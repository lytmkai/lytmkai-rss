<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[TypeScript 中如何精准禁止函数参数包含特定属性]]></title>    <link>https://juejin.cn/post/7599641289886892078</link>    <guid>https://juejin.cn/post/7599641289886892078</guid>    <pubDate>2026-01-27T06:48:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599641289886892078" data-draft-id="7599640782569930779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 中如何精准禁止函数参数包含特定属性"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-27T06:48:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="biggerdong"/> <meta itemprop="url" content="https://juejin.cn/user/782508007891192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 中如何精准禁止函数参数包含特定属性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/782508007891192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    biggerdong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:48:12.000Z" title="Tue Jan 27 2026 06:48:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TypeScript 中如何精准禁止函数参数包含特定属性</h2>
<p>你想知道在 TypeScript 中如何定义函数参数，<strong>禁止</strong> 参数对象包含某个特定的属性，对吧？这是一个很实用的类型约束场景，TypeScript 可以通过 <strong>类型工具</strong> 精准实现这个需求。</p>
<h4 data-id="heading-1">一、核心实现思路</h4>
<p>要禁止参数包含某个属性，核心是利用 TypeScript 的：</p>
<ol>
<li>
<p><code>Omit</code>：排除对象中指定的属性（基础）；</p>
</li>
<li>
<p><code>never</code> 类型 + 交叉类型：强制指定属性为 <code>never</code>，一旦传入就报错（精准禁止）。</p>
</li>
</ol>
<h4 data-id="heading-2">二、完整实现示例</h4>
<p>下面提供两种常用方案，你可以根据场景选择：</p>
<h5 data-id="heading-3">方案 1：基础版（仅排除属性，无明确报错）</h5>
<p>适用于「参数可以没有该属性，但不能有」的基础场景，通过 <code>Omit</code> 排除指定属性：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">
<span class="hljs-comment">// 定义基础类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">// 想要禁止的属性</span>
  <span class="hljs-attr">forbiddenProp</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 排除 forbiddenProp 属性，得到「允许传入」的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AllowedUser</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">'forbiddenProp'</span>&gt;;

<span class="hljs-comment">// 函数参数仅允许 AllowedUser 类型（即禁止传入 forbiddenProp）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUser</span>(<span class="hljs-params">user: AllowedUser</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">id</span>, user.<span class="hljs-property">name</span>);
}

<span class="hljs-comment">// ✅ 正确：没有 forbiddenProp</span>
<span class="hljs-title function_">printUser</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> });

<span class="hljs-comment">// ❌ 错误：包含 forbiddenProp，TypeScript 会报错</span>
<span class="hljs-title function_">printUser</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp</span>: <span class="hljs-number">123</span> });
</code></pre>
<h5 data-id="heading-4">方案 2：严格版（强制禁止，明确报错）</h5>
<p>适用于「即使传入该属性为 undefined/null 也报错」的严格场景，通过交叉类型 + <code>never</code> 实现：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">
<span class="hljs-comment">// 定义一个「禁止包含某属性」的通用类型工具</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ForbidProperty</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof <span class="hljs-built_in">any</span>&gt; = T &amp; {
  [P <span class="hljs-keyword">in</span> K]?: <span class="hljs-built_in">never</span>; <span class="hljs-comment">// 强制指定属性为 never（可选但不能有值）</span>
};

<span class="hljs-comment">// 基础用户类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// 禁止传入 forbiddenProp 属性（即使传 undefined 也报错）</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserForbidForbiddenProp</span> = <span class="hljs-title class_">ForbidProperty</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">'forbiddenProp'</span>&gt;;

<span class="hljs-comment">// 函数参数使用严格禁止类型</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUserStrict</span>(<span class="hljs-params">user: UserForbidForbiddenProp</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">id</span>, user.<span class="hljs-property">name</span>);
}

<span class="hljs-comment">// ✅ 正确：无 forbiddenProp</span>
<span class="hljs-title function_">printUserStrict</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> });

<span class="hljs-comment">// ❌ 错误：包含 forbiddenProp（有值）</span>
<span class="hljs-title function_">printUserStrict</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp</span>: <span class="hljs-number">123</span> });

<span class="hljs-comment">// ❌ 错误：包含 forbiddenProp（即使值为 undefined）</span>
<span class="hljs-title function_">printUserStrict</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp</span>: <span class="hljs-literal">undefined</span> });
</code></pre>
<h5 data-id="heading-5">方案 3：禁止多个属性（扩展场景）</h5>
<p>如果需要禁止多个属性，只需扩展通用类型工具：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">
<span class="hljs-comment">// 通用类型：禁止多个属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ForbidProperties</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof <span class="hljs-built_in">any</span>&gt; = T &amp; {
  [P <span class="hljs-keyword">in</span> K]?: <span class="hljs-built_in">never</span>;
};

<span class="hljs-comment">// 禁止传入 forbiddenProp1 和 forbiddenProp2</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserForbidMultiProps</span> = <span class="hljs-title class_">ForbidProperties</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">'forbiddenProp1'</span> | <span class="hljs-string">'forbiddenProp2'</span>&gt;;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUserMulti</span>(<span class="hljs-params">user: UserForbidMultiProps</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">id</span>, user.<span class="hljs-property">name</span>);
}

<span class="hljs-comment">// ❌ 错误：包含禁止的属性</span>
<span class="hljs-title function_">printUserMulti</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp1</span>: <span class="hljs-string">'xxx'</span> });
<span class="hljs-title function_">printUserMulti</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp2</span>: <span class="hljs-number">123</span> });
</code></pre>
<h4 data-id="heading-6">三、关键知识点解析</h4>
<ol>
<li>
<p><strong><code>Omit&lt;T, K&gt;</code></strong>：</p>
<ul>
<li>
<p>作用：从类型 <code>T</code> 中排除指定的属性 <code>K</code>，返回新类型。</p>
</li>
<li>
<p>局限性：仅排除属性，若手动传入该属性且值为 <code>undefined</code>，TypeScript 不会报错（如 <code>{ id: '1', name: '张三', forbiddenProp: undefined }</code> 会被允许）。</p>
</li>
</ul>
</li>
<li>
<p><strong><code>ForbidProperty&lt;T, K&gt;</code></strong> ** 通用工具**：</p>
<ul>
<li>
<p><code>T &amp; { [P in K]?: never }</code>：交叉类型，要求对象既符合 <code>T</code>，又要求指定属性 <code>K</code> 的类型为 <code>never</code>。</p>
</li>
<li>
<p><code>never</code> 类型：表示「不存在的类型」，任何值都不能赋值给 <code>never</code> 类型，因此传入该属性会直接报错。</p>
</li>
<li>
<p><code>?:</code> 可选修饰符：确保即使不传入该属性也不会报错，仅限制「传入时」的情况。</p>
</li>
</ul>
</li>
<li>
<p><strong>报错提示示例</strong>：</p>
</li>
</ol>
<p>当传入禁止的属性时，TypeScript 会给出清晰的错误提示：</p>
<pre><code class="hljs language-Plain" lang="Plain">
类型“{ id: string; name: string; forbiddenProp: number; }”的参数不能赋给类型“UserForbidForbiddenProp”的参数。
对象文字可以只指定已知属性，并且“forbiddenProp”不在类型“UserForbidForbiddenProp”中。
</code></pre>
<h4 data-id="heading-7">四、结合你之前的 Electron 场景示例</h4>
<p>如果要在创建 <code>BrowserWindow</code> 相关函数中禁止传入某个属性（比如禁止传入 <code>invalidId</code>）：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserWindowConstructorOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'electron'</span>;

<span class="hljs-comment">// 禁止传入 invalidId 属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ValidWindowOptions</span> = <span class="hljs-title class_">ForbidProperty</span>&lt;<span class="hljs-title class_">BrowserWindowConstructorOptions</span>, <span class="hljs-string">'invalidId'</span>&gt;;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createWindow</span>(<span class="hljs-params">options: ValidWindowOptions</span>) {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>(options);
  <span class="hljs-comment">// ... 其他逻辑</span>
}

<span class="hljs-comment">// ✅ 正确：无 invalidId</span>
<span class="hljs-title function_">createWindow</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">600</span> });

<span class="hljs-comment">// ❌ 错误：包含禁止的 invalidId</span>
<span class="hljs-title function_">createWindow</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>, <span class="hljs-attr">invalidId</span>: <span class="hljs-string">'123'</span> });
</code></pre>
<h4 data-id="heading-8">总结</h4>
<ol>
<li>
<p>禁止函数参数包含某个属性的核心是：</p>
<ul>
<li>
<p>基础场景用 <code>Omit&lt;T, K&gt;</code> 排除属性；</p>
</li>
<li>
<p>严格场景用 <code>T &amp; { [P in K]?: never }</code> 强制该属性为 <code>never</code>。</p>
</li>
</ul>
</li>
<li>
<p><code>ForbidProperty</code> 是通用类型工具，可复用在任意需要禁止属性的场景。</p>
</li>
<li>
<p>严格方案能阻止「传入属性且值为 undefined/null」的情况，比单纯 <code>Omit</code> 更严谨。</p>
</li>
</ol>
<blockquote>
<p>（注：文档部分内容可能由 AI 生成）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用户实践｜用 TRAE 开发 XMind-MCP 的心路历程]]></title>    <link>https://juejin.cn/post/7599232628185677859</link>    <guid>https://juejin.cn/post/7599232628185677859</guid>    <pubDate>2026-01-26T07:16:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599232628185677859" data-draft-id="7599247962822836251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用户实践｜用 TRAE 开发 XMind-MCP 的心路历程"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-26T07:16:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用户实践｜用 TRAE 开发 XMind-MCP 的心路历程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T07:16:16.000Z" title="Mon Jan 26 2026 07:16:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f9f9e31fd29402891f0e6d74022a415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=I%2BZ8IOyEVtIKlC8uYr66m6VDbP4%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者：张博思，TRAE 开发者用户</p>
</blockquote>
<p>本文记录了一个从“被 AI 生成的损坏文件搞到抓狂”到“自己动手开发一个 XMind-MCP 工具”的全过程。如果你也曾为 AI 生成的思维导图无法打开而烦恼，或者对如何为 AI 扩展能力感到好奇，这里有我的踩坑、思考与实践经验。项目已开源（仓库见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMaster-Frank%2FXMindMcp" target="_blank" title="https://github.com/Master-Frank/XMindMcp" ref="nofollow noopener noreferrer">github.com/Master-Fran…</a> ），欢迎围观。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e6b9100e69140c9a2cf5fdb0800e8f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=66GKOrrMhu8zAr0l0HNW9%2FEw12w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>缘起：一个被 AI“逼上梁山”的下午</strong></h2>
<p>故事始于一个普通的下午，我让 TRAE 帮我规划一份 Playwright 的学习路线。为了更直观，我突发奇想，让它把学习计划转成 XMind 格式的思维导图。</p>
<p>AI 很快给了我一个 XMind 文件，但当我尝试用 XMind 打开时，却收到了无情的错误提示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a92447e12a0d4641b894a8b30e93137a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=tLxSlFU%2BhTrw3hhwmwYK1K1zioU%3D" alt="" loading="lazy"/></p>
<p>我不死心，把错误代码发给 AI，指望它能帮我修复。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f5b8a7a7bfe45018a70f0ce8aa74528~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=QOsCqHHxdva5erQWbvkYUBeEUx4%3D" alt="" loading="lazy"/></p>
<p>然而，反复修改了几次，生成的 XMind 文件依然无法打开。那时我意识到，<strong>AI 可能缺乏创建 XMind 文件的技能。</strong></p>
<p>既然 AI 做不到，那就给它一个工具帮他做到！于是，我决定自己动手，开发一个能让 AI 真正操作 XMind 文件的 MCP（模型上下文协议）工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88444b826d454d44bd6e1af9b5cdcc41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=x4%2FX66kRCuhn32K%2B3yG8dWnR9H8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>为什么我选择把 XMind 工具做成 MCP 格式</strong></h2>
<p>原因其实很简单，总结下来就三点：</p>
<p>第一，我不想让写的操作 XMind 的代码只发挥一次作用。它需要能跨项目复用，并且能方便分享，让更多人都能用上，实实在在地提升效率。因此需要将代码打包。</p>
<p>第二，如果打包成 jar 包或 npm 包，不仅使用门槛偏高，还会受限于项目的编程语言，用起来没有那么灵活便捷。</p>
<p>第三，也是最核心的一点 —— 我做这个工具的初衷，就是让 AI 能帮我们直接生成 XMind 文档。而当下主流的、能让 AI 接入外部能力的方式就是 MCP，所以它自然成了实现这个目标的最优解。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a17d904d752347969b76722d6823f6e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=GYRJxyigpMwsK6qUqBabUyUdSVY%3D" alt="divider03.png" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>从 0 到 1：我的 XMind-MCP 开发笔记</strong></h2>
<h3 data-id="heading-3"><strong>技术选型：在 Node 碰壁后，转向 Python</strong></h3>
<p>这是我第一次尝试自己做一个 MCP，所以一开始没什么头绪。还好有 TRAE 陪我慢慢探索。最初，我看到很多 MCP 工具是通过 npx 安装的，便猜测或许可以用 Node 代码实现。我让 AI 帮我尝试了十几个不同的 npm 包，结果无一成功。</p>
<p>在反复验证后，我得出一个结论：<strong>目前来看，当前没有使用 Node 生成正常的 XMind 文件的方案。</strong> 于是，我把目光转向了后端语言，最终选择了 Python。</p>
<h3 data-id="heading-4"><strong>攻克核心：既然 AI 不懂，就给它一个“范本”</strong></h3>
<p>转向 Python 后，挑战依然存在。起初反复尝试，发现产出的文件在 XMind 中打开时，依然会因为 XML 格式问题报错。不过，报错的信息和刚开始的不一样。这让我意识到，方向对了，只是细节不对。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c5e366eeaf34de58a8c990516abc240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=%2B1uwHzg8f6%2BfdPzM%2FFraI5FnTxY%3D" alt="" loading="lazy"/></p>
<p>既然 AI 不知道正确的 XMind 文件内部结构是什么样的，<strong>那我就给它一个标准答案。</strong></p>
<p>我打开 XMind，手动创建了一个简单的 XMind 文件，把它放在项目目录中作为“模板”交给 AI，让它参考这个文件的内部结构和 XML 格式来重新编写生成 XMind 的逻辑。这个方法立竿见影，仅用几轮对话，AI 就帮我写出了能生成可正常打开的 XMind 文件的核心代码！</p>
<p>这也给我带来一个在 AI coding 中的宝贵经验：<strong>当 AI 不知道一件事怎么做时，给他一个“标准答案”。</strong> 这听起来像不像 skills 的思路？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32febcd3858143daae1883493fe4bf9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=ZAoMpbn1pU3N2gCHzS5y3sVoxkM%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd7562adf57b4ffd89e91ee3024ceeee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=4dtkFYUw%2B%2Fj2IbQtCuar%2F9TNwGI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5"><strong>封装成 MCP：服务器方案的弯路与 PyPI 的正途</strong></h3>
<p>核心功能完成后，下一步是把它封装成一个能被 AI 调用的 MCP 工具。</p>
<p>第一次封装 MCP 没有经验，因此我向 AI 了解封装 MCP 的方案。AI 给出的最佳的建议是——将 XMind MCP 部署到服务器上，通过 HTTP 接口的方式提供 XMind 相关的服务。为此，我还认真研究和对比了各种免费服务器方案。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c30014e92a24bbbbd637954a30784db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=VUStnQGOYW1fGugYH9Ia7BK4xuE%3D" alt="" loading="lazy"/></p>
<p>我对服务器部署的方案进行逐一验证，最后证明本 XMind MCP 无法通过 HTTP 的方式成功安装并提供服务。</p>
<p>我故技重施，在 TRAE 的 MCP 市场中查看热门 MCP 的安装方式并提供给 AI 用于参考。我发现大部分 MCP 是不需要服务器，支持本地安装的。例如我最近正在学习的 playwright。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e55965f97cc40b68d4b7d726af146e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=dmQbkLGN7AdNuit5P95lkMW8w2c%3D" alt="" loading="lazy"/></p>
<p>同时我查看了官方文档<strong>模型上下文协议（MCP） - 文档 - TRAE CN</strong>（ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.trae.cn%2Fide%2Fmodel-context-protocol" target="_blank" title="https://docs.trae.cn/ide/model-context-protocol" ref="nofollow noopener noreferrer">docs.trae.cn/ide/model-c…</a> ），支持本地打包安装的方式大抵有这三种</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b0a2ce5b0db425fbfd51006d2aa9f2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=R90gZw%2FoyaR5LWedNSwSbl1n914%3D" alt="" loading="lazy"/></p>
<p>既然本项目使用的编程语言是 Python，选择很显然是 uvx ！而如果需要使用 uvx 的方式安装，首先需要打包发布到 PyPI 平台。</p>
<p>于是，我注册了 PyPI 账号，把我的项目打了包并发布。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0df536372e3643b487c4a3b646b2ec0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=ci97ZNh1yEEnkW%2FVXKiO9YWf7eE%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>当使用<em><strong>pip install XMind-mcp</strong></em>成功的那一刻，感觉非常奇妙。写了这么多年代码，终于让别人也能<em><strong>install</strong></em>我的包了！</p>
</blockquote>
<p>确定 MCP 的安装方式后，还需要确定 MCP 的连接方式。常见的 MCP 连接方式有 FastMCP 和 stdio 两种，我选择了 FastMCP。 </p>
<p>在配置 FastMCP 的过程又遇到了些波折，发现不同的大模型在解决同一个问题时的表现也各有千秋。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f947f7b4ece4789864e14461d00f968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=TvtIbPWokO3IhCbUnaDS2eArLXo%3D" alt="" loading="lazy"/></p>
<p>很意外的是，GPT5 等海外模型没成功帮我解决 MCP 连接的问题，但是 Kimi K2 解决成功了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ed212dda7b54cdfa32cf85115a06a5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=4FUYf83HT%2Fes8xQEbDVEa9JTlrw%3D" alt="" loading="lazy"/></p>
<p>这段经历让我学到一个宝贵的教训：</p>
<blockquote>
<p><strong>遇到问题，如果几轮对话都无法解决，不要死磕，不妨换个模型试试。</strong> 就像遇到问题没有头绪时，咨询下其他人的意见，可能就豁然开朗了。</p>
</blockquote>
<h3 data-id="heading-6"><strong>实战与迭代：从“能用”到“好用”</strong></h3>
<p>MCP 工具初步跑通后，新的问题出现了：<strong>生成的 XMind 文件保存在哪里？</strong></p>
<p>我发现，由于 MCP 是通过 uvx 安装在 uv 的环境下，它运行时获取到的“当前目录”并不是我项目的工作区目录，导致生成的文件“不知所踪”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a804d1bc061f4e678463bbf0ef78f03c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=16ExcWAe01p7462XxK81k3QE0UM%3D" alt="" loading="lazy"/></p>
<p>为了解决这个问题，我从产品思维出发，做了两点改进：</p>
<p><strong>1、入参设置输出路径：</strong> 增加一个必填的输出路径参数，让 AI 可以指定生成的文件保存的位置。</p>
<p><strong>2、明确路径反馈：</strong> 让 MCP 在执行成功后，<strong>必须返回生成文件的绝对路径</strong>，方便用户找到。</p>
<p>我在本地测试通过后，我邀请了社区的 Nolan 大佬帮忙测试。果然，“不出意外就要出意外了”。在他的项目里，AI 似乎没完全理解如何正确调用我的 XMind MCP，导致生成的 XMind 结构错乱。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5f4e5818d7e447eab4ca41b41d43640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=O8bNDf3dsMnT0HXYbxg3Gsbuk2U%3D" alt="" loading="lazy"/></p>
<p>我认为问题出在 AI 对工具的“理解”上。我需要让我的 MCP “自我介绍”得更清楚。</p>
<p>于是我在 TRAE 请教 AI 有没有好的解决办法</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b93fe486e54f3eb37fa11fc7dfe1c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=t3ACu8bS9iEtnGo7mTsa9VJo6Yk%3D" alt="" loading="lazy"/></p>
<p>结果和我猜想的一样，需要完善 MCP 的自描述。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7643552875a464184d1c31920e2d459~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=mWSpggY%2BaK3K8jftLbBvJaOyP98%3D" alt="" loading="lazy"/></p>
<p>接下来我使用 TRAE 优化了 MCP 的自描述信息，详细说明了每个方法中每个参数的用途和数据结构，特别是核心的 data 参数应该如何组织层级关系。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3fa3ae859af4112aa237f06adacd611~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=Qz3wKxBM%2FTCqGMJgKyPj3aC%2BMwA%3D" alt="" loading="lazy"/></p>
<p>这次优化效果显著。经过 4 天、21 个版本的迭代，在 TRAE 的持续帮助下，这个 XMind MCP 工具终于达到了稳定好用的状态。现在，AI 已经能一次性生成结构清晰、内容正确的思维导图了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12babf1762c84889bbf03795ea6fbc73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=SE6gRPeQv78xnUB4Rp%2FH3PNT0VM%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ce627c0616643a38beaef0283094c5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=5YbxvLLWSONP66l3bXJpZWdj4Tw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f61fed40cd245cebbe5755cf8e4c77f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=xxlnfAnZevEgmMArova0I6VUltI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7"><strong>三步用上 XMind-MCP</strong></h2>
<p>使用这个工具非常简单，毕竟，<strong>给 AI 用的工具，就不该为难人类用户。</strong></p>
<p><strong>第一步：复制配置</strong>在 TRAE 对话框的“设置” -&gt; “MCP”标签页下，点击“手动添加”，然后粘贴以下 JSON 配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"XMind"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uvx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"XMind-mcp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--mode"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"fastmcp"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1b87e0d3174ec4babd7dfe140c2c54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=wwdl4DvYh2L8tdQLaOGeLH%2BAaLk%3D" alt="" loading="lazy"/></p>
<p><strong>第二步：安装环境依赖</strong>如果你的电脑没有安装过 Python 或 uv，TRAE 会引导你进行安装。对于 Windows 用户，安装 <em><strong>uv</strong></em> 后，<strong>请确保将</strong> <em><strong>uv</strong></em> <strong>的安装路径</strong> <strong>（通常是</strong> <em><strong>C:\Users\YourUsername.uv\bin</strong></em> <strong>）手动添加到系统环境变量的</strong> <em><strong>Path</strong></em> <strong>中。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/839f92fed3944973929db34a5ca03d15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=3V4PPmVBxFypHIslbPPSIAnNqwY%3D" alt="" loading="lazy"/></p>
<p><strong>第三步：选择智能体并开始使用</strong>安装成功后，选择你刚刚配置了 XMind-MCP 的那个智能体，然后就可以直接向 AI 下达指令了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b0786ca0ee246c2b71e64a2da6a42fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=am2hku%2B5k0KIl77dd8p4FoN%2Fnmk%3D" alt="" loading="lazy"/></p>
<p>例如，你可以说： <strong>“帮我使用 XMind mcp 生成一个关于 agent 学习的 XMind 文件。”</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/420d9545409f4364b9e50c02087073c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=ald%2B4UnA23dmp2bbVRJJFJzcvmo%3D" alt="" loading="lazy"/></p>
<p><strong>欢迎大家体验，有任何问题或建议，随时可以向我反馈！</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbd7580335ee4013be8e225251a3b7b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=%2B3a%2FQ9d3fggolb9faCTgCCZbB9g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8"><strong>XMind MCP 能做什么？</strong></h2>
<p>目前，XMind-MCP 支持以下核心功能：</p>
<ul>
<li>
<p><strong>读取思维导图：</strong> 读取 XMind 文件中每个节点的信息</p>
</li>
<li>
<p><strong>创建思维导图：</strong> 使用结构化数据（如 JSON）创建新的 XMind 文件。</p>
</li>
<li>
<p><strong>文件格式转换：</strong> 支持将 TXT、Markdown、HTML、Word、Excel 等多种格式的内容直接转换成 XMind 思维导图。</p>
</li>
<li>
<p><strong>分析思维导图结构：</strong> 分析 XMind 文件中的节点数和最大层级等信息，并给出是否健康的评价。</p>
</li>
<li>
<p><strong>文件检索：</strong> 列出指定目录下的所有 XMind 文件。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d5742f7f1d8422f90e8ca85da39e4b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=esEY%2Bm%2BKwtlvHRdOAwDw9q%2B7enI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别证书过期焦虑！这款开源工具让 SSL 管理彻底自动化！]]></title>    <link>https://juejin.cn/post/7598737609495068691</link>    <guid>https://juejin.cn/post/7598737609495068691</guid>    <pubDate>2026-01-26T01:21:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609495068691" data-draft-id="7597946284678414355" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别证书过期焦虑！这款开源工具让 SSL 管理彻底自动化！"/> <meta itemprop="keywords" content="Go,Docker,React.js"/> <meta itemprop="datePublished" content="2026-01-26T01:21:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java陈序员"/> <meta itemprop="url" content="https://juejin.cn/user/3958702402176765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别证书过期焦虑！这款开源工具让 SSL 管理彻底自动化！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3958702402176765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java陈序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:21:25.000Z" title="Mon Jan 26 2026 01:21:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是 <code>Java陈序员</code>。</p>
<p>无论是研发个人产品，还是中小企业做运维，会遇到要管理多个域名的情况，需要给域名申请证书。</p>
<p>但是手动申请证书往往很麻烦（尤其是有多个域名需要维护），而且很容易遗忘证书的过期。</p>
<p>今天，给大家推荐一款开源的证书管理工具，全流程管控 SSL 管理！</p>
<h2 data-id="heading-0">项目介绍</h2>
<p><code>certimate</code> —— 一款完全开源免费的自托管 SSL 证书 ACME 工具，申请、部署、续期全流程自动化可视化，支持各大主流云厂商。</p>
<p><strong>功能特色</strong>：</p>
<ul>
<li><strong>全流程自动化</strong>：无需编写代码，通过界面拖拽/配置即可搭建证书管理流程，配置完成后，从证书申请、ACME 验证到部署至目标平台，全程无需人工干预</li>
<li><strong>私有化部署</strong>：无需安装数据库、运行时或复杂框架，一键启动，开箱即用，所有数据本地化存储，掌控数据的隐私与安全</li>
<li><strong>生态适配拉满</strong>：阿里云、腾讯云、Cloudflare、AWS、华为云等主流域名托管商全覆盖，同时兼容 Let's Encrypt、Google Trust Services、ZeroSSL 等主流免费/付费证书颁发机构</li>
<li><strong>多维度监控</strong>：证书到期、申请失败、部署异常等状态，可通过邮件、钉钉、飞书、企业微信、Webhook 等实时推送</li>
<li><strong>轻量开源</strong>：超轻量的资源开销，仅需 ~16 MB 内存，完全开源免费，无功能阉割、无付费门槛</li>
</ul>
<h2 data-id="heading-1">快速上手</h2>
<p><code>certimate</code> 支持二进制安装、Docker 安装、源码编译安装等多种安装方式。</p>
<h3 data-id="heading-2">二进制安装</h3>
<p>1、下载预先编译好的二进制可执行文件压缩包</p>
<pre><code class="hljs language-bash" lang="bash">https://github.com/certimate-go/certimate/releases
</code></pre>
<blockquote>
<p>压缩包文件名后缀包含系统架构信息，需要根据操作系统自行选择相应的压缩包，下载并解压缩全部文件。</p>
</blockquote>
<p>2、进入解压后的目录，并在终端中执行</p>
<pre><code class="hljs language-bash" lang="bash">./certimate serve
</code></pre>
<p>3、运行成功后，浏览器访问</p>
<pre><code class="hljs language-bash" lang="bash">http://{IP/域名}:8090
</code></pre>
<p>4、初始的管理员账号及密码：</p>
<ul>
<li>账号：<code>admin@certimate.fun</code></li>
<li>密码：<code>1234567890</code></li>
</ul>
<h3 data-id="heading-3">Docker 安装</h3>
<ul>
<li>Docker 命令安装</li>
</ul>
<p>1、拉取镜像</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取镜像</span>
docker pull certimate/certimate:latest

<span class="hljs-comment"># 国内镜像</span>
docker pull registry.cn-shanghai.aliyuncs.com/certimate/certimate:latest
</code></pre>
<p>2、创建挂载目录</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /data/software/certimate
</code></pre>
<p>3、运行容器</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name certimate \
  --restart unless-stopped \
  -p 8090:8090 \
  -v /etc/localtime:/etc/localtime:ro \
  -v /etc/timezone:/etc/timezone:ro \
  -v /data/software/certimate:/app/pb_data \
  certimate/certimate:latest

<span class="hljs-comment"># 国内镜像</span>
docker run -d \
  --name certimate \
  --restart unless-stopped \
  -p 8090:8090 \
  -v /etc/localtime:/etc/localtime:ro \
  -v /etc/timezone:/etc/timezone:ro \
  -v /data/software/certimate:/app/pb_data \
  registry.cn-shanghai.aliyuncs.com/certimate/certimate:latest
</code></pre>
<ul>
<li>Docker Compose 安装</li>
</ul>
<p>1、创建 <code>docker-compose.yml</code> 文件并填写如下内容</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.0"</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">certimate:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">certimate/certimate:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">certimate</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8090</span><span class="hljs-string">:8090</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime:ro</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/timezone:/etc/timezone:ro</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/app/pb_data</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
</code></pre>
<p>2、一键启动</p>
<pre><code class="hljs language-bash" lang="bash">docker compose up -d
</code></pre>
<h2 data-id="heading-4">功能体验</h2>
<ul>
<li><strong>仪表盘</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0d8869e1c654e6b9007bdbd0792d8ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=e38SmIDBJ5Vsa3OkccizXoUP9XI%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>工作流</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5921ef5b112475d94facde6cd7e6fc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=t8ECONOTXEq1DTrDADepW%2BAXE%2Fk%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>流程编排</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1176b9788c11438e9c80ce9877658a59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=GrEhNym5YUkU2%2F8Sh%2BV9b8ERxIs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ce60274ad914d878d6d4e030510ccfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=6ul%2F6tjKI3dtLK%2FS238Ewq8ZEgw%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>运行历史</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f79adac1a506433ca3fe637fd6e956f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=M4aqkbYG5laPpx3XMCZmbClzBrw%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>主机提供商</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d14a9cd23552477c81cd83ee3feddec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=11cGKKwI3fdhw0lMqjx2bz69qC0%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>证书颁发机构</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e76ead178c843c7b944c326ee08efff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=d5gBAnY7OMiux5osPBCLXUfM4%2FE%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>通知渠道</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e858e0800de5470786354eb73f099db1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=xnlX%2FWbtqxtOFD5YPcXPD6id94g%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>系统设置</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05ef7e6c4d7d4d3989c8156196a73979~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=1uk5fx0mYM6MKF5T3CXxapqvCwc%3D" alt="" loading="lazy"/></p>
<p>可以说，<code>certimate</code> 把 SSL 证书管理从<strong>重复体力活</strong>变成<strong>自动化流程</strong>。不仅私有化部署可以保障数据安全，而且丰富的生态适配满足不同场景需求。无论是个人还是企业，都能通过它彻底告别证书过期的焦虑。快去部署体验吧~</p>
<pre><code class="hljs language-bash" lang="bash">项目地址：https://github.com/certimate-go/certimate
</code></pre>
<h2 data-id="heading-5">最后</h2>
<p>推荐的开源项目已经收录到 <code>GitHub</code> 项目，欢迎 <code>Star</code>：</p>
<pre><code class="hljs language-bash" lang="bash">https://github.com/chenyl8848/great-open-source-project
</code></pre>
<p>或者访问网站，进行在线浏览：</p>
<pre><code class="hljs language-bash" lang="bash">https://chencoding.top:8090/<span class="hljs-comment">#/</span>
</code></pre>
<blockquote>
<p>大家的点赞、收藏和评论都是对作者的支持，如文章对你有帮助还请点赞转发支持下，谢谢！</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 ES 的搜索结果只到 10,000？强制“数清楚”的代价有多大]]></title>    <link>https://juejin.cn/post/7599514071104765967</link>    <guid>https://juejin.cn/post/7599514071104765967</guid>    <pubDate>2026-01-26T10:33:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599514071104765967" data-draft-id="7599220371666272296" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 ES 的搜索结果只到 10,000？强制“数清楚”的代价有多大"/> <meta itemprop="keywords" content="搜索引擎"/> <meta itemprop="datePublished" content="2026-01-26T10:33:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 ES 的搜索结果只到 10,000？强制“数清楚”的代价有多大
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T10:33:09.000Z" title="Mon Jan 26 2026 10:33:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“为什么搜出来的结果总数永远是 10,000？是不是数据丢了？”</p>
</blockquote>
<p>这是每一个 Elasticsearch 新手在 7.x 版本之后都会遇到的“灵魂发问”。</p>
<p>而在得知“这是 ES 的默认性能优化”后，绝大多数人的第一反应往往是抗拒：“我不想要优化，我要精准的数字！老板要看，前端分页也要用。”</p>
<p>于是，在许多项目的代码库里，我们都能看到这样一行“补丁”：</p>
<p><code>"track_total_hits": true</code></p>
<p>数字终于准了，变成了 854,321，大家都很满意。</p>
<p>但没人注意到，就在这行代码生效的瞬间，集群的 CPU 占用率可能直接翻倍，查询延迟从 20ms 劣化到了 500ms。</p>
<p>为什么一个简单的“计数”，会成为拖垮集群性能的隐形杀手？</p>
<p>今天，我们不谈玄学，从 Lucene 底层原理 层面，揭秘这背后的代价。</p>
<h2 data-id="heading-0">现象：消失的“尾部数据”</h2>
<p>在 ES 7.0 之前，查询默认会算出精确总数。但在 7.0 之后，默认的响应体变成了这样：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"hits"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"relation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gte"</span>  <span class="hljs-comment">// 注意：Greater Than or Equal to (大于等于)</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    ...
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这不仅是一个数字的变化，更是搜索引擎检索逻辑的根本性范式转移：</p>
<p>从“找出所有匹配文档”进化为“只找出最有价值的 Top N”。</p>
<h2 data-id="heading-1">深度解析：Block-Max WAND 算法的智慧</h2>
<p>要理解为什么“数不准”能带来性能飞跃，必须深入 Lucene 的底层，了解 Block-Max WAND (BMW) 算法。</p>
<h3 data-id="heading-2">1. 倒排索引的物理结构：Block</h3>
<p>在 Lucene 的倒排索引（Inverted Index）中，一个 Term（词项）对应的 Postings List（文档 ID 列表）并不是一整条长链，而是被切分成了多个 Block（块），通常包含 128 个文档 ID。</p>
<p>关键点在于：</p>
<p>每个 Block 都有一个 Block Header，里面记录了这个块的元数据，其中最重要的一个是：</p>
<p>Max Score（块内最大分数）：即这个 Block 里所有文档中，能产生的最高相关性得分是多少。</p>
<h3 data-id="heading-3">2. 竞速机制：Min Competitive Score</h3>
<p>当 ES 执行查询（比如查询“手机”）并索要 Top 10 结果时，它会维护一个 最小竞争分数（Min Competitive Score）。</p>
<ul>
<li>
<p>刚开始，Top 10 没满，最小竞争分数是 0。</p>
</li>
<li>
<p>随着扫描进行，找到了 10 个文档，第 10 名的分数是 5.0。</p>
</li>
<li>
<p>此时，最小竞争分数变成了 5.0。意味着：任何分数低于 5.0 的文档，连进决赛圈的资格都没有。</p>
</li>
</ul>
<h3 data-id="heading-4">3. “隔山打牛”的跳跃优化</h3>
<p>接下来，神奇的事情发生了。</p>
<p>当遍历指针来到下一个 Block（假设包含 ID 1000-1127）时，算法不需要解压这个 Block，也不需要计算具体的文档分数，而是直接看 Block Header：</p>
<blockquote>
<p>算法拷问： “这个 Block 的 Max Score 是多少？”Block 回答： “最高只能得 4.5 分。”算法判断： “现在的门槛（Min Competitive Score）已经是 5.0 了。你这个 Block 里的文档全是‘废柴’，整个 Block 直接跳过！”</p>
</blockquote>
<p>结果： ES 可能直接跳过了数百万个低分文档。</p>
<p>代价： 因为跳过了，ES 根本不知道刚才那个 Block 里有几个文档匹配（虽然分低，但确实匹配）。所以，它无法给出精确的总数。</p>
<h2 data-id="heading-5">隐形陷阱：为什么关了 track_total_hits 依然慢？</h2>
<p>你以为把 track_total_hits 设为 false 就万事大吉了？</p>
<p>别天真了。 在某些特定场景下，即使你显式关闭了计数，ES 依然无法使用 Block-Max WAND 进行剪枝，查询性能依然会很差。</p>
<p>这就好比你告诉司机“不用数路边有几棵树（不计数）”，但你同时又下令“把路边每棵树的叶子都摘一片下来（聚合）”。司机虽然不用数数，但他依然得停在每一棵树下。</p>
<h3 data-id="heading-6">1. 聚合（Aggregations）：WAND 的天敌</h3>
<p>WAND 算法的核心奥义是 “Skipping（跳过）”。</p>
<p>而聚合（Aggregations）的核心诉求是 “Traversing（遍历）”。</p>
<p>如果你在查询中包含任何聚合（例如 <code>terms</code>、<code>avg</code>、<code>date_histogram</code>），ES 必须访问所有匹配的文档来计算统计值。</p>
<ul>
<li>
<p>冲突点：你不能跳过一个 Block，因为那个被跳过的 Block 里可能包含聚合所需的数据。</p>
</li>
<li>
<p>结果：WAND 优化被迫关闭，全量扫描不可避免。</p>
</li>
</ul>
<h3 data-id="heading-7">2. 排序与分数的纠结（Sort + track_scores）</h3>
<p>Block-Max WAND 依赖于 Max Score 来进行跳跃。</p>
<ul>
<li>
<p>场景：你按时间排序 (<code>sort: [{"timestamp": "desc"}]</code>)。</p>
</li>
<li>
<p>陷阱：如果你手滑加了 <code>track_scores: true</code>（或者某些 Client 默认开启）。</p>
</li>
<li>
<p>后果：虽然是按时间排序，但因为你强行索要 <code>_score</code>，ES 必须对每个文档计算分数，导致无法利用 BKD Tree 的索引顺序进行快速跳跃，也难以通过 WAND 进行分数剪枝（因为排序不是按分数排的）。</p>
</li>
</ul>
<h2 data-id="heading-8">代价：track_total_hits 如何摧毁性能</h2>
<p>口说无凭，数据为证。我们在 Serverless 8.17 环境下，创建一个6分片1副本的索引，写入约 2 亿条 脱敏文档，总计约30G数据，查询qps控制在30 。用实测结果向你展示——track_total_hits 取不同值时的cu消耗及响应时长：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b42c37cdd0db4318af44b2873e09607b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770028389&amp;x-signature=%2Bz8vTJtg6%2BJbxbAYMp85ITEtTr4%3D" alt="" loading="lazy"/></p>
<p>CPU 资源消耗对比(true,false,10000)</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d01ffef0e164ba09662dc008a1a59c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770028389&amp;x-signature=8f4n1YHNv0N03LNaG8Y9Msihm%2FM%3D" alt="" loading="lazy"/></p>
<p>平均耗时和 P95 耗时对比(true,false,10000)</p>
<p>当你加上 "track_total_hits": true 时，你实际上是在对底层引擎下达一道“死命令”：</p>
<p>“禁用 Block-Max WAND 优化，禁止跳过任何一个 Block。”这带来的性能崩塌是显著的。</p>
<h3 data-id="heading-9">1. CPU 的燃烧（计算密集）</h3>
<ul>
<li>
<p>优化模式：只解压和计算高分 Block。</p>
</li>
<li>
<p>强制计数：必须解压所有匹配的 Block（使用 Frame Of Reference 编码），并对每一个文档 ID 进行解码和比对。</p>
</li>
<li>
<p>量级差异：如果查询匹配 1 亿条数据，原本只需计算 Top 1000 的分数，现在必须计算 1 亿次。CPU 消耗可能增加几个数量级。</p>
</li>
</ul>
<h3 data-id="heading-10">2. I/O 的雪崩（访存密集）</h3>
<ul>
<li>
<p>优化模式：低分 Block（通常是历史冷数据）直接跳过，不需要从磁盘读取。</p>
</li>
<li>
<p>强制计数：强制读取所有 Block。</p>
</li>
<li>
<p>后果：这会导致大量的随机 I/O。更致命的是，这些本该沉睡的冷数据被加载到内存中，会污染 Page Cache，把真正热点的数据（比如最近 5 分钟的日志）挤出去。</p>
</li>
<li>
<p>现象：你会发现，为了查一个总数，整个集群的写入性能和热查询性能都下降了。</p>
</li>
</ul>
<h2 data-id="heading-11">决策矩阵：到底什么时候该用？</h2>
<p>我们需要建立一个清晰的决策标准，而不是盲目地 <code>true</code>。</p>
<p><strong>场景</strong></p>
<p><strong>track_total_hits 设置</strong></p>
<p><strong>理由</strong></p>
<p><strong>C 端搜索 / App 列表</strong></p>
<p><code>false</code> 或 <code>10000</code> (默认)</p>
<p>用户只翻前几页。显示“10,000+”完全满足体验，性能最优。</p>
<p><strong>高频业务接口</strong></p>
<p><strong>(QPS &gt; 100)</strong></p>
<p><code>false</code></p>
<p>**绝对禁止开启。**高并发下开启全量计数是集群雪崩的导火索。</p>
<p><strong>后台管理 / 审核列表</strong></p>
<p><code>true</code> (慎用)</p>
<p>运营人员并发低，且必须知道确切的“待办数量”。</p>
<p><strong>数据大盘 / 趋势图</strong></p>
<p><code>false</code> (使用聚合)</p>
<p>不要用 hits.total 画图！请使用 <code>date_histogram</code> 或 <code>cardinality</code> 聚合。</p>
<p><strong>数据导出</strong></p>
<p><code>false</code></p>
<p>导出任务应使用 Scroll API 或 Point in Time (PIT) API，这些 API 针对全量遍历做了优化，不需要实时计算总数 。</p>
<h2 data-id="heading-12">Serverless 下的治理之道</h2>
<p>在自建集群中，很难限制开发者的代码行为。但在 阿里云 ES Serverless 中，我们建议通过配置进行防御性治理。</p>
<h3 data-id="heading-13">1. 软限制："Track Total Hits上限"</h3>
<p>你可以通过 ES Serverless 控制台—开启功能设置，给查询加上一道“保护锁”：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea09ce16766a4fcd982a9831070dbb65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770028389&amp;x-signature=f3h%2FjLvAZSfXxYfQYlpUWbWDrlk%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>效果：一旦设置，即使客户端请求中带了 <code>"track_total_hits": true</code>，服务端也会强制忽略，只计算到 10,000。</p>
</li>
<li>
<p>价值：从根源上防止了某个实习生的一行代码搞挂整个生产集群。</p>
</li>
</ul>
<h3 data-id="heading-14">2. 拥抱“模糊的正确”</h3>
<p>在云原生时代，算力是按量计费的（CU）。</p>
<p>“无意义的精确计数” = “直接烧钱”。</p>
<p>利用 Serverless 的弹性与治理能力，将算力集中在真正产生业务价值的 Top N 搜索上，才是降本增效的关键。</p>
<h2 data-id="heading-15">附录：代码与实操</h2>
<h4 data-id="heading-16">1. 正确的查询姿势 (DSL)</h4>
<p><strong>场景 A：只要 Top 10 (性能最快)</strong></p>
<pre><code class="hljs language-json" lang="json">GET /logs/_search
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"error"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"track_total_hits"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>  <span class="hljs-comment">// 显式关闭，连 10000 都不数，最快</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p><strong>场景 B：需要精确计数 (Java Client)</strong></p>
<pre><code class="hljs language-ini" lang="ini">SearchRequest <span class="hljs-attr">searchRequest</span> = new SearchRequest(<span class="hljs-string">"logs"</span>)<span class="hljs-comment">;</span>
SearchSourceBuilder <span class="hljs-attr">sourceBuilder</span> = new SearchSourceBuilder()<span class="hljs-comment">;</span>
sourceBuilder.query(QueryBuilders.matchQuery("message", "error"))<span class="hljs-comment">;</span>

// ⚠️ 警告：仅在必要时开启，注意性能损耗
sourceBuilder.trackTotalHits(true)<span class="hljs-comment">; </span>

// 或者设置一个具体的上限，例如 5万
// sourceBuilder.trackTotalHitsUpTo(50000)<span class="hljs-comment">; </span>

searchRequest.source(sourceBuilder)<span class="hljs-comment">;</span>
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<h3 data-id="heading-17">2. 高效替代方案：Cardinality 聚合</h3>
<p>如果你只是想知道“大概有多少条日志”，不要用 <code>track_total_hits</code>，请用 HyperLogLog 算法：</p>
<pre><code class="hljs language-json" lang="json">GET /logs/_search
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total_count_approx"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cardinality"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"_id"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 或者其他高基数主键</span>
        <span class="hljs-attr">"precision_threshold"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span> 
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<ul>
<li>
<p>优点：性能极快，内存占用极低。</p>
</li>
<li>
<p>缺点：有约 5% 以内的误差。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[血压飙升，Flutter & Dart 2025 年度巨坑回顾]]></title>    <link>https://juejin.cn/post/7598737609494855699</link>    <guid>https://juejin.cn/post/7598737609494855699</guid>    <pubDate>2026-01-25T22:56:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494855699" data-draft-id="7598744870995771435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="血压飙升，Flutter &amp; Dart 2025 年度巨坑回顾"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2026-01-25T22:56:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            血压飙升，Flutter &amp; Dart 2025 年度巨坑回顾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T22:56:12.000Z" title="Sun Jan 25 2026 22:56:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，Google 官方发布了<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FHQ5_59Mm1WT1xsiPuy6I2w" target="_blank" title="https://mp.weixin.qq.com/s/HQ5_59Mm1WT1xsiPuy6I2w" ref="nofollow noopener noreferrer">《Flutter &amp; Dart 2025 年度十大高光时刻回顾》</a>，内容包括：</p>
<ul>
<li>Flutter 3.29 - 3.38 版本更新</li>
<li>Dart 3.7 - 3.19 版本更新</li>
<li>Flutter Roadmap &amp; Google I/O</li>
<li>NotebookLM、teamLab、Agape、Universal Destinations &amp; Experiences、Reflection.app 、 GE Appliances 、talabat 等案例展示</li>
<li>Material 和 Cupertino 拆分进度</li>
<li>build_runner 提速速度</li>
<li>Dart 与 Flutter MCP Server</li>
<li>Flutter AI Toolkit 、GenUI</li>
<li>····</li>
</ul>
<p>但是又怎么可以报喜不报忧？既然官方报喜，那我就来点忧的，<strong>2025 在 Flutter 内容上我的大概写了有 60 来篇，稍微整理几个给大家直观回顾下 2025 Flutter 究竟经历了哪些经典巨坑</strong>。</p>
<blockquote>
<p>只能说 Flutter 坑接坑不断，但 iOS 能占一半。</p>
</blockquote>
<h2 data-id="heading-0">宏</h2>
<p>Flutter 在 2025 年 1 月的时候，开年就送上了大礼，官方决定 Dart 宏功能推进暂停，后续专注定制数据处理支持，宏功能是在 2024 年初开始决定推进的，而 2025 年开年，官方得到了一个结论：</p>
<blockquote>
<p><strong>做出来能用是能用，但是质量和性能都达不到一开始的预期，而且维护成本很高</strong>。</p>
</blockquote>
<p>所以对于社区里大家盼星星盼月亮都在等的宏支持就这么夭折了，虽然不久前官方也再次出来解释了为什么暂停：</p>
<ul>
<li>宏执行时序与 Dart 常量模型存在根本冲突</li>
<li>JSON metadata 方案“能跑但不可用”</li>
<li>Analyzer + CFE 双体系导致工作量与复杂度指数级爆炸</li>
<li>性能与 IDE 体验无法接受</li>
<li>无法完全替代 build_runner</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81e81873180b40cba601194c60110e2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=WFxWKmdWN7oVCpN2RZTh2otLvzw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7591730714140606506" target="_blank" title="https://juejin.cn/post/7591730714140606506">《Dart 官方再解释为什么放弃了宏编程》</a></p>
</blockquote>
<p>但是宏终归还是凉了，<strong>官方也将精力回归到 build_runer ，也在性能上做出了一些不小的提升</strong>，但是 Augmentation 支持还是没落地（它允许通过 <code>augment</code> 关键字，在新文件里去“补充”旧文件的定义），这也是 2025 官方在宣布宏放弃之后，没能完全填不上的坑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea3f5f30f6ce48f0822fdd68a237e75a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=nqEX9zEx22E%2Bd91K3e%2BZMBNZVKk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">线程合并</h2>
<p>线程合并是 Flutter 在 3.29 的重大调整，在过去 <strong>Flutter 的 UI Runner 和 Android/iOS 平台的 Platform Runner 是处于不同线程</strong>，其中 Dart 的 root isolate 会在被关联到 UITaskRunner 上。</p>
<p>所以在过去 Flutter 里会有异步 platform channels 的存在，因为 UI Runner 和 Platform Runner 分属不同线程，所以 Dart 和 Native 互相调用时需要序列化和异步消息传递。</p>
<p>而在 3.29 里，作为改进移动平台上 Native 和 Dart 互操作系列调整中的一部分，两个线程被合并了，说人话就是： <code>UI Runner = Platform Runner </code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/029fb241548e4f49a85825a6bbe41221~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=H63enzHN5IZAM4yEtC3G%2FoO4vUo%3D" alt="" loading="lazy"/></p>
<p>实际上这是一个不错的调整，<strong>因为同步调用是趋势，而且也能解决 Flutter 的许多历史问题，也是一个大趋势</strong>，但是步子迈大了，总会扯出一些问题，而线程合并带来的问题还不少：</p>
<ul>
<li>Android 断点 Dart 代码现在会导致 ANR 弹窗死循环</li>
<li>线程合并之后，启动引擎、应用和设置 Dart 代码都运行的平台线程上，会导致第一个可交互帧的时间变长</li>
<li>Win 出现 Failed to post message to main thread 或者渲染卡死问题</li>
<li>一些插件过去没适配同步线程，导致卡顿明显</li>
<li>······</li>
</ul>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7496397558359162934" target="_blank" title="https://juejin.cn/post/7496397558359162934">《Flutter 在全新 Platform 和 UI 线程合并后，出现了什么大坑和变化？》</a></p>
</blockquote>
<p>这个改动带来的效益和目标是好的，也为 FFI 等同步调用场景打下了基础，但是奈何这类 break change 带来的问题，在初期版本可以说是灾难，在当时生产几乎都是选择暂时关闭这个特性。</p>
<h2 data-id="heading-2">mprotect failed: Permission denied</h2>
<p>iOS 可以说是 2026 Flutter 问题的重灾区，特别因为 iOS 26 的到来，给 Flutter 带来了不少全新的适配成本，其中就包括这个 mprotect failed，<strong>现象就是无法在 iOS 真机上 Debug 运行</strong>，因为 Apple 官方禁止了 JIT 支持的“漏洞”。</p>
<p>这个问题其实也很戏剧性：</p>
<ul>
<li>问题一开始出现在 iOS 18.4 beta，但是在 Flutter 还没处理的时候，但 iOS 18 beta2 该“漏洞”又可以正常使用，所以适配放缓</li>
<li>iOS 26 beta1 mprotect 漏洞又重新禁止了，所以 Flutter 又需要对适配加急</li>
</ul>
<p>所以 Flutter 不得不在 iOS 26 ，通过 LLDB 的 <code>debugserver</code> ，然后利用 python 脚本实现适配黑科技：对同一个内存地址，在 Debug 时做到同时 RW 和 RX 支持 ，实际上就是开了两道门。</p>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7542461507402924075" target="_blank" title="https://juejin.cn/post/7542461507402924075">《Flutter 又双叒叕可以在 iOS 26 的真机上 hotload 运行了》</a></p>
</blockquote>
<p>事实上这个支持一直不太好，成功率不高，经常会出现超时等问题，一直等到 iOS 26 发布之后， devicectl + lldb 的支持才完善，Debug 的真机 JIT 运行才回到正轨。</p>
<p>所以这里还有另外一问题，就是<strong>由于苹果对于 <code>ios-deploy</code> 的“废弃”，导致了 iOS 真机 Debug 运行出现 Timed out * to update 的问题</strong> ，具体表现在：</p>
<blockquote>
<p>如果你直接在 Xcode 直接运行这个 Flutter 项目是可以正常运行，但是通过 flutter 命令运行或者 ide run 就不行。</p>
</blockquote>
<p>这个坑相信有不少人踩过，当时临时解决方式包括有：</p>
<ul>
<li>需要安装 Xcode 并且运行时会弹出 Xcode 窗口</li>
<li>用户在 macOS 的<code>“系统设置 &gt; 隐私与安全性 &gt; 自动化”</code>中给予相应的权限</li>
<li>关闭 Wi-Fi，因为有时候即使 iPhone 通过 USB 数据线连接到 Mac，Xcode 也可能优先选择通过 Wi-Fi 进行调试连接</li>
<li>如果还不行，可以尝试 Xcode 直接运行，然后执行 <code>flutter attatch</code> 尝试连接 Dart VM Observatory 服务</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2aa15e6f60f4c4f8f021e4747afc47c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=lXHqRrkv9WekOT1PKnQGeTT%2FeTI%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>搞笑的是，有一段时间，<code>flutter attatch</code> 尝试连接 Dart VM Observatory 服务也 Timeout 了，详细可见：<a href="https://juejin.cn/post/7529752760076009508" target="_blank" title="https://juejin.cn/post/7529752760076009508">《聊聊 Flutter 在 iOS 真机 Debug 运行出现 Timed out *** to update 的问题》</a></p>
</blockquote>
<p>一直到 <a href="https://juejin.cn/post/754246150740292407" target="_blank" title="https://juejin.cn/post/754246150740292407">《Flutter 完成全新 devicectl + lldb 的 Debug JIT 运行支持》</a> 之后，iOS 的开发运行才回归正轨，这时候已经是接近 2025 的 9 月份了。</p>
<h2 data-id="heading-3">iOS 26 模拟器无法运行</h2>
<p>在 3.35 的时候，Flutter 开发者发现，Flutter 在 iOS 26 模拟器上也“随机”出现无法运行的情况，运行时会出现 <code>Unable to find a destination matching the provided destination specifie</code> 这样的提示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb33cc4a9530431f86b18ed7ba37408c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=2dUTkqF4CUHDQL1nqZztQkW2zkE%3D" alt="" loading="lazy"/></p>
<p>当然，这个即是 Flutter 的问题，也不是 Flutter 的问题，但是它是真很坑，因为在一开始，大家都不知道为什么会出现这个问题，而且为什么有的项目会有，有的项目不会，经过很长时间排查才发现，<strong>是一些插件和模拟器之间的适配问题</strong>，实际上问题是：</p>
<blockquote>
<p><strong>用的插件不支持 “ARM 模拟器”，而你默认使用的 iOS 26 模拟器只支持 ARM</strong> 。</p>
</blockquote>
<p>而解决问题的方式也很简单，只需在 Mac 上安装 <strong>Rosetta</strong> ，然后从 Xcode 中移除 <strong>iOS 26</strong> 平台，然后运行以下命令：</p>
<blockquote>
<p><code>xcodebuild -downloadPlatform iOS -architectureVariant universal</code></p>
</blockquote>
<p><strong>重新下载的会是具有通用架构支持的 iOS 26</strong>，而不仅仅是基于 Apple 的 ARM 架构默认配置，所以解决方案是强制 Xcode 下载 iOS 26 模拟器的“通用”版本，而不是默认的“Apple Silicon”，通过 <code>xcodebuild -downloadPlatform iOS -architectureVariant universal</code> 之后，就可以看到通用的 iOS 26 模拟器组件以及 Rosetta 模拟器：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68ecb50f4f5a45f99ad625d402e30265~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=Li2%2Be%2Ba0sX4RmF1Q8utgj0jwTt4%3D" alt="" loading="lazy"/></p>
<p>当然，<strong>Rosetta 只能说是一个临时的解决方式，核心还是要看哪些插件仍然无法运行 ARM</strong> ，但是也是一些 Flutter 插件没适配好，这锅 Flutter 也要背。</p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7560986017034190891" target="_blank" title="https://juejin.cn/post/7560986017034190891">《Flutter 在 iOS 26 模拟器跑不起来？其实很简单》</a></p>
</blockquote>
<h2 data-id="heading-4">iOS 26 WebView</h2>
<p>这也是一个大坑问题，就是 Flutter WebView 在 iOS 26 上有点击问题，原因来自 Flutter 的技术债务，核心原因就是因为一直以来线程合并之前的 <code>MethodChannel</code> 只能异步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fecb7f0d9ee04307971d881e125c9c99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=43xN8H9Daj4Gcvkk2YZ6%2BAbvNqc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>可谓是一环扣一环，毕竟线程同步后的 FFI 还真是解决这个的思路。</p>
</blockquote>
<p>那你要说这个问题有多坑，你看我都可以写三篇文章，就知道这个问题有多蛋疼：</p>
<ul>
<li><a href="https://juejin.cn/post/7571306072423448618" target="_blank" title="https://juejin.cn/post/7571306072423448618">《为什么你的 Flutter WebView 在 iOS 26 上有点击问题？》</a></li>
<li><a href="https://juejin.cn/post/7583577045578907674" target="_blank" title="https://juejin.cn/post/7583577045578907674">《Flutter 官方正式解决 WebView 在 iOS 26 上有点击问题》</a></li>
<li><a href="https://juejin.cn/post/7584443518162141220" target="_blank" title="https://juejin.cn/post/7584443518162141220">《再次紧急修复，Flutter 针对 WebView 无法点击问题增加新的快速修复》</a></li>
</ul>
<p>问题最开始出现在 iOS 18.2 beta 版本上，当页面上先触发了某些 Flutter widget（或者 overlay，比如 context menu / Drawer）后，<strong>WKWebView 内的点击（链接、按钮）不再响应</strong>（可高亮，但不会激活），需要重新加载 WebView 才恢复。</p>
<p>而具体原因在于，Flutter 在 iOS 的 PlatformView（例如承载 WKWebView 的视图）上实现了一套“手势拦截/延迟”机制：在需要时会把一个 <code>FlutterDelayingGestureRecognizer</code>（<code>delayingRecognizer</code> ）切到某些状态（<code>possible</code>, <code>ended</code>, <code>failed</code> 等）来告诉 UIKit 或者其他 recognizers 是否应该阻止/允许手势传递。</p>
<p>又因为，Flutter 和 UIKit 都各自有手势识别系统（GestureRecognizer），为了防止互相抢事件，Flutter engine 在 iOS 上加入了一个“<strong>delaying gesture recognizer</strong>”（延迟识别器）：</p>
<blockquote>
<p>它的作用是：当 Flutter 框架检测到某个 widget 想“阻止”事件时（比如 <code>GestureDetector</code> 或 overlay 遮罩），Flutter 会让这个 <code>delayingRecognizer</code> 阻止 UIKit 里的 recognizer（例如 WKWebView 的点击识别器）响应。</p>
</blockquote>
<p>而问题主要出现在 Flutter → UIKit 手势交界，详细的这里就不展开了，反正就是 Flutter 一开始为了解决这个问题做了一件事：</p>
<blockquote>
<p>在 blockGesture 的处理流程里把 <code>delayingRecognizer</code> <strong>移除后再添加回去</strong>，以强制 UIKit/WebKit 刷新识别器关系，解决了问题：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/252c6d88acca4d5f835b7304c0fd6031~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=ZKr7xbhxHR6o7OmjXDX6TMiV9dM%3D" alt="" loading="lazy"/></p>
</blockquote>
<p>但是这个做法在 iOS 26 上不行了，所以官方有做了两个处理：</p>
<ul>
<li>完整修复方案， 利用 FFI 和全新的 HitTest 实现，从底层正式重构修复问题，但是改动很多，没那么快合并到正式版本</li>
<li>临时解决方案，增加一个方式，通过递归操作，再来一下 NO &amp; YES <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2396c0d2869f41c2a250a4c2fd5ebf13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=%2Fhu32LkUpoe5ZRCaMWoD%2BLtBd%2Fo%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ac355b12d7e4fc38d99ead198051a5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=S9a4hijqLgDFYCEti4Cqs4ulY4Y%3D" alt="" loading="lazy"/></li>
</ul>
<p>针对完整解决方案，除了需要改引擎和框架，第三方插件也需要适配，但是属于是彻底解决问题的思路，而临时方案的好处就是：<strong>可以什么插件都不改就生效</strong>。</p>
<blockquote>
<p>所以，这个问题虽然解决了，但是这个坑还在，就看什么时候 break change 了。</p>
</blockquote>
<h2 data-id="heading-5">binary is invalid</h2>
<p>依然还是 iOS 问题，可以看到 2025 大坑，有一半以上都是 iOS 的，问题在于 3.38.1 之后的版本，在提交 App Store 的时候，有概率发现打包提交 iOS 的包会出现 <code>The binary is invalid</code> 的相关错误，简单来说，就是<strong>App Store 拒绝了某个二进制文件，因为它包含了无效的内容</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f12c3999ba437a9365b5847222c920~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=0XTg6xwPc%2Fy1RrE04luRX7DoV2k%3D" alt="" loading="lazy"/></p>
<p>那么这个内容是怎么来的？大概率是模拟器架构的 Framework 被错误地打包进了正式发布的 App ，具体原因还要提到最新版本增加的 Native Assets 功能。</p>
<p>Native Assets 的目标是<strong>让在 Flutter/Dart 包中集成 C、C++、Rust 或 Go 代码，可以像集成普通 Dart 包一样简单</strong>，也就是它允许 Dart 包定义如何构建和打包原生代码，开发者不需要深入了解每个平台的底层构建系统，也是 Dart FFI 未来的重要基建。</p>
<p>那它怎么导致了这次这个低级问题的出现？实际上这是一个构建脚本逻辑缺陷导致的“脏构建”问题，当 Flutter 构建依赖于 Native Assets（比如 <code>sqlite3</code> 等库）的 Plugin 时，这些原生资源会被编译并输出到 <code>build/native_assets/$platform</code> 目录（例如 <code>build/native_assets/ios</code>）。</p>
<p>因为在现有的构建脚本（<code>xcode_backend.dart</code>）在打包时，会简单粗暴地将 <code>build/native_assets/ios</code> 目录下的<strong>所有</strong>框架复制到最终的 App Bundle (<code>Runner.app/Frameworks</code>) ，例如：</p>
<ul>
<li>先运行了模拟器跑应用，这时模拟器专用的框架（如 <code>sqlite3arm64ios_sim.framework</code>）就会被生成并留在了 <code>build/native_assets/ios</code> 目录</li>
<li>接着，开发者在<strong>没有运行 <code>flutter clean</code></strong> 的情况下，直接运行了 Release 构建</li>
<li>构建脚本会把之前遗留的“模拟器框架”也一并复制进了 Release 包</li>
<li>App Store 检测到 Release 包中含有模拟器架构的代码，因此拒绝接收</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ef426a8657b4367beab6976a1354461~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=HZHJx9E2sPgCQA6pyLjiKNTyalY%3D" alt="" loading="lazy"/></p>
<p>而且，其实这个问题是存在两个 Bug ，目前 Fix 的 PR 也都已经合并，开发者处理思路有：</p>
<ul>
<li>
<p>存在 native assets 的</p>
<ul>
<li>使用 main - <code>flutter channel main</code></li>
<li>archiving 之前，使用 <code>flutter clean</code> 和 <code>flutter build ios --config-only</code></li>
</ul>
</li>
<li>
<p>没有使用 native assets 的:</p>
<ul>
<li>使用最新 <code>flutter channel main</code></li>
<li>使用稳定版 <code>flutter channel stable</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>因为第二个 bug 是某个 beta 版本弄出来的。</p>
</blockquote>
<p>所以，这也是一个草台版本的 bug ，但是带来的影响还是很坑的，毕竟提交的时候才发现版本不行，而且找起来也很麻烦，虽然解决很容易，但是恶心层度贼高。</p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7591350620189360134" target="_blank" title="https://juejin.cn/post/7591350620189360134">《Flutter 3.38.1 之后，因为某些框架低级错误导致提交 Store 被拒》</a></p>
</blockquote>
<h2 data-id="heading-6">iOS 键盘问题</h2>
<p>又是 iOS ，这次还是 iOS 26 问题，Flutter 在 iOS 26 上，某些场景会因为出现半透明键盘，而页面底下本来应该被键盘遮挡的 Widget，由于默认没有被绘制，从而出现键盘背景颜色 UI 异常：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/498c49cdcf114c27b07156f662a37723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=e0qEle3TEkqMOekx9g2nHerfvBs%3D" alt="" loading="lazy"/></p>
<p>虽然问题看起来是一个圆角问题，但是实际上这是 <strong>iOS 26 系统键盘增加了“半透明”后带来的问题，Flutter 在键盘后面那一层在某些场景下没有正确渲染内容</strong>，导致键盘半透明区域透出来的不是底下 BottomSheet 的真实内容，而是一整块黑色区域。</p>
<blockquote>
<p>issue 提到问题，问题最明显的场景主要出现在 iOS 26 的 <code>showModalBottomSheet()</code> 下。</p>
</blockquote>
<p>虽然问题看起来是一个圆角问题，但是实际上这是 <strong>iOS 26 系统键盘增加了“半透明”后带来的问题，Flutter 在键盘后面那一层在某些场景下没有正确渲染内容</strong>，导致键盘半透明区域透出来的不是底下 BottomSheet 的真实内容，而是一整块黑色区域。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c382b66b3e324ca680c30e974b85394a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=qRmiAi64qS16SCk4AF1XmlqJiRo%3D" alt="" loading="lazy"/></p>
<p>当然，<strong>正常大家使用输入框输入文本内容不会有什么问题</strong>，甚至如果你用 Dialog 场景也不会有什么问题，它主要出现在默认有底色场景的类似 <code>BottomSheet</code> 这种场景，所<strong>针对问题其实可以选择配置 <code>UIDesignRequiresCompatibility = YES</code> 来解决，或者替换为 Dialog 来绕过场景</strong>，但是如果要等官方修复这个场景，可能会需要等待评估是否真的有必要大规模底层改动。</p>
<p>这个问题就在于，官方是真的在考虑是否大规模修改底层来解决问题，毕竟按照之前的尿性，如果真的为了这个大规模修改底层，那么 issue 生 issue ，解一送十也不是不可能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e66f506501bf48b291a9c1af36a3ca64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=Efk7F5gijaPv2nKkRbsqhv66H3k%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7596245612558319625" target="_blank" title="https://juejin.cn/post/7596245612558319625">《Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动》</a></p>
</blockquote>
<h2 data-id="heading-7">最后</h2>
<p>看了 2025 的年度大坑回顾，不知道有没有你踩过的共鸣？但是这只是一些比较典型或者恶心的，其他琐碎小问题其实也不少，但是好在 Flutter 也有在积极解决这些大坑，不过可以看出来 iOS 26 确实带来了不少问题，很多问题也不是 Flutter 特有的，RN 和 KMP 也不可避免，<strong>只能说平台升级带来的坑是真不少</strong>，不然你看，谷歌看 Android 16 没带来什么大问题，所以给大家准备了 AGP 9 整整 KPI ，多贴心：</p>
<blockquote>
<p><a href="https://juejin.cn/post/7597900782910685203" target="_blank" title="https://juejin.cn/post/7597900782910685203">Android Gradle Plugin 9.0 发布，为什么这会是个史诗级大坑版本</a></p>
</blockquote>
<p>那么，2025 你遇到过什么坑呢？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windows 代理配置与删除完整指南（环境变量方式）]]></title>    <link>https://juejin.cn/post/7599017594520043546</link>    <guid>https://juejin.cn/post/7599017594520043546</guid>    <pubDate>2026-01-26T01:25:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599017594520043546" data-draft-id="7599094262592405514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windows 代理配置与删除完整指南（环境变量方式）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T01:25:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windows 代理配置与删除完整指南（环境变量方式）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:25:10.000Z" title="Mon Jan 26 2026 01:25:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Windows 开发环境中，很多工具（如 <strong>Git、Scoop、npm、pip、curl、Docker CLI</strong> 等）都会自动读取系统环境变量中的代理配置。<br/>
相比只在浏览器里设置代理，<strong>环境变量代理</strong>是一种更通用、更稳定的方式。</p>
<p>本文将系统介绍：</p>
<ul>
<li>✅ 如何在 Windows 中设置 HTTP / HTTPS 代理</li>
<li>✅ 如何验证代理是否生效</li>
<li>✅ 如何删除 / 取消代理</li>
<li>⚠️ 常见坑与注意事项</li>
</ul>
<h2 data-id="heading-0">一、什么是 Windows 环境变量代理？</h2>
<p>Windows 支持通过环境变量向程序传递代理信息，最常见的是：</p>
<pre><code class="hljs">HTTP_PROXY
HTTPS_PROXY
</code></pre>
<p>当这些变量存在时，大多数命令行工具会自动使用代理访问网络。</p>
<blockquote>
<p>📌 这是一种 <strong>系统级 / 用户级配置</strong>，不是浏览器专用。</p>
</blockquote>
<h2 data-id="heading-1">二、通过 PowerShell 设置代理（推荐）</h2>
<h3 data-id="heading-2">1️⃣ 设置用户级代理（最常用）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Environment]</span>::<span class="hljs-built_in">SetEnvironmentVariable</span>(
  <span class="hljs-string">"HTTP_PROXY"</span>,
  <span class="hljs-string">"http://127.0.0.1:1080"</span>,
  <span class="hljs-string">"User"</span>
)

[Environment]::<span class="hljs-built_in">SetEnvironmentVariable</span>(
  <span class="hljs-string">"HTTPS_PROXY"</span>,
  <span class="hljs-string">"http://127.0.0.1:1080"</span>,
  <span class="hljs-string">"User"</span>
)
</code></pre>
<p>说明：</p>
<ul>
<li><code>127.0.0.1:1080</code>：本地代理地址（如 Clash / V2Ray / Shadowsocks）</li>
<li><code>"User"</code>：只对当前用户生效（推荐）</li>
<li>不需要管理员权限</li>
</ul>
<p>⚠️ <strong>注意</strong>：<br/>
设置完成后，<strong>必须重新打开 PowerShell / CMD</strong> 才会生效。</p>
<h3 data-id="heading-3">2️⃣ 系统级代理（不推荐，需管理员）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Environment]</span>::<span class="hljs-built_in">SetEnvironmentVariable</span>(<span class="hljs-string">"HTTP_PROXY"</span>, <span class="hljs-string">"http://127.0.0.1:1080"</span>, <span class="hljs-string">"Machine"</span>)
[Environment]::<span class="hljs-built_in">SetEnvironmentVariable</span>(<span class="hljs-string">"HTTPS_PROXY"</span>, <span class="hljs-string">"http://127.0.0.1:1080"</span>, <span class="hljs-string">"Machine"</span>)
</code></pre>
<blockquote>
<p>适合服务器或多人共用机器，一般个人开发环境不建议。</p>
</blockquote>
<h2 data-id="heading-4">三、如何查看代理是否已配置</h2>
<h3 data-id="heading-5">方法一：PowerShell 查看（最快）</h3>
<p>新开一个 PowerShell 窗口，执行：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable">$env</span><span class="hljs-symbol">:HTTP_PROXY</span>
<span class="hljs-variable">$env</span><span class="hljs-symbol">:HTTPS_PROXY</span>
</code></pre>
<p>如果输出：</p>
<pre><code class="hljs language-arduino" lang="arduino">http:<span class="hljs-comment">//127.0.0.1:1080</span>
</code></pre>
<p>说明代理已生效 ✅</p>
<h3 data-id="heading-6">方法二：系统图形界面查看（最直观）</h3>
<ol>
<li><strong>Win + R</strong> → 输入：<code>sysdm.cpl</code></li>
<li>打开 <strong>高级</strong> → <strong>环境变量</strong></li>
<li>查看 <strong>“用户变量”</strong></li>
</ol>
<p>你会看到：</p>
<p>变量名</p>
<p>值</p>
<p>HTTP_PROXY</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A1080%2F" target="_blank" title="http://127.0.0.1:1080/" ref="nofollow noopener noreferrer">http://127.0.0.1:1080</a></p>
<p>HTTPS_PROXY</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A1080%2F" target="_blank" title="http://127.0.0.1:1080/" ref="nofollow noopener noreferrer">http://127.0.0.1:1080</a></p>
<h3 data-id="heading-7">方法三：注册表验证（底层确认）</h3>
<pre><code class="hljs language-erlang" lang="erlang">reg <span class="hljs-keyword">query</span> HKCU\Environment
</code></pre>
<p>如果存在：</p>
<pre><code class="hljs language-arduino" lang="arduino">HTTP_PROXY    REG_SZ    http:<span class="hljs-comment">//127.0.0.1:1080</span>
HTTPS_PROXY   REG_SZ    http:<span class="hljs-comment">//127.0.0.1:1080</span>
</code></pre>
<p>说明已<strong>持久化写入系统</strong>。</p>
<h2 data-id="heading-8">四、验证代理是否真的在“工作”</h2>
<h3 data-id="heading-9">1️⃣ 验证 Git 是否走代理</h3>
<pre><code class="hljs language-arduino" lang="arduino">git ls-remote https:<span class="hljs-comment">//github.com/ScoopInstaller/Extras.git</span>
</code></pre>
<p>如果不再出现：</p>
<ul>
<li><code>early EOF</code></li>
<li><code>curl 18</code></li>
<li><code>invalid index-pack output</code></li>
</ul>
<p>说明代理生效 👍</p>
<h3 data-id="heading-10">2️⃣ 验证 curl</h3>
<pre><code class="hljs language-arduino" lang="arduino">curl https:<span class="hljs-comment">//github.com</span>
</code></pre>
<h2 data-id="heading-11">五、如何删除 / 取消代理（非常重要）</h2>
<h3 data-id="heading-12">1️⃣ 用 PowerShell 删除（推荐）</h3>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">"HTTP_PROXY"</span>, $<span class="hljs-literal">null</span>, <span class="hljs-string">"User"</span>)
[<span class="hljs-meta">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">"HTTPS_PROXY"</span>, $<span class="hljs-literal">null</span>, <span class="hljs-string">"User"</span>)
</code></pre>
<p>然后：</p>
<ul>
<li>关闭 PowerShell</li>
<li>重新打开</li>
</ul>
<h3 data-id="heading-13">2️⃣ 图形界面删除</h3>
<ol>
<li><code>sysdm.cpl</code></li>
<li>高级 → 环境变量</li>
<li>在 <strong>用户变量</strong> 中删除：
<ul>
<li>HTTP_PROXY</li>
<li>HTTPS_PROXY</li>
</ul>
</li>
</ol>
<h3 data-id="heading-14">3️⃣ 验证是否已删除</h3>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable">$env</span><span class="hljs-symbol">:HTTP_PROXY</span>
<span class="hljs-variable">$env</span><span class="hljs-symbol">:HTTPS_PROXY</span>
</code></pre>
<p>如果无输出，说明已清除。</p>
<h2 data-id="heading-15">六、常见坑与注意事项（很重要）</h2>
<h3 data-id="heading-16">⚠️ 1. 当前窗口看不到新变量</h3>
<blockquote>
<p><code>SetEnvironmentVariable</code> <strong>不会影响当前 PowerShell 会话</strong></p>
</blockquote>
<p>必须：</p>
<ul>
<li>新开窗口</li>
<li>或重新登录用户</li>
</ul>
<h3 data-id="heading-17">⚠️ 2. Conda / Anaconda 干扰</h3>
<p>在 <code>(base)</code> 环境中，Conda 可能会：</p>
<ul>
<li>覆盖代理变量</li>
<li>使用自己的 OpenSSL / curl</li>
</ul>
<p>👉 如果代理不生效，建议：</p>
<pre><code class="hljs">conda deactivate
</code></pre>
<p>再测试。</p>
<h3 data-id="heading-18">⚠️ 3. 不等于 Windows「系统代理」</h3>
<p>环境变量代理 ≠ Windows 设置里的：</p>
<blockquote>
<p>设置 → 网络 → 代理</p>
</blockquote>
<p>两者<strong>互不影响</strong>。</p>
<h3 data-id="heading-19">⚠️ 4. 不要长期忘记开代理</h3>
<p>长期保留代理可能导致：</p>
<ul>
<li>内网地址访问失败</li>
<li>公司 VPN 冲突</li>
<li>本地服务异常</li>
</ul>
<p>👉 不用时记得删除。</p>
<h2 data-id="heading-20">七、适合哪些场景使用？</h2>
<p>✅ 适合：</p>
<ul>
<li>GitHub 访问不稳定</li>
<li>Scoop / npm / pip 下载失败</li>
<li>命令行工具走代理</li>
</ul>
<p>❌ 不适合：</p>
<ul>
<li>只想给浏览器加速</li>
<li>不希望命令行走代理</li>
</ul>
<h2 data-id="heading-21">八、总结一句话</h2>
<blockquote>
<p><strong>Windows 环境变量代理，是开发环境里最通用、最稳定的代理方式之一。</strong><br/>
会配、会查、会删，才能用得安心。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大促备战中的隐蔽陷阱：Double转String会使用科学计数法展示？]]></title>    <link>https://juejin.cn/post/7599247962822574107</link>    <guid>https://juejin.cn/post/7599247962822574107</guid>    <pubDate>2026-01-26T06:39:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599247962822574107" data-draft-id="7599268297223061514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大促备战中的隐蔽陷阱：Double转String会使用科学计数法展示？"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-01-26T06:39:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大促备战中的隐蔽陷阱：Double转String会使用科学计数法展示？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T06:39:27.000Z" title="Mon Jan 26 2026 06:39:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：齐海智</p>
<h2 data-id="heading-0"><strong>一、背景：大促备战中的异常数据</strong></h2>
<p>大促备战期间，接到客户反馈我司上传到客户服务器上的文件存在科学计数法表示的情况（下图的4.55058496E7），与约定不符。</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eab231574aec402c906845d62b7174ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=A0A6ZmXUQQ6Zp1bcxoYmUFj4Qj4%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>查看转换前的数据是：455058496，转换后（除以10：进行毫米到厘米的转换）就变成了科学计数法形式了。</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6404f1d853a4f81a7296f529c5b91fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=%2FE5ugSZlFkms1NWOc%2FgWfhyFh9o%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>问题代码：</p>
<pre><code class="hljs language-bash" lang="bash">&lt;<span class="hljs-built_in">set</span> var=<span class="hljs-string">"temp.b"</span> <span class="hljs-built_in">expr</span>=<span class="hljs-string">"<span class="hljs-variable">${_item.boxLength / 10}</span>"</span> clazz=<span class="hljs-string">"java.lang.String"</span>/&gt;
</code></pre>
<p>说明：</p>
<p>这个是个EL表达式，含义是使用<strong>expr</strong>的值作为计算逻辑，计算结果赋值给var指向的变量temp.b，类型是java.lang.String。</p>
<p>•<code>_item</code>代表当前上下文里的一个对象。</p>
<p>•<code>boxLength</code>是<code>_item</code>对象所具备的属性。</p>
<p>•该表达式先对<code>boxLength</code>执行除以 10 的运算，再把运算结果转换为字符串（由clazz定义的）。</p>
<p>业务上，boxLength是个长度的概念，单位是毫米，除以10是转换成厘米的含义。为了保证精度，系统（基于JAVA）会先将boxLength先转成java.lang.Double类型，再除以10，最后调用Double.toString()方法转成字符串。</p>
<h2 data-id="heading-1"><strong>二、问题定位：字符串转换的科学计数法陷阱</strong></h2>
<h3 data-id="heading-2">2.1 问题复现</h3>
<p>代码：</p>
<pre><code class="hljs language-ini" lang="ini">Double <span class="hljs-attr">depthInDouble</span> = <span class="hljs-number">455058496</span>d/<span class="hljs-number">10</span><span class="hljs-comment">;</span>
log.info("<span class="hljs-attr">depthInDouble</span>={}<span class="hljs-string">", depthInDouble);
</span></code></pre>
<p>结果：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fe13ce03c3c4f7ba6e411787b1577f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=Nd7P0NmXll9%2Fa4q1L7lfMbKpsIA%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<h3 data-id="heading-3">2.2 原因分析</h3>
<p>问题就出在了最后一行，日志输出的时候Double会被转成String，调用Double.toString（）方法，而对于Double对象的值在一定的范围内，会使用科学计数法表示。</p>
<p>log.info的调用链（为什么会调用到Double.toStirng()）：</p>
<pre><code class="hljs language-scss" lang="scss">log<span class="hljs-selector-class">.info</span>("depthInDouble={}", depthInDouble);
  ↓
Log4jLogger<span class="hljs-selector-class">.info</span>(String format, Object arg)
  ↓
AbstractLogger<span class="hljs-selector-class">.logIfEnabled</span>(...)
  ↓
AbstractLogger<span class="hljs-selector-class">.logMessage</span>(...)
  ↓
ParameterizedMessageFactory<span class="hljs-selector-class">.newMessage</span>(...)
  ↓
ParameterizedMessage 构造函数（参数被暂存为 <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span>）
  ↓
<span class="hljs-comment">// 此时尚未调用 Double.toString()</span>
  ↓
<span class="hljs-comment">// 当 Appender 执行输出时...</span>
Appender<span class="hljs-selector-class">.append</span>(LogEvent)
  ↓
LogEvent<span class="hljs-selector-class">.getMessage</span>()<span class="hljs-selector-class">.getFormattedMessage</span>() <span class="hljs-comment">// 触发消息格式化</span>
  ↓
ParameterizedMessage<span class="hljs-selector-class">.getFormattedMessage</span>()
  ↓
ParameterizedMessage<span class="hljs-selector-class">.formatMessage</span>(...)
  ↓
ParameterizedMessage<span class="hljs-selector-class">.argToString</span>(Object)
  ↓
Double<span class="hljs-selector-class">.toString</span>() <span class="hljs-comment">// 终于在这里被调用！</span>
</code></pre>
<p>查看Double.toString（）的源码，可以看到相关解释：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/839c50e593234abd9ab9e86dc9f49927~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=mzw%2B0f8H%2BIv8u%2BODb0j8yvN3%2FuQ%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>也就是说对于极小（小于10^-3）或者极大（大于10^7）值的浮点数，转成String的时候会使用科学计数法表示</strong>，验证如下。</p>
<p>代码：</p>
<pre><code class="hljs language-c" lang="c">public <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span> {
       String depth = <span class="hljs-string">"455058496"</span>; <span class="hljs-comment">// 单位：毫米</span>
       Double depthInDouble = Double.parseDouble(depth)/<span class="hljs-number">10</span>;
       String doubleInString = String.valueOf(depthInDouble);
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"depthInDouble={}"</span>, depthInDouble);
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"doubleInString={}"</span>, doubleInString);
       depthInDouble = <span class="hljs-number">1e-3</span>;
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"10^-3 = {}"</span>, depthInDouble);
       depthInDouble = <span class="hljs-number">1e7</span>;
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"10^7 = {}"</span>, depthInDouble);
       Double aVerySmallNumber = <span class="hljs-number">1e-9</span>;
       depthInDouble = <span class="hljs-number">1e-3</span> - aVerySmallNumber;
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"10^-3 - delta = {}"</span>, depthInDouble);
       depthInDouble = <span class="hljs-number">1e7</span> - aVerySmallNumber;
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"10^7 - delta = {}"</span>, depthInDouble);
   }
</code></pre>
<p>运行结果：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a45afad0dc9436ba9b050c72336cc73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=v6N6hxBBtKTzN9utY1Ctq4SUWq8%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>说明，10^-3不会使用科学记计数法，但是小于它就会使用科学计数法，10^7就会使用科学计数法，小于它就会不会，大于它会。</p>
<h3 data-id="heading-4">2.3 为什么要使用科学计数法</h3>
<h4 data-id="heading-5">2.3.1 小数在计算机内是如何表示的</h4>
<p>先不急于讨论为什么使用科学计数法，我们先看看小数在计算机内是如何表示的。</p>
<p>从存储角度来看，计算机的存储是有限资源，能存储的数据是有范围的，不是无限大，也就是说<strong>有限的硬件资源限制了计算机可以表示的数值的大小</strong>。对于一个浮点数，我们可以用10个bit存储，也可以用100个，为了实现跨设备、跨平台的数据统一表示和交换，IEEE 754 规范定义了标准格式，规定了Double类型使用64比特。</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e2c3a9f742f4ec398572b6277dbbb7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=O6IbAqkbWj9dr2tF53KFuAridWY%3D" alt="" loading="lazy"/></p>
<p>﻿</p>
<p>当64个比特确定了，那么它可以表示的数字的范围就确定了，接下来考虑怎么表示小数，可以表示什么范围内的小数，进而再讨论威慑么定义超过10^7或者小于10^-3使用科学计数法，而不用普通的方式（定点数表示法）。</p>
<p>类似整数可以利用除以2取余获得其二级制的表示形式，例如：123（10进制）= 1111011（二进制）</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe23800f3d64ea692b40c2755ab082d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=zZ3RZRDAnRm8ZFJl4iwtwqs4x9s%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>小数则进行乘2取整，如0.123（10进制）= 0. 0001111101（二进制，位数会一直循环无法精确表示，只能近似，这里取了10位）</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18b4da8de6f247e995b7b6c023fd86ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=ARjtVbS8veAaWUUkiB%2FubpclWHE%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>因此最简单的一种设计（不考虑正负）就是将64位中的一部分划分为整数位，一部分划分为小数位，比如32位整数，32位小数（定点数表示法）。</p>
<p>那么这样设计的Double最大数可以表示2^32-1，</p>
<p>如果要以米为单位表示银河系直径，约1光年<strong>≈</strong>299792458米/秒<em>1年 = 299792458米/秒</em>365天*86400秒/天 ≈ 9.45 * 10^15 ，而2^32-1≈4.29 * 10^9 （远小于1光年），因此无法使用Double表示银河系直径，无法支撑天文学科的计算了。</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/055afc86c832432399a4efc74b74e795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=EpR8CxoPUlSZ8yDsHOMRzSm5zqA%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>这样设计的Double最小可以表示2^-32=2.38<em>10^-10 ，一个质子的大小是0.84飞米=8.4</em>10^-16，因此也无法支持物理学的计算。</p>
<p>所以，矛盾在于增加整数部分的位数，就会压缩小数部分的位数，不同的领域中，既有要求数字很大可表示的（在乎量级，如天文学、金融学），也有要求数值很小能表示的（在乎精度，如物理学、生物学）。</p>
<p>可以看到，上面的很多数字表达，我们也使用了科学计数法的表示形式来简化表达，对于上面这个数字（9.454,254,955,488,000）写起来麻烦还很占地方，而且我们也不需要那么精确，只是看个量级，因此会写成9.45 * 10^15 ，不影响理解。</p>
<p>即表示一个极大或者极小的数可以使用：【数值<em>底数^指数】的形式，对于大数来讲指数就是正的，小数就是负的，计算机使用二进制，因此底数就是2，所以小数可以表示成：【数值</em>2^指数】的形式，这个数值，其实就是尾数。</p>
<p>计算机专家们经过多种研究，最终经过IEEE确定了IEEE 754标准，即不确定整数和小数的位数（固定小数点，即定点数），而使用变化的位数，也就是小数点可以浮动，即浮点数表示法。浮点数表示法定义了小数由符号位+指数位+尾数位三部分组成。</p>
<p>符号位是1bit，0代表整数，1代表负数，指数位决定数值的量级，尾数位决定数值精度。</p>
<p>64位的说明如下：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1b4f3dae56348a5ad7e55231d8c9907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=urS3c8ZmKfpBUqbaAHSAcV9ylhs%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>其中11和52的设计是在平衡了很多需求后得到的最佳实践。</p>
<pre><code class="hljs language-scss" lang="scss">Double (<span class="hljs-number">64</span>位) = 符号位(<span class="hljs-number">1</span>位) + 指数位(<span class="hljs-number">11</span>位) + 尾数位(<span class="hljs-number">52</span>位)

示例：<span class="hljs-number">455058496.0</span> 的IEEE <span class="hljs-number">754</span>表示
原始值：<span class="hljs-number">455058496.0</span>
二进制科学计数法：<span class="hljs-number">1.0101100001110000000000000000000</span> × <span class="hljs-number">2</span>^<span class="hljs-number">28</span>

符号位：<span class="hljs-number">0</span> (正数)
指数位：<span class="hljs-number">28</span> + <span class="hljs-number">1023</span>(偏移量) = <span class="hljs-number">1051</span> = <span class="hljs-number">10000011011</span>₂
尾数位：<span class="hljs-number">0101100001110000000000000000000</span>... (<span class="hljs-number">52</span>位)

完整<span class="hljs-number">64</span>位表示：
<span class="hljs-number">0</span> <span class="hljs-number">10000011011</span> <span class="hljs-number">0101100001110000000000000000000000000000000000000000</span>
</code></pre>
<h4 data-id="heading-6">2.3.2 数值超过10^7或者小于10^-3会发生什么</h4>
<p>其实什么也不会发生，只是基于如下原因综合权衡的结果。</p>
<h5 data-id="heading-7">1、认知科学依据</h5>
<p>•人类短期记忆的数字处理能力约为7±2位</p>
<p>•超过7位的整数部分难以快速理解</p>
<p>•科学计数法提供更好的可读性</p>
<h5 data-id="heading-8">2、精度保持考虑</h5>
<p>•10^7 = 10,000,000 (8位数字)</p>
<p>•超过此值，普通格式会显得冗长</p>
<p>•10^-3 = 0.001，更小的数用科学计数法更清晰</p>
<h5 data-id="heading-9">3、历史兼容性</h5>
<p>•这个标准在多种编程语言中被采用</p>
<p>•保持了与C语言printf的兼容性</p>
<p>•符合IEEE 754标准的建议</p>
<p>这也就是为什么这个这个范围内的数要表示成科学计数法了。</p>
<h4 data-id="heading-10">2.3.3 源码探究</h4>
<h5 data-id="heading-11">1、调用链路</h5>
<p>根据源码，可以看到Double.toString()方法的调用链是：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bd1fab3d2914726aaa9bcdce3d72e79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=2ph3CZbtwY6ACheYYm5QAiuNTgM%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>分流是否使用科学计数法的核心代码toChars的代码如下：</p>
<pre><code class="hljs language-ini" lang="ini">/*
 * Formats the decimal f 10^e.
 */
private int toChars(byte<span class="hljs-section">[]</span> str, int index, long f, int e, FormattedFPDecimal fd) {
    /*
     * For details not discussed here see section 10 of <span class="hljs-section">[1]</span>.
     *
     * Determine len such that
     *     10^(len-1) &lt;= f &lt; 10^len
     */
    int <span class="hljs-attr">len</span> = flog10pow2(Long.SIZE - numberOfLeadingZeros(f))<span class="hljs-comment">;</span>
    if (f &gt;= pow10(len)) {
        len += 1<span class="hljs-comment">;</span>
    }
    if (fd != null) {
        fd.set(f, e, len)<span class="hljs-comment">;</span>
        return index<span class="hljs-comment">;</span>
    }

    /*
     * Let fp and ep be the original f and e, respectively.
     * Transform f and e to ensure
     *     10^(H-1) &lt;= f &lt; 10^H
     *     fp 10^<span class="hljs-attr">ep</span> = f <span class="hljs-number">10</span>^(e-H) = <span class="hljs-number">0</span>.f <span class="hljs-number">10</span>^e
     */
    f *= pow10(H - len)<span class="hljs-comment">;</span>
    e += len<span class="hljs-comment">;</span>

    /*
     * The toChars?() methods perform left-to-right digits extraction
     * using ints, provided that the arguments are limited to 8 digits.
     * Therefore, split the <span class="hljs-attr">H</span> = <span class="hljs-number">17</span> digits of f into:
     *     <span class="hljs-attr">h</span> = the most significant digit of f
     *     <span class="hljs-attr">m</span> = the next <span class="hljs-number">8</span> most significant digits of f
     *     <span class="hljs-attr">l</span> = the last <span class="hljs-number">8</span>, least significant digits of f
     *
     * For <span class="hljs-attr">n</span> = <span class="hljs-number">17</span>, m = <span class="hljs-number">8</span> the table in section <span class="hljs-number">10</span> of [<span class="hljs-number">1</span>] shows
     *     floor(f / 10^8) = floor(193_428_131_138_340_668 f / 2^84) =
     *     floor(floor(193_428_131_138_340_668 f / 2^64) / 2^20)
     * and for <span class="hljs-attr">n</span> = <span class="hljs-number">9</span>, m = <span class="hljs-number">8</span>
     *     floor(hm / 10^8) = floor(1_441_151_881 hm / 2^57)
     */
    long <span class="hljs-attr">hm</span> = multiplyHigh(f, <span class="hljs-number">193_428_131_138_340_668</span>L) &gt;&gt;&gt; <span class="hljs-number">20</span><span class="hljs-comment">;</span>
    int <span class="hljs-attr">l</span> = (int) (f - <span class="hljs-number">100_000_000</span>L * hm)<span class="hljs-comment">;</span>
    int <span class="hljs-attr">h</span> = (int) (hm * <span class="hljs-number">1_441_151_881</span>L &gt;&gt;&gt; <span class="hljs-number">57</span>)<span class="hljs-comment">;</span>
    int <span class="hljs-attr">m</span> = (int) (hm - <span class="hljs-number">100_000_000</span> * h)<span class="hljs-comment">;</span>

    if (0 &lt; e &amp;&amp; e &lt;= 7) {
        return toChars1(str, index, h, m, l, e)<span class="hljs-comment">;</span>
    }
    if (-3 &lt; e &amp;&amp; e &lt;= 0) {
        return toChars2(str, index, h, m, l, e)<span class="hljs-comment">;</span>
    }
    return toChars3(str, index, h, m, l, e)<span class="hljs-comment">;</span>
}
</code></pre>
<p>代码地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenjdk%2Fjdk%2Fblob%2Fmaster%2Fsrc%2Fjava.base%2Fshare%2Fclasses%2Fjdk%2Finternal%2Fmath%2FDoubleToDecimal.java" target="_blank" title="https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/jdk/internal/math/DoubleToDecimal.java" ref="nofollow noopener noreferrer">github.com/openjdk/jdk…</a></p>
<p>可以看到使用科学计数法处理的核心代码是toChars3，代码如下：</p>
<pre><code class="hljs language-perl" lang="perl">private <span class="hljs-keyword">int</span> toChars3(byte[] str, <span class="hljs-keyword">int</span> <span class="hljs-keyword">index</span>, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> e) {
    <span class="hljs-regexp">/* -3 &gt;= e | e &gt; 7: computerized scientific notation */</span>
    <span class="hljs-keyword">index</span> = putDigit(str, <span class="hljs-keyword">index</span>, h);
    <span class="hljs-keyword">index</span> = putChar(str, <span class="hljs-keyword">index</span>, <span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">index</span> = put8Digits(str, <span class="hljs-keyword">index</span>, m);
    <span class="hljs-keyword">index</span> = lowDigits(str, <span class="hljs-keyword">index</span>, l);
    <span class="hljs-keyword">return</span> exponent(str, <span class="hljs-keyword">index</span>, e - <span class="hljs-number">1</span>);
}
</code></pre>
<h5 data-id="heading-12">2、toChars3()的参数含义</h5>
<p>•<code>byte[] str</code>: 输出字符串的字节数组</p>
<p>•<code>int index</code>: 当前写入位置的索引</p>
<p>•<code>int h</code>: 最高位数字 (0-9)</p>
<p>•<code>int m</code>: 中间8位数字 (00000000-99999999)</p>
<p>•<code>int l</code>: 低位数字 (用于精度控制)</p>
<p>•<code>int e</code>: 调整后的十进制指数值</p>
<h5 data-id="heading-13">3、 toChars3()的数据流处理步骤</h5>
<p>1.<code>putDigit(str, index, h) </code>→ 写入最高位数字</p>
<p>2.<code>putChar(str, index, '.') </code>→ 写入小数点</p>
<p>3.<code>put8Digits(str, index, m) </code>→ 写入中间8位数字</p>
<p>4.<code>lowDigits(str, index, l) </code>→ 写入低位数字（去除尾随零）</p>
<p>5.<code>exponent(str, index, e-1) </code>→ 写入指数部分</p>
<p>为什么使用 e-1？</p>
<pre><code class="hljs">原因：已经放置了一位数字在小数点前
目的：调整指数以保持数值不变
示例：4.55058496E7 表示 4.55058496 × 10^7
</code></pre>
<h5 data-id="heading-14">4、exponent()分析</h5>
<pre><code class="hljs language-css" lang="css">标准科学计数法：<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.bcd</span> × <span class="hljs-number">10</span>^n
约束条件：<span class="hljs-number">1</span> ≤ <span class="hljs-selector-tag">a</span> &lt; <span class="hljs-number">10</span>（小数点前只有一位非零数字）
</code></pre>

<pre><code class="hljs language-perl" lang="perl">private <span class="hljs-keyword">int</span> exponent(byte[] str, <span class="hljs-keyword">int</span> <span class="hljs-keyword">index</span>, <span class="hljs-keyword">int</span> <span class="hljs-keyword">exp</span>) {
    str[<span class="hljs-keyword">index</span>++] = (byte) <span class="hljs-string">'E'</span>;  <span class="hljs-regexp">//</span> 写入字符 <span class="hljs-string">'E'</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">exp</span> &lt; <span class="hljs-number">0</span>) {
        str[<span class="hljs-keyword">index</span>++] = (byte) <span class="hljs-string">'-'</span>;  <span class="hljs-regexp">//</span> 负指数写入 <span class="hljs-string">'-'</span>
        <span class="hljs-keyword">exp</span> = -<span class="hljs-keyword">exp</span>;  <span class="hljs-regexp">//</span> 转为正数处理
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">exp</span> &gt;= <span class="hljs-number">100</span>) {
        str[<span class="hljs-keyword">index</span>++] = (byte) (<span class="hljs-string">'0'</span> + <span class="hljs-keyword">exp</span> / <span class="hljs-number">100</span>);  <span class="hljs-regexp">//</span> 百位
        <span class="hljs-keyword">exp</span> %= <span class="hljs-number">100</span>;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">exp</span> &gt;= <span class="hljs-number">10</span>) {
        str[<span class="hljs-keyword">index</span>++] = (byte) (<span class="hljs-string">'0'</span> + <span class="hljs-keyword">exp</span> / <span class="hljs-number">10</span>);   <span class="hljs-regexp">//</span> 十位
        <span class="hljs-keyword">exp</span> %= <span class="hljs-number">10</span>;
    }
    str[<span class="hljs-keyword">index</span>++] = (byte) (<span class="hljs-string">'0'</span> + <span class="hljs-keyword">exp</span>);           <span class="hljs-regexp">//</span> 个位
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">index</span>;
}
</code></pre>
<p>•<strong>输入参数</strong>: <code>byte[] str</code>（输出缓冲区）、<code>int index</code>（写入位置）、<code>int exp</code>（指数值）</p>
<p>•<strong>核心功能</strong>: 将指数值格式化为字符串并写入字节数组</p>
<p>•<strong>处理逻辑</strong>: 优化处理1位、2位、3位数的指数</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 写入 'E'
<span class="hljs-bullet">2.</span> 处理负号（如果 exp &lt; 0）
<span class="hljs-bullet">3.</span> 处理百位（如果 exp &gt;= 100）
<span class="hljs-bullet">4.</span> 处理十位（如果 exp &gt;= 10）
<span class="hljs-bullet">5.</span> 处理个位（必须）
</code></pre>
<p>•<strong>返回值</strong>: 更新后的索引位置</p>
<p>例子：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 原始数值: 45505849.6
<span class="hljs-bullet">2.</span> 精确指数: 7.658067227112319
<span class="hljs-bullet">3.</span> 调整后指数: 7.658 - 1 = 6.658
<span class="hljs-bullet">4.</span> 四舍五入: 7
<span class="hljs-bullet">5.</span> exponent方法输入: exp = 7
<span class="hljs-bullet">6.</span> 执行步骤:
<span class="hljs-bullet">   -</span> 写入 'E' → index = 1
<span class="hljs-bullet">   -</span> exp = 7 &lt; 10，跳过百位和十位
<span class="hljs-bullet">   -</span> 写入个位 '7' → index = 2
<span class="hljs-bullet">7.</span> 输出: "E7"
<span class="hljs-bullet">8.</span> 完整结果: "4.55058496E7"
</code></pre>
<p>根据源代码的逻辑简化了一版如下：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcoding.jd.com%2FnewJavaEngineerOrientation%2FDouble2String.git" target="_blank" title="https://coding.jd.com/newJavaEngineerOrientation/Double2String.git" ref="nofollow noopener noreferrer">coding.jd.com/newJavaEngi…</a></p>
<h2 data-id="heading-15"><strong>三、解决方案</strong></h2>
<h4 data-id="heading-16">3.1 BigDecimal 精准控制</h4>
<pre><code class="hljs language-scss" lang="scss">new <span class="hljs-built_in">BigDecimal</span>(doubleValue)<span class="hljs-selector-class">.setScale</span>(<span class="hljs-number">2</span>, RoundingMode.HALF_UP)<span class="hljs-selector-class">.toPlainString</span>() 
</code></pre>
<h4 data-id="heading-17"><code>3.2 DecimalFormat 格式化</code></h4>
<pre><code class="hljs language-scss" lang="scss">new <span class="hljs-built_in">DecimalFormat</span>("#<span class="hljs-number">0.00</span>")<span class="hljs-selector-class">.format</span>(doubleValue) <span class="hljs-comment">// 强制保留两位小数  </span>
</code></pre>
<h2 data-id="heading-18"><strong>四、总结</strong></h2>
<p>Double 数值的字符串格式化规则（如 <code>Double.toString()</code>）遵循：</p>
<p>•普通格式（Plain）：当数值的指数范围在 [-3, 7) 时（即绝对值在 [10^-3, 10^7) 之间），直接显示小数形式（如 0.001 或 123456.0）。</p>
<p>•科学计数法（Scientific）：当指数范围超出 [-3, 7)（如 0.000999 或 10000000.0），显示为科学计数法（如 9.99e-4 或 1.0e7）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[供应链系统中的 Web 打印方案的探索实践]]></title>    <link>https://juejin.cn/post/7598921649888968731</link>    <guid>https://juejin.cn/post/7598921649888968731</guid>    <pubDate>2026-01-26T00:00:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888968731" data-draft-id="7599268297202253862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="供应链系统中的 Web 打印方案的探索实践"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-26T00:00:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古茗前端团队"/> <meta itemprop="url" content="https://juejin.cn/user/3233040624266695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            供应链系统中的 Web 打印方案的探索实践
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7198439419173404711/posts" data-v-d326b38e=""><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dafcebf7c91d402abd52f072a32deba8~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7198439419173404711/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="古茗前端团队" class="title" data-v-d326b38e="">古茗前端团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2026-01-26T00:00:01.000Z" title="Mon Jan 26 2026 00:00:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2026-01-26
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读1分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @古茗科技
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：刘锦泉</p>
</blockquote>
<h2 data-id="heading-0">一、前言</h2>
<p>在供应链业务系统中，打印是一项<strong>难以被完全数字化替代的基础能力</strong>。尽管系统形态不断向 Web 化、平台化演进，但在仓储、物流、配送等线下环节，大量核心流程依然依赖纸质单据（如面单、送货单、运输单）完成流转与交接。</p>
<p>打印的稳定性与一致性，往往直接影响现场作业效率。一旦打印出现异常，问题会迅速放大，甚至直接阻断线下业务流程。</p>
<p>基于真实的供应链项目实践，本文将围绕浏览器打印这一常被低估的能力，系统性地梳理主流方案的技术取舍，并重点展开基于 <code>window.print</code> 的实现思路与工程实践。</p>
<h2 data-id="heading-1">二、供应链系统中的主流打印方案调研</h2>
<p>围绕“如何将单据稳定、可靠地打印出来”，在实际项目中常见的 Web 打印方案大致可以分为三类：</p>
<ul>
<li>基于 DOM 的浏览器原生打印方案</li>
<li>基于可视化模板的前端打印方案</li>
<li>基于本地打印控件的软件方案</li>
</ul>
<p>下面结合实际项目经验，对这三类方案进行简要分析。</p>
<h3 data-id="heading-2">1.基于DOM浏览器原生打印方案</h3>
<p>这是目前<strong>最常见、也是前端介入成本最低</strong>的一种打印实现方式。</p>
<p>其核心思路是：</p>
<blockquote>
<p>直接使用浏览器原生打印能力，将页面或指定 DOM 节点渲染为打印内容。</p>
</blockquote>
<p>打印效果如下图：</p>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17442b196ee74d45bc966aa555135ff0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">实现方式</h4>
<ol>
<li><strong>原生</strong> <strong>window.print()</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// window.print</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">print</span>
</code></pre>
<ol start="2">
<li><strong>使用 <strong><strong>print-js</strong></strong> 等开源库进行增强</strong></li>
</ol>
<p>官网地址：传送门(<a href="https://link.juejin.cn?target=https%3A%2F%2Fprintjs.crabbly.com%2F" target="_blank" title="https://printjs.crabbly.com/" ref="nofollow noopener noreferrer">printjs.crabbly.com/</a>)</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// printJs</span>
<span class="hljs-title function_">printJS</span>({
  <span class="hljs-attr">printable</span>: <span class="hljs-string">'print-area'</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-string">'html'</span>,
  <span class="hljs-attr">style</span>: <span class="hljs-string">'@page { size: A4; margin: 10mm; }'</span>,
  <span class="hljs-attr">targetStyles</span>: [<span class="hljs-string">'*'</span>]
});
</code></pre>
<h4 data-id="heading-4">优点</h4>
<ul>
<li><strong>零额外依赖</strong>，完全基于浏览器原生能力</li>
<li><strong>浏览器兼容性优秀</strong>：Chrome、Firefox、Safari、Edge 均支持</li>
<li><strong>开发与维护成本低</strong>，对现代前端技术栈（React / Vue）非常友好</li>
<li><strong>页面即模板</strong>，业务变更成本低，适合供应链中高频调整的单据场景</li>
</ul>
<h4 data-id="heading-5">缺点</h4>
<ul>
<li><strong>样式控制高度依赖 CSS</strong>，对分页、跨页控制要求较高</li>
<li><strong>批量打印需自行实现调度与队列逻辑</strong></li>
<li><strong>打印体验受浏览器限制</strong>：
<ul>
<li>页眉页脚难以完全控制</li>
<li>无法绕开系统打印弹窗</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2.基于可视化模板的前端打印方案（HiPrint）</h3>
<p>以 HiPrint 为代表的方案，通常基于 jQuery，通过拖拽方式设计打印模板，再将业务数据动态渲染到模板中进行打印。HiPrint 官网地址：传送门(<a href="https://link.juejin.cn?target=http%3A%2F%2Fhiprint.io%2F" target="_blank" title="http://hiprint.io/" ref="nofollow noopener noreferrer">hiprint.io/</a>)</p>
<p>配置示例效果如下图：</p>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48c4a520ab744742a3c347753a9bb5b2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">实现方式</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基于jQuery的打印设计器</span>
$(<span class="hljs-string">'#element'</span>).<span class="hljs-title function_">hiPrint</span>({
  <span class="hljs-attr">designer</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启可视化设计</span>
  <span class="hljs-attr">templates</span>: [...] <span class="hljs-comment">// 预设模板</span>
});
</code></pre>
<h4 data-id="heading-8">优点</h4>
<ul>
<li><strong>所见即所得的可视化模板设计</strong>
<ul>
<li>拖拽式配置</li>
<li>非开发人员也可参与模板调整</li>
</ul>
</li>
<li><strong>布局组件丰富</strong>
<ul>
<li>表格、文本、条码、图片等组件齐全</li>
<li>支持动态数据绑定</li>
</ul>
</li>
<li><strong>模板管理能力完善</strong>
<ul>
<li>模板导入 / 导出</li>
<li>支持模板版本管理</li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">缺点</h4>
<ul>
<li><strong>技术栈依赖性强</strong>：强依赖 jQuery，与 React / Vue 整合成本高</li>
<li><strong>性能问题明显</strong>：
<ul>
<li>模板复杂时渲染速度下降</li>
<li>大数据量场景容易卡顿</li>
</ul>
</li>
<li><strong>样式隔离难度大</strong>：
<ul>
<li>容易与现有系统样式冲突</li>
<li>需要额外处理样式覆盖与作用域</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">3.基于本地打印控件的软件方案（LODOP）</h3>
<p>LODOP 是一类 <strong>依赖本地打印控件或客户端程序</strong> 的打印方案，通过浏览器与本地程序通信完成打印。在早期政务、财务、制造业系统中使用较多。官网地址：传送门(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lodop.net%2F" target="_blank" title="https://www.lodop.net/" ref="nofollow noopener noreferrer">www.lodop.net/</a>)</p>
<h4 data-id="heading-11">实现方式</h4>
<ul>
<li>先去Lodop官网下载相应的安装包</li>
<li>解压安装后将LodopFuncs.js放在项目中</li>
<li>具体页面引入 Lodop</li>
</ul>
<pre><code class="hljs language-css" lang="css">import { getLodop } <span class="hljs-selector-tag">from</span> "@/plugins/LodopFuncs";

let LODOP = getLodop()
</code></pre>
<ul>
<li>执行打印指令</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 需要先安装LODOP软件</span>
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">PRINT_INIT</span>(<span class="hljs-string">"打印任务"</span>);
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">ADD_PRINT_TEXT</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"供应链单据"</span>);
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">PRINT</span>();
</code></pre>
<h4 data-id="heading-12">优点</h4>
<ul>
<li><strong>打印控制能力极强</strong>
<ul>
<li>支持毫米级定位</li>
<li>可直接控制打印机指令</li>
</ul>
</li>
<li><strong>对专业打印设备支持完善</strong></li>
</ul>
<h4 data-id="heading-13">缺点</h4>
<ul>
<li><strong>浏览器兼容性极差</strong>
<ul>
<li>依赖 ActiveX</li>
<li>现代浏览器与移动端基本不支持</li>
<li>只支持windows 系统</li>
</ul>
</li>
<li><strong>部署与运维成本高</strong>
<ul>
<li>每台客户端需安装软件</li>
<li>需要管理员权限</li>
</ul>
</li>
<li><strong>安全性与可持续性问题</strong>
<ul>
<li>ActiveX 存在安全隐患</li>
<li>已逐步被浏览器厂商淘汰</li>
</ul>
</li>
</ul>
<h3 data-id="heading-14">4.方案对比一览表</h3>









































<table><thead><tr><th><strong>维度</strong></th><th><strong>window.print</strong></th><th><strong>jQuery HiPrint</strong></th><th><strong>LODOP</strong></th></tr></thead><tbody><tr><td><strong>开发成本</strong></td><td>极低</td><td>中等</td><td>高</td></tr><tr><td><strong>打印精度</strong></td><td>一般（受限于浏览器）</td><td>良好</td><td><strong>极高</strong></td></tr><tr><td><strong>跨浏览器</strong></td><td><strong>优秀</strong></td><td>良好</td><td>极差</td></tr><tr><td><strong>部署成本</strong></td><td><strong>零部署</strong></td><td>低</td><td>高（需安装客户端）</td></tr><tr><td><strong>维护成本</strong></td><td>低</td><td>中等</td><td>高</td></tr></tbody></table>
<h3 data-id="heading-15">5.方案选型结论</h3>
<p>结合当前业务特点：</p>
<ul>
<li>需要快速适配不同客户与环境</li>
<li>系统主体基于 React 技术栈</li>
<li>单据模板相对稳定，支持页面预览</li>
</ul>
<p>最终选择了 <strong>基于 DOM 的浏览器打印方案，并以 <strong>window.print</strong> 作为核心实现方式</strong>。</p>
<h4 data-id="heading-16">为什么直接使用 PrintJs ?</h4>
<p>可能会有人疑惑，既然是 DOM 打印，为什么不使用 <code>print-js</code> 进行封装？主要原因如下：</p>
<ul>
<li><strong>print-js 需要能够直接获取到打印节点（dom 的id 或者原始的html）</strong>
<ul>
<li><strong>必须将预览节点在打印前挂载到页面上。</strong></li>
</ul>
</li>
<li><strong>iframe 隔离成本高</strong>
<ul>
<li>需要单独引入工程化依赖包CSS 资源。如： Antd等</li>
</ul>
</li>
<li><strong>样式维护成本高</strong>
<ul>
<li>额外样式需要么通过字符串方式注入，要么将工程的less 转换成css 引入，不利于后续维护。</li>
</ul>
</li>
</ul>
<p>总的来说，print-js 在工程化配置项目依旧不是那么方便还用。</p>
<h2 data-id="heading-17">三、window.print 的能力边界</h2>
<p><code>window.print()</code> 本质上是<strong>触发浏览器打印对话框</strong>。当打印动作触发时，浏览器会将<strong>当前页面最终渲染的结果</strong>输出为打印内容，或者导出为 PDF 文件。</p>
<p>也正因为这一点，<code>window.print</code> 天生存在一个非常重要的限制：</p>
<blockquote>
<p><strong>它无法直接指定“只打印某一个 DOM 区域”。</strong></p>
</blockquote>
<p>浏览器并不知道你只想打印某一个 <code>div</code>，它只会按照当前页面的渲染结果，完整地执行一次打印流程。<br/>
这意味着，如果页面上存在导航栏、按钮、筛选条件等元素，它们同样会被一并打印出来。</p>
<h2 data-id="heading-18">四、指定区域打印的实现思路</h2>
<p>既然 <code>window.print</code> 无法直接指定打印区域，那么解决问题的思路就非常清晰了：</p>
<blockquote>
<p><strong>在触发打印之前，主动控制页面最终的渲染结果，让真正参与渲染的内容只剩下需要打印的部分。</strong></p>
</blockquote>
<p>顺着这个思路，第一个最直观的方案自然就出现了。</p>
<h3 data-id="heading-19">1.innerHTML 直接替换页面内容</h3>
<p>既然浏览器只会打印当前页面的渲染结果，那么我们是否可以在打印前，<strong>直接用需要打印的内容替换整个页面</strong>？</p>
<p>实现方式也很简单：</p>
<ul>
<li>缓存当前页面内容</li>
<li>将 <code>document.body.innerHTML</code> 替换为打印区域内容</li>
<li>执行 <code>window.print()</code></li>
<li>打印完成后再恢复页面</li>
</ul>
<p>代码示例如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取预览组件的html</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getPreviewContainerHtml</span> = (<span class="hljs-params">component</span>) =&gt; {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);

  <span class="hljs-title function_">flushSync</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(component, div);
  })

  <span class="hljs-keyword">return</span> div.<span class="hljs-property">innerHtml</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">prinit</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> oldHtml = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span>;
  <span class="hljs-keyword">const</span> printHtml = <span class="hljs-title function_">getPreviewContainerHtml</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PreviewContainer</span> /&gt;</span></span>);
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span> = printHtml;
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">print</span>()
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span> = oldHtml;
}
</code></pre>
<p>这种方案在早期项目中非常常见。但随着实践的深入，很快就会发现一个问题：<br/>
<strong>直接替换 <strong><code>innerHTML</code></strong> 会彻底打破原有页面的渲染结构。</strong></p>
<p>在 React / Vue 等现代前端框架中，这种方式会导致：</p>
<ul>
<li>组件状态丢失</li>
<li>事件绑定失效</li>
<li>页面需要强制刷新才能恢复</li>
</ul>
<p>因此，这种方案虽然思路直接，但在复杂系统中并不安全。</p>
<h3 data-id="heading-20">2.新开标签页打印</h3>
<p>既然直接替换当前页面会破坏原有渲染结构，那么很自然就会想到：</p>
<blockquote>
<p><strong>如果不动当前页面，而是新开一个标签页，专门用来承载打印内容，是否就可以解决这个问题？</strong></p>
</blockquote>
<p>新开标签页后，我们可以：</p>
<ul>
<li>在新页面中渲染完整的打印内容</li>
<li>调用新页面的 <code>window.print()</code></li>
<li>当前业务页面完全不受影响</li>
</ul>
<p>从技术角度看，这个方案确实可以稳定地打印出我们想要的内容。但在真实业务场景中，很快又会暴露出新的问题：</p>
<ul>
<li>浏览器可能拦截弹窗</li>
<li>用户需要多一步切换窗口的操作</li>
<li>打印流程被打断，体验不够流畅</li>
</ul>
<p>对于仓库、物流等高频打印场景来说，<strong>这种额外的交互成本是不可忽略的</strong>。</p>
<p>于是问题进一步演化为：</p>
<blockquote>
<p><strong>能否在不新开标签页、不破坏当前页面的前提下，在当前页签内完成指定内容的打印？</strong></p>
</blockquote>
<h3 data-id="heading-21">3.iframe 当前页签打印</h3>
<p>顺着这个问题继续往下推，自然而然就会引出 <strong>iframe 打印方案</strong>。</p>
<p>其核心思路是：</p>
<ul>
<li>在当前页面中动态创建一个隐藏的 <code>iframe</code></li>
<li>将需要打印的内容完整渲染到 iframe 中</li>
<li>调用 iframe 内部的 <code>print()</code> 方法完成打印</li>
</ul>
<p>示例代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">print</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
  iframe.<span class="hljs-property">src</span> = <span class="hljs-string">`预览页地址`</span>;
  iframe.<span class="hljs-title function_">setAttribute</span>(
    <span class="hljs-string">'style'</span>,
    <span class="hljs-string">'visibility: hidden; height: 0; width: 0; position: absolute; border: 0'</span>
  );

  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'onafterprint'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'打印完成'</span>);
    iframe.<span class="hljs-title function_">remove</span>();
  });

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);

  iframe.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      iframe.<span class="hljs-property">contentWindow</span>?.<span class="hljs-title function_">print</span>();
    }, <span class="hljs-number">1000</span>);
  };
};
</code></pre>
<p>从浏览器的角度来看，<strong>iframe 本身就是一个完整的页面环境</strong>，因此可以独立完成打印流程，而不会影响主页面的渲染状态。</p>
<p>这一方案在实践中具备明显优势：</p>
<ul>
<li>不破坏当前页面状态</li>
<li>不依赖新窗口或弹窗</li>
<li>对 React / Vue 等现代框架友好</li>
<li>非常适合供应链系统中的高频打印场景</li>
</ul>
<h3 data-id="heading-22">4.批量打印</h3>
<p>到目前为止，我们已经可以稳定地完成 <strong>单个单据的打印</strong>。但在供应链场景中，一个非常常见的需求是：</p>
<blockquote>
<p><strong>一次性打印多张面单、送货单或运输单。</strong></p>
</blockquote>
<p>在浏览器环境下，这一需求首先会受到一个客观限制：</p>
<ul>
<li>浏览器在同一时间只能处理<strong>一个打印任务</strong></li>
<li>调用 <code>window.print()</code> 时，浏览器会弹出系统打印对话框</li>
<li>在用户完成打印设置并关闭对话框之前，<strong>页面线程会被阻塞</strong></li>
</ul>
<p>这意味着，<strong>通过循环多次调用 <strong><code>window.print()</code></strong> 来实现批量打印并不可行</strong>。</p>
<h4 data-id="heading-23">批量渲染内容 + CSS 分页</h4>
<p>基于上述限制，一个更合理的思路是：<strong>在一次打印动作中，承载所有需要打印的单据内容。</strong>具体做法是：</p>
<ul>
<li>遍历需要打印的单据数据</li>
<li>将每一张单据渲染为独立的打印容器</li>
<li>通过 CSS 控制分页规则</li>
<li>最终只触发一次 window.print()</li>
</ul>
<p> 示例代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 批量创建打印容器</span>
printPageList.<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PrintContent</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"single-order-page"</span> /&gt;</span></span>
    })

<span class="hljs-comment">// css 配置</span>
<span class="hljs-comment">/* 确保每个订单在新页开始 */</span>
.<span class="hljs-property">single</span>-order-page {
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">before</span>: always;
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">inside</span>: avoid;
}

<span class="hljs-comment">/* 第一个订单不需要分页 */</span>
.<span class="hljs-property">single</span>-order-<span class="hljs-attr">page</span>:first-child {
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">before</span>: avoid;
}

</code></pre>
<p>通过这种方式，浏览器会将每个单据视为一页内容，顺序稳定、实现简单，非常适合<strong>版式统一的批量单据打印场景</strong>。</p>
<h4 data-id="heading-24">大批量场景下的性能考量</h4>
<p>需要注意的是，当单据数量非常大（例如超过 50 张）时，<strong>一次性渲染所有打印内容，可能会带来内存占用和页面卡顿的问题</strong>。在这种情况下，可以考虑引入<strong>串行队列式的打印方案</strong>。</p>
<p>该方案的核心思路是：</p>
<ul>
<li>构建一个打印任务队列</li>
<li>每次只渲染并打印一张单据</li>
<li>当前打印结束后，再进入下一张单据的处理</li>
</ul>
<p>但需要特别注意的是，<strong>浏览器无法准确感知打印完成的时机</strong>，因此该方案通常需要额外的控制手段，例如：</p>
<ul>
<li>由用户交互驱动（如点击“下一张”）</li>
<li>通过时间间隔进行节流控制</li>
</ul>
<p>这种方式更适合作为<strong>大批量或特殊场景下的补充方案</strong>，而不是默认选择。</p>
<h2 data-id="heading-25">五、核心 CSS 打印配置：从“能打”到“好用”</h2>
<p>在基于浏览器的打印方案中，CSS 决定了最终的输出效果。合理的打印样式配置，往往可以显著减少版式错乱、内容截断等问题，也是浏览器打印能否真正落地的重要前提。</p>
<p>下面结合实际项目，整理几类最常用、也最容易被忽视的打印样式配置。</p>
<h3 data-id="heading-26">1.使用 <code>@media print</code> 定义专用打印样式</h3>
<p>浏览器提供了 <code>@media print</code> 媒体查询，用于在打印场景下<strong>覆盖页面的默认样式</strong>。</p>
<p>通过该方式，可以做到：</p>
<ul>
<li>页面正常浏览时样式不受影响</li>
<li>打印时只应用与单据相关的样式规则</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-comment">/* 打印场景下隐藏页面中的非单据内容 */</span>
  <span class="hljs-selector-class">.no-print</span> {
    <span class="hljs-attribute">display</span>: none <span class="hljs-meta">!important</span>;
  }
}
</code></pre>
<h3 data-id="heading-27">2.页面尺寸与边距控制</h3>
<p>如果不对打印页面的尺寸和边距进行控制，常见问题包括：</p>
<ul>
<li>内容被裁切</li>
<li>页面留白过多</li>
<li>不同浏览器下表现不一致</li>
</ul>
<p>通过 <code>@page</code> 可以明确指定打印纸张规格与边距：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-keyword">@page</span> {
    size: A4;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">10mm</span>;
  }
}
</code></pre>
<h3 data-id="heading-28">3.避免表格内容被强制拆页</h3>
<p>表格是供应链单据中最常见的结构，同时也是打印问题的高发区域。<br/>
如果不加控制，浏览器可能会在任意位置拆分页，导致一行数据被拆成两页。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-tag">table</span> {
    <span class="hljs-attribute">border-collapse</span>: collapse;
    <span class="hljs-comment">/* 避免整个表格在打印时被拆分 */</span>
    <span class="hljs-attribute">page-break-inside</span>: avoid;
  }

  <span class="hljs-selector-tag">tr</span> {
    <span class="hljs-comment">/* 避免单行数据跨页 */</span>
    <span class="hljs-attribute">page-break-inside</span>: avoid;
  }
}
</code></pre>
<h3 data-id="heading-29">4.主动控制分页位置</h3>
<p>在部分业务场景中，需要对分页位置进行明确控制，例如：</p>
<ul>
<li>一张送货单单独占一页</li>
<li>合计信息必须在新页展示</li>
</ul>
<p>此时可以通过自定义分页样式来实现：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-class">.page-break</span> {
    <span class="hljs-comment">/* 在该元素前强制分页 */</span>
    <span class="hljs-attribute">page-break-before</span>: always;
  }
}
</code></pre>
<h3 data-id="heading-30">5.打印颜色与背景处理</h3>
<p>浏览器在打印时，默认会忽略背景颜色与部分样式，这在以下场景中尤为明显：</p>
<ul>
<li>面单背景色</li>
<li>标签类单据</li>
<li>状态标识区域</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-tag">body</span> {
    <span class="hljs-comment">/* 强制按页面样式输出颜色 */</span>
    -webkit-print-<span class="hljs-attribute">color</span>-adjust: exact;
    print-<span class="hljs-attribute">color</span>-adjust: exact;
  }
}
</code></pre>
<p>注：Window 电脑如果不设置 <code>-webkit-print-color-adjust: exact</code> 打印输出水印内容， 会出现空白现象。</p>
<h2 data-id="heading-31">六、总结</h2>
<p>浏览器打印在供应链系统中看似只是一个基础能力，但在真实项目中，往往涉及<strong>方案选型、技术栈适配、用户体验以及长期维护成本</strong>等多方面的权衡。</p>
<p>本文结合具体的业务背景，对主流 Web 打印方案进行了梳理，并重点分析了基于 <code>window.print</code> 的实现思路及其工程边界。</p>
<p>可以看到，<code>window.print</code> 本身并不复杂，真正的挑战更多来自页面渲染控制、样式管理以及打印流程的工程化处理。这也使得浏览器打印更像是一项系统能力的组合，而非单一 API 的简单调用。</p>
<p>在当前阶段，<code>window.print</code> 配合 <code>iframe</code> 依然是 Web 打印方案中<strong>性价比最高、可控性最强的一种实现方式</strong>。随着业务复杂度的提升，打印方案仍有进一步演进与细化的空间。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Compose 的震动还能这么玩儿？]]></title>    <link>https://juejin.cn/post/7598734303174574132</link>    <guid>https://juejin.cn/post/7598734303174574132</guid>    <pubDate>2026-01-26T01:00:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174574132" data-draft-id="7598203055747874868" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Compose 的震动还能这么玩儿？"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-01-26T01:00:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Compose 的震动还能这么玩儿？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:00:05.000Z" title="Mon Jan 26 2026 01:00:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c6800beeb924f2484ce679c209c80d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=cIxBYLXfmVshFDmNT53WpC%2F3wUU%3D" alt="2.png" loading="lazy"/></p>
<p>上周我在公司摸鱼的时候，发现 Github 上有一个开源库叫 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcompose-jindong%2Fjindong" target="_blank" title="https://github.com/compose-jindong/jindong" ref="nofollow noopener noreferrer">Jindong</a>，没错，听起来就是京东！</p>
<p>我以为我看错了，京东什么时候开始干这玩意儿了？后面才发现误会了。</p>
<h2 data-id="heading-0">Jindong 是什么</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ff95b33316948099512d1f39d6e87d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=WKMy2Nd2ynuxlIIvCsHbB9NozM8%3D" alt="1.png" loading="lazy"/></p>
<p><strong>Jindong</strong> 为 Compose 跨平台应用（支持 Android 和 iOS）提供了声明式的触觉反馈 <strong>DSL</strong>。它基于 Compose 构建，让你能通过简单直观的 API 定义复杂的触觉模式。</p>
<blockquote>
<p>该开源库的作者是来自韩国的开发者。“Jindong”[tɕindooŋ]（진동）在韩语中意为“振动”。<br/>
好朴实无华的库名称，如果是中文名那岂不就是——Zhendong？</p>
</blockquote>
<p>我们知道，当前移动 UI 开发已成功转向声明式范式，但与硬件 API 的交互（尤其是触觉反馈）仍然主要依赖命令式编程。</p>
<p>所以这个库的初衷，是为了让触觉反馈的交互也转向声明范式，它解决了在 Compose Multiplatform 应用中实现触觉反馈的复杂性。借助 Compose，开发者现在可以将触觉模式以结构化描述的形式进行定义。</p>
<p>也就是说，它提供了一种声明范式的方式调用硬件 API，同时还支持跨平台。</p>
<h2 data-id="heading-1">传统震动</h2>
<p>我们先来看看传统的命令式方式——使用标准 Android API 创建波形振动，需要并行的时序和振幅值数组：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Column(
    modifier = Modifier.fillMaxSize(),
) {
    Button(onClick = {
        <span class="hljs-keyword">val</span> timings = longArrayOf(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>)
        <span class="hljs-keyword">val</span> amplitudes = intArrayOf(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">128</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)
        <span class="hljs-keyword">val</span> effect = VibrationEffect.createWaveform(timings, amplitudes, -<span class="hljs-number">1</span>)
        defaultVibrator.vibrate(effect)
    }) {
        Text(<span class="hljs-string">"Vibrate"</span>)
    }
}

</code></pre>
<p>调整某个节拍的持续时间需要重新计算数组索引。更不用说，这种逻辑是平台相关的，iOS 的 Core Haptics 需要完全不同的代码实现。</p>
<h2 data-id="heading-2">声明式</h2>
<p><strong>Jindong</strong> 将这些底层细节抽象为一种 DSL。开发者只需定义反馈结构，库会负责执行。</p>
<p>首先，我们添加权限和依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.VIBRATE"</span> /&gt;</span>
</code></pre>
<pre><code class="hljs language-Kotlin" lang="Kotlin">implementation(<span class="hljs-string">"io.github.compose-jindong:jindong:1.0.0"</span>)
</code></pre>
<p>然后，开始 DSL 形式的震动：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }

JindongProvider { <span class="hljs-comment">// 需要提供一个 JindongProvider</span>
    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// 防止第一次进来就震动</span>
        Jindong(count) { <span class="hljs-comment">// 传入一个 key，当 key 发生变化的时候，就会震动</span>
            Sequence {
                repeat(<span class="hljs-number">3</span>) { <span class="hljs-comment">// 重复三次震动</span>
                    Haptic(<span class="hljs-number">50.</span>ms, HapticIntensity.STRONG)
                    Delay(<span class="hljs-number">100.</span>ms)
                }
            }
        }
    }

}

Column(
    modifier = Modifier.fillMaxSize(),
) {
    Button(onClick = {
        count++
    }) {
        Text(<span class="hljs-string">"Vibrate"</span>)
    }
}
</code></pre>
<p>在这里，开发者只需定义触觉模式（一个重复三次的序列），而库会负责处理平台相关的执行细节。</p>
<p>这种差异不仅仅是语法上的不同——关键在于<strong>谁来控制执行过程</strong>。</p>
<p>这也正是旧式的 View 写法和新式的 Compose 写法的核心差别：</p>

















<table><thead><tr><th>命令式思维</th><th>声明式思维</th></tr></thead><tbody><tr><td>“先振动 50ms，然后等待 100ms，再振动 50ms”</td><td>“我想要一个 50ms-100ms-50ms 的震动模式”</td></tr><tr><td>“循环三次，中间有延迟，启动震动”</td><td>“我想要三次重复”</td></tr></tbody></table>
<p>声明式编程关注于定义目标的逻辑和关系，而不指定如何实现它们。</p>
<p><strong>“描述要做什么，而不是怎么做。”</strong></p>
<h2 data-id="heading-3">生命周期管理</h2>
<p>在命令式触觉反馈中，生命周期管理是最大的痛点之一。如果用户在长时间振动模式播放过程中导航离开当前页面，会发生什么？</p>
<p>在命令式编程的世界里，你必须手动在 <code>onPause</code> 或 <code>onDispose</code> 中调用 <code>vibrator.cancel()</code>。</p>
<p>而使用 <strong>Jindong</strong> 时，触觉模式会自动绑定到 Compose 的生命周期：</p>
<ul>
<li><strong>自动取消</strong>：当 Composable 离开组合时，触觉引擎会立即停止。</li>
<li><strong>响应式更新</strong>：就像 <code>LaunchedEffect</code> 一样，如果在模式播放过程中 <code>keys</code> 发生变化，<strong>Jindong</strong> 会自动取消当前模式，并根据新状态重新开始执行。</li>
</ul>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">/**
 * 当 keys 发生变化时，触发触觉模式执行的可组合函数。
 */</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">jindong</span><span class="hljs-params">(
    <span class="hljs-keyword">vararg</span> keys: <span class="hljs-type">Any</span>?,
    content: @<span class="hljs-type">Composable</span> <span class="hljs-type">JindongScope</span>.() -&gt; <span class="hljs-type">Unit</span>,
)</span></span> {
    <span class="hljs-keyword">val</span> pattern = rememberHapticPattern(content)
    <span class="hljs-keyword">val</span> executor = LocalHapticExecutor.current
    LaunchedEffect(*keys) {
        executor.execute(pattern)
    }
}
</code></pre>
<p>这正是 Compose 的一大优势，无需特别关心生命周期。</p>
<p>当你离开组合时，当前的副作用自动结束！</p>
<h2 data-id="heading-4">搞点例子</h2>
<p>以下是一些 <strong>Jindong</strong> 的实用场景。</p>
<p><em>下面的例子因为篇幅我没有显示的指定 <code>JindongProvider</code>，实际上所有的 <code>Jindong</code> 都需要在 <code>JindongProvider</code> 内部。</em></p>
<h3 data-id="heading-5">屏幕进入反馈</h3>
<p>使用 <code>Unit</code> 作为触发键，可在进入屏幕时立即触发热反馈：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">WelcomeScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 页面出现时执行一次</span>
    Jindong(<span class="hljs-built_in">Unit</span>) {
        Haptic(<span class="hljs-number">100.</span>ms, HapticIntensity.MEDIUM)
    }
}
</code></pre>
<h3 data-id="heading-6">按钮点击反馈</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">TapButton</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> taps <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }
    <span class="hljs-keyword">if</span> (taps &gt; <span class="hljs-number">0</span>) {
        Jindong(taps) {
            Haptic(<span class="hljs-number">100.</span>ms, HapticIntensity.LIGHT)
        }
    }
    Button(onClick = { taps++ }) {
        Text(<span class="hljs-string">"Tap"</span>)
    }
}
</code></pre>
<h3 data-id="heading-7">淡出效果</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FadeOutHaptic</span><span class="hljs-params">(trigger: <span class="hljs-type">Int</span>)</span></span> {
    Jindong(trigger) {
        RepeatWithIndex(<span class="hljs-number">5</span>) { index -&gt;
            <span class="hljs-keyword">val</span> intensity = HapticIntensity.Custom(<span class="hljs-number">1.0f</span> - (index * <span class="hljs-number">0.2f</span>))
            Haptic(<span class="hljs-number">50.</span>ms, intensity)
            Delay(<span class="hljs-number">100.</span>ms)
        }
    }
}
</code></pre>
<h3 data-id="heading-8">模拟心跳</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">HeartbeatHaptic</span><span class="hljs-params">(trigger: <span class="hljs-type">Int</span>)</span></span> {
    Jindong(trigger) {
        Repeat(<span class="hljs-number">5</span>) {

            <span class="hljs-comment">// Lub（强脉冲）</span>
            Haptic(<span class="hljs-number">60.</span>ms, HapticIntensity.STRONG)
            Delay(<span class="hljs-number">80.</span>ms)

            <span class="hljs-comment">// Dub（弱脉冲）</span>
            Haptic(<span class="hljs-number">40.</span>ms, HapticIntensity.MEDIUM)
            Delay(<span class="hljs-number">400.</span>ms)
            
        }
    }
}
</code></pre>
<p><strong>强烈建议各位试一下，这个特别像！</strong></p>
<h2 data-id="heading-9">内部原理：Compose Runtime 与 CMP</h2>
<h3 data-id="heading-10">Compose Runtime 的作用是什么？</h3>
<p>Compose Runtime 是一个与 UI 渲染无关的树管理引擎。<strong>Jindong</strong> 依赖于 Compose 运行时的两个核心组件：</p>
<ul>
<li><strong>ComposeNode</strong>：这是一个通用函数，用于将节点插入到树中。在 <strong>Jindong</strong> 中，每个 DSL 函数（如 <code>Haptic</code>、<code>Delay</code> 和 <code>Sequence</code>）都会在内部调用 <code>ComposeNode</code>，以创建特定的 <code>HapticNode</code> 实现。</li>
<li><strong>Applier</strong>：运行时需要知道如何将这些节点连接起来。<code>Applier</code> 负责处理 <code>HapticNode</code> 树的结构更新，该树将在播放前被遍历，以收集 <code>ScheduledHapticEvent</code> 事件。</li>
</ul>
<p>就像 Compose UI 通过构建 <code>LayoutNode</code> 树来渲染像素一样，<strong>Jindong</strong> 通过构建 <code>HapticNode</code> 树来合成振动效果。这使我们能够使用标准的 Compose 特性（如 <code>SideEffect</code>、<code>remember</code>），结合 Kotlin 的标准控制流（如 <code>if/when/for</code>），自然地构建动态的触觉体验。</p>
<h3 data-id="heading-11">Compose Multiplatform 实现</h3>
<p><strong>Jindong</strong> 遵循标准的 CMP（Compose Multiplatform）架构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48925c6b609a4ab298002ef02ee73ccc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=GzjNWUeHecWN0ns1mQ0Q6DSF8Zg%3D" alt="cmp.png" loading="lazy"/></p>
<ol>
<li><strong>通用层（Common Layer）</strong> ：包含 Compose DSL 定义、节点（Nodes）以及 <code>HapticPattern</code> 数据模型。所有时间计算和模式编译都在此层完成，确保跨平台行为的一致性。</li>
<li><strong>平台层（Platform Layer，即执行器 Executor）</strong> ：
<ul>
<li><strong>Android</strong>：将 <code>HapticPattern</code> 转换为 <code>VibrationEffect</code>（使用 <code>VibrationEffect.createWaveform</code>）。</li>
<li><strong>iOS</strong>：将 <code>HapticPattern</code> 转换为 <code>CHHapticPattern</code>，用于 Core Haptics。</li>
</ul>
</li>
</ol>
<p>Android 和 iOS 对振动强度的处理方式不同。</p>
<p>Android 使用振幅整数（1–255），而 iOS 的 Core Haptics 使用归一化的浮点值（0.0–1.0）。</p>
<p><strong>Jindong</strong> 提供了一个统一的抽象层，使开发者可以使用归一化的百分比（例如，<code>intensity = 0.5f</code>）来定义强度，无需关心平台特定的数学转换。</p>
<h2 data-id="heading-12">总结</h2>
<p><strong>Jindong</strong> 旨在解决在 Compose Multiplatform 应用中实现触觉反馈的复杂性。通过利用 Compose 运行时，开发者可以将触觉模式定义为<strong>结构化描述</strong>，而非一系列电机命令序列。</p>
<p>各位还在等什么，赶紧用起来试试呀！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题]]></title>    <link>https://juejin.cn/post/7598938568431271951</link>    <guid>https://juejin.cn/post/7598938568431271951</guid>    <pubDate>2026-01-26T03:50:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598938568431271951" data-draft-id="7598838597559992354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-26T03:50:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狗头大军之江苏分军"/> <meta itemprop="url" content="https://juejin.cn/user/2955079655907879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2955079655907879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狗头大军之江苏分军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:50:56.000Z" title="Mon Jan 26 2026 03:50:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    113
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>状态本身并不可怕，可控的边界才是关键。无论 Vue/React/Flutter，真正失控的场景总是因为<code>谁该负责这块状态？</code> <code> 状态的生命周期与副作用不一样咋办？</code> <code>状态有多个“真实来源”</code>。比起盲目选用全局状态库，先设计状态边界、所有者与契约，再选工具，这才是我想写这篇文章的核心。</p>
</blockquote>
<h2 data-id="heading-0">目前</h2>
<p>我维护过三套完全不同的代码库：一个用 Vue3 做企业后台，一个用 React 做客户运营后台，还有一个用 Flutter 做用户端 App。开始的时候我和很多人一样，把“状态管理”当成救命稻草，拿着 Pinia、Redux、Provider 当工具箱里的万能胶，遇到问题就往全局塞状态。后来出现的问题不是框架的锅，而是我和团队没有先把状态的边界划清楚。最直观的一次教训是一个批量导入功能：导入进度既存在于页面的临时变量，也存在于全局 cache、后端轮询结果，还有一个后台任务队列的本地副本，结果在某些网络抖动场景下进度条反复闪烁、提交失败、回调覆盖更新，排查下来并不是网络问题，而是同一份“事实”有多个来源、多个所有者、多个副作用在不同地方生效，互相覆盖。修复并不靠换库，而是靠把“导入任务”明确成单一来源、改用只读查询加唯一写入入口，并把所有副作用集中到 service 层，这才把问题彻底堵住。</p>
<h2 data-id="heading-1">示例一：Vue3 中“状态失控”的典型写法 vs 有边界的写法</h2>
<p><strong>失控版本（真实会出事故的那种）</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// store.ts</span>
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">importTask</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span>,
})
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// A.vue</span>
state.<span class="hljs-property">progress</span> = <span class="hljs-number">30</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// B.vue</span>
state.<span class="hljs-property">progress</span> = <span class="hljs-number">80</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// service.ts</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  state.<span class="hljs-property">progress</span> += <span class="hljs-number">10</span>
}, <span class="hljs-number">1000</span>)
</code></pre>
<p>这种写法的问题不是 Vue，而是<strong>任何地方都能写</strong>，没有人知道谁是妆台管理者。<br/>
只要接口回调、定时轮询、用户操作同时发生一次，UI 就开始抽风。</p>
<h2 data-id="heading-2">但是</h2>
<p>不同框架的问题表现不太一样，但本质相似。Vue3 的常见失控点是把 <code>reactive</code> 的对象随手导出，全项目任意模块直接改动，或者把大量短期 UI 状态塞进 Pinia，结果是到底哪个组件该清理、什么时候取消 watch、谁负责取消请求，没人说得清楚；React 的典型症状是把太多东西放进 Context 或一个大 Redux store，组件随便改对象属性（非不可变更新），导致 memo 无效、重渲染泛滥和难以回溯的副作用；Flutter 则常见在 <code>setState</code> 或全局单例里乱放数据，导致父组件更新引起大量子树不必要重建，或者 Provider/Riverpod 的边界划分混乱，让调试变得痛苦。无论是哪种框架，问题总在这些点交汇：谁该负责这块数据、这块数据的生命周期何时开始与结束、哪些副作用会影响它、它是否有多个事实来源。</p>
<h2 data-id="heading-3">示例二：React 中“useEffect 地狱”是怎么来的</h2>
<p><strong>常见但危险的写法</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ImportPage</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/task?user=<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">setProgress</span>(data.<span class="hljs-property">progress</span>))
  }, [userId, progress])
}
</code></pre>
<p>这个代码我敢说你肯定见过。<br/>
问题在于：<code>progress</code> 既是<strong>结果</strong>，又被当成<strong>触发条件</strong>，effect 自己触发自己，网络抖一下就会循环请求。</p>
<p><strong>把副作用和状态边界拆开</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useImportTask</span>(<span class="hljs-params">userId: string</span>) {
  <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> canceled = <span class="hljs-literal">false</span>

    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/task?user=<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!canceled) <span class="hljs-title function_">setProgress</span>(data.<span class="hljs-property">progress</span>)
      })

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      canceled = <span class="hljs-literal">true</span>
    }
  }, [userId])

  <span class="hljs-keyword">return</span> progress
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ImportPage</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> progress = <span class="hljs-title function_">useImportTask</span>(userId)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Progress</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{progress}</span> /&gt;</span></span>
}
</code></pre>
<p>z仔细看看这段代码你会发现：  <strong>页面不再“拥有”状态，只是消费状态</strong>，失控的入口直接少了一半。</p>
<h2 data-id="heading-4">解决</h2>
<p>既然问题的核心是“边界不清”，我给新项目的建议有几条可能听起来反直觉但非常实用：第一，<code>不要急着建一个全局 store</code>，先把状态放在页面或组件本地，等出现明确的跨页面共享需求并能量化受益时再抽象；
第二，写代码前先画张状态边界图，列出每个状态的 owner、生命周期、是否持久化、是否为衍生值、以及唯一的写入入口；第三，全局或模块化 store 只暴露只读查询和明确的写入 API，禁止项目随意直接修改内部结构；第四，副作用全部集中到 service/side-effect 层（无论是 React 的 hook、Vue 的 composable 还是 Flutter 的 repository），组件只负责展示与触发，副作用层负责取消、去重、重试和错误处理；第五，<code>衍生状态不要持久化</code>，能由原始状态算出来的就用 computed/selector 动态计算；第六，对于复杂的状态流转场景（例如多阶段导入、有超时和回滚逻辑）考虑用状态机来建模，状态可视化之后很多边界问题就能一目了然；第七，启用类型系统和不可变更新约定，这能大幅提升可追溯性和避免微妙的引用错误；第八，把变更审计和日志当成基础设施，<code>为重要的全局状态记录 action 名称、时间戳和 trace id，出问题时能快速回溯。</code></p>
<p>哦对了，忘记距离flutter了，这个技术在掘金里面可能用到的人有点少，没有react vue那么多，但还是说一下吧。</p>
<h2 data-id="heading-5">示例三：Flutter 里最容易被忽略的全局状态</h2>
<p><strong>问题写法</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalTask</span> {
  <span class="hljs-type">static</span> <span class="hljs-type">int</span> progress = <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">setState(() {
  GlobalTask.progress += 10<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>这个问题非常隐蔽，因为 Flutter 重建 UI 很快，早期根本察觉不到。<br/>
但一旦页面多了、热重载多了、逻辑复杂了，你根本不知道是谁在改。</p>
<p><strong>明确 owner 的写法（Provider / Riverpod 思路）</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImportTaskState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ChangeNotifier</span> {
  int _progress = <span class="hljs-number">0</span>;

  int get progress =&gt; _progress;

  <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProgress</span>(<span class="hljs-params">int value</span>) {
    _progress = value;
    <span class="hljs-title function_">notifyListeners</span>();
  }
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Consumer</span>&lt;<span class="hljs-title class_">ImportTaskState</span>&gt;(
  <span class="hljs-attr">builder</span>: (_, state, __) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ProgressBar</span>(<span class="hljs-attr">value</span>: state.<span class="hljs-property">progress</span>);
  },
)
</code></pre>
<p>你不是在用 Provider，而是在<strong>声明：这块状态属于 ImportTaskState</strong>。</p>
<p>还有一些衍生状态千万不要存，如果有复杂流程直接用状态机</p>
<p><strong>错误思路</strong></p>
<pre><code class="hljs language-js" lang="js">state.<span class="hljs-property">list</span> = rawList
state.<span class="hljs-property">filteredList</span> = rawList.<span class="hljs-title function_">filter</span>(...)
</code></pre>
<p><strong>正确思路</strong></p>
<pre><code class="hljs language-hs" lang="hs">const filteredList = computed(() =&gt; {
  return state.list.filter(...)
})
</code></pre>
<p>这不是性能优化，这是<strong>防止状态分叉</strong>。  一旦存了两份，你迟早要花时间修同步问题。</p>
<hr/>
<h2 data-id="heading-6">状态机</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> importMachine = <span class="hljs-title function_">createMachine</span>({
  <span class="hljs-attr">id</span>: <span class="hljs-string">'import'</span>,
  <span class="hljs-attr">initial</span>: <span class="hljs-string">'idle'</span>,
  <span class="hljs-attr">states</span>: {
    <span class="hljs-attr">idle</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">START</span>: <span class="hljs-string">'uploading'</span> } },
    <span class="hljs-attr">uploading</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">SUCCESS</span>: <span class="hljs-string">'processing'</span>, <span class="hljs-attr">FAIL</span>: <span class="hljs-string">'error'</span> } },
    <span class="hljs-attr">processing</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">DONE</span>: <span class="hljs-string">'completed'</span> } },
    <span class="hljs-attr">completed</span>: {},
    <span class="hljs-attr">error</span>: {},
  },
})
</code></pre>
<p>当你把流程画成状态图之后，会非常清楚地看到：<strong>哪些状态允许更新，哪些不允许</strong>，根本不需要猜。</p>
<h2 data-id="heading-7">结尾~~~</h2>
<p>以下是我总结的几点建议~，针对我们当前三个技术栈项目了，按需自取哈~并不通用。</p>
<ul>
<li>一，功能设计阶段画状态边界图并在 PR 中提交；</li>
<li>二，凡是跨页面共享的状态必须指定 owner 与 action；</li>
<li>三，把网络请求、订阅、定时器等副作用统一封装在 service 层并实现取消逻辑；</li>
<li>四，把 UI 临时数据留在本地，衍生数据用 selector；</li>
<li>五，<code>对复杂流程使用状态机并训练团队阅读状态图</code> 没开玩笑， man！！！；</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手写 Promise.all]]></title>    <link>https://juejin.cn/post/7599483314160746515</link>    <guid>https://juejin.cn/post/7599483314160746515</guid>    <pubDate>2026-01-26T13:34:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599483314160746515" data-draft-id="7568319637000781824" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手写 Promise.all"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-26T13:34:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="剪刀石头布啊"/> <meta itemprop="url" content="https://juejin.cn/user/1855631360014798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手写 Promise.all
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631360014798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    剪刀石头布啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T13:34:15.000Z" title="Mon Jan 26 2026 13:34:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Promise 是 JavaScript 中非常重要的一个功能，他可以让我们异步的去处理一些事情，尤其是对于一些比较耗时的操作，其非常重要，当然一些不耗时的操作，有事就没必要使用它了，毕竟会带来额外的性能开销</p>
<h2 data-id="heading-1">Promise.all</h2>
<p>Promise.all 是 js 中个一个静态方法，尤其是写业务对接后端的时候，会经常见到，不管是写后端异步签名，还是前端接口请求，其主要用来聚合一组成功的结果</p>
<p>相比于 promise 其他系列，这个算是比较简单了(当然 race 更简单就不介绍了)</p>
<p>下面简单陈述 Promise.all 手写的几个关键单</p>
<ol>
<li>all 是一个静态方法，因此不能像写对象的原型链 prototype一样写</li>
<li>promise 状态从 pending 变更为 fulfilled 或者 rejected 只能发生一次，因此无需考虑多次回调 reject 的问题</li>
<li>遍历 promises 数组的时候，遍历的是所有可迭代对象，因此 for...of 非常适合</li>
</ol>
<p><strong>tips</strong>: 可以通过 promise 函数回调赋值的方式减少嵌套层级</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//声明一个静态方法</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-property">myAll</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">promises</span>) {
    <span class="hljs-keyword">let</span> resolve, reject;
    <span class="hljs-comment">//构造一个新的promise,赋值可以减少嵌套层级</span>
    <span class="hljs-keyword">const</span> completePromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">res, rej</span>) =&gt;</span> {
        resolve = res;
        reject = rej;
    })
    <span class="hljs-keyword">const</span> results = [];
    <span class="hljs-keyword">const</span> length = promises.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> completedCount = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> idx = <span class="hljs-number">0</span>
    <span class="hljs-comment">//tips: promise 状态从 pending 变更为 fulfilled 或者 rejected 只能发生一次</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> promises) {
        <span class="hljs-comment">//使用一个临时变量接收 idx 避免补货到外部同一个索引</span>
        <span class="hljs-keyword">const</span> currentIndex = idx;
        <span class="hljs-comment">//item可能不是promise，所以用Promise.resolve包一下</span>
        <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(item).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
            results[currentIndex] = value;
            completedCount++;
            <span class="hljs-comment">//全部成功标记成功</span>
            <span class="hljs-keyword">if</span> (completedCount === length) {
                <span class="hljs-title function_">resolve</span>(results);
            }
        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
            <span class="hljs-comment">//有一个返回err就行了，promise状态只会变更一次</span>
            <span class="hljs-title function_">reject</span>(err);
        })
        idx++;
    }
    <span class="hljs-keyword">return</span> completePromise;
}
</code></pre>
<p>下面测试一下结果，非常正确</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">test</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>)
        }, <span class="hljs-number">1000</span>)
    });
    <span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>)
        }, <span class="hljs-number">2000</span>)
    });
    <span class="hljs-keyword">const</span> p3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// reject('error 3')</span>
            <span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>)
        }, <span class="hljs-number">1500</span>)
    });
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">myAll</span>([p1, p2, p3]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'res'</span>, res)
    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'err'</span>, err)
    })
}

<span class="hljs-title function_">test</span>();
</code></pre>
<p>这篇文章就讲到这里了，由于内容相对简单，就不多介绍了</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skills完全指南：核心概念丨设计模式丨实战代码]]></title>    <link>https://juejin.cn/post/7598918127578972194</link>    <guid>https://juejin.cn/post/7598918127578972194</guid>    <pubDate>2026-01-26T05:06:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598918127578972194" data-draft-id="7598734303174066228" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skills完全指南：核心概念丨设计模式丨实战代码"/> <meta itemprop="keywords" content="Trae,人工智能,Claude"/> <meta itemprop="datePublished" content="2026-01-26T05:06:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skills完全指南：核心概念丨设计模式丨实战代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T05:06:23.000Z" title="Mon Jan 26 2026 05:06:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p><strong>Agent Skills</strong>最近非常火！它最初只是 Claude 中的一个功能模块，但在最近两个月里，随着越来越多开发者体验到其强大与便捷，Codex、Cursor、OpenCode 等主流 AI 编程工具也相继加入了对 Agent Skills 的支持。就连我日常使用最频繁的字节跳动旗下工具 Trae，也于近期集成了这一能力。</p>
<p>2025 年 12 月 18 日，Anthropic 正式将 Agent Skills 发布为开放标准，标志着它正与 MCP 一样，朝着通用化、跨平台化的规范方向发展。如果大家还不熟悉 Agent Skills，也无需担心——本文将带大家系统梳理其技术原理，解析关键设计模式，并通过实战代码为大家完整解读 <strong>Agent Skills</strong> 的核心内容。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0de5dcbd47cb47b99462ecab3859c6d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=whhyyWaCy9CTMjKLb6fLB7uNWCU%3D" alt="0.jpeg" loading="lazy"/></p>
<p>这里同样宣传一下笔者正在编写的专栏：<a href="https://juejin.cn/column/7594655863548248116" target="_blank" title="https://juejin.cn/column/7594655863548248116">《大模型训练指南》</a>，该专栏预计会有50期内容，将系统拆解从数据处理、模型训练到强化学习与智能体开发的全流程，并带大家从零实现模型，帮助大家掌握大模型训练的全技能，真正掌握塑造智能的能力！</p>
<h2 data-id="heading-1">一、 Agent Skills 介绍</h2>
<p>如果用一句话概括，<strong>Agent Skills 就像一份“带目录的说明书”</strong> 。更专业地说，它是一种<strong>渐进式披露的提示词管理机制</strong>。</p>
<p>该规范将提示词分为三个层次：</p>
<ul>
<li><strong>元数据（Metadata）</strong></li>
<li><strong>指令（Instruction）</strong></li>
<li><strong>资源（Resource）</strong></li>
</ul>
<p>其中，只有<strong>元数据层</strong>默认被加载到大模型的上下文中，其余两层均为<strong>按需加载</strong>。大家可以这样理解：</p>
<ul>
<li><strong>元数据</strong>如同书的<strong>目录</strong>，告诉模型有哪些可用的能力；</li>
<li><strong>指令</strong>如同书的<strong>正文</strong>，详细说明在某一能力下如何执行某项任务；</li>
<li><strong>资源</strong>如同书的<strong>附录</strong>，提供对某一能力的必要的补充材料（如代码示例、数据模板等）。</li>
</ul>
<p>智能体在执行时，首先仅载入“目录”（元数据），随后根据实际需求，再决定是否查阅该目录下的“正文”（指令）与“附录”（资源）。</p>
<p>与传统的完整 Prompt 或 MCP 方式相比，Agent Skills 最显著的优势在于<strong>大幅降低了 Token 消耗与提示词的复杂度</strong>，使智能体的能力扩展更加轻量与高效。</p>
<p>当然，仅理论描述仍显抽象。接下来笔者将通过一个 Claude Skills 的实际案例，带大家直观理解 Agent Skills 是如何运作的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/277610d043e543ceaae4c66d12554797~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=%2FDKUFH4L8TDYup%2FeBVO4YSG0A%2FA%3D" alt="1.png" loading="lazy"/></p>
<h2 data-id="heading-2">二、Claude Code使用Skills基本流程</h2>
<p>既然 Skills 规范由 Anthropic 公司提出，笔者就以 Claude Code 为例，首先介绍其基本用法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3624668940c749f2a4a90dacc86a0096~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=3M7hGeTICOMA91pvHnmxe3C5k6U%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-3">2.1 claude code安装教程</h3>
<ol>
<li><strong>环境准备：</strong> 首先大家需要安装<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.cn%2Fdownload%2F" target="_blank" title="https://nodejs.cn/download/" ref="nofollow noopener noreferrer">Node.js 18</a>或更新的版本环境。还需要安装<a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Finstall%2F" target="_blank" title="https://git-scm.com/install/" ref="nofollow noopener noreferrer">Git</a>，流程笔者就不再赘述，大家可以参考笔者以前文章 <a href="https://juejin.cn/post/7491986080473153586" target="_blank" title="https://juejin.cn/post/7491986080473153586">不写一行代码! VsCode+Cline+高德地图MCP Server 帮你搞定和女友的出行规划（附原理解析）</a>。</li>
<li><strong>安装 Claude Code：</strong> 在命令行中执行以下命令进行全局安装claude：<code>npm install -g @anthropic-ai/claude-code</code>命令,  安装完成后，可通过 <code>claude --version</code> 验证是否安装成功。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8eb8474902a46949f04646348dd7bcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=2S%2B%2FlChvWQLvcexh0hxHqavV5Jk%3D" alt="3.png" loading="lazy"/></p>
<ol start="3">
<li><strong>配置大模型（国内开发者）：</strong> 由于 Claude 模型访问限制，国内开发者通常可将其它模型接入 Claude Code。此处以<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fcoding-plan%2Ftool%2Fclaude%23%25E6%2596%25B9%25E5%25BC%258F%25E4%25B8%2589%25EF%25BC%259A%25E6%2589%258B%25E5%258A%25A8%25E9%2585%258D%25E7%25BD%25AE" target="_blank" title="https://docs.bigmodel.cn/cn/coding-plan/tool/claude#%E6%96%B9%E5%BC%8F%E4%B8%89%EF%BC%9A%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE" ref="nofollow noopener noreferrer"><strong>智谱大模型</strong></a>为例：在 <code>C:\Users{你的用户名}.claude</code> 目录下（若无则新建），创建 <code>settings.json</code> 文件，并填入以下配置：</li>
</ol>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ANTHROPIC_AUTH_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你注册的智谱api key(大家可以买套餐注册)"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ANTHROPIC_BASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://open.bigmodel.cn/api/anthropic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"API_TIMEOUT_MS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3000000"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>4.  <strong>完成基础配置：</strong> 在 <code>C:\Users{你的用户名}</code> 目录下，创建 <code>.claude.json</code> 文件并写入以下内容，配置完成后，请<strong>重新启动命令行窗口</strong>以使环境变量生效：</p>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"hasCompletedOnboarding"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>5.  <strong>启动与使用：</strong> 新建一个项目目录，通过命令行进入该目录后，执行 <code>claude</code> 命令即可启动。首次在某个目录使用时，系统可能会询问是否信任该目录，选择 <code>YES</code> 即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b773fdce82b43749a5c4e2f9b7e1136~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=QyCHb7%2BHZDvISBwFYRJAFZaQWIs%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-4">2.2 Claude Code中使用skills</h3>
<p>下面笔者将通过一个实战案例（思路参考自 @技术爬爬虾）来演示如何创建并使用一个 Skill。</p>
<ol>
<li><strong>Skill 的目录结构：</strong> 在 Claude Code 项目中，Skills 存放在 <code>项目目录/.claude/skills/</code> 路径下。每个 Skill 都是一个独立的文件夹，其中<strong>必须</strong>包含一个名为 <code>SKILL.md</code> 的定义文件（注意大写）。此文件包含了该 Skill 的<strong>元数据层</strong>和<strong>指令层</strong>。此外，文件夹内还可存放其他辅助文件，它们构成了 Skill 的<strong>资源层</strong>。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02f5acea00b24ddcbdf9458a86050634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=sjw3CdJLBwgIwkllkvTwUFWazzQ%3D" alt="6.png" loading="lazy"/></p>
<ol start="2">
<li><strong>创建 Skill 文件夹与文件：</strong> 在项目根目录（例如笔者这里是 <code>skill-project</code>）下，依次创建 <code>.claude\skills\字幕转markdown</code> 文件夹，并在其中创建 <code>SKILL.md</code> 文件(注意名称必须为<code>SKILL.md</code>，大小写都要一致)。</li>
<li><strong>编写 Skill 元数据：</strong> 在<code>SKILL.md</code> 文件中首先写入元数据，元数据用于描述 Skill 的基本信息，需用 <code>---</code> 包裹。它会被优先加载到大模型上下文中，相当于“能力目录”。</li>
</ol>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">srt字幕转markdown笔记</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">把srt字幕文件转换为markdown笔记</span>
<span class="hljs-meta">---
</span></code></pre>
<p>4.  <strong>编写 Skill 指令：</strong> 在<code>SKILL.md</code> 文件中元数据后面紧接着编写指令部分，指令部分定义了 Skill 的具体操作逻辑和详细要求，采用 Markdown 格式编写。</p>
<pre><code class="hljs language-markdown" lang="markdown">你是专业的字幕文本处理助手，任务是将sRT 字幕完整转换为 Markdown 笔记，并添加标点、段落格式和必要的截图占位符。要求
如下:
1.<span class="hljs-strong">**内容完整保留**</span>:禁止任何删减、总结或省略，必须逐字保留 SRT 所有文字。
2.<span class="hljs-strong">**语言规则**</span>:使用中文书写，保留必要的英文专有名词。
3.<span class="hljs-strong">**段落结构**</span>:
<span class="hljs-code">    -仅使用一个层级的段落
    -每个段落标题使用## 标题
    -第一段为引言，不使用标题
    -只需要划分2-3个段落
4. **标点与排版**:
    -为每句话添加合适标点
    -适当划分自然段
5.**截图占位符规则(按需插入)**
    -当某句符合以下任一条件时，在句末添加截图标记:
    -代码讲解
    -UI 交互操作
    -包含"这么、这里、这儿"等视觉指代词
    -提及网址/链接/地址(包括 GitHub、API endpoint等)
    -任何借助视觉材料更易理解的内容
    -形式必须严格为:
    ```
    Screenshot-[hh:mm:ss]
    ```
    -仅在真正有助理解时插入，不可滥用
    比如:
    ```
    原始SRT
    00:02:08,600--&gt;00:02:09,800
    安装这个工具
    ```
6. **输出文件格式**:
    - 生成内容保存为单个Markdown 文件，命名为:
    ```
    项目根目录/xxx.md
    ```
</span></code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a741365998fb4388a8d19fbaf5366915~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=0%2B%2FQKQy%2BHhr3rRuZe59oKzBZfpE%3D" alt="7.png" loading="lazy"/></p>
<ol start="5">
<li><strong>查看与测试 Skill</strong>：在项目目录下打开命令行并输入 <code>/skills</code>，即可看到已定义好的 Skill。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6feba68277fe44a586be2f6e8ac9a61d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=IiWNaqEKKCbyftWMz6cEWx0BCY0%3D" alt="8.png" loading="lazy"/></p>
<ol start="6">
<li><strong>运行 Skill</strong>： 将需要转换的 <code>.srt</code> 字幕文件拖入 Claude Code 命令行。此时，大模型仅加载了 <code>SKILL.md</code> 中的元数据（“目录”），识别出这是一个字幕文件，并<strong>询问是否使用对应的 Skill</strong>。<br/>
当大家确认使用后，Claude Code 才会将 <code>SKILL.md</code> 中详细的指令部分（“正文”）加载到上下文中，并开始执行转换任务。这就是  <strong>“渐进式披露提示词”</strong>  机制的核心体现：<strong>按需加载，显著节省 Token</strong>，这样大家是不是就理解了Skills设计的核心概念啦！</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5e22a94bf5040ddb7484163fc1c255d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=q3iBLf5YlxhwU7pViHRVWZ%2ByZiY%3D" alt="9.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/263faf0c59d549ca9b49cfd1ca34fa5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=zt4MHjtbDWVONfSGMI%2BO4XYo32w%3D" alt="10.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74ca09b264f0426f94960533630f1872~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=iADIltxxQny6UAOXl7Z05mO6vKU%3D" alt="11.png" loading="lazy"/></p>
<h3 data-id="heading-5">2.3 Claude Code skills进阶用法</h3>
<p>一个 Skill 的强大之处在于可以集成各种资源文件（脚本、文档、图片等），以实现更复杂的自动化工作流。下面笔者就继续优化字幕转markdown skills，让其功能变得更强大！</p>
<ol>
<li><strong>资源层的组织：</strong> 可以在 Skill 文件夹内创建子目录（如 <code>scripts</code>, <code>references</code>, <code>assets</code>）来分类存放资源文件，使结构更清晰。资源文件可以是
可执行脚本、补充说明文档，也可以是图片等其它资源，标准做法是将可执行Python文件放到scripts子文件夹中，把文档放到references这个子文件夹里面，把图片等其它资源放到assets子文件夹里面。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbd048e324304b23bc98c1dfcdefb527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=fRUaZI62P98I7CA4Ibrc02qM7qA%3D" alt="6.png" loading="lazy"/></p>
<ol start="2">
<li><strong>添加可执行脚本：</strong> 在 <code>字幕转markdown</code> 这个 Skill 的目录下，创建一个 <code>scripts</code> 子文件夹，并放入一个 Python 脚本 <code>screenshot.py</code>。该脚本的功能是：根据 Markdown 中生成的截图标记（如 <code>Screenshot-[00:03:12]</code>），调用 <code>ffmpeg</code> 从对应的视频文件中截取相应时间点的画面，并将标记替换为实际的图片链接。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Iterable, <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span>, <span class="hljs-type">Tuple</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">write_note</span>(<span class="hljs-params">filename: <span class="hljs-built_in">str</span>, markdown: <span class="hljs-built_in">str</span></span>) -&gt; Path:
    path = Path(<span class="hljs-string">f"output/<span class="hljs-subst">{filename}</span>.md"</span>)
    path.parent.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
    path.write_text(markdown, encoding=<span class="hljs-string">"utf-8"</span>)
    logging.info(<span class="hljs-string">"Saved note backup: %s"</span>, path)
    <span class="hljs-keyword">return</span> path


<span class="hljs-comment"># ---------- 截图 ----------</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_screenshot_markers</span>(<span class="hljs-params">markdown: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]]:
    <span class="hljs-string">"""
    找到 Screenshot-00:03:12 或 Screenshot-[00:03:12] 形式的标记。
    """</span>
    pattern = <span class="hljs-string">r"(?:\*?)Screenshot-(?:\[(\d{2}):(\d{2}):(\d{2})\]|(\d{2}):(\d{2}):(\d{2}))"</span>
    results: <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]] = []
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">match</span> <span class="hljs-keyword">in</span> re.finditer(pattern, markdown):
        hh = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">4</span>)
        mm = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">5</span>)
        ss = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">6</span>)
        total_seconds = <span class="hljs-built_in">int</span>(mm) * <span class="hljs-number">60</span> + <span class="hljs-built_in">int</span>(ss)
        results.append((<span class="hljs-keyword">match</span>.group(<span class="hljs-number">0</span>), total_seconds))
    <span class="hljs-keyword">return</span> results


<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_screenshot</span>(<span class="hljs-params">video_path: Path, output_dir: Path, timestamp: <span class="hljs-built_in">int</span></span>) -&gt; Path:
    <span class="hljs-string">"""
    调用 ffmpeg 截图，返回图片路径。
    """</span>
    output_dir.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
    mm = timestamp // <span class="hljs-number">60</span>
    ss = timestamp % <span class="hljs-number">60</span>
    filename = <span class="hljs-string">f"screenshot_<span class="hljs-subst">{mm:02d}</span>_<span class="hljs-subst">{ss:02d}</span>.jpg"</span>
    output_path = output_dir / filename

    cmd = [
        <span class="hljs-string">"ffmpeg"</span>,
        <span class="hljs-string">"-ss"</span>,
        <span class="hljs-built_in">str</span>(timestamp),
        <span class="hljs-string">"-i"</span>,
        <span class="hljs-built_in">str</span>(video_path),
        <span class="hljs-string">"-frames:v"</span>,
        <span class="hljs-string">"1"</span>,
        <span class="hljs-string">"-q:v"</span>,
        <span class="hljs-string">"2"</span>,
        <span class="hljs-built_in">str</span>(output_path),
        <span class="hljs-string">"-y"</span>,
    ]
    logging.info(<span class="hljs-string">"生成截图：time=%s, file=%s"</span>, timestamp, output_path)
    subprocess.run(cmd, check=<span class="hljs-literal">False</span>, capture_output=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">return</span> output_path


<span class="hljs-keyword">def</span> <span class="hljs-title function_">replace_screenshots</span>(<span class="hljs-params">
    markdown: <span class="hljs-built_in">str</span>,
    video_path: <span class="hljs-type">Optional</span>[Path],
    output_dir: Path,
    image_base_url: <span class="hljs-built_in">str</span>,
</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    将 Screenshot 标记替换为实际图片链接；没有视频时保持原样。
    返回修改后的 markdown。
    """</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> video_path:
        logging.info(<span class="hljs-string">"未提供视频文件，保留 Screenshot 标记不变。"</span>)
        <span class="hljs-keyword">return</span> markdown

    matches = extract_screenshot_markers(markdown)
    
    <span class="hljs-keyword">for</span> idx, (marker, ts) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(matches):
        <span class="hljs-keyword">try</span>:
            img_path = generate_screenshot(video_path, output_dir, ts)
            url = <span class="hljs-string">f"<span class="hljs-subst">{image_base_url.rstrip(<span class="hljs-string">'/'</span>)}</span>/<span class="hljs-subst">{img_path.name}</span>"</span>
            markdown = markdown.replace(marker, <span class="hljs-string">f"![](<span class="hljs-subst">{url}</span>)"</span>, <span class="hljs-number">1</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> exc:  <span class="hljs-comment"># pylint: disable=broad-except</span>
            logging.warning(<span class="hljs-string">"生成截图失败（%s）：%s"</span>, marker, exc)
    <span class="hljs-keyword">return</span> markdown

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    logging.basicConfig(
        level=logging.INFO,
        <span class="hljs-built_in">format</span>=<span class="hljs-string">"%(asctime)s [%(levelname)s] %(message)s"</span>,
    )
    parser = argparse.ArgumentParser(description=<span class="hljs-string">"将 SRT/视频转换为 Markdown 笔记"</span>)
    args = parser.parse_args()

    logging.info(<span class="hljs-string">"环境变量加载完成。"</span>)

    <span class="hljs-comment">#从当前工作目录自动查找对应的 SRT 和 MP4 文件</span>
    cwd = Path.cwd()
    md_path: Path
    video_path: Path
    <span class="hljs-comment"># 附件文件夹</span>
    image_base_url = <span class="hljs-string">"assets"</span>
    screenshots_path = Path(<span class="hljs-string">f"output/<span class="hljs-subst">{image_base_url}</span>"</span>)

    md_candidates = <span class="hljs-built_in">sorted</span>(cwd.glob(<span class="hljs-string">"*.md"</span>))
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> md_candidates:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"当前目录没有找到任何 .md 文件，请把字幕文件夹导出并且放到根目录下。"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(md_candidates) &gt; <span class="hljs-number">1</span>:
        logging.warning(<span class="hljs-string">"当前目录中发现多个 .srt，将使用第一个：%s"</span>, md_candidates[<span class="hljs-number">0</span>])
    md_path = md_candidates[<span class="hljs-number">0</span>]

    mp4_candidates = <span class="hljs-built_in">sorted</span>(cwd.glob(<span class="hljs-string">"*.mp4"</span>))
    <span class="hljs-keyword">if</span> mp4_candidates:
        preferred: <span class="hljs-type">Optional</span>[Path] = <span class="hljs-literal">None</span>
        video_path = preferred <span class="hljs-keyword">or</span> mp4_candidates[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(mp4_candidates) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> preferred <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            logging.warning(<span class="hljs-string">"当前目录中发现多个 .mp4，将使用第一个：%s"</span>, video_path)
    <span class="hljs-keyword">else</span>:
        logging.info(<span class="hljs-string">"当前目录未发现 .mp4，将保留 Markdown 中的 Screenshot 标记不变。"</span>)
        video_path = <span class="hljs-literal">None</span>

    <span class="hljs-comment"># 读取 markdown 文件内容</span>
    markdown = md_path.read_text(encoding=<span class="hljs-string">"utf-8"</span>)
    logging.info(<span class="hljs-string">"读取 Markdown 文件：%s"</span>, md_path)

    processed_md = replace_screenshots(markdown, video_path=video_path, output_dir=screenshots_path, image_base_url=image_base_url)

    logging.info(<span class="hljs-string">"截图处理完成"</span>)
    
    <span class="hljs-comment"># 备份替换后的 Markdown 内容</span>
    output = write_note(<span class="hljs-string">"note_processed"</span>, processed_md)

    info = {
        <span class="hljs-string">"output"</span>: <span class="hljs-built_in">str</span>(output),
        <span class="hljs-string">"screenshots_dir"</span>: <span class="hljs-built_in">str</span>(screenshots_path),
        <span class="hljs-string">"video_used_for_screenshot"</span>: <span class="hljs-built_in">str</span>(video_path)
    }
    <span class="hljs-built_in">print</span>(json.dumps(info, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1633a22220e4056ab7d4ef52e34e537~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=OghnvhSXdispslOM6v%2FIfIALRoA%3D" alt="12.png" loading="lazy"/></p>
<ol start="3">
<li><strong>更新指令以调用资源：</strong> 在 <code>SKILL.md</code> 的指令部分末尾，添加调用该脚本的步骤：</li>
</ol>

<pre><code class="hljs language-markdown" lang="markdown">7.<span class="hljs-strong">**后续处理**</span>:
<span class="hljs-code">    markdown生成完毕以后，调用
    python scripts/screenshot.py
    对视频进行截图，执行python脚本时不需要传递任何参数
</span></code></pre>
<p>4.  <strong>运行完整的 Skill 工作流：</strong>
1.  将待处理的视频文件 <code>.mp4</code> 也放入项目根目录。
2.  在 Claude Code 中，再次拖入 <code>.srt</code> 字幕文件。
3.  Claude Code 将首先执行“字幕转Markdown”任务，生成一份带有 <code>Screenshot-[hh:mm:ss]</code> 标记的笔记。
4.  接着，它会自动执行 <code>python scripts/screenshot.py</code> 命令。<strong>关键点在于</strong>：脚本代码本身<strong>不会</strong>作为提示词上下文传递给大模型，Claude Code 只是作为执行环境去运行它。这再次体现了 Skills 机制在<strong>降低上下文消耗</strong>上的优势。
5.  脚本运行后，最终生成一份包含实际截图链接的、图文并茂的 Markdown 笔记。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f499eab9294a4a5cb745d3264c882292~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=CJqqIXRwlKWBsZb%2FAkpuw4RPEyU%3D" alt="13.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d8e821750d0473c8bf0ce4348438f92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=oNSTZC4fa8%2BJyM7K0ho2SE%2FCnGE%3D" alt="14.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42a3d362b7634c6ea85b51d97cc81c39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=8L5G%2BcuKhgMb7WQ5eoUGNe43T6w%3D" alt="15.png" loading="lazy"/></p>
<h2 data-id="heading-6">三、 Skills和MCP的区别</h2>
<p>许多读者询问笔者：同样出自 Anthropic，Skills 与 MCP（Model Context Protocol）究竟有何不同？<br/>
实际上，<strong>Skills 与 MCP 是两个目标不同、互为补充的规范</strong>。它们虽有部分功能重叠，但设计侧重点和使用场景有显著差异：</p>
<ul>
<li><strong>Skills</strong> 的核心在于<strong>提示词的管理与组织</strong>，通过“渐进式披露”机制，以轻量、结构化方式扩展模型能力。</li>
<li><strong>MCP</strong> 的核心在于<strong>工具与服务的标准化接入</strong>，旨在为模型提供统一、安全的外部工具调用能力。</li>
</ul>
<p>简单类比：</p>
<ul>
<li><strong>Skills 如同“带目录的说明书”</strong> ——逐步展开，按需提供详细操作指引。</li>
<li><strong>MCP 如同“标准化工具箱”</strong> ——提供一系列即插即用的工具，模型可直接调用。</li>
</ul>
<p>若大家对 MCP 的具体实现与原理感兴趣，可进一步阅读笔者之前的文章：<a href="https://juejin.cn/post/7488895565314949120" target="_blank" title="https://juejin.cn/post/7488895565314949120">《理论+代码一文带你深入浅出MCP：人工智能大模型与外部世界交互的革命性突破》</a>。</p>
<p>为更直观对比，以下从几个维度总结二者的主要区别：</p>



































<table><thead><tr><th>维度</th><th>Agent Skills</th><th>MCP</th></tr></thead><tbody><tr><td><strong>侧重点</strong></td><td>提示词的结构化组织与渐进式加载</td><td>外部工具与服务的标准化调用</td></tr><tr><td><strong>类比</strong></td><td>带目录的说明书</td><td>标准化工具箱</td></tr><tr><td><strong>Token 消耗</strong></td><td>低（仅按需加载指令与资源）</td><td>较高（需携带工具描述与调用逻辑）</td></tr><tr><td><strong>核心主体</strong></td><td>Markdown 文件（SKILL.md）</td><td>软件包/服务（含协议与实现）</td></tr><tr><td><strong>编写与部署难度</strong></td><td>低（文件级配置，易于本地管理）</td><td>较高（需遵循协议，常涉及服务端开发）</td></tr></tbody></table>
<p>总的来说，<strong>Skills 更适合轻量化、提示词驱动的能力扩展</strong>，而 <strong>MCP 更适合复杂、需频繁调用外部工具或服务的场景</strong>。在实际项目中，二者亦可结合使用，例如通过 MCP 提供工具，再通过 Skills 组织调用这些工具的提示词流程，从而实现更高效、可维护的智能体架构。</p>
<h2 data-id="heading-7">四、总结</h2>
<p>本篇分享了Agent Skills核心概念。它通过元数据、指令和资源三层结构实现渐进式披露，显著降低Token消耗。以Claude Code为例，详细演示了Skills的创建、使用及进阶集成方法，帮助大家快速掌握Skills的核心概念和开发技巧，助力大家构建更强大的智能体！</p>
<p>当然很多粉丝和笔者一样受制于某些因素无法高效使用Claude Code，也对智谱等模型的订阅机制颇有异议（心疼自己钱包1秒），现在字节跳动的Trae也支持了Skills的编写调用，笔者日后也会分享Trae Skills调用的相关文章，大家敬请期待~</p>
<p>除大模型训练指南专栏外，笔者也在同步更新<a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>免费专栏，要说明该专栏适合所有对 LangChain 感兴趣的学习者，无论之前是否接触过 LangChain。该专栏基于笔者在实际项目中的深度使用经验，系统讲解了使用LangChain/LangGraph如何开发智能体，目前已更新 37 讲，并持续补充实战与拓展内容。欢迎感兴趣的同学关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号<strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工程师之夜系列分享第三十九篇：Kafka、RocketMQ、JMQ 存储架构深度对比]]></title>    <link>https://juejin.cn/post/7599268297223028746</link>    <guid>https://juejin.cn/post/7599268297223028746</guid>    <pubDate>2026-01-26T06:37:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297223028746" data-draft-id="7599101854645125130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工程师之夜系列分享第三十九篇：Kafka、RocketMQ、JMQ 存储架构深度对比"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-26T06:37:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工程师之夜系列分享第三十九篇：Kafka、RocketMQ、JMQ 存储架构深度对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T06:37:12.000Z" title="Mon Jan 26 2026 06:37:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：毕源泉</p>
<h2 data-id="heading-0"><strong>引言</strong></h2>
<p>消息队列的存储架构是决定其可靠性、吞吐量、延迟性能的核心因素，直接影响业务场景适配能力。本文聚焦三款主流消息队列 ——Kafka（LinkedIn 开源，侧重高吞吐）、RocketMQ（阿里开源，金融级特性突出）、JMQ（京东开源，侧重高可用与灵活性），从存储模型、数据组织、索引设计等维度展开深度对比，为技术选型与架构优化提供参考。​</p>
<p>本文将从概念辨析出发，系统拆解主流存储模型与存储引擎的设计逻辑，对比 JMQ、Kafka、RocketMQ的技术选型差异与架构设计。​</p>
<h2 data-id="heading-1"><strong>一、</strong> Kafka存储架构</h2>
<h3 data-id="heading-2">1.1 核心存储模型：分区日志流</h3>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7cfa3ce57c042bbb8129399b1c864f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=PnjsUDbTp9cMbaspiT5bEMbyEj8%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>Topic - 主题</strong></p>
<p>Kafka学习了数据库里面的设计，在里面设计了topic（主题），这个东西类似于关系型数据库的表，此时我需要获取中国移动的数据，那就直接监听中国移动订阅的Topic即可。</p>
<p><strong>Partition - 分区</strong></p>
<p>Kafka还有一个概念叫Partition（分区），分区具体在服务器上面表现起初就是一个目录，一个主题下面有多个分区，这些分区会存储到不同的服务器上面，或者说，其实就是在不同的主机上建了不同的目录。这些分区主要的信息就存在了.log文件里面。跟数据库里面的分区差不多，是为了提高性能。</p>
<p>至于为什么提高了性能，很简单，多个分区多个线程，多个线程并行处理肯定会比单线程好得多。</p>
<p>Topic和partition像是HBASE里的table和region的概念，table只是一个逻辑上的概念，真正存储数据的是region，这些region会分布式地存储在各个服务器上面，对应于kafka，也是一样，<strong>Topic也是逻辑概念，而partition就是分布式存储单元。这个设计是保证了海量数据处理的基础。我们可以对比一下，如果HDFS没有block的设计，一个100T的文件也只能单独放在一个服务器上面，那就直接占满整个服务器了，引入block后，大文件可以分散存储在不同的服务器上。</strong></p>
<p><strong>注意：</strong></p>
<p>1.分区会有单点故障问题，所以我们会为每个分区设置副本数</p>
<p>2.分区的编号是从0开始的</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/413616a8cb5b49108dc78ee5d83da964~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=Aak26sRbAylseEE6EPBodreChHk%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>Kafka 以「主题（Topic）- 分区（Partition）」为核心组织数据，每个分区本质是一个 append-only 的日志流，消息按生产顺序追加存储，保证分区内消息有序性。​</p>
<p><strong>优点：</strong> 可以充分利用磁盘顺序读写高性能的特性。存储介质也可以选择廉价的SATA磁盘，这样可以获得更长的数据保留时间、更低的数据存储成本。</p>
<h3 data-id="heading-3">1.2 数据组织：分段日志文件</h3>
<p>•每个分区拆分为多个 Segment 文件（默认 1GB），命名格式为「起始偏移量.log」（如 00000000000000000000.log）​，做这个限制目的是为了方便把.log加载到内存去操作</p>
<p>•配套两类索引文件：.index（偏移量→物理地址映射）、.timeindex（时间戳→偏移量映射）​​</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d505a0f45414658b84cf5dade264132~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=GQr2zCGvvd8SBdDGhx6z2V%2FnNWA%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>这个9936472之类的数字，就是代表了这个日志段文件里包含的起始offset，也就说明这个分区里至少都写入了接近1000万条数据了。</p>
<p>Kafka broker有一个参数，log.segment.bytes，限定了每个日志段文件的大小，最大就是1GB，一个日志段文件满了，就自动开一个新的日志段文件来写入，避免单个文件过大，影响文件的读写性能，这个过程叫做log rolling，正在被写入的那个日志段文件，叫做active log segment。</p>
<h3 data-id="heading-4">1.3 消息读/写过程</h3>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11a656ab0cd74097ba3d3659fad7ac82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=tjGdeAzwfIfl6gSq5hI33wKoeOI%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>写消息：</strong></p>
<p>•Index文件写入，Index文件较小，可以直接用mmap进行内存映射，避免频繁的磁盘I/O操作，提高写入性能；由于Index文件是稀疏索引，只需要记录关键位置的偏移量，因此即使使用mmap，写入的开销也相对较低。</p>
<p>•Segment文件写入，Segment文件较大，可以采用普通的写操作（FileChannel.write），由于Segment文件是顺序写入的，并且Kafka会利用操作系统的PageCache（页缓存）机制，写入操作会先写入到内存中，然后由操作系统在后台异步刷新到磁盘，可以进一步提高写入的性能。</p>
<p><strong>读消息：</strong></p>
<p>•Index文件读取，通常使用mmap方式读取，由于Index文件较小，且是稀疏索引，缺页中断的可能性较小。</p>
<p>•Segment文件读取，通常使用sendfile系统调用来实现零拷贝读取和发送，减少数据在用户空间与内核空间之间的拷贝次数，提高数据传输的效率。</p>
<h3 data-id="heading-5">1.4 关键技术</h3>
<p>Kafka 作为高性能的消息中间件，其超高吞吐量的核心秘诀之一就是<strong>深度依赖 PageCache + 顺序 I/O + mmap 内存映射</strong>的组合。</p>
<p>PageCache，中文名称为页高速缓冲存储器。它是将磁盘上的数据加载到内存中，当系统需要访问这些数据时，可以直接从内存中读取，而不必每次都去读取磁盘。这种方式显著减少了磁盘I/O操作，从而提高了系统性能。</p>
<p>mmap（Memory-mapped file）是操作系统提供的一种将<strong>磁盘文件</strong>与<strong>进程虚拟地址空间</strong>建立映射关系的核心技术，本质是让进程通过直接操作内存地址的方式读写文件，无需传统的 read/write 系统调用。核心价值在于<strong>零拷贝</strong>和<strong>内存式文件访问</strong>，尤其适合大文件、高吞吐、随机访问的场景。</p>
<p>将日志段（.log）文件映射到内存，生产者写入时直接写内存（内核异步刷盘），消费者读取时直接从内存读取，实现超高吞吐（Kafka 的 “顺序写 + mmap” 是其高性能核心）；</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/198f6af031ef4f60a5d2b0f82dc9494d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=Vyw2JODxGRRKZV86%2FZjMpywtpXY%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>零拷贝流程示意图</p>
<p>零拷贝过程：</p>
<p>1.用户进程发起sendfile系统调用，<strong>上下文（切换1）从用户态转向内核态</strong></p>
<p>2.DMA控制器，把数据从硬盘中拷贝到内核缓冲区。</p>
<p>3.CPU将读缓冲区中数据拷贝到socket缓冲区</p>
<p>4.DMA控制器，异步把数据从socket缓冲区拷贝到网卡，</p>
<p>5.<strong>上下文（切换2）从内核态切换回用户态</strong>，sendfile调用返回。</p>
<h3 data-id="heading-6">1.5 设计优势</h3>
<p>•顺序写磁盘：Segment 文件仅追加写入，规避随机 IO，吞吐量极高（单分区可达 10 万 + TPS）​​</p>
<p>•索引轻量化：仅维护偏移量与时间戳索引，降低存储开销​</p>
<p>•副本同步：基于 ISR 机制，仅同步已提交消息，兼顾一致性与可用性</p>
<h2 data-id="heading-7">二、RocketMQ存储架构</h2>
<p>Kafka的每个Partition都是一个完整的、顺序写入的文件，但当Partition数量增多时，从操作系统的角度看，这些写入操作会变得相对随机，这可能会影响写入性能。</p>
<h3 data-id="heading-8">2.1 核心存储模型：分离式设计</h3>
<p>RocketMQ采用「CommitLog + ConsumeQueue + IndexFile」三层结构，彻底分离数据存储与索引查询：​</p>
<p>•CommitLog：全局单一日志文件（默认 1GB / 个，循环覆盖），存储所有主题的原始消息​​</p>
<p>•ConsumeQueue：按主题 - 队列维度拆分的索引文件，存储「消息物理地址 + 偏移量 + 长度」，供消费者快速查询​</p>
<p>•IndexFile：哈希索引文件，支持按消息 Key 查询</p>
<p>CommitLog：消息的原始日记本</p>
<p><strong>CommitLog</strong>是RocketMQ存储消息的物理文件，所有消息都会按到达顺序写入这个文件。你可以把它想象成一本不断追加的日记本——每条消息都是按时间顺序记录的新日记。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 消息存储的核心逻辑简化示例（非源码）</span>
 public void <span class="hljs-built_in">putMessage</span>(Message message) {
     <span class="hljs-comment">// 1. 将消息序列化为字节数组</span>
     byte<span class="hljs-selector-attr">[]</span> data = <span class="hljs-built_in">serialize</span>(message);
     <span class="hljs-comment">// 2. 计算消息物理偏移量</span>
     long offset = commitLog<span class="hljs-selector-class">.getMaxOffset</span>();
     <span class="hljs-comment">// 3. 将数据追加到CommitLog文件末尾</span>
     commitLog<span class="hljs-selector-class">.append</span>(data);
     <span class="hljs-comment">// 4. 返回消息的全局唯一物理偏移量</span>
     return offset;
}
</code></pre>
<p>消息写入CommitLog时有三个关键特性：</p>
<p>1.<strong>顺序写入</strong>：所有消息按到达顺序追加到文件末尾，避免磁盘随机寻址</p>
<p>2.<strong>内存映射</strong>：通过MappedByteBuffer实现文件映射，减少数据拷贝次数</p>
<p>3.<strong>文件分割</strong>：单个CommitLog文件默认1GB，写满后创建新文件（文件名用起始偏移量命名）</p>
<p>举个例子，当生产者发送三条消息时，CommitLog文件可能长这样：</p>
<pre><code class="hljs language-ini" lang="ini">0000000000000000000（文件1，1GB）  
2|--消息A(<span class="hljs-attr">offset</span>=<span class="hljs-number">0</span>)  
3|--消息B(<span class="hljs-attr">offset</span>=<span class="hljs-number">100</span>)  
4|--消息C(<span class="hljs-attr">offset</span>=<span class="hljs-number">200</span>)  
500000000001073741824（文件2，起始偏移量1073741824）  
</code></pre>
<p><strong>温馨提示</strong>：虽然CommitLog是顺序写，但读取时需要配合索引结构，否则遍历文件找消息就像大海捞针。</p>
<p>消费队列ConsumeQueue：消息的快速目录</p>
<p>如果每次消费都要扫描CommitLog，性能会惨不忍睹。于是RocketMQ设计了<strong>ConsumeQueue</strong>——它是基于Topic和Queue的二级索引文件。</p>
<p>每个ConsumeQueue条目包含三个关键信息（固定20字节）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">1</span>| CommitLog <span class="hljs-title function_">Offset</span> <span class="hljs-params">(<span class="hljs-number">8</span>字节)</span> | Message <span class="hljs-title function_">Size</span> <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span> | Tag <span class="hljs-title function_">Hashcode</span> <span class="hljs-params">(<span class="hljs-number">8</span>字节)</span> |  
</code></pre>
<p>这相当于给CommitLog里的消息做了一个目录：</p>
<pre><code class="hljs language-lua" lang="lua">TopicA-Queue0的ConsumeQueue  
<span class="hljs-number">2</span>|<span class="hljs-comment">--0（对应CommitLog偏移0的消息A）  </span>
<span class="hljs-number">3</span>|<span class="hljs-comment">--100（对应CommitLog偏移100的消息B）  </span>
<span class="hljs-number">4</span>|<span class="hljs-comment">--200（对应CommitLog偏移200的消息C）</span>
</code></pre>
<p>当消费者拉取TopicA-Queue0的消息时：</p>
<p>1.先查ConsumeQueue获取消息的物理位置</p>
<p>2.根据CommitLog Offset直接定位到CommitLog文件</p>
<p>3.读取指定位置的消息内容</p>
<p><strong>关键设计点</strong>：</p>
<p>•ConsumeQueue采用内存映射+异步刷盘，保证高性能</p>
<p>•单个文件存储30万条索引，约5.72MB（30万*20字节）</p>
<p>•通过hashCode快速过滤Tag，实现消息过滤</p>
<p>索引文件IndexFile：消息的全局字典</p>
<p>如果需要根据MessageID或Key查询消息，ConsumeQueue就不够用了。这时候就要用到<strong>IndexFile</strong>这个全局索引。</p>
<p>IndexFile的结构类似HashMap：</p>
<p>1.<strong>Slot槽位</strong>（500万个）：存储相同hash值的Index条目链表头</p>
<p>2.<strong>Index条目</strong>（2000万条）：包含Key的hash值、CommitLog偏移量、时间差等信息</p>
<p>当写入消息时：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 索引构建过程简化示意</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">buildIndex</span><span class="hljs-params">(Message message)</span> </span>{
    <span class="hljs-comment">// 计算Key的hash值</span>
    <span class="hljs-type">int</span> hash = <span class="hljs-built_in">hash</span>(message.<span class="hljs-built_in">getKey</span>());
    <span class="hljs-comment">// 定位到对应的Slot槽位</span>
    <span class="hljs-type">int</span> slotPos = hash % slotNum;
    <span class="hljs-comment">// 在Index区域追加新条目</span>
    indexFile.<span class="hljs-built_in">addEntry</span>(hash, message.<span class="hljs-built_in">getCommitLogOffset</span>());
}
</code></pre>
<p>查询时通过两次查找快速定位：</p>
<p>1.根据Key的hash值找到Slot槽位</p>
<p>2.遍历Slot对应的链表，比对CommitLog中的实际Key值</p>
<p><strong>性能优化必知</strong>：</p>
<p>•消息体积差异大时，CommitLog仍然保持顺序写，但ConsumeQueue可能出现「稀疏索引」（相邻索引指向的物理位置间隔大）</p>
<p>•生产环境中CommitLog建议放在单独SSD磁盘，ConsumeQueue和IndexFile可放普通磁盘</p>
<p>•遇到消息堆积时，优先检查消费者速度，而不是无脑扩容Broker存储</p>
<p>理解这些底层机制，下次遇到消息查询性能问题或者磁盘IO瓶颈时，就知道该从CommitLog的写入模式还是ConsumeQueue的索引结构入手排查了。</p>
<h3 data-id="heading-9">2.2 数据流转机制</h3>
<p>•生产者写入 CommitLog，生成全局唯一偏移量（PHYOFFSET）​</p>
<p>•后台线程异步构建 ConsumeQueue 索引，同步消息元数据​</p>
<p>•消费者通过 ConsumeQueue 定位 CommitLog 中的消息，避免全量扫描</p>
<p>存储过程全景图</p>
<p>现在把各个模块串起来看消息的生命周期：</p>
<p>1.生产者发送消息到Broker</p>
<p>2.Broker将消息<strong>顺序写入CommitLog</strong></p>
<p>3.<strong>异步线程</strong>同时构建ConsumeQueue和IndexFile</p>
<p>4.消费者通过ConsumeQueue快速定位消息</p>
<p>5.按需查询IndexFile实现消息回溯</p>
<p>整个过程就像图书馆的管理系统：</p>
<p>•CommitLog是藏书库（按入库时间摆放）</p>
<p>•ConsumeQueue是分类目录（按题材/出版社分类）</p>
<p>•IndexFile是检索电脑（支持按书名/作者查询）</p>
<h3 data-id="heading-10">2.4 设计优势</h3>
<p>•读写分离：CommitLog 仅负责写入，ConsumeQueue 负责查询，提升并发性能​</p>
<p>•事务支持：通过 CommitLog 中的事务状态标记 + 回查机制，实现分布式事务消息​</p>
<p>•刷盘策略：支持「异步刷盘（高吞吐）」「同步刷盘（金融级可靠性）」动态切换</p>
<h2 data-id="heading-11">三、JMQ存储架构</h2>
<p>JMQ的消息存储分别参考了Kafka和RocketMQ存储设计上优点，并根据京东内部的应用场景进行了改进和创新。</p>
<h3 data-id="heading-12">3.1 核心存储模型：分区日志 + 队列兼容</h3>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a21373cfdec641a1a018091772364676~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=y1zpUofNrEQ29l88DvaPjAVhtyM%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>JMQ</strong>存储的基本单元是PartitionGroup。在同一个Broker上，每个PartitionGroup对应一组消息文件（Journal Files），顺序存放这个Topic的消息。</p>
<p>与Kafka类似，每个Topic包含若干Partition，每个Partition对应一组索引文件（Index Files），索引中存放消息在消息文件中的位置和消息长度。消息写入时，收到的消息按照对应的PartitionGroup写入依次追加写入消息文件中，然后异步创建索引并写入对应Partition的索引文件中。</p>
<p>以PartionGroup为基本存储单元的设计，在兼顾灵活性的同时，具有较好的性能，并且单个PartitionGroup可以支持更多的并发。</p>
<h3 data-id="heading-13">3.2 消息读/写过程</h3>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d132fb626919447fab474b3af46736ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=Zge44lNTYY1PMz17o%2F%2FqySdyaRQ%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>写消息：</strong></p>
<p>JMQ的写操作使用DirectBuffer作为缓存，数据先写入DirectBuffer，再异步通过FileChannel写入到文件中。</p>
<p>•消息写入DirectBuffer后，默认写入该节点成功（数据的高可靠是通过Raft协议复制，用多个内存副本来保证），相对Kafka的写操作来看，JMQ响应写入请求的处理过程没有发生系统调用，在京东内部的大量单条同步发送的场景下开销更低、性能更优。</p>
<p>•同时也避免使用MappedByteBuffer（Mmap方式）产生Page Fault中断，OS在中断中将该页对应磁盘中的数据拷贝到内存中，在对文件进行追加写入的情况下，这一无法避免的过程是完全没有必要，反而增加了写入的耗时的问题。</p>
<p><strong>读消息：</strong></p>
<p>JMQ采用定长稠密索引设计，每个索引固定长度。</p>
<p>•定长设计的好处是，直接根据索引序号就可以计算出索引在文件中的位置：索引位置 = 索引序号 * 索引长度。这样，消息的查找过程就比较简单了，首先计算出索引所在的位置，直接读取索引，然后根据索引中记录的消息位置读取消息。</p>
<p>•在京东内部应用场景中，单条消息处理耗时高是比较常见的，微服务架构下用户一般会申请更多的消费节点，让每个消费节点单次拉取较小批量的消息进行处理，以提升消费并行度，这样消费拉取请求的次数会比较多，稠密索引的设计会更适用内部的应用场景。</p>
<p>JMQ消费读操作99%以上都能命中缓存（JMQ设计的堆外内存与文件映射的一种缓存机制），避免了Kafka可能遇到的Cache被污染，影响性能和吞吐的问题。同时直接读内存也规避了RocketMQ在读取消息存储的日志数据文件时容易产生较多的随机访问读取磁盘，影响性能的问题。（当没有命中缓存时，会默认降级为通过Mmap的方式读取消息）。</p>
<h2 data-id="heading-14">四、竞品对比分析</h2>













































<table><thead><tr><th>﻿</th><th><strong>JMQ</strong></th><th><strong>Kafka</strong></th></tr></thead><tbody><tr><td><strong>存储模型</strong></td><td>以<strong>PartitionGroup</strong>为基本存储单元，支持高并发写入</td><td>以<strong>Partition</strong>为基本存储单元，支持灵活的数据复制和迁移</td></tr><tr><td><strong>消息写入性能</strong></td><td>- 单副本异步写入性能与 Kafka 相当 - 三副本异步写入性能优于 Kafka</td><td>- 单副本异步写入性能与 JMQ 相当 - 三副本异步写入性能略低于 JMQ</td></tr><tr><td><strong>同步写入性能</strong></td><td>- 同步写入性能稳定，几乎不受网络延迟影响</td><td>- 同步写入性能受网络延迟影响较大，稳定性略逊于 JMQ</td></tr><tr><td><strong>多分区性能</strong></td><td>- 多分区异步写入性能与 Kafka 相当 - 同步写入性能略低于 Kafka</td><td>- 多分区同步写入性能更稳定，适合高并发场景</td></tr><tr><td><strong>副本机制</strong></td><td>支持异步复制，副本间数据同步性能较好</td><td>支持异步和同步复制，副本机制成熟，适合复杂部署</td></tr><tr><td><strong>跨机房部署</strong></td><td>- 同步写入性能基本不受影响 - 异步写入性能下降</td><td>- 同步写入性能受网络延迟影响较大 - 异步写入性能下降</td></tr><tr><td><strong>适用场景</strong></td><td>- 对同步写入性能要求高 - 副本异步吞吐要求高 - 大规模微服务集群</td><td>- 复杂分区的高并发同步写入 - 大规模分布式系统 - 多语言生态支持丰富</td></tr></tbody></table>
<p>在单副本场景下，JMQ与Kafka的单机写入性能均十分出色，均可达到网络带宽上限。</p>
<p>然而，在更贴近生产环境的三副本场景中，两者特性出现分化：</p>
<p><strong>JMQ在三副本异步写入下的极限吞吐优势明显，且在跨机房部署时，其同步写入性能表现良好，几乎不受网络延迟影响；而Kafka则在多分区同步写入场景下展现出更稳定的性能，衰减小于JMQ。在大部分异步吞吐场景及不同消息体下的性能趋势上，两者表现相当。</strong></p>
<p>综上所述，JMQ尤其适合对同步写入性能和副本异步吞吐有极高要求的场景，而Kafka在复杂分区的高并发同步写入方面适应性更广。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多线程的这9种用途，99%的人不知道！]]></title>    <link>https://juejin.cn/post/7598830215259799588</link>    <guid>https://juejin.cn/post/7598830215259799588</guid>    <pubDate>2026-01-26T03:55:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598830215259799588" data-draft-id="7598830215259766820" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多线程的这9种用途，99%的人不知道！"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T03:55:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多线程的这9种用途，99%的人不知道！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:55:06.000Z" title="Mon Jan 26 2026 03:55:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>并发编程是一项非常重要的技术，无论在面试，还是工作中出现的频率非常高。</p>
<p>之前我发表的一篇《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247492962%26idx%3D1%26sn%3D17ed1d2ed950b4e9160218b296d19d4e%26chksm%3Dc0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082%26token%3D245805875%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247492962&amp;idx=1&amp;sn=17ed1d2ed950b4e9160218b296d19d4e&amp;chksm=c0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082&amp;token=245805875&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">聊聊并发编程的10个坑</a>》，在全网广受好评。说明了这类文章还是比较有价值的，接下来，打算继续聊聊并发编程这个话题。</p>
<p>并发编程说白了就是多线程编程，但多线程一定比单线程效率更高？</p>
<p>答：不一定，要看具体业务场景。</p>
<p>毕竟如果使用了多线程，那么线程之间的竞争和抢占cpu资源，线程的上下文切换，也是相对来说比较耗时的操作。</p>
<p>下面这几个问题在面试中，你必定遇到过：</p>
<ol>
<li>你在哪来业务场景中使用过多线程？</li>
<li>怎么用的？</li>
<li>踩过哪些坑？</li>
</ol>
<p>今天聊聊我之前在项目中用并发编程的12种业务场景，给有需要的朋友一个参考。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c1cdd0696df47feb415bb55e04c26fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=AX22MWpmhHkaa4S1zqLEkUSOTVI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">1. 简单定时任务</h2>
<p>各位亲爱的朋友，你没看错，<code>Thread</code>类真的能做定时任务。如果你看过一些<code>定时任务框架</code>的源码，你最后会发现，它们的底层也会使用Thread类。</p>
<p>实现这种定时任务的具体代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">try</span> {
                System.out.println(<span class="hljs-string">"下载文件"</span>);
                Thread.sleep(<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">5</span>);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(e);
            }
        }
    }).start();
}
</code></pre>
<p>使用Thread类可以做最简单的定时任务，在run方法中有个while的死循环（当然还有其他方式），执行我们自己的任务。有个需要特别注意的地方是，需要用<code>try...catch</code>捕获异常，否则如果出现异常，就直接退出循环，下次将无法继续执行了。</p>
<p>但这种方式做的定时任务，只能周期性执行，不能支持定时在某个时间点执行。</p>
<p>特别提醒一下，该线程建议定义成<code>守护线程</code>，可以通过<code>setDaemon</code>方法设置，让它在后台默默执行就好。</p>
<p>使用场景：比如项目中有时需要每隔5分钟去<code>下载某个文件</code>，或者每隔10分钟去读取模板文件<code>生成静态html页面</code>等等，一些简单的周期性任务场景。</p>
<p>使用<code>Thread</code>类做定时任务的优缺点：</p>
<ul>
<li>
<p>优点：这种定时任务非常简单，学习成本低，容易入手，对于那些简单的周期性任务，是个不错的选择。</p>
</li>
<li>
<p>缺点：不支持指定某个时间点执行任务，不支持延迟执行等操作，功能过于单一，无法应对一些较为复杂的场景。</p>
</li>
</ul>
<h2 data-id="heading-2">2.监听器</h2>
<p>有时候，我们需要写个监听器，去监听某些数据的变化。</p>
<p>比如：我们在使用<code>canal</code>的时候，需要监听<code>binlog</code>的变化，能够及时把数据库中的数据，同步到另外一个业务数据库中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/affe454823004309bd1f1dbe03a9554b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=EXteLiBSOsZaDIQQK6wQ8MkAH94%3D" alt="" loading="lazy"/>
如果直接写一个监听器去监听数据就太没意思了，我们想实现这样一个功能：在配置中心有个开关，配置监听器是否开启，如果开启了使用单线程异步执行。</p>
<p>主要代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> CanalService {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> Thread thread;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CanalConnector canalConnector;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">//连接canal</span>
        <span class="hljs-keyword">while</span>(running) {
           <span class="hljs-comment">//业务处理</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
       thread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-built_in">this</span>::handle, <span class="hljs-string">"name"</span>);
       running = <span class="hljs-literal">true</span>;
       thread.start();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {
       <span class="hljs-keyword">if</span>(!running) {
          <span class="hljs-keyword">return</span>;
       }
       running = <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<p>在start方法中开启了一个线程，在该线程中异步执行handle方法的具体任务。然后通过调用stop方法，可以停止该线程。</p>
<p>其中，使用<code>volatile</code>关键字控制的running变量作为开关，它可以控制线程中的状态。</p>
<p>接下来，有个比较关键的点是：如何通过配置中心的配置，控制这个开关呢？</p>
<p>以<code>apollo</code>配置为例，我们在配置中心的后台，修改配置之后，自动获取最新配置的核心代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CanalConfig</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CanalService canalService;

    <span class="hljs-meta">@ApolloConfigChangeListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">(ConfigChangeEvent event)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> event.getChange(<span class="hljs-string">"test.canal.enable"</span>).getNewValue();
        <span class="hljs-keyword">if</span>(BooleanUtils.toBoolean(value)) {
            canalService.start();
        } <span class="hljs-keyword">else</span> {
            canalService.stop();
        }
    }
}
</code></pre>
<p>通过<code>apollo</code>的<code>ApolloConfigChangeListener</code>注解，可以监听配置参数的变化。</p>
<p>如果<code>test.canal.enable</code>开关配置的true，则调用canalService类的start方法开启canal数据同步功能。如果开关配置的false，则调用canalService类的stop方法，自动停止canal数据同步功能。</p>
<h2 data-id="heading-3">3.收集日志</h2>
<p>在某些高并发的场景中，我们需要收集部分用户的日志（比如：用户登录的日志），写到数据库中，以便于做分析。</p>
<p>但由于项目中，还没有引入消息中间件，比如：<code>kafka</code>、<code>rocketmq</code>等。</p>
<p>如果直接将日志同步写入数据库，可能会影响接口性能。</p>
<p>所以，大家很自然想到了异步处理。</p>
<p>实现这个需求最简单的做法是，开启一个线程，异步写入数据到数据库即可。</p>
<p>这样做，可以是可以。</p>
<p>但如果用户登录操作的耗时，比异步写入数据库的时间要少得多。这样导致的结果是：生产日志的速度，比消费日志的速度要快得多，最终的性能瓶颈在消费端。</p>
<p>其实，还有更优雅的处理方式，虽说没有使用消息中间件，但借用了它的思想。</p>
<p>这套记录登录日志的功能，分为：日志生产端、日志存储端和日志消费端。</p>
<p>如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d39d5d0bdd84f22ac94821a4c7f3dc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=2MIfQwu%2FLeEcPguNAUjA8AQwuhw%3D" alt="" loading="lazy"/></p>
<p>先定义了一个阻塞队列。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginLogQueue</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_MAX_SIZE</span>    <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-type">BlockingQueueblockingQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(QUEUE_MAX_SIZE);

    <span class="hljs-comment">//生成消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">push</span><span class="hljs-params">(LoginLog loginLog)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.queue.add(loginLog);
    } 

    <span class="hljs-comment">//消费消息</span>
    <span class="hljs-keyword">public</span> LoginLog <span class="hljs-title function_">poll</span><span class="hljs-params">()</span> {
        <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            loginLog = <span class="hljs-built_in">this</span>.queue.take();
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p>然后定义了一个日志的生产者。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginSerivce</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LoginLogQueue loginLogQueue;

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">login</span><span class="hljs-params">(UserInfo userInfo)</span> {
        <span class="hljs-comment">//业务处理</span>
        <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> convert(userInfo);
        loginLogQueue.push(loginLog);
    }  
}
</code></pre>
<p>接下来，定义了日志的消费者。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInfoConsumer</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LoginLogQueue queue;

    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> voit init {
       <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
          <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
              <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> queue.take();
              <span class="hljs-comment">//写入数据库</span>
          }
        }).start();
    }
}
</code></pre>
<p>当然，这个例子中使用单线程接收登录日志，为了提升性能，也可以使用线程池来处理业务逻辑（比如：写入数据库）等。</p>
<h2 data-id="heading-4">4.excel导入</h2>
<p>我们可能会经常收到运营同学提过来的excel数据导入需求，比如：将某一大类下的所有子类一次性导入系统，或者导入一批新的供应商数据等等。</p>
<p>我们以导入供应商数据为例，它所涉及的业务流程很长，比如：</p>
<ol>
<li>调用天眼查接口校验企业名称和统一社会信用代码。</li>
<li>写入供应商基本表</li>
<li>写入组织表</li>
<li>给供应商自动创建一个用户</li>
<li>给该用户分配权限</li>
<li>自定义域名</li>
<li>发站内通知</li>
</ol>
<p>等等。</p>
<p>如果在程序中，解析完excel，读取了所有数据之后。用单线程一条条处理业务逻辑，可能耗时会非常长。</p>
<p>为了提升excel数据导入效率，非常有必要使用多线程来处理。</p>
<p>当然在java中实现多线程的手段有很多种，下面重点聊聊java8中最简单的实现方式：<code>parallelStream</code>。</p>
<p>伪代码如下：</p>
<pre><code class="hljs language-java" lang="java">supplierList.parallelStream().forEach(x -&gt; importSupplier(x));
</code></pre>
<p><code>parallelStream</code>是一个并行执行的流，它默认通过<code>ForkJoinPool</code>实现的，能提高你的多线程任务的速度。</p>
<p><code>ForkJoinPool</code>处理的过程会分而治之，它的核心思想是：<code>将一个大任务切分成多个小任务</code>。每个小任务都能单独执行，最后它会把所用任务的执行结果进行汇总。</p>
<p>下面用一张图简单介绍一下ForkJoinPool的原理：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49631443b7274584a83313137ae2e2bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=CuRx6HVWAQ%2FvsDml1HdJam2pssk%3D" alt="" loading="lazy"/></p>
<p>当然除了excel导入之外，还有类似的读取文本文件，也可以用类似的方法处理。</p>
<blockquote>
<p>温馨的提醒一下，如果一次性导入的数据非常多，用多线程处理，可能会使系统的cpu使用率飙升，需要特别关注。</p>
</blockquote>
<h2 data-id="heading-5">5.查询接口</h2>
<p>很多时候，我们需要在某个查询接口中，调用其他服务的接口，组合数据之后，一起返回。</p>
<p>比如有这样的业务场景：</p>
<p>在用户信息查询接口中需要返回：用户名称、性别、等级、头像、积分、成长值等信息。</p>
<p>而用户名称、性别、等级、头像在用户服务中，积分在积分服务中，成长值在成长值服务中。为了汇总这些数据统一返回，需要另外提供一个对外接口服务。</p>
<p>于是，用户信息查询接口需要调用用户查询接口、积分查询接口 和 成长值查询接口，然后汇总数据统一返回。</p>
<p>调用过程如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93aa59a74685455d910fc6962f8bdebe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=fn66NGI9o5afFQLpZ01x%2FXUUb4w%3D" alt="" loading="lazy"/></p>
<p>调用远程接口总耗时 530ms = 200ms + 150ms + 180ms</p>
<p>显然这种串行调用远程接口性能是非常不好的，调用远程接口总的耗时为所有的远程接口耗时之和。</p>
<p>那么如何优化远程接口性能呢？</p>
<p>既然串行调用多个远程接口性能很差，为什么不改成并行呢？</p>
<p>如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65e3ef20c3e04cf98491af9f56fccd28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=RA%2BTjzT%2B%2B0M16pTzvadZicSwHSg%3D" alt="" loading="lazy"/></p>
<p>调用远程接口总耗时 200ms = 200ms（即耗时最长的那次远程接口调用）</p>
<p>在java8之前可以通过实现<code>Callable</code>接口，获取线程返回结果。</p>
<p>java8以后通过<code>CompleteFuture</code>类实现该功能。我们这里以CompleteFuture为例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> UserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException {
    <span class="hljs-keyword">final</span> <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();
    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">userFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteUserAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);

    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">bonusFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteBonusAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);

    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">growthFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteGrowthAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);
    CompletableFuture.allOf(userFuture, bonusFuture, growthFuture).join();

    userFuture.get();
    bonusFuture.get();
    growthFuture.get();
    <span class="hljs-keyword">return</span> userInfo;
}
</code></pre>
<p>温馨提醒一下，这两种方式别忘了使用<code>线程池</code>。示例中我用到了<code>executor</code>，表示自定义的线程池，为了防止高并发场景下，出现线程过多的问题。</p>
<h2 data-id="heading-6">6.获取用户上下文</h2>
<p>不知道你在项目开发时，有没有遇到过这样的需求：用户登录之后，在所有的请求接口中，通过某个公共方法，就能获取到当前登录用户的信息？</p>
<p>获取的用户上下文，我们以<code>CurrentUser</code>为例。</p>
<p><code>CurrentUser</code>内部包含了一个<code>ThreadLocal</code>对象，它负责保存当前线程的用户上下文信息。当然为了保证在线程池中，也能从用户上下文中获取到正确的用户信息，这里用了阿里的<code>TransmittableThreadLocal</code>。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUser</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TransmittableThreadLocal&lt;CurrentUser&gt; THREA_LOCAL = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();
    
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String userName;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> String phone;
    ...
    
    <span class="hljs-keyword">public</span> statis <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(CurrentUser user)</span> {
      THREA_LOCAL.set(user);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getCurrent</span><span class="hljs-params">()</span> {
      <span class="hljs-keyword">return</span> THREA_LOCAL.get();
    }
}
</code></pre>
<p>这里为什么用了阿里的TransmittableThreadLocal，而不是普通的ThreadLocal呢？在线程池中，由于线程会被多次复用，导致从普通的ThreadLocal中无法获取正确的用户信息。父线程中的参数，没法传递给子线程，而TransmittableThreadLocal很好解决了这个问题。</p>
<p>然后在项目中定义一个全局的spring mvc拦截器，专门设置用户上下文到ThreadLocal中。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HandlerInterceptorAdapter</span> {
   
   <span class="hljs-meta">@Override</span>  
   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
      <span class="hljs-type">CurrentUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getUser(request);
      <span class="hljs-keyword">if</span>(Objects.nonNull(user)) {
         CurrentUser.set(user);
      }
   } 
}
</code></pre>
<p>用户在请求我们接口时，会先触发该拦截器，它会根据用户cookie中的token，调用调用接口获取redis中的用户信息。如果能获取到，说明用户已经登录，则把用户信息设置到CurrentUser类的ThreadLocal中。</p>
<p>接下来，在api服务的下层，即business层的方法中，就能轻松通过CurrentUser.getCurrent();方法获取到想要的用户上下文信息了。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/716f8f50a1534db785a2eba41e4c6c7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=S5WovHiVYbFMen3cheAMaJqlg34%3D" alt="" loading="lazy"/></p>
<p>这套用户体系的想法是很good的，但深入使用后，发现了一个小插曲：</p>
<p>api服务和mq消费者服务都引用了business层，business层中的方法两个服务都能直接调用。</p>
<p>我们都知道在api服务中用户是需要登录的，而mq消费者服务则不需要登录。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44e766b9bfed43ae8af0be092bc68b08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=TyvbIs6k9SghVb969pPlwFCzLS4%3D" alt="" loading="lazy"/></p>
<p>如果business中的某个方法刚开始是给api开发的，在方法深处使用了CurrentUser.getCurrent();获取用户上下文。但后来，某位新来的帅哥在mq消费者中也调用了那个方法，并未发觉这个小机关，就会中招，出现找不到用户上下文的问题。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bcfc398c332429b8cc072d2c57038e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=Tqbw%2Fwb6NDWB2uzo19h1BEHljiE%3D" alt="" loading="lazy"/></p>
<p>所以我当时的第一个想法是：代码没做兼容处理，因为之前这类问题偶尔会发生一次。</p>
<p>想要解决这个问题，其实也很简单。只需先判断一下能否从CurrentUser中获取用户信息，如果不能，则取配置的系统用户信息。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> BusinessConfig businessConfig;

<span class="hljs-type">CurrentUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> CurrentUser.getCurrent();
<span class="hljs-keyword">if</span>(Objects.nonNull(user)) {
   entity.setUserId(user.getUserId());
   entity.setUserName(user.getUserName());
} <span class="hljs-keyword">else</span> {
   entity.setUserId(businessConfig.getDefaultUserId());
   entity.setUserName(businessConfig.getDefaultUserName());
}
</code></pre>
<p>这种简单无公害的代码，如果只是在一两个地方加还OK。</p>
<p>此外，众所周知，<code>SimpleDateFormat</code>在java8以前，是用来处理时间的工具类，它是非线程安全的。也就是说，用该方法解析日期会有线程安全问题。</p>
<p>为了避免线程安全问题的出现，我们可以把SimpleDateFormat对象定义成<code>局部变量</code>。但如果你一定要把它定义成静态变量，可以使用ThreadLocal保存日期，也能解决线程安全问题。</p>
<h2 data-id="heading-7">8. 传递参数</h2>
<p>之前见过有些同事写代码时，一个非常有趣的用法，即：使用<code>MDC</code>传递参数。</p>
<p>MDC是什么？</p>
<p><code>MDC</code>是<code>org.slf4j</code>包下的一个类，它的全称是<code>Mapped Diagnostic Context</code>，我们可以认为它是一个线程安全的存放诊断日志的容器。</p>
<p><code>MDC</code>的底层是用了<code>ThreadLocal</code>来保存数据的。</p>
<p>例如现在有这样一种场景：我们使用<code>RestTemplate</code>调用远程接口时，有时需要在<code>header</code>中传递信息，比如：traceId，source等，便于在查询日志时能够串联一次完整的请求链路，快速定位问题。</p>
<p>这种业务场景就能通过<code>ClientHttpRequestInterceptor</code>接口实现，具体做法如下：</p>
<p>第一步，定义一个LogFilter拦截所有接口请求，在MDC中设置traceId：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException {
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException {
        MdcUtil.add(UUID.randomUUID().toString());
        System.out.println(<span class="hljs-string">"记录请求日志"</span>);
        chain.doFilter(request, response);
        System.out.println(<span class="hljs-string">"记录响应日志"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
    }
}
</code></pre>
<p>第二步，实现<code>ClientHttpRequestInterceptor</code>接口，MDC中获取当前请求的traceId，然后设置到header中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestTemplateInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClientHttpRequestInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ClientHttpResponse <span class="hljs-title function_">intercept</span><span class="hljs-params">(HttpRequest request, <span class="hljs-type">byte</span>[] body, ClientHttpRequestExecution execution)</span> <span class="hljs-keyword">throws</span> IOException {
        request.getHeaders().set(<span class="hljs-string">"traceId"</span>, MdcUtil.get());
        <span class="hljs-keyword">return</span> execution.execute(request, body);
    }
}
</code></pre>
<p>第三步，定义配置类，配置上面定义的RestTemplateInterceptor类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestTemplateConfiguration</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">restTemplate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
        restTemplate.setInterceptors(Collections.singletonList(restTemplateInterceptor()));
        <span class="hljs-keyword">return</span> restTemplate;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestTemplateInterceptor <span class="hljs-title function_">restTemplateInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplateInterceptor</span>();
    }
}
</code></pre>
<p>其中MdcUtil其实是利用MDC工具在<code>ThreadLocal</code>中存储和获取traceId</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MdcUtil</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TRACE_ID</span> <span class="hljs-operator">=</span> <span class="hljs-string">"TRACE_ID"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> MDC.get(TRACE_ID);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String value)</span> {
        MDC.put(TRACE_ID, value);
    }
}
</code></pre>
<p>当然，这个例子中没有演示MdcUtil类的add方法具体调的地方，我们可以在<code>filter</code>中执行接口方法之前，生成traceId，调用MdcUtil类的add方法添加到MDC中，然后在同一个请求的其他地方就能通过MdcUtil类的get方法获取到该traceId。</p>
<p>能使用MDC保存traceId等参数的根本原因是，用户请求到应用服务器，<code>Tomcat</code>会从线程池中分配一个线程去处理该请求。</p>
<p>那么该请求的整个过程中，保存到<code>MDC</code>的<code>ThreadLocal</code>中的参数，也是该线程独享的，所以不会有线程安全问题。</p>
<h2 data-id="heading-8">9. 模拟高并发</h2>
<p>有时候我们写的接口，在低并发的场景下，一点问题都没有。</p>
<p>但如果一旦出现高并发调用，该接口可能会出现一些意想不到的问题。</p>
<p>为了防止类似的事情发生，一般在项目上线前，我们非常有必要对接口做一下<code>压力测试</code>。</p>
<p>当然，现在已经有比较成熟的压力测试工具，比如：<code>Jmeter</code>、<code>LoadRunner</code>等。</p>
<p>如果你觉得下载压测工具比较麻烦，也可以手写一个简单的模拟并发操作的工具，用<code>CountDownLatch</code>就能实现，例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">concurrenceTest</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">/**
     * 模拟高并发情况代码
     */</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">atomicInteger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 相当于计数器，当所有都准备好了，再一起执行，模仿多并发，保证并发量</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 保证所有线程执行完了再打印atomicInteger的值</span>
    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            executorService.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                    <span class="hljs-keyword">try</span> {
                        countDownLatch.await(); <span class="hljs-comment">//一直阻塞当前线程，直到计时器的值为0,保证同时并发</span>
                    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                        log.error(e.getMessage(),e);
                    }
                    <span class="hljs-comment">//每个线程增加1000次，每次加1</span>
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                        atomicInteger.incrementAndGet();
                    }
                    countDownLatch2.countDown();
                }
            });
            countDownLatch.countDown();
        }

        countDownLatch2.await();<span class="hljs-comment">// 保证所有线程执行完</span>
        executorService.shutdown();
    } <span class="hljs-keyword">catch</span> (Exception e){
        log.error(e.getMessage(),e);
    }
}
</code></pre>
<h2 data-id="heading-9">10. 处理mq消息</h2>
<p>在高并发的场景中，消息积压问题，可以说如影随形，真的没办法从根本上解决。表面上看，已经解决了，但后面不知道什么时候，就会冒出一次，比如这次：</p>
<p>有天下午，产品过来说：有几个商户投诉过来了，他们说菜品有延迟，快查一下原因。</p>
<p>这次问题出现得有点奇怪。</p>
<p>为什么这么说？</p>
<p>首先这个时间点就有点奇怪，平常出问题，不都是中午或者晚上用餐高峰期吗？怎么这次问题出现在下午？</p>
<p>根据以往积累的经验，我直接看了<code>kafka</code>的<code>topic</code>的数据，果然上面消息有积压，但这次每个<code>partition</code>都积压了十几万的消息没有消费，比以往加压的消息数量增加了几百倍。这次消息积压得极不寻常。</p>
<p>我赶紧查服务监控看看消费者挂了没，还好没挂。又查服务日志没有发现异常。这时我有点迷茫，碰运气问了问订单组下午发生了什么事情没？他们说下午有个促销活动，跑了一个<code>JOB</code>批量更新过有些商户的订单信息。</p>
<p>这时，我一下子如梦初醒，是他们在JOB中批量发消息导致的问题。怎么没有通知我们呢？实在太坑了。</p>
<p>虽说知道问题的原因了，倒是眼前积压的这十几万的消息该如何处理呢？</p>
<p>此时，如果直接调大<code>partition</code>数量是不行的，历史消息已经存储到<code>4</code>个固定的partition，只有新增的消息才会到新的partition。我们重点需要处理的是已有的partition。</p>
<p>直接加服务节点也不行，因为<code>kafka</code>允许同组的多个<code>partition</code>被一个<code>consumer</code>消费，但不允许一个partition被同组的多个consumer消费，可能会造成资源浪费。</p>
<p>看来只有用<code>多线程</code>处理了。</p>
<p>为了紧急解决问题，我改成了用线程池处理消息，核心线程和最大线程数都配置成了<code>50</code>。</p>
<p>大致用法如下：</p>
<ol>
<li>先定义一个线程池：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolConfig</span> {

    <span class="hljs-meta">@Value("${thread.pool.corePoolSize:5}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> corePoolSize;

    <span class="hljs-meta">@Value("${thread.pool.maxPoolSize:10}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxPoolSize;

    <span class="hljs-meta">@Value("${thread.pool.queueCapacity:200}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> queueCapacity;

    <span class="hljs-meta">@Value("${thread.pool.keepAliveSeconds:30}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> keepAliveSeconds;

    <span class="hljs-meta">@Value("${thread.pool.threadNamePrefix:ASYNC_}")</span>
    <span class="hljs-keyword">private</span> String threadNamePrefix;

    <span class="hljs-meta">@Bean("messageExecutor")</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">messageExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(corePoolSize);
        executor.setMaxPoolSize(maxPoolSize);
        executor.setQueueCapacity(queueCapacity);
        executor.setKeepAliveSeconds(keepAliveSeconds);
        executor.setThreadNamePrefix(threadNamePrefix);
        executor.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());
        executor.initialize();
        <span class="hljs-keyword">return</span> executor;
    }
}
</code></pre>
<ol start="2">
<li>再定义一个消息的consumer：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConsumerService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Executor messageExecutor;
    
    <span class="hljs-meta">@KafkaListener(id="test",topics={"topic-test"})</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listen</span><span class="hljs-params">(String message)</span>{
        System.out.println(<span class="hljs-string">"收到消息："</span> + message);
        messageExecutor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWork</span>(message);
    }
}
</code></pre>
<ol start="3">
<li>在定义的Runable实现类中处理业务逻辑：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWork</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-keyword">private</span> String message;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyWork</span><span class="hljs-params">(String message)</span> {
       <span class="hljs-built_in">this</span>.message = message;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(message);
    }
}
</code></pre>
<p>果然，调整之后消息积压数量确实下降的非常快，大约半小时后，积压的消息就非常顺利的处理完了。</p>
<p>但此时有个更严重的问题出现：我收到了报警邮件，有两个订单系统的节点down机了。。。</p>
<p>更详细内容，请看看我的另一篇文章《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247490289%26idx%3D1%26sn%3Dbc311da9f4a4d3f48ee5dc207bf31a8b%26chksm%3Dc0ebc219f79c4b0fc711116723b9df3a5531cda32f0f5d00f065910aa552af6ff03b3f1528fc%26token%3D751314179%26lang%3Dzh_CN%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247490289&amp;idx=1&amp;sn=bc311da9f4a4d3f48ee5dc207bf31a8b&amp;chksm=c0ebc219f79c4b0fc711116723b9df3a5531cda32f0f5d00f065910aa552af6ff03b3f1528fc&amp;token=751314179&amp;lang=zh_CN&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">我用kafka两年踩过的一些非比寻常的坑</a>》</p>
<h2 data-id="heading-10">11. 统计数量</h2>
<p>在多线程的场景中，有时候需要统计数量，比如：用多线程导入供应商数据时，统计导入成功的供应商数有多少。</p>
<p>如果这时候用count++统计次数，最终的结果可能会不准。因为count++并非原子操作，如果多个线程同时执行该操作，则统计的次数，可能会出现异常。</p>
<p>为了解决这个问题，就需要使用<code>concurent</code>的<code>atomic</code>包下面的类，比如：<code>AtomicInteger</code>、<code>AtomicLong</code>等。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Servcie</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImportSupplierService</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">importSupplier</span><span class="hljs-params">(List&lt;SupplierInfo&gt; supplierList)</span> {
       <span class="hljs-keyword">if</span>(CollectionUtils.isEmpty(supplierList)) {
           <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
       }

       supplierList.parallelStream().forEach(x -&gt; {
           <span class="hljs-keyword">try</span> {
             importSupplier(x);
             count.addAndGet(<span class="hljs-number">1</span>);
           } <span class="hljs-keyword">catch</span>(Exception e) {
              log.error(e.getMessage(),e);
           }
       );

      <span class="hljs-keyword">return</span> count.get();
  }    
}
</code></pre>
<p><code>AtomicInteger</code>的底层说白了使用<code>自旋锁</code>+<code>CAS</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">incrementAndGet</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> get();
        <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> current + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (compareAndSet(current, next))
            <span class="hljs-keyword">return</span> next;
    }
}
</code></pre>
<p><code>自旋锁</code>说白了就是一个<code>死循环</code>。</p>
<p>而<code>CAS</code>是<code>比较</code>和<code>交换</code>的意思。</p>
<p>它的实现逻辑是：将内存位置处的<code>旧值</code>与<code>预期值</code>进行比较，若相等，则将内存位置处的值替换为<code>新值</code>。若不相等，则不做任何操作。</p>
<h2 data-id="heading-11">12. 延迟定时任务</h2>
<p>我们经常有延迟处理数据的需求，比如：如果用户下单后，超过30分钟还未完成支付，则系统自动将该订单取消。</p>
<p>这里需求就可以使用<code>延迟定时任务</code>实现。</p>
<p><code>ScheduledExecutorService</code>是<code>JDK1.5+</code>版本引进的定时任务，该类位于<code>java.util.concurrent</code>并发包下。</p>
<p>ScheduledExecutorService是基于多线程的，设计的初衷是为了解决<code>Timer</code>单线程执行，多个任务之间会互相影响的问题。</p>
<p>它主要包含4个方法：</p>
<ul>
<li>schedule(Runnable command,long delay,TimeUnit unit)，带延迟时间的调度，只执行一次，调度之后可通过Future.get()阻塞直至任务执行完毕。</li>
<li>schedule(Callable callable,long delay,TimeUnit unit)，带延迟时间的调度，只执行一次，调度之后可通过Future.get()阻塞直至任务执行完毕，并且可以获取执行结果。</li>
<li>scheduleAtFixedRate，表示以固定频率执行的任务，如果当前任务耗时较多，超过定时周期period，则当前任务结束后会立即执行。</li>
<li>scheduleWithFixedDelay，表示以固定延时执行任务，延时是相对当前任务结束为起点计算开始时间。</li>
</ul>
<p>实现这种定时任务的具体代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduleExecutorTest</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduledExecutorService</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">5</span>);
        scheduledExecutorService.scheduleAtFixedRate(() -&gt; {
            System.out.println(<span class="hljs-string">"doSomething"</span>);
        },<span class="hljs-number">1000</span>,<span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS);
    }
}
</code></pre>
<p>调用<code>ScheduledExecutorService</code>类的<code>scheduleAtFixedRate</code>方法实现周期性任务，每隔1秒钟执行一次，每次延迟1秒再执行。</p>
<p>这种定时任务是阿里巴巴开发者规范中用来替代<code>Timer</code>类的方案，对于多线程执行周期性任务，是个不错的选择。</p>
<p>使用<code>ScheduledExecutorService</code>类做延迟定时任务的优缺点：</p>
<ul>
<li>
<p>优点：基于多线程的定时任务，多个任务之间不会相关影响，支持周期性的执行任务，并且带延迟功能。</p>
</li>
<li>
<p>缺点：不支持一些较复杂的定时规则。</p>
</li>
</ul>
<p>当然，你也可以使用分布式定时任务，比如：xxl-job或者elastic-job等等。</p>
<p>其实，在实际工作中我使用多线程的场景远远不只这12种，在这里只是抛砖引玉，介绍了一些我认为比较常见的业务场景。</p>
<p>此外，如果你对并发编程中的一些坑，比较感兴趣的话，可以看看我的另一个文章《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247492962%26idx%3D1%26sn%3D17ed1d2ed950b4e9160218b296d19d4e%26chksm%3Dc0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082%26token%3D245805875%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247492962&amp;idx=1&amp;sn=17ed1d2ed950b4e9160218b296d19d4e&amp;chksm=c0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082&amp;token=245805875&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">聊聊并发编程的10个坑</a>》，里面写的非常详细。</p>
<h2 data-id="heading-12">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p>
<p>更多项目实战在我的技术网站：susan.net.cn/project</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[负载均衡实现的算法]]></title>    <link>https://juejin.cn/post/7599550337386004543</link>    <guid>https://juejin.cn/post/7599550337386004543</guid>    <pubDate>2026-01-27T06:53:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599550337386004543" data-draft-id="7599591405313654825" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="负载均衡实现的算法"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T06:53:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三的开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            负载均衡实现的算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三的开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:53:52.000Z" title="Tue Jan 27 2026 06:53:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nacos 本身不直接“实现”负载均衡算法，它是服务注册与发现中心，真正的负载均衡由客户端（如 Spring Cloud LoadBalancer / Ribbon / Dubbo / gRPC / Nginx 等）完成。但在微服务体系中，和 Nacos 搭配使用时，常见的负载均衡算法主要有以下几种：</p>
<hr/>
<h2 data-id="heading-0">一、轮询（Round Robin）</h2>
<p><strong>原理：</strong><br/>
按顺序依次调用每个实例。</p>
<p><strong>特点：</strong></p>
<ul>
<li>简单公平</li>
<li>不考虑实例性能差异</li>
</ul>
<p><strong>适用场景：</strong><br/>
实例配置一致、请求耗时相近。</p>
<hr/>
<h2 data-id="heading-1">二、随机（Random）</h2>
<p><strong>原理：</strong><br/>
从实例列表中随机选一个。</p>
<p><strong>特点：</strong></p>
<ul>
<li>实现简单</li>
<li>在实例数量大时分布较均匀</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、加权轮询（Weighted Round Robin）</h2>
<p><strong>原理：</strong><br/>
按权重比例轮询，性能高的机器分配更多请求。</p>
<p><strong>示例：</strong><br/>
A权重5，B权重1 → 6次请求中A拿5次，B拿1次。</p>
<p><strong>适用：</strong><br/>
不同配置机器混用（如4核和16核）。</p>
<hr/>
<h2 data-id="heading-3">四、加权随机（Weighted Random）</h2>
<p><strong>原理：</strong><br/>
按权重概率随机选择。</p>
<hr/>
<h2 data-id="heading-4">五、最少连接数（Least Connections）</h2>
<p><strong>原理：</strong><br/>
优先选择当前连接数最少的实例。</p>
<p><strong>适用：</strong><br/>
长连接、请求耗时差异大的场景。</p>
<hr/>
<h2 data-id="heading-5">六、一致性 Hash（Consistent Hash）</h2>
<p><strong>原理：</strong><br/>
根据请求参数（如 userId）Hash 到固定实例。</p>
<p><strong>特点：</strong></p>
<ul>
<li>同一用户总是打到同一台机器</li>
<li>扩容时影响面小</li>
</ul>
<p><strong>常见用途：</strong></p>
<ul>
<li>会话粘性</li>
<li>缓存命中率优化</li>
</ul>
<hr/>
<h2 data-id="heading-6">七、基于响应时间的负载均衡</h2>
<p><strong>原理：</strong><br/>
优先选择平均响应时间最短的实例。</p>
<hr/>
<h2 data-id="heading-7">八、Nacos 权重感知 + 健康度感知</h2>
<p>Nacos 会给每个实例维护：</p>
<ul>
<li>权重（weight）</li>
<li>健康状态（healthy）</li>
<li>临时实例 / 持久实例</li>
<li>心跳状态</li>
</ul>
<p>客户端负载均衡器通常会：</p>
<ol>
<li>过滤掉不健康实例</li>
<li>按权重参与算法（轮询 / 随机）</li>
<li>支持动态权重调整（运维可在线改）</li>
</ol>
<hr/>
<h2 data-id="heading-8">Spring Cloud Alibaba 中的对应关系</h2>





























<table><thead><tr><th>算法</th><th>实现类</th></tr></thead><tbody><tr><td>轮询</td><td>RoundRobinLoadBalancer</td></tr><tr><td>随机</td><td>RandomLoadBalancer</td></tr><tr><td>权重</td><td>NacosWeightedRule（Ribbon 时代）</td></tr><tr><td>最少连接</td><td>LeastConnections</td></tr><tr><td>一致性Hash</td><td>ConsistentHashRule</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[B 端工业软件图表优化：让十万级设备数据不再拖慢操作]]></title>    <link>https://juejin.cn/post/7598710324168376335</link>    <guid>https://juejin.cn/post/7598710324168376335</guid>    <pubDate>2026-01-26T02:12:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324168376335" data-draft-id="7565043507125026831" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="B 端工业软件图表优化：让十万级设备数据不再拖慢操作"/> <meta itemprop="keywords" content="前端,ECharts,性能优化"/> <meta itemprop="datePublished" content="2026-01-26T02:12:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秋天的一阵风"/> <meta itemprop="url" content="https://juejin.cn/user/3588413946594925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            B 端工业软件图表优化：让十万级设备数据不再拖慢操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3588413946594925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秋天的一阵风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:12:23.000Z" title="Mon Jan 26 2026 02:12:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p><strong/></p><p align="center"><strong>Hello~大家好。我是秋天的一阵风</strong></p><p/>
<p>在 B 端工业软件开发中，设备参数趋势、能耗分析、质检对比等核心模块均依赖图表可视化，单台设备按 5 秒采集频率，一天数据量即可突破 10 万级。当数据量达到此规模时，传统渲染方式会面临明显性能问题：</p>
<h3 data-id="heading-1">1. 遇到的问题：</h3>
<ul>
<li>图表初始化加载耗时超 1.5 秒，多模块并发打开时更久</li>
</ul>

<ul>
<li>用户交互（拖动时间轴、缩放数据）存在 0.5-0.6 秒延迟</li>
</ul>

<ul>
<li>折线图拖动时出现 “卡顿断连”，影响数据趋势判断</li>
</ul>
<h3 data-id="heading-2">2. 技术挑战：</h3>
<p>如何在保证工业数据趋势完整性（如设备参数波动、异常点捕捉）的前提下，实现 10 万级数据图表的流畅渲染与交互？</p>
<h2 data-id="heading-3">二、解决方案概述</h2>
<p>本文聚焦以下几种 ECharts 适配工业场景的性能优化方案，无需复杂定制开发即可落地：</p>
<ol>
<li>
<p><strong>LTTB 数据降采样（Sampling）</strong> ：智能筛选设备数据中的关键波动点（峰值、谷值、突变点），剔除平稳冗余数据，在不影响趋势判断的前提下，将渲染数据量压缩至原有的 1/25-1/30。</p>
</li>
<li>
<p><strong>DataZoom 区域缩放</strong>：默认只渲染 “最近 24 小时” 等核心时段数据（约 12% 数据量），用户按需缩放时才加载对应时段数据，避免全量渲染浪费资源。</p>
</li>
<li>
<p><strong>large 模式</strong>：ECharts 针对超大数据量（50万级以上）设计的底层渲染优化模式，通过简化绘制逻辑、减少绘制细节来提升渲染效率，适配设备集群海量数据概览场景。</p>
</li>
</ol>
<h2 data-id="heading-4">三、方案详细落地与实测</h2>
<h3 data-id="heading-5">1. 第一招：LTTB 降采样 —— 精准保留工业数据核心趋势</h3>
<p>B 端工业软件对图表的核心需求是 “捕捉设备参数异常波动”，而非展示每一个原始数据点。<code>LTTB（ Largest-Triangle-Three-Bucket ）</code>算法的优势在于，能从 10 万条数据中，优先保留体现趋势变化的 3000-4000 个关键节点（如温度突升点、转速骤降点），剔除数值平稳的冗余数据，既保证工业数据的分析价值，又大幅降低渲染压力。</p>
<h4 data-id="heading-6">核心配置与避坑点：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">series</span>: [{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>, <span class="hljs-comment">// 折线图</span>
  <span class="hljs-attr">data</span>: deviceParamData, <span class="hljs-comment">// 10万条设备原始数据</span>
  <span class="hljs-attr">sampling</span>: <span class="hljs-string">'lttb'</span>, <span class="hljs-comment">// 启用LTTB降采样，优先保留波动点</span>
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'none'</span>, <span class="hljs-comment">// 必加：工业图表无需单个数据点标记，减少DOM渲染</span>
  <span class="hljs-attr">animation</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 必关：工业场景需实时响应，动画会增加0.3秒延迟</span>
  <span class="hljs-attr">emphasis</span>: { <span class="hljs-attr">lineStyle</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">2</span> } } <span class="hljs-comment">// 适配多设备对比，hover时曲线加粗易区分</span>
}]
</code></pre>
<h4 data-id="heading-7">其他采样方式及适用场景</h4>
<ul>
<li><strong>average（平均值采样）</strong> ：功能是将采样区间内的所有数据点取平均值作为采样结果。适用场景：工业能耗统计、设备运行平均参数监控等需要体现整体均值水平的场景，例如按小时统计车间设备平均功率。</li>
<li><strong>max（最大值采样）</strong> ：仅保留采样区间内的最大值作为采样点。适用场景：设备峰值监控，如电机最大负载、锅炉最高温度等关键参数的极值追踪，可快速定位设备运行的峰值时刻。</li>
<li><strong>min（最小值采样）</strong> ：与max相反，保留采样区间内的最小值。适用场景：设备运行下限监控，如冷却系统最低水温、润滑油最低压力等，确保关键参数不低于安全阈值。</li>
<li><strong>sum（求和采样）</strong> ：对采样区间内的数据点进行求和计算作为采样结果。适用场景：工业产量统计、物料消耗累计等需要累加数据的场景，比如按班次统计生产线产品总产量。</li>
</ul>
<h4 data-id="heading-8">实测效果：</h4>
<p>原 10 万条 5 秒级设备参数数据，初始化需 1.9 秒，拖动卡顿；启用 LTTB 后，数据点降至 3500 个，初始化仅需 350 毫秒，交互无延迟，且设备异常波动点 100% 保留，未影响数据分析。</p>
<h3 data-id="heading-9">2. 第二招：DataZoom 区域缩放 —— 适配工业时段化查看习惯</h3>
<p>工业软件用户常按 “生产班次”“单日 / 单周” 查看数据，全量加载全年数据完全无必要。</p>
<p>DataZoom 的核心是 “按需渲染”：默认只加载最近 24 小时数据（约 1.2 万条，占 12%），用户通过滑块或滚轮缩放时，再动态加载对应时段数据，从源头减少渲染数据量。</p>
<h4 data-id="heading-10">核心配置与工业适配：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">dataZoom</span>: [
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'inside'</span>, <span class="hljs-comment">// 支持鼠标滚轮精准缩放，适配工业精细查看需求</span>
    <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">12</span>, <span class="hljs-comment">// 初始显示12%数据（对应1个生产班次）</span>
    <span class="hljs-attr">minValueSpan</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">// 最小缩放300个数据点（对应5分钟工业数据粒度）</span>
    <span class="hljs-attr">filterMode</span>: <span class="hljs-string">'empty'</span> <span class="hljs-comment">// 过滤不可见数据，减少计算负担</span>
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'slider'</span>, <span class="hljs-comment">// 显示滑块，方便定位历史生产时段</span>
    <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">12</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">28</span>,
    <span class="hljs-attr">labelFormatter</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(value).<span class="hljs-title function_">toLocaleTimeString</span>([], { <span class="hljs-attr">hour</span>: <span class="hljs-string">'2-digit'</span>, <span class="hljs-attr">minute</span>: <span class="hljs-string">'2-digit'</span> }) <span class="hljs-comment">// 适配工业时间显示习惯</span>
  }
]
</code></pre>
<h4 data-id="heading-11">适配技巧：</h4>
<p>用<code>requestIdleCallback</code>替代<code>setTimeout</code>初始化图表，避开工业软件 “设备告警”“生产计数” 等核心模块的加载高峰，避免图表与核心功能抢资源导致的延迟。实测显示，此调整可减少 30% 的初始化卡顿概率。</p>
<h3 data-id="heading-12">3. 第三招：large模式——超大数据量渲染的底层优化</h3>
<p>当工业场景需要展示车间所有设备（如50台设备，单台10万条数据，总计500万条）的运行状态概览时，仅靠降采样可能仍存在渲染压力。</p>
<p>large模式是ECharts的底层优化机制，开启后会自动采用 <em><em>“批量绘制”</em> *** “简化路径”</em>* 等策略，减少Canvas绘制的调用次数，同时关闭部分精细渲染效果，在保证整体趋势可见的前提下最大化提升性能。</p>
<h4 data-id="heading-13">核心配置与工业适配案例</h4>
<p>以“车间50台设备温度趋势概览”场景为例，核心配置如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">series</span>: [{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>, <span class="hljs-comment">// 折线图，适配多设备趋势对比</span>
  <span class="hljs-attr">data</span>: multiDeviceTempData, <span class="hljs-comment">// 50台设备总计500万条温度数据</span>
  <span class="hljs-attr">sampling</span>: <span class="hljs-string">'lttb'</span>, <span class="hljs-comment">// 结合降采样进一步压缩数据量</span>
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'none'</span>, <span class="hljs-comment">// 关闭数据点标记，减少绘制负担</span>
  <span class="hljs-attr">animation</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 关闭动画，保障实时交互</span>
  <span class="hljs-attr">large</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用large模式，开启底层渲染优化</span>
  <span class="hljs-attr">largeThreshold</span>: <span class="hljs-number">10000</span>, <span class="hljs-comment">// 阈值设置：数据量超过1万条时触发large模式</span>
  <span class="hljs-attr">lineStyle</span>: {
    <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> <span class="hljs-comment">// 线条宽度设为1px，平衡显示效果与渲染性能</span>
  }
}]
</code></pre>
<h4 data-id="heading-14">关键说明与适用场景</h4>
<ul>
<li><strong>核心功能</strong>：通过合并绘制指令、简化图形路径等底层优化，降低Canvas绘制开销，针对100万级以上数据量效果显著；largeThreshold用于设置触发阈值，可根据场景灵活调整（工业场景建议设5000-20000）。</li>
<li><strong>适用场景</strong>：设备集群运行状态概览（如车间所有设备温度/压力趋势）、全厂能耗总览等“重全局轻局部”的场景，不适用于需要精准查看单个数据点或细微波动的质检分析场景。</li>
<li><strong>搭配技巧</strong>：large模式建议与LTTB降采样组合使用，降采样负责“数据量压缩”，large模式负责“渲染效率优化”，两者结合可处理千万级数据的初步概览展示。</li>
</ul>
<h4 data-id="heading-15">实测效果</h4>
<p>500万条多设备温度数据，仅用LTTB降采样时初始化需1.2秒，拖动有轻微延迟；开启“LTTB+large模式”后，初始化耗时降至520毫秒，拖动、缩放等交互延迟均控制在0.1秒内，且50台设备的温度高低趋势清晰可辨，满足概览监控需求。</p>
<h2 data-id="heading-16">四、统计对比</h2>









































<table><thead><tr><th>优化方案</th><th>单模块渲染点</th><th>单模块初始化耗时</th><th>交互体验</th></tr></thead><tbody><tr><td>无优化</td><td>100,000</td><td>1800ms</td><td>缩放延迟 0.6 秒，切换模块卡顿</td></tr><tr><td>只开 LTTB</td><td>3,500</td><td>350ms</td><td>流畅，多曲线对比无延迟</td></tr><tr><td>只开 DataZoom</td><td>12,000</td><td>280ms</td><td>流畅，放大历史数据稍慢 0.1 秒</td></tr><tr><td>两者一起开</td><td>1,800</td><td>210ms</td><td>缩放、切换模块均无感知延迟</td></tr><tr><td>LTTB+DataZoom+large模式（500万数据）</td><td>10,000</td><td>520ms</td><td>概览流畅，支持快速切换设备集群视图</td></tr></tbody></table>
<h2 data-id="heading-17">五、B 端工业图表避坑指南与优化思路</h2>
<ol>
<li><strong>基础配置必做</strong>：无论哪种方案，<code>animation: false和symbol: 'none'</code>是底线 —— 工业场景无需动画效果，单个数据点标记只会增加 DOM 负担，这两项配置可减少 40% 渲染耗时。</li>
<li><strong>数据粒度协同</strong>：当数据超 50 万条时，需联合后端按 “工业时间粒度预采样”（如按分钟合并数据），前端再二次降采样，若数据超100万条，建议叠加large模式，避免前端处理超大数据量导致的内存占用问题。</li>
<li><strong>交互适配场景</strong>：工业用户多通过鼠标操作，DataZoom 滑块高度设 25-30px，minValueSpan对应实际生产粒度（如 5 分钟 / 1 小时）；开启large模式后，避免开启emphasis等精细交互效果，防止性能回退。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（65）如何在微服务架构中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7599528186587070474</link>    <guid>https://juejin.cn/post/7599528186587070474</guid>    <pubDate>2026-01-26T11:50:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599528186587070474" data-draft-id="7599543345980456987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（65）如何在微服务架构中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T11:50:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（65）如何在微服务架构中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T11:50:39.000Z" title="Mon Jan 26 2026 11:50:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在微服务架构中使用Hibernate涉及多个步骤，包括配置项目依赖、设置数据源、配置Hibernate、定义实体类、创建DAO层、创建服务层、以及编写应用逻辑。每个微服务通常独立部署和运行，其数据库和ORM配置也独立于其他微服务。下面是详细的实现步骤和代码示例。</p>
<h3 data-id="heading-0">1. 项目依赖</h3>
<p>首先，在微服务的构建文件中添加必要的依赖项。例如，如果你使用的是Maven来构建项目，可以在<code>pom.xml</code>中添加以下依赖项：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Hibernate Core --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.32.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- JPA API --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.persistence<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.persistence-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Data JPA if using Spring Boot --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. 配置数据源</h3>
<p>在微服务中配置数据源和Hibernate属性。假设我们使用Spring Boot来简化配置：</p>
<h4 data-id="heading-2"><code>application.properties</code></h4>
<pre><code class="hljs language-properties" lang="properties">spring.datasource.url=jdbc:mysql://localhost:3306/mydatabase
spring.datasource.username=root
spring.datasource.password=rootpassword
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
</code></pre>
<h3 data-id="heading-3">3. 配置Hibernate的SessionFactory</h3>
<p>Spring Boot会自动配置<code>SessionFactory</code>，如果你使用其他框架，可能需要手动配置。</p>
<h3 data-id="heading-4">4. 定义实体类</h3>
<p>定义一个简单的实体类，例如<code>User</code>。</p>
<h4 data-id="heading-5"><code>User.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String password;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> username;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-built_in">this</span>.username = username;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> password;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> {
        <span class="hljs-built_in">this</span>.password = password;
    }
}
</code></pre>
<h3 data-id="heading-6">5. 创建DAO层</h3>
<p>创建一个数据访问对象（DAO）接口和实现类，用于访问数据库。如果使用Spring Data JPA，可以简化为一个接口。</p>
<h4 data-id="heading-7"><code>UserRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;User, Long&gt; {
    User <span class="hljs-title function_">findByUsername</span><span class="hljs-params">(String username)</span>;
}
</code></pre>
<h3 data-id="heading-8">6. 创建服务层</h3>
<p>创建一个服务类，用于处理业务逻辑。</p>
<h4 data-id="heading-9"><code>UserService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository userRepository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserService</span><span class="hljs-params">(UserRepository userRepository)</span> {
        <span class="hljs-built_in">this</span>.userRepository = userRepository;
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">createUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-keyword">return</span> userRepository.save(user);
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> userRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> userRepository.findAll();
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-keyword">return</span> userRepository.save(user);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long id)</span> {
        userRepository.deleteById(id);
    }
}
</code></pre>
<h3 data-id="heading-10">7. 编写控制器</h3>
<p>利用上述服务类来编写RESTful API控制器。</p>
<h4 data-id="heading-11"><code>UserController.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserController</span><span class="hljs-params">(UserService userService)</span> {
        <span class="hljs-built_in">this</span>.userService = userService;
    }

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">createdUser</span> <span class="hljs-operator">=</span> userService.createUser(user);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(createdUser);
    }

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getUserById(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(user);
    }

    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;User&gt;&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        List&lt;User&gt; users = userService.getAllUsers();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(users);
    }

    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;User&gt; <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@RequestBody</span> User user)</span> {
        user.setId(id);
        <span class="hljs-type">User</span> <span class="hljs-variable">updatedUser</span> <span class="hljs-operator">=</span> userService.updateUser(user);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedUser);
    }

    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        userService.deleteUser(id);
        <span class="hljs-keyword">return</span> ResponseEntity.noContent().build();
    }
}
</code></pre>
<h3 data-id="heading-12">总结</h3>
<p>通过上述步骤，我们在微服务架构中使用了Hibernate，配置了数据源，定义了实体类，创建了DAO层和服务层，并编写了RESTful API控制器。这使得每个微服务可以独立地进行数据库操作，实现了完整的CRUD功能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python `__xxattr__` 四大实战模式详解：从代理到 ORM 的魔法之旅]]></title>    <link>https://juejin.cn/post/7599531732337557538</link>    <guid>https://juejin.cn/post/7599531732337557538</guid>    <pubDate>2026-01-26T14:30:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599531732337557538" data-draft-id="7599531732337541154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python `__xxattr__` 四大实战模式详解：从代理到 ORM 的魔法之旅"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-26T14:30:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python `__xxattr__` 四大实战模式详解：从代理到 ORM 的魔法之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T14:30:44.000Z" title="Mon Jan 26 2026 14:30:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关键词：Python、<strong>getattr</strong>、<strong>setattr</strong>、代理模式、延迟加载、属性验证、ORM<br/>
预计阅读：25 min，附完整可运行代码示例</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">0. 前言：为什么你一定要掌握 <code>__xxattr__</code></h2>
<p>在 Python 里，点语法（<code>obj.x</code>）看似平淡无奇，背后却藏着一套可插拔的“钩子”——<br/>
<code>__getattr__</code> / <code>__setattr__</code> / <code>__delattr__</code>。<br/>
它们就像“魔法插槽”，能让你在“属性被触碰”的瞬间植入任意逻辑：查日志、做校验、走网络、懒加载……<br/>
本文用“四大模式”带你把官方文档里干巴巴的定义变成能跑、能改、能上线的产品级代码。</p>
<hr/>
<h2 data-id="heading-1">1. 代理模式（Proxy）：把“转发”玩出花</h2>
<h3 data-id="heading-2">1.1 场景</h3>
<ul>
<li>包装第三方库，隐藏其怪异接口</li>
<li>给所有方法统一加日志、缓存、权限</li>
<li>实现“远程代理”：本地对象 ≈ 远端服务</li>
</ul>
<h3 data-id="heading-3">1.2 最小可运行模板</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span>:
    <span class="hljs-string">"""通用代理：只暴露被代理对象的公共属性（非 _ 开头）"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, target</span>):
        <span class="hljs-comment"># 必须用 super 绕过自身的 __setattr__</span>
        <span class="hljs-built_in">super</span>().__setattr__(<span class="hljs-string">'_target'</span>, target)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'[GET ] <span class="hljs-subst">{name}</span>'</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(self._target, name)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):
        <span class="hljs-keyword">if</span> name.startswith(<span class="hljs-string">'_'</span>):
            <span class="hljs-built_in">super</span>().__setattr__(name, value)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'[SET ] <span class="hljs-subst">{name}</span> = <span class="hljs-subst">{value}</span>'</span>)
            <span class="hljs-built_in">setattr</span>(self._target, name, value)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, name</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'[DEL ] <span class="hljs-subst">{name}</span>'</span>)
        <span class="hljs-built_in">delattr</span>(self._target, name)
</code></pre>
<h3 data-id="heading-4">1.3 使用演示</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Spam</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):      self.x = x
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params">self, y</span>):           <span class="hljs-built_in">print</span>(<span class="hljs-string">'Spam.bar:'</span>, self.x, y)

s = Spam(<span class="hljs-number">2</span>)
p = Proxy(s)

p.x          <span class="hljs-comment"># [GET ] x  → 2</span>
p.x = <span class="hljs-number">37</span>     <span class="hljs-comment"># [SET ] x = 37</span>
p.bar(<span class="hljs-number">3</span>)     <span class="hljs-comment"># [GET ] bar → Spam.bar: 37 3</span>
<span class="hljs-keyword">del</span> p.x      <span class="hljs-comment"># [DEL ] x</span>
</code></pre>
<blockquote>
<p>代理模式在 Python Cookbook 中被官方推荐为“继承的轻量级替代方案”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">2. 属性验证 &amp; 转换：把“赋值”做成管道</h2>
<h3 data-id="heading-6">2.1 需求</h3>
<ul>
<li>类型不对就抛错，而不是运行时崩</li>
<li>自动把字符串转数字、大小写归一化</li>
<li>支持“只读”“不可删除”等语义</li>
</ul>
<h3 data-id="heading-7">2.2 实现：描述符 + <code>__setattr__</code> 双保险</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Schema</span>:
    age     = <span class="hljs-built_in">int</span>
    name    = <span class="hljs-built_in">str</span>
    score   = <span class="hljs-built_in">float</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Validated</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, **kw</span>):
        <span class="hljs-comment"># 真实数据放在 __dict__ 本身，避免递归</span>
        self.__dict__[<span class="hljs-string">'_data'</span>] = {}
        <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> kw.items():
            <span class="hljs-built_in">setattr</span>(self, k, v)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):
        typ = <span class="hljs-built_in">getattr</span>(Schema, name, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">if</span> typ <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">f'未知字段 <span class="hljs-subst">{name}</span>'</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, typ):
            <span class="hljs-keyword">try</span>:
                value = typ(value)
            <span class="hljs-keyword">except</span> (ValueError, TypeError):
                <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f'<span class="hljs-subst">{name}</span> 必须是 <span class="hljs-subst">{typ.__name__}</span>'</span>)
        self._data[name] = value

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name</span>):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> self._data[name]
        <span class="hljs-keyword">except</span> KeyError:
            <span class="hljs-keyword">raise</span> AttributeError(name)

u = Validated(age=<span class="hljs-string">'18'</span>, name=<span class="hljs-string">'bob'</span>, score=<span class="hljs-string">'99.5'</span>)
<span class="hljs-built_in">print</span>(u.age, u.score)      <span class="hljs-comment"># 18 99.5</span>
u.age = <span class="hljs-string">'20'</span>               <span class="hljs-comment"># 自动转 int</span>
</code></pre>
<blockquote>
<p>该技巧在 attrs/cattrs 等库中大量使用，可节省 70% 的样板代码。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">3. 延迟加载（Lazy Loading）：让“昂贵”对象按需出生</h2>
<h3 data-id="heading-9">3.1 典型昂贵资源</h3>
<ul>
<li>大模型文件 / 千万级数据库连接</li>
<li>远程网络客户端（gRPC、REST）</li>
<li>重量级 GUI 组件</li>
</ul>
<h3 data-id="heading-10">3.2 装饰器版（类属性）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">lazy_property</span>(<span class="hljs-params">fn</span>):
    <span class="hljs-string">"""类级别延迟加载，结果缓存到实例"""</span>
    attr_name = <span class="hljs-string">'_lazy_'</span> + fn.__name__
<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_lazy</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">hasattr</span>(self, attr_name):
            <span class="hljs-built_in">setattr</span>(self, attr_name, fn(self))
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(self, attr_name)
    <span class="hljs-keyword">return</span> _lazy

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
<span class="hljs-meta">    @lazy_property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mysql_pool</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'&gt;&gt;&gt; 真正创建 MySQL 连接池 …'</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-string">'MySQLPool(...)'</span>
</code></pre>
<h3 data-id="heading-11">3.3 <code>__getattr__</code> 版（动态模块导入）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyModule</span>:
    <span class="hljs-string">"""访问时才 import，适用于可选依赖"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, item</span>):
        <span class="hljs-keyword">if</span> item == <span class="hljs-string">'pd'</span>:
            <span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
            self.pd = pd
            <span class="hljs-keyword">return</span> pd
        <span class="hljs-keyword">raise</span> AttributeError(item)

lm = LazyModule()
lm.pd.DataFrame()   <span class="hljs-comment"># 此处才首次 import pandas</span>
</code></pre>
<blockquote>
<p>延迟加载能把大型 CLI 工具的启动时间缩短 50% 以上。</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">4. ORM 框架实现：把“行”变成“对象”</h2>
<h3 data-id="heading-13">4.1 核心思想</h3>
<p>表 → 类，行 → 实例，字段 → 属性。<br/>
利用 <code>__getattr__</code> / <code>__setattr__</code> 把对属性的访问翻译成 SQL。</p>
<h3 data-id="heading-14">4.2 最小 ORM（仅依赖 sqlite3）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlite3, threading

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Field</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, typ</span>): self.typ = typ

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelMeta</span>(<span class="hljs-title class_ inherited__">type</span>):
    <span class="hljs-string">"""元类：扫描属性，收集字段"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">mcls, name, bases, ns</span>):
        <span class="hljs-keyword">if</span> name == <span class="hljs-string">'Model'</span>:               <span class="hljs-comment"># 基类本身不做处理</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__new__(mcls, name, bases, ns)
        fields = {k: v <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> ns.items() <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(v, Field)}
        ns[<span class="hljs-string">'_fields'</span>] = fields
        ns[<span class="hljs-string">'_table'</span>] = name.lower()
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__new__(mcls, name, bases, ns)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>(metaclass=ModelMeta):
    db = sqlite3.connect(<span class="hljs-string">'demo.db'</span>, check_same_thread=<span class="hljs-literal">False</span>)
    db_lock = threading.Lock()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, **kw</span>):
        <span class="hljs-comment"># 数据保存在 _row，避免与字段名冲突</span>
        self._row = {}
        <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> kw.items():
            <span class="hljs-built_in">setattr</span>(self, k, v)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, name, value</span>):
        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> self._fields:
            self._row[name] = value
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">super</span>().__setattr__(name, value)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, name</span>):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> self._row[name]
        <span class="hljs-keyword">except</span> KeyError:
            <span class="hljs-keyword">raise</span> AttributeError(name)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">self</span>):
        cols = <span class="hljs-string">', '</span>.join(self._row.keys())
        placeholders = <span class="hljs-string">', '</span>.join([<span class="hljs-string">'?'</span>] * <span class="hljs-built_in">len</span>(self._row))
        sql = <span class="hljs-string">f"INSERT INTO <span class="hljs-subst">{self._table}</span> (<span class="hljs-subst">{cols}</span>) VALUES (<span class="hljs-subst">{placeholders}</span>)"</span>
        <span class="hljs-keyword">with</span> self.db_lock:
            self.db.execute(sql, <span class="hljs-built_in">tuple</span>(self._row.values()))
            self.db.commit()

<span class="hljs-comment"># 定义模型</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">Model</span>):
    <span class="hljs-built_in">id</span>   = Field(<span class="hljs-built_in">int</span>)
    name = Field(<span class="hljs-built_in">str</span>)

<span class="hljs-comment"># 使用</span>
u = User(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>, name=<span class="hljs-string">'kimi'</span>)
u.save()          <span class="hljs-comment"># 真实写入 SQLite</span>
</code></pre>
<blockquote>
<p>大型库如 Django ORM、SQLAlchemy 内部同样依赖 <code>__setattr__</code> 做“脏数据跟踪”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-15">5. 性能陷阱 &amp; 调试锦囊</h2>

























<table><thead><tr><th>问题</th><th>现象</th><th>解决</th></tr></thead><tbody><tr><td>无限递归</td><td><code>RecursionError</code></td><td><code>__setattr__</code> 里用 <code>super()</code> 或直接改 <code>__dict__</code></td></tr><tr><td>性能下降</td><td>属性访问慢 3×</td><td>缓存计算结果、用 <code>__slots__</code> 减少字典开销</td></tr><tr><td>调试困难</td><td>断点进不去</td><td>在钩子内加 <code>print</code> / <code>logging</code>，或临时关闭自定义方法</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-16">6. 一张图总结（Mermaid）</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[__getattr__] --&gt; B[代理模式]
    A --&gt; C[延迟加载]
    D[__setattr__] --&gt; E[属性验证]
    D --&gt; F[ORM 脏跟踪]
    G[__delattr__] --&gt; H[保护只读属性]
</code></pre>
<hr/>
<h2 data-id="heading-17">7. 结语</h2>
<p><code>__xxattr__</code> 不是炫技，而是“把本来要写的 100 个 <code>if</code> / <code>try</code> 藏到语言运行时”。<br/>
掌握这四大模式，你就能：</p>
<ul>
<li>写出“自带文档”的类（代理）</li>
<li>让错误在“赋值瞬间”而不是“运行半小时后”爆掉（验证）</li>
<li>把启动时间从 3 s 降到 300 ms（懒加载）</li>
<li>用 200 行代码写个能跑业务的“迷你 Django”（ORM）</li>
</ul>
<p>下次当你敲下 <code>obj.x = y</code> 时，别忘了：背后有一整块魔法世界，等你去点亮。</p>
<hr/>
<blockquote>
<p>参考资料<br/>
: 《Python 实现类属性的延迟加载装饰器》<br/>
: 《Python 性能优化：懒加载与其他高级技巧》<br/>
: 《Python 使用 attrs 和 cattrs 实现面向对象编程》<br/>
: 《Python3 Cookbook 8.15 属性的代理访问》<br/>
: 《浅谈 Python 的元编程》</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skills使用指南：让AI智能体拥有"即插即用"的超能力]]></title>    <link>https://juejin.cn/post/7599666118007455787</link>    <guid>https://juejin.cn/post/7599666118007455787</guid>    <pubDate>2026-01-27T05:15:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599666118007455787" data-draft-id="7599550337385300031" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skills使用指南：让AI智能体拥有&quot;即插即用&quot;的超能力"/> <meta itemprop="keywords" content="Claude,Agent"/> <meta itemprop="datePublished" content="2026-01-27T05:15:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="奇舞精选"/> <meta itemprop="url" content="https://juejin.cn/user/4388906147515367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skills使用指南：让AI智能体拥有"即插即用"的超能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906147515367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    奇舞精选
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T05:15:26.000Z" title="Tue Jan 27 2026 05:15:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文作者为 360 奇舞团前端开发工程师</p>
</blockquote>
<p>当前的AI智能体就像是一位<strong>拥有超强算力却患有‘短期失忆症’的超级员工</strong>：虽然它能迅速掌握复杂的单次指令，却无法将过往的交互经验沉淀为长期的工作记忆。每一次对话窗口的开启都等同于‘恢复出厂设置’，迫使你不得不反复进行基础的背景同步与流程教学，导致大量精力被消耗在低效的重复沟通之中。</p>
<p>继 2025 年初以 MCP 协议解决连接难题后，Anthropic 于 10 月再推杀手锏——<strong>Agent Skills</strong>。它将复杂的任务流程固化为可复用的‘技能组件’，让 AI 能够按需调用能力，无需重复训练。这一创新直接重塑了 AI 开发生态，让‘能力复用’成为新常态。</p>
<h2 data-id="heading-0">一、什么是Agent Skills？</h2>
<h3 data-id="heading-1">1.1 Agent Skills概念</h3>
<p>Agent Skills是包含指令、脚本和资源的文件夹，智能体可以发现并使用它们来更准确、更高效地完成特定任务。</p>
<p>用一个更生动的比喻：</p>
<ul>
<li>
<p><strong>传统方式</strong>：每次都要向AI详细解释"如何做"</p>
</li>
<li>
<p><strong>Agent Skills</strong>：给AI一本"操作手册"，需要时自动调用</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/295135a81277489691a724adc3da794e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095725&amp;x-signature=3q4u%2Fl3Rpg87IiWQ2J1x8Fhre%2BI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">1.2 Skills与其他技术的区别</h3>
<p>很多人会困惑：Skills、Prompts、MCP有什么区别？</p>





























<table><thead><tr><th>技术</th><th>本质</th><th>作用范围</th><th>持久性</th></tr></thead><tbody><tr><td><strong>Prompts</strong></td><td>对话级指令</td><td>单次任务</td><td>临时</td></tr><tr><td><strong>Agent Skills</strong></td><td>领域知识包</td><td>可复用能力</td><td>持久化</td></tr><tr><td><strong>MCP</strong></td><td>工具连接协议</td><td>外部系统对接</td><td>持久化</td></tr></tbody></table>
<p><strong>用软件架构来理解</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">应用层：Agent Skills（领域知识、工作流、最佳实践）
<span class="hljs-code">    ↓
传输层：MCP（标准化接口、工具调用）
    ↓
基础设施层：数据库、API、文件系统
</span></code></pre>
<p>如果说MCP为智能体提供了"手"来操作工具，那么Skills就提供了"操作手册"或"SOP"，教导智能体如何正确使用这些工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8090f40835744cf79c940ccb7a3a160a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095725&amp;x-signature=BG5Fk7tElY0WYAC3cr6wLLZVZUw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">二、Agent Skills的技术原理</h2>
<h3 data-id="heading-4">2.1 渐进式披露（Progressive Disclosure）</h3>
<p>Agent Skills最核心的创新是<strong>三层渐进式加载机制</strong>：</p>
<h4 data-id="heading-5"><strong>第一层：发现阶段（~50 tokens）</strong></h4>
<p>智能体启动时，只加载所有技能的元数据（名称+描述）</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">data-analysis-expert</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">专业数据分析技能，支持CSV/Excel处理和可视化</span>
<span class="hljs-meta">---
</span></code></pre>
<h4 data-id="heading-6"><strong>第二层：激活阶段</strong></h4>
<p>当任务相关时，才加载完整的SKILL.md指令文档</p>
<h4 data-id="heading-7"><strong>第三层：执行阶段</strong></h4>
<p>按需动态访问引用的脚本和资源文件</p>
<p>这种设计让智能体可以同时"掌握"数十甚至上百个技能，而不会因为上下文过载而失效。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25266524c4ea4771925e14e074aeb868~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095725&amp;x-signature=A1J%2FTWi2BrXtRKANM%2F1r1CRsoTg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">2.2 标准文件结构</h3>
<p>一个完整的Skill通常包含：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">my</span>-skill/
├── SKILL.md           <span class="hljs-comment"># 核心指令文档（必需）</span>
├── scripts/           <span class="hljs-comment"># 可执行脚本</span>
│   ├── process.py
│   └── validate.sh
├── reference/         <span class="hljs-comment"># 参考文档</span>
│   └── api-docs.md
└── assets/            <span class="hljs-comment"># 资源文件</span>
    ├── templates/
    └── examples/
</code></pre>
<p><strong>SKILL.md示例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: github-actions-debugger
<span class="hljs-section">description: 帮助调试失败的GitHub Actions工作流
---</span>

<span class="hljs-section"># GitHub Actions调试专家</span>

<span class="hljs-section">## 使用时机</span>
当用户遇到CI/CD失败、构建错误或部署问题时使用

<span class="hljs-section">## 工作流程</span>
<span class="hljs-bullet">1.</span> 使用<span class="hljs-code">`list_workflow_runs`</span>工具查看最近的运行状态
<span class="hljs-bullet">2.</span> 使用<span class="hljs-code">`summarize_job_log_failures`</span>获取失败摘要
<span class="hljs-bullet">3.</span> 分析日志，定位问题根源
<span class="hljs-bullet">4.</span> 提供修复建议和代码示例

<span class="hljs-section">## 常见问题检查清单</span>
<span class="hljs-bullet">-</span> [ ] 环境变量和密钥配置
<span class="hljs-bullet">-</span> [ ] 依赖版本兼容性
<span class="hljs-bullet">-</span> [ ] 权限设置
<span class="hljs-bullet">-</span> [ ] 超时配置
</code></pre>
<h2 data-id="heading-9">三、Agent Skills的使用</h2>
<h3 data-id="heading-10">3.1 适用场景分析</h3>
<h4 data-id="heading-11"><strong>场景1：发现自己总是重复相同的指令</strong></h4>
<p><strong>案例</strong>：每次让AI写技术文档，都要说明：</p>
<ul>
<li>使用Markdown格式</li>
<li>包含目录</li>
<li>代码块要标注语言</li>
<li>添加实例和图表</li>
</ul>
<p><strong>Skills解决方案</strong>：创建<code>technical-writing</code>技能包，将这些规范固化。</p>
<h4 data-id="heading-12"><strong>场景2：需要遵循特定的领域知识或规范</strong></h4>
<p><strong>案例</strong>：公司的品牌设计规范（颜色、字体、布局）</p>
<p><strong>Skills解决方案</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: brand-guideline
<span class="hljs-section">description: 公司品牌视觉规范
---</span>

<span class="hljs-section">## 品牌色彩</span>
<span class="hljs-bullet">-</span> 主色：#FF6B6B（活力红）
<span class="hljs-bullet">-</span> 辅色：#4ECDC4（清新蓝）
<span class="hljs-bullet">-</span> 文字色：#2C3E50（深灰）

<span class="hljs-section">## 字体规范</span>
<span class="hljs-bullet">-</span> 标题：思源黑体 Bold
<span class="hljs-bullet">-</span> 正文：思源宋体 Regular
<span class="hljs-bullet">-</span> 代码：Fira Code

<span class="hljs-section">## 应用原则</span>
所有输出的视觉内容必须遵循以上规范...
</code></pre>
<h4 data-id="heading-13"><strong>场景3：复杂多步骤工作流</strong></h4>
<p><strong>案例</strong>：竞品分析报告制作</p>
<ol>
<li>收集竞品数据</li>
<li>数据清洗和分析</li>
<li>生成可视化图表</li>
<li>撰写分析报告</li>
<li>制作PPT演示</li>
</ol>
<p><strong>Skills解决方案</strong>：组合多个技能模块</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 智能体自动调用技能链</span>
<span class="hljs-variable">$web</span>-scraper → <span class="hljs-variable">$data</span>-analyzer → <span class="hljs-variable">$chart</span>-generator → <span class="hljs-variable">$report</span>-writer → <span class="hljs-variable">$pptx</span>-creator
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88058630a4954bff813f5d3d242fa4fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095725&amp;x-signature=%2B7PqwMaf6Xc2p5v6hzFApZu%2FhqM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">3.2 快速上手：使用Claude Code</h3>
<h4 data-id="heading-15"><strong>1: 安装Claude Code</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS/Linux</span>
curl -fsSL https://code.claude.com/install.sh | sh

<span class="hljs-comment"># Windows (使用PowerShell)</span>
irm https://code.claude.com/install.ps1 | iex
</code></pre>
<h4 data-id="heading-16"><strong>2: 安装预构建技能</strong></h4>
<p>Claude提供官方技能包：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在Claude Code中</span>
/skills

<span class="hljs-comment"># 选择要安装的技能</span>
- PowerPoint处理 (pptx)
- Excel数据分析 (xlsx)
- Word文档编辑 (docx)
- PDF生成 (pdf)
</code></pre>
<h4 data-id="heading-17"><strong>3: 使用技能</strong></h4>
<p><strong>方式1：显式调用</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用$符号直接指定技能</span>
<span class="hljs-variable">$pptx</span> 帮我创建一个产品发布会PPT，包含封面、产品特性、市场分析、Q&amp;A四个部分
</code></pre>
<p><strong>方式2：自动触发</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Claude会自动判断需要使用的技能</span>
帮我分析这个销售数据Excel，生成月度报告并制作可视化图表
<span class="hljs-comment"># → 自动激活 $xlsx 和 $chart-generator</span>
</code></pre>
<h3 data-id="heading-18">3.3 创建自定义技能</h3>
<h4 data-id="heading-19"><strong>方法1：手动创建</strong></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 创建技能文件夹</span>
<span class="hljs-built_in">mkdir</span> -p ~/.config/claude-code/skills/my-first-skill

<span class="hljs-comment"># 2. 创建SKILL.md</span>
<span class="hljs-built_in">cat</span> &gt; ~/.config/claude-code/skills/my-first-skill/SKILL.md &lt;&lt; <span class="hljs-string">'EOF'</span>
---
name: blog-writer
description: 专业技术博客写作助手
---

<span class="hljs-comment"># 技术博客写作专家</span>

<span class="hljs-comment">## 写作规范</span>
1. 标题：简洁有力，包含关键词
2. 结构：引言→核心内容→实战案例→总结
3. 代码：必须可运行，包含完整示例
4. 配图：每个核心概念配示意图

<span class="hljs-comment">## 输出格式</span>
- 使用Markdown
- 代码块标注语言
- 添加emoji增强可读性
- 文末附参考资源
</code></pre>
<h4 data-id="heading-20"><strong>方法2：使用Skill Creator</strong></h4>
<p>如果你不想从零开始写 Skill，那么可以直接让 AI 来帮你生成。官方提供了一个叫做 skill-creator 的工具，只需要简单描述你希望 Skill 实现的功能和能力，它就能自动生成对应的 Skill，让你把精力更多放在业务本身，而不是重复造轮子。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装官方skill-creator</span>
<span class="hljs-variable">$skill</span>-creator

<span class="hljs-comment"># 描述你的需求</span>
我需要一个技能包，用于：
- 自动化代码审查
- 检查代码规范（变量命名、注释完整性）
- 生成审查报告

<span class="hljs-comment"># AI会自动生成完整的SKILL.md和相关脚本</span>
</code></pre>
<h3 data-id="heading-21">3.4 技能组合</h3>
<p>在实际工作中，很多任务并不是单一技能就能搞定的。比如你要做一份市场分析报告，需要先从网上收集数据，再用Excel处理数据，然后生成可视化图表，最后写成Word报告。如果每个步骤都要你手动切换技能、传递数据，那和没用AI有什么区别？技能组合要解决的就是这个痛点，它让多个技能能够协同工作、数据自动流转，你只需要一句话触发整个工作流，中间完全不用插手。更重要的是，整个流程按照统一标准执行，避免了人为失误，而且一旦定义好，就可以反复使用，彻底告别重复劳动。</p>
<p><strong>案例：自动化内容生产流水线</strong></p>
<p>痛点：每次写公众号文章都要经历选题→资料收集→撰写→配图→SEO优化→发布，至少半天时间。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># content-pipeline技能</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">content-pipeline</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">全自动内容生产流程</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment">## 工作流</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">$web-researcher:</span> <span class="hljs-string">收集行业资讯和热点话题</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">$content-outliner:</span> <span class="hljs-string">根据SEO策略生成文章大纲</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">$blog-writer:</span> <span class="hljs-string">撰写正文内容</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">$image-generator:</span> <span class="hljs-string">生成配图（调用DALL-E</span> <span class="hljs-string">API）</span>
<span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">$seo-optimizer:</span> <span class="hljs-string">优化关键词和meta标签</span>
<span class="hljs-number">6</span><span class="hljs-string">.</span> <span class="hljs-string">$social-publisher:</span> <span class="hljs-string">发布到各平台</span>

<span class="hljs-comment">## 执行触发</span>
<span class="hljs-string">当用户说"写一篇关于[主题]的文章"时自动启动</span>
</code></pre>
<p><strong>使用结果：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 你只需要说一句话</span>
写一篇关于<span class="hljs-string">"2025年AI发展趋势"</span>的文章

<span class="hljs-comment"># AI自动完成：</span>
✓ 搜索最新AI新闻和报告（2分钟）
✓ 生成结构化大纲（1分钟）
✓ 撰写5000字文章（3分钟）
✓ 生成3张配图（2分钟）
✓ SEO优化（1分钟）
✓ 一键发布到公众号、知乎、掘金（1分钟）

总耗时：10分钟 vs 人工4小时
</code></pre>
<h2 data-id="heading-22">四、Agent Skills生态与工具</h2>
<h3 data-id="heading-23">4.1 官方技能库</h3>
<p><strong>Anthropic官方技能集</strong>：</p>
<ul>
<li>文档处理（PowerPoint、Excel、Word、PDF）</li>
<li>数据分析和可视化</li>
<li>Anthropic品牌规范</li>
</ul>
<h3 data-id="heading-24">4.2 社区生态工具</h3>
<h4 data-id="heading-25"><strong>Skill Seekers</strong></h4>
<p>自动抓取文档网站、GitHub仓库和PDF文件转换为Agent Skills</p>
<p><strong>应用</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 将Spring官方文档转换为技能包</span>
skill-seeker convert https://spring.io/docs --output spring-framework-skill
</code></pre>
<h4 data-id="heading-26"><strong>Superpowers</strong></h4>
<p>涵盖完整编程项目工作流的技能集合，包括：</p>
<ul>
<li>项目初始化和配置</li>
<li>代码规范检查</li>
<li>测试覆盖率分析</li>
<li>CI/CD自动化</li>
</ul>
<h4 data-id="heading-27"><strong>技能商店（SkillsMP）</strong></h4>
<ul>
<li>自动抓取GitHub上的所有Skills项目</li>
<li>按分类、更新时间、Star数量整理</li>
<li>一键下载和安装</li>
</ul>
<h3 data-id="heading-28">4.3 跨平台支持</h3>
<p>Agent Skills作为开放标准，已被多个平台支持：</p>








































<table><thead><tr><th>平台</th><th>支持状态</th><th>使用方式</th></tr></thead><tbody><tr><td><strong>Claude Code</strong></td><td>完整支持</td><td>原生集成</td></tr><tr><td><strong>Claude.ai</strong></td><td>完整支持</td><td>设置上传</td></tr><tr><td><strong>VS Code</strong></td><td>完整支持</td><td>chat.useAgentSkills</td></tr><tr><td><strong>Cursor</strong></td><td>完整支持</td><td>文档支持</td></tr><tr><td><strong>GitHub Copilot</strong></td><td>完整支持</td><td>原生集成</td></tr><tr><td><strong>OpenAI Codex</strong></td><td>完整支持</td><td>官方支持</td></tr></tbody></table>
<h2 data-id="heading-29">五、最佳实践与注意事项</h2>
<h3 data-id="heading-30">5.1 技能设计原则</h3>
<h4 data-id="heading-31"><strong>1. 单一职责</strong></h4>
<p>每个技能专注一个明确的能力领域</p>
<p><strong>错误示例</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">everything-helper</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">可以做任何事情的全能助手</span>
</code></pre>
<p><strong>正确示例</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">api-documentation-generator</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">根据代码自动生成API文档</span>
</code></pre>
<h4 data-id="heading-32"><strong>2. 清晰的触发条件</strong></h4>
<p>明确说明何时应该使用这个技能</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 使用时机</span>
<span class="hljs-bullet">-</span> 用户提到"生成API文档"
<span class="hljs-bullet">-</span> 用户上传了包含接口定义的代码文件
<span class="hljs-bullet">-</span> 用户询问"如何记录API"
</code></pre>
<h4 data-id="heading-33"><strong>3. 提供具体示例</strong></h4>
<p>包含完整的输入输出示例</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 示例</span>

<span class="hljs-section">### 输入</span>
<span class="hljs-code">```python
@app.route('/users/&lt;int:user_id&gt;', methods=['GET'])
def get_user(user_id):
    """获取用户信息"""
    user = User.query.get(user_id)
    return jsonify(user.to_dict())
</span></code></pre>
<h3 data-id="heading-34">输出</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## GET /users/{user<span class="hljs-emphasis">_id}

获取指定ID的用户信息

<span class="hljs-strong">**参数**</span>：
- `user_</span>id` (integer): 用户唯一标识</span>

<span class="hljs-strong">**返回**</span>：
<span class="hljs-bullet">-</span> 200: 用户对象
<span class="hljs-bullet">-</span> 404: 用户不存在
</code></pre>
<h3 data-id="heading-35">5.2 常见问题</h3>
<h4 data-id="heading-36"><strong>1：过度复杂</strong></h4>
<p>不要把太多逻辑塞进一个技能，善用技能组合</p>
<h4 data-id="heading-37"><strong>2：缺乏维护</strong></h4>
<p>技能需要随着业务变化及时更新</p>
<h4 data-id="heading-38"><strong>3：忽略错误处理</strong></h4>
<p>在脚本中添加健壮的错误处理逻辑</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># scripts/process.py</span>
<span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 核心逻辑</span>
    result = process_data()
    <span class="hljs-built_in">print</span>(result)
<span class="hljs-keyword">except</span> FileNotFoundError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误：找不到输入文件"</span>, file=sys.stderr)
    sys.exit(<span class="hljs-number">1</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理失败：<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>, file=sys.stderr)
    sys.exit(<span class="hljs-number">1</span>)
</code></pre>
<h2 data-id="heading-39">六、总结</h2>
<p>Agent Skills不仅是技术工具，更是一种思维方式的转变——<strong>将专业知识模块化、流程化、可复用化</strong>。在AI时代，这将成为个人和组织的核心竞争力。</p>
<h2 data-id="heading-40">参考资源</h2>
<p>Agent Skills官方文档:<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentskills.io" target="_blank" title="https://agentskills.io" ref="nofollow noopener noreferrer">agentskills.io</a>
Anthropic工程博客:<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fequipping-agents-for-the-real-world-with-agent-skills" target="_blank" title="https://www.anthropic.com/engineering/equipping-agents-for-the-real-world-with-agent-skills" ref="nofollow noopener noreferrer">www.anthropic.com/engineering…</a>
官方技能库:<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer">github.com/anthropics/…</a>
Awesome Agent Skills:<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskillmatic-ai%2Fawesome-agent-skills" target="_blank" title="https://github.com/skillmatic-ai/awesome-agent-skills" ref="nofollow noopener noreferrer">github.com/skillmatic-…</a>
SkillsMP技能商店:<a href="https://link.juejin.cn?target=https%3A%2F%2Fskillsmp.com" target="_blank" title="https://skillsmp.com" ref="nofollow noopener noreferrer">skillsmp.com</a></p>
<hr/>
<p>如果您关注前端+AI 相关领域可以扫码进群交流
添加小编微信进群😊</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cf4c6dc89cc40ad8ad1b49cc5e38a86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095725&amp;x-signature=V%2FOWZ9jAXlL10HO36XrS5qQHRfE%3D" alt="" loading="lazy"/></p>
<p>关于奇舞团
奇舞团是 360 集团最大的大前端团队，非常重视人才培养，有工程师、讲师、翻译官、业务接口人、团队 Leader 等多种发展方向供员工选择，并辅以提供相应的技术力、专业力、通用力、领导力等培训课程。奇舞团以开放和求贤的心态欢迎各种优秀人才关注和加入奇舞团。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c56eccf780140be8c498e618b801089~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095725&amp;x-signature=eUeeg0MEWORVGqEwyiK2WRyVHQE%3D" alt="" loading="lazy"/></p>
<hr/>
<blockquote>
<p>本文作者为 360 奇舞团前端开发工程师</p>
</blockquote>
<p>如果您关注前端+AI 相关领域可以扫码进群交流
添加小编微信进群😊</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/313417fab5824503aff9024cb228bd5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095725&amp;x-signature=odkZmJASRau0pJ6kELUgOqZvLEM%3D" alt="" loading="lazy"/></p>
<p>关于奇舞团
奇舞团是 360 集团最大的大前端团队，非常重视人才培养，有工程师、讲师、翻译官、业务接口人、团队 Leader 等多种发展方向供员工选择，并辅以提供相应的技术力、专业力、通用力、领导力等培训课程。奇舞团以开放和求贤的心态欢迎各种优秀人才关注和加入奇舞团。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/538f7063aabc4aa286217ad0c26560be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095725&amp;x-signature=utAc%2BtilFK8TqI%2BZn3pn3glN0ms%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端如何处理字节数据：支撑AI应用开发的重要技术]]></title>    <link>https://juejin.cn/post/7599591405313245225</link>    <guid>https://juejin.cn/post/7599591405313245225</guid>    <pubDate>2026-01-27T05:16:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599591405313245225" data-draft-id="7599591405313228841" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端如何处理字节数据：支撑AI应用开发的重要技术"/> <meta itemprop="keywords" content="前端,AIGC"/> <meta itemprop="datePublished" content="2026-01-27T05:16:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="奇舞精选"/> <meta itemprop="url" content="https://juejin.cn/user/4388906147515367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端如何处理字节数据：支撑AI应用开发的重要技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906147515367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    奇舞精选
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T05:16:56.000Z" title="Tue Jan 27 2026 05:16:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文作者为 360 奇舞团前端开发工程师</p>
</blockquote>
<p>前端的字节数据的处理，是一块<strong>经常被忽视、却越来越重要</strong>的基础能力。</p>
<p>在传统 Web 开发中，我们更多面对的是字符串、JSON、DOM、组件状态，很少直接触碰“原始数据”。但当业务开始涉及 <strong>音视频、文件系统、实时通信、加密、安全</strong> 时，就会需要更底层的数据处理和控制。在 AI 时代，AI 应用中的核心模块，流式数据、语音交互、文件上传、向量存储等能力的开发与优化，与字节数据的处理都有着密不可分的关系。
ArrayBuffer、Uint8Array、Blob、File、Buffer、Stream……，这些概念并不新，但它们往往以“临时补课”的方式出现在项目里，零散、割裂，很难形成完整认知。本文将简单梳理前端的主要字节处理部分，包括在 AI 项目开发应用到的几个方面。</p>
<h3 data-id="heading-0">一、从“字节”开始</h3>
<p>在 JavaScript 中，我们习惯认为数据是这样的：</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-string">"hello"</span>

{ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }

[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]

</code></pre>
<p>但这些只是<strong>语言层面的抽象</strong>。</p>
<p>在计算机系统中，数据更底层一些会被表示为：</p>
<blockquote>
<p>一段连续的字节序列（byte sequence）</p>
</blockquote>
<p>一个字节（byte）由 8 个二进制位（bit）组成，取值范围是 0～255。</p>
<p>无论是字符串、图片、音频、模型参数，本质上都是：</p>
<pre><code class="hljs">
0, 1, 2, …, 255

</code></pre>
<p>这些数字按照特定规则排列后的结果。</p>
<p>“字节数据处理”，指的就是：</p>
<blockquote>
<p><strong>在 JavaScript 中，以可控、明确的方式操作这些底层字节数据</strong>。</p>
</blockquote>
<h3 data-id="heading-1">二、浏览器中的基础：ArrayBuffer</h3>
<h4 data-id="heading-2">2.1 ArrayBuffer 的定位</h4>
<p>ArrayBuffer 是ECMAScript标准中定义的用于表示固定长度原始二进制数据缓冲区的对象，是浏览器提供的一个非常底层的对象，用来表示：</p>
<blockquote>
<p>一块固定长度的连续内存区域</p>
</blockquote>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>); <span class="hljs-comment">// 分配 8 字节</span>

</code></pre>
<p>此时你得到了 8 个字节的内存空间，但需要注意：</p>
<ul>
<li>
<p>ArrayBuffer <strong>只负责分配内存</strong></p>
</li>
<li>
<p>它本身不提供任何读写接口</p>
</li>
<li>
<p>也不关心这些字节代表什么含义</p>
</li>
</ul>
<p>可以理解为：</p>
<blockquote>
<p>ArrayBuffer = 纯内存</p>
</blockquote>
<h4 data-id="heading-3">2.2 为什么 ArrayBuffer 不能直接读写</h4>
<p>如果你尝试这样做：</p>
<pre><code class="hljs language-js" lang="js">
buffer[<span class="hljs-number">0</span>]

</code></pre>
<p>你会发现这是 <code>undefined</code>。</p>
<p>这是一个刻意的设计。</p>
<p>因为：</p>
<ul>
<li>
<p>内存本身是“无类型”的</p>
</li>
<li>
<p>直接读写会引入大量隐式假设</p>
</li>
</ul>
<p>于是，浏览器把“如何解释这段内存”的权力，交给了 <strong>TypedArray</strong>。</p>
<h3 data-id="heading-4">三、TypedArray：访问 ArrayBuffer 的标准方式</h3>
<h4 data-id="heading-5">3.1 TypedArray 的核心作用</h4>
<p>TypedArray 并不是一类单独的数据结构，而是一组<strong>视图类型</strong>的统称。</p>
<p>它们的共同点是：</p>
<ul>
<li>
<p>都依附于某个 ArrayBuffer</p>
</li>
<li>
<p>按照固定的数值类型来读写内存</p>
</li>
</ul>
<p>常见的包括：</p>
<ul>
<li>
<p>Uint8Array</p>
</li>
<li>
<p>Int16Array</p>
</li>
<li>
<p>Uint32Array</p>
</li>
<li>
<p>Float32Array</p>
</li>
<li>
<p>Float64Array</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-6">3.2 为什么 Uint8Array 最重要</h4>
<p>在前端实际项目中，<strong>使用频率最高的 TypedArray 是 Uint8Array</strong>。</p>
<p>原因只有一个：</p>
<blockquote>
<p>Uint8Array 与“字节”是一一对应的</p>
</blockquote>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">4</span>);

<span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);

  

view[<span class="hljs-number">0</span>] = <span class="hljs-number">255</span>;

view[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;

view[<span class="hljs-number">2</span>] = <span class="hljs-number">2</span>;

view[<span class="hljs-number">3</span>] = <span class="hljs-number">3</span>;

</code></pre>
<p>这 4 个数字，对应的就是 4 个真实字节。</p>
<p>因此，在以下场景中，Uint8Array 几乎是默认选择：</p>
<ul>
<li>
<p>文件读写</p>
</li>
<li>
<p>网络二进制协议</p>
</li>
<li>
<p>加密 / 哈希</p>
</li>
<li>
<p>音视频原始数据</p>
</li>
</ul>
<h4 data-id="heading-7">3.3 ArrayBuffer 与 TypedArray 的关系总结</h4>
<blockquote>
<p><strong>ArrayBuffer 负责“存”，TypedArray 负责“读写规则”</strong></p>
</blockquote>
<ul>
<li>
<p>ArrayBuffer 决定内存大小</p>
</li>
<li>
<p>TypedArray 决定如何解释这段内存</p>
</li>
</ul>
<p>它们通常是成对出现的。</p>
<h3 data-id="heading-8">四、Blob 与 File：浏览器中的“文件语义”</h3>
<h4 data-id="heading-9">4.1 为什么需要 Blob</h4>
<p>ArrayBuffer 和 Uint8Array 解决的是“内存层”的问题。但在浏览器中，我们经常需要：</p>
<ul>
<li>
<p>上传文件</p>
</li>
<li>
<p>下载文件</p>
</li>
<li>
<p>创建临时资源 URL</p>
</li>
</ul>
<p>这时，直接操作内存并不方便。</p>
<p><code>Blob</code> 的出现，解决的是：</p>
<blockquote>
<p><strong>二进制数据在浏览器中的“文件化表达”</strong></p>
</blockquote>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])

], { <span class="hljs-attr">type</span>: <span class="hljs-string">'application/octet-stream'</span> });

</code></pre>
<p>Blob 的特点是：</p>
<ul>
<li>
<p>内部是二进制数据</p>
</li>
<li>
<p>带有 MIME 类型</p>
</li>
<li>
<p>可以直接用于网络传输</p>
</li>
</ul>
<h4 data-id="heading-10">4.2 File：在 Blob 基础上增加元信息</h4>
<p><code>File</code> 是 <code>Blob</code> 的子类：</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>([

blob

], <span class="hljs-string">'demo.bin'</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">'application/octet-stream'</span> });

</code></pre>
<p>相比 Blob，File 多了：</p>
<ul>
<li>
<p>文件名</p>
</li>
<li>
<p>最后修改时间</p>
</li>
</ul>
<p>它通常来自：</p>
<ul>
<li>
<p><code>&lt;input type="file"&gt;</code></p>
</li>
<li>
<p>拖拽上传</p>
</li>
</ul>
<h4 data-id="heading-11">4.3 典型应用场景</h4>
<p>在大文件上传场景中，常需对文件进行分片并计算哈希值以支持断点续传或秒传。</p>
<pre><code class="hljs language-ini" lang="ini">
async function uploadInChunks(file, <span class="hljs-attr">chunkSize</span> = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>) {

const <span class="hljs-attr">totalChunks</span> = Math.ceil(file.size / chunkSize)<span class="hljs-comment">;</span>

const <span class="hljs-attr">worker</span> = new Worker(<span class="hljs-string">'/hash-worker.js'</span>)<span class="hljs-comment">; // 使用Web Worker避免阻塞</span>

  

for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; totalChunks; i++) {</span>

	const <span class="hljs-attr">start</span> = i * chunkSize<span class="hljs-comment">;</span>

	const <span class="hljs-attr">end</span> = Math.min(start + chunkSize, file.size)<span class="hljs-comment">;</span>

	const <span class="hljs-attr">chunk</span> = file.slice(start, end)<span class="hljs-comment">;</span>

	const <span class="hljs-attr">buffer</span> = await chunk.arrayBuffer()<span class="hljs-comment">;</span>

	const <span class="hljs-attr">bytes</span> = new Uint8Array(buffer)<span class="hljs-comment">;</span>

	// 可在此计算chunk哈希或加密

	const <span class="hljs-attr">hash</span> = await computeHash(bytes)<span class="hljs-comment">; // 假设函数已定义</span>

	// 发送分片

	await fetch('/upload', {

		method: 'POST',

		body: JSON.stringify({ chunkIndex: i, data: Array.from(bytes), hash })

	})<span class="hljs-comment">;</span>

	}

}

</code></pre>
<h3 data-id="heading-12">五、浏览器中的高频实战场景</h3>
<h4 data-id="heading-13">5.1 文件上传与分片</h4>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> file = input.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];

<span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> file.<span class="hljs-title function_">arrayBuffer</span>();

<span class="hljs-keyword">const</span> bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);

</code></pre>
<p>后续常见操作包括：</p>
<ul>
<li>
<p>计算 hash（用于秒传）</p>
</li>
<li>
<p>按固定大小切片</p>
</li>
<li>
<p>转换格式后再上传</p>
</li>
</ul>
<h4 data-id="heading-14">5.2 WebSocket 二进制通信</h4>
<pre><code class="hljs language-js" lang="js">
ws.<span class="hljs-property">binaryType</span> = <span class="hljs-string">'arraybuffer'</span>;

  

ws.<span class="hljs-property">onmessage</span> = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {

<span class="hljs-keyword">const</span> buffer = e.<span class="hljs-property">data</span>;

<span class="hljs-keyword">const</span> bytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);

};

</code></pre>
<p>很多实时系统、AI 推理服务都会采用这种方式。</p>
<h4 data-id="heading-15">5.3 音频与媒体处理</h4>
<p>音频处理的典型路径是：</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-title class_">MediaStream</span>

→ <span class="hljs-title class_">AudioBuffer</span>

→ <span class="hljs-title class_">Float32Array</span>

→ <span class="hljs-title class_">Uint8Array</span>

→ <span class="hljs-variable constant_">WAV</span>

</code></pre>
<p>这里几乎每一步，都绕不开字节层面处理。</p>
<h3 data-id="heading-16">六、Node.js 中的字节处理模型</h3>
<p>浏览器不是唯一的运行环境。在 Node.js 中，字节处理更加重要。</p>
<h4 data-id="heading-17">6.1 Buffer：Node 的核心二进制类型</h4>
<p>Node.js 没有直接使用 ArrayBuffer 作为主力，而是提供了 <code>Buffer</code>。</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> buf = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);

</code></pre>
<p>Buffer 的特点：</p>
<ul>
<li>
<p>本质是 Uint8Array 的子类</p>
</li>
<li>
<p>API 更偏向工程化</p>
</li>
<li>
<p>与文件系统、网络高度集成</p>
</li>
</ul>
<h4 data-id="heading-18">6.2 Buffer 与 Uint8Array 的关系</h4>
<p>在现代 Node.js 中：</p>
<pre><code class="hljs language-js" lang="js">
buf <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Uint8Array</span> <span class="hljs-comment">// true</span>

</code></pre>
<p>也就是说：</p>
<blockquote>
<p><strong>Buffer 是带有 Node 能力增强的 Uint8Array</strong></p>
</blockquote>
<p>它提供了大量便利方法：</p>
<ul>
<li>
<p>编码转换（utf8 / hex / base64）</p>
</li>
<li>
<p>slice / copy</p>
</li>
<li>
<p>与 fs、net、stream 无缝协作</p>
</li>
</ul>
<h4 data-id="heading-19">6.3 Stream：字节的“流式处理”</h4>
<p>在 Node 中，大文件和网络数据通常不会一次性读入内存。</p>
<pre><code class="hljs language-js" lang="js">
fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">'big.mp4'</span>)

.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> {

<span class="hljs-comment">// chunk 是 Buffer</span>

});

</code></pre>
<p>Stream 的核心思想是：</p>
<blockquote>
<p><strong>分块处理字节，避免内存峰值</strong></p>
</blockquote>
<p>这在以下场景中至关重要：</p>
<ul>
<li>
<p>大文件上传</p>
</li>
<li>
<p>AI 模型权重加载</p>
</li>
<li>
<p>实时音视频转码</p>
</li>
</ul>
<h3 data-id="heading-20">七、前后端字节模型的统一视角</h3>
<p>当你把浏览器与 Node 放在一起看，会发现：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0e3237e92a34f8ea7cab8be947e2494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095816&amp;x-signature=kYlMYMIVbxGJzYDY0zzbI5%2FvXTI%3D" alt="" loading="lazy"/></p>
<p>这张表，就是前后端二进制处理几个基础概念的关系。</p>
<h3 data-id="heading-21">八、字节处理与 AI 应用的直接关系</h3>
<p>在AI类应用开发中，以上几点或多或少都会有所涉及，以下领域的关系更直接一些。</p>
<h4 data-id="heading-22">8.1 语音识别</h4>
<p>语音识别的输入，并不是“音频文件”，而是：</p>
<ul>
<li>
<p>PCM 数值序列</p>
</li>
<li>
<p>Float32 / Int16</p>
</li>
</ul>
<p>前端和 Node 都需要完成：</p>
<blockquote>
<p>字节 → 数值 → 模型输入</p>
</blockquote>
<h4 data-id="heading-23">8.2 Embedding 与向量存储</h4>
<p>大模型的 embedding 通常表现为：</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">768</span>)

</code></pre>
<p>这些向量在网络中传输、在数据库中存储，本质上都是字节操作。</p>
<h4 data-id="heading-24">8.3 流式 AI 响应</h4>
<ul>
<li>
<p>SSE</p>
</li>
<li>
<p>WebSocket</p>
</li>
<li>
<p>自定义二进制协议</p>
</li>
</ul>
<p>都要求前端具备基本的字节解码能力。</p>
<h3 data-id="heading-25">九、常见误区</h3>
<ul>
<li>
<p>过度依赖 base64，忽视体积与性能</p>
</li>
<li>
<p>把二进制问题完全推给后端</p>
</li>
<li>
<p>不了解 Node Buffer 与 Uint8Array 的关系</p>
</li>
</ul>
<p>这些问题，在 AI 与多媒体时代会被不断放大。</p>
<h3 data-id="heading-26">结语</h3>
<p>数据处理是现代前端工程中不可或缺的基础能力。它不仅是文件上传、音视频处理的技术支撑，更是连接前端与AI、加密、实时系统的关键纽带。掌握 ArrayBuffer、TypedArray、Blob、Buffer 和 Stream 等核心概念，理解其在不同运行环境中的异同，有助于构建高效、稳定、可扩展的Web应用。随着AI应用的普及，前端开发也要具备更强的数据底层处理能力。通过系统化学习与实践，可显著提升在复杂场景下的技术应对能力，推动前端工程向更深层次发展。</p>
<hr/>
<p>如果您关注前端+AI 相关领域可以扫码进群交流
添加小编微信进群😊</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83cc1f1aa6ca4c7fb76e1557d836a1b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095816&amp;x-signature=r6JQo4VaGjWzJeBSxHGUkv7KSqU%3D" alt="" loading="lazy"/></p>
<p>关于奇舞团
奇舞团是 360 集团最大的大前端团队，非常重视人才培养，有工程师、讲师、翻译官、业务接口人、团队 Leader 等多种发展方向供员工选择，并辅以提供相应的技术力、专业力、通用力、领导力等培训课程。奇舞团以开放和求贤的心态欢迎各种优秀人才关注和加入奇舞团。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b86d1807464a4785933b01efe9148e46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095816&amp;x-signature=15C2V%2FLi%2BVFKVggdKrpoAA0Gh1M%3D" alt="" loading="lazy"/></p>
<hr/>
<blockquote>
<p>本文作者为 360 奇舞团前端开发工程师</p>
</blockquote>
<p>如果您关注前端+AI 相关领域可以扫码进群交流
添加小编微信进群😊</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb14926de37c4a80992da292c12e4d34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095816&amp;x-signature=rei%2FANsDZu%2FwiEAiQbSvAbI3s18%3D" alt="" loading="lazy"/></p>
<p>关于奇舞团
奇舞团是 360 集团最大的大前端团队，非常重视人才培养，有工程师、讲师、翻译官、业务接口人、团队 Leader 等多种发展方向供员工选择，并辅以提供相应的技术力、专业力、通用力、领导力等培训课程。奇舞团以开放和求贤的心态欢迎各种优秀人才关注和加入奇舞团。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db0e25c65a5747e7a77348fd8d8a8c65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWH6Iie57K-6YCJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095816&amp;x-signature=js9mF9jaYbttKZOY4U3HgvsyBfg%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elasticsearch与Lucene核心机制详解]]></title>    <link>https://juejin.cn/post/7599604510366138406</link>    <guid>https://juejin.cn/post/7599604510366138406</guid>    <pubDate>2026-01-27T03:34:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599604510366138406" data-draft-id="7599640782569177115" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearch与Lucene核心机制详解"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T03:34:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ray66"/> <meta itemprop="url" content="https://juejin.cn/user/3131851531368055"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearch与Lucene核心机制详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3131851531368055/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ray66
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:34:02.000Z" title="Tue Jan 27 2026 03:34:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Elasticsearch与Lucene核心机制详解</h2>
<h3 data-id="heading-1">一、基础概念：ES与Lucene的分工</h3>
<h4 data-id="heading-2">1.1 核心比喻</h4>
<ul>
<li><strong>Elasticsearch</strong> = 图书管理员 + 图书馆管理系统</li>
<li><strong>Lucene</strong> = 图书索引卡片柜（最核心的检索技术）</li>
</ul>
<h4 data-id="heading-3">1.2 具体职责分工</h4>













































<table><thead><tr><th>功能</th><th>Lucene负责</th><th>Elasticsearch负责</th></tr></thead><tbody><tr><td><strong>索引存储</strong></td><td>单个索引文件格式</td><td>分布式分片管理</td></tr><tr><td><strong>分词</strong></td><td>分词算法实现</td><td>分词器配置管理</td></tr><tr><td><strong>相关性</strong></td><td>TF-IDF/BM25计算</td><td>查询语句解析</td></tr><tr><td><strong>存储</strong></td><td>字段原始值存储</td><td>集群数据分布</td></tr><tr><td><strong>查询</strong></td><td>单个分片内检索</td><td>分布式查询协调</td></tr><tr><td><strong>事务</strong></td><td>单个索引段变更</td><td>集群级事务一致性</td></tr><tr><td><strong>API</strong></td><td>无</td><td>RESTful API、客户端SDK</td></tr></tbody></table>
<h4 data-id="heading-4">1.3 关键理解点</h4>
<ol>
<li>
<p><strong>Lucene是库，ES是服务</strong></p>
<ul>
<li>Lucene：Java库，需要编程调用</li>
<li>ES：开箱即用的搜索服务</li>
</ul>
</li>
<li>
<p><strong>Lucene不懂分布式</strong></p>
<ul>
<li>Lucene只处理单个索引（分片）</li>
<li>ES负责把数据分布到多个Lucene索引上</li>
</ul>
</li>
<li>
<p><strong>ES是Lucene的"集群管理器"</strong></p>
<pre><code class="hljs language-text" lang="text">一个ES节点 = Lucene实例 + 集群协调模块
整个ES集群 = 多个Lucene实例 + 分布式协调系统
</code></pre>
</li>
</ol>
<h3 data-id="heading-5">二、Lucene倒排索引详细结构</h3>
<h4 data-id="heading-6">2.1 简化表示 vs 真实结构</h4>
<p><strong>简化表示（便于理解）：</strong></p>
<pre><code class="hljs language-rust" lang="rust">词项: <span class="hljs-string">"小米"</span> <span class="hljs-punctuation">-&gt;</span> 位置: [name字段, tags字段]
</code></pre>
<p><strong>真实的多层结构：</strong></p>
<pre><code class="hljs language-ini" lang="ini">Level 1: 词项字典（Term Dictionary）
├── "小米" → 指向倒排列表A
├── "手机" → 指向倒排列表B
├── "2999" → 指向倒排列表C
└── ... (按字典序排序，使用FST压缩存储)

Level 2: 倒排列表（Posting List）
倒排列表A（对应词项"小米"）:
┌───────────────────────────────────────┐
│ Header:                               │
│   • <span class="hljs-attr">DocFreq</span> = <span class="hljs-number">2</span> (文档频率)            │
│   • <span class="hljs-attr">TotalTermFreq</span> = <span class="hljs-number">3</span> (总词频)        │
├───────────────────────────────────────┤
│ DocId List (使用FOR编码压缩):         │
│   文档1 → <span class="hljs-section">[位置信息指针]</span>               │
│   文档4 → <span class="hljs-section">[位置信息指针]</span>               │
├───────────────────────────────────────┤
│ 位置信息 (存储在每个文档项中):         │
│   文档1:                              │
│     • 字段: name                      │
│       - 位置: 0 (在字段中的偏移)       │
│       - 起始字符: 0                   │
│       - 结束字符: 2                   │
│     • 字段: brand                     │
│       - 位置: 0                       │
│       - 起始字符: 0                   │
│       - 结束字符: 2                   │
└───────────────────────────────────────┘
</code></pre>
<h4 data-id="heading-7">2.2 倒排索引的核心组件</h4>
<ol>
<li>
<p><strong>词项字典（Term Dictionary）</strong></p>
<ul>
<li>所有词项的排序列表</li>
<li>使用FST（有限状态转换器）压缩存储</li>
<li>支持前缀查询和模糊查询</li>
</ul>
</li>
<li>
<p><strong>倒排列表（Posting List）</strong></p>
<ul>
<li>存储包含该词项的文档列表</li>
<li>包含：文档ID、词频、位置信息</li>
<li>使用FOR（Frame Of Reference）编码压缩</li>
</ul>
</li>
<li>
<p><strong>位置信息（Positions）</strong></p>
<ul>
<li>词项在文档中的具体位置</li>
<li>包括：字段名、偏移量、起止字符</li>
<li>用于短语查询和高亮显示</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">三、索引段（Segment）机制</h3>
<h4 data-id="heading-9">3.1 什么是段？</h4>
<p><strong>段是Lucene索引的最小独立单元</strong>，每个段都是一个<strong>完整的、不可变的倒排索引</strong>。</p>
<h4 data-id="heading-10">3.2 段的产生过程</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[文档写入] --&gt; B[内存Buffer]
    B --&gt; C{达到阈值?}
    C --否--&gt; D[等待Refresh]
    C --是--&gt; E[创建新段]
    
    E --&gt; F[Segment_1]
    F --&gt; G[Refresh后&lt;br&gt;段可搜索]
    
    G --&gt; H{后台Merge触发?}
    H --是--&gt; I[选择小段合并]
    I --&gt; J[创建更大段]
    J --&gt; K[删除旧段]
    
    style F fill:#e1f5fe
    style J fill:#f3e5f5
</code></pre>
<h4 data-id="heading-11">3.3 段生命周期示例</h4>
<pre><code class="hljs language-makefile" lang="makefile">时间线发展：
<span class="hljs-section">T0: 索引为空</span>
<span class="hljs-section">T1: 写入文档1-3 → 内存Buffer</span>
<span class="hljs-section">T2: 写入文档4，触发refresh → 创建Segment_1[文档1-4]</span>
<span class="hljs-section">T3: 写入文档5-7 → 内存Buffer</span>
<span class="hljs-section">T4: 写入文档8，触发refresh → 创建Segment_2[文档5-8]</span>
<span class="hljs-section">T5: 写入文档9-10 → 内存Buffer</span>
<span class="hljs-section">T6: refresh → 创建Segment_3[文档9-10]</span>
<span class="hljs-section">T7: 触发合并 → Segment_1+Segment_2合并为Segment_4[文档1-8]</span>
最终：Segment_4 + Segment_3
</code></pre>
<h4 data-id="heading-12">3.4 段的物理文件结构</h4>
<pre><code class="hljs language-scss" lang="scss">Segment_1/
├── <span class="hljs-selector-class">.si</span> (段信息文件)
├── 倒排索引相关：
│   ├── <span class="hljs-selector-class">.tim</span> (词项字典)
│   ├── <span class="hljs-selector-class">.tip</span> (词项索引)
│   ├── <span class="hljs-selector-class">.doc</span> (倒排列表)
│   └── <span class="hljs-selector-class">.pos</span> (位置信息)
├── 正排存储：
│   ├── <span class="hljs-selector-class">.fdt</span> (存储字段值)
│   ├── <span class="hljs-selector-class">.fdx</span> (存储字段索引)
│   └── <span class="hljs-selector-class">.fdm</span> (存储字段元数据)
├── 列式存储：
│   ├── <span class="hljs-selector-class">.dvd</span> (DocValues数据)
│   └── <span class="hljs-selector-class">.dvm</span> (DocValues元数据)
└── 其他元数据文件
</code></pre>
<h4 data-id="heading-13">3.5 段的关键特性</h4>
<ol>
<li><strong>不可变性</strong>：一旦创建就不能修改</li>
<li><strong>独立性</strong>：每个段都是完整索引</li>
<li><strong>渐进合并</strong>：小段合并成大段</li>
<li><strong>删除标记</strong>：删除文档时只标记，合并时才物理删除</li>
</ol>
<h4 data-id="heading-14">3.6 为什么要有段机制？</h4>
<ol>
<li><strong>写入性能</strong>：可以批量写入，减少磁盘IO</li>
<li><strong>删除效率</strong>：通过标记删除，避免立即重写索引</li>
<li><strong>缓存友好</strong>：小段可以完全载入内存</li>
<li><strong>并发控制</strong>：读操作不影响写操作</li>
<li><strong>故障恢复</strong>：translog + 段机制保证数据安全</li>
</ol>
<h3 data-id="heading-15">四、10文档ES集群存储与查询实例</h3>
<h4 data-id="heading-16">4.1 示例文档</h4>
<pre><code class="hljs language-json" lang="json">文档<span class="hljs-number">1</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小米手机"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小米"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">2999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"手机"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">2</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"苹果手机"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"苹果"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">8999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"手机"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">3</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"华为平板"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"华为"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">3999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"平板"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">4</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">4</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小米电视"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小米"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">4999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"电视"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">5</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">5</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"联想笔记本"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"联想"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">5999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"电脑"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">6</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"苹果笔记本"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"苹果"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">12999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"电脑"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">7</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">7</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"华为手机"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"华为"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">3999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"手机"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">8</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小米笔记本"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小米"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">6999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"电脑"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">9</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">9</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"三星电视"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"三星"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">5999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"电视"</span><span class="hljs-punctuation">}</span>
文档<span class="hljs-number">10</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"苹果平板"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"苹果"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">5999</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"平板"</span><span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-17">4.2 集群部署结构</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">3</span>节点集群，<span class="hljs-number">3</span>主分片+<span class="hljs-number">1</span>副本：
节点<span class="hljs-number">1</span>: 分片<span class="hljs-built_in">P0</span>(主), 分片<span class="hljs-built_in">P1</span>(副本), 分片<span class="hljs-built_in">P2</span>(副本)
节点<span class="hljs-number">2</span>: 分片<span class="hljs-built_in">P1</span>(主), 分片<span class="hljs-built_in">P2</span>(副本), 分片<span class="hljs-built_in">P0</span>(副本)
节点<span class="hljs-number">3</span>: 分片<span class="hljs-built_in">P2</span>(主), 分片<span class="hljs-built_in">P0</span>(副本), 分片<span class="hljs-built_in">P1</span>(副本)
</code></pre>
<h4 data-id="heading-18">4.3 文档分布（按_id哈希路由）</h4>
<pre><code class="hljs">文档1 → 分片1  文档6 → 分片0
文档2 → 分片2  文档7 → 分片1
文档3 → 分片0  文档8 → 分片2
文档4 → 分片1  文档9 → 分片0
文档5 → 分片2  文档10 → 分片1
</code></pre>
<p><strong>最终分布</strong>：</p>
<ul>
<li>分片0: 文档3,6,9</li>
<li>分片1: 文档1,4,7,10</li>
<li>分片2: 文档2,5,8</li>
</ul>
<h4 data-id="heading-19">4.4 搜索流程详解</h4>
<h5 data-id="heading-20">场景1：搜索"小米"</h5>
<pre><code class="hljs language-text" lang="text">1. ES接收请求：GET /products/_search?q=小米
2. 转换为内部查询：match "_all": "小米"
3. 向所有主分片广播查询：
   - 节点2查询分片1
   - 节点3查询分片2
   - 节点1查询分片0
4. 各分片Lucene并行查询：
   - 分片1: [文档1:0.85, 文档4:0.85]
   - 分片2: [文档8:0.70]
   - 分片0: []
5. ES归并结果：[文档1, 文档4, 文档8]
6. 返回给用户
</code></pre>
<h5 data-id="heading-21">场景2：范围查询"price&gt;5000"</h5>
<pre><code class="hljs language-text" lang="text">各分片本地查询：
- 分片1: price DocValues遍历 → 文档10(5999)匹配
- 分片2: 文档2(8999)、5(5999)、8(6999)匹配
- 分片0: 文档6(12999)、9(5999)匹配
全局结果：文档2,5,6,8,9,10
</code></pre>
<h5 data-id="heading-22">场景3：聚合统计"按品牌分组"</h5>
<pre><code class="hljs language-text" lang="text">分片本地聚合：
- 分片1: 小米×2, 华为×1, 苹果×1
- 分片2: 苹果×1, 联想×1, 小米×1
- 分片0: 华为×1, 苹果×1, 三星×1
全局归并：
苹果:3, 小米:3, 华为:2, 联想:1, 三星:1
</code></pre>
<h4 data-id="heading-23">4.5 写入过程数据流</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. 客户端 → ES协调节点
<span class="hljs-number">2</span>. 路由计算：_id哈希 → 确定分片
<span class="hljs-number">3</span>. 转发到主分片节点
<span class="hljs-number">4</span>. 主分片写入：
   <span class="hljs-selector-tag">a</span>. 写入translog（保证持久化）
   <span class="hljs-selector-tag">b</span>. Lucene内存buffer添加文档
   c. 返回成功给客户端
<span class="hljs-number">5</span>. 异步复制到副本分片
<span class="hljs-number">6</span>. refresh（默认<span class="hljs-number">1</span>秒）：
   <span class="hljs-selector-tag">a</span>. Lucene buffer生成新段
   <span class="hljs-selector-tag">b</span>. 索引可搜索
<span class="hljs-number">7</span>. flush（每<span class="hljs-number">30</span>分钟/<span class="hljs-number">512</span>MB）：
   <span class="hljs-selector-tag">a</span>. 将内存数据写入磁盘
   <span class="hljs-selector-tag">b</span>. 清理translog
</code></pre>
<h3 data-id="heading-24">五、关键配置参数</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 段相关配置</span>
<span class="hljs-attr">index.refresh_interval:</span> <span class="hljs-string">"1s"</span>     <span class="hljs-comment"># 刷新间隔</span>
<span class="hljs-attr">index.merge.policy.max_merged_segment:</span> <span class="hljs-string">"5gb"</span>  <span class="hljs-comment"># 最大段大小</span>
<span class="hljs-attr">index.merge.policy.segments_per_tier:</span> <span class="hljs-number">10</span>      <span class="hljs-comment"># 每层段数</span>
<span class="hljs-attr">index.merge.scheduler.max_thread_count:</span> <span class="hljs-number">1</span>     <span class="hljs-comment"># 合并线程数</span>

<span class="hljs-comment"># 索引配置</span>
<span class="hljs-attr">index.number_of_shards:</span> <span class="hljs-number">3</span>        <span class="hljs-comment"># 主分片数</span>
<span class="hljs-attr">index.number_of_replicas:</span> <span class="hljs-number">1</span>      <span class="hljs-comment"># 副本数</span>
<span class="hljs-attr">index.codec:</span> <span class="hljs-string">"Lucene87"</span>          <span class="hljs-comment"># 压缩编解码器</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux系统安装Apache Maven 3.8.6]]></title>    <link>https://juejin.cn/post/7599598627008053300</link>    <guid>https://juejin.cn/post/7599598627008053300</guid>    <pubDate>2026-01-27T03:39:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599598627008053300" data-draft-id="7599713126375751695" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux系统安装Apache Maven 3.8.6"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-27T03:39:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WiseSheep"/> <meta itemprop="url" content="https://juejin.cn/user/3123091067642990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux系统安装Apache Maven 3.8.6
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123091067642990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WiseSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:39:07.000Z" title="Tue Jan 27 2026 03:39:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、下载Maven安装包</h2>
<p>可以通过官方地址下载，也可通过华为云镜像源下载</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># -c：断点续传（网络中断后可恢复下载）；-P：指定下载目录为/opt/data</span>
wget -c -P /opt/data https://mirrors.huaweicloud.com/apache/maven/maven-3/3.8.6/binaries/apache-maven-3.8.6-bin.tar.gz
</code></pre>
<h2 data-id="heading-1">二、解压并简化文件夹名称</h2>
<p>进入安装目录执行解压，并重命名文件夹，简化后续环境变量配置</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /opt/data
tar -zxvf apache-maven-3.8.6-bin.tar.gz
<span class="hljs-built_in">mv</span> apache-maven-3.8.6 maven3.8
</code></pre>
<h2 data-id="heading-2">三、配置Maven环境变量</h2>
<p>配置全局环境变量，使任意目录可调用maven命令</p>
<pre><code class="hljs language-bash" lang="bash">vim /etc/profile
<span class="hljs-comment"># 将以下内容追加到末尾</span>
<span class="hljs-built_in">export</span> MAVEN_HOME=/opt/data/maven3.8
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$MAVEN_HOME</span>/bin
<span class="hljs-comment"># 刷新环境变量</span>
<span class="hljs-built_in">source</span> /etc/profile
</code></pre>
<h2 data-id="heading-3">四、验证安装结果</h2>
<p>执行版本查看命令，验证安装是否成功</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看Maven版本信息，验证安装及配置</span>
mvn -v
</code></pre>
<p>输入如图所示即为安装成功
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a413dbd5496408fb19a095c907340c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770089947&amp;x-signature=HhPYVhTPbEG756pjJpefM8OCcDA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">五、配置国内镜像，本地仓库地址</h2>
<p>默认Maven镜像为国外源，下载依赖较慢，配置阿里云镜像大幅提升速度</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑配置文件</span>
vim /opt/data/maven3.8/conf/setting.xml
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 增加如下标签，设置本地仓库地址 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>&gt;</span>/opt/data/maven3.8/repository<span class="hljs-tag">&lt;/<span class="hljs-name">localRepository</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 在mirrors标签中增加如下内容 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>*<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 工业级视频流处理：从 FFmpeg 管道优化到非结构化数据清洗]]></title>    <link>https://juejin.cn/post/7599640782569209883</link>    <guid>https://juejin.cn/post/7599640782569209883</guid>    <pubDate>2026-01-27T03:45:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782569209883" data-draft-id="7599641289885990958" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 工业级视频流处理：从 FFmpeg 管道优化到非结构化数据清洗"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-27T03:45:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FT542"/> <meta itemprop="url" content="https://juejin.cn/user/3423222479199755"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 工业级视频流处理：从 FFmpeg 管道优化到非结构化数据清洗
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3423222479199755/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FT542
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:45:39.000Z" title="Tue Jan 27 2026 03:45:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">1. 拒绝临时文件：基于内存管道的帧提取</h4>
<p>传统的 <code>os.system('ffmpeg -i ...')</code> 调用方式会产生大量磁盘 IO，导致处理速度受限于硬盘读写。在工程实践中，我们应当利用 Stdin/Stdout 管道直接在内存中交换数据。</p>
<p>以下是一个封装好的高性能抽帧类，利用 <code>ffmpeg-python</code> 库实现：</p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> ffmpeg
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoPipeLoader</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, file_path</span>):
        self.file_path = file_path
        <span class="hljs-comment"># 获取视频元数据</span>
        self.probe = ffmpeg.probe(file_path)
        self.video_stream = <span class="hljs-built_in">next</span>((stream <span class="hljs-keyword">for</span> stream <span class="hljs-keyword">in</span> self.probe[<span class="hljs-string">'streams'</span>] <span class="hljs-keyword">if</span> stream[<span class="hljs-string">'codec_type'</span>] == <span class="hljs-string">'video'</span>), <span class="hljs-literal">None</span>)
        self.width = <span class="hljs-built_in">int</span>(self.video_stream[<span class="hljs-string">'width'</span>])
        self.height = <span class="hljs-built_in">int</span>(self.video_stream[<span class="hljs-string">'height'</span>])

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_frame_as_array</span>(<span class="hljs-params">self, frame_num</span>):
        <span class="hljs-string">"""
        利用 seek 和 pipe 直接读取特定帧到 numpy 数组，无磁盘交互
        """</span>
        out, _ = (
            ffmpeg
            .<span class="hljs-built_in">input</span>(self.file_path, ss=frame_num * <span class="hljs-number">0.04</span>) <span class="hljs-comment"># 假设25fps</span>
            .<span class="hljs-built_in">filter</span>(<span class="hljs-string">'scale'</span>, self.width, self.height)
            .output(<span class="hljs-string">'pipe:'</span>, <span class="hljs-built_in">format</span>=<span class="hljs-string">'rawvideo'</span>, pix_fmt=<span class="hljs-string">'rgb24'</span>, vframes=<span class="hljs-number">1</span>)
            .run(capture_stdout=<span class="hljs-literal">True</span>, capture_stderr=<span class="hljs-literal">True</span>)
        )
        <span class="hljs-keyword">return</span> np.frombuffer(out, np.uint8).reshape([self.height, self.width, <span class="hljs-number">3</span>])

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-comment"># loader = VideoPipeLoader('input_video.mp4')</span>
<span class="hljs-comment"># frame_data = loader.read_frame_as_array(100)</span>
</code></pre>
<h4 data-id="heading-1">2. 数据清洗中的“噪声”对抗与 Mask 原理</h4>
<p>在构建训练集（如 OCR 识别或动作捕捉）时，原始素材中自带的平台水印、硬字幕或贴纸被视为“视觉噪声”。如果直接丢入模型，会导致特征提取发生偏移。</p>
<p>要通过算法去除这些噪声，核心在于构建 Mask（掩膜）。OpenCV 的 <code>inpaint</code> 方法虽然能修复，但前提是必须提供精准的 Mask。在自动化流水线中，我们通常采用<strong>差分法</strong>或<strong>HSV颜色阈值分割</strong>来生成 Mask。</p>
<p>例如，针对白色透明水印，我们可以转换到 HSV 空间提取高亮区域：</p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini">import cv2

def create_watermark_mask(image):
    <span class="hljs-comment"># 转换到 HSV 空间</span>
    <span class="hljs-attr">hsv</span> = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)
    <span class="hljs-comment"># 设定水印的颜色范围（示例：白色透明水印）</span>
    <span class="hljs-attr">lower_white</span> = np.array([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>])
    <span class="hljs-attr">upper_white</span> = np.array([<span class="hljs-number">180</span>, <span class="hljs-number">25</span>, <span class="hljs-number">255</span>])
    <span class="hljs-attr">mask</span> = cv2.inRange(hsv, lower_white, upper_white)
    <span class="hljs-comment"># 膨胀操作，确保覆盖边缘</span>
    <span class="hljs-attr">kernel</span> = np.<span class="hljs-literal">on</span>es((<span class="hljs-number">3</span>,<span class="hljs-number">3</span>), np.uint8)
    return cv2.dilate(mask, kernel, <span class="hljs-attr">iterations</span>=<span class="hljs-number">1</span>)
</code></pre>
<p>然而，在面对复杂动态背景时，单纯依靠 OpenCV 的传统算法往往耗时且残留严重。在工业级链路中，通常采用“前置清洗”策略，即在数据进入 Pipeline 之前，利用专用工具完成清洗。</p>
<hr/>
<p><strong>【 🛠️ 2025 后端数据工程·高效工具栈盘点 】</strong></p>
<p>为了提升数据处理流水线的吞吐量与质量，建议组合使用以下工具，分别覆盖编解码、清洗、计算与服务化环节：</p>



































<table><thead><tr><th><strong>工具分类</strong></th><th><strong>推荐工具</strong></th><th><strong>核心价值与应用场景</strong></th></tr></thead><tbody><tr><td><strong>流媒体处理</strong></td><td><strong>FFmpeg</strong></td><td>音视频处理的基石。建议编译时开启硬件加速（NVENC/QSV）以提升转码效率。</td></tr><tr><td><strong>素材清洗/预处理</strong></td><td><strong>香蕉一键去水印 (小程序)</strong></td><td><strong>数据清洗环节的“前置过滤器”。在批量获取竞品视频或构建无标数据集时，它能通过AI算法自动识别并抹除主流平台的Logo和水印，直接解析出Clean Data，大幅降低后续OpenCV处理的复杂度。</strong></td></tr><tr><td><strong>计算库</strong></td><td><strong>NumPy / Pandas</strong></td><td>这里的标配。处理矩阵运算和元数据清洗的核心库。</td></tr><tr><td><strong>任务调度</strong></td><td><strong>Apache Airflow</strong></td><td>适合编排复杂的 DAG 工作流，监控视频处理任务的依赖关系。</td></tr><tr><td><strong>Web框架</strong></td><td><strong>FastAPI</strong></td><td>高性能的 Python 异步框架，适合将上述处理逻辑封装为微服务 API。</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[消息队列——RabbitMQ（基础）]]></title>    <link>https://juejin.cn/post/7599640782569291803</link>    <guid>https://juejin.cn/post/7599640782569291803</guid>    <pubDate>2026-01-27T04:08:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782569291803" data-draft-id="7598370121434890290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="消息队列——RabbitMQ（基础）"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-27T04:08:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="让我上个超影吧"/> <meta itemprop="url" content="https://juejin.cn/user/3411151088782442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            消息队列——RabbitMQ（基础）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411151088782442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    让我上个超影吧
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:08:34.000Z" title="Tue Jan 27 2026 04:08:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、知识结构图</h2>
<p>我是按照黑马的笔记大概整理了一个结构图，用于总体回顾和学习一下，<a href="https://link.juejin.cn?target=https%3A%2F%2Fb11et3un53m.feishu.cn%2Fwiki%2FOQH4weMbcimUSLkIzD6cCpN0nvc" target="_blank" title="https://b11et3un53m.feishu.cn/wiki/OQH4weMbcimUSLkIzD6cCpN0nvc" ref="nofollow noopener noreferrer">b11et3un53m.feishu.cn/wiki/OQH4we…</a>这是黑马的笔记地址，有需要的同学可以看一下
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3703e2a7baf94d1c872f308b28bd130c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092060&amp;x-signature=2WomT6AZBb%2B4U%2F%2FLNxNzUPJ0GN4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-1">二、消息队列的类型</h2>
<p>以下是当前常见的消息队列类型及其对比分析，涵盖核心类型、代表实现、关键特性及适用场景：</p>
<h2 data-id="heading-2">1.主流消息队列实现对比</h2>





























































































<table><thead><tr><th><strong>维度</strong></th><th><strong>RabbitMQ</strong></th><th><strong>Kafka</strong></th><th><strong>RocketMQ</strong></th><th><strong>Pulsar</strong></th><th><strong>ActiveMQ</strong></th></tr></thead><tbody><tr><td><strong>消息模型</strong></td><td>P2P、发布订阅（基于Exchange）</td><td>发布订阅（分区Topic）</td><td>发布订阅（Topic+Tag）</td><td>发布订阅（支持多租户Topic）</td><td>P2P、发布订阅（JMS标准）</td></tr><tr><td><strong>底层协议</strong></td><td>AMQP、MQTT、STOMP</td><td>自定义二进制协议</td><td>自定义协议（支持HTTP/2扩展）</td><td>Pulsar协议（支持HTTP/2、MQTT）</td><td>JMS、AMQP、MQTT、OpenWire</td></tr><tr><td><strong>吞吐量</strong></td><td>中低（万级TPS）</td><td>极高（百万级TPS，依赖分区数）</td><td>高（十万级TPS，顺序写入优化）</td><td>高（分层存储架构，支持多租户隔离）</td><td>低（单节点瓶颈，适合小规模）</td></tr><tr><td><strong>延迟</strong></td><td>低（毫秒级，适合实时场景）</td><td>低（毫秒级，批量处理时稍高）</td><td>低（毫秒级，优化网络和存储）</td><td>低（基于BookKeeper的高速存储）</td><td>中低（单节点下延迟可控）</td></tr><tr><td><strong>持久化</strong></td><td>磁盘持久化（支持内存队列）</td><td>磁盘顺序写入（日志分段存储，支持长期保留）</td><td>磁盘顺序写入（CommitLog机制）</td><td>分层存储（内存+BookKeeper持久化）</td><td>磁盘/内存持久化（JMS标准实现）</td></tr><tr><td><strong>集群能力</strong></td><td>分布式集群（Erlang节点，支持镜像队列）</td><td>分布式分区集群（ZooKeeper/Kafka Raft）</td><td>分布式集群（主从/DLedger Raft）</td><td>分布式集群（分层架构，无中心节点）</td><td>简单集群（主从/静态集群，扩展性有限）</td></tr><tr><td><strong>生态系统</strong></td><td>丰富（插件生态，支持多语言客户端）</td><td>成熟（Kafka Connect、Streams生态）</td><td>完善（阿里生态，支持Spring Cloud）</td><td>新兴（与Kafka生态兼容，Function支持）</td><td>传统（JMS生态，兼容性强但更新慢）</td></tr><tr><td><strong>典型场景</strong></td><td>企业级解耦、微服务通信、实时通知</td><td>日志收集、实时流处理、大数据管道</td><td>电商订单处理、分布式事务、顺序消息</td><td>多租户云原生场景、边缘计算、流处理</td><td>遗留系统集成、小规模企业应用</td></tr><tr><td><strong>优势</strong></td><td>轻量级、协议支持全、社区活跃</td><td>高吞吐量、可扩展性、消息回溯</td><td>事务消息、顺序消息、高可用性</td><td>云原生架构、分层存储、跨地域复制</td><td>兼容性强、易于部署（早期市场主流）</td></tr><tr><td><strong>劣势</strong></td><td>高并发下内存开销大、集群管理较复杂</td><td>消息顺序仅保证分区内、运维成本较高</td><td>生态依赖阿里、客户端语言支持较少</td><td>生态成熟度低于Kafka、学习曲线较陡</td><td>性能瓶颈明显、社区活跃度下降</td></tr></tbody></table>
<h3 data-id="heading-3">2.选型建议</h3>
<blockquote>
<ul>
<li><strong>中小规模业务/低延迟场景</strong>：选RabbitMQ（协议灵活）或RocketMQ（轻量高效）。</li>
<li><strong>高吞吐量/流处理场景</strong>：选Kafka（大数据生态适配）或Pulsar（云原生架构）。</li>
<li><strong>复杂业务逻辑/事务需求</strong>：选RocketMQ（事务消息、顺序消息）。</li>
<li><strong>遗留系统集成/简单解耦</strong>：选ActiveMQ（兼容性强，但需注意性能瓶颈）。</li>
</ul>
</blockquote>
<p>根据实际需求（如吞吐量、延迟、可靠性、生态适配）选择合适的类型和实现，分布式消息队列已成为主流，尤其在微服务、实时数据处理和云原生架构中优势显著。</p>
<h2 data-id="heading-4">三、收发消息</h2>
<h3 data-id="heading-5">1.交换机（Exchanges）</h3>
<h4 data-id="heading-6">1.1Fanout交换机</h4>
<h5 data-id="heading-7">①流程</h5>
<p>Fanout，英文翻译是扇出，在MQ中叫广播更合适。
在广播模式下，消息发送流程是这样的：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0432fefcfb914ada98b5f19e18859415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092060&amp;x-signature=9gHp05zbeeBpBMOl%2FGmTqngAj1A%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h5 data-id="heading-8">②总结交换机的作用</h5>
<blockquote>
<ul>
<li>接收publisher发送的消息</li>
<li>将消息按照规则路由到与之绑定的队列</li>
<li>不能缓存消息，路由失败，消息丢失</li>
<li>FanoutExchange的会将消息路由到每个绑定的队列</li>
</ul>
</blockquote>
<h4 data-id="heading-9">1.2Direct交换机</h4>
<h5 data-id="heading-10">①流程</h5>
<p>在Direct模型下：</p>
<blockquote>
<ul>
<li>队列与交换机的绑定，不能是任意绑定了，而是要指定一个RoutingKey（路由key）</li>
<li>消息的发送方在 向 Exchange发送消息时，也必须指定消息的 RoutingKey。</li>
<li>Exchange不再把消息交给每一个绑定的队列，而是根据消息的Routing Key进行判断，只有队列的Routingkey与消息的 Routing key完全一致，才会接收到消息</li>
</ul>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06c7391b15ca4da6b2b8e3032f3f5a85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092060&amp;x-signature=%2BaJWNzZH9LMDZv9RFRGtLZzuqQU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h5 data-id="heading-11">②总结（描述下Direct交换机与Fanout交换机的差异？）</h5>
<ul>
<li>Fanout交换机将消息路由给每一个与之绑定的队列</li>
<li>Direct交换机根据RoutingKey判断路由给哪个队列</li>
<li>如果多个队列具有相同的RoutingKey，则与Fanout功能类似</li>
</ul>
<h4 data-id="heading-12">1.3Topic交换机</h4>
<h5 data-id="heading-13">①流程</h5>
<p>Topic类型的Exchange与Direct相比，都是可以根据RoutingKey把消息路由到不同的队列。
只不过Topic类型Exchange可以让队列在绑定BindingKey 的时候使用通配符！</p>
<p>BindingKey 一般都是有一个或多个单词组成，多个单词之间以.分割，例如： item.insert</p>
<p>通配符规则：</p>
<ul>
<li>#：匹配一个或多个词</li>
<li>*：匹配不多不少恰好1个词</li>
</ul>
<p>举例：</p>
<ul>
<li>item.#：能够匹配item.spu.insert 或者 item.spu</li>
<li>item.*：只能匹配item.spu
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2a03384d0d24c259a7fac6133370625~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092060&amp;x-signature=LEtfBHrzKUD9jInFwBuSbVaSaP0%3D" alt="在这里插入图片描述" loading="lazy"/></li>
</ul>
<h5 data-id="heading-14">②总结（描述下Direct交换机与Topic交换机的差异？）</h5>
<ul>
<li>Topic交换机接收的消息RoutingKey必须是多个单词，以 . 分割</li>
<li>Topic交换机与队列绑定时的bindingKey可以指定通配符</li>
<li>#：代表0个或多个词</li>
<li>*：代表1个词</li>
</ul>
<h2 data-id="heading-15">四、SpringAMQP</h2>
<h3 data-id="heading-16">1.功能</h3>
<ul>
<li>自动声明队列、交换机及其绑定关系</li>
<li>基于注解的监听器模式，异步接收消息</li>
<li>封装了RabbitTemplate工具，用于发送消息</li>
</ul>
<h3 data-id="heading-17">2.需要的依赖</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--AMQP依赖，包含RabbitMQ--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-18">3.声明队列和交换机</h3>
<h4 data-id="heading-19">3.1基于bean声明</h4>
<p>direct模式由于要绑定多个KEY，会非常麻烦，每一个Key都要编写一个binding</p>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-keyword">package</span> com.itheima.consumer.config;

    <span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
    <span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
    <span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

    <span class="hljs-meta">@Configuration</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectConfig</span> {

        <span class="hljs-comment">/**
         * 声明交换机
         * <span class="hljs-doctag">@return</span> Direct类型交换机
         */</span>
        <span class="hljs-meta">@Bean</span>
        <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">directExchange</span><span class="hljs-params">()</span>{
            <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(<span class="hljs-string">"hmall.direct"</span>).build();
        }

        <span class="hljs-comment">/**
         * 第1个队列
         */</span>
        <span class="hljs-meta">@Bean</span>
        <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">directQueue1</span><span class="hljs-params">()</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">"direct.queue1"</span>);
        }

        <span class="hljs-comment">/**
         * 绑定队列和交换机
         */</span>
        <span class="hljs-meta">@Bean</span>
        <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingQueue1WithRed</span><span class="hljs-params">(Queue directQueue1, DirectExchange directExchange)</span>{
            <span class="hljs-keyword">return</span> BindingBuilder.bind(directQueue1).to(directExchange).with(<span class="hljs-string">"red"</span>);
        }
        <span class="hljs-comment">/**
         * 绑定队列和交换机
         */</span>
        <span class="hljs-meta">@Bean</span>
        <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingQueue1WithBlue</span><span class="hljs-params">(Queue directQueue1, DirectExchange directExchange)</span>{
            <span class="hljs-keyword">return</span> BindingBuilder.bind(directQueue1).to(directExchange).with(<span class="hljs-string">"blue"</span>);
        }

        <span class="hljs-comment">/**
         * 第2个队列
         */</span>
        <span class="hljs-meta">@Bean</span>
        <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">directQueue2</span><span class="hljs-params">()</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Queue</span>(<span class="hljs-string">"direct.queue2"</span>);
        }

        <span class="hljs-comment">/**
         * 绑定队列和交换机
         */</span>
        <span class="hljs-meta">@Bean</span>
        <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingQueue2WithRed</span><span class="hljs-params">(Queue directQueue2, DirectExchange directExchange)</span>{
            <span class="hljs-keyword">return</span> BindingBuilder.bind(directQueue2).to(directExchange).with(<span class="hljs-string">"red"</span>);
        }
        <span class="hljs-comment">/**
         * 绑定队列和交换机
         */</span>
        <span class="hljs-meta">@Bean</span>
        <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">bindingQueue2WithYellow</span><span class="hljs-params">(Queue directQueue2, DirectExchange directExchange)</span>{
            <span class="hljs-keyword">return</span> BindingBuilder.bind(directQueue2).to(directExchange).with(<span class="hljs-string">"yellow"</span>);
        }
    }

</code></pre>
<h4 data-id="heading-20">3.2基于注解声明</h4>
<p>基于@Bean的方式声明队列和交换机比较麻烦，Spring还提供了基于注解方式来声明。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RabbitListener</span>(bindings = <span class="hljs-variable">@QueueBinding</span>(
    value = <span class="hljs-variable">@Queue</span>(name = <span class="hljs-string">"direct.queue1"</span>),
    exchange = <span class="hljs-variable">@Exchange</span>(name = <span class="hljs-string">"hmall.direct"</span>, type = ExchangeTypes.DIRECT),
    key = {<span class="hljs-string">"red"</span>, <span class="hljs-string">"blue"</span>}
))
public void <span class="hljs-built_in">listenDirectQueue1</span>(String msg){
    <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"消费者1接收到direct.queue1的消息：【"</span> + msg + <span class="hljs-string">"】"</span>);
}

@<span class="hljs-selector-tag">RabbitListener</span>(bindings = <span class="hljs-variable">@QueueBinding</span>(
    value = <span class="hljs-variable">@Queue</span>(name = <span class="hljs-string">"direct.queue2"</span>),
    exchange = <span class="hljs-variable">@Exchange</span>(name = <span class="hljs-string">"hmall.direct"</span>, type = ExchangeTypes.DIRECT),
    key = {<span class="hljs-string">"red"</span>, <span class="hljs-string">"yellow"</span>}
))
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">listenDirectQueue2</span>(String msg){
    <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-string">"消费者2接收到direct.queue2的消息：【"</span> + msg + <span class="hljs-string">"】"</span>);
}
</code></pre>
<h3 data-id="heading-21">4.消息转换器</h3>
<h4 data-id="heading-22">4.1默认消息转换器</h4>
<p>Spring的消息发送代码接收的消息体是一个Object：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/552823cff2164b9e8d398dec931b5a71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092060&amp;x-signature=8Kol4X3FtqBh8ba7O9SFCyrbxH0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>而在数据传输时，它会把你发送的消息序列化为字节发送给MQ，接收消息的时候，还会把字节反序列化为Java对象。
只不过，默认情况下Spring采用的序列化方式是JDK序列化。众所周知，JDK序列化存在下列问题：</p>
<blockquote>
<ul>
<li>数据体积过大</li>
<li>有安全漏洞</li>
<li>可读性差</li>
</ul>
</blockquote>
<h4 data-id="heading-23">4.2配置JSON转换器</h4>
<p>JDK序列化方式并不合适。我们希望消息体的体积更小、可读性更高，因此可以使用JSON方式来做序列化和反序列化。
①引入依赖（注意，如果项目中引入了spring-boot-starter-web依赖，则无需再次引入Jackson依赖。）</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>②在配置类中添加一个bean</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> MessageConverter <span class="hljs-title function_">messageConverter</span><span class="hljs-params">()</span>{
    <span class="hljs-comment">// 1.定义消息转换器</span>
    <span class="hljs-type">Jackson2JsonMessageConverter</span> <span class="hljs-variable">jackson2JsonMessageConverter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonMessageConverter</span>();
    <span class="hljs-comment">// 2.配置自动创建消息id，用于识别不同消息，也可以在业务中基于ID判断是否是重复消息</span>
    jackson2JsonMessageConverter.setCreateMessageIds(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">return</span> jackson2JsonMessageConverter;
}
</code></pre>
<h2 data-id="heading-24">五、WorkQueues模型</h2>
<p>Work queues，任务模型。简单来说就是让多个消费者绑定到一个队列，共同消费队列中的消息
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/426946ecaf404df88620e722eef35ad0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092060&amp;x-signature=z%2BzRpNfPOL9FSEhbsMG5ZptTmfU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>Work模型的使用：</p>
<ul>
<li>多个消费者绑定到一个队列，同一条消息只会被一个消费者处理</li>
<li>通过设置prefetch来控制消费者预取的消息数量（默认是平均分配消息给每个队列）</li>
</ul>
<p><strong>感兴趣的宝子可以关注一波，后续会更新更多有用的知识！！！</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8600d619cacd4d02a45e7b9d8a8057aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092060&amp;x-signature=YE0%2BVZggYnq9tCbwoNvxIcJJhSI%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[员工管理系统：基于Java Swing，哈希表和IO流实现]]></title>    <link>https://juejin.cn/post/7599601258640244774</link>    <guid>https://juejin.cn/post/7599601258640244774</guid>    <pubDate>2026-01-27T04:24:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599601258640244774" data-draft-id="7599604510366367782" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="员工管理系统：基于Java Swing，哈希表和IO流实现"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-27T04:24:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="让我上个超影吧"/> <meta itemprop="url" content="https://juejin.cn/user/3411151088782442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            员工管理系统：基于Java Swing，哈希表和IO流实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411151088782442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    让我上个超影吧
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:24:39.000Z" title="Tue Jan 27 2026 04:24:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1小时+
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"> 1.需求分析</h2>
<h3 data-id="heading-1">1.1 功能需求</h3>
<p>1.1.1登录信息模块：</p>
<p>    用户登录：用户在登录界面输入账户名和密码，系统验证输入的信息与存储在 <code>User.csv</code> 文件中的管理员信息是否匹配。若匹配，跳转到主界面；若不匹配，弹出提示框告知用户登录失败。</p>
<p>    用户注册：提供注册按钮，点击后跳转到注册界面，实现新用户的注册功能。</p>
<p>    数据存储：从 <code>User.csv</code> 文件读取管理员账户名和密码信息到哈希表 <code>userMap</code> 中，用于登录验证；登录信息发生变化时（如新增用户注册），可将哈希表中的数据写回 <code>User.csv</code> 文件。</p>
<p>1.1.2员工管理模块：</p>
<p>    数据展示：从 <code>Emps.csv</code> 文件读取员工信息到哈希表 <code>employeeMap</code> 中，并以表格形式展示在 <code>EmpUI</code> 界面上，表格包含员工 ID、姓名、性别、出生年月、工作年月、学历、部门、住址、电话等字段。</p>
<p>    新增员工：在 <code>EmpUI</code> 界面提供“新增员工”按钮，点击后弹出新增员工窗口（<code>AddEmpUI</code>），用于添加新员工信息。</p>
<p>    查询员工：在 <code>EmpUI</code> 界面提供搜索框和“查询员工”按钮，用户输入姓名进行模糊查询，系统在哈希表中匹配员工信息并展示在表格中；若未找到匹配信息，弹出提示框告知用户。</p>
<p>    排序员工：在 <code>EmpUI</code> 界面提供排序下拉列表框，可按员工姓名进行升序（a -&gt; z）或降序（z -&gt; a）排序，排序后刷新表格展示。</p>
<p>    编辑员工：在表格上右键点击某一员工行，弹出右键菜单，选择“编辑”可打开编辑窗口（<code>EditEmpUI</code>）对该员工信息进行修改。</p>
<p>    删除员工：在表格上右键点击某一员工行，弹出右键菜单，选择“删除”，弹出确认对话框，确认后从哈希表和表格中删除该员工信息，并将更新后的数据写回 <code>Emps.csv</code> 文件。</p>
<p>1.1.3部门管理模块：</p>
<p>    数据展示：从 <code>Dept.csv</code> 文件读取部门信息到哈希表 <code>deptMap</code> 中，并以表格形式展示在 <code>DeptUI</code> 界面上，表格包含部门 ID、部门名称、负责人、成立日期等字段。</p>
<p>    新增部门：在 <code>DeptUI</code> 界面提供“新增部门”按钮，点击后弹出新增部门窗口（<code>AddDeptUI</code>），用于添加新部门信息。</p>
<p>    查询部门：在 <code>DeptUI</code> 界面提供搜索框和“查询部门”按钮，用户输入部门名称进行模糊查询，系统在哈希表中匹配部门信息并展示在表格中；若未找到匹配信息，弹出提示框告知用户。</p>
<p>    排序部门：在 <code>DeptUI</code> 界面提供排序下拉列表框，可按部门名称进行升序（a -&gt; z）或降序（z -&gt; a）排序，排序后刷新表格展示。</p>
<p>    编辑部门：在表格上右键点击某一部门行，弹出右键菜单，选择“编辑”可打开编辑窗口（<code>EditDeptUI</code>）对该部门信息进行修改。</p>
<p>    删除部门：在表格上右键点击某一部门行，弹出右键菜单，选择“删除”，弹出确认对话框，确认后从哈希表和表格中删除该部门信息，并将更新后的数据写回 <code>Dept.csv</code> 文件。</p>
<h3 data-id="heading-2">1.2 性能需求</h3>
<p>响应时间：对于常见操作，如登录、查询、排序等，系统应在短时间内（如不超过 3 秒）给出响应，以提供流畅的用户体验。</p>
<p>数据加载：在启动系统或切换界面时，加载员工和部门信息的时间应尽量短，尤其是在数据量较大的情况下，需优化文件读取和数据处理逻辑，确保界面能快速展示数据。</p>
<h3 data-id="heading-3">1.3 可靠性和可用性需求</h3>
<p>数据可靠性：系统应保证数据的完整性和准确性，在数据读取、写入和修改操作时，需进行错误处理，防止数据丢失或损坏。例如，在写入文件失败时，应弹出提示框告知用户，并保留原有数据。</p>
<p>系统可用性：系统应具备较高的可用性，确保在正常使用情况下，不会频繁出现崩溃或无响应的情况。在出现异常情况（如文件损坏、内存不足等）时，应提供合理的错误提示，引导用户进行相应处理，尽量保证系统的部分功能仍可使用。</p>
<h3 data-id="heading-4">1.4 错误处理需求</h3>
<p>文件操作错误：在读取或写入 <code>User.csv</code>、<code>Emps.csv</code>、<code>Dept.csv</code> 文件时，若发生文件不存在、读写权限不足等错误，应捕获异常并弹出相应的错误提示框，告知用户错误原因，如“文件不存在，请检查文件路径”或“写入文件失败，可能是权限不足”。</p>
<p>输入验证错误：在用户进行登录、注册、新增员工或部门等操作时，应对用户输入进行合法性验证。例如，登录时账户名或密码为空，应弹出提示框告知用户“请输入账户名和密码”；新增员工时，若关键信息（如员工 ID、姓名等）为空，也应提示用户输入完整信息。</p>
<p>其他运行时错误：对于其他可能出现的运行时错误（如哈希表操作异常、界面组件初始化失败等），应捕获异常并记录错误日志（若有日志功能），同时向用户弹出友好的错误提示框，告知用户系统出现问题，并建议用户重试或联系管理员。</p>
<h3 data-id="heading-5">1.5 将来可能要提出的需求</h3>
<p>权限管理：增加不同用户角色（如管理员、普通员工）及其权限设置，不同角色可进行的操作（如新增、编辑、删除等）有所限制。</p>
<p>数据统计与分析：对员工和部门信息进行统计分析，如统计各部门员工数量、各学历层次员工分布等，并以图表形式展示统计结果。</p>
<h3 data-id="heading-6">1.6建立数据模型——ER图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa617a29eaf14952aa3c79acc11ca4b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=jFcvb1IHNijb4d%2FhYqVy8rE4Xuk%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图1-1 员工和部门关系ER图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d1795a5ee46490e961c4f689bd41e95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=fydHMJFL6lw5%2BqNikH0Fdi%2FZApc%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图1-2 登录关系ER图</p>
<h2 data-id="heading-7">2.概要设计</h2>
<h3 data-id="heading-8">2.1 设计哈希表的抽象数据类型定义：</h3>
<p>ADT MyHashMap {<br/>
数据对象：D={ (ki, vi) | ki∈KeySet, vi∈ValueSet, i=1…n, n≥0 }<br/>
数据关系：R={&lt;ei, ej&gt; | ei, ej∈D, i≠j, ei.key ≠ ej.key}</p>
<p>基本操作：<br/>
MyHashMap()<br/>
操作结果：创建一个空的哈希表，初始容量为16，负载因子为0.75。</p>
<p>put(K key, V value)<br/>
操作结果：将键key和值value插入到哈希表中。如果键key已存在，则更新对应的值为value。如果插入后哈希表的元素数量超过扩容阈值，则进行扩容。</p>
<p>get(K key)<br/>
操作结果：根据键key返回对应的值。如果键不存在，则返回null。<br/>
remove(K key)<br/>
操作结果：根据键key移除对应的条目，并返回该条目的值。如果键不存在，则返回null。</p>
<p>size()<br/>
操作结果：返回哈希表中条目的数量。</p>
<p>values()<br/>
操作结果：返回哈希表中所有值的列表。</p>
<p>keys()<br/>
操作结果：返回哈希表中所有键的列表。</p>
<p>sortByNameAsc(MyHashMap&lt;String, V&gt; map)<br/>
操作结果：返回键按升序排序后的键数组。</p>
<p>sortByNameDesc(MyHashMap&lt;String, V&gt; map)<br/>
操作结果：返回键按降序排序后的键数组。</p>
<p>}ADT MyHashMap;</p>
<h3 data-id="heading-9">2.2本程序模块结构</h3>
<p>① 登录模块</p>
<p>② 员工界面管理模块</p>
<p>③ 部门界面管理模块</p>
<p>④ 哈希表数据结构类型模块</p>
<p>   <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/603775c53e9543c7a790f35e811c61ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=lKPSQ5eSJoCXEd9ugXXJhoTpEBM%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图2-1 员工管理系统功能结构图</p>
<h2 data-id="heading-10">3.详细设计</h2>
<h3 data-id="heading-11">3.1 模块功能设计</h3>
<p>3.1.1哈希表模块</p>
<p>①哈希表设计概述</p>
<p>数据结构：使用数组 table 来存储哈希表的桶（bucket），每个桶是一个链表，用于解决哈希冲突。</p>
<p>初始容量：初始容量为 16，定义为 INITIAL_CAPACITY。</p>
<p>负载因子：负载因子为 0.75，定义为 LOAD_FACTOR。当哈希表中的元素数量达到扩容阈值（容量 * 负载因子）时，会进行扩容。</p>
<p>②哈希函数</p>
<p>哈希函数 hash （除留余数法）用于计算键的哈希值，并确定键值对在哈希表中的存储位置。</p>
<p>③哈希冲突解决</p>
<p>哈希冲突通过链地址法（separate chaining）解决。当多个键映射到同一个桶时，这些键值对以链表的形式存储在该桶中。</p>
<p>在插入操作 put 中，如果发现桶中已有元素（即发生哈希冲突），会遍历链表查找是否存在相同的键。如果存在，则更新值；否则，将新的键值对添加到链表末尾。</p>
<p>3.1.2登录模块</p>
<p>功能说明：</p>
<p>注册功能：新用户默认没有账户，进行注册后将账号存入账号文件user.csv中，每次系统启动都会加载这份文件并填入哈希表，只要注册一次，无论程序是否关闭不影响账号信息</p>
<p>登录功能：程序启动后，user.csv文件加载到哈希表中，账号作为哈希表的键，密码作为哈希表的值，根据用户输入的账号名称来在哈希表中进行键值匹配，匹配成功则登录成功，匹配失败则弹出登录错误。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b895f76816594f56990fa00408ca15ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=%2BjgxZFBvT6cSuA0ys7vXXgirxA0%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-1 登录模块流程图</p>
<p>3.1.3员工信息管理模块</p>
<p>功能说明：</p>
<p>① 员工信息的增删改查</p>
<p>添加员工：用户可以通过表单输入员工的详细信息（如 ID、姓名、性别、出生年月、工作年月、学历、部门、住址、电话），其中部门的选择是从部门哈希表中读取的，部门的数量变化会影响新增员工页面的选择。点击“添加”按钮后，系统会验证输入是否合法，然后将新员工信息保存到内存中的 employeeMap 中，并刷新表格显示。同时，系统会将新的员工信息写入文件，以实现持久化存储。</p>
<p>删除员工：用户可以选择表格中的某一行，点击“删除”按钮后，系统会弹出确认对话框，询问用户是否确定删除。如果用户确认删除，系统会从 employeeMap 中移除对应的员工信息，并刷新表格显示。同时，系统会更新文件中的员工信息。</p>
<p>修改员工：用户可以选择表格中的某一行，点击“编辑”按钮后，系统会打开一个编辑窗口，允许用户修改员工的详细信息。修改完成后，点击“保存”按钮，系统会更新 employeeMap 中的员工信息，并刷新表格显示。同时，系统会将更新后的员工信息写入文件。</p>
<p>查询员工：用户可以在搜索框中输入员工的姓名或部分姓名，点击“查询”按钮后，系统会在 employeeMap 中查找匹配的员工信息，并在表格中显示结果。</p>
<p>如果没有找到匹配的员工，系统会弹出提示框，告知用户未找到相关记录。</p>
<p>员工排序：系统提供了两种排序方式：按员工名字的字典顺序进行升序排序（AZ）或降序排序（ZA）。用户可以通过点击表格标题栏中的“姓名”列来切换排序方式。</p>
<p>② 员工信息的持久化</p>
<p>保存员工信息：每次对员工信息进行添加、删除或修改操作后，系统会自动将最新的员工信息写入文件，确保数据不会丢失。</p>
<p>加载员工信息：程序启动时，系统会从文件中读取员工信息，并将其加载到 employeeMap 中，以便用户可以立即查看和操作这些数据。</p>
<p>③ 用户界面优化</p>
<p>表格展示：使用 JTable 组件展示员工信息，表格列包括员工 ID、姓名、性别、出生年月、工作年月、学历、部门、住址、电话等。表格支持排序功能，用户可以点击排序对名字进行升序或降序排序。</p>
<p>搜索功能：提供一个搜索框，用户可以在其中输入员工的姓名或部分姓名，系统会实时过滤表格中的数据，显示匹配的员工信息。如果用户清空搜索框，表格会恢复显示所有员工信息。</p>
<p>右键菜单：当用户右键点击表格中的某一行时，会弹出一个上下文菜单，提供“编辑”、“删除”等操作选项，方便用户快速操作。</p>
<p>④ 数据验证</p>
<p>必填项验证：在添加或修改员工信息时，系统会检查所有必填项（如姓名、性别、出生年月、工作年月、学历、部门、住址、电话）是否已填写。如果用户未填写必填项，系统会弹出提示框，要求用户补充完整信息。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f2dfac684074f4896fe285a1524e69d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=o84IPcNedX1axMEqcEqZX0C3Qkk%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-2 员工信息管理模块流程图</p>
<p>3.1.4部门信息管理模块</p>
<p>①添加部门</p>
<p>用户操作：用户可以通过表单输入部门的详细信息，包括部门 ID、名称、负责人、创建时间。点击“添加”按钮后，系统会验证输入是否合法，确保所有必填项已填写且没有空。如果验证通过，系统会将新部门信息保存到部门哈希表中中，并刷新表格显示。同时，系统会将新的部门信息写入文件，以实现持久化存储。</p>
<p>②删除部门</p>
<p>用户操作：用户可以选择表格中的某一行，右键点击该行并选择“删除部门”选项，或者直接点击表格上方的“删除”按钮。系统会弹出确认对话框，询问用户是否确定删除该部门。如果用户确认删除，系统会从哈希表中移除对应的部门信息，并刷新表格显示。同时，系统会更新文件中的部门信息。</p>
<p>③修改部门</p>
<p>用户操作：用户可以选择表格中的某一行，右键点击该行并选择“编辑部门”选项，或者直接点击表格上方的“编辑”按钮。系统会打开一个编辑窗口，允许用户修改部门的详细信息，如名称、负责人、描述等。修改完成后，点击“保存”按钮，系统会更新哈希表中的部门信息，并刷新表格显示。同时，系统会将更新后的部门信息写入文件。</p>
<p>④查询部门</p>
<p>用户操作：用户可以在搜索框中输入部门的名称或部分名称，点击“查询”按钮后，系统会在哈希表中查找匹配的部门信息，并在表格中显示结果。如果用户清空搜索框，表格会恢复显示所有部门信息。如果找到匹配的部门，系统会在表格中显示查询结果。如果没有找到匹配的部门，系统会弹出提示框，告知用户“未找到相关记录”。</p>
<p>⑤部门排序</p>
<p>用户操作：系统提供了两种排序方式：按部门名称的字典顺序进行升序排序（A-Z）或降序排序（Z-A）。用户可以通过点击表格标题栏中的“名称”列来切换排序方式。</p>
<p>系统响应：</p>
<p>点击“名称”列后，系统会根据当前的排序方式重新排列表格中的部门记录，并在表格中实时显示排序结果。</p>
<p>⑥部门信息的持久化</p>
<p>（1）保存部门信息</p>
<p>自动保存：</p>
<p>每次对部门信息进行添加、删除或修改操作后，系统会自动将最新的部门信息写入文件，确保数据不会丢失。文件格式为 CSV</p>
<p>（2）加载部门信息</p>
<p>自动加载：程序启动时，系统会从文件中读取部门信息，并将其加载到部门哈希表中，以便用户可以立即查看和操作这些数据。</p>
<p>⑦数据验证</p>
<p>（1）必填项验证</p>
<p>输入验证：</p>
<p>在添加或修改部门信息时，系统会检查所有必填项（如名称、负责人）是否已填写。如果用户未填写必填项，系统会弹出提示框，要求用户补充完整信息。</p>
<p>系统还会验证输入的数据格式是否正确，例如，部门名称不能包含特殊字符，负责人姓名不能为空等。</p>
<p>（2）关联数据验证</p>
<p>员工关联：</p>
<p>在删除部门时，系统会检查该部门下是否有员工。如果该部门下有员工，系统会弹出提示框，告知用户“该部门下有员工，无法直接删除”。</p>
<p>用户可以选择将员工转移到其他部门后再进行删除操作，或者取消删除操作。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afc6e850395d4ba79db8f633bfc039e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=Mcp2hHD4%2FssW17ZTvzngX9ixJAc%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<p>图3-3 部门信息管理模块流程图</p>
<h3 data-id="heading-12">3.2人机界面设计</h3>
<p>本系统的人机界面基于 Java 的 Swing 组件库构建，提供了一个图形用户界面（GUI），使用户可以通过直观的可视化操作进行员工和部门的管理。主界面采用菜单栏和表格视图相结合的设计，用户可以通过点击菜单项或右键点击表格中的行来执行各种管理和调试任务，如添加、修改、删除员工信息和部门信息。这种设计不仅简化了用户的操作流程，还确保了系统的高效性和易用性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aba29d5f784e40f295bf94fc21fff68e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=NoRJYZ9nv6Eg%2FvUV1%2FX9KlFtw4Q%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-4 登陆界面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63a8e7f2aaaa47f994b536e86c2682f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=eCpyXFJzZkvmWbxytmu%2FXHwUQgA%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-5 注册界面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c7e35f066c64f38867a0e7ccf5c948c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=t6WkTtwz2VXBNXgJfyLsk6aIHxY%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-6 员工管理界面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da7910d1bdb44dd99d5b5b9954d1ebbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=VD8davK9qTKWb3wZssBiHNbvock%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-7 部门管理界面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ed0390177b446eb897625ce02231ce1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=j7L54wGEMFpiijey9bXGfHZDsq8%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-8 新增员工界面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38e05b6312584ffca70637213120804e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=L9%2FtbXN583kRfPGgK3j8ggkik6A%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-9 新增部门界面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f81e48d49184a4b9c63972eca7595fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=83CshPceSkz5kLREYjuuKTTU7iU%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-10 编辑部门界面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a7aa13024704c7ab54d9161be4e8396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=C2RuIANK3SqmxK0vGv3KiLqpY34%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图3-11 编辑员工界面</p>
<h3 data-id="heading-13">3.3算法设计</h3>
<p>3.3.1数据结构选择</p>
<p>（一）哈希表</p>
<p>① 用途：本系统使用哈希表（MyHashMap）来存储部门（Dept）和员工（Employee）信息，以实现高效的数据查找、插入和删除操作。哈希表的键为部门名称（String）或员工姓名（String），值为对应的部门对象（Dept）或员工对象（Employee）。</p>
<p>② 优势：在大规模数据存储和频繁数据访问场景下，哈希表能够快速定位和操作数据，极大提高系统性能。例如，在根据部门名称查询部门信息或根据员工姓名查询员工信息时，哈希表可迅速返回结果。</p>
<p>（二）表格模型（DefaultTableModel）</p>
<p>① 用途：用于在图形用户界面（GUI）中展示部门和员工信息。表格模型存储了表格的列名、数据行等信息，并负责与界面表格组件（JTable）交互，实现数据的可视化展示。</p>
<p>② 优势：方便与 Swing 组件结合，实现直观的数据呈现。开发人员可轻松将数据模型中的数据更新同步到界面表格，同时表格的交互操作（如排序、选择等）也能及时反馈到数据模型。</p>
<p>（三）文件存储</p>
<p>① 用途：系统使用 CSV（逗号分隔值）文件来持久化存储部门、员工和管理员信息。在程序运行时，从文件中读取数据加载到内存中的哈希表，数据更新后，再将哈希表中的数据写回文件保存。</p>
<p>② 优势：CSV 文件格式简单，易于理解和编辑，适合存储结构化数据。与数据库相比，文件存储无需复杂的数据库管理系统配置，降低系统复杂度和部署成本，适用于小型或简单数据存储需求。</p>
<p>3.3.2核心算法</p>
<p>（一）哈希表操作算法</p>
<p>①put方法（插入数据）：</p>
<p>根据输入的键计算哈希值，确定在哈希表中的存储位置。若该位置为空，则直接插入新元素；若已存在元素，则遍历链表，若找到相同键，则更新对应值，否则将新元素插入链表头部。</p>
<p>②get方法（获取数据）：</p>
<p>计算键的哈希值，定位到哈希表中的存储位置，然后遍历链表查找对应键的值，若找到则返回，否则返回 null。</p>
<p>③remove方法（删除数据）：</p>
<p>计算键的哈希值，找到存储位置后，遍历链表，若找到对应键的元素，则删除该元素，并调整链表结构。</p>
<p>（二）排序算法</p>
<p>① sortByNameAsc和sortByNameDesc方法（按姓名排序）：</p>
<p>使用java.text.Collator类实现中文字符串的拼音排序。先获取哈希表中所有键（员工姓名），将其转换为数组，然后定义比较器。比较器先按姓氏拼音排序，若姓氏相同，则按姓名后续字符拼音排序。最后使用Arrays.sort方法对数组进行排序，升序或降序由比较器逻辑决定。</p>
<p>（三）文件读写算法</p>
<p>① writeDeptToFile、writeEmployeesToFile和writeUsersToFile方法（写入文件）：</p>
<p>遍历哈希表，将每个对象的属性值以逗号分隔的形式拼接成字符串，然后写入文件。每行表示一个对象的信息。</p>
<p>② readDeptFromFile、readEmployeesFromFile和readUsersFromFile方法（读取文件）：</p>
<p>从文件中逐行读取数据，按逗号分隔每行字符串，根据数据创建对应的对象（部门、员工或管理员），并将对象添加到哈希表中，以指定属性作为键。</p>
<p>（四）用户界面交互算法</p>
<p>① 添加部门 / 员工操作</p>
<p>   算法思路：在图形用户界面中，用户输入部门或员工信息后，点击添加按钮。系统获取输入框中的文本，创建对应的部门或员工对象，将其添加到哈希表中，并更新界面表格显示。同时，将新数据写入文件保存。</p>
<p>   流程</p>
<p>a. 用户在界面输入信息。</p>
<p>b. 点击添加按钮触发事件监听器。</p>
<p>c. 事件监听器获取输入信息，创建对象，添加到哈希表。</p>
<p>d. 调用refreshTable方法更新表格显示。</p>
<p>e. 调用相应的writeToFile方法将数据写入文件。</p>
<p>② 编辑部门 / 员工操作</p>
<p>   算法思路：用户在表格中右键点击某行数据，选择编辑选项，弹出编辑窗口。窗口中显示该行数据的原始信息，用户修改后点击保存按钮。系统更新哈希表中的对象信息，刷新表格显示，并将更新后的数据写入文件。</p>
<p>   流程</p>
<p>a. 用户右键点击表格行，选择编辑。</p>
<p>b. 弹出编辑窗口，显示原始数据。</p>
<p>c. 用户修改信息，点击保存按钮触发事件监听器。</p>
<p>d. 事件监听器获取新信息，更新哈希表中的对象。</p>
<p>e. 调用refreshTable方法更新表格。</p>
<p>f. 调用writeToFile方法保存数据。</p>
<p>③ 删除部门 / 员工操作</p>
<p>   算法思路：用户在表格中右键点击某行数据，选择删除选项，弹出确认对话框。用户确认后，系统从哈希表中删除对应对象，更新表格显示，并将更新后的数据写入文件。</p>
<p>   流程</p>
<p>a. 用户右键点击表格行，选择删除。</p>
<p>b. 弹出确认对话框，用户确认。</p>
<p>c. 系统根据选中行数据获取键，从哈希表中删除对象。</p>
<p>d. 调用refreshTable方法更新表格。</p>
<p>e. 调用writeToFile方法保存数据。</p>
<p>④ 查询部门 / 员工操作</p>
<p>   算法思路：用户在查询输入框中输入关键词，点击查询按钮。系统根据关键词在哈希表中查找匹配数据，将结果显示在表格中。若未找到匹配数据，则弹出提示框。</p>
<p>   流程</p>
<p>a. 用户在查询输入框输入关键词。</p>
<p>b. 点击查询按钮触发事件监听器。</p>
<p>c. 事件监听器获取关键词，遍历哈希表查找匹配数据。</p>
<p>d. 若找到，将匹配数据添加到表格模型显示；若未找到，弹出提示框。</p>
<p>⑤ 排序操作</p>
<p>   算法思路：用户在排序下拉框中选择排序方式（如按姓名升序、降序等），系统根据选择调用相应的排序方法对哈希表中的数据进行排序，然后更新表格显示。</p>
<p>   流程</p>
<p>a. 用户选择排序方式。</p>
<p>b. 下拉框触发事件监听器。</p>
<p>c. 事件监听器根据选择调用排序方法（如sortByNameAsc或sortByNameDesc）。</p>
<p>d.  排序方法对哈希表数据排序后，调用refreshTablesort方法更新表格显示。</p>
<h3 data-id="heading-14">3.4数据设计</h3>
<p>数据设计基于两个核心实体：<strong>员工（Employee）和部门（Dept）</strong> ，它们通过部门名称进行关联。每个员工属于一个特定的部门，并且系统不允许删除含有员工的部门以确保数据完整性。员工和部门的信息分别存储在两个自定义的哈希表 MyHashMap 中，即 employeeMap 和 deptMap，这两个哈希表使用字符串作为键（分别是员工姓名和部门名称），并分别映射到 Employee 和 Dept 对象。这些对象的属性（如员工的姓名、性别、出生年月等，以及部门的负责人、成立日期等）被用于构建图形用户界面中的表格视图（JTable），并通过CSV文件持久化存储。系统提供了增删改查功能，允许用户对员工和部门信息进行管理，并支持根据名称进行排序和搜索。此外，为了保证用户体验，还实现了右键菜单以提供快捷操作，如编辑和删除记录。</p>
<h2 data-id="heading-15">4.调试分析</h2>
<h3 data-id="heading-16">4.1遇到的问题：</h3>
<p>4.1.1启动页面时数据的读入问题，无法保障每次的数据都及时更新至csv文件中和页面表格中？</p>
<p>4.1.2我们设计了员工管理和部门管理，如何将员工和部门进行关联是之前面临的问题？</p>
<p>4.1.3在碰到多种非法输入的情况，如何控制程序不挂掉，增强程序的健壮性？</p>
<h3 data-id="heading-17">4.2解决方法：</h3>
<p>4.2.1程序启动时，直接读取csv文件至哈希表中，每次做增删改查操作时，都调用读入操作将最新的哈希表读入csv文件，并及时刷新页面。</p>
<p>4.2.2将员工类EmpUI和部门类DeptUI中的哈希表分别设置为静态类型的变量，在新增员工的界面类中可以直接调用部门类的哈希表来进行查找有哪些部门，新增员工的界面类中就可以通过一个下拉框展示可以选择的部门。</p>
<p>4.2.3对于各种非法的输入，做异常处理抛给界面显示以提醒用户相关的问题。</p>
<h3 data-id="heading-18">4.3经验和体会：</h3>
<p>数据持久化的重要性：及时将内存中的数据持久化到文件中，避免因程序崩溃或意外关闭导致数据丢失。对于关键业务系统，数据的完整性和一致性至关重要。</p>
<p>操作后的即时反馈：每次操作后及时刷新页面，给用户清晰的操作反馈，增强用户体验。用户可以看到他们的操作结果，减少困惑和误操作的可能性。</p>
<p>性能优化：虽然每次操作后都写入文件可以确保数据一致性，但频繁的文件操作可能会影响性能。可以通过批量处理或延迟写入（如每隔一定时间或达到一定操作次数后再写入）来优化性能，同时保持数据的相对一致性。</p>
<p>模块化设计的优势：通过将员工和部门的数据结构设计为静态哈希表，实现了模块之间的数据共享，简化了系统的复杂度。这种设计使得不同模块之间可以方便地访问和操作公共数据，减少了重复代码的编写。</p>
<p>双向关联的设计思路：员工和部门之间的双向关联设计不仅提高了查询效率，还增强了系统的灵活性。例如，可以通过员工快速找到所属部门，也可以通过部门快速找到所有员工。这种设计在实际业务场景中非常实用，特别是在需要统计分析时。</p>
<p>数据冗余与优化：虽然双向关联可以提高查询效率，但也可能导致一定程度的数据冗余。为了避免冗余数据带来的维护成本，建议在设计时仔细权衡，确保数据的一致性和完整性。</p>
<p>异常处理的重要性：良好的异常处理机制是程序健壮性的基础。通过捕获和处理异常，程序可以在遇到错误时优雅地恢复，而不是直接崩溃。这不仅提升了用户体验，也减少了系统维护的成本。</p>
<p>输入验证的最佳实践：在用户输入数据时，提前进行合法性检查是非常重要的。通过在前端和后端双重验证，可以有效防止非法数据进入系统，减少潜在的安全风险和逻辑错误。</p>
<p>日志记录的价值：日志记录不仅是调试工具，更是系统运维的重要手段。通过记录用户的操作行为，开发者可以更好地了解系统的使用情况，及时发现和解决问题。此外，日志还可以作为审计依据，确保系统的合规性和安全性。</p>
<h2 data-id="heading-19">5.用户手册</h2>
<h3 data-id="heading-20">5.1概述</h3>
<p>本用户手册旨在为用户提供详细的指导，帮助您顺利从 Gitee 拉取并使用 IntelliJ IDEA 编译和运行员工管理系统。该系统包括以下模块：</p>
<p>①登录模块：用户通过登录验证后进入系统。</p>
<p>②员工信息管理模块：提供员工信息的增删改查和排序功能。</p>
<p>③部门信息管理模块：提供部门信息的增删改查和排序功能。</p>
<h3 data-id="heading-21">5.2系统要求</h3>
<p>在安装和运行本系统之前，请确保您的计算机满足以下要求：</p>
<p>①操作系统：Windows 10/11, macOS, 或 Linux。</p>
<p>②Java 版本：Java 8 或更高版本（建议使用最新版本）。</p>
<p>③开发环境：IntelliJ IDEA（社区版或专业版）。</p>
<p>④Git 客户端：确保已安装 Git 客户端，并配置好 Git 环境变量。</p>
<h3 data-id="heading-22">5.3安装与配置</h3>
<p>5.3.1从 Gitee 拉取项目</p>
<p>①安装 Git 客户端：</p>
<p>如果您尚未安装 Git，请访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitscm.com%2F" target="_blank" title="https://gitscm.com/" ref="nofollow noopener noreferrer">Git 官方网站</a> 下载并安装适合您操作系统的 Git 客户端。</p>
<p>安装完成后，打开命令提示符（Windows）或终端（macOS/Linux），输入 <code>git version</code> 验证安装是否成功。</p>
<p>②克隆项目仓库：</p>
<p>打开命令提示符（Windows）或终端（macOS/Linux），导航到您希望保存项目的目录。例如： C:\path\to\your\directory使用以下命令从 Gitee 克隆员工管理系统的项目仓库：</p>
<p>git clone <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fjinxiaoliang%2Femployeemanagementsystem.git" title="https://gitee.com/jinxiaoliang/employeemanagementsystem.git" target="_blank" ref="nofollow noopener noreferrer">gitee.com/jinxiaolian…</a></p>
<p>克隆完成后，项目文件将保存在 <code>employeemanagementsystem</code> 文件夹中。</p>
<p>5.3.2导入项目到 IntelliJ IDEA</p>
<p>①启动 IntelliJ IDEA：打开 IntelliJ IDEA，选择“Open”或“Import Project”。</p>
<p>②导入项目：导航到克隆下来的 <code>employeemanagementsystem</code> 文件夹，选择该文件夹并点击“OK”。IntelliJ IDEA 将自动检测并导入项目。如果提示选择项目 SDK，请选择已安装的 Java 版本（建议使用最新版本）。</p>
<p>③配置项目依赖：项目使用了 Maven构建工具，IntelliJ IDEA 会自动下载并配置所需的依赖库。请等待依赖库下载完成。</p>
<h3 data-id="heading-23">5.4运行程序</h3>
<p>5.4.1使用 IntelliJ IDEA 运行</p>
<p>①启动程序：在 IntelliJ IDEA 中，点击顶部菜单栏的“Run” ， 程序将启动，并显示登录界面。</p>
<p>②调试程序：如果您需要调试程序，可以在代码中设置断点，然后点击“Run” &gt; “Debug 'EmployeeManagementSystem'”。IntelliJ IDEA 将以调试模式启动程序，允许您逐步执行代码并检查变量值</p>
<h3 data-id="heading-24">5.5使用说明</h3>
<p>5.5.1登录模块</p>
<p>①启动程序后，您将看到登录界面。</p>
<p>②输入您的用户名和密码，点击“登录”按钮。</p>
<p>③如果用户名和密码正确，您将进入系统主界面；否则，系统会提示您重新输入。</p>
<p>④如果你没有账号，点击注册按钮跳转到注册页面先进行账号的注册</p>
<p>5.5.2员工信息管理模块</p>
<p>员工信息管理模块提供了以下功能：</p>
<p>增加员工信息</p>
<p>删除员工信息</p>
<p>修改员工信息</p>
<p>查询员工信息</p>
<p>按条件排序</p>
<p>（1）增加员工信息</p>
<p>①在主界面选择“员工信息管理” &gt; “增加员工信息”。</p>
<p>②输入员工的详细信息，包括员工ID，姓名、性别、出生年月、工作年月、学历、部门、住址和电话。</p>
<p>③点击“保存”按钮，数据将保存到Emp.csv文件中。</p>
<p>（2）删除员工信息</p>
<p>①选择要删除的员工行：使用鼠标滚动并找到您想要删除的员工记录所在的行。将鼠标悬停在该行上，确保选中了正确的员工记录。</p>
<p>②右键点击并选择删除：右键点击选中的员工行，弹出一个上下文菜单。在菜单中选择“删除员工信息”选项。</p>
<p>③确认删除操作：系统会弹出一个确认对话框，提示您是否确定要删除该员工的信息。仔细阅读确认提示，确保您确实想要删除该员工的记录。如果确认删除，请点击“确认”按钮；如果您决定取消删除操作，请点击“取消”按钮。</p>
<p>（3）修改员工信息</p>
<p>①选择要修改的员工行：使用鼠标滚动并找到您想要修改的员工记录所在的行。将鼠标悬停在该行上，确保选中了正确的员工记录。</p>
<p>②右键点击并选择编辑：右键点击选中的员工行，弹出一个上下文菜单。在菜单中选择“修改员工信息”选项。</p>
<p>③查看并修改员工信息：系统将弹出一个编辑窗口，显示该员工的当前信息（如姓名、性别、出生年月、工作年月、学历、部门、住址和电话等）。根据需要修改相应的字段。您可以更改任何需要更新的信息，如部门、职位、联系方式等。</p>
<p>④保存修改：修改完信息后，点击“保存”按钮。系统会将更新后的信息保存到数据库中，并在表格中实时反映修改结果。</p>
<p>（4）查询员工信息</p>
<p>①在主界面选择“员工信息管理” &gt; “查询员工信息”。</p>
<p>②您可以根据姓名字段进行查询。</p>
<p>③输入查询条件后，点击“查询”按钮。</p>
<p>④系统将显示符合条件的员工信息列表。</p>
<p>（5）按条件排序</p>
<p>①在主界面选择“员工信息管理” &gt; “按条件排序”。</p>
<p>②选择排序方式（升序或降序）。</p>
<p>③点击“排序”按钮，系统将根据选择的条件对员工信息进行排序，并显示结果。</p>
<p>5.5.3部门信息管理模块</p>
<p>部门信息管理模块提供了以下功能：</p>
<p>增加部门信息</p>
<p>删除部门信息</p>
<p>修改部门信息</p>
<p>查询部门信息</p>
<p>按条件排序</p>
<p>（1）增加部门信息</p>
<p>①在主界面选择“部门信息管理” &gt; “增加部门信息”。</p>
<p>②输入部门的名称、负责人、联系电话等信息。</p>
<p>③点击“保存”按钮，系统将自动为部门分配唯一的 ID，并将数据保存到数据库中。</p>
<p>（2）删除部门信息</p>
<p>①选择要删除的部门行：使用鼠标滚动并找到您想要删除的部门记录所在的行。将鼠标悬停在该行上，确保选中了正确的部门记录。</p>
<p>②右键点击并选择删除：右键点击选中的部门行，弹出一个上下文菜单。在菜单中选择“删除部门信息”选项。</p>
<p>③确认删除操作：系统会弹出一个确认对话框，提示您是否确定要删除该部门的信息。仔细阅读确认提示，确保您确实想要删除该部门的记录。如果确认删除，请点击“确认”按钮；如果您决定取消删除操作，请点击“取消”按钮。</p>
<p>（3）修改部门信息</p>
<p>①选择要修改的部门行：使用鼠标滚动并找到您想要修改的部门记录所在的行。将鼠标悬停在该行上，确保选中了正确的部门记录。</p>
<p>②右键点击并选择编辑：右键点击选中的部门行，弹出一个上下文菜单。在菜单中选择“修改部门信息”选项。</p>
<p>③查看并修改部门信息：系统将弹出一个编辑窗口，显示该部门的当前信息（如名称、负责人、描述等）。根据需要修改相应的字段。您可以更改任何需要更新的信息，如部门名称、负责人、描述等。</p>
<p>④保存修改：修改完信息后，点击“保存”按钮。系统会将更新后的信息保存到Dept.csv文件中，并在表格中实时反映修改结果。</p>
<p>（4）查询部门信息</p>
<p>①在主界面选择“部门信息管理” &gt; “查询部门信息”。</p>
<p>②系统会提示您选择查询条件，您可以根据部门名称字段进行查询。</p>
<p>③输入查询条件后，点击“查询”按钮。</p>
<p>④系统将显示符合条件的部门信息列表。</p>
<p>（5）按条件排序</p>
<p>①在主界面选择“部门信息管理” &gt; “按条件排序”。</p>
<p>②选择排序方式（升序或降序）。</p>
<p>③点击“排序”按钮，系统将根据选择的条件对部门信息进行排序，并显示结果。</p>
<h3 data-id="heading-25">5.6注意事项</h3>
<p>路径要求：系统对文件路径没有特殊要求，但建议将项目文件夹保存在一个容易访问的目录中，避免使用过长或包含特殊字符的路径。</p>
<p>备份数据：定期备份员工和部门数据，以防止数据丢失。您可以手动导出数据并保存到安全的位置。</p>
<p>权限问题：如果在运行程序时遇到权限问题，请确保您有足够的权限访问和写入指定的文件夹。</p>
<h2 data-id="heading-26">6.测试结果</h2>
<h3 data-id="heading-27">6.1登录模块</h3>
<p>6.1.1登录操作</p>
<p>①输入：</p>
<p>  账户名：李</p>
<p>密码：123</p>
<p>测试结果：登录成功</p>
<p>②输入账户名：李</p>
<p>密码：1234</p>
<p>测试结果：登录失败</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39975e4ef6d1426791d6cb5679232fde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=fsUBwxapuQAKxWk%2F0fG5XpOuF6c%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-1 登录失败弹窗</p>
<p>6.1.2注册操作：</p>
<p>①输入：</p>
<p>  账户名：jxl</p>
<p>密码：123</p>
<p>测试结果：注册成功</p>
<p>②输入：</p>
<p>  账户名：（没有输入）</p>
<p>密码：（没有输入）</p>
<p>测试结果：注册失败</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/580b1b47481546b5ab06bfb89fc79fb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=%2F%2Fv%2BHgZ2I7y%2BTZFfu8LxbBOOyyQ%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-2 用户注册失败弹窗</p>
<h3 data-id="heading-28">6.2员工管理模块</h3>
<p>6.2.1新增员工</p>
<p>①输入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ccbf2aea6e148eb870877bb56782adb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=ofVHo%2BPKdIVH2OKWS9D4CbQAk10%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-3 新增员工正确输入窗口</p>
<p>测试结果：新增成功</p>
<p>②输入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/633744cf458949c69e1a8f3afe2a15c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=UMCVt51gCeNBB522C8wiGST6elg%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-4 新增员工错误输入窗口</p>
<p>测试结果：新增失败</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d49cba0e2c644747bece3197afa3c90b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=9wJ7tP8VRbIxxrVLu87WHrbXlmA%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-5 输入错误警告弹窗</p>
<p>6.2.2删除员工</p>
<p>①输入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8f589c13ca3434e8a5f00e028527241~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=VthGudSvHtd8zQSXUBzRZhJK1yQ%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-6 确认是否删除员工弹窗</p>
<p>测试结果：删除成功</p>
<p>6.2.3修改员工</p>
<p>①输入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cf2813028504d19ab689b1be50e0e98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=ry6db%2FwaQLYBnoS%2FhAVIsHL1yaY%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-7 编辑员工信息窗口进行修改</p>
<p>测试结果：修改成功</p>
<p>6.2.4查询员工：</p>
<p>①输入：周</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6be7b45747b45ac8f78cad7a845395a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=Tc4D%2BgIJNTKCHbFizFl1S0K8xzE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-8 输入字段进行查询</p>
<p>测试结果：查询成功</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61580a88affd47a1b6c265c21c152c77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=wnn7uRKMZX3sRo6Drt5Eopo9IPE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-9 输入字段查询成功展示的数据</p>
<p>②输入：周停</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14d540f2f35b49fbbe79d9bf0e3a3352~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=V4Mpi598w%2Bj%2FA8UcV9Jk1LTpDZ0%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-10 输入字段进行查询</p>
<p>测试结果：查询失败</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4077ccd5dc3648e4a92d2ce4e9b9ab6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=KQAC9NccwTQqos%2FdsDFeBR2fkSs%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-11 查询失败弹窗</p>
<p>6.2.5排序员工</p>
<p>①输入：按升序进行排</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b2a3d3c16474f07b8c3d6acf186c988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=20JA3fULIo0yyOuA49XQdopnflI%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-12 选择升序进行排序</p>
<p>测试结果：排序成功</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b99e2f5964dd466aabc8a890711b6733~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=9N1I%2BvidTLdgafavTfUi9%2FnSwOo%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-13 员工数据成功排序</p>
<p>②输入：按降序进行排</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1c0616b647b4cb3b1c6ba4659e92cc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=tTTR%2BvE28DhJhS2CVQXC%2FJ081cc%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-14 选择降序进行排序</p>
<p>测试结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aeee39d86f2947d3aafc356b657a2cf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=%2Fuoik0t4CcjhUKYeHmI6NwIyyH8%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-15 员工数据成功排序</p>
<h3 data-id="heading-29">6.3部门管理模块</h3>
<p>6.3.1新增部门</p>
<p>①输入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c38508f1534a7897c9c8e40c6d23f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=ThQnTE1VFlFU8YQ7iobrNZHBDKo%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-16 正确输入部门数据</p>
<p>测试结果：新增成功</p>
<p>②输入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/242b6942cb9d411c8fdfd47c68ef747b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=FKKkyDbcWBgkIzByta5j3crUEO8%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-17 非法输入部门数据</p>
<p>测试结果：新增失败</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d73929e6fd664fd6b48fd36a2e85ea40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=DX0snWVw3O5rgs%2B%2FChBkmu9nOTE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-18 异常输入弹窗</p>
<p>6.3.2删除部门</p>
<p>①输入：删除某个部门</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc4ab6c8d42e4d7dbd6ec5bbe825416f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=7gMKrLcYOluGAVUNCKDkTzGLoj0%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-19 非法删除有员工的部门的警告弹窗</p>
<p>测试结果：删除失败</p>
<p>6.3.3修改部门</p>
<p>①输入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c65947e78104f31a78f7645807c9c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=wE51lBhNQdFBLf%2F6BoNvBmIwNYE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-20 修改部门的弹窗</p>
<p>测试结果：修改成功</p>
<p>6.3.4查询部门：</p>
<p>①输入：市场</p>
<p>测试结果：查询成功</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f069f367e6481f986976c5f1ca5057~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=JrSVJPbBDIzQyNhr2lT82MAJ5LI%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>6-21 查询成功回显的数据</p>
<p>②输入：市场部门</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e96063dc277448168791036fe9571147~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=6fInjUUkzSGvEYMP0v3DbnxuyzA%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-22 输入数据表中没有的数据</p>
<p>测试结果：查询失败</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/471c4299d4294dbcb1cdec4f45fe5d81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=x1n7DhcLpRUSjoCSWhvDVO7qMjE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-23 未查询到的警告弹窗</p>
<p>6.3.5排序部门</p>
<p>①输入：按升序进行排</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/265ebb3f4eac43afa76d1d35e49b3f30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=6HQNZYBj3DgYBH0q0v1pCkwUz0k%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-24 选择按部门名称升序排序</p>
<p>测试结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f3efcdd46dc42c5b193e704c9997a04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=ZbS%2BXqzt7Hda%2FRqQs5skKs6BuHg%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-25 成功对部门进行排序</p>
<p>②输入：按降序进行排</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dd22d307f9d4b07bbc1e18012580a16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=vDFpRc0jJ%2BUJPDielPzY6ivF7OQ%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-26 选择按部门名称降序排序</p>
<p>测试结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca49e87504114f82931d5fc1cd5cdb4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=m6oX1SfPmQxk0fywXTp3DWtnDko%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​</p>
<p>图6-27 成功对部门进行排序</p>
<h2 data-id="heading-30">7.项目结构及源码分享</h2>
<h3 data-id="heading-31">7.1项目结构</h3>
<p>本项目是采用idea进行开发的，项目的文件结构图如下:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a19a7b52a52f4ea288c9d3592d0369a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770092910&amp;x-signature=pMWmqx9MQWWdt1rdThP%2BxLT1YeQ%3D" alt="" loading="lazy"/>​</p>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p> 图7-1 项目结构图</p>
<h3 data-id="heading-32">7.2源码分享（文件从上往下）</h3>
<h4 data-id="heading-33">7.2.1MessageConstant.java</h4>
<p>这个我本来是打算用来封装一些常量类来用，便于修改，后面没时间就没弄了，也没加到项目里，大家可以参考一下，可加可不加</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.jxl_dyw.constant;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageConstant</span> {
    <span class="hljs-comment">//"提示"</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TIP</span> <span class="hljs-operator">=</span> <span class="hljs-string">"提示"</span>;

    <span class="hljs-comment">//"请填写所有必填项！"</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILL_ALL_REQUIRED_ITEMS</span> <span class="hljs-operator">=</span> <span class="hljs-string">"请填写所有必填项！"</span>;

    <span class="hljs-comment">//"出生年月格式不正确，请输入yyyy-MM-dd格式！</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BIRTHDAY_FORMAT_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-string">"出生年月格式不正确，请输入yyyy-MM-dd格式！"</span>;

    <span class="hljs-comment">//"工作年月格式不正确，请输入yyyy-MM-dd格式！"</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">WORKDAY_FORMAT_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-string">"工作年月格式不正确，请输入yyyy-MM-dd格式！"</span>;
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-34">7.2.2Dept.java</h4>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">jxl_dyw</span>.<span class="hljs-property">entity</span>;

<span class="hljs-comment">/**
 * 部门
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dept</span> {
    <span class="hljs-comment">// 部门编号</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title class_">DeptId</span>;
    <span class="hljs-comment">// 部门名称</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title class_">DeptName</span>;
    <span class="hljs-comment">//部门创建人</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title class_">BuildPeople</span>;
    <span class="hljs-comment">//部门创建时间</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title class_">BuildTime</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Dept</span>() {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Dept</span>(<span class="hljs-title class_">String</span> deptId, <span class="hljs-title class_">String</span> deptName, <span class="hljs-title class_">String</span> buildPeople, <span class="hljs-title class_">String</span> buildTime) {
        <span class="hljs-title class_">DeptId</span> = deptId;
        <span class="hljs-title class_">DeptName</span> = deptName;
        <span class="hljs-title class_">BuildPeople</span> = buildPeople;
        <span class="hljs-title class_">BuildTime</span> = buildTime;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getDeptId</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">DeptId</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setDeptId</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> deptId</span>) {
        <span class="hljs-title class_">DeptId</span> = deptId;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getDeptName</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">DeptName</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setDeptName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> deptName</span>) {
        <span class="hljs-title class_">DeptName</span> = deptName;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBuildPeople</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">BuildPeople</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setBuildPeople</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> buildPeople</span>) {
        <span class="hljs-title class_">BuildPeople</span> = buildPeople;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBuildTime</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">BuildTime</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setBuildTime</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> buildTime</span>) {
        <span class="hljs-title class_">BuildTime</span> = buildTime;
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-35">7.2.3Employee.java</h4>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">jxl_dyw</span>.<span class="hljs-property">entity</span>;

<span class="hljs-comment">/**
 * 员工类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> {
    <span class="hljs-comment">//员工ID、姓名、性别、出生年月、工作年月、学历、职务、住址、电话</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title class_">EmpId</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> sex;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> birthday;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> workday;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> education;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> position;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> address;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> phone;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Employee</span>() {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-title class_">String</span> empId, <span class="hljs-title class_">String</span> name, <span class="hljs-title class_">String</span> sex, <span class="hljs-title class_">String</span> birthday, <span class="hljs-title class_">String</span> workday, <span class="hljs-title class_">String</span> education, <span class="hljs-title class_">String</span> position, <span class="hljs-title class_">String</span> address, <span class="hljs-title class_">String</span> phone) {
        <span class="hljs-title class_">EmpId</span> = empId;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sex</span> = sex;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">birthday</span> = birthday;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">workday</span> = workday;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">education</span> = education;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = position;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">address</span> = address;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">phone</span> = phone;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getEmpId</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">EmpId</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setEmpId</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> empId</span>) {
        <span class="hljs-title class_">EmpId</span> = empId;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getSex</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> sex;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setSex</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> sex</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sex</span> = sex;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBirthday</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> birthday;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setBirthday</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> birthday</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">birthday</span> = birthday;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getWorkday</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> workday;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setWorkday</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> workday</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">workday</span> = workday;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getEducation</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> education;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setEducation</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> education</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">education</span> = education;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getPosition</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> position;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setPosition</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> position</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span> = position;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getAddress</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> address;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setAddress</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> address</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">address</span> = address;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getPhone</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> phone;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setPhone</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> phone</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">phone</span> = phone;
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-36">7.2.4User.java</h4>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">jxl_dyw</span>.<span class="hljs-property">entity</span>;

<span class="hljs-comment">/**
 * 管理员
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-comment">//用户名</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> username;
    <span class="hljs-comment">//密码</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> password;
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span>() {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_">String</span> username, <span class="hljs-title class_">String</span> password) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span> = username;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span> = password;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUsername</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> username;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setUsername</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span> = username;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getPassword</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> password;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setPassword</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> password</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span> = password;
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-37">7.2.5MyHashMap.java</h4>
<pre><code class="hljs language-ini" lang="ini">package com.jxl_dyw.hashMap<span class="hljs-comment">;</span>

import java.util.*<span class="hljs-comment">;</span>

public class MyHashMap&lt;K, V&gt; {
    // 初始容量为16
    private static final int <span class="hljs-attr">INITIAL_CAPACITY</span> = <span class="hljs-number">16</span><span class="hljs-comment">;</span>
    // 负载因子为0.75
    private static final float <span class="hljs-attr">LOAD_FACTOR</span> = <span class="hljs-number">0.75</span>f<span class="hljs-comment">;</span>

    // 哈希表数组
    private Entry&lt;K, V&gt;<span class="hljs-section">[]</span> table<span class="hljs-comment">;</span>
    // 哈希表元素数量
    private int size<span class="hljs-comment">;</span>
    // 扩容阈值
    private int threshold<span class="hljs-comment">;</span>

    // 构造函数，初始化哈希表
    public MyHashMap() {
        <span class="hljs-attr">table</span> = new Entry[INITIAL_CAPACITY]<span class="hljs-comment">;</span>
        <span class="hljs-attr">size</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">threshold</span> = (int) (INITIAL_CAPACITY * LOAD_FACTOR)<span class="hljs-comment">;</span>
    }

    // 内部类，表示哈希表中的一个条目
    private static class Entry&lt;K, V&gt; {
        final K key<span class="hljs-comment">;</span>
        V value<span class="hljs-comment">;</span>
        Entry&lt;K, V&gt; next<span class="hljs-comment">;</span>

        Entry(K key, V value, Entry&lt;K, V&gt; next) {
            <span class="hljs-attr">this.key</span> = key<span class="hljs-comment">;</span>
            <span class="hljs-attr">this.value</span> = value<span class="hljs-comment">;</span>
            <span class="hljs-attr">this.next</span> = next<span class="hljs-comment">;</span>
        }
    }

    // 计算键的哈希值
    private int hash(Object key) {
        return (<span class="hljs-attr">key</span> == null) ? <span class="hljs-number">0</span> : Math.abs(key.hashCode() % table.length)<span class="hljs-comment">;</span>
    }

    // 插入键值对到哈希表中
    public void put(K key, V value) {
        int <span class="hljs-attr">index</span> = hash(key)<span class="hljs-comment">;</span>
        Entry&lt;K, V&gt; <span class="hljs-attr">newEntry</span> = new Entry&lt;&gt;(key, value, null)<span class="hljs-comment">;</span>

        // 如果桶为空，直接放入新条目
        if (table<span class="hljs-section">[index]</span> == null) {
            table<span class="hljs-section">[index]</span> = newEntry<span class="hljs-comment">;</span>
        } else {
            // 否则，遍历链表查找是否存在相同键，如果存在则更新值
            Entry&lt;K, V&gt; <span class="hljs-attr">current</span> = table[index]<span class="hljs-comment">;</span>
            while (current.next != null) {
                if (current.key.equals(key)) {
                    <span class="hljs-attr">current.value</span> = value<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                <span class="hljs-attr">current</span> = current.next<span class="hljs-comment">;</span>
            }
            if (current.key.equals(key)) {
                <span class="hljs-attr">current.value</span> = value<span class="hljs-comment">;</span>
            } else {
                <span class="hljs-attr">current.next</span> = newEntry<span class="hljs-comment">;</span>
            }
        }

        size++<span class="hljs-comment">;</span>
        // 如果超过扩容阈值，进行扩容
        if (size &gt;= threshold) {
            resize()<span class="hljs-comment">;</span>
        }
    }

    // 根据键获取值
    public V get(K key) {
        int <span class="hljs-attr">index</span> = hash(key)<span class="hljs-comment">;</span>
        Entry&lt;K, V&gt; <span class="hljs-attr">entry</span> = table[index]<span class="hljs-comment">;</span>

        // 遍历链表查找键，找到则返回值
        while (entry != null) {
            if (entry.key.equals(key)) {
                return entry.value<span class="hljs-comment">;</span>
            }
            <span class="hljs-attr">entry</span> = entry.next<span class="hljs-comment">;</span>
        }

        return null<span class="hljs-comment">;</span>
    }

    // 根据键移除条目
    public V remove(K key) {
        int <span class="hljs-attr">index</span> = hash(key)<span class="hljs-comment">;</span>
        Entry&lt;K, V&gt; <span class="hljs-attr">previous</span> = null<span class="hljs-comment">;</span>
        Entry&lt;K, V&gt; <span class="hljs-attr">current</span> = table[index]<span class="hljs-comment">;</span>

        // 遍历链表查找键，找到则移除条目
        while (current != null) {
            if (current.key.equals(key)) {
                if (<span class="hljs-attr">previous</span> == null) {
                    table<span class="hljs-section">[index]</span> = current.next<span class="hljs-comment">;</span>
                } else {
                    <span class="hljs-attr">previous.next</span> = current.next<span class="hljs-comment">;</span>
                }
                size--<span class="hljs-comment">;</span>
                return current.value<span class="hljs-comment">;</span>
            }
            <span class="hljs-attr">previous</span> = current<span class="hljs-comment">;</span>
            <span class="hljs-attr">current</span> = current.next<span class="hljs-comment">;</span>
        }

        return null<span class="hljs-comment">;</span>
    }

    // 扩容哈希表
    private void resize() {
        Entry&lt;K, V&gt;<span class="hljs-section">[]</span> <span class="hljs-attr">oldTable</span> = table<span class="hljs-comment">;</span>
        <span class="hljs-attr">table</span> = new Entry[oldTable.length * <span class="hljs-number">2</span>]<span class="hljs-comment">;</span>
        <span class="hljs-attr">size</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">threshold</span> = (int) (table.length * LOAD_FACTOR)<span class="hljs-comment">;</span>

        // 重新插入旧表中的所有条目到新表中
        for (Entry&lt;K, V&gt; entry : oldTable) {
            while (entry != null) {
                put(entry.key, entry.value)<span class="hljs-comment">;</span>
                <span class="hljs-attr">entry</span> = entry.next<span class="hljs-comment">;</span>
            }
        }
    }

    // 获取哈希表中条目的数量
    public int size() {
        return size<span class="hljs-comment">;</span>
    }

    // 获取哈希表中所有的值
    public List&lt;V&gt; values() {
        List&lt;V&gt; <span class="hljs-attr">values</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
        for (Entry&lt;K, V&gt; entry : table) {
            while (entry != null) {
                values.add(entry.value)<span class="hljs-comment">;</span>
                <span class="hljs-attr">entry</span> = entry.next<span class="hljs-comment">;</span>
            }
        }
        return values<span class="hljs-comment">;</span>
    }

    // 获取哈希表中所有的键
    public List&lt;K&gt; keys() {
        List&lt;K&gt; <span class="hljs-attr">keys</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
        for (Entry&lt;K, V&gt; entry : table) {
            while (entry != null) {
                keys.add(entry.key)<span class="hljs-comment">;</span>
                <span class="hljs-attr">entry</span> = entry.next<span class="hljs-comment">;</span>
            }
        }
        return keys<span class="hljs-comment">;</span>
    }

    // 按照员工姓名的姓氏进行升序排序，姓氏相同则按后续字符排序
    public String<span class="hljs-section">[]</span> sortByNameAsc(MyHashMap&lt;String, V&gt; map) {
        List&lt;String&gt; <span class="hljs-attr">keys</span> = map.keys()<span class="hljs-comment">;</span>
        String<span class="hljs-section">[]</span> <span class="hljs-attr">sortedKeys</span> = keys.toArray(new String[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span>

        // 使用 Collator 确保中文字符按照拼音排序
        Comparator&lt;String&gt; <span class="hljs-attr">nameComparator</span> = new Comparator&lt;String&gt;() {
            //使其适应中文环境
            private final java.text.Collator <span class="hljs-attr">collator</span> = java.text.Collator.getInstance(Locale.CHINA)<span class="hljs-comment">;</span>

            @Override
            public int compare(String o1, String o2) {
                // 分割姓名为姓和名
                String <span class="hljs-attr">surname1</span> = o1.split(<span class="hljs-string">""</span>)[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
                String <span class="hljs-attr">surname2</span> = o2.split(<span class="hljs-string">""</span>)[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>

                // 首先按姓氏排序
                int <span class="hljs-attr">surnameComparison</span> = collator.compare(surname1, surname2)<span class="hljs-comment">;</span>
                if (surnameComparison != 0) {
                    return surnameComparison<span class="hljs-comment">;</span>
                }

                // 如果姓氏相同，则按后续字符排序
                return collator.compare(o1, o2)<span class="hljs-comment">;</span>
            }
        }<span class="hljs-comment">;</span>

        // 对键数组进行排序
        Arrays.sort(sortedKeys, nameComparator)<span class="hljs-comment">;</span>
        return sortedKeys<span class="hljs-comment">;</span>
    }

    // 按照员工姓名的姓氏进行降序排序，姓氏相同则按后续字符排序
    public String<span class="hljs-section">[]</span> sortByNameDesc(MyHashMap&lt;String, V&gt; map) {
        List&lt;String&gt; <span class="hljs-attr">keys</span> = map.keys()<span class="hljs-comment">;</span>
        String<span class="hljs-section">[]</span> <span class="hljs-attr">sortedKeys</span> = keys.toArray(new String[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span>

        // 使用 Collator 确保中文字符按照拼音排序
        Comparator&lt;String&gt; <span class="hljs-attr">nameComparator</span> = new Comparator&lt;String&gt;() {
            private final java.text.Collator <span class="hljs-attr">collator</span> = java.text.Collator.getInstance(Locale.CHINA)<span class="hljs-comment">;</span>

            @Override
            public int compare(String o1, String o2) {
                // 分割姓名为姓和名
                String <span class="hljs-attr">surname1</span> = o1.split(<span class="hljs-string">""</span>)[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
                String <span class="hljs-attr">surname2</span> = o2.split(<span class="hljs-string">""</span>)[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>

                // 首先按姓氏排序
                int <span class="hljs-attr">surnameComparison</span> = collator.compare(surname1, surname2)<span class="hljs-comment">;</span>
                if (surnameComparison != 0) {
                    return -surnameComparison<span class="hljs-comment">; // 降序</span>
                }

                // 如果姓氏相同，则按后续字符排序
                return -collator.compare(o1, o2)<span class="hljs-comment">; // 降序</span>
            }
        }<span class="hljs-comment">;</span>

        // 对键数组进行排序
        Arrays.sort(sortedKeys, nameComparator)<span class="hljs-comment">;</span>
        return sortedKeys<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-38">7.2.6AddDeptUI.java</h4>
<pre><code class="hljs language-ini" lang="ini">package com.jxl_dyw.UI<span class="hljs-comment">;</span>

import com.jxl_dyw.entity.Dept<span class="hljs-comment">;</span>
import javax.swing.*<span class="hljs-comment">;</span>
import java.awt.*<span class="hljs-comment">;</span>
import java.awt.event.ActionEvent<span class="hljs-comment">;</span>
import java.awt.event.ActionListener<span class="hljs-comment">;</span>
import java.io.IOException<span class="hljs-comment">;</span>

/**
 * 新增部门的UI界面
 */
public class AddDeptUI {

    public AddDeptUI() {
        // 创建 JFrame
        JFrame <span class="hljs-attr">frame</span> = new JFrame(<span class="hljs-string">"编辑部门"</span>)<span class="hljs-comment">;</span>
        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE)<span class="hljs-comment">; // 关闭时只关闭当前窗口，不退出整个程序</span>
        frame.setSize(800, 600)<span class="hljs-comment">; // 增大窗口尺寸</span>
        frame.setLocationRelativeTo(null)<span class="hljs-comment">; // 居中显示窗口</span>

        // 使用 GridBagLayout 进行布局
        frame.setLayout(new GridBagLayout())<span class="hljs-comment">;</span>
        GridBagConstraints <span class="hljs-attr">gbc</span> = new GridBagConstraints()<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.insets</span> = new Insets(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>)<span class="hljs-comment">; // 增大组件之间的间距</span>

        // 创建一个面板用于存放所有输入字段
        JPanel <span class="hljs-attr">inputPanel</span> = new JPanel(new GridBagLayout())<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

        // 设置全局字体，使所有组件的文字更大
        Font <span class="hljs-attr">font</span> = new Font(<span class="hljs-string">"宋体"</span>, Font.PLAIN, <span class="hljs-number">18</span>)<span class="hljs-comment">;</span>

        // 创建组件并添加到面板
        JLabel <span class="hljs-attr">deptIdLabel</span> = new JLabel(<span class="hljs-string">"部门编号:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">deptIdField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        deptIdLabel.setFont(font)<span class="hljs-comment">;</span>
        deptIdField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, deptIdLabel, deptIdField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">deptNameLabel</span> = new JLabel(<span class="hljs-string">"部门名称:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">deptNameField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        deptNameLabel.setFont(font)<span class="hljs-comment">;</span>
        deptNameField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, deptNameLabel, deptNameField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">buildPeopleLabel</span> = new JLabel(<span class="hljs-string">"负责人:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">buildPeopleField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        buildPeopleLabel.setFont(font)<span class="hljs-comment">;</span>
        buildPeopleField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, buildPeopleLabel, buildPeopleField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">buildTimeLabel</span> = new JLabel(<span class="hljs-string">"成立日期:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">buildTimeField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        buildTimeLabel.setFont(font)<span class="hljs-comment">;</span>
        buildTimeField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, buildTimeLabel, buildTimeField, gbc)<span class="hljs-comment">;</span>

        // 创建按钮面板
        JPanel <span class="hljs-attr">buttonPanel</span> = new JPanel()<span class="hljs-comment">;</span>
        JButton <span class="hljs-attr">addButton</span> = new JButton(<span class="hljs-string">"添加"</span>)<span class="hljs-comment">;</span>
        addButton.setFont(font)<span class="hljs-comment">; // 设置按钮字体</span>
        buttonPanel.add(addButton)<span class="hljs-comment">;</span>

        // 添加按钮点击事件监听器
        addButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // 获取输入的部门信息
                String <span class="hljs-attr">deptId</span> = deptIdField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">deptName</span> = deptNameField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">buildPeople</span> = buildPeopleField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">buildTime</span> = buildTimeField.getText().trim()<span class="hljs-comment">;</span>
                // 判断部门编号是否为纯数字
                if (!deptId.matches("\d+")) {
                    JOptionPane.showMessageDialog(frame, "部门编号必须为纯数字！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                //对日期输入的格式进行验证
                if (!buildTime.matches("\d{4}-\d{2}-\d{2}")) {
                    JOptionPane.showMessageDialog(frame, "日期格式不正确，请输入yyyy-MM-dd格式的日期！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                // 验证输入是否为空
                if (deptId.isEmpty() || deptId.isEmpty() || deptName.isEmpty() || buildPeople.isEmpty() || buildTime.isEmpty()) {
                    JOptionPane.showMessageDialog(frame, "请填写所有必填项！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }

                // 创建 Dept 对象
                Dept <span class="hljs-attr">dept</span> = new Dept(deptId, deptName, buildPeople, buildTime)<span class="hljs-comment">;</span>

                // 判断部门是否已经存在，如果存在则不允许添加
                if (DeptUI.getDeptMap().get(dept.getDeptName())!=null) {
                    JOptionPane.showMessageDialog(frame, "该部门已存在，请重新输入！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                // 将 Dept 对象添加到哈希表中，以部门的名字作为键
                DeptUI.getDeptMap().put(dept.getDeptName(), dept)<span class="hljs-comment">;</span>

                // 刷新部门表格
                DeptUI.refreshTable()<span class="hljs-comment">;</span>

                // 将部门信息写入文件
                try {
                    DeptUI.writeDeptToFile(DeptUI.filePath)<span class="hljs-comment">;</span>
                } catch (IOException ex) {
                    JOptionPane.showMessageDialog(frame, "保存部门信息失败: " + ex.getMessage(), "错误", JOptionPane.ERROR_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }

                // 清空输入框
                deptIdField.setText("")<span class="hljs-comment">;</span>
                deptNameField.setText("")<span class="hljs-comment">;</span>
                buildPeopleField.setText("")<span class="hljs-comment">;</span>
                buildTimeField.setText("")<span class="hljs-comment">;</span>

                // 关闭页面
                frame.dispose()<span class="hljs-comment">;</span>
            }
        })<span class="hljs-comment">;</span>

        // 将输入面板和按钮面板添加到主窗口
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">2</span><span class="hljs-comment">; // 占两列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.BOTH<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weightx</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        frame.add(inputPanel, gbc)<span class="hljs-comment">;</span>

        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">1</span><span class="hljs-comment">; // 占一列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.NONE<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.CENTER<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">0.1</span><span class="hljs-comment">;</span>
        frame.add(buttonPanel, gbc)<span class="hljs-comment">;</span>

        // 设置窗口可见
        frame.setVisible(true)<span class="hljs-comment">;</span>
    }

    // 辅助方法：添加标签和输入框到面板
    private void addComponent(JPanel panel, JLabel label, JComponent textField, GridBagConstraints gbc) {
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.EAST<span class="hljs-comment">;</span>
        panel.add(label, gbc)<span class="hljs-comment">;</span>

        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.WEST<span class="hljs-comment">;</span>
        panel.add(textField, gbc)<span class="hljs-comment">;</span>
    }


}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-39">7.2.7AddEmpUI.java</h4>
<pre><code class="hljs language-ini" lang="ini">package com.jxl_dyw.UI<span class="hljs-comment">;</span>

import com.jxl_dyw.entity.Employee<span class="hljs-comment">;</span>

import javax.swing.*<span class="hljs-comment">;</span>
import java.awt.*<span class="hljs-comment">;</span>
import java.awt.event.ActionEvent<span class="hljs-comment">;</span>
import java.awt.event.ActionListener<span class="hljs-comment">;</span>
import java.io.IOException<span class="hljs-comment">;</span>

public class AddEmpUI extends JFrame {
    public AddEmpUI() {
        // 创建 JFrame
        JFrame <span class="hljs-attr">frame</span> = new JFrame(<span class="hljs-string">"新增员工"</span>)<span class="hljs-comment">;</span>
        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE)<span class="hljs-comment">; // 关闭时只关闭当前窗口，不退出整个程序</span>
        frame.setSize(800, 600)<span class="hljs-comment">; // 增大窗口尺寸</span>
        frame.setLocationRelativeTo(null)<span class="hljs-comment">; // 居中显示窗口</span>

        // 使用 GridBagLayout 进行布局
        frame.setLayout(new GridBagLayout())<span class="hljs-comment">;</span>
        GridBagConstraints <span class="hljs-attr">gbc</span> = new GridBagConstraints()<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.insets</span> = new Insets(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>)<span class="hljs-comment">; // 增大组件之间的间距</span>

        // 创建一个面板用于存放所有输入字段
        JPanel <span class="hljs-attr">inputPanel</span> = new JPanel(new GridBagLayout())<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

        // 设置全局字体，使所有组件的文字更大
        Font <span class="hljs-attr">font</span> = new Font(<span class="hljs-string">"宋体"</span>, Font.PLAIN, <span class="hljs-number">18</span>)<span class="hljs-comment">;</span>

        // 创建组件并添加到面板
        JLabel <span class="hljs-attr">empIdLabel</span> = new JLabel(<span class="hljs-string">"员工ID:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">empIdField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        empIdLabel.setFont(font)<span class="hljs-comment">;</span>
        empIdField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, empIdLabel, empIdField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">nameLabel</span> = new JLabel(<span class="hljs-string">"姓名:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">nameField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        nameLabel.setFont(font)<span class="hljs-comment">;</span>
        nameField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, nameLabel, nameField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">sexLabel</span> = new JLabel(<span class="hljs-string">"性别:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">sexField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        sexLabel.setFont(font)<span class="hljs-comment">;</span>
        sexField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, sexLabel, sexField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">birthdayLabel</span> = new JLabel(<span class="hljs-string">"出生年月:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">birthdayField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        birthdayLabel.setFont(font)<span class="hljs-comment">;</span>
        birthdayField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, birthdayLabel, birthdayField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">workdayLabel</span> = new JLabel(<span class="hljs-string">"工作年月:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">workdayField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        workdayLabel.setFont(font)<span class="hljs-comment">;</span>
        workdayField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, workdayLabel, workdayField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">educationLabel</span> = new JLabel(<span class="hljs-string">"学历:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">educationField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        educationLabel.setFont(font)<span class="hljs-comment">;</span>
        educationField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, educationLabel, educationField, gbc)<span class="hljs-comment">;</span>

        // 部门标签
        JLabel <span class="hljs-attr">positionLabel</span> = new JLabel(<span class="hljs-string">"部门:"</span>)<span class="hljs-comment">;</span>
        positionLabel.setFont(font)<span class="hljs-comment">;</span>
        //获取部门哈希表中所有的键
        String<span class="hljs-section">[]</span> <span class="hljs-attr">departments</span> = DeptUI.getDeptMap().keys().toArray(new String[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span>
        // 创建下拉框，并添加预定义的部门选项
        JComboBox&lt;String&gt; <span class="hljs-attr">positionComboBox</span> = new JComboBox&lt;&gt;(departments)<span class="hljs-comment">;</span>
        positionComboBox.setFont(font)<span class="hljs-comment">;</span>
        // 将标签和下拉框添加到面板中
        addComponent(inputPanel, positionLabel, positionComboBox, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">addressLabel</span> = new JLabel(<span class="hljs-string">"住址:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">addressField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        addressLabel.setFont(font)<span class="hljs-comment">;</span>
        addressField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, addressLabel, addressField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">phoneLabel</span> = new JLabel(<span class="hljs-string">"电话:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">phoneField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        phoneLabel.setFont(font)<span class="hljs-comment">;</span>
        phoneField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, phoneLabel, phoneField, gbc)<span class="hljs-comment">;</span>

        // 创建按钮面板
        JPanel <span class="hljs-attr">buttonPanel</span> = new JPanel()<span class="hljs-comment">;</span>
        JButton <span class="hljs-attr">addButton</span> = new JButton(<span class="hljs-string">"添加"</span>)<span class="hljs-comment">;</span>
        addButton.setFont(font)<span class="hljs-comment">; // 设置按钮字体</span>
        buttonPanel.add(addButton)<span class="hljs-comment">;</span>

        // 添加按钮点击事件监听器
        addButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // 获取输入的员工信息
                String <span class="hljs-attr">empId</span> = empIdField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">name</span> = nameField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">sex</span> = sexField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">birthday</span> = birthdayField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">workday</span> = workdayField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">education</span> = educationField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">position</span> = positionComboBox.getSelectedItem().toString()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">address</span> = addressField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">phone</span> = phoneField.getText().trim()<span class="hljs-comment">;</span>
                //验证输入出生日期格式
                if (!birthday.matches("\d{4}-\d{2}-\d{2}")) {
                    JOptionPane.showMessageDialog(frame, "出生年月格式不正确，请输入yyyy-MM-dd格式！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                //验证输入工作日期格式
                if (!workday.matches("\d{4}-\d{2}-\d{2}")) {
                    JOptionPane.showMessageDialog(frame, "工作年月格式不正确，请输入yyyy-MM-dd格式！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                // 验证输入是否为空
                if (empId.isEmpty() || name.isEmpty() || sex.isEmpty() || birthday.isEmpty() || workday.isEmpty() ||
                        education.isEmpty() || position.isEmpty() || address.isEmpty() || phone.isEmpty()) {
                    JOptionPane.showMessageDialog(frame, "请填写所有必填项！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }

                // 创建 Employee 对象
                Employee <span class="hljs-attr">employee</span> = new Employee(empId, name, sex, birthday, workday, education, position, address, phone)<span class="hljs-comment">;</span>
                //如果员工名称已存在，则提示不可添加
                if (EmpUI.getEmployeeMap().get(employee.getName()) != null) {
                    JOptionPane.showMessageDialog(frame, "员工已存在，请勿重复添加！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                // 将 Employee 对象添加到哈希表中，以员工的名字作为键
                EmpUI.getEmployeeMap().put(employee.getName(), employee)<span class="hljs-comment">;</span>
                //刷新表格
                EmpUI.refreshTable()<span class="hljs-comment">;</span>
                //将员工信息写入文件
                try {
                    EmpUI.writeEmployeesToFile(EmpUI.filePath)<span class="hljs-comment">;</span>
                } catch (IOException ex) {
                    throw new RuntimeException(ex)<span class="hljs-comment">;</span>
                }

                // 清空输入框
                empIdField.setText("")<span class="hljs-comment">;</span>
                nameField.setText("")<span class="hljs-comment">;</span>
                sexField.setText("")<span class="hljs-comment">;</span>
                birthdayField.setText("")<span class="hljs-comment">;</span>
                workdayField.setText("")<span class="hljs-comment">;</span>
                educationField.setText("")<span class="hljs-comment">;</span>
                positionComboBox.setSelectedItem("")<span class="hljs-comment">;</span>
                addressField.setText("")<span class="hljs-comment">;</span>
                phoneField.setText("")<span class="hljs-comment">;</span>
                //关闭页面
                frame.dispose()<span class="hljs-comment">;</span>
            }
        })<span class="hljs-comment">;</span>

        // 将输入面板和按钮面板添加到主窗口
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">2</span><span class="hljs-comment">; // 占两列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.BOTH<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weightx</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        frame.add(inputPanel, gbc)<span class="hljs-comment">;</span>

        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">1</span><span class="hljs-comment">; // 占一列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.NONE<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.CENTER<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">0.1</span><span class="hljs-comment">;</span>
        frame.add(buttonPanel, gbc)<span class="hljs-comment">;</span>

        // 设置窗口可见
        frame.setVisible(true)<span class="hljs-comment">;</span>
    }

    // 辅助方法：添加标签和输入框到面板
    private void addComponent(JPanel panel, JLabel label, JComponent textField, GridBagConstraints gbc) {
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.EAST<span class="hljs-comment">;</span>
        panel.add(label, gbc)<span class="hljs-comment">;</span>

        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.WEST<span class="hljs-comment">;</span>
        panel.add(textField, gbc)<span class="hljs-comment">;</span>
    }

}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-40">7.2.8DeptUI.java</h4>
<pre><code class="hljs language-scss" lang="scss">package com<span class="hljs-selector-class">.jxl_dyw</span><span class="hljs-selector-class">.UI</span>;

import com<span class="hljs-selector-class">.jxl_dyw</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.Dept</span>;
import com<span class="hljs-selector-class">.jxl_dyw</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.Employee</span>;
import com<span class="hljs-selector-class">.jxl_dyw</span><span class="hljs-selector-class">.hashMap</span><span class="hljs-selector-class">.MyHashMap</span>;

import javax<span class="hljs-selector-class">.swing</span>.*;
import javax<span class="hljs-selector-class">.swing</span><span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.DefaultTableModel</span>;
import java<span class="hljs-selector-class">.awt</span>.*;
import java<span class="hljs-selector-class">.awt</span><span class="hljs-selector-class">.event</span><span class="hljs-selector-class">.ActionEvent</span>;
import java<span class="hljs-selector-class">.awt</span><span class="hljs-selector-class">.event</span><span class="hljs-selector-class">.ActionListener</span>;
import java<span class="hljs-selector-class">.awt</span><span class="hljs-selector-class">.event</span><span class="hljs-selector-class">.MouseAdapter</span>;
import java<span class="hljs-selector-class">.awt</span><span class="hljs-selector-class">.event</span><span class="hljs-selector-class">.MouseEvent</span>;
import java<span class="hljs-selector-class">.io</span>.*;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Arrays</span>;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.HashMap</span>;

<span class="hljs-comment">/**
 * 部门类型的UI界面
 */</span>
public class DeptUI extends JPanel {
    private JTable departmentTable;
    private static DefaultTableModel tableModel;
    <span class="hljs-comment">// 部门信息文件路径</span>
    static String filePath = "<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/resources/Dept<span class="hljs-selector-class">.csv</span>";
    private static MyHashMap&lt;String, Dept&gt; deptMap=new MyHashMap&lt;&gt;();

    public static MyHashMap&lt;String, Dept&gt; <span class="hljs-built_in">getDeptMap</span>() {
        return deptMap;
    }

    public <span class="hljs-built_in">DeptUI</span>() throws IOException {
        <span class="hljs-built_in">setLayout</span>(new BorderLayout());
        <span class="hljs-comment">// 从文件中读取部门数据</span>
        <span class="hljs-built_in">readDeptFromFile</span>(filePath);
        <span class="hljs-comment">// 创建表格模型</span>
        String<span class="hljs-selector-attr">[]</span> columnNames = {"ID", "部门名称", "负责人", "成立日期"};
        tableModel = new <span class="hljs-built_in">DefaultTableModel</span>(columnNames, <span class="hljs-number">0</span>); <span class="hljs-comment">// 初始化为空表格</span>

        <span class="hljs-comment">// 读取哈希表的数据，并将对象中的数据添加到表格中</span>
        for (Dept dept : deptMap.values()) {
            <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> rowData = {
                    dept<span class="hljs-selector-class">.getDeptId</span>(),
                    dept<span class="hljs-selector-class">.getDeptName</span>(),
                    dept<span class="hljs-selector-class">.getBuildPeople</span>(),
                    dept<span class="hljs-selector-class">.getBuildTime</span>()
            };
            tableModel<span class="hljs-selector-class">.addRow</span>(rowData); <span class="hljs-comment">// 将每一行数据添加到表格模型中</span>
        }

        <span class="hljs-comment">// 创建表格</span>
        departmentTable = new <span class="hljs-built_in">JTable</span>(tableModel);
        JScrollPane scrollPane = new <span class="hljs-built_in">JScrollPane</span>(departmentTable);
        <span class="hljs-built_in">add</span>(scrollPane, BorderLayout.CENTER);

        <span class="hljs-comment">// 创建顶部栏</span>
        JPanel topPanel = new <span class="hljs-built_in">JPanel</span>();
        topPanel<span class="hljs-selector-class">.setLayout</span>(new FlowLayout(FlowLayout.LEFT));

        <span class="hljs-comment">// 查询按钮</span>
        JButton checkButton = new <span class="hljs-built_in">JButton</span>("查询部门");
        <span class="hljs-comment">// 搜索框</span>
        JTextField searchField = new <span class="hljs-built_in">JTextField</span>(<span class="hljs-number">20</span>);
        JButton addButton = new <span class="hljs-built_in">JButton</span>("新增部门");
        <span class="hljs-comment">//排序下拉列表框</span>
        JComboBox&lt;String&gt; comboBox = new JComboBox&lt;&gt;();
        comboBox<span class="hljs-selector-class">.addItem</span>("默认");
        comboBox<span class="hljs-selector-class">.addItem</span>("部门名称a-&gt;z升序");
        comboBox<span class="hljs-selector-class">.addItem</span>("部门名称z-&gt;a降序");


        topPanel<span class="hljs-selector-class">.add</span>(checkButton);
        topPanel<span class="hljs-selector-class">.add</span>(searchField);
        topPanel<span class="hljs-selector-class">.add</span>(addButton);
        topPanel<span class="hljs-selector-class">.add</span>(comboBox);

        <span class="hljs-built_in">add</span>(topPanel, BorderLayout.NORTH);

        <span class="hljs-comment">// 调整表格的行高</span>
        for (int row = <span class="hljs-number">0</span>; row &lt; departmentTable.getRowCount(); row++) {
            departmentTable<span class="hljs-selector-class">.setRowHeight</span>(<span class="hljs-number">30</span>); <span class="hljs-comment">// 调整行高以适应按钮</span>
            <span class="hljs-comment">//设置表格的字体</span>
            departmentTable<span class="hljs-selector-class">.setFont</span>(new Font("宋体", Font.PLAIN, <span class="hljs-number">14</span>));
        }
        addButton<span class="hljs-selector-class">.addActionListener</span>(e -&gt; {
            AddDeptUI addDeptUI = new AddDeptUI();
        });

        <span class="hljs-comment">//为下拉框的选项添加事件监听器</span>
        comboBox<span class="hljs-selector-class">.addActionListener</span>(new ActionListener() {
            <span class="hljs-keyword">@Override</span>
            public void actionPerformed(ActionEvent e) {
                <span class="hljs-selector-tag">Object</span> selected = comboBox<span class="hljs-selector-class">.getSelectedItem</span>();
                if (selected.equals("部门名称a-&gt;z升序")) {
                    <span class="hljs-comment">//按姓名a-&gt;z升序</span>
                    <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> sortAsc = deptMap<span class="hljs-selector-class">.sortByNameAsc</span>(deptMap);
                    String<span class="hljs-selector-attr">[]</span> stringSortAsc = Arrays<span class="hljs-selector-class">.copyOf</span>(sortAsc, sortAsc.length, String[].class);
                    <span class="hljs-built_in">refreshTablesort</span>(stringSortAsc);

                    <span class="hljs-comment">//刷新表格</span>

                } else if (selected.equals("部门名称z-&gt;a降序")) {
                    <span class="hljs-comment">//按姓名z-&gt;a降序</span>
                    <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> sortDesc = deptMap<span class="hljs-selector-class">.sortByNameDesc</span>(deptMap);
                    String<span class="hljs-selector-attr">[]</span> stringSortDesc = Arrays<span class="hljs-selector-class">.copyOf</span>(sortDesc, sortDesc.length, String[].class);
                    <span class="hljs-built_in">refreshTablesort</span>(stringSortDesc);

                    <span class="hljs-comment">//刷新表格</span>

                }else {
                    <span class="hljs-built_in">refreshTable</span>();
                }
            }
        });

        <span class="hljs-comment">// 为查询按钮添加事件监听器</span>
        checkButton<span class="hljs-selector-class">.addActionListener</span>(new ActionListener() {
            <span class="hljs-keyword">@Override</span>
            public void actionPerformed(ActionEvent e) {
                String searchName = searchField<span class="hljs-selector-class">.getText</span>()<span class="hljs-selector-class">.trim</span>();

                <span class="hljs-comment">// 清空表格</span>
                tableModel<span class="hljs-selector-class">.setRowCount</span>(<span class="hljs-number">0</span>);

                if (searchName.isEmpty()) {
                    <span class="hljs-built_in">refreshTable</span>();
                } else {
                    boolean found = false;
                    for (Dept dept : deptMap.values()) {
                        if (dept.getDeptName()<span class="hljs-selector-class">.contains</span>(searchName)) {
                            <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> rowData = {
                                    dept<span class="hljs-selector-class">.getDeptId</span>(),
                                    dept<span class="hljs-selector-class">.getDeptName</span>(),
                                    dept<span class="hljs-selector-class">.getBuildPeople</span>(),
                                    dept<span class="hljs-selector-class">.getBuildTime</span>()
                            };
                            tableModel<span class="hljs-selector-class">.addRow</span>(rowData);
                            found = true;
                        }
                    }
                    if (!found) {
                        JOptionPane<span class="hljs-selector-class">.showMessageDialog</span>(DeptUI.this, "未找到匹配的部门", "查询结果", JOptionPane.WARNING_MESSAGE);
                    }
                }
            }
        });
       <span class="hljs-comment">// 添加鼠标右键菜单</span>
        departmentTable<span class="hljs-selector-class">.addMouseListener</span>(new MouseAdapter() {
            <span class="hljs-keyword">@Override</span>
            public void mouseReleased(MouseEvent e) {
                if (e.isPopupTrigger()) {
                    int row = departmentTable<span class="hljs-selector-class">.rowAtPoint</span>(e.getPoint());
                    if (row &gt;= <span class="hljs-number">0</span>) {
                        <span class="hljs-built_in">showPopupMenu</span>(e, row);
                    }
                }
            }
        });
    }

    <span class="hljs-comment">// 刷新排序后的表格</span>
    private void <span class="hljs-built_in">refreshTablesort</span>(String []keys) {
        <span class="hljs-comment">// 清空表格</span>
        tableModel<span class="hljs-selector-class">.setRowCount</span>(<span class="hljs-number">0</span>);

        <span class="hljs-comment">// 遍历哈希表，将每个员工的信息添加到表格中</span>
        for (String key: keys) {
            <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> rowData = {
                    deptMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getDeptId</span>(),
                    deptMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getDeptName</span>(),
                    deptMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getBuildPeople</span>(),
                    deptMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getBuildTime</span>()
            };
            tableModel<span class="hljs-selector-class">.addRow</span>(rowData); <span class="hljs-comment">// 将每一行数据添加到表格模型中</span>
        }
    }

    <span class="hljs-comment">// 显示鼠标右键菜单</span>
    private void <span class="hljs-built_in">showPopupMenu</span>(MouseEvent e, int row) {
        JPopupMenu popupMenu = new <span class="hljs-built_in">JPopupMenu</span>();

        JMenuItem editItem = new <span class="hljs-built_in">JMenuItem</span>("编辑");
        editItem<span class="hljs-selector-class">.addActionListener</span>(new ActionListener() {
            <span class="hljs-keyword">@Override</span>
            public void actionPerformed(ActionEvent e) {
                <span class="hljs-comment">// 获取选中的行数据</span>
                String deptName = (String) tableModel<span class="hljs-selector-class">.getValueAt</span>(row, <span class="hljs-number">1</span>);
                Dept dept = deptMap<span class="hljs-selector-class">.get</span>(deptName);

                <span class="hljs-comment">// 弹出编辑窗口</span>
                new <span class="hljs-built_in">EditDeptUI</span>(dept);
            }
        });
        popupMenu<span class="hljs-selector-class">.add</span>(editItem);

        JMenuItem deleteItem = new <span class="hljs-built_in">JMenuItem</span>("删除");
        deleteItem<span class="hljs-selector-class">.addActionListener</span>(new ActionListener() {
            <span class="hljs-keyword">@Override</span>
            public void actionPerformed(ActionEvent e) {
                <span class="hljs-comment">// 获取选中的行数据</span>
                String deptName = (String) tableModel<span class="hljs-selector-class">.getValueAt</span>(row, <span class="hljs-number">1</span>);
                Dept dept = deptMap<span class="hljs-selector-class">.get</span>(deptName);

                <span class="hljs-comment">// 弹出确认对话框</span>
                int confirm = JOptionPane<span class="hljs-selector-class">.showConfirmDialog</span>(DeptUI.this, "确定要删除部门 " + dept.getDeptName() + " 吗？", "确认删除", JOptionPane<span class="hljs-selector-class">.YES_NO_OPTION</span>);
                <span class="hljs-comment">//如果该部门下有员工，则不能删除</span>
                if (hasEmployee(deptName)) {
                    JOptionPane<span class="hljs-selector-class">.showMessageDialog</span>(DeptUI.this, "该部门下有员工，不能删除", "错误", JOptionPane.ERROR_MESSAGE);
                    return;
                }
                if (confirm == JOptionPane.YES_OPTION) {
                    <span class="hljs-comment">// 删除部门</span>
                    deptMap<span class="hljs-selector-class">.remove</span>(deptName);
                    tableModel<span class="hljs-selector-class">.removeRow</span>(row);

                    <span class="hljs-comment">// 将新的数据写入文件中</span>
                    try {
                        <span class="hljs-built_in">writeDeptToFile</span>(filePath);
                    } catch (IOException ex) {
                        JOptionPane<span class="hljs-selector-class">.showMessageDialog</span>(DeptUI.this, "保存部门信息失败: " + ex.getMessage(), "错误", JOptionPane<span class="hljs-selector-class">.ERROR_MESSAGE</span>);
                    }
                }
            }
        });
        popupMenu<span class="hljs-selector-class">.add</span>(deleteItem);

        popupMenu<span class="hljs-selector-class">.show</span>(e.getComponent(), e<span class="hljs-selector-class">.getX</span>(), e<span class="hljs-selector-class">.getY</span>());
    }

    <span class="hljs-comment">//判断该部门是否有员工</span>
    public static boolean <span class="hljs-built_in">hasEmployee</span>(String deptName) {
        for (Employee emp : EmpUI.getEmployeeMap()<span class="hljs-selector-class">.values</span>()) {
            if (emp.getPosition()<span class="hljs-selector-class">.equals</span>(deptName)) {
                return true;
            }
        }
        return false;
    }

    <span class="hljs-comment">//将哈希表中的数据写入到CSV文件中</span>
    public static void <span class="hljs-built_in">writeDeptToFile</span>(String filePath) throws IOException {
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(filePath))) {

            <span class="hljs-comment">// 遍历哈希表，将每个员工的信息写入CSV文件</span>
            for (Dept dept : deptMap.values()) {
                writer<span class="hljs-selector-class">.write</span>(String.join(",",
                        dept.getDeptId(),
                        dept<span class="hljs-selector-class">.getDeptName</span>(),
                        dept<span class="hljs-selector-class">.getBuildPeople</span>(),
                        dept<span class="hljs-selector-class">.getBuildTime</span>()
                ));
                writer<span class="hljs-selector-class">.newLine</span>();
            }
        }
    }


    <span class="hljs-comment">// 刷新表格，重新加载哈希表中的数据</span>
    public static void <span class="hljs-built_in">refreshTable</span>() {
        <span class="hljs-built_in">loadDeptDataToTable</span>();
    }


    <span class="hljs-comment">// 从哈希表中加载员工数据到表格</span>
    private static void <span class="hljs-built_in">loadDeptDataToTable</span>() {
        <span class="hljs-comment">// 清空表格</span>
        tableModel<span class="hljs-selector-class">.setRowCount</span>(<span class="hljs-number">0</span>);

        <span class="hljs-comment">// 遍历哈希表，将每个员工的信息添加到表格中</span>
        for (Dept dept : deptMap.values()) {
            <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> rowData = {
                    dept<span class="hljs-selector-class">.getDeptId</span>(),
                    dept<span class="hljs-selector-class">.getDeptName</span>(),
                    dept<span class="hljs-selector-class">.getBuildPeople</span>(),
                    dept<span class="hljs-selector-class">.getBuildTime</span>()
            };
            tableModel<span class="hljs-selector-class">.addRow</span>(rowData); <span class="hljs-comment">// 将每一行数据添加到表格模型中</span>
        }
    }

    <span class="hljs-comment">// 读取 CSV 文件并将数据添加到 employeeMap 中</span>
    public void <span class="hljs-built_in">readDeptFromFile</span>(String filePath) throws IOException {
        try (BufferedReader br = new BufferedReader(new FileReader(filePath))) {
            String line;
            while ((line = br.readLine()) != null) {
                <span class="hljs-comment">// 按逗号分隔每一行</span>
                String<span class="hljs-selector-attr">[]</span> fields = line<span class="hljs-selector-class">.split</span>(",");

                <span class="hljs-comment">// 创建 Employee 对象</span>
                Dept dept = new <span class="hljs-built_in">Dept</span>(
                        fields[<span class="hljs-number">0</span>],
                        fields[<span class="hljs-number">1</span>],
                        fields[<span class="hljs-number">2</span>],
                        fields[<span class="hljs-number">3</span>]
                );

                <span class="hljs-comment">// 将 dept对象添加到哈希表中，以部门的名字作为键</span>
                deptMap<span class="hljs-selector-class">.put</span>(dept.getDeptName(), dept);
            }
        }
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-41">7.2.9EditDeptUI.java</h4>
<pre><code class="hljs language-ini" lang="ini">package com.jxl_dyw.UI<span class="hljs-comment">;</span>

import com.jxl_dyw.entity.Dept<span class="hljs-comment">;</span>
import javax.swing.*<span class="hljs-comment">;</span>
import java.awt.*<span class="hljs-comment">;</span>
import java.awt.event.ActionEvent<span class="hljs-comment">;</span>
import java.awt.event.ActionListener<span class="hljs-comment">;</span>
import java.io.IOException<span class="hljs-comment">;</span>

public class EditDeptUI {


    public  EditDeptUI(Dept dept) {
        // 创建 JFrame
        JFrame <span class="hljs-attr">frame</span> = new JFrame(<span class="hljs-string">"编辑部门"</span>)<span class="hljs-comment">;</span>
        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE)<span class="hljs-comment">; // 关闭时只关闭当前窗口，不退出整个程序</span>
        frame.setSize(800, 600)<span class="hljs-comment">; // 增大窗口尺寸</span>
        frame.setLocationRelativeTo(null)<span class="hljs-comment">; // 居中显示窗口</span>

        // 使用 GridBagLayout 进行布局
        frame.setLayout(new GridBagLayout())<span class="hljs-comment">;</span>
        GridBagConstraints <span class="hljs-attr">gbc</span> = new GridBagConstraints()<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.insets</span> = new Insets(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>)<span class="hljs-comment">; // 增大组件之间的间距</span>

        // 创建一个面板用于存放所有输入字段
        JPanel <span class="hljs-attr">inputPanel</span> = new JPanel(new GridBagLayout())<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

        // 设置全局字体，使所有组件的文字更大
        Font <span class="hljs-attr">font</span> = new Font(<span class="hljs-string">"宋体"</span>, Font.PLAIN, <span class="hljs-number">18</span>)<span class="hljs-comment">;</span>

        // 创建组件并添加到面板
        JLabel <span class="hljs-attr">deptIdLabel</span> = new JLabel(<span class="hljs-string">"部门编号:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">deptIdField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        deptIdLabel.setFont(font)<span class="hljs-comment">;</span>
        deptIdField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, deptIdLabel, deptIdField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">deptNameLabel</span> = new JLabel(<span class="hljs-string">"部门名称:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">deptNameField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        deptNameLabel.setFont(font)<span class="hljs-comment">;</span>
        deptNameField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, deptNameLabel, deptNameField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">buildPeopleLabel</span> = new JLabel(<span class="hljs-string">"负责人:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">buildPeopleField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        buildPeopleLabel.setFont(font)<span class="hljs-comment">;</span>
        buildPeopleField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, buildPeopleLabel, buildPeopleField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">buildTimeLabel</span> = new JLabel(<span class="hljs-string">"成立日期:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">buildTimeField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        buildTimeLabel.setFont(font)<span class="hljs-comment">;</span>
        buildTimeField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, buildTimeLabel, buildTimeField, gbc)<span class="hljs-comment">;</span>

        // 将获取的对象的数据放入各个输入框内
        deptIdField.setText(dept.getDeptId())<span class="hljs-comment">;</span>
        deptNameField.setEditable(false)<span class="hljs-comment">; // 部门名称不允许修改</span>
        deptNameField.setText(dept.getDeptName())<span class="hljs-comment">;</span>
        buildPeopleField.setText(dept.getBuildPeople())<span class="hljs-comment">;</span>
        buildTimeField.setText(dept.getBuildTime())<span class="hljs-comment">;</span>

        // 创建按钮面板
        JPanel <span class="hljs-attr">buttonPanel</span> = new JPanel()<span class="hljs-comment">;</span>
        JButton <span class="hljs-attr">saveButton</span> = new JButton(<span class="hljs-string">"修改"</span>)<span class="hljs-comment">;</span>
        saveButton.setFont(font)<span class="hljs-comment">; // 设置按钮字体</span>
        buttonPanel.add(saveButton)<span class="hljs-comment">;</span>

        // 添加按钮点击事件监听器
        saveButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // 获取输入的部门信息
                String <span class="hljs-attr">deptId</span> = deptIdField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">deptName</span> = deptNameField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">buildPeople</span> = buildPeopleField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">buildTime</span> = buildTimeField.getText().trim()<span class="hljs-comment">;</span>
                // 判断部门编号是否为纯数字
                if (!deptId.matches("\d+")) {
                    JOptionPane.showMessageDialog(frame, "部门编号必须为纯数字！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                //对日期输入的格式进行验证
                if (!buildTime.matches("\d{4}-\d{2}-\d{2}")) {
                    JOptionPane.showMessageDialog(frame, "日期格式不正确，请输入yyyy-MM-dd格式的日期！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                // 验证输入是否为空
                if (deptId.isEmpty()||deptName.isEmpty() || buildPeople.isEmpty() || buildTime.isEmpty()) {
                    JOptionPane.showMessageDialog(frame, "请填写所有必填项！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }

                // 更新 Dept 对象
                Dept <span class="hljs-attr">dept</span> = new Dept(deptId, deptName, buildPeople, buildTime)<span class="hljs-comment">;</span>
                //添加到哈希表中
                DeptUI.getDeptMap().put(dept.getDeptName(), dept)<span class="hljs-comment">;</span>

                // 刷新部门表格
                DeptUI.refreshTable()<span class="hljs-comment">;</span>

                // 将部门信息写入文件
                try {
                    DeptUI.writeDeptToFile(DeptUI.filePath)<span class="hljs-comment">;</span>
                } catch (IOException ex) {
                    JOptionPane.showMessageDialog(frame, "保存部门信息失败: " + ex.getMessage(), "错误", JOptionPane.ERROR_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }

                //清空输入框
                deptIdField.setText("")<span class="hljs-comment">;</span>
                deptNameField.setText("")<span class="hljs-comment">;</span>
                buildPeopleField.setText("")<span class="hljs-comment">;</span>
                buildTimeField.setText("")<span class="hljs-comment">;</span>
                // 关闭页面
                frame.dispose()<span class="hljs-comment">;</span>
            }
        })<span class="hljs-comment">;</span>

        // 将输入面板和按钮面板添加到主窗口
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">2</span><span class="hljs-comment">; // 占两列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.BOTH<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weightx</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        frame.add(inputPanel, gbc)<span class="hljs-comment">;</span>

        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">1</span><span class="hljs-comment">; // 占一列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.NONE<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.CENTER<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">0.1</span><span class="hljs-comment">;</span>
        frame.add(buttonPanel, gbc)<span class="hljs-comment">;</span>

        // 设置窗口可见
        frame.setVisible(true)<span class="hljs-comment">;</span>
    }


    // 辅助方法：添加标签和输入框到面板
    private void addComponent(JPanel panel, JLabel label, JComponent textField, GridBagConstraints gbc) {
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.EAST<span class="hljs-comment">;</span>
        panel.add(label, gbc)<span class="hljs-comment">;</span>

        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.WEST<span class="hljs-comment">;</span>
        panel.add(textField, gbc)<span class="hljs-comment">;</span>
    }

}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-42">7.2.10EditEmpUI.java</h4>
<pre><code class="hljs language-ini" lang="ini">package com.jxl_dyw.UI<span class="hljs-comment">;</span>

import com.jxl_dyw.entity.Employee<span class="hljs-comment">;</span>

import javax.swing.*<span class="hljs-comment">;</span>
import java.awt.*<span class="hljs-comment">;</span>
import java.awt.event.ActionEvent<span class="hljs-comment">;</span>
import java.awt.event.ActionListener<span class="hljs-comment">;</span>
import java.io.IOException<span class="hljs-comment">;</span>

public class EditEmpUI {
    public EditEmpUI(Employee employee) {
        // 创建 JFrame
        JFrame <span class="hljs-attr">frame</span> = new JFrame(<span class="hljs-string">"编辑员工"</span>)<span class="hljs-comment">;</span>
        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE)<span class="hljs-comment">; // 关闭时只关闭当前窗口，不退出整个程序</span>
        frame.setSize(800, 600)<span class="hljs-comment">; // 增大窗口尺寸</span>
        frame.setLocationRelativeTo(null)<span class="hljs-comment">; // 居中显示窗口</span>

        // 使用 网格布局器进行布局
        frame.setLayout(new GridBagLayout())<span class="hljs-comment">;</span>
        GridBagConstraints <span class="hljs-attr">gbc</span> = new GridBagConstraints()<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.insets</span> = new Insets(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>)<span class="hljs-comment">; // 增大组件之间的间距</span>

        // 创建一个面板用于存放所有输入字段
        JPanel <span class="hljs-attr">inputPanel</span> = new JPanel(new GridBagLayout())<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

        // 设置全局字体，使所有组件的文字更大
        Font <span class="hljs-attr">font</span> = new Font(<span class="hljs-string">"宋体"</span>, Font.PLAIN, <span class="hljs-number">18</span>)<span class="hljs-comment">;</span>

        // 创建组件并添加到面板
        JLabel <span class="hljs-attr">empIdLabel</span> = new JLabel(<span class="hljs-string">"员工ID:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">empIdField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        empIdLabel.setFont(font)<span class="hljs-comment">;</span>
        empIdField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, empIdLabel, empIdField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">nameLabel</span> = new JLabel(<span class="hljs-string">"姓名:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">nameField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        nameLabel.setFont(font)<span class="hljs-comment">;</span>
        nameField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, nameLabel, nameField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">sexLabel</span> = new JLabel(<span class="hljs-string">"性别:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">sexField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        sexLabel.setFont(font)<span class="hljs-comment">;</span>
        sexField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, sexLabel, sexField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">birthdayLabel</span> = new JLabel(<span class="hljs-string">"出生年月:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">birthdayField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        birthdayLabel.setFont(font)<span class="hljs-comment">;</span>
        birthdayField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, birthdayLabel, birthdayField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">workdayLabel</span> = new JLabel(<span class="hljs-string">"工作年月:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">workdayField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        workdayLabel.setFont(font)<span class="hljs-comment">;</span>
        workdayField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, workdayLabel, workdayField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">educationLabel</span> = new JLabel(<span class="hljs-string">"学历:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">educationField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        educationLabel.setFont(font)<span class="hljs-comment">;</span>
        educationField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, educationLabel, educationField, gbc)<span class="hljs-comment">;</span>

        // 部门标签
        JLabel <span class="hljs-attr">positionLabel</span> = new JLabel(<span class="hljs-string">"部门:"</span>)<span class="hljs-comment">;</span>
        positionLabel.setFont(font)<span class="hljs-comment">;</span>
        //获取部门哈希表中所有的键
        String<span class="hljs-section">[]</span> <span class="hljs-attr">departments</span> = DeptUI.getDeptMap().keys().toArray(new String[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span>
        // 创建下拉框，并添加预定义的部门选项
        JComboBox&lt;String&gt; <span class="hljs-attr">positionComboBox</span> = new JComboBox&lt;&gt;(departments)<span class="hljs-comment">;</span>
        positionComboBox.setFont(font)<span class="hljs-comment">;</span>
        // 将标签和下拉框添加到面板中
        addComponent(inputPanel, positionLabel, positionComboBox, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">addressLabel</span> = new JLabel(<span class="hljs-string">"住址:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">addressField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        addressLabel.setFont(font)<span class="hljs-comment">;</span>
        addressField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, addressLabel, addressField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">phoneLabel</span> = new JLabel(<span class="hljs-string">"电话:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">phoneField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        phoneLabel.setFont(font)<span class="hljs-comment">;</span>
        phoneField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, phoneLabel, phoneField, gbc)<span class="hljs-comment">;</span>

        // 创建按钮面板
        JPanel <span class="hljs-attr">buttonPanel</span> = new JPanel()<span class="hljs-comment">;</span>
        JButton <span class="hljs-attr">addButton</span> = new JButton(<span class="hljs-string">"修改"</span>)<span class="hljs-comment">;</span>
        addButton.setFont(font)<span class="hljs-comment">; // 设置按钮字体</span>
        buttonPanel.add(addButton)<span class="hljs-comment">;</span>

        //将获取的对象的数据放入各个输入框内
        empIdField.setText(employee.getEmpId())<span class="hljs-comment">;</span>
        nameField.setText(employee.getName())<span class="hljs-comment">;</span>
        sexField.setText(employee.getSex())<span class="hljs-comment">;</span>
        birthdayField.setText(employee.getBirthday())<span class="hljs-comment">;</span>
        workdayField.setText(employee.getWorkday())<span class="hljs-comment">;</span>
        educationField.setText(employee.getEducation())<span class="hljs-comment">;</span>
        positionComboBox.setSelectedItem(employee.getPosition())<span class="hljs-comment">;</span>
        addressField.setText(employee.getAddress())<span class="hljs-comment">;</span>
        phoneField.setText(employee.getPhone())<span class="hljs-comment">;</span>

        //用户姓名不允许修改
        nameField.setEditable(false)<span class="hljs-comment">;</span>

        // 添加按钮点击事件监听器
        addButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // 获取输入的员工信息
                String <span class="hljs-attr">empId</span> = empIdField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">name</span> = nameField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">sex</span> = sexField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">birthday</span> = birthdayField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">workday</span> = workdayField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">education</span> = educationField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">position</span> = positionComboBox.getSelectedItem().toString()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">address</span> = addressField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">phone</span> = phoneField.getText().trim()<span class="hljs-comment">;</span>
                //验证输入出生日期格式
                if (!birthday.matches("\d{4}-\d{2}-\d{2}")) {
                    JOptionPane.showMessageDialog(frame, "出生年月格式不正确，请输入yyyy-MM-dd格式！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                //验证输入工作日期格式
                if (!workday.matches("\d{4}-\d{2}-\d{2}")) {
                    JOptionPane.showMessageDialog(frame, "工作年月格式不正确，请输入yyyy-MM-dd格式！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }
                // 验证输入是否为空
                if (empId.isEmpty() || name.isEmpty() || sex.isEmpty() || birthday.isEmpty() || workday.isEmpty() ||
                        education.isEmpty() || position.isEmpty() || address.isEmpty() || phone.isEmpty()) {
                    JOptionPane.showMessageDialog(frame, "请填写所有必填项！", "提示", JOptionPane.WARNING_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }

                // 创建 Employee 对象
                Employee <span class="hljs-attr">employee</span> = new Employee(empId, name, sex, birthday, workday, education, position, address, phone)<span class="hljs-comment">;</span>

                // 将 Employee 对象添加到哈希表中，以员工的名字作为键
                EmpUI.getEmployeeMap().put(employee.getName(), employee)<span class="hljs-comment">;</span>
                //刷新表格
                EmpUI.refreshTable()<span class="hljs-comment">;</span>
                //将员工信息写入文件
                try {
                    EmpUI.writeEmployeesToFile(EmpUI.filePath)<span class="hljs-comment">;</span>
                } catch (IOException ex) {
                    throw new RuntimeException(ex)<span class="hljs-comment">;</span>
                }

                // 清空输入框
                empIdField.setText("")<span class="hljs-comment">;</span>
                nameField.setText("")<span class="hljs-comment">;</span>
                sexField.setText("")<span class="hljs-comment">;</span>
                birthdayField.setText("")<span class="hljs-comment">;</span>
                workdayField.setText("")<span class="hljs-comment">;</span>
                educationField.setText("")<span class="hljs-comment">;</span>
                positionComboBox.setSelectedItem("")<span class="hljs-comment">;</span>
                addressField.setText("")<span class="hljs-comment">;</span>
                phoneField.setText("")<span class="hljs-comment">;</span>
                //关闭页面
                frame.dispose()<span class="hljs-comment">;</span>
            }
        })<span class="hljs-comment">;</span>

        // 将输入面板和按钮面板添加到主窗口
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">2</span><span class="hljs-comment">; // 占两列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.BOTH<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weightx</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        frame.add(inputPanel, gbc)<span class="hljs-comment">;</span>

        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">1</span><span class="hljs-comment">; // 占一列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.NONE<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.CENTER<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">0.1</span><span class="hljs-comment">;</span>
        frame.add(buttonPanel, gbc)<span class="hljs-comment">;</span>

        // 设置窗口可见
        frame.setVisible(true)<span class="hljs-comment">;</span>
    }

    // 辅助方法：添加标签和输入框到面板
    private void addComponent(JPanel panel, JLabel label, JComponent textField, GridBagConstraints gbc) {
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.EAST<span class="hljs-comment">;</span>
        panel.add(label, gbc)<span class="hljs-comment">;</span>

        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.WEST<span class="hljs-comment">;</span>
        panel.add(textField, gbc)<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-43">7.2.11EmpUI.java</h4>
<pre><code class="hljs language-scss" lang="scss">package com<span class="hljs-selector-class">.jxl_dyw</span><span class="hljs-selector-class">.UI</span>;

import com<span class="hljs-selector-class">.jxl_dyw</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.Employee</span>;
import com<span class="hljs-selector-class">.jxl_dyw</span><span class="hljs-selector-class">.hashMap</span><span class="hljs-selector-class">.MyHashMap</span>;

import javax<span class="hljs-selector-class">.swing</span>.*;
import javax<span class="hljs-selector-class">.swing</span><span class="hljs-selector-class">.table</span><span class="hljs-selector-class">.DefaultTableModel</span>;
import java<span class="hljs-selector-class">.awt</span>.*;
import java<span class="hljs-selector-class">.awt</span><span class="hljs-selector-class">.event</span><span class="hljs-selector-class">.ActionEvent</span>;
import java<span class="hljs-selector-class">.awt</span><span class="hljs-selector-class">.event</span><span class="hljs-selector-class">.ActionListener</span>;
import java<span class="hljs-selector-class">.awt</span><span class="hljs-selector-class">.event</span><span class="hljs-selector-class">.MouseAdapter</span>;
import java<span class="hljs-selector-class">.awt</span><span class="hljs-selector-class">.event</span><span class="hljs-selector-class">.MouseEvent</span>;
import java<span class="hljs-selector-class">.io</span>.*;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Arrays</span>;

<span class="hljs-comment">/**
 * 员工表面板
 */</span>
public class EmpUI extends JPanel {
    <span class="hljs-comment">// 员工表格</span>
    private JTable employeeTable;
    private static DefaultTableModel tableModel;
    <span class="hljs-comment">// 员工信息文件路径</span>
    static String filePath = "<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/resources/Emps<span class="hljs-selector-class">.csv</span>";
    <span class="hljs-comment">//用于存放员工的哈希表</span>
    private static MyHashMap&lt;String , Employee&gt; employeeMap = new MyHashMap&lt;&gt;();
    <span class="hljs-comment">//get方法</span>
    public static MyHashMap&lt;String, Employee&gt; <span class="hljs-built_in">getEmployeeMap</span>() {
        return employeeMap;
    }
    public <span class="hljs-built_in">EmpUI</span>() throws IOException {
        <span class="hljs-built_in">setLayout</span>(new BorderLayout());
        <span class="hljs-comment">//用文件输入读取Emps.csv文件中的员工信息，并添加到哈希表中</span>
        <span class="hljs-built_in">readEmployeesFromFile</span>(filePath);
        <span class="hljs-comment">// 创建表格模型员工 ID、姓名、性别、出生年月、工作年月、学历、职务、住址、电话</span>
        String<span class="hljs-selector-attr">[]</span> columnNames = {"员工 ID", "姓名", "性别", "出生年月", "工作年月", "学历", "部门", "住址", "电话"};

        tableModel = new <span class="hljs-built_in">DefaultTableModel</span>(columnNames, <span class="hljs-number">0</span>); <span class="hljs-comment">// 初始化为空表格</span>

        <span class="hljs-comment">// 读取哈希表的数据，并将对象中的数据添加到表格中</span>
        for (Employee employee : employeeMap.values()) {
            <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> rowData = {
                    employee<span class="hljs-selector-class">.getEmpId</span>(),
                    employee<span class="hljs-selector-class">.getName</span>(),
                    employee<span class="hljs-selector-class">.getSex</span>(),
                    employee<span class="hljs-selector-class">.getBirthday</span>(),
                    employee<span class="hljs-selector-class">.getWorkday</span>(),
                    employee<span class="hljs-selector-class">.getEducation</span>(),
                    employee<span class="hljs-selector-class">.getPosition</span>(),
                    employee<span class="hljs-selector-class">.getAddress</span>(),
                    employee<span class="hljs-selector-class">.getPhone</span>()
            };
            tableModel<span class="hljs-selector-class">.addRow</span>(rowData); <span class="hljs-comment">// 将每一行数据添加到表格模型中</span>
        }

        <span class="hljs-comment">// 创建表格</span>
        employeeTable = new <span class="hljs-built_in">JTable</span>(tableModel);
        <span class="hljs-comment">// 创建一个滚动面板，并将员工表格添加到其中</span>
        <span class="hljs-comment">// 确保当员工表格的内容超出屏幕显示范围时，可以通过滚动</span>
        JScrollPane scrollPane = new <span class="hljs-built_in">JScrollPane</span>(employeeTable);
        <span class="hljs-built_in">add</span>(scrollPane, BorderLayout.CENTER);

        <span class="hljs-comment">// 创建顶部栏</span>
        JPanel topPanel = new <span class="hljs-built_in">JPanel</span>();
        topPanel<span class="hljs-selector-class">.setLayout</span>(new FlowLayout(FlowLayout.LEFT));

        <span class="hljs-comment">// 查询按钮</span>
        JButton checkButton = new <span class="hljs-built_in">JButton</span>("查询员工");
        <span class="hljs-comment">//增加搜索栏</span>
        JTextField searchField = new <span class="hljs-built_in">JTextField</span>(<span class="hljs-number">20</span>);
        JButton addButton = new <span class="hljs-built_in">JButton</span>("新增员工");
        <span class="hljs-comment">//排序下拉列表框</span>
        JComboBox&lt;String&gt; comboBox = new JComboBox&lt;&gt;();
        comboBox<span class="hljs-selector-class">.addItem</span>("默认");
        comboBox<span class="hljs-selector-class">.addItem</span>("姓名a-&gt;z升序");
        comboBox<span class="hljs-selector-class">.addItem</span>("姓名z-&gt;a降序");



        topPanel<span class="hljs-selector-class">.add</span>(checkButton);
        topPanel<span class="hljs-selector-class">.add</span>(searchField);
        topPanel<span class="hljs-selector-class">.add</span>(addButton);
        topPanel<span class="hljs-selector-class">.add</span>(comboBox);

        <span class="hljs-built_in">add</span>(topPanel, BorderLayout.NORTH);

        <span class="hljs-comment">// 调整表格的行高</span>
        for (int row = <span class="hljs-number">0</span>; row &lt; employeeTable.getRowCount(); row++) {
            employeeTable<span class="hljs-selector-class">.setRowHeight</span>(<span class="hljs-number">30</span>); <span class="hljs-comment">// 调整行高以适应按钮</span>
            <span class="hljs-comment">//设置表格的字体</span>
            employeeTable<span class="hljs-selector-class">.setFont</span>(new Font("宋体", Font.PLAIN, <span class="hljs-number">14</span>));
        }
        <span class="hljs-comment">//添加按钮的监听器</span>
        addButton<span class="hljs-selector-class">.addActionListener</span>(e -&gt; {
            new AddEmpUI();
        });

        <span class="hljs-comment">//为下拉框的选项添加事件监听器</span>
        comboBox<span class="hljs-selector-class">.addActionListener</span>(new ActionListener() {
            <span class="hljs-keyword">@Override</span>
            public void actionPerformed(ActionEvent e) {
                <span class="hljs-selector-tag">Object</span> selected = comboBox<span class="hljs-selector-class">.getSelectedItem</span>();
                if (selected.equals("姓名a-&gt;z升序")) {
                    <span class="hljs-comment">//按姓名a-&gt;z升序</span>
                    <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> sortAsc = employeeMap<span class="hljs-selector-class">.sortByNameAsc</span>(employeeMap);
                    <span class="hljs-comment">// 创建一个新的字符串数组，长度与sortAsc数组相同，并将sortAsc数组的内容复制到新数组中</span>
                    String<span class="hljs-selector-attr">[]</span> stringSortAsc = Arrays<span class="hljs-selector-class">.copyOf</span>(sortAsc, sortAsc.length, String[].class);
                    <span class="hljs-comment">//刷新表格</span>
                    <span class="hljs-built_in">refreshTablesort</span>(stringSortAsc);

                } else if (selected.equals("姓名z-&gt;a降序")) {
                    <span class="hljs-comment">//按姓名z-&gt;a降序</span>
                    <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> sortDesc = employeeMap<span class="hljs-selector-class">.sortByNameDesc</span>(employeeMap);
                    String<span class="hljs-selector-attr">[]</span> stringSortDesc = Arrays<span class="hljs-selector-class">.copyOf</span>(sortDesc, sortDesc.length, String[].class);
                    <span class="hljs-comment">//刷新表格</span>
                    <span class="hljs-built_in">refreshTablesort</span>(stringSortDesc);

                }else {
                    <span class="hljs-comment">//默认刷新表格</span>
                    <span class="hljs-built_in">refreshTable</span>();
                }
            }
        });


        <span class="hljs-comment">// 为查询按钮添加事件监听器</span>
        checkButton<span class="hljs-selector-class">.addActionListener</span>(new ActionListener() {
            <span class="hljs-keyword">@Override</span>
            public void actionPerformed(ActionEvent e) {
                String searchName = searchField<span class="hljs-selector-class">.getText</span>()<span class="hljs-selector-class">.trim</span>();

                <span class="hljs-comment">// 清空表格</span>
                tableModel<span class="hljs-selector-class">.setRowCount</span>(<span class="hljs-number">0</span>);

                if (searchName.isEmpty()) {
                    <span class="hljs-built_in">refreshTable</span>();
                } else {
                    boolean found = false;
                    for (Employee employee : employeeMap.values()) {
                        if (employee.getName()<span class="hljs-selector-class">.contains</span>(searchName) || employee<span class="hljs-selector-class">.getName</span>()<span class="hljs-selector-class">.contains</span>(searchName)) {
                            <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> rowData = {
                                    employee<span class="hljs-selector-class">.getEmpId</span>(),
                                    employee<span class="hljs-selector-class">.getName</span>(),
                                    employee<span class="hljs-selector-class">.getSex</span>(),
                                    employee<span class="hljs-selector-class">.getBirthday</span>(),
                                    employee<span class="hljs-selector-class">.getWorkday</span>(),
                                    employee<span class="hljs-selector-class">.getEducation</span>(),
                                    employee<span class="hljs-selector-class">.getPosition</span>(),
                                    employee<span class="hljs-selector-class">.getAddress</span>(),
                                    employee<span class="hljs-selector-class">.getPhone</span>()
                            };
                            tableModel<span class="hljs-selector-class">.addRow</span>(rowData);
                            found = true;
                        }
                    }
                    if (!found) {
                        JOptionPane<span class="hljs-selector-class">.showMessageDialog</span>(EmpUI.this, "未找到匹配的员工", "查询结果", JOptionPane.WARNING_MESSAGE);
                    }
                }
            }
        });

        <span class="hljs-comment">// 添加鼠标右键菜单</span>
        employeeTable<span class="hljs-selector-class">.addMouseListener</span>(new MouseAdapter() {
            <span class="hljs-keyword">@Override</span>
            public void mouseReleased(MouseEvent e) {
                if (e.isPopupTrigger()) {
                    int row = employeeTable<span class="hljs-selector-class">.rowAtPoint</span>(e.getPoint());
                    if (row &gt;= <span class="hljs-number">0</span>) {
                        <span class="hljs-built_in">showPopupMenu</span>(e, row);
                    }
                }
            }
        });
    }

    <span class="hljs-comment">// 刷新排序后的表格</span>
    private void <span class="hljs-built_in">refreshTablesort</span>(String []keys) {
        <span class="hljs-comment">// 清空表格</span>
        tableModel<span class="hljs-selector-class">.setRowCount</span>(<span class="hljs-number">0</span>);

        <span class="hljs-comment">// 遍历哈希表，将每个员工的信息添加到表格中</span>
        for (String key: keys) {
            <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> rowData = {
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getEmpId</span>(),
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getName</span>(),
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getSex</span>(),
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getBirthday</span>(),
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getWorkday</span>(),
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getEducation</span>(),
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getPosition</span>(),
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getAddress</span>(),
                    employeeMap<span class="hljs-selector-class">.get</span>(key)<span class="hljs-selector-class">.getPhone</span>()
            };
            tableModel<span class="hljs-selector-class">.addRow</span>(rowData); <span class="hljs-comment">// 将每一行数据添加到表格模型中</span>
        }
    }

    <span class="hljs-comment">// 显示鼠标右键菜单</span>
    private void <span class="hljs-built_in">showPopupMenu</span>(MouseEvent e, int row) {
        JPopupMenu popupMenu = new <span class="hljs-built_in">JPopupMenu</span>();

        JMenuItem editItem = new <span class="hljs-built_in">JMenuItem</span>("编辑");
        editItem<span class="hljs-selector-class">.addActionListener</span>(new ActionListener() {
            <span class="hljs-keyword">@Override</span>
            public void actionPerformed(ActionEvent e) {
                <span class="hljs-comment">// 获取选中的行数据</span>
                String name = (String) tableModel<span class="hljs-selector-class">.getValueAt</span>(row, <span class="hljs-number">1</span>);
                Employee employee = employeeMap<span class="hljs-selector-class">.get</span>(name);

                <span class="hljs-comment">// 弹出编辑窗口</span>
                new <span class="hljs-built_in">EditEmpUI</span>(employee);
            }
        });
        popupMenu<span class="hljs-selector-class">.add</span>(editItem);

        JMenuItem deleteItem = new <span class="hljs-built_in">JMenuItem</span>("删除");
        deleteItem<span class="hljs-selector-class">.addActionListener</span>(new ActionListener() {
            <span class="hljs-keyword">@Override</span>
            public void actionPerformed(ActionEvent e) {
                <span class="hljs-comment">// 获取选中的行数据</span>
                String name = (String) tableModel<span class="hljs-selector-class">.getValueAt</span>(row, <span class="hljs-number">1</span>);
                Employee employee = employeeMap<span class="hljs-selector-class">.get</span>(name);

                <span class="hljs-comment">// 弹出确认对话框</span>
                int confirm = JOptionPane<span class="hljs-selector-class">.showConfirmDialog</span>(EmpUI.this, "确定要删除员工 " + employee.getName() + " 吗？", "确认删除", JOptionPane<span class="hljs-selector-class">.YES_NO_OPTION</span>);
                if (confirm == JOptionPane.YES_OPTION) {
                    <span class="hljs-comment">// 删除哈希表中的员工</span>
                    employeeMap<span class="hljs-selector-class">.remove</span>(name);
                    tableModel<span class="hljs-selector-class">.removeRow</span>(row);
                }
                <span class="hljs-comment">//将新的数据写入文件中</span>
                try {
                    <span class="hljs-built_in">writeEmployeesToFile</span>(filePath);
                } catch (IOException ex) {
                    throw new <span class="hljs-built_in">RuntimeException</span>(ex);
                }
            }
        });
        popupMenu<span class="hljs-selector-class">.add</span>(deleteItem);

        popupMenu<span class="hljs-selector-class">.show</span>(e.getComponent(), e<span class="hljs-selector-class">.getX</span>(), e<span class="hljs-selector-class">.getY</span>());
    }

    <span class="hljs-comment">//将哈希表中的数据写入到CSV文件中</span>
    public static void <span class="hljs-built_in">writeEmployeesToFile</span>(String filePath) throws IOException {
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(filePath))) {

            <span class="hljs-comment">// 遍历哈希表，将每个员工的信息写入CSV文件</span>
            for (Employee employee : employeeMap.values()) {
                writer<span class="hljs-selector-class">.write</span>(String.join(",",
                        employee.getEmpId(),
                        employee<span class="hljs-selector-class">.getName</span>(),
                        employee<span class="hljs-selector-class">.getSex</span>(),
                        employee<span class="hljs-selector-class">.getBirthday</span>(),
                        employee<span class="hljs-selector-class">.getWorkday</span>(),
                        employee<span class="hljs-selector-class">.getEducation</span>(),
                        employee<span class="hljs-selector-class">.getPosition</span>(),
                        employee<span class="hljs-selector-class">.getAddress</span>(),
                        employee<span class="hljs-selector-class">.getPhone</span>()
                ));
                writer<span class="hljs-selector-class">.newLine</span>();
            }
        }
    }


    <span class="hljs-comment">// 刷新表格，重新加载哈希表中的数据</span>
    public static void <span class="hljs-built_in">refreshTable</span>() {
        <span class="hljs-built_in">loadEmployeeDataToTable</span>();
    }


    <span class="hljs-comment">// 从哈希表中加载员工数据到表格</span>
    private static void <span class="hljs-built_in">loadEmployeeDataToTable</span>() {
        <span class="hljs-comment">// 清空表格</span>
        tableModel<span class="hljs-selector-class">.setRowCount</span>(<span class="hljs-number">0</span>);

        <span class="hljs-comment">// 遍历哈希表，将每个员工的信息添加到表格中</span>
        for (Employee employee : employeeMap.values()) {
            <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> rowData = {
                    employee<span class="hljs-selector-class">.getEmpId</span>(),
                    employee<span class="hljs-selector-class">.getName</span>(),
                    employee<span class="hljs-selector-class">.getSex</span>(),
                    employee<span class="hljs-selector-class">.getBirthday</span>(),
                    employee<span class="hljs-selector-class">.getWorkday</span>(),
                    employee<span class="hljs-selector-class">.getEducation</span>(),
                    employee<span class="hljs-selector-class">.getPosition</span>(),
                    employee<span class="hljs-selector-class">.getAddress</span>(),
                    employee<span class="hljs-selector-class">.getPhone</span>()
            };
            tableModel<span class="hljs-selector-class">.addRow</span>(rowData); <span class="hljs-comment">// 将每一行数据添加到表格模型中</span>
        }
    }

    <span class="hljs-comment">// 读取 CSV 文件并将数据添加到 employeeMap 中</span>
    public void <span class="hljs-built_in">readEmployeesFromFile</span>(String filePath) throws IOException {
        try (BufferedReader br = new BufferedReader(new FileReader(filePath))) {
            String line;
            while ((line = br.readLine()) != null) {
                <span class="hljs-comment">// 按逗号分隔每一行</span>
                String<span class="hljs-selector-attr">[]</span> fields = line<span class="hljs-selector-class">.split</span>(",");

                <span class="hljs-comment">// 创建 Employee 对象</span>
                Employee employee = new <span class="hljs-built_in">Employee</span>(
                        fields[<span class="hljs-number">0</span>],
                        fields[<span class="hljs-number">1</span>],
                        fields[<span class="hljs-number">2</span>],
                        fields[<span class="hljs-number">3</span>],
                        fields[<span class="hljs-number">4</span>],
                        fields[<span class="hljs-number">5</span>],
                        fields[<span class="hljs-number">6</span>],
                        fields[<span class="hljs-number">7</span>],
                        fields[<span class="hljs-number">8</span>]
                );

                <span class="hljs-comment">// 将 Employee 对象添加到哈希表中，以员工的名字作为键</span>
                employeeMap<span class="hljs-selector-class">.put</span>(employee.getName(), employee);
            }
        }
    }

}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-44">7.2.12LoginUI.java</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.jxl_dyw.UI;

<span class="hljs-keyword">import</span> com.jxl_dyw.entity.User;
<span class="hljs-keyword">import</span> com.jxl_dyw.hashMap.MyHashMap;

<span class="hljs-keyword">import</span> javax.swing.*;
<span class="hljs-keyword">import</span> java.awt.*;
<span class="hljs-keyword">import</span> java.io.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginUI</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JFrame</span> {

    <span class="hljs-keyword">private</span> JTextField usernameField;
    <span class="hljs-keyword">private</span> JPasswordField passwordField;

    <span class="hljs-comment">// 管理员信息文件路径</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"src/main/resources/User.csv"</span>;
    <span class="hljs-comment">//用于存放管理员的哈希表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MyHashMap&lt;String , String&gt; userMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyHashMap</span>&lt;&gt;();
    <span class="hljs-comment">//get方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MyHashMap&lt;String, String&gt; <span class="hljs-title function_">getUserMap</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> userMap;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LoginUI</span><span class="hljs-params">()</span> {

        <span class="hljs-comment">// 读取文件中的管理员信息</span>
        <span class="hljs-keyword">try</span> {
            readUsersFromFile(filePath);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
        }

        <span class="hljs-comment">// 设置窗口标题</span>
        setTitle(<span class="hljs-string">"员工信息管理系统"</span>);

        <span class="hljs-comment">// 设置窗口大小和关闭操作</span>
        setSize(<span class="hljs-number">400</span>, <span class="hljs-number">300</span>);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        <span class="hljs-comment">// 创建面板并设置布局</span>
        <span class="hljs-type">JPanel</span> <span class="hljs-variable">formPanel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JPanel</span>();
        <span class="hljs-comment">//网格布局管理器</span>
        formPanel.setLayout(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GridBagLayout</span>());
        <span class="hljs-comment">//设置空边框</span>
        formPanel.setBorder(BorderFactory.createEmptyBorder(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>));

        <span class="hljs-type">GridBagConstraints</span> <span class="hljs-variable">gbc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridBagConstraints</span>();
        gbc.insets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Insets</span>(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
        gbc.anchor = GridBagConstraints.WEST;

        <span class="hljs-comment">// 添加用户名标签和文本框</span>
        <span class="hljs-type">JLabel</span> <span class="hljs-variable">usernameLabel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JLabel</span>(<span class="hljs-string">"账户名:"</span>);
        usernameLabel.setFont(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Font</span>(<span class="hljs-string">"宋体"</span>, Font.PLAIN, <span class="hljs-number">20</span>));
        gbc.gridx = <span class="hljs-number">0</span>;
        gbc.gridy = <span class="hljs-number">0</span>;
        formPanel.add(usernameLabel, gbc);

        usernameField = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JTextField</span>(<span class="hljs-number">20</span>);
        gbc.gridx = <span class="hljs-number">1</span>;
        formPanel.add(usernameField, gbc);

        <span class="hljs-comment">// 添加密码标签和密码框</span>
        <span class="hljs-type">JLabel</span> <span class="hljs-variable">passwordLabel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JLabel</span>(<span class="hljs-string">"密码:"</span>);
        passwordLabel.setFont(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Font</span>(<span class="hljs-string">"宋体"</span>, Font.PLAIN, <span class="hljs-number">20</span>));
        gbc.gridx = <span class="hljs-number">0</span>;
        gbc.gridy = <span class="hljs-number">1</span>;
        formPanel.add(passwordLabel, gbc);

        passwordField = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JPasswordField</span>(<span class="hljs-number">20</span>);
        gbc.gridx = <span class="hljs-number">1</span>;
        formPanel.add(passwordField, gbc);

        <span class="hljs-comment">// 添加按钮面板</span>
        <span class="hljs-type">JPanel</span> <span class="hljs-variable">buttonPanel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JPanel</span>();
        buttonPanel.setLayout(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FlowLayout</span>(FlowLayout.CENTER));

        <span class="hljs-comment">// 添加登录按钮</span>
        <span class="hljs-type">JButton</span> <span class="hljs-variable">loginButton</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JButton</span>(<span class="hljs-string">"登录"</span>);
        buttonPanel.add(loginButton);

        <span class="hljs-comment">// 添加注册按钮</span>
        <span class="hljs-type">JButton</span> <span class="hljs-variable">registerButton</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JButton</span>(<span class="hljs-string">"注册"</span>);
        buttonPanel.add(registerButton);

        <span class="hljs-comment">// 设置按钮的大小</span>
        loginButton.setPreferredSize(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dimension</span>(<span class="hljs-number">100</span>, <span class="hljs-number">30</span>));
        registerButton.setPreferredSize(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dimension</span>(<span class="hljs-number">100</span>, <span class="hljs-number">30</span>));

        <span class="hljs-comment">// 将表单面板添加到窗口中央</span>
        add(formPanel, BorderLayout.CENTER);
        <span class="hljs-comment">// 将按钮面板添加到窗口底部</span>
        add(buttonPanel, BorderLayout.SOUTH);

        <span class="hljs-comment">// 显示窗口</span>
        setLocationRelativeTo(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 窗口居中显示</span>
        setVisible(<span class="hljs-literal">true</span>);

        <span class="hljs-comment">//登录按钮的监听事件</span>
        loginButton.addActionListener(e -&gt; {
            <span class="hljs-comment">// 登录逻辑</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> usernameField.getText();
            <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(passwordField.getPassword());

            <span class="hljs-comment">// 假设验证成功</span>
            <span class="hljs-keyword">if</span> (isValidLogin(username, password)) {
                <span class="hljs-comment">// 跳转到MainUI</span>
                <span class="hljs-type">MainUI</span> <span class="hljs-variable">mainUI</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">try</span> {
                    mainUI = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MainUI</span>();
                } <span class="hljs-keyword">catch</span> (IOException ex) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(ex);
                }
                mainUI.setVisible(<span class="hljs-literal">true</span>);
                dispose(); <span class="hljs-comment">// 关闭当前登录界面</span>
            } <span class="hljs-keyword">else</span> {
                JOptionPane.showMessageDialog(<span class="hljs-built_in">this</span>, <span class="hljs-string">"登录失败，请检查用户名和密码。"</span>);
            }
        });
        <span class="hljs-comment">//注册按钮的监听事件</span>
        registerButton.addActionListener(e -&gt; {
            <span class="hljs-comment">// 跳转到RegisterUI</span>
            <span class="hljs-type">RegisterUI</span> <span class="hljs-variable">registerUI</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegisterUI</span>();
            registerUI.setVisible(<span class="hljs-literal">true</span>);
            dispose(); <span class="hljs-comment">// 关闭当前登录界</span>
        });
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidLogin</span><span class="hljs-params">(String username, String password)</span> {
        <span class="hljs-comment">// 实现你的登录验证逻辑</span>
        <span class="hljs-keyword">return</span> userMap.get(username) != <span class="hljs-literal">null</span> &amp;&amp; userMap.get(username).equals(password);
    }

    <span class="hljs-comment">//读取用户表到哈希表</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readUsersFromFile</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(filePath))) {
            String line;
            <span class="hljs-keyword">while</span> ((line = br.readLine()) != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// 按逗号分隔每一行</span>
                String[] fields = line.split(<span class="hljs-string">","</span>);

                <span class="hljs-comment">// 创建 User 对象</span>
                <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(fields[<span class="hljs-number">0</span>], fields[<span class="hljs-number">1</span>]);

                <span class="hljs-comment">// 将 User 对象添加到哈希表中，以用户名作为键</span>
                userMap.put(user.getUsername(), user.getPassword());
            }
        }
    }

    <span class="hljs-comment">//将哈希表中的数据写入到CSV文件中</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeUsersToFile</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileWriter</span>(filePath))) {

            <span class="hljs-comment">// 遍历哈希表，将每个用户的信息写入CSV文件</span>
            <span class="hljs-keyword">for</span> (String username : userMap.keys()) {
                writer.write(String.join(<span class="hljs-string">","</span>,
                        username,
                        userMap.get(username)
                ));
                writer.newLine();
            }
        }
    }

}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-45">7.2.13MainUI.java</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.jxl_dyw.<span class="hljs-type">UI</span>;

<span class="hljs-keyword">import</span> javax.swing.*;
<span class="hljs-keyword">import</span> java.awt.*;
<span class="hljs-keyword">import</span> java.io.<span class="hljs-type">IOException</span>;

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainUI</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JFrame</span> </span>{
    <span class="hljs-comment">//选项卡面板</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">JTabbedPane</span> tabbedPane;
    <span class="hljs-keyword">private</span> <span class="hljs-type">EmpUI</span> empUI;
    <span class="hljs-keyword">private</span> <span class="hljs-type">DeptUI</span> deptUI;

    public <span class="hljs-type">MainUI</span>() <span class="hljs-keyword">throws</span> <span class="hljs-type">IOException</span> {
        setTitle(<span class="hljs-string">"企业人事管理系统"</span>);
        <span class="hljs-comment">//点击窗口关闭按钮，关闭程序</span>
        setDefaultCloseOperation(<span class="hljs-type">JFrame</span>.<span class="hljs-type">EXIT_ON_CLOSE</span>);
        setSize(<span class="hljs-number">1200</span>, <span class="hljs-number">800</span>);

        <span class="hljs-comment">// 创建顶部栏</span>
        <span class="hljs-type">JPanel</span> topPanel = <span class="hljs-keyword">new</span> <span class="hljs-type">JPanel</span>();
        topPanel.setLayout(<span class="hljs-keyword">new</span> <span class="hljs-type">FlowLayout</span>(<span class="hljs-type">FlowLayout</span>.<span class="hljs-type">LEFT</span>));
        <span class="hljs-type">JLabel</span> titleLabel = <span class="hljs-keyword">new</span> <span class="hljs-type">JLabel</span>(<span class="hljs-string">"员工信息管理系统"</span>);
        topPanel.add(titleLabel);

        <span class="hljs-comment">// 创建选项卡面板</span>
        tabbedPane = <span class="hljs-keyword">new</span> <span class="hljs-type">JTabbedPane</span>();
        empUI = <span class="hljs-keyword">new</span> <span class="hljs-type">EmpUI</span>();
        deptUI = <span class="hljs-keyword">new</span> <span class="hljs-type">DeptUI</span>();
        tabbedPane.addTab(<span class="hljs-string">"员工管理"</span>, empUI);
        tabbedPane.addTab(<span class="hljs-string">"部门管理"</span>, deptUI);

        <span class="hljs-comment">// 设置布局</span>
        setLayout(<span class="hljs-keyword">new</span> <span class="hljs-type">BorderLayout</span>());
        add(topPanel, <span class="hljs-type">BorderLayout</span>.<span class="hljs-type">NORTH</span>);
        add(tabbedPane, <span class="hljs-type">BorderLayout</span>.<span class="hljs-type">CENTER</span>);
        <span class="hljs-comment">//使其居中</span>
        setLocationRelativeTo(<span class="hljs-literal">null</span>);
        setVisible(<span class="hljs-literal">true</span>);
    }

}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-46">7.2.14RegisterUI.java</h4>
<pre><code class="hljs language-ini" lang="ini">package com.jxl_dyw.UI<span class="hljs-comment">;</span>

import com.jxl_dyw.entity.User<span class="hljs-comment">;</span>

import javax.swing.*<span class="hljs-comment">;</span>
import java.awt.*<span class="hljs-comment">;</span>
import java.awt.event.ActionEvent<span class="hljs-comment">;</span>
import java.awt.event.ActionListener<span class="hljs-comment">;</span>
import java.awt.event.WindowAdapter<span class="hljs-comment">;</span>
import java.awt.event.WindowEvent<span class="hljs-comment">;</span>
import java.io.IOException<span class="hljs-comment">;</span>

public class RegisterUI extends JFrame {
    public RegisterUI() {
        // 设置窗口标题和关闭行为
        setTitle("注册")<span class="hljs-comment">;</span>
        setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE)<span class="hljs-comment">; // 关闭时只关闭当前窗口，不退出整个程序</span>
        setSize(800, 600)<span class="hljs-comment">; // 增大窗口尺寸</span>
        setLocationRelativeTo(null)<span class="hljs-comment">; // 居中显示窗口</span>

        // 添加窗口监听事件，点击关闭按钮时回退到登录页面
        addWindowListener(new WindowAdapter() {
            @Override
            public void windowClosing(WindowEvent e) {
                new LoginUI().setVisible(true)<span class="hljs-comment">;</span>
            }
        })<span class="hljs-comment">;</span>

        // 使用 GridBagLayout 进行布局
        setLayout(new GridBagLayout())<span class="hljs-comment">;</span>
        GridBagConstraints <span class="hljs-attr">gbc</span> = new GridBagConstraints()<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.insets</span> = new Insets(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>)<span class="hljs-comment">; // 增大组件之间的间距</span>

        // 创建一个面板用于存放所有输入字段
        JPanel <span class="hljs-attr">inputPanel</span> = new JPanel(new GridBagLayout())<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

        // 设置全局字体，使所有组件的文字更大
        Font <span class="hljs-attr">font</span> = new Font(<span class="hljs-string">"宋体"</span>, Font.PLAIN, <span class="hljs-number">18</span>)<span class="hljs-comment">;</span>

        // 创建用户名和密码组件并添加到面板
        JLabel <span class="hljs-attr">userLabel</span> = new JLabel(<span class="hljs-string">"用户名:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">userField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        userLabel.setFont(font)<span class="hljs-comment">;</span>
        userField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, userLabel, userField, gbc)<span class="hljs-comment">;</span>

        JLabel <span class="hljs-attr">passwordLabel</span> = new JLabel(<span class="hljs-string">"密码:"</span>)<span class="hljs-comment">;</span>
        JTextField <span class="hljs-attr">passwordField</span> = new JTextField(<span class="hljs-number">20</span>)<span class="hljs-comment">;</span>
        passwordLabel.setFont(font)<span class="hljs-comment">;</span>
        passwordField.setFont(font)<span class="hljs-comment">;</span>
        addComponent(inputPanel, passwordLabel, passwordField, gbc)<span class="hljs-comment">;</span>

        // 创建按钮面板
        JPanel <span class="hljs-attr">buttonPanel</span> = new JPanel()<span class="hljs-comment">;</span>
        JButton <span class="hljs-attr">registerButton</span> = new JButton(<span class="hljs-string">"注册"</span>)<span class="hljs-comment">;</span>
        registerButton.setFont(font)<span class="hljs-comment">; // 设置按钮字体</span>
        buttonPanel.add(registerButton)<span class="hljs-comment">;</span>

        // 添加按钮点击事件监听器
        registerButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                // 获取输入的用户信息
                String <span class="hljs-attr">username</span> = userField.getText().trim()<span class="hljs-comment">;</span>
                String <span class="hljs-attr">password</span> = passwordField.getText().trim()<span class="hljs-comment">;</span>

                // 验证输入是否为空
                if (username.isEmpty() || password.isEmpty()) {
                    JOptionPane.showMessageDialog(RegisterUI.this, "用户名和密码不能为空", "错误", JOptionPane.ERROR_MESSAGE)<span class="hljs-comment">;</span>
                    return<span class="hljs-comment">;</span>
                }

                // 创建 User 对象
                User <span class="hljs-attr">user</span> = new User(username, password)<span class="hljs-comment">;</span>

                // 将 User 对象添加到哈希表中，以用户名作为键
                LoginUI.getUserMap().put(user.getUsername(), user.getPassword())<span class="hljs-comment">;</span>

                // 将用户信息写入文件
                try {
                    LoginUI.writeUsersToFile(LoginUI.filePath)<span class="hljs-comment">;</span>
                } catch (IOException ex) {
                    throw new RuntimeException(ex)<span class="hljs-comment">;</span>
                }

                // 清空输入框
                userField.setText("")<span class="hljs-comment">;</span>
                passwordField.setText("")<span class="hljs-comment">;</span>

                // 弹出对话框
                JOptionPane.showMessageDialog(RegisterUI.this, "注册成功", "提示", JOptionPane.INFORMATION_MESSAGE)<span class="hljs-comment">;</span>

                // 关闭注册页面并重新显示登录页面
                dispose()<span class="hljs-comment">;</span>
                new LoginUI().setVisible(true)<span class="hljs-comment">;</span>
            }
        })<span class="hljs-comment">;</span>

        // 将输入面板和按钮面板添加到主窗口
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridy</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">2</span><span class="hljs-comment">; // 占两列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.BOTH<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weightx</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">1.0</span><span class="hljs-comment">;</span>
        add(inputPanel, gbc)<span class="hljs-comment">;</span>

        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.gridwidth</span> = <span class="hljs-number">1</span><span class="hljs-comment">; // 占一列</span>
        <span class="hljs-attr">gbc.fill</span> = GridBagConstraints.NONE<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.CENTER<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.weighty</span> = <span class="hljs-number">0.1</span><span class="hljs-comment">;</span>
        add(buttonPanel, gbc)<span class="hljs-comment">;</span>

        // 设置窗口可见
        setVisible(true)<span class="hljs-comment">;</span>
    }

    private void addComponent(JPanel panel, JLabel label, JComponent textField, GridBagConstraints gbc) {
        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
        gbc.gridy++<span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.EAST<span class="hljs-comment">;</span>
        panel.add(label, gbc)<span class="hljs-comment">;</span>

        <span class="hljs-attr">gbc.gridx</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">gbc.anchor</span> = GridBagConstraints.WEST<span class="hljs-comment">;</span>
        panel.add(textField, gbc)<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-47">7.2.15EmpApp.java</h4>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">jxl_dyw</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">jxl_dyw</span>.<span class="hljs-property">UI</span>.<span class="hljs-property">LoginUI</span>;


<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmpApp</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginUI</span>();
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-48">7.2.16Dept.csv</h4>
<pre><code class="hljs">102,市场部,李娜,2019-08-10
104,财务部,赵敏,2018-11-05
103,销售部,金小梁,2021-03-22
101,研发部,张伟,2020-05-15
105,人力资源部,刘洋,2022-07-12
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-49">7.2.17Emps.csv</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">1005</span><span class="hljs-string">,陈磊,男,1988-07-11,2014-03-01,硕士,财务部,杭州市西湖区XX路XX号,13512345678</span>
<span class="hljs-string">E013,何晓波,男,1986-07-18,2011-09-10,本科,技术部,长沙市岳麓区XX大厦15层,12712345678</span>
<span class="hljs-string">E008,周晓燕,女,1994-07-22,2019-03-15,本科,市场部,武汉市洪山区XX小区22号楼,13265432187</span>
<span class="hljs-string">E015,宋晓阳,男,1989-03-12,2013-07-25,硕士,人力资源部,青岛市市南区XX花园12栋,12554321876</span>
<span class="hljs-number">1010</span><span class="hljs-string">,郑丽,女,1991-10-20,2017-09-15,硕士,销售部,西安市雁塔区XX路XX号,13087654321</span>
<span class="hljs-number">1002</span><span class="hljs-string">,李娜,女,1990-08-22,2012-05-15,硕士,财务部,上海市浦东新区XX路XX号,13987654321</span>
<span class="hljs-number">1003</span><span class="hljs-string">,王强,男,1982-11-30,2008-09-01,博士,财务部,广州市天河区XX大道XX号,13612345678</span>
<span class="hljs-string">E009,吴晓明,男,1984-11-25,2010-08-12,本科,人力资源部,重庆市渝中区XX花园15栋,13112345678</span>
<span class="hljs-string">E010,郑晓玲,女,1995-02-10,2020-06-20,硕士,财务部,天津市南开区XX公寓25楼,13087654321</span>
<span class="hljs-string">E007,杨晓东,男,1987-09-15,2012-12-05,硕士,技术部,南京市鼓楼区XX大厦18层,13354321876</span>
<span class="hljs-string">E001,刘晓峰,男,1986-05-20,2011-07-15,本科,技术部,北京市海淀区XX大厦3层,13812345679</span>
<span class="hljs-string">E017,冯晓龙,男,1985-11-28,2010-10-12,本科,研发部,沈阳市和平区XX大厦22层,12312345678</span>
<span class="hljs-string">E012,黄晓莉,女,1990-10-30,2015-11-25,硕士,销售部,西安市雁塔区XX小区8号楼,12865432187</span>
<span class="hljs-number">1006</span><span class="hljs-string">,刘芳,女,1992-12-18,2016-11-01,本科,市场营销部,成都市武侯区XX街XX号,13487654321</span>
<span class="hljs-string">E019,许晓刚,男,1987-02-15,2012-11-10,本科,技术部,长春市朝阳区XX大厦10层,12154321876</span>
<span class="hljs-string">E014,罗晓梅,女,1993-05-20,2018-04-15,本科,市场部,郑州市金水区XX小区20号楼,12687654321</span>
<span class="hljs-string">E016,唐晓云,女,1994-09-05,2019-02-18,本科,财务部,大连市中山区XX公寓18楼,12465432187</span>
<span class="hljs-string">E011,孙晓辉,男,1988-01-05,2014-05-15,本科,研发部,苏州市工业园区XX大厦10层,12954321876</span>
<span class="hljs-string">E020,叶晓芬,女,1990-04-25,2015-05-20,硕士,市场部,济南市历下区XX小区8号楼,12065432187</span>
<span class="hljs-number">1008</span><span class="hljs-string">,周静,女,1994-02-08,2019-04-01,本科,研发部,武汉市江汉区XX大街XX号,13287654321</span>
<span class="hljs-string">E003,张伟民,男,1989-12-03,2013-09-10,本科,人力资源部,广州市白云区XX花园8栋,13654321877</span>
<span class="hljs-string">E018,朱晓婷,女,1992-06-10,2017-08-20,硕士,销售部,哈尔滨市南岗区XX小区15号楼,12287654321</span>
<span class="hljs-number">1009</span><span class="hljs-string">,吴迪,男,1989-05-12,2015-08-01,博士,算法研究部,重庆市渝中区XX路XX号,13112345678</span>
<span class="hljs-string">E006,李晓霞,女,1992-03-19,2017-05-10,本科,销售部,杭州市西湖区XX小区10号楼,13487654321</span>
<span class="hljs-string">E004,赵敏,女,1993-06-28,2018-02-18,本科,财务部,深圳市福田区XX公寓12楼,13765432188</span>
<span class="hljs-string">E002,王丽华,女,1991-08-14,2016-04-25,硕士,市场部,上海市徐汇区XX小区15号楼,13987654322</span>
<span class="hljs-number">1001</span><span class="hljs-string">,张伟,男,1985-03-15,2010-07-01,本科,技术研发部,北京市朝阳区XX街XX号,13812345678</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-50">7.2.18User.csv</h4>
<pre><code class="hljs">11,11
顾清寒,520
aidh,1234
Djakarta,121233
李,123
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-51">7.3文件资源</h3>
<p>用git从gitee上拉取<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fjin-xiao-liang" title="https://gitee.com/jin-xiao-liang" target="_blank" ref="nofollow noopener noreferrer">gitee.com/jin-xiao-li…</a></p>
<h2 data-id="heading-52">8.说明</h2>
<p>这个小项目是我和一个同学在学校的实训上完成的，因为是数据结构课程的学期实训，所以像数据存储之类的没有采用数据库而是采用文件读取和哈希表来进行操作的，包括哈希表因为Java中有封装好的，直接用也有点偏离数据结构实训要求，所以哈希表部分索性就我们自己写一个哈希表。</p>
<p>项目采用swing组件的部分比较多，这个组件其实是属于比较过时的技术，大家不必深入研究，能看懂，会用ai来写就可以了，希望这篇文章能帮大家应付一下学校比较麻烦的作业之类的，觉得有帮助的可以点个关注哦！</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Coze搭建工作流（爆款视频、调研报告、海报生成等实操）-精讲版]]></title>    <link>https://juejin.cn/post/7599652649551380480</link>    <guid>https://juejin.cn/post/7599652649551380480</guid>    <pubDate>2026-01-27T05:51:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599652649551380480" data-draft-id="7599703627789811752" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Coze搭建工作流（爆款视频、调研报告、海报生成等实操）-精讲版"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T05:51:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="琪琪的课程站"/> <meta itemprop="url" content="https://juejin.cn/user/2490828211889978"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Coze搭建工作流（爆款视频、调研报告、海报生成等实操）-精讲版
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2490828211889978/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    琪琪的课程站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T05:51:18.000Z" title="Tue Jan 27 2026 05:51:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Coze搭建工作流（爆款视频、调研报告、海报生成等实操）---youkeit.xyz/15442/</strong></p>
<h2 data-id="heading-0">锚定2026智能工作流新范式：Coze实操解锁爆款内容+办公自动化核心能力</h2>
<p>在2026年的AI技术浪潮中，Coze平台凭借其零代码工作流引擎和AI Agent技术，正重塑着内容创作与办公自动化的边界。通过可视化拖拽组件和智能节点编排，普通用户无需编程基础即可构建复杂的自动化流程，实现从爆款内容生成到企业级办公系统的全场景覆盖。本文将通过三个实战案例，深度解析Coze工作流的核心能力与实现路径。</p>
<h3 data-id="heading-1">一、爆款内容生产：小红书笔记秒变10W+的自动化引擎</h3>
<h4 data-id="heading-2">案例背景</h4>
<p>某美妆品牌需每日生成50篇符合小红书风格的种草笔记，传统人工创作需8小时/天，且质量参差不齐。通过Coze工作流，团队将创作效率提升20倍，单篇笔记生成时间压缩至3分钟。</p>
<h4 data-id="heading-3">工作流设计</h4>
<pre><code class="hljs language-css" lang="css">mermaid
<span class="hljs-number">1</span>graph <span class="hljs-selector-tag">TD</span>
<span class="hljs-number">2</span>    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[开始节点]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[热点话题抓取]</span>
<span class="hljs-number">3</span>    <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[竞品分析插件]</span>
<span class="hljs-number">4</span>    C --&gt; D<span class="hljs-selector-attr">[DeepSeek大模型文案生成]</span>
<span class="hljs-number">5</span>    D --&gt; E<span class="hljs-selector-attr">[AI配图生成]</span>
<span class="hljs-number">6</span>    E --&gt; F<span class="hljs-selector-attr">[emoji自动添加]</span>
<span class="hljs-number">7</span>    F --&gt; G<span class="hljs-selector-attr">[话题标签优化]</span>
<span class="hljs-number">8</span>    G --&gt; H<span class="hljs-selector-attr">[多平台发布]</span>
<span class="hljs-number">9</span>    H --&gt; <span class="hljs-selector-tag">I</span><span class="hljs-selector-attr">[数据监控]</span>
</code></pre>
<h4 data-id="heading-4">关键节点实现代码</h4>
<pre><code class="hljs language-javascript" lang="javascript">javascript
<span class="hljs-number">1</span><span class="hljs-comment">// 热点话题抓取节点（自定义JavaScript插件）</span>
2<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchHotTopics</span>(<span class="hljs-params"/>) {
<span class="hljs-number">3</span>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.xiaohongshu.com/trending'</span>);
<span class="hljs-number">4</span>  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
<span class="hljs-number">5</span>  <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
<span class="hljs-number">6</span>    <span class="hljs-attr">topic</span>: item.<span class="hljs-property">title</span>,
<span class="hljs-number">7</span>    <span class="hljs-attr">heat</span>: item.<span class="hljs-property">score</span>
<span class="hljs-number">8</span>  }));
<span class="hljs-number">9</span>}
<span class="hljs-number">10</span>
<span class="hljs-number">11</span><span class="hljs-comment">// DeepSeek文案生成节点（LLM调用配置）</span>
<span class="hljs-number">12</span>{
<span class="hljs-number">13</span>  <span class="hljs-string">"model"</span>: <span class="hljs-string">"DeepSeek-R1-32B"</span>,
<span class="hljs-number">14</span>  <span class="hljs-string">"prompt"</span>: <span class="hljs-string">`根据以下信息生成小红书风格文案：
15  产品：<span class="hljs-subst">${input.productName}</span>
16  核心卖点：<span class="hljs-subst">${input.keyFeatures.join(<span class="hljs-string">'、'</span>)}</span>
17  目标人群：<span class="hljs-subst">${input.targetAudience}</span>
18  要求：使用emoji分隔段落，结尾添加3个相关话题标签`</span>
<span class="hljs-number">19</span>}
<span class="hljs-number">20</span>
<span class="hljs-number">21</span><span class="hljs-comment">// 自动配图节点（即梦AI插件调用）</span>
<span class="hljs-number">22</span>{
<span class="hljs-number">23</span>  <span class="hljs-string">"plugin"</span>: <span class="hljs-string">"jimeng-image"</span>,
<span class="hljs-number">24</span>  <span class="hljs-string">"params"</span>: {
<span class="hljs-number">25</span>    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">`<span class="hljs-subst">${input.文案内容}</span>，ins风，粉色系，高清8K`</span>,
<span class="hljs-number">26</span>    <span class="hljs-string">"style"</span>: <span class="hljs-string">"realistic"</span>
<span class="hljs-number">27</span>  }
<span class="hljs-number">28</span>}
</code></pre>
<h4 data-id="heading-5">实施效果</h4>
<ul>
<li>内容生产效率提升：单日产能从5篇提升至100篇</li>
<li>互动率提升：平均点赞量从120提升至850</li>
<li>成本降低：人力成本减少75%，错误率下降至0.3%</li>
</ul>
<h3 data-id="heading-6">二、办公自动化革命：智能合同处理系统</h3>
<h4 data-id="heading-7">业务痛点</h4>
<p>某律所每日需处理200+份合同文档，传统人工审核存在：</p>
<ol>
<li>关键条款遗漏率高达15%</li>
<li>单份合同处理耗时45分钟</li>
<li>跨版本对比效率低下</li>
</ol>
<h4 data-id="heading-8">Coze解决方案</h4>
<pre><code class="hljs language-css" lang="css">mermaid
<span class="hljs-number">1</span>graph LR
<span class="hljs-number">2</span>    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[合同上传]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[OCR文字识别]</span>
<span class="hljs-number">3</span>    <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[条款分类模型]</span>
<span class="hljs-number">4</span>    C --&gt; D{风险条款检测}
<span class="hljs-number">5</span>    D --&gt;|是| E<span class="hljs-selector-attr">[高亮标注]</span>
<span class="hljs-number">6</span>    D --&gt;|否| F<span class="hljs-selector-attr">[自动归档]</span>
<span class="hljs-number">7</span>    E --&gt; G<span class="hljs-selector-attr">[生成修订建议]</span>
<span class="hljs-number">8</span>    G --&gt; H<span class="hljs-selector-attr">[邮件通知]</span>
</code></pre>
<h4 data-id="heading-9">核心代码实现</h4>
<pre><code class="hljs language-python" lang="python">python
<span class="hljs-number">1</span><span class="hljs-comment"># 条款分类模型（Python插件节点）</span>
<span class="hljs-number">2</span><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline
<span class="hljs-number">3</span>
<span class="hljs-number">4</span>classifier = pipeline(
<span class="hljs-number">5</span>    <span class="hljs-string">"text-classification"</span>,
<span class="hljs-number">6</span>    model=<span class="hljs-string">"bert-base-chinese"</span>,
<span class="hljs-number">7</span>    tokenizer=<span class="hljs-string">"bert-base-chinese"</span>
<span class="hljs-number">8</span>)
<span class="hljs-number">9</span>
<span class="hljs-number">10</span><span class="hljs-keyword">def</span> classify_clauses(text):
<span class="hljs-number">11</span>    results = classifier(text.split(<span class="hljs-string">'\n'</span>))
<span class="hljs-number">12</span>    <span class="hljs-keyword">return</span> {
<span class="hljs-number">13</span>        <span class="hljs-string">"payment_terms"</span>: <span class="hljs-built_in">any</span>(r[<span class="hljs-string">'label'</span>]==<span class="hljs-string">'payment'</span> <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results),
<span class="hljs-number">14</span>        <span class="hljs-string">"liability_clauses"</span>: <span class="hljs-built_in">any</span>(r[<span class="hljs-string">'label'</span>]==<span class="hljs-string">'liability'</span> <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results)
<span class="hljs-number">15</span>    }
<span class="hljs-number">16</span>
<span class="hljs-number">17</span><span class="hljs-comment"># 风险检测逻辑（条件判断节点）</span>
<span class="hljs-number">18</span><span class="hljs-keyword">def</span> check_risk(clauses):
<span class="hljs-number">19</span>    risks = []
<span class="hljs-number">20</span>    <span class="hljs-keyword">if</span> clauses[<span class="hljs-string">'payment_terms'</span>] <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-string">'违约金'</span> <span class="hljs-keyword">in</span> text:
<span class="hljs-number">21</span>        risks.append(<span class="hljs-string">"付款条款缺少违约金约定"</span>)
<span class="hljs-number">22</span>    <span class="hljs-keyword">if</span> clauses[<span class="hljs-string">'liability_clauses'</span>] <span class="hljs-keyword">and</span> <span class="hljs-string">'免责'</span> <span class="hljs-keyword">in</span> text:
<span class="hljs-number">23</span>        risks.append(<span class="hljs-string">"存在不合理免责条款"</span>)
<span class="hljs-number">24</span>    <span class="hljs-keyword">return</span> risks
</code></pre>
<h4 data-id="heading-10">实施成效</h4>
<ul>
<li>处理效率提升：单份合同处理时间缩短至8分钟</li>
<li>风险识别准确率：从68%提升至92%</li>
<li>年度纠纷减少：预计降低法律风险成本200万元</li>
</ul>
<h3 data-id="heading-11">三、企业级应用：智能客服中台</h3>
<h4 data-id="heading-12">需求分析</h4>
<p>某电商平台需构建支持10万+日咨询量的智能客服系统，要求：</p>
<ol>
<li>多渠道接入（APP/网页/小程序）</li>
<li>意图识别准确率≥95%</li>
<li>平均响应时间≤1.2秒</li>
</ol>
<h4 data-id="heading-13">Coze工作流架构</h4>
<pre><code class="hljs language-rust" lang="rust">mermaid
<span class="hljs-number">1</span>sequenceDiagram
<span class="hljs-number">2</span>    用户<span class="hljs-punctuation">-&gt;</span>&gt;+Coze: 发起咨询
<span class="hljs-number">3</span>    Coze<span class="hljs-punctuation">-&gt;</span>&gt;+知识库: 检索相似问题
<span class="hljs-number">4</span>    知识库-<span class="hljs-punctuation">-&gt;</span>&gt;-Coze: 返回匹配结果
<span class="hljs-number">5</span>    alt 命中知识库
<span class="hljs-number">6</span>        Coze<span class="hljs-punctuation">-&gt;</span>&gt;用户: 返回标准答案
<span class="hljs-number">7</span>    <span class="hljs-keyword">else</span> 未命中
<span class="hljs-number">8</span>        Coze<span class="hljs-punctuation">-&gt;</span>&gt;+LLM: 生成动态回复
<span class="hljs-number">9</span>        LLM-<span class="hljs-punctuation">-&gt;</span>&gt;-Coze: 返回生成内容
<span class="hljs-number">10</span>        Coze<span class="hljs-punctuation">-&gt;</span>&gt;+人工审核: 标记敏感内容
<span class="hljs-number">11</span>        人工审核-<span class="hljs-punctuation">-&gt;</span>&gt;-Coze: 返回审核结果
<span class="hljs-number">12</span>        Coze<span class="hljs-punctuation">-&gt;</span>&gt;用户: 返回最终答复
<span class="hljs-number">13</span>    end
</code></pre>
<h4 data-id="heading-14">关键技术实现</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">javascript
<span class="hljs-number">1</span><span class="hljs-comment">// 动态路由节点配置</span>
<span class="hljs-number">2</span>{
<span class="hljs-number">3</span>  <span class="hljs-string">"type"</span>: <span class="hljs-string">"router"</span>,
<span class="hljs-number">4</span>  <span class="hljs-string">"conditions"</span>: [
<span class="hljs-number">5</span>    {
<span class="hljs-number">6</span>      <span class="hljs-string">"if"</span>: <span class="hljs-string">"<span class="hljs-subst">${knowledge_base.score}</span> &gt; 0.8"</span>,
<span class="hljs-number">7</span>      <span class="hljs-string">"then"</span>: <span class="hljs-string">"return_standard_answer"</span>
<span class="hljs-number">8</span>    },
<span class="hljs-number">9</span>    {
<span class="hljs-number">10</span>      <span class="hljs-string">"if"</span>: <span class="hljs-string">"<span class="hljs-subst">${input.contains(<span class="hljs-string">'投诉'</span>)}</span>"</span>,
<span class="hljs-number">11</span>      <span class="hljs-string">"then"</span>: <span class="hljs-string">"escalate_to_human"</span>
<span class="hljs-number">12</span>    }
<span class="hljs-number">13</span>  ],
<span class="hljs-number">14</span>  <span class="hljs-string">"default"</span>: <span class="hljs-string">"generate_dynamic_response"</span>
<span class="hljs-number">15</span>}
<span class="hljs-number">16</span>
<span class="hljs-number">17</span><span class="hljs-comment">// 多轮对话管理（上下文记忆）</span>
<span class="hljs-number">18</span>{
<span class="hljs-number">19</span>  <span class="hljs-string">"context_window"</span>: <span class="hljs-number">5</span>,
<span class="hljs-number">20</span>  <span class="hljs-string">"memory_keys"</span>: [
<span class="hljs-number">21</span>    <span class="hljs-string">"user_intent"</span>,
<span class="hljs-number">22</span>    <span class="hljs-string">"last_product"</span>,
<span class="hljs-number">23</span>    <span class="hljs-string">"order_status"</span>
<span class="hljs-number">24</span>  ],
<span class="hljs-number">25</span>  <span class="hljs-string">"fallback_strategy"</span>: <span class="hljs-string">"transfer_to_human"</span>
<span class="hljs-number">26</span>}
</code></pre>
<h4 data-id="heading-15">运营数据</h4>
<ul>
<li>自助解决率：从62%提升至89%</li>
<li>人力成本节约：每月减少3000工时</li>
<li>用户满意度：NPS评分从45提升至78</li>
</ul>
<h3 data-id="heading-16">四、2026年Coze工作流发展趋势</h3>
<ol>
<li><strong>多模态融合</strong>：支持文本/图像/视频的联合处理，如自动生成带产品演示的营销文案</li>
<li><strong>实时决策引擎</strong>：集成强化学习模型，实现动态定价、库存优化等实时决策</li>
<li><strong>数字孪生应用</strong>：通过工作流模拟业务场景，提前预测政策变化影响</li>
<li><strong>隐私计算集成</strong>：在数据不出域的前提下完成跨组织协作流程</li>
</ol>
<h3 data-id="heading-17">结语</h3>
<p>Coze平台通过"节点即服务"的设计理念，正在重新定义企业数字化的实施路径。在2026年，掌握工作流编排能力将成为职场核心竞争力的关键组成部分。无论是个人创作者还是企业开发者，都能通过Coze的低代码引擎，快速构建适应业务变化的智能系统，在AI时代抢占先机。</p>
<blockquote>
<p>"未来十年，工作流自动化将消灭80%的重复性劳动，而剩下的20%将需要人类与AI共同创造。" —— 《2026全球AI应用白皮书》</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[webpack5搭建vue3项目]]></title>    <link>https://juejin.cn/post/7599598627008036916</link>    <guid>https://juejin.cn/post/7599598627008036916</guid>    <pubDate>2026-01-27T03:35:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599598627008036916" data-draft-id="7599232628186136611" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="webpack5搭建vue3项目"/> <meta itemprop="keywords" content="Webpack,Vue.js"/> <meta itemprop="datePublished" content="2026-01-27T03:35:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="奔跑路上的Me"/> <meta itemprop="url" content="https://juejin.cn/user/1680516363335208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            webpack5搭建vue3项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1680516363335208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    奔跑路上的Me
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:35:52.000Z" title="Tue Jan 27 2026 03:35:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Webpack5+Vue3+TS 项目搭建（从核心到功能完善）</h2>
<h3 data-id="heading-1">一、核心基础搭建（确保项目能启动运行）</h3>
<p>目标：搭建项目骨架，整合 Vue3、TS、Webpack5 核心依赖，实现最基础的页面渲染，确保开发环境能正常启动。</p>
<h4 data-id="heading-2">步骤 1：初始化项目 &amp; 搭建目录</h4>
<p>先创建项目文件夹并初始化，搭建最精简的核心目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目目录并进入</span>
<span class="hljs-built_in">mkdir</span> vue3-ts-webpack5 &amp;&amp; <span class="hljs-built_in">cd</span> vue3-ts-webpack5
<span class="hljs-comment"># 初始化 npm 项目</span>
npm init -y
<span class="hljs-comment"># 创建核心目录和文件</span>
<span class="hljs-built_in">mkdir</span> -p src/components public
<span class="hljs-built_in">touch</span> tsconfig.json webpack.config.ts src/main.ts src/App.vue src/shims-vue.d.ts public/index.html
</code></pre>
<p>基础目录结构（仅保留核心文件）：</p>
<pre><code class="hljs language-csharp" lang="csharp">vue3-ts-webpack5/
├── src/
│   ├── components/  <span class="hljs-meta"># 组件目录</span>
│   ├── App.vue      <span class="hljs-meta"># 根组件</span>
│   ├── main.ts      <span class="hljs-meta"># 入口文件</span>
│   └── shims-vue.d.ts  <span class="hljs-meta"># Vue 类型声明</span>
├── <span class="hljs-keyword">public</span>/
│   └── index.html   <span class="hljs-meta"># HTML 模板</span>
├── tsconfig.json    <span class="hljs-meta"># TS 配置</span>
├── webpack.config.ts  <span class="hljs-meta"># Webpack 核心配置</span>
└── package.json     <span class="hljs-meta"># 依赖管理</span>
</code></pre>
<h3 data-id="heading-3">二、安装核心依赖</h3>
<p>仅安装启动项目必需的依赖，避免冗余：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 核心业务依赖</span>
npm i vue
<span class="hljs-comment"># Webpack 基础依赖</span>
npm i -D webpack webpack-cli webpack-dev-server
<span class="hljs-comment"># Vue+TS 编译依赖</span>
npm i -D typescript ts-loader @vue/compiler-sfc vue-loader
<span class="hljs-comment"># 类型声明依赖</span>
npm i -D @types/node @types/webpack ts-node
<span class="hljs-comment"># HTML 处理插件</span>
npm i -D html-webpack-plugin
</code></pre>
<h4 data-id="heading-4">步骤 3：配置 TS（tsconfig.json）</h4>
<p>适配 Vue3+TS 编译规则，确保 TS 能识别 Vue 文件和模块：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"target"</span>: <span class="hljs-string">"ES2020"</span>,
    <span class="hljs-string">"module"</span>: <span class="hljs-string">"ESNext"</span>,
    <span class="hljs-string">"moduleResolution"</span>: <span class="hljs-string">"Node"</span>,
    <span class="hljs-string">"strict"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"jsx"</span>: <span class="hljs-string">"preserve"</span>,
    <span class="hljs-string">"sourceMap"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"resolveJsonModule"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"esModuleInterop"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"lib"</span>: [<span class="hljs-string">"ES2020"</span>, <span class="hljs-string">"DOM"</span>],
    <span class="hljs-string">"types"</span>: [<span class="hljs-string">"node"</span>, <span class="hljs-string">"webpack-env"</span>],
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: { <span class="hljs-string">"@/*"</span>: [<span class="hljs-string">"src/*"</span>] },  <span class="hljs-comment"># 配置别名，方便导入</span>
    <span class="hljs-string">"skipLibCheck"</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-string">"include"</span>: [<span class="hljs-string">"src/**/*"</span>, <span class="hljs-string">"webpack.config.ts"</span>],
  <span class="hljs-string">"exclude"</span>: [<span class="hljs-string">"node_modules"</span>, <span class="hljs-string">"dist"</span>]
}
</code></pre>
<h4 data-id="heading-5">步骤 4：Vue 类型声明（shims-vue.d.ts）</h4>
<p>解决 TS 无法识别 .vue 文件的问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'*.vue'</span> {
  <span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DefineComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">component</span>: <span class="hljs-title class_">DefineComponent</span>&lt;{}, {}, <span class="hljs-built_in">any</span>&gt;
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component
}
</code></pre>
<h4 data-id="heading-6">步骤 5：基础 Webpack 配置（webpack.config.ts）</h4>
<p>仅配置核心规则，确保 Vue、TS、HTML 能正常编译：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Configuration</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'webpack'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'html-webpack-plugin'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VueLoaderPlugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-loader'</span>

<span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">Configuration</span> = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'development'</span>,  <span class="hljs-comment">// 先以开发模式搭建</span>
  <span class="hljs-attr">entry</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src/main.ts'</span>),
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'js/[name].js'</span>
  },
  <span class="hljs-attr">devServer</span>: {
    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>,
    <span class="hljs-attr">hot</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">compress</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.vue'</span>, <span class="hljs-string">'.js'</span>, <span class="hljs-string">'.json'</span>],
    <span class="hljs-attr">alias</span>: { <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>) }
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      <span class="hljs-comment">// 处理 Vue 文件</span>
      { <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.vue$/</span>, <span class="hljs-attr">loader</span>: <span class="hljs-string">'vue-loader'</span>, <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span> },
      <span class="hljs-comment">// 处理 TS 文件</span>
      { <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.ts$/</span>, <span class="hljs-attr">loader</span>: <span class="hljs-string">'ts-loader'</span>, <span class="hljs-attr">options</span>: { <span class="hljs-attr">appendTsSuffixTo</span>: [<span class="hljs-regexp">/.vue$/</span>] }, <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span> }
    ]
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueLoaderPlugin</span>(),  <span class="hljs-comment">// Vue 编译必需</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
      <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'public/index.html'</span>),
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'index.html'</span>
    })
  ],
  <span class="hljs-attr">devtool</span>: <span class="hljs-string">'eval-cheap-module-source-map'</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> config
</code></pre>
<h4 data-id="heading-7">步骤 6：编写基础业务代码</h4>
<h5 data-id="heading-8">1. public/index.html（模板文件）</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
核心基础版
</code></pre>
<h5 data-id="heading-9">2. src/main.ts（入口文件）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h5 data-id="heading-10">3. src/App.vue（根组件）</h5>
<pre><code class="hljs language-xml" lang="xml">核心基础搭建完成{{ msg }}<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> "&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-attr">msg</span>: string = <span class="hljs-string">'Vue3 + TS + Webpack5 运行正常'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg)
</span></code></pre>
<h4 data-id="heading-11">步骤 7：配置启动脚本并测试</h4>
<p>修改 package.json 的 scripts 字段，添加开发环境脚本：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"webpack serve --config webpack.config.ts"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>启动项目，验证核心功能：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run dev
</code></pre>
<p>浏览器自动打开 localhost:8080，能看到页面内容即说明核心搭建成功。</p>
<h3 data-id="heading-12">三、基础功能完善（处理样式、静态资源）</h3>
<p>目标：添加 CSS 处理、图片/字体资源加载能力，让项目支持常见静态资源引用。</p>
<h4 data-id="heading-13">步骤 1：安装资源处理依赖</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># CSS 处理依赖</span>
npm i -D css-loader@6.<span class="hljs-number">10.0</span> style-loader@3.<span class="hljs-number">3.4</span>
<span class="hljs-comment"># 补充静态资源目录</span>
<span class="hljs-keyword">mkdir</span> -p src/assets/{images,fonts,styles}
</code></pre>
<h4 data-id="heading-14">步骤 2：更新 Webpack 配置（添加资源处理规则）</h4>
<p>在 module.rules 中添加 CSS、图片、字体的处理规则：</p>
<pre><code class="hljs language-bash" lang="bash">// 新增规则，插入到 module.rules 数组中
{
  <span class="hljs-built_in">test</span>: /.css$/,
  use: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>],  // 开发环境嵌入 JS
  exclude: /node_modules/
},
{
  <span class="hljs-built_in">test</span>: /.(png|jpg|jpeg|gif|svg)$/i,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">'asset'</span>,  // webpack5 内置，小文件转 <span class="hljs-built_in">base64</span>，大文件输出单独文件
  parser: { dataUrlCondition: { maxSize: 8 * 1024 } },  // 8kb 为界
  generator: { filename: <span class="hljs-string">'assets/images/[name].[hash:8][ext]'</span> }
},
{
  <span class="hljs-built_in">test</span>: /.(woff2?|eot|ttf|otf)$/i,
  <span class="hljs-built_in">type</span>: <span class="hljs-string">'asset/resource'</span>,
  generator: { filename: <span class="hljs-string">'assets/fonts/[name].[hash:8][ext]'</span> }
}
</code></pre>
<h4 data-id="heading-15">步骤 3：补充类型声明（shims-vue.d.ts）</h4>
<p>让 TS 识别图片、字体资源：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 新增以下内容</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'*.png'</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'*.jpg'</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'*.ttf'</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'*.woff2'</span>
</code></pre>
<h4 data-id="heading-16">步骤 4：测试资源引用</h4>
<p>在 src/assets/images 放入一张图片（如 logo.png），修改 App.vue：</p>
<pre><code class="hljs language-arduino" lang="arduino">核心基础搭建完成{{ msg }}&lt;script setup 
<span class="hljs-type">const</span> msg: string = <span class="hljs-string">'Vue3 + TS + Webpack5 运行正常'</span>
console.<span class="hljs-built_in">log</span>(msg)
</code></pre>
<p>重启 npm run dev，能正常显示图片和样式即说明功能生效。</p>
<h3 data-id="heading-17">四、进阶功能叠加（CSS 剥离、压缩、单位转换）</h3>
<p>目标：优化 CSS 处理流程，实现生产环境剥离、压缩，以及 px 转 rem/vw 适配。</p>
<h4 data-id="heading-18">步骤 1：安装相关依赖</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># CSS 剥离、压缩插件</span>
npm i -D mini-css-extract-plugin css-minimizer-webpack-plugin
<span class="hljs-comment"># 单位转换 + 浏览器兼容</span>
npm i amfe-flexible  <span class="hljs-comment"># rem 适配必需</span>
npm i -D postcss-loader postcss-preset-env postcss-pxtorem
</code></pre>
<h4 data-id="heading-19">步骤 2：配置 PostCSS（px 转 rem）</h4>
<p>创建 postcss.config.js 文件，实现 px 自动转 rem：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-string">'postcss-preset-env'</span>: {  <span class="hljs-comment">// 自动添加浏览器前缀</span>
      <span class="hljs-attr">autoprefixer</span>: { <span class="hljs-attr">overrideBrowserslist</span>: [<span class="hljs-string">'last 2 versions'</span>, <span class="hljs-string">'&gt; 1%'</span>] }
    },
    <span class="hljs-string">'postcss-pxtorem'</span>: {
      <span class="hljs-attr">rootValue</span>: <span class="hljs-number">37.5</span>,  <span class="hljs-comment">// 设计稿 375px 适配，750px 设为 75</span>
      <span class="hljs-attr">propList</span>: [<span class="hljs-string">'*'</span>],  <span class="hljs-comment">// 所有属性转 rem</span>
      <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">'html'</span>],  <span class="hljs-comment">// 排除 html 标签</span>
      <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/i</span>
    }
  }
}
</code></pre>
<h4 data-id="heading-20">步骤 3：更新 Webpack 配置（CSS 进阶处理）</h4>
<p>区分开发/生产环境，实现 CSS 剥离、压缩，整合 PostCSS：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 顶部引入新增插件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'mini-css-extract-plugin'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CssMinimizerPlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'css-minimizer-webpack-plugin'</span>
<span class="hljs-keyword">import</span> crossEnv <span class="hljs-keyword">from</span> <span class="hljs-string">'cross-env'</span>  <span class="hljs-comment">// 后续会安装，先引入</span>

<span class="hljs-comment">// 定义环境变量</span>
<span class="hljs-keyword">const</span> isProd = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>

<span class="hljs-comment">// 更新 CSS 规则</span>
{
  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.css$/</span>,
  <span class="hljs-attr">use</span>: [
    isProd ? <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span> : <span class="hljs-string">'style-loader'</span>,  <span class="hljs-comment">// 生产剥离，开发嵌入</span>
    <span class="hljs-string">'css-loader'</span>,
    <span class="hljs-string">'postcss-loader'</span>  <span class="hljs-comment">// 单位转换 + 前缀</span>
  ],
  <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>
},

<span class="hljs-comment">// 更新 plugins 数组</span>
<span class="hljs-attr">plugins</span>: [
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueLoaderPlugin</span>(),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
    <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'public/index.html'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'index.html'</span>,
    <span class="hljs-attr">minify</span>: isProd ? { <span class="hljs-attr">removeComments</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">collapseWhitespace</span>: <span class="hljs-literal">true</span> } : <span class="hljs-literal">false</span>
  }),
  <span class="hljs-comment">// 生产环境添加 CSS 剥离插件</span>
  ...(isProd ? [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>({
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'css/[name].[contenthash:8].css'</span>,
      <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">'css/[name].[contenthash:8].chunk.css'</span>
    })
  ] : [])
],

<span class="hljs-comment">// 优化配置（添加 CSS 压缩）</span>
<span class="hljs-attr">optimization</span>: {
  <span class="hljs-attr">minimizer</span>: [
    <span class="hljs-string">`...`</span>,  <span class="hljs-comment">// 保留默认 JS 压缩器</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CssMinimizerPlugin</span>()  <span class="hljs-comment">// 生产环境压缩 CSS</span>
  ]
}
</code></pre>
<h4 data-id="heading-21">步骤 4：适配 rem 单位</h4>
<p>在入口文件 main.ts 中引入 amfe-flexible：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'amfe-flexible'</span>  <span class="hljs-comment">// 动态设置根字体大小</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'@/assets/styles/index.css'</span>  <span class="hljs-comment">// 可新增全局样式文件</span>
</code></pre>
<p>重启项目，查看元素样式，px 已自动转为 rem 即生效。</p>
<h3 data-id="heading-22">五、打包优化（清理旧资源、多进程编译）</h3>
<p>目标：优化打包流程，清理旧资源，提升打包速度。</p>
<h4 data-id="heading-23">步骤 1：安装优化依赖</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理旧资源插件</span>
npm i -D clean-webpack-plugin
<span class="hljs-comment"># 多进程编译优化</span>
npm i -D happypack thread-loader
<span class="hljs-comment"># 环境变量统一</span>
npm i -D cross-env
</code></pre>
<h4 data-id="heading-24">步骤 2：配置打包清理旧资源</h4>
<p>在 Webpack 配置中添加 CleanWebpackPlugin：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 顶部引入</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CleanWebpackPlugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'clean-webpack-plugin'</span>

<span class="hljs-comment">// 加入 plugins 数组（放在最前面，确保打包前清理）</span>
<span class="hljs-attr">plugins</span>: [
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWebpackPlugin</span>(),  <span class="hljs-comment">// 新增</span>
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueLoaderPlugin</span>(),
  <span class="hljs-comment">// 其他插件...</span>
]
</code></pre>
<h4 data-id="heading-25">步骤 3：配置 HappyPack 多进程编译</h4>
<p>优化 TS 编译速度，利用多 CPU 核心：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 顶部引入</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HappyPack</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'happypack'</span>
<span class="hljs-keyword">import</span> os <span class="hljs-keyword">from</span> <span class="hljs-string">'os'</span>

<span class="hljs-comment">// 初始化线程池（根据 CPU 核心数设置）</span>
<span class="hljs-keyword">const</span> happyThreadPool = <span class="hljs-title class_">HappyPack</span>.<span class="hljs-title class_">ThreadPool</span>({ <span class="hljs-attr">size</span>: os.<span class="hljs-title function_">cpus</span>().<span class="hljs-property">length</span> })

<span class="hljs-comment">// 修改 TS 处理规则</span>
{
  <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.ts$/</span>,
  <span class="hljs-attr">use</span>: <span class="hljs-string">'happypack/loader?id=ts'</span>,  <span class="hljs-comment">// 用 HappyPack 代理</span>
  <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>
},

<span class="hljs-comment">// 新增 HappyPack 插件配置（加入 plugins 数组）</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">HappyPack</span>({
  <span class="hljs-attr">id</span>: <span class="hljs-string">'ts'</span>,
  <span class="hljs-attr">threadPool</span>: happyThreadPool,
  <span class="hljs-attr">loaders</span>: [
    {
      <span class="hljs-attr">loader</span>: <span class="hljs-string">'ts-loader'</span>,
      <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">transpileOnly</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 只编译不做类型检查，提升速度</span>
        <span class="hljs-attr">appendTsSuffixTo</span>: [<span class="hljs-regexp">/.vue$/</span>]
      }
    }
  ]
})
</code></pre>
<h4 data-id="heading-26">步骤 4：配置生产环境打包脚本</h4>
<p>修改 package.json 的 scripts 字段：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cross-env NODE_ENV=development webpack serve --config webpack.config.ts"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cross-env NODE_ENV=production webpack --config webpack.config.ts"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-27">六、最终测试与验证</h3>
<h4 data-id="heading-28">步骤 1：测试生产环境打包</h4>
<pre><code class="hljs language-arduino" lang="arduino">npm run build
</code></pre>
<p>验证 dist 目录：</p>
<ul>
<li>dist 目录已自动清理，无旧文件残留；</li>
<li>CSS 已剥离为单独文件，且已压缩；</li>
<li>图片、字体资源按配置路径输出，带哈希值；</li>
<li>JS 文件已分割（公共依赖、业务代码分离）。</li>
</ul>
<h4 data-id="heading-29">步骤 2：验证功能完整性</h4>
<p>打开 dist/index.html，确认：页面正常渲染、样式适配（rem 生效）、资源加载正常，所有需求功能均实现。</p>
<h3 data-id="heading-30">总结：搭建逻辑梳理</h3>
<p>整个流程遵循「先跑通核心→再补基础功能→最后优化进阶」的原则，每一步都有明确目标，避免因配置叠加导致的问题：</p>
<ol>
<li>核心层：Vue3+TS+Webpack5 基础整合，确保项目能启动；</li>
<li>基础层：处理样式、图片、字体，满足日常开发资源引用；</li>
<li>进阶层：CSS 剥离、压缩、单位转换，适配生产环境和移动端；</li>
<li>优化层：清理旧资源、多进程编译，提升打包效率和体验。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从一道面试题看算法思维：最小栈（Min Stack）的从 O(N) 到 O(1) 进化之路]]></title>    <link>https://juejin.cn/post/7599585289947676735</link>    <guid>https://juejin.cn/post/7599585289947676735</guid>    <pubDate>2026-01-27T04:03:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599585289947676735" data-draft-id="7599585289947578431" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从一道面试题看算法思维：最小栈（Min Stack）的从 O(N) 到 O(1) 进化之路"/> <meta itemprop="keywords" content="前端,算法"/> <meta itemprop="datePublished" content="2026-01-27T04:03:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从一道面试题看算法思维：最小栈（Min Stack）的从 O(N) 到 O(1) 进化之路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:03:15.000Z" title="Tue Jan 27 2026 04:03:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“最小栈”（LeetCode 155题）作为一道非常经典的试金石。它不涉及复杂的动态规划或图论，却能精准地考察候选人对数据结构的理解深度以及<strong>空间换时间</strong>这一核心算法思想的掌握程度。</p>
<p>题目要求看似简单：设计一个栈，支持 push、pop、top 操作，并能在常数时间 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<p> 内检索到最小元素 getMin。</p>
<p>很多候选人在看到题目时，往往忽略了 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<p> 这个关键约束，直接给出了一个功能正确但性能不达标的方案。今天，我们就从面试官的视角，来剖析这道题从 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(N)
</code></pre>
<p> 到 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<p> 的进化过程。</p>
<h2 data-id="heading-0">第一阶段：直觉与妥协 (暴力解法)</h2>
<p>当被问到“如何实现一个支持获取最小值的栈”时，大多数人的第一直觉是利用 JavaScript 数组的原生方法。既然栈的本质是先进后出（LIFO），那么 push、pop 和 top 都很容易实现。</p>
<p>对于 getMin，最朴素的想法是：既然我要找最小值，那就遍历整个数组好了。</p>
<p>以下是这类回答的典型代码实现：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ES5 构造函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniStack</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span> = []; <span class="hljs-comment">// 存储数据的数组</span>
}

<span class="hljs-title class_">MiniStack</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>.<span class="hljs-title function_">push</span>(x);
}

<span class="hljs-title class_">MiniStack</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">pop</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>.<span class="hljs-title function_">pop</span>();
}

<span class="hljs-title class_">MiniStack</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">top</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>.<span class="hljs-property">length</span>){
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">stack</span>.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>];
}

<span class="hljs-comment">// 暴力解法核心：遍历查找 O(N)</span>
<span class="hljs-title class_">MiniStack</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getMin</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> minValue = <span class="hljs-title class_">Infinity</span>; <span class="hljs-comment">// 初始化为无穷大</span>
    <span class="hljs-keyword">const</span> { stack } = <span class="hljs-variable language_">this</span>;
    <span class="hljs-comment">// 遍历整个栈寻找最小值</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; stack.<span class="hljs-property">length</span>; i++){
        <span class="hljs-keyword">if</span>(stack[i] &lt; minValue){
            minValue = stack[i];
        }
    }
    <span class="hljs-keyword">return</span> minValue;
}
</code></pre>
<h3 data-id="heading-1">面试官点评</h3>
<p>这份代码从功能上来说是正确的。它利用了 JS 数组模拟栈，push、pop、top 的时间复杂度确实是 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<p>。</p>
<p>但是，getMin 方法的实现存在致命弱点：<strong>它的时间复杂度是</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(N) 
</code></pre>
<p>。</p>
<p>随着栈内元素数量（N）的增加，获取最小值的耗时将线性增长。如果在高频调用的场景下，这种遍历操作是不可接受的性能瓶颈。在面试中，这只能算是一个“勉强及格”的答案，因为它没有体现出任何算法优化的思维。</p>
<h2 data-id="heading-2">第二阶段：思维跃迁 (空间换时间)</h2>
<p>如何将 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(N)
</code></pre>
<p> 优化为 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<p>？这需要我们转换思维。</p>
<p>在暴力解法中，我们每次调用 getMin 都要重新计算。也就是我们“忘记”了之前的比较结果。如果我们能有一种机制，能够“记住”随着数据入栈过程中，每一个状态下的最小值，那就不需要回头遍历了。</p>
<p>这里引入算法设计中极重要的思想：<strong>空间换时间</strong>。</p>
<p>我们需要引入一个<strong>辅助栈（Auxiliary Stack）</strong> 。</p>
<ul>
<li><strong>数据栈 (stack)</strong> ：负责常规的数据存储，维持栈的正常逻辑。</li>
<li><strong>辅助栈 (stack2)</strong> ：负责同步存储当前数据栈对应的最小值。</li>
</ul>
<p><strong>核心策略</strong>：辅助栈的栈顶，永远存储着当前数据栈中所有元素的最小值。这实际上维护了一个非严格单调递减的序列。</p>
<h2 data-id="heading-3">第三阶段：完美实现 (双栈协同)</h2>
<p>有了辅助栈的思路，接下来的难点在于：<strong>如何保持两个栈的状态同步？</strong></p>
<p>我们需要处理好两个关键逻辑：</p>
<ol>
<li><strong>入栈 (Push)</strong> ：新元素进来了，辅助栈存不存？</li>
<li><strong>出栈 (Pop)</strong> ：数据栈弹出了，辅助栈要不要跟着弹？</li>
</ol>
<p>以下是经过逻辑修正后的 </p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<p> 完美实现：</p>
<p>JavaScript</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">const</span> MiniStack = function() {
    <span class="hljs-keyword">this</span>.stack = [];      <span class="hljs-comment">// 数据栈</span>
    <span class="hljs-keyword">this</span>.stack2 = [];     <span class="hljs-comment">// 辅助栈（单调栈，栈顶即为最小值）</span>
}

<span class="hljs-comment">// O(1)</span>
MiniStack.prototype.push = function(x) {
    <span class="hljs-comment">// 1. 数据栈必须入栈</span>
    <span class="hljs-keyword">this</span>.stack.push(x);
    
    <span class="hljs-comment">// 2. 辅助栈入栈逻辑</span>
    <span class="hljs-comment">// 如果辅助栈为空，或者新元素 x 小于等于 辅助栈栈顶，则入辅助栈</span>
    <span class="hljs-comment">// 注意：这里必须是 &lt;=，不能只是 &lt;，否则会有重复最小值丢失的问题</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.stack2.length === <span class="hljs-number">0</span> || x &lt;= <span class="hljs-keyword">this</span>.stack2[<span class="hljs-keyword">this</span>.stack2.length-<span class="hljs-number">1</span>]) {
        <span class="hljs-keyword">this</span>.stack2.push(x);
    }
}

<span class="hljs-comment">// O(1)</span>
MiniStack.prototype.pop = function() {
    <span class="hljs-comment">// 1. 数据栈弹出</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> = <span class="hljs-keyword">this</span>.stack.pop();
    
    <span class="hljs-comment">// 2. 辅助栈同步逻辑</span>
    <span class="hljs-comment">// 如果弹出的元素等于辅助栈栈顶元素，说明最小值被移除，辅助栈也要弹出</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">val</span> === <span class="hljs-keyword">this</span>.stack2[<span class="hljs-keyword">this</span>.stack2.length-<span class="hljs-number">1</span>]) {
        <span class="hljs-keyword">this</span>.stack2.pop();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">val</span>;
}

<span class="hljs-comment">// O(1)</span>
MiniStack.prototype.top = function() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.stack[<span class="hljs-keyword">this</span>.stack.length-<span class="hljs-number">1</span>];
}

<span class="hljs-comment">// O(1)</span>
MiniStack.prototype.getMin = function() {
    <span class="hljs-comment">// 直接返回辅助栈栈顶，无需遍历</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.stack2[<span class="hljs-keyword">this</span>.stack2.length-<span class="hljs-number">1</span>];
}
</code></pre>
<h3 data-id="heading-4">深度解析</h3>
<h4 data-id="heading-5">1. Push 操作的去重与同步</h4>
<p>在 push 方法中，判断条件 x &lt;= this.stack2[top] 至关重要。</p>
<ul>
<li>
<p><strong>为什么要判断大小？</strong>  我们只关心比当前最小值更小（或相等）的数。如果新来的数比当前最小值还大，它绝不可能是当前的最小值，因此不需要压入辅助栈。这保证了辅助栈的<strong>单调递减</strong>特性。</p>
</li>
<li>
<p><strong>为什么要包含等于（&lt;=）？</strong>  这是一个常见的坑。假设入栈序列为 [5, 2, 2]。</p>
<ul>
<li>如果不包含等于：辅助栈通过判断只存入第一个 2。</li>
<li>当数据栈弹出最上面的 2 时，代码会误以为最小值被移除了，导致辅助栈唯一的 2 也被弹出。</li>
<li>此时数据栈里还剩一个 2，但辅助栈里的最小值变成了 5。这就产生了 Bug。</li>
<li>因此，<strong>重复的最小值必须同时压入辅助栈</strong>。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">2. Pop 操作的同步</h4>
<p>在 pop 方法中，我们对比数据栈弹出的值与辅助栈栈顶的值。<br/>
只有当两者相等时，才弹出辅助栈。这意味着：我们移除的正是当前的最小值。辅助栈弹出后，新的栈顶自然就变成了“次小值”（即之前的最小值），完美还原了历史状态。</p>
<h4 data-id="heading-7">3. GetMin 的极致性能</h4>
<p>由于辅助栈的精心维护，其栈顶永远是全局最小值。getMin 变成了简单的数组索引访问，没有任何循环，时间复杂度稳稳落在 O(1)</p>
<h3 data-id="heading-8">总结：</h3>
<p>辅助栈就像是数据栈的“历史快照”索引。无论数据栈怎么进出，辅助栈的栈顶始终指向“当前存活数据中的最小者”。这种设计将 getMin 的复杂度从线性阶降维到了常数阶。在实际面试中，写出代码往往只占 60% 的分数。剩下的 40% 取决于你能否清晰地解释“为什么引入辅助栈”、“如何处理重复最小值”以及“空间与时间的权衡”。算法不仅仅是背诵代码，更是对数据流动和资源消耗的精准控制。</p>
<p>如果这篇文章对你有帮助的话，就请你点个赞吧！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[起底 Nuxt 构建魔法：一份代码是如何变成两套“平行宇宙”产物的？]]></title>    <link>https://juejin.cn/post/7599604510366318630</link>    <guid>https://juejin.cn/post/7599604510366318630</guid>    <pubDate>2026-01-27T04:03:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599604510366318630" data-draft-id="7596343020213518362" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="起底 Nuxt 构建魔法：一份代码是如何变成两套“平行宇宙”产物的？"/> <meta itemprop="keywords" content="前端,Node.js,前端框架"/> <meta itemprop="datePublished" content="2026-01-27T04:03:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="donecoding"/> <meta itemprop="url" content="https://juejin.cn/user/3192637500430093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            起底 Nuxt 构建魔法：一份代码是如何变成两套“平行宇宙”产物的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3192637500430093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    donecoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:03:45.000Z" title="Tue Jan 27 2026 04:03:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在系列的前两篇文章中，我们聊了 SSR 的避坑指南和水合（Hydration）的底层逻辑。今天，我们触达最核心的工程化问题：</p>
<p><strong>我们在编辑器里写的是同一套 Vue 代码，但为什么在服务端它能避开 <code>window</code> 运行，在客户端又能精准操作 DOM？Nuxt 到底在构建阶段做了什么手脚？</strong></p>
<ol>
<li>物理层面的“分家”：双重并行构建</li>
</ol>
<p>当你运行 <code>npx nuxi build</code> 时，Nuxt 并不是简单地打包了一次代码。实际上，它驱动构建引擎启动了<strong>两轮完全独立且并行</strong>的编译任务：</p>
<ol>
<li>
<p><strong>Server Build（服务端构建）</strong> ：</p>
<ul>
<li><strong>产物</strong>：生成一个运行在 Node.js 或 Edge Worker 环境的 <code>.mjs</code> 模块。</li>
<li><strong>入口</strong>：对应服务端渲染逻辑，负责接收请求、执行逻辑、拼装 HTML。</li>
</ul>
</li>
<li>
<p><strong>Client Build（客户端构建）</strong> ：</p>
<ul>
<li><strong>产物</strong>：生成由浏览器下载的 <code>.js</code> 静态资源。</li>
<li><strong>入口</strong>：对应客户端交互逻辑，负责数据响应、DOM 变更、SPA 路由跳转。</li>
</ul>
</li>
</ol>
<p>这两个产物物理隔离，入口文件不同，最终被打到了 <code>.output/server</code> 和 <code>.output/public</code> 两个完全不同的目录下。</p>
<ol start="2">
<li>编译宏：代码里的“时空转换开关”</li>
</ol>
<p>在代码中，我们经常使用 <code>import.meta.client</code> 或 <code>process.client</code>。你可能以为这是一个运行时变量，但实际上它是<strong>编译时的静态占位符（Macro）</strong> 。</p>
<p>在构建流水线上，Vite 会根据当前的任务目标，暴力地进行<strong>静态替换</strong>：</p>
<ul>
<li><strong>在 Client Build 任务中</strong>：Vite 会把所有的 <code>import.meta.client</code> 替换为字面量 <code>true</code>。</li>
<li><strong>在 Server Build 任务中</strong>：它会被替换为 <code>false</code>。</li>
</ul>
<p><strong>随之而来的奇迹是：死代码消除 (Tree-shaking)。</strong><br/>
如果编译器看到 <code>if (false) { ... }</code>，它会确认这段代码永远不会执行，从而在最终的产物中<strong>物理删除</strong>掉这块代码。这意味着，你写在 <code>if (import.meta.server)</code> 里的逻辑，根本不会出现在发给浏览器的 JS 文件中。</p>
<blockquote>
<p><strong>⚠️ 安全提醒：</strong>  此处仅为说明代码裁剪的极端物理效果。在生产实践中，<strong>数据库密钥等敏感信息绝不应硬编码在源码中</strong>，而应通过环境变量（Runtime Config）在运行时注入，并在服务器端通过进程环境读取。</p>
</blockquote>
<ol start="3">
<li>SSR 只是“一锤子买卖”：路由接管逻辑</li>
</ol>
<p>这里是很多新手的误区： <strong>“是不是每次点页面跳转，服务器都要重新渲染一次 HTML？”</strong></p>
<p><strong>答案是：不。</strong>  Nuxt 采用的是 <strong>通用渲染（Universal Rendering）</strong>  架构。</p>
<ul>
<li><strong>首屏访问</strong>：由 <strong>服务端入口 A</strong> 接管。它执行渲染，生成 HTML（死代码），将静态内容发给浏览器。</li>
<li><strong>激活（Hydration）</strong> ：浏览器加载 <strong>客户端入口 B</strong>。B 会读取服务端留下的数据（Payload），在内存中重建响应式系统，并接管现有的 DOM。</li>
<li><strong>后续跳转</strong>：一旦水合完成，应用就变成了一个标准的 <strong>SPA（单页面应用）</strong> 。当你通过 <code>&lt;NuxtLink&gt;</code> 跳转时，浏览器不会再请求新的 HTML，而是通过 JS 异步加载数据并直接在客户端更新视图。</li>
</ul>
<ol start="4">
<li>插件系统的真相：任务队列的激活</li>
</ol>
<p>Nuxt 插件并不是在 <code>onMounted</code> 后才注册的，而是在<strong>应用启动的最早期</strong>。</p>
<p>插件的本质是一个<strong>预初始化任务队列</strong>。在 Vue 实例挂载前，Nuxt 会依次执行这些插件。</p>
<ul>
<li><strong>.server 插件</strong>：只在服务端构建任务中被包含。</li>
<li><strong>.client 插件</strong>：只在客户端构建任务中被包含。</li>
</ul>
<p>这种“环境标记”让插件能够精准地在各自的“平行宇宙”中初始化。如果你的插件需要操作 BOM/DOM，将其命名为 <code>.client.ts</code> 是最工程化的做法，这能确保它在构建阶段就被服务端彻底剔除。</p>
<ol start="5">
<li>总结：SSR 的工程闭环</li>
</ol>
<p>通过这三篇文章，我们勾勒出了 Vue SSR 的完整闭环：</p>
<ol>
<li><strong>编写阶段</strong>：利用环境判断和生命周期钩子编写同构代码。</li>
<li><strong>构建阶段</strong>：Nuxt 将源码拆解为两套物理产物，通过硬编码宏实现代码裁剪与瘦身。</li>
<li><strong>运行阶段（首屏）</strong> ：服务端入口 A 生产 HTML，发送给浏览器实现秒开。</li>
<li><strong>交互阶段（SPA）</strong> ：客户端入口 B 完成水合后全面接管，实现后续的无刷新跳转。</li>
</ol>
<p>理解了“两套并行产物”的逻辑，你就再也不会为环境报错感到焦虑。<strong>底层架构的复杂，换来的是开发者的心智解耦。</strong></p>
<hr/>
<p><em>这是《Vue3 组件库 SSR 深度解析》系列的终结篇。如果你对 NuxtLink 与 RouterLink 的底层差异，或者 Vue 为何不提供原生环境判断变量感兴趣，请关注我的后续番外篇！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 Trae IDE 中利用 MCP 高效抓取与收录网络文章]]></title>    <link>https://juejin.cn/post/7599614131423248393</link>    <guid>https://juejin.cn/post/7599614131423248393</guid>    <pubDate>2026-01-27T04:29:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599614131423248393" data-draft-id="7599641289886105646" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 Trae IDE 中利用 MCP 高效抓取与收录网络文章"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T04:29:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="奥升小悠"/> <meta itemprop="url" content="https://juejin.cn/user/1077949151055223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 Trae IDE 中利用 MCP 高效抓取与收录网络文章
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1077949151055223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    奥升小悠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:29:04.000Z" title="Tue Jan 27 2026 04:29:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在维护 奥升官网（基于 Nuxt 3 构建）的过程中，我们需要将发布在其他平台的技术文章迁移到官网的内容管理系统中。手动复制粘贴不仅效率低下，还容易遗漏图片资源或导致格式错乱。</p>
<p>借助 <strong>Trae IDE</strong> 及 <strong>Chrome MCP</strong>，我们可以将这一过程高度自动化。本文将详细介绍这套抓取方案的思路与实现。</p>
<h2 data-id="heading-1">环境与工具</h2>
<p>本方案依赖以下核心环境与工具：</p>
<ol>
<li><strong>Trae IDE</strong>: 新一代 AI 驱动的集成开发环境（我使用的国际版，开了会员），可调用 Gemini-3-Pro-Preview 模型，支持复杂的上下文理解与多步任务执行。</li>
<li><strong>MCP (Model Context Protocol)</strong>:
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhangwin%2Fmcp-chrome" target="_blank" title="https://github.com/hangwin/mcp-chrome" ref="nofollow noopener noreferrer">mcp_chrome</a>: 提供浏览器自动化能力，用于访问网页、读取 DOM 结构、截图等。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-2">抓取思路</h2>
<p>整个抓取流程可以概括为以下四个步骤：</p>
<ol>
<li><strong>目标分析</strong>: AI 通过 MCP 浏览器工具访问目标 URL，解析页面结构，识别标题、正文、发布时间及图片链接。</li>
<li><strong>内容提取</strong>: 将 HTML 内容转换为符合 Nuxt Content 规范的 Markdown 格式，并自动提取 Frontmatter（元数据）。</li>
<li><strong>图片处理</strong>:
<ul>
<li>自动下载文章中的图片到 <code>public/images/articles</code> 目录，并按文章id分文件夹存储。</li>
<li>使用 <code>sharp</code> 对图片进行压缩优化（WebP/JPG 转换、尺寸调整）。</li>
<li>将图片按上传到 OSS 指定文件路径中。</li>
<li>替换 Markdown 中的图片链接为 OSS 上的路径。</li>
</ul>
</li>
<li><strong>自动收录</strong>: 将处理好的 Markdown 文件写入 <code>content/articles/</code> 目录。</li>
</ol>
<h2 data-id="heading-3">关键实现</h2>
<h3 data-id="heading-4">1. 页面内容读取</h3>
<p>利用 MCP 的 <code>chrome_read_page</code> 或 <code>chrome_get_web_content</code> 工具，我们可以直接获取渲染后的页面内容，这对于动态加载的页面尤为重要。</p>
<h3 data-id="heading-5">2. 图片资源的自动化处理</h3>
<p><strong>1. 提取链接</strong>
AI 会从 DOM 中找出所有 <code>&lt;img&gt;</code> 标签的 <code>src</code> 属性。</p>
<p><strong>2. 批量下载</strong>
AI 会生成并执行 Shell 命令（如 <code>curl</code> 或 <code>wget</code>）来下载图片。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># AI 自动生成的下载命令示例</span>
<span class="hljs-built_in">mkdir</span> -p publichttps://ucode-orise.oss-cn-beijing.aliyuncs.com/website/article/20
curl -o publichttps://ucode-orise.oss-cn-beijing.aliyuncs.com/website/article/20/1.jpg http://example.com/path/to/image.jpg
</code></pre>
<p><strong>3. 图片压缩</strong>
利用项目中的 <code>sharp</code> 脚本对下载的图片进行批量处理，确保加载性能。</p>
<p><strong>4. 图片上传到 OSS</strong>
使用<code>ali-oss</code> 库，编写 <code>upload_oss</code> 脚本，将压缩后的图片上传到 OSS 上指定的目录。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params">filePath, retryCount = <span class="hljs-number">0</span></span>) {
    <span class="hljs-comment">// 处理上传到oss的文件路径</span>
    <span class="hljs-keyword">const</span> relativePath = path.<span class="hljs-title function_">relative</span>(articlesDir, filePath);
    <span class="hljs-keyword">const</span> objectName = <span class="hljs-string">`website/article/<span class="hljs-subst">${relativePath.split(path.sep).join(<span class="hljs-string">'/'</span>)}</span>`</span>;

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">put</span>(objectName, filePath);
        <span class="hljs-comment">//... </span>
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-comment">//...</span>
    }
}
</code></pre>
<h3 data-id="heading-6">3. Markdown 生成与 Frontmatter 注入</h3>
<p>Nuxt Content 要求每篇文章包含特定的元数据。我们定义了统一的 Prompt 模板，让 AI 生成标准格式：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
title: 文章标题
slug: article-slug
description: 文章摘要...
date: 2024-03-20
category: 分类
<span class="hljs-section">cover: https://ucode-orise.oss-cn-beijing.aliyuncs.com/website/article/[slug]/cover.jpg
---</span>

<span class="hljs-section">## 正文内容</span>
...
</code></pre>
<h2 data-id="heading-7">实际效果展示</h2>
<p>下图是我们在 Trae 环境中开发时的文章列表页面截图，展示了收录后的效果：</p>
<p><img src="https://ucode-orise.oss-cn-beijing.aliyuncs.com/website/article/21/1.png" alt="IDE" loading="lazy"/>
<img src="https://ucode-orise.oss-cn-beijing.aliyuncs.com/website/article/21/2.png" alt="IDE" loading="lazy"/>
<img src="https://ucode-orise.oss-cn-beijing.aliyuncs.com/website/article/21/3.png" alt="IDE" loading="lazy"/></p>
<h2 data-id="heading-8">总结</h2>
<p>通过 Trae IDE + MCP 的组合，我们将原本需要 10 分钟/篇的人工迁移工作缩短到了 2-3 分钟/篇（主要是AI对话推理时间）。开发者只需提供一个 URL，剩下的分析、下载、转换、优化工作全部由 AI 代理完成。这不仅极大提升了效率，还保证了代码风格与目录结构的一致性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub 入门笔记]]></title>    <link>https://juejin.cn/post/7599579865608257578</link>    <guid>https://juejin.cn/post/7599579865608257578</guid>    <pubDate>2026-01-27T04:37:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599579865608257578" data-draft-id="7599550337385496639" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub 入门笔记"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-27T04:37:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="靖晗"/> <meta itemprop="url" content="https://juejin.cn/user/3739882046098584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub 入门笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3739882046098584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    靖晗
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:37:15.000Z" title="Tue Jan 27 2026 04:37:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为前端开发新手，Git是我们版本控制的基础工具。虽然我记了笔记，但是我依旧很害怕我的笔记本丢失。因此再在这里发一遍我自己所整理的笔记，也希望能帮到同样在入门Git的小伙伴～</p>
<hr/>
<h2 data-id="heading-0">一、Git基础准备</h2>
<ol>
<li>什么是Git？</li>
</ol>
<pre><code class="hljs">Git 是一个分布式版本控制系统，能帮我们跟踪代码变更、协作开发，是前端工程师的必备技能。
</code></pre>
<ol start="2">
<li>macOS安装：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"> 在 App Store 下载 Xcode，安装后会自动包含 Git。 （注：<span class="hljs-built_in">command</span>+space，输入Terminal可以直接找到mac自带的终端。）
</code></pre>
<hr/>
<h2 data-id="heading-1">二、本地操作全流程</h2>
<h3 data-id="heading-2">Step 1：创建版本库</h3>
<pre><code class="hljs language-bash" lang="bash">终端输入：<span class="hljs-comment"># 1. 创建本地文件夹</span>
              <span class="hljs-built_in">mkdir</span> learngit
        <span class="hljs-comment"># 2. 进入文件夹</span>
              <span class="hljs-built_in">cd</span> learngit
        <span class="hljs-comment"># 3. 查看当前路径（macOS路径示例）</span>
              <span class="hljs-built_in">pwd</span>
</code></pre>
<h3 data-id="heading-3">Step 2：初始化仓库</h3>
<pre><code class="hljs language-bash" lang="bash">终端输入：git init
        <span class="hljs-comment"># 输出：Initialized empty Git repository in /Users/michael/learngit/.git/</span>
</code></pre>
<p>注：.git是隐藏目录，用ls -ah才能看到。</p>
<h3 data-id="heading-4">Step 3：关于Git的常用的指令</h3>
<pre><code class="hljs language-sql" lang="sql">  <span class="hljs-number">1.</span> 添加文件到暂存区
        git <span class="hljs-keyword">add</span> file名字
  
  <span class="hljs-number">2.</span> 提交到仓库
        git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m "想要留言的内容"
  
  <span class="hljs-number">3.</span> 查看当前文件状态
        git status
  
  <span class="hljs-number">4.</span> 查看具体修改内容
        git diff file名字
 
  <span class="hljs-number">5.</span> 查看提交历史
        git log
 
  <span class="hljs-number">6.</span> 简洁查看历史, 用一行显示提交记录，方便快速浏览
        git log <span class="hljs-comment">--pretty=oneline</span>
  
  <span class="hljs-number">7.</span> 回退到上一个版本
        git reset <span class="hljs-comment">--hard HEAD^</span>
        注：reset 会直接丢弃修改，慎用，推荐先用 git reflog 找回。
  
  <span class="hljs-number">8.</span> 回退到指定版本（通过 <span class="hljs-keyword">Commit</span> ID）
        git reset <span class="hljs-comment">--hard 1094a...(commit id)</span>
  
  <span class="hljs-number">9.</span> 查看所有操作记录（找回回退前的版本）
        git reflog
  
  <span class="hljs-number">10.</span> 撤销工作区的修改
        git checkout <span class="hljs-comment">-- file名字</span>
  
  <span class="hljs-number">11.</span> 撤销暂存区的修改（放回工作区）
        git reset HEAD file名字
  
  <span class="hljs-number">12.</span> 撤销已提交的修改（安全方式）
        git revert HEAD
  
  <span class="hljs-number">13.</span> 添加远程仓库地址
        git remote <span class="hljs-keyword">add</span> origin git<span class="hljs-variable">@github</span>.com:你的用户名<span class="hljs-operator">/</span>learngit.git
  
  <span class="hljs-number">14.</span> 查看远程仓库信息
        git remote <span class="hljs-operator">-</span>v
  
  <span class="hljs-number">15.</span> 首次推送并关联分支
        git push <span class="hljs-operator">-</span>u origin main
  
  <span class="hljs-number">16.</span> 后续推送
        git push origin main
        
  <span class="hljs-number">17.</span> 创建并切换到分支
        <span class="hljs-number">1</span>) git checkout <span class="hljs-operator">-</span>b 分支名字
        <span class="hljs-number">2</span>) git switch <span class="hljs-operator">-</span>c 分支名字
        这两个都可以

  <span class="hljs-number">19.</span> 查看当前分支
        git branch
  
  <span class="hljs-number">20.</span> 切换到主分支
        <span class="hljs-number">1</span>) git checkout main
        <span class="hljs-number">2</span>) git switch main
        这两个都可以
  
  <span class="hljs-number">21.</span> 合并分支
        git <span class="hljs-keyword">merge</span> 分支名字
        
  <span class="hljs-number">22.</span> 删除分支
        git branch <span class="hljs-operator">-</span>d 分支名字
        
  <span class="hljs-number">23.</span> 禁用Fast Forward 合并
        git <span class="hljs-keyword">merge</span> <span class="hljs-comment">--no-ff -m "merge with no-ff" dev</span>
        
  <span class="hljs-number">24.</span> 临时保存当前工作进度
        git stash

  <span class="hljs-number">25.</span> 查看保存的进度
        git stash list

  <span class="hljs-number">26.</span> 恢复进度（不删除 stash 记录）
        git stash apply

  <span class="hljs-number">27.</span> 恢复进度并删除 stash 记录
        git stash pop

  <span class="hljs-number">28.</span> 恢复指定的 stash
        git stash apply stash@{<span class="hljs-number">0</span>} （注：这里的stash@{<span class="hljs-number">0</span>}默认的是第一个）
  
  <span class="hljs-number">29.</span> 复制指定 <span class="hljs-keyword">Commit</span> 到当前分支
        git cherry<span class="hljs-operator">-</span>pick commitID
        
  <span class="hljs-number">30.</span> 配置别名
        git config <span class="hljs-comment">--global alias.想要配置的别名 原来的名称</span>
        例如：git config <span class="hljs-comment">--global alias.st status</span>
        
  <span class="hljs-number">31.</span> 如何查看自己所配置的别名
        cat .gitconfig
        
  <span class="hljs-number">32.</span> 创建标签
        git tag v1<span class="hljs-number">.0</span>(注：一般是v什么什么，有点类似于版本）
  
  <span class="hljs-number">33.</span> 创建带说明的标签
        git tag <span class="hljs-operator">-</span>a v1<span class="hljs-number">.0</span> <span class="hljs-operator">-</span>m "Verrsion 1.0"
        
  <span class="hljs-number">34.</span> 查看所有的标签
        git tag
      
  <span class="hljs-number">35.</span> 查看标签详情
        git <span class="hljs-keyword">show</span> 想要查看的标签的名字
        
  <span class="hljs-number">36.</span> 删除标签
        git tag <span class="hljs-operator">-</span>d 标签的名字
  
  <span class="hljs-number">37.</span> .gitignore文件
        <span class="hljs-number">1.</span>如果需要强制添加被忽略的文件
            git <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>f 文件名称
        
        <span class="hljs-number">2.</span>检查.gitignore规则是否正确
            git <span class="hljs-keyword">check</span><span class="hljs-operator">-</span>ignore <span class="hljs-operator">-</span>v 文件名称
            
  <span class="hljs-number">38.</span> Cmake基础操作
        <span class="hljs-number">1.</span> 创建 build 目录
            mkdir build <span class="hljs-operator">&amp;&amp;</span> cd build
        
        <span class="hljs-number">2.</span> 生成 Makefile
            cmake ..
            
        <span class="hljs-number">3.</span> 编译
            make
        
        <span class="hljs-number">4.</span> 运行程序
            .<span class="hljs-operator">/</span>main
</code></pre>
<hr/>
<h2 data-id="heading-5">总结</h2>
<p>这篇笔记整理了 Git 的基础操作和常用命令，适合初学者快速入门。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue 表格 vxe-table 如何设置列默认不显示，用户可以手动通过工具栏设置显示]]></title>    <link>https://juejin.cn/post/7599591405313146921</link>    <guid>https://juejin.cn/post/7599591405313146921</guid>    <pubDate>2026-01-27T04:41:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599591405313146921" data-draft-id="7599579865608273962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue 表格 vxe-table 如何设置列默认不显示，用户可以手动通过工具栏设置显示"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-27T04:41:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自由的云h"/> <meta itemprop="url" content="https://juejin.cn/user/3921272428567529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue 表格 vxe-table 如何设置列默认不显示，用户可以手动通过工具栏设置显示
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3921272428567529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自由的云h
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:41:55.000Z" title="Tue Jan 27 2026 04:41:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>vue 表格 vxe-table 如何设置列默认不显示，用户可以手动通过工具栏设置显示。实现该方式非常简单，可以通过列的 visible 属性设置为默认不显示，然后用户可以在工具栏的自定义列里面勾选显示或隐藏。自定义方式就很方便了。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvxetable.cn" target="_blank" title="https://vxetable.cn" ref="nofollow noopener noreferrer">vxetable.cn</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e702c0a2d93740859ac1061d1a6c24e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Ieq55Sx55qE5LqRaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770093715&amp;x-signature=dqpXpxCLI7lgKEBxMGqVYY6hcBI%3D" alt="table_custom_def_hide" loading="lazy"/></p>
<p>通过设置 toolbar-config.custom 启用列个性化设置功能,然后将列的 visible=false 设置为默认隐藏，用户可以通过自定义勾选显示;还可以设置是否否禁用，拖拽排序，冻结列等</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-grid</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"gridOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-grid</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> gridOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">toolbarConfig</span>: {
    <span class="hljs-attr">custom</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">70</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'role'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Role'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Name'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'sex'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Sex'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Age'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'address'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Address'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> }
  ],
  <span class="hljs-attr">data</span>: [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test1'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'test abc'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test2'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">22</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Guangzhou'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test3'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test4'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> }
  ]
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-0">多种显示模式</h2>
<p>自定义列弹出层支持多种方式，可以设置为弹出层，窗口，抽屉等方式.</p>
<p>通过设置 custom-config.mode='modal' 启用窗口模式</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fde18d3cf7b4e188a6da415634c78fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Ieq55Sx55qE5LqRaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770093715&amp;x-signature=TqzHAVesD6QZUm99ivq7SLRaamk%3D" alt="image" loading="lazy"/></p>
<p>设置 custom-config.mode='drawer' 启用窗口模式</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3939d1303fd44551ac38542c61d17efe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Ieq55Sx55qE5LqRaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770093715&amp;x-signature=Rz9Z5UpLbo6qhUC8%2Btbk6vzlDJI%3D" alt="image" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-table" target="_blank" title="https://gitee.com/x-extends/vxe-table" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Router v6 实战：从基础用法到组件抽离]]></title>    <link>https://juejin.cn/post/7599640782569422875</link>    <guid>https://juejin.cn/post/7599640782569422875</guid>    <pubDate>2026-01-27T05:16:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782569422875" data-draft-id="7599601258640375846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Router v6 实战：从基础用法到组件抽离"/> <meta itemprop="keywords" content="React.js,前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-27T05:16:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="全栈打怪日记"/> <meta itemprop="url" content="https://juejin.cn/user/2269028453720813"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Router v6 实战：从基础用法到组件抽离
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2269028453720813/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    全栈打怪日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T05:16:16.000Z" title="Tue Jan 27 2026 05:16:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>React Router 是 React 生态中实现单页面路由跳转的核心工具，今天我们就以这个完整的 Demo 为例，一步步讲解它的基础用法、组件抽离方式和关键注意事项。</p>
<h3 data-id="heading-0">一、项目结构与准备工作</h3>
<p>我们先梳理一下这个 Demo 的文件结构，这是典型的路由拆分方式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fba2e8bbff94450f8186005eae20cf44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWo5qCI5omT5oCq5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095775&amp;x-signature=oYDcO5r0IYSTCSF0e4BLP%2FRXTGA%3D" alt="carbon.png" loading="lazy"/></p>
<h4 data-id="heading-1">1. 安装依赖</h4>
<p>首先确保已经安装了 React Router v6：bashnpm install react-router-dom</p>
<h2 data-id="heading-2">或</h2>
<p>yarn add react-router-dom</p>
<h3 data-id="heading-3">二、核心实现：从基础配置到组件抽离</h3>
<h4 data-id="heading-4">1. 第一步：抽离路由配置组件</h4>
<p>我们把所有路由规则统一放到 <code>src/routes/index.tsx</code> 中，这样便于维护和复用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cd276af81e44c8a825cef75c1a75230~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWo5qCI5omT5oCq5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095775&amp;x-signature=2OyDccawebXiDppziF2vCJ%2FwB4M%3D" alt="carbon (1).png" loading="lazy"/></p>
<h4 data-id="heading-5">2. 第二步：在根组件中引入路由上下文</h4>
<p>在 <code>App.tsx</code> 中，我们用 <code>&lt;BrowserRouter&gt;</code> 包裹整个应用，提供路由运行所需的上下文环境，然后引入我们抽离好的 <code>AppRoute</code> 组件。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddd961aec19342b0bfb37256180f3e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWo5qCI5omT5oCq5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095775&amp;x-signature=zapN7huKd4d476TBsYIDgZAUEgc%3D" alt="carbon (2).png" loading="lazy"/></p>
<h4 data-id="heading-6">3. 第三步：页面组件中使用 <code>&lt;Link&gt;</code> 实现跳转</h4>
<p>在 <code>Home.tsx</code> 和 <code>About.tsx</code> 中，我们用 <code>&lt;Link&gt;</code> 标签替代原生 <code>&lt;a&gt;</code> 标签，实现无刷新跳转。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4ec131e64e7419ab6e37b19f124c3d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWo5qCI5omT5oCq5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095775&amp;x-signature=%2BN9g0DDl9uV6QNLBWvCkOs7IMpo%3D" alt="carbon (3).png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2de93c7e7bd24adf88ab61d4130f23df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWo5qCI5omT5oCq5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095775&amp;x-signature=jr6eVx6pUNXHc3dpOx3bT30aN9g%3D" alt="carbon (4).png" loading="lazy"/></p>
<h3 data-id="heading-7">三、关键注意事项（避坑指南）</h3>
<ol>
<li><strong>包名不要写错</strong>很多新手会把 <code>react-router-dom</code> 误写成其他名字，导致依赖找不到。正确的导入方式是：</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/599e0044083844d6ae81e78bce81ce1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWo5qCI5omT5oCq5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770095775&amp;x-signature=xZXM7Jf%2BlXDY3VD2tlgKffC%2BOuM%3D" alt="carbon (5).png" loading="lazy"/></p>
<ol>
<li>
<p><strong><code>&lt;Route&gt;</code> 标签不能包含文本内容</strong><code>&lt;Route&gt;</code> 是纯配置型标签，只能用来定义路径和组件映射，不能在标签内直接写文本，否则会报错。❌ 错误写法：<code>&lt;Route path="/" element={&lt;Home /&gt;}&gt;去Home页面&lt;/Route&gt;</code>✅ 正确写法：<code>&lt;Route path="/" element={&lt;Home /&gt;} /&gt;</code></p>
</li>
<li>
<p><strong><code>&lt;Link&gt;</code> 的 <code>to</code> 属性建议用绝对路径</strong>像 <code>to="/about"</code> 这样的绝对路径更稳定，避免了相对路径在嵌套路由中可能出现的问题。</p>
</li>
<li>
<p><strong>路由上下文的作用域</strong><code>useParams</code>、<code>useNavigate</code> 等路由钩子，以及 <code>&lt;Link&gt;</code>、<code>&lt;Routes&gt;</code> 等组件，必须在 <code>&lt;BrowserRouter&gt;</code> 包裹的范围内使用，否则会报错。</p>
</li>
<li>
<p><strong>抽离路由的好处</strong></p>
<ul>
<li>路由规则集中管理，修改和维护更方便</li>
<li>根组件代码更简洁，职责更清晰</li>
<li>复杂项目中可以进一步拆分成多个路由模块，再统一导入</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">四、进阶拓展：动态路由与嵌套路由</h3>
<p>这个 Demo 是最基础的路由配置，在实际开发中你还会用到这些进阶功能：</p>
<ol>
<li><strong>动态路由</strong>：用于匹配带参数的路径，比如 <code>/user/123</code>，可以用 <code>useParams()</code> 来获取参数。</li>
<li><strong>嵌套路由</strong>：适合实现侧边栏 + 内容区的布局，通过 <code>&lt;Outlet&gt;</code> 来渲染子路由内容。</li>
<li><strong>编程式导航</strong>：通过 <code>useNavigate()</code> 钩子实现代码跳转，比如登录成功后跳转到首页。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue3.5+antdv3.2封装table自定义表头-自定义排序-自定义伸缩列]]></title>    <link>https://juejin.cn/post/7599703627789385768</link>    <guid>https://juejin.cn/post/7599703627789385768</guid>    <pubDate>2026-01-27T05:26:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599703627789385768" data-draft-id="7599703627789287464" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue3.5+antdv3.2封装table自定义表头-自定义排序-自定义伸缩列"/> <meta itemprop="keywords" content="Ant Design,Vue.js"/> <meta itemprop="datePublished" content="2026-01-27T05:26:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="灼夏无冕"/> <meta itemprop="url" content="https://juejin.cn/user/1399045546053838"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue3.5+antdv3.2封装table自定义表头-自定义排序-自定义伸缩列
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1399045546053838/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    灼夏无冕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T05:26:24.000Z" title="Tue Jan 27 2026 05:26:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>业务需求:</p>
<p>1.表头自定义</p>
<p>2.表格伸缩列自定义</p>
<p>3.字段长度自适应伸缩列,超过宽度设置自动省略,popover气泡卡牌显示全部字段</p>
<p>4.表格排序自定义</p>
<p>5.可展开数据通过操作栏展开</p>
<p>自定义表头:</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a-modal</span>
      <span class="hljs-attr">:visible</span>=<span class="hljs-string">"modelValue"</span>
      <span class="hljs-attr">title</span>=<span class="hljs-string">"自定义表头"</span>
      <span class="hljs-attr">:destroyOnClose</span>=<span class="hljs-string">"true"</span>
      <span class="hljs-attr">:keyboard</span>=<span class="hljs-string">"false"</span>
      <span class="hljs-attr">:maskClosable</span>=<span class="hljs-string">"false"</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"800px"</span>
      @<span class="hljs-attr">ok</span>=<span class="hljs-string">"handleOk"</span>
      @<span class="hljs-attr">cancel</span>=<span class="hljs-string">"handleCancel"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"column-selector-grid"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"selector-actions"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"resetToDefault"</span>&gt;</span>恢复默认<span class="hljs-tag">&lt;/<span class="hljs-name">a-button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"selectAll"</span>&gt;</span>全选<span class="hljs-tag">&lt;/<span class="hljs-name">a-button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"clearAll"</span>&gt;</span>清空<span class="hljs-tag">&lt;/<span class="hljs-name">a-button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">draggable</span>
            <span class="hljs-attr">v-model</span>=<span class="hljs-string">"internalColumns"</span>
            <span class="hljs-attr">group</span>=<span class="hljs-string">"columns"</span>
            <span class="hljs-attr">item-key</span>=<span class="hljs-string">"dataIndex"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-layout"</span>
            <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"props.disabled"</span>
            @<span class="hljs-attr">start</span>=<span class="hljs-string">"onDragStart"</span>
            @<span class="hljs-attr">end</span>=<span class="hljs-string">"onDragEnd"</span>
            <span class="hljs-attr">:move</span>=<span class="hljs-string">"onMove"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">item</span>=<span class="hljs-string">"{ element }"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-item"</span>
                <span class="hljs-attr">:class</span>=<span class="hljs-string">"{
                'required-item': element.required,
                'selected-item': element.visible,}"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"drag-handle"</span> &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">drag-outlined</span> /&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item-content"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a-checkbox</span>
                    <span class="hljs-attr">v-model:checked</span>=<span class="hljs-string">"element.visible"</span>
                    <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"element.required "</span>
                    <span class="hljs-attr">class</span>=<span class="hljs-string">"content-checkbox"</span>
                &gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-title"</span>&gt;</span>
                    {{ element.title }}
                    <span class="hljs-tag">&lt;<span class="hljs-name">a-tooltip</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"element.tip"</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">"element.tip"</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">question-circle-outlined</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tip-icon"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">a-tooltip</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">a-checkbox</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">draggable</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fixed-columns-info"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-text"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">info-circle-outlined</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info-icon"</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>固定表头申明：<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fixed-first-text"</span>&gt;</span>序号<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> 固定显示在第一位，
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fixed-last-text"</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> 固定显示在最后一位，以及其他所有被固定的表头都不能取消选择或调整位置。
        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">a-modal</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, watch, nextTick } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">QuestionCircleOutlined</span>, <span class="hljs-title class_">DragOutlined</span>, <span class="hljs-title class_">InfoCircleOutlined</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/icons-vue'</span>;
<span class="hljs-keyword">import</span> draggable <span class="hljs-keyword">from</span> <span class="hljs-string">'vuedraggable'</span>;

<span class="hljs-comment">// 固定列配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FIXED_COLUMNS</span> = {
  <span class="hljs-attr">FIRST</span>: <span class="hljs-string">'no'</span>,      <span class="hljs-comment">// 序号列固定在第一位</span>
  <span class="hljs-attr">LAST</span>: <span class="hljs-string">'action'</span>    <span class="hljs-comment">// 操作列固定在最后一位</span>
};

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">allColumns</span>: <span class="hljs-title class_">Array</span>,        <span class="hljs-comment">// 所有可用列，按照 tableColumns 顺序</span>
  <span class="hljs-attr">defaultColumns</span>: <span class="hljs-title class_">Array</span>,    <span class="hljs-comment">// 当前选中的列</span>
  <span class="hljs-attr">modelValue</span>: <span class="hljs-title class_">Boolean</span>,       <span class="hljs-comment">// 控制弹窗显示</span>
  <span class="hljs-attr">disabled</span>:{
    <span class="hljs-attr">type</span>:<span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>:<span class="hljs-literal">false</span>
  }
});

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-string">'confirm'</span>,<span class="hljs-string">'closeSelector'</span>]);

<span class="hljs-comment">// 内部维护的列数据</span>
<span class="hljs-keyword">const</span> internalColumns = <span class="hljs-title function_">ref</span>([]);

<span class="hljs-comment">// 拖拽状态</span>
<span class="hljs-keyword">const</span> isDragging = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> draggedElement = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 拖拽开始事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onDragStart</span> = (<span class="hljs-params">evt</span>) =&gt; {
  <span class="hljs-keyword">const</span> draggedItem = evt.<span class="hljs-property">item</span>;
  <span class="hljs-keyword">const</span> draggedIndex = evt.<span class="hljs-property">oldIndex</span>;
  <span class="hljs-keyword">const</span> draggedData = internalColumns.<span class="hljs-property">value</span>[draggedIndex];
  <span class="hljs-comment">// 检查是否是固定列</span>
  <span class="hljs-keyword">if</span> (draggedData.<span class="hljs-property">required</span> ) {
    <span class="hljs-comment">// 阻止拖拽固定列</span>
    evt.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-keyword">return</span>;
  }
  isDragging.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  draggedElement.<span class="hljs-property">value</span> = draggedData;
};

<span class="hljs-comment">// 拖拽结束事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onDragEnd</span> = (<span class="hljs-params">evt</span>) =&gt; {
  isDragging.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  draggedElement.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-comment">// 延迟执行位置恢复，确保拖拽完全结束</span>
  <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">ensureFixedColumnsPosition</span>();
  });
};

<span class="hljs-comment">// 拖拽移动事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onMove</span> = (<span class="hljs-params">evt</span>) =&gt; {
  <span class="hljs-keyword">const</span> draggedItem = evt?.<span class="hljs-property">dragged</span>.<span class="hljs-property">__draggable_context</span>?.<span class="hljs-property">element</span>;
  <span class="hljs-keyword">const</span> targetIndex = evt.<span class="hljs-property">draggedContext</span>.<span class="hljs-property">futureIndex</span>;
  <span class="hljs-comment">// 检查被拖动列是否是固定列</span>
  <span class="hljs-keyword">if</span> (draggedItem?.<span class="hljs-property">required</span> ) {
    <span class="hljs-comment">// 阻止拖拽固定列</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-comment">// 检查目标是否是固定列</span>
  <span class="hljs-keyword">const</span> targetItem = internalColumns.<span class="hljs-property">value</span>[targetIndex];
  <span class="hljs-keyword">if</span> (targetItem &amp;&amp; targetItem.<span class="hljs-property">required</span>) {
    <span class="hljs-comment">// 阻止拖拽到固定列</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-comment">// 智能位置调整：确保拖拽后固定列位置仍然正确</span>
  <span class="hljs-keyword">const</span> adjustedTargetIndex = <span class="hljs-title function_">adjustTargetIndex</span>(targetIndex);
  <span class="hljs-keyword">if</span> (adjustedTargetIndex !== targetIndex) {
    <span class="hljs-comment">// 如果目标位置需要调整，更新拖拽目标</span>
    evt.<span class="hljs-property">draggedContext</span>.<span class="hljs-property">futureIndex</span> = adjustedTargetIndex;
  }
  <span class="hljs-comment">// 允许正常列在固定列之间自由拖拽</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

<span class="hljs-comment">// 智能调整目标位置，确保不破坏序号和操作的位置</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">adjustTargetIndex</span> = (<span class="hljs-params">targetIndex</span>) =&gt; {
  <span class="hljs-keyword">const</span> columns = internalColumns.<span class="hljs-property">value</span>;
  <span class="hljs-comment">// 找到序号和操作的位置</span>
  <span class="hljs-keyword">const</span> noIndex = columns.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === <span class="hljs-variable constant_">FIXED_COLUMNS</span>.<span class="hljs-property">FIRST</span>);
  <span class="hljs-keyword">const</span> actionIndex = columns.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === <span class="hljs-variable constant_">FIXED_COLUMNS</span>.<span class="hljs-property">LAST</span>);
  <span class="hljs-comment">// 如果目标位置是序号列位置，调整到序号列后面</span>
  <span class="hljs-keyword">if</span> (targetIndex === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  }
  <span class="hljs-comment">// 如果目标位置是操作列位置，调整到操作列前面</span>
  <span class="hljs-keyword">if</span> (targetIndex === columns.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> columns.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>;
  }
  <span class="hljs-comment">// 如果目标位置在序号列之前，调整到序号列后面</span>
  <span class="hljs-keyword">if</span> (targetIndex &lt; noIndex) {
    <span class="hljs-keyword">return</span> noIndex + <span class="hljs-number">1</span>;
  }
  <span class="hljs-comment">// 如果目标位置在操作列之后，调整到操作列前面</span>
  <span class="hljs-keyword">if</span> (targetIndex &gt; actionIndex) {
    <span class="hljs-keyword">return</span> actionIndex - <span class="hljs-number">1</span>;
  }
  <span class="hljs-keyword">return</span> targetIndex;
};

<span class="hljs-comment">// 确保固定列在正确位置</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ensureFixedColumnsPosition</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> columns = [...internalColumns.<span class="hljs-property">value</span>];
  <span class="hljs-keyword">let</span> hasChanges = <span class="hljs-literal">false</span>;

  <span class="hljs-comment">// 确保序号列在第一位</span>
  <span class="hljs-keyword">const</span> noColumn = columns.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === <span class="hljs-variable constant_">FIXED_COLUMNS</span>.<span class="hljs-property">FIRST</span>);
  <span class="hljs-keyword">if</span> (noColumn) {
    <span class="hljs-keyword">const</span> noIndex = columns.<span class="hljs-title function_">indexOf</span>(noColumn);
    <span class="hljs-keyword">if</span> (noIndex !== <span class="hljs-number">0</span>) {
      columns.<span class="hljs-title function_">splice</span>(noIndex, <span class="hljs-number">1</span>);
      columns.<span class="hljs-title function_">unshift</span>(noColumn);
      hasChanges = <span class="hljs-literal">true</span>;
    }
  }

  <span class="hljs-comment">// 确保操作列在最后一位</span>
  <span class="hljs-keyword">const</span> actionColumn = columns.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === <span class="hljs-variable constant_">FIXED_COLUMNS</span>.<span class="hljs-property">LAST</span>);
  <span class="hljs-keyword">if</span> (actionColumn) {
    <span class="hljs-keyword">const</span> actionIndex = columns.<span class="hljs-title function_">indexOf</span>(actionColumn);
    <span class="hljs-keyword">if</span> (actionIndex !== columns.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
      columns.<span class="hljs-title function_">splice</span>(actionIndex, <span class="hljs-number">1</span>);
      columns.<span class="hljs-title function_">push</span>(actionColumn);
      hasChanges = <span class="hljs-literal">true</span>;
    }
  }

  <span class="hljs-comment">// 如果有变化，更新列顺序</span>
  <span class="hljs-keyword">if</span> (hasChanges) {
    internalColumns.<span class="hljs-property">value</span> = [...columns];
  }
};

<span class="hljs-comment">// 初始化列数据，保持 tableColumns 的顺序</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initColumns</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 按照 allColumns 的顺序初始化</span>
  internalColumns.<span class="hljs-property">value</span> = props.<span class="hljs-property">allColumns</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> ({
    ...col,
    <span class="hljs-attr">visible</span>: props.<span class="hljs-property">defaultColumns</span>.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">dataIndex</span>) || col.<span class="hljs-property">required</span>
  }));
  <span class="hljs-comment">// 确保固定列在正确位置</span>
  <span class="hljs-title function_">ensureFixedColumnsPosition</span>();
};

<span class="hljs-comment">// 恢复默认</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">resetToDefault</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">initColumns</span>();
};

<span class="hljs-comment">// 全选</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectAll</span> = (<span class="hljs-params"/>) =&gt; {
  internalColumns.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> {
    col.<span class="hljs-property">visible</span> = <span class="hljs-literal">true</span>;
  });
};

<span class="hljs-comment">// 清空（除了必需列和固定列）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">clearAll</span> = (<span class="hljs-params"/>) =&gt; {
  internalColumns.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (!col.<span class="hljs-property">required</span> ) {
      col.<span class="hljs-property">visible</span> = <span class="hljs-literal">false</span>;
    }
  });
};

<span class="hljs-comment">// 确认保存</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleOk</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 按照当前顺序返回可见列的 dataIndex 数组</span>
  <span class="hljs-keyword">const</span> visibleColumns = internalColumns.<span class="hljs-property">value</span>
      .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">visible</span>)
      .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span>);

  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'confirm'</span>, visibleColumns);
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-literal">false</span>);
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCancel</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span>(props.<span class="hljs-property">disabled</span>){
    internalColumns.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> {
      col.<span class="hljs-property">visible</span> = props.<span class="hljs-property">defaultColumns</span>.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">dataIndex</span>) || col.<span class="hljs-property">required</span> ;
    });
  }

  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-literal">false</span>);
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'closeSelector'</span>);
};

<span class="hljs-comment">// 监听 props 变化重新初始化</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">allColumns</span>, initColumns, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> });
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">defaultColumns</span>, <span class="hljs-function">() =&gt;</span> {
  internalColumns.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> {
    col.<span class="hljs-property">visible</span> = props.<span class="hljs-property">defaultColumns</span>.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">dataIndex</span>) || col.<span class="hljs-property">required</span> ;
  });
});

<span class="hljs-comment">// 监听内部列顺序变化，确保固定列位置正确</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> internalColumns.<span class="hljs-property">value</span>, <span class="hljs-function">(<span class="hljs-params">newColumns</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (newColumns &amp;&amp; newColumns.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// 检查固定列位置</span>
    <span class="hljs-keyword">const</span> noIndex = newColumns.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === <span class="hljs-variable constant_">FIXED_COLUMNS</span>.<span class="hljs-property">FIRST</span>);
    <span class="hljs-keyword">const</span> actionIndex = newColumns.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === <span class="hljs-variable constant_">FIXED_COLUMNS</span>.<span class="hljs-property">LAST</span>);

    <span class="hljs-comment">// 如果固定列位置不正确，立即恢复</span>
    <span class="hljs-keyword">if</span> (noIndex !== <span class="hljs-number">0</span> || actionIndex !== newColumns.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
      <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">ensureFixedColumnsPosition</span>();
      });
    }
  }
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.column-selector-grid</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.selector-actions</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fafafa</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
}

<span class="hljs-selector-class">.grid-layout</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">150px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.grid-item</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#d9d9d9</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">cursor</span>: move;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-class">.grid-item</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-class">.grid-item</span><span class="hljs-selector-class">.required-item</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f6ffed</span>;
}

<span class="hljs-selector-class">.grid-item</span><span class="hljs-selector-class">.selected-item</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e6f7ff</span>;
}

<span class="hljs-selector-class">.drag-handle</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
  <span class="hljs-attribute">cursor</span>: move;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-selector-class">.grid-item</span><span class="hljs-selector-class">.required-item</span> <span class="hljs-selector-class">.drag-handle</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#d9f7be</span>;
}

<span class="hljs-selector-class">.item-content</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.content-checkbox</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.content-checkbox</span> &gt;&gt;&gt; <span class="hljs-selector-class">.ant-checkbox</span> {
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.content-checkbox</span> &gt;&gt;&gt; <span class="hljs-selector-class">.ant-checkbox</span> + <span class="hljs-selector-tag">span</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">white-space</span>: normal;
}

<span class="hljs-selector-class">.content-title</span> {
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.4</span>;
  <span class="hljs-attribute">word-break</span>: break-word;
  <span class="hljs-attribute">text-align</span>: left;
}

<span class="hljs-selector-class">.tip-icon</span> {
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.fixed-columns-info</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f6ffed</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#b7eb8f</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.info-text</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
}

<span class="hljs-selector-class">.info-icon</span> {
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#52c41a</span>;
}

<span class="hljs-selector-class">.fixed-first-text</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#52c41a</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.fixed-last-text</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1890ff</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>表格封装:</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-page"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"header"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a-table</span>
          <span class="hljs-attr">bordered</span>
          <span class="hljs-attr">row-key</span>=<span class="hljs-string">"id"</span>
          <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">"tableRef"</span>
          <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span>
          <span class="hljs-attr">:columns</span>=<span class="hljs-string">"currentTableColumns"</span>
          <span class="hljs-attr">:data-source</span>=<span class="hljs-string">"dataSource"</span>
          <span class="hljs-attr">:expand-row-by-click</span>=<span class="hljs-string">"false"</span>
          <span class="hljs-attr">:row-selection</span>=<span class="hljs-string">"rowSelection"</span>
          <span class="hljs-attr">:expandIconColumnIndex</span>=<span class="hljs-string">"-1"</span>
          @<span class="hljs-attr">expand</span>=<span class="hljs-string">"handleExpand"</span>
          <span class="hljs-attr">:expanded-row-keys</span>=<span class="hljs-string">"expandedRowKeys"</span>
          @<span class="hljs-attr">resizeColumn</span>=<span class="hljs-string">"handleResizeColumn"</span>
          <span class="hljs-attr">:scroll</span>=<span class="hljs-string">"{ x: '120%', y: 'calc(100vh - 375px)' }"</span>
          <span class="hljs-attr">:pagination</span>=<span class="hljs-string">"false"</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 动态插槽处理 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"slotName in Object.keys($slots)"</span> #[<span class="hljs-attr">slotName</span>]=<span class="hljs-string">"scope"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"slotName"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:name</span>=<span class="hljs-string">"slotName"</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"scope"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

        <span class="hljs-comment">&lt;!--通用bodyCell插槽封装--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">bodyCell</span>=<span class="hljs-string">"{text,record,column,index}"</span>&gt;</span>
          <span class="hljs-comment">&lt;!--  先检查是否有自定义的bodyCell插槽--&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$slots.bodyCell"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"bodyCell"</span> <span class="hljs-attr">:text</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">:record</span>=<span class="hljs-string">"record"</span> <span class="hljs-attr">:column</span>=<span class="hljs-string">"column"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
          <span class="hljs-comment">&lt;!-- 无自定义的bodyCell插槽时的默认处理逻辑--&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
            {{ formatCellText(text,record,column) }}
          <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 通用操作列 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">action</span>=<span class="hljs-string">"{ record, index }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"action"</span> <span class="hljs-attr">:record</span>=<span class="hljs-string">"record"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 默认操作列 --&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 扩展行插槽 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">expandedRowRender</span>=<span class="hljs-string">"{ record, index }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"expandedRowRender"</span> <span class="hljs-attr">:record</span>=<span class="hljs-string">"record"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"index"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-name">a-table</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pagination-wrapper"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a-pagination</span>
            <span class="hljs-attr">show-size-changer</span>
            <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
            <span class="hljs-attr">v-model:current</span>=<span class="hljs-string">"pagination.page"</span>
            <span class="hljs-attr">v-model:page-size</span>=<span class="hljs-string">"pagination.pageSize"</span>
            <span class="hljs-attr">:show-total</span>=<span class="hljs-string">"(total) =&gt; `共 ${total} 条`"</span>
            <span class="hljs-attr">:total</span>=<span class="hljs-string">"pagination.total"</span>
            <span class="hljs-attr">:pageSizeOptions</span>=<span class="hljs-string">"['100', '200', '300', '500']"</span>
            @<span class="hljs-attr">change</span>=<span class="hljs-string">"onChangePage"</span>
        &gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">a-pagination</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!--   自定义表头模态框--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ColumnSelector</span>
        <span class="hljs-attr">:visible</span>=<span class="hljs-string">"showColumnSelector"</span>
        <span class="hljs-attr">:all-columns</span>=<span class="hljs-string">"enhancedColumns"</span>
        <span class="hljs-attr">:default-columns</span>=<span class="hljs-string">"selectedColumns"</span>
        @<span class="hljs-attr">confirm</span>=<span class="hljs-string">"handleColumnConfirm"</span>
        @<span class="hljs-attr">closeSelector</span>=<span class="hljs-string">"closeSelector"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> {computed, h, nextTick, onMounted, onUnmounted, onUpdated, reactive, ref} <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> {settingStore} <span class="hljs-keyword">from</span> <span class="hljs-string">"../../store/index.js"</span>;
<span class="hljs-keyword">import</span> {storeToRefs} <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ColumnSelector</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../../components/ColumnsSelector/index.vue"</span>;
<span class="hljs-keyword">import</span> {debounce, deepClone} <span class="hljs-keyword">from</span> <span class="hljs-string">"../../utils/util.js"</span>;
<span class="hljs-keyword">const</span> settingStoreRef = <span class="hljs-title function_">settingStore</span>();
<span class="hljs-keyword">const</span> { tableOrderByName, tableAscOrDescOrNomal } = <span class="hljs-title function_">storeToRefs</span>(settingStoreRef)
<span class="hljs-keyword">import</span> customizeHeaderApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../api/CustomizeHeader/index.js'</span>
<span class="hljs-keyword">import</span> {message} <span class="hljs-keyword">from</span> <span class="hljs-string">"ant-design-vue"</span>;
<span class="hljs-keyword">import</span> {useRoute} <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-router"</span>;

<span class="hljs-keyword">let</span> tableRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-comment">//表格加载状态</span>
  <span class="hljs-attr">loading</span>:<span class="hljs-title class_">Boolean</span>,
  <span class="hljs-attr">showColumnSelector</span>:<span class="hljs-title class_">Boolean</span>,
  <span class="hljs-attr">rowSelection</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>
  },
  <span class="hljs-attr">pagination</span>:{
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: { },
  },
  <span class="hljs-comment">//需要排序的表格标题</span>
  <span class="hljs-attr">sortTableList</span>:{
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: [],
  },
  <span class="hljs-comment">//补充必需的列</span>
  <span class="hljs-attr">requiredColumns</span>:{
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: [],
  },
  <span class="hljs-attr">expandedRowKeys</span>:{
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: [],
  },
  <span class="hljs-attr">columns</span>:<span class="hljs-title class_">Array</span>,
  <span class="hljs-attr">dataSource</span>:{
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: [],
  },
})
<span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>();

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'onChangePage'</span>,<span class="hljs-string">'closeSelector'</span>,<span class="hljs-string">'resetPage'</span>,<span class="hljs-string">'columnResized'</span>])

<span class="hljs-comment">//自定义表头拉伸</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResizeColumn</span>=(<span class="hljs-params">w, col</span>)=&gt;{
  col.<span class="hljs-property">width</span> = w;
  <span class="hljs-comment">// 强制表格重新渲染</span>
  <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
    tableRef.<span class="hljs-property">value</span>?.<span class="hljs-property">$forceUpdate</span>?.();
  })
  <span class="hljs-title function_">debounceResizeColumn</span>({
    <span class="hljs-attr">dataIndex</span>: col.<span class="hljs-property">dataIndex</span>,
    <span class="hljs-attr">width</span>: w,
    <span class="hljs-attr">routePath</span>: route.<span class="hljs-property">path</span>
  })
}
<span class="hljs-keyword">const</span> debounceResizeColumn = <span class="hljs-title function_">debounce</span>(<span class="hljs-function">(<span class="hljs-params">payload</span>)=&gt;</span>{
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'columnResized'</span>,payload)
  <span class="hljs-title function_">checkAllCellsOverflow</span>();
},<span class="hljs-number">500</span>)

<span class="hljs-keyword">let</span> <span class="hljs-variable constant_">DEFAULT_VISIBLE_COLUMNS</span> = props.<span class="hljs-property">columns</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span>{
  <span class="hljs-keyword">return</span> item.<span class="hljs-property">dataIndex</span>
})
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleExpand</span> = (<span class="hljs-params">expanded, record</span>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'handleExpand'</span>,expanded, record)
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">onChangePage</span>=(<span class="hljs-params">data</span>)=&gt;{
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'onChangePage'</span>, data)
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">closeSelector</span>=(<span class="hljs-params"/>)=&gt;{
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'closeSelector'</span>)
}
<span class="hljs-comment">//排序</span>
<span class="hljs-comment">// 当前排序状态</span>
<span class="hljs-keyword">const</span> currentSorter = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">field</span>: tableOrderByName.<span class="hljs-property">value</span>,
  <span class="hljs-attr">order</span>: tableAscOrDescOrNomal.<span class="hljs-property">value</span> ?
      (tableAscOrDescOrNomal.<span class="hljs-property">value</span> === <span class="hljs-string">'0'</span> ? <span class="hljs-string">'ascend'</span> : <span class="hljs-string">'descend'</span>) :
      <span class="hljs-literal">null</span>
});
<span class="hljs-comment">// 生成带有自定义排序图标的列配置</span>
<span class="hljs-keyword">const</span> currentSortTableColumns = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> props.<span class="hljs-property">columns</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (props.<span class="hljs-property">sortTableList</span>.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">dataIndex</span>)) {
      <span class="hljs-keyword">const</span> isCurrentSorted = currentSorter.<span class="hljs-property">value</span>.<span class="hljs-property">field</span> === col.<span class="hljs-property">dataIndex</span>;
      <span class="hljs-keyword">const</span> sortUpActive = isCurrentSorted &amp;&amp; currentSorter.<span class="hljs-property">value</span>.<span class="hljs-property">order</span> === <span class="hljs-string">'ascend'</span>;
      <span class="hljs-keyword">const</span> sortDownActive = isCurrentSorted &amp;&amp; currentSorter.<span class="hljs-property">value</span>.<span class="hljs-property">order</span> === <span class="hljs-string">'descend'</span>;
      <span class="hljs-keyword">return</span> {
        ...col,
        <span class="hljs-comment">// 禁用 Ant Design 的默认排序图标</span>
        <span class="hljs-attr">sorter</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// 使用自定义标题渲染</span>
        <span class="hljs-attr">title</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-string">'div'</span>, {
          <span class="hljs-attr">class</span>: <span class="hljs-string">'sortable-header'</span>,
          <span class="hljs-attr">onClick</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
            <span class="hljs-title function_">handleHeaderClick</span>(col.<span class="hljs-property">dataIndex</span>, event);
          }
        }, [
          <span class="hljs-title function_">h</span>(<span class="hljs-string">'span'</span>, {
            <span class="hljs-attr">class</span>: <span class="hljs-string">'header-title'</span>,
          }, col.<span class="hljs-property">title</span>),
          <span class="hljs-title function_">h</span>(<span class="hljs-string">'div'</span>, {
            <span class="hljs-attr">class</span>: <span class="hljs-string">'sort-icons'</span>,
            <span class="hljs-attr">style</span>: <span class="hljs-string">'display: flex; flex-direction: column; margin-left: 4px; line-height: 1;'</span>,
            <span class="hljs-attr">onClick</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
              <span class="hljs-comment">// 阻止事件冒泡，排序图标有自己的点击事件</span>
              event.<span class="hljs-title function_">stopPropagation</span>();
            }
          }, [
            <span class="hljs-comment">// 升序三角形图标（正三角）</span>
            <span class="hljs-title function_">h</span>(<span class="hljs-string">'div'</span>, {
              <span class="hljs-attr">class</span>: <span class="hljs-string">`sort-icon sort-up <span class="hljs-subst">${sortUpActive ? <span class="hljs-string">'active'</span> : <span class="hljs-string">''</span>}</span>`</span>,
              <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">handleSortClick</span>(col.<span class="hljs-property">dataIndex</span>, <span class="hljs-string">'ascend'</span>)
            }),
            <span class="hljs-comment">// 降序三角形图标（倒三角）</span>
            <span class="hljs-title function_">h</span>(<span class="hljs-string">'div'</span>, {
              <span class="hljs-attr">class</span>: <span class="hljs-string">`sort-icon sort-down <span class="hljs-subst">${sortDownActive ? <span class="hljs-string">'active'</span> : <span class="hljs-string">''</span>}</span>`</span>,
              <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">handleSortClick</span>(col.<span class="hljs-property">dataIndex</span>, <span class="hljs-string">'descend'</span>)
            })
          ])
        ])
      };
    }
    <span class="hljs-keyword">return</span> col;
  });
});
<span class="hljs-comment">// 处理排序图标点击</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSortClick</span> = (<span class="hljs-params">field, order</span>) =&gt; {
  <span class="hljs-comment">// 如果点击的是当前排序字段且当前已经是该排序方式，则取消排序</span>
  <span class="hljs-keyword">if</span> (currentSorter.<span class="hljs-property">value</span>.<span class="hljs-property">field</span> === field &amp;&amp; currentSorter.<span class="hljs-property">value</span>.<span class="hljs-property">order</span> === order) {
    settingStoreRef.$patch({
      <span class="hljs-attr">tableOrderByName</span>: <span class="hljs-literal">undefined</span>,
      <span class="hljs-attr">tableAscOrDescOrNomal</span>: <span class="hljs-literal">undefined</span>
    });
    currentSorter.<span class="hljs-property">value</span> = {
      <span class="hljs-attr">field</span>: <span class="hljs-literal">undefined</span>,
      <span class="hljs-attr">order</span>: <span class="hljs-literal">null</span>
    };
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 设置新的排序</span>
    <span class="hljs-keyword">const</span> sortOrder = order === <span class="hljs-string">'ascend'</span> ? <span class="hljs-string">'0'</span> : <span class="hljs-string">'1'</span>;
    settingStoreRef.$patch({
      <span class="hljs-attr">tableOrderByName</span>: field,
      <span class="hljs-attr">tableAscOrDescOrNomal</span>: sortOrder
    });
    currentSorter.<span class="hljs-property">value</span> = {
      <span class="hljs-attr">field</span>: field,
      <span class="hljs-attr">order</span>: order
    };
  }
  <span class="hljs-comment">// 重置页码并重新加载数据</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'resetPage'</span>)
};
<span class="hljs-comment">// 处理列标题点击（点击标题其他位置）</span>
<span class="hljs-comment">// 处理表头点击</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleHeaderClick</span> = (<span class="hljs-params">field, event</span>) =&gt; {
  <span class="hljs-keyword">const</span> target = event.<span class="hljs-property">target</span>;
  <span class="hljs-comment">// 判断是否点击了排序图标区域</span>
  <span class="hljs-keyword">const</span> isSortIcon = target.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'.sort-icons'</span>) ||
      target.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'sort-icon'</span>) ||
      target.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'sort-up'</span>) ||
      target.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'sort-down'</span>) ||
      target.<span class="hljs-property">tagName</span> === <span class="hljs-string">'DIV'</span> &amp;&amp; (
          target.<span class="hljs-property">style</span>.<span class="hljs-property">borderLeft</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'transparent'</span>) ||
          target.<span class="hljs-property">style</span>.<span class="hljs-property">borderRight</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'transparent'</span>)
      );

  <span class="hljs-comment">// 如果点击的是排序图标区域，不处理（由 handleSortClick 处理）</span>
  <span class="hljs-keyword">if</span> (isSortIcon) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-comment">// 获取当前列的排序状态</span>
  <span class="hljs-keyword">const</span> isCurrentColumn = currentSorter.<span class="hljs-property">value</span>.<span class="hljs-property">field</span> === field;
  <span class="hljs-keyword">const</span> isAscending = currentSorter.<span class="hljs-property">value</span>.<span class="hljs-property">order</span> === <span class="hljs-string">'ascend'</span>;
  <span class="hljs-keyword">const</span> isDescending = currentSorter.<span class="hljs-property">value</span>.<span class="hljs-property">order</span> === <span class="hljs-string">'descend'</span>;
  <span class="hljs-keyword">if</span> (isCurrentColumn) {
    <span class="hljs-comment">// 如果当前列已经是排序状态，点击表头其他区域取消排序</span>
    <span class="hljs-keyword">if</span> (isAscending || isDescending) {
      settingStoreRef.$patch({
        <span class="hljs-attr">tableOrderByName</span>: <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">tableAscOrDescOrNomal</span>: <span class="hljs-literal">undefined</span>
      });
      currentSorter.<span class="hljs-property">value</span> = {
        <span class="hljs-attr">field</span>: <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">order</span>: <span class="hljs-literal">null</span>
      };
      <span class="hljs-title function_">emit</span>(<span class="hljs-string">'resetPage'</span>)
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 如果当前列没有排序，点击表头设置为默认升序</span>
    settingStoreRef.$patch({
      <span class="hljs-attr">tableOrderByName</span>: field,
      <span class="hljs-attr">tableAscOrDescOrNomal</span>: <span class="hljs-string">'0'</span> <span class="hljs-comment">// 0 表示升序</span>
    });
    currentSorter.<span class="hljs-property">value</span> = {
      <span class="hljs-attr">field</span>: field,
      <span class="hljs-attr">order</span>: <span class="hljs-string">'ascend'</span>
    };
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'resetPage'</span>)
  }
};
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initTableOrder</span>(<span class="hljs-params"/>){
  settingStoreRef.$patch({
    <span class="hljs-attr">tableOrderByName</span>:<span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">tableAscOrDescOrNomal</span>:<span class="hljs-literal">undefined</span>
  })
  currentSorter.<span class="hljs-property">value</span> = {
    <span class="hljs-attr">field</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">order</span>: <span class="hljs-literal">null</span>
  };
}

<span class="hljs-comment">//自定义表头 start</span>
<span class="hljs-keyword">const</span> visibleColumns = <span class="hljs-title function_">ref</span>([...<span class="hljs-variable constant_">DEFAULT_VISIBLE_COLUMNS</span>]);
<span class="hljs-keyword">let</span> allDefaultColumns = <span class="hljs-title function_">ref</span>([])
<span class="hljs-comment">// 获取实际显示的表格列</span>
<span class="hljs-keyword">const</span> currentTableColumns = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> allColumns = currentSortTableColumns.<span class="hljs-property">value</span>;
  <span class="hljs-comment">// 过滤出需要显示的列，并保持顺序</span>
  <span class="hljs-keyword">return</span> visibleColumns.<span class="hljs-property">value</span>
      .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">dataIndex</span> =&gt;</span> allColumns.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === dataIndex))
      .<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>);
});

<span class="hljs-comment">// 当前选中的列</span>
<span class="hljs-keyword">const</span> selectedColumns = <span class="hljs-title function_">ref</span>([...<span class="hljs-variable constant_">DEFAULT_VISIBLE_COLUMNS</span>]);
<span class="hljs-keyword">const</span> selectorColumns = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 过滤出需要显示的列，并保持顺序</span>
  <span class="hljs-keyword">return</span> allDefaultColumns.<span class="hljs-property">value</span>
      .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">dataIndex</span> =&gt;</span> props.<span class="hljs-property">columns</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === dataIndex))
      .<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>);
});
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getColumnTip</span>(<span class="hljs-params">dataIndex</span>) {
  <span class="hljs-keyword">let</span> tips = {};
  props.<span class="hljs-property">columns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span>{
    tips[item.<span class="hljs-property">dataIndex</span>] =  item.<span class="hljs-property">title</span>;
  })
  <span class="hljs-keyword">return</span> tips[dataIndex];
}
<span class="hljs-comment">// 增强列信息</span>
<span class="hljs-keyword">const</span> enhancedColumns = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> columns = selectorColumns.<span class="hljs-property">value</span>;
  <span class="hljs-comment">// 确保顺序与 tableColumns 一致</span>
  <span class="hljs-keyword">return</span> columns.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> ({
    ...col,
    <span class="hljs-attr">tip</span>: <span class="hljs-title function_">getColumnTip</span>(col.<span class="hljs-property">dataIndex</span>),
    <span class="hljs-attr">required</span>: props.<span class="hljs-property">requiredColumns</span>.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">dataIndex</span>)
  }));
});
<span class="hljs-comment">// 保存列设置</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleColumnConfirm</span>(<span class="hljs-params">columns</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 更新visibleColumns和selectedColumns</span>
    visibleColumns.<span class="hljs-property">value</span> = columns;
    selectedColumns.<span class="hljs-property">value</span> = columns;
    <span class="hljs-comment">// 接口保存</span>
    <span class="hljs-keyword">await</span> customizeHeaderApi.<span class="hljs-title function_">update</span>({
      <span class="hljs-attr">pageRoutePath</span>: route.<span class="hljs-property">path</span>,
      <span class="hljs-attr">tableColumsNameLst</span>: columns
    })
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'closeSelector'</span>);
    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">'表头设置已保存'</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'保存列设置失败'</span>, e);
    message.<span class="hljs-title function_">error</span>(<span class="hljs-string">'保存表头设置失败'</span>);
  }
}
<span class="hljs-comment">// 加载保存的设置</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadColumnPreference</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">//获取已保存的设置</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> customizeHeaderApi.<span class="hljs-title function_">get</span>({<span class="hljs-attr">pageRoutePath</span>:route?.<span class="hljs-property">path</span>});
    <span class="hljs-keyword">const</span> saved = res.<span class="hljs-property">data</span>?.<span class="hljs-property">tableColumsNameLst</span>;
    <span class="hljs-comment">// 验证并处理保存的列设置</span>
    <span class="hljs-keyword">if</span> (saved &amp;&amp; saved.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// 1. 过滤掉不存在的列</span>
      <span class="hljs-keyword">const</span> validColumns = saved.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">dataIndex</span> =&gt;</span>
          props.<span class="hljs-property">columns</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> col.<span class="hljs-property">dataIndex</span> === dataIndex)
      );
      <span class="hljs-comment">// 2. 补充必需的列</span>
      props.<span class="hljs-property">requiredColumns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">col</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!validColumns.<span class="hljs-title function_">includes</span>(col)) {
          validColumns.<span class="hljs-title function_">unshift</span>(col); <span class="hljs-comment">// 必需列放在前面</span>
        }
      });
      visibleColumns.<span class="hljs-property">value</span> = validColumns;
      <span class="hljs-comment">//必须列</span>
      <span class="hljs-keyword">let</span> requiredColumns = <span class="hljs-title function_">deepClone</span>(props.<span class="hljs-property">columns</span>);
      requiredColumns = requiredColumns.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">col</span>)=&gt;</span>props.<span class="hljs-property">requiredColumns</span>.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">dataIndex</span>));
      <span class="hljs-comment">//已保存的必须列</span>
      <span class="hljs-keyword">let</span> savedNonRequiredColumns = saved.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">dataIndex</span> =&gt;</span> !props.<span class="hljs-property">requiredColumns</span>.<span class="hljs-title function_">includes</span>(dataIndex)).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">dataIndex</span>=&gt;</span>
          props.<span class="hljs-property">columns</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">col</span>=&gt;</span> col.<span class="hljs-property">dataIndex</span> == dataIndex)).<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>);
      <span class="hljs-comment">//未保存的列</span>
      <span class="hljs-keyword">let</span> unsavedCols = props.<span class="hljs-property">columns</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">col</span>=&gt;</span>!props.<span class="hljs-property">requiredColumns</span>.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">dataIndex</span>) &amp;&amp; !saved.<span class="hljs-title function_">includes</span>(col.<span class="hljs-property">dataIndex</span>));
      <span class="hljs-keyword">const</span> orderColumns = [...requiredColumns,...savedNonRequiredColumns,...unsavedCols];
      allDefaultColumns.<span class="hljs-property">value</span> = orderColumns.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">col</span>=&gt;</span>col.<span class="hljs-property">dataIndex</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 使用默认值</span>
      visibleColumns.<span class="hljs-property">value</span> = [...<span class="hljs-variable constant_">DEFAULT_VISIBLE_COLUMNS</span>];
      allDefaultColumns.<span class="hljs-property">value</span> = [...<span class="hljs-variable constant_">DEFAULT_VISIBLE_COLUMNS</span>];
    }
    <span class="hljs-comment">// 更新selectedColumns（用于ColumnSelector）</span>
    selectedColumns.<span class="hljs-property">value</span> = [...visibleColumns.<span class="hljs-property">value</span>];
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'加载列设置失败'</span>, e);
    visibleColumns.<span class="hljs-property">value</span> = [...<span class="hljs-variable constant_">DEFAULT_VISIBLE_COLUMNS</span>];
    selectedColumns.<span class="hljs-property">value</span> = [...<span class="hljs-variable constant_">DEFAULT_VISIBLE_COLUMNS</span>];
  }
}
<span class="hljs-comment">//自定义表头 end</span>

<span class="hljs-comment">// 格式化单元格文本</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">formatCellText</span> = (<span class="hljs-params">text, record, column</span>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> text === <span class="hljs-string">'object'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(text)
  }
  <span class="hljs-keyword">return</span> text || <span class="hljs-string">''</span>
}
<span class="hljs-comment">// 检查文本是否溢出</span>
<span class="hljs-keyword">const</span> overflowMap = <span class="hljs-title function_">reactive</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>());
<span class="hljs-keyword">const</span> <span class="hljs-title function_">isOverflow</span> = (<span class="hljs-params">columnKey, rowKey</span>) =&gt; {
  <span class="hljs-keyword">return</span> overflowMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${rowKey}</span>-<span class="hljs-subst">${columnKey}</span>`</span>) || <span class="hljs-literal">false</span>;
};
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkAllCellsOverflow</span> =(<span class="hljs-params"/>)=&gt;{
  <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">const</span> cells = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.table-cell'</span>);
    cells.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">cell</span>)=&gt;</span>{
      <span class="hljs-keyword">const</span> columnKey = cell.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-column-key'</span>);
      <span class="hljs-keyword">const</span> rowKye = cell.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-row-key'</span>);
      <span class="hljs-keyword">const</span> key = <span class="hljs-string">`<span class="hljs-subst">${rowKye}</span>-<span class="hljs-subst">${columnKey}</span>`</span>;
      <span class="hljs-keyword">const</span> isOverFlow = cell.<span class="hljs-property">scrollWidth</span> &gt; cell.<span class="hljs-property">clientWidth</span>;
      overflowMap.<span class="hljs-title function_">set</span>(key,isOverFlow);
    })
  })
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">()=&gt;</span>{
  <span class="hljs-title function_">initTableOrder</span>();
  <span class="hljs-title function_">loadColumnPreference</span>();
  <span class="hljs-comment">// 监听窗口变化</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, checkAllCellsOverflow);
})
<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">()=&gt;</span>{
  <span class="hljs-title function_">checkAllCellsOverflow</span>();
})
<span class="hljs-comment">// 清理事件监听</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, checkAllCellsOverflow);
});
<span class="hljs-comment">// 暴露方法给父组件</span>
<span class="hljs-title function_">defineExpose</span>({
  initTableOrder,
  isOverflow,
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.pagination-wrapper</span> {
  <span class="hljs-attribute">text-align</span>: right;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**  防抖函数，规定时间内连续出发的函数只执行最后一次 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait, immediate</span>) {
    <span class="hljs-keyword">let</span> timeout; <span class="hljs-comment">// 定义一个计时器变量，用于延迟执行函数</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) { <span class="hljs-comment">// 返回一个包装后的函数</span>
        <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 保存函数执行上下文对象</span>
        <span class="hljs-keyword">const</span> later = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) { <span class="hljs-comment">// 定义延迟执行的函数</span>
            timeout = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 清空计时器变量</span>
            <span class="hljs-keyword">if</span> (!immediate) func.<span class="hljs-title function_">apply</span>(context, args); <span class="hljs-comment">// 若非立即执行，则调用待防抖函数</span>
        };
        <span class="hljs-keyword">const</span> callNow = immediate &amp;&amp; !timeout; <span class="hljs-comment">// 是否立即调用函数的条件</span>
        <span class="hljs-built_in">clearTimeout</span>(timeout); <span class="hljs-comment">// 清空计时器</span>
        timeout = <span class="hljs-built_in">setTimeout</span>(later, wait); <span class="hljs-comment">// 创建新的计时器，延迟执行函数</span>
        <span class="hljs-keyword">if</span> (callNow) func.<span class="hljs-title function_">apply</span>(context, args); <span class="hljs-comment">// 如果满足立即调用条件，则立即执行函数</span>
    };
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> columWidthStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'columnWidthStore'</span>, {
    <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
        <span class="hljs-attr">columnWidthList</span>: [],
    }),
    <span class="hljs-attr">actions</span>: {
        <span class="hljs-title function_">setColumnList</span>(<span class="hljs-params">record</span>){
            <span class="hljs-keyword">const</span> { routePath,dataIndex,width } = record;
            <span class="hljs-keyword">let</span> routeConfig = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnWidthList</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item.<span class="hljs-property">routePath</span> == routePath);
            <span class="hljs-keyword">if</span>(routeConfig){
                <span class="hljs-keyword">const</span> columnConfig = routeConfig?.<span class="hljs-property">columnList</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item.<span class="hljs-property">dataIndex</span> == dataIndex);
                <span class="hljs-keyword">if</span>(columnConfig){
                    columnConfig.<span class="hljs-property">width</span> = width;
                }<span class="hljs-keyword">else</span>{
                    routeConfig.<span class="hljs-property">columnList</span>.<span class="hljs-title function_">push</span>({dataIndex,width})
                }
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnWidthList</span>.<span class="hljs-title function_">push</span>({
                    routePath,<span class="hljs-attr">columnList</span>:[{dataIndex,width}]
                })
            }

        },
        <span class="hljs-title function_">getRouteColumnWidths</span>(<span class="hljs-params">routePath</span>) {
            <span class="hljs-keyword">const</span> routeConfig = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnWidthList</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item.<span class="hljs-property">routePath</span> == routePath);
            <span class="hljs-keyword">if</span>(!routeConfig)<span class="hljs-keyword">return</span> [];
            <span class="hljs-keyword">return</span> routeConfig.<span class="hljs-property">columnList</span>;
        },
        <span class="hljs-title function_">deleteRouteConfig</span>(<span class="hljs-params">routePath</span>) {
            <span class="hljs-keyword">let</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnWidthList</span>.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span>{<span class="hljs-keyword">return</span> item.<span class="hljs-property">routePath</span> == routePath});
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnWidthList</span>.<span class="hljs-title function_">splice</span>(index,<span class="hljs-number">1</span>);
        },
        <span class="hljs-title function_">deleteAllRoute</span>(<span class="hljs-params"/>){
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnWidthList</span> = []
        }

    },
    <span class="hljs-attr">getters</span>: {

    },
    <span class="hljs-attr">persist</span>: {
        <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// 自定义持久化参数</span>
        <span class="hljs-attr">strategies</span>: [
            {
                <span class="hljs-comment">// 自定义key,默认就是仓库的key</span>
                <span class="hljs-attr">key</span>: <span class="hljs-string">"columWidthStore"</span>,
                <span class="hljs-comment">// 自定义存储方式，默认sessionStorage</span>
                <span class="hljs-attr">storage</span>: <span class="hljs-variable language_">localStorage</span>,
                <span class="hljs-comment">// 指定要持久化的数据，默认所有 state 都会进行缓存，可以通过 paths 指定要持久化的字段，其他的则不会进行持久化。</span>
                <span class="hljs-attr">paths</span>: [
                    <span class="hljs-string">"columnWidthList"</span>,
                ],
            }
        ],
    },
})


</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;
<span class="hljs-keyword">import</span> { deepClone } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../utils/util.js"</span>;
<span class="hljs-keyword">const</span> customTitlesStr = sessionStorage.<span class="hljs-title function_">getItem</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_APP_TBAS_TITLES_KEY</span>)
<span class="hljs-keyword">const</span> customTitles = (customTitlesStr &amp;&amp; <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(customTitlesStr)) || []
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> settingStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'settingStore'</span>, {
    <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
        <span class="hljs-attr">isMobile</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">pageMinHeight</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">tableOrderByName</span>:<span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">tableAscOrDescOrNomal</span>:<span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">menuData</span>: [],
        <span class="hljs-attr">menuList</span>: {},
        <span class="hljs-attr">activeValue</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">activatedFirst</span>: <span class="hljs-literal">undefined</span>,
        customTitles,
    }),
    <span class="hljs-attr">actions</span>: {
        <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isMobile</span> = <span class="hljs-literal">false</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">tableOrderByName</span> = <span class="hljs-literal">undefined</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">tableAscOrDescOrNomal</span> = <span class="hljs-literal">undefined</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">visible</span> = <span class="hljs-literal">false</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageMinHeight</span> = <span class="hljs-number">0</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">menuData</span> = [];
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">menuList</span> = {};
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">activeValue</span> = <span class="hljs-string">''</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">activatedFirst</span> = <span class="hljs-literal">undefined</span>;       
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">customTitles</span> = customTitles;
        },
        <span class="hljs-title function_">setDevice</span>(<span class="hljs-params">state, isMobile</span>) {
            state.<span class="hljs-property">isMobile</span> = isMobile
        },
        <span class="hljs-title function_">setVisible</span>(<span class="hljs-params">state, visible</span>) {
            state.<span class="hljs-property">visible</span> = visible
        },
        <span class="hljs-title function_">setMenuValue</span>(<span class="hljs-params">value</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">menuData</span>.<span class="hljs-title function_">push</span>(value)
        },

    },
    <span class="hljs-attr">getters</span>: {
 
    },
    <span class="hljs-attr">persist</span>: {
        <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// 自定义持久化参数</span>
        <span class="hljs-attr">strategies</span>: [
            {
                <span class="hljs-comment">// 自定义key,默认就是仓库的key</span>
                <span class="hljs-attr">key</span>: <span class="hljs-string">"settingStore"</span>,
                <span class="hljs-comment">// 自定义存储方式，默认sessionStorage</span>
                <span class="hljs-attr">storage</span>: <span class="hljs-variable language_">localStorage</span>,
                <span class="hljs-comment">// 指定要持久化的数据，默认所有 state 都会进行缓存，可以通过 paths 指定要持久化的字段，其他的则不会进行持久化。</span>
                <span class="hljs-attr">paths</span>: [
                    <span class="hljs-string">"menuData"</span>,
                    <span class="hljs-string">"activeValue"</span>,
                    <span class="hljs-string">"menuList"</span>,
                    <span class="hljs-string">"tableOrderByName"</span>,
                    <span class="hljs-string">"tableAscOrDescOrNomal"</span>
                ],
            }
        ],
    },
})

</code></pre>
<p>组件使用:</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">customizeTable</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">"customizeTableRef"</span>
        <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span>
        <span class="hljs-attr">:columns</span>=<span class="hljs-string">"tableColumns"</span>
        <span class="hljs-attr">:pagination</span>=<span class="hljs-string">"pagination"</span>
        <span class="hljs-attr">:data-source</span>=<span class="hljs-string">"dataSource"</span>
        <span class="hljs-attr">:requiredColumns</span>=<span class="hljs-string">"requiredColumns"</span>
        <span class="hljs-attr">:sortTableList</span>=<span class="hljs-string">"sortTableList"</span>
        <span class="hljs-attr">:showColumnSelector</span>=<span class="hljs-string">"showColumnSelector"</span>
        <span class="hljs-attr">:expandedRowKeys</span>=<span class="hljs-string">"expandedRowKeys"</span>
        @<span class="hljs-attr">onChangePage</span>=<span class="hljs-string">"onChangePage"</span>
        @<span class="hljs-attr">closeSelector</span>=<span class="hljs-string">"closeSelector"</span>
        @<span class="hljs-attr">expand</span>=<span class="hljs-string">"handleExpand"</span>
        @<span class="hljs-attr">resetPage</span>=<span class="hljs-string">"resetPage"</span>
        @<span class="hljs-attr">columnResized</span>=<span class="hljs-string">"columnResized"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">header</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: flex;margin-bottom: 10px"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>测试：<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a-input</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:120px;margin-right: 4px"</span> <span class="hljs-attr">v-model:value</span>=<span class="hljs-string">"testValue"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a-input</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a-button</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"testValue = undefined"</span>&gt;</span>清空<span class="hljs-tag">&lt;/<span class="hljs-name">a-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">bodyCell</span>=<span class="hljs-string">"{ text, record, column }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"overFlowColumns.includes(column.dataIndex)"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table-cell"</span>
               <span class="hljs-attr">:data-row-key</span>=<span class="hljs-string">"record.key"</span>
               <span class="hljs-attr">:data-column-key</span>=<span class="hljs-string">"column.dataIndex"</span>
               @<span class="hljs-attr">dblclick</span>=<span class="hljs-string">"handleCellDoubleClick(record, column)"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a-popover</span>  <span class="hljs-attr">placement</span>=<span class="hljs-string">"leftBottom"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"getCellOverflow(column.dataIndex, record.key)"</span> <span class="hljs-attr">:content</span>=<span class="hljs-string">"record[column.dataIndex]"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span> {{ text }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">a-popover</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span>&gt;</span>
              {{ text }}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"column.dataIndex === 'action'"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a-dropdown</span> <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottom"</span> &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ant-dropdown-link"</span> @<span class="hljs-attr">click.prevent</span>&gt;</span>
              操作
            <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">overlay</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">a-menu</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-active-background-color"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a-menu-item</span> &gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">a-button</span>
                      <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
                      @<span class="hljs-attr">click</span>=<span class="hljs-string">"toggleExpand(record.id)"</span>
                      <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 0 4px;"</span>
                  &gt;</span>
                    {{ expandedRowKeys.includes(record.id) ? '收起' : '详情' }}
                  <span class="hljs-tag">&lt;/<span class="hljs-name">a-button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">a-menu-item</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">a-menu</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">a-dropdown</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">expandedRowRender</span>=<span class="hljs-string">"{ record }"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"expanded-style"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a-descriptions</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-10"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"详细信息"</span> <span class="hljs-attr">bordered</span> <span class="hljs-attr">:column</span>=<span class="hljs-string">"2"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a-descriptions-item</span> <span class="hljs-attr">:contentStyle</span>=<span class="hljs-string">"contentColor"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"1"</span>&gt;</span>{{record.one}}<span class="hljs-tag">&lt;/<span class="hljs-name">a-descriptions-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a-descriptions-item</span> <span class="hljs-attr">:contentStyle</span>=<span class="hljs-string">"contentColor"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"2"</span>&gt;</span>{{record.two}}<span class="hljs-tag">&lt;/<span class="hljs-name">a-descriptions-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a-descriptions-item</span> <span class="hljs-attr">:contentStyle</span>=<span class="hljs-string">"contentColor"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"3"</span>&gt;</span>{{record.three}}<span class="hljs-tag">&lt;/<span class="hljs-name">a-descriptions-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a-descriptions-item</span> <span class="hljs-attr">:contentStyle</span>=<span class="hljs-string">"contentColor"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"4"</span>&gt;</span>{{record.four}}<span class="hljs-tag">&lt;/<span class="hljs-name">a-descriptions-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a-descriptions-item</span> <span class="hljs-attr">:contentStyle</span>=<span class="hljs-string">"contentColor"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"5"</span>&gt;</span>{{record.five}}<span class="hljs-tag">&lt;/<span class="hljs-name">a-descriptions-item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a-descriptions-item</span> <span class="hljs-attr">:contentStyle</span>=<span class="hljs-string">"contentColor"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"6"</span> &gt;</span>{{record.six}}<span class="hljs-tag">&lt;/<span class="hljs-name">a-descriptions-item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">a-descriptions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">customizeTable</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted,  ref} <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> {columWidthStore} <span class="hljs-keyword">from</span> <span class="hljs-string">"../src/store/index.js"</span>;
<span class="hljs-keyword">import</span> customizeTable <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/CustomizeTable/index.vue'</span>
<span class="hljs-keyword">import</span> {useRoute} <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-router"</span>;
<span class="hljs-keyword">import</span> {copyToClipboard} <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/util.js'</span>
<span class="hljs-keyword">let</span> route = <span class="hljs-title function_">useRoute</span>();
<span class="hljs-keyword">let</span> customizeTableRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">let</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">let</span> testValue = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">let</span> contentColor = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">backgroundColor</span>:<span class="hljs-string">'#fff'</span>
});
<span class="hljs-keyword">let</span> tableColumns = <span class="hljs-title function_">ref</span>([
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"序号"</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">"no"</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">46</span>,
    <span class="hljs-attr">fixed</span>:<span class="hljs-string">'left'</span>,
    <span class="hljs-attr">customRender</span>: <span class="hljs-function">(<span class="hljs-params">{index}</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>`</span>,
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"1"</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">"one"</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">key</span>:<span class="hljs-string">'one'</span>,
    <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">ellipsis</span>:<span class="hljs-literal">true</span>,
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"2"</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">"two"</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">key</span>:<span class="hljs-string">'one'</span>,
    <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">ellipsis</span>:<span class="hljs-literal">true</span>,
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"3"</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">"three"</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">key</span>:<span class="hljs-string">'one'</span>,
    <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">ellipsis</span>:<span class="hljs-literal">true</span>,
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"4"</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">"four"</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">key</span>:<span class="hljs-string">'one'</span>,
    <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">ellipsis</span>:<span class="hljs-literal">true</span>,
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"5"</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">"five"</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">key</span>:<span class="hljs-string">'one'</span>,
    <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">ellipsis</span>:<span class="hljs-literal">true</span>,
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"6"</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">"six"</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">key</span>:<span class="hljs-string">'one'</span>,
    <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">ellipsis</span>:<span class="hljs-literal">true</span>,
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"操作"</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">"action"</span>,
    <span class="hljs-attr">fixed</span>:<span class="hljs-string">'right'</span>,
    <span class="hljs-attr">key</span>:<span class="hljs-string">'action'</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>,
  },
])
<span class="hljs-keyword">let</span> overFlowColumns = tableColumns.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span>![<span class="hljs-string">'no'</span>,<span class="hljs-string">'action'</span>].<span class="hljs-title function_">includes</span>(item.<span class="hljs-property">dataIndex</span>)).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>)=&gt;</span>item.<span class="hljs-property">dataIndex</span>);
<span class="hljs-keyword">let</span> dataSource = <span class="hljs-title function_">ref</span>([
  {<span class="hljs-attr">one</span>:<span class="hljs-string">'111'</span>,<span class="hljs-attr">two</span>:<span class="hljs-string">'2222'</span>,<span class="hljs-attr">three</span>:<span class="hljs-string">'333'</span>,<span class="hljs-attr">four</span>:<span class="hljs-string">'444444444444444444444444444444444444444'</span>,<span class="hljs-attr">five</span>:<span class="hljs-string">'555'</span>,<span class="hljs-attr">six</span>:<span class="hljs-string">'666'</span>,<span class="hljs-attr">id</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">key</span>:<span class="hljs-number">1111</span>}
])
<span class="hljs-keyword">const</span> pagination = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span>,
  <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-string">"default"</span>,
});
<span class="hljs-keyword">let</span> requiredColumns = <span class="hljs-title function_">ref</span>([<span class="hljs-string">'no'</span>,<span class="hljs-string">'one'</span>,<span class="hljs-string">'two'</span>])
<span class="hljs-keyword">let</span> sortTableList = <span class="hljs-title function_">ref</span>([<span class="hljs-string">'one'</span>,<span class="hljs-string">'two'</span>,<span class="hljs-string">'three'</span>])
<span class="hljs-keyword">let</span> showColumnSelector = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCellDoubleClick</span>(<span class="hljs-params">record, column</span>) {
  <span class="hljs-keyword">const</span> text = record[column.<span class="hljs-property">dataIndex</span>];
  <span class="hljs-title function_">copyToClipboard</span>(text);
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onChangePage</span> = (<span class="hljs-params">data</span>) =&gt; {
  pagination.<span class="hljs-property">value</span>.<span class="hljs-property">page</span> = data;
  <span class="hljs-comment">// getList();</span>
};
<span class="hljs-keyword">const</span> <span class="hljs-title function_">resetPage</span>=(<span class="hljs-params"/>)=&gt;{
  pagination.<span class="hljs-property">value</span>.<span class="hljs-property">page</span> = <span class="hljs-number">1</span>;
  <span class="hljs-comment">// getList();</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">closeSelector</span>=(<span class="hljs-params"/>)=&gt;{
  showColumnSelector.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">/* 表格详情展开关闭 start */</span>
<span class="hljs-comment">// 添加展开行的状态管理</span>
<span class="hljs-keyword">let</span> expandedRowKeys = <span class="hljs-title function_">ref</span>([]);
<span class="hljs-comment">// 切换展开状态的方法</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleExpand</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-keyword">const</span> index = expandedRowKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">indexOf</span>(id);
  <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 如果已经展开，则关闭</span>
    expandedRowKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 如果未展开，则展开并关闭其他已展开的行</span>
    expandedRowKeys.<span class="hljs-property">value</span> = [id];
  }
};
<span class="hljs-comment">// 处理表格展开事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleExpand</span> = (<span class="hljs-params">expanded, record</span>) =&gt; {
  <span class="hljs-keyword">if</span> (expanded) {
    <span class="hljs-comment">// 展开时关闭其他行</span>
    expandedRowKeys.<span class="hljs-property">value</span> = [record.<span class="hljs-property">id</span>];
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 收起时移除</span>
    <span class="hljs-keyword">const</span> index = expandedRowKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">indexOf</span>(record.<span class="hljs-property">id</span>);
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      expandedRowKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
    }
  }
};
<span class="hljs-comment">/* 表格详情展开关闭 end */</span>

<span class="hljs-keyword">const</span> columStore = <span class="hljs-title function_">columWidthStore</span>();
<span class="hljs-keyword">const</span> <span class="hljs-title function_">columnResized</span>=(<span class="hljs-params">record</span>)=&gt;{
  columStore.<span class="hljs-title function_">setColumnList</span>({
    <span class="hljs-attr">routePath</span>: record.<span class="hljs-property">routePath</span>,
    <span class="hljs-attr">dataIndex</span>: record.<span class="hljs-property">dataIndex</span>,
    <span class="hljs-attr">width</span>: record.<span class="hljs-property">width</span>,
  });

}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initColumnWidth</span>=(<span class="hljs-params"/>)=&gt;{
  <span class="hljs-keyword">let</span> temp = columStore.<span class="hljs-title function_">getRouteColumnWidths</span>(route?.<span class="hljs-property">path</span>)
  <span class="hljs-keyword">if</span>(temp?.<span class="hljs-property">length</span>){
    tableColumns.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">el</span>)=&gt;</span>{
      <span class="hljs-keyword">let</span> index = temp.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">item</span>=&gt;</span>item.<span class="hljs-property">dataIndex</span> == el.<span class="hljs-property">dataIndex</span>);
      <span class="hljs-keyword">if</span>(index&gt;=<span class="hljs-number">0</span>)el.<span class="hljs-property">width</span> = temp[index].<span class="hljs-property">width</span>;
    })
  }
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getCellOverflow</span> = (<span class="hljs-params">columnKey, rowKey</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!customizeTableRef.<span class="hljs-property">value</span>?.<span class="hljs-property">isOverflow</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'无法访问子组件的 isOverflow 方法'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> customizeTableRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">isOverflow</span>(columnKey, rowKey);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'调用 isOverflow 方法出错:'</span>, error);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
};
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">()=&gt;</span>{
  <span class="hljs-title function_">initColumnWidth</span>();
})

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.table-cell</span> {
  <span class="hljs-attribute">white-space</span>: nowrap;
  <span class="hljs-attribute">text-overflow</span>: ellipsis;
  <span class="hljs-attribute">overflow</span>: hidden;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>


</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e65d39b4a6734a2f9d9e1d70992daffc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G85aSP5peg5YaV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770096384&amp;x-signature=sFLI%2FNMHP0S273PC8gUCR9SjwT0%3D" alt="GIF 2026-1-27 11-27-26.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零打造 AI 全栈应用（五）：Post List 背后的前后端解耦与 Mock 工程化实践]]></title>    <link>https://juejin.cn/post/7599640782569472027</link>    <guid>https://juejin.cn/post/7599640782569472027</guid>    <pubDate>2026-01-27T05:28:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782569472027" data-draft-id="7599640782569455643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零打造 AI 全栈应用（五）：Post List 背后的前后端解耦与 Mock 工程化实践"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T05:28:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="白兰地空瓶"/> <meta itemprop="url" content="https://juejin.cn/user/191753514127514"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零打造 AI 全栈应用（五）：Post List 背后的前后端解耦与 Mock 工程化实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/191753514127514/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    白兰地空瓶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T05:28:59.000Z" title="Tue Jan 27 2026 05:28:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在上一篇<a href="https://juejin.cn/post/7599601258640293926" target="_blank" title="https://juejin.cn/post/7599601258640293926">《从零打造 AI 全栈应用（四）：别小看幻灯片，一个 Carousel 组件背后的工程化与性能思维一、为什么一个幻灯片组件》</a> 中，我们通过一个轮播组件，拆解了<strong>组件状态、插件模式与性能取舍</strong>。</p>
<p>这一篇，我们把视角从「组件内部」拉回到「页面级数据流」，聊一个在真实项目中<strong>几乎绕不开的问题</strong>：</p>
<p><strong>前端页面的数据，到底该怎么来？</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、Post List 是 UI 问题，还是数据问题？</h2>
<p>在很多博客 / 社区 / AI 内容产品中，都会有一个核心页面：</p>
<blockquote>
<p><strong>文章列表（Post List）</strong></p>
</blockquote>
<p>表面上它是一个 UI：</p>
<ul>
<li>卡片列表</li>
<li>分页</li>
<li>点赞数 / 评论数 / 标签</li>
</ul>
<p>但工程上，它首先是一个<strong>数据协作问题</strong>：</p>
<ul>
<li>数据来自哪里？</li>
<li>前端要不要等后端？</li>
<li>后端接口没好，页面怎么办？</li>
</ul>
<p>如果这几个问题想不清楚，项目一定会出现：</p>
<ul>
<li>前端被后端接口卡进度</li>
<li>大量 <code>if (data)</code> 防御式代码</li>
<li>开发阶段和线上环境差异巨大</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、前后端分离的核心前提：<strong>前端不能等后端</strong></h2>
<p>很多同学嘴上说前后端分离，但心智模型还是：</p>
<blockquote>
<p>「等后端接口写好，我再写页面」</p>
</blockquote>
<p>这是<strong>不成立的</strong>。</p>
<p>真正的前后端分离，意味着：</p>
<ul>
<li>前端可以<strong>独立完成页面与交互</strong></li>
<li>后端只要<strong>遵守接口契约</strong>即可无缝接入</li>
</ul>
<p>而这个“契约”，就是 —— <strong>API 接口文档</strong>。</p>
<hr/>
<h2 data-id="heading-2">三、先定义接口，而不是先写代码</h2>
<p>以 Post List 为例，我们先约定接口形态：</p>
<pre><code class="hljs language-bash" lang="bash">GET /api/posts?page=1&amp;<span class="hljs-built_in">limit</span>=10
</code></pre>
<p>返回结构：</p>
<pre><code class="hljs language-css" lang="css">{
  "<span class="hljs-selector-tag">code</span>": <span class="hljs-number">200</span>,
  <span class="hljs-string">"items"</span>: Post[],
  <span class="hljs-string">"pagination"</span>: {
    "current": <span class="hljs-number">1</span>,
    <span class="hljs-string">"limit"</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">"total"</span>: <span class="hljs-number">45</span>,
    <span class="hljs-string">"totalPage"</span>: <span class="hljs-number">5</span>
  }
}
</code></pre>
<p>注意这里的几个工程化点：</p>
<ul>
<li><strong>分页信息由后端返回</strong>，不是前端猜</li>
<li>字段命名稳定，不夹杂 UI 语义</li>
<li>返回结构对 mock / 真接口完全一致</li>
</ul>
<blockquote>
<p>只要这个结构不变，<br/>
<strong>前端切换真实后端地址是无感的</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">四、Mock 的工程意义，而不是“假数据”</h2>
<p>很多人一听 mock，就觉得是：</p>
<blockquote>
<p>随便造点数据糊页面</p>
</blockquote>
<p>这是对 mock 的严重低估。</p>
<p>在工程中，mock 的作用是：</p>
<ul>
<li>解耦前后端开发节奏</li>
<li>固化接口结构</li>
<li>提前暴露分页 / 边界问题</li>
<li>让前端在<strong>真实请求语义下开发</strong></li>
</ul>
<hr/>
<h2 data-id="heading-4">五、Vite + vite-plugin-mock：最小成本接入</h2>
<pre><code class="hljs language-css" lang="css">pnpm <span class="hljs-selector-tag">i</span> vite-plugin-mock -D
</code></pre>
<p>它的优势在于：</p>
<ul>
<li>与 Vite 深度集成</li>
<li>开发环境自动启用</li>
<li>不侵入业务代码</li>
</ul>
<blockquote>
<p>上线前只需要切换 baseURL，<br/>
mock 即可完全下线。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">六、Post Mock 的核心不是数据，而是「逻辑完整度」</h2>
<h3 data-id="heading-6">1️⃣ 使用 Mock.js 构造真实数据结构</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">posts</span> = Mock.<span class="hljs-title function_ invoke__">mock</span>({
  <span class="hljs-string">'list|45'</span>: [{
    <span class="hljs-attr">title</span>: <span class="hljs-string">'@ctitle(8, 20)'</span>,
    <span class="hljs-attr">brief</span>: <span class="hljs-string">'@ctitle(20,100)'</span>,
    <span class="hljs-attr">totalComment</span>: <span class="hljs-string">'@integer(0, 30)'</span>,
    <span class="hljs-attr">totalLikes</span>: <span class="hljs-string">'@integer(0, 500)'</span>,
    <span class="hljs-attr">publishedAt</span>: <span class="hljs-string">'@datetime("yyyy-MM-dd HH:mm")'</span>,
    <span class="hljs-attr">user</span>: {
      <span class="hljs-attr">id</span>: <span class="hljs-string">'@integer(1, 10)'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'@cname(2, 4)'</span>,
      <span class="hljs-attr">avatar</span>: <span class="hljs-string">'@image(300x200)'</span>
    },
    <span class="hljs-attr">tags</span>: () =&gt; Mock.Random.<span class="hljs-title function_ invoke__">pick</span>(tags, <span class="hljs-number">2</span>),
    thumbnail: <span class="hljs-string">'@image(300x200)'</span>,
    id: <span class="hljs-string">'@increment(1)'</span>
  }]
}).<span class="hljs-keyword">list</span>;
</code></pre>
<p>重点不在“随机”，而在：</p>
<ul>
<li>字段类型是否稳定</li>
<li>嵌套结构是否真实</li>
<li>是否足够支撑 UI 复杂度</li>
</ul>
<hr/>
<h3 data-id="heading-7">2️⃣ 分页逻辑必须和真实后端一致</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">currentPage</span> = parseInt(page, <span class="hljs-number">10</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">size</span> = parseInt(limit, <span class="hljs-number">10</span>)<span class="hljs-comment">;</span>

const <span class="hljs-attr">start</span> = (currentPage - <span class="hljs-number">1</span>) * size<span class="hljs-comment">;</span>
const <span class="hljs-attr">end</span> = start + size<span class="hljs-comment">;</span>
const <span class="hljs-attr">paginatedData</span> = posts.slice(start, end)<span class="hljs-comment">;</span>
</code></pre>
<p>以及返回的 pagination：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">pagination:</span> {
  <span class="hljs-attr">current:</span> <span class="hljs-string">currentPage</span>,
  <span class="hljs-attr">limit:</span> <span class="hljs-string">size</span>,
  <span class="hljs-string">total</span>,
  <span class="hljs-attr">totalPage:</span> <span class="hljs-string">Math.ceil(total</span> <span class="hljs-string">/</span> <span class="hljs-string">size)</span>
}
</code></pre>
<blockquote>
<p>如果 mock 不做分页，<br/>
那前端分页逻辑一定会在真接口时翻车。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">七、Axios：前端的“数据适配层”</h2>
<p>前端通过 axios 请求接口，本质上并不关心：</p>
<ul>
<li>数据是真是假</li>
<li>接口来自 mock 还是真后端</li>
</ul>
<p>它只关心：</p>
<ul>
<li>返回结构是否符合约定</li>
<li>错误码是否可控</li>
</ul>
<p>这也是为什么：</p>
<blockquote>
<p><strong>mock 必须 100% 模拟真实接口语义</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">八、顺带一提：Auth Mock 是怎么服务页面的？</h2>
<p>登录 mock 使用 JWT：</p>
<ul>
<li><code>login</code>：签发 token</li>
<li><code>check</code>：验证 token</li>
</ul>
<p>这带来的好处是：</p>
<ul>
<li>前端可以完整开发登录态逻辑</li>
<li>请求拦截器、权限判断全部可写</li>
<li>不等真实用户系统</li>
</ul>
<hr/>
<h2 data-id="heading-10">九、回到工程视角：这一篇你真正学到什么？</h2>
<p>通过一个 Post List，你应该能讲清楚：</p>
<ul>
<li>什么是“前端不能等后端”</li>
<li>mock 在工程中的真实价值</li>
<li>分页为什么必须由接口驱动</li>
<li>如何设计一个可无缝切换的 API 层</li>
</ul>
<blockquote>
<p>面试官真正关心的不是你会不会用 mock，<br/>
而是你<strong>是否具备前后端协作的工程意识</strong>。</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零打造 AI 全栈应用（四）：别小看幻灯片，一个 Carousel 组件背后的工程化与性能思维]]></title>    <link>https://juejin.cn/post/7599601258640293926</link>    <guid>https://juejin.cn/post/7599601258640293926</guid>    <pubDate>2026-01-27T04:44:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599601258640293926" data-draft-id="7599604510366416934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零打造 AI 全栈应用（四）：别小看幻灯片，一个 Carousel 组件背后的工程化与性能思维"/> <meta itemprop="keywords" content="全栈,React.js"/> <meta itemprop="datePublished" content="2026-01-27T04:44:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="白兰地空瓶"/> <meta itemprop="url" content="https://juejin.cn/user/191753514127514"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零打造 AI 全栈应用（四）：别小看幻灯片，一个 Carousel 组件背后的工程化与性能思维
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/191753514127514/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    白兰地空瓶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:44:03.000Z" title="Tue Jan 27 2026 04:44:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在上一篇文章 <a href="https://juejin.cn/post/7598021313870053382" target="_blank" title="https://juejin.cn/post/7598021313870053382">《从零打造 AI 全栈应用（三）：一个 BackToTop 组件背后的工程化与性能思维》</a>中，我们拆解了一个<strong>看似简单却极易被忽视的组件</strong>，并通过它讨论了事件监听、性能优化与工程边界的问题。</p>
<p>但真实项目中，<strong>工程能力往往体现在细节</strong>。</p>
<p>这篇文章，我们从一个再常见不过的组件 —— <strong>幻灯片 / Carousel</strong> 入手，聊聊它背后隐藏的组件设计、状态管理、性能优化和工程化取舍。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、为什么一个幻灯片组件值得单独写一篇？</h2>
<p>很多同学会觉得：</p>
<blockquote>
<p>幻灯片不就是个 UI 组件吗？能滑就行。</p>
</blockquote>
<p>但在真实项目（尤其是首页、活动页、AI 产品的内容入口）中，它往往意味着：</p>
<ul>
<li>页面<strong>首屏核心组件</strong></li>
<li>高频渲染、长时间驻留</li>
<li>涉及自动播放、交互、状态同步</li>
<li>很容易成为<strong>性能与可维护性的隐患</strong></li>
</ul>
<p>所以我们这次的目标不是「写一个能跑的轮播图」，而是：</p>
<blockquote>
<p><strong>写一个工程上站得住脚的 Carousel 组件</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、技术选型：为什么是 shadcn/ui + Embla？</h2>
<h3 data-id="heading-2">1️⃣ shadcn/ui 的 Carousel 设计哲学</h3>
<p>shadcn/ui 提供的并不是一个“黑盒组件”，而是一组<strong>组合式组件</strong>：</p>
<ul>
<li><code>Carousel</code></li>
<li><code>CarouselContent</code></li>
<li><code>CarouselItem</code></li>
</ul>
<p>特点很明显：</p>
<ul>
<li>结构清晰，层次分明</li>
<li>不强绑定样式</li>
<li>底层基于 <strong>Embla Carousel</strong>，性能成熟</li>
</ul>
<blockquote>
<p>本质上，它更像是一个“轮播能力的外壳”，而不是一个定死的 UI。</p>
</blockquote>
<p>这点非常重要 —— <strong>可定制性 = 长期可维护性</strong>。</p>
<hr/>
<h3 data-id="heading-3">2️⃣ 自动播放为什么用插件，而不是自己写 <code>setInterval</code>？</h3>
<p>自动播放我们选择的是：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoPlay</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'embla-carousel-autoplay'</span>
</code></pre>
<p>原因很简单：</p>
<ul>
<li>和 Embla API 深度适配</li>
<li>内部处理了生命周期、交互中断</li>
<li>不需要自己处理定时器清理</li>
</ul>
<blockquote>
<p>工程中一个重要原则：<br/>
<strong>能用成熟插件解决的，不要重复造轮子</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">三、组件设计：从 Props 到职责边界</h2>
<h3 data-id="heading-5">1️⃣ 数据结构设计</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SlideData</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">image</span>: <span class="hljs-built_in">string</span>;
  title?: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p>几个刻意的设计点：</p>
<ul>
<li><code>id</code> 不强制 number，兼容服务端数据</li>
<li><code>title</code> 可选，UI 自动适配</li>
<li>组件只关心<strong>展示所需的最小数据</strong></li>
</ul>
<blockquote>
<p>不要把组件变成业务垃圾桶。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">2️⃣ 组件 Props：只暴露真正需要的能力</h3>
<pre><code class="hljs language-ini" lang="ini">interface SlideShowProps {
  slides: SlideData<span class="hljs-section">[]</span><span class="hljs-comment">;</span>
  autoPlay?: boolean<span class="hljs-comment">;</span>
  autoPlayDelay?: number<span class="hljs-comment">;</span>
}
</code></pre>
<p>这里没有：</p>
<ul>
<li>当前 index 的受控状态</li>
<li>复杂回调</li>
</ul>
<p>原因是：</p>
<blockquote>
<p><strong>这是一个偏展示型组件，而不是业务中枢</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">四、状态管理：selectedIndex 为什么是私有状态？</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> [selectedIndex, setSelectedIndex] = useState&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> [api, setApi] = useState&lt;<span class="hljs-title class_">CarouselApi</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
</code></pre>
<h3 data-id="heading-8">关键点：</h3>
<ul>
<li><code>selectedIndex</code> 不从外部传入</li>
<li>通过 <code>CarouselApi</code> 与底层同步</li>
</ul>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(() =&gt; {
  if (!api) return;
  <span class="hljs-built_in">setSelectedIndex</span>(api.selectedScrollSnap());

  const onSelect = () =&gt; {
    <span class="hljs-built_in">setSelectedIndex</span>(api.selectedScrollSnap());
  };

  api<span class="hljs-selector-class">.on</span>('select', onSelect);
  return () =&gt; api<span class="hljs-selector-class">.off</span>('select', onSelect);
}, <span class="hljs-selector-attr">[api]</span>);
</code></pre>
<h3 data-id="heading-9">这段代码的工程意义：</h3>
<ul>
<li>UI 状态 <strong>来源单一</strong>（底层 carousel）</li>
<li>React 状态只是一个映射</li>
<li>避免“双向状态不同步”</li>
</ul>
<blockquote>
<p>面试常考：<strong>如何避免状态源混乱？</strong><br/>
这个例子非常典型。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">五、自动播放：为什么一定要用 <code>useRef</code>？</h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">plugin</span> = <span class="hljs-title function_ invoke__">useRef</span>(
  autoPlay
    ? <span class="hljs-title function_ invoke__">AutoPlay</span>({ <span class="hljs-attr">delay</span>: autoPlayDelay, <span class="hljs-attr">stopOnInteraction</span>: <span class="hljs-literal">true</span> })
    : <span class="hljs-literal">null</span>
);
</code></pre>
<h3 data-id="heading-11">如果不用 <code>useRef</code> 会发生什么？</h3>
<ul>
<li>每次 render 都创建新插件实例</li>
<li>自动播放被反复重置</li>
<li>性能抖动、行为不可控</li>
</ul>
<h3 data-id="heading-12">useRef 的本质价值：</h3>
<blockquote>
<p><strong>在 React 渲染体系外，持久化一个可变对象</strong>。</p>
</blockquote>
<p>这是一个非常典型、非常“面试级别”的用法。</p>
<hr/>
<h2 data-id="heading-13">六、交互细节：为什么鼠标移入要暂停？</h2>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">onMouseEnter</span>={() =&gt; plugin.current?.stop()}
<span class="hljs-attr">onMouseLeave</span>={() =&gt; plugin.current?.reset()}
</code></pre>
<p>这是一个看似很小，但体验影响极大的细节：</p>
<ul>
<li>用户正在看内容</li>
<li>自动切走 = 强干扰</li>
</ul>
<blockquote>
<p>好的组件，不是功能多，而是<strong>尊重用户行为</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">七、指示点设计：状态驱动，而不是 DOM 操作</h2>
<pre><code class="hljs language-ini" lang="ini">slides.map((_, i) =&gt; (
  &lt;button
    <span class="hljs-attr">key</span>={i}
    <span class="hljs-attr">className</span>={`h-<span class="hljs-number">2</span> w-<span class="hljs-number">2</span> rounded-full transition-all
      ${<span class="hljs-attr">selectedIndex</span> === i ? <span class="hljs-string">'bg-white w-6'</span> : <span class="hljs-string">'bg-white/50'</span>}`}
  /&gt;
))<span class="hljs-comment">;</span>
</code></pre>
<p>几个工程要点：</p>
<ul>
<li>循环渲染，不操作 DOM</li>
<li>动态类名完全由状态驱动</li>
<li><code>transition-all</code> 提供平滑过渡</li>
</ul>
<blockquote>
<p>React 组件的本质：<br/>
<strong>UI = f(state)</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-15">八、CSS 与性能：渐变背景为什么优于图片？</h2>
<pre><code class="hljs language-css" lang="css">bg-gradient-<span class="hljs-selector-tag">to</span>-t <span class="hljs-selector-tag">from</span>-black/<span class="hljs-number">60</span> <span class="hljs-selector-tag">to</span>-transparent
</code></pre>
<p>相比图片背景，渐变的优势：</p>
<ul>
<li>不需要额外 HTTP 请求</li>
<li>减少并发资源下载</li>
<li>GPU 友好</li>
<li>更容易适配深浅色</li>
</ul>
<blockquote>
<p>在高性能场景下，<br/>
<strong>能不用图片，就不用图片</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-16">九、总结：一个小组件，体现哪些工程能力？</h2>
<p>回看这个 Carousel，你至少可以聊清楚：</p>
<ul>
<li>组件拆分与职责边界</li>
<li>第三方库的正确使用方式</li>
<li>React 状态与外部状态同步</li>
<li><code>useRef</code> 的真实应用场景</li>
<li>UI 细节与性能取舍</li>
</ul>
<blockquote>
<p>面试官真正想看的，不是你会不会写轮播图，<br/>
而是你<strong>为什么这么写</strong>。</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【车载Android】多媒体开发入门（下）- 音频焦点]]></title>    <link>https://juejin.cn/post/7599565587154206746</link>    <guid>https://juejin.cn/post/7599565587154206746</guid>    <pubDate>2026-01-27T05:02:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599565587154206746" data-draft-id="7593258683751252002" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【车载Android】多媒体开发入门（下）- 音频焦点"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-27T05:02:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林栩link"/> <meta itemprop="url" content="https://juejin.cn/user/870468939434039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【车载Android】多媒体开发入门（下）- 音频焦点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/870468939434039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林栩link
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T05:02:27.000Z" title="Tue Jan 27 2026 05:02:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>想象一下这个场景</strong>：你正开着车，点开媒体中心听着音乐；突然电话铃声大作，屏幕弹出来电提醒；紧接着导航又大声喊出“前方左转”——而你的音乐却依然我行我素地轰鸣着…… 这无疑是一场听觉灾难！</p>
</blockquote>
<p>在 Android 这个多任务操作系统中，为了避免多个应用同时“吵架”，系统引入了一套协作机制：<strong>音频焦点（Audio Focus）</strong> 。作为开发者，能否优雅地申请、响应和释放音频焦点，是衡量一个多媒体应用是否成熟的关键指标。</p>
<p><a href="https://juejin.cn/post/7591407298414247942" target="_blank" title="https://juejin.cn/post/7591407298414247942">【车载Android】多媒体开发入门（上）- MediaSession</a></p>
<p>【车载Android】多媒体开发入门（下）- 音频焦点</p>
<hr/>
<h2 data-id="heading-0">一、什么是音频焦点？</h2>
<p>音频焦点并非强制性的“独占锁”，而更像一套<strong>应用间的“君子协定”</strong> ：</p>
<ul>
<li>
<p><strong>核心原则</strong>：同一时间，通常只有一个应用持有“长时焦点”并主导音频输出。</p>
</li>
<li>
<p><strong>运作方式</strong>：</p>
<ul>
<li>当你的应用需要播放声音时，应主动向系统<strong>申请焦点</strong>；</li>
<li>当系统因更高优先级事件（如来电、闹钟、导航）需要焦点时，会<strong>通知你</strong>；</li>
<li>你需根据通知类型，<strong>暂停播放</strong>或<strong>降低音量（Duck）</strong> ，以配合全局音频体验。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、传统方式：手动管理音频焦点（Media3 之前）</h2>
<p>如果你的应用尚未采用 Jetpack Media3 框架，则需手动处理焦点申请与监听。</p>
<h3 data-id="heading-2">1. 明确播放意图：设置 AudioAttributes</h3>
<p>在申请焦点前，必须先声明音频的<strong>用途（Usage）</strong> 和<strong>内容类型（Content Type）</strong> ：</p>
<pre><code class="hljs language-scss" lang="scss">val audioAttributes = AudioAttributes<span class="hljs-selector-class">.Builder</span>()
    <span class="hljs-selector-class">.setUsage</span>(AudioAttributes.USAGE_MEDIA)        <span class="hljs-comment">// 用途：媒体播放</span>
    <span class="hljs-selector-class">.setContentType</span>(AudioAttributes.CONTENT_TYPE_MUSIC) <span class="hljs-comment">// 类型：音乐</span>
    <span class="hljs-selector-class">.build</span>()
</code></pre>
<blockquote>
<p><strong>Usage 决定系统如何路由声音</strong>（扬声器/蓝牙/听筒）和<strong>音量键控制哪个流</strong>（媒体音量 vs 通话音量）。 <strong>Content Type 影响底层音效处理</strong>（如人声增强、环绕声等）。</p>
</blockquote>
<h3 data-id="heading-3">2. 申请与释放焦点</h3>






























<table><thead><tr><th>焦点类型</th><th>对应参数</th><th>使用场景</th></tr></thead><tbody><tr><td>长焦点 (Gain)</td><td>AUDIOFOCUS_GAIN</td><td>音乐播放器、播客、长视频。</td></tr><tr><td>瞬时焦点 (Transient)</td><td>AUDIOFOCUS_GAIN_TRANSIENT</td><td>导航播报、短信提示音。</td></tr><tr><td>瞬时损耗降低音量 (Duck)</td><td>AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK</td><td>简单的通知音，希望背景音乐压低音量但不停止。</td></tr><tr><td>独占焦点</td><td>AUDIOFOCUS_GAIN_TRANSIENT_EXCLUSIVE</td><td>录音机、语音助手，不希望被任何声音干扰。</td></tr></tbody></table>
<h4 data-id="heading-4">Android 8.0+（推荐方式）：</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> audioFocusRequest: AudioFocusRequest? = <span class="hljs-literal">null</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestAudioFocus</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">val</span> request = AudioFocusRequest.Builder(AudioManager.AUDIOFOCUS_GAIN)
        .setAudioAttributes(audioAttributes)
        .setWillPauseWhenDucked(<span class="hljs-literal">true</span>) <span class="hljs-comment">// 表示愿意在 duck 时暂停</span>
        .setOnAudioFocusChangeListener(audioFocusChangeListener)
        .build()

    audioFocusRequest = request
    <span class="hljs-keyword">val</span> result = audioManager.requestAudioFocus(request)
    <span class="hljs-keyword">return</span> result == AudioManager.AUDIOFOCUS_REQUEST_GRANTED
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">abandonAudioFocus</span><span class="hljs-params">()</span></span> {
    audioFocusRequest?.let { audioManager.abandonAudioFocusRequest(it) }
}
</code></pre>
<h4 data-id="heading-5">兼容旧版本（API &lt; 26）：</h4>
<p>使用已弃用的 <code>requestAudioFocus(listener, streamType, durationHint)</code> 方法，现在的车载应用已经用不上了。</p>
<h3 data-id="heading-6">3. 监听焦点变化并响应</h3>
<p>无论新旧 API，都必须实现 <code>OnAudioFocusChangeListener</code>，并根据不同的 <code>focusChange</code> 采取相应措施：</p>








































<table><thead><tr><th>焦点变化类型</th><th>常量</th><th>触发场景示例</th><th>建议行为</th><th>是否可恢复</th></tr></thead><tbody><tr><td>永久失去焦点</td><td>AUDIOFOCUS_LOSS</td><td>用户打开其他音乐 App 并开始播放</td><td>立即停止播放，释放 MediaPlayer 等资源</td><td>通常不会自动恢复；需用户主动切回你的 App</td></tr><tr><td>暂时失去焦点</td><td>AUDIOFOCUS_LOSS_TRANSIENT</td><td>来电、闹钟响起、语音助手唤醒（如“Hey 小度”）</td><td>暂停播放，保持资源（不释放 MediaPlayer）</td><td>预期很快恢复（如通话结束），收到 AUDIOFOCUS_GAIN 后恢复播放</td></tr><tr><td>可降低音量继续播放</td><td>AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK</td><td>导航语音提示、系统提示音</td><td>不暂停，但将音量临时降低（如降至 20%）</td><td>焦点很快归还，收到 AUDIOFOCUS_GAIN 后恢复原音量</td></tr><tr><td>重新获得焦点</td><td>AUDIOFOCUS_GAIN</td><td>干扰结束</td><td>继续播放并恢复音量</td><td>N/A</td></tr></tbody></table>
<pre><code class="hljs language-scss" lang="scss">private val audioFocusChangeListener = AudioManager<span class="hljs-selector-class">.OnAudioFocusChangeListener</span> { focusChange -&gt;
    when (focusChange) {
        AudioManager<span class="hljs-selector-class">.AUDIOFOCUS_LOSS</span> -&gt; <span class="hljs-built_in">pauseOrStopPlayback</span>()
        AudioManager<span class="hljs-selector-class">.AUDIOFOCUS_LOSS_TRANSIENT</span> -&gt; <span class="hljs-built_in">pausePlayback</span>()
        AudioManager<span class="hljs-selector-class">.AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK</span> -&gt; <span class="hljs-built_in">lowerVolume</span>()
        AudioManager<span class="hljs-selector-class">.AUDIOFOCUS_GAIN</span> -&gt; <span class="hljs-built_in">resumePlayback</span>()
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-7">三、现代方案：Media3 自动管理音频焦点</h2>
<p>Jetpack <strong>Media3</strong>（ExoPlayer 的新一代框架）极大简化了焦点管理，<strong>几乎无需写任何音频焦点代码</strong>！</p>
<h3 data-id="heading-8">1. 开启自动焦点管理</h3>
<p>只需在初始化 <code>ExoPlayer</code> 时传入 <code>AudioAttributes</code> 并启用自动管理：</p>
<pre><code class="hljs language-scss" lang="scss">val audioAttributes = AudioAttributes<span class="hljs-selector-class">.Builder</span>()
    <span class="hljs-selector-class">.setUsage</span>(C.USAGE_MEDIA)
    <span class="hljs-selector-class">.setContentType</span>(C.CONTENT_TYPE_MUSIC)
    <span class="hljs-selector-class">.build</span>()

val player = ExoPlayer<span class="hljs-selector-class">.Builder</span>(context)
    <span class="hljs-selector-class">.setAudioAttributes</span>(audioAttributes, /* handleAudioFocus= */ true) <span class="hljs-comment">// 关键！</span>
    <span class="hljs-selector-class">.build</span>()
</code></pre>
<p><strong>开启后，ExoPlayer 会自动</strong>：</p>
<ul>
<li>播放时申请焦点；</li>
<li>来电时自动暂停；</li>
<li>电话挂断后自动恢复；</li>
<li>导航提示时自动 Duck（降音量）；</li>
<li>申请失败时推迟播放。</li>
</ul>
<h3 data-id="heading-9">2. 如需监听焦点导致的播放状态变化</h3>
<p>虽然大部分逻辑被封装，但仍可通过 <code>Player.Listener</code> 感知因焦点丢失导致的暂停：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">player.addListener(<span class="hljs-keyword">object</span> : Player.Listener {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPlayWhenReadyChanged</span><span class="hljs-params">(playWhenReady: <span class="hljs-type">Boolean</span>, reason: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">if</span> (reason == Player.PLAY_WHEN_READY_CHANGE_REASON_AUDIO_FOCUS_LOSS) {
            <span class="hljs-comment">// 系统因焦点丢失暂停了播放</span>
            <span class="hljs-comment">// 可用于更新 UI 或记录日志</span>
        }
    }
})
</code></pre>
<hr/>
<h2 data-id="heading-10">四、音频属性（AudioAttributes）</h2>
<p><code>AudioAttributes</code> 是音频焦点的基础，它告诉系统“你播放的是什么声音”。</p>
<h3 data-id="heading-11">1. Usage（用途）— 决定声音去哪、怎么控</h3>






























<table><thead><tr><th>常用值</th><th>适用场景</th><th>路由行为</th></tr></thead><tbody><tr><td>USAGE_MEDIA</td><td>音乐、视频</td><td>蓝牙媒体通道、媒体音量键</td></tr><tr><td>USAGE_VOICE_COMMUNICATION</td><td>语音通话、连麦</td><td>听筒/耳机、触发 AEC 回声消除</td></tr><tr><td>USAGE_NOTIFICATION</td><td>通知音</td><td>可被 Duck，短暂播放</td></tr><tr><td>USAGE_ALARM</td><td>闹钟</td><td>即使静音也播放（按需使用！）</td></tr></tbody></table>
<blockquote>
<p><strong>切勿为了声音大就滥用</strong> <strong><code>USAGE_ALARM</code></strong>！例如将音乐播放器设为此类型，会导致插耳机或连接蓝牙耳机时声音仍从扬声器外放，严重破坏体验。</p>
</blockquote>
<h3 data-id="heading-12">2. Content Type（内容类型）— 决定如何处理声音</h3>
<ul>
<li>
<p><code>CONTENT_TYPE_MUSIC</code>：高保真，适合音乐；</p>
</li>
<li>
<p><code>CONTENT_TYPE_MOVIE</code>：强调动态范围与环绕感；</p>
</li>
<li>
<p><code>CONTENT_TYPE_SPEECH</code>：增强人声清晰度，适合播客、有声书。</p>
</li>
</ul>
<h3 data-id="heading-13">3. 高级选项：防止音频被捕获</h3>
<p>对于版权敏感内容（如VIP音乐），可禁止录屏或辅助功能抓取音频：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-class">.setAllowedCapturePolicy</span>(C.ALLOW_CAPTURE_BY_NONE)
</code></pre>
<hr/>
<h2 data-id="heading-14">五、常见误区与实践建议</h2>
<h3 data-id="heading-15">误区 1：“静音键 = 失去音频焦点”</h3>
<ul>
<li>
<p><strong>事实</strong>：物理静音键仅控制系统音量流，<strong>不影响音频焦点逻辑</strong>。即使静音，你的应用仍可能持有焦点。</p>
</li>
</ul>
<h3 data-id="heading-16">注意 2：Android 12+ 更严格</h3>
<ul>
<li>
<p>若应用在后台且<strong>未持有音频焦点</strong>，尝试播放音频可能被系统直接拦截并抛出异常。</p>
</li>
</ul>
<h3 data-id="heading-17">实践建议</h3>
<ol>
<li><strong>准确设置 Usage</strong>：按实际场景选择，不要为了“声音更大”而误用 <code>ALARM</code>。</li>
<li><strong>动态切换属性</strong>：若应用同时支持短视频（<code>MEDIA</code>）和语音通话（<code>VOICE_COMMUNICATION</code>），请根据状态切换 <code>AudioAttributes</code>。</li>
<li><strong>配合设备特性</strong>：使用 <code>VOICE_COMMUNICATION</code> 可自动启用系统级回声消除（AEC），提升通话质量。</li>
</ol>
<hr/>
<h2 data-id="heading-18">总结</h2>
<p>音频焦点虽小，却是构建专业级车载多媒体应用不可或缺的一环，<strong>好的音视频应用，不仅会发声，更应懂得何时闭嘴🤐。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 之后，前端的下一个“十年之约”叫 Signals]]></title>    <link>https://juejin.cn/post/7599614131423428617</link>    <guid>https://juejin.cn/post/7599614131423428617</guid>    <pubDate>2026-01-27T05:49:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599614131423428617" data-draft-id="7599604510366564390" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 之后，前端的下一个“十年之约”叫 Signals"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T05:49:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Next_Tech研究局"/> <meta itemprop="url" content="https://juejin.cn/user/1259381572254521"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 之后，前端的下一个“十年之约”叫 Signals
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1259381572254521/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Next_Tech研究局
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T05:49:37.000Z" title="Tue Jan 27 2026 05:49:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在这个前端技术更迭比天气还快的时代，我们似乎正处于一个微妙的临界点。React 统治了过去十年，Vue 赢得了开发者的心，但当我们回过头看，复杂的“心智负担”和“性能损耗”依然是挥之不去的阴影。</p>
<p>最近，Signals（信号） 这个概念在 SolidJS、Preact、Qwik 甚至 Angular 中全线爆发，连 Vue 也一直深耕于此。</p>
<p>今天，我们就来聊聊这个让前端圈再次“躁动”的底层逻辑：Signals 究竟是什么？它会是状态管理的终点吗？</p>
<h2 data-id="heading-0">01 范式演进：从“全量刷新”到“精确制导”</h2>
<p>要理解 Signals，必须先看清它的对手：Virtual DOM（虚拟 DOM）。</p>
<p>在 React 的世界观里，状态改变 = 重新执行函数 = 生成新的虚拟 DOM 树 = Diff 对比 = 更新真实 DOM。</p>
<ul>
<li><strong>痛点：</strong> 即使只改了一个计数器，整个组件甚至子组件树都要重新“跑一遍”。为了优化，我们不得不祭出 useMemo、useCallback、memo 等“心智枷锁”。</li>
</ul>
<p><strong>Signals 走的是另一条路：精确制导。</strong></p>
<p>如果说 React 是“拉（Pull）”模式——发生变化后由框架去比对哪里变了；那么 Signals 就是“推（Push）”模式——状态自己知道谁依赖了它，当它变了，直接通知对应的 DOM 节点去更新。</p>
<p><strong>技术比喻：</strong></p>
<ul>
<li><strong>Virtual DOM：</strong> 班主任（框架）每天进教室大喊：“谁的名字改了？大家都站起来让我比对一遍！”</li>
<li><strong>Signals：</strong> 学生（状态）直接给特定的同学（DOM 节点）发个微信：“我改名了，你改一下笔记。”</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fee09a3fcf9429a9e1bdacf902cc89f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmV4dF9UZWNo56CU56m25bGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770097777&amp;x-signature=3RHc8Queh3cn1GvW6ZJhPBBBmqI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">02 诸神黄昏：主流框架的“信号”之战</h2>
<p>虽然大家都在提 Signals，但各家的实现思路和现状大不相同。</p>
<h3 data-id="heading-2">1. Vue：生而为信号的“老江湖”</h3>
<p>Vue 的响应式系统（从 Object.defineProperty 到 Proxy）本质上一直具有 Signals 的特性。Vue 3 的 ref 和 computed 其实就是 Signals 的变体。通过模板编译优化，Vue 能够实现非常精细的组件级更新。</p>
<h3 data-id="heading-3">2. SolidJS &amp; Svelte：彻底的“去 VDOM 化”</h3>
<p>SolidJS 是 Signals 的集大成者。它直接放弃了虚拟 DOM，将代码编译成原生的 DOM 操作。当你改变一个 Signal 时，真的只有那个特定的文本节点在闪烁，这种“手术刀级别”的更新，让它在性能榜单上常年霸榜。</p>
<h3 data-id="heading-4">3. React：倔强的“单向数据流”</h3>
<p>React 官方目前对 Signals 保持克制。React 的核心哲学是“UI 即函数”，追求的是声明式的简洁。引入 Signals 意味着打破这一哲学，转向响应式监听。虽然 Preact 等社区库已经实现了 React 版本的 Signals，但官方更倾向于通过 React Compiler（Forget） 自动处理优化，而不是改变底层响应式模型。</p>
<h2 data-id="heading-5">03 为什么是现在？Signals 爆发的三大诱因</h2>
<p>为什么这个几十年前就在 Smalltalk 存在的概念，会在 2026 年的前端圈翻红？</p>
<ol>
<li><strong>性能压榨到了极致：</strong> 随着 Web 应用复杂度指数级上升，虚拟 DOM 的 Diff 开销在移动端和低端设备上愈发明显。</li>
<li><strong>DX（开发者体验）的回归：</strong> 开发者厌倦了写满屏幕的 Dependency Array（依赖项数组）。Signals 自动追踪依赖，让代码看起来更像原生 JavaScript。</li>
<li><strong>细粒度更新与跨端需求：</strong> 尤其是在低功耗的跨端场景（如 IoT 设备、复杂的小程序环境），Signals 的按需更新能显著降低 CPU 占用。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70ee70f9fc4740dc96569fbfe4721167~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmV4dF9UZWNo56CU56m25bGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770097777&amp;x-signature=ABLYpkaGu8da%2BssIHb0XEv0JhtY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">04 终点，还是又一个循环？</h2>
<p>Signals 真的很完美吗？并不。</p>
<p>当应用规模极其巨大时，复杂的响应式链路可能导致“追踪地狱”，调试一个状态为何变化可能会变得像迷宫一样复杂。此外，它对开发者底层认知的要求其实更高了。</p>
<p>Signals 会是终点吗？ 在「研究所」看来，它更像是一次“底层的拨乱反正”。</p>
<p>前端框架正从“黑盒式的全量更新”转向“透明化的按需驱动”。未来的趋势可能不再是“我们要不要用 Signals”，而是“Signals 将成为框架默认的底层基础设施”。开发者不需要感知它的存在，却能享受它带来的极致性能。</p>
<p>💡作为开发者，我们不必纠结于名词的更迭。从 JQuery 的手动挡，到 React 的半自动挡，再到 Signals 驱动的“自动驾驶”，技术的本质永远是消除重复，让创意更自由地表达。</p>
<p>如果你正在追求极致的 C 端性能，或者厌倦了 React 繁琐的 Hooks 优化，不妨去尝试一下 SolidJS 或 Vue 3 的最新特性，感受一下那种“指哪打哪”的快感。</p>
<hr/>
<p>微信公众号：Next Tech研究局 站在前端与 AI 的交叉口，分享最好用的工具与最前沿的跨端实践。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python开发者必备的5个高效技巧，90%的人不知道第二个！]]></title>    <link>https://juejin.cn/post/7599598627008315444</link>    <guid>https://juejin.cn/post/7599598627008315444</guid>    <pubDate>2026-01-27T04:19:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599598627008315444" data-draft-id="7599703627788992552" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python开发者必备的5个高效技巧，90%的人不知道第二个！"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-27T04:19:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python开发者必备的5个高效技巧，90%的人不知道第二个！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:19:12.000Z" title="Tue Jan 27 2026 04:19:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Python开发者必备的5个高效技巧，90%的人不知道第二个！</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Python作为一门简洁、易读且功能强大的编程语言，已经成为开发者的首选工具之一。然而，尽管许多开发者能够熟练使用Python的基础语法和常见库，但很少有人真正掌握那些可以显著提升开发效率的高级技巧。本文将揭示5个鲜为人知但极其高效的Python技巧，帮助你在日常开发中事半功倍。特别值得一提的是，第二个技巧90%的开发者都不知道！</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. 使用<code>functools.lru_cache</code>优化递归函数</h3>
<p>递归函数在解决某些问题时非常直观，但性能问题常常让人望而却步。Python的<code>functools</code>模块提供了一个名为<code>lru_cache</code>的装饰器，可以缓存函数的计算结果，避免重复计算。</p>
<h4 data-id="heading-4">示例：斐波那契数列</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache

<span class="hljs-meta">@lru_cache(<span class="hljs-params">maxsize=<span class="hljs-literal">None</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci</span>(<span class="hljs-params">n</span>):
    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> n
    <span class="hljs-keyword">return</span> fibonacci(n-<span class="hljs-number">1</span>) + fibonacci(n-<span class="hljs-number">2</span>)
</code></pre>
<h4 data-id="heading-5">优势</h4>
<ul>
<li><strong>显著提升性能</strong>：对于重复计算的递归调用（如斐波那契数列），缓存可以将时间复杂度从O(2^n)降低到O(n)。</li>
<li><strong>简单易用</strong>：只需添加一个装饰器即可实现缓存功能。</li>
</ul>
<h4 data-id="heading-6">注意事项</h4>
<ul>
<li><code>maxsize</code>参数用于限制缓存的大小，设为<code>None</code>表示不限制。</li>
<li>对于有副作用的函数或不纯的函数（依赖外部状态），慎用缓存。</li>
</ul>
<hr/>
<h3 data-id="heading-7">2. 利用<code>__slots__</code>节省内存（90%的人不知道！）</h3>
<p>Python的对象默认使用字典（<code>__dict__</code>）来存储属性，这会带来额外的内存开销。通过定义<code>__slots__</code>，可以显式声明对象的属性列表，从而避免动态字典的开销。</p>
<h4 data-id="heading-8">示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    __slots__ = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'age'</span>]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        self.name = name
        self.age = age
</code></pre>
<h4 data-id="heading-9">优势</h4>
<ul>
<li><strong>节省内存</strong>：对于需要创建大量实例的类（如ORM模型），内存占用可减少50%以上。</li>
<li><strong>加速属性访问</strong>：由于属性访问不再需要通过字典查找，速度更快。</li>
</ul>
<h4 data-id="heading-10">注意事项</h4>
<ul>
<li><code>__slots__</code>会禁用动态添加属性的能力（即无法在运行时添加新属性）。</li>
<li>继承时需谨慎：如果父类有<code>__slots__</code>，子类也需要定义自己的<code>__slots__</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-11">3. 使用上下文管理器管理资源</h3>
<p>Python的上下文管理器（通过<code>with</code>语句实现）是管理资源（如文件、数据库连接、锁）的最佳实践。除了内置的上下文管理器外，还可以通过标准库中的<code>contextlib.contextmanager</code>轻松自定义。</p>
<h4 data-id="heading-12">示例：自定义计时器上下文管理器</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager
<span class="hljs-keyword">import</span> time

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">timer</span>():
    start = time.time()
    <span class="hljs-keyword">yield</span>
    end = time.time()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"耗时: <span class="hljs-subst">{end - start:<span class="hljs-number">.2</span>f}</span>秒"</span>)

<span class="hljs-comment"># 使用方式</span>
<span class="hljs-keyword">with</span> timer():
    time.sleep(<span class="hljs-number">1</span>)
</code></pre>
<h4 data-id="heading-13">优势</h4>
<ul>
<li><strong>资源自动释放</strong>：确保资源在使用后正确关闭或释放（如文件、锁）。</li>
<li><strong>代码更清晰</strong>：避免了手动调用清理逻辑的繁琐操作。</li>
</ul>
<h4 data-id="heading-14">扩展应用</h4>
<p>结合多个上下文管理器可以使用嵌套或标准库中的<code>socket.create_connection()</code>等高级功能。</p>
<hr/>
<h3 data-id="heading-15">4. Python的动态导入与反射机制</h3>
<p>Python的动态导入和反射能力允许程序在运行时加载模块或获取对象信息，这在插件系统或配置化开发中非常有用。</p>
<h4 data-id="heading-16">示例：动态导入模块并调用函数</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> importlib

module_name = <span class="hljs-string">"math"</span>
function_name = <span class="hljs-string">"sqrt"</span>

module = importlib.import_module(module_name)
func = <span class="hljs-built_in">getattr</span>(module, function_name)
result = func(<span class="hljs-number">4</span>)  <span class="hljs-comment"># result为2.0</span>
</code></pre>
<h4 data-id="heading-17">优势</h4>
<ul>
<li><strong>灵活性高</strong>：可以根据配置或用户输入动态加载功能模块。</li>
<li><strong>解耦代码</strong>：主程序不需要硬编码所有可能的模块依赖。</li>
</ul>
<p>####注意事项</p>
<ul>
<li><strong>安全问题</strong>：动态加载可能导致恶意代码执行（如用户输入的模块名）。建议对输入做严格校验。</li>
</ul>
<hr/>
<p>###5.利用生成器和迭代器优化大数据处理</p>
<p>在处理大规模数据集时,传统的列表操作可能会导致内存爆炸.Python生成器和迭代器提供了一种惰性计算的方式,只在需要时才生成数据.</p>
<p>####示例:读取大文件的行</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_large_file</span>(<span class="hljs-params">file_path</span>): 
 <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path,<span class="hljs-string">'r'</span>)<span class="hljs-keyword">as</span> f: 
 <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f: 
 <span class="hljs-keyword">yield</span> line.strip() 

<span class="hljs-comment">#使用方法 </span>
<span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> read_large_file(<span class="hljs-string">'huge_file.txt'</span>): 
 process(line)<span class="hljs-comment">#逐行处理而不加载整个文件到内存 </span>
</code></pre>
<p>####优势</p>
<ul>
<li><strong>内存高效</strong>:理论上可以处理无限大的数据集.</li>
<li><strong>链式操作</strong>:可以与map(),filter()等无缝结合.</li>
</ul>
<p>####高级技巧
itertools标准库提供了许多强大的迭代器工具,如groupby(),islice()等.</p>
<hr/>
<p>##总结</p>
<p>Python的强大不仅在于其简洁语法和丰富生态,更在于这些隐藏的高级特性.本文介绍的五个技巧:</p>
<p>1.functools.lru_cache优化递归性能.
2.__slots_节省对象内存.
3.上下文管理器优雅管理资源.
4.动态导入实现灵活架构.
5.生成器处理大数据集.</p>
<p>特别是第二个_slots_技巧,确实很少被提及却能带来显著的性能提升.掌握这些技术将帮助你写出更高效、更专业的Python代码</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skills 傻瓜式教程，26 年最火 AI 技术就这？]]></title>    <link>https://juejin.cn/post/7599604510366236710</link>    <guid>https://juejin.cn/post/7599604510366236710</guid>    <pubDate>2026-01-27T03:47:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599604510366236710" data-draft-id="7599601258639851558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skills 傻瓜式教程，26 年最火 AI 技术就这？"/> <meta itemprop="keywords" content="Agent,AI编程,程序员"/> <meta itemprop="datePublished" content="2026-01-27T03:47:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员鱼皮"/> <meta itemprop="url" content="https://juejin.cn/user/2444938365386621"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skills 傻瓜式教程，26 年最火 AI 技术就这？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2444938365386621/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员鱼皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:47:57.000Z" title="Tue Jan 27 2026 03:47:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是小阿巴，正在用 AI 开发网站。</p>
<p>为了让 AI 生成的效果更好，你告诉 AI：</p>
<ul>
<li>界面不要使用蓝紫渐变色</li>
<li>不要生成一大堆没用的文档</li>
<li>你要遵循公司的代码规范</li>
</ul>
<p>阿巴阿巴，洋洋洒洒几百字。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/679b43432ead4cf6a57acd53a29e8073~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=TeEBMi%2F5J7QMrT0ZJLZh6JknAFA%3D" alt="" loading="lazy"/></p>
<p>之后每次开发网站时，你都要写这么一段又臭又长的提示词，太麻烦了！</p>
<p>于是聪明的你开始想办法。</p>
<p>先把常用的提示词保存到单独的文件（比如 <code>prompts.md</code>），每次手动投喂给 AI。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83b1fb79c339412eafb488bb86595b6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=1Y7usVzvxtoYiLEZB6kPYdVYvd0%3D" alt="" loading="lazy"/></p>
<p>然后创建了资源文件夹，把公司的代码规范、设计素材都塞进去，告诉 AI 参考这些写。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/148922b9a5b7486ab8ad1bcbc642b7ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=2evfwv1Wcx5xo%2Brbe0A7uCs9xFQ%3D" alt="" loading="lazy"/></p>
<p>接着你还写了一些脚本，让 AI 生成代码后自动执行格式化、运行测试、提交代码到 Git。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1c09f4d60b340fa8f93f3b0ad83dba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=kP8GHXUTbxIDTToaDfJrrGVt9y8%3D" alt="" loading="lazy"/></p>
<p>最后我再写个 <code>AGENTS.md</code> 文件，把所有规范和工作流程都写进去，让 AI 自动读取。</p>
<p>你沾沾自喜：嘿嘿，俺这套工作流，堪称完美！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b578ed01aff42d285e2888fc378ab76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=%2FUjEiijCFQfyDDDqyCdoeT4TUPQ%3D" alt="" loading="lazy"/></p>
<p>但很快，你发现了问题，随着规范越写越多，文档越来越臃肿，每次对话都要占用很多 AI 上下文空间，浪费 tokens。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7db28b039f524327a356315c6cd04825~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=uInCHUZrRGE7%2B%2FydQ4zc4aqhQNU%3D" alt="" loading="lazy"/></p>
<p>于是你找到号称 “没有人比他更不懂 AI” 的鱼皮求助：阿巴阿巴，俺还能咋办啊……</p>
<p>鱼皮：不是有 Agent Skills 么？为啥不直接用？</p>
<p>你一脸懵：啥玩意儿？</p>
<p>鱼皮：这可是最近 AI 圈儿爆火的技术，下面我来带你玩转 Agent Skills，让你知道它是什么、怎么用、有什么魔力、怎么自己开发。</p>
<p>点个收藏，我们开始~</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5336a764f16f47f383c99b10ae53c0e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=8gN9NoO5EzJFAvWnm6eLrr5mQ3I%3D" alt="" loading="lazy"/></p>
<p>⭐️ 推荐观看视频动画版，更通俗易懂：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1T7zzBQEaA%2F" target="_blank" title="https://www.bilibili.com/video/BV1T7zzBQEaA/" ref="nofollow noopener noreferrer">bilibili.com/video/BV1T7…</a></p>
<h2 data-id="heading-0">什么是 Agent Skills？</h2>
<p>Agent Skills 是 Anthropic 推出的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.claude.com%2Fdocs%2Fzh-CN%2Fagents-and-tools%2Fagent-skills%2Foverview" target="_blank" title="https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/overview" ref="nofollow noopener noreferrer">一套开放标准</a>，目的是让 AI 能够学习使用各种专业技能，而不用每次都重复输入提示词。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1b4bacf0ca44d4181e34e53cf7283a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=3%2BSARWDnxS5jfedkN2o1XSlgQeE%3D" alt="" loading="lazy"/></p>
<p>简单来说，它就是给 AI 装备的 <strong>技能包</strong>。技能包里有精心设计的提示词、代码脚本、还有各种资源文件。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9ef63fc4d4846dcbd3ac90c397bb5d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=cSNmXU3HLWSvtjozg6FKHn50th4%3D" alt="" loading="lazy"/></p>
<p>把 AI 想象成一个职场小白，给他装上 <code>文档处理技能</code>，它就立刻知道怎么生成 PPT、处理 Excel 表格；装上 <code>代码规范技能</code>，它就知道怎么按照公司标准写代码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/166861d335e74f3f9b4427e2dc61059f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=UpGGuGplWBOQTUjLPoETh%2FIf5Rs%3D" alt="" loading="lazy"/></p>
<p>你挠挠头：等等…… 这不就是俺在做的事吗？把教 AI 做事的文档和 AI 要用到的文件打包成文件夹？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/823301f368fc49ae86e7fa117ffbfc55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=%2BhcF5Dhs1U1uDsG1W8qv0vaBJ%2FE%3D" alt="" loading="lazy"/></p>
<p>鱼皮：差不多，但 Anthropic 把它做成了一个通用标准，而且在实现原理上有一些新花样……</p>
<p>你捶胸顿足：可恶啊，俺差点就改变世界了！这能有什么新花样？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3176d76d2bdc4f598096ac013095992d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=HOM2ctzw43K%2BS2awAb6ibv6Gdtw%3D" alt="" loading="lazy"/></p>
<p>鱼皮：我先来带你用一下 Agent Skills，再跟你说说其中的奥秘。</p>
<h2 data-id="heading-1">Agent Skills 入门实战</h2>
<p>目前对 Agent Skills 支持最完善的工具是 Anthropic 官方的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fclaude.com%2Fproduct%2Fclaude-code" target="_blank" title="https://claude.com/product/claude-code" ref="nofollow noopener noreferrer">Claude Code</a>，我们就以此为例，安装并使用 Skills。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf5cf3d805044393b2588e7b03bd0337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=KSc6GVPj5MTnP9AfZUNVxViqOvo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">1、安装 Skills 技能</h3>
<p>先打开 Claude Code 并输入命令，添加官方技能市场：</p>
<pre><code class="hljs language-bash" lang="bash">/plugin marketplace add anthropics/skills
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb02defb82114c5aab11197bff2515cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=xiiE%2BKteEMahXaviOJXFcepeyMY%3D" alt="" loading="lazy"/></p>
<p>这就像是在你的 AI 助手里开通了一个技能商店，接下来你就可以从商店中获取技能了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a961c2c19c3641629a2b85324b93b868~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=JB1NEvvaPmUfdKaplxvqxnrdBwg%3D" alt="" loading="lazy"/></p>
<p>在 Claude Code 中输入命令，安装官方提供的技能包：</p>
<pre><code class="hljs language-bash" lang="bash">/plugin install example-skills@anthropic-agent-skills
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24b260ec18514ec48147629639e6e782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=adFC6Jhoq0QYE%2FLngva%2F5%2F64Rp4%3D" alt="" loading="lazy"/></p>
<p>这个 example-skills 包含了一堆官方示例技能，包括前端设计、网页测试、动图制作等等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/781d0cc50f41466182ab451d4194b7ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=3bsL140KjhvVn2GmilM4C%2BzncgQ%3D" alt="" loading="lazy"/></p>
<p>装完之后，你就可以直接让 AI 使用这些技能了。</p>
<h3 data-id="heading-3">2、前端设计技能</h3>
<p>比如你要做一个网站，以前没装技能的时候，AI 生成的代码又是那个熟悉的蓝紫渐变色，千篇一律的 AI 审美。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c8514bbd6ae4223adb5f7b0723d576c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=S3stIzmHMJe3zolrnYdtkMltBGQ%3D" alt="" loading="lazy"/></p>
<p>现在安装了 frontend-design 这个 <strong>教 AI 生成专业设计感网站</strong> 的技能后，你输入：“帮我开发个人作品集网站”。</p>
<p>AI 会主动问你：我发现你安装了前端设计技能，需要用它来生成更具设计感的页面吗？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/372aac57a65b4ce3bd44632b03d292ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=oLSe8CNK%2ByPBHq1e1EyPLeYBzN0%3D" alt="" loading="lazy"/></p>
<p>确认之后，AI 会利用技能生成代码，告别蓝紫渐变，生成独特风格的精美页面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f60b29593a3d4ec6bc7c45e7c07e42ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=nY9sIRNGpGRv4WAjutt9ECpaF%2B0%3D" alt="" loading="lazy"/></p>
<p>我们不用每次都给 AI 输入一大堆相同的提示词，装一次技能就行了。</p>
<h3 data-id="heading-4">3、文档处理技能</h3>
<p>除了代码相关的技能，官方还提供了文档处理技能包。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f24ff9ac66645d684db789f718f5d2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=XSm5IXo3FGDABnG2weKWLQJL%2B08%3D" alt="" loading="lazy"/></p>
<p>同样在 Claude Code 中输入一行命令安装：</p>
<pre><code class="hljs language-typescript" lang="typescript">/plugin install <span class="hljs-variable language_">document</span>-skills<span class="hljs-meta">@anthropic</span>-agent-skills
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14b2712f3e054e39987512069233803f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=1qwESmAk0uxTqFeqICkuPk%2FWNAU%3D" alt="" loading="lazy"/></p>
<p>这个技能包里有 PPT 制作、Word 文档生成、Excel 数据分析、PDF 解析等技能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cb20f214a414a9e808e0702dfc07a96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=Al0dhDps160NvrAwmXzDCJlbGHc%3D" alt="" loading="lazy"/></p>
<p>接下来如果你让 AI 做个 PPT，它会自动调用 PPT 制作技能，直接生成排版好的 PPT 文件，帮你节省几个小时。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e872d17631824be2a653666e91c44fd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=WxGPIe69hnzGaRITExoe4grYxRM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce21e8cfd3484be08977bd6a4e2adfdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=cYBW5NFXeFcFvGUKUeqhQlElx0s%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">揭秘 Agent Skills 内部原理</h2>
<p>你好奇道：咦，为什么 Skills 能做到安装即用？技能包里面到底有啥？AI 又是怎么知道该用哪个技能的？</p>
<p>鱼皮：好问题。<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentskills.io%2Fwhat-are-skills" target="_blank" title="https://agentskills.io/what-are-skills" ref="nofollow noopener noreferrer">技能</a> 其实就是一个包含 <code>SKILL.md</code> 技能说明文件的文件夹，还可以包含可执行脚本、资源和参考文档。</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">my</span>-skill/
├── SKILL.md         <span class="hljs-comment"># 必需：指令和元数据</span>
├── scripts/         <span class="hljs-comment"># 可选：可执行脚本</span>
├── references/       <span class="hljs-comment"># 可选：参考文档</span>
└── assets/           <span class="hljs-comment"># 可选：模板和资源</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aef6b097af914e73b2dc2a209a8a184b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=UI7KBMMy0%2F9PTniPEBHObXP6eHA%3D" alt="" loading="lazy"/></p>
<p>由于每个技能的复杂度不同，结构也会存在区别。我们可以在本地目录中找到已安装的技能文件夹。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20856da9f994434e8cd7af00131ba617~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=S92%2FcOQwVVPdW37EGyx5AzecjB8%3D" alt="" loading="lazy"/></p>
<p>以官方的 PPT 制作技能为例，它的结构是这样的：</p>
<pre><code class="hljs language-bash" lang="bash">skills/pptx/
├── SKILL.md         <span class="hljs-comment"># 技能说明书（必需）</span>
├── ooxml/           <span class="hljs-comment"># OOXML 相关资源</span>
├── scripts/         <span class="hljs-comment"># 处理脚本</span>
├── html2pptx.md     <span class="hljs-comment"># HTML 转 PPT 说明</span>
├── ooxml.md         <span class="hljs-comment"># OOXML 格式说明</span>
└── LICENSE.txt       <span class="hljs-comment"># 许可证</span>
</code></pre>
<p>包含一个核心的技能说明文档 <code>SKILL.md</code>，还有脚本、参考文档和各种资源文件。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3441e7351b419cbf5b2abce5421177~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=KURXanfWbzfISw%2FDAmoQKDYgTXo%3D" alt="" loading="lazy"/></p>
<p>而 frontend-design 前端设计技能只有一个 <code>SKILL.md</code> 文件。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3a1c0a292414a94b5cc89e2da9e3a97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=ZTaXNmLFhtbccxP3pl4j5ZhRJuY%3D" alt="" loading="lazy"/></p>
<p><code>SKILL.md</code> 文件是每个技能的核心，它包含两个关键部分。</p>
<p>第一部分是 <strong>元数据</strong>，用 YAML 格式写在文件开头：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-string">name:</span> <span class="hljs-string">frontend-design</span>
<span class="hljs-string">description:</span> <span class="hljs-string">生成具有专业设计感的前端代码，避免千篇一律的</span> <span class="hljs-string">AI</span> <span class="hljs-string">审美</span>
<span class="hljs-meta">---
</span></code></pre>
<p>其中 <code>name</code> 是技能的名字。<code>description</code> 是技能的描述，告诉 AI 什么时候应该使用这个技能。描述写得越清晰，AI 就越容易在合适的时机调用它。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd87165ead4a4163b026ef23944be73d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=2PCEBwXh3aqcN2a9bSzexZ7vqNs%3D" alt="" loading="lazy"/></p>
<p>第二部分是 <strong>指令内容</strong>，就是一套经过精心设计的提示词，指导 AI 具体怎么做。</p>
<p>以 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Fblob%2Fmain%2Fskills%2Ffrontend-design%2FSKILL.md" target="_blank" title="https://github.com/anthropics/skills/blob/main/skills/frontend-design/SKILL.md" ref="nofollow noopener noreferrer">frontend-design</a> 技能为例，它的指令内容包括：</p>
<ul>
<li>设计思考：在写代码前，先分析产品目的、用户群体、技术约束，然后选择一个大胆的美学方向（极简、复古未来、工业风、有机自然、奢华精致等）</li>
<li>前端美学指南：包括字体选择（避免 Arial、Inter 等烂大街字体，选择有个性的组合）、配色主题（主色调配鲜明点缀色）、动效设计、空间构成、背景和视觉细节</li>
<li>避坑指南：明确禁止紫色渐变、系统字体、千篇一律的布局等 AI 审美陷阱</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59d721e09c1a4efca446ee1d5ed4bc9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=w8ihk%2FAP7P3xuOiIaIjMyWpsjfc%3D" alt="" loading="lazy"/></p>
<p>你挠了挠头：如果有多个 SKills，AI 怎么知道该用哪个技能呢？如果把每个技能说明文档都塞给 AI，不是很占用上下文么？</p>
<p>鱼皮：这就要说到 <strong>渐进式披露（Progressive Disclosure）</strong> 这个核心机制了。</p>
<p>当你让 AI 执行任务时，它会先扫描技能目录，但不会把所有内容都加载到上下文中。而是只读取每个技能的元数据（名字和描述），发现描述和任务相关，就知道该用这个技能了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0634b67b03094caa96ca694be03fc8ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=4seDFjvnBg%2FIYQ05NKbSubWU8l0%3D" alt="" loading="lazy"/></p>
<p>然后才把完整的技能说明文档读进来，按照里面的指令执行：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a08e857c7c648a1892ba26bd8ea35fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=kGJBZ8g3QPfVlRnFgikr1KEuAjk%3D" alt="" loading="lazy"/></p>
<p>并根据需要加载技能包中的其他资源：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3de1c9adb4f40d5af81f61d9e2f2c3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=qoRF3%2FQdV91PQx6e2szbgHG3ql8%3D" alt="" loading="lazy"/></p>
<p><strong>用到哪个查哪个</strong>，既精准匹配又节省上下文，这就是渐进式披露的精髓。</p>
<p>所以 Agent Skills 的本质就是 <strong>把专业知识打包成一个文件夹，让 AI 按需读取并使用</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53ac8c2740114c7e9aae75b4a682975f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=VwYpApQy6UbgAe9sEw7v49%2BkMwE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">跨工具的 Agent Skills</h2>
<p>你问：除了 Claude Code 之外，其他 AI 工具支持 Agent Skills 么？俺平时用 Cursor 比较多……</p>
<p>鱼皮：当然能！<a href="https://link.juejin.cn?target=https%3A%2F%2Fagentskills.io%2F" target="_blank" title="https://agentskills.io/" ref="nofollow noopener noreferrer">Agent Skills</a> 已经成为通用标准，Cursor、VS Code、Codex 等工具都支持。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/572b408ce4994e43bdc43a748701806e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=5ElY%2FSduBlX8qhmdEPJpKvmeC70%3D" alt="" loading="lazy"/></p>
<p>Skills 的社区也非常活跃，你可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claudeskill.site%2Fzh%2Fskills" target="_blank" title="https://www.claudeskill.site/zh/skills" ref="nofollow noopener noreferrer">Claude Skills Hub 市场</a>、开源的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FComposioHQ%2Fawesome-claude-skills" target="_blank" title="https://github.com/ComposioHQ/awesome-claude-skills" ref="nofollow noopener noreferrer">Awesome Claude Skills</a> 等地方找到很多现成的技能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53593a81687b43a49ddf348f0e46821f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=CWAJcwgBZqWs%2BmuSe0KP%2Fg2k9%2Bw%3D" alt="" loading="lazy"/></p>
<p>比如有个叫 <a href="https://link.juejin.cn?target=https%3A%2F%2Fui-ux-pro-max-skill.nextlevelbuilder.io%2F" target="_blank" title="https://ui-ux-pro-max-skill.nextlevelbuilder.io/" ref="nofollow noopener noreferrer">UI UX Pro MAX</a> 的技能特别火，专门用于提升 AI 的设计能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53c3a0f60dad4cdbb0d8bc546cf06cbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=hVyzHq3O%2BzWceC%2FXy5kM%2B2YmzIg%3D" alt="" loading="lazy"/></p>
<p>用法很简单，首先按照 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnextlevelbuilder%2Fui-ux-pro-max-skill" target="_blank" title="https://github.com/nextlevelbuilder/ui-ux-pro-max-skill" ref="nofollow noopener noreferrer">开源仓库文档</a> 的指引，安装官方提供的命令行工具：</p>
<pre><code class="hljs">npm install -g uipro-cli
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3603e9ce448f4379b30e7efce20bcb20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=4tYdpdK2acy3r8im1vFx%2BbYVcNg%3D" alt="" loading="lazy"/></p>
<p>然后进入到你的项目目录下，根据使用的 AI 工具执行对应的命令。比如我这里用 Cursor：</p>
<pre><code class="hljs language-css" lang="css">uipro init <span class="hljs-attr">--ai</span> <span class="hljs-attribute">cursor</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d7889e8d1134584995e251b8dfcf2a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=J6%2F8o%2FkRY20MFY4T2nCTIzIPrqw%3D" alt="" loading="lazy"/></p>
<p>它会自动把技能安装到 Cursor 的配置目录里。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbc145f1d0594799b0b2073e0e08cfb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=EIEeNNO19KM2260yOofv1ZM5BYo%3D" alt="" loading="lazy"/></p>
<p>安装完成后，可以看到它的文件结构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4a846ff10c34b9c90d471f7c85eb712~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=%2BEKyavnMhSn5tXCzhHcCWSdgXME%3D" alt="" loading="lazy"/></p>
<p>接下来，当你让 AI 开发一个网站时，可以使用斜杠命令手动触发技能，或者让 AI 自动识别技能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7da66d1099644af3938354d3202e0ceb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=iWWFhqboyTzA953dy0uaWh2tmCg%3D" alt="" loading="lazy"/></p>
<p>1）AI 会根据你的需求识别出产品类型和需要的页面类型</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/586a02d5c5e54e13b33b095a82e7efc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=YMdVq4NHnh41%2FTorxOmumV7%2FUiU%3D" alt="" loading="lazy"/></p>
<p>2）然后调用 <code>search.py</code> 搜索脚本，在 data 目录里进行多维度搜索，找到适合的配色、字体、布局风格</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94775765d2e344898b2a1d6ba69ba41d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=ToXUhY1LT9cjBci7RdXW4BPywQU%3D" alt="" loading="lazy"/></p>
<p>3）综合搜索结果，生成完整的设计方案（主色调、字体组合、间距规范等）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79c70c1cc63f4a6caef98dad6a95204b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=Dsg18CZHPjlhdKsPZ2dtXKKqpHM%3D" alt="" loading="lazy"/></p>
<p>4）最后，再按照设计方案生成代码</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1626b8d5405d40d99dd242c0e7181536~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=C%2BMrcL6gZaO8OPQgArWRLaswGCg%3D" alt="" loading="lazy"/></p>
<p>这样一来，生成的界面既专业又有设计感。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8ff080a12414ce2972d7dfd1adf5bf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=gapGl6%2FD0n2UMxNMflDWCkMfsQY%3D" alt="" loading="lazy"/></p>
<p>AI 不需要把所有规则都背下来，而是用到哪个查哪个，这就是 Agent Skills 的精髓。</p>
<h2 data-id="heading-7">创建自己的 Agent Skills</h2>
<p>用了很多别人的技能后，你产生了一个大胆的想法：俺能不能把公司的周报格式封装成一个技能？以后推荐给新来的同事，还能卖个几块钱，嘿嘿嘿~</p>
<p>鱼皮笑道：有点儿东西，你打算怎么做呢？</p>
<p>你会心一笑：当然是发挥程序员最擅长的事情 —— 复制粘贴！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8706e56933fa40e39aedb3bcdeae940a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=QImONED%2F6nEXcRNzTt7EzUhYUXA%3D" alt="" loading="lazy"/></p>
<p>俺先复制一个官方的技能包，修改目录名称为自己的。</p>
<p>然后修改技能说明文档 <code>SKILL.md</code> 的元数据、指令内容这些关键部分。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac93b055ba324a728bb03b5c21f61b7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=1mP8z5CWE7sH3L7lL3wE5wJqRAE%3D" alt="" loading="lazy"/></p>
<p>示例 <code>SKILL.md</code> 文件：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">company-weekly-report</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">生成符合公司规范的项目周报，包含进度汇总、问题跟踪和下周计划</span>
<span class="hljs-meta">---</span>
<span class="hljs-string">​</span>
<span class="hljs-comment"># 公司周报生成技能</span>
<span class="hljs-string">​</span>
<span class="hljs-string">当用户要求生成周报时，请按以下步骤执行：</span>
<span class="hljs-string">​</span>
<span class="hljs-comment">## 1. 收集信息</span>
<span class="hljs-string">-</span> <span class="hljs-string">询问本周完成的主要工作</span>
<span class="hljs-string">-</span> <span class="hljs-string">询问遇到的问题和解决方案</span>
<span class="hljs-string">-</span> <span class="hljs-string">询问下周计划</span>
<span class="hljs-string">​</span>
<span class="hljs-comment">## 2. 格式规范</span>
<span class="hljs-string">-</span> <span class="hljs-string">使用公司蓝色主题</span>
<span class="hljs-string">-</span> <span class="hljs-string">标题使用微软雅黑加粗</span>
<span class="hljs-string">-</span> <span class="hljs-string">每个模块不超过</span> <span class="hljs-number">5</span> <span class="hljs-string">个要点</span>
<span class="hljs-string">​</span>
<span class="hljs-comment">## 3. 输出格式</span>
<span class="hljs-string">-</span> <span class="hljs-string">默认输出</span> <span class="hljs-string">Markdown</span>
<span class="hljs-string">-</span> <span class="hljs-string">如需</span> <span class="hljs-string">PPT，调用</span> <span class="hljs-string">pptx</span> <span class="hljs-string">技能</span>
</code></pre>
<p>最后，把公司的 Logo、PPT 模板、报告样例放在子文件夹里就行了。妈妈再也不用担心我的周报了~</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dfadb3ce4514fdda360866c30adabb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=0Gye3AeIgrQaGTP4LxdU4ZIX7Ws%3D" alt="" loading="lazy"/></p>
<p>鱼皮：不错不错，但其实有更简单规范的方法。</p>
<p>在前面安装的 example-skills 官方示例技能包里，有一个叫 <code>Skill Creator</code> 的技能，专门用来帮你创建新技能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e2b61fd440143b09370a4fe72e8b6bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=oawzvfOKlR0xXjE4PMGOaedZIKw%3D" alt="" loading="lazy"/></p>
<p>你只需要跟 AI 说：“帮我创建一个专门生成公司周报的技能”</p>
<p>接下来 AI 会问你几个问题，一步一步回答就好：</p>
<ul>
<li>你希望周报包含哪些主要部分？</li>
<li>你希望周报以什么格式输出?</li>
<li>你通常会如何使用这个周报技能?</li>
<li>希望周报的语言风格是什么?</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97ac5a6fa2ff4d00abc15128f57e683f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=Rg3VA%2Fc1Z8TbvFXbddB7YYFvXAY%3D" alt="" loading="lazy"/></p>
<p>很快，一个完整的技能包就生成了，你会看到一个 <code>.skill</code> 为后缀的文件，本质上是一个 zip 压缩包。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8f274b94a2b441790e30db2059ec9b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=x2gy8AOWIorqAeX8fLZ7HrJ4oFU%3D" alt="" loading="lazy"/></p>
<p>你可以把它解压到你的个人技能目录（<code>~/.claude/skills/</code>）下，你的所有项目都能用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c67c40a7d4174ca1af3e2687956af679~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=HlLv6mqyxiSJuBkeTsNUFDx9B1s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/288439a55d4b47d1a4fda4a099f9dd93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=9hWDe3s6wpj%2F4JnUBBdUjb13KSI%3D" alt="" loading="lazy"/></p>
<p>如果你想让这个技能只在某个项目生效，可以把它放到项目的 <code>.claude/skills/</code> 目录下，并且利用 Git 同步给项目组其他成员。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd420b41b75f43068673cb047899c79a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=esOl57EVVrs7EBbMFp6pjJzsoBE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7bbf0ff9cce423bbc2447472fd2494d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=4u%2BALW3Vs%2BykSLj8i%2BYuh2r3qBo%3D" alt="" loading="lazy"/></p>
<p>测试没问题后，你还可以把它开源到 GitHub，或者上传到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claudeskill.site%2Fzh%2Fskills" target="_blank" title="https://www.claudeskill.site/zh/skills" ref="nofollow noopener noreferrer">Claude Skills Hub</a> 这样的社区平台，让所有用户都能用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3aebf40b715b408fa232255fd1fab230~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=0S%2BaC2og7IOlT%2Fs7MwHJz0EMDqs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">Skills / MCP / 斜杠命令的区别</h2>
<p>你开心极了：原来开发一个 Skills 这么简单！但是，这玩意儿跟之前火爆的 MCP 和斜杠命令有啥区别？</p>
<p>鱼皮：好问题！</p>
<p><strong>MCP 就像给 AI 装上了 “手和眼睛”</strong> ，让 AI 能够连接外部工具和数据源，比如搜索网页、读取代码仓库、查询数据库。适合需要获取数据或操作外部系统的场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b88fe3e5d094d34a7f9e2d855cfa828~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=MZB0LIneq855px4ZjM1RDLEzD5Y%3D" alt="" loading="lazy"/></p>
<p><strong>而 Agent Skills 更像是给 AI 发了一本 “工作手册”</strong> ，把专业知识和工作流程打包起来，教 AI 在特定领域该怎么做。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57b22be47e614cf6bcd657fce25665ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=I%2BQdQUfrtzEsYqPssZ%2BsP9OyJVs%3D" alt="" loading="lazy"/></p>
<p>至于斜杠命令，它就像是快捷键，是需要你手动输入 <code>/command</code> 命令来触发的固定操作；而 Skills 的特点是 AI 可以自动识别该用什么技能，不需要你显式调用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c713edcd1b643319607c3e946946da8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=SSqh8X5wdhhUH4hwxgkV8zZW7V0%3D" alt="" loading="lazy"/></p>
<p>对了，其实 MCP 和 Skills 是可以结合起来的。</p>
<p>举个例子，如果你想让 AI 帮你发周报：</p>
<ul>
<li>MCP 负责获取数据：从任务管理数据库拉取这周的任务列表</li>
<li>Skills 负责加工数据：把获取到的原始数据整理成老板爱看的格式</li>
</ul>
<p>一个提供食材，一个提供配方。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a56c977530a940dfb489f6293241444a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=rbY3BhWzlde5Ztz04hs8z0YI3DA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">Agent Skills 凭什么大火？</h2>
<p>你看着技能文件夹的结构，突然怪叫一声：等等，俺突然意识到一个问题…… 这不就是我们程序员玩烂的 “封装、复用、模块化、懒加载” 那一套吗？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a766352622f947c8b951d796e6b34d1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=vIYHl29%2B59mOsweoBMgGQc%2BFxnw%3D" alt="" loading="lazy"/></p>
<p>写几个代码文件、打个包、发到网上，让其他程序员下载下来用，不是一回事儿么？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da53a1e4eec3433fab55201cfc8a98d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=tge5szG90TIidsiuUbAyvmsMvaQ%3D" alt="" loading="lazy"/></p>
<p>为什么 Agent Skills 能突然让整个 AI 圈为之疯狂？</p>
<p>鱼皮：好问题，从技术的角度来看，它并没有发明什么惊天动地的算法。</p>
<p>在我看来，它能火主要是 2 个原因。</p>
<p>第一，它是开放标准，封装一次技能包后就能在各种 AI 工具里复用，还能通过社区共享。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94f7b20333d5480d8a41cd9cbe1d9568~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=cXgZcj6McI8SdC0cjLYsDezwAps%3D" alt="" loading="lazy"/></p>
<p>更重要的是，Skills 能立刻让 AI 的工作更专业可靠，让普通人 “无感” 地享受技术带来的价值。以前想让 AI 变聪明，你得学提示词工程、配置各种工具链。现在只需要像装 APP 一样安装技能包，AI 就立刻变专业了。一项技术的成功，不在于它有多复杂，而在于它能让普通用户不关注技术细节的情况下，感受到技术的价值。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87bae9ce0c0041278143780bbe0345bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=VPA3GQQ%2FxSjDACrxxJCpSLHvfj0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">结尾</h2>
<p>你点点头：学会了学废了！降低门槛，才是技术走向大众的钥匙。</p>
<p>鱼皮：没错，Agent Skills 不仅仅是个技术概念，更是一种新的工作方式。你可以把它融入到自己的日常工作中，比如把重复的任务封装成技能、把团队的最佳实践固化成技能，让 AI 真正成为你的得力助手。</p>
<p>在这个 Vibe Coding 盛行的年代，技术的门槛正在崩塌，而想象力的边界正在无限扩张。你可以在我免费开源的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fai-guide" target="_blank" title="https://github.com/liyupi/ai-guide" ref="nofollow noopener noreferrer">《AI 编程零基础入门教程》</a>中学到更多 AI 编程技巧，也欢迎关注我的账号，学习更多 AI 和编程的技巧。</p>
<blockquote>
<p>开源指路：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fai-guide" target="_blank" title="https://github.com/liyupi/ai-guide" ref="nofollow noopener noreferrer">github.com/liyupi/ai-g…</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69bfefb4b1a64d6486a59d7b401c707b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6bG855qu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770090477&amp;x-signature=PlSBNh0qn%2FA8BVZeXUv9tooGDkI%3D" alt="" loading="lazy"/></p>
<p>那么问题来了，你最想让 AI 学会什么技能呢？</p>
<h2 data-id="heading-11">更多</h2>
<p>💻 编程学习交流：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fcode-nav" target="_blank" title="https://github.com/liyupi/code-nav" ref="nofollow noopener noreferrer">编程导航</a> 📃 简历快速制作：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Flaoyujianli" target="_blank" title="https://github.com/liyupi/laoyujianli" ref="nofollow noopener noreferrer">老鱼简历</a> ✏️ 面试刷题神器：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fmianshiya" target="_blank" title="https://github.com/liyupi/mianshiya" ref="nofollow noopener noreferrer">面试鸭</a> 📖 AI 学习指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliyupi%2Fai-guide" target="_blank" title="https://github.com/liyupi/ai-guide" ref="nofollow noopener noreferrer">鱼皮 AI 导航</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个普通本科生，硬磕AI大模型的心路历程......]]></title>    <link>https://juejin.cn/post/7599591405313015849</link>    <guid>https://juejin.cn/post/7599591405313015849</guid>    <pubDate>2026-01-27T04:12:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599591405313015849" data-draft-id="7599591405312999465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个普通本科生，硬磕AI大模型的心路历程......"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2026-01-27T04:12:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个普通本科生，硬磕AI大模型的心路历程......
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:12:18.000Z" title="Tue Jan 27 2026 04:12:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我就是那种扔在人堆里找不着的普通本科生，二本院校，学的是万金油似的工商管理，没什么硬核技能，毕业就跟着大流进了家小公司做行政，每天复印文件、整理报表、应付各种杂事，混了大半年，越干越慌。</p>
<p>不是说行政不好，就是觉得这日子一眼望到头，拿着死工资，拼不过学历比我高的，也比不过会专业技能的，万一哪天公司裁员，我肯定是第一个被踢走的。那时候就总琢磨，得学点什么傍身，可又不知道从哪下手...编程听不懂，设计没天赋，考公又卷得离谱。</p>
<p>第一次接触AI大模型，还是同事用ChatGPT写周报，我凑过去看了一眼，惊得不行！原来还能这么玩？后来自己也试着用，写文案、改简历、甚至帮我梳理工作流程，越用越觉得这东西太顶了。那时候网上铺天盖地都是AI相关的新闻，我就动了心思：要不，试试转行做这个？</p>
<p>现在回头想，当时真是脑子一热，根本不知道AI大模型这行水有多深。我连Python都不会，更别说什么深度学习、神经网络了，跟个门外汉似的，连术语都听不懂。一开始跟着网上的教程学，老师讲得飞快，一堆公式和代码扔过来，我对着屏幕愣一下午，连复制粘贴都能搞错格式，越学越挫败，好几次都想放弃......</p>
<p>最崩溃的时候是第一次做小项目，想试着微调一个简单的模型，找数据、理逻辑、写代码，折腾了快一个星期，结果运行的时候全是报错，对着报错信息搜了半天，还是一头雾水。那天晚上在出租屋，看着电脑屏幕上密密麻麻的红色字体，真的有点绷不住，觉得自己就是自不量力，普通本科，没专业基础，凭什么跟那些计算机、自动化专业的人抢饭碗？</p>
<p>但又不甘心就这么算了。毕竟已经花了两个多月的时间，每天下班就坐在书桌前学到半夜，周末也泡在图书馆里，放弃了朋友聚会，也戒了刷短视频的习惯，要是就这么停了，之前的努力不都白费了？后来我就降低预期，不追求一下子学会多高深的内容，先从最基础的补起：每天背几个Python语法，看懂一段简单的代码，慢慢积累。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer"><strong>更多AI大模型学习视频及资源，都在智泊AI。</strong></a></p>
<p>我也没敢辞掉工作，毕竟还要靠工资交房租、吃饭，只能利用业余时间死磕。为了能跟上进度，我报了个AI大模型全栈班，虽然有点小贵，但老师能手把手教，遇到问题也能及时问，不用自己一个人瞎琢磨。班里的同学大多是计算机相关专业的，要么是应届生，要么是有工作经验的程序员，就我一个跨专业、零基础的普通本科，一开始都不好意思说话，怕问出的问题太傻被人笑话。</p>
<p>好在老师和同学都挺友好，慢慢我也放开了，遇到不懂的就问。到了项目阶段我就更加不敢懈怠了，毕竟大厂很看重这块，每次我都会把做项目的经验记在小本子上。有一次做文本生成的小练习，我熬了两个大夜，反复改代码、调参数，终于能生成一段通顺且符合要求的文字时，那种成就感，比拿了工资还开心。</p>
<p>就这样磕了快半年，我总算能独立做一些基础的大模型应用开发，比如简单的对话机器人、文本摘要工具。之后就开始投简历，投的都是中小型公司的AI助理、大模型应用岗，没敢碰那些大厂，因为我知道自己实力不够，先从小公司积累经验再说。</p>
<p>一开始我以为会卡学历和专业，没想到面试官只看重我的项目经验是否能落地，是否能衔接公司现有的业务发展，还问我做过的项目细节，我把自己做过的项目从头到尾讲了一遍，包括遇到的问题、怎么解决的，还有自己的优化思路等等。</p>
<p>其实，说实话，求职的那段时间压力特别大，一边要应付原公司的工作，一边要准备面试，还要接着补专业知识，有时候甚至怀疑，自己是不是真的不适合这行。但好在老师总会鼓励我，并且会教我怎么回答面试官的问题，再加上之前项目阶段的经验积累，我也算是游刃有余。面试结束后第三天，我就收到了录用通知。</p>
<p>现在我做AI大模型应用已经快半年了，工资比之前做行政高了不少，虽然每天还是要学习，但每天都过得很充实，再也没有之前那种迷茫感。</p>
<p>其实我知道，我不算成功，也不是什么逆袭大神，只是一个想拼一把的普通人。很多和我一样的普通本科生，可能都有过想转行的想法，又怕自己没基础、没学历，不敢迈出第一步。但我想说，没基础可以补，学历不够可以用项目经验凑，最怕的是连尝试的勇气都没有。</p>
<p>转行AI大模型这一路，我踩了无数个坑，熬了无数个夜，也有过无数次想放弃的瞬间，但好在我坚持下来了。它不是一条捷径，甚至比很多行业都难，但只要你愿意沉下心来积累，普通人也能在这行找到自己的位置。</p>
<p>另外，作为过来人我深知在这个转行过程中的迷茫，刚开始我也不知道从何开始，今天写这一篇文章也是想感慨一下自己的来时路，同时呢，也给天南地北的朋友们指条明路，让大家可以少走弯路，也趁着今天有空，我把我当时学大模型的一些学习路线、笔记素材、视频教程等资源都上传到我的网盘了，如果你现在还没有一个清晰的规划，可以参考一下我的。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer"><strong>更多AI大模型学习视频及资源，都在智泊AI。</strong></a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于Uniswap V2的闪电贷套利合约实现与分析]]></title>    <link>https://juejin.cn/post/7599565587154157594</link>    <guid>https://juejin.cn/post/7599565587154157594</guid>    <pubDate>2026-01-27T04:25:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599565587154157594" data-draft-id="7599604510366384166" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于Uniswap V2的闪电贷套利合约实现与分析"/> <meta itemprop="keywords" content="后端,算法"/> <meta itemprop="datePublished" content="2026-01-27T04:25:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cipher"/> <meta itemprop="url" content="https://juejin.cn/user/2242659448524872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于Uniswap V2的闪电贷套利合约实现与分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659448524872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cipher
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T04:25:14.000Z" title="Tue Jan 27 2026 04:25:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：闪电贷在 DeFi 中的核心作用</h2>
<p>在去中心化金融（DeFi）领域，闪电贷（Flash Loan）代表了区块链技术的一项革命性创新。它允许用户在无需提供抵押的情况下即时借入巨额资金，前提是必须在同一交易内完成偿还。这种机制充分利用了以太坊交易的原子性——即交易要么全部执行成功，要么全部回滚——从而为套利、清算和资本优化等复杂策略提供了安全高效的执行环境。本文将对基于 Uniswap V2 的闪电贷套利合约进行函数级别的细致剖析，结合测试案例和执行流程，揭示其背后的技术原理与实际应用价值。</p>
<p>Uniswap V2 作为恒定乘积自动做市商（AMM）的典范，其闪电兑换（Flash Swap）机制进一步扩展了闪电贷的应用边界。与传统闪电贷（如 Aave）要求偿还相同资产不同，Uniswap V2 的闪电兑换允许用户以等值其他资产偿付，这为跨池套利提供了更大的灵活性。通过本文的分析，您将深入理解这一机制如何在代码层面实现高效的资金循环。</p>
<h2 data-id="heading-1">一、合约接口与整体架构</h2>
<h3 data-id="heading-2">1.1 Uniswap V2 接口定义</h3>
<p>合约首先定义了三个核心接口，这些是与 Uniswap V2 协议交互的基础：</p>
<ul>
<li><code>IUniswapV2Pair</code>：处理代币对的核心操作，包括 <code>token0()</code>、<code>token1()</code>、<code>swap()</code> 和 <code>getReserves()</code>。这些方法确保了合约能精确查询储备并执行交换。</li>
<li><code>IUniswapV2Factory</code>：通过 <code>getPair()</code> 方法获取特定代币对的地址，实现动态池子定位。</li>
<li><code>IUniswapV2Router02</code>：提供 <code>getAmountOut()</code> 和 <code>getAmountIn()</code> 等纯函数，用于计算交换量，避免手动实现 AMM 公式可能引入的精度误差。</li>
</ul>
<p>这些接口的设计体现了模块化和标准化原则，确保合约与 Uniswap V2 的无缝集成，同时便于未来扩展。</p>
<h3 data-id="heading-3">1.2 状态变量与事件机制</h3>
<p>合约的状态变量设计简洁高效：</p>
<ul>
<li><code>uniswapV2Factory</code> 和 <code>uniswapV2Router</code>：存储协议地址，支持测试时的动态配置。</li>
<li><code>owner</code>：合约所有者，用于访问控制。</li>
<li><code>FlashSwapExecuted</code> 事件：记录套利执行细节，包括池子地址、代币类型、借贷量和利润，便于链上监控和审计。</li>
</ul>
<p>这种精炼的状态管理降低了存储成本，并提升了合约的安全性。</p>
<h2 data-id="heading-4">二、函数级代码剖析</h2>
<h3 data-id="heading-5">2.1 构造函数 (constructor)</h3>
<pre><code class="hljs language-solidity" lang="solidity">constructor() {
    uniswapV2Factory = 0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f;
    uniswapV2Router = 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D;
    owner = msg.sender;
}
</code></pre>
<p>构造函数初始化了 Uniswap V2 的主网地址，并设置所有者。这种硬编码方式确保了部署时的即用性，同时为生产环境提供了稳定性。</p>
<h3 data-id="heading-6">2.2 访问控制修饰符 (onlyOwner)</h3>
<pre><code class="hljs language-solidity" lang="solidity">modifier onlyOwner() {
    require(msg.sender == owner, 'Not owner');
    _;
}
</code></pre>
<p>这一修饰符构成了合约的安全基石，确保敏感操作（如套利执行和地址配置）仅限于所有者执行，防范潜在的外部滥用。</p>
<h3 data-id="heading-7">2.3 地址配置函数 (setUniswapAddresses)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function setUniswapAddresses(address factory, address router) external onlyOwner {
    uniswapV2Factory = factory;
    uniswapV2Router = router;
}
</code></pre>
<p>此函数增强了合约的适应性，允许在测试或分叉环境中切换地址，体现了开发中的最佳实践：生产与测试分离。</p>
<h3 data-id="heading-8">2.4 套利启动函数 (executeFlashSwap)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function executeFlashSwap(
    address poolA, // 价格较低的池子
    address poolB, // 价格较高的池子
    address tokenA, // 要借贷的代币
    address tokenB, // 要交换的代币
    uint256 amountToBorrow // 借贷数量
) external onlyOwner {
    // 验证池子地址
    require(poolA != address(0) &amp;&amp; poolB != address(0), 'Invalid pool addresses');

    // 从 poolA 开始闪电贷
    IUniswapV2Pair pair = IUniswapV2Pair(poolA);
    address token0 = pair.token0();
    address token1 = pair.token1();

    uint256 amount0Out = tokenA == token0 ? amountToBorrow : 0;
    uint256 amount1Out = tokenA == token1 ? amountToBorrow : 0;

    // 编码数据传递给回调函数
    bytes memory data = abi.encode(poolB, tokenA, tokenB, amountToBorrow);

    // 执行闪电贷
    pair.swap(amount0Out, amount1Out, address(this), data);
}
</code></pre>
<p>作为套利的入口，此函数验证输入、编码回调数据，并触发 <code>swap()</code> 以启动闪电兑换。关键在于数据编码，确保回调函数能访问必要参数。</p>
<h3 data-id="heading-9">2.5 回调核心函数 (uniswapV2Call)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function uniswapV2Call(address sender, uint256 amount0, uint256 amount1, bytes calldata data) external {
    // 验证调用者是合法的 Uniswap V2 配对合约
    address token0 = IUniswapV2Pair(msg.sender).token0();
    address token1 = IUniswapV2Pair(msg.sender).token1();
    address pair = IUniswapV2Factory(uniswapV2Factory).getPair(token0, token1);
    require(msg.sender == pair, 'Invalid pair');
    require(sender == address(this), 'Invalid sender');

    // 解码数据
    (address poolB, address _tokenA, address _tokenB, uint256 amountBorrowed) = abi.decode(
      data,
      (address, address, address, uint256)
    );

    // 获取借到的代币数量
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Borrowed tokenA", amountBorrowed);
    uint256 amountReceived = amount0 &gt; 0 ? amount0 : amount1;
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Expected TokenA:", amountReceived);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Received TokenA:", IERC20(_tokenA).balanceOf(address(this)));
    
    // 在 poolB 中将 tokenA 兑换为 tokenB
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; In poolB, exchange tokenA to tokenB");
    _swapOnPool(poolB, _tokenA, _tokenB, amountReceived);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Received TokenB:", IERC20(_tokenB).balanceOf(address(this)));

    // 计算需要还款的数量（包含手续费）
    uint256 amountToRepay = _calculateRepayAmount(amountBorrowed);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Need repay TokenA:", amountToRepay);

    // 从amountOut中拿出一部分用于还款
    // 这里我们计算需要多少_tokenB来偿还所需的_tokenA（计算输出需要偿还的amountToRepay个A，需要输入多少个B）
    uint256 amountToSwapBack = _calculateAmountToSwapBack(msg.sender, _tokenB, amountToRepay);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Need repay TokenB for TokenA in poolA:", amountToSwapBack);

    // 检查我们是否有足够多的_tokenB用于偿还_tokenA
    uint256 balanceOfTokenB = IERC20(_tokenB).balanceOf(address(this));
    require(balanceOfTokenB &gt;= amountToSwapBack, 'Insufficient tokenB for repayment');
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; balanceOfTokenB:", IERC20(_tokenB).balanceOf(address(this)));

    // 转移_tokenB给配对合约（msg.sender 是 poolA）
    IERC20(_tokenB).transfer(msg.sender, amountToSwapBack);

    // 现在我们已经把需要的_tokenB发送给配对合约，配对合约会将其与它持有的_tokenA进行交换
    // 这里不再直接调用swap，而是通过配对合约在swap结束时自动完成交换
    // 配对合约会验证我们是否返回了足够的_tokenA

    // 由于我们已经发送了正确的amountToSwapBack到配对合约A
    // 并且我们计算了所需的还款金额，所以合约能验证通过

    // 计算利润
    uint256 remainingTokenB = IERC20(_tokenB).balanceOf(address(this));
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Remaining TokenB:", remainingTokenB);

    // 将剩余代币转给 owner
    if (remainingTokenB &gt; 0) {
      IERC20(_tokenB).transfer(owner, remainingTokenB);
    }

    emit FlashSwapExecuted(msg.sender, poolB, _tokenA, _tokenB, amountBorrowed, remainingTokenB);
  }
</code></pre>
<p>此函数是闪电兑换的核心引擎：验证调用者、解码数据、执行套利交换、计算并偿还借款，最后转移利润。日志输出便于调试，强调了资金流动的透明性。</p>
<h3 data-id="heading-10">2.6 内部交换函数 (_swapOnPool)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function _swapOnPool(address pool, address tokenIn, address tokenOut, uint256 amountIn) internal {
    IUniswapV2Pair pair = IUniswapV2Pair(pool); // poolB
    (uint112 reserve0, uint112 reserve1, ) = pair.getReserves();

    address _token0 = pair.token0();

    bool token0IsTokenIn = tokenIn == _token0;

    (uint112 reserveIn, uint112 reserveOut) = token0IsTokenIn ? (reserve0, reserve1) : (reserve1, reserve0);

    // 计算输出数量
    uint256 amountOut = IUniswapV2Router02(uniswapV2Router).getAmountOut(amountIn, reserveIn, reserveOut);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Expected TokenB:", amountOut);

    // 转移代币到配对合约
    IERC20(tokenIn).transfer(pool, amountIn);

    // 执行交换 - 根据tokenIn是token0还是token1来确定输出方向
    uint256 amount0Out = tokenOut == _token0 ? amountOut : 0;
    uint256 amount1Out = tokenOut == _token0 ? 0 : amountOut;

    pair.swap(amount0Out, amount1Out, address(this), new bytes(0));
}
</code></pre>
<p>函数处理套利中的关键交换步骤，利用路由计算输出并执行 <code>swap()</code>，确保滑点最小化。</p>
<h3 data-id="heading-11">2.7 还款计算函数 (_calculateRepayAmount)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function _calculateRepayAmount(uint256 amountBorrowed) internal pure returns (uint256) {
    // Uniswap V2 手续费是 0.3%
    return (amountBorrowed * 1000) / 997 + 1;
}
</code></pre>
<p>此纯函数精确计算 Uniswap V2 的 0.3% 手续费溢价，确保偿还符合 AMM 的 K 值恒定要求。</p>
<h3 data-id="heading-12">2.8 反向交换计算 (_calculateAmountToSwapBack)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function _calculateAmountToSwapBack(
    address pool,
    address tokenIn,
    uint256 amountOutNeeded
) internal view returns (uint256 amountIn) {
    IUniswapV2Pair pair = IUniswapV2Pair(pool); // poolA
    (uint112 reserve0, uint112 reserve1, ) = pair.getReserves();

    address _token0 = pair.token0();
    bool token0IsTokenIn = tokenIn == _token0;

    (uint112 reserveIn, uint112 reserveOut) = token0IsTokenIn ? (reserve0, reserve1) : (reserve1, reserve0);

    amountIn = IUniswapV2Router02(uniswapV2Router).getAmountIn(amountOutNeeded, reserveIn, reserveOut);
}
</code></pre>
<p>利用 <code>getAmountIn()</code> 计算偿还所需输入量，避免手动公式计算的潜在误差。</p>
<h3 data-id="heading-13">2.9 紧急撤资函数 (emergencyWithdraw)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function emergencyWithdraw(address token) external onlyOwner {
    uint256 balance = IERC20(token).balanceOf(address(this));
    if (balance &gt; 0) {
        IERC20(token).transfer(owner, balance);
    }
}
</code></pre>
<p>作为后备机制，此函数允许所有者提取资金，增强合约的鲁棒性。</p>
<h2 data-id="heading-14">三、测试环境与函数分析</h2>
<h3 data-id="heading-15">3.1 Mock 模拟合约</h3>
<p>测试使用 Mock 版本模拟 ERC20、Pair、Factory 和 Router，确保隔离环境下的可控性。这些模拟实现了核心逻辑，如 K 值验证（<code>balance0Adjusted * balance1Adjusted &gt;= _reserve0 * _reserve1 * 1000**2</code>），准确复现 Uniswap V2 的行为。</p>
<h3 data-id="heading-16">3.2 初始化函数 (setUp)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function setUp() public {
    // 部署代币
    tokenA = new MockERC20("Token A", "TKA");
    tokenB = new MockERC20("Token B", "TKB");

    // 部署工厂和路由器
    factory = new MockUniswapV2Factory();
    router = new MockUniswapV2Router();

    // 部署配对合约
    poolA = new MockUniswapV2Pair(address(tokenA), address(tokenB));
    poolB = new MockUniswapV2Pair(address(tokenA), address(tokenB));

    // 设置工厂中的配对信息
    factory.setPair(address(tokenA), address(tokenB), address(poolA));

    // 设置初始储备 (pairA: 1A = 1000B, 即 1:1000 的比例)
    // 设置为 1000000 A 和 1000000000 B (比例为 1:1000)
    tokenA.mint(address(poolA), 1000000);
    tokenB.mint(address(poolA), 1000000000);
    poolA.setReserves(1000000, 1000000000);

    // 设置pairB的储备 (pairB: 1A = 1300B, 即 1:1300 的比例)
    // 设置为 1000000 A 和 1300000000 B (比例为 1:1300)
    tokenA.mint(address(poolB), 1000000);
    tokenB.mint(address(poolB), 1300000000);
    poolB.setReserves(1000000, 1300000000);

    // 部署FlashSwapTestable合约
    flashSwap = new FlashSwap();

    // 设置模拟的工厂和路由器地址
    flashSwap.setUniswapAddresses(address(factory), address(router));

    // 将FlashSwapTestable合约的owner设置为测试合约（当前this）
    // flashSwap合约的当前owner是部署合约时的msg.sender（也就是FlashSwapTest合约）
    // 因此owner变量应该设置为FlashSwapTest合约的地址
    owner = address(this);
}
</code></pre>
<p>初始化创建价差场景（PoolA: 1A=1000B；PoolB: 1A=1300B），模拟真实套利机会。</p>
<h3 data-id="heading-17">3.3 套利测试函数 (testFlashSwapArbitrage)</h3>
<pre><code class="hljs language-solidity" lang="solidity">function testFlashSwapArbitrage() public {
        // 测试用例：验证FlashSwap套利交易逻辑
        // 场景：pairA中1A=1000B， pairB中1A=1300B
        // 从pairA借出来100个A，在pairB中用100个A兑换B代币，再在pairA中将B换成A还回去

        // 记录初始状态
        uint256 initialTokenABalance = tokenA.balanceOf(owner);
        uint256 initialTokenBBalance = tokenB.balanceOf(owner);

        console.log("Initial A Balance:", initialTokenABalance);
        console.log("Initial B Balance:", initialTokenBBalance);

        // 调用FlashSwap合约进行套利交易
        // 从poolA借A代币，在poolB中进行套利
        flashSwap.executeFlashSwap(
            address(poolA),     // 从poolA借A代币
            address(poolB),     // 在poolB中进行套利
            address(tokenA),    // 借贷的代币是A
            address(tokenB),    // 交换的目标代币是B
            100                 // 借贷数量是100
        );

        // 检查是否获利
        uint256 finalTokenABalance = tokenA.balanceOf(owner);
        uint256 finalTokenBBalance = tokenB.balanceOf(owner);

        console.log("Final A Balance:", finalTokenABalance);
        console.log("Final B Balance:", finalTokenBBalance);
        console.log("A Balance Change:", int(finalTokenABalance) - int(initialTokenABalance));
        console.log("B Balance Change:", int(finalTokenBBalance) - int(initialTokenBBalance));

        // 验证最终的B代币余额有所增加（套利获利）
        // 初始B代币余额应该加上最终收益等于最终B代币余额
        assertGt(finalTokenBBalance, initialTokenBBalance);

        // 输出日志显示获利结果
        console.log("B Token Profit:", finalTokenBBalance - initialTokenBBalance);
    }
</code></pre>
<p>测试验证了从借贷到利润转移的全链路，确保逻辑无误。</p>
<h2 data-id="heading-18">四、执行流程与结果剖析</h2>
<p>为直观展示套利流程，以下是基于测试案例的时序图，描绘了关键交互：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Owner as Owner
    participant FlashSwap as FlashSwap Contract
    participant PoolA as PoolA (borrowing pool)
    participant PoolB as PoolB (arbitrage pool)
    participant TokenA as TokenA
    participant TokenB as TokenB
    participant Router as Uniswap Router

    Note over Owner,TokenB: 设置阶段：根据合约初始化和测试用例
    Note over Owner,TokenB: poolA: 1A = 1000B (1,000,000 A : 1,000,000,000 B)
    Note over Owner,TokenB: poolB: 1A = 1300B (1,000,000 A : 1,300,000,000 B)
    Note over Owner,TokenB: 借贷: 100 TokenA
    Owner-&gt;&gt;FlashSwap: executeFlashSwap(poolA, poolB, TokenA, TokenB, 100)
    activate FlashSwap
    FlashSwap-&gt;&gt;PoolA: swap(amount0Out=100, amount1Out=0, address(this), data)
    activate PoolA
    Note over PoolA: 在swap函数中触发uniswapV2Call回调
    PoolA-&gt;&gt;FlashSwap: uniswapV2Call(this, 100, 0, data)
    activate FlashSwap
    Note over FlashSwap: 1. 验证调用者
    Note over FlashSwap: 2. 计算借贷数量: received 100 TokenA
    Note over FlashSwap: 3. 查询当前TokenA余额: IERC20(_tokenA).balanceOf
    Note over FlashSwap: 预期收到: 100 TokenA, 实际借到: 100 TokenA

    FlashSwap-&gt;&gt;PoolB: _swapOnPool() - exchange 100 TokenA to TokenB
    Note over FlashSwap: 调用_swapOnPool(poolB, TokenA, TokenB, 100)
    activate PoolB
    PoolB-&gt;&gt;TokenA: transfer(poolB, 100 TokenA)
    TokenA-&gt;&gt;PoolB: transfer completed
    PoolB-&gt;&gt;FlashSwap: swap(0, 129597, address(this), new bytes(0))
    FlashSwap-&gt;&gt;PoolB: receive TokenB from swap (129597 TokenB)
    deactivate PoolB

    Note over FlashSwap: 4. 在poolB中完成交换: 100 TokenA -&gt; 129597 TokenB
    Note over FlashSwap: 根据合约池B比例 1:1300, 100 A 应兑换 129597 TokenB
    Note over FlashSwap: amountOut = 100 * 997 / (1000000 * 1000 + 100 * 997) * 1300000000 ≈ 129597

    Note over FlashSwap: 5. 计算还款金额: 100 * 1000 / 997 + 1 = 101 TokenA 
    Note over FlashSwap: 6. 计算在poolA中需要交换多少TokenB来还TokenA
    Note over FlashSwap: amountIn = 1000 * 1000000000 * 101 / (997 * (1000000 - 101)) + 1 ≈ 101315
    FlashSwap-&gt;&gt;Router: _calculateAmountToSwapBack(poolA, TokenB, 101)
    Router-&gt;&gt;FlashSwap: return 101315 TokenB required

    Note over FlashSwap: 7. 验证TokenB余额: balanceOf &gt;= 101315 TokenB 
    Note over FlashSwap: 8. 需要还款101 TokenA，需用101315 TokenB交换(101315来自_tokenB)
    FlashSwap-&gt;&gt;PoolA: transfer(101315 TokenB to pairA contract)
    deactivate FlashSwap

    Note over PoolA: 9. 配对合约A自动计算并验证是否返回足够TokenA
    Note over PoolA: 根据公式 balanceAAdjusted * balanceBAdjusted &gt;= _reserveA * _reserveB
    Note over PoolA: 借出100 TokenA，收到101315 TokenB，计算是否返还足额TokenA
    Note over PoolA: balanceAAdjusted = balanceA - amountAIn * 0.003 = 999900 - 0 * 0.003 = 999900
    Note over PoolA: balanceBAdjusted = balanceB - amountBIn * 0.003 = 1000101315 - 101315 * 0.003 ≈ 1000101011
    Note over PoolA: _reserveA = 1000000
    Note over PoolA: _reserveB = 1000000000
    Note over PoolA: 如果计算结果 999900 * 1000101011 ≥ 1000000 * 1000000000，则验证通过，交易完成
    PoolA--&gt;&gt;FlashSwap: Verify repayment and complete transaction

    Note over FlashSwap: Profit calculation:
    Note over FlashSwap: 总TokenB获得: 129597, 用于还款: 101315, 剩余: 28282 TokenB
    FlashSwap-&gt;&gt;Owner: transfer(remaining 28282 TokenB to owner)
    deactivate PoolA
    Note over Owner,FlashSwap: FlashSwap套利完成，获得28282 TokenB利润
</code></pre>
<p>测试执行输出如下，展示了资金流动的精确轨迹：</p>
<pre><code class="hljs language-bash" lang="bash">$ forge <span class="hljs-built_in">test</span> --match-test testFlashSwapArbitrage -vvv
[⠊] Compiling...
[⠰] Compiling 1 files with Solc 0.8.30
[⠔] Solc 0.8.30 finished <span class="hljs-keyword">in</span> 4.49s
Compiler run successful!

Ran 1 <span class="hljs-built_in">test</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">test</span>/FlashSwap.t.sol:FlashSwapTest
[PASS] testFlashSwapArbitrage() (gas: 176830)
Logs:
  Initial A Balance: 0
  Initial B Balance: 0
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Borrowed tokenA 100
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Expected TokenA: 100
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Received TokenA: 100
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; In poolB, exchange tokenA to tokenB
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Expected TokenB: 129597
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; amount0In: 100
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; amount1In: 0
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; balance0: 1000100
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; balance1: 1299870403
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; _reserve0: 1000000
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; _reserve1: 1300000000
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Received TokenB: 129597
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Need repay TokenA: 101
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Need repay TokenB <span class="hljs-keyword">for</span> TokenA <span class="hljs-keyword">in</span> poolA: 101315
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; balanceOfTokenB: 129597
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Remaining TokenB: 28282
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; amount0In: 0
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; amount1In: 101315
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; balance0: 999900
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; balance1: 1000101315
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; _reserve0: 1000000
  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; _reserve1: 1000000000
  Final A Balance: 0
  Final B Balance: 28282
  A Balance Change: 0
  B Balance Change: 28282
  B Token Profit: 28282
</code></pre>
<p>从输出可见，借入 100 TokenA，在 PoolB 兑换为 129,597 TokenB；偿还需 101 TokenA（含费），对应 101,315 TokenB；最终利润 28,282 TokenB。价差 30% 被手续费和滑点压缩至约 28%，体现了 AMM 的动态定价机制。</p>
<h2 data-id="heading-19">五、安全性与风险评估</h2>
<p>尽管强大，闪电贷合约需警惕风险：</p>
<ul>
<li><strong>价格操纵</strong>：攻击者可能通过大额交易扭曲池子价格。</li>
<li><strong>重入攻击</strong>：回调机制需严格验证调用者。</li>
<li><strong>Gas 消耗</strong>：复杂逻辑可能导致交易失败或 MEV 抢跑。</li>
<li><strong>流动性风险</strong>：池子深度不足可能放大滑点。</li>
</ul>
<p>推荐集成 Chainlink 预言机作为价格校验，并进行全面审计。</p>
<h2 data-id="heading-20">六、结语与应用展望</h2>
<p>闪电贷不仅是技术创新，更是 DeFi 效率的体现。通过本文的剖析，我们见证了 Uniswap V2 如何通过原子交易实现无风险套利。这一机制在实际中可扩展至三角套利、多链桥接等领域，推动 DeFi 的进一步成熟。开发者应注重安全与优化，以最大化其潜力。</p>
<h2 data-id="heading-21">附录：完整合约代码</h2>
<p>@contracts/src/FlashSwap.sol:</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.13;

import '@openzeppelin/contracts/token/ERC20/IERC20.sol';
import "forge-std/console.sol";

interface IUniswapV2Pair {
  function token0() external view returns (address);

  function token1() external view returns (address);

  function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external;

  function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast);
}

interface IUniswapV2Factory {
  function getPair(address tokenA, address tokenB) external view returns (address pair);
}

interface IUniswapV2Router02 {
  function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) external pure returns (uint amountOut);

  function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut) external pure returns (uint amountIn);
}

// 测试版本的FlashSwap合约，允许设置工厂和路由器地址
contract FlashSwap {
  address public uniswapV2Factory;
  address public uniswapV2Router;

  address public owner;

  event FlashSwapExecuted(
    address indexed poolA,
    address indexed poolB,
    address tokenA,
    address tokenB,
    uint256 amountBorrowed,
    uint256 profit
  );

  modifier onlyOwner() {
    require(msg.sender == owner, 'Not owner');
    _;
  }

  constructor() {
    uniswapV2Factory = 0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f;
    uniswapV2Router = 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D;
    owner = msg.sender;
  }

  // 允许测试时设置工厂和路由器地址
  function setUniswapAddresses(address factory, address router) external onlyOwner {
    uniswapV2Factory = factory;
    uniswapV2Router = router;
  }

  // 执行闪电兑换套利
  function executeFlashSwap(
    address poolA, // 价格较低的池子
    address poolB, // 价格较高的池子
    address tokenA, // 要借贷的代币
    address tokenB, // 要交换的代币
    uint256 amountToBorrow // 借贷数量
  ) external onlyOwner {
    // 验证池子地址
    require(poolA != address(0) &amp;&amp; poolB != address(0), 'Invalid pool addresses');

    // 从 poolA 开始闪电贷
    IUniswapV2Pair pair = IUniswapV2Pair(poolA);
    address token0 = pair.token0();
    address token1 = pair.token1();

    uint256 amount0Out = tokenA == token0 ? amountToBorrow : 0;
    uint256 amount1Out = tokenA == token1 ? amountToBorrow : 0;

    // 编码数据传递给回调函数
    bytes memory data = abi.encode(poolB, tokenA, tokenB, amountToBorrow);

    // 执行闪电贷
    pair.swap(amount0Out, amount1Out, address(this), data);
  }

  // Uniswap V2 回调函数
  function uniswapV2Call(address sender, uint256 amount0, uint256 amount1, bytes calldata data) external {
    // 验证调用者是合法的 Uniswap V2 配对合约
    address token0 = IUniswapV2Pair(msg.sender).token0();
    address token1 = IUniswapV2Pair(msg.sender).token1();
    address pair = IUniswapV2Factory(uniswapV2Factory).getPair(token0, token1);
    require(msg.sender == pair, 'Invalid pair');
    require(sender == address(this), 'Invalid sender');

    // 解码数据
    (address poolB, address _tokenA, address _tokenB, uint256 amountBorrowed) = abi.decode(
      data,
      (address, address, address, uint256)
    );

    // 获取借到的代币数量
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Borrowed tokenA", amountBorrowed);
    uint256 amountReceived = amount0 &gt; 0 ? amount0 : amount1;
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Expected TokenA:", amountReceived);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Received TokenA:", IERC20(_tokenA).balanceOf(address(this)));
    

    // 在 poolB 中将 tokenA 兑换为 tokenB
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; In poolB, exchange tokenA to tokenB");
    _swapOnPool(poolB, _tokenA, _tokenB, amountReceived);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Received TokenB:", IERC20(_tokenB).balanceOf(address(this)));

    // 计算需要还款的数量（包含手续费）
    uint256 amountToRepay = _calculateRepayAmount(amountBorrowed);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Need repay TokenA:", amountToRepay);

    // 从amountOut中拿出一部分用于还款
    // 这里我们计算需要多少_tokenB来偿还所需的_tokenA（计算输出需要偿还的amountToRepay个A，需要输入多少个B）
    uint256 amountToSwapBack = _calculateAmountToSwapBack(msg.sender, _tokenB, amountToRepay);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Need repay TokenB for TokenA in poolA:", amountToSwapBack);

    // 检查我们是否有足够多的_tokenB用于偿还_tokenA
    uint256 balanceOfTokenB = IERC20(_tokenB).balanceOf(address(this));
    require(balanceOfTokenB &gt;= amountToSwapBack, 'Insufficient tokenB for repayment');
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; balanceOfTokenB:", IERC20(_tokenB).balanceOf(address(this)));

    // 转移_tokenB给配对合约（msg.sender 是 poolA）
    IERC20(_tokenB).transfer(msg.sender, amountToSwapBack);

    // 现在我们已经把需要的_tokenB发送给配对合约，配对合约会将其与它持有的_tokenA进行交换
    // 这里不再直接调用swap，而是通过配对合约在swap结束时自动完成交换
    // 配对合约会验证我们是否返回了足够的_tokenA

    // 由于我们已经发送了正确的amountToSwapBack到配对合约A
    // 并且我们计算了所需的还款金额，所以合约能验证通过

    // 计算利润
    uint256 remainingTokenB = IERC20(_tokenB).balanceOf(address(this));
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Remaining TokenB:", remainingTokenB);

    // 将剩余代币转给 owner
    if (remainingTokenB &gt; 0) {
      IERC20(_tokenB).transfer(owner, remainingTokenB);
    }

    emit FlashSwapExecuted(msg.sender, poolB, _tokenA, _tokenB, amountBorrowed, remainingTokenB);
  }

  // 执行交换
  function _swapOnPool(address pool, address tokenIn, address tokenOut, uint256 amountIn) internal {
    IUniswapV2Pair pair = IUniswapV2Pair(pool); // poolB
    (uint112 reserve0, uint112 reserve1, ) = pair.getReserves();

    address _token0 = pair.token0();

    bool token0IsTokenIn = tokenIn == _token0;

    (uint112 reserveIn, uint112 reserveOut) = token0IsTokenIn ? (reserve0, reserve1) : (reserve1, reserve0);

    // 计算输出数量
    uint256 amountOut = IUniswapV2Router02(uniswapV2Router).getAmountOut(amountIn, reserveIn, reserveOut);
    console.log("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Expected TokenB:", amountOut);

    // 转移代币到配对合约
    IERC20(tokenIn).transfer(pool, amountIn);

    // 执行交换 - 根据tokenIn是token0还是token1来确定输出方向
    uint256 amount0Out = tokenOut == _token0 ? amountOut : 0;
    uint256 amount1Out = tokenOut == _token0 ? 0 : amountOut;

    pair.swap(amount0Out, amount1Out, address(this), new bytes(0));
  }

  // 计算需要交换回去的数量
  function _calculateAmountToSwapBack(
    address pool,
    address tokenIn,
    uint256 amountOutNeeded
  ) internal view returns (uint256 amountIn) {
    IUniswapV2Pair pair = IUniswapV2Pair(pool); // poolA
    (uint112 reserve0, uint112 reserve1, ) = pair.getReserves();

    address _token0 = pair.token0();
    bool token0IsTokenIn = tokenIn == _token0;

    (uint112 reserveIn, uint112 reserveOut) = token0IsTokenIn ? (reserve0, reserve1) : (reserve1, reserve0);

    amountIn = IUniswapV2Router02(uniswapV2Router).getAmountIn(amountOutNeeded, reserveIn, reserveOut);
  }

  // 计算还款数量（包含 0.3% 手续费）
  function _calculateRepayAmount(uint256 amountBorrowed) internal pure returns (uint256) {
    // Uniswap V2 手续费是 0.3%
    return (amountBorrowed * 1000) / 997 + 1;
  }

  // 紧急提取函数
  function emergencyWithdraw(address token) external onlyOwner {
    uint256 balance = IERC20(token).balanceOf(address(this));
    if (balance &gt; 0) {
      IERC20(token).transfer(owner, balance);
    }
  }
}
</code></pre>
<p>@contracts/test/FlashSwap.t.sol:</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "forge-std/Test.sol";
import "forge-std/console.sol";
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "../src/FlashSwap.sol";

// 为 Mock 合约添加的接口定义
interface IUniswapV2Callee {
    function uniswapV2Call(address sender, uint amount0, uint amount1, bytes calldata data) external;
}

contract MockERC20 is ERC20 {
    constructor(string memory name, string memory symbol) ERC20(name, symbol) {}

    function mint(address to, uint256 amount) public {
        _mint(to, amount);
    }

    function burn(address from, uint256 amount) public {
        _burn(from, amount);
    }
}

contract MockUniswapV2Pair is IUniswapV2Pair {
    address public token0;
    address public token1;
    uint112 public reserve0;
    uint112 public reserve1;
    uint32 public blockTimestampLast;

    constructor(address _token0, address _token1) {
        token0 = _token0;
        token1 = _token1;
        reserve0 = 0;
        reserve1 = 0;
        blockTimestampLast = uint32(block.timestamp);
    }

    function setReserves(uint112 _reserve0, uint112 _reserve1) external {
        reserve0 = _reserve0;
        reserve1 = _reserve1;
        blockTimestampLast = uint32(block.timestamp);
    }

    function getReserves() public view returns (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast) {
        return (reserve0, reserve1, blockTimestampLast);
    }

    function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external {
        require(amount0Out &gt; 0 || amount1Out &gt; 0, 'UniswapV2: INSUFFICIENT_OUTPUT_AMOUNT');
        (uint112 _reserve0, uint112 _reserve1,) = getReserves(); // gas savings
        require(amount0Out &lt; _reserve0 &amp;&amp; amount1Out &lt; _reserve1, 'UniswapV2: INSUFFICIENT_LIQUIDITY');

        uint balance0;
        uint balance1;
        { // scope for _token{0,1}, avoids stack too deep errors
            address _token0 = token0;
            address _token1 = token1;
            require(to != _token0 &amp;&amp; to != _token1, 'UniswapV2: INVALID_TO');
            if (amount0Out &gt; 0) MockERC20(token0).transfer(to, amount0Out); // optimistically transfer tokens
            if (amount1Out &gt; 0) MockERC20(token1).transfer(to, amount1Out); // optimistically transfer tokens
            if (data.length &gt; 0) {
                // 假设to地址实现了uniswapV2Call回调函数
                // 这个函数会被FlashSwap等合约实现，用于处理闪贷逻辑
                (bool success,) = to.call(abi.encodeWithSignature("uniswapV2Call(address,uint256,uint256,bytes)",
                    msg.sender, amount0Out, amount1Out, data));
                require(success, "Uniswap V2 callback failed");
            }
            balance0 = IERC20(_token0).balanceOf(address(this));
            balance1 = IERC20(_token1).balanceOf(address(this));
        }
        uint amount0In = balance0 &gt; _reserve0 - amount0Out ? balance0 - (_reserve0 - amount0Out) : 0;
        uint amount1In = balance1 &gt; _reserve1 - amount1Out ? balance1 - (_reserve1 - amount1Out) : 0;
        require(amount0In &gt; 0 || amount1In &gt; 0, 'UniswapV2: INSUFFICIENT_INPUT_AMOUNT');
        { // scope for reserve{0,1}Adjusted, avoids stack too deep errors
            uint balance0Adjusted = balance0 * 1000 - amount0In * 3;
            uint balance1Adjusted = balance1 * 1000 - amount1In * 3;
            require(balance0Adjusted * balance1Adjusted &gt;= uint(_reserve0) * _reserve1 * 1000 ** 2, 'UniswapV2: K');
        }

        _update(balance0, balance1, _reserve0, _reserve1);
    }

    function _update(uint balance0, uint balance1, uint112 _reserve0, uint112 _reserve1) private {
        uint32 blockTimestamp = uint32(block.timestamp % 2 ** 32);
        uint32 timeElapsed = blockTimestamp - blockTimestampLast; // overflow is desired
        if (timeElapsed &gt; 0 &amp;&amp; _reserve0 != 0 &amp;&amp; _reserve1 != 0) {
            // 仅测试，不做任何操作
        }
        reserve0 = uint112(balance0);
        reserve1 = uint112(balance1);
        blockTimestampLast = blockTimestamp;
    }
}

contract MockUniswapV2Factory is IUniswapV2Factory {
    mapping(address =&gt; mapping(address =&gt; address)) public getPair;

    function setPair(address tokenA, address tokenB, address pair) external {
        getPair[tokenA][tokenB] = pair;
        getPair[tokenB][tokenA] = pair; // Uniswap V2 工厂函数是双向对称的
    }
}

contract MockUniswapV2Router is IUniswapV2Router02 {
    // Uniswap V2 公式计算函数
    function getAmountOut(uint amountIn, uint reserveIn, uint reserveOut) external pure returns (uint amountOut) {
        require(amountIn &gt; 0, "UniswapV2Library: INSUFFICIENT_INPUT_AMOUNT");
        require(reserveIn &gt; 0 &amp;&amp; reserveOut &gt; 0, "UniswapV2Library: INSUFFICIENT_LIQUIDITY");
        uint amountInWithFee = amountIn * 997;
        uint numerator = amountInWithFee * reserveOut;
        uint denominator = (reserveIn * 1000) + amountInWithFee;
        amountOut = numerator / denominator;
    }

    function getAmountIn(uint amountOut, uint reserveIn, uint reserveOut) external pure returns (uint amountIn) {
        require(amountOut &gt; 0, "UniswapV2Library: INSUFFICIENT_OUTPUT_AMOUNT");
        require(reserveIn &gt; 0 &amp;&amp; reserveOut &gt; 0, "UniswapV2Library: INSUFFICIENT_LIQUIDITY");
        uint numerator = reserveIn * amountOut * 1000;
        uint denominator = (reserveOut - amountOut) * 997;
        amountIn = (numerator / denominator) + 1;
    }
}

contract FlashSwapTest is Test {
    FlashSwap public flashSwap;
    MockERC20 public tokenA;
    MockERC20 public tokenB;
    MockUniswapV2Pair public poolA;
    MockUniswapV2Pair public poolB;
    MockUniswapV2Factory public factory;
    MockUniswapV2Router public router;

    address public owner;

    function setUp() public {
        // 部署代币
        tokenA = new MockERC20("Token A", "TKA");
        tokenB = new MockERC20("Token B", "TKB");

        // 部署工厂和路由器
        factory = new MockUniswapV2Factory();
        router = new MockUniswapV2Router();

        // 部署配对合约
        poolA = new MockUniswapV2Pair(address(tokenA), address(tokenB));
        poolB = new MockUniswapV2Pair(address(tokenA), address(tokenB));

        // 设置工厂中的配对信息
        factory.setPair(address(tokenA), address(tokenB), address(poolA));

        // 设置初始储备 (pairA: 1A = 1000B, 即 1:1000 的比例)
        // 设置为 1000000 A 和 1000000000 B (比例为 1:1000)
        tokenA.mint(address(poolA), 1000000);
        tokenB.mint(address(poolA), 1000000000);
        poolA.setReserves(1000000, 1000000000);

        // 设置pairB的储备 (pairB: 1A = 1300B, 即 1:1300 的比例)
        // 设置为 1000000 A 和 1300000000 B (比例为 1:1300)
        tokenA.mint(address(poolB), 1000000);
        tokenB.mint(address(poolB), 1300000000);
        poolB.setReserves(1000000, 1300000000);

        // 部署FlashSwapTestable合约
        flashSwap = new FlashSwap();

        // 设置模拟的工厂和路由器地址
        flashSwap.setUniswapAddresses(address(factory), address(router));

        // 将FlashSwapTestable合约的owner设置为测试合约（当前this）
        // flashSwap合约的当前owner是部署合约时的msg.sender（也就是FlashSwapTest合约）
        // 因此owner变量应该设置为FlashSwapTest合约的地址
        owner = address(this);
    }

    function testFlashSwapArbitrage() public {
        // 测试用例：验证FlashSwap套利交易逻辑
        // 场景：pairA中1A=1000B， pairB中1A=1300B
        // 从pairA借出来100个A，在pairB中用100个A兑换B代币，再在pairA中将B换成A还回去

        // 记录初始状态
        uint256 initialTokenABalance = tokenA.balanceOf(owner);
        uint256 initialTokenBBalance = tokenB.balanceOf(owner);

        console.log("Initial A Balance:", initialTokenABalance);
        console.log("Initial B Balance:", initialTokenBBalance);

        // 调用FlashSwap合约进行套利交易
        // 从poolA借A代币，在poolB中进行套利
        flashSwap.executeFlashSwap(
            address(poolA),     // 从poolA借A代币
            address(poolB),     // 在poolB中进行套利
            address(tokenA),    // 借贷的代币是A
            address(tokenB),    // 交换的目标代币是B
            100                 // 借贷数量是100
        );

        // 检查是否获利
        uint256 finalTokenABalance = tokenA.balanceOf(owner);
        uint256 finalTokenBBalance = tokenB.balanceOf(owner);

        console.log("Final A Balance:", finalTokenABalance);
        console.log("Final B Balance:", finalTokenBBalance);
        console.log("A Balance Change:", int(finalTokenABalance) - int(initialTokenABalance));
        console.log("B Balance Change:", int(finalTokenBBalance) - int(initialTokenBBalance));

        // 验证最终的B代币余额有所增加（套利获利）
        // 初始B代币余额应该加上最终收益等于最终B代币余额
        assertGt(finalTokenBBalance, initialTokenBBalance);

        // 输出日志显示获利结果
        console.log("B Token Profit:", finalTokenBBalance - initialTokenBBalance);
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[echarts饼图当鼠标移上去后，高亮色怎么设置为扇形本身的颜色？]]></title>    <link>https://juejin.cn/post/7599690133117419554</link>    <guid>https://juejin.cn/post/7599690133117419554</guid>    <pubDate>2026-01-27T03:05:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599690133117419554" data-draft-id="7599586891085037602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="echarts饼图当鼠标移上去后，高亮色怎么设置为扇形本身的颜色？"/> <meta itemprop="keywords" content="前端,ECharts"/> <meta itemprop="datePublished" content="2026-01-27T03:05:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小黑的铁粉"/> <meta itemprop="url" content="https://juejin.cn/user/2225067266412605"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            echarts饼图当鼠标移上去后，高亮色怎么设置为扇形本身的颜色？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067266412605/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小黑的铁粉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:05:41.000Z" title="Tue Jan 27 2026 03:05:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="zenburn">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#3f3f3f;color:#dcdcdc}.hljs-keyword,.hljs-selector-tag,.hljs-tag{color:#e3ceab}.hljs-template-tag{color:#dcdcdc}.hljs-number{color:#8cd0d3}.hljs-attribute,.hljs-template-variable,.hljs-variable{color:#efdcbc}.hljs-literal{color:#efefaf}.hljs-subst{color:#8f8f8f}.hljs-name,.hljs-section,.hljs-selector-class,.hljs-selector-id,.hljs-title,.hljs-type{color:#efef8f}.hljs-bullet,.hljs-link,.hljs-symbol{color:#dca3a3}.hljs-built_in,.hljs-builtin-name,.hljs-deletion,.hljs-string{color:#cc9393}.hljs-addition,.hljs-comment,.hljs-meta,.hljs-quote{color:#7f9f7f}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">以下是一个环形图，鼠标未移到饼图上时</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee3735568e5445c0b8a75604c788c49b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6buR55qE6ZOB57KJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088378&amp;x-signature=J%2BsyjPSwfHWJ5pagPBW3rk8TYFs%3D" alt="图片.png" loading="lazy"/></p>
<h4 data-id="heading-1">当鼠标移动到时长异常部分时，因为设置了高亮的原因再加上本身颜色就浅，看起来像换了种颜色</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27a4fbc70c0344c0a10761893a2f6b88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6buR55qE6ZOB57KJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088378&amp;x-signature=djhoqWi8Aeh%2F%2BRnwtDjI1bdVyvI%3D" alt="hover.png" loading="lazy"/></p>
<h4 data-id="heading-2">先看下优化后的样子</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8946e442b1084218816abc397c6043ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6buR55qE6ZOB57KJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088378&amp;x-signature=LpCAaOzB%2BfF8%2FaKk2Arh6sNtDuE%3D" alt="-hover-ok.png" loading="lazy"/></p>
<p>对比明显吧。</p>
<p>如何在设置了emphasis高亮配置时，保持扇形的颜色为本身的颜色呢，换句话说，想要保留高亮的其它配置，比如放大，边框等等，但颜色不要高亮展示，该如何设置呢？</p>
<pre><code class="hljs language-js" lang="js">
option = {
  <span class="hljs-attr">series</span>: [
   {
       <span class="hljs-string">"name"</span>:<span class="hljs-string">"运行状态"</span>,
       <span class="hljs-string">"type"</span>:<span class="hljs-string">"pie"</span>,
       <span class="hljs-string">"startAngle"</span>:<span class="hljs-number">90</span>,
       <span class="hljs-string">"radius"</span>:[
           <span class="hljs-string">"58%"</span>,
           <span class="hljs-string">"73%"</span>
       ],
       <span class="hljs-string">"center"</span>:[
           <span class="hljs-string">"50%"</span>,
           <span class="hljs-string">"50%"</span>
       ],
       <span class="hljs-attr">animation</span>: <span class="hljs-literal">true</span>,
       <span class="hljs-string">"selectedoffset"</span>:<span class="hljs-number">3</span>,
       <span class="hljs-comment">//这里设置统一悬停样式</span>
       <span class="hljs-attr">emphasis</span>:{
               
           <span class="hljs-string">"scale"</span>: <span class="hljs-literal">true</span>,
           <span class="hljs-string">"scalesize"</span>:<span class="hljs-number">6</span>,
           <span class="hljs-attr">itemStyle</span>:{
               <span class="hljs-comment">// "shadowBlur": 20,</span>
               <span class="hljs-comment">// "shadowColor":"rgba(0,0,0,1)",</span>
               <span class="hljs-string">"borderWidth"</span>: <span class="hljs-number">3</span>,
               <span class="hljs-string">"borderColor"</span>: <span class="hljs-string">"#fff"</span>,
                
           }
       },
       <span class="hljs-string">"label"</span>:{
           <span class="hljs-string">"padding"</span>:[
               <span class="hljs-number">15</span>,
               <span class="hljs-number">0</span>,
               <span class="hljs-number">0</span>,
               <span class="hljs-number">0</span>
           ],
           <span class="hljs-string">"color"</span>:<span class="hljs-string">"#4E5969"</span>,
           <span class="hljs-string">"fontSize"</span>:<span class="hljs-number">14</span>,
           <span class="hljs-string">"formatter"</span>:<span class="hljs-string">"{b|{b}} {d|{c}%}\n"</span>,
           <span class="hljs-string">"rich"</span>:{
               <span class="hljs-string">"b"</span>:{
                   <span class="hljs-string">"fontSize"</span>:<span class="hljs-number">14</span>,
                   <span class="hljs-string">"color"</span>:<span class="hljs-string">"#4E5969"</span>
               },
               <span class="hljs-string">"d"</span>:{
                   <span class="hljs-string">"fontSize"</span>:<span class="hljs-number">16</span>,
                   <span class="hljs-string">"fontWeight"</span>:<span class="hljs-number">600</span>,
                   <span class="hljs-string">"fontFamily"</span>:<span class="hljs-string">"DINAlternate-Bold, DINAlternate"</span>,
                   <span class="hljs-string">"color"</span>:<span class="hljs-string">"#4E5969"</span>
               }
           }
       },
       <span class="hljs-string">"labelLine"</span>:{
           <span class="hljs-string">"length2"</span>:<span class="hljs-number">4</span>
       },
       <span class="hljs-string">"data"</span>:[
           {
               <span class="hljs-string">"name"</span>:<span class="hljs-string">"时长异常"</span>,
               <span class="hljs-string">"value"</span>:<span class="hljs-number">41.63</span>,
                <span class="hljs-attr">originalColor</span>: <span class="hljs-string">"#91caff"</span>,
               <span class="hljs-string">"itemStyle"</span>:{
                   <span class="hljs-string">"color"</span>:<span class="hljs-string">"#91caff"</span>,
                   <span class="hljs-string">"borderColor"</span>:<span class="hljs-string">"#fff"</span>,
                   <span class="hljs-string">"borderWidth"</span>:<span class="hljs-number">2</span>
               },
               <span class="hljs-comment">// 答案在这里---&gt;&gt;&gt;鼠标悬停，颜色不高亮，且使用扇形本身颜色</span>
                 <span class="hljs-attr">emphasis</span>:{
                     <span class="hljs-string">"itemStyle"</span>:{
                         <span class="hljs-string">"color"</span>:<span class="hljs-string">"#91caff"</span>,
                      
                    }
                }
           },
           {
               <span class="hljs-string">"name"</span>:<span class="hljs-string">"时长正常"</span>,
               <span class="hljs-string">"value"</span>:<span class="hljs-number">51.58</span>,
               <span class="hljs-string">"itemStyle"</span>:{
                   <span class="hljs-string">"color"</span>:<span class="hljs-string">"#358EFE"</span>,
                   <span class="hljs-string">"borderColor"</span>:<span class="hljs-string">"#fff"</span>,
                   <span class="hljs-string">"borderWidth"</span>:<span class="hljs-number">2</span>
               },
               <span class="hljs-attr">emphasis</span>:{
                   <span class="hljs-string">"itemStyle"</span>:{
                       <span class="hljs-string">"color"</span>:<span class="hljs-string">"#358EFE"</span>,
                      
                   }
               }
           },
           {
               <span class="hljs-string">"name"</span>:<span class="hljs-string">"无时长"</span>,
               <span class="hljs-string">"value"</span>:<span class="hljs-number">6.79</span>,
               <span class="hljs-string">"itemStyle"</span>:{
                   <span class="hljs-string">"color"</span>:<span class="hljs-string">"#12C2C1"</span>,
                   <span class="hljs-string">"borderColor"</span>:<span class="hljs-string">"#fff"</span>,
                   <span class="hljs-string">"borderWidth"</span>:<span class="hljs-number">2</span>
               },
               <span class="hljs-attr">emphasis</span>:{
                   <span class="hljs-string">"itemStyle"</span>:{
                       <span class="hljs-string">"color"</span>:<span class="hljs-string">"#12C2C1"</span>,
                      
                   }
               }
           }
       ]
   }
]
};


</code></pre>
<h2 data-id="heading-3">解决</h2>
<p>设置了统一的悬停样式后，在单个data中设置下悬停时样式的color即可~Nice..</p>
<p>当然了，一般不会这么细致，但有时候确实会因为颜色的深浅影响UI视觉效果，这时候去找AI也没给出最简单的答案，AI要在统一悬停那设置color的函数，试了下，并不行。总之记录下，或许有人会用到。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[几种依赖注入的使用场景 - InversifyJS为例]]></title>    <link>https://juejin.cn/post/7599581204860813338</link>    <guid>https://juejin.cn/post/7599581204860813338</guid>    <pubDate>2026-01-27T03:12:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599581204860813338" data-draft-id="7599614131422969865" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="几种依赖注入的使用场景 - InversifyJS为例"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-27T03:12:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="irises"/> <meta itemprop="url" content="https://juejin.cn/user/3030697436261735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            几种依赖注入的使用场景 - InversifyJS为例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030697436261735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    irises
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:12:33.000Z" title="Tue Jan 27 2026 03:12:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>依赖注入不仅仅是一个让代码看起来“高级”的工具，它的核心价值在于<strong>解耦</strong>。通过将对象的“创建权”从业务逻辑中剥离并交给容器，我们能获得极高的灵活性。</p>
<blockquote>
<p>关于依赖注入相关概念可参考<a href="https://juejin.cn/post/7333421776459923465?searchId=20260127102011C9D7CD7EB5885DF2B803#heading-0" target="_blank" title="https://juejin.cn/post/7333421776459923465?searchId=20260127102011C9D7CD7EB5885DF2B803#heading-0">依赖注入的艺术：编写可扩展 JavaScript 代码的秘密</a></p>
</blockquote>
<p>以下是<strong>依赖注入</strong>最具代表性的五个使用场景。</p>
<hr/>
<h2 data-id="heading-0">1. 单元测试 (Unit Testing)</h2>
<p><strong>痛点：</strong> 当业务类直接 <code>new</code> 依赖时，测试该类就必须执行依赖的真实逻辑（如真实扣款、真实写库），导致测试缓慢且危险。</p>
<h3 data-id="heading-1">❌ 方式 A：不使用 InversifyJS (强耦合)</h3>
<p><code>OrderService</code> 内部强行依赖了 <code>RealPayment</code>。要测试 <code>checkout</code> 方法，你必须真的发起支付，无法轻松 Mock。</p>
<p>TypeScript</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 具体的支付实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RealPayment</span> {
    <span class="hljs-title function_">pay</span>(<span class="hljs-params">amount: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`$$$ 调用银行接口扣款: <span class="hljs-subst">${amount}</span>`</span>); <span class="hljs-comment">// 真实副作用</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">payment</span>: <span class="hljs-title class_">RealPayment</span>;

    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 😱 致命缺陷：硬编码依赖，测试时无法替换！</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">payment</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealPayment</span>();
    }

    <span class="hljs-title function_">checkout</span>(<span class="hljs-params">amount: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">payment</span>.<span class="hljs-title function_">pay</span>(amount);
    }
}
</code></pre>
<h3 data-id="heading-2">✅ 方式 B：使用 InversifyJS (依赖抽象)</h3>
<p>业务类只依赖接口 <code>IPayment</code>。在单元测试中，我们可以通过容器绑定一个 <code>MockPayment</code>，轻松隔离副作用。</p>
<p>TypeScript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 定义接口</span>
interface IPayment { <span class="hljs-built_in">pay</span>(amount: number): void; }

<span class="hljs-comment">// 2. 业务逻辑 (只依赖接口)</span>
<span class="hljs-keyword">@injectable</span>()
class OrderService {
    <span class="hljs-built_in">constructor</span>(
        @inject(TYPES.Payment) private payment: IPayment // 注入接口
    ) {}

    <span class="hljs-built_in">checkout</span>(amount: number) {
        this<span class="hljs-selector-class">.payment</span><span class="hljs-selector-class">.pay</span>(amount);
    }
}

<span class="hljs-comment">// --- 单元测试文件 spec.ts ---</span>
const testContainer = new <span class="hljs-built_in">Container</span>();

<span class="hljs-comment">// 🧪 测试时：绑定 Mock 实现</span>
const mockPayment = { 
    pay: jest.<span class="hljs-built_in">fn</span>() // 使用 Jest 等测试库的 Mock 函数
}; 
testContainer<span class="hljs-selector-class">.bind</span>(TYPES.Payment)<span class="hljs-selector-class">.toConstantValue</span>(mockPayment);
testContainer<span class="hljs-selector-class">.bind</span>(OrderService)<span class="hljs-selector-class">.toSelf</span>();

const service = testContainer<span class="hljs-selector-class">.get</span>(OrderService);
service<span class="hljs-selector-class">.checkout</span>(<span class="hljs-number">100</span>);

<span class="hljs-comment">// 断言：验证是否调用了 mock 方法，而不是真的扣款</span>
<span class="hljs-built_in">expect</span>(mockPayment.pay)<span class="hljs-selector-class">.toHaveBeenCalledWith</span>(<span class="hljs-number">100</span>);
</code></pre>
<hr/>
<h2 data-id="heading-3">2. 可替换的组件 (Swappable Components)</h2>
<p><strong>痛点：</strong> 同一个接口有多种实现（例如：存储策略既有本地存储，又有云存储）。传统写法通常伴随着大量的 <code>if-else</code> 或工厂模式代码。</p>
<h3 data-id="heading-4">❌ 方式 A：不使用 InversifyJS (工厂模式/条件判断)</h3>
<p>调用者需要知道具体的实现类，且扩展新策略时需要修改工厂代码。</p>
<p>TypeScript</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalStorage</span> { <span class="hljs-title function_">save</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"存硬盘"</span>); } }
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CloudStorage</span> { <span class="hljs-title function_">save</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"存 AWS S3"</span>); } }

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FileManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">storage</span>: <span class="hljs-built_in">any</span>;

    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-comment">// 😱 违反开闭原则：每次加新策略都要改这里</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">'local'</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CloudStorage</span>();
        }
    }
}
</code></pre>
<h3 data-id="heading-5">✅ 方式 B：使用 InversifyJS (命名绑定)</h3>
<p>使用 <code>@named</code> 标签，可以在不修改业务逻辑代码的情况下，灵活注入不同的策略。</p>
<p>TypeScript</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@injectable</span>()
class FileManager {
    <span class="hljs-selector-tag">constructor</span>(
        <span class="hljs-comment">// ✨ 优雅：同时注入两种策略，按需使用</span>
        <span class="hljs-variable">@inject</span>(TYPES.Storage) <span class="hljs-variable">@named</span>(<span class="hljs-string">"local"</span>) private <span class="hljs-attribute">local</span>: IStorage,
        <span class="hljs-variable">@inject</span>(TYPES.Storage) <span class="hljs-variable">@named</span>(<span class="hljs-string">"cloud"</span>) private <span class="hljs-attribute">cloud</span>: IStorage
    ) {}

    <span class="hljs-built_in">backup</span>() {
        <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.local</span><span class="hljs-selector-class">.save</span>(); <span class="hljs-comment">// 先存本地</span>
        <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.cloud</span><span class="hljs-selector-class">.save</span>(); <span class="hljs-comment">// 再存云端</span>
    }
}

<span class="hljs-comment">// --- 容器配置 ---</span>
<span class="hljs-selector-tag">container</span><span class="hljs-selector-class">.bind</span>&lt;<span class="hljs-selector-tag">IStorage</span>&gt;(TYPES.Storage)<span class="hljs-selector-class">.to</span>(LocalStorage)<span class="hljs-selector-class">.whenTargetNamed</span>(<span class="hljs-string">"local"</span>);
<span class="hljs-selector-tag">container</span><span class="hljs-selector-class">.bind</span>&lt;<span class="hljs-selector-tag">IStorage</span>&gt;(TYPES.Storage)<span class="hljs-selector-class">.to</span>(CloudStorage)<span class="hljs-selector-class">.whenTargetNamed</span>(<span class="hljs-string">"cloud"</span>);
</code></pre>
<hr/>
<h2 data-id="heading-6">3. 跨环境运行 (Cross-Environment Execution)</h2>
<p><strong>痛点：</strong> 开发环境用 SQLite，生产环境用 PostgreSQL。如果不使用 DI，代码中会充斥着 <code>process.env.NODE_ENV</code> 的判断，导致代码混乱。</p>
<h3 data-id="heading-7">❌ 方式 A：不使用 InversifyJS (环境判断污染逻辑)</h3>
<p>TypeScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseService</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 😱 环境配置逻辑泄漏到了业务类中</span>
        <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostgresConnection</span>();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqliteConnection</span>();
        }
    }
    
    <span class="hljs-title function_">query</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-title function_">exec</span>(<span class="hljs-string">"SELECT * FROM users"</span>);
    }
}
</code></pre>
<h3 data-id="heading-8">✅ 方式 B：使用 InversifyJS (容器模块化配置)</h3>
<p>业务代码完全干净，环境切换的逻辑被移到了容器配置层（Composition Root）。</p>
<p>TypeScript</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 业务代码 (完全不知道当前是什么环境)</span>
<span class="hljs-meta">@injectable</span>()
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseService</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-meta">@inject</span>(TYPES.DbConnection) <span class="hljs-keyword">private</span> conn: IDbConnection</span>) {}
}

<span class="hljs-comment">// 2. 环境配置模块 (config.ts)</span>
<span class="hljs-keyword">const</span> devModule = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContainerModule</span>(<span class="hljs-function">(<span class="hljs-params">bind</span>) =&gt;</span> {
    bind&lt;<span class="hljs-title class_">IDbConnection</span>&gt;(<span class="hljs-variable constant_">TYPES</span>.<span class="hljs-property">DbConnection</span>).<span class="hljs-title function_">to</span>(<span class="hljs-title class_">SqliteConnection</span>);
});

<span class="hljs-keyword">const</span> prodModule = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContainerModule</span>(<span class="hljs-function">(<span class="hljs-params">bind</span>) =&gt;</span> {
    bind&lt;<span class="hljs-title class_">IDbConnection</span>&gt;(<span class="hljs-variable constant_">TYPES</span>.<span class="hljs-property">DbConnection</span>).<span class="hljs-title function_">to</span>(<span class="hljs-title class_">PostgresConnection</span>);
});

<span class="hljs-comment">// 3. 入口文件 (index.ts)</span>
<span class="hljs-keyword">const</span> container = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Container</span>();
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
    container.<span class="hljs-title function_">load</span>(prodModule); <span class="hljs-comment">// 🏭 加载生产模块</span>
} <span class="hljs-keyword">else</span> {
    container.<span class="hljs-title function_">load</span>(devModule);  <span class="hljs-comment">// 🛠️ 加载开发模块</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-9">4. 插件式架构 (Plugin Architecture)</h2>
<p><strong>痛点：</strong> 系统核心需要加载第三方插件。如果不使用 DI，核心系统必须手动 import 并实例化插件，这使得动态扩展变得极其困难。</p>
<h3 data-id="heading-10">❌ 方式 A：不使用 InversifyJS (手动列表)</h3>
<p>核心代码必须“认识”每一个插件。</p>
<p>TypeScript</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GitPlugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./plugins/git"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DockerPlugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./plugins/docker"</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">plugins</span>: <span class="hljs-built_in">any</span>[] = [];

    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 😱 扩展性差：想加个插件，还得改核心代码的构造函数</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GitPlugin</span>());
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DockerPlugin</span>());
    }

    <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-title function_">exec</span>());
    }
}
</code></pre>
<h3 data-id="heading-11">✅ 方式 B：使用 InversifyJS (多重注入 Multi-Injection)</h3>
<p>核心系统定义接口，插件自行注册到容器。核心系统自动获取所有符合接口的插件。</p>
<p>TypeScript</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 核心系统</span>
<span class="hljs-variable">@injectable</span>()
class App {
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">plugins</span>: <span class="hljs-selector-tag">IPlugin</span><span class="hljs-selector-attr">[]</span>;

    <span class="hljs-selector-tag">constructor</span>(
        <span class="hljs-comment">// ✨ 魔法：自动把容器里所有绑定为 TYPES.Plugin 的实例都注入进来，形成数组</span>
        <span class="hljs-variable">@multiInject</span>(TYPES.Plugin) <span class="hljs-attribute">plugins</span>: IPlugin[]
    ) {
        <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.plugins</span> = <span class="hljs-selector-tag">plugins</span>;
    }
}

<span class="hljs-comment">// 插件 A (独立文件)</span>
<span class="hljs-selector-tag">bind</span>&lt;<span class="hljs-selector-tag">IPlugin</span>&gt;(TYPES.Plugin)<span class="hljs-selector-class">.to</span>(GitPlugin);

<span class="hljs-comment">// 插件 B (独立文件)</span>
<span class="hljs-selector-tag">bind</span>&lt;<span class="hljs-selector-tag">IPlugin</span>&gt;(TYPES.Plugin)<span class="hljs-selector-class">.to</span>(DockerPlugin);

<span class="hljs-comment">// 这种模式下，新增插件只需要 bind 一下，不需要修改 App 类的任何代码。</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">5. 复杂的生命周期管理 (Singleton vs Transient)</h2>
<p><strong>痛点：</strong> 某些对象（如缓存、数据库连接池）必须是全局单例，而某些对象（如 HTTP 请求上下文）必须每次新建。手动管理这些单例模式非常容易出错。</p>
<h3 data-id="heading-13">❌ 方式 A：不使用 InversifyJS (手动单例模式)</h3>
<p>开发者必须手动实现 Singleton 模式，代码啰嗦且难以维护。</p>
<p>TypeScript</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">CacheService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> instance: CacheService;
    
    <span class="hljs-comment">// 😱 样板代码：每个单例类都要写这一坨逻辑</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">constructor</span>()</span> {} 

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title">getInstance</span>(): CacheService</span> {
        <span class="hljs-keyword">if</span> (!CacheService.instance) {
            CacheService.instance = <span class="hljs-keyword">new</span> CacheService();
        }
        <span class="hljs-keyword">return</span> CacheService.instance;
    }
}

<span class="hljs-comment">// 使用时必须小心</span>
<span class="hljs-keyword">const</span> cache = CacheService.getInstance();
</code></pre>
<h3 data-id="heading-14">✅ 方式 B：使用 InversifyJS (声明式生命周期)</h3>
<p>类本身不需要知道自己是不是单例，全靠容器配置。</p>
<p>TypeScript</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheService</span> {
    <span class="hljs-keyword">constructor</span>() { console.log(<span class="hljs-string">"CacheService Created"</span>); }
}

<span class="hljs-meta">@injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestHandler</span> {
    <span class="hljs-keyword">constructor</span>() { console.log(<span class="hljs-string">"RequestHandler Created"</span>); }
}

<span class="hljs-comment">// --- 容器配置 ---</span>
<span class="hljs-comment">// 1. 单例：整个应用只创建一次</span>
container.bind(CacheService).toSelf().inSingletonScope();

<span class="hljs-comment">// 2. 瞬态：每次请求都创建新的</span>
container.bind(RequestHandler).toSelf().inTransientScope();

<span class="hljs-comment">// --- 运行结果 ---</span>
<span class="hljs-keyword">const</span> cache1 = container.<span class="hljs-keyword">get</span>(CacheService);
<span class="hljs-keyword">const</span> cache2 = container.<span class="hljs-keyword">get</span>(CacheService);
<span class="hljs-comment">// 输出: "CacheService Created" (只输出一次，cache1 === cache2)</span>

<span class="hljs-keyword">const</span> handler1 = container.<span class="hljs-keyword">get</span>(RequestHandler);
<span class="hljs-keyword">const</span> handler2 = container.<span class="hljs-keyword">get</span>(RequestHandler);
<span class="hljs-comment">// 输出: "RequestHandler Created" (输出两次，handler1 !== handler2)</span>
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS选择器 - 认识选择器]]></title>    <link>https://juejin.cn/post/7599690133117517858</link>    <guid>https://juejin.cn/post/7599690133117517858</guid>    <pubDate>2026-01-27T03:14:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599690133117517858" data-draft-id="7599652649550086144" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS选择器 - 认识选择器"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T03:14:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GinoWi"/> <meta itemprop="url" content="https://juejin.cn/user/687651121011707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS选择器 - 认识选择器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/687651121011707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GinoWi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:14:50.000Z" title="Tue Jan 27 2026 03:14:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSS选择器 - 认识选择器</h2>
<p>选择器就是用于查找或选取需要设置CSS样式的HTML标签。</p>
<h4 data-id="heading-1">标签选择器</h4>
<ul>
<li>作用：根据指定的标签名称，在当前界面中找到所有该名称的标签，然后设置属性。</li>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css">标签名称{
  属性名称: 属性名称值;
}
</code></pre>
<ul>
<li>
<p>注意点：</p>
<ol>
<li>标签选择器选中的是当前界面中所有的标签，而不能单独选中某一个标签。</li>
<li>标签选择器无论标签嵌套多深都能选中。</li>
<li>只要是HTML中的标签就可以作为标签选择器。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-2">id选择器</h4>
<ul>
<li>作用：根据指定的<code>id</code>名称找到对应的标签，然后设置属性。</li>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-id">#id</span>名称{
  属性名称: 属性值;
}
</code></pre>
<ul>
<li>
<p>注意点：</p>
<ul>
<li>每个HTML标签都有一个属性叫做<code>id</code>，也就是说每个标签都可以设置<code>id</code>。</li>
<li>在同一个界HTML页面中<code>id</code>的名称是不可以重复的。</li>
<li>在编写id选择器的时候一定要在<code>id</code>名称前面加上<code>#</code>。</li>
<li><code>id</code>名称是有一定的规范的：（1）<code>id</code>名称只能由字母/数字、下划线组成；（2）<code>id</code>名称不能以数字开头；（3）<code>id</code>名称不能是HTML标签的名称。</li>
<li>在开发过程中，一般情况下如果仅仅是为了设置样式，我们不会专门使用<code>id</code>选择器，因为<code>id</code>属性一般是留给js使用的。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">类选择器</h4>
<ul>
<li>作用：根据指定的类名称找到对应的标签，然后设置属性。</li>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css">.类名{
  属性名称: 属性值;
}
</code></pre>
<ul>
<li>
<p>注意点：</p>
<ul>
<li>每个HTML标签都一个属性叫做<code>class</code>，也就是说每个标签都可以设置<code>class</code>。</li>
<li>在同一个HTML界面中<code>class</code>的名称是可以重复的。</li>
<li>在编写<code>class</code>选择器的时候一定要在<code>class</code>名称前面加上<code>.</code>。</li>
<li>类名的命名规范和<code>id</code>的命名规范一样。</li>
<li>类名就是专门用来给某个特定的标签设置样式的。</li>
<li>在HTML中每个HTML标签可以同时绑定多个类名，eg：<code>&lt;标签名称 class=“类名1 类名2 ……“&gt;</code>；错误的写法：<code>&lt;p class="1" class="2"&gt;&lt;/p&gt;</code></li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>补充内容：</strong></p>
<ol start="0">
<li>
<p><code>id</code>和<code>class</code>的区别？</p>
<ul>
<li><code>id</code>相当于人的身份证，不能重复；而<code>class</code>相当于人的名称不能重复。</li>
<li>一个HTML标签只能绑定一个<code>id</code>名称，而一个HTML标签可以绑定多个<code>class</code>名称。</li>
</ul>
</li>
<li>
<p><code>id</code>选择器和<code>class</code>选择器的区别？</p>
<ul>
<li><code>id</code>选择器是以<code>#</code>开头，而<code>class</code>选择器以<code>.</code>开头。</li>
</ul>
</li>
<li>
<p>在开发中到底选择<code>id</code>选择器还是<code>class</code>选择器？</p>
<ul>
<li><code>id</code>一般情况下是给js使用的，所以除非特殊情况，否则不要用<code>id</code>选择器去设置样式。</li>
</ul>
</li>
</ol>
</blockquote>
<h4 data-id="heading-4">后代选择器</h4>
<ul>
<li>作用：找到指定标签的所有后代标签设置属性。（组合器）</li>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/*先找到选择器1所选中的标签，然后再在这个标签下面去查找所有选择器2所选中的标签，然后再设置属性。*/</span>
选择器<span class="hljs-number">1</span> 选择器<span class="hljs-number">2</span>{
    属性: 值;
}
</code></pre>
<ul>
<li>
<p>注意点：</p>
<ul>
<li>后代选择器必须用空格隔开。</li>
<li>后代不仅仅是子元素，也包括孙子元素或者重孙子元素，只要最终是放到指定标签中的都是后代。</li>
<li>后代选择器不仅仅可以使用标签名称，还可以使用其他选择器（id选择器、类选择器）。</li>
<li>后代选择器可以无限延伸，无限向下寻找。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">子元素选择器</h4>
<ul>
<li>作用：找到指定标签中所有直接子元素，然后设置属性。</li>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/*先通过选择器1找到选中的标签，然后在这个标签中查找所有通过选择器2选中的直接子元素。*/</span>
选择器<span class="hljs-number">1</span> &gt; 选择器<span class="hljs-number">2</span>{
  属性: 值;
}
</code></pre>
<ul>
<li>注意点：</li>
</ul>
<ol>
<li>子元素选择器只会查找儿子，不会查找其他被嵌套的标签</li>
<li>子元素选择器之间只能由大于号链接，并且不能加空格</li>
<li>子元素选择器不仅仅可以使用标签名称，还可以使用其他选择器。</li>
<li>子元素选择器可以通过&gt;一直延续下去。</li>
</ol>
<blockquote>
<p><em><strong>补充内容：</strong></em></p>
<p>后代选择器和子元素选择器之间的区别？</p>
<ul>
<li>后代选择器使用空格作为连接符号，子元素选择器使用<code>&gt;</code>作为连接符号。</li>
<li>后代选择器会选中指定标签中所有的特定后代标签，也就是会选中儿子、孙子……，只要是被放到指定标签中的特定标签都会被选中。</li>
<li>子元素选择器只会选中指定标签中所有特定的直接子元素，也就是只会选中特定的儿子标签。</li>
</ul>
<p>后代选择器和子元素选择器的共同点？</p>
<ul>
<li>后代选择器和子元素选择器都可以使用标签名称/<code>id</code>名称/<code>class</code>名称来作为选择器。</li>
<li>后代选择器和子元素选择器都可以通过各自的连接符号一直延续下去。</li>
</ul>
<p>在后续开发中如何使用？</p>
<ul>
<li>如果想选中指定标签中所有特定标签，那么就使用后代选择器</li>
<li>如果只想选中指定标签中特定的儿子标签，那么选择子元素选择器</li>
</ul>
</blockquote>
<h4 data-id="heading-6">交集选择器</h4>
<ul>
<li>作用：给所有选择器选中的标签中，共同包含的那部分标签设置属性。</li>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css">选择器<span class="hljs-number">1</span>选择器<span class="hljs-number">2</span>{
  属性: 值;
}
</code></pre>
<ul>
<li>
<p>注意点：</p>
<ul>
<li><strong>选择器和选择器之间没有任何连接符号。</strong></li>
<li>选择器可以使用标签名称/<code>id</code>名称/<code>class</code>名称。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-7">并集选择器</h4>
<ul>
<li>作用：给我们所有选择器选中的标签设置属性。</li>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css">选择器<span class="hljs-number">1</span>, 选择器<span class="hljs-number">2</span>{
  属性: 值;
}
</code></pre>
<ul>
<li>
<p>注意点：</p>
<ul>
<li>并集选择器必须使用<code>,</code>来连接。</li>
<li>选择器可以使用标签名称/<code>id</code>名称/<code>class</code>名称。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">兄弟选择器</h4>
<p>兄弟就是同级关系。</p>
<ol>
<li>
<p>相邻兄弟选择器（CSS2）</p>
<ul>
<li>
<p>作用：给指定选择器后面紧跟的那个选择器选中的标签设置属性。</p>
</li>
<li>
<p>格式：</p>
<pre><code class="hljs language-css" lang="css">选择器<span class="hljs-number">1</span> + 选择器<span class="hljs-number">2</span>{
  属性: 值;
}
</code></pre>
</li>
<li>
<p>注意点：</p>
<ul>
<li>相邻兄弟选择器必须通过加号连接。</li>
<li>相邻兄弟选择器只能选中紧跟其后的那个标签，不能选中被隔开的标签。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>通用兄弟选择器（css3）</p>
<ul>
<li>
<p>作用：给指定选择器后面所有选择器选中的所有标签设置属性。</p>
</li>
<li>
<p>格式：</p>
<pre><code class="hljs language-css" lang="css">选择器<span class="hljs-number">1</span> ~ 选择器<span class="hljs-number">2</span>{
  属性: 值;
}
</code></pre>
</li>
<li>
<p>注意点：</p>
<ul>
<li>通用兄弟选择器必须用波浪线来连接。</li>
<li>通用兄弟选择器选中的是指定选择器后面某个选择器选中的所有标签，无论有没有被隔开都可以选中。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 data-id="heading-9">序选择器</h4>
<p>CSS3新增选择器中最具代表性的就是序选择器。</p>
<ul>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css">标签名称序选择器{
  属性: 值;
}
</code></pre>
<ol>
<li>
<p>同级别中的第几个</p>
<ul>
<li>
<p><code>:first-child</code>：选中同级别中的第一个标签</p>
</li>
<li>
<p><code>:last-child</code>：选择同级别中最后一个标签</p>
</li>
<li>
<p><code>:nth-child(n)</code>：选择同级别中第n个标签</p>
</li>
<li>
<p><code>:nth-last-child(n)</code>：选择同级别中倒数第n个标签</p>
</li>
<li>
<p>注意点：</p>
<ul>
<li>排序时不会区分类型。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>同类型中的第几个</p>
<ul>
<li><code>:first-of-type</code>：选中同级别中同类型的第一个标签</li>
<li><code>:last-of-type</code>：选中同级别中同类型的最后一个标签</li>
<li><code>:nth-of-type(n)</code>： 选中同级别中同类型的第n个标签</li>
<li><code>:nth-last-of-type(n)</code>：选择同级别中同类型的倒数第n个标签</li>
</ul>
</li>
<li>
<p>特殊：</p>
<ul>
<li><code>:only-child</code>：选中父元素中唯一的元素</li>
<li><code>:only-of-type</code>：选中父元素中唯一类型的元素</li>
<li><code>:nth-child(odd)</code>：选中同级别中的奇数元素</li>
<li><code>:nth-child(even)</code>：选中同级别中的偶数元素</li>
<li><code>:nth-of-type(odd)</code>： 选中同级别中同类型的奇数元素</li>
<li><code>:nth-of-type(even)</code>：选中同级别中同类型的偶数元素。</li>
<li><code>:nth-child(xn+y)</code>： x和y时用户自定义的，而n是一个计数器，从0开始统计。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-10">属性选择器</h4>
<ul>
<li>
<p>作用：根据指定的属性名称找到对应的标签，然后设置属性</p>
</li>
<li>
<p>格式：</p>
<pre><code class="hljs language-css" lang="css">标签名称<span class="hljs-selector-attr">[attribute]</span>{
    属性: 值;
}
</code></pre>
</li>
<li>
<p>不同类型属性选择器：</p>
<ul>
<li>
<p>找到有指定属性，并切指定属性等于<code>value</code>的标签：</p>
<pre><code class="hljs language-css" lang="css">标签名称<span class="hljs-selector-attr">[attribute=value]</span>{
    属性: 值;
}
</code></pre>
</li>
<li>
<p>选取属性取值是以value开头的：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/*CSS2*/</span>
标签名称<span class="hljs-selector-attr">[attribute|=value]</span>{
    属性: 值;
}
<span class="hljs-comment">/*CSS3*/</span>
标签名称<span class="hljs-selector-attr">[attribute^=value]</span>{
    属性: 值;
}
</code></pre>
<ul>
<li>
<p>区别：</p>
<ul>
<li>CSS2开头只能找到<code>value</code>开头，并且<code>value</code>是用<code>-</code>与其他内容隔开的。</li>
<li>CSS3中的只要是以<code>value</code>开头的都可以找到，无论有没有被<code>-</code>隔开。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>属性的取值是以<code>value</code>结尾的：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/*CSS3*/</span>
标签名称<span class="hljs-selector-attr">[attribute$=value]</span>{
    属性: 值;
}
</code></pre>
</li>
<li>
<p>属性的取值是否包含某个特定的<code>value</code>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/*CSS2*/</span>
标签名称<span class="hljs-selector-attr">[attribute~=value]</span>{
    属性: 值;
}
<span class="hljs-comment">/*CSS3*/</span>
标签名称<span class="hljs-selector-attr">[attribute*=value]</span>{
    属性: 值;
}
</code></pre>
<ul>
<li>
<p>区别：</p>
<ul>
<li>CSS2的只能找到<code>value</code>是独立的单词，<code>value</code>是被空格隔开的。</li>
<li>CSS3中只要包含<code>value</code>就可以被找到。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>最常见的场景：用于区分<code>input</code>属性。</p>
</li>
</ul>
<h4 data-id="heading-11">通配符选择器</h4>
<ul>
<li>作用：给当前界面上所有标签设置属性。</li>
<li>格式：</li>
</ul>
<pre><code class="hljs language-css" lang="css">*{
  属性: 值;
}
</code></pre>
<ul>
<li>
<p>注意点：</p>
<ul>
<li>由于通配符选择器是设置界面上所有标签的属性，所以在设置之前会遍历所有标签，如果当前界面上的标签比较多，性能就会比较差，所以一般开发过程中不会使用。</li>
</ul>
</li>
</ul>
<p><strong>参考链接：</strong></p>
<p>W3School官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3school.com.cn%2F" target="_blank" title="https://www.w3school.com.cn/" ref="nofollow noopener noreferrer">www.w3school.com.cn</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从理解到应用 | 在 TRAE 中快速上手 Skills]]></title>    <link>https://juejin.cn/post/7599581687358963762</link>    <guid>https://juejin.cn/post/7599581687358963762</guid>    <pubDate>2026-01-27T03:01:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599581687358963762" data-draft-id="7599581204860518426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从理解到应用 | 在 TRAE 中快速上手 Skills"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-27T03:01:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从理解到应用 | 在 TRAE 中快速上手 Skills
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:01:58.000Z" title="Tue Jan 27 2026 03:01:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a262b6d79c84e2480ea1a3b62a63b11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=cPFIW%2Bt%2FukdqIVYE9hpGVvqvRKo%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者： Amber，TRAE 产品运营 ；李健，TRAE 开发者用户</p>
</blockquote>
<p>想全面了解 Skills 功能，也欢迎阅读上一篇文章：</p>
<p><a href="https://juejin.cn/post/7599528186586595338" target="_blank" title="https://juejin.cn/post/7599528186586595338">一文读懂 Skills｜从概念到实操的完整指南</a></p>
<p>上一篇文章我们已经梳理了 Skills 的原理和操作。发布后我们收到了许多 TRAE 友的反馈，希望能有一份更适合新手快速上手的入门手册，我们继续来讲一讲。</p>
<p>本文从更贴近日常使用的视角出发，帮助你继续理解什么是 Skills，厘清在众多功能中何时应选择 Skills、哪些典型场景尤其适合使用 Skills，以及一份结构规范、易复用的 Skills 应当如何编写。最后，我们还会通过一个简洁明了的示例，直观展示 Skills 的实际输出效果，帮助初学者也能快速理解并应用。快来看看吧！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8951ec9b20c433aa56eed1fb03556ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=P26049wwbMXdyw7%2FJiV0nw49whc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>Skills 是什么</strong></h2>
<p>大家最常看到的是「一句话解释 Skills 」，但今天我们换个角度，从 AI 的两个核心概念——Agent 和 MCP——说起，来聊聊为什么 Skills 的出现是必不可少的。</p>
<h3 data-id="heading-1"><strong>为什么需要 Agent ？</strong></h3>
<p>要理解 Agent（智能体），我们可以先和传统的软件开发模式做个对比。</p>
<p>在传统的项目开发中，比如我们要搭建一个电商平台，通常需要明确划分出用户模块、商品模块、订单模块等固定单元。这些模块的交互流程是预先设计好的，非常严格。如果我们想在开发完成后增加一个“购物车”功能，就必须中断并修改原有的代码流程，将购物车模块嵌入到订单模块之前。这种对业务逻辑的调整，往往意味着对代码的大规模重构。</p>
<p>那么，如果让 Agent 来搭建一个电商平台，它会怎么做呢？Agent 不会纠结于平台应该由哪些具体模块组成，它只关心一件事：当用户输入“我要买一个商品”的指令后，能否最终实现“成功付款买到商品”这个目标。至于中间的过程是用了 Java 还是 Python，商品信息是存在数据库里还是 Excel 表格里，订单是用系统处理还是用飞书多维表格来管理——这些实现细节，Agent 并不在乎。</p>
<p>所以，为什么需要 Agent？<strong>因为在今天这个业务需求越来越多样化、动态化的时代，我们更关心目标是否达成，而不是实现目标的具体方式和技术细节。</strong> Agent 正是为这种面向目标的任务而生。</p>
<h3 data-id="heading-2"><strong>为什么需要 MCP ？</strong></h3>
<p>回到我们传统的电商平台开发。在开发过程中，我们常常需要集成一些第三方服务，比如手机短信验证、人脸识别、微信支付或者物流信息查询。这些功能并非由我们的电商平台独立完成，而是通过调用第三方服务的 API 来实现的。通常，这些 API 都有明确的授权和调用规则。</p>
<p>那么，Agent 是否也能调用这些 API 呢？当然可以。但如果 Agent 的工作方式并非完全基于代码，又要如何实现人脸识别这类复杂功能呢？这时，MCP 就应运而生了。<strong>你可以把 MCP（Model Context Protocol）理解为一种专门为 AI 设计的“API”，它让 AI 能够像传统软件一样，调用和使用各种外部服务的能力。</strong></p>
<h3 data-id="heading-3"><strong>为什么需要 Skills？</strong></h3>
<p>在理解了 Agent 和 MCP 之后，我们再来看一下 Skills。</p>
<p>对 AI 来说，除了可以通过 MCP 来使用别人的能力之外，我们还可以把一些重复性的工作打包出来，变成大家都能用的工具包，这样就大大的减少了我们编码的复杂性，功能不再全部丢给我们自己从头到尾写一遍了，那这个工具包就是 Skills。</p>
<p>举个例子，假设我们需要在应用里做一个文件上传功能。我们当然可以自己从头开始写代码，但如果自己不擅长界面设计，做出来的上传组件可能会很难看，需要花费大量时间去调整样式。但如果这时候，有另一位擅长前后端开发的工程师，已经做了一个功能完善、界面美观的文件上传组件，并把它作为 Skill 分享了出来，我们是不是就可以直接拿来用，而不用在我们不擅长的领域里反复挣扎了呢？</p>
<p>这正是 Skill 的核心价值所在。</p>
<h3 data-id="heading-4"><strong>理解三个功能的定位</strong></h3>
<ul>
<li>
<p><strong>Agent：</strong> 是面向目标的<strong>执行者</strong>。你给它一个目标（比如“我要买商品”），它就会自主规划流程、选择工具去完成，不再受限于传统的模块化开发思维。</p>
</li>
<li>
<p><strong>MCP：</strong> 是 AI 用来调用外部能力的<strong>通讯器</strong>。它就像传统项目中的第三方 API，让 Agent 能够接入并使用支付、识别等外部服务。</p>
</li>
<li>
<p><strong>Skills：</strong> 是可供重复使用的<strong>能力包</strong>。无论是“发送邮件”还是“文件上传”，这些成熟的功能都可以被封装成 Skill，让 Agent 和 MCP 能像使用工具一样直接调用，避免重复造轮子。</p>
</li>
</ul>
<blockquote>
<p>简单来说，Skills <strong>通过固定的规则和标准化的能力，来保证输出结果的稳定和一致。</strong></p>
</blockquote>
<p>再举个例子：</p>
<p>假设你要搭建一个网站，需要一个完整的用户系统。你可以直接使用现成的“用户鉴权 Skill”来快速接入登录验证功能，再用“手机验证码注册 Skill”来搞定注册流程。</p>
<p>这就是 Skills 带来的便利。想象一下，未来社区里有成千上万个公开分享的 Skills，我们可以即取即用，开发工作将变得前所未有的便捷和高效。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3584191ba78d422d9b188e796323c9df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=OC0uioaKUBsZ9DN5NLoplRtQjCU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>什么时候该用 Skills</strong></h2>
<blockquote>
<p>任何新功能都不是万金油，我们应该在合适的场景使用它。当你需要一个<strong>可以被重复使用、并按需自动调用</strong>的能力时，Skills 就是你的最佳选择。</p>
</blockquote>
<p>在创建 Skills 之前，不妨先问自己两个问题：<strong>这件事未来会重复做吗？用一套标准化的指令来完成，效果会不会更好？</strong></p>
<h3 data-id="heading-6"><strong>适合用 Skills 的场景</strong></h3>
<ul>
<li>
<p><strong>高频重复的操作：</strong> 同一个指令你已经手动输入过很多次。</p>
</li>
<li>
<p><strong>要求输出一致：</strong> 需要跨越多次对话，始终保持相同的输出风格、格式或标准。</p>
</li>
<li>
<p><strong>固定的工作流程：</strong> 有一套明确的多步骤工作流程需要严格执行。</p>
</li>
<li>
<p><strong>沉淀专业知识：</strong> 想把团队的最佳实践，如<strong>代码规范、品牌指南、测试流程、数据分析方法</strong>等，固化下来，让 AI 也能掌握。</p>
</li>
</ul>
<h3 data-id="heading-7"><strong>场景举例</strong></h3>
<h4 data-id="heading-8"><strong>场景一：稳定输出高质量结果</strong></h4>
<p>如果你需要智能体每次都按你的标准输出，例如统一设计规范、执行团队标准、保持品牌一致性、确保代码符合约定等场景其实都很适合。</p>
<p>与其指望智能体“记住”你的偏好，不如把要求打包成 Skills，变成一个专业技能包，让输出结果稳定可控。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e71526a81344a0cb252a0530d3e0c9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=akNRdoM%2FGBgBGbWEN5sEk%2Ba%2FVj0%3D" alt="" loading="lazy"/></p>
<p>示例：用 frontend-design Skill 优化网页前端设计</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89776deea46240baa50630e4f272fbda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=tYRaXRjXy33Fchide0nVd7x5hFk%3D" alt="" loading="lazy"/>Before：仅使用 prompt + SOLO agent</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62a68e1443ab4b6197c0d372b8554386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=EGJuhvYsgCsbY9vY92DBGHVpN0o%3D" alt="" loading="lazy"/>After：在 SOLO 中调用 frontend-design-skill 之后</p>
<h4 data-id="heading-9"><strong>场景二：自动化重复性工作流</strong></h4>
<p>测试框架、代码规范检查、常规数据分析、那些躲不掉的日常流程....都可以把 SOP 变成可复用的 Skills，让 AI 替你完成。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b00246d9a4045a598e6b8b3d60dc6f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=HUGHXnNRlkyw8FrROgU0M5Keyjk%3D" alt="" loading="lazy"/></p>
<p>示例：用 ux-designer Skills 生成线框图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23e1176bdc4041c2ae44476fdb83a20b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=v1DgImmoV8L0eUNIkcGm8SO2IJI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-10"><strong>场景三：沉淀与共享 Skills</strong></h4>
<p>Skill 不仅仅是提升个人效率的工具，更是将专业能力规模化、与团队共享的绝佳方式。</p>
<ul>
<li>
<p><strong>流程共享：</strong> 把成熟的工作流程封装成 Skill，团队成员无需再反复沟通流程细节，直接调用即可。</p>
</li>
<li>
<p><strong>规范统一：</strong> 将团队的设计规范、代码规范或品牌指南制作成 Skill，确保整个团队的输出风格一致。</p>
</li>
<li>
<p><strong>社区生态：</strong> 你可以在社区中发现、构建并共享你的 Skill，让优秀的能力跨越不同的使用者和场景，不断复用和传承。</p>
</li>
</ul>
<h3 data-id="heading-11"><strong>Skills 和其他功能怎么选？</strong></h3>
<p>在 TRAE 中，有多种方式可以引导 AI 更好地理解你的意图。那么，在 Skill 和其他功能之间，我们应该如何选择呢？</p>
<h4 data-id="heading-12"><strong>Prompt vs Skills</strong></h4>
<p>Prompt（提示词）是一次性的指令。如果你发现自己为了同一个目的，反复输入了三遍以上的 Prompt，那就应该考虑将它沉淀为一个 Skill 了。</p>
<h4 data-id="heading-13"><strong>Rules vs Skills</strong></h4>
<p>Rules（规则）是全局生效的，一旦设置，它会在整个对话过程中持续占用 AI 的“注意力”（上下文窗口）。</p>
<p>如果你的 Rules 文件变得越来越臃肿，不妨把其中与具体工作流程相关的指令迁移到 Skill 中。Rules 里只保留一些轻量级的、全局性的偏好设置，比如你喜欢的代码风格、沟通语言等。</p>
<h4 data-id="heading-14"><strong>Context vs Skills</strong></h4>
<p>Context（上下文）通常指的是在 Workspace（工作空间）内共享的知识库或文档。AI 在对话开始时就会读取这些内容，并同样会占用上下文窗口。</p>
<p>相比之下，Skill 是结构化的、可执行的指令，只在被需要时<strong>主动触发</strong>。因此，Skill 更适合用来封装可复用的工作流程和行为指令，而 Context 更适合提供背景信息和知识参考。</p>
<h4 data-id="heading-15"><strong>SOLO Sub Agent vs Skills</strong></h4>
<p>Sub Agent（子智能体）可以看作是一个专注于特定领域的“专职员工”，而 Skills 则是一个可随处迁移的“能力包”，能够被不同的智能体、在不同的场景下复用。</p>
<p>如果你发现多个不同的 Sub Agent 都需要某一项同样的能力，那么最好的做法就是将这项能力抽象成一个 Skill，供所有智能体按需调用。</p>
<p><strong>总结一下：</strong></p>
<ul>
<li>
<p><strong>Rules、Context 和 Sub Agent</strong> 的指令通常会<strong>持续占用</strong>宝贵的上下文窗口。</p>
</li>
<li>
<p><strong>Skills</strong> 则是<strong>按需加载</strong>，不仅节省了资源（Token），也让 AI 的每一次行动都更加专注和高效。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c95304fcdc9b48dcbea9a462b6ed475d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=HanNUn0IVxonY%2FOu%2BbI3UZc0qXY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-16"><strong>Skills 的编写结构</strong></h2>
<p>一个 Skill 到底长什么样？</p>
<p>从本质上讲，一个 Skill 就是一个包含了 <em><strong>SKILL.md</strong></em> 文件的文件夹。这个 <em><strong>SKILL.md</strong></em> 文件是用 Markdown 格式编写的，它就像一份“使用说明书”，告诉 AI 这个 Skill 是用来做什么的、应该如何使用。</p>
<p>由于 Skill 采用标准的 <strong>Markdown</strong> 格式，因此无论是创建、阅读还是分享，都非常方便。</p>
<p>标准文件结构（<strong>唯一必需</strong> <strong>的是</strong> <em><strong>Skill.md</strong></em> <strong>文件</strong> <strong>，</strong> <strong>其他都是</strong> <strong>可选</strong> <strong>的</strong> <strong>，根据你的 Skill 需要来决定。)</strong></p>
<pre><code class="hljs language-python" lang="python">your-Skill/
├── Skill.md          <span class="hljs-comment"># 必需：智能体的核心指令</span>
├── examples/         <span class="hljs-comment"># 可选：输入/输出示例</span>
│   ├── <span class="hljs-built_in">input</span>.md
│   └── output.md
├── templates/        <span class="hljs-comment"># 可选：可复用的模板</span>
│   └── component.tsx
└── resources/        <span class="hljs-comment"># 可选：参考文件、运行脚本或素材</span>
    └── style-guide.md
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b69e38968704bf7847c6fd3a51e1f6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=0l%2F4NV750AxUcdeb1d92Q0izsiU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-17"><strong>在 TRAE 中使用 Skills</strong></h2>
<blockquote>
<p><strong>使用 Skills 的黄金法则是</strong> <strong>「先跑起来，再慢慢优化」</strong> <strong>。你的第一个版本不需要追求完美。</strong></p>
<ul>
<li>
<p><strong>第 1 步：</strong> 先创建一个只包含核心功能的基础版本。</p>
</li>
<li>
<p><strong>第 2 步：</strong> 用一个真实的任务来测试它。</p>
</li>
<li>
<p><strong>第 3 步：</strong> 观察输出结果，看看哪里不尽如人意。</p>
</li>
<li>
<p><strong>第 4 步：</strong> 针对发现的问题，优化和补充你的指令。</p>
</li>
<li>
<p><strong>第 5 步：</strong> 重复以上步骤，不断迭代。</p>
</li>
</ul>
<p><strong>请记住：一个好用的 Skill，一定是在实际使用中反复打磨出来的。先让它能用，再追求好用。</strong></p>
</blockquote>
<p>你可以选择导入他人的 Skill 或者自己创建一个 Skill，当然你导入了他人的 Skill 也可以根据自己的实际需求进行修改。</p>
<h3 data-id="heading-18"><strong>导入社区 Agent Skills</strong></h3>
<p>TRAE 的 Skills 功能基于开放的 Agent Skills 标准构建，这意味着它完全兼容社区生态。你可以从 GitHub 等代码托管平台上找到海量的现成 Skill，直接下载并导入使用。</p>
<p><strong>导入步骤：</strong></p>
<ol>
<li>
<p>从社区找到你需要的 Skill（比如 Example Agent Skills：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%25EF%25BC%2589" target="_blank" title="https://github.com/anthropics/skills%EF%BC%89" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></p>
</li>
<li>
<p>下载包含 <em><strong>Skill.md</strong></em> 的文件夹</p>
</li>
<li>
<p>在 TRAE 中导入：设置 → 规则和技能 → 技能 → 创建</p>
</li>
</ol>
<p>你可以直接使用已有的 Skills，也可以根据自己的需求修改。</p>
<h3 data-id="heading-19"><strong>创建你自己的 Skills</strong></h3>
<p>一个 Skill 由以下几部分组成：</p>
<ul>
<li>
<p><strong>名称：</strong> 为你的 Skill 起一个清晰易懂的名字。</p>
</li>
<li>
<p><strong>描述：</strong> 简单说明这个 Skill 是做什么的，以及在什么情况下应该使用它。</p>
</li>
<li>
<p><strong>指令（可选）：</strong> 如果任务比较复杂，可以在这里提供详细的、分步骤的指令。</p>
</li>
</ul>
<p>就这么简单。对于一些简单的任务，一个 Skill 甚至只需要名称和描述就足够了。<strong>只有当你的工作流需要特定的步骤或输出格式时，才需要逐步添加更详细的指令。</strong></p>
<h4 data-id="heading-20"><strong>方式一：在对话中创建 Skills</strong></h4>
<p>最简单的方式是直接和 TRAE 对话。描述你的需求，AI 会帮你生成 Skill。</p>
<p>比如：</p>
<ul>
<li>
<p>"创建一个 Skill，帮我检查代码的性能问题"</p>
</li>
<li>
<p>"做一个生成 CSS 组件的 Skill，要符合我们的品牌规范"</p>
</li>
<li>
<p>"建一个 Skill，用来规范我的数据分析报告"</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dccc6144d89c4fe99ea4a74863c74e91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=HiW2hI%2FL2RuklKhic6WtB3%2FX9I0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-21"><strong>方式二：手动创建 Skills</strong></h4>
<p>如果你想要添加更详细的工作流、指令及工具调用，可以用 Markdown 格式手动编写 Skill。</p>
<p>​</p>
<p><strong>基础</strong> <em><strong>Skill.md</strong></em> <strong>模板：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Skill</span> <span class="hljs-string">名称</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">简要描述这个</span> <span class="hljs-string">Skill</span> <span class="hljs-string">的功能和使用场景</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment"># Skill 名称</span>

<span class="hljs-comment">## Description</span>
<span class="hljs-string">一句话说明这个</span> <span class="hljs-string">Skill</span> <span class="hljs-string">干什么。</span>

<span class="hljs-comment">## When to Use</span>
<span class="hljs-string">触发这个</span> <span class="hljs-string">Skill</span> <span class="hljs-string">的条件。</span>

<span class="hljs-comment">## Instructions</span>
<span class="hljs-string">清晰的分步说明，告诉</span> <span class="hljs-string">TRAE</span> <span class="hljs-string">智能体具体怎么做。</span>

<span class="hljs-comment">## Examples (Optional)</span>
<span class="hljs-string">输入/输出示例，展示预期效果。</span>
</code></pre>
<h3 data-id="heading-22"><strong>如何调用你的 Skills</strong></h3>
<p>一共有两种方式调用：</p>
<h4 data-id="heading-23"><strong>方式一：显性调用</strong></h4>
<p>显性调用，就是直接在你的指令中明确告诉 AI 使用哪一个 Skill。这种方式可以让你精准地控制 AI 的行为，确保输出结果的稳定性。</p>
<p><strong>示例：</strong></p>
<ul>
<li>
<p>“用 <em><strong>codemap</strong></em> Skill 总结一下这个代码分支做了哪些修改。”</p>
</li>
<li>
<p>“请使用 <em><strong>Frontend Design</strong></em> Skill 来构建这个 UI 组件。”</p>
</li>
<li>
<p>“用 <em><strong>CSV</strong></em> Skill 帮我处理一下这个数据集。”</p>
</li>
</ul>
<p>当你明确知道应该使用哪个 Skill，并且希望得到稳定、可预期的结果时，推荐使用显性调用。</p>
<h4 data-id="heading-24"><strong>方式二：隐性调用</strong></h4>
<p>隐性调用，则完全依赖 AI 的自主判断。AI 会根据你当前的任务描述，以及每个 Skill 中“何时使用（When to Use）”的描述，来自动决定是否以及调用哪个 Skill。</p>
<p>例如，假设你创建了一个名为 <em><strong>Code Review</strong></em> 的 Skill，并在其中定义了触发条件是“当用户请求代码反馈时”。那么，当你向 AI 提出以下问题时：</p>
<ul>
<li>
<p>“你觉得这个函数写得怎么样？”</p>
</li>
<li>
<p>“帮我 review 一下这个合并请求（PR）。”</p>
</li>
<li>
<p>“这段代码有什么潜在的问题吗？”</p>
</li>
</ul>
<p>AI 会自动识别出你的意图，并调用 <em><strong>Code Review</strong></em> Skill 来回答你的问题，整个过程无需你手动指定。</p>
<h4 data-id="heading-25"><strong>如何选择「显性」还是「隐性」</strong></h4>
<ul>
<li><strong>当任务复杂、关键或需要高度稳定的输出时，建议采用显性调用。</strong></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c96956d1931a48838f0d5d05d08799d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=ppIUZU9o8Z53%2FvdOX290B5oA8Aw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-26"><strong>一起来实操</strong></h2>
<p>我们以创建一个“多彩输出”的 Skill 为例。</p>
<p>该技能主要是为了能够让 AI 在回复的时候，根据内容情况，修改内容的颜色，便于我们直接就看到关键点等，功能比较简单，先让大家感受一下 Skill 的魅力。</p>
<blockquote>
<p>操作版本：TRAE 中国版</p>
</blockquote>
<h3 data-id="heading-27"><strong>1. 在 TRAE 中打开 Skills 创建面板</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5140563502ca4083b4826643af5838a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=z0x269IfRGA0d1PlPpUPUHK0D6E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-28"><strong>2. 创建我所需要的 Skills</strong></h3>
<ul>
<li>
<p><strong>技能名称：</strong> 就是你的技能叫什么名字，将来调用的技能你就能看到这个技能被调用了。</p>
</li>
<li>
<p><strong>描述：</strong> 就是你的这个技能的一些说明，做什么的，有什么用等等。</p>
</li>
<li>
<p><strong>指令：</strong> 这个是最重要的地方，就是技能怎么实现的地方。</p>
</li>
</ul>
<p>如果你不太清楚指令该如何写，这里有一个小技巧：你可以先把写好了技能名称和描述的界面截图，然后将图片发给一个能够识别图片的多模态模型（如 Doubao-Seed-Coder），并对它说**「你好，我想制作一个 Skill，名称和描述如图片所示，但我不擅长写指令，你来帮我写一下吧」。**</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0d81d4f383e497cb20ee28f7b862b27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=%2BGxGiOEP1L0ryKx4Oms7bna6dws%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-29"><strong>3. 查看创建的 Skills</strong></h3>
<p>创建完成后，我们回到文件目录。你会发现在根目录下的 <em><strong>.trae</strong></em> 文件夹里，系统自动创建了一个 <em><strong>skills</strong></em> 目录，并在其中生成了一个名为“多彩输出”的子目录。这个子目录里包含一个<em><strong>SKILL.md</strong></em> 文件。<strong>这个文件的内容，正是由我们刚刚填写的技能名称、描述和指令生成的。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a94c1aae9a5b4dd3ac9eea1969ff6fb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=eL4%2FAAvZ3QEUjVkdCDzXKjBM%2BeQ%3D" alt="" loading="lazy"/></p>
<p>下面是本次创建的 SKILL.md 文件内容，可以看到里面包括：</p>
<ul>
<li>
<p><em><strong>name</strong></em> 字段，就是我们填的技能名称。</p>
</li>
<li>
<p><em><strong>description</strong></em> 字段，就是我们填的描述。</p>
</li>
<li>
<p>而其他的部分就是我们填写的指令（<em><strong>Command</strong></em>）。</p>
</li>
</ul>

<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">---</span>
<span class="hljs-selector-tag">name</span>: 多彩输出
<span class="hljs-selector-tag">description</span>: 用多种颜色来包装<span class="hljs-selector-tag">AI</span>回复的内容，通过颜色来区分内容的重要度，一眼就知道回复的关键点在哪里。
<span class="hljs-selector-tag">---</span>

# 多彩输出

多彩输出技能可以将<span class="hljs-selector-tag">AI</span>回复的内容用不同颜色进行包装，通过颜色来区分内容的重要度，帮助您快速识别回复中的关键点。

## 触发方式

该技能支持自然语言触发，您可以使用以下方式触发多彩输出功能：

<span class="hljs-selector-tag">-</span> 请用多彩颜色回复
<span class="hljs-selector-tag">-</span> 多彩输出
<span class="hljs-selector-tag">-</span> 用颜色回复
<span class="hljs-selector-tag">-</span> 多彩颜色
<span class="hljs-selector-tag">-</span> 彩色输出

当您使用以上自然语言表达时，<span class="hljs-selector-tag">AI</span>会自动以多彩颜色的方式回复您的内容。

## 使用场景

<span class="hljs-number">1</span>. **阅读长回复时** ：通过颜色区分重要信息，快速抓住回复的核心内容
<span class="hljs-number">2</span>. **学习新知识时** ：用不同颜色标记不同类型的信息，提高学习效率
<span class="hljs-number">3</span>. **工作汇报时** ：突出关键数据和结论，使汇报更专业、更易理解
<span class="hljs-number">4</span>. **日常交流时** ：增加回复的视觉吸引力，提升沟通体验

## 输出解释

技能会根据内容的类型和重要度，自动为不同部分添加颜色：

<span class="hljs-selector-tag">-</span> &lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#FF5733</span>;"&gt;红色&lt;/<span class="hljs-selector-tag">span</span>&gt; <span class="hljs-selector-tag">-</span> 用于强调重要信息和警告
<span class="hljs-selector-tag">-</span> &lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#33FF57</span>;"&gt;绿色&lt;/<span class="hljs-selector-tag">span</span>&gt; <span class="hljs-selector-tag">-</span> 用于显示成功或正面信息
<span class="hljs-selector-tag">-</span> &lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#3357FF</span>;"&gt;蓝色&lt;/<span class="hljs-selector-tag">span</span>&gt; <span class="hljs-selector-tag">-</span> 用于显示一般提示或链接
<span class="hljs-selector-tag">-</span> &lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#FF33A8</span>;"&gt;粉色&lt;/<span class="hljs-selector-tag">span</span>&gt; <span class="hljs-selector-tag">-</span> 用于显示特殊说明
<span class="hljs-selector-tag">-</span> &lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#FFC300</span>;"&gt;黄色&lt;/<span class="hljs-selector-tag">span</span>&gt; <span class="hljs-selector-tag">-</span> 用于显示注意事项

## 示例

### 示例<span class="hljs-number">1</span>：触发多彩输出

**触发方式** ：输入`请用多彩颜色回复`

**<span class="hljs-selector-tag">AI</span>回复** ：

在&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#3357FF</span>;"&gt;<span class="hljs-selector-tag">Python</span>&lt;/<span class="hljs-selector-tag">span</span>&gt;中，可以使用&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#FF5733</span>;"&gt;<span class="hljs-selector-tag">requests</span>&lt;/<span class="hljs-selector-tag">span</span>&gt;库来发送&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#33FF57</span>;"&gt;<span class="hljs-selector-tag">HTTP</span>请求&lt;/<span class="hljs-selector-tag">span</span>&gt;。首先需要&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#FFC300</span>;"&gt;安装<span class="hljs-selector-tag">requests</span>库&lt;/<span class="hljs-selector-tag">span</span>&gt;，然后&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#3357FF</span>;"&gt;导入并使用<span class="hljs-selector-tag">get</span>方法&lt;/<span class="hljs-selector-tag">span</span>&gt;。

### 示例<span class="hljs-number">2</span>：带问题的多彩输出

**触发方式** ：输入`请用多彩颜色回复 <span class="hljs-selector-tag">Python</span>的<span class="hljs-selector-tag">requests</span>库如何使用？`

**<span class="hljs-selector-tag">AI</span>回复** ：

要使用&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#3357FF</span>;"&gt;<span class="hljs-selector-tag">Python</span>&lt;/<span class="hljs-selector-tag">span</span>&gt;的&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#FF5733</span>;"&gt;<span class="hljs-selector-tag">requests</span>&lt;/<span class="hljs-selector-tag">span</span>&gt;库，首先需要&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#FFC300</span>;"&gt;安装&lt;/<span class="hljs-selector-tag">span</span>&gt;它：&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#33FF57</span>;"&gt;<span class="hljs-selector-tag">pip</span> <span class="hljs-selector-tag">install</span> <span class="hljs-selector-tag">requests</span>&lt;/<span class="hljs-selector-tag">span</span>&gt;。然后可以&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#FFC300</span>;"&gt;导入&lt;/<span class="hljs-selector-tag">span</span>&gt;并使用它发送各种&lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>="<span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#3357FF</span>;"&gt;<span class="hljs-selector-tag">HTTP</span>请求&lt;/<span class="hljs-selector-tag">span</span>&gt;。

## 实现方式

该技能直接通过<span class="hljs-selector-tag">AI</span>的回复模板实现多彩输出，无需执行外部<span class="hljs-selector-tag">Python</span>脚本。当您使用自然语言触发短语后，<span class="hljs-selector-tag">AI</span>会自动在回复内容中添加<span class="hljs-selector-tag">HTML</span>颜色标签，使不同类型的信息显示不同的颜色。
</code></pre>
<p>到这里为止，一个技能就创建好了，这个技能比较简单，所以一个 SKILL.md 就能解决问题。</p>
<blockquote>
<p>如果你的 Skill 功能比较复杂，光靠一个 <em><strong>SKILL.md</strong></em> 文件无法实现时，我们同样可以求助 AI。</p>
<p>例如，假设我们需要创建一个“语音播报”的 Skill。我们可以告诉 AI：“我希望这个 Skill 能够直接播报 AI 回复的内容”。AI 会自动检查我们创建的“语音播报” Skill，如果发现它只是一个空架子，就会开始帮助我们补充实现功能的代码和指令。接下来，我们只需要在 AI 的协助下不断调试，直到功能完善。</p>
</blockquote>
<h3 data-id="heading-30"><strong>4. 使用创建的 Skills</strong></h3>
<p>现在，让我们新建一个对话，来试试刚刚创建的 Skill 的效果吧。可以看到，AI 的输出完全遵循了我们在 Skill 中定义的规则。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0d7adffd1164669975dc20381c8b4e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=2YoGmjYwH%2FmWQyl6sAFrYno7yc4%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5924cce0ab3142e488191bfee33ba2b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=X6uHzUbXblKQbrWGZ9sl1NEvKVc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa15f454db26466690e27596b0fcc475~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088570&amp;x-signature=zELy50nzpWTdDWu0rQFkle1Q4ts%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-31"><strong>总结</strong></h2>
<p>希望这个简单的例子，能让你直观地感受到 Skills 的魅力。</p>
<p>今天我们全面更新了 Skills 的功能，我们不仅在 Beta 版的基础上新增了 2 个功能，同时在 <strong>SOLO + IDE 模式</strong>以及<strong>全部智能体和模型（含自定义）均支持了 Skills！</strong></p>
<blockquote>
<p>一些社区资料：</p>
<ul>
<li>
<p>官方博客解释 Skill 概念：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fclaude.com%2Fblog%2Fskills-explained" target="_blank" title="https://claude.com/blog/skills-explained" ref="nofollow noopener noreferrer">claude.com/blog/skills…</a></p>
</li>
<li>
<p>Claude 官方实践指南：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.claude.com%2Fdocs%2Fzh-CN%2Fagents-and-tools%2Fagent-skills%2Fbest-practices" target="_blank" title="https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/best-practices" ref="nofollow noopener noreferrer">platform.claude.com/docs/zh-CN/…</a></p>
</li>
<li>
<p>Claude 官方 Skills 仓库<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills" target="_blank" title="https://github.com/anthropics/skills" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></p>
</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个Python库：python-dateutil - 强大的日期时间解析与计算工具]]></title>    <link>https://juejin.cn/post/7599604510365990950</link>    <guid>https://juejin.cn/post/7599604510365990950</guid>    <pubDate>2026-01-27T03:09:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599604510365990950" data-draft-id="7599581204860780570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个Python库：python-dateutil - 强大的日期时间解析与计算工具"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-27T03:09:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="敏编程"/> <meta itemprop="url" content="https://juejin.cn/user/2579909358396288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个Python库：python-dateutil - 强大的日期时间解析与计算工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2579909358396288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    敏编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:09:25.000Z" title="Tue Jan 27 2026 03:09:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">python-dateutil - 强大的日期时间解析与计算工具</h2>
<h3 data-id="heading-1">一、什么是python-dateutil？</h3>
<p><strong>python-dateutil</strong> 是一个用于扩展标准库 <code>datetime</code> 模块的 Python 库。
它可以帮助你：</p>
<ul>
<li>灵活地解析各种格式的日期时间字符串。</li>
<li>进行复杂的日期时间计算，例如计算两个日期之间的相对时间。</li>
<li>处理时区信息，进行时区转换。</li>
</ul>
<h3 data-id="heading-2">二、应用场景</h3>
<p><strong>python-dateutil</strong> 广泛应用于以下实际场景：</p>
<ul>
<li><strong>日志分析</strong>: 从不同格式的日志文件中提取日期时间信息进行分析。</li>
<li><strong>数据处理</strong>: 清洗和标准化包含日期时间字段的数据集。</li>
<li><strong>排程系统</strong>: 计算任务的开始时间、结束时间或未来某个时间点。</li>
<li><strong>报表生成</strong>: 根据特定时间范围汇总数据。</li>
</ul>
<h3 data-id="heading-3">三、如何安装</h3>
<ol>
<li>使用 pip 安装</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install python-dateutil

<span class="hljs-comment"># 如果安装慢的话，推荐使用国内镜像源</span>
pip install python-dateutil -i https://www.python64.cn/pypi/simple/
</code></pre>
<ol start="2">
<li>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行代码（无需本地安装）</li>
</ol>
<h3 data-id="heading-4">四、示例代码</h3>
<p>解析并格式化一个日期字符串</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dateutil <span class="hljs-keyword">import</span> parser
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># 一个包含日期的字符串</span>
date_string = <span class="hljs-string">"May 25, 2023 at 10:30 AM"</span>

<span class="hljs-comment"># 使用dateutil.parser解析字符串</span>
parsed_date = parser.parse(date_string)

<span class="hljs-comment"># 检查解析是否成功</span>
<span class="hljs-keyword">if</span> parsed_date:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"原始日期字符串: <span class="hljs-subst">{date_string}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"解析后的日期对象: <span class="hljs-subst">{parsed_date}</span>"</span>)
    <span class="hljs-comment"># 将解析后的日期格式化为另一种字符串</span>
    formatted_date = parsed_date.strftime(<span class="hljs-string">"%Y/%m/%d %H:%M:%S"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"格式化后的日期字符串: <span class="hljs-subst">{formatted_date}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"日期字符串解析失败。"</span>)

</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F%3Fcode%3Dfrom%2520dateutil%2520import%2520parser%250Afrom%2520datetime%2520import%2520datetime%250A%250A%2523%2520%25E4%25B8%2580%25E4%25B8%25AA%25E5%258C%2585%25E5%2590%25AB%25E6%2597%25A5%25E6%259C%259F%25E7%259A%2584%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%250Adate_string%2520%253D%2520%2522May%252025%252C%25202023%2520at%252010%253A30%2520AM%2522%250A%250A%2523%2520%25E4%25BD%25BF%25E7%2594%25A8dateutil.parser%25E8%25A7%25A3%25E6%259E%2590%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%250Aparsed_date%2520%253D%2520parser.parse%2528date_string%2529%250A%250A%2523%2520%25E6%25A3%2580%25E6%259F%25A5%25E8%25A7%25A3%25E6%259E%2590%25E6%2598%25AF%25E5%2590%25A6%25E6%2588%2590%25E5%258A%259F%250Aif%2520parsed_date%253A%250A%2520%2520%2520%2520print%2528f%2522%25E5%258E%259F%25E5%25A7%258B%25E6%2597%25A5%25E6%259C%259F%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%253A%2520%257Bdate_string%257D%2522%2529%250A%2520%2520%2520%2520print%2528f%2522%25E8%25A7%25A3%25E6%259E%2590%25E5%2590%258E%25E7%259A%2584%25E6%2597%25A5%25E6%259C%259F%25E5%25AF%25B9%25E8%25B1%25A1%253A%2520%257Bparsed_date%257D%2522%2529%250A%2520%2520%2520%2520%2523%2520%25E5%25B0%2586%25E8%25A7%25A3%25E6%259E%2590%25E5%2590%258E%25E7%259A%2584%25E6%2597%25A5%25E6%259C%259F%25E6%25A0%25BC%25E5%25BC%258F%25E5%258C%2596%25E4%25B8%25BA%25E5%258F%25A6%25E4%25B8%2580%25E7%25A7%258D%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%250A%2520%2520%2520%2520formatted_date%2520%253D%2520parsed_date.strftime%2528%2522%2525Y%252F%2525m%252F%2525d%2520%2525H%253A%2525M%253A%2525S%2522%2529%250A%2520%2520%2520%2520print%2528f%2522%25E6%25A0%25BC%25E5%25BC%258F%25E5%258C%2596%25E5%2590%258E%25E7%259A%2584%25E6%2597%25A5%25E6%259C%259F%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%253A%2520%257Bformatted_date%257D%2522%2529%250Aelse%253A%250A%2520%2520%2520%2520print%2528%2522%25E6%2597%25A5%25E6%259C%259F%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%25E8%25A7%25A3%25E6%259E%2590%25E5%25A4%25B1%25E8%25B4%25A5%25E3%2580%2582%2522%2529%250A" target="_blank" title="https://www.min2k.com/tools/python-run/?code=from%20dateutil%20import%20parser%0Afrom%20datetime%20import%20datetime%0A%0A%23%20%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E6%97%A5%E6%9C%9F%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%0Adate_string%20%3D%20%22May%2025%2C%202023%20at%2010%3A30%20AM%22%0A%0A%23%20%E4%BD%BF%E7%94%A8dateutil.parser%E8%A7%A3%E6%9E%90%E5%AD%97%E7%AC%A6%E4%B8%B2%0Aparsed_date%20%3D%20parser.parse%28date_string%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E8%A7%A3%E6%9E%90%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%0Aif%20parsed_date%3A%0A%20%20%20%20print%28f%22%E5%8E%9F%E5%A7%8B%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%3A%20%7Bdate_string%7D%22%29%0A%20%20%20%20print%28f%22%E8%A7%A3%E6%9E%90%E5%90%8E%E7%9A%84%E6%97%A5%E6%9C%9F%E5%AF%B9%E8%B1%A1%3A%20%7Bparsed_date%7D%22%29%0A%20%20%20%20%23%20%E5%B0%86%E8%A7%A3%E6%9E%90%E5%90%8E%E7%9A%84%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%BA%E5%8F%A6%E4%B8%80%E7%A7%8D%E5%AD%97%E7%AC%A6%E4%B8%B2%0A%20%20%20%20formatted_date%20%3D%20parsed_date.strftime%28%22%25Y%2F%25m%2F%25d%20%25H%3A%25M%3A%25S%22%29%0A%20%20%20%20print%28f%22%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E7%9A%84%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%3A%20%7Bformatted_date%7D%22%29%0Aelse%3A%0A%20%20%20%20print%28%22%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%E3%80%82%22%29%0A" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行这段代码，结果如下：</p>
<pre><code class="hljs language-text" lang="text">原始日期字符串: May 25, 2023 at 10:30 AM
解析后的日期对象: 2023-05-25 10:30:00
格式化后的日期字符串: 2023/05/25 10:30:00
</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fmermaid%2F%3Fcode%3Dflowchart%2520TB%250A%2520%2520A%255B%25E5%25BC%2580%25E5%25A7%258B%255D%2520--%253E%2520B%257B%25E5%25AF%25BC%25E5%2585%25A5%25E6%25A8%25A1%25E5%259D%2597%257D%253B%250A%2520%2520B%2520--%253E%2520C%255B%25E5%25AE%259A%25E4%25B9%2589%25E6%2597%25A5%25E6%259C%259F%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%255D%253B%250A%2520%2520C%2520--%253E%2520D%255B%25E4%25BD%25BF%25E7%2594%25A8parser.parse%25E8%25A7%25A3%25E6%259E%2590%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%255D%253B%250A%2520%2520D%2520--%253E%2520E%257B%25E5%2588%25A4%25E6%2596%25AD%25E8%25A7%25A3%25E6%259E%2590%25E6%2598%25AF%25E5%2590%25A6%25E6%2588%2590%25E5%258A%259F%253F%257D%253B%250A%2520%2520E%2520--%2520%25E6%2598%25AF%2520--%253E%2520F%255B%25E6%2589%2593%25E5%258D%25B0%25E5%258E%259F%25E5%25A7%258B%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%255D%253B%250A%2520%2520F%2520--%253E%2520G%255B%25E6%2589%2593%25E5%258D%25B0%25E8%25A7%25A3%25E6%259E%2590%25E5%2590%258E%25E5%25AF%25B9%25E8%25B1%25A1%255D%253B%250A%2520%2520G%2520--%253E%2520H%255B%25E6%25A0%25BC%25E5%25BC%258F%25E5%258C%2596%25E6%2597%25A5%25E6%259C%259F%255D%253B%250A%2520%2520H%2520--%253E%2520I%255B%25E6%2589%2593%25E5%258D%25B0%25E6%25A0%25BC%25E5%25BC%258F%25E5%258C%2596%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%255D%253B%250A%2520%2520E%2520--%2520%25E5%2590%25A6%2520--%253E%2520J%255B%25E6%2589%2593%25E5%258D%25B0%25E8%25A7%25A3%25E6%259E%2590%25E5%25A4%25B1%25E8%25B4%25A5%25E4%25BF%25A1%25E6%2581%25AF%255D%253B%250A%2520%2520I%2520--%253E%2520K%255B%25E7%25BB%2593%25E6%259D%259F%255D%253B%250A%2520%2520J%2520--%253E%2520K%253B" target="_blank" title="https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%7D%3B%0A%20%20B%20--%3E%20C%5B%E5%AE%9A%E4%B9%89%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%5D%3B%0A%20%20C%20--%3E%20D%5B%E4%BD%BF%E7%94%A8parser.parse%E8%A7%A3%E6%9E%90%E5%AD%97%E7%AC%A6%E4%B8%B2%5D%3B%0A%20%20D%20--%3E%20E%7B%E5%88%A4%E6%96%AD%E8%A7%A3%E6%9E%90%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F%3F%7D%3B%0A%20%20E%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%5D%3B%0A%20%20F%20--%3E%20G%5B%E6%89%93%E5%8D%B0%E8%A7%A3%E6%9E%90%E5%90%8E%E5%AF%B9%E8%B1%A1%5D%3B%0A%20%20G%20--%3E%20H%5B%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%97%A5%E6%9C%9F%5D%3B%0A%20%20H%20--%3E%20I%5B%E6%89%93%E5%8D%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%5D%3B%0A%20%20E%20--%20%E5%90%A6%20--%3E%20J%5B%E6%89%93%E5%8D%B0%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%E4%BF%A1%E6%81%AF%5D%3B%0A%20%20I%20--%3E%20K%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20J%20--%3E%20K%3B" ref="nofollow noopener noreferrer">MermaidGo</a> 绘制示例代码的流程图，结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9663d5d3848435da54348365d50949e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWP57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088165&amp;x-signature=JKwfigtlDVfTXVaUfB1zNgfDUpo%3D" alt="MermerGo的python-dateutil流程图" loading="lazy"/></p>
<h3 data-id="heading-5">五、学习资源</h3>
<ol>
<li>开源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdateutil%2Fdateutil" target="_blank" title="https://github.com/dateutil/dateutil" ref="nofollow noopener noreferrer">dateutil</a></li>
<li>中文自述：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python64.cn%2Freadme%2Fpython-dateutil%2F" target="_blank" title="https://www.python64.cn/readme/python-dateutil/" ref="nofollow noopener noreferrer">REMDME</a></li>
<li>在线运行：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a></li>
</ol>
<blockquote>
<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br/>
学习过程中有任何问题，欢迎在评论区留言交流～</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[诊断、分割、解释三位一体：医学AI如何从“工具”进化成“助手”？]]></title>    <link>https://juejin.cn/post/7599652649550233600</link>    <guid>https://juejin.cn/post/7599652649550233600</guid>    <pubDate>2026-01-27T03:16:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599652649550233600" data-draft-id="7599598627007627316" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="诊断、分割、解释三位一体：医学AI如何从“工具”进化成“助手”？"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2026-01-27T03:16:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            诊断、分割、解释三位一体：医学AI如何从“工具”进化成“助手”？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T03:16:50.000Z" title="Tue Jan 27 2026 03:16:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在医学影像的世界里，AI模型大多还停留在“工具”阶段：它们能精准勾画病灶轮廓，却无法告诉你这意味着什么；它们能回答疾病名称，却指不出病灶的具体位置。医生面对的，仍然是碎片化的信息。</p>
<p>一项来自澳门大学的研究，正试图打破这种割裂。Sim4Seg 的提出，标志着医学视觉语言模型开始从“工具”向“具备诊断推理能力的助手”演进。</p>
<h2 data-id="heading-0"><strong>临床的真正需求：分割、诊断与解释，缺一不可</strong></h2>
<p>想象一下这个场景：一位医生拿到一张胸片，AI不仅高亮了一片阴影区域（分割），还能同时给出诊断——“疑似肺炎”，并附上推理：“此处可见片状高密度影，边界模糊，符合社区获得性肺炎的典型影像学表现”。</p>
<p>这才是临床工作流中真正需要的辅助：定位、定性与解释，三位一体。</p>
<p>然而，现有技术是割裂的：</p>
<ul>
<li><strong>传统分割模型（如U-Net、SAM-Med2D）：</strong> 精于像素级勾勒，但“沉默不语”。</li>
<li><strong>医学视觉问答模型（VQA）：</strong> 能回答问题，但输出是纯文本，缺乏空间定位能力。</li>
</ul>
<p>Sim4Seg所定义的 <strong>Medical Diagnosis Segmentation（MDS）</strong>  任务，正是为了解决这一核心矛盾。它要求模型接收一张医学图像和一个诊断式查询，同时输出<strong>分割掩码</strong>与带有<strong>推理链（Chain-of-Thought）的诊断结论。</strong></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0321bda2075473d9d0895f4f303c9ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=JBRMs37XoP1NyqCBvpiB3SrFvX8%3D" alt="screenshot_2026-01-26_16-32-42.png" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>数据奠基：M3DS数据集——为“会思考的分割”而生</strong></h2>
<p>好的模型需要好的数据。为了支持MDS这一新任务，研究团队构建了M3DS数据集，其独特价值在于<strong>首次大规模统一了分割标注与诊断推理链。</strong></p>
<ul>
<li><strong>数据亮点：</strong></li>
</ul>

<ul>
<li><strong>多模态与多疾病：</strong> 涵盖X光、超声、内镜、皮肤镜、眼底照相5种模态，包含骨折、息肉、结节、肿瘤等10类疾病。</li>
</ul>

<ul>
<li>
<p><strong>高质量诊断CoT生成：</strong> 采用创新的双角色自动化流水线生成诊断推理文本。</p>
<p>医学助手（HuatuoGPT-Vision）：按步骤分析图像，生成初步诊断与推理。</p>
<p>批判助手：严格审查推理的逻辑完整性、医学准确性和术语规范性。</p>
<p>最终通过人工复核确保可靠性。这套方法高效地解决了诊断文本标注成本极高的难题。</p>
</li>
</ul>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8325efd879084b99af6a0783125e4672~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=KwnS9%2ByzEjS76iLVl627WjxXrlY%3D" alt="screenshot_2026-01-26_16-33-33.png" loading="lazy"/></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94253ab2281245edba407f630d4d6c05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=9TjcetqE0M7lscr8h0wDKNEjaV4%3D" alt="screenshot_2026-01-26_16-33-54.png" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>模型核心：RVLS2M——让语言理解“照亮”图像区域</strong></h2>
<p>Sim4Seg的核心创新是一个名为 <strong>RVLS2M（区域感知视觉-语言相似度掩码）</strong>  的模块。它的设计理念非常巧妙：<strong>利用模型内部对诊断文本的理解，反过来生成一个能指导分割的“区域提示图”。</strong></p>
<p><strong>它是如何工作的？</strong></p>
<ol>
<li>特征提取与对齐：大型视觉语言模型（LVLM）在处理图像和诊断查询时，会输出图像特征和代表分割目标的特殊文本标记特征。</li>
<li>计算相似度图：RVLS2M计算每个图像区域特征与分割目标文本特征之间的余弦相似度，得到一张“热度图”——越亮的地方，表示该区域与文本描述的目标越相关。</li>
<li>生成区域提示：将相似度图网格化、池化，并通过自适应阈值二值化，最终得到一个粗糙的、区域级的提示掩码。</li>
<li>引导精细分割：这个提示掩码作为空间先验知识，输入到像SAM这样的强大分割器中进行细化，得到最终精准的像素级分割结果。</li>
</ol>
<p>简单说，RVLS2M让模型用“语言脑”思考后，告诉“视觉手”应该重点关注图像的哪些地方。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cfdfb8f641d469fb105756068ab0ce2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=RCoILYPeu3TRJVanQ5HCKzUebOI%3D" alt="screenshot_2026-01-26_16-34-15.png" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>性能跃升：不仅更准，而且更“像医生”</strong></h2>
<p>在M3DS数据集上的综合实验表明，Sim4Seg实现了分割与诊断能力的双重飞跃：</p>
<ul>
<li><strong>分割性能显著提升：</strong> 相比强大的基线模型LISA，Sim4Seg在分割交并比（gIoU）指标上提升超过57%。</li>
<li><strong>诊断准确率大幅提高：</strong> 在诊断准确率（Acc）上，Sim4Seg结合推理链数据后，比基线提升超过165%。</li>
<li><strong>即插即用的有效性：</strong> RVLS2M模块甚至可以在不进行额外训练的情况下，直接提升现有模型（如LISA）的分割性能（零样本下提升11.6%），证明了其强大的通用性。</li>
</ul>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df22a1cc348a4e21aa791e26969c569f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=MLC9Ygoug2msL7X41ERIGSHGbeo%3D" alt="screenshot_2026-01-26_16-35-31.png" loading="lazy"/></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81abcd3aba41468f85d15c62f2224222~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=N5DSq%2BHqtA9V34M16FiMZRK6Yms%3D" alt="screenshot_2026-01-26_16-35-41.png" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>两大“助攻”策略：让模型“多想多试”</strong></h2>
<p>除了核心模块，论文中两个策略也值得关注：</p>
<ol>
<li><strong>测试时缩放（TTS）：</strong> 在推理阶段，让模型生成多条不同的诊断推理路径，每条路径都可能诱导出略有差异的分割提示，进而产生多个候选分割结果。最后通过指标选择最优的一个。这模拟了医生的多角度思考过程。</li>
<li><strong>最优粒度选择（τ策略）：</strong> 研究发现，区域提示的“粗细”很有讲究。提示太粗糙（网格太大）会导致定位模糊；提示太精细（网格太小）又会引入噪声。实验找到了一个最佳平衡点（如16×16网格）。</li>
</ol>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16cedd17b24b40e99264f50952c6c15a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=tFYbqgMRX1ZNKICqT6u1iaRPf7k%3D" alt="screenshot_2026-01-26_16-36-06.png" loading="lazy"/></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b69bfb376fa4a078a4156003e78b692~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=87RsgtkHKwBVBEdTA7uO%2BetNz%2F0%3D" alt="screenshot_2026-01-26_16-36-21.png" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>案例见证：看模型如何“一步步思考”</strong></h2>
<p>论文展示了多个跨模态的真实案例。例如，面对一张眼底照片，Sim4Seg不仅能精确分割出黄斑区病变的血管，还能生成如下诊断推理链：</p>
<p>“这是一张眼底彩照。首先，图像中央可见黄斑区...其次，观察到局部有片状出血和渗出...结合患者可能的年龄因素，这些表现符合湿性年龄相关性黄斑变性的诊断。”</p>
<p>这种输出，让模型的决策过程变得<strong>透明、可信、可审查</strong>，极大地增强了临床医生的信任感。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acdcae6779c54791a69c8789b6f2d16b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770088613&amp;x-signature=ISPBlFYMmvlRp8xSIMSQ11Cvgyo%3D" alt="screenshot_2026-01-26_16-36-54.png" loading="lazy"/></p>
<h2 data-id="heading-6"><strong>结语：范式转变的开始</strong></h2>
<p>Sim4Seg的意义远不止于一项技术改进。它代表了一条明确的演进路径：医学AI正从执行单一任务的“专用工具”，成长为能够协同完成感知、推理与解释的临床助手。</p>
<p>通过提出MDS任务、构建M3DS数据集，以及创新性地利用视觉-语言相似性来桥接分割与诊断，这项工作为未来真正“懂医学、会思考”的AI奠定了关键的基础。当模型既能“指出来”，又能“说出来”，还能“解释清楚”时，我们距离AI成为医生的得力伙伴，便又近了一步。</p>
<blockquote>
<p>代码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSLR567%2FSim4Seg" target="_blank" title="https://github.com/SLR567/Sim4Seg" ref="nofollow noopener noreferrer">github.com/SLR567/Sim4…</a></p>
<p>数据集地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSLR567%2FM3DS" target="_blank" title="https://github.com/SLR567/M3DS" ref="nofollow noopener noreferrer">github.com/SLR567/M3DS</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 Java 中实现 Word 和 TXT 之间的互相转换：实用教程]]></title>    <link>https://juejin.cn/post/7599530824426749962</link>    <guid>https://juejin.cn/post/7599530824426749962</guid>    <pubDate>2026-01-27T01:37:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599530824426749962" data-draft-id="7599538010726039579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 Java 中实现 Word 和 TXT 之间的互相转换：实用教程"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-27T01:37:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户033212666367"/> <meta itemprop="url" content="https://juejin.cn/user/230252528804124"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 Java 中实现 Word 和 TXT 之间的互相转换：实用教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/230252528804124/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户033212666367
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T01:37:34.000Z" title="Tue Jan 27 2026 01:37:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常的软件开发和办公自动化场景中，文档格式转换是一个普遍且重要的需求。无论是从结构化的 Word 文档中提取纯文本信息，还是将纯文本内容格式化为可编辑的 Word 文档，高效、准确地实现这两种格式的互相转换，是许多开发者面临的痛点。本文将深入探讨如何在 Java 环境下，借助一个功能强大的库，轻松解决 Word 和 TXT 之间的转换难题，提升您的开发效率。</p>
<hr/>
<h2 data-id="heading-0">Spire.Doc for Java：Word 与 TXT 转换的利器</h2>
<p>在 Java 生态中，处理 Word 文档的库并不少见，但 Spire.Doc for Java 凭借其强大的功能和易用性脱颖而出。它是一个专业的 Word 文档处理组件，支持创建、读写、编辑、转换和打印 Word 文档，并且兼容多种 Word 版本。其中，对 Word 和 TXT 格式的互相转换提供了非常便捷的 API。</p>
<h3 data-id="heading-1">引入 Spire.Doc for Java</h3>
<p>要开始使用 Spire.Doc，您需要将其作为依赖添加到您的 Maven 项目中。</p>
<p><strong>Maven 配置示例：</strong></p>
<pre><code class="hljs language-xml" lang="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>com.e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.e-iceblue.cn/repository/maven-public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spire.doc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>14.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<p>请确保您使用的版本是最新的稳定版本，以获取最佳的兼容性和功能。</p>
<hr/>
<h2 data-id="heading-2">从 Word 到 TXT：逐步实现文档内容提取</h2>
<p>将 Word 文档转换为纯文本（TXT）是一个常见的需求，例如用于内容提取、文本分析或跨平台传输。Spire.Doc for Java 提供了一行代码即可完成此操作。</p>
<h3 data-id="heading-3">实现步骤：</h3>
<ol>
<li><strong>加载 Word 文档：</strong> 使用 <code>Document</code> 类的 <code>loadFromFile()</code> 方法加载目标 Word 文档。</li>
<li><strong>保存为 TXT 格式：</strong> 调用 <code>saveToFile()</code> 方法，并指定输出路径和 <code>FileFormat.Txt</code> 格式。</li>
<li><strong>释放资源：</strong> 调用 <code>dispose()</code> 方法释放文档对象占用的资源。</li>
</ol>
<h3 data-id="heading-4">Java 代码示例：</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> com.<span class="hljs-property">spire</span>.<span class="hljs-property">doc</span>.<span class="hljs-property">Document</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">spire</span>.<span class="hljs-property">doc</span>.<span class="hljs-property">FileFormat</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConvertWordtoText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {

        <span class="hljs-comment">// 创建 Document 对象</span>
        <span class="hljs-title class_">Document</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();

        <span class="hljs-comment">// 加载 Word 文件</span>
        doc.<span class="hljs-title function_">loadFromFile</span>(<span class="hljs-string">"示例.docx"</span>);

        <span class="hljs-comment">// 将文档保存为 TXT 格</span>
        doc.<span class="hljs-title function_">saveToFile</span>(<span class="hljs-string">"Word转文本.txt"</span>, <span class="hljs-title class_">FileFormat</span>.<span class="hljs-property">Txt</span>);

        <span class="hljs-comment">// 释放资源</span>
        doc.<span class="hljs-title function_">dispose</span>();
    }
}
</code></pre>
<p><strong>代码解析：</strong></p>
<ul>
<li><code>document.loadFromFile(inputWordPath)</code>: 负责读取指定路径的 Word 文档内容。</li>
<li><code>document.saveToFile(outputTxtPath, FileFormat.Txt)</code>: 这是转换的核心。它将加载的 Word 文档内容以纯文本格式写入到 <code>outputTxtPath</code> 指定的文件中。<code>FileFormat.Txt</code> 枚举值明确指示了目标格式。</li>
<li><code>document.dispose()</code>: 释放资源，用于关闭文件流并释放内存，特别是在处理大量文档时。</li>
</ul>
<hr/>
<h2 data-id="heading-5">从 TXT 到 Word：构建富文本格式文档</h2>
<p>将纯文本（TXT）文件转换为 Word 文档，通常是为了对其进行格式化、添加图片、表格或其他富文本元素。Spire.Doc 同样能轻松实现这一目标。</p>
<h3 data-id="heading-6">实现步骤：</h3>
<ol>
<li><strong>创建或加载 Word 文档：</strong> 对于从 TXT 创建新的 Word 文档，直接创建 <code>Document</code> 对象即可。</li>
<li><strong>加载 TXT 内容：</strong> 使用 <code>Document</code> 类的 <code>loadFromFile()</code> 方法加载 TXT 文件。</li>
<li><strong>保存为 Word 格式：</strong> 调用 <code>saveToFile()</code> 方法，并指定输出路径和 <code>FileFormat.Docx</code>（或 <code>FileFormat.Doc</code>）格式。</li>
<li><strong>释放资源：</strong> 调用 <code>dispose()</code> 方法释放文档对象占用的资源。</li>
</ol>
<h3 data-id="heading-7">Java 代码示例：</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> com.<span class="hljs-property">spire</span>.<span class="hljs-property">doc</span>.<span class="hljs-property">Document</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">spire</span>.<span class="hljs-property">doc</span>.<span class="hljs-property">FileFormat</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConvertTextToWord</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {

        <span class="hljs-comment">// 创建 Document 对象</span>
        <span class="hljs-title class_">Document</span> txt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();

        <span class="hljs-comment">// 加载 .txt 文本文件</span>
        txt.<span class="hljs-title function_">loadFromFile</span>(<span class="hljs-string">"介绍.txt"</span>);

        <span class="hljs-comment">// 将文件保存为 Word 格式</span>
        txt.<span class="hljs-title function_">saveToFile</span>(<span class="hljs-string">"TXT转Word.docx"</span>, <span class="hljs-title class_">FileFormat</span>.<span class="hljs-property">Docx</span>);

        <span class="hljs-comment">// 释放资源</span>
        txt.<span class="hljs-title function_">dispose</span>();
    }
}
</code></pre>
<p><strong>代码解析：</strong></p>
<ul>
<li><code>document.loadFromFile(inputTxtPath)</code>: 这里巧妙地利用了 <code>spire.doc for java</code> 的 <code>loadFromFile</code> 方法不仅可以加载 Word 文档，还能加载 TXT 文件并将其内容导入到 <code>Document</code> 对象中。</li>
<li><code>document.saveToFile(outputWordPath, FileFormat.Docx)</code>: 将包含 TXT 内容的 <code>Document</code> 对象保存为 Word 格式。<code>FileFormat.Docx</code> 是现代 Word 文档的默认格式，您也可以选择 <code>FileFormat.Doc</code>。</li>
</ul>
<p><strong>格式调整建议：</strong></p>
<p>将 TXT 转换为 Word 后，默认情况下可能只是简单的文本导入。如果需要更复杂的格式，例如设置字体、段落样式、页眉页脚等，Spire.Doc 也提供了丰富的 API 来实现这些功能，您可以在 <code>loadFromFile</code> 之后、<code>saveToFile</code> 之前，对 <code>document</code> 对象进行进一步的编辑操作。</p>
<hr/>
<h2 data-id="heading-8">结语</h2>
<p>通过本文的详细介绍和代码示例，相信您已经掌握了在 Java 中使用 Spire.Doc for Java 库实现 Word 和 TXT 文档互相转换的关键技术。该库以其简洁的 API 和强大的功能，为 Java 开发者提供了一个高效、可靠的文档处理解决方案。无论是日常的数据处理，还是复杂的办公自动化系统，Spire.Doc 都能助您一臂之力。鼓励您在实际项目中尝试应用这些技术，并进一步探索该库在 Word 文档处理方面的更多高级功能，例如文档合并、拆分、内容替换、表格操作等，以满足更复杂的业务需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>