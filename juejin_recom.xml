<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Spring Boot模板引擎在后端开发中的实战应用]]></title>    <link>https://juejin.cn/post/7576861477267439635</link>    <guid>https://juejin.cn/post/7576861477267439635</guid>    <pubDate>2025-11-27T00:04:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576861477267439635" data-draft-id="7576484465758863395" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot模板引擎在后端开发中的实战应用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T00:04:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot模板引擎在后端开发中的实战应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:04:22.000Z" title="Thu Nov 27 2025 00:04:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在后端开发中，我们经常需要根据业务数据动态生成各种文本内容：从配置文件到源代码，从SQL脚本到部署文档。</p>
<p>这些重复性的生成任务不仅耗时耗力，还容易出错。模板引擎为我们提供了一种有效的解决方案。</p>
<h2 data-id="heading-0">后端开发的重复性工作痛点</h2>
<p>在后端开发过程中，经常存在大量重复性的工作需要完成</p>
<h4 data-id="heading-1">1. 配置文件需要根据环境动态生成</h4>
<ul>
<li><strong>多环境配置管理</strong>：需要根据数据库类型、环境参数等信息生成不同的application.yml配置文件</li>
<li><strong>基础设施配置</strong>：Nginx、Docker、Kubernetes等配置文件需要根据服务信息动态生成</li>
<li><strong>配置模板复用</strong>：不同项目的配置结构相似，但参数不同，需要统一的配置模板</li>
</ul>
<h4 data-id="heading-2">2. 代码结构高度相似需要模板化生成</h4>
<ul>
<li><strong>CRUD代码生成</strong>：根据数据库表结构自动生成Entity、Repository、Service、Controller等代码</li>
<li><strong>API接口文档生成</strong>：基于Controller注解自动生成接口文档，保持文档与代码同步</li>
<li><strong>项目脚手架</strong>：创建新项目时快速生成标准化的基础代码结构</li>
</ul>
<h4 data-id="heading-3">3. 文档和脚本需要标准化模板</h4>
<ul>
<li><strong>数据库设计文档</strong>：根据表结构信息自动生成数据库设计文档</li>
<li><strong>部署脚本生成</strong>：根据项目配置自动生成部署脚本和说明文档</li>
<li><strong>API文档同步</strong>：基于代码中的注解和结构生成最新的API文档</li>
</ul>
<h4 data-id="heading-4">4. 通知和报表需要动态内容生成</h4>
<ul>
<li><strong>邮件内容模板化</strong>：用户注册、密码重置、订单通知等邮件内容需要根据用户数据动态生成</li>
<li><strong>日志格式标准化</strong>：统一的日志格式模板，包含时间戳、请求ID、用户信息等字段</li>
</ul>
<h2 data-id="heading-5">解决方案：基于模板引擎的自动化生成</h2>
<p>模板引擎通过将模板与数据分离，实现了文本内容的自动化生成。核心思想是：</p>
<ul>
<li><strong>模板定义</strong>：创建包含占位符和控制逻辑的模板文件</li>
<li><strong>数据准备</strong>：构建包含生成所需数据的数据模型</li>
<li><strong>引擎处理</strong>：模板引擎将数据与模板结合，生成最终的文本内容</li>
</ul>
<h4 data-id="heading-6">工作原理详解</h4>
<p>模板引擎的工作流程可以分为以下几个步骤：</p>
<ul>
<li><strong>1. 模板解析</strong>：引擎解析模板文件，构建抽象语法树（AST）</li>
<li><strong>2. 数据绑定</strong>：将传入的数据对象与模板中的变量进行绑定</li>
<li><strong>3. 表达式求值</strong>：计算模板中的表达式，生成动态内容</li>
<li><strong>4. 内容生成</strong>：将处理后的内容输出为目标格式</li>
</ul>
<h4 data-id="heading-7">技术选型</h4>
<p>在后端场景中，常用的模板引擎有FreeMarker、Velocity和Thymeleaf等。</p>
<p><strong>Spring Boot集成FreeMarker：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>基础配置示例：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">freemarker:</span>
    <span class="hljs-attr">template-loader-path:</span> <span class="hljs-string">classpath:/templates/</span>
    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.ftl</span>
    <span class="hljs-attr">charset:</span> <span class="hljs-string">UTF-8</span>
    <span class="hljs-attr">content-type:</span> <span class="hljs-string">text/plain</span>
    <span class="hljs-attr">cache:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 生产环境建议开启缓存</span>
    <span class="hljs-attr">settings:</span>
      <span class="hljs-attr">template_update_delay_milliseconds:</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">default_encoding:</span> <span class="hljs-string">UTF-8</span>
      <span class="hljs-attr">output_encoding:</span> <span class="hljs-string">UTF-8</span>
      <span class="hljs-attr">locale:</span> <span class="hljs-string">zh_CN</span>
      <span class="hljs-attr">datetime_format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span>
      <span class="hljs-attr">number_format:</span> <span class="hljs-number">0</span><span class="hljs-string">.##</span>
      <span class="hljs-attr">boolean_format:</span> <span class="hljs-literal">true</span><span class="hljs-string">,false</span>
</code></pre>
<h4 data-id="heading-8">模板引擎的优势</h4>
<p>相比传统的字符串拼接或硬编码方式，模板引擎具有明显优势：</p>
<ul>
<li><strong>1. 可维护性强</strong>：模板文件与业务代码分离，修改模板不需要重新编译</li>
<li><strong>2. 可读性好</strong>：模板语法接近自然语言，易于理解和维护</li>
<li><strong>3. 功能丰富</strong>：内置条件判断、循环、函数调用等强大功能</li>
<li><strong>4. 缓存机制</strong>：支持模板缓存，提高生成性能</li>
<li><strong>5. 错误处理</strong>：提供详细的错误信息，便于调试和问题定位</li>
</ul>
<h2 data-id="heading-9">配置文件生成实战</h2>
<h4 data-id="heading-10">1. Nginx配置生成器</h4>
<p><code>模板文件 templates/config/nginx.conf.ftl</code></p>
<pre><code class="hljs language-nginx" lang="nginx"># Nginx Configuration for ${serviceName}
# Generated at: .now

upstream ${serviceName}_backend {
    #least_conn;
    &lt;#list servers as server&gt;
    server ${server.host}:${server.port}&lt;#if server.weight??&gt; weight=${server.weight}&lt;/#if&gt;;
    &lt;/#list&gt;
}

server {
    listen ${port};
    server_name ${domain};

    access_log /var/log/nginx/${serviceName}_access.log;
    error_log /var/log/nginx/${serviceName}_error.log;

    &lt;#if sslEnabled&gt;
    ssl_certificate ${sslCertificatePath};
    ssl_certificate_key ${sslCertificateKeyPath};
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    &lt;/#if&gt;

    location / {
        proxy_pass http://${serviceName}_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        &lt;#if timeout??&gt;
        proxy_connect_timeout ${timeout};
        proxy_send_timeout ${timeout};
        proxy_read_timeout ${timeout};
        &lt;/#if&gt;
    }

    &lt;#if staticPath??&gt;
    location /static/ {
        alias ${staticPath}/;
        expires 1d;
        add_header Cache-Control "public, immutable";
    }
    &lt;/#if&gt;

    &lt;#if healthCheckPath??&gt;
    location ${healthCheckPath} {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
    &lt;/#if&gt;
}
</code></pre>
<p><strong>配置生成服务</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigGeneratorService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Configuration freemarkerConfig;

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateNginxConfig</span><span class="hljs-params">(NginxConfig config)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException {
        <span class="hljs-type">Template</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> freemarkerConfig.getTemplate(<span class="hljs-string">"config/nginx.conf.ftl"</span>);

        <span class="hljs-comment">// 添加当前时间戳</span>
        config.setNow(LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME));

        <span class="hljs-keyword">try</span>(<span class="hljs-type">StringWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringWriter</span>()) {
            template.process(config, out);
            <span class="hljs-keyword">return</span> out.toString();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveConfigToFile</span><span class="hljs-params">(String configContent, String outputPath)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(outputPath);
        Files.createDirectories(path.getParent());
        Files.write(path, configContent.getBytes(StandardCharsets.UTF_8));
    }
}

<span class="hljs-comment">// 配置数据模型</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NginxConfig</span> {
    <span class="hljs-keyword">private</span> String serviceName;
    <span class="hljs-keyword">private</span> String domain;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> sslEnabled;
    <span class="hljs-keyword">private</span> String sslCertificatePath;
    <span class="hljs-keyword">private</span> String sslCertificateKeyPath;
    <span class="hljs-keyword">private</span> String staticPath;
    <span class="hljs-keyword">private</span> String healthCheckPath;
    <span class="hljs-keyword">private</span> Integer timeout;
    <span class="hljs-keyword">private</span> List&lt;ServerInfo&gt; servers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServerInfo</span> {
        <span class="hljs-keyword">private</span> String host;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;
        <span class="hljs-keyword">private</span> Integer weight;
    }
}
</code></pre>
<p><strong>使用示例</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/config")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ConfigGeneratorService configGenerator;

    <span class="hljs-meta">@PostMapping("/nginx")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">generateNginxConfig</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> NginxConfig config)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">configContent</span> <span class="hljs-operator">=</span> configGenerator.generateNginxConfig(config);

            <span class="hljs-comment">// 保存到文件</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">outputPath</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/etc/nginx/sites-available/"</span> + config.getServiceName() + <span class="hljs-string">".conf"</span>;
            configGenerator.saveConfigToFile(configContent, outputPath);

            <span class="hljs-keyword">return</span> ResponseEntity.ok(configContent);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> ResponseEntity.status(<span class="hljs-number">500</span>).body(<span class="hljs-string">"配置生成失败: "</span> + e.getMessage());
        }
    }
}
</code></pre>
<h4 data-id="heading-11">2. Docker Compose配置生成</h4>
<p><code>模板文件 templates/config/docker-compose.yml.ftl</code></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
<span class="hljs-string">&lt;#list</span> <span class="hljs-string">services</span> <span class="hljs-string">as</span> <span class="hljs-string">service&gt;</span>
  <span class="hljs-string">${service.name}:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">${service.image}:${service.tag}</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">${service.containerName}</span>
    <span class="hljs-string">&lt;#if</span> <span class="hljs-string">service.ports??&gt;</span>
    <span class="hljs-attr">ports:</span>
    <span class="hljs-string">&lt;#list</span> <span class="hljs-string">service.ports</span> <span class="hljs-string">as</span> <span class="hljs-string">port&gt;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${port.host}:${port.container}"</span>
    <span class="hljs-string">&lt;/#list&gt;</span>
    <span class="hljs-string">&lt;/#if&gt;</span>
    <span class="hljs-string">&lt;#if</span> <span class="hljs-string">service.environment??&gt;</span>
    <span class="hljs-attr">environment:</span>
    <span class="hljs-string">&lt;#list</span> <span class="hljs-string">service.environment</span> <span class="hljs-string">as</span> <span class="hljs-string">key,</span> <span class="hljs-string">value&gt;</span>
      <span class="hljs-string">${key}:</span> <span class="hljs-string">"${value}"</span>
    <span class="hljs-string">&lt;/#list&gt;</span>
    <span class="hljs-string">&lt;/#if&gt;</span>
    <span class="hljs-string">&lt;#if</span> <span class="hljs-string">service.volumes??&gt;</span>
    <span class="hljs-attr">volumes:</span>
    <span class="hljs-string">&lt;#list</span> <span class="hljs-string">service.volumes</span> <span class="hljs-string">as</span> <span class="hljs-string">volume&gt;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">${volume.host}:${volume.container}</span>
    <span class="hljs-string">&lt;/#list&gt;</span>
    <span class="hljs-string">&lt;/#if&gt;</span>
    <span class="hljs-string">&lt;#if</span> <span class="hljs-string">service.dependsOn??&gt;</span>
    <span class="hljs-attr">depends_on:</span>
    <span class="hljs-string">&lt;#list</span> <span class="hljs-string">service.dependsOn</span> <span class="hljs-string">as</span> <span class="hljs-string">dependency&gt;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">${dependency}</span>
    <span class="hljs-string">&lt;/#list&gt;</span>
    <span class="hljs-string">&lt;/#if&gt;</span>
    <span class="hljs-string">&lt;#if</span> <span class="hljs-string">service.networks??&gt;</span>
    <span class="hljs-attr">networks:</span>
    <span class="hljs-string">&lt;#list</span> <span class="hljs-string">service.networks</span> <span class="hljs-string">as</span> <span class="hljs-string">network&gt;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">${network}</span>
    <span class="hljs-string">&lt;/#list&gt;</span>
    <span class="hljs-string">&lt;/#if&gt;</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>

<span class="hljs-string">&lt;/#list&gt;</span>
<span class="hljs-string">&lt;#if</span> <span class="hljs-string">networks??&gt;</span>
<span class="hljs-attr">networks:</span>
<span class="hljs-string">&lt;#list</span> <span class="hljs-string">networks</span> <span class="hljs-string">as</span> <span class="hljs-string">network&gt;</span>
  <span class="hljs-string">${network.name}:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">${network.driver!"bridge"}</span>
<span class="hljs-string">&lt;/#list&gt;</span>
<span class="hljs-string">&lt;/#if&gt;</span>

<span class="hljs-string">&lt;#if</span> <span class="hljs-string">volumes??&gt;</span>
<span class="hljs-attr">volumes:</span>
<span class="hljs-string">&lt;#list</span> <span class="hljs-string">volumes</span> <span class="hljs-string">as</span> <span class="hljs-string">volume&gt;</span>
  <span class="hljs-string">${volume.name}:</span>
<span class="hljs-string">&lt;/#list&gt;</span>
<span class="hljs-string">&lt;/#if&gt;</span>
</code></pre>
<h2 data-id="heading-12">代码生成实战</h2>
<h4 data-id="heading-13">1. CRUD代码生成器</h4>
<p><code>实体类模板 templates/code/Entity.java.ftl</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> ${packageName}.entity;

&lt;#list imports as <span class="hljs-keyword">import</span>&gt;
<span class="hljs-keyword">import</span> ${<span class="hljs-keyword">import</span>};
&lt;/#list&gt;

<span class="hljs-comment">/**
 * ${tableName} 实体类
 *
 * <span class="hljs-doctag">@author</span> ${author}
 * <span class="hljs-doctag">@since</span> ${date}
 */</span>
<span class="hljs-meta">@Data</span>
&lt;#<span class="hljs-keyword">if</span> tableName??&gt;
<span class="hljs-meta">@TableName("${tableName}")</span>
&lt;/#<span class="hljs-keyword">if</span>&gt;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">$</span>{className} <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

&lt;#list fields as field&gt;
    <span class="hljs-comment">/** ${field.comment!} */</span>
    &lt;#<span class="hljs-keyword">if</span> field.id&gt;
    <span class="hljs-meta">@TableId(type = IdType.${field.idType!"AUTO"})</span>
    &lt;/#<span class="hljs-keyword">if</span>&gt;
    &lt;#<span class="hljs-keyword">if</span> field.notNull&gt;
    <span class="hljs-meta">@NotNull(message = "${field.comment!}不能为空")</span>
    &lt;/#<span class="hljs-keyword">if</span>&gt;
    &lt;#<span class="hljs-keyword">if</span> field.length??&gt;
    <span class="hljs-meta">@Size(max = ${field.length}, message = "${field.comment!}长度不能超过${field.length}")</span>
    &lt;/#<span class="hljs-keyword">if</span>&gt;
    <span class="hljs-keyword">private</span> ${field.type} ${field.name};

&lt;/#list&gt;
&lt;#-- Getter和Setter方法由Lombok <span class="hljs-meta">@Data</span>注解自动生成 --&gt;
}
</code></pre>
<p><code>Service接口模板 templates/code/Service.java.ftl</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> ${packageName}.service;

<span class="hljs-keyword">import</span> ${packageName}.entity.${className};
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * ${className} 服务接口
 *
 * <span class="hljs-doctag">@author</span> ${author}
 * <span class="hljs-doctag">@since</span> ${date}
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">$</span>{className}Service {

    <span class="hljs-comment">/**
     * 分页查询${className}
     */</span>
    Page&lt;${className}&gt; select${className}Page(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> size, ${className} ${classNameInstance});

    <span class="hljs-comment">/**
     * 根据ID查询${className}
     */</span>
    ${className} select${className}ById(${primaryKey.type} ${primaryKey.name});

    <span class="hljs-comment">/**
     * 新增${className}
     */</span>
    <span class="hljs-type">int</span> insert${className}(${className} ${classNameInstance});

    <span class="hljs-comment">/**
     * 修改${className}
     */</span>
    <span class="hljs-type">int</span> update${className}(${className} ${classNameInstance});

    <span class="hljs-comment">/**
     * 批量删除${className}
     */</span>
    <span class="hljs-type">int</span> delete${className}ByIds(List&lt;${primaryKey.type}&gt; ids);

    <span class="hljs-comment">/**
     * 删除${className}
     */</span>
    <span class="hljs-type">int</span> delete${className}ById(${primaryKey.type} ${primaryKey.name});
}
</code></pre>
<p><code>Controller模板 templates/code/Controller.java.ftl</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> ${packageName}.controller;

<span class="hljs-keyword">import</span> ${packageName}.entity.${className};
<span class="hljs-keyword">import</span> ${packageName}.service.${className}Service;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> io.swagger.annotations.Api;
<span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;

<span class="hljs-comment">/**
 * ${className} 控制器
 *
 * <span class="hljs-doctag">@author</span> ${author}
 * <span class="hljs-doctag">@since</span> ${date}
 */</span>
<span class="hljs-meta">@Api(tags = "${className}管理")</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/${classNameInstance}")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">$</span>{className}Controller {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ${className}Service ${classNameInstance}Service;

    <span class="hljs-meta">@ApiOperation("分页查询${className}")</span>
    <span class="hljs-meta">@GetMapping("/page")</span>
    <span class="hljs-keyword">public</span> Page&lt;${className}&gt; get${className}Page(
            <span class="hljs-meta">@RequestParam(defaultValue = "1")</span> <span class="hljs-type">int</span> page,
            <span class="hljs-meta">@RequestParam(defaultValue = "10")</span> <span class="hljs-type">int</span> size,
            ${className} ${classNameInstance}) {
        <span class="hljs-keyword">return</span> ${classNameInstance}Service.select${className}Page(page, size, ${classNameInstance});
    }

    <span class="hljs-meta">@ApiOperation("根据ID查询${className}")</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ${className} get${className}ById(<span class="hljs-meta">@PathVariable</span> ${primaryKey.type} id) {
        <span class="hljs-keyword">return</span> ${classNameInstance}Service.select${className}ById(id);
    }

    <span class="hljs-meta">@ApiOperation("新增${className}")</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> create${className}(<span class="hljs-meta">@RequestBody</span> ${className} ${classNameInstance}) {
        <span class="hljs-keyword">return</span> ${classNameInstance}Service.insert${className}(${classNameInstance});
    }

    <span class="hljs-meta">@ApiOperation("修改${className}")</span>
    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> update${className}(<span class="hljs-meta">@PathVariable</span> ${primaryKey.type} id, <span class="hljs-meta">@RequestBody</span> ${className} ${classNameInstance}) {
        ${classNameInstance}.set${primaryKey.name?cap_first}(id);
        <span class="hljs-keyword">return</span> ${classNameInstance}Service.update${className}(${classNameInstance});
    }

    <span class="hljs-meta">@ApiOperation("删除${className}")</span>
    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> delete${className}(<span class="hljs-meta">@PathVariable</span> ${primaryKey.type} id) {
        <span class="hljs-keyword">return</span> ${classNameInstance}Service.delete${className}ById(id);
    }
}
</code></pre>
<p><strong>代码生成服务</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeGeneratorService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Configuration freemarkerConfig;

    <span class="hljs-meta">@Value("${code.output.path}")</span>
    <span class="hljs-keyword">private</span> String outputBasePath;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateCode</span><span class="hljs-params">(GenerateRequest request)</span> <span class="hljs-keyword">throws</span> Exception {
        Map&lt;String, Object&gt; dataModel = buildDataModel(request);

        <span class="hljs-comment">// 生成实体类</span>
        generateFile(<span class="hljs-string">"code/Entity.java.ftl"</span>,
                    getEntityPath(request.getPackageName(), request.getClassName()),
                    dataModel);

        <span class="hljs-comment">// 生成Service接口</span>
        generateFile(<span class="hljs-string">"code/Service.java.ftl"</span>,
                    getServicePath(request.getPackageName(), request.getClassName()),
                    dataModel);

        <span class="hljs-comment">// 生成Controller</span>
        generateFile(<span class="hljs-string">"code/Controller.java.ftl"</span>,
                    getControllerPath(request.getPackageName(), request.getClassName()),
                    dataModel);
    }

    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">buildDataModel</span><span class="hljs-params">(GenerateRequest request)</span> {
        Map&lt;String, Object&gt; dataModel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        dataModel.put(<span class="hljs-string">"packageName"</span>, request.getPackageName());
        dataModel.put(<span class="hljs-string">"className"</span>, request.getClassName());
        dataModel.put(<span class="hljs-string">"classNameInstance"</span>, StringUtils.uncapitalize(request.getClassName()));
        dataModel.put(<span class="hljs-string">"tableName"</span>, request.getTableName());
        dataModel.put(<span class="hljs-string">"author"</span>, request.getAuthor());
        dataModel.put(<span class="hljs-string">"date"</span>, LocalDate.now().toString());
        dataModel.put(<span class="hljs-string">"fields"</span>, request.getFields());
        dataModel.put(<span class="hljs-string">"primaryKey"</span>, findPrimaryKey(request.getFields()));
        dataModel.put(<span class="hljs-string">"imports"</span>, calculateImports(request.getFields()));
        <span class="hljs-keyword">return</span> dataModel;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">generateFile</span><span class="hljs-params">(String templateName, String outputPath, Map&lt;String, Object&gt; dataModel)</span>
            <span class="hljs-keyword">throws</span> IOException, TemplateException {
        <span class="hljs-type">Template</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> freemarkerConfig.getTemplate(templateName);

        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(outputBasePath, outputPath);
        Files.createDirectories(path.getParent());

        <span class="hljs-keyword">try</span>(<span class="hljs-type">StringWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringWriter</span>()) {
            template.process(dataModel, out);
            Files.write(path, out.toString().getBytes(StandardCharsets.UTF_8));
        }
    }

    <span class="hljs-comment">// 工具方法</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getEntityPath</span><span class="hljs-params">(String packageName, String className)</span> {
        <span class="hljs-keyword">return</span> packageName.replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">'/'</span>) + <span class="hljs-string">"/entity/"</span> + className + <span class="hljs-string">".java"</span>;
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getServicePath</span><span class="hljs-params">(String packageName, String className)</span> {
        <span class="hljs-keyword">return</span> packageName.replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">'/'</span>) + <span class="hljs-string">"/service/"</span> + className + <span class="hljs-string">"Service.java"</span>;
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getControllerPath</span><span class="hljs-params">(String packageName, String className)</span> {
        <span class="hljs-keyword">return</span> packageName.replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">'/'</span>) + <span class="hljs-string">"/controller/"</span> + className + <span class="hljs-string">"Controller.java"</span>;
    }
}
</code></pre>
<h2 data-id="heading-14">邮件模板处理</h2>
<h4 data-id="heading-15">1. HTML邮件模板</h4>
<p><code>模板文件 templates/email/welcome.html.ftl</code></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>欢迎加入${companyName}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: Arial, sans-serif; <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; }
        <span class="hljs-selector-class">.container</span> { <span class="hljs-attribute">max-width</span>: <span class="hljs-number">600px</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.header</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#007bff</span>; <span class="hljs-attribute">color</span>: white; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">text-align</span>: center; }
        <span class="hljs-selector-class">.content</span> { <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.footer</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">text-align</span>: center; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>; }
        <span class="hljs-selector-class">.button</span> {
            <span class="hljs-attribute">display</span>: inline-block;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">24px</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#28a745</span>;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">text-decoration</span>: none;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>欢迎加入${companyName}！<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>亲爱的${user.name}，<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>感谢您注册${companyName}！您的账户已经创建成功。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您的账户信息：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>用户名：${user.username}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>邮箱：${user.email}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                &lt;#if user.phone??&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>手机号：${user.phone}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                &lt;/#if&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>请点击下面的按钮激活您的账户：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center;"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"${activationUrl}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span>&gt;</span>激活账户<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            &lt;#if activationToken??&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>如果按钮无法点击，请复制以下链接到浏览器：<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"word-break: break-all; background-color: #f8f9fa; padding: 10px;"</span>&gt;</span>
                ${activationUrl}?token=${activationToken}
            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            &lt;/#if&gt;

            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>激活链接将在${expiryHours}小时后失效，请尽快完成激活。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"footer"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>此邮件由系统自动发送，请勿回复。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>© ${currentYear} ${companyName}. 保留所有权利。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            &lt;#if unsubscribeUrl??&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"${unsubscribeUrl}"</span>&gt;</span>取消订阅<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            &lt;/#if&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>邮件服务</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Configuration freemarkerConfig;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JavaMailSender mailSender;

    <span class="hljs-meta">@Value("${spring.mail.from}")</span>
    <span class="hljs-keyword">private</span> String fromEmail;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendWelcomeEmail</span><span class="hljs-params">(User user, String activationToken)</span> <span class="hljs-keyword">throws</span> Exception {
        Map&lt;String, Object&gt; dataModel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        dataModel.put(<span class="hljs-string">"user"</span>, user);
        dataModel.put(<span class="hljs-string">"companyName"</span>, <span class="hljs-string">"我的公司"</span>);
        dataModel.put(<span class="hljs-string">"activationUrl"</span>, <span class="hljs-string">"https://myapp.com/activate"</span>);
        dataModel.put(<span class="hljs-string">"activationToken"</span>, activationToken);
        dataModel.put(<span class="hljs-string">"expiryHours"</span>, <span class="hljs-number">24</span>);
        dataModel.put(<span class="hljs-string">"currentYear"</span>, Year.now().getValue());

        <span class="hljs-type">Template</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> freemarkerConfig.getTemplate(<span class="hljs-string">"email/welcome.html.ftl"</span>);

        <span class="hljs-keyword">try</span>(<span class="hljs-type">StringWriter</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringWriter</span>()) {
            template.process(dataModel, out);

            <span class="hljs-type">MimeMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> mailSender.createMimeMessage();
            <span class="hljs-type">MimeMessageHelper</span> <span class="hljs-variable">helper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MimeMessageHelper</span>(message, <span class="hljs-literal">true</span>, <span class="hljs-string">"UTF-8"</span>);

            helper.setFrom(fromEmail);
            helper.setTo(user.getEmail());
            helper.setSubject(<span class="hljs-string">"欢迎加入"</span> + dataModel.get(<span class="hljs-string">"companyName"</span>));
            helper.setText(out.toString(), <span class="hljs-literal">true</span>); <span class="hljs-comment">// true表示HTML格式</span>

            mailSender.send(message);
        }
    }
}
</code></pre>
<h2 data-id="heading-16">高级技巧与最佳实践</h2>
<h4 data-id="heading-17">1. 模板继承与片段复用</h4>
<p><code>基础配置模板 templates/config/base.conf.ftl</code></p>
<pre><code class="hljs language-conf" lang="conf"># 基础配置文件
# 生成时间: ${generationTime}
# 环境: ${environment}

&lt;#macro logConfig&gt;
# 日志配置
logging.level.root=${logLevel!"INFO"}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
&lt;/#macro&gt;

&lt;#macro databaseConfig&gt;
# 数据库配置
spring.datasource.url=${database.url}
spring.datasource.username=${database.username}
spring.datasource.password=${database.password}
spring.datasource.driver-class-name=${database.driver!"com.mysql.cj.jdbc.Driver"}
&lt;/#macro&gt;

&lt;#macro serverConfig&gt;
# 服务器配置
server.port=${server.port!8080}
server.servlet.context-path=${server.contextPath!"/"}
&lt;/#macro&gt;
</code></pre>
<p><code>具体配置模板 templates/config/application.yml.ftl</code></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">&lt;#include</span> <span class="hljs-string">"base.conf.ftl"</span><span class="hljs-string">&gt;</span>

<span class="hljs-comment"># Spring Boot Application Configuration</span>
<span class="hljs-string">&lt;@serverConfig/&gt;</span>
<span class="hljs-string">&lt;@databaseConfig/&gt;</span>
<span class="hljs-string">&lt;@logConfig/&gt;</span>

<span class="hljs-comment"># 应用特定配置</span>
<span class="hljs-attr">app:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">${appName}</span>
  <span class="hljs-attr">version:</span> <span class="hljs-string">${appVersion!"1.0.0"}</span>
  <span class="hljs-string">&lt;#if</span> <span class="hljs-string">customConfig??&gt;</span>
  <span class="hljs-string">&lt;#list</span> <span class="hljs-string">customConfig</span> <span class="hljs-string">as</span> <span class="hljs-string">key,</span> <span class="hljs-string">value&gt;</span>
  <span class="hljs-string">${key}:</span> <span class="hljs-string">${value}</span>
  <span class="hljs-string">&lt;/#list&gt;</span>
  <span class="hljs-string">&lt;/#if&gt;</span>

<span class="hljs-string">&lt;#if</span> <span class="hljs-string">profiles??&gt;</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">${profiles.active!"dev"}</span>
<span class="hljs-string">&lt;/#if&gt;</span>
</code></pre>
<h4 data-id="heading-18">2. 模板缓存与性能优化</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TemplateConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Configuration <span class="hljs-title function_">freemarkerConfig</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> TemplateModelException {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(Configuration.VERSION_2_3_31);
        config.setClassForTemplateLoading(<span class="hljs-built_in">this</span>.getClass(), <span class="hljs-string">"/templates"</span>);

        <span class="hljs-comment">// 编码设置</span>
        config.setDefaultEncoding(<span class="hljs-string">"UTF-8"</span>);

        <span class="hljs-comment">// 数字格式化</span>
        config.setNumberFormat(<span class="hljs-string">"0.######"</span>);

        <span class="hljs-comment">// 缓存设置</span>
        config.setTemplateUpdateDelayMilliseconds(<span class="hljs-number">30000</span>); <span class="hljs-comment">// 30秒检查一次模板更新</span>
        config.setCacheStorage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">freemarker</span>.cache.MruCacheStorage(<span class="hljs-number">100</span>, <span class="hljs-number">250</span>));

        <span class="hljs-comment">// 错误处理</span>
        config.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER);

        <span class="hljs-comment">// 自定义指令</span>
        config.setSharedVariable(<span class="hljs-string">"formatDate"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateFormatMethod</span>());
        config.setSharedVariable(<span class="hljs-string">"toJson"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToJsonMethod</span>());

        <span class="hljs-keyword">return</span> config;
    }

    <span class="hljs-comment">// 自定义日期格式化方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateFormatMethod</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TemplateMethodModelEx</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">exec</span><span class="hljs-params">(List arguments)</span> <span class="hljs-keyword">throws</span> TemplateModelException {
            <span class="hljs-keyword">if</span> (arguments.size() != <span class="hljs-number">2</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateModelException</span>(<span class="hljs-string">"需要两个参数：日期和格式"</span>);
            }

            <span class="hljs-type">Object</span> <span class="hljs-variable">dateObj</span> <span class="hljs-operator">=</span> arguments.get(<span class="hljs-number">0</span>);
            <span class="hljs-type">Object</span> <span class="hljs-variable">formatObj</span> <span class="hljs-operator">=</span> arguments.get(<span class="hljs-number">1</span>);

            <span class="hljs-keyword">if</span> (dateObj <span class="hljs-keyword">instanceof</span> Date &amp;&amp; formatObj <span class="hljs-keyword">instanceof</span> SimpleScalar) {
                <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> (Date) dateObj;
                <span class="hljs-type">String</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> ((SimpleScalar) formatObj).getAsString();
                <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(format);
                <span class="hljs-keyword">return</span> sdf.format(date);
            }

            <span class="hljs-keyword">return</span> dateObj.toString();
        }
    }

    <span class="hljs-comment">// JSON转换方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToJsonMethod</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TemplateMethodModelEx</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">exec</span><span class="hljs-params">(List arguments)</span> <span class="hljs-keyword">throws</span> TemplateModelException {
            <span class="hljs-keyword">if</span> (arguments.size() != <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateModelException</span>(<span class="hljs-string">"需要一个参数：要转换的对象"</span>);
            }

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> objectMapper.writeValueAsString(arguments.get(<span class="hljs-number">0</span>));
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateModelException</span>(<span class="hljs-string">"JSON转换失败: "</span> + e.getMessage());
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-19">3. 模板安全管理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TemplateSecurityManager</span> {

    <span class="hljs-keyword">public</span> Configuration <span class="hljs-title function_">createSecureConfig</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> TemplateModelException {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>(Configuration.VERSION_2_3_31);

        <span class="hljs-comment">// 限制模板中的Java对象访问</span>
        config.setNewBuiltinClassResolver(TemplateClassResolver.SAFER_RESOLVER);

        <span class="hljs-comment">// 禁用危险的方法调用</span>
        config.setSetting(<span class="hljs-string">"freemarker.template.utility.Execute"</span>, <span class="hljs-string">"disabled"</span>);
        config.setSetting(<span class="hljs-string">"freemarker.template.utility.ObjectConstructor"</span>, <span class="hljs-string">"disabled"</span>);

        <span class="hljs-comment">// 限制可访问的包</span>
        config.setSetting(<span class="hljs-string">"freemarker.ext.beans.BeansWrapper"</span>, <span class="hljs-string">"restricted"</span>);

        <span class="hljs-keyword">return</span> config;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">validateTemplate</span><span class="hljs-params">(String templateContent)</span> {
        <span class="hljs-comment">// 检查模板中是否包含危险代码</span>
        String[] dangerousPatterns = {
            <span class="hljs-string">"new\\s*java\\.io"</span>,
            <span class="hljs-string">"System\\.exit"</span>,
            <span class="hljs-string">"Runtime\\.getRuntime"</span>,
            <span class="hljs-string">"ProcessBuilder"</span>,
            <span class="hljs-string">"Class\\.forName"</span>,
            <span class="hljs-string">"Method\\.invoke"</span>
        };

        <span class="hljs-keyword">for</span> (String pattern : dangerousPatterns) {
            <span class="hljs-keyword">if</span> (Pattern.compile(pattern).matcher(templateContent).find()) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h2 data-id="heading-20">总结</h2>
<p>Spring Boot模板引擎为后端开发提供了强大的自动化生成能力，有效解决了重复性工作的痛点，通过掌握Spring Boot模板引擎，开发者能够构建高效的自动化工具链，将更多精力投入到业务逻辑的实现中，提升整体开发效率和代码质量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python开发者必知的5个高效技巧，让你的代码性能提升50%]]></title>    <link>https://juejin.cn/post/7576914798055571508</link>    <guid>https://juejin.cn/post/7576914798055571508</guid>    <pubDate>2025-11-27T00:16:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576914798055571508" data-draft-id="7576867727718957091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python开发者必知的5个高效技巧，让你的代码性能提升50%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-27T00:16:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python开发者必知的5个高效技巧，让你的代码性能提升50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:16:49.000Z" title="Thu Nov 27 2025 00:16:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Python开发者必知的5个高效技巧，让你的代码性能提升50%</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>Python因其简洁、易读的语法和丰富的生态系统而广受欢迎，但在性能方面却常常被人诟病。尽管Python的解释型特性和动态类型系统带来了开发效率的提升，但也可能导致运行时性能瓶颈。然而，通过合理运用一些高效技巧，开发者完全可以显著提升Python代码的执行效率——甚至达到50%以上的性能提升。</p>
<p>本文将深入探讨5个经过验证的高效技巧，涵盖从数据结构选择到并发编程的多个层面。这些技巧不仅基于官方文档和权威资料，还结合了实际项目中的优化经验。无论你是初学者还是资深开发者，这些方法都能帮助你写出更快、更高效的Python代码。</p>
<hr/>
<h3 data-id="heading-2">1. 选择正确的数据结构</h3>
<h4 data-id="heading-3">为什么重要？</h4>
<p>数据结构的选择直接影响算法的时空复杂度。Python内置了多种数据结构（如列表、字典、集合等），但它们的性能特征差异显著。错误的选择可能导致不必要的性能开销。</p>
<h4 data-id="heading-4">高效实践：</h4>
<ul>
<li>
<p><strong>列表 vs. 集合：</strong><br/>
如果需要频繁检查元素是否存在（<code>in</code>操作），集合（<code>set</code>）的O(1)时间复杂度远胜于列表（<code>list</code>）的O(n)。例如：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 低效写法</span>
items = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
<span class="hljs-keyword">if</span> <span class="hljs-number">3</span> <span class="hljs-keyword">in</span> items:  <span class="hljs-comment"># O(n)</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># 高效写法</span>
items = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>}
<span class="hljs-keyword">if</span> <span class="hljs-number">3</span> <span class="hljs-keyword">in</span> items:  <span class="hljs-comment"># O(1)</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
</li>
<li>
<p><strong>字典的键选择：</strong><br/>
使用简单、不可变类型（如字符串、元组）作为字典键，可以避免哈希计算的开销。自定义对象作为键时，确保正确实现<code>__hash__</code>和<code>__eq__</code>方法。</p>
</li>
</ul>
<h4 data-id="heading-5">Benchmark结果：</h4>
<p>在一个包含10万次成员检查的测试中，使用集合比列表快约200倍。</p>
<hr/>
<h3 data-id="heading-6">2.利用生成器与惰性求值</h3>
<h4 data-id="heading-7">为什么重要？</h4>
<p>Python中的生成器（Generator）通过惰性求值避免一次性加载所有数据到内存，尤其适合处理大规模数据集或流式数据。</p>
<h4 data-id="heading-8">高效实践：</h4>
<ul>
<li><strong>替代列表推导式：</strong><br/>
将列表推导式（<code>[...]</code>）改为生成器表达式（<code>(...)</code>），可以节省内存并提前开始处理数据。例如：</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#低效写法（立即加载所有数据）</span>
squares=[x*x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>)]

<span class="hljs-comment">#高效写法（惰性求值）</span>
squares=(x*x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>))
</code></pre>
<ul>
<li><strong>yield关键字：</strong><br/>
在需要逐步生成结果的函数中使用yield：</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_large_file</span>(<span class="hljs-params">file</span>):
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
chunk=file.read(<span class="hljs-number">4096</span>)
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> chunk:
<span class="hljs-keyword">break</span>
<span class="hljs-keyword">yield</span> chunk
</code></pre>
<h4 data-id="heading-9">性能对比：</h4>
<p>处理1GB文件时，生成器版本的内存占用仅为传统方法的1/1000。</p>
<hr/>
<p>###3.使用内置函数与库</p>
<h4 data-id="heading-10">为什么重要？</h4>
<p>Python的内置函数（如map()、filter()）和标准库（如itertools）通常由C实现比纯Python代码快一个数量级。</p>
<p>####高效实践：
-**map/filter代替循环：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#低效写法</span>
result=[]
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>):
<span class="hljs-keyword">if</span> x%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>:
result.append(x*<span class="hljs-number">2</span>)

<span class="hljs-comment">#高效写法</span>
result=<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x:x*<span class="hljs-number">2</span> <span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x:x%<span class="hljs-number">2</span>==<span class="hljs-number">0</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000</span>)))
</code></pre>
<p>-**collections模块：
defaultdict可避免重复的键存在检查Counter提供快速的计数功能：</p>
<p><code>python from collections import defaultdict counts=defaultdict(int) for word in words: counts[word]+=1 </code></p>
<p>####Benchmark显示：
使用collections.Counter比手动实现快3-5倍</p>
<hr/>
<p>###4.向量化运算与NumPy</p>
<p>####为什么重要？
数值计算是Python的传统弱项但通过NumPy的向量化运算可以实现C级别的性能.</p>
<p>####高效实践：
-**避免显式循环：</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-comment">#低效写法 a=[1  2  3] b=[4  5  6] result=[a[i]+b[i] for i in range(len(a))]</span>

<span class="hljs-comment">#高效写法 a=np.array([1  2  3]) b=np.array([4  5  6]) result=a+b ```</span>

-**利用广播机制：
NumPy广播可以自动处理不同形状数组间的运算:

```python matrix=np.random.rand(<span class="hljs-number">10001000</span>) result=matrix*[<span class="hljs-number">123</span>]<span class="hljs-comment">#自动广播 ```</span>

<span class="hljs-comment">####性能对比:</span>
在1000x1000矩阵乘法中NumPy比纯Python快<span class="hljs-number">200</span>倍以上.

---

<span class="hljs-comment">###5.并发与异步IO  </span>

<span class="hljs-comment">####为什么重要？</span>
现代CPU多核普及而Python有GIL限制合理使用多进程/异步IO能充分利用硬件资源.

<span class="hljs-comment">####高效实践：</span>
-**CPU密集型任务用multiprocessing：

```python <span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool <span class="hljs-keyword">def</span> <span class="hljs-title function_">compute</span>(<span class="hljs-params">x</span>): <span class="hljs-keyword">return</span> x*x

<span class="hljs-keyword">with</span> Pool() <span class="hljs-keyword">as</span> p: results=p.<span class="hljs-built_in">map</span>(compute <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>)) ```

-**IO密集型用asyncio：

```python <span class="hljs-keyword">import</span> asyncio <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url</span>): <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session: <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(url) <span class="hljs-keyword">as</span> response: <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.text()

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>(): urls=[<span class="hljs-string">'url1'</span><span class="hljs-string">'url2'</span><span class="hljs-string">'url3'</span>] tasks=[fetch(url) <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls] <span class="hljs-keyword">await</span> asyncio.gather(*tasks) ```

<span class="hljs-comment">####实测效果：</span>
网络请求场景中asyncio比同步版本快<span class="hljs-number">8</span>-<span class="hljs-number">10</span>倍.

---

<span class="hljs-comment">###总结 </span>

本文介绍的五种技巧覆盖了Python优化的关键领域：

<span class="hljs-number">1.</span>数据结构的选择直接影响基础操作性能；
<span class="hljs-number">2.</span>生成器完美解决内存与延迟问题；
<span class="hljs-number">3.</span>内置函数是隐藏的性能宝藏；
<span class="hljs-number">4.</span>NumPy让数值计算脱胎换骨；
<span class="hljs-number">5.</span>并发模型针对不同场景各展所长；

将这些方法有机结合通常可获得<span class="hljs-number">50</span>%以上的整体性能提升某些场景甚至能达到数量级差异真正的优化还需要结合profiling工具针对性改进希望这些经验能助你写出更高效的Python代码
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ServBay 详解：一站式本地 Web 开发环境]]></title>    <link>https://juejin.cn/post/7577171133431431209</link>    <guid>https://juejin.cn/post/7577171133431431209</guid>    <pubDate>2025-11-27T00:26:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577171133431431209" data-draft-id="7576888607480217619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ServBay 详解：一站式本地 Web 开发环境"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T00:26:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ServBay 详解：一站式本地 Web 开发环境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:26:15.000Z" title="Thu Nov 27 2025 00:26:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🔍 核心概览</h2>
<p>ServBay 是一款专为现代 Web 开发设计的<strong>一体化本地开发环境管理工具</strong>，支持 macOS 和 Windows 平台。它通过图形化界面集成多种开发语言、数据库和服务，让开发者能在几分钟内完成专业开发环境的配置。</p>
<p>下面的表格概括了 ServBay 的核心特性，帮助你快速了解其全貌。</p>



































<table><thead><tr><th>特性类别</th><th>核心功能描述</th><th>支持示例</th></tr></thead><tbody><tr><td><strong>🚀 开发语言支持</strong>​</td><td>支持多版本共存与一键切换，可为不同项目锁定特定版本。</td><td>PHP (5.6-8.5)、Node.js (12-24)、Python (2.7, 3.5-3.14)、Go、Java、Ruby、Rust、.NET。</td></tr><tr><td><strong>🗄️ 数据库与存储</strong>​</td><td>集成多种 SQL/NoSQL 数据库，支持一键安装与图形化管理。</td><td>MySQL、PostgreSQL、MongoDB、Redis、MariaDB。</td></tr><tr><td><strong>🌐 Web 服务器与网络</strong>​</td><td>内置多种 Web 服务器，并提供域名、DNS 和自动 SSL 证书管理。</td><td>Caddy、Nginx、Apache；自定义域名（如 <code>.test</code>）、自动 HTTPS。</td></tr><tr><td><strong>🔩 高级开发工具</strong>​</td><td>集成邮件服务器、反向代理、AI 工具和对象存储等现代化开发所需服务。</td><td>邮件服务器 (Mailpit)、反向代理 (ngrok)、Ollama (AI)、MinIO (对象存储)。</td></tr><tr><td><strong>💾 环境与数据管理</strong>​</td><td>提供项目级环境隔离、强大的备份恢复功能，并支持命令行操作。</td><td>项目级 PHP/Node.js 版本配置、一键备份/恢复数据库和配置、终端直接调用命令。</td></tr></tbody></table>
<h2 data-id="heading-1">💡 突出优势</h2>
<p>ServBay 的设计理念是让开发者从繁琐的环境配置中解放出来，专注于编码本身。其核心优势体现在：</p>
<ul>
<li><strong>极速启动与高效性能</strong>：与传统方案相比，ServBay 能在数秒内启动完整环境（如 LAMP），无需等待容器构建或虚拟机启动。由于采用原生方式运行服务，而非虚拟化技术，其在文件读写速度和系统资源（CPU/内存）占用上具有明显优势。</li>
<li><strong>图形化界面带来的易用性</strong>：通过直观的图形界面，ServBay 极大降低了环境管理的复杂度。服务的启停、版本的切换、网站的添加和域名配置等操作都可以通过点击完成，对新手非常友好，也便于团队统一环境。</li>
<li><strong>出色的环境隔离与灵活性</strong>：ServBay 实现了项目级别的环境隔离。你可以为每个项目指定独立的开发语言和数据库版本，有效避免了项目间的环境冲突，使得在不同技术栈的项目间切换变得轻松自如。</li>
<li><strong>开箱即用的功能集成</strong>：它集成了开发中常用但配置繁琐的服务。例如，内置的 Mailpit 可以捕获并预览应用发送的所有测试邮件，无需配置外部 SMTP 或担心邮件外发；内置的 PKI 系统能为零配置生成可信的本地 SSL 证书，轻松实现 HTTPS 开发。</li>
</ul>
<h2 data-id="heading-2">⚖️ 潜在考量</h2>
<p>没有任何工具是完美的，选择 ServBay 时也需要考虑以下几点：</p>
<ul>
<li><strong>平台锁定风险</strong>：ServBay 提供了一个高度定制和集成的环境。虽然方便，但也意味着你的本地开发流程与 ServBay 深度绑定。如果需要迁移到其他环境，可能需要重新配置。</li>
<li><strong>自定义灵活性限制</strong>：对于有极特殊定制化需求的高级用户，ServBay 的图形化界面可能无法覆盖所有底层配置细节。尽管新版本已支持直接编辑单个站点的 Web 服务器配置文件，但在极限控制上可能仍不如完全手动的环境。</li>
<li><strong>资源占用</strong>：虽然比 Docker 等方案更轻量，但作为一个集成大量服务的应用，ServBay 本身仍会占用一定的磁盘空间（建议 10GB 以上可用空间）和内存。</li>
</ul>
<h2 data-id="heading-3">🆚 与其他工具的比较</h2>
<p>为了更好地定位 ServBay，可以将其与常用工具进行简单对比：</p>
<ul>
<li><strong>vs. MAMP/XAMPP</strong>：ServBay 在<strong>功能全面性、多版本管理能力和现代化工具（如 AI、反向代理）集成度上远超</strong>这些传统工具。它提供了更直观的界面和更强大的项目级管理功能。</li>
<li><strong>vs. Docker</strong>：Docker 的核心优势在于<strong>环境一致性</strong>和<strong>容器化部署</strong>，适合微服务架构和需要精确复制生产环境的场景。ServBay 的核心优势在于<strong>本地开发体验和性能</strong>，它更轻快、配置更简单，特别适合前端、全栈 Web 项目和追求开发效率的个人或团队。两者定位不同，并非完全替代关系。</li>
<li><strong>vs. 手动配置（Homebrew等）</strong> ：手动配置最灵活，但耗时且易出错。ServBay 通过自动化封装，在<strong>保证一定灵活性的同时，提供了无与伦比的便捷性和开箱即用的体验</strong>。</li>
</ul>
<h2 data-id="heading-4">🛠️ 快速上手指南</h2>
<ol>
<li>
<p><strong>下载与安装</strong>：访问 ServBay 官方网站下载对应操作系统（macOS 或 Windows）的安装包。安装过程与普通软件无异，通常只需将应用拖入“应用程序”文件夹即可。</p>
</li>
<li>
<p><strong>初始化向导</strong>：首次启动时，ServBay 会引导你进行初始设置，包括选择常用的软件包（如 PHP、Node.js、数据库等），帮助你快速搭建基础环境。</p>
</li>
<li>
<p><strong>创建你的第一个网站</strong>：</p>
<ul>
<li>在“网站”管理界面，点击“+”号添加新网站。</li>
<li>输入网站名称、自定义域名（如 <code>myproject.serv</code>）。</li>
<li>选择网站类型（静态、PHP、反向代理等）并配置相应路径或端口。</li>
<li>保存后，ServBay 会自动处理域名解析和 SSL 证书，你即可通过 <code>https://myproject.serv</code>访问你的站点。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-5">💎 总结</h2>
<p>ServBay 是一款强大而实用的现代化本地开发环境工具，尤其适合<strong>Web 全栈开发者、小型团队、学生以及任何希望从环境配置的繁琐工作中解脱出来、更专注于编码创造的用户</strong>。它通过“一体化”和“图形化”的设计哲学，显著降低了本地开发的入门和协作成本，能够有效提升开发效率和体验。如果你追求稳定、高效且功能全面的本地服务器套件，ServBay 绝对值得尝试。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ServBay与Docker在具体使用场景和性能表现上有哪些详细对比？]]></title>    <link>https://juejin.cn/post/7576923573777039402</link>    <guid>https://juejin.cn/post/7576923573777039402</guid>    <pubDate>2025-11-27T00:28:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576923573777039402" data-draft-id="7576893180081012778" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ServBay与Docker在具体使用场景和性能表现上有哪些详细对比？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T00:28:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ServBay与Docker在具体使用场景和性能表现上有哪些详细对比？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:28:03.000Z" title="Thu Nov 27 2025 00:28:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ServBay 和 Docker 是两款设计哲学迥异的工具，它们分别优化了不同的工作流。为了帮你快速把握全貌，我先用一个表格来概括它们的核心区别，然后再深入聊聊具体的选择建议。</p>



































<table><thead><tr><th>特性维度</th><th>🚀 ServBay</th><th>🐳 Docker</th></tr></thead><tbody><tr><td><strong>核心定位</strong>​</td><td>专为本地Web开发优化的<strong>一体化集成环境</strong>​</td><td>应用打包、分发和部署的<strong>容器化平台</strong>​</td></tr><tr><td><strong>性能表现</strong>​</td><td><strong>启动速度极快</strong>（秒级），文件读写为<strong>原生速度</strong>，资源占用低</td><td>启动速度较慢（依赖镜像构建和拉取），在macOS/Windows上文件I/O有性能损耗，资源占用较高</td></tr><tr><td><strong>易用性</strong>​</td><td><strong>极高的开箱即用性</strong>，图形化界面，自动化配置SSL、域名等</td><td><strong>学习曲线陡峭</strong>，需编写Dockerfile和docker-compose.yml，手动管理网络、存储卷</td></tr><tr><td><strong>环境一致性</strong>​</td><td>侧重<strong>本地开发效率</strong>，环境与生产服务器可能存差异</td><td>提供<strong>高度一致的环境</strong>，从开发到生产可实现“一次构建，到处运行”</td></tr><tr><td><strong>适用场景</strong>​</td><td>本地全栈Web开发、API开发、个人项目、需要快速启动和迭代的场景</td><td>微服务架构、CI/CD流水线、需要精确复制生产Linux环境、团队协作确保环境一致的场景</td></tr></tbody></table>
<h3 data-id="heading-0">💡 如何根据场景做选择</h3>
<p>了解基本区别后，你可以通过下面几个问题来判断哪款工具更适合你当前的需求。</p>
<ul>
<li>
<p><strong>你的核心目标是什么？是追求“开发效率”还是“部署一致性”？</strong></p>
<ul>
<li>如果你的首要任务是<strong>快速搭建本地环境、高效编码和测试</strong>，希望一键获得HTTPS域名、测试邮件捕获等开箱即用的功能，那么 <strong>ServBay 是更优的选择</strong>。它能让你几乎忘记环境的存在，专注业务逻辑。</li>
<li>如果你的项目架构复杂（如微服务），或者团队流程要求<strong>开发、测试、生产环境必须高度统一</strong>，那么 <strong>Docker 的优势无可替代</strong>。</li>
</ul>
</li>
<li>
<p><strong>你的技术栈和团队情况如何？</strong></p>
<ul>
<li>对于<strong>初学者、独立开发者</strong>或主要进行<strong>传统Web项目开发</strong>的团队，ServBay 能显著降低环境配置的心智负担和时间成本。</li>
<li>如果团队技术栈偏向<strong>云原生和DevOps</strong>，或者招聘要求中明确需要容器化经验，那么学习和使用 Docker 是对个人和团队都更有价值的投资。</li>
</ul>
</li>
<li>
<p><strong>是否需要考虑混合使用？</strong></p>
<p>值得注意的是，这两种工具并非完全互斥。一种常见的模式是“<strong>本地开发用 ServBay，上线部署用 Docker</strong>”。你可以在本地使用 ServBay 获得极致开发体验，待应用完成后，再使用 Docker 构建镜像用于部署。这种组合能在一定程度上兼顾效率与一致性</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[流碧卡片 6 小时闪电开发 AI gemini-3-pro-preview ！ 秒出小红书爆款图，免下载直接用]]></title>    <link>https://juejin.cn/post/7576859594360225792</link>    <guid>https://juejin.cn/post/7576859594360225792</guid>    <pubDate>2025-11-27T00:29:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576859594360225792" data-draft-id="7576859594360209408" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="流碧卡片 6 小时闪电开发 AI gemini-3-pro-preview ！ 秒出小红书爆款图，免下载直接用"/> <meta itemprop="keywords" content="前端,后端,AI编程"/> <meta itemprop="datePublished" content="2025-11-27T00:29:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="万少"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708283191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            流碧卡片 6 小时闪电开发 AI gemini-3-pro-preview ！ 秒出小红书爆款图，免下载直接用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708283191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    万少
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:29:29.000Z" title="Thu Nov 27 2025 00:29:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">流碧卡片 6 小时闪电开发 AI gemini-3-pro-preview ！ 秒出小红书爆款图，免下载直接用</h2>
<blockquote>
<p><strong>体验地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcard.zbztb.cn" target="_blank" title="https://card.zbztb.cn" ref="nofollow noopener noreferrer">card.zbztb.cn</a><br/>
<strong>开发驱动</strong>: Trae IDE + Gemini-3-pro-Preview</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">简介 | Introduction</h3>
<p><strong>流碧卡片 (Liubi Card)</strong>  是一款专注于<strong>优雅、高效、隐私</strong>的社交媒体卡片生成工具。它可以将您的文字、代码或灵感瞬间转化为设计感十足的图片，完美适配微信、小红书、Instagram 等社交平台。</p>
<p>本项目完全采用<strong>纯前端技术栈</strong>开发，由新一代 AI 编程 IDE <strong>Trae</strong> 搭载 <strong>Gemini-3-pro-Preview</strong> 模型辅助构建，展现了 AI 赋能开发的无限可能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6d5b88fd8e04a8b9591f4c84d435c6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808169&amp;x-signature=OSPgfzpEQhPj8eIqXd8Y9vzp0vA%3D" alt="image-20251127081035219" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">核心亮点 | Key Features</h3>
<h4 data-id="heading-3">1. 海量风格模板 (40+ Built-in Templates)</h4>
<p>从<strong>赛博朋克</strong>的霓虹幻彩，到<strong>莫兰迪</strong>的温柔静谧；从<strong>水彩</strong>的艺术质感，到<strong>极简</strong>的商务风格。 我们内置了超过 <strong>40 种</strong>精心设计的视觉模板，一键切换，即刻出片。</p>
<ul>
<li><strong>最新新增</strong>: 日落、森林、午夜、糖果、旧纸张、蓝图、终端等 20 款全新风格。</li>
</ul>
<h4 data-id="heading-4">2. 每日灵感 (Daily Inspiration)</h4>
<p>每天首次访问，都会收到一份专属的惊喜。</p>
<ul>
<li><strong>智能随机</strong>: 从精选的 100+ 条中英文金句中随机抽取。</li>
<li><strong>风格碰撞</strong>: 自动匹配一种独特的视觉风格，让每天的打卡都与众不同。</li>
</ul>
<h4 data-id="heading-5">3. AI 智能文案优化 (AI-Powered)</h4>
<p>接入 <strong>DeepSeek</strong> 大模型能力，为您的一键润色文案。</p>
<ul>
<li>让平淡的文字变得更有社交传播力。</li>
<li>自动提取金句，优化排版。</li>
</ul>
<h4 data-id="heading-6">4.  极致隐私安全 (Privacy First)</h4>
<ul>
<li><strong>零后端依赖</strong>: 所有图片生成、文字处理均在您的<strong>浏览器本地</strong>完成。</li>
<li><strong>数据不上传</strong>: 您的创作内容绝不会上传至任何服务器，安全无忧。</li>
</ul>
<h4 data-id="heading-7">5.  完美适配移动端 (Responsive Design)</h4>
<ul>
<li>专为手机和平板优化的交互体验。</li>
<li>支持 <strong>3:4 (小红书) <strong>、</strong> 9:16 (抖音) <strong>、</strong> 1:1 (Instagram)</strong>  等多种主流比例。</li>
</ul>
<hr/>
<h3 data-id="heading-8">技术栈 | Tech Stack</h3>
<p>本项目是现代前端工程化的典范，使用了以下核心技术：</p>
<ul>
<li><strong>核心框架</strong>: React 19 + TypeScript</li>
<li><strong>构建工具</strong>: Vite 6</li>
<li><strong>UI 系统</strong>: Ant Design 6 + Tailwind CSS</li>
<li><strong>国际化</strong>: i18next (支持中英双语)</li>
<li><strong>绘图引擎</strong>: html2canvas</li>
<li><strong>AI 辅助</strong>: Trae IDE + Gemini-3-pro-Preview</li>
</ul>
<hr/>
<h3 data-id="heading-9">开发背后的故事 | Development Story</h3>
<p>这个项目的快速迭代得益于 <strong>Trae IDE</strong> 与 <strong>Gemini-3-pro-Preview</strong> 的强大组合。</p>
<h4 data-id="heading-10">高效的各种功能实现</h4>
<p>在开发过程中，我只需通过自然语言描述需求：</p>
<blockquote>
<p>"帮我增加一个每日随机生成卡片功能，需要判断是否今日首次打开，并随机选择内容和风格..."</p>
</blockquote>
<p>Gemini-3-pro-Preview 能够瞬间理解上下文：</p>
<ol>
<li><strong>自动规划</strong>: 识别需要修改 <code>HomePage.tsx</code> 添加逻辑，创建 <code>quotes.ts</code> 存储语录。</li>
<li><strong>代码生成</strong>: 自动编写了完整的 <code>checkDailyCard</code> 逻辑和 <code>generateDailyCard</code> 函数。</li>
<li><strong>Bug 修复</strong>: 当遇到 React StrictMode 导致的弹窗重复问题时，AI 迅速给出了从“命令式”到“声明式”状态管理的重构方案。</li>
</ol>
<h4 data-id="heading-11">创意的批量生产</h4>
<p>当需要新增 <strong>20 种模板</strong> 时，AI 不仅生成了代码，还为每个模板设计了独特的配色方案（渐变、阴影、边框），并同步完成了中英文的本地化配置，将原本需要数小时的重复工作压缩到了几分钟。</p>
<hr/>
<h3 data-id="heading-12">🔗 立即体验</h3>
<p><strong>点击访问</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcard.zbztb.cn" target="_blank" title="https://card.zbztb.cn" ref="nofollow noopener noreferrer">card.zbztb.cn</a></p>
<p>无论您是想记录生活感悟，还是分享技术代码，流碧卡片都能让您的文字更加闪耀。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习 LiteLLM 的缓存系统]]></title>    <link>https://juejin.cn/post/7576859594360193024</link>    <guid>https://juejin.cn/post/7576859594360193024</guid>    <pubDate>2025-11-27T00:26:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576859594360193024" data-draft-id="7576867727718973475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习 LiteLLM 的缓存系统"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-27T00:26:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日习一技"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习 LiteLLM 的缓存系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日习一技
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:26:04.000Z" title="Thu Nov 27 2025 00:26:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着我们的 LLM 网关承载的流量越来越大、接入的模型越来越多，除了稳定性和可靠性，<strong>成本和性能</strong> 也成为了关键的考量因素。实际上，我们的应用每天都在处理很多相似的查询，比如客服系统中的常见问题、代码生成中的重复模式、文档摘要中的相似内容。如果每次都调用真实的 LLM API，不仅延迟高、成本昂贵，还可能触发供应商的速率限制。而且，对于相同或相似的查询，LLM 的回答往往是一致的或高度相似的，这就为缓存的应用提供了天然的基础。</p>
<p>LiteLLM 提供了一套完整的缓存解决方案，它不仅能够缓存完全相同的请求（精确缓存），还能够基于语义相似性缓存相似的请求（语义缓存），从而显著降低成本，并大幅提升性能，同时减轻对上游 API 的压力，提高了系统稳定性。</p>
<p>今天这篇文章，我们就来深入了解一下 LiteLLM 的缓存系统。</p>
<h2 data-id="heading-0">缓存类型一览</h2>
<p>LiteLLM 支持 8 种不同的缓存后端，每种都针对特定的使用场景：</p>
<p><strong>传统缓存</strong>：</p>
<ul>
<li><strong>内存缓存（In-Memory）</strong>：最快的访问速度，适合单机部署和开发测试</li>
<li><strong>磁盘缓存（Disk）</strong>：持久化存储，适合单机长期缓存</li>
<li><strong>Redis 缓存</strong>：分布式缓存，适合多实例部署和生产环境</li>
</ul>
<p><strong>云存储缓存</strong>：</p>
<ul>
<li><strong>S3 缓存</strong>：利用 AWS S3 进行大规模、低成本的缓存存储</li>
<li><strong>GCS 缓存</strong>：基于 Google Cloud Storage 的缓存解决方案</li>
<li><strong>Azure Blob 缓存</strong>：微软 Azure 的对象存储缓存</li>
</ul>
<p><strong>智能缓存</strong>：</p>
<ul>
<li><strong>Redis 语义缓存</strong>：基于向量相似度的语义匹配缓存</li>
<li><strong>Qdrant 语义缓存</strong>：专业向量数据库的语义缓存解决方案</li>
</ul>
<h2 data-id="heading-1">基本使用</h2>
<p>首先我们来体验下最简单的内存缓存，在 <code>config.yaml</code> 文件中添加如下配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">cache:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">cache_params:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">local</span>
</code></pre>
<p>然后重启 LiteLLM Proxy 服务。发送第一次请求：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "给我讲个笑话"}]
  }'</span>
</code></pre>
<p>第一次请求会调用真实的 API，耗时可能在 1-3 秒。再发送完全相同的请求（加了 <code>-v</code> 选项用于打印响应头）：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -v -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "给我讲个笑话"}]
  }'</span>
</code></pre>
<p>第二次请求从缓存返回，耗时通常在 50-200 毫秒，响应头中会包含缓存相关信息：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">x-litellm-cache-key: 6b86d8cb3ab300d7cbe071f93176e28cc25d9da7f2db95dd8ad078176faddc94</span>
</code></pre>
<blockquote>
<p>这个 Key 是根据请求内容生成的，相同的请求参数生成的 Key 也是相同的。</p>
</blockquote>
<h2 data-id="heading-2">Redis 缓存</h2>
<p>内存缓存适合单机部署和开发测试，生产环境一般使用 Redis 作为缓存后端。可以用 Docker 在本地快速启一个 Redis 示例：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker run -d \
  --name redis-stack \
  -p 6379:6379 \
  -p 8001:8001 \
  redis/redis-stack:latest
</code></pre>
<p>注意我这里使用的是 Redis Stack 镜像，它是一个包含多个模块的集成软件套件，在 Redis 的基础上，扩展了 <strong>搜索（RedisSearch）</strong>、<strong>JSON（RedisJSON）</strong>、<strong>图数据库（RedisGraph）</strong>、<strong>时间序列（RedisTimeSeries）</strong> 和 <strong>布隆过滤器（RedisBloom）</strong> 等功能，提供了更丰富的数据处理能力，适用于构建复杂应用。相对于 Redis Server 只是核心的内存数据结构存储，更侧重于缓存和消息队列等场景。</p>
<p>最简单的 Redis 缓存配置如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">cache:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">cache_params:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>          <span class="hljs-comment"># Redis 服务器地址</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>               <span class="hljs-comment"># Redis 端口</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">your_password</span>  <span class="hljs-comment"># Redis 密码（可选）</span>
    <span class="hljs-attr">ttl:</span> <span class="hljs-number">600</span>                 <span class="hljs-comment"># 默认缓存时间（秒）</span>
</code></pre>
<blockquote>
<p>对于大规模部署，LiteLLM 支持配置 Redis 集群或哨兵。</p>
</blockquote>
<p>验证方法和内存缓存一样，第二次请求从缓存返回，并且在 Redis 中应该能找到 <code>x-litellm-cache-key</code> 对应的缓存键：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03d6c95633e64c9fa43ff307fee919a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764807964&amp;x-signature=jV67cpc4DlI4lWoemLFlwmJeTTQ%3D" alt="redis-key.png" loading="lazy"/></p>
<h2 data-id="heading-3">Redis 语义缓存</h2>
<p>Redis 不仅可以用来做普通缓存，还可以用来做向量数据库。我们可以将文本、图像等非结构化数据转换为向量，存储到 Redis 中，并利用 Redis 的内存优势实现毫秒级的向量相似性搜索。</p>
<p>LiteLLM 基于 Redis 向量数据库实现了语义缓存功能，<strong>语义缓存</strong> 不同于传统的精确匹配缓存，它能够理解查询的语义含义，并返回语义相似查询的缓存结果。即使这些查询的字面表达完全不同，语义缓存也能识别它们的相似性并返回相同的结果，大大提高了缓存命中率。</p>
<p>Redis 语义缓存基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-vl-python" target="_blank" title="https://github.com/redis/redis-vl-python" ref="nofollow noopener noreferrer">Redis Vector Library (RedisVL)</a> 实现，首先需要安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">$ pip install redisvl==0.4.1
</code></pre>
<p>然后在 LiteLLM 的配置文件中开启 Redis 语义缓存：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">cache:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">cache_params:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">redis-semantic</span>              <span class="hljs-comment"># 语义缓存类型</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">your_password</span>
    <span class="hljs-attr">ttl:</span> <span class="hljs-number">600</span>
    <span class="hljs-attr">similarity_threshold:</span> <span class="hljs-number">0.8</span>                                     <span class="hljs-comment"># 相似度阈值（0-1，1为完全匹配）</span>
    <span class="hljs-attr">redis_semantic_cache_embedding_model:</span> <span class="hljs-string">text-embedding-3-large</span>  <span class="hljs-comment"># 嵌入模型名称</span>
</code></pre>
<p>其中 <code>similarity_threshold</code> 为相似度阈值，范围 <code>[0-1]</code>，<code>redis_semantic_cache_embedding_model</code> 为嵌入模型名称，必须是在 <code>model_list</code> 中定义。</p>
<blockquote>
<p>注意，如果你的 Redis 没有密码，启动可能会报错 <code>Missing required Redis configuration: REDIS_PASSWORD</code>。设置一下环境变量 <code>export REDIS_PASSWORD=</code> 即可。</p>
</blockquote>
<p>可以使用两个相似的请求来验证，第一次请求：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "什么是人工智能？"}]
  }'</span>
</code></pre>
<p>第二次请求：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -v -X POST <span class="hljs-string">'http://127.0.0.1:4000/chat/completions'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "AI 是什么？"}]
  }'</span>
</code></pre>
<p>第二次请求的响应头中不仅包含了缓存 Key，还包含了相似度信息：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">x-litellm-cache-key: 9cdf6246deaee1f8d96aa8b093029bc129f7eca32f2f8f4a9fd0352138e6ea3e</span>
<span class="hljs-section">x-litellm-semantic-similarity: 0.162912428379</span>
</code></pre>
<p>我们打开 Redis 管理页面，可以发现多了一个 <code>litellm_semantic_cache_index</code> 开头的键：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cebfd18f60c24385987a334469927b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764807964&amp;x-signature=4trFxZz1cBm0FgXZmnLWLHxxUMg%3D" alt="redis-sematic-key.png" loading="lazy"/></p>
<p>它的内容包含了请求的 Prompt 和对应的响应：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c35b89dd8fd4124b3e413a15801b4a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764807964&amp;x-signature=xwH6N6yVVCsB6JB%2FkjyoqGUqXto%3D" alt="redis-sematic-value.png" loading="lazy"/></p>
<h3 data-id="heading-4">RedisVL 库介绍</h3>
<p><strong>RedisVL (Redis Vector Library)</strong> 是 Redis 官方提供的 Python 客户端库，专为 AI 应用设计，提供了高级的向量搜索抽象，主要特性包括：</p>
<ul>
<li><strong>简化的 API</strong>：高级抽象，简化向量搜索操作</li>
<li><strong>强大的查询能力</strong>：支持混合查询、过滤条件、聚合等</li>
<li><strong>语义缓存</strong>：专门为 LLM 缓存优化的 LLMCache 组件，LiteLLM 的 Redis 语义缓存就是基于它实现的</li>
</ul>
<p>这一节我们通过一个简单示例学习它的基本使用。</p>
<p>首先通过 Schema 创建索引：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> redisvl.index <span class="hljs-keyword">import</span> SearchIndex
<span class="hljs-keyword">from</span> redis <span class="hljs-keyword">import</span> Redis

<span class="hljs-comment"># 创建连接</span>
client = Redis.from_url(<span class="hljs-string">"redis://localhost:6379"</span>)

<span class="hljs-comment"># 使用字典定义 Schema</span>
schema = {
  <span class="hljs-string">"index"</span>: {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"product_index"</span>,
    <span class="hljs-string">"prefix"</span>: <span class="hljs-string">"product:"</span>,
  },
  <span class="hljs-string">"fields"</span>: [
    {<span class="hljs-string">"name"</span>: <span class="hljs-string">"title"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>},
    {<span class="hljs-string">"name"</span>: <span class="hljs-string">"brand"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"tag"</span>},
    {<span class="hljs-string">"name"</span>: <span class="hljs-string">"price"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"numeric"</span>},
    {<span class="hljs-string">"name"</span>: <span class="hljs-string">"category"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"tag"</span>},
    {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"description_vector"</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"vector"</span>,
      <span class="hljs-string">"attrs"</span>: {
        <span class="hljs-string">"dims"</span>: <span class="hljs-number">3072</span>,  <span class="hljs-comment"># 向量维度</span>
        <span class="hljs-string">"distance_metric"</span>: <span class="hljs-string">"cosine"</span>,  <span class="hljs-comment"># 距离度量</span>
        <span class="hljs-string">"algorithm"</span>: <span class="hljs-string">"flat"</span>,  <span class="hljs-comment"># 向量索引算法</span>
        <span class="hljs-string">"datatype"</span>: <span class="hljs-string">"float32"</span>
      }
    }
  ]
}

<span class="hljs-comment"># 创建索引</span>
index = SearchIndex.from_dict(schema, redis_client=client)
index.create(overwrite=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"索引创建成功！"</span>)
</code></pre>
<p>这是一个产品表，包含产品的名称、品牌、分类、价格、描述等信息，我们为描述加一个向量字段，用于语义搜索。</p>
<blockquote>
<p>其中向量维度根据你使用的 Embedding 模型来定义，我这里使用的是 OpenAI 的 <code>text-embedding-3-large</code> 模型，维度是 3072 维。</p>
</blockquote>
<p>接着定义一批示例数据，加载到 Redis 中：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> litellm <span class="hljs-keyword">import</span> embedding

<span class="hljs-comment"># 定义产品数据</span>
products = [
  {
    <span class="hljs-string">"id"</span>: <span class="hljs-string">"p001"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"iPhone 15 Pro Max"</span>,
    <span class="hljs-string">"brand"</span>: <span class="hljs-string">"Apple"</span>,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"smartphone"</span>,
    <span class="hljs-string">"price"</span>: <span class="hljs-number">1199</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"最新的 iPhone，配备 A17 Pro 芯片，48MP 主摄像头，钛金属机身"</span>
  },
  {
    <span class="hljs-string">"id"</span>: <span class="hljs-string">"p002"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"MacBook Pro 14英寸"</span>,
    <span class="hljs-string">"brand"</span>: <span class="hljs-string">"Apple"</span>,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"laptop"</span>,
    <span class="hljs-string">"price"</span>: <span class="hljs-number">1999</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"搭载 M3 芯片的专业笔记本电脑，适合开发者和创意工作者"</span>
  },
  {
    <span class="hljs-string">"id"</span>: <span class="hljs-string">"p003"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"AirPods Pro"</span>,
    <span class="hljs-string">"brand"</span>: <span class="hljs-string">"Apple"</span>,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"audio"</span>,
    <span class="hljs-string">"price"</span>: <span class="hljs-number">249</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"主动降噪无线耳机，空间音频技术，透明模式"</span>
  },
  {
    <span class="hljs-string">"id"</span>: <span class="hljs-string">"p004"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"Samsung Galaxy S24"</span>,
    <span class="hljs-string">"brand"</span>: <span class="hljs-string">"Samsung"</span>,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"smartphone"</span>,
    <span class="hljs-string">"price"</span>: <span class="hljs-number">899</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"Android 旗舰手机，AI 摄影功能，120Hz 显示屏"</span>
  },
  {
    <span class="hljs-string">"id"</span>: <span class="hljs-string">"p005"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"Dell XPS 13"</span>,
    <span class="hljs-string">"brand"</span>: <span class="hljs-string">"Dell"</span>,
    <span class="hljs-string">"category"</span>: <span class="hljs-string">"laptop"</span>,
    <span class="hljs-string">"price"</span>: <span class="hljs-number">1299</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"轻薄笔记本电脑，13.3英寸 4K 触摸屏，Intel 处理器"</span>
  }
]

<span class="hljs-comment"># 生成向量嵌入</span>
<span class="hljs-keyword">for</span> product <span class="hljs-keyword">in</span> products:
  response = embedding(<span class="hljs-string">'text-embedding-3-large'</span>, product[<span class="hljs-string">"description"</span>])
  product[<span class="hljs-string">"description_vector"</span>] = np.array(response.data[<span class="hljs-number">0</span>][<span class="hljs-string">'embedding'</span>], dtype=np.float32).tobytes()

<span class="hljs-comment"># 加载产品数据到 Redis</span>
<span class="hljs-keyword">for</span> product <span class="hljs-keyword">in</span> products:
  index.load([product], id_field=<span class="hljs-string">"id"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"成功加载 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(products)}</span> 个产品到索引中"</span>)
</code></pre>
<p>我们为每个产品的描述生成对应的向量，并通过 <code>index.load()</code> 将产品数据加载到 Redis 中。接下来就可以执行搜索了：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> redisvl.index <span class="hljs-keyword">import</span> SearchIndex
<span class="hljs-keyword">from</span> redisvl.query <span class="hljs-keyword">import</span> VectorQuery

<span class="hljs-comment"># 使用已有索引</span>
index = SearchIndex.from_existing(<span class="hljs-string">'product_index'</span>, client)

<span class="hljs-comment"># 生成查询向量</span>
response = embedding(<span class="hljs-string">'text-embedding-3-large'</span>, <span class="hljs-string">"适合程序员的电脑"</span>)
query_vector = np.array(response.data[<span class="hljs-number">0</span>][<span class="hljs-string">'embedding'</span>], dtype=np.float32).tobytes()

<span class="hljs-comment"># 创建向量查询</span>
vector_query = VectorQuery(
  vector=query_vector,
  vector_field_name=<span class="hljs-string">"description_vector"</span>,
  return_fields=[<span class="hljs-string">"title"</span>, <span class="hljs-string">"brand"</span>, <span class="hljs-string">"category"</span>, <span class="hljs-string">"price"</span>, <span class="hljs-string">"description"</span>],
  num_results=<span class="hljs-number">3</span>,
)

<span class="hljs-comment"># 执行搜索</span>
results = index.query(vector_query)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n查询: '适合程序员的电脑'"</span>)
<span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> results:
  score = <span class="hljs-number">1</span> - <span class="hljs-built_in">float</span>(doc[<span class="hljs-string">'vector_distance'</span>])  <span class="hljs-comment"># 转换为相似度分数</span>
  <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- <span class="hljs-subst">{doc[<span class="hljs-string">'title'</span>]}</span> (<span class="hljs-subst">{doc[<span class="hljs-string">'brand'</span>]}</span>) - 相似度: <span class="hljs-subst">{score:<span class="hljs-number">.3</span>f}</span>"</span>)
  <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  价格: $<span class="hljs-subst">{doc[<span class="hljs-string">'price'</span>]}</span> | 描述: <span class="hljs-subst">{doc[<span class="hljs-string">'description'</span>]}</span>"</span>)
</code></pre>
<p>搜索结果如下：</p>
<pre><code class="hljs language-bash" lang="bash">查询: <span class="hljs-string">'适合程序员的电脑'</span>
- MacBook Pro 14英寸 (Apple) - 相似度: 0.570
  价格: <span class="hljs-variable">$1999</span> | 描述: 搭载 M3 芯片的专业笔记本电脑，适合开发者和创意工作者
- Dell XPS 13 (Dell) - 相似度: 0.435
  价格: <span class="hljs-variable">$1299</span> | 描述: 轻薄笔记本电脑，13.3英寸 4K 触摸屏，Intel 处理器
- iPhone 15 Pro Max (Apple) - 相似度: 0.293
  价格: <span class="hljs-variable">$1199</span> | 描述: 最新的 iPhone，配备 A17 Pro 芯片，48MP 主摄像头，钛金属机身
</code></pre>
<h2 data-id="heading-5">缓存控制参数</h2>
<p>LiteLLM 提供了灵活的缓存控制机制，允许在请求级别动态控制缓存行为。这些控制参数借鉴了 HTTP 缓存控制的设计理念，提供了细粒度的缓存管理能力。</p>









































<table><thead><tr><th>参数</th><th>类型</th><th>说明</th><th>使用场景</th></tr></thead><tbody><tr><td><code>ttl</code></td><td>int</td><td>指定缓存时间（秒）</td><td>短期缓存、时效性内容</td></tr><tr><td><code>s-maxage</code></td><td>int</td><td>只接受指定时间内的缓存（秒）</td><td>强制刷新、数据一致性</td></tr><tr><td><code>no-cache</code></td><td>bool</td><td>跳过缓存读取，强制调用 API</td><td>需要最新数据</td></tr><tr><td><code>no-store</code></td><td>bool</td><td>不存储响应到缓存</td><td>敏感内容、一次性查询</td></tr><tr><td><code>namespace</code></td><td>str</td><td>自定义缓存命名空间</td><td>多租户、环境隔离</td></tr></tbody></table>
<h3 data-id="heading-6">动态 TTL 控制</h3>
<p>参数 <code>ttl</code> 用于控制缓存时间，我们可以为不同类型的请求设置不同的缓存时间：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 长期缓存：百科类知识</span>
response = client.chat.completions.create(
  model=<span class="hljs-string">"gpt-4o"</span>,
  messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"什么是量子计算？"</span>}],
  extra_body={
    <span class="hljs-string">"cache"</span>: {
      <span class="hljs-string">"ttl"</span>: <span class="hljs-number">86400</span>  <span class="hljs-comment"># 缓存 24 小时</span>
    }
  }
)

<span class="hljs-comment"># 短期缓存：实时性要求较高的内容</span>
response = client.chat.completions.create(
  model=<span class="hljs-string">"gpt-4o"</span>,
  messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"今天的股市表现如何？"</span>}],
  extra_body={
    <span class="hljs-string">"cache"</span>: {
      <span class="hljs-string">"ttl"</span>: <span class="hljs-number">300</span>  <span class="hljs-comment"># 缓存 5 分钟</span>
    }
  }
)
</code></pre>
<h3 data-id="heading-7">缓存年龄控制</h3>
<p>参数 <code>s-maxage</code> 控制只接受指定年龄内的缓存：</p>
<pre><code class="hljs language-python" lang="python">response = client.chat.completions.create(
  model=<span class="hljs-string">"gpt-4o"</span>,
  messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"最新的股票价格"</span>}],
  extra_body={
    <span class="hljs-string">"cache"</span>: {
      <span class="hljs-string">"s-maxage"</span>: <span class="hljs-number">60</span>  <span class="hljs-comment"># 只接受 1 分钟内的缓存</span>
    }
  }
)
</code></pre>
<h3 data-id="heading-8">强制刷新缓存</h3>
<p>当需要获取最新结果时，可以使用 <code>no-cache</code> 强制绕过缓存：</p>
<pre><code class="hljs language-python" lang="python">response = client.chat.completions.create(
  model=<span class="hljs-string">"gpt-4o"</span>,
  messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"最新的股票价格"</span>}],
  extra_body={
    <span class="hljs-string">"cache"</span>: {
      <span class="hljs-string">"no-cache"</span>: <span class="hljs-literal">True</span>  <span class="hljs-comment"># 跳过缓存检查</span>
    }
  }
)
</code></pre>
<h3 data-id="heading-9">禁用缓存存储</h3>
<p>对于包含敏感信息的查询，可以使用 <code>no-store</code> 不缓存当前响应：</p>
<pre><code class="hljs language-python" lang="python">response = client.chat.completions.create(
  model=<span class="hljs-string">"gpt-4o"</span>,
  messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"敏感信息查询"</span>}],
  extra_body={
    <span class="hljs-string">"cache"</span>: {
      <span class="hljs-string">"no-store"</span>: <span class="hljs-literal">True</span>  <span class="hljs-comment"># 不存储此响应</span>
    }
  }
)
</code></pre>
<h3 data-id="heading-10">命名空间隔离</h3>
<p>在多租户或多环境场景中，LiteLLM 支持命名空间来实现缓存隔离：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">cache:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">cache_params:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">namespace:</span> <span class="hljs-string">"litellm.production"</span>  <span class="hljs-comment"># 命名空间前缀</span>
</code></pre>
<p>这样存储在 Redis 中的键将变成 <code>{namespace}:&lt;hash&gt;</code> 格式，我们也可以在请求参数中动态控制，为不同的用户或应用使用独立的缓存空间：</p>
<pre><code class="hljs language-python" lang="python">response = client.chat.completions.create(
  model=<span class="hljs-string">"gpt-4o"</span>,
  messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Hello"</span>}],
  extra_body={
    <span class="hljs-string">"cache"</span>: {
      <span class="hljs-string">"namespace"</span>: <span class="hljs-string">"user:12345"</span>  <span class="hljs-comment"># 用户专用命名空间</span>
    }
  }
)
</code></pre>
<h3 data-id="heading-11">默认关闭模式</h3>
<p>对于需要严格控制的场景，可以将缓存设置为默认关闭，只在需要时显式启用：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">litellm_settings:</span>
  <span class="hljs-attr">cache:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">cache_params:</span>
    <span class="hljs-attr">mode:</span> <span class="hljs-string">default_off</span>  <span class="hljs-comment"># 缓存默认关闭</span>
</code></pre>
<p>客户端需要显式启用缓存：</p>
<pre><code class="hljs language-python" lang="python">response = client.chat.completions.create(
  model=<span class="hljs-string">"gpt-4o"</span>,
  messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Hello"</span>}],
  extra_body={
    <span class="hljs-string">"cache"</span>: {<span class="hljs-string">"use-cache"</span>: <span class="hljs-literal">True</span>}  <span class="hljs-comment"># 显式启用缓存</span>
  }
)
</code></pre>
<h2 data-id="heading-12">小结</h2>
<p>我们今天简单学习了 LiteLLM 的缓存系统。LiteLLM 提供了从简单的内存缓存到复杂的语义缓存等多种选择，每种缓存都有其特定的适用场景，可以根据业务需求灵活选择最合适的缓存策略。此外，LiteLLM 的缓存控制参数提供了细粒度的缓存管理能力，使开发者能够动态调整缓存行为，以适应不同场景的需求。</p>
<p>通过合理配置和使用这些缓存功能，应用可以更好地处理重复性和相似性的查询，有效降低对上游 LLM API 的压力，提升系统的稳定性与响应速度。</p>
<h2 data-id="heading-13">欢迎关注</h2>
<p>如果这篇文章对您有所帮助，欢迎关注我的同名公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">日习一技，每天学一点新技术</a>。</p>
<p>我会每天花一个小时，记录下我学习的点点滴滴。内容包括但不限于：</p>
<ul>
<li>某个产品的使用小窍门</li>
<li>开源项目的实践和心得</li>
<li>技术点的简单解读</li>
</ul>
<p>目标是让大家用5分钟读完就能有所收获，不需要太费劲，但却可以轻松获取一些干货。不管你是技术新手还是老鸟，欢迎给我提建议，如果有想学习的技术，也欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分享一些ServBay和Docker混合使用的最佳实践？]]></title>    <link>https://juejin.cn/post/7576923573777072170</link>    <guid>https://juejin.cn/post/7576923573777072170</guid>    <pubDate>2025-11-27T00:31:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576923573777072170" data-draft-id="7576923573777055786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分享一些ServBay和Docker混合使用的最佳实践？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T00:31:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分享一些ServBay和Docker混合使用的最佳实践？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:31:20.000Z" title="Thu Nov 27 2025 00:31:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ServBay 和 Docker 在设计哲学上确实不同，但它们并非“二选一”的对手。在实际开发中，许多高效的工作流正是利用了二者的优势，实现 <strong>“本地开发用 ServBay，部署交付用 Docker”</strong> ​ 的黄金组合。</p>
<p>下面这个表格清晰地概括了这种混合策略的核心思想与分工。</p>



































<table><thead><tr><th>特性对比</th><th>ServBay 的角色 (主攻本地开发)</th><th>Docker 的角色 (主攻部署与协作)</th><th>混合策略的核心价值</th></tr></thead><tbody><tr><td><strong>核心目标</strong>​</td><td><strong>极致的开发体验</strong>：速度优先，开箱即用</td><td><strong>环境一致性</strong>：一次构建，处处运行</td><td><strong>扬长避短</strong>：让每个工具做自己最擅长的事</td></tr><tr><td><strong>性能表现</strong>​</td><td><strong>原生性能</strong>：启动秒级，文件读写无损耗</td><td><strong>虚拟化开销</strong>：启动较慢，文件I/O有性能损耗</td><td><strong>开发阶段追求效率，生产阶段保证稳定</strong>​</td></tr><tr><td><strong>环境管理</strong>​</td><td><strong>图形化界面</strong>：一键配置服务、域名、SSL</td><td><strong>声明式配置</strong>：通过 Dockerfile 和 compose 文件定义环境</td><td><strong>简化个人日常操作，标准化团队交付物</strong>​</td></tr><tr><td><strong>适用阶段</strong>​</td><td><strong>编码、调试、本地测试</strong>​</td><td><strong>CI/CD、生产部署、团队环境同步</strong>​</td><td><strong>覆盖从开发到上线的完整生命周期</strong>​</td></tr></tbody></table>
<h3 data-id="heading-0">混合使用模式与最佳实践</h3>
<p>基于上述分工，以下是几种经过验证的混合使用模式：</p>
<h4 data-id="heading-1">1. ServBay 主攻本地开发，Docker 封装生产环境</h4>
<p>这是最常见且高效的模式。你在本地使用 ServBay 获得闪电般的启动速度和无缝的编码调试体验。当功能完成需要交付时，再使用 Docker 将应用及其依赖打包成一个标准镜像。</p>
<ul>
<li>
<p><strong>适用场景</strong>：全栈 Web 项目（如使用 PHP、Python、Node.js 的项目）、需要快速迭代的 API 开发。</p>
</li>
<li>
<p><strong>操作流程</strong>：</p>
<ol>
<li><strong>本地开发</strong>：在 ServBay 中为项目 <code>my-app</code>创建站点 <code>https://my-app.serv</code>，配置好所需的 PHP 8.3 和 MySQL 8.0 环境，开始高效编码。</li>
<li><strong>编写 Dockerfile</strong>：在项目根目录创建 <code>Dockerfile</code>，定义如何构建生产镜像。</li>
<li><strong>交付与部署</strong>：通过 CI/CD 流程或手动命令构建 Docker 镜像，并推送到镜像仓库，用于在生产服务器或测试环境中部署。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-2">2. ServBay 管理基础服务，Docker 运行特定工具</h4>
<p>在这种模式下，ServBay 作为稳定的“地基”，负责运行那些版本固定、不常变动的核心服务（如 MySQL、Redis、Nginx）。而 Docker 则用于快速启动和销毁一些特定的、临时的工具链服务。</p>
<ul>
<li>
<p><strong>适用场景</strong>：需要临时使用数据库管理工具（如 Adminer）、需要运行一次性脚本或工具。</p>
</li>
<li>
<p><strong>操作流程</strong>：</p>
<ol>
<li>用 ServBay 一键启动并管理主要的 MySQL 数据库服务。</li>
<li>当需要一個更强大的数据库管理界面时，无需在 ServBay 中复杂配置，直接运行 <code>docker run -d -p 8080:80 --link my-db:db adminer</code>即可启动一个 Adminer 容器。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-3">3. ServBay 简化AI开发环境，Docker 保障模型服务一致性</h4>
<p>对于集成AI能力的应用，ServBay可以极大简化本地的大模型（如通过Ollama）和AI Agent框架（如LangChain）的部署与管理。而最终将AI应用上线时，Docker能确保模型服务与API接口的环境一致性。</p>
<ul>
<li>
<p><strong>适用场景</strong>：本地开发带有AI功能的应用，如基于RAG的智能问答系统。</p>
</li>
<li>
<p><strong>操作流程</strong>：</p>
<ol>
<li><strong>本地AI环境搭建</strong>：利用 ServBay 内置的 Ollama 支持，在图形界面中一键下载并运行大语言模型（如 Llama 3），并通过 <code>https://ollama.servbay.host</code>这样的安全域名进行访问，无需关心复杂的命令行参数。</li>
<li><strong>应用容器化</strong>：你的主应用代码（如Python Flask API）则通过Dockerfile进行容器化，在构建时可以直接引用本地ServBay提供的AI服务地址进行测试。</li>
</ol>
</li>
</ul>
<h3 data-id="heading-4">成功案例参考</h3>
<ul>
<li><strong>n8n自动化工作流平台</strong>：有开发者分享使用 ServBay 在本地快速部署 n8n：通过 ServBay 配置好 Node.js 环境并设置反向代理，几分钟内就能在 <code>https://n8n.serv</code>这样的域名下访问本地n8n实例进行自动化流程开发。当流程开发完毕需要部署到生产服务器时，再使用官方的 n8n Docker 镜像，确保了环境一致性和易于维护。</li>
<li><strong>AI Agent项目开发</strong>：对于LangChain、AutoGen等AI Agent项目，在本地开发时使用ServBay可以一键配置Ollama等LLM环境，快速验证想法。而在部署到生产环境时，则可以利用Docker Compose来编排包括LLM服务（如Ollama容器）、向量数据库（如Redis容器）和应用本身在内的多个服务，实现可靠的一键部署。</li>
</ul>
<h3 data-id="heading-5">⚠️ 混合使用注意事项</h3>
<ol>
<li><strong>版本对齐</strong>：确保 ServBay 本地使用的服务版本（如 PHP、Node.js、MySQL）与生产 Docker 镜像中定义的版本保持一致，避免因版本差异导致线上问题。</li>
<li><strong>依赖管理</strong>：明确区分开发依赖和生产依赖。<code>package.json</code>或 <code>composer.json</code>中的开发依赖不应被打进生产镜像。</li>
<li><strong>配置隔离</strong>：使用环境变量或配置文件来管理不同环境（本地、测试、生产）的差异，如数据库连接字符串、API密钥等。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ServBay如何与IDE（如IntelliJ IDEA）深度集成，实现一键调试和热部署？]]></title>    <link>https://juejin.cn/post/7576888607480299539</link>    <guid>https://juejin.cn/post/7576888607480299539</guid>    <pubDate>2025-11-27T00:38:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576888607480299539" data-draft-id="7576888607480283155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ServBay如何与IDE（如IntelliJ IDEA）深度集成，实现一键调试和热部署？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T00:38:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ServBay如何与IDE（如IntelliJ IDEA）深度集成，实现一键调试和热部署？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:38:52.000Z" title="Thu Nov 27 2025 00:38:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ServBay 本身是一款专注于提供稳定、集成化本地服务（如Nginx、MySQL、Redis等）的环境管理工具。要实现与 IntelliJ IDEA 的深度集成，特别是热部署和一键调试，核心在于将 ServBay 管理的服务与 IDEA 强大的项目管理和调试功能进行“桥接”。下面是一个清晰的流程和配置方案。</p>
<h3 data-id="heading-0">🔧 集成方案概述</h3>
<p>实现 ServBay 与 IntelliJ IDEA 的协同工作，其整体思路如下表所示：</p>





























<table><thead><tr><th>步骤</th><th>ServBay 的角色</th><th>IntelliJ IDEA 的角色</th><th>最终目标</th></tr></thead><tbody><tr><td><strong>1. 环境准备</strong>​</td><td>提供并管理Web服务器（如Nginx）、数据库（MySQL）等依赖服务。</td><td>作为主开发环境，编写和构建Spring Boot应用。</td><td>获得一个完整的、可运行的本地服务器环境。</td></tr><tr><td><strong>2. 热部署配置</strong>​</td><td>托管应用运行时的容器（通过其管理的服务）。</td><td>利用内置功能（DevTools）将更改后的代码自动部署到ServBay托管的运行环境中。</td><td>实现代码修改后无需手动重启服务即可生效。</td></tr><tr><td><strong>3. 一键调试</strong>​</td><td>确保其管理的Java进程以调试模式启动。</td><td>通过远程调试（Remote Debugging）配置，连接到ServBay管理的JVM。</td><td>能够在IDEA中直接设置断点、单步调试部署在ServBay环境中的代码。</td></tr></tbody></table>
<h3 data-id="heading-1">🚀 配置热部署</h3>
<p>对于Spring Boot项目，实现热部署（应用代码修改后自动生效）最有效的方式是结合使用Spring Boot DevTools和IntelliJ IDEA的自动编译功能。</p>
<ol>
<li>
<p><strong>项目配置</strong></p>
<ul>
<li><strong>添加依赖</strong>：在项目的 <code>pom.xml</code>中添加 Spring Boot DevTools 依赖。</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<ul>
<li><strong>开启IDEA自动编译</strong>：在 IDEA 的设置中（<code>Settings/Preferences</code>&gt; <code>Build, Execution, Deployment</code>&gt; <code>Compiler</code>），勾选 <strong>Build project automatically</strong>。</li>
<li><strong>注册表配置</strong>：按 <code>Ctrl+Shift+Alt+/</code>（Windows/Linux）或 <code>Cmd+Shift+Option+/</code>（Mac），选择 <strong>Registry...</strong> ，找到并勾选 <code>compiler.automake.allow.when.app.running</code>选项。</li>
</ul>
</li>
<li>
<p><strong>ServBay 中的部署与运行</strong></p>
<p>将你的Spring Boot应用打包为JAR或WAR文件。你可以通过ServBay管理的反向代理，将特定域名（如 <code>myapp.servbay.host</code>）代理到你的Spring Boot应用实际运行的端口（例如8080）。这样你就可以通过一个清晰的域名访问应用。</p>
</li>
</ol>
<p>完成以上配置后，当你在IDEA中修改代码并保存时，IDEA会自动编译。随后，Spring Boot DevTools会监听到类路径的变化，并触发应用的快速重启（而非冷启动），从而使更改在ServBay托管的服务中几乎即时生效。</p>
<h3 data-id="heading-2">🔍 配置一键调试</h3>
<p>要实现远程调试，需要让ServBay中运行的Java应用开启调试模式，然后让IDEA去连接它。</p>
<ol>
<li>
<p><strong>在ServBay中启用调试模式</strong></p>
<p>你需要确保你的Spring Boot应用在ServBay环境下是以支持调试的方式启动。这通常需要通过ServBay的配置界面，为你运行Java应用的服务（例如，一个自定义的Java服务配置）在<strong>JVM参数</strong>中添加远程调试选项。</p>
<p>在应用的启动配置（例如在ServBay中管理该服务的设置项）里，增加JVM参数：</p>
<pre><code class="hljs language-ini" lang="ini">-agentlib:<span class="hljs-attr">jdwp</span>=transport=dt_socket,server=y,suspend=n,address=<span class="hljs-number">5005</span>
</code></pre>
<ul>
<li><code>address=5005</code>是调试器监听的端口号，可以自定义。</li>
</ul>
</li>
<li>
<p><strong>在IntelliJ IDEA中创建远程调试配置</strong></p>
<ul>
<li>在IDEA中，点击顶部菜单栏的 <strong>Run</strong>​ &gt; <strong>Edit Configurations...</strong> 。</li>
<li>点击左上角的 <strong>+</strong> ​ 号，选择 <strong>Remote JVM Debug</strong>。</li>
<li>给配置取个名字，比如 "Debug MyApp on ServBay"。</li>
<li>确保 <strong>Host</strong>​ 填写为 <code>localhost</code>（如果ServBay和IDEA在同一台机器上）或你的Mac的局域网IP。</li>
<li><strong>Port</strong>​ 填写上一步中设置的端口，例如 <code>5005</code>。</li>
<li>点击 <strong>OK</strong>​ 保存配置。</li>
</ul>
</li>
<li>
<p><strong>开始调试</strong></p>
<ul>
<li>确保你的应用已在ServBay中启动。</li>
<li>在IDEA中，从顶部运行配置下拉菜单里选择刚刚创建的 "Debug MyApp on ServBay"，然后点击旁边的 <strong>Debug</strong>​ 按钮（图标是小虫子）。</li>
<li>如果IDEA底部控制台显示 "Connected to the target VM, ..."，则表示连接成功。</li>
<li>现在，你可以在你的Java代码中设置断点。当通过浏览器或其他工具访问你的应用并触发相应逻辑时，IDEA就会在断点处暂停，你可以像调试本地程序一样进行变量查看、单步执行等操作。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">💎 最佳实践与技巧</h3>
<ul>
<li><strong>端口管理</strong>：确保ServBay中配置的调试端口（如5005）没有被其他程序占用。</li>
<li><strong>多版本管理</strong>：ServBay支持同时管理多个版本的PHP、Node.js等环境。确保你为项目选择的环境与IDEA中设置的Project SDK和语言级别保持一致。</li>
<li><strong>日志查看</strong>：调试时，结合查看ServBay提供的服务日志和IDEA的Debug控制台输出，能更快定位问题。</li>
</ul>
<p>希望这份详细的指南能帮助你顺利地将ServBay的便捷性与IntelliJ IDEA的强大功能结合起来，极大提升你的开发效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Creator都快4.0了，怎么能没有这样的功能？]]></title>    <link>https://juejin.cn/post/7576907627016912947</link>    <guid>https://juejin.cn/post/7576907627016912947</guid>    <pubDate>2025-11-27T00:38:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576907627016912947" data-draft-id="7576821574428033033" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Creator都快4.0了，怎么能没有这样的功能？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-27T00:38:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Creator都快4.0了，怎么能没有这样的功能？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:38:56.000Z" title="Thu Nov 27 2025 00:38:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>点击上方亿元程序员+关注和★星标</p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，最近笔者看到有小伙伴吐槽：</p>
<p><strong>编辑器为什么没有快速隐藏显示组件的快捷键？？</strong></p>
<p><strong>好家伙</strong>，Creator都快4.0了，怎么能没有这样的功能？</p>
<p><strong>于是</strong>笔者去文档翻了翻，还真没找到，小伙伴还提到隔壁<code>Unity</code>的就在菜单上：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a13f5f1056b545169a81833afe149990~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=VK7F3s7UMg3Il4P8yDTAUZdW1UQ%3D" alt="" loading="lazy"/></p>
<p><strong>功夫不负有心人</strong>，终于在菜单<code>文件-&gt;快捷键-&gt;scene-&gt;toggle-active-selected-node</code>中找到了快捷键<code>h</code>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51a1c9236816454c91e53aac36390b56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=CGXQMV9YQBeBhVfP61MyOcxAwIM%3D" alt="" loading="lazy"/></p>
<p><strong>试了一下</strong>，的确可以用，但是好像有点小<code>BUG</code>，操作后，通过<code>ctrl+z</code>没办法撤回操作。</p>
<p><strong>言归正传</strong>，本期带大家一起来看看，如何在<code>Cocos</code>游戏开发中，自定义<strong>快捷键</strong>实现<strong>显示/隐藏节点</strong>、<strong>调整节点的渲染层级</strong>。</p>
<p><strong>如果</strong>对你或你的小伙伴有帮助，可以<strong>点赞</strong>和<strong>爱心</strong>和<strong>分享</strong>三连哦~</p>
<p><strong>本文源工程可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">为什么要用快捷键？</h2>
<p><strong>在</strong>游戏开发中，我们拼<code>UI</code>的时候，经常由于大图片或者其他内容的遮挡，我们想要找到指定内容的时候比较困难。</p>
<p><strong>所以</strong>我们需要先将部分内容隐藏，隐藏节点的常规操作就是通过鼠标选择节点，然后再移动鼠标到属性面板去反勾选那个小框框：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba76d76b3bb7448e96296b4c27e0b923~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=p6KJ3u41RmMhc0ZbK1Pk%2Fp%2BE7ls%3D" alt="" loading="lazy"/></p>
<p><strong>操作</strong>非常不流畅，调整节点的渲染层级也是如此，想要拖动到同级节点的上面/下面的时候，眼花很容易拖到子节点或者父节点那里去，让人抓狂。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76bc7fd0d76d438cac18b7fd468e6ccb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=VUNeI5jr9wCbCV1YIIlwBrRXdWo%3D" alt="" loading="lazy"/></p>
<p><strong>所以啊，我们一起来看看实例。</strong></p>
<h2 data-id="heading-2">上实例</h2>
<h3 data-id="heading-3">1.创建插件</h3>
<p><strong>想要自定义快捷键</strong>，首先要创建我们的插件，通过菜单<code>扩展-&gt;创建扩展</code>打开扩展创建面板,选择一个空白模板进行创建。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a676027bb764e49b9245710e4d305d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=XlrpzqnPqKKEHpDujr19xJdfE%2FU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2.定义快捷键</h3>
<p><strong>关于自定义快捷键</strong>，官方文档还是有比较详细的描述的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/420b6a7968ef41b2b1d14367c5077695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=jrtxQT%2FqQyY5UXCbW1RA8Ay4xe4%3D" alt="来源于官方文档" loading="lazy"/></p>
<p><strong>我们</strong>在插件的<code>package.json</code>中定义下面三个消息以及三个快捷键：</p>
<ul>
<li><strong>setActive</strong>(alt+shift+a):显示/隐藏节点。</li>
<li><strong>setSiblingIndex_up</strong>(alt+shift+=):节点向上移动一层。</li>
<li><strong>setSiblingIndex_down</strong>(alt+shift+-):节点向下移动一层。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0208c0a590254699909af3f27d89407a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=abWgmXrNCNwVrN769m%2BOuJ9DPsw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3.实现setActive方法</h3>
<p><strong>首先</strong>我们在<code>main.ts</code>中，实现我们的<code>setActive</code>方法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1868efd02cf48a8812a5e7b116a0e5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=l0%2FPu55ccKuP%2BmlOGSmjXGMJFEs%3D" alt="" loading="lazy"/></p>
<p><strong>其中</strong>关键的步骤：</p>
<ul>
<li>
<p><strong>获取选择的节点</strong>： 通过<code>Editor.Selection.getSelected('node')</code>获取当前选择的节点数组(可多选)。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75996f7764ce4b1eb56c47608000c3e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=C9Ji8U7JQ5BHP4si%2BiNq3QChbuU%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>查询节点信息</strong>： 通过<code>Editor.Message.request('scene', 'query-node', nodes[0])</code>查询节点信息，注意这个不是我们开发时的<code>cc.Node</code>，获取是否隐藏可以通过<code>node.active.value</code>获取。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cdb662443c54bedb42c574656614493~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=Tkg82mjtdfA0PllKVck%2BOxS4IqQ%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>修改节点属性</strong>：通过<code>set-property</code>消息修改。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f80e53cd18b4a1a9c7565dacbcb2793~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=Ce0XEwYfhgHzOSULWk8VrQh3%2Bv4%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>记录undo数据</strong>：上面提到的官方的隐藏接口可能缺少这个，导致无法撤回。开始记录和结束记录要成对出现。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/030997fd0298484caeacf11cbd3833df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=eLe4us%2F6RZBiG%2FGVNboP%2Bet8o6A%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-6">4.实现setSiblingIndex方法</h3>
<p><strong>我们</strong>把上移和下移的逻辑写到一起，通过<code>offset</code>传入上下移动的步数。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/099cc61e8e9642feac8f81ac68415676~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=14TB2Sx6HTyv%2BwaOlvwFg4t9qbY%3D" alt="" loading="lazy"/></p>
<p><strong>其中</strong>关键的步骤：</p>
<ul>
<li>
<p><strong>获取选择的节点</strong>： 同上。</p>
</li>
<li>
<p><strong>查询节点信息</strong>： 同上上。</p>
</li>
<li>
<p><strong>查询选择的节点的父节点信息</strong>： 通过<code>node.parent.value.uuid</code>拿到父节点的<code>uuid</code>，再通过上面的方法获得父节点信息。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddec1056d5ac4664970826c6031ccaf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=D2vB2l3TdI7LzpBCKJ6LDssPhsg%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>查询节点的层级</strong>：通过父节点信息<code>children</code>数组找出节点的层级。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a91f3b37686435aab375f4a5512aaa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=foCCes8jo9wxR8xzOO3ehRFE1HQ%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>修改节点层级</strong>：<code>target</code>是要调整位置的项的下标，<code>offset</code>是要调整的偏移。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33e2240930134555913621463cfd9da8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=QStXIn38bO2VaRbVj15OSykEbPs%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>记录undo数据</strong>：同上上上。</p>
</li>
<li>
<p><strong>调用</strong>：上传<code>-1</code>，下传<code>1</code>。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe9da25248364878be90d0bfabf31f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=s%2BpMiT7QIiG9%2BSwH3WwfFqsEKNQ%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-7">5.效果演示</h3>
<p><strong>隐藏/显示节点</strong>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abcf7f153d114a4fbf91d6d601b59358~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=QvJaO0MLv3rbcdXZHjt7qlUalDc%3D" alt="" loading="lazy"/></p>
<p><strong>修改层级</strong>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60a1e005c73d49158c5917ef23fb4ab6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764808736&amp;x-signature=KWB2m1cXsIfm8AHM2i5aoHxQkF0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">结语</h2>
<p><strong>以上</strong>就是今天的全部内容，小伙伴们可以自行扩展，如有不足还请指出。</p>
<p><strong>我们常常说到</strong>不要重复造轮子，但是轮子都没有的话，只能拿起扳手了。</p>
<p><strong>小伙伴们还有哪些想要实现的功能？</strong></p>
<p>本文<strong>源工程</strong>可通过<strong>私信</strong>发送 <strong>Shortcut</strong> 获取。</p>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐专栏：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3175880857546129410%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3175880857546129410#wechat_redirect" ref="nofollow noopener noreferrer">知识付费专栏</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26mid%3D2247487282%26idx%3D1%26sn%3De3cb8ab6f5c0d5f804d5c29e2e90b9ad%26chksm%3Dc00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54%26token%3D336413522%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NTY2MjIzMg==&amp;mid=2247487282&amp;idx=1&amp;sn=e3cb8ab6f5c0d5f804d5c29e2e90b9ad&amp;chksm=c00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54&amp;token=336413522&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3207702867494305797%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3207702867494305797#wechat_redirect" ref="nofollow noopener noreferrer">100个Cocos实例</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3073771187570999299%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3073771187570999299#wechat_redirect" ref="nofollow noopener noreferrer">8年主程手把手打造Cocos独立游戏开发框架</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3121583619634626562%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3121583619634626562#wechat_redirect" ref="nofollow noopener noreferrer">和8年游戏主程一起学习设计模式</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3Faction%3Dgetalbum%26__biz%3DMzg5NTY2MjIzMg%3D%3D%26scene%3D1%26album_id%3D3038883468588089350%26count%3D3%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;__biz=Mzg5NTY2MjIzMg==&amp;scene=1&amp;album_id=3038883468588089350&amp;count=3#wechat_redirect" ref="nofollow noopener noreferrer">从零开始开发贪吃蛇小游戏到上线系列</a></p>
<p>点击下方灰色按钮+关注。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个典型的SpringBoot Web项目在ServBay和Docker中分别的完整开发部署流程]]></title>    <link>https://juejin.cn/post/7577171133431496745</link>    <guid>https://juejin.cn/post/7577171133431496745</guid>    <pubDate>2025-11-27T00:37:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577171133431496745" data-draft-id="7577171133431463977" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个典型的SpringBoot Web项目在ServBay和Docker中分别的完整开发部署流程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-27T00:37:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个典型的SpringBoot Web项目在ServBay和Docker中分别的完整开发部署流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:37:21.000Z" title="Thu Nov 27 2025 00:37:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>一个典型的Java SpringBoot Web项目在ServBay和Docker中的开发部署流程，核心差异在于<strong>ServBay提供了高度集成和稳定的本地开发环境</strong>，而<strong>Docker则确保了环境一致性和跨平台的部署能力</strong>。下面这个表格能帮你直观地了解两者的主要区别和适用场景。</p>






























<table><thead><tr><th>对比维度</th><th>ServBay (本地开发)</th><th>Docker (部署)</th></tr></thead><tbody><tr><td><strong>核心价值</strong>​</td><td><strong>本地开发效率</strong>，提供开箱即用、版本统一的完整环境（JDK, Maven/Gradle）</td><td><strong>环境一致性</strong>与<strong>隔离性</strong>，确保应用从开发到生产环境行为一致</td></tr><tr><td><strong>环境管理</strong>​</td><td>自动管理，一键启动/停止服务（如数据库），无需手动安装配置</td><td>通过Dockerfile和镜像定义环境，容器化运行</td></tr><tr><td><strong>适用场景</strong>​</td><td><strong>开发、调试、单元测试</strong>阶段，追求快速启动和高效率</td><td><strong>测试、生产环境部署</strong>，持续集成/持续部署（CI/CD）流程</td></tr><tr><td><strong>配置重点</strong>​</td><td>集成开发环境（IDE），ServBay服务管理</td><td>编写Dockerfile，优化镜像层，容器编排（如Docker Compose, Kubernetes）</td></tr></tbody></table>
<p>接下来，我们详细看看在ServBay和Docker中的具体操作流程。</p>
<h3 data-id="heading-0">🔧 ServBay 本地开发流程</h3>
<p>ServBay 是一个优秀的本地开发环境工具，能让你在本地快速启动所有开发所需服务。</p>
<ol>
<li>
<p><strong>环境准备与项目初始化</strong></p>
<ul>
<li>
<p><strong>安装ServBay</strong>：从官网下载并安装ServBay，它通常会集成JDK、Maven/Gradle等必要工具。</p>
</li>
<li>
<p><strong>创建SpringBoot项目</strong>：可以使用Spring Initializr（通常集成在IDE中）或ServBay可能提供的命令行工具来快速生成项目基础结构。标准的SpringBoot项目结构如下所示：</p>
<pre><code class="hljs language-bash" lang="bash">my-springboot-app/
├── src/
│   ├── main/
│   │   ├── java/com/example/demo/DemoApplication.java  <span class="hljs-comment"># 主应用类</span>
│   │   ├── resources/
│   │   │   ├── application.properties    <span class="hljs-comment"># 配置文件</span>
│   │   │   ├── static/                   <span class="hljs-comment"># 静态资源</span>
│   │   │   └── templates/                <span class="hljs-comment"># 模板文件</span>
│   │   └── webapp/ (可选，若打WAR包)
│   └── <span class="hljs-built_in">test</span>/java/...                      <span class="hljs-comment"># 测试代码</span>
├── pom.xml 或 build.gradle                <span class="hljs-comment"># 项目依赖管理</span>
└── README.md
</code></pre>
</li>
<li>
<p><strong>启动ServBay服务</strong>：通过ServBay界面或命令行启动项目所需的辅助服务，如MySQL、Redis等。在项目配置文件（如<code>application.properties</code>或<code>application.yml</code>）中设置数据源，指向ServBay启动的服务地址（例如<code>localhost:3306</code>）。</p>
</li>
</ul>
</li>
<li>
<p><strong>项目开发与调试</strong></p>
<ul>
<li><strong>编码与自动重启</strong>：在IDE（如IntelliJ IDEA）中进行编码。利用Spring Boot DevTools实现应用的热部署，修改代码后保存即可生效，无需手动重启。</li>
<li><strong>运行与调试</strong>：可以直接在IDE中运行或调试<code>DemoApplication</code>类的main方法，启动内嵌的Tomcat服务器。</li>
<li><strong>本地测试</strong>：通过浏览器或API工具（如Postman）访问<code>http://localhost:8080/hello</code>进行测试。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">🐳 Docker 部署流程</h3>
<p>Docker 部署的核心在于创建镜像和运行容器，确保环境一致性。</p>
<ol>
<li>
<p><strong>创建Dockerfile</strong></p>
<p>在项目根目录下创建<code>Dockerfile</code>，用于定义如何构建Docker镜像。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用官方OpenJDK运行时作为基础镜像</span>
FROM openjdk:17-jdk-slim
<span class="hljs-comment"># 设置工作目录</span>
WORKDIR /app
<span class="hljs-comment"># 将Maven构建得到的JAR文件复制到容器中</span>
COPY target/demo-0.0.1-SNAPSHOT.jar app.jar
<span class="hljs-comment"># 声明容器运行时暴露的端口</span>
EXPOSE 8080
<span class="hljs-comment"># 指定容器启动时运行的命令</span>
ENTRYPOINT [<span class="hljs-string">"java"</span>, <span class="hljs-string">"-jar"</span>, <span class="hljs-string">"app.jar"</span>]
</code></pre>
</li>
<li>
<p><strong>构建Docker镜像并运行容器</strong></p>
<ul>
<li>
<p><strong>构建镜像</strong>：在包含<code>Dockerfile</code>的目录下执行命令。<code>-t</code>参数为镜像打标签。</p>
<pre><code class="hljs language-perl" lang="perl">docker build -t <span class="hljs-keyword">my</span>-springboot-app:<span class="hljs-number">1.0</span> .
</code></pre>
</li>
<li>
<p><strong>运行容器</strong>：基于镜像启动一个Docker容器。<code>-p</code>参数将宿主机的8080端口映射到容器的8080端口，<code>-d</code>参数让容器在后台运行。</p>
<pre><code class="hljs language-perl" lang="perl">docker run -d -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> --name <span class="hljs-keyword">my</span>-app-container <span class="hljs-keyword">my</span>-springboot-app:<span class="hljs-number">1.0</span>
</code></pre>
</li>
<li>
<p><strong>验证部署</strong>：访问<code>http://你的服务器IP:8080/hello</code>，应能看到"Hello, Docker!"的响应。</p>
</li>
</ul>
</li>
<li>
<p><strong>进阶部署与管理</strong></p>
<p>对于复杂应用，可能需要连接数据库、Redis等其他服务，可以使用Docker Compose定义和运行多容器应用。如果需要更高的可用性和扩展性，可以进一步使用Kubernetes进行容器编排。</p>
</li>
</ol>
<h3 data-id="heading-2">💡 流程对比与选择建议</h3>
<ul>
<li><strong>追求极致本地开发效率</strong>：选择 <strong>ServBay</strong>。它的开箱即用和快速启动能极大提升你的日常开发效率。</li>
<li><strong>要求环境绝对一致与标准化部署</strong>：选择 <strong>Docker</strong>。特别是在团队协作和CI/CD流程中，Docker能有效避免"在我这儿是好的"这类问题。</li>
<li><strong>大型微服务项目</strong>：通常采用 <strong>混合策略</strong>：在本地，你可能使用类似ServBay的工具快速启动一些基础支撑服务（如注册中心、配置中心），而各个业务微服务则使用Docker进行管理和联调。在生产环境，则全面使用Kubernetes等容器编排平台。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一些经典的3D编辑器开源项目]]></title>    <link>https://juejin.cn/post/7576867727719039011</link>    <guid>https://juejin.cn/post/7576867727719039011</guid>    <pubDate>2025-11-27T00:56:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576867727719039011" data-draft-id="7576689869809860644" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一些经典的3D编辑器开源项目"/> <meta itemprop="keywords" content="前端,three.js,开源"/> <meta itemprop="datePublished" content="2025-11-27T00:56:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="答案answer"/> <meta itemprop="url" content="https://juejin.cn/user/2634865719391869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一些经典的3D编辑器开源项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634865719391869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    答案answer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:56:23.000Z" title="Thu Nov 27 2025 00:56:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>给大家分享一下个人在探索开发three.js编辑器项目期间发现的一些比较不错的<em>3D编辑器</em>类型的开源项目，如果你也正打算做类似相关的项目，那么这些开源项目会是一个不错的参考借鉴</p>
<p>以下排名不分先后🙏🏻</p>
<h3 data-id="heading-1">项目一：Astral3D</h3>
<p><strong>描述</strong>：基于Vue3 + THREE.JS 免费开源的三维引擎及配套编辑器，包含BIM轻量化、CAD解析预览、粒子系统、插件系统等功能。</p>
<p><strong>特点</strong>：强大的3D场景内容元素的编辑和保存功能和丰富多样的3D元素内容，同时支持<em>BIM</em>和<em>CAD</em>等工业建模文件的加载渲染</p>
<p><strong>注意⚠️</strong>：项目是<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmlt131220%2FAstral3D%2Ftree%2Fdevelop%23" target="_blank" title="https://github.com/mlt131220/Astral3D/tree/develop#" ref="nofollow noopener noreferrer">Apache-2.0 license</a> 的开源协议，项目作者本人也声明了项目可用于个人<em>学习</em>，如有商用需要向作者申请<em>商用授权</em></p>
<p><strong>界面</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b79826972c3f4c10baebcdb99e75a29d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809783&amp;x-signature=ZDSFUifhetAhWVb71frxvYTmnFk%3D" alt="image.png" loading="lazy"/></p>
<p><strong>在线地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Feditor.astraljs.com%2F%23%2F" target="_blank" title="https://editor.astraljs.com/#/" ref="nofollow noopener noreferrer">editor.astraljs.com/#/</a></p>
<p><strong>Github</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmlt131220%2FAstral3D" target="_blank" title="https://github.com/mlt131220/Astral3D" ref="nofollow noopener noreferrer">github.com/mlt131220/A…</a></p>
<h3 data-id="heading-2">项目二：thebrowserlab</h3>
<p><strong>描述</strong>：一个「运行在浏览器里的 3D 编辑器 + 创意编码 (creative-coding) 环境」</p>
<p><strong>特点</strong>：支持加载视频、文本、图片、粒子等内容并提供了丰富的编辑表单参数可视化编辑配置，同时还支持在线代码的<em>脚本</em>内容写入设置3D场景内容。</p>
<p><strong>注意⚠️</strong>：项目使用 <em>MIT 授权 (MIT license)</em>，意味着你可以自由地 fork、修改、商用 (遵守 MIT 即可)</p>
<p><strong>界面</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/717acb5f1f4d4e78a454e02310932ea9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809783&amp;x-signature=Sq0yWqTtey%2BL90idrw50MxYDO%2B8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>在线地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fthebrowserlab.com%2F" target="_blank" title="https://thebrowserlab.com/" ref="nofollow noopener noreferrer">thebrowserlab.com/</a></p>
<p><strong>Github</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ficurtis1%2Fthebrowserlab" target="_blank" title="https://github.com/icurtis1/thebrowserlab" ref="nofollow noopener noreferrer">github.com/icurtis1/th…</a></p>
<h3 data-id="heading-3">项目三：threepipe</h3>
<p><strong>描述</strong>：一个基于 Three.js 构建的现代 3D 框架</p>
<p><strong>特点</strong>：项目基于了Three.js进行了二次封装，提供了不少高级功能，使其适合从简单 3D 模型预览到复杂 交互 / 渲染应用，通过简单的API 使用就可以快速创建复杂的3D模型预览器，模型编辑器等内容。</p>
<p><strong>注意⚠️</strong>：既然是封装好的框架，在享受使用的便利时，新的学习成本也是不可避免的，项目使用 <em>Apache-2.0-1</em>协议，商用也许需要授权，不过毕竟是<em>歪果仁</em>开发的，即使未授权也难以知晓</p>
<p><strong>界面</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f327f0f04f54440f8c2126c58872d2fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809783&amp;x-signature=lrVPX6kfFmV%2F8cGpDWRgLjz%2FzQE%3D" alt="image.png" loading="lazy"/>
<strong>在线地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Feditor.threepipe.org%2F" target="_blank" title="https://editor.threepipe.org/" ref="nofollow noopener noreferrer">editor.threepipe.org/</a></p>
<p><strong>Github</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frepalash%2Fthreepipe" target="_blank" title="https://github.com/repalash/threepipe" ref="nofollow noopener noreferrer">github.com/repalash/th…</a></p>
<h3 data-id="heading-4">项目四：ShadowEditor</h3>
<p><strong>描述</strong>：基于Three.js、Go语言和MongoDB的跨平台的3D场景编辑器，支持桌面版和Web版。</p>
<p><strong>特点</strong>：跨平台的支持 Windows / Linux / Mac，在桌面 (desktop) 和浏览器 (web) 中都能运行，前后端一体的项目</p>
<p><strong>注意⚠️</strong>：使用 MIT 许可证的项目，可以自由用于学习、实验或商业用途。从界面不难看出，应该是属于上古时期的项目了，three.js版本也是107的。作者也推出了商业版的，如有需要也可以试用一下商业版的</p>
<p><strong>界面</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/561593a43cdb4bd2a8246c45f6bfc95f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809783&amp;x-signature=Fj7jlCvptv0BLayeDr8Oj9avjKo%3D" alt="image.png" loading="lazy"/>
<strong>在线地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.hylab.cn%2Fshadoweditor%2F" target="_blank" title="https://www.hylab.cn/shadoweditor/" ref="nofollow noopener noreferrer">www.hylab.cn/shadowedito…</a></p>
<p><strong>Github</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftengge1%2FShadowEditor" target="_blank" title="https://gitee.com/tengge1/ShadowEditor" ref="nofollow noopener noreferrer">gitee.com/tengge1/Sha…</a></p>
<h3 data-id="heading-5">项目五：three-editor</h3>
<p><strong>描述</strong>：一个基于 Three.js 的 可视化 / 低代码 3D 编辑器 / 内核／框架。它的目标是降低使用 Three.js 的门槛，让构建 Web 3D 场景更简单、更迅速</p>
<p><strong>特点</strong>：提供了一整套“可视化 + 配置 + 编辑 + 渲染”的能力，使得即使不深入了解 Three.js，也能快速构建 3D 场景 / 项目，：如果你只是想在网页中展示某个 3D 模型、场景或交互，而不想编写大量 Three.js boilerplate，three-editor 能极大降低门槛</p>
<p><strong>注意⚠️</strong>：因为场景内容都是封装处理好的，提供的可编辑参数内容配置并不多，如果你的<em>自定义需求</em>很多的话使用这个项目前需要谨慎考虑一下</p>
<p><strong>界面</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88723f8d940a45ec9e7a335485624d04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809783&amp;x-signature=rqkppAEhbeEhjbYYtlWQGqrgSp0%3D" alt="image.png" loading="lazy"/></p>
<p><strong>在线地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fz2586300277.github.io%2Fthreejs-editor%2F" target="_blank" title="https://z2586300277.github.io/threejs-editor/" ref="nofollow noopener noreferrer">z2586300277.github.io/threejs-edi…</a></p>
<p><strong>Github</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fz2586300277%2Fthree-editor" target="_blank" title="https://github.com/z2586300277/three-editor" ref="nofollow noopener noreferrer">github.com/z2586300277…</a></p>
<h3 data-id="heading-6">项目六：scene-editor</h3>
<p><strong>描述</strong>：vis-three/scene-editor 是基于 vis-three 框架构建的 —— vis-three 本身是一个封装自 Three.js 的前端 3D 开发框架，用于简化 Web3D 开发</p>
<p><strong>特点</strong>：基于vis-three 衍生开发的一个3D编辑器提供了一套较为完整的 Web 3D 场景编辑功能 — 目标是让你即使对 3D 或 Three.js 不熟，也能比较轻松地 “拖／配／编辑” 出一个 3D 场景</p>
<p><strong>注意⚠️</strong>：仓库地址的代码是Vue3项目编译打包后的，作者并没有直接提供Vue3项目的源代码，如果有二次开发需求，无法直接性修改源代码</p>
<p><strong>界面</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f1f952087f345e4881f38fd1c707598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809783&amp;x-signature=EI5ga8BnHkMuVo5bclwJsCubR3A%3D" alt="image.png" loading="lazy"/></p>
<p><strong>在线地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fz2586300277.github.io%2Fthreejs-editor%2F" target="_blank" title="https://z2586300277.github.io/threejs-editor/" ref="nofollow noopener noreferrer">z2586300277.github.io/threejs-edi…</a></p>
<p><strong>Github</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FShiotsukikaedesari%2Fvis-three" target="_blank" title="https://github.com/Shiotsukikaedesari/vis-three" ref="nofollow noopener noreferrer">github.com/Shiotsukika…</a></p>
<p><strong>Gitee</strong>:<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fvis-three%2Fscene-editor" target="_blank" title="https://gitee.com/vis-three/scene-editor" ref="nofollow noopener noreferrer">gitee.com/vis-three/s…</a></p>
<h3 data-id="heading-7">项目七： three.js官方编辑器</h3>
<p><strong>描述</strong>：<strong>Three.js</strong>（著名的 WebGL / Web 3D 渲染库）自带 / 官方提供的可视化编辑器，接触过three.js的应该都知道吧</p>
<p><strong>特点</strong>：<em>3D编辑器</em>的鼻祖了也是唯一一个能和three.js最新版本保持随时同步的编辑器，很多现有的商业项目和开源项目的功能，或多或少都参考了这个项目去实现的</p>
<p><strong>注意⚠️</strong>：使用原生js 去实现的，二次开发和扩展功能成本较大</p>
<p><strong>界面</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e46ab1d2f05f4f25962957b593625227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809783&amp;x-signature=dXpE0ZGIUkfDJfISc3o4pV8%2FH80%3D" alt="image.png" loading="lazy"/></p>
<p><strong>在线地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Feditor%2F" target="_blank" title="https://threejs.org/editor/" ref="nofollow noopener noreferrer">threejs.org/editor/</a></p>
<p><strong>Github</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmrdoob%2Fthree.js%2Ftree%2Fmaster%2Feditor" target="_blank" title="https://github.com/mrdoob/three.js/tree/master/editor" ref="nofollow noopener noreferrer">github.com/mrdoob/thre…</a></p>
<h3 data-id="heading-8">项目八： threejs-3dmodel-edit</h3>
<p><strong>描述</strong>：一个基于 <strong>Three.js + Vue 3 + TypeScript + Pinia</strong> 的前端 3D 模型编辑器 / 可视化编辑平台</p>
<p><strong>特点</strong>：是一个比较完整、现代、易用的 Web-based 3D 模型编辑器 — 它把 Three.js 的功能通过 Vue / TS / Pinia 封装起来，让非专业 3D 建模背景的人也能比较容易地加载 /编辑 /导出 /展示 3D 模型。基于企业级项目代码开发的标准规范，如果你正在开发自己的第一个企业级Three.js 项目那么这个项目的代码设计思路将会是一个不错的参考</p>
<p><strong>注意⚠️</strong>：作者本人的3D开源项目，毛遂自荐一下，哈哈哈哈</p>
<p><strong>界面</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa5958da39aa455a8cdf01a0eaef9232~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809783&amp;x-signature=dN7pyKTbYzNAHoZwn6tOAd3pvVk%3D" alt="image.png" loading="lazy"/></p>
<p><strong>在线地址</strong>：<a href="https://link.juejin.cn?target=http%3A%2F%2Fthreeflowx.cn%2Fopen%2F%23%2F" target="_blank" title="http://threeflowx.cn/open/#/" ref="nofollow noopener noreferrer">threeflowx.cn/open/#/</a></p>
<p><strong>Github</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhangbo126%2Fthreejs-3dmodel-edit" target="_blank" title="https://github.com/zhangbo126/threejs-3dmodel-edit" ref="nofollow noopener noreferrer">github.com/zhangbo126/…</a></p>
<p><strong>Gitee</strong>:<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FZHANG_6666%2FThree.js3D" target="_blank" title="https://gitee.com/ZHANG_6666/Three.js3D" ref="nofollow noopener noreferrer">gitee.com/ZHANG_6666/…</a></p>
<h2 data-id="heading-9">结语</h2>
<p>ok以上就是作者本人已知的一些不错的开源3D编辑器合集了，如果你还知道一些好的3D编辑器项目欢迎<em>评论区</em>补充</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[超越YOLOv8/v11！自研RKM-YOLO为输电线路巡检精度、速度双提升]]></title>    <link>https://juejin.cn/post/7576907627016994867</link>    <guid>https://juejin.cn/post/7576907627016994867</guid>    <pubDate>2025-11-27T00:58:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576907627016994867" data-draft-id="7576863819982487561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="超越YOLOv8/v11！自研RKM-YOLO为输电线路巡检精度、速度双提升"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2025-11-27T00:58:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            超越YOLOv8/v11！自研RKM-YOLO为输电线路巡检精度、速度双提升
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-27T00:58:13.000Z" title="Thu Nov 27 2025 00:58:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>输电线路作为电力系统的关键组成部分，其正常运行对电网稳定性至关重要。绝缘子和防震锤等关键部件长期暴露在恶劣环境中，易受冰损、风损、酸雨和雷击等不利因素影响，引发故障。</p>
<p>传统人工巡检不仅耗时费力，还容易出现漏检或误检情况。直升机巡检虽覆盖范围广，但成本高昂且受天气影响大。无人机巡检技术凭借其覆盖范围广、效率高、安全性好和成本低等优势，正逐渐成为主流检测方法。</p>
<p>然而，无人机巡检会产生大量航拍图像，依赖人工识别效率低下且可能引入人为误差。现有深度学习算法在检测多尺度、不规则小目标时仍面临挑战，特别是在复杂环境中特征丢失导致检测精度下降的问题。无人机对输电线路进行巡检已成为保障电力供应系统可靠运行的关键手段。然而，环境的复杂性常常导致设备故障定位困难和维护延迟，直接影响电力供应安全。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/144ad4f6a11b48c78653cae320c92e33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=fm%2BH%2BJp1VZJr56qlT2qHODZ2Vjg%3D" alt="图片1.png" loading="lazy"/></p>
<blockquote>
<p><strong>论文标题：</strong></p>
<p>A lightweight RKM-YOLO algorithm for transmission line fault inspection</p>
<p><strong>论文链接：</strong></p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sciencedirect.com%2Fscience%2Farticle%2Fpii%2FS2352484725004494" target="_blank" title="https://www.sciencedirect.com/science/article/pii/S2352484725004494" ref="nofollow noopener noreferrer">www.sciencedirect.com/science/art…</a></strong></p>
</blockquote>
<h2 data-id="heading-0"><strong>引言</strong></h2>
<p>为解决这些挑战，我们提出了一种基于改进版YOLOv8n的轻量化算法——RKM-YOLO，该算法在精度和效率方面均取得了显著提升。</p>
<p>上述算法提供了重大改进；然而，它们在检测多尺度和不规则小目标方面仍然面临挑战。在训练过程中，边缘信息、灰度信息和其他特征可能会丢失，导致小物体检测的准确性降低，误报的可能性增加。此外，现有缺陷检测方法在复杂环境中的效率仍然有限，从而限制了模型的泛化能力。因此，我们开发了RKM-YOLO算法，这是YOLOv8的改进版本，用于检测传输线组件的缺陷。本文的主要贡献如下：</p>
<ul>
<li>首先，介绍了RFCAConv模块，该模块集成了接收场空间注意机制和坐标注意机制。这解决了卷积层中参数共享导致的局部特征提取不足的问题。</li>
<li>建议使用K3_RFCA模块。通过利用有效的注意力加权，该模块将多层处理的深层特征与低级浅特征相结合，允许骨干网络同时捕获本地和全球多尺度信息，从而增强骨干网络的特征提取能力。</li>
<li>为了提高传输线中多目标物体的检测能力，我们设计了一个轻量级特征融合网络（KBiFPN），以改善判别特征的提取。拟议的结构有效地捕获了关键特征通道，并通过元素乘法机制增强了特征相关性，从而产生了更准确的特征图。这在不影响准确性的情况下，显著降低了模型的参数计数。</li>
<li>我们设计了一个多尺度多维注意力模块（MMCA）。MMCA利用不同尺度的深度可分离卷积来捕获多尺度的本地和全球信息，增强模型对细节和远程依赖性的感知。通过使用自适应加权策略来动态调整通道特征的权重，模型可以自适应地加强对关键通道特征的关注，同时抑制无关信息。</li>
</ul>
<h2 data-id="heading-1"><strong>RKM-YOLO的整体架构</strong></h2>
<p>在这项研究中，我们改进了YOLOv8模型，以解决检测小目标、多尺度目标和复杂背景的挑战。具体来说，我们设计了RKM-YOLO来提高其识别输电线路组件缺陷的能力。改进后的YOLO网络的结构如图所示。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6656fbec85c24f94b59c4698c2d409bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=hAxYrwmAlICnJRcZLVE9KhjDmLI%3D" alt="图片2.png" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>RKM-YOLO算法核心创新</strong></h2>
<ul>
<li><strong>感受野通道注意力卷积（RFCAConv）模块</strong></li>
</ul>
<p>在复杂输电线路巡检场景中，光折射常导致骨干网络在特征提取过程中引入大量噪声，干扰图像中的长程依赖关系。我们引入RFCAConv模块，使网络能够为每个感受野生成特定权重，更精准地学习图像中的局部特征。</p>
<p>该模块通过分组卷积提取丰富的感受野特征，结合坐标注意力机制将位置信息嵌入到通道注意力中，显著提升了模块捕获空间依赖关系的能力。RFCAConv对输入特征重新加权，有效减少由输电线路噪声引起的长程依赖干扰。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4bdf6a10ebf438f8650689d5df6d860~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=1%2BMvynnGffj9a3NW3Wg5j5%2BwFmA%3D" alt="图片3.png" loading="lazy"/></p>
<ul>
<li><strong>K3-RFCA结构</strong></li>
</ul>
<p>我们设计了K3-RFCA结构，该结构继承了C2f模块的梯度流机制，同时增强了局部特征捕获能力。通过用RFCAConv替换传统的bottleneck，网络的特征提取能力得到显著增强。</p>
<p>K3-RFCA模块采用双并行1×1卷积分支设计，在保持高效特征表示的同时，从输入特征中高效提取信息。通过逐层的RFCAConv卷积梯度流，模型可以更深入地提取有用特征，确保不同层级的特征表示能有效捕获输入图像中的丰富信息。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a05c4ca596b04f60bf6b535ff43c807f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=RWB%2FA4caI0qYA5Cto9hZtczlfv4%3D" alt="图片4.png" loading="lazy"/></p>
<ul>
<li><strong>改进的KBiFPN特征融合网络</strong></li>
</ul>
<p>在特征融合阶段，我们提出了一种优化的KBiFPN结构。该结构将BiFPN输出层的数量从五个减少到三个，通过优化层配置降低了特征冗余，提高了特征融合效率。</p>
<p>我们引入StarNet的核心组件——Star块，通过逐元素乘法运算将输入特征映射到高维非线性特征空间，使得特征聚合更加有效。受益于Star块的轻量化设计，KBiFPN在显著减少参数数量的同时，提升了整体性能。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a4168c191bb4affb77da1f0126ca56a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=qK4W1msTMjo1B%2Fv2PhQfC%2FMVDHM%3D" alt="图片5.png" loading="lazy"/></p>
<ul>
<li><strong>多尺度多维协同注意力（MMCA）机制</strong></li>
</ul>
<p>为解决输电线路巡检中的小目标检测问题，我们提出了创新的多尺度多维协同注意力机制。MMCA整合了多尺度卷积注意力模块在多尺度特征提取方面的优势，使其能够在低背景干扰下同时捕获多个尺度的细粒度和全局信息。</p>
<p>该模块利用不同尺度的深度可分离卷积来捕获多尺度局部和全局信息，增强模型对细节和长程依赖的感知。通过自适应加权策略动态调整通道特征的权重，模型能够自适应地强化对关键通道特征的关注，同时抑制无关信息。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4476fe6dd2a34ce583b55ee7225eaf54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=PooJ178H4rASsTO8pWzExQM5vCM%3D" alt="图片6.png" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>实验成果与性能对比</strong></h2>
<p>实验结果表明，RKM-YOLO在多个关键指标上均表现出色：</p>
<ul>
<li>平均检测精度（mAP）达到90.7%</li>
<li>模型参数减少了18.27%</li>
<li>召回率和mAP50分别提升了3.1%</li>
<li>检测速度完全满足无人机巡检的实时要求</li>
</ul>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/309f61b39fe74b2797ac3a5028fcb84c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=mxFUIBNoEpeJFjTaUBZfyQq4HbQ%3D" alt="图片7.png" loading="lazy"/></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48a3bab28ffa43bc870ce91b9706008e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=2H%2Fju%2F4brEmZiWTOgzZhdBi3dfU%3D" alt="图片8.png" loading="lazy"/></p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f910f985cd9b4295b32cf6275d857115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=KbH0wpQKi8qni7kqERl%2F3thm8NI%3D" alt="图片9.png" loading="lazy"/></p>
<p>与现有算法对比，我们的方法在小目标检测场景中表现尤为突出：</p>
<ul>
<li>绝缘子损伤识别准确率：89.7%</li>
<li>闪络检测准确率：87.5%</li>
<li>防震锤监测准确率：88.9%</li>
<li>腐蚀评估准确率：89.5%</li>
</ul>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db544854f2e5456799b0303bed507c09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=WHGhcKnhlXlz97QYJbB3yBISBt8%3D" alt="图片10.png" loading="lazy"/></p>
<p>在各种复杂场景下的可视化结果也证明，我们的改进模型有效解决了无人机航拍场景中小目标检测的挑战，在精度和鲁棒性方面均优于YOLOv5、YOLOv8和YOLOv11等算法，成功克服了漏检和误检问题。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5227353f7174b91894d2c1cb91edc0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764809893&amp;x-signature=sEdHdioXGz02ePQxawG6gaMV9io%3D" alt="图片11.png" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>结论</strong></h2>
<p>RKM-YOLO算法通过引入RFCAConv模块、K3-RFCA结构、KBiFPN特征融合网络和MMCA注意力机制，有效解决了输电线路巡检中小目标检测的难题。该算法在保持高精度的同时显著减少了参数数量，实现了精度与效率的良好平衡。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（149）Redis的监控指标有哪些？]]></title>    <link>https://juejin.cn/post/7576877687571644416</link>    <guid>https://juejin.cn/post/7576877687571644416</guid>    <pubDate>2025-11-26T23:04:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576877687571644416" data-draft-id="7576877687571628032" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（149）Redis的监控指标有哪些？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-26T23:04:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（149）Redis的监控指标有哪些？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T23:04:38.000Z" title="Wed Nov 26 2025 23:04:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>监控Redis的性能和运行状态是非常重要的，特别是在生产环境中。常见的监控指标包括内存使用情况、CPU使用情况、连接数、命中率、慢查询等。我们可以通过Redis自带的<code>INFO</code>命令来获取这些信息，并使用Java代码来收集和展示这些监控指标。以下是详细的介绍和代码示例。</p>
<h3 data-id="heading-0">1. 重要的监控指标</h3>
<p>以下是一些重要的Redis监控指标：</p>
<ul>
<li>
<p><strong>内存使用情况</strong>：</p>
<ul>
<li><code>used_memory</code>：Redis已经使用的内存总量。</li>
<li><code>used_memory_rss</code>：从操作系统角度看到的内存使用量。</li>
<li><code>used_memory_peak</code>：峰值内存使用量。</li>
</ul>
</li>
<li>
<p><strong>CPU使用情况</strong>：</p>
<ul>
<li><code>used_cpu_sys</code>：Redis服务器所使用的系统CPU时间。</li>
<li><code>used_cpu_user</code>：Redis服务器所使用的用户CPU时间。</li>
</ul>
</li>
<li>
<p><strong>连接数</strong>：</p>
<ul>
<li><code>connected_clients</code>：当前连接到Redis服务器的客户端数量。</li>
<li><code>blocked_clients</code>：因为BLPOP、BRPOP等命令阻塞的客户端数量。</li>
</ul>
</li>
<li>
<p><strong>命中率</strong>：</p>
<ul>
<li><code>keyspace_hits</code>：查找成功的次数。</li>
<li><code>keyspace_misses</code>：查找失败的次数。</li>
</ul>
</li>
<li>
<p><strong>慢查询</strong>：</p>
<ul>
<li><code>slowlog</code>：记录执行时间超过设定阈值的命令。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-1">2. 使用Java代码获取和展示监控指标</h3>
<p>我们可以使用Jedis库来连接Redis服务器，并通过<code>INFO</code>命令获取监控信息。</p>
<h4 data-id="heading-2">依赖</h4>
<p>在<code>pom.xml</code>中添加Jedis依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">3. 代码示例</h3>
<p>以下是一个Java代码示例，用于获取和展示Redis的监控指标。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisMonitor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">REDIS_HOST</span> <span class="hljs-operator">=</span> <span class="hljs-string">"localhost"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REDIS_PORT</span> <span class="hljs-operator">=</span> <span class="hljs-number">6379</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(REDIS_HOST, REDIS_PORT)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info();

            Map&lt;String, String&gt; infoMap = parseInfo(info);
            printInfo(infoMap);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, String&gt; <span class="hljs-title function_">parseInfo</span><span class="hljs-params">(String info)</span> {
        Map&lt;String, String&gt; infoMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        String[] lines = info.split(<span class="hljs-string">"\n"</span>);
        <span class="hljs-keyword">for</span> (String line : lines) {
            <span class="hljs-keyword">if</span> (line.contains(<span class="hljs-string">":"</span>)) {
                String[] keyValue = line.split(<span class="hljs-string">":"</span>);
                infoMap.put(keyValue[<span class="hljs-number">0</span>], keyValue[<span class="hljs-number">1</span>].trim());
            }
        }
        <span class="hljs-keyword">return</span> infoMap;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printInfo</span><span class="hljs-params">(Map&lt;String, String&gt; infoMap)</span> {
        System.out.println(<span class="hljs-string">"Memory Usage:"</span>);
        System.out.println(<span class="hljs-string">"Used Memory: "</span> + infoMap.get(<span class="hljs-string">"used_memory"</span>));
        System.out.println(<span class="hljs-string">"Used Memory RSS: "</span> + infoMap.get(<span class="hljs-string">"used_memory_rss"</span>));
        System.out.println(<span class="hljs-string">"Used Memory Peak: "</span> + infoMap.get(<span class="hljs-string">"used_memory_peak"</span>));

        System.out.println(<span class="hljs-string">"\nCPU Usage:"</span>);
        System.out.println(<span class="hljs-string">"Used CPU Sys: "</span> + infoMap.get(<span class="hljs-string">"used_cpu_sys"</span>));
        System.out.println(<span class="hljs-string">"Used CPU User: "</span> + infoMap.get(<span class="hljs-string">"used_cpu_user"</span>));

        System.out.println(<span class="hljs-string">"\nConnections:"</span>);
        System.out.println(<span class="hljs-string">"Connected Clients: "</span> + infoMap.get(<span class="hljs-string">"connected_clients"</span>));
        System.out.println(<span class="hljs-string">"Blocked Clients: "</span> + infoMap.get(<span class="hljs-string">"blocked_clients"</span>));

        System.out.println(<span class="hljs-string">"\nCache Hits and Misses:"</span>);
        System.out.println(<span class="hljs-string">"Keyspace Hits: "</span> + infoMap.get(<span class="hljs-string">"keyspace_hits"</span>));
        System.out.println(<span class="hljs-string">"Keyspace Misses: "</span> + infoMap.get(<span class="hljs-string">"keyspace_misses"</span>));

        <span class="hljs-comment">// Here you can add more metrics as needed</span>
    }
}
</code></pre>
<h3 data-id="heading-4">4. 代码说明</h3>
<ol>
<li>
<p><strong>依赖配置</strong>：首先在<code>pom.xml</code>中添加Jedis依赖。</p>
</li>
<li>
<p><strong>连接Redis服务器</strong>：通过Jedis客户端连接到Redis服务器。</p>
</li>
<li>
<p><strong>获取监控信息</strong>：使用<code>jedis.info()</code>命令获取Redis服务器的监控信息。</p>
</li>
<li>
<p><strong>解析和展示监控信息</strong>：</p>
<ul>
<li>将<code>INFO</code>命令返回的字符串解析成键值对。</li>
<li>根据需要展示的监控指标，提取相应的信息并打印到控制台。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">5. 进一步优化</h3>
<p>为了更好地监控Redis服务器，可以进行以下优化：</p>
<ul>
<li><strong>定时任务</strong>：可以使用定时任务（如<code>ScheduledExecutorService</code>）定期获取和展示监控信息。</li>
<li><strong>可视化工具</strong>：将监控数据发送到可视化工具如Grafana进行展示。</li>
<li><strong>报警系统</strong>：当某些指标超过预设的阈值时，触发报警机制。</li>
</ul>
<h3 data-id="heading-6">6. 使用定时任务示例</h3>
<p>以下是一个使用定时任务定期获取和展示Redis监控信息的示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisMonitor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">REDIS_HOST</span> <span class="hljs-operator">=</span> <span class="hljs-string">"localhost"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REDIS_PORT</span> <span class="hljs-operator">=</span> <span class="hljs-number">6379</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);

        scheduler.scheduleAtFixedRate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(REDIS_HOST, REDIS_PORT)) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info();

                    Map&lt;String, String&gt; infoMap = parseInfo(info);
                    printInfo(infoMap);
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    e.printStackTrace();
                }
            }
        }, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);  <span class="hljs-comment">// 每10秒获取一次监控信息</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, String&gt; <span class="hljs-title function_">parseInfo</span><span class="hljs-params">(String info)</span> {
        Map&lt;String, String&gt; infoMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        String[] lines = info.split(<span class="hljs-string">"\n"</span>);
        <span class="hljs-keyword">for</span> (String line : lines) {
            <span class="hljs-keyword">if</span> (line.contains(<span class="hljs-string">":"</span>)) {
                String[] keyValue = line.split(<span class="hljs-string">":"</span>);
                infoMap.put(keyValue[<span class="hljs-number">0</span>], keyValue[<span class="hljs-number">1</span>].trim());
            }
        }
        <span class="hljs-keyword">return</span> infoMap;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printInfo</span><span class="hljs-params">(Map&lt;String, String&gt; infoMap)</span> {
        System.out.println(<span class="hljs-string">"Memory Usage:"</span>);
        System.out.println(<span class="hljs-string">"Used Memory: "</span> + infoMap.get(<span class="hljs-string">"used_memory"</span>));
        System.out.println(<span class="hljs-string">"Used Memory RSS: "</span> + infoMap.get(<span class="hljs-string">"used_memory_rss"</span>));
        System.out.println(<span class="hljs-string">"Used Memory Peak: "</span> + infoMap.get(<span class="hljs-string">"used_memory_peak"</span>));

        System.out.println(<span class="hljs-string">"\nCPU Usage:"</span>);
        System.out.println(<span class="hljs-string">"Used CPU Sys: "</span> + infoMap.get(<span class="hljs-string">"used_cpu_sys"</span>));
        System.out.println(<span class="hljs-string">"Used CPU User: "</span> + infoMap.get(<span class="hljs-string">"used_cpu_user"</span>));

        System.out.println(<span class="hljs-string">"\nConnections:"</span>);
        System.out.println(<span class="hljs-string">"Connected Clients: "</span> + infoMap.get(<span class="hljs-string">"connected_clients"</span>));
        System.out.println(<span class="hljs-string">"Blocked Clients: "</span> + infoMap.get(<span class="hljs-string">"blocked_clients"</span>));

        System.out.println(<span class="hljs-string">"\nCache Hits and Misses:"</span>);
        System.out.println(<span class="hljs-string">"Keyspace Hits: "</span> + infoMap.get(<span class="hljs-string">"keyspace_hits"</span>));
        System.out.println(<span class="hljs-string">"Keyspace Misses: "</span> + infoMap.get(<span class="hljs-string">"keyspace_misses"</span>));

        System.out.println(<span class="hljs-string">"===================================="</span>);
    }
}
</code></pre>
<p>通过上述方法，可以持续监控Redis的运行状态，确保其稳定高效地运行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[INFINI Labs 产品更新 - Coco AI v0.9 与 Easysearch v2.0 全新功能上线，全面支持 GitLab 合并请求（MR）自动]]></title>    <link>https://juejin.cn/post/7576888607479873555</link>    <guid>https://juejin.cn/post/7576888607479873555</guid>    <pubDate>2025-11-26T16:23:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576888607479873555" data-draft-id="7576888607479857171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="INFINI Labs 产品更新 - Coco AI v0.9 与 Easysearch v2.0 全新功能上线，全面支持 GitLab 合并请求（MR）自动 "/> <meta itemprop="keywords" content="产品,数据库,人工智能"/> <meta itemprop="datePublished" content="2025-11-26T16:23:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="极限实验室"/> <meta itemprop="url" content="https://juejin.cn/user/1258294223312599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            INFINI Labs 产品更新 - Coco AI v0.9 与 Easysearch v2.0 全新功能上线，全面支持 GitLab 合并请求（MR）自动 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1258294223312599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    极限实验室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T16:23:35.000Z" title="Wed Nov 26 2025 16:23:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50010a739ffa4d92a1e4534033812f3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=Omn9GHDmZnw%2BAtDo54XoC4Dk9Kk%3D" alt="release" loading="lazy"/></p>
<p>INFINI Labs 产品更新发布！此次更新主要包括：Coco AI v0.9 全面支持 GitLab 合并请求（MR）自动 AI Review，并重构为插件流水线架构，新增 Neo4j、MongoDB 等 10+ 数据源连接器，开启“AI+开发”协同新范式；Easysearch v2.0 正式发布，内置轻量级管理 UI，无需依赖 Kibana，实现集群“开箱即管”，Lucene 升级至 9.12.2，性能全面提升；INFINI Console、Gateway、Agent、Loadgen v1.30 统一基于 Framework v1.3 升级，全面支持 Easysearch 2.0 与 OpenSearch 3.x，新增百分比聚合、子目录代理等关键能力。详情见 Release Notes。</p>
<h2 data-id="heading-0">Coco AI v0.9</h2>
<p>Coco AI 是一款完全开源、跨平台的企业级智能搜索与助手系统，专为现代企业打造。它通过统一搜索入口，连接企业内外部的异构数据源，融合大模型能力，帮助团队高效访问知识，智能决策协作。</p>
<p>Coco AI 本次详细更新记录如下：</p>
<h3 data-id="heading-1">Coco AI 客户端 v0.9</h3>
<h3 data-id="heading-2">🚀 功能特性 (Features)</h3>
<ul>
<li>feat: 支持通过快捷键切换分组 #911</li>
<li>feat: 支持从设置页面打开日志文件夹</li>
<li>feat: 支持使用 home 和 end 键移动光标</li>
<li>feat: 支持使用 page up 和 page down 键移动选中条</li>
<li>feat: 规范化多级菜单的标签结构</li>
<li>feat: 当父插件类型为 Extension 时，搜索父插件可以搜到子插件</li>
<li>feat: 支持使用 modifier key 和回车对话 AI 助手</li>
<li>feat: 允许在光标位于开头时返回</li>
<li>feat(插件兼容性): 插件描述文件添加 minimum_coco_version 字段进行版本检查</li>
<li>feat: 实现紧凑窗口模式</li>
<li>feat: 实现设置项搜索延迟和本地搜索结果权重</li>
<li>feat: 添加主窗口透明度设置</li>
<li>feat: 添加从默认模式回答紧凑模式的延迟设置</li>
</ul>
<h3 data-id="heading-3">✈️ 改进优化 (Improvements)</h3>
<ul>
<li>refactor: 优化搜索结果的排序逻辑 #910</li>
<li>style: 为图片添加深色投影 #912</li>
<li>chore: 为 Web 组件添加跨域配置 #921</li>
<li>refactor: 若 AXUIElementSetAttributeValue() 失败则进行重试 #924</li>
<li>refactor(calculator): 若表达式为 "num =&gt; num" 格式则跳过计算 #929</li>
<li>chore: 使用自定义日志目录 #930</li>
<li>chore: 将 tauri_nspanel 升级至 v2.1 #933</li>
<li>refactor: show_coco/hide_coco 现已在 macOS 上改用 NSPanel 的相关方法 #933</li>
<li>refactor: 将 convert_pages() 流程封装为函数 #934</li>
<li>refactor(post-search): 从每个查询源至少收集 2 份文档 #948</li>
<li>refactor: custom_version_comparator() 现已支持语义化版本比较 #941</li>
<li>chore: 让主窗口垂直居中 #959</li>
<li>refactor(view extension): 通过本地 HTTP 服务器加载 HTML/资源文件 #973</li>
</ul>
<h3 data-id="heading-4">🐛 问题修复(Bug Fixes)</h3>
<ul>
<li>fix: 修复服务列表自动更新的问题 #913</li>
<li>ix: 修复聊天内容重复的问题 #916</li>
<li>fix: 修复固定窗口（Pinned Window）快捷键失效的问题 #917</li>
<li>fix: 修复从另一显示器操作焦点窗口时，窗口管理扩展失效的问题 #919</li>
<li>fix(窗口管理插件): 修复“下一个/上一个桌面”功能失效的问题 #926</li>
<li>fix: 修复页面频繁闪烁的问题 #935</li>
<li>fix(view extension): 修复通过快捷键打开扩展时搜索栏 UI 显示异常的问题 #938</li>
<li>fix: 修复全选文本后无法删除的问题 #943</li>
<li>fix: 修复在聊天和搜索页面之间切换时的抖动问题 #955</li>
<li>fix: 修复重复显示登录成功提示的问题 #977</li>
<li>fix: 修复 Quick AI 无法继续对话的问题 #979</li>
</ul>
<p>Coco App 相关截图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e54860ff099b45349c86424bc04cbb3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=THHdo4tr4rsz7VYr3F%2Fi%2FGGOpZs%3D" alt="" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b8027cd76cd4d88b36cab59a2ab377c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=lLFNB69J0dj%2BL9IDH6WJoBT74%2BA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">Coco AI 服务端 v0.9</h3>
<h3 data-id="heading-6">💥 重大变更(Breaking Changes)</h3>
<ul>
<li>refactor: 将连接器重构为基于流水线（Pipeline）模式 (#545) #545</li>
<li>refactor: 重新实现安全功能；需重新运行设置程序</li>
</ul>
<h3 data-id="heading-7">🚀 功能特性 (Features)</h3>
<ul>
<li>feat: 新增 Neo4j 连接器 #539</li>
<li>feat: 新增内置商店 #551</li>
<li>feat: 基于 RBAC 的安全机制</li>
<li>feat: 用户级数据所有权与共享功能</li>
<li>feat: 管理界面增加权限校验</li>
<li>feat: 新增路由权限验证</li>
<li>feat: 新增用户实体卡片</li>
<li>feat: 文档管理增加视图功能</li>
<li>feat: 新增 Webhooks 管理界面 (#558)</li>
<li>feat: 新增 GitLab 合并事件的 Webhook 处理器</li>
<li>feat: 集成扩展商店</li>
<li>feat: 支持编辑连接器处理器配置</li>
<li>feat: 支持配置 Base Path 以自定义服务端点</li>
<li>feat: 名称字段增加拼音支持</li>
<li>feat: 新增 MongoDB 连接器</li>
</ul>
<h3 data-id="heading-8">🐛 问题修复(Bug Fixes)</h3>
<ul>
<li>fix: 修复切换扩展类型后重置搜索关键词的问题</li>
<li>fix: 修复全屏小部件的相关问题</li>
</ul>
<h3 data-id="heading-9">✈️ 改进优化 (Improvements)</h3>
<ul>
<li>refactor: 为深色模式添加悬停背景效果</li>
<li>chore: 修复文档搜索功能</li>
<li>chore: 格式化日期</li>
<li>refactor: 更新初始值</li>
<li>chore: 修复数据源名称缺失的问题</li>
<li>chore: 安装完成后隐藏弹窗</li>
<li>chore: 基于框架变更进行重构</li>
<li>chore: 为支持深度思考（DeepThink）获取更多文档 #577</li>
<li>chore: 启用搜索后将首页更改为搜索页 #541</li>
<li>chore: 更新搜索 API 以支持查询 DSL #550</li>
<li>chore: 默认按创建时间排序</li>
<li>chore: 调整多语言配置</li>
<li>chore: 用户表单增加确认密码字段</li>
<li>chore: 调整连接器类型</li>
<li>chore: 调整连接器 OAuth 重定向设置</li>
<li>refactor: 为集成功能进行重构</li>
<li>refactor: 移除集成配置中的 Token</li>
<li>chore: 编辑用户时禁用邮箱字段</li>
<li>chore: 调整搜索设置</li>
</ul>
<p>Coco Server 相关截图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55be1af8debb46f5af0d63856d67a9d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=4ytfgD9kfzEJ7kfGtSMeYXemLHg%3D" alt="" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48dcb491f4cb4f2eaedd50eb31f817bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=ZDaAgnwDtMu0g6XACBsRt4qOu7k%3D" alt="" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/718ada6d4db5436b85c18a4118ee9a23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=43sMSyUM3O1MDOeBrdWiut%2FmFAQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">Easysearch v2.0</h2>
<p>INFINI Easysearch 是一个分布式的搜索型数据库，实现非结构化数据检索、全文检索、向量检索、地理位置信息查询、组合索引查询、多语种支持、聚合分析等。Easysearch 可以完美替代 Elasticsearch，同时添加和完善多项企业级功能。Easysearch 助您拥有简洁、高效、易用的搜索体验。</p>
<p>Easysearch 本次更新如下：</p>
<h3 data-id="heading-11">💥 重大变更(Breaking Changes)</h3>
<ul>
<li>正式发布 Easysearch 2.0 版本，底层 Lucene 更新到 9.12.2</li>
<li>新增 ui 插件，为 Easysearch 提供了轻量级界面化管理功能，不再依赖第三方对集群进行管理，真正做到开箱即用</li>
</ul>
<h3 data-id="heading-12">🚀 功能特性 (Features)</h3>
<ul>
<li>兼容 1.15.x 版本的索引，可无缝升级</li>
<li>新增 UI 插件，涵盖从集群，节点，索引，到分片等不同维度的监控和管理功能</li>
<li>支持关闭 security 进入 UI</li>
</ul>
<h3 data-id="heading-13">✈️ 改进优化 (Improvements)</h3>
<ul>
<li>range 查询，按数字类型字段排序，相比旧版本效率大幅提升</li>
</ul>
<p>Easysearch UI 相关截图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f04c3eea87054253806bc5ff83b05df9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=2maBksX7XVrwUoD4e7ARxgHiF68%3D" alt="" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/903af95d8551482995297cddf305f82b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=k%2FuFIwhmCPX2priOlSDoBKafCjU%3D" alt="" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8a3122fc56347a7a2e19ee8ebc3d59d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=LdJWVnzWGUjJkacTQ6PnisyxZmM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">Console v1.30</h2>
<p>INFINI Console 是一款开源的非常轻量级的多集群、跨版本的搜索基础设施统一管控平台。通过对流行的搜索引擎基础设施进行跨版本、多集群的集中纳管，企业可以快速方便的统一管理企业内部的不同版本的多套搜索集群。</p>
<p>Console 本次详细更新记录如下：</p>
<h3 data-id="heading-15">🚀 功能特性 (Features)</h3>
<ul>
<li>feat: 支持百分比聚合</li>
<li>feat: 为初始化管理员用户增加密码强度校验 (#250)</li>
<li>feat: 支持 Nginx 代理下的子目录路径 (#243)</li>
</ul>
<h3 data-id="heading-16">🐛 问题修复(Bug Fixes)</h3>
<ul>
<li>fix: 修复了索引映射 (mapping) 在滚动查询 (scroll) 后不正确的问题 (#248)</li>
<li>fix: 修复索引 mapping 在滚动操作之后不对的问题</li>
<li>fix: 修复集群监控设置显示错误</li>
</ul>
<h3 data-id="heading-17">✈️ 改进优化 (Improvements)</h3>
<ul>
<li>chore: 删除集群后减少 Agent 上报异常错误日志输出 (#258)</li>
<li>此版本包含了底层 Framework v1.3 的更新，解决了一些常见问题，并增强了整体稳定性和性能。虽然 Console 本身没有直接的变更，但从 Framework 中继承的改进间接地使 Console 受益。</li>
</ul>
<h2 data-id="heading-18">Gateway v1.30</h2>
<p>INFINI Gateway 是一个开源的面向搜索场景的高性能数据网关，所有请求都经过网关处理后再转发到后端的搜索业务集群。基于 INFINI Gateway 可以实现索引级别的限速限流、常见查询的缓存加速、查询请求的审计、查询结果的动态修改等等。</p>
<p>Gateway 本次更新如下：</p>
<h3 data-id="heading-19">🚀 功能特性 (Features)</h3>
<ul>
<li>feat(rewrite_to_bulk)：使文档更新兼容 Elasticsearch 6.x (#112)</li>
</ul>
<h3 data-id="heading-20">🐛 问题修复(Bug Fixes)</h3>
<ul>
<li>fix: 修复心跳连接的潜在泄漏问题 (#107)</li>
</ul>
<h3 data-id="heading-21">✈️ 改进优化 (Improvements)</h3>
<ul>
<li>改进 ReverseProxy 的锁机制和节点发现逻辑 (#111)</li>
<li>此版本包含了底层 Framework v1.3 的更新，解决了一些常见问题，并增强了整体稳定性和性能。虽然 Gateway 本身没有直接的变更，但从 Framework 中继承的改进间接地使 Gateway 受益。</li>
</ul>
<h2 data-id="heading-22">Agent v1.30</h2>
<p>INFINI Agent 负责采集和上传 Elasticsearch, Easysearch, Opensearch 集群的日志和指标信息，通过 INFINI Console 管理，支持主流操作系统和平台，安装包轻量且无任何外部依赖，可以快速方便地安装。</p>
<p>Agent 本次更新如下：</p>
<h3 data-id="heading-23">🚀 功能特性 (Features)</h3>
<p>在 Kubernetes 环境下通过环境变量 http.port 探测 Easysearch 的 HTTP 端口</p>
<h3 data-id="heading-24">✈️ 改进优化 (Improvements)</h3>
<ul>
<li>此版本包含了底层 Framework v1.3 的更新，解决了一些常见问题，并增强了整体稳定性和性能。虽然 Agent 本身没有直接的变更，但从 Framework 中继承的改进间接地使 Agent 受益。</li>
</ul>
<h2 data-id="heading-25">Loadgen v1.30</h2>
<p>INFINI Loadgen 是一款开源的专为 Easysearch、Elasticsearch、OpenSearch 设计的轻量级性能测试工具。</p>
<p>Loadgen 本次更新如下：</p>
<h3 data-id="heading-26">✈️ 改进优化 (Improvements)</h3>
<ul>
<li>此版本包含了底层 Framework v1.3 的更新，解决了一些常见问题，并增强了整体稳定性和性能。虽然 Loadgen 本身没有直接的变更，但从 Framework 中继承的改进间接地使 Loadgen 受益。</li>
</ul>
<h2 data-id="heading-27">Framework 1.3.0</h2>
<p>INFINI Framework 是 INFINI Labs 基于 Golang 的产品的核心基础，已开源。该框架以开发者为中心设计，简化了构建高性能、可扩展且可靠的应用程序的过程。</p>
<p>Framework 本次更新如下：</p>
<h3 data-id="heading-28">🚀 功能特性 (Features)</h3>
<ul>
<li>feat: add delete by query v2 #194</li>
<li>feat: support aggregation queries in orm</li>
<li>feat: add support for query_string query</li>
<li>feat: allow to read http request body multi-times #212</li>
<li>feat: add support for Elasticsearch cat allocation API</li>
<li>feat: support custom write operation type for indexing_merge processor</li>
<li>feat: add util to parse time with local timezone #217</li>
<li>feat: add PKCS#12 certificate support for http client config</li>
<li>feat: add security module, with rbac,sharing,oauth client etc.</li>
<li>feat: add entity_card module</li>
<li>feat: add abstract layer for user or teams search</li>
<li>feat: add util to normalize folder path</li>
<li>feat: add some string utils</li>
<li>feat: allow force update all mappings for existing indices</li>
<li>feat: add several http filters</li>
<li>feat: add util to execute http requests via curl</li>
</ul>
<h3 data-id="heading-29">🐛 问题修复 (Bug Fixes)</h3>
<ul>
<li>fix: localhost/127.0.0.1 with noproxy #185</li>
<li>fix: cluster metadata lost #200</li>
<li>fix: fix security permission cache</li>
<li>fix: fix incorrect queue capacity check</li>
</ul>
<h3 data-id="heading-30">✈️ 改进 (Improvements)</h3>
<ul>
<li>chore: less logging for session store change #180</li>
<li>refactor: initialize index schema using index template</li>
<li>chore: add generate secure string util func #183</li>
<li>chore: add validate secure func #184</li>
<li>refactor: refactoring security structs #191</li>
<li>refactor: refactoring schema init logic, disable index based template #188</li>
<li>chore: use safe special chars #190</li>
<li>chore: reduce log with agent #193</li>
<li>chore: add util to register http handler #206</li>
<li>chore: allow access application settings for ui #209</li>
<li>refactor: refactoring query string parser #216</li>
<li>chore: update default fuzziness to 3 #215</li>
<li>chore: avoid using same session name for mulit instances #221</li>
<li>refactor: refactoring pipeline #222</li>
<li>chore: enhance bulk indexing - stricter offset validation and improved error handling #224</li>
<li>refactor: refactoring http utils #226</li>
<li>refactor: refactoring search response, add score support</li>
<li>refactor: refactoring ORM module, add generic security hooks</li>
<li>refactor: add boolean query to orm query builder</li>
<li>refactor: refactoring access_token, simplify login info</li>
<li>refactor: move RegisterAllowOriginFunc to core</li>
</ul>
<p>更多详情请查看以下各产品的 Release Notes 或联系我们的技术支持团队！</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fcoco-app%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/coco-app/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>Coco AI App</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fcoco-server%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/coco-server/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>Coco AI Server</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Feasysearch%2Fmain%2Fdocs%2Frelease-notes%2Feasysearch%2F" target="_blank" title="https://docs.infinilabs.com/easysearch/main/docs/release-notes/easysearch/" ref="nofollow noopener noreferrer"><strong>INFINI Easysearch</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fgateway%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/gateway/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Gateway</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fconsole%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/console/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Console</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fagent%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/agent/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Agent</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Floadgen%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/loadgen/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Loadgen</strong></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Fframework%2Fmain%2Fdocs%2Frelease-notes%2F" target="_blank" title="https://docs.infinilabs.com/framework/main/docs/release-notes/" ref="nofollow noopener noreferrer"><strong>INFINI Framework</strong></a></li>
</ul>
<h2 data-id="heading-31">期待反馈</h2>
<p>欢迎下载体验使用，如果您在使用过程中遇到如何疑问或者问题，欢迎前往 INFINI Labs Github（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs" target="_blank" title="https://github.com/infinilabs" ref="nofollow noopener noreferrer">github.com/infinilabs</a>） 中的对应项目中提交 Feature Request 或提交 Bug。</p>
<p><strong>下载地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Finfinilabs.cn%2Fdownload" target="_blank" title="https://infinilabs.cn/download" ref="nofollow noopener noreferrer">infinilabs.cn/download</a></p>
<p><strong>邮件</strong>：<strong><a href="https://link.juejin.cn?target=mailto%3Ahello%40infini.ltd" target="_blank" title="mailto:hello@infini.ltd" ref="nofollow noopener noreferrer">hello@infini.ltd</a></strong></p>
<p><strong>Discord</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2F4tKTMkkvVX" target="_blank" title="https://discord.gg/4tKTMkkvVX" ref="nofollow noopener noreferrer">discord.gg/4tKTMkkvVX</a></p>
<h2 data-id="heading-32">关于极限科技（INFINI Labs）</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a97b73aef5e42a49d2dbee2778b80ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764779014&amp;x-signature=11L8orEqn5VfuykkDKTMjnDR0UA%3D" alt="INFINI Labs" loading="lazy"/></p>
<p>极限科技，全称极限数据（北京）科技有限公司，是一家专注于实时搜索与数据分析的软件公司。旗下品牌极限实验室（INFINI Labs）致力于打造极致易用的数据探索与分析体验。</p>
<p>极限科技是一支年轻的团队，采用天然分布式的方式来进行远程协作，员工分布在全球各地，希望通过努力成为中国乃至全球企业大数据实时搜索分析产品的首选，为中国技术品牌输出添砖加瓦。</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Finfinilabs.cn" target="_blank" title="https://infinilabs.cn" ref="nofollow noopener noreferrer">infinilabs.cn</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 defineProps 与 defineEmits 深度解析]]></title>    <link>https://juejin.cn/post/7576923573776990250</link>    <guid>https://juejin.cn/post/7576923573776990250</guid>    <pubDate>2025-11-26T23:37:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576923573776990250" data-draft-id="7577171133431365673" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3  defineProps 与 defineEmits 深度解析"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-26T23:37:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3  defineProps 与 defineEmits 深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T23:37:10.000Z" title="Wed Nov 26 2025 23:37:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>还在为 Vue 组件间的类型安全头疼吗？每次传参都像在玩“猜猜我是谁”，运行时错误频出，调试起来让人抓狂？别担心，今天我要带你彻底掌握 Vue 3 中的 defineProps 和 defineEmits，这对 TypeScript 的完美搭档将彻底改变你的开发体验。</p>
<p>读完本文，你将获得一套完整的类型安全组件通信方案，从基础用法到高级技巧，再到实战中的最佳实践。更重要的是，你会发现自己写出的代码更加健壮、可维护，再也不用担心那些烦人的类型错误了。</p>
<h2 data-id="heading-0">为什么需要 defineProps 和 defineEmits？</h2>
<p>在 Vue 2 时代，我们在组件中定义 props 和 emits 时，类型检查往往不够完善。虽然可以用 PropTypes，但和 TypeScript 的配合总是差那么点意思。很多时候，我们只能在运行时才发现传递了错误类型的数据，这时候已经为时已晚。</p>
<p>想象一下这样的场景：你写了一个按钮组件，期望接收一个 size 属性，只能是 'small'、'medium' 或 'large' 中的一个。但在使用时，同事传了个 'big'，TypeScript 编译时没报错，直到用户点击时才发现样式不对劲。这种问题在大型项目中尤其致命。</p>
<p>Vue 3 的 Composition API 与 TypeScript 的深度集成解决了这个问题。defineProps 和 defineEmits 这两个编译器宏，让组件的输入输出都有了完整的类型推导和检查。</p>
<h2 data-id="heading-1">defineProps：让组件输入类型安全</h2>
<p>defineProps 用于定义组件的 props，它最大的优势就是与 TypeScript 的无缝集成。我们来看几种不同的用法。</p>
<p>基础用法很简单，但功能强大：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义一个按钮组件</span>
<span class="hljs-comment">// 使用类型字面量定义 props</span>
<span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">size</span>: <span class="hljs-string">'small'</span> | <span class="hljs-string">'medium'</span> | <span class="hljs-string">'large'</span>
  disabled?: <span class="hljs-built_in">boolean</span>
  loading?: <span class="hljs-built_in">boolean</span>
}&gt;()

<span class="hljs-comment">// 在模板中直接使用</span>
<span class="hljs-comment">// 现在有了完整的类型提示和检查</span>
</code></pre>
<p>这种写法的好处是，当你使用这个组件时，TypeScript 会严格检查传入的 size 值。如果你试图传递 'big'，编译器会立即报错，而不是等到运行时。</p>
<p>但有时候我们需要给 props 设置默认值，这时候可以这样写：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 withDefaults 辅助函数设置默认值</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> {
  <span class="hljs-attr">size</span>: <span class="hljs-string">'small'</span> | <span class="hljs-string">'medium'</span> | <span class="hljs-string">'large'</span>
  disabled?: <span class="hljs-built_in">boolean</span>
  loading?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">ButtonProps</span>&gt;(), {
  <span class="hljs-attr">size</span>: <span class="hljs-string">'medium'</span>,
  <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>
})
</code></pre>
<p>withDefaults 帮我们处理了默认值，同时保持了类型的完整性。这样即使父组件没有传递这些 props，子组件也能正常工作。</p>
<p>还有一种情况，我们需要混合使用运行时声明和类型声明：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 运行时声明与类型声明结合</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-comment">// 运行时声明</span>
  <span class="hljs-attr">label</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-comment">// 类型声明</span>
  <span class="hljs-attr">count</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  }
})

<span class="hljs-comment">// 定义类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>
  count?: <span class="hljs-built_in">number</span>
}

<span class="hljs-comment">// 这种写法在某些复杂场景下很有用</span>
</code></pre>
<p>这种混合写法在处理一些动态 prop 时特别有用，比如需要根据某些条件决定 prop 的类型。</p>
<h2 data-id="heading-2">defineEmits：组件输出的类型守卫</h2>
<p>defineEmits 用于定义组件发出的事件，同样提供了完整的类型支持。这确保了我们在触发事件时传递正确的数据，也让使用者知道应该如何处理这些事件。</p>
<p>先看一个基础示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义表单组件的事件</span>
<span class="hljs-comment">// 使用类型字面量定义 emits</span>
<span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  <span class="hljs-comment">// submit 事件携带一个表单数据对象</span>
  <span class="hljs-attr">submit</span>: [<span class="hljs-attr">formData</span>: <span class="hljs-title class_">FormData</span>]
  <span class="hljs-comment">// cancel 事件不携带数据</span>
  <span class="hljs-attr">cancel</span>: []
  <span class="hljs-comment">// input 事件携带字符串值</span>
  <span class="hljs-attr">input</span>: [<span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>]
}&gt;()

<span class="hljs-comment">// 在方法中触发事件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">gatherFormData</span>()
  <span class="hljs-comment">// TypeScript 会检查 formData 是否符合 FormData 类型</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'submit'</span>, formData)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCancel</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 不传递参数，符合类型定义</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'cancel'</span>)
}
</code></pre>
<p>这种写法的优势在于，当你在组件内调用 emit 时，TypeScript 会严格检查参数的类型和数量。如果你试图 emit('submit') 而不传递 formData，或者传递错误类型的参数，编译器会立即提醒你。</p>
<p>对于更复杂的场景，我们可以使用接口来定义事件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用接口定义事件类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">FormEvents</span> {
  <span class="hljs-attr">submit</span>: <span class="hljs-function">(<span class="hljs-params">data: FormData</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">cancel</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">isValid: <span class="hljs-built_in">boolean</span>, errors: <span class="hljs-built_in">string</span>[]</span>) =&gt;</span> <span class="hljs-built_in">void</span>
}

<span class="hljs-keyword">const</span> emit = defineEmits&lt;<span class="hljs-title class_">FormEvents</span>&gt;()

<span class="hljs-comment">// 在验证方法中触发复杂事件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">performValidation</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> isValid = <span class="hljs-title function_">validateForm</span>()
  <span class="hljs-keyword">const</span> errors = <span class="hljs-title function_">getValidationErrors</span>()
  
  <span class="hljs-comment">// TypeScript 确保我们传递正确的参数类型</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'validate'</span>, isValid, errors)
}
</code></pre>
<p>这种接口方式的定义让代码更加清晰，特别是当事件类型比较复杂时。你可以把所有的事件定义放在一个地方，便于维护和理解。</p>
<h2 data-id="heading-3">实战技巧：高级用法与最佳实践</h2>
<p>在实际项目中，我们经常会遇到一些复杂场景，这时候就需要一些高级技巧来应对。</p>
<p>一个常见的需求是，我们需要基于已有的 props 类型来定义事件。比如在一个可搜索的表格组件中：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义表格组件的 props 和 emits</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableProps</span> {
  <span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span>[]
  <span class="hljs-attr">columns</span>: <span class="hljs-title class_">Column</span>[]
  searchable?: <span class="hljs-built_in">boolean</span>
  pagination?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">const</span> props = defineProps&lt;<span class="hljs-title class_">TableProps</span>&gt;()

<span class="hljs-comment">// 事件定义基于 props 的某些特性</span>
<span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  <span class="hljs-comment">// 只有当 searchable 为 true 时才会有 search 事件</span>
  <span class="hljs-attr">search</span>: [<span class="hljs-attr">query</span>: <span class="hljs-built_in">string</span>]
  <span class="hljs-comment">// 只有当 pagination 为 true 时才会有 pageChange 事件</span>
  <span class="hljs-attr">pageChange</span>: [<span class="hljs-attr">page</span>: <span class="hljs-built_in">number</span>]
  <span class="hljs-comment">// 始终存在的选择事件</span>
  <span class="hljs-attr">rowSelect</span>: [<span class="hljs-attr">row</span>: <span class="hljs-built_in">any</span>]
}&gt;()

<span class="hljs-comment">// 在搜索方法中条件性触发事件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSearch</span>(<span class="hljs-params">query: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">searchable</span>) {
    <span class="hljs-comment">// TypeScript 知道这个事件是有效的</span>
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'search'</span>, query)
  }
}
</code></pre>
<p>另一个有用的技巧是泛型组件的定义。当我们想要创建可重用的通用组件时：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义一个通用的列表组件</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListProps</span>&lt;T&gt; {
  <span class="hljs-attr">items</span>: T[]
  <span class="hljs-attr">keyField</span>: keyof T
  renderItem?: <span class="hljs-function">(<span class="hljs-params">item: T</span>) =&gt;</span> <span class="hljs-built_in">any</span>
}

<span class="hljs-comment">// 使用泛型定义 props</span>
<span class="hljs-keyword">function</span> defineListProps&lt;T&gt;() {
  <span class="hljs-keyword">return</span> defineProps&lt;<span class="hljs-title class_">ListProps</span>&lt;T&gt;&gt;()
}

<span class="hljs-comment">// 在具体组件中使用</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-comment">// 为 User 类型特化组件</span>
<span class="hljs-keyword">const</span> props = defineListProps&lt;<span class="hljs-title class_">User</span>&gt;()
</code></pre>
<p>这种泛型组件的方式在组件库开发中特别有用，它提供了极大的灵活性，同时保持了类型安全。</p>
<p>在处理异步操作时，我们通常需要定义加载状态和错误处理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 异步操作组件的完整类型定义</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">AsyncProps</span> {
  data?: <span class="hljs-built_in">any</span>
  loading?: <span class="hljs-built_in">boolean</span>
  error?: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">AsyncEmits</span> {
  <span class="hljs-attr">retry</span>: []
  <span class="hljs-attr">reload</span>: [force?: <span class="hljs-built_in">boolean</span>]
  <span class="hljs-attr">success</span>: [<span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span>]
}

<span class="hljs-keyword">const</span> props = defineProps&lt;<span class="hljs-title class_">AsyncProps</span>&gt;()
<span class="hljs-keyword">const</span> emit = defineEmits&lt;<span class="hljs-title class_">AsyncEmits</span>&gt;()

<span class="hljs-comment">// 在异步操作完成时触发事件</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">fetch</span>()
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'success'</span>, result)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 错误处理</span>
  }
}
</code></pre>
<h2 data-id="heading-4">常见陷阱与解决方案</h2>
<p>虽然 defineProps 和 defineEmits 很强大，但在使用过程中还是有一些需要注意的地方。</p>
<p>一个常见的错误是试图在运行时访问类型信息：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 错误的做法：试图在运行时使用类型</span>
<span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>
}&gt;()

<span class="hljs-comment">// 这在运行时是 undefined，因为类型信息在编译时就被移除了</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(props.<span class="hljs-property">count</span>.<span class="hljs-property">type</span>) <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// 正确的做法：使用运行时声明</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">count</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  }
})
</code></pre>
<p>另一个陷阱是关于可选参数的处理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义带有可选参数的事件</span>
<span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  <span class="hljs-comment">// 第二个参数是可选的</span>
  <span class="hljs-attr">search</span>: [<span class="hljs-attr">query</span>: <span class="hljs-built_in">string</span>, options?: <span class="hljs-title class_">SearchOptions</span>]
}&gt;()

<span class="hljs-comment">// 使用时要注意参数顺序</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSearch</span>(<span class="hljs-params">query: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-comment">// 可以只传递必填参数</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'search'</span>, query)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAdvancedSearch</span>(<span class="hljs-params">query: <span class="hljs-built_in">string</span>, options: SearchOptions</span>) {
  <span class="hljs-comment">// 也可以传递所有参数</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'search'</span>, query, options)
}
</code></pre>
<p>在处理复杂的嵌套对象时，类型定义可能会变得冗长：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用类型别名简化复杂类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserProfile</span> = {
  <span class="hljs-attr">personal</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>
  }
  <span class="hljs-attr">preferences</span>: {
    <span class="hljs-attr">theme</span>: <span class="hljs-string">'light'</span> | <span class="hljs-string">'dark'</span>
    <span class="hljs-attr">language</span>: <span class="hljs-built_in">string</span>
  }
}

<span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">profile</span>: <span class="hljs-title class_">UserProfile</span>
}&gt;()

<span class="hljs-comment">// 这样既保持了类型安全，又让代码更清晰</span>
</code></pre>
<h2 data-id="heading-5">与其它 Composition API 的配合</h2>
<p>defineProps 和 defineEmits 可以很好地与 Vue 3 的其它 Composition API 配合使用，创造出强大的组合逻辑。</p>
<p>比如与 provide/inject 的配合：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 父组件提供数据</span>
<span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">theme</span>: <span class="hljs-string">'light'</span> | <span class="hljs-string">'dark'</span>
  <span class="hljs-attr">locale</span>: <span class="hljs-built_in">string</span>
}&gt;()

<span class="hljs-comment">// 基于 props 提供全局配置</span>
<span class="hljs-title function_">provide</span>(<span class="hljs-string">'appConfig'</span>, {
  <span class="hljs-attr">theme</span>: props.<span class="hljs-property">theme</span>,
  <span class="hljs-attr">locale</span>: props.<span class="hljs-property">locale</span>
})

<span class="hljs-comment">// 子组件注入并使用</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-title function_">inject</span>(<span class="hljs-string">'appConfig'</span>)
</code></pre>
<p>与 watch 和 computed 的配合：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">items</span>: <span class="hljs-built_in">any</span>[]
  <span class="hljs-attr">filter</span>: <span class="hljs-built_in">string</span>
}&gt;()

<span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  <span class="hljs-attr">filtered</span>: [<span class="hljs-attr">results</span>: <span class="hljs-built_in">any</span>[]]
}&gt;()

<span class="hljs-comment">// 监听 props 变化并触发事件</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">filter</span>, <span class="hljs-function">(<span class="hljs-params">newFilter</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> filtered = <span class="hljs-title function_">filterItems</span>(props.<span class="hljs-property">items</span>, newFilter)
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'filtered'</span>, filtered)
})

<span class="hljs-comment">// 基于 props 计算衍生数据</span>
<span class="hljs-keyword">const</span> sortedItems = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> props.<span class="hljs-property">items</span>.<span class="hljs-title function_">sort</span>(sortFunction)
})
</code></pre>
<h2 data-id="heading-6">性能优化与最佳实践</h2>
<p>虽然类型安全很重要，但我们也要注意性能影响。以下是一些优化建议：</p>
<p>对于大型对象，考虑使用浅层响应式：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-comment">// 对于大型配置对象，使用 shallowRef 避免不必要的响应式开销</span>
  <span class="hljs-attr">config</span>: <span class="hljs-title class_">AppConfig</span>
  <span class="hljs-comment">// 对于频繁变化的数据，保持深度响应式</span>
  <span class="hljs-attr">items</span>: <span class="hljs-built_in">any</span>[]
}&gt;()
</code></pre>
<p>合理使用 PropType 进行复杂类型验证：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">PropType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-comment">// 使用 PropType 进行运行时类型验证</span>
  <span class="hljs-attr">complexData</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">PropType</span>&lt;<span class="hljs-title class_">ComplexData</span>&gt;,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">value: ComplexData</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">validateComplexData</span>(value)
    }
  }
})
</code></pre>
<h2 data-id="heading-7">总结</h2>
<p>defineProps 和 defineEmits 是 Vue 3 与 TypeScript 完美结合的代表作。它们不仅提供了编译时的类型安全，还大大提升了开发体验。通过本文的学习，你应该能够在组件中正确定义类型安全的 props 和 emits，充分利用 TypeScript 的类型推导能力，处理各种复杂场景下的类型需求，避免常见的陷阱和错误。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET 范围与索引（Range、Index）完全解析：语法、用法与最佳实践]]></title>    <link>https://juejin.cn/post/7576844295434584073</link>    <guid>https://juejin.cn/post/7576844295434584073</guid>    <pubDate>2025-11-26T23:38:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576844295434584073" data-draft-id="7576844295434567689" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET 范围与索引（Range、Index）完全解析：语法、用法与最佳实践"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-11-26T23:38:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET 范围与索引（Range、Index）完全解析：语法、用法与最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T23:38:56.000Z" title="Wed Nov 26 2025 23:38:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>C# 8.0</code> 引入了范围（<code>Ranges</code>）和索引（<code>Indices</code>）功能，提供了更简洁、更直观的语法来处理集合中的元素和子集。这些功能大大简化了数组、字符串、列表等数据结构的操作。</p>
<h3 data-id="heading-1">索引（Indices）</h3>
<h4 data-id="heading-2">从末尾开始的索引</h4>
<p>使用 <code>^</code> 运算符表示从末尾开始的索引：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] numbers = { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span> };

<span class="hljs-comment">// 传统方式获取最后一个元素</span>
<span class="hljs-built_in">int</span> last1 = numbers[numbers.Length - <span class="hljs-number">1</span>]; <span class="hljs-comment">// 9</span>

<span class="hljs-comment">// 使用索引运算符获取最后一个元素</span>
<span class="hljs-built_in">int</span> last2 = numbers[^<span class="hljs-number">1</span>]; <span class="hljs-comment">// 9</span>

<span class="hljs-comment">// 获取倒数第二个元素</span>
<span class="hljs-built_in">int</span> secondLast = numbers[^<span class="hljs-number">2</span>]; <span class="hljs-comment">// 8</span>

<span class="hljs-comment">// 获取倒数第三个元素</span>
<span class="hljs-built_in">int</span> thirdLast = numbers[^<span class="hljs-number">3</span>]; <span class="hljs-comment">// 7</span>
</code></pre>
<h4 data-id="heading-3">索引的工作原理</h4>
<p>索引实际上是 <code>System.Index</code> 结构体的语法糖：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 以下两行代码是等价的</span>
<span class="hljs-built_in">int</span> last = numbers[^<span class="hljs-number">1</span>];
<span class="hljs-built_in">int</span> last = numbers[<span class="hljs-keyword">new</span> Index(<span class="hljs-number">1</span>, fromEnd: <span class="hljs-literal">true</span>)];

<span class="hljs-comment">// 从开头开始的索引</span>
<span class="hljs-built_in">int</span> first = numbers[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 等价于 numbers[new Index(0, fromEnd: false)]</span>
</code></pre>






























<table><thead><tr><th>表达式</th><th>含义</th><th>等同于</th></tr></thead><tbody><tr><td><code>^0</code></td><td>序列结束后的位置</td><td><code>array.Length</code></td></tr><tr><td><code>^1</code></td><td>最后一个元素</td><td><code>array[array.Length - 1]</code></td></tr><tr><td><code>^2</code></td><td>倒数第二个元素</td><td><code>array[array.Length - 2]</code></td></tr><tr><td><code>^n</code></td><td>从末尾算起的第 n 个元素</td><td><code>array[array.Length - n]</code></td></tr></tbody></table>
<h3 data-id="heading-4">范围（Ranges）</h3>
<h4 data-id="heading-5">基本范围操作</h4>
<p>使用 <code>..</code> 运算符指定范围：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] numbers = { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span> };

<span class="hljs-comment">// 获取索引1到3的元素（不包括索引3）</span>
<span class="hljs-built_in">int</span>[] sub1 = numbers[<span class="hljs-number">1.</span><span class="hljs-number">.3</span>]; <span class="hljs-comment">// [1, 2]</span>

<span class="hljs-comment">// 获取从开始到索引3的元素</span>
<span class="hljs-built_in">int</span>[] sub2 = numbers[.<span class="hljs-number">.3</span>]; <span class="hljs-comment">// [0, 1, 2]</span>

<span class="hljs-comment">// 获取从索引6到末尾的元素</span>
<span class="hljs-built_in">int</span>[] sub3 = numbers[<span class="hljs-number">6.</span>.]; <span class="hljs-comment">// [6, 7, 8, 9]</span>

<span class="hljs-comment">// 获取所有元素</span>
<span class="hljs-built_in">int</span>[] all = numbers[..]; <span class="hljs-comment">// [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>

<span class="hljs-comment">// 使用从末尾开始的索引定义范围</span>
<span class="hljs-built_in">int</span>[] sub4 = numbers[^<span class="hljs-number">3.</span>.^<span class="hljs-number">1</span>]; <span class="hljs-comment">// [7, 8] - 从倒数第三个到倒数第一个（不包括）</span>
</code></pre>
<h4 data-id="heading-6">范围的工作原理</h4>
<p>范围实际上是 <code>System.Range</code> 结构体的语法糖：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 以下两行代码是等价的</span>
<span class="hljs-built_in">int</span>[] sub = numbers[<span class="hljs-number">1.</span><span class="hljs-number">.4</span>];
<span class="hljs-built_in">int</span>[] sub = numbers[<span class="hljs-keyword">new</span> Range(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)];

<span class="hljs-comment">// Range 包含 Start 和 End 两个 Index</span>
Range range = <span class="hljs-number">1.</span><span class="hljs-number">.4</span>;
Console.WriteLine(<span class="hljs-string">$"Start: <span class="hljs-subst">{range.Start}</span>, End: <span class="hljs-subst">{range.End}</span>"</span>);
<span class="hljs-comment">// 输出: Start: 1, End: 4</span>
</code></pre>



































<table><thead><tr><th>语法</th><th>含义</th><th>等同于</th></tr></thead><tbody><tr><td><code>..</code></td><td>整个范围</td><td><code>[0..^0]</code></td></tr><tr><td><code>start..</code></td><td>从 start 到序列结束</td><td><code>[start..^0]</code></td></tr><tr><td><code>..end</code></td><td>从开始到 end 之前</td><td><code>[0..end]</code></td></tr><tr><td><code>start..end</code></td><td>从 start 到 end 之前</td><td><code>[start..end]</code></td></tr><tr><td><code>^start..^end</code></td><td>使用末尾索引指定范围</td><td><code>[length - start..length - end]</code></td></tr></tbody></table>
<h4 data-id="heading-7">范围表达式返回值</h4>
<p>范围表达式返回的是原序列的视图(<code>view</code>)，而不是副本。对于数组、字符串等类型，它返回的是只读视图；对于 <code>Span&lt;T&gt;</code> 和 <code>Memory&lt;T&gt;</code>，它返回新的 <code>Span</code> 或 <code>Memory</code>。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] original = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-built_in">int</span>[] slice = original[<span class="hljs-number">1.</span><span class="hljs-number">.4</span>]; <span class="hljs-comment">// [2, 3, 4]</span>

<span class="hljs-comment">// 修改原始数组会影响切片</span>
original[<span class="hljs-number">2</span>] = <span class="hljs-number">100</span>;
Console.WriteLine(<span class="hljs-built_in">string</span>.Join(<span class="hljs-string">", "</span>, slice)); <span class="hljs-comment">// 2, 100, 4</span>

<span class="hljs-comment">// 修改切片也会影响原始数组</span>
slice[<span class="hljs-number">1</span>] = <span class="hljs-number">200</span>;
Console.WriteLine(<span class="hljs-built_in">string</span>.Join(<span class="hljs-string">", "</span>, original)); <span class="hljs-comment">// 1, 2, 200, 4, 5</span>
</code></pre>
<h3 data-id="heading-8">不同类型的使用示例</h3>
<h4 data-id="heading-9">数组</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] array = { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span> };

<span class="hljs-comment">// 获取前5个元素</span>
<span class="hljs-built_in">int</span>[] firstFive = array[.<span class="hljs-number">.5</span>]; <span class="hljs-comment">// [0, 1, 2, 3, 4]</span>

<span class="hljs-comment">// 获取最后3个元素</span>
<span class="hljs-built_in">int</span>[] lastThree = array[^<span class="hljs-number">3.</span>.]; <span class="hljs-comment">// [7, 8, 9]</span>

<span class="hljs-comment">// 获取中间部分</span>
<span class="hljs-built_in">int</span>[] middle = array[<span class="hljs-number">3.</span><span class="hljs-number">.7</span>]; <span class="hljs-comment">// [3, 4, 5, 6]</span>

<span class="hljs-comment">// 获取除第一个和最后一个之外的所有元素</span>
<span class="hljs-built_in">int</span>[] withoutEnds = array[<span class="hljs-number">1.</span>.^<span class="hljs-number">1</span>]; <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7, 8]</span>
</code></pre>
<h4 data-id="heading-10">字符串</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> text = <span class="hljs-string">"Hello, World!"</span>;

<span class="hljs-comment">// 获取前5个字符</span>
<span class="hljs-built_in">string</span> hello = text[.<span class="hljs-number">.5</span>]; <span class="hljs-comment">// "Hello"</span>

<span class="hljs-comment">// 获取最后6个字符</span>
<span class="hljs-built_in">string</span> world = text[^<span class="hljs-number">6.</span>.]; <span class="hljs-comment">// "World!"</span>

<span class="hljs-comment">// 获取逗号后的部分（不包括逗号本身和空格）</span>
<span class="hljs-built_in">string</span> afterComma = text[<span class="hljs-number">7.</span>.^<span class="hljs-number">1</span>]; <span class="hljs-comment">// "World"</span>

<span class="hljs-comment">// 获取子字符串</span>
<span class="hljs-built_in">string</span> sub = text[<span class="hljs-number">7.</span><span class="hljs-number">.12</span>]; <span class="hljs-comment">// "World"</span>
</code></pre>
<h4 data-id="heading-11">列表（<code>List&lt;T&gt;</code>）</h4>
<pre><code class="hljs language-csharp" lang="csharp">List&lt;<span class="hljs-built_in">int</span>&gt; list = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">int</span>&gt; { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span> };

<span class="hljs-comment">// 获取范围（需要转换为数组或使用GetRange）</span>
<span class="hljs-built_in">int</span>[] subArray = list.ToArray()[<span class="hljs-number">2.</span><span class="hljs-number">.6</span>]; <span class="hljs-comment">// [2, 3, 4, 5]</span>

<span class="hljs-comment">// 或者使用List的GetRange方法（不是基于范围的语法，但功能类似）</span>
List&lt;<span class="hljs-built_in">int</span>&gt; subList = list.GetRange(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// [2, 3, 4, 5]</span>
</code></pre>
<h4 data-id="heading-12"><code>Span&lt;T&gt;</code> 和 <code>Memory&lt;T&gt;</code></h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] array = { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span> };

<span class="hljs-comment">// 创建Span并使用范围</span>
Span&lt;<span class="hljs-built_in">int</span>&gt; span = array.AsSpan();
Span&lt;<span class="hljs-built_in">int</span>&gt; spanSlice = span[<span class="hljs-number">2.</span><span class="hljs-number">.6</span>]; <span class="hljs-comment">// [2, 3, 4, 5]</span>

<span class="hljs-comment">// 创建Memory并使用范围</span>
Memory&lt;<span class="hljs-built_in">int</span>&gt; memory = array.AsMemory();
Memory&lt;<span class="hljs-built_in">int</span>&gt; memorySlice = memory[<span class="hljs-number">3.</span><span class="hljs-number">.7</span>]; <span class="hljs-comment">// [3, 4, 5, 6]</span>
</code></pre>
<h3 data-id="heading-13">高级用法和模式</h3>
<h4 data-id="heading-14">与模式匹配结合使用</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] numbers = { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span> };

<span class="hljs-comment">// 使用范围进行模式匹配</span>
<span class="hljs-keyword">if</span> (numbers <span class="hljs-keyword">is</span> [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, .., <span class="hljs-number">8</span>, <span class="hljs-number">9</span>])
{
    Console.WriteLine(<span class="hljs-string">"数组以0,1,2开头，以8,9结尾"</span>);
}

<span class="hljs-comment">// 在switch表达式中使用</span>
<span class="hljs-built_in">string</span> result = numbers <span class="hljs-keyword">switch</span>
{
    [<span class="hljs-meta">0, 1, 2, ..</span>] =&gt; <span class="hljs-string">"以0,1,2开头"</span>,
    [.., <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>] =&gt; <span class="hljs-string">"以7,8,9结尾"</span>,
    [<span class="hljs-meta">0, .., 9</span>] =&gt; <span class="hljs-string">"以0开头，以9结尾"</span>,
    _ =&gt; <span class="hljs-string">"其他模式"</span>
};
</code></pre>
<h4 data-id="heading-15">自定义类型支持范围</h4>
<p>要使自定义类型支持范围操作，需要实现以下方法之一：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyCollection</span>&lt;<span class="hljs-title">T</span>&gt;
{
    <span class="hljs-keyword">private</span> T[] _items;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyCollection</span>(<span class="hljs-params">T[] items</span>)</span>
    {
        _items = items;
    }
    
    <span class="hljs-comment">// 方法1：实现Slice方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> MyCollection&lt;T&gt; <span class="hljs-title">Slice</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> start, <span class="hljs-built_in">int</span> length</span>)</span>
    {
        T[] slice = <span class="hljs-keyword">new</span> T[length];
        Array.Copy(_items, start, slice, <span class="hljs-number">0</span>, length);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyCollection&lt;T&gt;(slice);
    }
    
    <span class="hljs-comment">// 方法2：实现索引器接受Range参数</span>
    <span class="hljs-keyword">public</span> MyCollection&lt;T&gt; <span class="hljs-keyword">this</span>[Range range]
    {
        <span class="hljs-keyword">get</span>
        {
            <span class="hljs-keyword">var</span> (start, length) = GetStartAndLength(range);
            <span class="hljs-keyword">return</span> Slice(start, length);
        }
    }
    
    <span class="hljs-comment">// 辅助方法：将Range转换为(start, length)</span>
    <span class="hljs-keyword">private</span> (<span class="hljs-built_in">int</span> start, <span class="hljs-built_in">int</span> length) GetStartAndLength(Range range)
    {
        <span class="hljs-built_in">int</span> start = range.Start.IsFromEnd ? 
            _items.Length - range.Start.Value : range.Start.Value;
        
        <span class="hljs-built_in">int</span> end = range.End.IsFromEnd ? 
            _items.Length - range.End.Value : range.End.Value;
        
        <span class="hljs-built_in">int</span> length = end - start;
        <span class="hljs-keyword">return</span> (start, length);
    }
    
    <span class="hljs-comment">// 其他成员...</span>
}

<span class="hljs-comment">// 使用自定义集合的范围操作</span>
<span class="hljs-keyword">var</span> collection = <span class="hljs-keyword">new</span> MyCollection&lt;<span class="hljs-built_in">int</span>&gt;(<span class="hljs-keyword">new</span>[] { <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span> });
<span class="hljs-keyword">var</span> subCollection = collection[<span class="hljs-number">1.</span><span class="hljs-number">.4</span>]; <span class="hljs-comment">// 包含元素[1, 2, 3]</span>
</code></pre>
<h3 data-id="heading-16">实际应用场景</h3>
<h4 data-id="heading-17">字符串处理</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 提取文件扩展名</span>
<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">GetFileExtension</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> filename</span>)</span>
{
    <span class="hljs-built_in">int</span> dotIndex = filename.LastIndexOf(<span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">return</span> dotIndex &gt;= <span class="hljs-number">0</span> ? filename[(dotIndex + <span class="hljs-number">1</span>)..] : <span class="hljs-built_in">string</span>.Empty;
}

<span class="hljs-comment">// 提取域名</span>
<span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">GetDomain</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> url</span>)</span>
{
    <span class="hljs-built_in">int</span> protocolEnd = url.IndexOf(<span class="hljs-string">"://"</span>);
    <span class="hljs-keyword">if</span> (protocolEnd &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> url;
    
    <span class="hljs-built_in">int</span> domainStart = protocolEnd + <span class="hljs-number">3</span>;
    <span class="hljs-built_in">int</span> pathStart = url.IndexOf(<span class="hljs-string">'/'</span>, domainStart);
    
    <span class="hljs-keyword">return</span> pathStart &lt; <span class="hljs-number">0</span> ? 
        url[domainStart..] : 
        url[domainStart..pathStart];
}

<span class="hljs-comment">// 处理CSV行</span>
<span class="hljs-function"><span class="hljs-built_in">string</span>[] <span class="hljs-title">ParseCsvLine</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> line</span>)</span>
{
    List&lt;<span class="hljs-built_in">string</span>&gt; fields = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();
    <span class="hljs-built_in">int</span> start = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">while</span> (start &lt; line.Length)
    {
        <span class="hljs-built_in">int</span> end = line.IndexOf(<span class="hljs-string">','</span>, start);
        <span class="hljs-keyword">if</span> (end &lt; <span class="hljs-number">0</span>) end = line.Length;
        
        fields.Add(line[start..end].Trim());
        start = end + <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">return</span> fields.ToArray();
}
</code></pre>
<h4 data-id="heading-18">数据分页</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 使用范围实现分页</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IEnumerable</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">GetPage</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T[] data, <span class="hljs-built_in">int</span> pageNumber, <span class="hljs-built_in">int</span> pageSize</span>)</span>
{
    <span class="hljs-built_in">int</span> startIndex = (pageNumber - <span class="hljs-number">1</span>) * pageSize;
    <span class="hljs-keyword">if</span> (startIndex &gt;= data.Length)
        <span class="hljs-keyword">return</span> Enumerable.Empty&lt;T&gt;();
    
    <span class="hljs-built_in">int</span> endIndex = Math.Min(startIndex + pageSize, data.Length);
    <span class="hljs-keyword">return</span> data[startIndex..endIndex];
}

<span class="hljs-comment">// 使用Span&lt;T&gt;提高性能</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ReadOnlySpan</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">GetPageSpan</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T[] data, <span class="hljs-built_in">int</span> pageNumber, <span class="hljs-built_in">int</span> pageSize</span>)</span>
{
    <span class="hljs-built_in">int</span> startIndex = (pageNumber - <span class="hljs-number">1</span>) * pageSize;
    <span class="hljs-keyword">if</span> (startIndex &gt;= data.Length)
        <span class="hljs-keyword">return</span> ReadOnlySpan&lt;T&gt;.Empty;
    
    <span class="hljs-built_in">int</span> endIndex = Math.Min(startIndex + pageSize, data.Length);
    <span class="hljs-keyword">return</span> data.AsSpan()[startIndex..endIndex];
}
</code></pre>
<h4 data-id="heading-19">数组操作</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 数组旋转</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">RotateArrayLeft</span>&lt;<span class="hljs-title">T</span>&gt;(<span class="hljs-params">T[] array, <span class="hljs-built_in">int</span> positions</span>)</span>
{
    positions %= array.Length;
    <span class="hljs-keyword">if</span> (positions == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-comment">// 创建临时数组保存前positions个元素</span>
    T[] temp = array[..positions];
    
    <span class="hljs-comment">// 将剩余元素向左移动</span>
    Array.Copy(array, positions, array, <span class="hljs-number">0</span>, array.Length - positions);
    
    <span class="hljs-comment">// 将临时数组中的元素放回末尾</span>
    Array.Copy(temp, <span class="hljs-number">0</span>, array, array.Length - positions, positions);
}

<span class="hljs-comment">// 数组分割</span>
(T[] left, T[] right) SplitArray&lt;T&gt;(T[] array, <span class="hljs-built_in">int</span> splitIndex)
{
    <span class="hljs-keyword">return</span> (array[..splitIndex], array[splitIndex..]);
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（148）Redis的性能测试如何进行？]]></title>    <link>https://juejin.cn/post/7576894778572210211</link>    <guid>https://juejin.cn/post/7576894778572210211</guid>    <pubDate>2025-11-26T23:03:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576894778572210211" data-draft-id="7576867727718858787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（148）Redis的性能测试如何进行？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-26T23:03:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（148）Redis的性能测试如何进行？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T23:03:51.000Z" title="Wed Nov 26 2025 23:03:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>进行Redis的性能测试涉及以下几个步骤：设置测试环境、选择测试工具、编写测试代码、运行测试、收集和分析结果。以下是详细的步骤和Java代码示例，展示如何进行Redis的性能测试。</p>
<h3 data-id="heading-0">1. 设置测试环境</h3>
<p>确保Redis服务器正在运行，并且客户端能够连接到服务器。你可以使用本地安装的Redis服务器，也可以使用云提供的Redis实例。</p>
<h3 data-id="heading-1">2. 选择测试工具</h3>
<p>我们可以使用Jedis库来与Redis进行交互。Jedis是一个简单且功能强大的Java Redis客户端。</p>
<h4 data-id="heading-2">依赖</h4>
<p>在<code>pom.xml</code>中添加Jedis依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">3. 性能测试指标</h3>
<p>以下是主要的性能测试指标：</p>
<ul>
<li>吞吐量（TPS, Transactions Per Second）：每秒完成的事务数量。</li>
<li>延迟（Latency）：每个请求的响应时间。</li>
</ul>
<h3 data-id="heading-4">4. 性能测试代码示例</h3>
<p>以下是一个Java代码示例，用于测试读写操作的性能。</p>
<h4 data-id="heading-5">代码示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.exceptions.JedisException;

<span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPerformanceTest</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">REDIS_HOST</span> <span class="hljs-operator">=</span> <span class="hljs-string">"localhost"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REDIS_PORT</span> <span class="hljs-operator">=</span> <span class="hljs-number">6379</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">THREAD_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">OPERATION_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(THREAD_COUNT);

        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; THREAD_COUNT; i++) {
            executorService.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                    <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(REDIS_HOST, REDIS_PORT)) {
                        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; OPERATION_COUNT; j++) {
                            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"key"</span> + j;
                            <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-string">"value"</span> + j;
                            jedis.set(key, value);
                            jedis.get(key);
                        }
                    } <span class="hljs-keyword">catch</span> (JedisException e) {
                        e.printStackTrace();
                    }
                }
            });
        }

        executorService.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!executorService.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executorService.shutdownNow();
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executorService.shutdownNow();
        }

        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> endTime - startTime;

        <span class="hljs-type">double</span> <span class="hljs-variable">tps</span> <span class="hljs-operator">=</span> ((<span class="hljs-type">double</span>) (THREAD_COUNT * OPERATION_COUNT * <span class="hljs-number">2</span>)) / (duration / <span class="hljs-number">1000.0</span>);  <span class="hljs-comment">// 2 operations (set + get)</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">latency</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>) duration / (THREAD_COUNT * OPERATION_COUNT * <span class="hljs-number">2</span>);

        System.out.println(<span class="hljs-string">"Total time: "</span> + duration + <span class="hljs-string">" ms"</span>);
        System.out.println(<span class="hljs-string">"Throughput (TPS): "</span> + tps);
        System.out.println(<span class="hljs-string">"Average Latency: "</span> + latency + <span class="hljs-string">" ms"</span>);
    }
}
</code></pre>
<h3 data-id="heading-6">5. 代码说明</h3>
<ol>
<li>
<p><strong>依赖配置</strong>：首先在<code>pom.xml</code>中添加Jedis依赖。</p>
</li>
<li>
<p><strong>配置客户端</strong>：设置Redis服务器的主机名和端口号，以及线程数和操作次数。</p>
</li>
<li>
<p><strong>性能测试逻辑</strong>：</p>
<ul>
<li>创建一个固定大小的线程池。</li>
<li>为每个线程执行一系列的读写操作。</li>
<li>捕获操作的开始时间和结束时间，并计算总时间。</li>
<li>计算TPS和平均延迟。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-7">6. 运行测试</h3>
<p>确保Redis服务器正在运行，然后编译并运行上述代码。该测试程序会启动多个线程，每个线程都会执行一系列读写操作，并最终输出总耗时、TPS和平均延迟。</p>
<h3 data-id="heading-8">7. 分析结果</h3>
<ul>
<li><strong>总时间</strong>：整个测试运行的总时间（毫秒）。</li>
<li><strong>吞吐量（TPS）</strong>：每秒完成的事务数量。通过总操作次数除以总时间计算得出。</li>
<li><strong>平均延迟</strong>：每个请求的响应时间。通过总时间除以总操作次数计算得出。</li>
</ul>
<p>通过分析这些结果，可以评估Redis在特定环境下的性能表现。这种方法可以帮助优化Redis配置和应用程序的性能。</p>
<h3 data-id="heading-9">8. 进一步优化</h3>
<p>为了获得更加准确和全面的性能测试结果，还可以考虑以下几点：</p>
<ul>
<li><strong>预热</strong>：在正式测试前，进行一些预热操作，以确保Redis服务器和客户端都处于运行状态。</li>
<li><strong>测试集群</strong>：对于生产环境，更常见的是使用Redis集群。可以设置一个Redis集群环境，进行分布式性能测试。</li>
<li><strong>监控工具</strong>：使用监控工具（如Redis自带的<code>INFO</code>命令、Redis监控工具如RedisStat、Grafana结合Prometheus等）来实时监控Redis服务器的状态和性能。</li>
<li><strong>压力测试工具</strong>：除了自定义代码，可以使用专业的压力测试工具如<code>redis-benchmark</code>，该工具是Redis自带的，用于测试Redis性能的工具。</li>
</ul>
<p>通过这些方法，可以更加全面地了解Redis在不同条件下的性能表现，从而做出相应的优化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[破局视频翻译【最后一公里】––从语音克隆到口型对齐的完整工程思路]]></title>    <link>https://juejin.cn/post/7576856418471034890</link>    <guid>https://juejin.cn/post/7576856418471034890</guid>    <pubDate>2025-11-26T18:08:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576856418471034890" data-draft-id="7576907627016781875" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="破局视频翻译【最后一公里】––从语音克隆到口型对齐的完整工程思路"/> <meta itemprop="keywords" content="Python,AIGC,GitHub"/> <meta itemprop="datePublished" content="2025-11-26T18:08:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mortimer"/> <meta itemprop="url" content="https://juejin.cn/user/4441682704623992"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            破局视频翻译【最后一公里】––从语音克隆到口型对齐的完整工程思路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682704623992/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mortimer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T18:08:07.000Z" title="Wed Nov 26 2025 18:08:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3e09d1fcbf54dbb8874d4bb8b0ebcae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764785286&amp;x-signature=0fGGpA5vYEyMPuK%2BNH2t4R3FG%2BA%3D" alt="" loading="lazy"/></p>
<p>ElevenLabs、HeyGen 等闭源服务已经把跨语言<strong>视频翻译</strong>体验推到近乎“完美”级别：
<strong>嘴型精准同步、音色自然还原、画面完整不失真</strong>，几乎就是工业标准。</p>
<p>但一旦涉及 <strong>私有化部署</strong> 或 <strong>开源落地</strong>，现实立刻变得残酷：</p>
<ul>
<li>商用 API 成本高、限制死、可控性差，能选的供应商屈指可数</li>
<li>开源生态高度碎片化，各模块效果断层严重，工程链路难以打磨到生产可用</li>
</ul>
<p>尤其是在「<strong>根据音频修改原视频中人物口型</strong>」这一核心能力上几乎是断档：
国内数字人技术生态确实成熟，但那主要是 <strong>“给一张照片做口播”</strong> 或 <strong>“合成虚拟主播”</strong>。
真正需要 <strong>“驱动原视频人物的嘴型，与新语音逐帧对齐”</strong> 的开放 API 极其稀缺，
目前只有科灵、阿里提供一些基础接口，但限制多、可控性不足，很难在真实业务中使用。</p>
<p>因此，真正的视频翻译绝不只是“ASR → 翻译 → TTS”这么一条三步流水线。
整个难点浓缩成一个词：<strong>视听一致性</strong>——如何在替换语音后，让原视频人物的嘴型、表情、微动作都与新声音严格同步，并且保持画质不崩。</p>
<hr/>
<h2 data-id="heading-0">视听一致性</h2>
<p>即更换语音后，如何让 <strong>人物的口型、表情、嘴唇动态、头部微动、画质细节</strong> 与新语音高度一致，同时不破坏原视频质量。</p>
<p>本文将尝试系统拆解一套 <strong>可自部署的完整工程链路</strong>，覆盖从音频清洗、声纹聚类、音素级对齐，到口型驱动、画质修复的全流程结构，真正直击视频翻译的“最后一公里”。</p>
<hr/>
<h2 data-id="heading-1">一、构建语音克隆所需的高质量参考音频</h2>
<p>语音克隆效果的上限，<strong>99% 取决于参考音源的质量</strong>。
原始互联网视频中的音频几乎必然包含：</p>
<ul>
<li>背景音乐</li>
<li>环境噪音</li>
<li>房间混响</li>
<li>压缩伪影</li>
</ul>
<p>这些问题不解决，后续 TTS 克隆再强也只能“垃圾进、垃圾出”。</p>
<hr/>
<h3 data-id="heading-2">1. 人声分离 + 去混响 —— 两步缺一不可</h3>
<h4 data-id="heading-3">（1）人声伴奏分离</h4>
<p>推荐方案：<strong>UVR5 + MDX-Net 模型族</strong></p>
<h4 data-id="heading-4">（2）去混响</h4>
<p>只做人声分离是不够的。原视频常会带强烈房间混响，克隆后的语音会出现“电子腔调”“浴室音”。</p>
<p>推荐开源方案：<strong>DeepFilterNet</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRikorose%2FDeepFilterNet" target="_blank" title="https://github.com/Rikorose/DeepFilterNet" ref="nofollow noopener noreferrer">github.com/Rikorose/De…</a>)</p>
<blockquote>
<p>pyVideoTrans 当前仅使用 <code>UVR-MDX-NET-Voc_FT</code> 做人声分离，并未包含去混响环节。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">2. VAD → 声纹聚类 → 构建长参考音频</h3>
<p>高质量 TTS 通常需要<strong>15–60秒</strong>连续、干净、同说话人的音频。
但原始字幕切片只有 2–10 秒，而且多说话人视频非常普遍。</p>
<ol>
<li><strong>精准 VAD 切分</strong></li>
</ol>
<ul>
<li>可用 Silero VAD 或 WhisperX 自带 VAD</li>
<li>去掉静音，切成可用语音单元</li>
</ul>
<ol start="2">
<li>
<p><strong>提取声纹嵌入</strong>
推荐：</p>
<ul>
<li>Pyannote.audio (<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fpyannote%2Fspeaker-diarization-3.1" target="_blank" title="https://huggingface.co/pyannote/speaker-diarization-3.1" ref="nofollow noopener noreferrer">huggingface.co/pyannote/sp…</a>)</li>
<li>speechbrain 相关声纹模型 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspeechbrain%2Fspeechbrain" target="_blank" title="https://github.com/speechbrain/speechbrain" ref="nofollow noopener noreferrer">github.com/speechbrain…</a>)</li>
</ul>
</li>
<li>
<p><strong>按声纹聚类，区分不同说话人</strong></p>
</li>
<li>
<p><strong>对同说话人的短片段进行拼接</strong>
得到连续 30~60 秒的参考音频，用于 TTS 克隆。</p>
</li>
</ol>
<blockquote>
<p>pyVideoTrans 当前使用 Silero VAD + 简易声纹区分（eres2net / NeMo titanetsmall），尚未支持同簇片段拼接。</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">二、语音合成与时域对齐：解决“音画不同步”的根源</h2>
<p>语言之间的时长差异是不可避免的。
英文翻译成中文通常会 <strong>变长 20–50%</strong>，若不处理，会出现：</p>
<ul>
<li>画面还没说完，但音频已经结束</li>
<li>口型节奏明显对不上</li>
<li>人物张嘴时音频无声，闭嘴时出现语音</li>
</ul>
<p>行业所有成熟方案都采用 <strong>音素级精对齐 + 时长控制</strong> 的方式来解决此问题。</p>
<hr/>
<h3 data-id="heading-7">1. 音素级强制对齐</h3>
<p>普通 Whisper 只有 <strong>词级</strong> 时间戳，做不了口型驱动。
必须使用能提供 <strong>音素级</strong>对齐的 ASR。</p>
<p>推荐：<strong>WhisperX</strong> (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fm-bain%2FwhisperX" target="_blank" title="https://github.com/m-bain/whisperX" ref="nofollow noopener noreferrer">github.com/m-bain/whis…</a>)</p>
<blockquote>
<p>pyVideoTrans 当前未集成音素级对齐，仍使用普通 Whisper。</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">2. TTS 等时性控制</h3>
<p><strong>想达到工程级控制链至少包括以下三步</strong></p>
<h4 data-id="heading-9">（1）翻译阶段限制音节/字数</h4>
<p>在 LLM Prompt 中加入：</p>
<ul>
<li>最大音节数</li>
<li>对齐原句时长的约束</li>
</ul>
<p>从源头减少时长偏差。</p>
<h4 data-id="heading-10">（2）高自然度语音克隆模型</h4>
<p>推荐（中英双语）：</p>
<ul>
<li><strong>CosyVoice 2.0</strong></li>
<li><strong>F5-TTS</strong></li>
<li><strong>Index-TTS2</strong></li>
<li><strong>Fish-Speech v1.5</strong></li>
</ul>
<p>特点：自然度高、克隆效果稳定。</p>
<h4 data-id="heading-11">（3）精细时域拉伸/压缩（保持音调不变）</h4>
<p>使用 <strong>rubberband</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fbreakfastquay.com%2Frubberband%2F%25EF%25BC%2589" target="_blank" title="https://breakfastquay.com/rubberband/%EF%BC%89" ref="nofollow noopener noreferrer">breakfastquay.com/rubberband/…</a>
将 TTS 输出控制在原视频时长的 <strong>0.9×–1.2×</strong> 内。</p>
<blockquote>
<p>pyVideoTrans 目前仅支持 API 级克隆，未包含完整的音节控制 + 时长控制链路。</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">三、视觉重构：口型驱动的真正核心与难点</h2>
<p>目标非常明确：<strong>只动嘴，不动脸。不破坏视频画质</strong></p>
<p>视觉部分的工程量与算力投入在整个链路中是最高的。</p>
<hr/>
<h3 data-id="heading-13">1. 时长差异下的视频帧处理策略</h3>

















<table><thead><tr><th>时长差距</th><th>推荐处理方式</th></tr></thead><tbody><tr><td>≤20%</td><td>音频 rubberband 微调 + FFmpeg setpts 对齐</td></tr><tr><td>&gt;20%</td><td>必须插帧，必要时生成静态微动帧</td></tr></tbody></table>
<p><strong>推荐开源：</strong></p>
<ul>
<li>
<p><strong>RIFE</strong>（视频插帧）
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhzwer%2FPractical-RIFE" target="_blank" title="https://github.com/hzwer/Practical-RIFE" ref="nofollow noopener noreferrer">github.com/hzwer/Pract…</a></p>
</li>
<li>
<p><strong>Stable Video Diffusion</strong>
生成自然的眨眼、轻微头部运动等微动画面</p>
</li>
</ul>
<blockquote>
<p>pyVideoTrans 目前只做简单的 setpts 时间拉伸。</p>
</blockquote>
<hr/>
<h3 data-id="heading-14">2. 多人同框时的“面部锁定”</h3>
<p>如果不对人物身份进行绑定，背景人脸会莫名张嘴，视频会直接毁掉。</p>
<p>解决方案：</p>
<ul>
<li>使用 <strong>InsightFace</strong> 做人脸检测 + 人脸识别 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepinsight%2Finsightface%25EF%25BC%2589" target="_blank" title="https://github.com/deepinsight/insightface%EF%BC%89" ref="nofollow noopener noreferrer">github.com/deepinsight…</a></li>
<li>将每个说话人的声纹ID与屏幕上的脸ID绑定</li>
<li>当前说话人 → 只驱动对应面部区域</li>
<li>其他脸保持静止</li>
<li>侧脸/遮挡帧自动跳过推理</li>
</ul>
<hr/>
<h3 data-id="heading-15">3. 高保真口型驱动</h3>
<ul>
<li>
<p>当前开源最优选： MuseTalk（腾讯）
实时推理、唇形自然、牙齿纹理优秀，画质保留好。
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTMElyralab%2FMuseTalk" target="_blank" title="https://github.com/TMElyralab/MuseTalk" ref="nofollow noopener noreferrer">github.com/TMElyralab/…</a></p>
</li>
<li>
<p>次选： VideoReTalking
效果稳定但较慢。
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FOpenTalker%2Fvideo-retalking" target="_blank" title="https://github.com/OpenTalker/video-retalking" ref="nofollow noopener noreferrer">github.com/OpenTalker/…</a></p>
</li>
</ul>
<blockquote>
<p>pyVideoTrans 当前完全没有口型驱动能力。</p>
</blockquote>
<hr/>
<h2 data-id="heading-16">四、后处理：画质修复与最终合成</h2>
<p>口型驱动模型一般只在 <strong>96×96 或 128×128</strong> 的小区域推理。
直接贴回视频必然产生：</p>
<ul>
<li>嘴部模糊</li>
<li>局部马赛克</li>
<li>面部细节不完整</li>
</ul>
<p>必须进行 <strong>面部超分辨率</strong>。</p>
<h3 data-id="heading-17">推荐开源方案流程：</h3>
<ol>
<li>
<p><strong>GPEN</strong> 速度快、面部纹理还原好
<em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyangxy%2FGPEN" target="_blank" title="https://github.com/yangxy/GPEN" ref="nofollow noopener noreferrer">github.com/yangxy/GPEN</a></em></p>
</li>
<li>
<p><strong>CodeFormer</strong> 身份保持极强、可作为补偿阶段
<em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsczhou%2FCodeFormer" target="_blank" title="https://github.com/sczhou/CodeFormer" ref="nofollow noopener noreferrer">github.com/sczhou/Code…</a></em></p>
</li>
<li>
<p><strong>GFPGAN</strong> 经典、稳健，可在链路中兜底
<em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencentARC%2FGFPGAN" target="_blank" title="https://github.com/TencentARC/GFPGAN" ref="nofollow noopener noreferrer">github.com/TencentARC/…</a></em></p>
</li>
</ol>
<p>最终使用 FFmpeg：</p>
<ul>
<li>合并新音频流</li>
<li>合成处理后的视频流</li>
<li>插入对齐的字幕</li>
</ul>
<hr/>
<h2 data-id="heading-18">真正工业级的视频翻译链路</h2>
<p><strong>人声分离 → 去混响 → 声纹聚类 → 长参考音频 → 音素级 ASR → 对齐翻译 → 高品质 TTS 克隆 → 时长控制  → 面部识别与锁定 → MuseTalk 驱动 → GPEN/CodeFormer 修复 → FFmpeg 合成</strong></p>
<p>猜测这条链路在结构上应与 ElevenLabs / HeyGen 相差无几，但全部使用开源可自部署模型。</p>
<p>想实现这套流程，显然所需较多的硬件资源，以及不小的技术难度，出于 pyVideoTrans 业余爱好项目的定位，未考虑完整环节， 丢失了 <em>去混响、 声纹聚类与拼接、音素级对齐、 面部锁定、 高保真口型驱动、 面部修复</em> 这些较困难的部分。</p>
<p><strong>真正要破局视频翻译的“最后一公里”，必须把上述每一步都补齐——缺一不可。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Langchain 浅出]]></title>    <link>https://juejin.cn/post/7576861477267308563</link>    <guid>https://juejin.cn/post/7576861477267308563</guid>    <pubDate>2025-11-26T18:32:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576861477267308563" data-draft-id="7576861477267275795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Langchain 浅出"/> <meta itemprop="keywords" content="LangChain,LLM,Python"/> <meta itemprop="datePublished" content="2025-11-26T18:32:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吴佳浩"/> <meta itemprop="url" content="https://juejin.cn/user/2696441245481975"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Langchain 浅出
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2696441245481975/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吴佳浩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T18:32:33.000Z" title="Wed Nov 26 2025 18:32:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">Langchain 浅出</h2>
<blockquote>
<p>原本的计划是发一篇《langchain深入浅出》，但是太长了就切割成了两部份，先发了这篇浅出
中间还经历了大版本的更新╮(╯▽╰)╭但是有惊无险还是写完了。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2a3016eef8c4ab0933e83e98f1dd875~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC05L2z5rWp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764786752&amp;x-signature=9QBMD3JS4fCsYV%2BHC86WRTg%2FIbk%3D" alt="人工智能的无限可能.png" loading="lazy"/></p>
<p><strong>作者</strong>：吴佳浩</p>
<p><strong>最后更新</strong>：2025-11-27</p>
<p><strong>适用版本</strong>：LangChain v1.0+</p>
<h3 data-id="heading-1">目录</h3>
<ol>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">什么是 LangChain</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">环境准备</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">核心概念</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">实战案例</a></li>
</ol>
<hr/>
<h3 data-id="heading-2">什么是Langchain</h3>
<blockquote>
<p>这里我就不多话太多时间和大家扯淡了 一句话概括什么是langchain</p>
<p>LangChain 是把“模型、提示、工具、记忆”等模块按统一 Runnable 接口串成 pipeline，让开发者像搭积木一样快速搭建 LLM 应用的生产级框架。</p>
</blockquote>
<p><strong>核心优势</strong>：</p>
<ul>
<li>模块化设计，易于组合和扩展</li>
<li>支持多种 LLM 提供商（OpenAI、Anthropic、ollama本地模型等）</li>
<li>丰富的预构建组件</li>
</ul>
<hr/>
<h3 data-id="heading-3">核心概念深度解析</h3>
<h4 data-id="heading-4">1. LangChain 的工作原理</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">%% LangChain v1 关键流程（Runnable 版）
graph LR
    A[用户输入] --&gt; B[ChatPromptTemplate]
    B --&gt; C[RunnableWithMessageHistory]
    C --&gt; D[Chat Model]
    D --&gt; E[Output Parser]
    E --&gt; F[结果]
</code></pre>
<p><strong>关键流程（LangChain v1）</strong>：</p>
<ol>
<li>
<p><strong>输入处理</strong><br/>
用户输入 → <code>ChatPromptTemplate.invoke()</code> → 生成消息列表。</p>
</li>
<li>
<p><strong>历史注入（可选）</strong><br/>
<code>RunnableWithMessageHistory</code> 自动把之前对话拼进消息，再传给模型。</p>
</li>
<li>
<p><strong>模型调用</strong><br/>
<code>ChatModel.invoke(messages)</code> → 返回 <code>AIMessage</code>。</p>
</li>
<li>
<p><strong>输出解析</strong><br/>
<code>OutputParser.invoke(ai_message)</code> → 结构化数据 / 字符串。</p>
</li>
<li>
<p><strong>结果返回</strong><br/>
解析后的内容即为最终答案，同时历史被持久化，供下轮使用。</p>
</li>
<li>
<h6 data-id="heading-5"><strong>记忆管理</strong>：对话历史存储在 Memory 中供后续使用</h6>
</li>
</ol>
<hr/>
<h3 data-id="heading-6">环境准备</h3>
<h4 data-id="heading-7">步骤 1：安装 Python</h4>
<h5 data-id="heading-8">macOS</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查是否已安装 Python（推荐 3.8+）</span>
python3 --version

<span class="hljs-comment"># 如果未安装，使用 Homebrew 安装</span>
/bin/bash -c <span class="hljs-string">"<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>"</span>
brew install python@3.12.11
</code></pre>
<h5 data-id="heading-9">Windows</h5>
<pre><code class="hljs language-powershell" lang="powershell"># 下载 Python 安装包
# 访问：https://www.python.org/downloads/
# 下载 Python 3.12.11+ 安装包
# 安装时勾选 "Add Python to PATH"

# 验证安装
python --version
</code></pre>
<h4 data-id="heading-10">步骤 2：创建项目目录</h4>
<h5 data-id="heading-11">macOS</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目文件夹</span>
<span class="hljs-built_in">mkdir</span> langchain-demo
<span class="hljs-built_in">cd</span> langchain-demo

<span class="hljs-comment"># 创建虚拟环境</span>
python3 -m venv venv

<span class="hljs-comment"># 激活虚拟环境</span>
<span class="hljs-built_in">source</span> venv/bin/activate
</code></pre>
<h5 data-id="heading-12">Windows</h5>
<pre><code class="hljs language-powershell" lang="powershell"># 创建项目文件夹
mkdir langchain-demo
cd langchain-demo

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
.\venv\Scripts\activate
</code></pre>
<h4 data-id="heading-13">步骤 3：安装 LangChain</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 核心骨架（必装）</span>
pip install -U langchain==1.0.0 langchain-core

<span class="hljs-comment"># 2. 模型/嵌入支持（按需选）</span>
pip install langchain-openai          <span class="hljs-comment"># OpenAI / Azure</span>
pip install langchain-ollama          <span class="hljs-comment"># Ollama 本地模型</span>
pip install langchain-huggingface     <span class="hljs-comment"># HuggingFace 模型/嵌入</span>

<span class="hljs-comment"># 3. 向量库（RAG 必装其一）</span>
pip install chromadb                  <span class="hljs-comment"># 本地文件型</span>
<span class="hljs-comment"># pip install faiss-cpu               # 另一轻量选择</span>

<span class="hljs-comment"># 4. 辅助工具</span>
pip install python-dotenv             <span class="hljs-comment"># 读 .env</span>
pip install tiktoken                  <span class="hljs-comment"># OpenAI token 计数 我主要是用本地的ollama暂时不用 有需要的酌情安装</span>
pip install pydantic                  <span class="hljs-comment"># 结构化输出/数据验证</span>
pip install langgraph                 <span class="hljs-comment"># 需要复杂 Agent 流程时再装</span>
</code></pre>
<h4 data-id="heading-14">步骤 4：配置 API 密钥</h4>
<p>创建 <code>.env</code> 文件来存储 API 密钥：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建 .env 文件</span>
<span class="hljs-built_in">touch</span> .<span class="hljs-built_in">env</span>  <span class="hljs-comment"># macOS</span>
<span class="hljs-comment"># 或</span>
<span class="hljs-built_in">type</span> nul &gt; .<span class="hljs-built_in">env</span>  <span class="hljs-comment"># Windows</span>
</code></pre>
<p>在 <code>.env</code> 文件中添加：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">OPENAI_API_KEY=你的_OpenAI_API_密钥
# 或使用其他 LLM 提供商
# ANTHROPIC_API_KEY=你的_Anthropic_API_密钥

</code></pre>
<p><em><strong>注意这里你如果使用的是本地的ollama 那么则无需配置秘钥</strong></em></p>
<hr/>
<p><strong>人狠话不多</strong> <strong>叫声浩哥</strong></p>
<p>**上呆么（demo）**😄😄</p>
<hr/>
<h3 data-id="heading-15">完整项目结构</h3>
<p>因为我这里有两套环境 Mac 7b &amp; Windows就用30b所以会出现上下的demo 使用的模型出现些许的出入，这点在这里也做一个说明，防止看着些的朋友出现一些困惑。</p>
<p>还有别问我venv哪里来的 如果这你都不会那么建议你去看我的<a href="https://juejin.cn/post/7292014439384793098" target="_blank" title="https://juejin.cn/post/7292014439384793098">Python入门指南系列</a></p>
<pre><code class="hljs language-bash" lang="bash">langchain-demo/
├── venv/                      <span class="hljs-comment"># 虚拟环境</span>
├── .<span class="hljs-built_in">env</span>                       <span class="hljs-comment"># 环境变量配置</span>
├── requirements.txt           <span class="hljs-comment"># 依赖包列表</span>
├── demo1_basic.py            <span class="hljs-comment"># 案例1：基础调用</span>
├── demo2_prompt_template.py  <span class="hljs-comment"># 案例2：提示词模板</span>
├── demo3_chains.py           <span class="hljs-comment"># 案例3：链式调用</span>
├── demo4_memory.py           <span class="hljs-comment"># 案例4：对话记忆</span>
├── demo5_document_qa.py      <span class="hljs-comment"># 案例5：文档问答</span>
├── demo6_agent.py            <span class="hljs-comment"># 案例6：Agent代理</span>
└── run_all_demos.py          <span class="hljs-comment"># 运行所有示例</span>
</code></pre>
<p>创建 <code>requirements.txt</code> 文件：</p>
<pre><code class="hljs language-txt" lang="txt"># LangChain v1 最小可用组合
langchain&gt;=1.0.0           # 主包正式版
langchain-core&gt;=1.0.0      # 核心协议（可省略，主包会拉最新）
langchain-openai&gt;=1.0.0    # OpenAI 系列
langchain-ollama&gt;=1.0.0    # 本地 Ollama
tiktoken&gt;=0.7.0            # OpenAI token 计数
python-dotenv&gt;=1.0.0       # 环境变量
chromadb&gt;=0.5.0            # 向量数据库
</code></pre>
<p>安装所有依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pip install -r requirements.txt
</code></pre>
<hr/>
<h3 data-id="heading-16">实战案例</h3>
<h4 data-id="heading-17">案例 1：基础 LLM 调用</h4>
<p>创建文件 <code>demo1_basic.py</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
案例 1：基础的 LLM 调用
展示如何使用 LangChain 调用语言模型
"""</span>
<span class="hljs-comment"># 如果使用的OpenApideng相关的内容则使用以下的插件</span>
<span class="hljs-comment"># from langchain_openai import ChatOllama</span>

 
<span class="hljs-comment"># 如果使用的是ollama的话那么直接使用本插件 </span>
<span class="hljs-keyword">from</span> langchain_ollama <span class="hljs-keyword">import</span> ChatOllama <span class="hljs-comment"># 新</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

<span class="hljs-comment"># 加载环境变量 如果使用的本地的ollama 这里可以直接省略</span>
load_dotenv() 

<span class="hljs-keyword">def</span> <span class="hljs-title function_">basic_llm_call</span>():
    <span class="hljs-string">"""最简单的 LLM 调用示例"""</span>
    
    <span class="hljs-comment"># 初始化模型</span>
    <span class="hljs-comment"># temperature: 控制输出的随机性（0-1），0 表示确定性输出</span>
    llm = ChatOllama(
        model=<span class="hljs-string">"Qwen2.5:7b"</span>,
        temperature=<span class="hljs-number">0.7</span>
    )
    
    <span class="hljs-comment"># 直接调用模型</span>
    response = llm.invoke(<span class="hljs-string">"请用一句话介绍什么是人工智能"</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"基础 LLM 调用结果："</span>)
    <span class="hljs-built_in">print</span>(response.content)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    basic_llm_call()
</code></pre>
<p><strong>运行方式</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">python demo1_basic.py
</code></pre>
<p><strong>输出结果:</strong></p>
<pre><code class="hljs language-bash" lang="bash">Langchain深入浅出 % python demo_basic.py
==================================================
本地 Ollama (Qwen2.5:7b) 调用结果：
人工智能是指由机器或软件所表现出的智能行为。
==================================================
</code></pre>
<hr/>
<h4 data-id="heading-18">案例 2：使用提示词模板</h4>
<p>创建文件 <code>demo2_prompt_template.py</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate,ChatPromptTemplate <span class="hljs-comment"># 导入提示词模板类</span>
<span class="hljs-keyword">from</span> langchain_ollama <span class="hljs-keyword">import</span> ChatOllama  <span class="hljs-comment"># 导入Ollama聊天模型类</span>

<span class="hljs-comment"># 1.simple prompt template example</span>
<span class="hljs-comment">#   简单的提示词模版示例</span>
<span class="hljs-comment">#   功能：展示如何使用提示词模板生成营销文案</span>
<span class="hljs-comment">#   流程：</span>
<span class="hljs-comment">#   1. 创建提示词模板</span>
<span class="hljs-comment">#   2. 初始化语言模型</span>
<span class="hljs-comment">#   3. 填充模板参数</span>
<span class="hljs-comment">#   4. 调用模型生成响应</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_prompt_template</span>():
    <span class="hljs-string">"""\n\t简单的提示词模版示例\n\t功能：展示如何使用提示词模板生成营销文案\n\t流程：\n\t\t1. 创建提示词模板\n\t\t2. 初始化语言模型\n\t\t3. 填充模板参数\n\t\t4. 调用模型生成响应\n\t"""</span>
    <span class="hljs-string">"""简单的提示词模版示例"""</span>
    <span class="hljs-comment"># 创建提示词模版</span>
    <span class="hljs-comment"># {product}是占位符，可以动态替换</span>
    myTemplate = <span class="hljs-string">"""
    你是一名产品营销文案专家，请帮我为以下产品撰写一段吸引人的营销文案：
    产品名称：{product}
    产品描述：{description}
    产品特点：{features}
    请用轻松活泼的语气，字数控制在 100 字以内。
    """</span>
    <span class="hljs-comment"># 创建提示词模版对象</span>
    prompt = PromptTemplate(
        input_variables=[<span class="hljs-string">"product"</span>, <span class="hljs-string">"description"</span>, <span class="hljs-string">"features"</span>],  <span class="hljs-comment"># 定义模板中可替换的变量</span>
        template=myTemplate  <span class="hljs-comment"># 使用上面定义的模板字符串</span>
    )
    <span class="hljs-comment"># 初始化模型</span>
    llm = ChatOllama(
        model=<span class="hljs-string">"qwen2.5:7b"</span>,  <span class="hljs-comment"># 指定使用的模型名称</span>
        temperature=<span class="hljs-number">0.7</span>,  <span class="hljs-comment"># 设置温度参数，控制输出的随机性</span>
    )
    
    <span class="hljs-comment"># 填充提示词模版</span>
    formatted_prompt = prompt.<span class="hljs-built_in">format</span>(
        product=<span class="hljs-string">"智能手环"</span>,  <span class="hljs-comment"># 替换模板中的product变量</span>
        description=<span class="hljs-string">"年轻的运动爱好者"</span>,  <span class="hljs-comment"># 替换模板中的description变量</span>
        features=<span class="hljs-string">"心率监测、睡眠追踪、防水设计"</span>  <span class="hljs-comment"># 替换模板中的features变量</span>
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)  <span class="hljs-comment"># 打印分隔线</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"生成的提示词："</span>)  <span class="hljs-comment"># 打印提示信息</span>
    <span class="hljs-built_in">print</span>(formatted_prompt)  <span class="hljs-comment"># 打印格式化后的提示词</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

    <span class="hljs-comment"># 调用模型使用模型处理格式化后的提示词</span>
    respone = llm.invoke(formatted_prompt)  


    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n模型响应:"</span>)  <span class="hljs-comment"># 打印提示信息</span>
    <span class="hljs-built_in">print</span>(respone.content)  <span class="hljs-comment"># 打印模型的响应内容</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)  <span class="hljs-comment"># 打印分隔线</span>

<span class="hljs-comment"># 2.对话式提示词模版</span>
<span class="hljs-comment">#   对话式提示词模版示例</span>
<span class="hljs-comment">#   功能：展示如何使用提示词模板进行对话式交互</span>
<span class="hljs-comment">#   流程：</span>
<span class="hljs-comment">#   1. 创建提示词模板</span>
<span class="hljs-comment">#   2. 初始化语言模型</span>
<span class="hljs-comment">#   3. 填充模板参数格式化</span>
<span class="hljs-comment">#   4. 调用模型生成响应</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_prompt_template</span>():
    <span class="hljs-comment">#创建对话模版</span>
    <span class="hljs-comment">#可以指定系统消息、人类消息等不同的角色</span>
    chat_template = ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一名资深的{role}，拥有10年以上的从业经验"</span>),
        (<span class="hljs-string">"human"</span>, <span class="hljs-string">"请帮我分析:{question}"</span>)
    ])

    <span class="hljs-comment"># 初始化模型</span>
    llm = ChatOllama(
        model=<span class="hljs-string">"qwen2.5:7b"</span>,  <span class="hljs-comment"># 指定使用的模型名称</span>
        temperature=<span class="hljs-number">0.7</span>,  <span class="hljs-comment"># 设置温度参数，控制输出的随机性</span>
    )

    <span class="hljs-comment"># 填充提示词模版</span>
    messages = chat_template.format_messages(
        role=<span class="hljs-string">"Python工程师"</span>,  <span class="hljs-comment"># 替换模板中的role变量</span>
        question=<span class="hljs-string">"如何优化Python代码的性能？"</span>  <span class="hljs-comment"># 替换模板中的topic变量</span>
    )

    <span class="hljs-comment"># 调用模型使用模型处理格式化后的提示词</span>
    response = llm.invoke(messages)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n对话模板响应："</span>)
    <span class="hljs-built_in">print</span>(response.content)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

<span class="hljs-comment"># 判断是否为主程序运行，如果是，则调用simple_prompt_template函数，否则不执行</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
        simple_prompt_template()
        chat_prompt_template()
</code></pre>
<p><strong>输出结果:</strong></p>
<pre><code class="hljs language-bash" lang="bash">==================================================
生成的提示词：

    你是一名产品营销文案专家，请帮我为以下产品撰写一段吸引人的营销文案：
    产品名称：智能手环
    产品描述：年轻的运动爱好者
    产品特点：心率监测、睡眠追踪、防水设计
    请用轻松活泼的语气，字数控制在 100 字以内。
    
==================================================

模型响应:
想成为朋友圈里的运动小明星吗？来试试我们的智能手环吧！它专为年轻的运动爱好者打造，不仅有时尚外观，还有心率监测和睡眠追踪功能哦。防水设计让你无忧运动，记录每一次挥汗如雨的时刻。戴上它，开启你的活力人生！
==================================================

对话模板响应：
优化Python代码的性能是一个多方面的工作，通常需要考虑算法复杂度、数据结构选择以及特定库和工具的应用。下面是一些常见的优化策略：

<span class="hljs-comment">### 1. 分析瓶颈</span>

- **使用`cProfile`或`line_profiler`**：首先定位程序中的热点（即执行时间最长的部分）。这有助于确定优化的重点。
- **了解Python的性能特性**：例如，避免不必要的对象创建、减少函数调用次数等。

<span class="hljs-comment">### 2. 选择合适的数据结构和算法</span>

- 根据问题的具体情况选择最适合的数据结构。比如使用`collections.deque`代替列表进行频繁的添加和删除操作，或使用`heapq`来实现优先队列。
- 仔细考虑是否真的需要使用字典或集合，有时候列表可能足够且更快。

<span class="hljs-comment">### 3. 使用内置函数</span>

- Python库中的很多函数都是用C语言编写的，执行速度远快于Python代码。例如，使用`map()`、`filter()`等高阶函数代替循环。
- 利用`itertools`模块提供的高效迭代器工具，如`chain()`, `accumulate()`等。

<span class="hljs-comment">### 4. 避免全局变量</span>

- 全局变量在每次调用时都需要查找，这会降低程序的执行速度。尽量减少对全局变量的依赖。
  
<span class="hljs-comment">### 5. 使用多线程或异步编程</span>

- 如果你的任务是I/O密集型（如网络请求、文件读写等），可以考虑使用`asyncio`实现异步IO操作来提高效率。
- 对于CPU密集型的任务，可以利用`multiprocessing`模块创建进程来并行执行。

<span class="hljs-comment">### 6. 编译Python代码</span>

- 使用PyPy解释器可能会带来显著的速度提升。虽然标准的CPython通常已足够快，但在某些情况下使用PyPy可以实现更快的运行时。
- 利用Numba这样的工具将部分或全部Python函数编译成机器码。

<span class="hljs-comment">### 7. 减少内存消耗</span>

- 使用`numpy`、`pandas`等库处理大规模数据集往往比纯Python实现更高效，因为它们底层使用了C语言编写，并且进行了优化。
  
<span class="hljs-comment">### 8. 内存管理与垃圾回收</span>

- 确保正确地使用资源和管理对象生命周期。避免不必要的内存泄漏。

通过上述方法的综合应用，通常可以显著提高Python代码的执行速度和效率。不过需要注意的是，性能优化应当在确保程序功能的前提下进行，并且要衡量所付出的努力是否值得得到的性能提升。
==================================================
</code></pre>
<p><strong>小结</strong></p>






























<table><thead><tr><th>维度</th><th><code>PromptTemplate</code></th><th><code>ChatPromptTemplate</code></th></tr></thead><tbody><tr><td>结构</td><td>单一段落字符串（无角色）</td><td>带角色的消息列表（系统 / 人类 / AI）</td></tr><tr><td>交互方式</td><td>传递纯文本</td><td>传递消息列表</td></tr><tr><td>适用场景</td><td>单轮任务、简单指令</td><td>多轮对话、需要角色设定的任务</td></tr><tr><td>模型理解方式</td><td>作为整体指令处理</td><td>按角色优先级和上下文处理</td></tr></tbody></table>
<p>简单来说，<code>PromptTemplate</code> 是 “给模型一段话”，<code>ChatPromptTemplate</code> 是 “给模型一段带角色的对话历史”，后者更适合模拟真实交互场景。</p>
<hr/>
<h4 data-id="heading-19">案例 3：链式调用（Chain）</h4>
<p>创建文件 <code>demo3_chains.py</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
案例 3：链式调用（LangChain v1版本 新写法）
展示如何用 RunnableSequence 替代 LLMChain / SequentialChain
"""</span>
<span class="hljs-comment">#本地使用ollama 这里暂时注释</span>
<span class="hljs-comment">#from dotenv import load_dotenv</span>
<span class="hljs-comment">#load_dotenv()</span>

<span class="hljs-keyword">from</span> langchain_ollama <span class="hljs-keyword">import</span> ChatOllama
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate
<span class="hljs-comment"># from langchain.chains import LLMChain, SequentialChain #被版本删除使用下面的替代</span>
<span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableSequence, RunnablePassthrough <span class="hljs-comment"># 新引入的类，用于替代 LLMChain / SequentialChain，实现链式调用</span>



<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_chain</span>():
    <span class="hljs-string">"""简单链式调用示例"""</span>


    <span class="hljs-comment"># 初始化模型</span>
    llm = ChatOllama(
        model=<span class="hljs-string">"qwen2.5:7b"</span>,
        temperature=<span class="hljs-number">0.7</span>,
    )

    <span class="hljs-comment"># 创建提示词模板</span>
    prompt = PromptTemplate(
        input_variables=[<span class="hljs-string">"topic"</span>],
        template=<span class="hljs-string">"请为以下主题写一个标题{topic}"</span>
    )

    <span class="hljs-comment"># 突出语法变化：用最精简的逻辑（输入→格式化→生成）展示新版 API 的核心语法，减少其他干扰。</span>
    <span class="hljs-comment"># 创建链式调用</span>
    chain = prompt | llm




    <span class="hljs-comment"># 运行链式调用</span>
    result = chain.invoke({<span class="hljs-string">"topic"</span>: <span class="hljs-string">"人工智能"</span>})

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"链式调用结果："</span>)
<span class="hljs-comment">#    content='"探索未来：人工智能的技术进步与应用前景"' additional_kwargs={} response_metadata={'model': 'qwen2.5:7b', 'created_at': '2025-11-20T08:12:53.783476Z', 'done': True, 'done_reason': 'stop', 'total_duration': 5279829084, 'load_duration': 836230125, 'prompt_eval_count': 37, 'prompt_eval_duration': 4001584375, 'eval_count': 12, 'eval_duration': 439842917, 'logprobs': None, 'model_name': 'qwen2.5:7b', 'model_provider': 'ollama'} id='lc_run--3fa4a36d-9887-4a5d-af20-1daa48daf5ff-0' usage_metadata={'input_tokens': 37, 'output_tokens': 12, 'total_tokens': 49}</span>
    <span class="hljs-built_in">print</span>(result.content)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)




<span class="hljs-keyword">def</span> <span class="hljs-title function_">sequential_chain</span>():
    <span class="hljs-string">"""顺序链示例（新版 Runnable API，实现与 SequentialChain 等价）"""</span>
    <span class="hljs-comment"># 初始化模型</span>
    llm = ChatOllama(
        model=<span class="hljs-string">"qwen2.5:7b"</span>,
        temperature=<span class="hljs-number">0.7</span>,
    )

    <span class="hljs-comment"># Step 1: 生成标题</span>
    title_prompt = PromptTemplate(
        input_variables=[<span class="hljs-string">"topic"</span>],
        template=<span class="hljs-string">"请为以下主题写一个标题：{topic}"</span>
    )
    title_chain = title_prompt | llm

    <span class="hljs-comment"># Step 2: 生成大纲</span>
    outline_prompt = PromptTemplate(
        input_variables=[<span class="hljs-string">"title"</span>],
        template=<span class="hljs-string">"请根据以下标题写一段简介：{title}"</span>
    )
    outline_chain = outline_prompt | llm

    <span class="hljs-comment"># Step 3: 生成开头</span>
    intro_prompt = PromptTemplate(
        input_variables=[<span class="hljs-string">"title"</span>, <span class="hljs-string">"outline"</span>],
        template=<span class="hljs-string">"""
        文章标题：{title}
        文章大纲：{outline}
        请根据以上信息，写一段引人入胜的开头（100字左右）  
        """</span> 
    )
    intro_chain = intro_prompt | llm

    <span class="hljs-comment"># 创建顺序链式调用</span>
    <span class="hljs-comment"># 创建顺序链式调用</span>
    <span class="hljs-comment"># 注意：RunnableSequence 不接受 steps 参数，应使用 | 运算符连接</span>
    <span class="hljs-comment"># RunnablePassthrough	无修改透传输入	输出 = 输入（数据完全不变）</span>
    <span class="hljs-comment"># RunnablePassthrough.assign()	透传输入 + 新增 / 更新字段	输出 = 原有输入 + 新字段（增量扩展）</span>
    overall_chain = (
        RunnablePassthrough() <span class="hljs-comment">#这一步纯多余就是单纯的用一下 当做了解吧  Ai是永远猜不透人类的脑回路的 只有人类才能写出这样的代码既没用也无害哈哈哈哈</span>
        |RunnablePassthrough.assign(title=title_chain)
        | RunnablePassthrough.assign(outline=(<span class="hljs-keyword">lambda</span> x :{<span class="hljs-string">"title"</span>:x[<span class="hljs-string">"title"</span>].content}) | outline_chain) <span class="hljs-comment"># 透传输入 + 新增 / 更新字段, </span>
        | RunnablePassthrough.assign(introduction=(<span class="hljs-keyword">lambda</span> x :{<span class="hljs-string">"title"</span>:x[<span class="hljs-string">"title"</span>].content,<span class="hljs-string">"outline"</span>:x[<span class="hljs-string">"outline"</span>].content}) | intro_chain)<span class="hljs-comment"># 透传输入 + 新增 / 更新字段</span>
    )

    <span class="hljs-comment"># 运行顺序链式调用</span>
    result = overall_chain.invoke({<span class="hljs-string">"topic"</span>: <span class="hljs-string">"量子计算的实际用例"</span>})

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"顺序链执行结果："</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n标题：\n"</span>, result[<span class="hljs-string">"title"</span>].content)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n大纲：\n"</span>, result[<span class="hljs-string">"outline"</span>].content)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n开头段落：\n"</span>, result[<span class="hljs-string">"introduction"</span>].content)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)




<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
        simple_chain()
        sequential_chain()
</code></pre>
<p><strong>补充</strong></p>
<blockquote>
<p>LangChain 中构建顺序链主要有三种方式，核心逻辑等价但写法不同：</p>
<ol>
<li><strong><code>|</code>运算符</strong>：最简洁，直接串联组件（如<code>r1 | r2 | r3</code>），LangChain 推荐用法；</li>
<li><strong><code>RunnableSequence(组件1, 组件2)</code></strong>：显式通过位置参数构建，与<code>|</code>运算符功能一致；</li>
<li><strong><code>RunnableSequence.from_list([组件])</code></strong>：通过列表定义步骤，适合步骤较多时集中管理。</li>
</ol>
<p>三者本质都是实现组件的顺序执行，仅语法形式不同，可根据代码可读性和场景需求选择。</p>
</blockquote>
<p>版本 2：直接传入位置参数</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableSequence, RunnablePassthrough

<span class="hljs-comment"># 定义各步骤组件</span>
step1 = RunnablePassthrough.assign(title=title_chain)  <span class="hljs-comment"># 新增title字段</span>
step2 = RunnablePassthrough.assign(
    outline=(<span class="hljs-keyword">lambda</span> x: {<span class="hljs-string">"title"</span>: x[<span class="hljs-string">"title"</span>].content}) | outline_chain
)  <span class="hljs-comment"># 新增outline字段</span>
step3 = RunnablePassthrough.assign(
    introduction=(<span class="hljs-keyword">lambda</span> x: {<span class="hljs-string">"title"</span>: x[<span class="hljs-string">"title"</span>].content, <span class="hljs-string">"outline"</span>: x[<span class="hljs-string">"outline"</span>].content}) | intro_chain
)  <span class="hljs-comment"># 新增introduction字段</span>

<span class="hljs-comment"># 用RunnableSequence串联步骤（直接传位置参数）</span>
overall_chain = RunnableSequence(step1, step2, step3)
</code></pre>
<p>版本 3：用<code>from_list()</code>方法（更直观）</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableSequence, RunnablePassthrough

<span class="hljs-comment"># 定义步骤列表</span>
steps = [
    RunnablePassthrough.assign(title=title_chain),
    RunnablePassthrough.assign(
        outline=(<span class="hljs-keyword">lambda</span> x: {<span class="hljs-string">"title"</span>: x[<span class="hljs-string">"title"</span>].content}) | outline_chain
    ),
    RunnablePassthrough.assign(
        introduction=(<span class="hljs-keyword">lambda</span> x: {<span class="hljs-string">"title"</span>: x[<span class="hljs-string">"title"</span>].content, <span class="hljs-string">"outline"</span>: x[<span class="hljs-string">"outline"</span>].content}) | intro_chain
    )
]

<span class="hljs-comment"># 用from_list()创建RunnableSequence</span>
overall_chain = RunnableSequence.from_list(steps)
</code></pre>
<p><strong>输出结果：</strong></p>
<pre><code class="hljs language-bash" lang="bash">==================================================
链式调用结果：
<span class="hljs-string">"探索未来：人工智能的技术进步与应用前景"</span>
==================================================

==================================================
顺序链执行结果：

标题：
 量子计算的现实应用案例探究

大纲：
 量子计算作为一种前沿技术，利用量子力学原理进行信息处理和计算，具有超越传统计算机的强大潜力。本研究旨在探讨量子计算在现实世界中的具体应用案例，分析其如何解决实际问题并带来创新解决方案。

通过深入剖析不同行业领域的应用场景，如药物发现、金融建模、优化算法等，我们可以更清晰地看到量子计算技术的潜力和挑战。例如，在医药研发中，利用量子计算机模拟分子结构和反应过程，可以加速新药开发流程；在金融服务领域，量子计算能够处理复杂的风险分析与投资组合优化问题。

此外，本研究还将介绍当前实现这些应用的技术进展、面临的障碍及未来发展方向。通过对案例的详细解析，不仅有助于深化对量子计算技术的理解，也为相关领域的研究人员和从业者提供有价值的参考信息。

开头段落：
 在当今科技日新月异的时代，量子计算作为一种颠覆性的前沿技术，正逐渐揭开其神秘面纱。不同于传统计算机基于二进制原理的工作方式，量子计算机利用量子力学中的叠加态和纠缠态特性，实现了前所未有的信息处理速度与能力。从加速药物研发到优化金融投资组合，量子计算正在为解决复杂现实问题提供创新解决方案。本文将深入探讨这些应用案例，揭示其背后的技术奥秘与挑战，引领我们进入一个充满无限可能的新时代。
</code></pre>
<p><strong>流程理解  刚开始看稍微稍微有点抽象 不过理一就清晰多了</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
   A["输入：{'topic': '量子计算的实际用例'}"] --&gt; B["RunnablePassthrough.assign(title=title_chain)"]
   
   %% Step1：生成title
   B --&gt; C["title_chain执行：title_prompt + llm"]
   C --&gt; D["输出title结果（带.content属性）"]
   D --&gt; B1["上下文更新：{'topic': ..., 'title': 结果对象}"]
   
   %% Step2：生成outline
   B1 --&gt; E["RunnablePassthrough.assign(outline=lambda+outline_chain)"]
   E --&gt; F["lambda提取：{'title': x['title'].content}"]
   F --&gt; G["outline_chain执行：outline_prompt + llm"]
   G --&gt; H["输出outline结果（带.content属性）"]
   H --&gt; E1["上下文更新：{'topic': ..., 'title': ..., 'outline': 结果对象}"]
   
   %% Step3：生成introduction
   E1 --&gt; I["RunnablePassthrough.assign(introduction=lambda+intro_chain)"]
   I --&gt; J["lambda提取：{'title': x['title'].content, 'outline': x['outline'].content}"]
   J --&gt; K["intro_chain执行：intro_prompt + llm"]
   K --&gt; L["输出introduction结果（带.content属性）"]
   L --&gt; M["最终上下文：{'topic': ..., 'title': ..., 'outline': ..., 'introduction': ...}"]
   
   %% 结果输出
   M --&gt; N["打印结果：title.content / outline.content / introduction.content"]
</code></pre>
<hr/>
<h4 data-id="heading-20">案例 4：对话记忆（Memory）</h4>
<p>在写这个demo的时候版本更新了langchain 正式的迈入了1.x的时代，随之后来的变化也是巨大的就好像我们下面的这个示例</p>
<p>旧版 Agent 依赖固定的<strong>硬编码循环</strong>（AgentExecutor），难以处理复杂的分支和多步任务。</p>
<p>LangChain v1 的目标是构建生产级、可定制的自主智能体，这要求流程具备<strong>状态管理和非线性决策能力</strong>。</p>
<p>因此，LangGraph 作为底层的<strong>状态机运行时</strong>，取代了旧的执行器，赋予 Agent 流程<strong>自定义的柔性</strong>。</p>
<p>伪代码公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>v</mi><mn>1</mn><mi mathvariant="normal">_</mi><mi>A</mi><mi>g</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>≡</mo><mi>G</mi><mi>r</mi><mi>a</mi><mi>p</mi><mi>h</mi><mo stretchy="false">(</mo><mtext>State</mtext><munderover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>Tool Output</mtext></mpadded><mpadded width="+0.6em" lspace="0.3em"><mtext>Node Logic</mtext></mpadded></munderover><mtext>Next Step</mtext><mo stretchy="false">)</mo><mtext>v1_Agent</mtext><mo>≡</mo><mtext>图</mtext><mo stretchy="false">(</mo><mtext>当前状态</mtext><munderover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>工具输出</mtext></mpadded><mpadded width="+0.6em" lspace="0.3em"><mtext>决策函数</mtext></mpadded></munderover><mtext>下一节点</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v1\_Agent \equiv Graph(\text{State} \xrightarrow[\text{Tool Output}]{\text{Node Logic}} \text{Next Step})
\text{v1\_Agent} \equiv \text{图}(\text{当前状态} \xrightarrow[\text{工具输出}]{\text{决策函数}} \text{下一节点})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord" style="margin-right:0.02778em;">1_</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8523em;vertical-align:-0.7442em;"/><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord text"><span class="mord">State</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Node Logic</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"/><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewbox="0 0 400000 522" preserveaspectratio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128&#10;-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20&#10; 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7&#10; 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85&#10;-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5&#10;-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67&#10; 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span><span style="top:-2.0919em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Tool Output</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7442em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">Next Step</span></span><span class="mclose">)</span><span class="mord text"><span class="mord">v1_Agent</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.7007em;vertical-align:-0.6003em;"/><span class="mord text"><span class="mord cjk_fallback">图</span></span><span class="mopen">(</span><span class="mord text"><span class="mord cjk_fallback">当前状态</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1003em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">决策函数</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"/><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewbox="0 0 400000 522" preserveaspectratio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128&#10;-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20&#10; 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7&#10; 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85&#10;-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5&#10;-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67&#10; 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span><span style="top:-2.0997em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">工具输出</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6003em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord cjk_fallback">下一节点</span></span><span class="mclose">)</span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>v1_Agent</mtext><mo>≡</mo><mtext>图</mtext><mo stretchy="false">(</mo><mtext>当前状态</mtext><munderover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>工具输出</mtext></mpadded><mpadded width="+0.6em" lspace="0.3em"><mtext>决策函数</mtext></mpadded></munderover><mtext>下一节点</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{v1\_Agent} \equiv \text{图}(\text{当前状态} \xrightarrow[\text{工具输出}]{\text{决策函数}} \text{下一节点})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9933em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">v1_Agent</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.7007em;vertical-align:-0.6003em;"/><span class="mord text"><span class="mord cjk_fallback">图</span></span><span class="mopen">(</span><span class="mord text"><span class="mord cjk_fallback">当前状态</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1003em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">决策函数</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"/><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewbox="0 0 400000 522" preserveaspectratio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128&#10;-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20&#10; 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7&#10; 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85&#10;-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5&#10;-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67&#10; 151.7 139 205zm0 0v40h399900v-40z"/></svg></span></span><span style="top:-2.0997em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">工具输出</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6003em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord cjk_fallback">下一节点</span></span><span class="mclose">)</span></span></span></span></span></div>
<hr/>
<p>创建文件 <code>demo4_memory.py</code>：
下面的demo将会分为两个函数一个是以前的方法旨在用来比较以前和现在的区别。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
案例 4：对话记忆
展示如何让 AI 记住之前的对话内容

 这里不再说明为何没有引入 openai 库，请参考 README.md 中的说明 以及dotenv 文件配置说明
"""</span>
<span class="hljs-keyword">from</span> langchain_ollama <span class="hljs-keyword">import</span> ChatOllama
<span class="hljs-keyword">from</span> langchain_classic.chains <span class="hljs-keyword">import</span> ConversationChain
<span class="hljs-keyword">from</span> langchain_classic.memory <span class="hljs-keyword">import</span> ConversationBufferMemory <span class="hljs-comment"># 对话记忆</span>

<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> MemorySaver
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent<span class="hljs-comment"># from dotenv import load_dotenv</span>
<span class="hljs-comment"># load_dotenv()</span>

<span class="hljs-keyword">def</span>  <span class="hljs-title function_">conversation_with_memory</span>():
    <span class="hljs-string">"""带有对话记忆的聊天示例"""</span>

    <span class="hljs-comment"># 初始化模型</span>
    llm = ChatOllama(
        model=<span class="hljs-string">"qwen3-coder:30b"</span>,
        temperature=<span class="hljs-number">0.7</span>,
    )

    <span class="hljs-comment"># 创建记忆组件</span>
    <span class="hljs-comment"># CoversationBufferMemory 会保存对话的历史记录，并在每次调用模型时将其作为上下文传递</span>
    memory = ConversationBufferMemory()

    <span class="hljs-comment"># 创建对话链</span>
    conversation = ConversationChain(
        llm=llm,
        memory=memory,
        verbose = <span class="hljs-literal">True</span> <span class="hljs-comment"># 是否打印详细日志</span>
     )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始多轮对话（带记忆）："</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-comment"># 第一次对话</span>
    response1 =conversation.invoke(<span class="hljs-built_in">input</span>=<span class="hljs-string">"你好，我是Alben，是一名资深程序员"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n用户：你好，我是Alben，是一名资深程序员"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI：<span class="hljs-subst">{response1}</span>\n"</span>)
    


    <span class="hljs-comment"># 第二次对话</span>
    response2 = conversation.invoke(<span class="hljs-built_in">input</span>=<span class="hljs-string">"我最近在研究AI，想了解一下AI的发展趋势"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n用户：我最近在研究AI，想了解一下AI的发展趋势"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI：<span class="hljs-subst">{response2}</span>\n"</span>)

    <span class="hljs-comment">#第三次对话：检查记忆是否生效</span>
    response3 = conversation.invoke(<span class="hljs-built_in">input</span>=<span class="hljs-string">"你还记得我的名字吗？我最近在研究什么"</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"用户：你还记得我的名字吗？我最近在研究什么"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI：<span class="hljs-subst">{response3}</span>\n"</span>)


    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(memory.buffer) <span class="hljs-comment"># 打印对话历史</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)


<span class="hljs-comment"># 写法太旧了 不能用了</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">conversation_with_summary_memory</span>():
    <span class="hljs-string">"""使用摘要记忆的对话"""</span>
    
    <span class="hljs-comment"># 初始化模型</span>
    llm = ChatOllama(
        model=<span class="hljs-string">"qwen3-coder:30b"</span>,
        temperature=<span class="hljs-number">0.7</span>,
    )
    

    <span class="hljs-comment">#自动总结对话历史ConversationSummaryMemory</span>
    <span class="hljs-comment"># memory.buffer 可以获取对话历史，但会自动进行总结，</span>
    <span class="hljs-comment">#适合长对话，可以节省token</span>

    memory = ConversationSummaryMemory()



    <span class="hljs-comment"># 创建对话链</span>
    conversation = ConversationChain(
        llm=llm,
        verbose = <span class="hljs-literal">True</span> <span class="hljs-comment"># 是否打印详细日志</span>
     )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始多轮对话（不带记忆）："</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-comment"># 模拟多轮对话</span>
    conversation.predict(<span class="hljs-built_in">input</span>=<span class="hljs-string">"我今天去了公园，看到了很多花。"</span>)
    conversation.predict(<span class="hljs-built_in">input</span>=<span class="hljs-string">"公园里还有一个湖，湖面上有很多鸭子。"</span>)
    conversation.predict(<span class="hljs-built_in">input</span>=<span class="hljs-string">"我在公园待了两个小时，感觉很放松。"</span>) 
        <span class="hljs-comment"># 查看摘要</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n对话摘要："</span>)
    <span class="hljs-built_in">print</span>(memory.buffer)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">conversation_v1_modern</span>():
    <span class="hljs-string">"""LangChain v1 标准写法 (使用 LangGraph)"""</span>
    
    <span class="hljs-comment"># 1. 初始化模型</span>
    llm = ChatOllama(model=<span class="hljs-string">"qwen3-coder:30b"</span>, temperature=<span class="hljs-number">0.7</span>)

    <span class="hljs-comment"># 2. 初始化记忆保存器 (Checkpointer)</span>
    <span class="hljs-comment"># v1 不再区分 "Buffer" 还是 "Summary"，它直接把状态存到这里</span>
    memory = MemorySaver()

    <span class="hljs-comment"># 3. 创建 Agent (或者简单的图)</span>
    <span class="hljs-comment"># create_agent 自带了消息管理循环</span>
    agent = create_agent(model=llm, tools=[], checkpointer=memory)

    <span class="hljs-comment"># 4. 设定线程 ID (类似于用户 ID，用于区分不同对话的记忆)</span>
    config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"user_001"</span>}}

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始 LangGraph 对话 (自动持久化)："</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)

    <span class="hljs-comment"># 5. 第一轮</span>
    input_msg = <span class="hljs-string">"我今天去了公园，看到了很多花。"</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"User: <span class="hljs-subst">{input_msg}</span>"</span>)
    <span class="hljs-comment"># invoke 会自动读取 thread_id 对应的历史，拼接到 prompt 中</span>
    <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> agent.stream({<span class="hljs-string">"messages"</span>: [HumanMessage(content=input_msg)]}, config=config):
        <span class="hljs-keyword">if</span> <span class="hljs-string">"agent"</span> <span class="hljs-keyword">in</span> event:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI: <span class="hljs-subst">{event[<span class="hljs-string">'agent'</span>][<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)

    <span class="hljs-comment"># 6. 第二轮 (它会自动记得上一轮)</span>
    input_msg = <span class="hljs-string">"我刚才说我在哪里？"</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nUser: <span class="hljs-subst">{input_msg}</span>"</span>)
    <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> agent.stream({<span class="hljs-string">"messages"</span>: [HumanMessage(content=input_msg)]}, config=config):
        <span class="hljs-keyword">if</span> <span class="hljs-string">"agent"</span> <span class="hljs-keyword">in</span> event:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"AI: <span class="hljs-subst">{event[<span class="hljs-string">'agent'</span>][<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
            
    <span class="hljs-comment"># 7. 查看当前保存的状态 (相当于旧版的 memory.buffer)</span>
    snapshot = agent.get_state(config)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n[当前记忆状态]："</span>)
    <span class="hljs-comment"># 这里保存了完整的对话历史列表</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(snapshot.values[<span class="hljs-string">'messages'</span>]), <span class="hljs-string">"条消息记录"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
        conversation_with_memory()
        <span class="hljs-comment"># conversation_with_summary_memory()</span>
        conversation_v1_modern()
</code></pre>
<p><strong>输出结果：</strong></p>
<pre><code class="hljs language-bash" lang="bash">==================================================
开始多轮对话（带记忆）：
==================================================


&gt; Entering new ConversationChain chain...
Prompt after formatting:
The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not 
know the answer to a question, it truthfully says it does not know.

Current conversation:

Human: 你好，我是Alben，是一名资深程序员
AI:

&gt; Finished chain.

用户：你好，我是Alben，是一名资深程序员
AI：{<span class="hljs-string">'input'</span>: <span class="hljs-string">'你好，我是Alben，是一名资深程序员'</span>, <span class="hljs-string">'history'</span>: <span class="hljs-string">''</span>, <span class="hljs-string">'response'</span>: <span class="hljs-string">'你好Alben！很高兴认识你这位资深程序员！作为一名资深程序员，你一定有很多丰富的编程经
验和技巧吧。我很好奇你主要专注于哪些编程语言和技术领域呢？是偏向后端开发、前端开发，还是其他特定的技术方向？我作为AI助手，虽然在很多编程相关的话题上都有所了解，但
很期待听听你作为资深程序员的实际经验和见解。'</span>}



&gt; Entering new ConversationChain chain...
Prompt after formatting:
The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not 
know the answer to a question, it truthfully says it does not know.

Current conversation:
Human: 你好，我是Alben，是一名资深程序员
AI: 你好Alben！很高兴认识你这位资深程序员！作为一名资深程序员，你一定有很多丰富的编程经验和技巧吧。我很好奇你主要专注于哪些编程语言和技术领域呢？是偏向后端开发、前
端开发，还是其他特定的技术方向？我作为AI助手，虽然在很多编程相关的话题上都有所了解，但很期待听听你作为资深程序员的实际经验和见解。
Human: 我最近在研究AI，想了解一下AI的发展趋势
AI:

&gt; Finished chain.

用户：我最近在研究AI，想了解一下AI的发展趋势
AI：{<span class="hljs-string">'input'</span>: <span class="hljs-string">'我最近在研究AI，想了解一下AI的发展趋势'</span>, <span class="hljs-string">'history'</span>: <span class="hljs-string">'Human: 你好，我是Alben，是一名资深程序员\nAI: 你好Alben！很高兴认识你这位资深程序员！作为一名资
深程序员，你一定有很多丰富的编程经验和技巧吧。我很好奇你主要专注于哪些编程语言和技术领域呢？是偏向后端开发、前端开发，还是其他特定的技术方向？我作为AI助手，虽然在 
很多编程相关的话题上都有所了解，但很期待听听你作为资深程序员的实际经验和见解。'</span>, <span class="hljs-string">'response'</span>: <span class="hljs-string">'很高兴你对AI发展趋势感兴趣，Alben！作为资深程序员，你对AI的关注非常及
时，因为AI正在深刻改变整个编程和开发领域。\n\n从我了解到的信息来看，AI发展趋势主要集中在几个方面：\n\n**技术层面**：\n- 大语言模型持续进化，推理能力和多模态处理能 
力不断提升\n- AutoML和AIGC（AI生成内容）技术快速发展\n- 边缘AI计算和模型压缩技术日趋成熟\n\n**应用层面**：\n- AI在代码生成、自动化测试、智能调试等方面应用越来越广 
泛\n- 企业级AI应用从试点走向规模化部署\n- AI与各行业深度融合，比如医疗、金融、制造等\n\n**对开发者的影响**：\n- 编程工具和IDE正在集成更多AI辅助功能\n- 低代码/无代 
码平台借助AI技术快速普及\n- 开发者需要掌握AI相关的技能，如模型微调、Prompt工程等\n\n作为程序员，你认为AI技术的哪个方面最值得重点关注？或者你已经在哪些具体场景中尝 
试过AI应用了？'</span>}



&gt; Entering new ConversationChain chain...
Prompt after formatting:
The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not 
know the answer to a question, it truthfully says it does not know.

Current conversation:
Human: 你好，我是Alben，是一名资深程序员
AI: 你好Alben！很高兴认识你这位资深程序员！作为一名资深程序员，你一定有很多丰富的编程经验和技巧吧。我很好奇你主要专注于哪些编程语言和技术领域呢？是偏向后端开发、前
端开发，还是其他特定的技术方向？我作为AI助手，虽然在很多编程相关的话题上都有所了解，但很期待听听你作为资深程序员的实际经验和见解。
Human: 我最近在研究AI，想了解一下AI的发展趋势
AI: 很高兴你对AI发展趋势感兴趣，Alben！作为资深程序员，你对AI的关注非常及时，因为AI正在深刻改变整个编程和开发领域。

从我了解到的信息来看，AI发展趋势主要集中在几个方面：

**技术层面**：
- 大语言模型持续进化，推理能力和多模态处理能力不断提升
- AutoML和AIGC（AI生成内容）技术快速发展
- 边缘AI计算和模型压缩技术日趋成熟

**应用层面**：
- AI在代码生成、自动化测试、智能调试等方面应用越来越广泛
- 企业级AI应用从试点走向规模化部署
- AI与各行业深度融合，比如医疗、金融、制造等

**对开发者的影响**：
- 编程工具和IDE正在集成更多AI辅助功能
- 低代码/无代码平台借助AI技术快速普及
- 开发者需要掌握AI相关的技能，如模型微调、Prompt工程等

作为程序员，你认为AI技术的哪个方面最值得重点关注？或者你已经在哪些具体场景中尝试过AI应用了？
Human: 你还记得我的名字吗？我最近在研究什么
AI:

&gt; Finished chain.
用户：你还记得我的名字吗？我最近在研究什么
AI：{<span class="hljs-string">'input'</span>: <span class="hljs-string">'你还记得我的名字吗？我最近在研究什么'</span>, <span class="hljs-string">'history'</span>: <span class="hljs-string">'Human: 你好，我是Alben，是一名资深程序员\nAI: 你好Alben！很高兴认识你这位资深程序员！作为一名资深
程序员，你一定有很多丰富的编程经验和技巧吧。我很好奇你主要专注于哪些编程语言和技术领域呢？是偏向后端开发、前端开发，还是其他特定的技术方向？我作为AI助手，虽然在很 
多编程相关的话题上都有所了解，但很期待听听你作为资深程序员的实际经验和见解。\nHuman: 我最近在研究AI，想了解一下AI的发展趋势\nAI: 很高兴你对AI发展趋势感兴趣，Alben 
！作为资深程序员，你对AI的关注非常及时，因为AI正在深刻改变整个编程和开发领域。\n\n从我了解到的信息来看，AI发展趋势主要集中在几个方面：\n\n**技术层面**：\n- 大语言 
模型持续进化，推理能力和多模态处理能力不断提升\n- AutoML和AIGC（AI生成内容）技术快速发展\n- 边缘AI计算和模型压缩技术日趋成熟\n\n**应用层面**：\n- AI在代码生成、自 
动化测试、智能调试等方面应用越来越广泛\n- 企业级AI应用从试点走向规模化部署\n- AI与各行业深度融合，比如医疗、金融、制造等\n\n**对开发者的影响**：\n- 编程工具和IDE正
在集成更多AI辅助功能\n- 低代码/无代码平台借助AI技术快速普及\n- 开发者需要掌握AI相关的技能，如模型微调、Prompt工程等\n\n作为程序员，你认为AI技术的哪个方面最值得重点
关注？或者你已经在哪些具体场景中尝试过AI应用了？'</span>, <span class="hljs-string">'response'</span>: <span class="hljs-string">'是的，我当然记得你的名字！你叫Alben，而且我清楚地记得你最近在研究AI。你刚才还跟我分享了你对AI发展趋
势的兴趣，还提到作为资深程序员，你对AI技术的各个层面都很关注，包括大语言模型、AutoML、AIGC、边缘AI计算等技术发展，以及AI在代码生成、自动化测试、智能调试等方面的应 
用。\n\n你之前还提到，你对AI对开发者影响的方面特别感兴趣，比如编程工具集成AI辅助功能、低代码/无代码平台的发展，以及开发者需要掌握的AI相关技能等。\n\n你当时还问我，
作为程序员，你觉得AI技术的哪个方面最值得重点关注？我印象很深呢！'</span>}

==================================================
Human: 你好，我是Alben，是一名资深程序员
AI: 你好Alben！很高兴认识你这位资深程序员！作为一名资深程序员，你一定有很多丰富的编程经验和技巧吧。我很好奇你主要专注于哪些编程语言和技术领域呢？是偏向后端开发、前
端开发，还是其他特定的技术方向？我作为AI助手，虽然在很多编程相关的话题上都有所了解，但很期待听听你作为资深程序员的实际经验和见解。
Human: 我最近在研究AI，想了解一下AI的发展趋势
AI: 很高兴你对AI发展趋势感兴趣，Alben！作为资深程序员，你对AI的关注非常及时，因为AI正在深刻改变整个编程和开发领域。

从我了解到的信息来看，AI发展趋势主要集中在几个方面：

**技术层面**：
- 大语言模型持续进化，推理能力和多模态处理能力不断提升
- AutoML和AIGC（AI生成内容）技术快速发展
- 边缘AI计算和模型压缩技术日趋成熟

**应用层面**：
- AI在代码生成、自动化测试、智能调试等方面应用越来越广泛
- 企业级AI应用从试点走向规模化部署
- AI与各行业深度融合，比如医疗、金融、制造等

**对开发者的影响**：
- 编程工具和IDE正在集成更多AI辅助功能
- 低代码/无代码平台借助AI技术快速普及
- 开发者需要掌握AI相关的技能，如模型微调、Prompt工程等

作为程序员，你认为AI技术的哪个方面最值得重点关注？或者你已经在哪些具体场景中尝试过AI应用了？
Human: 你还记得我的名字吗？我最近在研究什么
AI: 是的，我当然记得你的名字！你叫Alben，而且我清楚地记得你最近在研究AI。你刚才还跟我分享了你对AI发展趋势的兴趣，还提到作为资深程序员，你对AI技术的各个层面都很关注
，包括大语言模型、AutoML、AIGC、边缘AI计算等技术发展，以及AI在代码生成、自动化测试、智能调试等方面的应用。

你之前还提到，你对AI对开发者影响的方面特别感兴趣，比如编程工具集成AI辅助功能、低代码/无代码平台的发展，以及开发者需要掌握的AI相关技能等。

你当时还问我，作为程序员，你觉得AI技术的哪个方面最值得重点关注？我印象很深呢！
==================================================
==================================================
开始 LangGraph 对话 (自动持久化)：
==================================================
User: 我今天去了公园，看到了很多花。

User: 我刚才说我在哪里？

[当前记忆状态]：
4 条消息记录
</code></pre>
<hr/>
<h4 data-id="heading-21">进阶示例</h4>
<h4 data-id="heading-22">案例 5：文档问答系统</h4>
<blockquote>
<p>该 Demo 是一个 <strong>LangChain v1 LCEL</strong> 的标准 RAG 实现，使用 <strong>Ollama</strong> 进行本地部署。有些小前提</p>
</blockquote>
<h6 data-id="heading-23">必要的安装包</h6>
<p>为了运行这个本地 RAG 系统，您需要安装以下 Python 包，并确保本地 Ollama 服务已启动且模型已拉取：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 核心 LCEL 依赖通常随其他包安装，但我们明确列出所需功能包：</span>
pip install -U langchain-ollama langchain-community langchain-text-splitters
pip install -U chroma-db 
</code></pre>
<h4 data-id="heading-24">Ollama 模型准备 (命令行操作)</h4>
<p>确保您的 Ollama 服务正在运行，并拉取了以下模型：</p>
<ol>
<li>
<p><strong>嵌入模型 (Embedding Model):</strong> 用于向量化文档。</p>
<p>Bash</p>
<pre><code class="hljs language-bash" lang="bash">ollama pull nomic-embed-text
</code></pre>
</li>
<li>
<p><strong>聊天模型 (Chat Model):</strong> 用于问答生成。</p>
<p>Bash</p>
<pre><code class="hljs language-bash" lang="bash">ollama pull qwen2.5:7b
有条件的
ollma pull qwen3-coder:30b
</code></pre>
<p>因为我这里有两套环境 Mac 7b Windows就用30b所以会出现上下的demo 使用的模型出现些许的出入，这点在这里也做一个说明，防止看着些的朋友出现一些困惑。</p>
<hr/>
</li>
</ol>
<p>创建文件 <code>demo5_document_qa.py</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
案例 5：文档问答系统 (Ollama 纯本地 RAG 版本)
Embedding 和 Chat 模型均使用 Ollama。

请确保已在 Ollama 中拉取了嵌入模型 (如 nomic-embed-text)。
运行命令示例：ollama pull nomic-embed-text
"""</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-comment"># from dotenv import load_dotenv # ❌ 不再需要，因为没有外部 API Key</span>
<span class="hljs-comment"># import os # 保留，用于文件操作</span>

<span class="hljs-comment"># V1 核心组件导入 (来自 langchain_core)</span>
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnablePassthrough
<span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser

<span class="hljs-comment"># V1 专用包导入 (修正了 text_splitter 的路径)</span>
<span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter 

<span class="hljs-comment"># V1 社区/技术组件导入</span>
<span class="hljs-keyword">from</span> langchain_ollama <span class="hljs-keyword">import</span> ChatOllama, OllamaEmbeddings <span class="hljs-comment"># ✅ 新增 OllamaEmbeddings </span>
<span class="hljs-comment"># from langchain_openai import OpenAIEmbeddings # ❌ 不再需要</span>

<span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> Chroma 
<span class="hljs-keyword">from</span> langchain_community.document_loaders <span class="hljs-keyword">import</span> TextLoader

<span class="hljs-comment"># load_dotenv() # ❌ 不再需要加载 .env 文件</span>

<span class="hljs-comment"># --- 辅助函数：格式化文档 (取代 chain_type="stuff") ---</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">format_docs</span>(<span class="hljs-params">docs</span>):
    <span class="hljs-string">"""将检索到的文档列表格式化为一个单独的字符串，用于注入 Prompt。"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"\n\n"</span>.join(doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs)

<span class="hljs-comment"># --- 辅助函数：创建示例文档 ---</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_sample_document</span>():
    <span class="hljs-comment"># ... (函数体与内容保持不变)</span>
    content = <span class="hljs-string">"""
    Python 是一种高级编程语言，由 Guido van Rossum 于 1991 年首次发布。
    Python 的设计哲学强调代码的可读性和简洁的语法，使用缩进来表示代码块。
    
    Python 具有以下特点：
    1. 简单易学：Python 的语法简洁明了，适合初学者。
    2. 功能强大：拥有丰富的标准库和第三方库。
    3. 跨平台：可以在 Windows、macOS、Linux 等操作系统上运行。
    4. 解释型语言：无需编译，可以直接运行。
    5. 面向对象：支持面向对象编程范式。
    
    Python 的应用领域非常广泛：
    - Web 开发：使用 Django、Flask 等框架
    - 数据科学：使用 NumPy、Pandas、Matplotlib 等库
    - 人工智能：使用 TensorFlow、PyTorch 等框架
    - 自动化运维：使用 Ansible、Fabric 等工具
    - 爬虫开发：使用 Scrapy、BeautifulSoup 等库
    
    Python 的版本历史：
    - Python 2.x：2000 年发布，2020 年停止维护
    - Python 3.x：2008 年发布，是当前主流版本
    """</span>
    
    doc_path = <span class="hljs-string">"python_intro.txt"</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(doc_path, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        f.write(content)
    
    <span class="hljs-keyword">return</span> doc_path

<span class="hljs-comment"># --- 核心 RAG 逻辑函数 (v1 LCEL) ---</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">document_qa_system_v1</span>():
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"创建文档问答系统 (Ollama 纯本地版)..."</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    
    <span class="hljs-comment"># 步骤 1-2：创建、加载、分割文档</span>
    doc_path = create_sample_document()
    loader = TextLoader(doc_path, encoding=<span class="hljs-string">"utf-8"</span>)
    documents = loader.load()
    text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="hljs-number">200</span>, chunk_overlap=<span class="hljs-number">50</span>)
    texts = text_splitter.split_documents(documents)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✓ 已分割文档，共 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(texts)}</span> 个片段"</span>)
    
    <span class="hljs-comment"># 步骤 3：创建向量存储和检索器</span>
    <span class="hljs-comment"># 🌟 关键修改：使用 OllamaEmbeddings</span>
    <span class="hljs-comment"># 请确保 'nomic-embed-text' (或你选择的任何 Ollama 嵌入模型) 已拉取</span>
    embeddings = OllamaEmbeddings(model=<span class="hljs-string">"nomic-embed-text"</span>) 
    
    vectorstore = Chroma.from_documents(documents=texts, embedding=embeddings)
    retriever = vectorstore.as_retriever(search_kwargs={<span class="hljs-string">"k"</span>: <span class="hljs-number">3</span>})
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"✓ 已创建向量存储和检索器 (使用 Ollama Embedding)"</span>)
    
    <span class="hljs-comment"># 步骤 4：定义 LLM 和 Prompt</span>
    llm = ChatOllama(model=<span class="hljs-string">"qwen3-coder:30b"</span>, temperature=<span class="hljs-number">0</span>) <span class="hljs-comment"># Ollama Chat Model 保持不变</span>
    
    prompt = ChatPromptTemplate.from_template(<span class="hljs-string">"""
        你是一个专业的问答助手，请基于提供的上下文 (Context) 来回答问题 (Question)。
        如果上下文中没有足够的信息，请说明你无法找到相关信息。
        
        ---
        Context:
        {context}
        ---
        
        Question: {question}
        """</span>)

    <span class="hljs-comment"># 步骤 5-7：构建 LCEL Chain 和执行逻辑 (保持不变)</span>
    
    rag_chain_core = (
        RunnablePassthrough.assign(
            context=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">"context"</span>]
        )
        | prompt
        | llm
        | StrOutputParser()
    )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_source_and_answer</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>):
        source_documents = retriever.invoke(query)
        chain_input = {
            <span class="hljs-string">"question"</span>: query,
            <span class="hljs-string">"context"</span>: format_docs(source_documents)
        }
        result = rag_chain_core.invoke(chain_input)
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"query"</span>: query,
            <span class="hljs-string">"result"</span>: result,
            <span class="hljs-string">"source_documents"</span>: source_documents,
        }
        
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"✓ 已创建 LCEL RAG 包装函数"</span>)

    <span class="hljs-comment"># 进行问答</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始问答："</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    
    questions = [
        <span class="hljs-string">"Python 是谁发明的？"</span>,
        <span class="hljs-string">"Python 有哪些特点？"</span>,
        <span class="hljs-string">"Python 可以用于哪些领域？"</span>,
        <span class="hljs-string">"Python 2 什么时候停止维护的？"</span>
    ]
    
    <span class="hljs-keyword">for</span> question <span class="hljs-keyword">in</span> questions:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n问题：<span class="hljs-subst">{question}</span>"</span>)
        result = get_source_and_answer(question)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"答案：<span class="hljs-subst">{result[<span class="hljs-string">'result'</span>]}</span>"</span>)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n引用的文档片段："</span>)
        <span class="hljs-keyword">for</span> i, doc <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(result[<span class="hljs-string">'source_documents'</span>], <span class="hljs-number">1</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  片段 <span class="hljs-subst">{i}</span>：<span class="hljs-subst">{doc.page_content[:<span class="hljs-number">100</span>]}</span>..."</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
        
    <span class="hljs-comment"># 清理临时文件</span>
    os.remove(doc_path)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n✓ 已清理临时文件"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    document_qa_system_v1()
</code></pre>
<p><strong>输出结果：</strong></p>
<pre><code class="hljs language-bash" lang="bash">==================================================
创建文档问答系统 (Ollama 纯本地版)...
==================================================
✓ 已分割文档，共 4 个片段
✓ 已创建向量存储和检索器 (使用 Ollama Embedding)
✓ 已创建 LCEL RAG 包装函数

==================================================
开始问答：
==================================================

问题：Python 是谁发明的？
答案：根据提供的上下文信息，Python 是由 Guido van Rossum 发明的。他在 1991 年首次发布了这门编程语言。

引用的文档片段：
  片段 1：Python 是一种高级编程语言，由 Guido van Rossum 于 1991 年首次发布。
    Python 的设计哲学强调代码的可读性和简洁的语法，使用缩进来表示代码块。    
    
  ...
  片段 2：- 爬虫开发：使用 Scrapy、BeautifulSoup 等库
    
    Python 的版本历史：
    - Python 2.x：2000 年发布，2020 年停止维护
    - ...
  片段 3：2. 功能强大：拥有丰富的标准库和第三方库。
    3. 跨平台：可以在 Windows、macOS、Linux 等操作系统上运行。
    4. 解释型语言：无需编译，可以直接运行。
    5....
--------------------------------------------------

问题：Python 有哪些特点？
答案：根据提供的上下文，Python 具有以下特点：

1. **简单易学**：Python 的语法简洁明了，适合初学者。
2. **功能强大**：拥有丰富的标准库和第三方库。
3. **跨平台**：可以在 Windows、macOS、Linux 等操作系统上运行。
4. **解释型语言**：无需编译，可以直接运行。
5. **面向对象**：支持面向对象编程范式。
6. **代码可读性强**：强调代码的可读性和简洁的语法，使用缩进来表示代码块。

这些特点使得 Python 成为一门既易于学习又功能强大的编程语言。

引用的文档片段：
  片段 1：Python 是一种高级编程语言，由 Guido van Rossum 于 1991 年首次发布。
    Python 的设计哲学强调代码的可读性和简洁的语法，使用缩进来表示代码块。

  ...
  片段 2：- 爬虫开发：使用 Scrapy、BeautifulSoup 等库

    Python 的版本历史：
    - Python 2.x：2000 年发布，2020 年停止维护
    - ...
  片段 3：2. 功能强大：拥有丰富的标准库和第三方库。
    3. 跨平台：可以在 Windows、macOS、Linux 等操作系统上运行。
    4. 解释型语言：无需编译，可以直接运行。
    5....
--------------------------------------------------

问题：Python 可以用于哪些领域？
答案：根据提供的上下文信息，Python 可以用于以下领域：

1. **Web 开发**：使用 Django、Flask 等框架
2. **爬虫开发**：使用 Scrapy、BeautifulSoup 等库

此外，虽然上下文中没有明确提到，但根据 Python 的特点（如功能强大、跨平台、解释型语言、面向对象等），它还可以应用于：
- 数据分析和科学计算
- 人工智能和机器学习
- 自动化脚本
- 软件开发
- 网络编程等

不过，基于上下文直接提供的信息，主要提到了 Web 开发和爬虫开发这两个领域。

引用的文档片段：
  片段 1：Python 是一种高级编程语言，由 Guido van Rossum 于 1991 年首次发布。
    Python 的设计哲学强调代码的可读性和简洁的语法，使用缩进来表示代码块。

  ...
  片段 2：- 爬虫开发：使用 Scrapy、BeautifulSoup 等库

    Python 的版本历史：
    - Python 2.x：2000 年发布，2020 年停止维护
    - ...
  片段 3：2. 功能强大：拥有丰富的标准库和第三方库。
    3. 跨平台：可以在 Windows、macOS、Linux 等操作系统上运行。
    4. 解释型语言：无需编译，可以直接运行。
    5....
--------------------------------------------------

问题：Python 2 什么时候停止维护的？
答案：根据提供的上下文，Python 2.x 版本于 **2020 年停止维护**。

引用的文档片段：
  片段 1：Python 是一种高级编程语言，由 Guido van Rossum 于 1991 年首次发布。
    Python 的设计哲学强调代码的可读性和简洁的语法，使用缩进来表示代码块。

  ...
  片段 2：- 爬虫开发：使用 Scrapy、BeautifulSoup 等库

    Python 的版本历史：
    - Python 2.x：2000 年发布，2020 年停止维护
    - ...
  片段 3：2. 功能强大：拥有丰富的标准库和第三方库。
    3. 跨平台：可以在 Windows、macOS、Linux 等操作系统上运行。
    4. 解释型语言：无需编译，可以直接运行。
    5....
--------------------------------------------------

✓ 已清理临时文件

</code></pre>
<h5 data-id="heading-25">📝 代码结构和流程说明</h5>
<ol>
<li><strong>数据准备 (Data Preparation):</strong>
<ul>
<li>使用 <code>TextLoader</code> 加载本地文件。</li>
<li>使用 <code>RecursiveCharacterTextSplitter</code> 将大文档分割成小片段 (<code>texts</code>)，确保上下文不会丢失。</li>
<li>使用 <code>OllamaEmbeddings</code> 将这些片段转换为向量，并存储到 <code>Chroma</code> 数据库。</li>
</ul>
</li>
<li><strong>RAG 链定义 (LCEL Chain Definition):</strong>
<ul>
<li><code>rag_chain_core</code> 定义了问答的逻辑流：先接收输入-&gt; 结合 Prompt -&gt;调用 LLM -&gt; 解析输出。</li>
<li><code>get_source_and_answer</code> 是一个包装函数，负责执行 <strong>检索</strong> (<code>retriever.invoke(query)</code>)，然后将检索结果（<code>context</code>）和原始问题一起传入核心 LCEL Chain 中生成答案。</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph Prepare["准备阶段 (仅运行一次)"]
        A[文档内容] --&gt; B(文本分割器);
        B --&gt; C(OllamaEmbeddings);
        C --&gt; D[Chroma 向量数据库];
    end

    subgraph Execute["运行阶段 (每轮问答)"]
        Q[用户问题 Query] --&gt; |1. 转换为向量| R(Retriever 检索器);
        R --&gt; F{获取 K 个最相关的文档片段};
        Q --&gt; G[原始问题];
        F --&gt; H[格式化函数 format_docs];
        H --&gt; I{Context 上下文};
        I &amp; G --&gt; J[ChatPromptTemplate];
        J --&gt; K(ChatOllama LLM);
        K --&gt; L[StrOutputParser];
        L --&gt; M[最终答案 Answer];
    end
</code></pre>
<h6 data-id="heading-26">总结:</h6>
<p>通过以上的实践，你就已经完成了一个最基础的的本地RAG了。如果你也在学习那么是不是也会觉得有点意思。</p>
<hr/>
<h4 data-id="heading-27">案例 6：使用 Agent（代理）</h4>
<p>首先了解一下工作的流程:</p>
<pre><code class="hljs language-mermaid" lang="mermaid">%% ReAct 循环（LangChain v1 最小版）
flowchart TD
    A[用户提问] --&gt; B[create_agent 入口]
    B --&gt; C{ReAct Prompt\n+ 工具描述}
    C --&gt; D[LLM 生成 Thought\n+ Action]
    D --&gt; E[工具调用]
    E --&gt; F[Observation]
    F --&gt; G{足够信息?}
    G --&gt;|否| D
    G --&gt;|是| H[LLM 生成 Final Answer]
    H --&gt; I[结果输出]
</code></pre>
<hr/>
<p>创建文件 <code>demo6_agent.py</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
案例 6：Agent（代理）展示如何让 AI 自主使用工具完成任务 (LangChain v1 最终版)

特点：
1. 纯本地 Agent，使用 Ollama qwen3-coder:30b 模型。
2. 采用简洁的 LangChain v1 LCEL 风格：create_agent 后直接 invoke()，无需 AgentExecutor。
"""</span>
<span class="hljs-comment"># ----------------------------------------------------</span>
<span class="hljs-comment"># 导入修正与核心组件</span>
<span class="hljs-comment"># ----------------------------------------------------</span>
<span class="hljs-keyword">from</span> langchain_ollama <span class="hljs-keyword">import</span> ChatOllama             <span class="hljs-comment"># 从 Ollama 包中导入聊天模型</span>
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent           <span class="hljs-comment"># V1 Agent 核心工厂函数，用于创建 Agent Runnable</span>
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool               <span class="hljs-comment"># 用于装饰 Python 函数，将其注册为 LLM 可用的工具</span>
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage    <span class="hljs-comment"># 用于格式化用户输入，符合 V1 Agent 的标准输入格式</span>
<span class="hljs-keyword">import</span> math                                         <span class="hljs-comment"># 供计算器工具使用的标准数学库</span>
<span class="hljs-comment"># ----------------------------------------------------</span>
<span class="hljs-comment"># 非 Ollama 环境相关内容 (已注释)</span>
<span class="hljs-comment"># from dotenv import load_dotenv </span>
<span class="hljs-comment"># load_dotenv() # 如果使用 OpenAI 等需要 API Key 的服务，此处用于加载环境变量</span>
<span class="hljs-comment"># ----------------------------------------------------</span>

<span class="hljs-comment"># --- 1. 工具定义：使用 @tool 装饰器实现自定义工具 ---</span>
<span class="hljs-comment"># 实现工具的意义在于，让 LLM 可以调用这些函数，完成特定的任务，补齐 LLM 的能力短板。</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculator</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""用于执行数学计算。输入应该是一个数学表达式，例如：'2 + 2' 或 'math.sqrt(16)'"""</span>
    <span class="hljs-comment"># 这个 Docstring 会被 Agent 读取，作为工具的使用说明</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># eval的作用是执行字符串形式的表达式，并返回结果</span>
        <span class="hljs-comment"># expression是传入的字符串形式的变量</span>
        <span class="hljs-comment"># 限制命名空间：{'__builtins__': None} 禁用所有内置函数，</span>
        <span class="hljs-comment"># 仅允许访问 'math' 库，以提高 eval 的安全性（虽然仍需谨慎）</span>
        result = <span class="hljs-built_in">eval</span>(expression, {<span class="hljs-string">"__builtins__"</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">"math"</span>: math}) 
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"计算结果：<span class="hljs-subst">{result}</span>"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"计算错误：<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""用于查询城市的天气情况。输入应该是一个城市名称，例如：'北京'"""</span>
    <span class="hljs-comment"># 这是一个模拟工具。在实际应用中，此函数体应该包含对外部天气 API 的调用逻辑。</span>
    weather_data = {
        <span class="hljs-string">"北京"</span>: <span class="hljs-string">"晴天，气温 20°C"</span>,
        <span class="hljs-string">"上海"</span>: <span class="hljs-string">"多云，气温 25°C"</span>,
        <span class="hljs-string">"深圳"</span>: <span class="hljs-string">"雨天，气温 28°C"</span>
    }
    <span class="hljs-keyword">return</span> weather_data.get(city, <span class="hljs-string">f"抱歉，没有 <span class="hljs-subst">{city}</span> 的天气数据"</span>)

<span class="hljs-comment"># --- 2. Agent 逻辑 ---</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">agent_example_v1</span>():
    <span class="hljs-string">"""Agent 示例 (LangChain v1 最小可运行版本)"""</span>
        
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"创建 Agent（LangChain v1 LCEL 最小版）..."</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
        
    <span class="hljs-comment"># 初始化 LLM 模型</span>
    <span class="hljs-comment"># 确保 Ollama 服务正在运行，并且 qwen3-coder:30b 模型已通过 ollama pull 拉取</span>
    llm = ChatOllama(model=<span class="hljs-string">"qwen3-coder:30b"</span>, temperature=<span class="hljs-number">0</span>) 
        
    <span class="hljs-comment"># 定义工具列表：将所有用 @tool 装饰的函数收集起来</span>
    tools = [calculator, get_weather] 
        
    <span class="hljs-comment"># ③ V1 核心：创建 Agent Runnable</span>
    <span class="hljs-comment"># create_agent 内部会生成一个 ReAct 模式的 Prompt，并将 tools 注册给 LLM。</span>
    <span class="hljs-comment"># 它返回一个 Runnable 对象，可直接调用。</span>
    agent = create_agent(llm, tools)
        
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"✓ Agent Runnable 已创建\n"</span>)
        
    <span class="hljs-comment"># 测试用例</span>
    test_cases = [
        <span class="hljs-string">"帮我计算 15 的平方根是多少"</span>,
        <span class="hljs-string">"北京今天天气怎么样？"</span>,
        <span class="hljs-string">"上海的天气如何，温度适合外出吗？"</span>,
        <span class="hljs-string">"请计算 (25 + 75) * 2 的结果"</span>
    ]
        
    <span class="hljs-keyword">for</span> i, query <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_cases, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"测试 <span class="hljs-subst">{i}</span>：<span class="hljs-subst">{query}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
                
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 🌟 V1 调用：直接 invoke Runnable</span>
            <span class="hljs-comment"># 输入格式：{"messages": [HumanMessage(content=query)]}</span>
            <span class="hljs-comment"># Agent 会根据这个输入开始它的 ReAct 循环（思考-&gt;调用工具-&gt;观察-&gt;再次思考）</span>
            result = agent.invoke(
                {<span class="hljs-string">"messages"</span>: [HumanMessage(content=query)]}
            )
            
            <span class="hljs-comment"># 最终答案：Agent 的输出是一个包含多轮思考和消息的字典。</span>
            <span class="hljs-comment"># 最终的答案（用户的回复）位于 messages 列表的最后一条消息中。</span>
            answer = result[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>].content
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n最终答案：<span class="hljs-subst">{answer}</span>\n"</span>) 
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># 捕获执行过程中的错误，例如 Ollama 服务中断或 LLM 解析失败</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n执行出错：<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>\n"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    agent_example_v1()
</code></pre>
<p><strong>输出结果：</strong></p>
<pre><code class="hljs language-bash" lang="bash">==================================================
创建 Agent（LangChain v1 LCEL 最小版）...
==================================================
✓ Agent Runnable 已创建

==================================================
测试 1：帮我计算 15 的平方根是多少
==================================================

最终答案：15 的平方根约等于 3.873。

==================================================
测试 2：北京今天天气怎么样？
==================================================

最终答案：北京今天天气晴朗，气温为 20°C。

==================================================
测试 3：上海的天气如何，温度适合外出吗？
==================================================

最终答案：上海目前天气多云，气温为25°C。这样的温度比较舒适，适合外出活动。不过建议携带一件薄外套，以防天气变化或早晚温差较大。

==================================================
测试 4：请计算 (25 + 75) * 2 的结果
==================================================

最终答案：计算结果为 200。


</code></pre>
<p><strong>源码速览</strong></p>
<ul>
<li><code>@tool</code>：把普通函数变成 LLM 可调用的 <strong>Action</strong></li>
<li><code>create_agent</code>：封装 ReAct Prompt，返回 <strong>Runnable</strong></li>
<li><code>invoke({"messages": [...]})</code>：v1 标准输入，<strong>最后一条消息</strong>即最终答案</li>
</ul>
<p><strong>小结</strong></p>
<p><strong>demo6</strong> 用最少的代码展示了 LangChain v1 的 ReAct Agent 全貌：本地模型、自定义工具、即创即跑，复制即可体验“让 AI 自己动脑子”。</p>
<hr/>
<h4 data-id="heading-28">运行所有示例</h4>
<p>创建文件 <code>run_all_demos.py</code>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
运行所有示例
"""</span>

<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_demo</span>(<span class="hljs-params">demo_name</span>):
    <span class="hljs-string">"""运行单个示例"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">70</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"运行 <span class="hljs-subst">{demo_name}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">70</span> + <span class="hljs-string">"\n"</span>)
    
    <span class="hljs-keyword">try</span>:
        subprocess.run([sys.executable, demo_name], check=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">except</span> subprocess.CalledProcessError <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"运行 <span class="hljs-subst">{demo_name}</span> 时出错：<span class="hljs-subst">{e}</span>"</span>)
    <span class="hljs-keyword">except</span> FileNotFoundError:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"找不到文件：<span class="hljs-subst">{demo_name}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    demos = [
        <span class="hljs-string">"demo1_basic.py"</span>,
        <span class="hljs-string">"demo2_prompt_template.py"</span>,
        <span class="hljs-string">"demo3_chains.py"</span>,
        <span class="hljs-string">"demo4_memory.py"</span>,
        <span class="hljs-string">"demo5_document_qa.py"</span>,
        <span class="hljs-string">"demo6_agent.py"</span>
    ]
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始运行所有 LangChain 示例..."</span>)
    
    <span class="hljs-keyword">for</span> demo <span class="hljs-keyword">in</span> demos:
        run_demo(demo)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span> * <span class="hljs-number">70</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"所有示例运行完成！"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">70</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<hr/>
<h3 data-id="heading-29">总结</h3>
<p>通过上面的的六个demo 相信你对langchin已经有了一个基本的认识了，为了节约很多同学的学习成本。</p>
<p>如果你的本地只有一台Mac  建议你使用ollama qwen2.5:7b 基本轻松无法压力。</p>
<p>那么如果你的预算比较充足或者你的本地的配置比较高
可以尝试和我使用同样的本地模型qwen3-coder:30b。</p>
<p><em><strong>6 个 demo 覆盖核心：调用 → 链 → 记忆 → RAG → Agent</strong></em></p>
<p><strong>下一篇我们讲《langchin深入》</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再让Claude乱写代码了！一个配置文件让AI准确率提升10%]]></title>    <link>https://juejin.cn/post/7576861477267079187</link>    <guid>https://juejin.cn/post/7576861477267079187</guid>    <pubDate>2025-11-26T15:04:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576861477267079187" data-draft-id="7577042546094817322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再让Claude乱写代码了！一个配置文件让AI准确率提升10%"/> <meta itemprop="keywords" content="Claude,AI编程,敏捷开发"/> <meta itemprop="datePublished" content="2025-11-26T15:04:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术探索家"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再让Claude乱写代码了！一个配置文件让AI准确率提升10%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术探索家
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T15:04:35.000Z" title="Wed Nov 26 2025 15:04:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec42c13f23f14ba1ba71ab6b7bedd781~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5o6i57Si5a62:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775779&amp;x-signature=rvQunk5btaRKYcHpLiS4xpeKV%2B8%3D" alt="CLAUDE.md编写技巧.jpg" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p>你有没有遇到过这种情况：满怀期待地打开Claude Code，结果它对你的项目一头雾水？明明是个React项目，它却给你生成Vue的代码；明明技术栈文档里写着用TypeScript，它偏偏输出一堆JavaScript。</p>
<p>我第一次用Claude Code的时候就踩了这个坑。当时在做一个Node.js后端项目，Claude自作主张用Express重写了我基于Koa的代码，导致整个中间件系统全部失效。那一刻我才意识到：AI再聪明，也需要你告诉它"游戏规则"。</p>
<p>解决方案比想象中简单——一个叫CLAUDE.md的配置文件。这个文件就像给AI发的一份"项目说明书"，告诉它你的技术栈、代码规范、工作流程。根据Anthropic的实际测试，配置良好的CLAUDE.md能让AI的编码准确率提升5%-10%，同时减少大量无效建议。</p>
<p>今天我想分享7个实战技巧，帮你写出真正有效的CLAUDE.md。这些技巧都是我踩过坑后总结出来的，每个都配有可以直接使用的示例代码。</p>
<h2 data-id="heading-1">CLAUDE.md到底是什么</h2>
<p>说白了，CLAUDE.md就是放在项目根目录的一个Markdown文件，专门用来指导Claude Code理解你的项目。它类似于<code>.editorconfig</code>或者<code>README.md</code>，但作用更具体——告诉AI该怎么帮你写代码。</p>
<p><strong>工作机制很直接</strong>：当你在项目里使用Claude Code时，它会自动读取这个文件。虽然官方文档说会自动加载，但社区经验告诉我们最好用<code>/init</code>命令显式提醒一次，确保AI已经"读懂"你的配置。文件内容会被加载到AI的上下文记忆里，影响它后续所有的代码生成和建议。</p>
<p>这里有个关键特性——Claude Code支持<strong>层级配置</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">project-root/

├── CLAUDE.md              <span class="hljs-comment"># 全局配置（整个项目通用）</span>
├── frontend/
│   └── .claude/
│       └── CLAUDE.md     <span class="hljs-comment"># 前端特定配置</span>
└── backend/
    └── .claude/
        └── CLAUDE.md     <span class="hljs-comment"># 后端特定配置</span>
</code></pre>
<p>这意味着你可以在根目录定义通用规范，然后在子模块里覆盖特定规则。比如前端用React，后端用Node.js，各自维护自己的配置。</p>
<h2 data-id="heading-2">四个核心总则</h2>
<p>写CLAUDE.md之前，先记住这四个原则。我一开始没注意这些，写了300多行的"史诗级"配置文件，结果Claude表现反而变差了。</p>
<h3 data-id="heading-3">1. 简洁性：100行以内原则</h3>
<p>老实说，这是我付出代价才学到的教训。CLAUDE.md不是README，不需要长篇大论。</p>
<p>为什么要简洁？从技术角度讲，Claude的上下文窗口虽然很大，但CLAUDE.md会占用你的token配额。文件越长，留给实际代码分析的token就越少。根据Arize AI的研究，100行以内的配置文件效果最佳。</p>
<p>❌ <strong>错误示例</strong>（冗长重复）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目简介</span>
这是一个基于React的前端项目。我们使用React来构建用户界面。
React是一个由Facebook开发的JavaScript库...（此处省略200字React介绍）

<span class="hljs-section"># 技术栈</span>
我们的技术栈包括以下内容：
<span class="hljs-bullet">-</span> React - 这是我们的UI框架，版本是18.2...
<span class="hljs-bullet">-</span> TypeScript - 我们用它来做类型检查...
</code></pre>
<p>✅ <strong>正确示例</strong>（精简直接）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 技术栈</span>
<span class="hljs-bullet">-</span> React 18.2 (Hooks优先，避免Class组件)
<span class="hljs-bullet">-</span> TypeScript (严格模式)
<span class="hljs-bullet">-</span> TailwindCSS (utilities优先)

<span class="hljs-section"># 代码规范</span>
<span class="hljs-bullet">-</span> 函数组件 + 自定义Hooks
<span class="hljs-bullet">-</span> Props解构赋值
<span class="hljs-bullet">-</span> 优先使用const，避免let
</code></pre>
<p>看到区别了吗？第二个版本只用了60个字符就传达了同样甚至更多的有效信息。</p>
<h3 data-id="heading-4">2. 特定性：说人话，别模糊</h3>
<p>这个原则听起来简单，但很容易犯错。</p>
<p>❌ <strong>错误示例</strong>（模糊不清）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 代码风格</span>
<span class="hljs-bullet">-</span> 保持代码简洁
<span class="hljs-bullet">-</span> 使用最佳实践
<span class="hljs-bullet">-</span> 注意性能优化
</code></pre>
<p>这种写法等于没写。什么叫"简洁"？什么叫"最佳实践"？AI根本没法执行。</p>
<p>✅ <strong>正确示例</strong>（具体可执行）：</p>
<pre><code class="hljs language-markdown" lang="markdown">
<span class="hljs-section"># 代码风格</span>
<span class="hljs-bullet">-</span> 单函数不超过50行，超过则拆分
<span class="hljs-bullet">-</span> API调用必须包含错误处理和loading状态
<span class="hljs-bullet">-</span> 列表渲染必须添加key属性，用ID而非index
<span class="hljs-bullet">-</span> 避免嵌套三元表达式，改用if/else或早期return
</code></pre>
<p>现在AI知道该做什么了。每条规则都是明确的、可验证的。</p>
<h3 data-id="heading-5">3. 可迭代性：别怕改，随时更新</h3>
<p>我见过有开发者在项目初期写了CLAUDE.md，然后半年都不碰它。结果项目从Vue 2迁移到Vue 3了，配置文件还在说"使用Options API"。</p>
<p><strong>用#键快速更新</strong>：这是我最喜欢的一个技巧。在Claude Code里，按<code>#</code>键可以快速引用和编辑CLAUDE.md。当你发现AI的行为不符合预期时，立刻改配置，不要拖延。</p>
<p>真实场景：上周我在做一个项目，Claude老是用<code>axios</code>生成代码，但我们团队已经统一用<code>fetch</code> + 自定义封装。我直接按<code>#</code>键，在CLAUDE.md里加了一行：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># HTTP请求</span>
<span class="hljs-bullet">-</span> 统一使用 <span class="hljs-code">`src/utils/request.ts`</span> 封装的fetch
<span class="hljs-bullet">-</span> 禁止直接使用axios或原生fetch
</code></pre>
<p>保存后，Claude就再也没犯过这个错误。</p>
<h3 data-id="heading-6">4. 团队共享：纳入版本控制</h3>
<p>这条很多人会忽略。CLAUDE.md必须提交到Git仓库，和<code>.gitignore</code>一样重要。</p>
<p>为什么？因为你的配置代表了团队的编码共识。如果每个人本地都有不同版本的CLAUDE.md，AI给张三生成的代码风格和给李四生成的完全不同，这就乱套了。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .gitignore 中不要忽略CLAUDE.md</span>
<span class="hljs-comment"># ❌ 错误做法</span>
*.md

<span class="hljs-comment"># ✅ 正确做法</span>
*.md
!CLAUDE.md
!README.md
</code></pre>
<p>而且要在Code Review时检查CLAUDE.md的变更。如果有人改了配置，整个团队都应该知道。</p>
<h2 data-id="heading-7">必须包含的5个内容模块</h2>
<p>这是我总结的最小可用配置。少了这些模块，CLAUDE.md基本没啥用。</p>
<h3 data-id="heading-8">1. 技术栈声明</h3>
<p>必须明确列出你用的框架、库和版本。这是最基础的。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 技术栈</span>
<span class="hljs-strong">**前端**</span>
<span class="hljs-bullet">-</span> Next.js 14 (App Router)
<span class="hljs-bullet">-</span> React 18 (Server Components优先)
<span class="hljs-bullet">-</span> TypeScript 5.2
<span class="hljs-bullet">-</span> Tailwind CSS 3.4

<span class="hljs-strong">**后端**</span>
<span class="hljs-bullet">-</span> Node.js 20 LTS
<span class="hljs-bullet">-</span> Express 4.18
<span class="hljs-bullet">-</span> Prisma ORM
<span class="hljs-bullet">-</span> PostgreSQL 15
</code></pre>
<p>注意我写了版本号。如果不写版本，Claude可能用旧API生成代码。比如Next.js 13和14的路由写法完全不同，不指定版本很危险。</p>
<h3 data-id="heading-9">2. 项目结构说明</h3>
<p>告诉AI你的文件是怎么组织的，这样它才能把代码放对位置。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目结构</span>
src/
├── app/              # Next.js页面路由
├── components/       # 可复用UI组件
│   ├── ui/          # 基础组件(Button, Input)
│   └── features/    # 业务组件(UserCard, OrderList)
├── lib/             # 工具函数和hooks
├── services/        # API调用层
└── types/           # TypeScript类型定义

<span class="hljs-section"># 文件命名</span>
<span class="hljs-bullet">-</span> 组件：PascalCase (UserProfile.tsx)
<span class="hljs-bullet">-</span> 工具函数：camelCase (formatDate.ts)
<span class="hljs-bullet">-</span> 常量：UPPER<span class="hljs-emphasis">_SNAKE_</span>CASE (API<span class="hljs-emphasis">_BASE_</span>URL)

</code></pre>
<p>有了这个，Claude就知道新建一个用户卡片组件应该放在<code>components/features/UserCard.tsx</code>，而不是随便找个地方。</p>
<h3 data-id="heading-10">3. 常用命令</h3>
<p>这部分经常被忽略，但超级有用。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 开发命令</span>
npm run dev          # 启动开发服务器(localhost:3000)
npm run build        # 生产构建
npm run test         # 运行Jest测试
npm run lint         # ESLint检查
npm run type-check   # TypeScript类型检查

<span class="hljs-section"># 数据库</span>
npx prisma studio    # 打开数据库GUI
npx prisma migrate dev  # 运行数据库迁移
</code></pre>
<p>为什么要写这个？因为Claude有时候需要验证代码或者运行测试，告诉它正确的命令能避免很多问题。</p>
<h3 data-id="heading-11">4. 代码风格规范</h3>
<p>这是重头戏。要写得足够具体。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 代码规范</span>
<span class="hljs-section">## React组件</span>
<span class="hljs-bullet">-</span> 使用函数组件 + Hooks，禁止Class组件
<span class="hljs-bullet">-</span> Props类型定义在组件上方，使用interface而非type
<span class="hljs-bullet">-</span> 组件内部顺序：Props定义 → 组件函数 → 导出

<span class="hljs-section">## 状态管理</span>
<span class="hljs-bullet">-</span> 本地状态：useState/useReducer
<span class="hljs-bullet">-</span> 服务器状态：TanStack Query
<span class="hljs-bullet">-</span> 全局状态：Zustand (避免使用Context)

<span class="hljs-section">## 错误处理</span>
<span class="hljs-bullet">-</span> API调用必须try-catch
<span class="hljs-bullet">-</span> 用户可见错误使用toast提示
<span class="hljs-bullet">-</span> 开发环境console.error，生产环境上报Sentry
</code></pre>
<h3 data-id="heading-12">5. 工作流和限制</h3>
<p>告诉AI什么能做、什么不能做。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 工作流</span>
<span class="hljs-bullet">-</span> 新功能开发：先写类型定义 → 写组件 → 写测试
<span class="hljs-bullet">-</span> 修Bug：先写复现测试 → 修复代码 → 验证测试通过

<span class="hljs-section"># 限制事项</span>
<span class="hljs-bullet">-</span> ❌ 不要修改 <span class="hljs-code">`/prisma/schema.prisma`</span> (需团队评审)
<span class="hljs-bullet">-</span> ❌ 不要安装新依赖包 (需在package.json review时讨论)
<span class="hljs-bullet">-</span> ❌ 不要修改 <span class="hljs-code">`/lib/auth/*`</span> (认证逻辑敏感)
<span class="hljs-bullet">-</span> ✅ 可以自由修改 <span class="hljs-code">`/components`</span> 和 <span class="hljs-code">`/app`</span> 下的业务代码
</code></pre>
<p>这能防止AI"好心办坏事"，误改关键代码。</p>
<h2 data-id="heading-13">7个让效果翻倍的实战技巧</h2>
<h3 data-id="heading-14">技巧1：用SHOULD/MUST强调优先级</h3>
<p>不是所有规则都同等重要。用关键词区分优先级。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 规范优先级</span>
<span class="hljs-strong">**MUST (必须遵守)**</span>
<span class="hljs-bullet">-</span> MUST 使用TypeScript严格模式
<span class="hljs-bullet">-</span> MUST 为所有API添加错误处理

<span class="hljs-strong">**SHOULD (推荐遵守)**</span>
<span class="hljs-bullet">-</span> SHOULD 组件不超过200行
<span class="hljs-bullet">-</span> SHOULD 提取重复逻辑为自定义Hook

<span class="hljs-strong">**COULD (可选)**</span>
<span class="hljs-bullet">-</span> COULD 添加JSDoc注释
</code></pre>
<p>这个技巧来自RFC规范文档的写法。用了之后，Claude明显对"MUST"的规则执行得更严格。</p>
<h3 data-id="heading-15">技巧2：善用/init命令</h3>
<p>虽然官方说CLAUDE.md会自动加载，但我强烈建议每次打开项目先运行<code>/init</code>命令。</p>
<pre><code class="hljs language-bash" lang="bash">你：/init
Claude：已加载项目配置，当前技术栈：React 18 + TypeScript...
</code></pre>
<p>这就像给AI"刷新"一下记忆。特别是当你刚改完CLAUDE.md，用<code>/init</code>能让变更立即生效。</p>
<h3 data-id="heading-16">技巧3：示例代码胜过千言万语</h3>
<p>与其描述规范，不如直接给示例。</p>
<p>❌ <strong>纯文字描述</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">-</span> API函数需要包含类型定义、错误处理和loading状态
</code></pre>
<p>✅ <strong>带示例代码</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># API调用规范</span>
参考示例：
\<span class="hljs-code">`\`</span>\`typescript
// src/services/user.ts
export async function getUser(id: string): Promise<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">User</span>&gt;</span></span> {
  try {
    const response = await fetch(<span class="hljs-code">`/api/users/${id}`</span>);
    if (!response.ok) throw new Error('Failed to fetch user');
    return await response.json();
  } catch (error) {
    console.error('getUser error:', error);
    throw error;
  }
}
\<span class="hljs-code">`\`</span>\`
所有API函数都遵循此模式：类型返回值 + try-catch + 错误日志
</code></pre>
<p>Claude看到示例后，生成的代码会非常接近你的期望。</p>
<h3 data-id="heading-17">技巧4：分层配置管理（Monorepo必备）</h3>
<p>如果你的项目是Monorepo架构，一定要用分层配置。</p>
<pre><code class="hljs language-bash" lang="bash">monorepo-root/
├── CLAUDE.md                    <span class="hljs-comment"># 全局：通用规范、Git工作流</span>
├── apps/
│   ├── web/
│   │   └── .claude/CLAUDE.md   <span class="hljs-comment"># Web应用：React + Next.js</span>
│   └── mobile/
│       └── .claude/CLAUDE.md   <span class="hljs-comment"># 移动端：React Native</span>
└── packages/
    └── shared/
        └── .claude/CLAUDE.md   <span class="hljs-comment"># 共享包：纯TS工具库</span>
</code></pre>
<p><strong>根目录CLAUDE.md</strong>（全局规范）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Monorepo通用规范</span>
<span class="hljs-bullet">-</span> 使用pnpm作为包管理器
<span class="hljs-bullet">-</span> 统一TypeScript配置继承自根目录tsconfig.json
<span class="hljs-bullet">-</span> Commit信息遵循Conventional Commits

<span class="hljs-section"># 工作流</span>
<span class="hljs-bullet">-</span> 代码修改前先运行 <span class="hljs-code">`pnpm install`</span>
<span class="hljs-bullet">-</span> 提交前运行 <span class="hljs-code">`pnpm run lint`</span> 检查所有包
</code></pre>
<p><strong>apps/web/.claude/CLAUDE.md</strong>（前端专属）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Web应用特定配置</span>
继承根目录规范，以下是额外配置：
<span class="hljs-bullet">-</span> 技术栈：Next.js 14 + React 18
<span class="hljs-bullet">-</span> 样式：Tailwind CSS
<span class="hljs-bullet">-</span> 状态管理：Zustand
</code></pre>
<p>Claude会先读取根目录配置，然后根据你当前工作目录读取子配置。这样就不用在每个子项目重复写通用规范了。</p>
<h3 data-id="heading-18">技巧5：用❌和✅做对比</h3>
<p>人类和AI都喜欢对比学习。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 状态更新规范</span>
❌ 错误：直接修改state
\<span class="hljs-code">`\`</span>\`typescript
const [user, setUser] = useState({name: 'John', age: 30});
user.age = 31; // 错误！直接修改了对象
\<span class="hljs-code">`\`</span>\`

✅ 正确：使用不可变更新
\<span class="hljs-code">`\`</span>\`typescript
const [user, setUser] = useState({name: 'John', age: 30});
setUser(prev =&gt; ({...prev, age: 31}));
\<span class="hljs-code">`\`</span>\`
</code></pre>
<p>这种对比让规则一目了然，Claude学习效率也更高。</p>
<h3 data-id="heading-19">技巧6：记录常见错误模式</h3>
<p>把团队经常犯的错误写进去，让AI帮你把关。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># ⚠️ 常见错误和避坑指南</span>
<span class="hljs-section">## 1. 忘记清理副作用</span>
❌ 问题代码：
\<span class="hljs-code">`\`</span>\`typescript
useEffect(() =&gt; {
  const timer = setInterval(() =&gt; {/* ... <span class="hljs-emphasis">*/}, 1000);
  // 忘记清理！
}, []);
\`\`\`

✅ 正确做法：
\`\`\`typescript
useEffect(() =&gt; {
  const timer = setInterval(() =&gt; {/*</span> ... <span class="hljs-emphasis">*/}, 1000);
  return () =&gt; clearInterval(timer); // 清理定时器
}, []);
\`\`\`

## 2. 缺失依赖项
如果ESLint提示依赖项缺失，不要禁用警告，要么添加依赖，要么用useCallback/useMemo优化
</span></code></pre>
<p>有了这个，Claude在生成代码时会主动避免这些坑。</p>
<h3 data-id="heading-20">技巧7：链接到详细文档</h3>
<p>CLAUDE.md要简洁，但可以链接到详细文档。</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 详细规范文档</span>
<span class="hljs-bullet">-</span> [<span class="hljs-string">API设计规范</span>](<span class="hljs-link">./docs/api-guidelines.md</span>) - RESTful API设计标准
<span class="hljs-bullet">-</span> [<span class="hljs-string">组件开发指南</span>](<span class="hljs-link">./docs/component-guide.md</span>) - 组件拆分和复用原则
<span class="hljs-bullet">-</span> [<span class="hljs-string">测试规范</span>](<span class="hljs-link">./docs/testing.md</span>) - 单元测试和集成测试要求
</code></pre>
<p>这样既保持了CLAUDE.md的简洁，又能在需要时提供详细信息。Claude可以通过这些链接获取更多上下文。</p>
<h2 data-id="heading-21">5个最容易踩的坑</h2>
<h3 data-id="heading-22">坑1：文件太长，塞一切内容</h3>
<p>新手最常犯的错误。把README、API文档、业务逻辑说明全塞进CLAUDE.md。</p>
<p><strong>问题</strong>：占用太多token，反而稀释了重要信息。</p>
<p><strong>解决</strong>：严格控制在100行以内，只写AI编码时真正需要的信息。</p>
<h3 data-id="heading-23">坑2：从不更新配置</h3>
<p>项目在变化，CLAUDE.md却一成不变。</p>
<p><strong>问题</strong>：过时的配置导致AI生成错误代码。</p>
<p><strong>解决</strong>：养成习惯，每次重大重构后更新CLAUDE.md，并在PR中review配置变更。</p>
<h3 data-id="heading-24">坑3：忘记版本控制</h3>
<p>把CLAUDE.md加入<code>.gitignore</code>或者不提交到仓库。</p>
<p><strong>问题</strong>：团队成员各自为政，代码风格混乱。</p>
<p><strong>解决</strong>：必须纳入Git，和代码一起review。</p>
<h3 data-id="heading-25">坑4：过于笼统的规则</h3>
<p>写"保持代码简洁"、"遵循最佳实践"这种空话。</p>
<p><strong>问题</strong>：AI无法执行，等于没写。</p>
<p><strong>解决</strong>：每条规则必须具体、可验证、可执行。</p>
<h3 data-id="heading-26">坑5：敏感信息泄露</h3>
<p>把API密钥、数据库密码写进CLAUDE.md。</p>
<p><strong>问题</strong>：配置文件会提交到仓库，敏感信息泄露。</p>
<p><strong>解决</strong>：只描述配置方式，不写具体值。</p>
<pre><code class="hljs language-markdown" lang="markdown">❌ 错误
\<span class="hljs-code">`\`</span>\`markdown
<span class="hljs-section"># 数据库配置</span>
DATABASE<span class="hljs-emphasis">_URL=postgresql://admin:password123@localhost:5432/mydb
\`\`\`

✅ 正确
\`\`\`markdown
# 环境变量
- DATABASE_</span>URL: 从.env.local读取，格式参考.env.example
<span class="hljs-bullet">-</span> API<span class="hljs-emphasis">_KEY: 从环境变量获取，本地开发联系@张三获取测试key
\`\`\`
</span></code></pre>
<h2 data-id="heading-27">3个真实项目案例</h2>
<h3 data-id="heading-28">案例1：React前端项目</h3>
<p>这是我目前在维护的一个电商前端项目的配置（简化版）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 电商前端项目</span>
<span class="hljs-section">## 技术栈</span>
<span class="hljs-bullet">-</span> Next.js 14.0 (App Router)
<span class="hljs-bullet">-</span> React 18.2
<span class="hljs-bullet">-</span> TypeScript 5.2
<span class="hljs-bullet">-</span> Tailwind CSS 3.4
<span class="hljs-bullet">-</span> Zustand (状态管理)
<span class="hljs-bullet">-</span> TanStack Query (服务器状态)

<span class="hljs-section">## 项目结构</span>
src/
├── app/          # 页面路由
├── components/   # 组件
│   ├── ui/      # 基础组件
│   └── features/ # 业务组件
├── lib/         # 工具函数
└── services/    # API调用

  


<span class="hljs-section">## 代码规范</span>
<span class="hljs-bullet">-</span> 组件：函数组件 + Hooks
<span class="hljs-bullet">-</span> 状态：本地用useState，全局用Zustand，服务器用TanStack Query
<span class="hljs-bullet">-</span> 样式：Tailwind utilities，复杂布局抽取为组件
<span class="hljs-bullet">-</span> 错误处理：API调用必须try-catch


<span class="hljs-section">## 命令</span>
npm run dev      # 开发服务器
npm run build    # 生产构建
npm run lint     # 代码检查

<span class="hljs-section">## 限制</span>
<span class="hljs-bullet">-</span> 不要修改 /lib/auth/* (认证逻辑)
<span class="hljs-bullet">-</span> 不要安装新包 (需团队讨论)
</code></pre>
<p><strong>效果</strong>：用了这个配置后，Claude生成的组件结构和我手写的基本一致，节省了大量调整时间。</p>
<h3 data-id="heading-29">案例2：Node.js后端项目</h3>
<p>这是一个Express API项目的配置：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 订单管理系统API</span>
<span class="hljs-section">## 技术栈</span>
<span class="hljs-bullet">-</span> Node.js 20 LTS
<span class="hljs-bullet">-</span> Express 4.18
<span class="hljs-bullet">-</span> Prisma ORM
<span class="hljs-bullet">-</span> PostgreSQL 15
<span class="hljs-bullet">-</span> Zod (数据验证)

<span class="hljs-section">## 项目结构</span>
src/
├── routes/       # 路由定义
├── controllers/  # 业务逻辑
├── services/     # 数据库操作
├── middleware/   # 中间件
└── utils/        # 工具函数

<span class="hljs-section">## 编码规范</span>
<span class="hljs-bullet">-</span> 所有API必须包含：请求验证(Zod) + 错误处理 + 日志记录
<span class="hljs-bullet">-</span> 数据库操作统一放在services层
<span class="hljs-bullet">-</span> 控制器只做请求响应，不写业务逻辑
<span class="hljs-bullet">-</span> 使用async/await，避免回调

<span class="hljs-section">## API示例</span>
\<span class="hljs-code">`\`</span>\`typescript
// controllers/order.controller.ts
export async function createOrder(req: Request, res: Response) {
  try {
    const data = orderSchema.parse(req.body); // Zod验证
    const order = await orderService.create(data);
    logger.info('Order created', { orderId: order.id });
    res.json({ success: true, data: order });
  } catch (error) {
    logger.error('Create order failed', error);
    res.status(500).json({ success: false, error: 'Internal error' });
  }
}
\<span class="hljs-code">`\`</span>\`

<span class="hljs-section">## 命令</span>
npm run dev       # 开发模式(nodemon)
npm run build     # TypeScript编译
npm test          # Jest测试
npx prisma studio # 数据库GUI
</code></pre>
<p><strong>效果</strong>：Claude现在生成的API端点都自带Zod验证和错误处理，质量提升明显。</p>
<h3 data-id="heading-30">案例3：Monorepo架构</h3>
<p>这是一个同时包含前后端的Monorepo项目：</p>
<p><strong>根目录CLAUDE.md</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 全栈应用Monorepo</span>

<span class="hljs-section">## 架构</span>
<span class="hljs-bullet">-</span> 使用pnpm workspaces
<span class="hljs-bullet">-</span> apps/: 应用程序
<span class="hljs-bullet">-</span> packages/: 共享包

<span class="hljs-section">## 通用规范</span>
<span class="hljs-bullet">-</span> TypeScript严格模式
<span class="hljs-bullet">-</span> ESLint + Prettier统一格式化
<span class="hljs-bullet">-</span> Commit遵循Conventional Commits

<span class="hljs-section">## 命令</span>
pnpm install           # 安装所有依赖
pnpm run dev           # 同时启动前后端
pnpm run lint          # 检查所有包
pnpm --filter web dev  # 只启动web应用
</code></pre>
<p><strong>apps/web/.claude/CLAUDE.md</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Web应用配置</span>
继承根目录规范

<span class="hljs-bullet">-</span> Next.js 14 + React
<span class="hljs-bullet">-</span> 端口：3000
<span class="hljs-bullet">-</span> 详细规范见根目录CLAUDE.md
</code></pre>
<p><strong>apps/api/.claude/CLAUDE.md</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># API服务配置</span>
继承根目录规范

<span class="hljs-bullet">-</span> Express + Prisma
<span class="hljs-bullet">-</span> 端口：4000
<span class="hljs-bullet">-</span> 详细规范见根目录CLAUDE.md
</code></pre>
<p><strong>效果</strong>：Claude能根据当前工作目录自动切换上下文，在前端目录生成React代码，在后端目录生成Express代码。</p>
<h2 data-id="heading-31">结论：从今天开始优化你的CLAUDE.md</h2>
<p>看完这7个技巧，你应该对如何写好CLAUDE.md有了清晰的认识。记住最重要的三点：</p>
<ol>
<li>
<p><strong>保持简洁</strong> - 100行以内，只写必要信息</p>
</li>
<li>
<p><strong>足够具体</strong> - 每条规则都可执行、可验证</p>
</li>
<li>
<p><strong>持续更新</strong> - 项目在变，配置也要跟着变</p>
</li>
</ol>
<p>从我的实际经验来看，一个好的CLAUDE.md能把AI的工作效率提升至少30%。你不需要一次性写完所有内容，可以从最基础的技术栈声明开始，然后每次遇到AI犯错时，就往CLAUDE.md里加一条规则。</p>
<p>现在就打开你的项目，创建或优化你的CLAUDE.md吧。如果你还没开始用Claude Code，这个配置文件会是你的第一步。如果你已经在用，但AI表现不够理想，试试今天分享的这些技巧。</p>
<p>最后提醒一句：CLAUDE.md不是一次性工作，它应该和你的项目一起成长。每次重大重构、技术栈升级、规范变更，都别忘了更新这个文件。让AI真正理解你的项目，从写好CLAUDE.md开始。</p>
<blockquote>
<p>本文首发自<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.betterlink.top%2Fzh%2Fposts%2Fai%2F20251122-claude-md-writing-guide%2F" target="_blank" title="https://blog.betterlink.top/zh/posts/ai/20251122-claude-md-writing-guide/" ref="nofollow noopener noreferrer">blog.betterlink.top/zh/posts/ai…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让Trae CN SOLO自主发挥，看看能做出一个什么样的项目]]></title>    <link>https://juejin.cn/post/7576867727718662179</link>    <guid>https://juejin.cn/post/7576867727718662179</guid>    <pubDate>2025-11-26T15:20:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576867727718662179" data-draft-id="7576853741758201890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让Trae CN SOLO自主发挥，看看能做出一个什么样的项目"/> <meta itemprop="keywords" content="前端,Trae,人工智能"/> <meta itemprop="datePublished" content="2025-11-26T15:20:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="银空飞羽"/> <meta itemprop="url" content="https://juejin.cn/user/1086796427178429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让Trae CN SOLO自主发挥，看看能做出一个什么样的项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1086796427178429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    银空飞羽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T15:20:16.000Z" title="Wed Nov 26 2025 15:20:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">写在前面</h2>
<p>很早之前就在公司内部用过这种全栈自动化开发的大模型工具，然后当时在用的Trae CN编辑器也一直说要推出该能力，早早的就加到了候补白名单中，终于在今天收到短信，正好借着运营小姐姐告诉我的平台活动，于是来试用一下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97c18be91de44206b54edc7a851d7471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=QQqLtEBU7tp0fWXoOIELFjhXDdQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">界面展示</h2>
<p>SOLO模式本质上就是开发者啥都不用干，给大模型一个指令，然后大模型自主完成从项目设计、代码开发、自主运行、到自动debug最终上线的一整套全栈开发流程。</p>
<p>你可以提前给它设定好技术栈，或者给它详细的产品设计，让它按照你的思路搞，最后由你来验收。</p>
<p>打开Trae CN的SOLO界面</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaabe51a622f483e8d4fd1559888b595~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=ZdjMCCOwtLLs4kfrrsqFeyeRNd4%3D" alt="" loading="lazy"/></p>
<p>跟当初Trae国际版界面有点不同，国际版支持两种模式：小项目模式和大项目迭代模式，这里看CN版的就一种模式，左边的工具栏都是在SOLO开发中会自主调用的，包括用户自己的导入的MCP、智能体必要时也会被调用发挥作用。</p>
<p>整体能力上跟国际版的相比应该有一些阉割，不过不重要，看看对于小型项目来讲能做到什么程度吧。</p>
<h2 data-id="heading-2">自动化开发</h2>
<p>开始给它提示词让其自由发挥，在发送提示词之前，先进行一波提示词描述优化</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62991ce8b99b4948b0c2c133be2ef18f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=E2qc6wWVPefsXXNDqbXmjWCS2mY%3D" alt="" loading="lazy"/></p>
<p>优化后的效果如下</p>
<blockquote>
<p>设计并开发一个基于现代Web技术栈的完整网站应用，要求功能完备、具有创新性和实用性。技术实现需采用标准Web开发技术（HTML5、CSS3、JavaScript/TypeScript），可结合主流前端框架（如React、Vue或Angular）提升开发效率。网站需包含完整的用户交互流程，至少涵盖首页、核心功能模块页、用户设置页等关键页面。功能设计应具有独特性和创新性，避免简单模仿现有网站。所有用户数据和应用状态必须使用浏览器本地存储方案（localStorage/sessionStorage/IndexedDB）实现持久化管理，确保在用户刷新页面或重新访问时数据不丢失。网站需满足响应式设计要求，适配桌面端、平板和移动设备等不同屏幕尺寸。开发过程中需实现合理的代码结构、组件化设计和错误处理机制，确保应用的可维护性和稳定性。</p>
</blockquote>
<p>OK，需求明确后，让SOLO模式开工吧，首先进行任务设计</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91c19af4c84a4fe088a4a52b09cd12bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=L6N0ttGrWWG%2F8qCghbSTWw0%2FnTg%3D" alt="" loading="lazy"/></p>
<p>然后看到了它自由发挥了三个功能，感觉中间没有什么关联</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39c413cb5d1e4b6cb3043b880d08ae19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=dqqTKi6C96MXjjoxF4eJs5JdvO0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/849bb9f13425485c9a512f5766eba3e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=dQh2kqsViPBVZRjdv%2BlJwaHcS%2Fo%3D" alt="" loading="lazy"/></p>
<p>终于完成了，打开内置浏览器一看，报错</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fab09034ef04dc6a73cf4084feaaadf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=YjTQ3nje5MmS4X64Yzn3bj6i86s%3D" alt="" loading="lazy"/></p>
<p>点击右下角将报错信息添加到对话，让它改bug吧</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcf81fc1d61646658ea989f116611559~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=VAMp0OwGgU1lVquWWQftlOvL5Uo%3D" alt="" loading="lazy"/></p>
<p>又等了一会，OK了。尝试使用一下</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b1ee576e22d43ccac0a7b58b65f180f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=f5cdx8jcQ%2B1DXvvcajPytmTtvq4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ddab247f14c49ee90a9f8f6b62a13ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=iAbV1wmQl8BjgmZzBRQoP8ZUnS8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c39d75fe00e4909a6c81479c5ca1fd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=YI9ptT9sVm%2B0CdGFGn2PQyQ3ae0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0e2e0380d2141679d1ad2888f5baf7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZO256m66aOe5769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764775370&amp;x-signature=PPu2002rsh%2FLbZxNb8vGAeOXutc%3D" alt="" loading="lazy"/>
感觉可以哦，是个目标任务管理网站，可以设置任务、目标，设置中还能设置主题，甚至还有进度条这种小细节，作为一个项目管理工具真心不错。</p>
<p>本次比较仓促，确实没想到什么需求，就索性直接让Trae自己创造需求，实现需求，基本是一站式开发，只有一些操作是需要我来确认的，其他基本就扔后台不管了，还是挺省心的。等以后有刚需了再好好试试。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[提升 EdgeWorker 可观测性：使用 DataStream 设置日志功能]]></title>    <link>https://juejin.cn/post/7576844295434485769</link>    <guid>https://juejin.cn/post/7576844295434485769</guid>    <pubDate>2025-11-26T15:56:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576844295434485769" data-draft-id="7576907627016732723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="提升 EdgeWorker 可观测性：使用 DataStream 设置日志功能"/> <meta itemprop="keywords" content="人工智能,云计算"/> <meta itemprop="datePublished" content="2025-11-26T15:56:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AKAMAI"/> <meta itemprop="url" content="https://juejin.cn/user/829502942352628"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            提升 EdgeWorker 可观测性：使用 DataStream 设置日志功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/829502942352628/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AKAMAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T15:56:56.000Z" title="Wed Nov 26 2025 15:56:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关于作者：AJ Johnson 是 Akamai Technologies 的高级产品经理，专注于平台即服务（PaaS），并领导旨在扩展和优化公司云平台能力的战略计划。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d7341fdca8e4c6285d317b92d69162f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764777416&amp;x-signature=d3ZCwSaCS5NIfEp7%2BeydGtQTlTQ%3D" alt="" loading="lazy"/></p>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linode.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%2F%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251126_blogarticles230" target="_blank" title="https://www.linode.com/zh/lp/akamai-cloud-computing-freetrial/?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251126_blogarticles230" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达500美元专属额度</p>
<hr/>
<p>询问任何开发者，他们都会告诉您，良好且及时的应用遥测对于构建、维护和优化应用程序至关重要。没有适当的反馈，开发人员就如同在黑暗中摸索，难以识别逻辑错误、合规性问题以及优化空间。应用日志记录是开发过程的核心部分，在代码从概念走向生产的过程中提供关键洞察。而长期以来，这一功能在 EdgeWorkers 中一直缺失。</p>
<p>EdgeWorkers 是全球分布最广的无服务器边缘计算平台，使开发人员能够将业务逻辑放置在边缘，以减少延迟、加快响应时间、提高性能，并为全球客户提供更好的用户体验。</p>
<p>我们很高兴地宣布，EdgeWorkers 的可观测性得到了极大改善！自 Akamai 推出 EdgeWorkers 与 DataStream（一个免费的集中式数据收集和交付平台）的集成以来，已经过去了几个月。借助这项新的日志记录集成，开发人员现在可以为其关键任务的 EdgeWorker 工作负载设置日志。按照日志记录的标准，提供了多种详细级别：跟踪、调试、信息、警告和错误。控制日志级别为应用程序开发人员提供了灵活性和选项，以便排查其 EdgeWorkers 逻辑故障。</p>
<p>在推出 DataStream 集成之前，EdgeWorker 开发人员会使用高级标头和手动检查来调试其代码和工作流，这种方式繁琐、耗时且容易出错，很容易错过关键洞察。此外，借助完整的日志记录功能，开发人员可以更轻松地检测那些在简单 cURL 请求中可能无法显现的异常情况。</p>
<p>DataStream 集成的一个便捷特性是，无需编辑和重新部署代码即可修改在 EdgeWorkers 代码包中定义的日志级别。使用日志"覆盖"，可以根据需要切换函数日志以设置日志级别和详细程度，允许用户仅在需要更细粒度信息之前记录错误。这样做的好处是灵活性，同时控制日志量以避免额外的可观测性成本。请参阅以下示例，了解如何通过 UI 或使用 CLI 控制日志级别。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9a0a65c66614881929790e3e4fad977~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764777416&amp;x-signature=a2eRqas9FxNMmeon8EwC9FurquU%3D" alt="" loading="lazy"/></p>
<p>使用 UI 设置日志级别（无需重新部署代码）</p>
<p>使用 Akamai CLI，您可以通过类似以下命令设置日志级别：</p>
<p>akamai ew log-level set 82236 production debug;</p>
<p>自该集成推出以来，我们已经吸纳了众多 Akamai 的 EdgeWorker 客户，他们已配置了应用程序日志流。EdgeWorker 客户可以选择将其日志数据发送到他们选择的目的地，例如流行的内部可观测性工具，如 Splunk、New Relic 等。有关支持的端点的完整列表，请参阅 DataStream 目的地列表。</p>
<p>随着许多客户采用这一新功能，早期反馈是积极的。一位欧洲游戏客户提到，他们使用新的 JavaScript 日志记录功能在上线前隔离了新业务逻辑的问题。另一位客户强调了拥有可用日志对于更快发现问题的重要性。</p>
<p>以下是 EdgeWorker 日志记录的主要目的地：</p>
<p><strong><strong>EdgeWorker DataStream 主要目的地</strong></strong></p>
<ul>
<li>AWS S3</li>
<li>Splunk</li>
<li>Datadog</li>
<li>Google Cloud Storage</li>
<li>HTTPS</li>
<li>New Relic</li>
<li>Azure Storage</li>
<li>S3 兼容存储（包括 Akamai 的对象存储）</li>
<li>TrafficPeak</li>
<li>Sumo Logic</li>
</ul>
<h4 data-id="heading-0"><strong><strong>EdgeWorker 日志记录入门</strong></strong></h4>
<p>为您的 EdgeWorkers 设置日志记录非常简单，前提是您已经在代码包中添加了日志消息。首先，确保您的合约中包含了用于 EdgeWorkers 的 DataStream。这是一项免费服务，但需要合约授权才能启用。要添加用于 EdgeWorkers 的 DataStream，请联系您的客户代表。然后，按照以下步骤启用服务：</p>
<ol>
<li>通过 Control Center 的通用服务部分导航到 DataStream 服务</li>
<li>选择"创建 EdgeWorkers 流"</li>
<li>为您的流命名</li>
<li>最后，从结构化或 JSON 格式中选择，并选择目标目的地。</li>
</ol>
<p>就这样！您现在可以编写您的 EdgeWorkers 日志记录逻辑了，一旦激活，即可启用 Datastream 来使用它。要了解更多信息并获得完整的分步说明，请参阅有关启用和配置 EdgeWorker 日志流的详细文档。请参考 EdgeWorker JavaScript DataStream 设置页面。</p>
<p>以下是一些设置过程的示例截图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9de1aba16d2149138e0cf8825a4cdf1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764777416&amp;x-signature=Qh6ptPiWuueypuMEqgOfX2VR%2BlY%3D" alt="" loading="lazy"/></p>
<p><strong>设置 EW 日志流</strong></p>
<p><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb0702ac82784a709f64e889daaafd39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764777416&amp;x-signature=QFmOxZGrjIyOmC7pJaSZPXS6mh0%3D" alt="" loading="lazy"/></strong></p>
<p><strong>配置日志流目的地</strong></p>
<h4 data-id="heading-1"><strong><strong>EdgeWorker 可观测性有哪些新功能和即将推出的功能？</strong></strong></h4>
<p>未来的改进设想包括启用 OpenTelemetry 格式、支持数据本地化，以及可能允许基于属性的流式传输，而不是按每个 EdgeWorker 进行跟踪。关于可观测性方面，您可以在 ACC 门户中的 EdgeWorkers 执行报告中期待改进，因为我们很快将添加挂钟时间跟踪、初始化指标并简化报告。</p>
<p>一如既往，如果您对如何改进 EdgeWorker 可观测性或服务的任何其他方面有任何疑问或建议，请联系您的客户代表，或在我们<a href="https://link.juejin.cn?target=https%3A%2F%2Fcommunity.akamai.com%2Fcustomers%2Fs%2F%3Flanguage%3Dzh_CN%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_251126_external1_blogarticles230" target="_blank" title="https://community.akamai.com/customers/s/?language=zh_CN?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_251126_external1_blogarticles230" ref="nofollow noopener noreferrer">社区网站</a>上给我们留言。祝您日志记录愉快！</p>
<h4 data-id="heading-2"><strong><strong>了解更多关于 Akamai EdgeWorkers 的信息</strong></strong></h4>
<p>查看这些 Akamai 资源，了解 Akamai EdgeWorkers 如何使您的组织受益：</p>
<ul>
<li>EdgeWorkers TechDocs 文档</li>
<li>EdgeCompute 提供的 EdgeWorkers 代码示例</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcommunity.akamai.com%2Fcustomers%2Fs%2F%3Flanguage%3Dzh_CN%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_251126_external2_blogarticles230" target="_blank" title="https://community.akamai.com/customers/s/?language=zh_CN?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_251126_external2_blogarticles230" ref="nofollow noopener noreferrer">Akamai 开发者讨论论坛</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86d8e91c09a44f92ac095b95313ad95c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764777416&amp;x-signature=a6aQMDIPynw%2FDxWMTrxV02iFPhs%3D" alt="" loading="lazy"/></p>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linode.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%2F%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251126_blogarticles230_end" target="_blank" title="https://www.linode.com/zh/lp/akamai-cloud-computing-freetrial/?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251126_blogarticles230_end" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达500美元专属额度</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[K8s: 如何通过kubectl命令实时监控滚动更新的详细过程？]]></title>    <link>https://juejin.cn/post/7576893180080504874</link>    <guid>https://juejin.cn/post/7576893180080504874</guid>    <pubDate>2025-11-26T14:06:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576893180080504874" data-draft-id="7576888607479562259" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="K8s: 如何通过kubectl命令实时监控滚动更新的详细过程？"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-11-26T14:06:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            K8s: 如何通过kubectl命令实时监控滚动更新的详细过程？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T14:06:48.000Z" title="Wed Nov 26 2025 14:06:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Kubernetes 中实时监控滚动更新的详细过程，可以通过组合使用多个 <code>kubectl</code>命令来实现。下面这个表格汇总了最核心的命令及其用途，你可以根据不同的监控需求来选择。</p>






























<table><thead><tr><th>监控命令</th><th>主要用途</th><th>关键参数 / 说明</th></tr></thead><tbody><tr><td><code>kubectl rollout status deployment/&lt;部署名称&gt;</code></td><td><strong>核心进度监控</strong>：实时显示更新整体进度，直到完成或失败。</td><td>无特殊参数，专注于进度状态。</td></tr><tr><td><code>kubectl get pods -w -l &lt;标签&gt;</code></td><td><strong>Pod级别详情</strong>：动态显示Pod的新旧替换、状态变化等详细过程。</td><td><code>-w</code>用于实时监视；<code>-l</code>按标签筛选特定Deployment的Pod。</td></tr><tr><td><code>kubectl describe deployment &lt;部署名称&gt;</code></td><td><strong>事件与配置洞察</strong>：查看更新触发原因、ReplicaSet变化及关键事件日志。</td><td>输出信息详细，适合在更新停滞或出错时深挖原因。</td></tr><tr><td><code>kubectl get replicasets -w</code></td><td><strong>幕后视角</strong>：观察为新旧版本创建的ReplicaSet及其副本数量的变化。</td><td>了解Deployment控制器如何通过管理ReplicaSet来完成滚动更新。</td></tr></tbody></table>
<h3 data-id="heading-0">🧩 理解监控的关键节点</h3>
<p>在监控时，理解一些关键状态的含义能让你更清楚更新进行到了哪一步：</p>
<ul>
<li><strong><code>UP-TO-DATE</code></strong>：显示当前已更新到新版本的 Pod 数量。</li>
<li><strong><code>AVAILABLE</code></strong>：显示当前可供用户使用的 Pod 数量，这些 Pod 已经处于就绪（Ready）状态。</li>
<li><strong>Pod 的状态</strong>：在 <code>kubectl get pods</code>的输出中，<code>ContainerCreating</code>表示Pod正在创建，<code>Terminating</code>表示旧Pod正在终止。</li>
</ul>
<h3 data-id="heading-1">🛠️ 综合监控实战示例</h3>
<p>假设你要监控一个名为 <code>my-app</code>的 Deployment 的更新过程。</p>
<ol>
<li>
<p><strong>触发更新</strong>：首先执行更新命令，例如更新镜像版本。</p>
<pre><code class="hljs language-perl" lang="perl">kubectl set image deployment/<span class="hljs-keyword">my</span>-app <span class="hljs-keyword">my</span>-app=<span class="hljs-keyword">my</span>-app:v2.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>
</code></pre>
</li>
<li>
<p><strong>开启多个终端标签页进行综合监控</strong>：</p>
<ul>
<li>
<p><strong>标签页1：启动核心进度监控</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl rollout status deployment/my-app
</code></pre>
<p>这个命令会持续输出类似 <code>Waiting for rollout to finish: 2 out of 3 new replicas have been updated...</code>的信息，并在成功后提示 <code>deployment "my-app" successfully rolled out</code>。</p>
</li>
<li>
<p><strong>标签页2：启动Pod详情监控</strong></p>
<pre><code class="hljs language-ini" lang="ini">kubectl get pods -w -l <span class="hljs-attr">app</span>=my-app
</code></pre>
<p>这里你可以清晰地看到Kubernetes如何逐步启动新Pod（状态从 <code>Pending</code>到 <code>ContainerCreating</code>再到 <code>Running</code>），并终止旧Pod（状态变为 <code>Terminating</code>）。</p>
</li>
<li>
<p><strong>标签页3（可选）：启动幕后视角监控</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">kubectl get replicasets -w
</code></pre>
<p>此命令可让你观察到，Deployment 会创建一个新的 ReplicaSet 来管理新版本的 Pod（其副本数从0逐步增加），而旧的 ReplicaSet 的副本数则逐渐缩减到0。</p>
</li>
</ul>
</li>
<li>
<p><strong>遇到问题时进行深度排查</strong>：如果更新卡住或失败，使用 <code>describe</code>命令查看详细信息和事件。</p>
<pre><code class="hljs language-perl" lang="perl">kubectl describe deployment <span class="hljs-keyword">my</span>-app
</code></pre>
<p>在输出结果的 <code>Events</code>部分，包含了关于滚动更新过程的详细日志，例如 <code>Scaled up replica set my-app-7c54d5c99 to 1</code>（扩容新ReplicaSet）和 <code>Scaled down replica set my-app-7d47f45c6 to 2</code>（缩容旧ReplicaSet）等，这对于排查就绪探针失败、资源不足等问题非常有帮助。</p>
</li>
</ol>
<h3 data-id="heading-2">💡 进阶技巧与注意事项</h3>
<ul>
<li>
<p><strong>就绪探针的重要性</strong>：为了使 <code>rollout status</code>命令能准确判断新Pod是否可用，你的Pod定义中必须配置有效的 <code>readinessProbe</code>（就绪探针）。Kubernetes 只有在新Pod的就绪探针检查通过后，才会认为该Pod已就绪，然后继续替换下一个旧Pod。</p>
</li>
<li>
<p><strong>进度期限</strong>：Deployment 有一个 <code>progressDeadlineSeconds</code>配置（默认为600秒）。如果更新过程超过此时间仍未完成，Kubernetes 会将其标记为失败。你可以通过 <code>kubectl describe deployment</code>命令的结果来查看状态。</p>
</li>
<li>
<p><strong>一键回滚</strong>：如果发现新版本有问题，可以快速回滚到上一个版本。</p>
<pre><code class="hljs language-bash" lang="bash">kubectl rollout undo deployment/my-app
</code></pre>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Grab 原理篇：它是怎么"偷窥" React 的？]]></title>    <link>https://juejin.cn/post/7576843726011973658</link>    <guid>https://juejin.cn/post/7576843726011973658</guid>    <pubDate>2025-11-26T14:21:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576843726011973658" data-draft-id="7576856418470707210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Grab 原理篇：它是怎么&quot;偷窥&quot; React 的？"/> <meta itemprop="keywords" content="AI编程,人工智能,React.js"/> <meta itemprop="datePublished" content="2025-11-26T14:21:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Grab 原理篇：它是怎么"偷窥" React 的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T14:21:33.000Z" title="Wed Nov 26 2025 14:21:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>上一篇我们介绍了 React Grab 是什么、怎么用。</p>
<p>这一篇，我们来聊点硬核的——<strong>它到底是怎么做到的？</strong></p>
<p>当你按下 <code>⌘C</code> 点击一个按钮，它是怎么知道这个按钮：</p>
<ul>
<li>住在哪个文件</li>
<li>第几行代码</li>
<li>属于哪个组件</li>
<li>有什么样式</li>
</ul>
<p>让我们掀开它的底裤看看。</p>
<hr/>
<h2 data-id="heading-1">整体架构：三层蛋糕</h2>
<p>React Grab 的架构可以理解为三层蛋糕：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph ReactGrab["React Grab"]
        subgraph Layers["三层架构"]
            Event["🎯 事件层&lt;br/&gt;(原生 DOM)"]
            Analysis["🔍 分析层&lt;br/&gt;(bippy)"]
            UI["🎨 UI 层&lt;br/&gt;(Solid.js)"]
        end

        Core["⚙️ 核心协调器&lt;br/&gt;(core.tsx)"]
        Clipboard["📋 剪贴板 API"]

        Event --&gt; Core
        Analysis --&gt; Core
        UI --&gt; Core
        Core --&gt; Clipboard
    end

    style Event fill:#e1f5fe
    style Analysis fill:#fff3e0
    style UI fill:#f3e5f5
    style Core fill:#e8f5e9
    style Clipboard fill:#fce4ec
</code></pre>
<p><strong>第一层：事件层</strong> - 监听你的键盘和鼠标，知道你什么时候想"抓"东西</p>
<p><strong>第二层：分析层</strong> - 拿到你点击的元素后，去 React 内部"偷"信息</p>
<p><strong>第三层：UI 层</strong> - 在页面上画高亮框、显示标签</p>
<p>最后，核心协调器把所有信息打包，扔进剪贴板。</p>
<hr/>
<h2 data-id="heading-2">第一层：事件监听</h2>
<h3 data-id="heading-3">它怎么知道你要抓？</h3>
<p>用户交互的状态机：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">stateDiagram-v2
    [*] --&gt; 待命: 页面加载

    待命 --&gt; 抓取模式: 按下 ⌘C / Ctrl+C
    抓取模式 --&gt; 待命: 松开按键

    抓取模式 --&gt; 悬停高亮: 鼠标移动到元素
    悬停高亮 --&gt; 抓取模式: 鼠标移开

    悬停高亮 --&gt; 执行抓取: 鼠标点击
    执行抓取 --&gt; 复制完成: 写入剪贴板
    复制完成 --&gt; 抓取模式: 继续选择其他元素
    复制完成 --&gt; 待命: 松开按键
</code></pre>
<p>React Grab 监听三类事件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 AbortController 统一管理事件监听器</span>
<span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

<span class="hljs-comment">// 1. 键盘事件：检测 Cmd+C / Ctrl+C</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> ((e.<span class="hljs-property">metaKey</span> || e.<span class="hljs-property">ctrlKey</span>) &amp;&amp; e.<span class="hljs-property">key</span> === <span class="hljs-string">'c'</span>) {
    <span class="hljs-title function_">activateGrabMode</span>();  <span class="hljs-comment">// 进入"抓取模式"</span>
  }
}, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> });

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keyup'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Meta'</span> || e.<span class="hljs-property">key</span> === <span class="hljs-string">'Control'</span>) {
    <span class="hljs-title function_">deactivateGrabMode</span>();  <span class="hljs-comment">// 退出"抓取模式"</span>
  }
}, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> });

<span class="hljs-comment">// 2. 鼠标移动：追踪悬停位置</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, handleMouseMove, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> });

<span class="hljs-comment">// 3. 鼠标点击：执行抓取</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, handleMouseDown, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> });
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseup'</span>, handleMouseUp, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> });
</code></pre>
<h3 data-id="heading-4">为什么高亮不会"抖"？</h3>
<p>如果鼠标稍微动一下就切换高亮元素，体验会很差。</p>
<p>React Grab 用了一个小技巧——<strong>稳定检测</strong>：</p>
<ul>
<li>鼠标移动超过 200px 才重新计算</li>
<li>停留 100ms 后才显示高亮</li>
<li>只有"稳定"悬停时才触发</li>
</ul>
<p>这就是为什么你快速划过元素时，高亮框不会疯狂闪烁。</p>
<hr/>
<h2 data-id="heading-5">第二层：React Fiber 访问（核心黑魔法）</h2>
<p>这是整个工具最精彩的部分。</p>
<h3 data-id="heading-6">什么是 Fiber？</h3>
<p>Fiber 是 React 16+ 的内部数据结构。你可以把它理解为 React 的"私人笔记本"，记录了每个组件的：</p>
<ul>
<li>它是谁（组件类型）</li>
<li>它长什么样（props）</li>
<li>它现在的状态（state）</li>
<li>它的家人是谁（父/子/兄弟节点）</li>
<li><strong>它从哪里来</strong>（源代码位置）</li>
</ul>
<p>最后一条是关键——React 在开发模式下，会偷偷记录每个组件的源代码位置。</p>
<h3 data-id="heading-7">怎么访问 Fiber？</h3>
<p>React Grab 使用了一个叫 <code>bippy</code> 的库（也是作者 Aiden Bai 写的）来访问 Fiber：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { _fiberRoots <span class="hljs-keyword">as</span> fiberRoots, instrument } <span class="hljs-keyword">from</span> <span class="hljs-string">"bippy"</span>;

<span class="hljs-comment">// 注册一个"间谍"，监听 React 的 commit 阶段</span>
<span class="hljs-title function_">instrument</span>({
  <span class="hljs-title function_">onCommitFiberRoot</span>(<span class="hljs-params">_, fiberRoot</span>) {
    <span class="hljs-comment">// 每次 React 渲染完成，就把 fiber 根节点收集起来</span>
    fiberRoots.<span class="hljs-title function_">add</span>(fiberRoot);
  },
});
</code></pre>
<p>这段代码做了什么？</p>
<ol>
<li>React 每次渲染完成（commit），都会触发这个回调</li>
<li><code>bippy</code> 把 Fiber 根节点存起来</li>
<li>之后我们就可以从这些根节点遍历整棵 Fiber 树</li>
</ol>
<h3 data-id="heading-8">从 DOM 到 Fiber</h3>
<p>当你点击一个 DOM 元素，React Grab 需要找到它对应的 Fiber 节点：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    DOM["🖱️ DOM 元素&lt;br/&gt;(HTMLElement)"]
    Fiber["🧬 Fiber 节点&lt;br/&gt;(_debugSource)"]
    Source["📍 源代码位置&lt;br/&gt;(fileName, lineNumber)"]

    DOM --&gt;|"__reactFiber$xxx"| Fiber
    Fiber --&gt;|"读取 _debugSource"| Source

    style DOM fill:#e3f2fd
    style Fiber fill:#fff8e1
    style Source fill:#e8f5e9
</code></pre>
<p>具体怎么做？React 会在 DOM 元素上挂一个隐藏属性，指向对应的 Fiber 节点。<code>bippy</code> 封装了这个逻辑：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> {
  getSourceFromHostInstance,
  normalizeFileName,
  isSourceFile
} <span class="hljs-keyword">from</span> <span class="hljs-string">"bippy/dist/source"</span>;

<span class="hljs-comment">// 从 DOM 元素获取源代码位置</span>
<span class="hljs-keyword">const</span> source = <span class="hljs-title function_">getSourceFromHostInstance</span>(domElement);
<span class="hljs-comment">// 返回: { fileName: 'src/Button.tsx', lineNumber: 42, columnNumber: 5 }</span>
</code></pre>
<p>一行代码，就拿到了文件路径和行号。</p>
<hr/>
<h2 data-id="heading-9">源代码位置是哪来的？</h2>
<p>你可能好奇：React 怎么知道每个组件在源代码的哪一行？</p>
<p>答案是：<strong>Babel 插件</strong>。</p>
<h3 data-id="heading-10">编译时注入</h3>
<p>整个流程是这样的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph Dev["开发时"]
        JSX["📝 JSX 代码&lt;br/&gt;&amp;lt;Button&amp;gt;提交&amp;lt;/Button&amp;gt;"]
        Babel["🔧 Babel 编译"]
        JS["📄 带 __source 的 JS"]
    end

    subgraph Runtime["运行时"]
        React["⚛️ React 创建 Fiber"]
        Fiber["🧬 Fiber 节点&lt;br/&gt;_debugSource"]
    end

    subgraph Tool["React Grab"]
        Grab["🎯 读取 _debugSource"]
        Output["📋 输出位置信息"]
    end

    JSX --&gt;|"@babel/plugin-transform-react-jsx-source"| Babel
    Babel --&gt; JS
    JS --&gt;|"React.createElement()"| React
    React --&gt; Fiber
    Fiber --&gt;|"bippy"| Grab
    Grab --&gt; Output

    style JSX fill:#e3f2fd
    style Babel fill:#fff3e0
    style JS fill:#e8f5e9
    style React fill:#e1f5fe
    style Fiber fill:#fff8e1
    style Grab fill:#f3e5f5
    style Output fill:#fce4ec
</code></pre>
<p>当你写 JSX：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Button</span> onClick={handleClick}&gt;提交&lt;/<span class="hljs-title class_">Button</span>&gt;
</code></pre>
<p>Babel 在开发模式下会把它转换成：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">Button</span>, {
  <span class="hljs-attr">onClick</span>: handleClick,
  <span class="hljs-attr">__source</span>: {
    <span class="hljs-attr">fileName</span>: <span class="hljs-string">"/src/App.tsx"</span>,
    <span class="hljs-attr">lineNumber</span>: <span class="hljs-number">42</span>,
    <span class="hljs-attr">columnNumber</span>: <span class="hljs-number">5</span>
  }
}, <span class="hljs-string">"提交"</span>)
</code></pre>
<p>看到了吗？<code>__source</code> 属性是 Babel 自动加的。</p>
<p>这是由 <code>@babel/plugin-transform-react-jsx-source</code> 插件完成的，React 脚手架（Create React App、Vite、Next.js）在开发模式下都会自动启用它。</p>
<h3 data-id="heading-11">存储在 Fiber 中</h3>
<p>React 拿到 <code>__source</code> 后，会把它存到 Fiber 节点的 <code>_debugSource</code> 字段：</p>
<pre><code class="hljs language-typescript" lang="typescript">fiber.<span class="hljs-property">_debugSource</span> = {
  <span class="hljs-attr">fileName</span>: <span class="hljs-string">"/src/App.tsx"</span>,
  <span class="hljs-attr">lineNumber</span>: <span class="hljs-number">42</span>,
  <span class="hljs-attr">columnNumber</span>: <span class="hljs-number">5</span>
}
</code></pre>
<p>这就是 React Grab 能精准定位源代码的秘密——<strong>React 自己就记着呢</strong>，它只是把信息读出来而已。</p>
<hr/>
<h2 data-id="heading-12">第三层：UI 渲染</h2>
<h3 data-id="heading-13">一个有趣的选择</h3>
<p>React Grab 的 UI（高亮框、标签）是用 <strong>Solid.js</strong> 写的，不是 React。</p>
<p>为什么？</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createSignal, createMemo, createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">'solid-js'</span>;

<span class="hljs-comment">// 响应式状态</span>
<span class="hljs-keyword">const</span> [isActive, setIsActive] = <span class="hljs-title function_">createSignal</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> [hoveredElement, setHoveredElement] = createSignal&lt;<span class="hljs-title class_">Element</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 派生状态：高亮框的位置</span>
<span class="hljs-keyword">const</span> highlightStyle = <span class="hljs-title function_">createMemo</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> el = <span class="hljs-title function_">hoveredElement</span>();
  <span class="hljs-keyword">if</span> (!el) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">const</span> rect = el.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">top</span>: rect.<span class="hljs-property">top</span> + <span class="hljs-string">'px'</span>,
    <span class="hljs-attr">left</span>: rect.<span class="hljs-property">left</span> + <span class="hljs-string">'px'</span>,
    <span class="hljs-attr">width</span>: rect.<span class="hljs-property">width</span> + <span class="hljs-string">'px'</span>,
    <span class="hljs-attr">height</span>: rect.<span class="hljs-property">height</span> + <span class="hljs-string">'px'</span>
  };
});
</code></pre>
<h3 data-id="heading-14">为什么不用 React？</h3>
<p>四个原因：</p>
<ol>
<li><strong>隔离性</strong> - 不会和你应用的 React 冲突。想象一下，一个检测 React 的工具自己也用 React，那不是套娃吗？</li>
<li><strong>轻量</strong> - Solid.js 的运行时只有几 KB，React 要大得多</li>
<li><strong>性能</strong> - Solid.js 是细粒度响应式，更新 UI 更高效</li>
<li><strong>无依赖</strong> - 不需要完整的 React 运行时</li>
</ol>
<p>这是一个很聪明的架构决策。</p>
<hr/>
<h2 data-id="heading-15">最后一步：剪贴板</h2>
<h3 data-id="heading-16">数据结构</h3>
<p>React Grab 把收集到的信息打包成一个结构化对象：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">GrabData</span> {
  <span class="hljs-comment">// 源代码信息</span>
  <span class="hljs-attr">source</span>: {
    <span class="hljs-attr">fileName</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">lineNumber</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">columnNumber</span>: <span class="hljs-built_in">number</span>;
  };

  <span class="hljs-comment">// 组件信息</span>
  <span class="hljs-attr">component</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">ancestors</span>: <span class="hljs-built_in">string</span>[];  <span class="hljs-comment">// 组件层级链</span>
  };

  <span class="hljs-comment">// DOM 信息</span>
  <span class="hljs-attr">dom</span>: {
    <span class="hljs-attr">selector</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">tagName</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">dimensions</span>: { <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span> };
  };

  <span class="hljs-comment">// HTML 片段</span>
  <span class="hljs-attr">htmlSnippet</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<h3 data-id="heading-17">CSS 选择器生成</h3>
<p>为了让 AI 能精准定位元素，还需要生成一个唯一的 CSS 选择器：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { finder } <span class="hljs-keyword">from</span> <span class="hljs-string">'@medv/finder'</span>;

<span class="hljs-keyword">const</span> selector = <span class="hljs-title function_">finder</span>(element);
<span class="hljs-comment">// 返回: "#app &gt; div.container &gt; button.submit-btn"</span>
</code></pre>
<p><code>@medv/finder</code> 是一个专门干这个的库，它会生成最短且唯一的选择器。</p>
<h3 data-id="heading-18">写入剪贴板</h3>
<p>最后一步，把数据写入剪贴板：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用现代 Clipboard API</span>
navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">write</span>([
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClipboardItem</span>({
    <span class="hljs-string">'text/html'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([htmlContent], { <span class="hljs-attr">type</span>: <span class="hljs-string">'text/html'</span> }),
    <span class="hljs-string">'text/plain'</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([plainText], { <span class="hljs-attr">type</span>: <span class="hljs-string">'text/plain'</span> })
  })
]);
</code></pre>
<p>注意它同时写了两种格式：</p>
<ul>
<li><code>text/html</code> - 结构化数据，AI 工具可以解析</li>
<li><code>text/plain</code> - 纯文本，直接粘贴也能看</li>
</ul>
<hr/>
<h2 data-id="heading-19">技术栈总结</h2>
<p>React Grab 用到的核心技术：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((React Grab))
    事件层
      原生 DOM API
      键盘事件
      鼠标事件
      AbortController
    分析层
      bippy
      Fiber 访问
      _debugSource
      组件层级
    UI 层
      Solid.js
      高亮框
      标签提示
      响应式更新
    输出层
      Clipboard API
      @medv/finder
      结构化数据
</code></pre>








































<table><thead><tr><th>模块</th><th>技术</th><th>作用</th></tr></thead><tbody><tr><td>事件监听</td><td>原生 DOM API</td><td>捕获键盘/鼠标事件</td></tr><tr><td>Fiber 访问</td><td>bippy</td><td>读取 React 内部数据</td></tr><tr><td>源码定位</td><td>Babel 插件</td><td>编译时注入位置信息</td></tr><tr><td>选择器生成</td><td>@medv/finder</td><td>生成唯一 CSS 选择器</td></tr><tr><td>UI 渲染</td><td>Solid.js</td><td>绘制高亮框和标签</td></tr><tr><td>数据传递</td><td>Clipboard API</td><td>复制到剪贴板</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-20">几个精妙的设计</h2>
<h3 data-id="heading-21">1. 不侵入应用代码</h3>
<p>React Grab 完全是"外挂"式的：</p>
<ul>
<li>不需要修改你的组件代码</li>
<li>不需要安装 Babel 插件（React 自带的就够了）</li>
<li>不会影响应用的正常运行</li>
</ul>
<h3 data-id="heading-22">2. 开发模式限定</h3>
<p>它依赖的 <code>_debugSource</code> 只在开发模式存在，所以：</p>
<ul>
<li>生产环境天然无效</li>
<li>不会泄露源码信息</li>
<li>不会增加生产包体积</li>
</ul>
<h3 data-id="heading-23">3. 轻量且独立</h3>
<p>用 Solid.js 而不是 React 来做 UI，既保证了轻量，又避免了和应用 React 的冲突。</p>
<hr/>
<h2 data-id="heading-24">局限性</h2>
<p>当然，这套方案也有局限：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Works["✅ 能用"]
        React["React 16+"]
        Dev["开发模式"]
        Modern["现代浏览器"]
    end

    subgraph NotWork["❌ 不能用"]
        Vue["Vue"]
        Angular["Angular"]
        Svelte["Svelte"]
        Prod["生产环境"]
        IE["IE 浏览器"]
    end

    React -.-&gt;|"Fiber 架构"| Works
    Dev -.-&gt;|"_debugSource"| Works

    Vue -.-&gt;|"无 Fiber"| NotWork
    Angular -.-&gt;|"不同架构"| NotWork
    Svelte -.-&gt;|"编译时框架"| NotWork
    Prod -.-&gt;|"无调试信息"| NotWork

    style Works fill:#e8f5e9
    style NotWork fill:#ffebee
</code></pre>
<h3 data-id="heading-25">只能用于 React</h3>
<p>它深度依赖 React Fiber 架构，所以：</p>
<ul>
<li>❌ Vue - 没有 Fiber</li>
<li>❌ Angular - 完全不同的架构</li>
<li>❌ Svelte - 编译时框架，运行时没有组件树</li>
</ul>
<h3 data-id="heading-26">只能用于开发模式</h3>
<p>生产环境的代码：</p>
<ul>
<li>没有 <code>_debugSource</code></li>
<li>被压缩混淆了</li>
<li>Source Map 通常也不开放</li>
</ul>
<p>所以只能在开发时用。</p>
<h3 data-id="heading-27">依赖 Source Map</h3>
<p>如果你的构建工具没有生成 Source Map，或者禁用了 JSX source 插件，定位就会失效。</p>
<hr/>
<h2 data-id="heading-28">总结</h2>
<p>React Grab 的原理可以用一句话概括：</p>
<blockquote>
<p><strong>利用 React 在开发模式下自带的源码位置信息，通过 Fiber 树反向查找，把元素的"身份证"复制给 AI。</strong></p>
</blockquote>
<p>它不是什么黑科技，而是巧妙地利用了 React 已有的调试机制。</p>
<p>这也是为什么它能做到：</p>
<ul>
<li>零配置</li>
<li>零侵入</li>
<li>零性能影响</li>
</ul>
<p>因为脏活累活，React 和 Babel 已经帮你干完了。</p>
<hr/>
<h2 data-id="heading-29">相关资源</h2>
<ul>
<li><strong>React Grab GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faidenybai%2Freact-grab" target="_blank" title="https://github.com/aidenybai/react-grab" ref="nofollow noopener noreferrer">github.com/aidenybai/r…</a></li>
<li><strong>bippy（Fiber 访问库）</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faidenybai%2Fbippy" target="_blank" title="https://github.com/aidenybai/bippy" ref="nofollow noopener noreferrer">github.com/aidenybai/b…</a></li>
<li><strong>@medv/finder（选择器生成）</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fantonmedv%2Ffinder" target="_blank" title="https://github.com/antonmedv/finder" ref="nofollow noopener noreferrer">github.com/antonmedv/f…</a></li>
<li><strong>Solid.js</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.solidjs.com%2F" target="_blank" title="https://www.solidjs.com/" ref="nofollow noopener noreferrer">www.solidjs.com/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Helm深度解析：Kubernetes应用管理的利器]]></title>    <link>https://juejin.cn/post/7576888607479627795</link>    <guid>https://juejin.cn/post/7576888607479627795</guid>    <pubDate>2025-11-26T14:26:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576888607479627795" data-draft-id="7576888607479578643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Helm深度解析：Kubernetes应用管理的利器"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-11-26T14:26:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Helm深度解析：Kubernetes应用管理的利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T14:26:32.000Z" title="Wed Nov 26 2025 14:26:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：为什么我们需要Helm？</h2>
<p>在现代云原生环境中，Kubernetes已成为容器编排的事实标准。然而，当应用复杂度增加时，直接使用kubectl管理Kubernetes资源文件变得异常繁琐。每个微服务都可能涉及Deployment、Service、ConfigMap等多种资源，而多环境部署更是雪上加霜。这正是Helm的用武之地——作为Kubernetes的包管理器，它将应用打包成可复用的Chart，极大简化了部署和管理流程。</p>
<p>本文将深入解析Helm的核心机制，并通过实际案例展示其强大功能，同时揭示最佳实践和常见陷阱。</p>
<h2 data-id="heading-1">一、Helm核心架构与工作原理</h2>
<h3 data-id="heading-2">1.1 Helm三大核心概念</h3>
<p>Helm的架构建立在三个基本概念之上，它们共同构成了一个完整的应用管理生态系统：</p>
<ul>
<li><strong>Chart</strong>：Helm的应用包装格式，包含应用的所有Kubernetes资源定义模板和配置参数。类比于Linux系统中的RPM或DEB包。</li>
<li><strong>Release</strong>：Chart在Kubernetes集群中的运行实例。每次安装都会生成一个唯一的Release，记录该次部署的配置和状态。</li>
<li><strong>Repository</strong>：Chart的存储和分发中心，支持HTTP/S和OCI协议，便于团队共享和复用应用模板。</li>
</ul>
<h3 data-id="heading-3">1.2 Helm 3的革命性改进</h3>
<p>Helm 3移除了Tiller组件，直接通过kubeconfig与Kubernetes API交互，显著提升了安全性和简化了架构。这一变化解决了Helm 2中存在的安全隐患和复杂的RBAC配置问题。</p>
<h2 data-id="heading-4">二、Helm Chart深度设计与实战</h2>
<h3 data-id="heading-5">2.1 多层微服务Chart设计</h3>
<p>考虑一个典型的三层应用架构（前端、后端、数据库），Helm通过子Chart依赖关系优雅地管理这种复杂应用。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Chart.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v2</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">ecommerce-app</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">A</span> <span class="hljs-string">multi-tier</span> <span class="hljs-string">ecommerce</span> <span class="hljs-string">application</span>
<span class="hljs-attr">version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">dependencies:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">frontend</span>
    <span class="hljs-attr">version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
    <span class="hljs-attr">repository:</span> <span class="hljs-string">file://../frontend</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">backend</span>
    <span class="hljs-attr">version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
    <span class="hljs-attr">repository:</span> <span class="hljs-string">file://../backend</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">database</span>
    <span class="hljs-attr">version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
    <span class="hljs-attr">repository:</span> <span class="hljs-string">file://../database</span>
</code></pre>
<p><strong>依赖管理策略</strong>有两种主要方式：</p>
<ul>
<li><strong>嵌入式依赖</strong>：子Chart作为父Chart的一部分，紧耦合，简单但不够灵活</li>
<li><strong>依赖导入式</strong>：各Chart独立开发调试，松耦合，复杂但更灵活</li>
</ul>
<h3 data-id="heading-6">2.2 模板引擎高级用法</h3>
<p>Helm使用Go模板语言实现配置的动态化。以下是一个生产环境可用的Deployment模板示例：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> {{ <span class="hljs-string">.Release.Name</span> }}<span class="hljs-string">-{{</span> <span class="hljs-string">.Chart.Name</span> <span class="hljs-string">}}</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">app:</span> {{ <span class="hljs-string">.Chart.Name</span> }}
    <span class="hljs-attr">version:</span> {{ <span class="hljs-string">.Chart.AppVersion</span> }}
    <span class="hljs-attr">environment:</span> {{ <span class="hljs-string">.Values.environment</span> <span class="hljs-string">|</span> <span class="hljs-string">default</span> <span class="hljs-string">"prod"</span> }}
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> {{ <span class="hljs-string">.Values.replicaCount</span> }}
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> {{ <span class="hljs-string">.Chart.Name</span> }}
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> {{ <span class="hljs-string">.Chart.Name</span> }}
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> {{ <span class="hljs-string">.Chart.Name</span> }}
          <span class="hljs-attr">image:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ .Values.image.repository }}</span>:<span class="hljs-template-variable">{{ .Values.image.tag }}</span>"</span>
          <span class="hljs-attr">imagePullPolicy:</span> {{ <span class="hljs-string">.Values.image.pullPolicy</span> }}
          {{<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.resources</span> }}
          <span class="hljs-attr">resources:</span>
            {{<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">12</span> }}
          {{<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> }}
          <span class="hljs-attr">env:</span>
          {{<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">$name</span>, <span class="hljs-string">$value</span> <span class="hljs-string">:=</span> <span class="hljs-string">.Values.env</span> }}
            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> {{ <span class="hljs-string">$name</span> }}
              <span class="hljs-attr">value:</span> {{ <span class="hljs-string">$value</span> <span class="hljs-string">|</span> <span class="hljs-string">quote</span> }}
          {{<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> }}
</code></pre>
<p>模板中支持复杂的控制结构、函数和管道操作，大大增强了灵活性。</p>
<h3 data-id="heading-7">2.3 值文件设计与多环境管理</h3>
<p>通过分层配置管理，可以实现一套Chart多环境部署：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># values-prod.yaml</span>
<span class="hljs-attr">global:</span>
  <span class="hljs-attr">environment:</span> <span class="hljs-string">production</span>
  <span class="hljs-attr">domain:</span> <span class="hljs-string">example.com</span>

<span class="hljs-attr">frontend:</span>
  <span class="hljs-attr">replicaCount:</span> <span class="hljs-number">3</span>
  <span class="hljs-attr">image:</span>
    <span class="hljs-attr">tag:</span> <span class="hljs-string">"stable"</span>
  <span class="hljs-attr">resources:</span>
    <span class="hljs-attr">requests:</span>
      <span class="hljs-attr">memory:</span> <span class="hljs-string">"256Mi"</span>
      <span class="hljs-attr">cpu:</span> <span class="hljs-string">"250m"</span>
    <span class="hljs-attr">limits:</span>
      <span class="hljs-attr">memory:</span> <span class="hljs-string">"512Mi"</span>
      <span class="hljs-attr">cpu:</span> <span class="hljs-string">"500m"</span>

<span class="hljs-attr">backend:</span>
  <span class="hljs-attr">replicaCount:</span> <span class="hljs-number">2</span>
  <span class="hljs-attr">database:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">"mysql-production"</span>
</code></pre>
<h2 data-id="heading-8">三、Helm高级特性与部署控制</h2>
<h3 data-id="heading-9">3.1 资源部署顺序控制</h3>
<p>Helm不会简单地按文件顺序部署资源，而是遵循智能的排序规则。根据源码分析，内置的资源类型优先级如下：</p>
<ol>
<li><strong>Namespace, NetworkPolicy</strong>（基础环境隔离）</li>
<li><strong>ConfigMap, Secret</strong>（配置与敏感信息）</li>
<li><strong>PersistentVolumeClaim</strong>（存储资源）</li>
<li><strong>ServiceAccount, Role, RoleBinding</strong>（权限控制）</li>
<li><strong>Service</strong>（网络访问入口）</li>
<li><strong>Deployment, StatefulSet, DaemonSet</strong>（工作负载）</li>
<li><strong>Ingress</strong>（外部流量路由）</li>
</ol>
<p>这种排序确保了"基础设施优先于应用负载"的部署逻辑。</p>
<h3 data-id="heading-10">3.2 生命周期钩子精准控制</h3>
<p>Helm钩子允许在特定时间点执行自定义操作，常见钩子类型包括：</p>
<ul>
<li><code>pre-install</code>：在安装前执行（如预检检查）</li>
<li><code>post-install</code>：在安装后执行（如初始化数据库）</li>
<li><code>pre-upgrade</code>：在升级前执行（如备份数据）</li>
<li><code>post-upgrade</code>：在升级后执行（如清理临时文件)</li>
</ul>
<p>以下是一个数据库迁移钩子的示例：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ .Release.Name }}</span>-db-migrate"</span>
  <span class="hljs-attr">annotations:</span>
    <span class="hljs-attr">"helm.sh/hook":</span> <span class="hljs-string">post-install,post-upgrade</span>
    <span class="hljs-attr">"helm.sh/hook-weight":</span> <span class="hljs-string">"5"</span>
    <span class="hljs-attr">"helm.sh/hook-delete-policy":</span> <span class="hljs-string">hook-succeeded</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Never</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">migrate</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ .Values.image.repository }}</span>:<span class="hljs-template-variable">{{ .Values.image.tag }}</span>"</span>
        <span class="hljs-attr">command:</span> [<span class="hljs-string">'sh'</span>, <span class="hljs-string">'-c'</span>, <span class="hljs-string">'python manage.py migrate'</span>]
</code></pre>
<h3 data-id="heading-11">3.3 依赖等待与就绪检查</h3>
<p>对于有严格依赖关系的服务，可以使用initContainer实现依赖等待：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spec:</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">initContainers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wait-for-db</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">busybox:1.35</span>
        <span class="hljs-attr">command:</span> [<span class="hljs-string">'sh'</span>, <span class="hljs-string">'-c'</span>, <span class="hljs-string">'until nc -z <span class="hljs-template-variable">{{ .Values.mysql.host }}</span> <span class="hljs-template-variable">{{ .Values.mysql.port }}</span>; do echo "等待MySQL就绪..."; sleep 2; done'</span>]
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{ .Values.image.repository }}</span>:<span class="hljs-template-variable">{{ .Values.image.tag }}</span>"</span>
</code></pre>
<h2 data-id="heading-12">四、Helm在CI/CD中的实战集成</h2>
<h3 data-id="heading-13">4.1 GitOps流水线集成</h3>
<p>将Helm与Argo CD等GitOps工具结合，可以实现声明式的持续部署：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># argo-app.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">argoproj.io/v1alpha1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Application</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">production-app</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">destination:</span>
    <span class="hljs-attr">server:</span> <span class="hljs-string">https://kubernetes.default.svc</span>
  <span class="hljs-attr">project:</span> <span class="hljs-string">default</span>
  <span class="hljs-attr">source:</span>
    <span class="hljs-attr">path:</span> <span class="hljs-string">charts/myapp</span>
    <span class="hljs-attr">repoURL:</span> <span class="hljs-string">https://git.example.com/helm-charts.git</span>
    <span class="hljs-attr">targetRevision:</span> <span class="hljs-string">main</span>
    <span class="hljs-attr">helm:</span>
      <span class="hljs-attr">valueFiles:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">values-prod.yaml</span>
  <span class="hljs-attr">syncPolicy:</span>
    <span class="hljs-attr">automated:</span>
      <span class="hljs-attr">prune:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">selfHeal:</span> <span class="hljs-literal">true</span>
</code></pre>
<h3 data-id="heading-14">4.2 安全最佳实践</h3>
<ol>
<li><strong>Secret管理</strong>：避免在values.yaml中硬编码敏感信息，使用外部Secret存储：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">helm install myapp ./chart --set-file dbPassword=./secrets/pass.txt
</code></pre>
<ol>
<li><strong>版本锁定</strong>：防止依赖版本漂移导致的不可预测行为：</li>
</ol>
<pre><code class="hljs language-css" lang="css">helm dependency build <span class="hljs-attr">--verify</span>
</code></pre>
<ol>
<li><strong>RBAC最小权限</strong>：为Helm创建专属ServiceAccount，遵循最小权限原则。</li>
</ol>
<h2 data-id="heading-15">五、Helm陷阱与规避策略</h2>
<h3 data-id="heading-16">5.1 过度模板化陷阱</h3>
<p><strong>症状</strong>：模板中大量条件判断、单个Chart管理过多微服务。</p>
<p><strong>解决方案</strong>：遵循"单一Chart单一服务"原则，复杂场景拆分为Subchart。</p>
<h3 data-id="heading-17">5.2 调试技巧</h3>
<p>Helm提供多种调试工具，帮助定位问题：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 模板渲染调试</span>
helm template --debug ./chart

<span class="hljs-comment"># 与集群中实际状态差异对比</span>
helm diff upgrade myapp ./chart

<span class="hljs-comment"># 干跑模式验证</span>
helm install --dry-run --debug ./chart
</code></pre>
<h3 data-id="heading-18">5.3 版本兼容性管理</h3>
<p>严格遵循SemVer版本规范，确保升级的兼容性：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Chart.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v2</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span>
<span class="hljs-attr">version:</span> <span class="hljs-number">1.2</span><span class="hljs-number">.3</span>  <span class="hljs-comment"># 主版本.次版本.修订号</span>
<span class="hljs-attr">appVersion:</span> <span class="hljs-number">2.1</span><span class="hljs-number">.0</span>
</code></pre>
<h2 data-id="heading-19">六、真实场景案例：电商平台Helm化改造</h2>
<p>某电商平台在2022年双十一前完成Helm化改造，取得了显著成效：</p>
<ul>
<li><strong>部署时间</strong>：从3小时缩短至8分钟</li>
<li><strong>回滚效率</strong>：从人工检查YAML变为一键回滚</li>
<li><strong>配置错误率</strong>：降低92%</li>
</ul>
<p>其核心改造策略包括：</p>
<ol>
<li>将20+微服务拆分为独立的子Chart</li>
<li>通过全局Values管理跨服务配置</li>
<li>使用Helm钩子处理数据库迁移和初始化</li>
<li>集成到CI/CD流水线实现自动发布</li>
</ol>
<h2 data-id="heading-20">结论</h2>
<p>Helm作为Kubernetes应用管理的强大工具，通过模板化、版本控制和依赖管理，极大地简化了复杂应用的部署和管理。然而，它也是一把双刃剑——不当使用会导致配置复杂度反而增加。</p>
<p>掌握Helm的关键在于：<strong>理解其设计哲学，遵循最佳实践，适时使用高级特性</strong>。简单场景适度使用，复杂系统深度整合，始终遵循"基础设施即代码"原则。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[黑森林突袭！FLUX.2发布，这就是我们要的“生产力怪兽”]]></title>    <link>https://juejin.cn/post/7576893180080619562</link>    <guid>https://juejin.cn/post/7576893180080619562</guid>    <pubDate>2025-11-26T14:41:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576893180080619562" data-draft-id="7577042546094800938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="黑森林突袭！FLUX.2发布，这就是我们要的“生产力怪兽”"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-26T14:41:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            黑森林突袭！FLUX.2发布，这就是我们要的“生产力怪兽”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T14:41:29.000Z" title="Wed Nov 26 2025 14:41:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>就在2025年11月25日，那个被无数AI绘画爱好者视作“技术灯塔”的黑森林实验室（Black Forest Labs），终于甩出了他们的王炸——FLUX.2。</p>
<p>如果你还在纠结上一代模型的手部细节或是由于缺乏一致性而无法将其真正投入工作流，那么这次的更新可能会让你眼前一亮。简单来说，FLUX.2 并不是一次简单的版本号叠加，它是从“以此炫技”向“生产力工具”的一次暴力转型。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-26_22.32.59-1024x528.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-26_22.32.59-1024x528.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10209cf26f6c4c8382506294cc4b68d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764772889&amp;x-signature=LgaBh2Xk1zte0xQybHz9%2FZhKWfw%3D" alt="iShot_2025-11-26_22.32.59" loading="lazy"/></a></p>
<p><strong>不再是“抽卡”游戏，而是精准控制</strong></p>
<p>以前我们玩文生图，多少带着点“抽卡”的运气成分。但FLUX.2 显然想终结这个时代。</p>
<p>这次最让人头皮发麻的功能，莫过于“多参考图像生成”。想象一下，作为设计师，你需要为一个角色画一套分镜，以前你需要无数复杂的LoRA训练和ControlNet调试来维持角色脸部不崩。现在，FLUX.2 允许你直接扔进去最多10张参考图。它能吃透角色的面部特征、服装风格甚至是特定的产品细节，然后生成高度一致的新图像。这对于做故事板、电商图或者是游戏资产的人来说，简直是降维打击。</p>
<p>而且，它变“聪明”了。得益于融合了Mistral-3视觉语言模型，FLUX.2 对于复杂的逻辑有了惊人的理解力。你告诉它“画7个苹果”，它不会给你画6个或者8个；你给它一个具体的HEX颜色代码（比如#ff0088），它能精准渲染出那个特定的粉色，而不是“大概是粉色”。它甚至能像程序员一样理解结构化的JSON提示词，这意味着我们可以像调整相机参数一样去微调画面。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-26_22.32.21-1024x787.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-26_22.32.21-1024x787.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e935303f644942269fb318490473230d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764772889&amp;x-signature=i5HWRR1tqAquuhVMRgXwgJpqh14%3D" alt="iShot_2025-11-26_22.32.21" loading="lazy"/></a></p>
<p><strong>画质与细节的狂飙</strong></p>
<p>很多开源模型在生成大图时容易出现结构崩坏，但FLUX.2 直接把分辨率支持拉到了400万像素（4MP）。这意味着生成的图片不再是只能发发朋友圈的“小样”，而是可以直接拿去精修、打印的成品。</p>
<p>文字渲染能力也提升了一个台阶。以前AI生成的图片里，文字往往是一团乱码，现在FLUX.2 已经可以处理复杂的排版和UI界面，甚至是一些细小的说明文字也能清晰可读。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-26_22.32.28-1024x600.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-26_22.32.28-1024x600.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e98b602eb943eeb9c2ac338c91bedf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764772889&amp;x-signature=udhkeY8ytW2%2FFcPm%2FU01elkvDTs%3D" alt="iShot_2025-11-26_22.32.28" loading="lazy"/></a></p>
<p><strong>显卡燃烧？这次或许还好</strong></p>
<p>听到320亿参数（32B），你的第一反应可能是：我的显卡要炸了。</p>
<p>原始的FLUX.2模型确实庞大，加载它原本需要夸张的90GB显存。但好消息是，黑森林实验室这次和NVIDIA以及ComfyUI搞了深度合作。通过FP8量化技术和内存卸载功能，他们硬生生把显存需求砍掉了40%。</p>
<p>这意味着，虽然它依然是个大家伙，但已经不再是数据中心独享的奢侈品。很多消费级的GeForce RTX显卡现在也能跑得起来。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-26_22.32.38-1024x779.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-26_22.32.38-1024x779.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d23768699bc34968b465da3d0740774e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764772889&amp;x-signature=ErIxecEVzUV4JfLUMJLlii5duys%3D" alt="iShot_2025-11-26_22.32.38" loading="lazy"/></a></p>
<p><strong>开源与商业的平衡艺术</strong></p>
<p>黑森林实验室这次的策略非常清晰，不想让所有人“白嫖”，但也给了社区足够的诚意。</p>
<ul>
<li><strong>FLUX.2 [pro]</strong>：这是给甚至不差钱的企业准备的，闭源，性能最强，速度最快，只能通过API使用。</li>
<li><strong>FLUX.2 [dev]</strong>：这是给社区的礼物。权重开放，虽然不能商用，但研究人员和极客们可以在本地尽情折腾，基于它开发各种插件和生态。</li>
<li><strong>FLUX.2 [flex]</strong> &amp; <strong>[klein]</strong>：介于两者之间，Flex给了开发者更多参数控制权，而即将推出的Klein则是面向边缘设备的轻量版。</li>
</ul>
<p>值得一提的是，作为模型底座的VAE（变分自编码器）是完全基于Apache 2.0协议开源的，这为未来的生态互操作性打下了很好的基础。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-26_22.32.53-1024x793.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-26_22.32.53-1024x793.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/562a0240d6fb4114963130c68351c49a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764772889&amp;x-signature=hXG%2BVuF5nP1clZijpNBulg8eelI%3D" alt="iShot_2025-11-26_22.32.53" loading="lazy"/></a></p>
<p><strong>写在最后</strong></p>
<p>FLUX.2 的出现，标志着开源图生图模型真正拥有了叫板闭源顶级模型（如Midjourney v6.1或DALL-E 3）的底气。它不再仅仅是用来生成漂亮小姐姐的玩具，而是一把因为精准控制和逻辑理解而变得锋利无比的生产力瑞士军刀。</p>
<p>目前，ComfyUI已经第一时间集成了支持。如果你手头有张不错的N卡，或者只是想看看AI进化的新高度，现在就是动手的最佳时机。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再当 AI 的"人肉定位器"了：一个工具让 React 组件秒定位]]></title>    <link>https://juejin.cn/post/7576843726011908122</link>    <guid>https://juejin.cn/post/7576843726011908122</guid>    <pubDate>2025-11-26T13:53:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576843726011908122" data-draft-id="7576844295434158089" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再当 AI 的&quot;人肉定位器&quot;了：一个工具让 React 组件秒定位"/> <meta itemprop="keywords" content="前端,AI编程,AIGC"/> <meta itemprop="datePublished" content="2025-11-26T13:53:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再当 AI 的"人肉定位器"了：一个工具让 React 组件秒定位
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T13:53:14.000Z" title="Wed Nov 26 2025 13:53:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">开篇</h2>
<p>想象一下这个场景：</p>
<p>你正在和 AI 助手愉快地结对编程，突然想让它帮你改一下页面上那个"有点丑"的按钮。</p>
<p>于是你输入：</p>
<blockquote>
<p>"帮我把右上角那个蓝色的按钮改成圆角的"</p>
</blockquote>
<p>AI 回复：</p>
<blockquote>
<p>"好的，请问是哪个文件？叫什么组件？我需要更多信息..."</p>
</blockquote>
<p>你翻了个白眼，开始在项目里一个个文件夹找那个按钮到底藏在哪里...</p>
<p><strong>这种痛，React Grab 懂。</strong></p>
<hr/>
<h2 data-id="heading-1">它是谁？</h2>
<p>React Grab 是一个开源的开发者工具，做的事情很简单——<strong>让你点一下页面元素，就能把它的"身份证"复制给 AI</strong>。</p>
<p>什么是"身份证"？就是这个元素的：</p>
<ul>
<li>住在哪个文件、第几行代码</li>
<li>它爸爸是谁（父组件）</li>
<li>它长什么样（DOM 结构、CSS 选择器）</li>
<li>它的完整家谱（组件层级）</li>
</ul>
<p>有了这些信息，AI 就不会再迷路了。</p>
<p><strong>项目名片</strong>：</p>
<ul>
<li>🏠 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Freact-grab.com" target="_blank" title="https://react-grab.com" ref="nofollow noopener noreferrer">react-grab.com</a></li>
<li>📦 GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faidenybai%2Freact-grab" target="_blank" title="https://github.com/aidenybai/react-grab" ref="nofollow noopener noreferrer">github.com/aidenybai/r…</a></li>
<li>👨‍💻 作者：Aiden Bai（Million.js 的作者，React 性能优化大佬）</li>
<li>📜 许可证：MIT（完全免费，放心用）</li>
</ul>
<hr/>
<h2 data-id="heading-2">为什么需要它？</h2>
<h3 data-id="heading-3">没有它之前</h3>
<p>让 AI 帮你改 UI，你需要：</p>
<ol start="0">
<li><strong>当侦探</strong> 🔍 - 在项目里翻箱倒柜找组件文件</li>
<li><strong>当翻译</strong> 📝 - 费尽口舌描述"就是那个...页面中间偏右...有个图标的...按钮"</li>
<li><strong>当复读机</strong> 🔄 - AI 理解错了？再解释一遍...</li>
<li><strong>当搬运工</strong> 📋 - 手动复制代码，粘贴，再复制，再粘贴...</li>
</ol>
<h3 data-id="heading-4">有了它之后</h3>
<ol start="0">
<li>按住 <code>⌘C</code>（Mac）或 <code>Ctrl+C</code>（Windows）</li>
<li>点一下你想改的元素</li>
<li>粘贴给 AI</li>
<li>完事</li>
</ol>
<p><strong>就这么简单。</strong></p>
<hr/>
<h2 data-id="heading-5">它能做什么？</h2>
<h3 data-id="heading-6">🎯 精准抓取</h3>
<p>按住快捷键，鼠标移到元素上，它会贴心地帮你高亮显示：</p>
<blockquote>
<p>"你要的是这个吗？它叫 <code>&lt;button&gt;</code>，住在 <code>MyComponent</code> 里"</p>
</blockquote>
<p>点一下，信息就到剪贴板了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb5686565d5d41a7abca62e7cc3e8e01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764769993&amp;x-signature=mf8GtTREVuZTFiJ7dd91P%2FJh0zI%3D" alt="image-20251126212651365.png" loading="lazy"/></p>
<h3 data-id="heading-7">📦 区域选择</h3>
<p>想一次改好几个元素？没问题。</p>
<p>按住快捷键，拖个框把它们圈起来，所有元素的信息打包带走。</p>
<h3 data-id="heading-8">🧬 完整信息</h3>
<p>复制的内容长这样：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">selected_element</span>&gt;</span>
- selector: [data-lov-name="img"]
- width: 187
- height: 40
HTML snippet:
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> <span class="hljs-attr">used-at</span>=<span class="hljs-string">"//localhost:3001/src/components/common/page.tsx:22:26"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 完整的组件层级... --&gt;</span>
    <span class="hljs-comment">&lt;!-- IMPORTANT: selected element --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-10 w-auto"</span> <span class="hljs-attr">data-component-path</span>=<span class="hljs-string">"src/page/login/index..."</span>
         <span class="hljs-attr">data-component-line</span>=<span class="hljs-string">"157"</span> <span class="hljs-attr">...</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">img</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">selected_element</span>&gt;</span>
</code></pre>
<p>AI 看到这个，立马就知道：</p>
<ul>
<li>这是个 <code>img</code> 标签</li>
<li>在 <code>src/page/login/index.tsx</code> 文件的第 157 行</li>
<li>它的父组件是 <code>Main</code>，定义在 <code>page.tsx</code> 的第 22 行</li>
<li>尺寸是 187×40</li>
</ul>
<p><strong>零歧义，零迷路，零废话。</strong></p>
<hr/>
<h2 data-id="heading-9">谁能用？</h2>
<p>好消息：<strong>不是 Cursor 专属</strong>！</p>





























<table><thead><tr><th>AI 助手</th><th>能用吗？</th></tr></thead><tbody><tr><td>Cursor</td><td>✅ 当然可以</td></tr><tr><td>Claude Code</td><td>✅ 完全支持</td></tr><tr><td>OpenCode</td><td>✅ 没问题</td></tr><tr><td>Windsurf</td><td>✅ 理论上都行</td></tr><tr><td>任何能粘贴的工具</td><td>✅ 只要支持剪贴板就行</td></tr></tbody></table>
<p>本质上，React Grab 只是把信息复制到剪贴板。所以只要你的 AI 工具能接收粘贴内容，就能用。</p>
<hr/>
<h2 data-id="heading-10">使用场景</h2>
<h3 data-id="heading-11">场景一：改样式</h3>
<blockquote>
<p>"帮我把这个按钮改成渐变背景，加个 hover 动效"</p>
</blockquote>
<p>以前：找文件 → 描述位置 → 可能还找错了 现在：点一下 → 粘贴 → 搞定</p>
<h3 data-id="heading-12">场景二：Debug</h3>
<blockquote>
<p>"这个卡片显示有问题，帮我看看"</p>
</blockquote>
<p>直接点击有问题的元素，AI 立刻知道去哪个文件找。</p>
<h3 data-id="heading-13">场景三：重构</h3>
<blockquote>
<p>"把这几个按钮抽成一个通用组件"</p>
</blockquote>
<p>框选多个元素，AI 能看到它们的共同模式。</p>
<h3 data-id="heading-14">场景四：学习</h3>
<blockquote>
<p>"这个动画效果是怎么实现的？"</p>
</blockquote>
<p>点一下，AI 就能定位到源码给你讲解。</p>
<hr/>
<h2 data-id="heading-15">它的脾气</h2>
<p>了解一下 React Grab 的特点，能让你们相处得更愉快：</p>
<h3 data-id="heading-16">😊 它喜欢</h3>
<ul>
<li><strong>React 项目</strong> - 这是它的主场</li>
<li><strong>开发模式</strong> - Source Map 开着，它才能准确定位</li>
<li><strong>现代浏览器</strong> - Chrome、Edge、Firefox 都 OK</li>
</ul>
<h3 data-id="heading-17">😕 它不太行</h3>
<ul>
<li><strong>Vue / Angular / Svelte</strong> - 抱歉，只认 React</li>
<li><strong>生产环境</strong> - 代码压缩后它就迷路了</li>
<li><strong>远古浏览器</strong> - IE？那是什么？</li>
</ul>
<h3 data-id="heading-18">💡 小贴士</h3>
<ul>
<li>它<strong>不会</strong>影响你的应用性能（只在按快捷键时激活）</li>
<li>它<strong>不会</strong>出现在生产环境（只要你配置正确）</li>
<li>它<strong>不会</strong>和 React DevTools 冲突（它们是好朋友）</li>
</ul>
<hr/>
<h2 data-id="heading-19">和 React DevTools 的区别</h2>
<p>经常有人问：有 React DevTools 了，还要这个干嘛？</p>
<p>它们是不同物种：</p>






























<table><thead><tr><th/><th>React Grab</th><th>React DevTools</th></tr></thead><tbody><tr><td><strong>服务对象</strong></td><td>AI 助手</td><td>人类开发者</td></tr><tr><td><strong>交互方式</strong></td><td>点击复制</td><td>面板浏览</td></tr><tr><td><strong>输出格式</strong></td><td>文本信息</td><td>可视化界面</td></tr><tr><td><strong>使用场景</strong></td><td>喂给 AI</td><td>自己看着调试</td></tr></tbody></table>
<p><strong>React DevTools 是给你看的，React Grab 是给 AI 看的。</strong></p>
<hr/>
<h2 data-id="heading-20">总结</h2>
<p>React Grab 解决的问题很纯粹：</p>
<blockquote>
<p><strong>让 AI 能"看见"你页面上的元素。</strong></p>
</blockquote>
<p>不需要你当翻译、当侦探、当搬运工。</p>
<p>点一下，粘贴，然后你就可以专注于<strong>描述你想要什么</strong>，而不是<strong>解释那是什么</strong>。</p>
<p>这就是它存在的意义。</p>
<hr/>
<h2 data-id="heading-21">怎么装？</h2>
<p>放心，安装比泡面还简单。</p>
<h3 data-id="heading-22">方式一：一行脚本搞定（推荐新手）</h3>
<p>在你的 HTML 文件里加一行：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;script
  <span class="hljs-attr">src</span>=<span class="hljs-string">"//unpkg.com/react-grab/dist/index.global.js"</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
  <span class="hljs-attr">data-enabled</span>=<span class="hljs-string">"true"</span>
&gt;&lt;/script&gt;
</code></pre>
<p>就这样，没了。刷新页面就能用。</p>
<h3 data-id="heading-23">方式二：Next.js App Router</h3>
<p>在 <code>app/layout.tsx</code> 里加：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Script</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'next/script'</span>;
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{
  children,
}: {
  children: React.ReactNode;
}</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        {process.env.NODE_ENV === 'development' &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">Script</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"//unpkg.com/react-grab/dist/index.global.js"</span>
            <span class="hljs-attr">crossOrigin</span>=<span class="hljs-string">"anonymous"</span>
            <span class="hljs-attr">data-enabled</span>=<span class="hljs-string">"true"</span>
            <span class="hljs-attr">strategy</span>=<span class="hljs-string">"afterInteractive"</span>
          /&gt;</span><span class="xml">
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></span>
  );
}
</code></pre>
<p>注意那个 <code>process.env.NODE_ENV === 'development'</code>——<strong>只在开发环境加载</strong>，生产环境自动消失。</p>
<h3 data-id="heading-24">方式三：Next.js Pages Router</h3>
<p>在 <code>pages/_document.tsx</code> 里加：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Html</span>, <span class="hljs-title class_">Head</span>, <span class="hljs-title class_">Main</span>, <span class="hljs-title class_">NextScript</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/document'</span>;
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Document</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Html</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span>
        {process.env.NODE_ENV === 'development' &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">script</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"//unpkg.com/react-grab/dist/index.global.js"</span>
            <span class="hljs-attr">crossOrigin</span>=<span class="hljs-string">"anonymous"</span>
            <span class="hljs-attr">data-enabled</span>=<span class="hljs-string">"true"</span>
          /&gt;</span><span class="xml">
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">NextScript</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Html</span>&gt;</span></span></span>
  );
}
</code></pre>
<h3 data-id="heading-25">方式四：Vite 项目</h3>
<p>先装包：</p>
<pre><code class="hljs language-csharp" lang="csharp">npm install react-grab
<span class="hljs-meta"># 或者</span>
pnpm <span class="hljs-keyword">add</span> react-grab
<span class="hljs-meta"># 或者</span>
yarn <span class="hljs-keyword">add</span> react-grab
</code></pre>
<p>然后在 <code>index.html</code> 里加：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>) {
    <span class="hljs-keyword">import</span>(<span class="hljs-string">'react-grab'</span>);
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>同样，<code>import.meta.env.DEV</code> 确保只在开发时加载。</p>
<hr/>
<h2 data-id="heading-26">装完怎么用？</h2>
<ol start="0">
<li><strong>启动项目</strong> - <code>npm run dev</code></li>
<li><strong>打开浏览器</strong> - 访问你的应用</li>
<li><strong>按住快捷键</strong> - <code>⌘C</code>（Mac）或 <code>Ctrl+C</code>（Windows）</li>
<li><strong>移动鼠标</strong> - 你会看到元素被高亮</li>
<li><strong>点击</strong> - 信息自动复制</li>
<li><strong>粘贴给 AI</strong> - 开始愉快地改代码</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[30 分钟落地全栈交互：OneCode CLI+SVG 排课表实战]]></title>    <link>https://juejin.cn/post/7576859345935286326</link>    <guid>https://juejin.cn/post/7576859345935286326</guid>    <pubDate>2025-11-26T13:55:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576859345935286326" data-draft-id="7576861477266833427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="30 分钟落地全栈交互：OneCode CLI+SVG 排课表实战"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-26T13:55:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            30 分钟落地全栈交互：OneCode CLI+SVG 排课表实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T13:55:47.000Z" title="Wed Nov 26 2025 13:55:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“排课系统开发一周起步？”——别再被传统跨栈开发绑架效率了。对于教育系统高频使用的排课表模块，开发者往往陷入“前端画SVG、后端写接口、联调耗半天”的困境，而用户却在为“点击没反馈、加载慢半拍”的体验吐槽。</p>
<p>现在，OneCode CLI彻底打破这个僵局：无需切换开发工具，不用精通前后端双技术栈，仅靠一套CLI指令+低代码可视化配置，30分钟就能从环境搭建到部署上线，做出具备“悬停高亮、点击缩放、冲突闪烁预警”的全栈交互SVG排课表。本文就是你的“计时实战手册”，每一步都标注核心动作与耗时，跟着操作，结束时就能带走一个可直接用的高体验排课系统。</p>
<p>OneCode平台的全栈整合能力恰好破解这一困局，其配套的Qoder CLI工具更是打通“前端组件-动态交互-后端服务”的开发链路：无需跨工具切换，仅通过CLI指令即可完成组件生成、交互绑定、数据联调全流程，快速实现具备“悬停高亮、点击反馈、冲突预警”的动态排课表。本文以该排课表为实战案例，手把手演示如何通过OneCode+Qoder CLI构建全栈动态交互应用，既保障开发效率，更让最终产品的用户体验实现质的提升。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9751eac9e6b2490192c8caae18e2b149~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764770147&amp;x-signature=8VytQyF6QmcMIqQzLvKtP3z2YbM%3D" alt="程序展现SVG效果" loading="lazy"/></p>
<h2 data-id="heading-0">一、项目核心价值：30分钟落地的“效率+体验”双优方案</h2>
<h3 data-id="heading-1">1.1 项目定位</h3>
<p>本次开发的SVG动态排课表，核心解决“传统开发周期长”与“用户体验差”两大核心问题，30分钟内实现四大核心价值功能，兼顾开发者效率与终端用户体验：</p>
<ul>
<li>鼠标悬停高亮：课程块颜色渐变+微缩放，交互反馈清晰</li>
<li>点击缩放反馈：触发150ms短促动画，操作感知明确</li>
<li>冲突闪烁预警：红橙交替闪烁，排课错误即时提醒</li>
<li>数据实时同步：后端更新自动推送，无需页面刷新</li>
</ul>
<p>最终产物适配PC端与移动端，可直接嵌入现有教育管理系统。</p>
<h3 data-id="heading-2">1.2 技术栈选型</h3>
<p>依托OneCode平台的全栈整合能力，无需跨工具切换即可完成前后端开发，核心技术如下：</p>
<ul>
<li><strong>开发平台</strong>：OneCode v4.0+（SVG注解/动画组件/服务框架一体化）</li>
<li><strong>前端技术</strong>：SVG矢量图形（高清无锯齿，适配多设备）</li>
<li><strong>后端技术</strong>：Java Spring Boot（OneCode原生集成，零额外配置）</li>
<li><strong>核心工具</strong>：OneCode QoderCLI（代码生成/批量操作/逻辑补全，效率核心）</li>
</ul>
<h2 data-id="heading-3">二、环境准备：3分钟搞定，为30分钟落地抢时间</h2>
<p>核心目标：快速完成OneCode与Qoder CLI环境配置，确保后续开发“零卡顿”。以下指令复制粘贴即可执行，全程3分钟内完成。</p>
<h3 data-id="heading-4">2.1 安装OneCode CLI与项目初始化</h3>
<pre><code class="hljs language-javascript" lang="javascript"># <span class="hljs-number">1.</span> 安装<span class="hljs-title class_">OneCode</span> <span class="hljs-variable constant_">CLI</span>（多系统通用）
curl -fsSL <span class="hljs-attr">https</span>:<span class="hljs-comment">//onecode-official.oss-cn-hangzhou.aliyuncs.com/install.sh | bash</span>

# <span class="hljs-number">2.</span> 验证安装（需v2<span class="hljs-number">.0</span><span class="hljs-number">.0</span>+支持<span class="hljs-variable constant_">SVG</span>注解）
onecode --version
# 预期输出：<span class="hljs-title class_">OneCode</span> <span class="hljs-variable constant_">CLI</span> v2<span class="hljs-number">.1</span><span class="hljs-number">.5</span> (支持<span class="hljs-variable constant_">SVG</span>与<span class="hljs-title class_">MCPv2</span>协议)

# <span class="hljs-number">3.</span> 初始化排课表项目（指定<span class="hljs-title class_">Spring</span> <span class="hljs-title class_">Boot</span>框架）
onecode project create svg-schedule-demo \
  --framework <span class="hljs-attr">springboot</span>:<span class="hljs-number">2.7</span><span class="hljs-number">.0</span> \
  --description <span class="hljs-string">"OneCode SVG动态排课表示例"</span>

# <span class="hljs-number">4.</span> 进入项目目录并加载依赖
cd svg-schedule-demo
onecode deps sync
</code></pre>
<h3 data-id="heading-5">2.2 配置QoderCLI能力</h3>
<p>通过QoderCLI关联OneCode代理，确保开发过程中可实时获取辅助能力：</p>
<pre><code class="hljs language-javascript" lang="javascript"># <span class="hljs-number">1.</span> 登录<span class="hljs-title class_">OneCode</span>控制台获取<span class="hljs-variable constant_">API</span>密钥（个人中心→开发者设置）
# <span class="hljs-number">2.</span> 配置全局<span class="hljs-title class_">QoderCLI</span>密钥
onecode config set <span class="hljs-variable language_">global</span>.<span class="hljs-property">api</span>-key <span class="hljs-string">"你的OneCode API密钥"</span>

# <span class="hljs-number">3.</span> 验证<span class="hljs-title class_">QoderCLI</span>连接
qodercli mcp test onecode --check tool
# 预期输出：<span class="hljs-title class_">QoderCLI</span>代理状态：在线（支持代码生成/注解推荐）
</code></pre>
<h2 data-id="heading-6">三、核心实现：25分钟完成全栈开发（分步骤计时）</h2>
<h3 data-id="heading-7">3.0 低代码SVG画布组件：可视化开发的基石</h3>
<p>OneCode低代码SVG画布组件是衔接可视化配置与代码开发的核心载体，它打破了“低代码只能拖拽简单元素”的认知局限，提供“可视化布局+注解化配置+代码扩展”三重能力，为复杂动态排课表开发奠定基础。其核心特性如下：</p>
<ul>
<li><strong>可视化画布基座</strong>：内置SVG画布编辑器，支持拖拽添加课程块、文本、时间轴等基础组件，实时预览布局效果，生成的可视化配置可直接转化为Java注解代码，无需手动编写坐标与样式。</li>
<li><strong>组件化复用机制</strong>：提供课程块、状态标签、预警图标等预制组件库，支持自定义组件封装与团队共享，排课表中重复的课程元素可通过组件复用减少开发量。</li>
<li><strong>全栈联动能力</strong>：组件可直接绑定后端服务接口（如通过可视化配置选择关联<code>ScheduleService</code>），无需手动编写前后端对接代码，实现“组件拖拽即接口关联”。</li>
<li><strong>开放扩展接口</strong>：支持通过注解与Java代码扩展组件逻辑，低代码配置负责基础结构，代码扩展负责复杂业务，兼顾开发效率与灵活性。</li>
</ul>
<p>核心开发链路（总耗时25分钟）：低代码搭骨架（5分钟）→动画交互配置（8分钟）→后端服务开发（7分钟）→Qoder CLI优化（5分钟）。借助OneCode注解与Qoder CLI辅助，每一步都直击核心，不做冗余操作。</p>
<h3 data-id="heading-8">3.1 第一步（5分钟）：低代码+Qoder CLI，速搭SVG排课表骨架</h3>
<p>关键动作：低代码拖拽生成基础布局，Qoder CLI补全代码细节，5分钟完成“可视化→代码”转换，比纯手写快10倍。</p>
<p><strong>低代码可视化配置流程（前置操作）</strong>：登录OneCode平台→进入“SVG画布编辑器”→选择“排课表模板”→拖拽“周一至周五”时间轴组件与“课程块”组件→调整位置与基础样式（如颜色、大小）→点击“生成注解代码”，即可得到<code>WeeklyScheduleView</code>的基础类结构，后续仅需补充细节逻辑。</p>
<p>这种“低代码搭骨架+QoderCLI补细节”的模式，使排课表基础结构开发时间从1小时缩短至5分钟，且生成的代码天然符合OneCode规范。</p>
<pre><code class="hljs language-javascript" lang="javascript">package com.<span class="hljs-property">onecode</span>.<span class="hljs-property">view</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">onecode</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">svg</span>.*;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">onecode</span>.<span class="hljs-property">service</span>.<span class="hljs-property">ScheduleService</span>;

<span class="hljs-comment">/**
 * SVG动态排课表视图
 * 注解说明：<span class="hljs-doctag">@SVGPaperFormAnnotation</span>定义画布，<span class="hljs-doctag">@SVGRectCombAnnotation</span>定义课程块
 * QoderCLI辅助：自动补全注解属性与基础结构
 */</span>
@<span class="hljs-title class_">SVGPaperFormAnnotation</span>(
    width = <span class="hljs-string">"100%"</span>,
    height = <span class="hljs-string">"600px"</span>,
    selectable = <span class="hljs-literal">true</span>,
    customService = <span class="hljs-title class_">ScheduleService</span>.<span class="hljs-property">class</span> <span class="hljs-comment">// 关联后端服务</span>
)
public <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeeklyScheduleView</span> {
    <span class="hljs-comment">// 排课表表头（周一至周五）</span>
    @<span class="hljs-title class_">SVGText</span>
    @<span class="hljs-title class_">SVGAnnotation</span>(
        text = <span class="hljs-string">"周一"</span>,
        left = <span class="hljs-string">"150px"</span>,
        top = <span class="hljs-string">"80px"</span>,
        fontSize = <span class="hljs-string">"16px"</span>,
        fontWeight = <span class="hljs-string">"bold"</span>,
        fill = <span class="hljs-string">"#333333"</span>
    )
    private <span class="hljs-title class_">SVGText</span> mondayTitle;
    
    @<span class="hljs-title class_">SVGText</span>
    @<span class="hljs-title class_">SVGAnnotation</span>(text = <span class="hljs-string">"周二"</span>, left = <span class="hljs-string">"280px"</span>, top = <span class="hljs-string">"80px"</span>, fontSize = <span class="hljs-string">"16px"</span>, fontWeight = <span class="hljs-string">"bold"</span>)
    private <span class="hljs-title class_">SVGText</span> tuesdayTitle;
    
    <span class="hljs-comment">// 数学课课程块（核心交互元素）</span>
    @<span class="hljs-title class_">SVGRectCombAnnotation</span>
    @<span class="hljs-title class_">SVGAnnotation</span>(
        width = <span class="hljs-string">"120px"</span>,
        height = <span class="hljs-string">"80px"</span>,
        left = <span class="hljs-string">"150px"</span>,
        top = <span class="hljs-string">"100px"</span>,
        fill = <span class="hljs-string">"#4CAF50"</span>,
        stroke = <span class="hljs-string">"#388E3C"</span>,
        strokeWidth = <span class="hljs-string">"2"</span>
    )
    @<span class="hljs-title class_">SVGAttrAnnotation</span>(rx = <span class="hljs-string">"5"</span>, ry = <span class="hljs-string">"5"</span>) <span class="hljs-comment">// 圆角配置（QoderCLI推荐属性）</span>
    private <span class="hljs-title class_">SVGRectCombAnnotation</span> mondayMathClass;
    
    <span class="hljs-comment">// 课程文本内容</span>
    @<span class="hljs-title class_">SVGText</span>
    @<span class="hljs-title class_">SVGAnnotation</span>(
        text = <span class="hljs-string">"数学课\n9:00-10:30"</span>,
        left = <span class="hljs-string">"160px"</span>,
        top = <span class="hljs-string">"120px"</span>,
        fontSize = <span class="hljs-string">"14px"</span>,
        fill = <span class="hljs-string">"#FFFFFF"</span>,
        fontWeight = <span class="hljs-string">"bold"</span>
    )
    private <span class="hljs-title class_">SVGText</span> mondayMathText;
    
    <span class="hljs-comment">// 英语课课程块（通过QoderCLI批量生成）</span>
    @<span class="hljs-title class_">SVGRectCombAnnotation</span>
    @<span class="hljs-title class_">SVGAnnotation</span>(width = <span class="hljs-string">"120px"</span>, height = <span class="hljs-string">"80px"</span>, left = <span class="hljs-string">"150px"</span>, top = <span class="hljs-string">"200px"</span>, fill = <span class="hljs-string">"#2196F3"</span>)
    private <span class="hljs-title class_">SVGRectCombAnnotation</span> mondayEnglishClass;
    
    @<span class="hljs-title class_">SVGText</span>
    @<span class="hljs-title class_">SVGAnnotation</span>(text = <span class="hljs-string">"英语课\n10:40-12:10"</span>, left = <span class="hljs-string">"160px"</span>, top = <span class="hljs-string">"220px"</span>, fontSize = <span class="hljs-string">"14px"</span>, fill = <span class="hljs-string">"#FFFFFF"</span>)
    private <span class="hljs-title class_">SVGText</span> mondayEnglishText;
}
</code></pre>
<p>QoderCLI辅助技巧：当编写课程块注解时，OneCode QoderCLI会实时推荐常用属性（如圆角rx/ry、边框宽度），并自动匹配OneCode主题色，避免视觉风格混乱。</p>
<h3 data-id="heading-9">3.2 第二步（8分钟）：注解化配置，让课程块“活”起来</h3>
<p>核心优势：不用写一行JS/CSS动画代码，通过OneCode @AnimBinder注解配置，配合Qoder CLI自动补全参数，8分钟实现所有交互动效。</p>
<h4 data-id="heading-10">场景1：鼠标悬停高亮动画</h4>
<p>为课程块添加“颜色渐变+轻微缩放”的悬停效果，提升交互反馈：</p>
<pre><code class="hljs language-javascript" lang="javascript">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeeklyScheduleView</span> {
    <span class="hljs-comment">// 悬停动画绑定（QoderCLI生成完整配置）</span>
    @<span class="hljs-title class_">AnimBinder</span>(
        customAnim = <span class="hljs-title class_">CustomAnimType</span>.<span class="hljs-property">combine</span>, <span class="hljs-comment">// 组合动画</span>
        name = <span class="hljs-string">"classHoverEffect"</span>,
        trigger = <span class="hljs-title class_">AnimTrigger</span>.<span class="hljs-property">MOUSE_OVER</span>, <span class="hljs-comment">// 触发条件：鼠标悬停</span>
        params = {
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"fillColor"</span>, value = <span class="hljs-string">"#66BB6A"</span>), <span class="hljs-comment">// 高亮颜色</span>
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"scale"</span>, value = <span class="hljs-string">"1.05"</span>), <span class="hljs-comment">// 缩放比例</span>
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"duration"</span>, value = <span class="hljs-string">"300ms"</span>) <span class="hljs-comment">// 动画时长</span>
        },
        bindElements = {<span class="hljs-string">"mondayMathClass"</span>, <span class="hljs-string">"mondayEnglishClass"</span>} <span class="hljs-comment">// 绑定多个课程块</span>
    )
    private <span class="hljs-title class_">AnimBinder</span> hoverAnimation;
    
    <span class="hljs-comment">// 鼠标离开恢复动画</span>
    @<span class="hljs-title class_">AnimBinder</span>(
        customAnim = <span class="hljs-title class_">CustomAnimType</span>.<span class="hljs-property">reset</span>,
        name = <span class="hljs-string">"classResetEffect"</span>,
        trigger = <span class="hljs-title class_">AnimTrigger</span>.<span class="hljs-property">MOUSE_OUT</span>,
        params = @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"duration"</span>, value = <span class="hljs-string">"200ms"</span>),
        bindElements = {<span class="hljs-string">"mondayMathClass"</span>, <span class="hljs-string">"mondayEnglishClass"</span>}
    )
    private <span class="hljs-title class_">AnimBinder</span> resetAnimation;
}
</code></pre>
<h4 data-id="heading-11">场景2：点击反馈与课程详情弹窗</h4>
<p>点击课程块时触发“缩放+颜色加深”动画，并调用后端服务显示课程详情：</p>
<pre><code class="hljs language-javascript" lang="javascript">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeeklyScheduleView</span> {
    <span class="hljs-comment">// 点击动画</span>
    @<span class="hljs-title class_">AnimBinder</span>(
        customAnim = <span class="hljs-title class_">CustomAnimType</span>.<span class="hljs-property">combine</span>,
        name = <span class="hljs-string">"classClickEffect"</span>,
        trigger = <span class="hljs-title class_">AnimTrigger</span>.<span class="hljs-property">CLICK</span>,
        params = {
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"fillColor"</span>, value = <span class="hljs-string">"#2E7D32"</span>),
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"scale"</span>, value = <span class="hljs-string">"0.98"</span>),
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"duration"</span>, value = <span class="hljs-string">"150ms"</span>)
        },
        bindElements = {<span class="hljs-string">"mondayMathClass"</span>}
    )
    private <span class="hljs-title class_">AnimBinder</span> clickAnimation;
    
    <span class="hljs-comment">// 点击事件绑定（关联后端服务方法）</span>
    @<span class="hljs-title class_">SVGEvent</span>(
        eventEnum = <span class="hljs-title class_">SVGEventEnum</span>.<span class="hljs-property">onClick</span>,
        actions = {
            @<span class="hljs-title class_">CustomAction</span>(
                type = <span class="hljs-title class_">ActionTypeEnum</span>.<span class="hljs-property">METHOD</span>,
                name = <span class="hljs-string">"showCourseDetail"</span>,
                method = <span class="hljs-string">"getCourseById"</span> <span class="hljs-comment">// 后端服务方法</span>
            )
        }
    )
    private <span class="hljs-title class_">SVGRectCombAnnotation</span> mathClassClickEvent;
    
    <span class="hljs-comment">// 接收后端返回的课程详情</span>
    private <span class="hljs-title class_">CourseDetail</span> currentCourseDetail;
}
</code></pre>
<h4 data-id="heading-12">场景3：课程冲突预警闪烁动画</h4>
<p>当检测到同一时间段重复排课时，课程块自动触发“红橙交替闪烁”动画，提醒管理员处理：</p>
<pre><code class="hljs language-javascript" lang="javascript">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeeklyScheduleView</span> {
    <span class="hljs-comment">// 冲突预警动画</span>
    @<span class="hljs-title class_">AnimBinder</span>(
        customAnim = <span class="hljs-title class_">CustomAnimType</span>.<span class="hljs-property">blinkAlertLoop</span>,
        name = <span class="hljs-string">"conflictAlertEffect"</span>,
        params = {
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"color1"</span>, value = <span class="hljs-string">"#F44336"</span>),
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"color2"</span>, value = <span class="hljs-string">"#FFCDD2"</span>),
            @<span class="hljs-title class_">AnimParam</span>(key = <span class="hljs-string">"interval"</span>, value = <span class="hljs-string">"500ms"</span>)
        }
    )
    private <span class="hljs-title class_">AnimBinder</span> conflictAnimation;
    
    <span class="hljs-comment">// 接收后端冲突通知，触发动画</span>
    public <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScheduleConflict</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> courseId</span>) {
        <span class="hljs-comment">// 定位冲突课程块并绑定动画</span>
        <span class="hljs-title class_">SVGRectCombAnnotation</span> conflictBlock = <span class="hljs-title function_">getCourseBlockById</span>(courseId);
        conflictAnimation.<span class="hljs-title function_">bindElement</span>(conflictBlock);
        conflictAnimation.<span class="hljs-title function_">start</span>();
        
        <span class="hljs-comment">// 显示冲突提示（OneCode内置弹窗组件）</span>
        <span class="hljs-title class_">OneCodeDialog</span>.<span class="hljs-title function_">showWarning</span>(<span class="hljs-string">"课程冲突"</span>, currentCourseDetail.<span class="hljs-title function_">getConflictReason</span>());
    }
}
</code></pre>
<h3 data-id="heading-13">3.3 第三步（7分钟）：全栈联动，后端服务一键生成</h3>
<p>核心效率点：Qoder CLI一键生成服务类基础结构，仅需补充5行业务逻辑，7分钟完成“数据加载-事件处理-主动推送”全链路服务，无需手动写接口注解与返回格式。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解withContext和launch的真正区别]]></title>    <link>https://juejin.cn/post/7577001324416712754</link>    <guid>https://juejin.cn/post/7577001324416712754</guid>    <pubDate>2025-11-26T13:59:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577001324416712754" data-draft-id="7576518316137087027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解withContext和launch的真正区别"/> <meta itemprop="keywords" content="Kotlin,Android,Android Jetpack"/> <meta itemprop="datePublished" content="2025-11-26T13:59:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解withContext和launch的真正区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T13:59:27.000Z" title="Wed Nov 26 2025 13:59:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「The Real Difference Between withContext(Dispatchers.IO) and launch(Dispatchers.IO)」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fproandroiddev.com%2Fthe-real-difference-between-withcontext-dispatchers-io-and-launch-dispatchers-io-b70ec00a33f2" target="_blank" title="https://proandroiddev.com/the-real-difference-between-withcontext-dispatchers-io-and-launch-dispatchers-io-b70ec00a33f2" ref="nofollow noopener noreferrer">proandroiddev.com/the-real-di…</a>，由
Anatolii Frolov发布于2025年11月20日。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30bc5447b8124c14a0e977e4fcfb30ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764770367&amp;x-signature=Zstme%2FcfUwhZEmfTU2VpoaWcp28%3D" alt="0.png" loading="lazy"/></p>
<p>在使用 Kotlin 协程时，很容易遇到两种看起来 几乎相同的模式。它们都使用了 <code>Dispatchers.IO</code>。它们都将工作移出主线程。它们都出现在不同团队编写的仓库、服务层和 ViewModel 代码中。</p>
<p>但相似之处仅限于表面。它们的行为截然不同——这种差异会影响实际 Android 项目中的顺序、正确性，甚至线程安全。当后台操作影响 UI 状态或共享数据时，这一点尤为重要。</p>
<p>这种困惑不难理解。它们的语法几乎相同，并且都在同一个调度器上运行。但一个会暂停直到工作完成，而另一个会启动并行工作并立即返回。这创建了不同的执行路径，很容易被忽略。</p>
<p>本文解释了 <code>withContext(Dispatchers.IO)</code> 和 <code>launch(Dispatchers.IO)</code> 之间的真正区别，通过实际代码展示了它们的行为差异，并重点介绍了这种差异在生产环境 Android 应用中的重要性。</p>
<h2 data-id="heading-0">看似相同的代码行为却截然不同</h2>
<p>以下两段代码看起来几乎一样：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">withContext(Dispatchers.IO) {
    <span class="hljs-comment">// work</span>
}launch(Dispatchers.IO) {
    <span class="hljs-comment">// work</span>
}
</code></pre>
<p>它们运行在同一个调度器上。它们都将工作转移到后台线程。但它们的行为<strong>并不</strong>相同。</p>
<p>以下是并排运行它们的结果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    println(<span class="hljs-string">"Start"</span>)

    launch(Dispatchers.IO) {
        delay(<span class="hljs-number">100</span>)
        println(<span class="hljs-string">"Inside launch"</span>)
    }

    withContext(Dispatchers.IO) {
        delay(<span class="hljs-number">50</span>)
        println(<span class="hljs-string">"Inside withContext"</span>)
    }

    println(<span class="hljs-string">"End"</span>)
}
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-bash" lang="bash">Start
Inside withContext
End
Inside launch
</code></pre>
<p>这展示了关键区别。</p>
<p><code>withContext</code> 会等待其工作完成才会继续执行。</p>
<p><code>launch</code> 则完全不等待——它并行运行，并在稍后完成。</p>
<h2 data-id="heading-1">为什么会发生这种情况</h2>
<p><code>withContext</code> 是一个挂起函数。这意味着当前协程会在该行暂停，切换到 <code>Dispatchers.IO</code>，执行代码块，然后从中断的地方继续执行。这里的关键词是<strong>等待</strong>。在该行之后的任何代码都会等待代码块执行完毕。</p>
<p><code>launch</code> 会创建一个新的协程并立即返回。当前协程会立即继续执行，而新创建的代码块会独立执行。这是一种“触发并继续”模式。除非你显式地对新创建的协程调用 <code>join()</code>，否则不会有等待。</p>
<p>这不是一个 bug，而是协程构建器的设计决策。</p>
<p><code>withContext</code> 确保单个协程内部的执行顺序。</p>
<p><code>launch</code> 的设计本身就引入了并发性。</p>
<p>这种视觉上的相似性掩盖了行为上的差异。前者保持代码的可预测顺序，而后者引入了并行工作，这些工作可能会根据调度和负载情况随时完成。</p>
<h2 data-id="heading-2">这种差异在实际项目中的重要性</h2>
<p>在许多 Android 场景中，任务完成的确切时间至关重要。哪怕是顺序上的细微差别，都可能导致一些难以察觉的 bug，直到生产环境才会被发现。</p>
<h3 data-id="heading-3">1. 后台任务完成后更新 UI</h3>
<p>在 ViewModel 中：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">viewModelScope.launch {
    <span class="hljs-keyword">val</span> user = withContext(Dispatchers.IO) {
        userRepository.loadUser()
    }
    _state.value = user
}
</code></pre>
<p>输出（概念图）：</p>
<pre><code class="hljs language-bash" lang="bash">User loaded first
UI updated second
</code></pre>
<p>由于 <code>withContext</code> 会等待，因此 UI 只有在加载完成后才会更新。</p>
<p>但如果将其替换为 <code>launch(Dispatchers.IO)</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">viewModelScope.launch {
    <span class="hljs-keyword">var</span> result: User? = <span class="hljs-literal">null</span>

    launch(Dispatchers.IO) {
        result = userRepository.loadUser()
    }

    _state.value = result
}
</code></pre>
<p>输出（概念图）：</p>
<pre><code class="hljs language-bash" lang="bash">UI updated first
User loaded later
</code></pre>
<p>这里，UI 在后台任务完成之前就更新了。语法上的视觉相似性掩盖了执行顺序的不同。</p>
<h3 data-id="heading-4">2.协调多步骤后台操作</h3>
<p>在自定义仓库代码中，你可能需要操作严格按照顺序执行。例如，先保存数据，然后写入日志：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">withContext(Dispatchers.IO) {
    fileWriter.save(<span class="hljs-keyword">data</span>)
}

withContext(Dispatchers.IO) {
    logWriter.write(<span class="hljs-string">"Saved"</span>)
}
</code></pre>
<p><code>suspend</code> 保证了操作顺序。日志写入必须在保存完成后才能进行。</p>
<p>但使用 <code>launch</code> 则：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">launch(Dispatchers.IO) { fileWriter.save(<span class="hljs-keyword">data</span>) }
launch(Dispatchers.IO) { logWriter.write(<span class="hljs-string">"Saved"</span>) }
</code></pre>
<p>这两个操作可以以任意顺序执行。在负载较高的情况下，日志写入可能早于保存操作。这听起来似乎无关紧要，但一旦调试或审计变得困难，就会造成问题。</p>
<h3 data-id="heading-5">3. 访问共享状态</h3>
<p>使用 <code>withContext</code> 进行顺序执行在更新共享对象时更安全：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">withContext(Dispatchers.IO) {
    cache.update(item)
}
</code></pre>
<p>使用 <code>launch</code>，两个更新操作可以同时运行：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">launch(Dispatchers.IO) { cache.update(item1) }
launch(Dispatchers.IO) { cache.update(item2) }
</code></pre>
<p>除非缓存本身是线程安全的，否则并行写入可能会导致竞态条件。</p>
<h2 data-id="heading-6">为什么这种差异容易被忽略</h2>
<p>主要原因是语法。两者都使用相同的括号。两者都显示 <code>Dispatchers.IO</code>。两者都将代码包裹在代码块中。人们的注意力会集中在调度器上，而不是协程构建器上。</p>
<p>另一个原因是许多现代库已经在内部处理线程。Room DAO 方法和 Retrofit 的挂起函数不需要 <code>withContext(Dispatchers.IO)</code>。由于这些库减少了手动切换调度器，开发者看到的协程构建器之间的明显差异较少。</p>
<p>这可能会造成一种错觉，即所有调度器的用法都可以互换，但对于自定义操作来说并非如此。</p>
<h2 data-id="heading-7">与 async/await 的深入比较</h2>
<p>为了进一步突出差异，请比较以下三个示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> deferred = async(Dispatchers.IO) {
    loadData()
}<span class="hljs-keyword">val</span> result = deferred.await()
println(result)
</code></pre>
<p>输出（概念图）：</p>
<pre><code class="hljs language-bash" lang="bash">loadData completes
result printed
</code></pre>
<p><code>async</code> 的行为类似于 <code>launch</code>，但返回 <code>Deferred</code>。</p>
<p><code>await()</code> 会将其转换为顺序行为——就像 <code>withContext</code> 一样。</p>
<p>关键点：<strong>顺序行为仅在显式等待时发生。</strong></p>
<h2 data-id="heading-8">异常处理行为</h2>
<p><code>withContext</code> 直接在调用协程中抛出异常。它们不会被延迟或存储。</p>
<p><code>launch</code> 将异常报告给其父作用域。如果该作用域有 supervisor 或自定义异常处理程序，则效果不同。异常不会立即中断调用者的执行路径。</p>
<p>这意味着：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">withContext(Dispatchers.IO) { error(<span class="hljs-string">"Boom"</span>) }
println(<span class="hljs-string">"Next"</span>)
</code></pre>
<p>崩溃会在“Next”执行之前停止协程。</p>
<p>但使用 <code>launch</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">launch(Dispatchers.IO) { error(<span class="hljs-string">"Boom"</span>) }
println(<span class="hljs-string">"Next"</span>)
</code></pre>
<p>“Next”仍然会打印。启动的协程会自行崩溃。</p>
<h2 data-id="heading-9">需要记住的内容</h2>
<ul>
<li>
<p><code>withContext</code> <strong>等待</strong>代码块执行完毕后才会继续执行。</p>
</li>
<li>
<p><code>launch</code> 会启动<strong>并行</strong>工作并立即返回。</p>
</li>
<li>
<p>当<strong>结果或顺序</strong>至关重要时，请使用 <code>withContext</code>。</p>
</li>
<li>
<p>当你需要<strong>并发工作</strong>且无需阻塞调用者时，请使用 <code>launch</code>。</p>
</li>
<li>
<p>视觉上的相似性掩盖了行为上的差异——协程构建器定义了语义，而不是调度器。</p>
</li>
</ul>
<h2 data-id="heading-10">总结</h2>
<p><code>withContext(Dispatchers.IO)</code> 和 <code>launch(Dispatchers.IO)</code> 看起来相似，但行为却不同。前者会暂停并确保顺序执行，而后者会创建并发并立即继续执行。当工作顺序、共享状态、UI 更新或异常处理依赖于工作完成时间时，这种差异至关重要。</p>
<p>理解这种区别可以使协程代码更易于预测，并避免那些只有在实际应用中才会显现的细微错误。</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepAgents官方文档（一）]]></title>    <link>https://juejin.cn/post/7576859345935302710</link>    <guid>https://juejin.cn/post/7576859345935302710</guid>    <pubDate>2025-11-26T14:03:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576859345935302710" data-draft-id="7576838552472240171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepAgents官方文档（一）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-26T14:03:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桜吹雪"/> <meta itemprop="url" content="https://juejin.cn/user/1179091901098269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepAgents官方文档（一）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1179091901098269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桜吹雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T14:03:08.000Z" title="Wed Nov 26 2025 14:03:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>DeepAgents.js官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fjavascript%2Fdeepagents%2Foverview" target="_blank" title="https://docs.langchain.com/oss/javascript/deepagents/overview" ref="nofollow noopener noreferrer">Deep Agents</a></p>
<hr/>
<h2 data-id="heading-0">Deep Agents 概览</h2>
<p><strong>构建能够规划、使用 subagents 以及利用文件系统处理复杂任务的 agents</strong></p>
<p><code>deepagents</code> 是一个独立的库，专为构建能够处理复杂、多步骤任务的 agents 而设计。它基于 <strong>LangGraph</strong> 构建，灵感来源于 <strong>Claude Code</strong>、<strong>Deep Research</strong> 和 <strong>Manus</strong> 等应用。Deep agents 自带规划能力、用于上下文管理的文件系统，以及生成 (spawn) <strong>subagents</strong> 的能力。</p>
<h3 data-id="heading-1">何时使用 deep agents</h3>
<p>当您需要具备以下能力的 agents 时，请使用 deep agents：</p>
<ul>
<li>处理需要规划和分解的<strong>复杂、多步骤任务</strong></li>
<li>通过文件系统 tools <strong>管理大量上下文</strong></li>
<li>将<strong>工作委托</strong>给专门的 subagents 以实现上下文隔离</li>
<li>跨对话和 <strong>threads</strong> 持久化 <strong>memory</strong></li>
</ul>
<p>对于更简单的用例，请考虑使用 <strong>LangChain</strong> 的 <code>create_agent</code> 或构建自定义的 <strong>LangGraph workflow</strong>。</p>
<h3 data-id="heading-2">核心能力 (Core capabilities)</h3>
<h4 data-id="heading-3">规划与任务分解 (Planning and task decomposition)</h4>
<p>Deep agents 包含一个内置的 <code>write_todos</code> tool，使 agents 能够将复杂任务分解为离散的步骤，跟踪进度，并随着新信息的出现动态调整计划。</p>
<h4 data-id="heading-4">上下文管理 (Context management)</h4>
<p>文件系统 <strong>tools</strong> (<code>ls</code>, <code>read_file</code>, <code>write_file</code>, <code>edit_file</code>) 允许 agents 将大量上下文卸载 (offload) 到 <strong>memory</strong> 中，从而防止 <strong>context window</strong> 溢出，并支持处理变长的 tool 结果。</p>
<h4 data-id="heading-5">Subagent 生成 (Subagent spawning)</h4>
<p>内置的 <code>task</code> tool 允许 agents 生成专门的 <strong>subagents</strong> 以进行上下文隔离。这既保持了主 agent 的上下文整洁，又能针对特定的子任务进行深入处理。</p>
<h4 data-id="heading-6">长期记忆 (Long-term memory)</h4>
<p>利用 <strong>LangGraph</strong> 的 <strong>Store</strong> 扩展 agents，使其具备跨 <strong>threads</strong> 的持久化 <strong>memory</strong>。Agents 可以保存并检索先前对话中的信息。</p>
<h3 data-id="heading-7">与 LangChain 生态系统的关系</h3>
<p>Deep agents 构建于以下基础之上：</p>
<ul>
<li><strong>LangGraph</strong> - 提供底层的 graph 执行和 <strong>state</strong> 管理</li>
<li><strong>LangChain</strong> - <strong>Tools</strong> 和 <strong>model</strong> 集成可与 deep agents 无缝协作</li>
<li><strong>LangSmith</strong> - 提供 <strong>Observability</strong> (可观测性)、评估和部署支持</li>
</ul>
<p>Deep agents 应用程序可以通过 <strong>LangSmith Deployment</strong> 进行部署，并使用 <strong>LangSmith Observability</strong> 进行监控。
这里是根据 LangChain DeepAgents JavaScript 文档（参考 <code>langchain-ai/deepagentsjs</code> 官方仓库及文档结构）进行的专业翻译。</p>
<hr/>
<h2 data-id="heading-8">快速开始 (Quickstart)</h2>
<p>在几分钟内构建您的第一个DeepAgent</p>
<p>本指南将指导您创建具备规划、文件系统工具和子Agent功能的DeepAgent。您将构建一个能够进行研究并撰写报告的研究Agent。</p>
<h3 data-id="heading-9">先决条件</h3>
<p>开始前，请确保已从模型提供商（如 Anthropic、OpenAI）获取 API 密钥。</p>
<h4 data-id="heading-10">步骤1：安装依赖项</h4>
<p>首先，安装 <code>deepagents</code> 包以及必要的依赖项。</p>
<pre><code class="hljs language-bash" lang="bash">npm install deepagents @langchain/tavily  
<span class="hljs-comment"># 或  </span>
yarn add deepagents @langchain/tavily  
<span class="hljs-comment"># 或  </span>
pnpm add deepagents @langchain/tavily
</code></pre>
<h4 data-id="heading-11">步骤2：设置 API 密钥</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> ANTHROPIC_API_KEY=<span class="hljs-string">"your-api-key"</span>  
<span class="hljs-built_in">export</span> TAVILY_API_KEY=<span class="hljs-string">"your-tavily-api-key"</span>
</code></pre>
<h4 data-id="heading-12">步骤3：创建搜索工具</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { tool } <span class="hljs-keyword">from</span> <span class="hljs-string">"langchain"</span>;  
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TavilySearch</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/tavily"</span>;  
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;  

<span class="hljs-keyword">const</span> internetSearch = <span class="hljs-title function_">tool</span>(  
  <span class="hljs-keyword">async</span> ({}: {  
    <span class="hljs-attr">query</span>: <span class="hljs-built_in">string</span>;  
    maxResults?: <span class="hljs-built_in">number</span>;  
    topic?: <span class="hljs-string">"general"</span> | <span class="hljs-string">"news"</span> | <span class="hljs-string">"finance"</span>;  
    includeRawContent?: <span class="hljs-built_in">boolean</span>;  
  }) =&gt; {  
    <span class="hljs-keyword">const</span> tavilySearch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TavilySearch</span>({  
      maxResults,  
      <span class="hljs-attr">tavilyApiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">TAVILY_API_KEY</span>,  
      includeRawContent,  
      topic,  
    });  
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> tavilySearch.<span class="hljs-title function_">_call</span>({ query });  
  },  
  {  
    <span class="hljs-attr">name</span>: <span class="hljs-string">"internet_search"</span>,  
    <span class="hljs-attr">description</span>: <span class="hljs-string">"执行网络搜索"</span>,  
    <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({  
      <span class="hljs-attr">query</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"搜索查询"</span>),  
      <span class="hljs-attr">maxResults</span>: z  
        .<span class="hljs-title function_">number</span>()  
        .<span class="hljs-title function_">optional</span>()  
        .<span class="hljs-title function_">default</span>(<span class="hljs-number">5</span>)  
        .<span class="hljs-title function_">describe</span>(<span class="hljs-string">"最大返回结果数"</span>),  
      <span class="hljs-attr">topic</span>: z  
        .<span class="hljs-title function_">enum</span>([<span class="hljs-string">"general"</span>, <span class="hljs-string">"news"</span>, <span class="hljs-string">"finance"</span>])  
        .<span class="hljs-title function_">optional</span>()  
        .<span class="hljs-title function_">default</span>(<span class="hljs-string">"general"</span>)  
        .<span class="hljs-title function_">describe</span>(<span class="hljs-string">"搜索主题分类"</span>),  
      <span class="hljs-attr">includeRawContent</span>: z  
        .<span class="hljs-title function_">boolean</span>()  
        .<span class="hljs-title function_">optional</span>()  
        .<span class="hljs-title function_">default</span>(<span class="hljs-literal">false</span>)  
        .<span class="hljs-title function_">describe</span>(<span class="hljs-string">"是否包含原始内容"</span>),  
    }),  
  }  
);
</code></pre>
<h4 data-id="heading-13">步骤4：创建deep agent</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { createDeepAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">"deepagents"</span>;  

<span class="hljs-comment">// 引导Agent成为专家研究员的系统提示  </span>
<span class="hljs-keyword">const</span> researchInstructions = <span class="hljs-string">`您是一位专家研究员。您的任务是进行彻底的研究，然后撰写一份精炼的报告。

您可以通过互联网搜索工具作为主要信息收集手段。

## \`internet_search\`

使用此工具针对给定查询执行网络搜索。您可以指定返回结果的最大数量、主题以及是否包含原始内容。`</span>;  

<span class="hljs-keyword">const</span> agent = <span class="hljs-title function_">createDeepAgent</span>({  
  <span class="hljs-attr">tools</span>: [internetSearch],  
  <span class="hljs-attr">systemPrompt</span>: researchInstructions,  
});
</code></pre>
<h4 data-id="heading-14">步骤5：运行Agent</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">invoke</span>({  
  <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"什么是 LangGraph？"</span> }],  
});  

<span class="hljs-comment">// 输出Agent的最终响应  </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">messages</span>[result.<span class="hljs-property">messages</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">content</span>);
</code></pre>
<h3 data-id="heading-15">发生了什么？</h3>
<p>您的DeepAgent自动完成了以下操作：</p>
<ul>
<li><strong>规划策略</strong>：使用内置 <code>write_todos</code>工具分解研究任务</li>
<li><strong>开展研究</strong>：调用 <code>internet_search</code>工具收集信息</li>
<li><strong>上下文管理</strong>：使用文件系统工具（<code>write_file</code>、<code>read_file</code>）卸载大型搜索结果</li>
<li><strong>生成子Agent</strong>（如需）：将复杂子任务委托给专用子Agent</li>
<li><strong>综合报告</strong>：将发现编译为连贯的响应</li>
</ul>
<h3 data-id="heading-16">下一步</h3>
<p>完成首个DeepAgent后，您可以：</p>
<ul>
<li><strong>自定义Agent</strong>：学习自定义选项（系统提示、工具、子Agent）</li>
<li><strong>理解中间件</strong>：深入探究驱动DeepAgent的中间件架构</li>
<li><strong>添加长期记忆</strong>：实现跨会话的持久化记忆</li>
<li><strong>生产部署</strong>：了解 LangGraph 应用的部署方案</li>
</ul>
<hr/>
<h2 data-id="heading-17">定制DeepAgent</h2>
<p>学习如何通过系统提示、工具、子Agent等方式定制DeepAgent</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    Create[create_deep_agent] --&gt; Core[Core Config]
    Create --&gt; Features[Features]

    Core --&gt; Model[Model]
    Core --&gt; Prompt[System Prompt]
    Core --&gt; Tools[Tools]

    Features --&gt; Backend[Backend]
    Features --&gt; Sub[Subagents]
    Features --&gt; Interrupt[Interrupts]

    Model --&gt; Agent[Customized Agent]
    Prompt --&gt; Agent
    Tools --&gt; Agent
    Backend --&gt; Agent
    Sub --&gt; Agent
    Interrupt --&gt; Agent
</code></pre>
<h3 data-id="heading-18">模型</h3>
<p>默认情况下，<code>deepagents</code>使用 <code>claude-sonnet-4-5-20250929</code>。您可以通过传递任意 LangChain 模型对象进行自定义。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatAnthropic</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/anthropic"</span>;  
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;  
<span class="hljs-keyword">import</span> { createDeepAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">"deepagents"</span>;  

<span class="hljs-comment">// 使用 Anthropic 模型  </span>
<span class="hljs-keyword">const</span> agent = <span class="hljs-title function_">createDeepAgent</span>({  
  <span class="hljs-attr">model</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatAnthropic</span>({  
    <span class="hljs-attr">model</span>: <span class="hljs-string">"claude-sonnet-4-20250514"</span>,  
    <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>,  
  }),  
});  

<span class="hljs-comment">// 使用 OpenAI 模型  </span>
<span class="hljs-keyword">const</span> agent2 = <span class="hljs-title function_">createDeepAgent</span>({  
  <span class="hljs-attr">model</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({  
    <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-5"</span>,  
    <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>,  
  }),  
});
</code></pre>
<h3 data-id="heading-19">系统提示</h3>
<p>深度代理内置基于 Claude Code 系统提示的默认引导提示。该默认提示包含使用内置规划工具、文件系统工具和子代理的详细说明。</p>
<p><strong>每个面向特定场景的深度代理都应包含针对该场景的自定义系统提示</strong>。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { createDeepAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">"deepagents"</span>;  

<span class="hljs-keyword">const</span> researchInstructions = <span class="hljs-string">`您是一位专家研究员。您的任务是进行彻底的研究，然后撰写一份精炼的报告。`</span>;  

<span class="hljs-keyword">const</span> agent = <span class="hljs-title function_">createDeepAgent</span>({  
  <span class="hljs-attr">systemPrompt</span>: researchInstructions,  
});
</code></pre>
<h3 data-id="heading-20">工具</h3>
<p>与工具调用代理类似，深度代理可访问一组顶层工具。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { tool } <span class="hljs-keyword">from</span> <span class="hljs-string">"langchain"</span>;  
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TavilySearch</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/tavily"</span>;  
<span class="hljs-keyword">import</span> { createDeepAgent } <span class="hljs-keyword">from</span> <span class="hljs-string">"deepagents"</span>;  
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;  

<span class="hljs-keyword">const</span> internetSearch = <span class="hljs-title function_">tool</span>(  
  <span class="hljs-keyword">async</span> ({  
    query,  
    maxResults = <span class="hljs-number">5</span>,  
    topic = <span class="hljs-string">"general"</span>,  
    includeRawContent = <span class="hljs-literal">false</span>,  
  }: {  
    <span class="hljs-attr">query</span>: <span class="hljs-built_in">string</span>;  
    maxResults?: <span class="hljs-built_in">number</span>;  
    topic?: <span class="hljs-string">"general"</span> | <span class="hljs-string">"news"</span> | <span class="hljs-string">"finance"</span>;  
    includeRawContent?: <span class="hljs-built_in">boolean</span>;  
  }) =&gt; {  
    <span class="hljs-keyword">const</span> tavilySearch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TavilySearch</span>({  
      maxResults,  
      <span class="hljs-attr">tavilyApiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">TAVILY_API_KEY</span>,  
      includeRawContent,  
      topic,  
    });  
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> tavilySearch.<span class="hljs-title function_">_call</span>({ query });  
  },  
  {  
    <span class="hljs-attr">name</span>: <span class="hljs-string">"internet_search"</span>,  
    <span class="hljs-attr">description</span>: <span class="hljs-string">"执行网络搜索"</span>,  
    <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({  
      <span class="hljs-attr">query</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"搜索查询"</span>),  
      <span class="hljs-attr">maxResults</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">optional</span>().<span class="hljs-title function_">default</span>(<span class="hljs-number">5</span>),  
      <span class="hljs-attr">topic</span>: z.<span class="hljs-title function_">enum</span>([<span class="hljs-string">"general"</span>, <span class="hljs-string">"news"</span>, <span class="hljs-string">"finance"</span>]).<span class="hljs-title function_">optional</span>().<span class="hljs-title function_">default</span>(<span class="hljs-string">"general"</span>),  
      <span class="hljs-attr">includeRawContent</span>: z.<span class="hljs-title function_">boolean</span>().<span class="hljs-title function_">optional</span>().<span class="hljs-title function_">default</span>(<span class="hljs-literal">false</span>),  
    }),  
  }  
);  

<span class="hljs-keyword">const</span> agent = <span class="hljs-title function_">createDeepAgent</span>({  
  <span class="hljs-attr">tools</span>: [internetSearch],  
});
</code></pre>
<p>除自定义工具外，深度代理还内置以下默认工具：</p>
<ul>
<li><code>write_todos</code>：更新代理的待办事项列表</li>
<li><code>ls</code>：列出代理文件系统中的所有文件</li>
<li><code>read_file</code>：从文件系统中读取文件</li>
<li><code>write_file</code>：向文件系统中写入新文件</li>
<li><code>edit_file</code>：编辑现有文件</li>
<li><code>task</code>：生成子代理处理特定任务</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Manim进阶：用背景图片让你的数学视频脱颖而出]]></title>    <link>https://juejin.cn/post/7576838552472191019</link>    <guid>https://juejin.cn/post/7576838552472191019</guid>    <pubDate>2025-11-26T12:12:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576838552472191019" data-draft-id="7576841976928534564" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Manim进阶：用背景图片让你的数学视频脱颖而出"/> <meta itemprop="keywords" content="Python,动效"/> <meta itemprop="datePublished" content="2025-11-26T12:12:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Manim进阶：用背景图片让你的数学视频脱颖而出
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T12:12:03.000Z" title="Wed Nov 26 2025 12:12:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>做<code>Manim</code>动画久了，你是否厌倦了那万年不变的黑色虚空？</p>
<p>很多初学者（甚至老手）都想给动画加个背景图，但往往会遇到两个问题：</p>
<ol>
<li><strong>怎么加</strong>？ 是把图片放进去，还是设置相机？</li>
<li><strong>看不清</strong>！ 背景花里胡哨，前面的文字公式瞬间“隐身”了。</li>
</ol>
<p>今天，我们就来揭开<code>Manim</code>动画中一个简单却强大的技巧--为动画添加背景。</p>
<p>通过几个小示例，分别演示两种完全不同的背景处理思路。</p>
<h2 data-id="heading-0">1. 舞台布景法</h2>
<p>使用<code>ImageMobject</code>类，这是最直观、最常用的方法。</p>
<p>它的<strong>逻辑</strong>是：背景图片只是舞台上的一个普通演员，只是它长得特别大，而且站得特别靠后。</p>
<p>这种方式的<strong>特点</strong>是：</p>
<ul>
<li>
<p><strong>高度灵活</strong>：背景就是个对象（<code>Mobject</code>），所以它可以动！你可以让背景旋转、平移、缩放，甚至改变颜色。</p>
</li>
<li>
<p><strong>层级管理</strong>：需要手动把它的 <code>z_index</code> 设低，或者最先添加它。</p>
</li>
</ul>
<p>下面的第一个示例中，实现一个简单的<strong>动态背景</strong>，操作<strong>背景</strong>和操作一般的<code>Mobject</code>是一样的。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Method1ImageMobject</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 1. 加载图片（确保这个图片是存在的）</span>
        bg = ImageMobject(<span class="hljs-string">"./assets/紫色梦幻星空.jpg"</span>)

        <span class="hljs-comment"># 2. 核心操作：撑满屏幕并允许超出</span>
        <span class="hljs-comment"># 我们把高度设为屏幕高度的 2 倍，这样才有移动的空间</span>
        bg.scale_to_fit_height(config.frame_height * <span class="hljs-number">2</span>)

        <span class="hljs-comment"># 3. 核心操作：放到最底层</span>
        bg.set_z_index(-<span class="hljs-number">100</span>)

        self.add(bg)

        <span class="hljs-comment"># 前景物体</span>
        text = Text(<span class="hljs-string">"方法一：ImageMobject"</span>, font_size=<span class="hljs-number">40</span>, color=WHITE)
        sub = Text(<span class="hljs-string">"背景可以动！"</span>, font_size=<span class="hljs-number">24</span>, color=YELLOW).next_to(text, DOWN)

        self.play(Write(text), FadeIn(sub))

        <span class="hljs-comment"># 4. 演示优势：让背景缓慢移动</span>
        self.play(bg.animate.shift(LEFT * <span class="hljs-number">2</span>), rate_func=linear)
        self.play(bg.animate.shift(UP * <span class="hljs-number">2</span>), rate_func=linear)
        self.play(bg.animate.shift(RIGHT * <span class="hljs-number">2</span>), rate_func=linear)
        self.play(bg.animate.shift(DOWN * <span class="hljs-number">2</span>), rate_func=linear)
        self.wait()
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/061bb7b7bbc04a56b9da5766fa01197c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764763923&amp;x-signature=j6qOcgtvxSDXv1NOUOc%2BjPJpDSY%3D" alt="" loading="lazy"/></p>
<p>下面的示例也很简单，就是显示一段简单的公式。</p>
<p>不过，大家可以比较看看，相比于默认的黑色背景，加一个学校的黑板背景，是不是更有亲和力？</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Method2ImageMobject</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 1. 加载图片</span>
        bg = ImageMobject(<span class="hljs-string">"./assets/黑板.jpg"</span>)

        <span class="hljs-comment"># 2. 调整大小铺满屏幕</span>
        bg.scale_to_fit_height(config.frame_height)
        bg.scale_to_fit_width(config.frame_width)

        <span class="hljs-comment"># 3. 核心操作：放到最底层</span>
        bg.set_z_index(-<span class="hljs-number">100</span>)
        self.add(bg)

        <span class="hljs-comment"># 前景物体</span>
        math = MathTex(<span class="hljs-string">r"\int_0^\infty e^{-x^2} dx = \frac{\sqrt{\pi}}{2}"</span>)
        self.play(Write(math))
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/724f8e6c53344fe8b80ecd523d8ad594~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764763923&amp;x-signature=jQeh67hJOUrKJJxZNloxY7%2Bdu88%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">2. 主角光环法</h2>
<p>除了上面两种，还有一种比较特殊的方式，也就是<code>BackgroundColoredVMobjectDisplayer</code>类。</p>
<p>它是一个<strong>负责渲染</strong>的类，专门处理一种特殊情况：<strong>当物体拥有“背景色描边”时，如何遮挡住它背后的东西</strong>。</p>
<p>我们通过 <code>set_background_stroke()</code> 来调用这个机制。</p>
<p>严格来说不是 <strong>“设置全屏背景”</strong>，而是 <strong>“给物体加一个局部背景（Matte）”</strong>，这是在花哨背景下生存的必备技能。</p>
<p>它的<strong>特点</strong>是：</p>
<ul>
<li><strong>局部遮挡</strong>：在文字或公式周围生成一圈不透明的轮廓。</li>
<li><strong>增强对比</strong>：专门用于解决“背景太花，文字看不清”的问题。</li>
</ul>
<p>下面的示例故意构造了一个混乱的背景，然后比较看看，这两个一样的公式，是不是加了局部背景的公式更加清晰。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadableFormulaOnImage</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 1. 先设置一个很花的背景（这里为了演示，我们用随机噪点模拟一张复杂的图）</span>
        <span class="hljs-comment"># 实际使用中，请换成你的 image.jpg</span>
        noise = Rectangle(width=<span class="hljs-number">16</span>, height=<span class="hljs-number">10</span>)
        noise.set_fill(color=[BLUE, RED, GREEN, YELLOW], opacity=<span class="hljs-number">0.5</span>)
        <span class="hljs-comment"># 把它搞得乱一点</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):
            line = Line(
                start=[np.random.uniform(-<span class="hljs-number">7</span>, <span class="hljs-number">7</span>), np.random.uniform(-<span class="hljs-number">4</span>, <span class="hljs-number">4</span>), <span class="hljs-number">0</span>],
                end=[np.random.uniform(-<span class="hljs-number">7</span>, <span class="hljs-number">7</span>), np.random.uniform(-<span class="hljs-number">4</span>, <span class="hljs-number">4</span>), <span class="hljs-number">0</span>],
                color=random_color(),
                stroke_width=<span class="hljs-number">5</span>,
            )
            self.add(line)
        self.add(noise)

        <span class="hljs-comment"># 2. 普通的文字（在花背景下很难看清）</span>
        bad_text = MathTex(<span class="hljs-string">r"\frac{-b \pm \sqrt{b^2 - 4ac}}{2a}"</span>)
        bad_text.shift(UP)

        <span class="hljs-comment"># 3. 【核心技巧】使用 BackgroundColoredVMobject 机制</span>
        <span class="hljs-comment"># set_background_stroke 会给文字加一层“描边”</span>
        <span class="hljs-comment"># 这层描边是不透明的，会利用 Displayer 类遮挡住背景！</span>
        good_text = MathTex(<span class="hljs-string">r"\frac{-b \pm \sqrt{b^2 - 4ac}}{2a}"</span>)
        good_text.set_background_stroke(color=BLACK, width=<span class="hljs-number">8</span>)  <span class="hljs-comment"># 黑色描边，宽度设大一点</span>
        good_text.shift(DOWN)

        <span class="hljs-comment"># 动画演示对比</span>
        self.play(Write(bad_text))

        self.play(Write(good_text))  <span class="hljs-comment"># 清晰可见！</span>
        self.wait()
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4748c568b7ab457997efa40adcd02869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764763923&amp;x-signature=9VFU8qZ%2Bi8B%2FrD1Tl8IPW2cBao8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">3. 两种方式比较</h2>
<p>两种方式各有自己的应用场景，对比如下：</p>








































<table><thead><tr><th>特性</th><th>舞台布景法</th><th>主角光环法</th></tr></thead><tbody><tr><td>本质</td><td>场景中的一个巨大物体</td><td>物体自身的描边属性</td></tr><tr><td>主要用途</td><td>动态背景、视差滚动、多层背景</td><td>高亮主体、对抗花哨背景</td></tr><tr><td>动画能力</td><td>⭐⭐⭐⭐⭐ (极强)</td><td>⭐⭐⭐ (跟随物体运动)</td></tr><tr><td>代码复杂度</td><td>中 (需手动调大小/层级)</td><td>低 (一行设置)</td></tr><tr><td>文档对应</td><td><code>Mobject </code>类</td><td><code>BackgroundColoredVMobjectDisplayer</code></td></tr><tr><td>最佳场景</td><td>漂浮的云、移动的星空</td><td>字幕、复杂背景下的公式</td></tr></tbody></table>
<h2 data-id="heading-3">4. 总结</h2>
<p>简单来说，如果你想做一段电影感的片头，背景需要缓慢推移，请用 <strong>舞台布景法</strong>；</p>
<p>如果你发现文字看不清了，请使用 <strong>主角光环法</strong> (<code>set_background_stroke</code>) 给文字加个 <strong>“光环”</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Solidity合约升级：让你的区块链代码永葆青春的硬核攻略]]></title>    <link>https://juejin.cn/post/7576859594359668736</link>    <guid>https://juejin.cn/post/7576859594359668736</guid>    <pubDate>2025-11-26T12:22:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576859594359668736" data-draft-id="7576867727718432803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Solidity合约升级：让你的区块链代码永葆青春的硬核攻略"/> <meta itemprop="keywords" content="Solidity,智能合约"/> <meta itemprop="datePublished" content="2025-11-26T12:22:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天涯学馆"/> <meta itemprop="url" content="https://juejin.cn/user/3394916565129287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Solidity合约升级：让你的区块链代码永葆青春的硬核攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394916565129287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天涯学馆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T12:22:02.000Z" title="Wed Nov 26 2025 12:22:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天咱们来聊聊Solidity里一个超硬核的技术——合约升级！区块链上的智能合约一旦部署，默认是“铁打不动”的，但现实中需求总在变，bug也得修，咋办？合约升级就是救星！它能让你在不换地址、不丢数据的情况下，悄悄把合约逻辑更新，简直像给代码换了个新皮肤！咱们会用大白话把合约升级的套路讲透，从最简单的代理模式到OpenZeppelin的透明代理和UUPS，再到多签控制升级，配合硬核代码和Hardhat测试，带你一步步实现安全的合约升级。</p>
<h2 data-id="heading-0">核心概念</h2>
<p>先来搞明白几个关键点：</p>
<ul>
<li><strong>不可变性</strong>：以太坊智能合约部署后，字节码和存储通常不可更改。</li>
<li><strong>代理模式</strong>：通过代理合约（Proxy）分离存储和逻辑，代理保存数据，逻辑合约提供代码，升级时只换逻辑合约。</li>
<li><strong>委托调用（delegatecall）</strong>：代理通过<code>delegatecall</code>调用逻辑合约，逻辑合约的代码在代理的存储上下文执行。</li>
<li><strong>存储布局</strong>：代理和逻辑合约的存储槽必须一致，否则数据会乱套。</li>
<li><strong>升级机制</strong>：更新代理指向的逻辑合约地址，实现功能升级。</li>
<li><strong>安全风险</strong>：
<ul>
<li><strong>存储冲突</strong>：新逻辑合约的存储布局变化可能覆盖旧数据。</li>
<li><strong>权限控制</strong>：谁能升级？没限制可能被黑客搞乱。</li>
<li><strong>初始化</strong>：新逻辑合约需要正确初始化。</li>
</ul>
</li>
<li><strong>OpenZeppelin</strong>：提供透明代理（Transparent Proxy）和UUPS（Universal Upgradeable Proxy Standard）实现。</li>
<li><strong>Solidity 0.8.x</strong>：自带溢出/下溢检查，安全可靠。</li>
<li><strong>Hardhat</strong>：开发和测试工具，方便部署和验证。</li>
</ul>
<p>咱们用Solidity 0.8.20，结合OpenZeppelin和Hardhat，从基础代理到高级UUPS和多签升级，逐步实现安全的合约升级。</p>
<h2 data-id="heading-1">环境准备</h2>
<p>用Hardhat搭建开发环境，写和测试合约。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> upgrade-demo
<span class="hljs-built_in">cd</span> upgrade-demo
npm init -y
npm install --save-dev hardhat @nomicfoundation/hardhat-toolbox @openzeppelin/contracts @openzeppelin/contracts-upgradeable
npm install ethers
</code></pre>
<p>初始化Hardhat：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat init
</code></pre>
<p>选择TypeScript项目，安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev ts-node typescript @types/node @types/mocha
</code></pre>
<p>目录结构：</p>
<pre><code class="hljs language-lua" lang="lua">upgrade-demo/
├── contracts/
│   ├── SimpleProxy.sol
│   ├── LogicV1.sol
│   ├── LogicV2.sol
│   ├── TransparentProxy.sol
│   ├── UUPSProxy.sol
│   ├── MultiSigUpgrade.sol
├── scripts/
│   ├── deploy.ts
├── test/
│   ├── Upgrade.test.ts
├── hardhat.<span class="hljs-built_in">config</span>.ts
├── tsconfig.json
├── <span class="hljs-built_in">package</span>.json
</code></pre>
<p><code>tsconfig.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CommonJS"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"resolveJsonModule"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"rootDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"hardhat.config.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"scripts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"test"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>hardhat.config.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">HardhatUserConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat/config"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"@nomicfoundation/hardhat-toolbox"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">HardhatUserConfig</span> = {
  <span class="hljs-attr">solidity</span>: <span class="hljs-string">"0.8.20"</span>,
  <span class="hljs-attr">networks</span>: {
    <span class="hljs-attr">hardhat</span>: {
      <span class="hljs-attr">chainId</span>: <span class="hljs-number">1337</span>,
    },
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> config;
</code></pre>
<p>跑本地节点：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat node
</code></pre>
<h2 data-id="heading-2">基础代理合约</h2>
<p>先搞一个简单的代理合约，弄清楚<code>delegatecall</code>和升级的套路。</p>
<h3 data-id="heading-3">合约代码</h3>
<p><code>contracts/LogicV1.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract LogicV1 {
    address public owner;
    uint256 public value;

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/LogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract LogicV2 {
    address public owner;
    uint256 public value;

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value * 2; // V2 doubles the value
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/SimpleProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract SimpleProxy {
    address public implementation;
    address public owner;

    constructor(address _implementation) {
        owner = msg.sender;
        implementation = _implementation;
    }

    function upgrade(address _newImplementation) public {
        require(msg.sender == owner, "Only owner");
        implementation = _newImplementation;
    }

    fallback() external payable {
        address impl = implementation;
        require(impl != address(0), "Implementation not set");

        assembly {
            let ptr := mload(0x40)
            calldatacopy(ptr, 0, calldatasize())
            let result := delegatecall(gas(), impl, ptr, calldatasize(), 0, 0)
            let size := returndatasize()
            returndatacopy(ptr, 0, size)
            switch result
            case 0 { revert(ptr, size) }
            default { return(ptr, size) }
        }
    }

    receive() external payable {}
}
</code></pre>
<h3 data-id="heading-4">解析</h3>
<ul>
<li><strong>LogicV1</strong>：基础逻辑合约，存<code>owner</code>和<code>value</code>，提供<code>initialize</code>、<code>setValue</code>、<code>getValue</code>。</li>
<li><strong>LogicV2</strong>：升级版，<code>setValue</code>将输入值翻倍，存储布局与V1一致。</li>
<li><strong>SimpleProxy</strong>：
<ul>
<li>存<code>implementation</code>（逻辑合约地址）和<code>owner</code>。</li>
<li><code>upgrade</code>：更新逻辑合约地址，仅<code>owner</code>可调用。</li>
<li><code>fallback</code>：用<code>delegatecall</code>转发调用到<code>implementation</code>，用汇编实现低级调用。</li>
</ul>
</li>
<li><strong>delegatecall</strong>：逻辑合约的代码在代理的存储上下文执行，<code>owner</code>和<code>value</code>存在代理合约。</li>
<li><strong>安全特性</strong>：
<ul>
<li><code>onlyOwner</code>限制升级权限。</li>
<li>检查<code>implementation</code>不为空。</li>
<li>初始化检查防止重复设置。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">测试</h3>
<p><code>test/Upgrade.test.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SimpleProxy</span>, <span class="hljs-title class_">LogicV1</span>, <span class="hljs-title class_">LogicV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"SimpleProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">SimpleProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">LogicV1</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">LogicV2</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"SimpleProxy"</span>);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">initialize</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict setValue to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Only owner"</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">upgrade</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxy.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgrade</span>(logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Only owner"</span>);
  });
});
</code></pre>
<p>跑测试：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat <span class="hljs-built_in">test</span>
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>LogicV1</code>和<code>SimpleProxy</code>，通过代理调用<code>initialize</code>。</li>
<li>操作：设置<code>value</code>为42，验证存储在代理。</li>
<li>升级：切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20，<code>owner</code>不变。</li>
<li>权限：非<code>owner</code>无法升级。</li>
</ul>
</li>
<li><strong>存储</strong>：代理保存<code>owner</code>和<code>value</code>，<code>delegatecall</code>确保逻辑合约操作代理存储。</li>
</ul>
<h2 data-id="heading-6">存储冲突的坑</h2>
<p>存储布局不一致会导致数据错乱，来看个错误例子。</p>
<h3 data-id="heading-7">错误示例</h3>
<p><code>contracts/BadLogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract BadLogicV2 {
    uint256 public value; // Slot 0 (wrong order)
    address public owner; // Slot 1 (wrong order)

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p>测试：</p>
<p><code>test/Upgrade.test.ts</code>（添加）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">it</span>(<span class="hljs-string">"should fail with storage collision"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
  <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">BadLogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"BadLogicV2"</span>);
  <span class="hljs-keyword">const</span> badLogicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BadLogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> badLogicV2.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">upgrade</span>(badLogicV2.<span class="hljs-property">address</span>);
  <span class="hljs-keyword">const</span> proxyAsBadLogicV2 = <span class="hljs-title class_">BadLogicV2Factory</span>.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>);
  <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsBadLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-property">not</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
});
</code></pre>
<ul>
<li><strong>问题</strong>：<code>LogicV1</code>的<code>owner</code>(slot 0), <code>value</code>(slot 1)，<code>BadLogicV2</code>的<code>value</code>(slot 0), <code>owner</code>(slot 1)，升级后<code>owner</code>被覆盖为<code>value</code>的值。</li>
<li><strong>解决</strong>：新逻辑合约必须保持存储布局一致，或用OpenZeppelin的工具规范化。</li>
</ul>
<h2 data-id="heading-8">透明代理（Transparent Proxy）</h2>
<p>用OpenZeppelin的透明代理，解决管理员和用户调用冲突。</p>
<p><code>contracts/LogicV1.sol</code>（更新）：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";

contract LogicV1 is Initializable, OwnableUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/LogicV2.sol</code>（更新）：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";

contract LogicV2 is Initializable, OwnableUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/TransparentProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/proxy/transparent/TransparentUpgradeableProxy.sol";

contract TransparentProxy is TransparentUpgradeableProxy {
    constructor(address logic, address admin, bytes memory data)
        TransparentUpgradeableProxy(logic, admin, data)
    {}
}
</code></pre>
<h3 data-id="heading-9">解析</h3>
<ul>
<li><strong>LogicV1/V2</strong>：
<ul>
<li>用<code>Initializable</code>和<code>OwnableUpgradeable</code>，支持代理初始化。</li>
<li><code>initializer</code>确保初始化只执行一次。</li>
</ul>
</li>
<li><strong>TransparentProxy</strong>：
<ul>
<li>继承<code>TransparentUpgradeableProxy</code>。</li>
<li>构造函数设置逻辑合约、管理员地址、初始化数据。</li>
<li>透明机制：管理员调用操作代理（如升级），普通用户调用转发到逻辑合约。</li>
</ul>
</li>
<li><strong>安全特性</strong>：
<ul>
<li>防止管理员误调用逻辑合约。</li>
<li><code>OwnableUpgradeable</code>管理权限。</li>
<li>标准化的存储布局。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">测试</h3>
<p><code>test/Upgrade.test.ts</code>（更新）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TransparentProxy</span>, <span class="hljs-title class_">LogicV1</span>, <span class="hljs-title class_">LogicV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"TransparentProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">TransparentProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">LogicV1</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">LogicV2</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">admin</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1, admin] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"TransparentProxy"</span>);
    <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, admin.<span class="hljs-property">address</span>, initData);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict setValue to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyAdminFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"ProxyAdmin"</span>, admin);
    <span class="hljs-keyword">const</span> proxyAdmin = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyAdminFactory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">deployed</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">connect</span>(admin).<span class="hljs-title function_">upgrade</span>(proxy.<span class="hljs-property">address</span>, logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to admin"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyAdminFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"ProxyAdmin"</span>, admin);
    <span class="hljs-keyword">const</span> proxyAdmin = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyAdminFactory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">deployed</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAdmin.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgrade</span>(proxy.<span class="hljs-property">address</span>, logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });
});
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>LogicV1</code>和<code>TransparentProxy</code>，通过<code>initData</code>初始化。</li>
<li>操作：设置<code>value</code>为42。</li>
<li>升级：用<code>ProxyAdmin</code>切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20。</li>
<li>权限：只有<code>admin</code>可升级。</li>
</ul>
</li>
<li><strong>透明机制</strong>：管理员调用直接操作代理，普通用户调用转发到逻辑合约。</li>
</ul>
<h2 data-id="heading-11">UUPS代理（Universal Upgradeable Proxy Standard）</h2>
<p>UUPS把升级逻辑放逻辑合约，代理更轻量。</p>
<p><code>contracts/UUPSLogicV1.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";

contract UUPSLogicV1 is Initializable, OwnableUpgradeable, UUPSUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
        __UUPSUpgradeable_init();
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }

    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {}
}
</code></pre>
<p><code>contracts/UUPSLogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";

contract UUPSLogicV2 is Initializable, OwnableUpgradeable, UUPSUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
        __UUPSUpgradeable_init();
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }

    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {}
}
</code></pre>
<p><code>contracts/UUPSProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/proxy/ERC1967/ERC1967Proxy.sol";

contract UUPSProxy is ERC1967Proxy {
    constructor(address logic, bytes memory data) ERC1967Proxy(logic, data) {}
}
</code></pre>
<h3 data-id="heading-12">解析</h3>
<ul>
<li><strong>UUPSLogicV1/V2</strong>：
<ul>
<li>继承<code>UUPSUpgradeable</code>，包含升级逻辑。</li>
<li><code>_authorizeUpgrade</code>：限制升级权限。</li>
</ul>
</li>
<li><strong>UUPSProxy</strong>：
<ul>
<li>继承<code>ERC1967Proxy</code>，逻辑地址存标准槽位。</li>
<li>构造函数：设置逻辑合约和初始化数据。</li>
</ul>
</li>
<li><strong>优势</strong>：
<ul>
<li>代理合约轻量，升级逻辑在逻辑合约。</li>
<li>可通过自毁移除升级功能。</li>
</ul>
</li>
<li><strong>安全特性</strong>：
<ul>
<li><code>onlyOwner</code>控制升级。</li>
<li><code>Initializer</code>防止重复初始化。</li>
<li>ERC1967标准槽位。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">测试</h3>
<p><code>test/Upgrade.test.ts</code>（更新）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UUPSProxy</span>, <span class="hljs-title class_">UUPSLogicV</span>1, <span class="hljs-title class_">UUPSLogicV</span>2 } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"UUPSProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">UUPSProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">UUPSLogicV</span>1;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">UUPSLogicV</span>2;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSProxy"</span>);
    <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, initData);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">upgradeTo</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgradeTo</span>(logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });
});
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>UUPSLogicV1</code>和<code>UUPSProxy</code>，通过<code>initData</code>初始化。</li>
<li>操作：设置<code>value</code>为42。</li>
<li>升级：调用<code>upgradeTo</code>切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20。</li>
<li>权限：非<code>owner</code>无法升级。</li>
</ul>
</li>
<li><strong>UUPS特点</strong>：升级逻辑在逻辑合约，代理更轻量。</li>
</ul>
<h2 data-id="heading-14">多签控制升级</h2>
<p>为升级加多签机制，需多人同意。</p>
<p><code>contracts/MultiSigUpgrade.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";

contract MultiSigUpgrade is Initializable, UUPSUpgradeable, OwnableUpgradeable {
    address[] public owners;
    uint256 public required;
    uint256 public transactionCount;
    mapping(uint256 =&gt; Transaction) public transactions;
    mapping(uint256 =&gt; mapping(address =&gt; bool)) public confirmations;
    uint256 public value;

    struct Transaction {
        address newImplementation;
        bool executed;
        uint256 confirmationCount;
    }

    event SubmitUpgrade(uint256 indexed txId, address indexed newImplementation);
    event ConfirmUpgrade(uint256 indexed txId, address indexed owner);
    event ExecuteUpgrade(uint256 indexed txId, address indexed newImplementation);
    event RevokeConfirmation(uint256 indexed txId, address indexed owner);

    modifier onlyOwner() {
        bool isOwner = false;
        for (uint256 i = 0; i &lt; owners.length; i++) {
            if (owners[i] == msg.sender) {
                isOwner = true;
                break;
            }
        }
        require(isOwner, "Not owner");
        _;
    }

    function initialize(address[] memory _owners, uint256 _required) public initializer {
        __Ownable_init(msg.sender);
        __UUPSUpgradeable_init();
        require(_owners.length &gt; 0, "Owners required");
        require(_required &gt; 0 &amp;&amp; _required &lt;= _owners.length, "Invalid required");
        owners = _owners;
        required = _required;
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }

    function submitUpgrade(address newImplementation) public onlyOwner {
        require(newImplementation != address(0), "Invalid implementation");
        uint256 txId = transactionCount++;
        transactions[txId] = Transaction({
            newImplementation: newImplementation,
            executed: false,
            confirmationCount: 0
        });
        emit SubmitUpgrade(txId, newImplementation);
    }

    function confirmUpgrade(uint256 txId) public onlyOwner {
        Transaction storage transaction = transactions[txId];
        require(!transaction.executed, "Transaction already executed");
        require(!confirmations[txId][msg.sender], "Already confirmed");

        confirmations[txId][msg.sender] = true;
        transaction.confirmationCount++;
        emit ConfirmUpgrade(txId, msg.sender);

        if (transaction.confirmationCount &gt;= required) {
            executeUpgrade(txId);
        }
    }

    function executeUpgrade(uint256 txId) internal {
        Transaction storage transaction = transactions[txId];
        require(!transaction.executed, "Transaction already executed");
        require(transaction.confirmationCount &gt;= required, "Insufficient confirmations");

        transaction.executed = true;
        _authorizeUpgrade(transaction.newImplementation);
        _upgradeTo(transaction.newImplementation);
        emit ExecuteUpgrade(txId, transaction.newImplementation);
    }

    function revokeConfirmation(uint256 txId) public onlyOwner {
        Transaction storage transaction = transactions[txId];
        require(!transaction.executed, "Transaction already executed");
        require(confirmations[txId][msg.sender], "Not confirmed");

        confirmations[txId][msg.sender] = false;
        transaction.confirmationCount--;
        emit RevokeConfirmation(txId, msg.sender);
    }

    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {}
}
</code></pre>
<p><code>contracts/MultiSigLogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";

contract MultiSigLogicV2 is Initializable, UUPSUpgradeable, OwnableUpgradeable {
    address[] public owners;
    uint256 public required;
    uint256 public transactionCount;
    mapping(uint256 =&gt; Transaction) public transactions;
    mapping(uint256 =&gt; mapping(address =&gt; bool)) public confirmations;
    uint256 public value;

    struct Transaction {
        address newImplementation;
        bool executed;
        uint256 confirmationCount;
    }

    event SubmitUpgrade(uint256 indexed txId, address indexed newImplementation);
    event ConfirmUpgrade(uint256 indexed txId, address indexed owner);
    event ExecuteUpgrade(uint256 indexed txId, address indexed newImplementation);
    event RevokeConfirmation(uint256 indexed txId, address indexed owner);

    modifier onlyOwner() {
        bool isOwner = false;
        for (uint256 i = 0; i &lt; owners.length; i++) {
            if (owners[i] == msg.sender) {
                isOwner = true;
                break;
            }
        }
        require(isOwner, "Not owner");
        _;
    }

    function initialize(address[] memory _owners, uint256 _required) public initializer {
        __Ownable_init(msg.sender);
        __UUPSUpgradeable_init();
        require(_owners.length &gt; 0, "Owners required");
        require(_required &gt; 0 &amp;&amp; _required &lt;= _owners.length, "Invalid required");
        owners = _owners;
        required = _required;
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value * 2; // V2 doubles the value
    }

    function getValue() public view returns (uint256) {
        return value;
    }

    function submitUpgrade(address newImplementation) public onlyOwner {
        require(newImplementation != address(0), "Invalid implementation");
        uint256 txId = transactionCount++;
        transactions[txId] = Transaction({
            newImplementation: newImplementation,
            executed: false,
            confirmationCount: 0
        });
        emit SubmitUpgrade(txId, newImplementation);
    }

    function confirmUpgrade(uint256 txId) public onlyOwner {
        Transaction storage transaction = transactions[txId];
        require(!transaction.executed, "Transaction already executed");
        require(!confirmations[txId][msg.sender], "Already confirmed");

        confirmations[txId][msg.sender] = true;
        transaction.confirmationCount++;
        emit ConfirmUpgrade(txId, msg.sender);

        if (transaction.confirmationCount &gt;= required) {
            executeUpgrade(txId);
        }
    }

    function executeUpgrade(uint256 txId) internal {
        Transaction storage transaction = transactions[txId];
        require(!transaction.executed, "Transaction already executed");
        require(transaction.confirmationCount &gt;= required, "Insufficient confirmations");

        transaction.executed = true;
        _authorizeUpgrade(transaction.newImplementation);
        _upgradeTo(transaction.newImplementation);
        emit ExecuteUpgrade(txId, transaction.newImplementation);
    }

    function revokeConfirmation(uint256 txId) public onlyOwner {
        Transaction storage transaction = transactions[txId];
        require(!transaction.executed, "Transaction already executed");
        require(confirmations[txId][msg.sender], "Not confirmed");

        confirmations[txId][msg.sender] = false;
        transaction.confirmationCount--;
        emit RevokeConfirmation(txId, msg.sender);
    }

    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {}
}
</code></pre>
<h3 data-id="heading-15">解析</h3>
<ul>
<li><strong>MultiSigUpgrade</strong>：
<ul>
<li>继承<code>UUPSUpgradeable</code>，支持多签升级。</li>
<li><code>owners</code>和<code>required</code>控制多签。</li>
<li><code>submitUpgrade</code>：提交升级提案。</li>
<li><code>confirmUpgrade</code>：确认提案，达标后执行。</li>
<li><code>executeUpgrade</code>：调用<code>_upgradeTo</code>切换逻辑。</li>
<li><code>revokeConfirmation</code>：撤销确认。</li>
</ul>
</li>
<li><strong>MultiSigLogicV2</strong>：升级版，<code>setValue</code>翻倍。</li>
<li><strong>安全特性</strong>：
<ul>
<li>多签防止单人误操作。</li>
<li><code>onlyOwner</code>限制操作。</li>
<li>检查<code>newImplementation</code>有效性。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-16">测试</h3>
<p><code>test/Upgrade.test.ts</code>（添加）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UUPSProxy</span>, <span class="hljs-title class_">MultiSigUpgrade</span>, <span class="hljs-title class_">MultiSigLogicV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"MultiSigUpgrade"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">UUPSProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">MultiSigUpgrade</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">MultiSigLogicV2</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner1</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">owner2</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">owner3</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">nonOwner</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner1, owner2, owner3, nonOwner] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigUpgrade"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSProxy"</span>);
    <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [
      [owner1.<span class="hljs-property">address</span>, owner2.<span class="hljs-property">address</span>, owner3.<span class="hljs-property">address</span>],
      <span class="hljs-number">2</span>,
    ]);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, initData);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigLogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigUpgrade"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owners</span>(<span class="hljs-number">0</span>)).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner1.<span class="hljs-property">address</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.required()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">2</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigUpgrade"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade with multi-sig"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigUpgrade"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">submitUpgrade</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">connect</span>(owner2).<span class="hljs-title function_">confirmUpgrade</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">connect</span>(owner3).<span class="hljs-title function_">confirmUpgrade</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigLogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owners</span>(<span class="hljs-number">0</span>)).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner1.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should not upgrade without enough confirmations"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigUpgrade"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">submitUpgrade</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">connect</span>(owner2).<span class="hljs-title function_">confirmUpgrade</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigLogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// Still V1</span>
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should allow revoking confirmation"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigUpgrade"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">submitUpgrade</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">connect</span>(owner2).<span class="hljs-title function_">confirmUpgrade</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">connect</span>(owner2).<span class="hljs-title function_">revokeConfirmation</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">connect</span>(owner3).<span class="hljs-title function_">confirmUpgrade</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigLogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// Still V1</span>
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to owners"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigUpgrade"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(nonOwner).<span class="hljs-title function_">submitUpgrade</span>(logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Not owner"</span>);
  });
});
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：3个<code>owners</code>，需2人确认。</li>
<li>操作：设置<code>value</code>为42。</li>
<li>升级：提交提案，2人确认后切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20。</li>
<li>撤销：撤销确认阻止升级。</li>
</ul>
</li>
<li><strong>安全</strong>：多签机制防止单人误操作。</li>
</ul>
<h2 data-id="heading-17">部署脚本</h2>
<p><code>scripts/deploy.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [owner, admin, owner1, owner2, owner3] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
  <span class="hljs-keyword">const</span> logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`LogicV1 deployed to: <span class="hljs-subst">${logicV1.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">TransparentProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"TransparentProxy"</span>);
  <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
  <span class="hljs-keyword">const</span> transparentProxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">TransparentProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, admin.<span class="hljs-property">address</span>, initData);
  <span class="hljs-keyword">await</span> transparentProxy.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`TransparentProxy deployed to: <span class="hljs-subst">${transparentProxy.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">UUPSLogicV</span>1Factory = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>);
  <span class="hljs-keyword">const</span> uupsLogicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UUPSLogicV</span>1Factory.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> uupsLogicV1.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`UUPSLogicV1 deployed to: <span class="hljs-subst">${uupsLogicV1.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">UUPSProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSProxy"</span>);
  <span class="hljs-keyword">const</span> uupsProxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UUPSProxyFactory</span>.<span class="hljs-title function_">deploy</span>(uupsLogicV1.<span class="hljs-property">address</span>, initData);
  <span class="hljs-keyword">await</span> uupsProxy.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`UUPSProxy deployed to: <span class="hljs-subst">${uupsProxy.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">MultiSigLogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"MultiSigUpgrade"</span>);
  <span class="hljs-keyword">const</span> multiSigLogicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">MultiSigLogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> multiSigLogicV1.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`MultiSigUpgrade deployed to: <span class="hljs-subst">${multiSigLogicV1.address}</span>`</span>);

  <span class="hljs-keyword">const</span> multiSigInitData = <span class="hljs-title class_">MultiSigLogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [
    [owner1.<span class="hljs-property">address</span>, owner2.<span class="hljs-property">address</span>, owner3.<span class="hljs-property">address</span>],
    <span class="hljs-number">2</span>,
  ]);
  <span class="hljs-keyword">const</span> multiSigProxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UUPSProxyFactory</span>.<span class="hljs-title function_">deploy</span>(multiSigLogicV1.<span class="hljs-property">address</span>, multiSigInitData);
  <span class="hljs-keyword">await</span> multiSigProxy.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`MultiSigProxy deployed to: <span class="hljs-subst">${multiSigProxy.address}</span>`</span>);
}

<span class="hljs-title function_">main</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
  process.<span class="hljs-property">exitCode</span> = <span class="hljs-number">1</span>;
});
</code></pre>
<p>跑部署：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat run scripts/deploy.ts --network hardhat
</code></pre>
<ul>
<li><strong>解析</strong>：部署所有代理和逻辑合约，记录地址。</li>
</ul>
<h2 data-id="heading-18">性能分析</h2>
<ul>
<li><strong>部署</strong>：
<ul>
<li><code>SimpleProxy</code>：~0.6M gas。</li>
<li><code>TransparentProxy</code>：~1.2M gas。</li>
<li><code>UUPSProxy</code>：~0.8M gas。</li>
<li><code>LogicV1</code>/<code>UUPSLogicV1</code>：~1M gas。</li>
<li><code>MultiSigUpgrade</code>：~1.5M gas。</li>
</ul>
</li>
<li><strong>操作</strong>：
<ul>
<li>初始化：~100k gas。</li>
<li>设置值：~50k gas。</li>
<li>升级：~~60k gas（透明），~~40k gas（UUPS），~100k gas（多签）。</li>
</ul>
</li>
</ul>
<hr/>
<p>跑代码，体验Solidity合约升级的硬核玩法吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[给 TRAE SOLO 一台服务器，它能干什么？]]></title>    <link>https://juejin.cn/post/7576821684252475435</link>    <guid>https://juejin.cn/post/7576821684252475435</guid>    <pubDate>2025-11-26T12:36:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576821684252475435" data-draft-id="7576859345935089718" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="给 TRAE SOLO 一台服务器，它能干什么？"/> <meta itemprop="keywords" content="Trae,Solo,AI编程"/> <meta itemprop="datePublished" content="2025-11-26T12:36:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            给 TRAE SOLO 一台服务器，它能干什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T12:36:45.000Z" title="Wed Nov 26 2025 12:36:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前一阵子刷到一个很有意思的操作：有人直接把一台服务器的权限扔给了 AI，并简单说了句目标。</p>
<p>然后，AI 就从零开始安装环境、配依赖，拉仓库，启动服务，最后成功完成了对外服务的提供。</p>
<p>今天，我们就尝试下这个思路：让 <code>TRAE SOLO</code> 自行在远程服务器中搭建一套 <code>MinerU</code> 环境。</p>
<h2 data-id="heading-0">MinerU</h2>
<p>首先，简单介绍下 <code>MinerU</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33f6d82478d04e299eb19d753a2feee7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=eyAcvMYv80Ko0lYxi894%2BhOMfN4%3D" alt="" loading="lazy"/></p>
<p><code>MinerU</code> 是一款能将<strong>PDF/图片转换为机器可读格式</strong>（例如 <code>markdown</code>、<code>JSON</code>）的工具，诞生于上海人工智能实验室出品大模型 <code>InternLM</code> 的预训练过程中。</p>
<p>核心特性：</p>
<ul>
<li><strong>多模态文档解析</strong>：支持多种文档类型，包括扫描版 PDF</li>
<li><strong>结构化还原</strong>：可识别表格、公式、分子式等</li>
<li><strong>高保真语义理解</strong>：利用布局分析和阅读顺序推理，避免传统 OCR 机械识别导致的逻辑错乱。</li>
<li><strong>本地化 &amp; 开源免费</strong>：全部模型和代码开源，可私有部署，无需调用外部 API，保障数据隐私。</li>
</ul>
<h2 data-id="heading-1">共绩算力</h2>
<p>AI 要部署的应用已经了解了，现在需要给 AI 找一个可以操作的服务器。</p>
<p>最近我使用的算力平台是“共绩算力”，<code>RTX 4090</code> 只要 <code>1.68</code> 元/小时，还能按毫秒计费、自动扩容，非常便于我根据研究的模型挑选合适的节点配置。</p>
<p>尤其是目前，平台还有福利，<strong>注册就送算力券</strong>。</p>
<h2 data-id="heading-2">实操记录</h2>
<h3 data-id="heading-3">节点建立</h3>
<p>注册并登录“共绩算力”平台。</p>
<p>在“云主机”页面选择合适的节点</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/381d765e27df439a89ad4481f0287395~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=Rc4YtH5x9fML4ri8vP5vSZVT9jw%3D" alt="" loading="lazy"/></p>
<p>选择合适的节点类型后，配置相关镜像、存储等，我这里配置了“基础镜像”，由于是测试搭建模型，未配置相关存储。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45720f1c6b0c433eb1630a9778577e87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=ZHXguh3rd2MYd2LyIXgx%2F%2FIF8wI%3D" alt="" loading="lazy"/></p>
<p>如果是第一次租用，账户余额为 0，会要求充值一下（0.01元即可），然后，需要在个人中心关注下公众号，这些按照页面提示进行即可。</p>
<p>租用成功后，会在“控制台”-“云主机列表”中看到租用的节点。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ced2f6fccc284a258c6b961f3df6fc34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=c53clo2VeJABljwf1KwMHtyaP8E%3D" alt="" loading="lazy"/></p>
<p>24G 显存、63G 内存，1小时 1.68 元，并且有算力券抵扣，还很合适的。</p>
<h3 data-id="heading-4">远程连接</h3>
<p><strong>第一步</strong>，我们先来调整下 <code>SSH</code> 连接的命令，让其支持端口映射，方便访问 demo。</p>
<p>在上一步的“云主机列表”-“SSH登录信息”中，复制出登录指令，格式如下。</p>
<pre><code class="hljs language-css" lang="css">ssh root<span class="hljs-keyword">@hdy1</span>.550c.cloud -p <span class="hljs-number">40002</span>
</code></pre>
<p>增加<strong>端口映射参数</strong>。</p>
<pre><code class="hljs language-java" lang="java">ssh -vvN -L <span class="hljs-number">7860</span>:<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">7860</span> root<span class="hljs-meta">@hdy1</span>.550c.cloud -p <span class="hljs-number">40002</span>
</code></pre>
<p>其中 <code>7860</code> 是 <code>MinerU demo</code> 的服务端口。</p>
<p><strong>第二步</strong>，我们打开 <code>TRAE</code> 进行远程连接。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f9b703dfe8241f19585bdafa24cd984~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=M1BqQ%2FKJfoL%2FPVZAlOzkjla%2Fc70%3D" alt="" loading="lazy"/></p>
<p>输入上面的指令，回车即可。</p>
<p>此时会要求录入密码，再次从“云主机列表”-“SSH登录信息”中复制“登录密码”即可。</p>
<blockquote>
<p>如果同一地址连接多次，可能会在 SSH 连接中生成多个相同的 Host，此时会出现登录失败的情况，手动删除重复的 Host 即可。</p>
</blockquote>
<p>成功连接后，终端信息如下。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a9b28a6d3d742e1a8102d68ad591783~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=m8gIiVOKAC5gAOWKDOX9fEqEBFc%3D" alt="" loading="lazy"/></p>
<p>正常情况下可以在编辑器中打开远程文件夹，也可以在终端执行命令了。</p>
<p>但今天，我们都交给 AI。</p>
<h3 data-id="heading-5">环境部署</h3>
<p>开发环境：国际版 <code>SOLO Coder</code> 智能体，未选择 <code>Plan</code> 模式。</p>
<p>直接在 <code>Chat</code> 窗口录入如下指令，等待完成。</p>
<p><strong>指令</strong></p>
<p>指令非常简单，让 AI 参考 <code>MinerU</code> 官方仓库文档，自行完成部署。</p>
<p>因为模型下载涉及到 <code>HuggingFace</code> 的网络问题，一般各大算力企业都会提供镜像内容，这里把“共绩算力”的镜像文档也放上了。</p>
<pre><code class="hljs language-ruby" lang="ruby">参考github文档<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/opendatalab</span><span class="hljs-regexp">/mineru?tab=readme-ov-file ，帮我完成mineru的安装，并完成demo启动。
云服务器文档：https:/</span><span class="hljs-regexp">/www.gongjiyun.com/docs</span><span class="hljs-regexp">/server/introduction</span><span class="hljs-regexp">/rznmwsy13i4a8yktuyycoxyinmg/</span> 
</code></pre>
<p><strong>过程</strong></p>
<p>过程很清晰：安装依赖、下载模型、启动Demo。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ed996c916d140cdb6e08f5c1fdf5da5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=zqHwEcUepdAd22Ase9gK8vIZOhs%3D" alt="" loading="lazy"/></p>
<p>后面还有详细的安装步骤、网络加速与镜像建议、常用参数与优化、问题排查、后续可选增强等内容，便于我们回顾审阅。</p>
<p><strong>SOLO 模式的好处就是中间遇到问题，它可以自行解决</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a961e3db9aa7494f8246f58bcf74ae20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=xQkx4ScwbTogw%2Bfyg2KosdmFI84%3D" alt="" loading="lazy"/></p>
<p>最后还给出了 demo 的访问方式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad9688c470114572ba55130ceef88e8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=BzTO%2FbDrygPDuRktGgBxwy02eHw%3D" alt="" loading="lazy"/></p>
<p><strong>结果</strong></p>
<p>命令执行完成后，<code>SOLO</code> 内置浏览器已经帮我把 demo 打开了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbb24fca4efe455ea6f1c14f79537ddb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=1diCpbeVDiDxzba0NULY8kS%2F6PU%3D" alt="" loading="lazy"/></p>
<p>这里可以通过 <code>http://localhost:7860/</code> 访问到服务器，就是因为“远程连接”章节中的 SSH 命令中增加了端口映射。</p>
<h3 data-id="heading-6">调试优化</h3>
<p>上面跑起来的 demo，上传测试的 PDF 后，转换报错。</p>
<p>不着急，我们直接让 <code>SOLO</code> 帮忙修复下。</p>
<p><strong>指令</strong></p>
<pre><code class="hljs">demo中上传后报错，请帮我修复
</code></pre>
<p><strong>过程</strong></p>
<p><code>SOLO</code> 可以从终端中获取错误信息，快速定位问题：</p>
<p>“上传解析时报错的根因是 Gradio 处理流程在解析时尝试访问 HuggingFace 获取模型元数据，出现 SSL 错误导致函数返回 None ，最终触发 TypeError: cannot unpack non-iterable NoneType object ”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/147e903ead2f409eb39b6ffa8b9c95c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=NjQAkBUNiBJd0hRoLD75Qfim%2B1c%3D" alt="" loading="lazy"/></p>
<p><strong>结果</strong></p>
<p>再次上传 <code>PDF</code>，可以看到提取结果了，已经完成了今天的既定目标了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fad90c7e2c44072961045993260da4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764765405&amp;x-signature=nZEk2Y46KqYNQjC%2F79J7mgqmy%2FQ%3D" alt="" loading="lazy"/></p>
<p>由于模型参数未调优，识别中存在些许问题，非此次分享重点，我们就不再讨论了。</p>
<h2 data-id="heading-7">结语</h2>
<p>整个过程还是非常顺利的，除了我第一次忘记配置模型镜像下载导致的失败。</p>
<p>之前以为 AI 可以自己 <code>SOLO</code> 代码就很酷了，没想到，AI 都已经可以自己掌控服务器了。</p>
<p>给个目标，就能直接等待验收？那后续技术验证、环境搭建脚本岂不是更轻松了。</p>
<p>当部署、调试、优化也能交给 AI 自主完成后，开发者就有了更多的时间去思考“做什么”而非“怎么做”——这或许才是智能时代的生产力跃迁。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LLM 推理的“显存墙”与“通信墙”：从显存分布到部署原则]]></title>    <link>https://juejin.cn/post/7576852209565499419</link>    <guid>https://juejin.cn/post/7576852209565499419</guid>    <pubDate>2025-11-26T11:12:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576852209565499419" data-draft-id="7576838095519219763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" LLM 推理的“显存墙”与“通信墙”：从显存分布到部署原则"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-26T11:12:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mwq30123"/> <meta itemprop="url" content="https://juejin.cn/user/3403743729030686"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             LLM 推理的“显存墙”与“通信墙”：从显存分布到部署原则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3403743729030686/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mwq30123
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T11:12:53.000Z" title="Wed Nov 26 2025 11:12:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是一篇基于我们之前的对话内容整合而成的深度技术文章。文章从你提供的关于“显存与带宽限制”的精辟论述出发，深入剖析了 Llama-3-70B 的实际数据，对比了 MHA 与 GQA 的巨大差异，并探讨了 LLM 推理系统的核心瓶颈。</p>
<hr/>
<h2 data-id="heading-0">破解 LLM 推理的“显存墙”与“通信墙”：从显存分布到部署原则</h2>
<h4 data-id="heading-1">引言：推理系统的双重束缚</h4>
<p>众所周知，一般情况下 LLM 的推理都是在 GPU 上进行。单张 GPU 的显存是有限的，这构成了大模型落地的第一道物理屏障。显存的占用主要分为两大部分：</p>
<ol>
<li><strong>静态显存（Static Memory）</strong> ：用于存放模型的参数（Weights）和前向计算的临时激活值（Activations）。这部分依赖于模型的体量，一旦选定模型（如 70B 或 405B），它几乎就是一个固定的常数，是我们进入游戏的“门票”。</li>
<li><strong>动态显存（Dynamic Memory）</strong> ：主要用于存放 <strong>KV Cache</strong>。这部分不仅依赖于模型的体量，更强依赖于模型的输入长度（Context Length）和并发量（Batch Size）。在推理过程中，它是动态线性增长的。当 Context 长度足够长时，它的大小就会反客为主，占据主导地位，甚至轻松超出一张卡、一台机（8张卡）的总显存量。</li>
</ol>
<p>在 GPU 上部署模型有一个黄金原则：<strong>能一张卡部署的，就不要跨多张卡；能一台机部署的，就不要跨多台机。</strong></p>
<p>这是因为数据传输遵循严格的物理层级： <strong>“卡内通信带宽（SRAM ↔ HBM） &gt; 卡间通信带宽（NVLink） &gt; 机间通信带宽（Infiniband/Ethernet）”</strong> 。由于“木桶效应”，模型部署时跨越的物理设备越多，受低速通信带宽的“拖累”就越大。事实上，即便是目前最顶级的 H100，其卡内显存带宽（HBM3）虽然达到了 3TB/s，但对于 Short Context 推理（Memory Bound 场景）来说，这个速度依然是瓶颈，更不用说速度下降数个数量级的卡间和机间通信了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe1a1cd2190a4c8c9a82828f1387ba5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbXdxMzAxMjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764760388&amp;x-signature=fP4lCr0rriERst%2BCyMS7rj3crJ0%3D" alt="截屏2025-11-26 19.11.37.png" loading="lazy"/></p>
<h4 data-id="heading-2">一、 显存账本：Llama-3-70B 的真实开销</h4>
<p>为了具象化理解上述原则，我们以 <strong>Llama-3-70B</strong> 模型在 <strong>FP16</strong> 精度下的部署为例，算一笔显存的账。</p>
<h5 data-id="heading-3">1. 静态显存：昂贵的入场券</h5>
<p>Llama-3-70B 拥有 700 亿参数。在 FP16 精度下，每个参数占用 2 Bytes。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Static Usage</mtext><mo>≈</mo><mn>70</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>×</mo><mn>2</mn><mtext> Bytes</mtext><mo>≈</mo><mrow><mn mathvariant="bold">140</mn><mtext> GB</mtext></mrow></mrow><annotation encoding="application/x-tex">\text{Static Usage} \approx 70 \times 10^9 \times 2 \text{ Bytes} \approx \mathbf{140 \text{ GB}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">Static Usage</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">70</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord">2</span><span class="mord text"><span class="mord"> Bytes</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord"><span class="mord mathbf">140</span><span class="mord text"><span class="mord"> GB</span></span></span></span></span></span></span></p>
<p>这意味着，仅仅是为了加载模型，你就至少需要 <strong>2张 80GB 的 A100/H100</strong>。如果只有一张卡，连模型都无法启动。这 140GB 是雷打不动的“固定成本”。</p>
<h5 data-id="heading-4">2. 动态显存：被忽视的隐形杀手</h5>
<p>动态显存的核心是 KV Cache。它存储了所有历史 Token 的键（Key）和值（Value），以避免重复计算。Llama-3-70B 采用了 <strong>GQA（分组查询注意力）</strong> 技术，将 KV Heads 的数量压缩到了 8 个。</p>
<p>在此架构下，每生成或处理 <strong>1 个 Token</strong>，其 KV Cache 的显存占用约为：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>Mem</mtext><mtext>token</mtext></msub><mo>≈</mo><mrow><mn mathvariant="bold">0.31</mn><mtext> MB</mtext></mrow></mrow><annotation encoding="application/x-tex">\text{Mem}_{\text{token}} \approx \mathbf{0.31 \text{ MB}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord text"><span class="mord">Mem</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">token</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord"><span class="mord mathbf">0.31</span><span class="mord text"><span class="mord"> MB</span></span></span></span></span></span></span></p>
<blockquote>
<p>文章底部有计算过程</p>
</blockquote>
<p>看似很小？让我们看看在不同场景下的<strong>总账</strong>：</p>
<ul>
<li>
<p><strong>场景 A（长文档分析）</strong> ：Batch Size=1，Context=32k。</p>
<ul>
<li>KV Cache <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>10</mn><mtext> GB</mtext></mrow><annotation encoding="application/x-tex">\approx 10 \text{ GB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"/><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">10</span><span class="mord text"><span class="mord"> GB</span></span></span></span></span></span>。此时 2张卡（共160GB，剩20GB可用）还能勉强应付。</li>
</ul>
</li>
<li>
<p><strong>场景 B（高并发服务）</strong> ：Batch Size=64，Context=2k。</p>
<ul>
<li>KV Cache <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>41</mn><mtext> GB</mtext></mrow><annotation encoding="application/x-tex">\approx 41 \text{ GB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"/><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">41</span><span class="mord text"><span class="mord"> GB</span></span></span></span></span></span>。</li>
<li><strong>结果</strong>：此时总显存需求达到 181GB，<strong>2张卡直接显存溢出（OOM）</strong> ，系统崩溃。</li>
</ul>
</li>
</ul>
<p>这验证了引言中的判断：<strong>在长文本或高并发场景下，动态显存会迅速吞噬剩余空间，迫使我们增加更多昂贵的 GPU。</strong></p>
<h4 data-id="heading-5">二、 架构的演进：为何 MHA 正在被抛弃？</h4>
<p>为了解决“动态显存爆炸”的问题，现代大模型（如 Llama 3, Mistral）纷纷抛弃了传统的 <strong>MHA（多头注意力）</strong> ，转而使用 <strong>GQA（分组查询注意力）</strong> 。</p>
<p>我们可以做一个<strong>反事实假设</strong>：如果 Llama-3-70B 坚持使用 MHA，会发生什么？</p>
<p>在 MHA 架构下，KV Heads 的数量必须与 Query Heads 一致（64个），这意味着 KV Cache 的大小将直接<strong>翻 8 倍</strong>。</p>

























<table><thead><tr><th><strong>指标</strong></th><th><strong>Llama-3-70B (实际 GQA)</strong></th><th><strong>Llama-3-70B (假设 MHA)</strong></th></tr></thead><tbody><tr><td><strong>单 Token 显存占用</strong></td><td><strong>0.31 MB</strong></td><td><strong>2.5 MB</strong></td></tr><tr><td><strong>32k 长文 (BS=1)</strong></td><td>10 GB (轻松)</td><td><strong>80 GB</strong> (占满一张 H100)</td></tr><tr><td><strong>128k 超长文 (BS=1)</strong></td><td>40 GB (可接受)</td><td><strong>320 GB</strong> (灾难级)</td></tr></tbody></table>
<p>如果使用 MHA，仅为了处理一个 128k 的长文本请求，光是 KV Cache 就需要 <strong>4张 H100</strong>，加上权重则需要 <strong>6-8张</strong>。这将导致推理成本高到无法商业化。因此，从 MHA 向 GQA/MLA 的演进，本质上是一场<strong>为了在有限显存内塞入更长 Context 的自救运动</strong>。</p>
<h4 data-id="heading-6">三、 带宽瓶颈：不仅仅是存不下</h4>
<p>当我们被迫因为显存不足而增加 GPU 数量时（从单卡 -&gt; 多卡 -&gt; 多机），我们立刻撞上了第二道墙：<strong>通信带宽</strong>。</p>
<p>LLM 的推理过程（Decoding 阶段）是一个典型的 <strong>Memory Bound（内存受限）</strong> 任务。</p>
<ul>
<li><strong>计算核心（Tensor Core）</strong> 像是一个切菜极快的厨师（算力过剩）。</li>
<li><strong>显存（HBM）</strong> 像是冰箱。</li>
<li>每生成一个 Token，厨师都需要把冰箱里重达 <strong>140GB</strong> 的食材（权重）全部搬运一遍，切一刀，然后放回去。</li>
</ul>
<p>即便 H100 的 HBM3 带宽高达 3TB/s，搬运一次 140GB 数据也需要约 <strong>46ms</strong>。这意味着，<strong>理论上限</strong>每秒只能生成约 20 个 Token。</p>
<p>而一旦我们将模型切分到多台机器（Model Parallelism）：</p>
<ol>
<li>计算不再是瓶颈，<strong>网络</strong>成了瓶颈。</li>
<li>设备间通信带宽从 3TB/s 骤降至 50-100GB/s（Infiniband）。</li>
<li>每一次矩阵乘法（Matrix Multiplication）都需要在机器间同步数据。</li>
<li>原本 46ms 的延迟可能会变成 500ms 甚至更高，导致用户体验产生极其明显的卡顿。</li>
</ol>
<h4 data-id="heading-7">结语</h4>
<p>理解了显存的静态与动态分布，以及通信带宽的层级差异，我们就能明白当前大模型推理优化的核心逻辑：</p>
<ol>
<li><strong>量化（Quantization）</strong> ：通过 Int8/Int4 压缩静态权重，试图把 70B 模型塞进单卡或更少的卡中，避免跨设备通信。</li>
<li><strong>架构改良（GQA/MLA）</strong> ：通过减少 KV Cache 的体积，延缓动态显存的溢出，从而支持超长上下文（Long Context）。</li>
<li><strong>算子融合（Kernel Fusion）</strong> ：减少数据在 HBM 和 SRAM 之间的搬运次数，突破带宽瓶颈。</li>
</ol>
<p>在显存墙与带宽墙被彻底打破之前， <strong>“能单卡不跨卡，能单机不跨机”</strong> 将始终是 LLM 部署的最高准则。</p>
<h4 data-id="heading-8">单个 Token 的 KV Cache 显存占用计算</h4>
<p>以下是 <strong>Llama-3-70B</strong> 单个 Token 的 KV Cache 显存占用计算公式的详细推导过程。</p>
<h5 data-id="heading-9">1. 通用计算公式</h5>
<p>任何 Transformer 类模型的 KV Cache（每个 Token）显存占用公式如下：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>Mem</mtext><mtext>token</mtext></msub><mo>=</mo><mn>2</mn><mo>×</mo><msub><mi>n</mi><mtext>layers</mtext></msub><mo>×</mo><msub><mi>n</mi><mtext>kv_heads</mtext></msub><mo>×</mo><msub><mi>d</mi><mtext>head</mtext></msub><mo>×</mo><msub><mi>P</mi><mtext>bytes</mtext></msub></mrow><annotation encoding="application/x-tex">\text{Mem}_{\text{token}} = 2 \times n_{\text{layers}} \times n_{\text{kv\_heads}} \times d_{\text{head}} \times P_{\text{bytes}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord text"><span class="mord">Mem</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">token</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">layers</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9503em;vertical-align:-0.367em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">kv_heads</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">head</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">bytes</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></p>
<p><strong>参数含义拆解：</strong></p>
<ul>
<li><strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span></span></span></span></span></strong> ：代表 <strong>Key</strong> 和 <strong>Value</strong> 两个矩阵（Query 不需要缓存）。</li>
<li><strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mtext>layers</mtext></msub></mrow><annotation encoding="application/x-tex">n_{\text{layers}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">layers</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></strong> ：模型的总层数（Layers）。</li>
<li><strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mtext>kv_heads</mtext></msub></mrow><annotation encoding="application/x-tex">n_{\text{kv\_heads}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7976em;vertical-align:-0.367em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">kv_heads</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span/></span></span></span></span></span></span></span></span></span></strong> ：用于存储 KV 的注意力头数量（GQA/MQA 架构下，这个数值小于 Query 头数）。</li>
<li><strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mtext>head</mtext></msub></mrow><annotation encoding="application/x-tex">d_{\text{head}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">head</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></strong> ：单个注意力头的维度大小。</li>
<li><strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mtext>bytes</mtext></msub></mrow><annotation encoding="application/x-tex">P_{\text{bytes}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">bytes</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></strong> ：数据精度占用的字节数（FP16/BF16 通常为 2 Bytes）。</li>
</ul>
<hr/>
<h5 data-id="heading-10">2. Llama-3-70B 的具体参数代入</h5>
<p>根据 Llama-3-70B 的架构配置：</p>
<ol>
<li>
<p><strong>精度 (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mtext>bytes</mtext></msub></mrow><annotation encoding="application/x-tex">P_{\text{bytes}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">bytes</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>)</strong> ：通常推理使用 FP16，即 <strong>2 Bytes</strong>。</p>
</li>
<li>
<p><strong>层数 (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mtext>layers</mtext></msub></mrow><annotation encoding="application/x-tex">n_{\text{layers}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">layers</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>)</strong> ：<strong>80 层</strong>。</p>
</li>
<li>
<p><strong>KV 头数 (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mtext>kv_heads</mtext></msub></mrow><annotation encoding="application/x-tex">n_{\text{kv\_heads}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7976em;vertical-align:-0.367em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">kv_heads</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span/></span></span></span></span></span></span></span></span></span>)</strong> ：</p>
<ul>
<li>Llama-3-70B 使用了 <strong>GQA (Grouped Query Attention)</strong> 。</li>
<li>虽然它的 Query Heads 是 64，但 KV Heads 被压缩到了 <strong>8</strong>。</li>
</ul>
</li>
<li>
<p><strong>单头维度 (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mtext>head</mtext></msub></mrow><annotation encoding="application/x-tex">d_{\text{head}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">head</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>)</strong> ：</p>
<ul>
<li>计算公式：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Hidden Size</mtext><mi mathvariant="normal">/</mi><mtext>Query Heads</mtext></mrow><annotation encoding="application/x-tex">\text{Hidden Size} / \text{Query Heads}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">Hidden Size</span></span><span class="mord">/</span><span class="mord text"><span class="mord">Query Heads</span></span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8192</mn><mi mathvariant="normal">/</mi><mn>64</mn><mo>=</mo><mn mathvariant="bold">128</mn></mrow><annotation encoding="application/x-tex">8192 / 64 = \mathbf{128}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">8192/64</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord"><span class="mord mathbf">128</span></span></span></span></span></span>。</li>
</ul>
</li>
</ol>
<hr/>
<h5 data-id="heading-11">3. 计算步骤</h5>
<p>将上述数值代入公式：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mtext>Mem</mtext><mtext>token</mtext></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mn>2</mn><mo>×</mo><mn>80</mn><mo>×</mo><mn>8</mn><mo>×</mo><mn>128</mn><mo>×</mo><mn>2</mn><mtext> (Bytes)</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mn>160</mn><mo>×</mo><mn>8</mn><mo>×</mo><mn>256</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mn>1280</mn><mo>×</mo><mn>256</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow/></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow/><mo>=</mo><mrow><mn mathvariant="bold">327</mn><mo separator="true">,</mo><mn mathvariant="bold">680</mn><mtext> Bytes</mtext></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \text{Mem}_{\text{token}} &amp;= 2 \times 80 \times 8 \times 128 \times 2 \text{ (Bytes)} \\ &amp;= 160 \times 8 \times 256 \\ &amp;= 1280 \times 256 \\ &amp;= \mathbf{327,680 \text{ Bytes}} \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6em;vertical-align:-2.75em;"/><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord text"><span class="mord">Mem</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">token</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"/><span class="mord"/></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"/></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"/><span class="mord"/></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span/></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">80</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">128</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">2</span><span class="mord text"><span class="mord"> (Bytes)</span></span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord">160</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">256</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord">1280</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord">256</span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mord"><span class="mord mathbf">327</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathbf">680</span><span class="mord text"><span class="mord"> Bytes</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<h5 data-id="heading-12">4. 单位换算（Bytes <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">→</span></span></span></span></span> MB）</h5>
<p>将字节转换为兆字节（MB）：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext>Mem</mtext><mtext>token (MB)</mtext></msub><mo>=</mo><mfrac><mrow><mn>327</mn><mo separator="true">,</mo><mn>680</mn></mrow><mrow><mn>1024</mn><mo>×</mo><mn>1024</mn></mrow></mfrac><mo>≈</mo><mrow><mn mathvariant="bold">0.3125</mn><mtext> MB</mtext></mrow></mrow><annotation encoding="application/x-tex">\text{Mem}_{\text{token (MB)}} = \frac{327,680}{1024 \times 1024} \approx \mathbf{0.3125 \text{ MB}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"/><span class="mord"><span class="mord text"><span class="mord">Mem</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">token (MB)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.3005em;vertical-align:-0.4033em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8972em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1024</span><span class="mbin mtight">×</span><span class="mord mtight">1024</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">327</span><span class="mpunct mtight">,</span><span class="mord mtight">680</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord"><span class="mord mathbf">0.3125</span><span class="mord text"><span class="mord"> MB</span></span></span></span></span></span></span></p>
<p>这就是文中提到的 <strong>0.31 MB</strong> 的由来。</p>
<hr/>
<h5 data-id="heading-13">补充：如果是 MHA 会怎样？</h5>
<p>如果取消 GQA，改回传统的 MHA，则 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mtext>kv_heads</mtext></msub></mrow><annotation encoding="application/x-tex">n_{\text{kv\_heads}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7976em;vertical-align:-0.367em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">kv_heads</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span/></span></span></span></span></span></span></span></span></span> 会从 8 变成 64。</p>
<p>计算结果直接乘以 8：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.3125</mn><mtext> MB</mtext><mo>×</mo><mn>8</mn><mo>=</mo><mrow><mn mathvariant="bold">2.5</mn><mtext> MB</mtext></mrow></mrow><annotation encoding="application/x-tex">0.3125 \text{ MB} \times 8 = \mathbf{2.5 \text{ MB}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord">0.3125</span><span class="mord text"><span class="mord"> MB</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">8</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord"><span class="mord mathbf">2.5</span><span class="mord text"><span class="mord"> MB</span></span></span></span></span></span></span></p>
<p>这就是为什么 GQA 对于显存优化如此重要的数学证明。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[玩转 Pipelines 之修正链路错误状态码]]></title>    <link>https://juejin.cn/post/7576853741757743138</link>    <guid>https://juejin.cn/post/7576853741757743138</guid>    <pubDate>2025-11-26T11:17:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576853741757743138" data-draft-id="7576859594359504896" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="玩转 Pipelines 之修正链路错误状态码"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-26T11:17:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可观测性用观测云"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            玩转 Pipelines 之修正链路错误状态码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可观测性用观测云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T11:17:17.000Z" title="Wed Nov 26 2025 11:17:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Pipelines 是一种运行在 DataKit 上的轻量级脚本语言，用于对采集到的数据进行自定义解析和修改。通过定义解析规则，它们能够将不同种类的数据细粒度地切割并转换为结构化的格式，以满足具体的数据管理需求。例如，用户可以通过 Pipelines 提取日志中的时间戳、状态和其他关键字段，并将这些信息作为标签使用。</p>
<p>DataKit 利用 Pipelines 的强大功能，使得用户能够在工作空间页面上直接编写和调试 Pipeline 脚本，从而实现对数据的更细粒度的结构化处理。这种处理不仅提高了数据的可管理性，而且通过 Pipeline 提供的丰富函数库，支持对常见数据进行标准化操作，如解析时间字符串和补全 IP 地址的地理信息等。</p>
<h2 data-id="heading-0">场景分析</h2>
<p>用户在上报应用性能监测数据的时候，如果在业务侧做了一些自定义状态码，比如自定义 4xx，但这种在业务上属于正常的心跳监控，不需要在观测云上归类为错误请求。这时候怎么在观测云上进行修正状态码，从而减少错误分析，以及误告警。</p>
<h2 data-id="heading-1">实施方案</h2>
<p>如下链路原文带有 <code>status=error</code> 的标签，实际用户在 "error_type"="com.xxx.cloud.os.service.exceptions.OsServiceException" 的错误类型下，都属于正常的业务请求，需要从源头把这类型的报错修正为正常的状态。</p>
<pre><code class="hljs language-python" lang="python">{
  <span class="hljs-string">"time"</span>: <span class="hljs-number">1761533611771</span>,
  <span class="hljs-string">"__docid"</span>: <span class="hljs-string">"T_1761533611771_d3vdtb2c600s73e27rpg"</span>,
  <span class="hljs-string">"__namespace"</span>: <span class="hljs-string">"tracing"</span>,
  <span class="hljs-string">"__source"</span>: <span class="hljs-string">"user-xxx-eks"</span>,
  <span class="hljs-string">"cluster_name_k8s"</span>: <span class="hljs-string">"eks-prod"</span>,
  <span class="hljs-string">"create_time"</span>: <span class="hljs-number">1761533612872</span>,
  <span class="hljs-string">"date"</span>: <span class="hljs-number">1761533611771</span>,
  <span class="hljs-string">"date_ns"</span>: <span class="hljs-number">1761533611771449300</span>,
  <span class="hljs-string">"dd_version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"dk_fingerprint"</span>: <span class="hljs-string">"ip-xxx-16-xx-229.us-west-2.xxx.internal"</span>,
  <span class="hljs-string">"duration"</span>: <span class="hljs-number">19712</span>,
  <span class="hljs-string">"env"</span>: <span class="hljs-string">"prod"</span>,
  <span class="hljs-string">"host"</span>: <span class="hljs-string">"ip-172xxx-220.us-west-2.xxx.internal"</span>,
  <span class="hljs-string">"host_ip"</span>: <span class="hljs-string">"172.16.12.xxx"</span>,
  <span class="hljs-string">"message"</span>: <span class="hljs-string">"{"</span>service<span class="hljs-string">":"</span>user-xxx-eks<span class="hljs-string">","</span>name<span class="hljs-string">":"</span>spring.handle<span class="hljs-string">r","</span>resource<span class="hljs-string">":"</span>PointRightPublicController.listGiftCardRight<span class="hljs-string">","</span>start<span class="hljs-string">":1761533611771449259,"</span>duration<span class="hljs-string">":19712571,"</span>erro<span class="hljs-string">r":0,"</span>meta<span class="hljs-string">":{"</span>_dd.p.tid<span class="hljs-string">":"</span>68fedeab00000000<span class="hljs-string">","</span>thread.name<span class="hljs-string">":"</span>http-nio-<span class="hljs-number">9602</span>-<span class="hljs-built_in">exec</span>-<span class="hljs-number">11</span><span class="hljs-string">","</span>language<span class="hljs-string">":"</span>jvm<span class="hljs-string">","</span>trace_128_bit_id<span class="hljs-string">":"</span>68fedeab000000003d47a83b00ad5ef0<span class="hljs-string">","</span>component<span class="hljs-string">":"</span>spring-web-controlle<span class="hljs-string">r"},"</span>metrics<span class="hljs-string">":{"</span>_dd.measured<span class="hljs-string">":1,"</span>thread.<span class="hljs-built_in">id</span><span class="hljs-string">":207},"</span><span class="hljs-built_in">type</span><span class="hljs-string">":"</span>we<span class="hljs-string">b"}"</span>,
  <span class="hljs-string">"operation"</span>: <span class="hljs-string">"spring.handler"</span>,
  <span class="hljs-string">"parent_id"</span>: <span class="hljs-string">"6497552948601585817"</span>,
  <span class="hljs-string">"pod_name"</span>: <span class="hljs-string">"user-service-xxx-xxx"</span>,
  <span class="hljs-string">"pod_namespace"</span>: <span class="hljs-string">"xxx-prod"</span>,
  <span class="hljs-string">"region"</span>: <span class="hljs-string">"us-xxx-2"</span>,
  <span class="hljs-string">"remote_ip"</span>: <span class="hljs-string">"172.16.xx.xxx"</span>,
  <span class="hljs-string">"resource"</span>: <span class="hljs-string">"PointRightPublicController.listGiftCardRight"</span>,
  <span class="hljs-string">"service"</span>: <span class="hljs-string">"user-xxx-eks"</span>,
  <span class="hljs-string">"source"</span>: <span class="hljs-string">"ddtrace"</span>,
  <span class="hljs-string">"source_type"</span>: <span class="hljs-string">"web"</span>,
  <span class="hljs-string">"span_id"</span>: <span class="hljs-string">"744311550763894067"</span>,
  <span class="hljs-string">"span_kind"</span>: <span class="hljs-string">"server"</span>,
  <span class="hljs-string">"span_type"</span>: <span class="hljs-string">"local"</span>,
  <span class="hljs-string">"start"</span>: <span class="hljs-number">1761533611771449</span>,
  <span class="hljs-string">"status"</span>: <span class="hljs-string">"error"</span>,
  <span class="hljs-string">"time_us"</span>: <span class="hljs-number">1761533611771449.2</span>,
  <span class="hljs-string">"trace_id"</span>: <span class="hljs-string">"68fedeab000000003d47a83b00ad5ef0"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"zone_id"</span>: <span class="hljs-string">"usw2-xxx"</span>,
  <span class="hljs-string">"error_type"</span>: <span class="hljs-string">"com.xxx.cloud.os.service.exceptions.OsServiceException"</span>
}
</code></pre>
<p>新建 Pipelines</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee694a50582a487ea1bf843c1169065f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764760636&amp;x-signature=ruSNi6hq4wFxOiOH%2BQi%2FitS0Y0w%3D" alt="" loading="lazy"/></p>
<p>选择应用性能监控--&gt;服务选择--&gt;一键获取样本</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdfd62261cbb485788b973235f738e6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764760636&amp;x-signature=Yh4I3kTexc%2BqkElBNCz9Ck%2BwuDQ%3D" alt="" loading="lazy"/></p>
<p>判断如果是 error_type 等于com.xxxxx.cloud.os.service.exceptions.OsServiceException 则为业务自定义错误，这个可以归类为正常请求，无需到错误追踪，把 status 修正为 ok 即可</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/006e5de3287243d0aa57d13ad3807eac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764760636&amp;x-signature=u9RbYbaCbZHBdfTorEhJ4vuBJeo%3D" alt="" loading="lazy"/></p>
<p>完整的 Pipelines 规则</p>
<pre><code class="hljs language-lua" lang="lua"># <span class="hljs-number">1.</span> 提取 JSON 原始数据中的 <span class="hljs-string">"status"</span> 字段（原文为 JSON，用 _ 表示原始输入）
# 语法：json(输入源, JSON路径, 提取后字段名)，此处字段名与路径一致（均为 <span class="hljs-built_in">status</span>）
json(_, <span class="hljs-built_in">status</span>, <span class="hljs-built_in">status</span>)

# <span class="hljs-number">2.</span> 判断 <span class="hljs-built_in">status</span> 字段是否等于 <span class="hljs-string">"ok"</span>（字符串比较需带双引号）
<span class="hljs-keyword">if</span> <span class="hljs-built_in">status</span> == <span class="hljs-string">"error"</span> {
    # 满足条件时，添加新字段 kind，值为 <span class="hljs-number">1</span>（整数类型）
  json(_, error_type, error_type)
  <span class="hljs-keyword">if</span> error_type == <span class="hljs-string">"com.xxxxx.cloud.os.service.exceptions.OsServiceException"</span> {
  #set_tag(<span class="hljs-built_in">status</span>,<span class="hljs-string">"ok"</span>)
  add_key(<span class="hljs-built_in">status</span>,<span class="hljs-string">"ok"</span>)
  }

}
</code></pre>
<p>处理结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2083dc61a7d4523b981d76560f8e46f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764760636&amp;x-signature=8nVoZqNusFtUNYjRW3nfFhtTpMs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58afdf4a18df4683b3f3e8996623903a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764760636&amp;x-signature=ET0ZODm13HkNohAMPzjSlpIV2D0%3D" alt="" loading="lazy"/></p>
<p>如上演示可看到，误报到错误追踪的链路， 已经修正处理完成，正常在链路列表展示了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++26：开启新纪元]]></title>    <link>https://juejin.cn/post/7576859594359521280</link>    <guid>https://juejin.cn/post/7576859594359521280</guid>    <pubDate>2025-11-26T11:17:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576859594359521280" data-draft-id="7576676694784720930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++26：开启新纪元"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-26T11:17:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++26：开启新纪元
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T11:17:53.000Z" title="Wed Nov 26 2025 11:17:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于C++开发者而言，语言的进化从未停止。C++26，作为C++23之后的下一代标准，并非一次简单的修补，而是一次旨在重塑我们编写高性能、高维护性代码方式的雄心勃勃的尝试。它将并发编程、编译时计算和类型安全提升到了前所未有的高度，这足以颠覆我们长期以来形成的某些编程习惯和认知。</p>
<h4 data-id="heading-0"><strong>一、 并发编程的范式转移：从“手工管理”到“声明式执行”</strong></h4>
<p>传统的C++并发编程依赖于直接操作 <code>std::thread</code>、<code>std::async</code> 和 <code>std::mutex</code>。这种方式强大但繁琐，且极易出错。C++26 引入的 <code>std::execution</code> 旨在将并发编程带入声明式的新时代。</p>
<p><strong>旧认知：</strong> 我必须手动创建线程池，管理任务队列，并小心翼翼地处理线程同步。
<strong>新认知：</strong> 我只需声明任务的<strong>执行策略</strong>，运行时库会自动以最优方式调度和执行。</p>
<p><strong>代码示例：并行排序算法的演变</strong></p>
<p>假设我们有一个需要并行排序的大向量。</p>
<ul>
<li>
<p><strong>C++17/20 方式（基于 <code>std::async</code>）：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp">std::vector&lt;<span class="hljs-type">int</span>&gt; data = { ... }; <span class="hljs-comment">// 大量数据</span>
<span class="hljs-comment">// 手动分块并异步排序，再合并，代码复杂且容易出错</span>
<span class="hljs-keyword">auto</span> future = std::<span class="hljs-built_in">async</span>(std::launch::async, [&amp;data] {
    std::<span class="hljs-built_in">sort</span>(data.<span class="hljs-built_in">begin</span>(), data.<span class="hljs-built_in">end</span>());
});
future.<span class="hljs-built_in">wait</span>();
</code></pre>
</li>
<li>
<p><strong>C++26 方式（基于 <code>std::execution</code>）：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;execution&gt;</span></span>
std::vector&lt;<span class="hljs-type">int</span>&gt; data = { ... }; <span class="hljs-comment">// 大量数据</span>

<span class="hljs-comment">// 声明式并行：只需指定执行策略</span>
std::<span class="hljs-built_in">sort</span>(std::execution::par, data.<span class="hljs-built_in">begin</span>(), data.<span class="hljs-built_in">end</span>());
</code></pre>
<p><strong>颠覆性解读：</strong>
<code>std::execution::par</code> 只是一个策略。你还可以使用 <code>std::execution::par_unseq</code> 来允许向量化（与SIMD结合），或者 <code>std::execution::seq</code> 表示顺序执行。<strong>代码的核心逻辑（<code>std::sort</code>）与并发策略解耦了</strong>。这意味着我们不再关心线程是如何创建的，而是关心任务<strong>应该以何种属性</strong>被执行。这种抽象是革命性的，它让并行算法像串行算法一样易于使用。</p>
</li>
</ul>
<h4 data-id="heading-1"><strong>二、 SIMD的平民化：从内联汇编到标准库泛型</strong></h4>
<p>SIMD（单指令多数据）是性能优化的“圣杯”，但过去通常需要通过编译器内置函数（Intrinsics）或内联汇编来使用，代码既丑陋又不可移植。</p>
<p><strong>旧认知：</strong> 要想极致性能，必须深入硬件特定指令，牺牲代码可读性和可移植性。
<strong>新认知：</strong> 我可以编写可移植的、泛型的C++代码，并由标准库在底层自动映射为最优的SIMD指令。</p>
<p><strong>代码示例：数组元素乘法的性能飞跃</strong></p>
<ul>
<li>
<p><strong>传统方式：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">multiply_arrays</span><span class="hljs-params">(<span class="hljs-type">float</span>* a, <span class="hljs-type">float</span>* b, <span class="hljs-type">float</span>* result, <span class="hljs-type">size_t</span> n)</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; n; ++i) {
        result[i] = a[i] * b[i];
    }
}
<span class="hljs-comment">// 编译器可能自动向量化，但对于复杂逻辑，往往需要手动提示或使用Intrinsics。</span>
</code></pre>
</li>
<li>
<p><strong>C++26 SIMD 方式（基于提案 <code>std::simd</code>）：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;experimental/simd&gt;</span> <span class="hljs-comment">// 预计在C++26中进入std::</span></span>
<span class="hljs-keyword">namespace</span> stdx = std::experimental;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">multiply_arrays</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">float</span>* a, <span class="hljs-type">const</span> <span class="hljs-type">float</span>* b, <span class="hljs-type">float</span>* result, <span class="hljs-type">size_t</span> n)</span> </span>{
    <span class="hljs-keyword">using</span> V = stdx::native_simd&lt;<span class="hljs-type">float</span>&gt;; <span class="hljs-comment">// 自动选择当前平台最合适的向量宽度</span>
    <span class="hljs-type">size_t</span> vec_size = V::<span class="hljs-built_in">size</span>();
    
    <span class="hljs-comment">// 处理完整向量部分</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i + vec_size &lt;= n; i += vec_size) {
        <span class="hljs-function">V <span class="hljs-title">va</span><span class="hljs-params">(a + i, stdx::vector_aligned)</span></span>;
        <span class="hljs-function">V <span class="hljs-title">vb</span><span class="hljs-params">(b + i, stdx::vector_aligned)</span></span>;
        V vresult = va * vb; <span class="hljs-comment">// 运算符重载，直观的逐元素乘法</span>
        vresult.<span class="hljs-built_in">copy_to</span>(result + i, stdx::vector_aligned);
    }
    <span class="hljs-comment">// ... 处理尾部剩余元素</span>
}
</code></pre>
<p><strong>颠覆性解读：</strong>
这段代码是<strong>平台无关的</strong>。<code>stdx::native_simd&lt;float&gt;</code> 在x86 AVX2平台上可能是8个float，在ARM NEON上可能是4个，但代码无需修改。我们使用熟悉的C++运算符（<code>*</code>）来操作整个向量，而不是繁琐的 <code>_mm256_load_ps</code> 和 <code>_mm256_mul_ps</code>。这极大地降低了使用SIMD的门槛，使得数据并行编程成为广大C++开发者的常规武器，而不仅仅是少数专家的秘技。</p>
</li>
</ul>
<h4 data-id="heading-2"><strong>三、 编译时世界的边界扩张：<code>constexpr</code> 的进一步胜利</strong></h4>
<p>C++的 <code>constexpr</code> 一直在将运行时计算推向编译时。C++26继续这一趋势，允许在 <code>constexpr</code> 上下文中进行更多操作。</p>
<p><strong>旧认知：</strong> 编译时计算主要用于简单的数学运算和类型体操。
<strong>新认知：</strong> 更复杂的算法、甚至部分标准库容器和算法都可以在编译期执行，实现“零成本抽象”的终极形态。</p>
<p><strong>代码示例：编译时生成查找表</strong></p>
<ul>
<li><strong>传统方式：</strong> 在运行时初始化一个查找表，或使用模板元编程但代码极其复杂。</li>
<li><strong>C++26 方式：</strong>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-keyword">constexpr</span> std::array&lt;<span class="hljs-type">int</span>, 256&gt; <span class="hljs-title">generate_sine_lookup_table</span><span class="hljs-params">()</span> </span>{
    std::array&lt;<span class="hljs-type">int</span>, 256&gt; table{};
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; table.<span class="hljs-built_in">size</span>(); ++i) {
        <span class="hljs-type">double</span> angle = <span class="hljs-number">2</span> * <span class="hljs-number">3.1415926535</span> * i / table.<span class="hljs-built_in">size</span>();
        table[i] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(std::<span class="hljs-built_in">sin</span>(angle) * <span class="hljs-number">1024</span>); <span class="hljs-comment">// 定点数</span>
    }
    <span class="hljs-keyword">return</span> table;
}

<span class="hljs-comment">// 此表在编译期就已计算并嵌入二进制代码，运行时零开销！</span>
<span class="hljs-keyword">constexpr</span> <span class="hljs-keyword">auto</span> SIN_LUT = <span class="hljs-built_in">generate_sine_lookup_table</span>();

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">fast_sine_approximation</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> value = SIN_LUT[<span class="hljs-number">128</span>]; <span class="hljs-comment">// 直接访问，无计算成本</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<strong>颠覆性解读：</strong>
注意，<code>std::array</code> 的析构和 <code>std::sin</code> 等函数现在都可能成为 <code>constexpr</code>。这意味着我们可以在编译期模拟几乎完整的运行时环境，将那些确定性的、耗时的初始化工作彻底从运行时剥离。这对于嵌入式系统、游戏引擎和高性能计算至关重要，它改变了我们在“开发时”和“运行时”之间分配计算负载的思维模式。</li>
</ul>
<h4 data-id="heading-3"><strong>四、 内存安全与并发安全的新工具</strong></h4>
<p>虽然C++不会变成Rust，但C++26通过库组件积极应对多线程环境下的内存安全问题。</p>
<p><strong>旧认知：</strong> 无锁编程是深渊，手动管理多线程下的对象生命周期极易导致use-after-free。
<strong>新认知：</strong> 标准库提供了如风险指针和RCU等高级范式，可以安全且高效地管理并发对象生命周期。</p>
<p><strong>代码示例：使用风险指针进行安全读取</strong></p>
<p>（此处为概念性代码，基于提案 <code>std::hazard_pointer</code>）</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 概念性代码，展示思想</span>
std::atomic&lt;MyObject*&gt; global_obj{<span class="hljs-literal">nullptr</span>};
std::hazard_pointer_domain hp_domain;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reader</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 1. 获取一个风险指针，并将其与当前线程关联</span>
    <span class="hljs-keyword">auto</span> hp = hp_domain.<span class="hljs-built_in">acquire</span>();
    
    MyObject* obj = <span class="hljs-literal">nullptr</span>;
    <span class="hljs-keyword">do</span> {
        <span class="hljs-comment">// 2. 安全地加载原子指针</span>
        obj = global_obj.<span class="hljs-built_in">load</span>(std::memory_order_acquire);
        <span class="hljs-comment">// 3. 将加载的指针“保护”起来，告知系统我正在使用它</span>
        hp.<span class="hljs-built_in">protect</span>(obj);
        <span class="hljs-comment">// 4. 再次检查指针是否已被其他写者修改</span>
        <span class="hljs-comment">// 如果没有，则说明我们成功保护了obj，可以安全使用</span>
    } <span class="hljs-keyword">while</span> (obj != global_obj.<span class="hljs-built_in">load</span>(std::memory_order_acquire));
    
    <span class="hljs-comment">// 5. 安全地使用obj，此时即使有写者删除了旧对象，也不会回收它</span>
    obj-&gt;<span class="hljs-built_in">do_something</span>();
    
    <span class="hljs-comment">// 6. 释放风险指针</span>
    hp.<span class="hljs-built_in">release</span>();
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">writer</span><span class="hljs-params">()</span> </span>{
    MyObject* new_obj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MyObject</span>(...);
    MyObject* old_obj = global_obj.<span class="hljs-built_in">exchange</span>(new_obj, std::memory_order_acq_rel);
    
    <span class="hljs-comment">// 尝试回收旧对象。如果旧对象正被任何风险指针保护，则延迟回收</span>
    hp_domain.<span class="hljs-built_in">retire</span>(old_obj, [](MyObject* ptr) { <span class="hljs-keyword">delete</span> ptr; });
}
</code></pre>
<p><strong>颠覆性解读：</strong>
风险指针和RCU等机制，将我们从繁琐且容易出错的“手动引用计数”或“完全无锁”中解放出来。它们提供了一种<strong>协作式</strong>的内存回收协议，读者通过风险指针宣告“我正在使用此对象”，写者则负责在确认无人使用时再进行回收。这为构建高性能、无锁的并发数据结构提供了标准化、更安全的基础。</p>
<h4 data-id="heading-4"><strong>总结：认知的颠覆与演进</strong></h4>
<p>C++26 的变革是深层次的：</p>
<ol>
<li><strong>并发抽象化：</strong> 我们从关心线程（<code>std::thread</code>）转向关心任务和策略（<code>std::execution</code>）。</li>
<li><strong>数据并行平民化：</strong> SIMD从硬件特定技巧变成了可移植的泛型编程工具。</li>
<li><strong>编译时计算常态化：</strong> 编译期与运行时的界限进一步模糊，我们可以将更多工作静态化。</li>
<li><strong>内存安全系统化：</strong> 标准库开始提供高级构件，来系统性地解决并发环境下的内存管理难题。</li>
</ol>
<p>这些变化要求我们不断更新自己的知识库和思维方式。C++26 不是在原有路径上小修小补，而是在为我们铺就一条通往更高性能、更高生产力和更高代码质量的新道路。它提醒我们，C++的哲学依然是“信任程序员，但不给程序员不必要的负担”，而如今，它正通过更强大的抽象来兑现这一承诺。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++程序执行起点不是main：颠覆你认知的真相]]></title>    <link>https://juejin.cn/post/7576861477266620435</link>    <guid>https://juejin.cn/post/7576861477266620435</guid>    <pubDate>2025-11-26T11:24:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576861477266620435" data-draft-id="7576838552472092715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++程序执行起点不是main：颠覆你认知的真相"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-26T11:24:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++程序执行起点不是main：颠覆你认知的真相
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T11:24:08.000Z" title="Wed Nov 26 2025 11:24:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>你以为main函数是起点？C++的运行机制远比这复杂！</p>
</blockquote>
<p>在C++学习之路上，我们都被教导过一个“基本事实”：程序从main函数开始执行。但今天，我要带你揭开这个广为流传的误解背后的真相。</p>
<h2 data-id="heading-0">一个令人惊讶的实验</h2>
<p>让我们通过一个简单例子来观察C++程序的实际启动过程：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LifecycleTracker</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">LifecycleTracker</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* name) : <span class="hljs-built_in">name</span>(name) {
        cout &lt;&lt; <span class="hljs-string">"【构造】"</span> &lt;&lt; name &lt;&lt; <span class="hljs-string">" - 此时main尚未开始"</span> &lt;&lt; endl;
    }
    
    ~<span class="hljs-built_in">LifecycleTracker</span>() {
        cout &lt;&lt; <span class="hljs-string">"【析构】"</span> &lt;&lt; name &lt;&lt; <span class="hljs-string">" - 此时main已经结束"</span> &lt;&lt; endl;
    }

<span class="hljs-keyword">private</span>:
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name;
};

<span class="hljs-comment">// 全局对象</span>
<span class="hljs-function">LifecycleTracker <span class="hljs-title">global_obj</span><span class="hljs-params">(<span class="hljs-string">"全局对象"</span>)</span></span>;

<span class="hljs-comment">// 全局变量初始化</span>
<span class="hljs-type">int</span> global_var = []() {
    cout &lt;&lt; <span class="hljs-string">"【初始化】全局变量 - 在main之前"</span> &lt;&lt; endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;
}();

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    cout &lt;&lt; <span class="hljs-string">"【进入】main函数开始执行"</span> &lt;&lt; endl;
    <span class="hljs-function">LifecycleTracker <span class="hljs-title">local_obj</span><span class="hljs-params">(<span class="hljs-string">"局部对象"</span>)</span></span>;
    cout &lt;&lt; <span class="hljs-string">"【退出】main函数即将结束"</span> &lt;&lt; endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>运行这个程序，你会看到类似这样的输出：</p>
<pre><code class="hljs language-css" lang="css">【初始化】全局变量 - 在<span class="hljs-selector-tag">main</span>之前
【构造】全局对象 - 此时<span class="hljs-selector-tag">main</span>尚未开始
【进入】<span class="hljs-selector-tag">main</span>函数开始执行
【构造】局部对象 - 在<span class="hljs-selector-tag">main</span>内部
【退出】<span class="hljs-selector-tag">main</span>函数即将结束
【析构】局部对象 - 在<span class="hljs-selector-tag">main</span>之后
【析构】全局对象 - 此时<span class="hljs-selector-tag">main</span>已经结束
</code></pre>
<p>看到证据了吗？在main函数登场前，C++运行时已经做了大量准备工作！</p>
<h2 data-id="heading-1">C++程序的真实启动流程</h2>
<h3 data-id="heading-2">第一阶段：操作系统准备</h3>
<p>当你运行程序时，操作系统首先接管控制权：</p>
<ol>
<li><strong>加载可执行文件</strong>到内存</li>
<li><strong>创建进程和线程</strong>结构</li>
<li><strong>分配内存空间</strong>（栈、堆等）</li>
<li><strong>加载依赖库</strong>（动态链接库）</li>
<li><strong>传递环境变量和命令行参数</strong></li>
</ol>
<p>这就像电影开拍前，制片方要准备好场地、设备和人员。</p>
<h3 data-id="heading-3">第二阶段：C++运行时初始化</h3>
<p>操作系统完成基础准备后，将控制权交给C++运行时环境。这个阶段包括：</p>
<ul>
<li>初始化C标准库</li>
<li>设置堆内存管理器</li>
<li>准备I/O系统</li>
<li><strong>初始化全局和静态变量</strong></li>
<li><strong>调用全局对象的构造函数</strong></li>
<li>整理命令行参数</li>
</ul>
<p>只有在所有这些准备工作完成后，运行时环境才会调用我们熟悉的main函数。</p>
<h3 data-id="heading-4">第三阶段：main函数执行</h3>
<p>现在才轮到我们的“主角”登场：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 你的代码在这里执行</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// 或者带参数版本</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>* argv[])</span> </span>{
    <span class="hljs-comment">// 使用命令行参数</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>重要的是理解：<strong>main函数是被C++运行时调用的</strong>，而不是程序的真正起点。</p>
<h3 data-id="heading-5">第四阶段：程序收尾工作</h3>
<p>main函数返回后，程序的生命周期还未结束：</p>
<ol>
<li>接收main的返回值</li>
<li><strong>调用全局对象的析构函数</strong></li>
<li>清理资源</li>
<li>向操作系统返回退出码</li>
<li>结束进程</li>
</ol>
<h2 data-id="heading-6">深入理解初始化顺序问题</h2>
<p>理解C++启动机制对解决实际问题至关重要，特别是在处理全局对象时。</p>
<h3 data-id="heading-7">单文件内的初始化顺序</h3>
<p>在同一个源文件中，初始化顺序是确定的：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-type">int</span> a = []() {
    cout &lt;&lt; <span class="hljs-string">"初始化a"</span> &lt;&lt; endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}();

<span class="hljs-type">int</span> b = []() {
    cout &lt;&lt; <span class="hljs-string">"初始化b，a="</span> &lt;&lt; a &lt;&lt; endl;  <span class="hljs-comment">// a已初始化</span>
    <span class="hljs-keyword">return</span> a + <span class="hljs-number">1</span>;
}();

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">MyClass</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* name) {
        cout &lt;&lt; <span class="hljs-string">"构造"</span> &lt;&lt; name &lt;&lt; <span class="hljs-string">"，b="</span> &lt;&lt; b &lt;&lt; endl;
    }
};

<span class="hljs-function">MyClass <span class="hljs-title">obj1</span><span class="hljs-params">(<span class="hljs-string">"对象1"</span>)</span></span>;  <span class="hljs-comment">// b已初始化</span>
<span class="hljs-function">MyClass <span class="hljs-title">obj2</span><span class="hljs-params">(<span class="hljs-string">"对象2"</span>)</span></span>;  <span class="hljs-comment">// 按顺序构造</span>
</code></pre>
<p>输出将是可预测的：</p>
<pre><code class="hljs language-ini" lang="ini">初始化a
初始化b，<span class="hljs-attr">a</span>=<span class="hljs-number">1</span>
构造对象1，<span class="hljs-attr">b</span>=<span class="hljs-number">2</span>
构造对象2，<span class="hljs-attr">b</span>=<span class="hljs-number">2</span>
</code></pre>
<h3 data-id="heading-8">多文件间的初始化陷阱</h3>
<p>问题出现在多个源文件之间：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// file1.cpp</span>
<span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> external_var;  <span class="hljs-comment">// 在file2.cpp中定义</span>
<span class="hljs-type">int</span> my_var = external_var + <span class="hljs-number">10</span>;  <span class="hljs-comment">// 危险！external_var可能未初始化</span>

<span class="hljs-comment">// file2.cpp</span>
<span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> my_var;  <span class="hljs-comment">// 在file1.cpp中定义  </span>
<span class="hljs-type">int</span> external_var = my_var * <span class="hljs-number">2</span>;  <span class="hljs-comment">// 同样危险！</span>
</code></pre>
<p>这种<strong>静态初始化顺序问题</strong>是C++中经典的陷阱之一。</p>
<h3 data-id="heading-9">解决方案：延迟初始化</h3>
<p>使用函数内的静态变量可以优雅地解决这个问题：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 安全的全局变量访问</span>
<span class="hljs-function"><span class="hljs-type">int</span>&amp; <span class="hljs-title">getConfig</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">static</span> <span class="hljs-type">int</span> config = <span class="hljs-built_in">initializeConfig</span>();  <span class="hljs-comment">// 首次调用时初始化</span>
    <span class="hljs-keyword">return</span> config;
}

<span class="hljs-comment">// 单例模式确保初始化顺序</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Database</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">static</span> Database&amp; <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> Database instance;  <span class="hljs-comment">// 线程安全的延迟初始化</span>
        <span class="hljs-keyword">return</span> instance;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 数据库连接操作</span>
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">Database</span>() {
        <span class="hljs-comment">// 构造函数</span>
    }
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">businessLogic</span><span class="hljs-params">()</span> </span>{
    Database::<span class="hljs-built_in">getInstance</span>().<span class="hljs-built_in">connect</span>();  <span class="hljs-comment">// 首次使用时自动初始化</span>
}
</code></pre>
<h2 data-id="heading-10">实际应用价值</h2>
<p>理解C++启动过程不仅仅是理论知识，它在实际开发中极其有用：</p>
<h3 data-id="heading-11">1. 调试复杂问题</h3>
<p>当遇到程序启动时崩溃，但main函数中找不到原因时，问题可能出在全局对象的构造函数中。</p>
<h3 data-id="heading-12">2. 资源管理</h3>
<p>知道析构函数的调用时机，可以帮助我们正确管理资源生命周期。</p>
<h3 data-id="heading-13">3. 架构设计</h3>
<p>在设计库框架时，经常需要在main执行前后自动执行初始化/清理代码：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LibraryInitializer</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">LibraryInitializer</span>() {
        <span class="hljs-comment">// 库的自动初始化</span>
        <span class="hljs-built_in">initializeLibrary</span>();
    }
    
    ~<span class="hljs-built_in">LibraryInitializer</span>() {
        <span class="hljs-comment">// 库的自动清理</span>
        <span class="hljs-built_in">cleanupLibrary</span>();
    }
};

<span class="hljs-comment">// 全局实例确保自动初始化</span>
LibraryInitializer library_init;
</code></pre>
<h3 data-id="heading-14">4. 性能优化</h3>
<p>避免在全局对象构造函数中进行复杂计算，这会拖慢程序启动速度。</p>
<h2 data-id="heading-15">高级技巧：控制启动过程</h2>
<h3 data-id="heading-16">在main之前执行代码</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 方法1：全局对象构造函数</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StartupManager</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">StartupManager</span>() {
        <span class="hljs-built_in">setupLogging</span>();
        <span class="hljs-built_in">loadConfiguration</span>();
    }
};
StartupManager startup;  <span class="hljs-comment">// 在main前自动初始化</span>

<span class="hljs-comment">// 方法2：编译器特定属性（GCC/Clang）</span>
__attribute__((constructor))
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">before_main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 在main之前执行</span>
}
</code></pre>
<h3 data-id="heading-17">在main之后执行代码</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span>

<span class="hljs-comment">// 方法1：atexit函数</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cleanup</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 清理工作</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">atexit</span>(cleanup);  <span class="hljs-comment">// 注册退出时执行的函数</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-comment">// 方法2：全局对象析构函数</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ShutdownManager</span> {
<span class="hljs-keyword">public</span>:
    ~<span class="hljs-built_in">ShutdownManager</span>() {
        <span class="hljs-built_in">saveState</span>();
        <span class="hljs-built_in">closeConnections</span>();
    }
};
ShutdownManager shutdown;  <span class="hljs-comment">// 在main后自动清理</span>
</code></pre>
<h2 data-id="heading-18">总结</h2>
<p>现在你应该明白了：</p>
<ul>
<li><strong>main函数不是起点</strong>：它是被C++运行时调用的</li>
<li><strong>全局对象在main之前构造</strong>：这是初始化顺序问题的根源</li>
<li><strong>程序在main之后继续运行</strong>：完成清理工作后才真正结束</li>
<li><strong>理解这些机制至关重要</strong>：对调试、设计和性能优化都有帮助</li>
</ul>
<p>C++程序的完整生命周期更像是一部精心编排的戏剧：main函数是主角的登场，但前后都有重要的序幕和尾声。</p>
<p>下次有人问你"C++程序从哪里开始"，你可以自信地给出完整答案了！这不仅会让你在技术讨论中脱颖而出，更能帮助你写出更健壮、可靠的C++代码。</p>
<p>记住，真正的高手不仅知道怎么用语言特性，更理解它们背后的运行机制。这正是区分普通程序员和专家的关键所在！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Qoder CLI 与 OneCode 平台深度整合技术实践：CLI委托驱动的开发范式革新]]></title>    <link>https://juejin.cn/post/7576838552472125483</link>    <guid>https://juejin.cn/post/7576838552472125483</guid>    <pubDate>2025-11-26T11:26:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576838552472125483" data-draft-id="7576861477266636819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Qoder CLI 与 OneCode 平台深度整合技术实践：CLI委托驱动的开发范式革新"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-26T11:26:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Qoder CLI 与 OneCode 平台深度整合技术实践：CLI委托驱动的开发范式革新
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T11:26:57.000Z" title="Wed Nov 26 2025 11:26:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在人工智能辅助编程技术迅猛发展的当下，开发者对智能化编码平台的依赖程度持续加深。Qoder CLI作为一款先进的AI驱动型终端编码工具，不仅具备强大的命令行编码能力，更通过创新的委托模式与OneCode平台实现深度协同，推动OneCode开发范式产生根本性变革。本文聚焦CLI委托模式的核心价值，结合OneCode可视化IDE的最新特性，系统阐述二者整合的技术路径与实践价值。</p>
<p>一、核心概念解析</p>
<p>1.1 什么是Qoder CLI？</p>
<p>Qoder CLI是基于人工智能技术构建的终端编码工具，支持开发者在命令行环境中完成复杂编码任务，无需脱离终端即可实现代码生成、重构及工作流自动化。其核心特性以“委托能力”为核心构建：</p>
<ul>
<li>
<p>智能任务委托：接收自然语言指令后，能够自动完成任务拆解与执行方案生成，支持复杂需求的端到端落地</p>
</li>
<li>
<p>项目感知能力：深度解析OneCode项目结构、依赖关系及编码规范，确保生成内容与平台的兼容性</p>
</li>
<li>
<p>MCP协议扩展：通过模型控制协议（Model Control Protocol）与OneCode平台建立稳定通信链路，实现指令与数据的双向流转</p>
</li>
<li>
<p>异步任务管理：支持将大规模代码生成、项目重构等耗时任务委托至云端执行，有效释放本地计算资源</p>
</li>
</ul>
<p>1.2 什么是OneCode平台？</p>
<p>OneCode平台是面向企业级应用开发的现代化开发框架，以“低代码开发+AI能力增强”为核心定位，旨在简化复杂项目的构建与维护流程。该平台核心能力包括：</p>
<ul>
<li>
<p>统一代码管理：集中管控多项目代码库，保障团队编码规范的一致性</p>
</li>
<li>
<p>模块化架构：支持组件化开发与复用机制，降低系统耦合度</p>
</li>
<li>
<p>自动化部署流水线：原生支持CI/CD流程集成，实现从开发到生产环境的无缝衔接</p>
</li>
<li>
<p>可视化IDE新特性：最新版本推出任务规划、图生代码多Agent模式、深度AI集成代理三大核心功能，强化人工智能与开发流程的深度融合</p>
</li>
</ul>
<p>二、整合准备工作</p>
<p>在启动整合工作前，需完成基础环境配置，确保Qoder CLI与OneCode平台之间的通信链路畅通。核心前提条件如下：</p>
<ol>
<li>
<p>已完成Qoder CLI工具的安装部署及授权配置</p>
</li>
<li>
<p>已完成OneCode平台部署，并获取相应的访问权限</p>
</li>
<li>
<p>具备基础命令行操作能力及OneCode项目管理权限</p>
</li>
</ol>
<p>2.1 安装与配置Qoder CLI</p>
<p>通过官方推荐的标准化方式完成Qoder CLI的安装部署，需确保所安装版本支持MCP协议及委托模式：</p>
<h2 data-id="heading-0">三种主流安装方式可选</h2>
<h2 data-id="heading-1">1. Curl脚本安装（通用跨平台）</h2>
<p>curl -fsSL <a href="https://link.juejin.cn?target=https%3A%2F%2Fqoder.com%2Finstall" target="_blank" title="https://qoder.com/install" ref="nofollow noopener noreferrer">qoder.com/install</a> | bash</p>
<h2 data-id="heading-2">2. Homebrew安装（macOS/Linux系统）</h2>
<p>brew install qoderai/qoder/qodercli --cask</p>
<h2 data-id="heading-3">3. NPM安装（Node.js环境依赖）</h2>
<p>npm install -g @qoder-ai/qodercli</p>
<h2 data-id="heading-4">验证安装结果及版本兼容性（需v0.3.0及以上版本支持OneCode委托模式）</h2>
<p>qodercli --version</p>
<h2 data-id="heading-5">预期输出：Qoder CLI v0.3.5 (支持OneCode委托模式)</h2>
<p>2.2 配置OneCode平台环境</p>
<p>OneCode平台需通过官方标准化工具链完成安装配置，该工具链支持Windows、macOS、Linux全系统，且无需依赖Node环境。核心流程分为CLI工具安装、API密钥配置、项目初始化三步，具体操作以官方最新文档为准：OneCode平台推荐通过Gitee仓库下载源码编译安装，该方式可获取最新稳定版本，支持按需定制功能，且适配Windows、macOS、Linux全系统。核心流程分为源码获取、编译构建、环境配置三步，需提前安装Git与Maven（3.6+）依赖：</p>
<h2 data-id="heading-6">一、OneCode CLI工具安装（多系统适配）</h2>
<h2 data-id="heading-7">1. Linux/macOS/WSL系统（推荐）</h2>
<p>curl -fsSL <a href="https://link.juejin.cn?target=https%3A%2F%2Fonecode-official.oss-cn-hangzhou.aliyuncs.com%2Finstall.sh" target="_blank" title="https://onecode-official.oss-cn-hangzhou.aliyuncs.com/install.sh" ref="nofollow noopener noreferrer">onecode-official.oss-cn-hangzhou.aliyuncs.com/install.sh</a> | bash</p>
<h2 data-id="heading-8">2. macOS系统（Homebrew辅助安装）</h2>
<p>brew tap onecode-dev/offical
brew install onecode-cli</p>
<h2 data-id="heading-9">3. Windows系统（PowerShell管理员模式）</h2>
<p>Set-ExecutionPolicy Bypass -Scope Process -Force;
iwr -useb <a href="https://link.juejin.cn?target=https%3A%2F%2Fonecode-official.oss-cn-hangzhou.aliyuncs.com%2Finstall.ps1" target="_blank" title="https://onecode-official.oss-cn-hangzhou.aliyuncs.com/install.ps1" ref="nofollow noopener noreferrer">onecode-official.oss-cn-hangzhou.aliyuncs.com/install.ps1</a> | iex</p>
<h2 data-id="heading-10">4. 版本验证（需v2.0.0及以上版本支持MCP协议与Qoder集成）</h2>
<p>onecode --version</p>
<h2 data-id="heading-11">预期输出：OneCode CLI v2.1.5 (Build: 20250610) - 支持MCPv2协议</h2>
<h2 data-id="heading-12">二、API密钥获取与配置</h2>
<h2 data-id="heading-13">1. 登录OneCode官方控制台（云版：<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.onecode.cn%25EF%25BC%259B%25E7%25A7%2581%25E6%259C%2589%25E9%2583%25A8%25E7%25BD%25B2%25E7%2589%2588%25E9%259C%2580%25E6%259B%25BF%25E6%258D%25A2%25E4%25B8%25BA%25E4%25BC%2581%25E4%25B8%259A%25E5%2586%2585%25E7%25BD%2591%25E5%259C%25B0%25E5%259D%2580%25EF%25BC%2589" target="_blank" title="https://console.onecode.cn%EF%BC%9B%E7%A7%81%E6%9C%89%E9%83%A8%E7%BD%B2%E7%89%88%E9%9C%80%E6%9B%BF%E6%8D%A2%E4%B8%BA%E4%BC%81%E4%B8%9A%E5%86%85%E7%BD%91%E5%9C%B0%E5%9D%80%EF%BC%89" ref="nofollow noopener noreferrer">console.onecode.cn；私有部署版需替换为企业内网地址）</a></h2>
<h2 data-id="heading-14">2. 进入「个人中心」→「开发者设置」→「API密钥管理」</h2>
<h2 data-id="heading-15">3. 点击「新建密钥」，备注用途为「Qoder CLI集成」，复制生成的密钥串（仅显示一次，需妥善保存）</h2>
<h2 data-id="heading-16">4. 配置全局API密钥（避免每次命令重复输入）</h2>
<p>onecode config set global.api-key "your-onecode-api-key"</p>
<h2 data-id="heading-17">三、OneCode项目初始化与环境验证</h2>
<h2 data-id="heading-18">1. 初始化课程表管理项目（指定框架与版本）</h2>
<p>onecode project create my-course-schedule <br/>
--framework springboot <br/>
--version 2.7.0 <br/>
--description "高校课程表管理系统"</p>
<h2 data-id="heading-19">2. 进入项目工作目录</h2>
<p>cd my-course-schedule</p>
<h2 data-id="heading-20">3. 加载项目依赖（自动同步OneCode平台组件）</h2>
<p>onecode deps sync</p>
<h2 data-id="heading-21">4. 启动本地开发服务（默认8080端口，冲突可通过--port指定）</h2>
<p>onecode server start --port 8080</p>
<h2 data-id="heading-22">预期输出：OneCode Development Server [RUNNING]</h2>
<h2 data-id="heading-23">Access Console: <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fonecode-console" target="_blank" title="http://localhost:8080/onecode-console" ref="nofollow noopener noreferrer">http://localhost:8080/onecode-console</a></h2>
<h2 data-id="heading-24">Service Status: HEALTHY</h2>
<h2 data-id="heading-25">5. 环境连通性测试（验证与Qoder CLI通信链路）</h2>
<p>onecode mcp test --target qoder</p>
<h2 data-id="heading-26">预期输出：MCP Link Established - Qoder CLI Compatible</h2>
<h2 data-id="heading-27">一、前置依赖准备（必装）</h2>
<h2 data-id="heading-28">1. 安装Git（版本2.30+，用于源码克隆）</h2>
<h2 data-id="heading-29">Linux</h2>
<p>sudo apt-get install git -y</p>
<h2 data-id="heading-30">macOS</h2>
<p>brew install git</p>
<h2 data-id="heading-31">Windows：下载安装包 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fdownload%2Fwin" target="_blank" title="https://git-scm.com/download/win" ref="nofollow noopener noreferrer">git-scm.com/download/wi…</a></h2>
<h2 data-id="heading-32">2. 安装Maven（版本3.6.3+，用于源码编译）</h2>
<h2 data-id="heading-33">Linux/macOS</h2>
<p>wget <a href="https://link.juejin.cn?target=https%3A%2F%2Farchive.apache.org%2Fdist%2Fmaven%2Fmaven-3%2F3.9.6%2Fbinaries%2Fapache-maven-3.9.6-bin.tar.gz" target="_blank" title="https://archive.apache.org/dist/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz" ref="nofollow noopener noreferrer">archive.apache.org/dist/maven/…</a>
tar -zxvf apache-maven-3.9.6-bin.tar.gz
sudo mv apache-maven-3.9.6 /usr/local/</p>
<h2 data-id="heading-34">配置Maven环境变量（Linux/macOS）</h2>
<p>echo "export MAVEN_HOME=/usr/local/apache-maven-3.9.6" &gt;&gt; ~/.bashrc
echo "export PATH=$MAVEN_HOME/bin:$PATH" &gt;&gt; ~/.bashrc
source ~/.bashrc</p>
<h2 data-id="heading-35">Windows：下载安装包 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmaven.apache.org%2Fdownload.cgi%25EF%25BC%258C%25E9%2585%258D%25E7%25BD%25AE%25E7%25B3%25BB%25E7%25BB%259F%25E7%258E%25AF%25E5%25A2%2583%25E5%258F%2598%25E9%2587%258FMAVEN_HOME" target="_blank" title="https://maven.apache.org/download.cgi%EF%BC%8C%E9%85%8D%E7%BD%AE%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FMAVEN_HOME" ref="nofollow noopener noreferrer">maven.apache.org/download.cg…</a></h2>
<h2 data-id="heading-36">验证依赖</h2>
<p>git --version &amp;&amp; mvn --version</p>
<h2 data-id="heading-37">预期输出：Git版本≥2.30，Maven版本≥3.6.3</h2>
<h2 data-id="heading-38">二、从Gitee下载OneCode源码并编译</h2>
<h2 data-id="heading-39">1. 克隆官方源码仓库（稳定分支：release-2.1.x）</h2>
<p>git clone -b release-2.1.x <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fonecode-dev%2Fonecode-platform.git" target="_blank" title="https://gitee.com/onecode-dev/onecode-platform.git" ref="nofollow noopener noreferrer">gitee.com/onecode-dev…</a>
cd onecode-platform</p>
<h2 data-id="heading-40">2. 源码编译（跳过测试加速构建，依赖Java 8/11）</h2>
<h2 data-id="heading-41">编译核心CLI模块及平台服务</h2>
<p>mvn clean package -DskipTests -pl onecode-cli,onecode-server -am</p>
<h2 data-id="heading-42">3. 验证编译结果</h2>
<h2 data-id="heading-43">编译产物路径：onecode-cli/target/onecode-cli-2.1.5-bin.tar.gz</h2>
<p>ls onecode-cli/target | grep "onecode-cli-.*-bin.tar.gz"</p>
<h2 data-id="heading-44">预期输出：onecode-cli-2.1.5-bin.tar.gz</h2>
<h2 data-id="heading-45">三、OneCode 安装与环境配置</h2>
<h2 data-id="heading-46">1. 下载编译onecode  项目</h2>
<h2 data-id="heading-47">2. 配置全局工程</h2>
<h2 data-id="heading-48">3. 初始化课程表管理项目（衔接后续整合实践）</h2>
<p>onecode project create my-course-schedule <br/>
--framework springboot <br/>
--version 2.7.0 <br/>
--description "高校课程表管理系统"</p>
<h2 data-id="heading-49">4. 启动本地服务验证环境</h2>
<p>cd my-course-schedule
onecode server start --port 8080</p>
<h2 data-id="heading-50">预期输出：OneCode Development Server [RUNNING]</h2>
<h2 data-id="heading-51">Access Console: <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fonecode-console" target="_blank" title="http://localhost:8080/onecode-console" ref="nofollow noopener noreferrer">http://localhost:8080/onecode-console</a></h2>
<h2 data-id="heading-52">Service Status: HEALTHY</h2>
<p>三、CLI委托模式带来的OneCode开发范式革命</p>
<p>在传统OneCode开发流程中，开发者需在可视化IDE与代码编辑器之间频繁切换，完成“需求拆解-组件设计-代码编写-配置部署”的全流程操作。Qoder CLI的委托模式彻底改变这一工作模式，构建“指令输入-AI执行-结果反馈”的全新开发链路，核心变革体现在以下四个维度：</p>
<p>3.1 开发流程：从“手动操作”到“指令驱动”的跃迁</p>
<p>在传统开发模式下，开发一款课程表应用需经历“创建实体类-设计服务层-编写前端组件-配置数据库映射-部署测试”等12项手动操作步骤，总耗时约2个工作日。采用CLI委托模式后，开发者仅需输入核心需求指令，后续编码与配置工作可全部委托Qoder CLI完成：</p>
<h2 data-id="heading-53">委托Qoder CLI完成课程表应用开发</h2>
<p>qodercli delegate onecode "在当前OneCode项目中构建课程表应用，需满足以下要求：</p>
<ol>
<li>数据实体包含课程ID、课程名称、授课教师、上课时间、教室位置等核心字段</li>
<li>服务层实现数据的增删改查操作及按时间段查询功能</li>
<li>代码需符合OneCode @DBField注解规范及平台编码风格</li>
<li>自动生成数据库初始化脚本" --async</li>
</ol>
<h2 data-id="heading-54">查看委托任务执行进度</h2>
<p>qodercli task status</p>
<h2 data-id="heading-55">预期输出：Task-123 | 执行中(65%) | 已完成：实体类生成、服务层编码 | 待完成：前端组件开发、数据库脚本生成</h2>
<p>该模式可将开发周期缩短至30分钟以内，推动开发者从传统的“代码执行者”向“业务需求定义者”转变，使其能够聚焦核心业务逻辑设计而非重复编码工作。</p>
<p>3.2 任务协作：本地终端与云端能力的无缝协同</p>
<p>Qoder CLI的Quest Remote远程委派功能，可为OneCode开发提供云端算力支撑。针对大型项目的代码生成、架构重构等耗时任务，可直接委托至云端沙箱环境执行，本地终端仅需接收执行结果，实现“轻量输入-重度执行”的协同模式：</p>
<h2 data-id="heading-56">启用远程委派模式（适用于大型OneCode项目）</h2>
<p>qodercli config set delegate.mode remote</p>
<h2 data-id="heading-57">委托云端执行大规模代码重构任务</h2>
<p>qodercli delegate onecode "对现有课程表应用进行架构重构，具体要求：</p>
<ol>
<li>优化数据库查询语句性能，添加字段索引注解</li>
<li>将冗余的CourseService类拆分为查询服务与操作服务</li>
<li>重构后代码需符合OneCode模块化规范" --priority high</li>
</ol>
<h2 data-id="heading-58">任务执行完成后自动同步至本地OneCode项目</h2>
<p>qodercli task sync Task-123</p>
<p>该协作模式有效解决了本地环境算力不足、依赖冲突等问题，同时通过云端环境标准化配置，确保生成代码与OneCode平台的兼容性。</p>
<p>3.3 规范落地：从“人工检查”到“AI强制约束”的升级</p>
<p>OneCode平台的编码规范（包括注解使用、目录结构、命名规则等）在传统开发模式中需通过人工审查或IDE插件保障，存在执行不到位的风险。在CLI委托模式下，Qoder CLI已预先学习OneCode平台规范，生成代码时可自动满足约束条件，无需额外人工干预：</p>
<p>// 委托生成的CourseScheduleEntity类（自动符合OneCode规范）
@EntityMapping(
table = "course_schedule",
primaryKey = "schedule_id",
primaryKeyStrategy = PrimaryKeyStrategy.AUTO
)
@DBTable(tableName = "course_schedule", primaryKey = "schedule_id", cname = "课程表")
public class CourseScheduleEntity {</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Uid</span>
<span class="hljs-meta">@DBField</span>(dbFieldName = <span class="hljs-string">"schedule_id"</span>, dbType = <span class="hljs-title class_">ColType</span>.<span class="hljs-property">VARCHAR</span>, length = <span class="hljs-number">36</span>, isNull = <span class="hljs-literal">false</span>, cnName = <span class="hljs-string">"课程表ID"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> scheduleId;

<span class="hljs-meta">@DBField</span>(dbFieldName = <span class="hljs-string">"course_name"</span>, dbType = <span class="hljs-title class_">ColType</span>.<span class="hljs-property">VARCHAR</span>, length = <span class="hljs-number">20</span>, isNull = <span class="hljs-literal">false</span>, cnName = <span class="hljs-string">"课程名称"</span>)
<span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> courseName;

<span class="hljs-comment">// 自动添加OneCode平台要求的序列化接口与toString方法</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">toString</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"CourseScheduleEntity{"</span> +
            <span class="hljs-string">"scheduleId='"</span> + scheduleId + <span class="hljs-string">'\''</span> +
            <span class="hljs-string">", courseName='"</span> + courseName + <span class="hljs-string">'\''</span> +
            <span class="hljs-string">'}'</span>;
}
</code></pre>
<p>}</p>
<p>针对项目中已存在的非规范代码，可通过委托指令实现批量修正，大幅降低代码审查成本：</p>
<h2 data-id="heading-59">委托修正项目中所有不符合规范的代码</h2>
<p>qodercli delegate onecode "扫描当前OneCode项目代码，执行以下优化操作：</p>
<ol>
<li>补全所有实体类中缺失的@DBField注解</li>
<li>修正不符合驼峰命名规范的方法名</li>
<li>删除未被引用的导入语句" --scope all</li>
</ol>
<p>3.4 集成能力：CLI与可视化IDE的双向赋能</p>
<p>Qoder CLI的委托模式并非替代OneCode可视化IDE，而是形成“CLI处理批量任务+IDE完成精细调整”的协同机制。OneCode可视化IDE的最新功能与CLI委托模式可实现无缝衔接，达成1+1&gt;2的应用效果：</p>
<ul>
<li>
<p>CLI生成的代码可直接在IDE中打开，进行可视化调整与优化</p>
</li>
<li>
<p>IDE中的任务规划结果可导出为标准化CLI指令，实现批量执行</p>
</li>
<li>
<p>图生代码功能生成的界面原型，可通过CLI委托完成业务逻辑填充</p>
</li>
</ul>
<p>四、OneCode可视化IDE新功能与CLI的协同实践</p>
<p>OneCode可视化IDE最新推出的任务规划、图生代码多Agent模式、深度AI集成代理三大功能，与Qoder CLI的委托模式形成能力互补，构建全流程AI开发体系。以下为具体协同应用场景：</p>
<p>4.1 任务规划：从可视化拆解到CLI批量执行</p>
<p>OneCode IDE的任务规划功能支持开发者通过拖拽方式将需求拆解为“实体设计-服务开发-前端组件-部署配置”等子任务，并生成标准化任务清单。该清单可直接导出为CLI指令，通过委托模式实现批量执行：</p>
<h2 data-id="heading-60">基于OneCode IDE任务规划结果生成CLI执行指令</h2>
<h2 data-id="heading-61">1. 导出IDE任务规划结果（生成task-plan.json配置文件）</h2>
<p>onecode ide export-task --format json --output task-plan.json</p>
<h2 data-id="heading-62">2. 基于任务清单执行批量委托</h2>
<p>qodercli delegate onecode --from task-plan.json --sync-ide</p>
<h2 data-id="heading-63">执行完成后同步任务状态至IDE</h2>
<p>qodercli task sync-ide Task-456</p>
<p>该模式既保留了IDE可视化规划的直观性，又发挥了CLI批量执行的高效性，特别适用于团队协作中的需求落地场景。</p>
<p>4.2 图生代码多Agent模式：CLI驱动的协同生成</p>
<p>OneCode IDE的图生代码功能支持上传UI设计图，通过多Agent协作机制生成前端组件代码（布局Agent负责页面结构、样式Agent负责视觉美化、逻辑Agent负责交互实现）。当需要批量生成相似组件时，可通过CLI委托模式驱动该流程自动化：</p>
<h2 data-id="heading-64">委托CLI调用OneCode多Agent模式批量生成前端组件</h2>
<p>qodercli delegate onecode "基于图生代码多Agent模式执行以下操作：</p>
<ol>
<li>批量处理./design目录下的5张课程表相关UI设计图</li>
<li>布局Agent采用OneCode标准栅格系统进行页面结构设计</li>
<li>样式Agent使用平台默认主题进行视觉美化</li>
<li>逻辑Agent绑定已生成的CourseService服务接口</li>
<li>组件生成后自动注册至OneCode组件库"</li>
</ol>
<h2 data-id="heading-65">查看各Agent执行日志详情</h2>
<p>qodercli task log Task-789 --agent all</p>
<p>CLI的批量处理能力与多Agent的专业分工相结合，可使前端组件开发效率提升80%以上，尤其适用于标准化程度高的企业级应用开发场景。</p>
<p>4.3 深度AI集成代理：CLI触发的全流程智能支持</p>
<p>OneCode平台的深度AI集成代理功能，可在开发全流程中提供需求分析、代码优化、缺陷修复等智能支持。通过CLI委托模式，可将该代理能力嵌入自动化流程，实现开发全周期的AI赋能：</p>
<h2 data-id="heading-66">1. 委托AI代理分析需求文档并生成开发方案</h2>
<p>qodercli delegate onecode-agent "分析./requirements/course-schedule.md需求文档，生成OneCode开发方案，内容需包含技术选型、接口设计、数据库表结构定义" --output dev-plan.md</p>
<h2 data-id="heading-67">2. 基于开发方案自动生成项目基础骨架</h2>
<p>qodercli delegate onecode --from dev-plan.md --action generate-skeleton</p>
<h2 data-id="heading-68">3. 开发完成后委托AI代理进行代码审查与优化</h2>
<p>qodercli delegate onecode-agent "审查当前项目代码，重点检查以下维度：</p>
<ul>
<li>代码与OneCode平台规范的符合性</li>
<li>数据库查询语句的性能优化空间</li>
<li>异常处理逻辑的完整性
并自动生成优化建议及修复方案" --fix auto</li>
</ul>
<p>这种“需求分析-骨架生成-开发执行-代码优化”的全流程委托模式，推动OneCode开发从“工具辅助”阶段迈向“智能驱动”的新阶段。</p>
<p>五、整合过程中的关键配置与最佳实践</p>
<p>5.1 核心配置：MCP服务器与权限管理</p>
<p>Qoder CLI与OneCode平台的通信基于MCP协议实现，需完成以下配置以确保委托功能正常运行：</p>
<h2 data-id="heading-69">1. 注册OneCode MCP服务节点（关联AI代理能力）</h2>
<h2 data-id="heading-70">命令说明：--command指定MCP服务启动指令，--env注入环境变量，--timeout设置连接超时阈值</h2>
<p>qodercli mcp add onecode <br/>
--command "onecode mcp start --port 9090" <br/>
--env ONECODE_API_KEY=your-valid-api-key <br/>
--timeout 30s</p>
<h2 data-id="heading-71">2. 多维验证MCP连接有效性</h2>
<h2 data-id="heading-72">检查项包括：网络连通性、AI代理状态、能力矩阵匹配度</h2>
<p>qodercli mcp test onecode --check all</p>
<h2 data-id="heading-73">预期输出：</h2>
<h2 data-id="heading-74">网络连接：OK（TCP 9090端口可达）</h2>
<h2 data-id="heading-75">AI代理状态：在线（版本v1.2.0）</h2>
<h2 data-id="heading-76">支持能力：代码生成、规范检查、需求解析、多Agent调度</h2>
<h2 data-id="heading-77">兼容性：Qoder CLI v0.3.5 与 OneCode v4.0 匹配</h2>
<h2 data-id="heading-78">3. 配置项目级委托策略（优先级：项目配置&gt;全局配置）</h2>
<h2 data-id="heading-79">核心策略：优先使用远程AI代理、启用任务日志同步、指定Agent执行顺序</h2>
<p>cat &gt; .qoder-delegate.json &lt;&lt; EOF
{
"defaultTarget": "onecode",
"taskPriority": "medium",
"syncIde": true,
"logSyncInterval": 10s,
"agentConfig": {
"preferRemote": true,
"logLevel": "info",
"defaultAgentOrder": ["analysis", "generate", "optimize"]
},
"retryPolicy": {
"maxRetries": 3,
"retryDelay": 5s
}
}
EOF</p>
<h2 data-id="heading-80">4. 验证配置生效状态</h2>
<p>qodercli config validate --scope project</p>
<h2 data-id="heading-81">预期输出：项目级配置有效，无冲突项</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[本地系统、虚拟机、远程服务器三者之间的核心区别]]></title>    <link>https://juejin.cn/post/7576821684252262443</link>    <guid>https://juejin.cn/post/7576821684252262443</guid>    <pubDate>2025-11-26T10:25:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576821684252262443" data-draft-id="7576859345934598198" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="本地系统、虚拟机、远程服务器三者之间的核心区别"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-26T10:25:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="tomato_404"/> <meta itemprop="url" content="https://juejin.cn/user/2179677551600074"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            本地系统、虚拟机、远程服务器三者之间的核心区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2179677551600074/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    tomato_404
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-26T10:25:15.000Z" title="Wed Nov 26 2025 10:25:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🌍 一句话总结</h2>
<p>✅ 你之所以用 <strong>Tabby 连接公司服务器</strong> 不需要虚拟机，<br/>
是因为那台服务器 <strong>已经是一台运行着 Ubuntu 的独立电脑（远程机器）</strong> 。<br/>
而你要在自己的电脑上“拥有一个 Ubuntu 环境”，<br/>
就得自己“造出”这样一台虚拟的电脑——那就是虚拟机。</p>
<hr/>
<h2 data-id="heading-1">🧠 类比理解：虚拟机 vs 远程服务器</h2>





























<table><thead><tr><th>概念</th><th>是什么</th><th>在哪儿运行</th><th>你如何进入</th></tr></thead><tbody><tr><td>💻 你自己的电脑（Windows）</td><td>物理机</td><td>桌子上的电脑</td><td>直接操作</td></tr><tr><td>🧱 虚拟机（VM）</td><td>一台“在你电脑里模拟出来的另一台电脑”</td><td>运行在你的物理机里</td><td>通过虚拟机软件打开</td></tr><tr><td>🖥️ 公司服务器（Ubuntu）</td><td>一台真实存在的远程电脑（在机房或云上）</td><td>运行在公司网络</td><td>用 SSH（如 Tabby）远程连接</td></tr></tbody></table>
<p>所以区别就在于：</p>
<ul>
<li><strong>虚拟机 = 在你电脑里“模拟出另一台电脑”</strong> ；</li>
<li><strong>服务器 = 已经存在的“另一台真实电脑”</strong> ；</li>
<li><strong>SSH（Tabby） = 你用网线连过去远程操作那台电脑的“键盘和屏幕”。</strong></li>
</ul>
<hr/>
<h2 data-id="heading-2">🔍 更深入一点：Tabby 并不是运行 Ubuntu，而是在“远程登录”Ubuntu</h2>
<p>当你运行：</p>
<pre><code class="hljs language-sql" lang="sql">ssh <span class="hljs-keyword">user</span><span class="hljs-variable">@192</span><span class="hljs-number">.168</span><span class="hljs-number">.31</span><span class="hljs-number">.185</span>
</code></pre>
<p>或用 Tabby 连接公司服务器时：</p>
<ul>
<li>你的电脑只是一个<strong>终端界面</strong>（相当于“显示器 + 键盘”）；</li>
<li>运行命令、文件系统、网络配置都发生在远程服务器上；</li>
<li>所以你会看到那边的：</li>
</ul>

<ul>
<li>
<ul>
<li>Ubuntu 系统</li>
<li>已经安装好的 nginx、docker 等等；</li>
<li>你只是在操作那台远程机器。</li>
</ul>
</li>
</ul>
<p>而如果你想在<strong>自己的电脑上</strong>也有一样的 Ubuntu 环境，<br/>
因为你手上这台机器运行的可能是 <strong>Windows</strong> 或 <strong>macOS</strong>，<br/>
那就得“虚拟”出一台 Ubuntu 系统的电脑，靠虚拟机实现。</p>
<hr/>
<h2 data-id="heading-3">🧩 对比一下你的两种情况：</h2>























<table><thead><tr><th>场景</th><th>运行的系统</th><th>物理机器是谁</th><th>为什么能用 Ubuntu</th></tr></thead><tbody><tr><td>① Tabby 连公司服务器</td><td>Ubuntu</td><td>服务器（192.168.31.185）</td><td>服务器已经装好了 Ubuntu</td></tr><tr><td>② 自己电脑（Windows）</td><td>Windows</td><td>你自己的笔电 / PC</td><td>没有 Ubuntu，需要虚拟机或 WSL</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">⚙️ 那如果我想像公司服务器那样，本机也能跑 Ubuntu，有哪些选择？</h2>






























<table><thead><tr><th>方案</th><th>原理</th><th>是否需要虚拟机</th></tr></thead><tbody><tr><td><strong>VirtualBox / VMware 安装 Ubuntu</strong></td><td>直接在 Windows 上开一台“虚拟电脑”装 Ubuntu</td><td>✅ 需要虚拟机</td></tr><tr><td><strong>WSL2 (Windows Subsystem for Linux)</strong></td><td>微软提供的轻量 Linux 子系统</td><td>❌ 不需要传统虚拟机，推荐</td></tr><tr><td><strong>Docker Desktop</strong></td><td>它在底层用轻量虚拟化跑 Linux 内核</td><td>⚙️ 自动管理虚拟层，无需你配置</td></tr><tr><td><strong>买/租云服务器（远程主机）</strong></td><td>直接连远程 Ubuntu</td><td>❌ 不需要虚拟机，本身就是服务器</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">🧭 你可以这样理解一条主线：</h2>
<p>物理机器（你的电脑 或 公司服务器）<br/>
→ 上面运行系统（Windows 或 Ubuntu）<br/>
→ 系统里装环境（nginx、docker 等）</p>
<p>当你连接服务器时，<br/>
你是“借用公司那台 Ubuntu 机器的系统”；<br/>
当你在本机装虚拟机时，<br/>
你是在“自己电脑里再创建一台 Ubuntu 机器”。</p>
<hr/>
<h2 data-id="heading-6">🚀 推荐你目前最方便的做法（如果你是 Windows 用户）</h2>
<p>👉 <strong>使用 WSL2 + Ubuntu 子系统</strong><br/>
不需要虚拟机软件、不占太多资源、命令与公司服务器完全一致。</p>
<p>安装命令（管理员 PowerShell）：</p>
<pre><code class="hljs language-css" lang="css">wsl <span class="hljs-attr">--install</span>
</code></pre>
<p>安装完成后：</p>
<pre><code class="hljs language-bash" lang="bash">wsl -l -v   <span class="hljs-comment"># 查看 Ubuntu 是否安装成功</span>
wsl         <span class="hljs-comment"># 进入 Ubuntu 终端</span>
</code></pre>
<p>现在你就在一个真正的 Ubuntu 环境里了，<br/>
可以执行：</p>
<pre><code class="hljs language-lua" lang="lua">sudo apt update
sudo apt install nginx docker.<span class="hljs-built_in">io</span> -y
</code></pre>
<p>这时你本地环境的使用体验，就和你用 Tabby 连公司服务器非常接近。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[女朋友又给我出难题了：解锁网页禁用复制 + 一键提取图片文字]]></title>    <link>https://juejin.cn/post/7576197876717797414</link>    <guid>https://juejin.cn/post/7576197876717797414</guid>    <pubDate>2025-11-25T02:45:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576197876717797414" data-draft-id="7575102209606303770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="女朋友又给我出难题了：解锁网页禁用复制 + 一键提取图片文字"/> <meta itemprop="keywords" content="前端,JavaScript,浏览器"/> <meta itemprop="datePublished" content="2025-11-25T02:45:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不一样的少年_"/> <meta itemprop="url" content="https://juejin.cn/user/3035079961218551"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            女朋友又给我出难题了：解锁网页禁用复制 + 一键提取图片文字
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3035079961218551/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不一样的少年_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T02:45:00.000Z" title="Tue Nov 25 2025 02:45:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    900
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>女朋友做广告策划，每天要从海量网站和素材中摘抄文案。</p>
<p>微信或飞书截图都有 OCR，但她总要“切微信/飞书 → 识别 → 复制 → 切回浏览器”，来回折腾好麻烦，经常被打断思路。</p>
<p><strong>两个最常见的烦恼</strong>：</p>
<ul>
<li>
<p><strong>禁止复制的页面</strong>：设计灵感站、素材站、文库类网站，明明能看到文字，就是选不了、右键也没用，只能手敲。</p>
</li>
<li>
<p><strong>图片里的文字无法快速提取</strong>：看到一张图，得切到微信、点“提取文字”、等识别、复制、再切回来粘贴。</p>
</li>
</ul>
<p><strong>一张图，好几个步骤，来回切换三次。</strong></p>
<p>有天晚上她在赶方案，一边操作一边念叨：“太麻烦了，思路都断了……”</p>
<p>我说：“要不我给你写个插件？”</p>
<p>于是周末两天，做了这个 <strong>「图文解锁器」</strong>：</p>
<ol>
<li><strong>一键解除网页限制</strong> —— 禁选中、禁右键的网站，点一下就能正常复制</li>
<li><strong>浏览器里直接拖框识别</strong> —— 不用切微信，看到哪里框哪里，几秒出结果</li>
<li><strong>所有操作在侧边栏完成</strong> —— 不遮挡页面，不用来回切窗口</li>
</ol>
<p>周一她用上之后的评价：“终于顺手了！那些恶心的禁止复制网站现在随便复制，图片识别也不用跳来跳去了。”</p>
<p>下面讲讲开发过程和技术实现 👇</p>
</blockquote>
<h2 data-id="heading-0">效果演示: 解锁网页禁用复制 + 一键提取图片文字</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dce2ce2f9c5043b690a3184eb6f0d1de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764748905&amp;x-signature=6g1TP6c5jRKOc%2FeqrH6m5S%2FmWCs%3D" alt="copy-everything.gif" loading="lazy"/></p>
<h2 data-id="heading-1">功能特性</h2>
<h3 data-id="heading-2">1.  解除网页限制</h3>
<ul>
<li>一键解除复制限制</li>
<li>恢复右键菜单</li>
<li>允许文本选中</li>
<li>支持动态加载的网页内容解除限制</li>
</ul>
<h3 data-id="heading-3">2. OCR 文字识别（方式与特性）</h3>






























<table><thead><tr><th>方式</th><th>说明</th><th>使用场景</th></tr></thead><tbody><tr><td><strong>页面截图</strong></td><td>快速截取当前可见区域</td><td>一键识别网页全部内容</td></tr><tr><td><strong>自选区域</strong></td><td>拖拽选择任意区域</td><td>只识别你选中的特定区域</td></tr><tr><td><strong>点击上传</strong></td><td>选择本地图片文件</td><td>识别本地图片中的文字</td></tr><tr><td><strong>拖拽上传</strong></td><td>拖入图片即可识别</td><td>方便上传图片并识别文字</td></tr></tbody></table>
<ul>
<li>基于腾讯云 OCR API（每月 1000 次免费额度）</li>
<li>内置图片预览，识别前可确认内容</li>
<li>识别结果一键复制，支持后续粘贴使用</li>
<li>识别流程：选择方式 → 预览 → 开始识别 → 复制/下载</li>
</ul>
<h2 data-id="heading-4">快速开始（安装使用）</h2>
<h3 data-id="heading-5">1. 获取代码</h3>
<ul>
<li><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTeernage%2Fcopy-everything" target="_blank" title="https://github.com/Teernage/copy-everything" ref="nofollow noopener noreferrer">github.com/Teernage/co…</a> ⭐ 如果对您有帮助，欢迎Star</li>
<li><strong>Gitee</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxuzhenxin110%2Fcopy-everything" target="_blank" title="https://gitee.com/xuzhenxin110/copy-everything" ref="nofollow noopener noreferrer">gitee.com/xuzhenxin11…</a></li>
</ul>
<h3 data-id="heading-6">2. 安装扩展（本地加载）</h3>
<ol>
<li>打开 Chrome，地址栏输入 chrome://extensions/</li>
<li>右上角开启“开发者模式”</li>
<li>点击“加载已解压的扩展程序”</li>
<li>选择插件目录</li>
<li>安装完成</li>
</ol>
<p><code>小贴士：Side Panel 依赖较新版本 Chrome，建议 114+。</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a20851ca20744c5fb2660860839141cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764748905&amp;x-signature=QB6ADXsHczAk%2Fp4t0W88i2byf4A%3D" alt="安装copy-everything.gif" loading="lazy"/></p>
<h3 data-id="heading-7">3. 首次使用</h3>
<ul>
<li>点击插件图标打开侧边栏</li>
<li>点击「一键解除」即可解除页面复制限制</li>
<li>使用截图功能（页面截图 / 自选区域）或本地上传（点击上传 / 拖拽上传）进行 OCR 识别</li>
<li>首次体验可直接使用以下账号（每月 1000 次免费额度）：
<ul>
<li>SecretId： AKIDLUQ7aqsjNmwufWFm590d1BxXs0xgBRTH</li>
<li>SecretKey： c09OVP4aw75oIYZMvFO8j5C5uiIgspIc</li>
<li>将 SecretId 和 SecretKey 填入插件侧边栏后保存设置，即可开始图文识别</li>
</ul>
</li>
</ul>
<p><code>注：如免费额度用完，请根据下方指导申请属于你自己的账号哦。👇</code></p>
<h4 data-id="heading-8">腾讯云 OCR 开通与配置</h4>
<p>插件支持腾讯云 OCR，每月有约 1000 次免费额度，足够日常使用。首次识别前，请按以下步骤开通并配置：</p>
<ol>
<li>进入 腾讯云文字识别控制台<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.tencent.com%2Focr%2Fv2%2Foverview" target="_blank" title="https://console.cloud.tencent.com/ocr/v2/overview" ref="nofollow noopener noreferrer">console.cloud.tencent.com/ocr/v2/over…</a> ，勾选条款并开通服务。</li>
<li>前往 API 密钥管理<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.tencent.com%2Fcam%2Fcapi" target="_blank" title="https://console.cloud.tencent.com/cam/capi" ref="nofollow noopener noreferrer">console.cloud.tencent.com/cam/capi</a> 获取自己的 SecretId 和 SecretKey。</li>
<li>将 SecretId 和 SecretKey 填入插件侧边栏并保存设置，即可开始图文识别。</li>
</ol>
<h3 data-id="heading-9">注意事项</h3>
<ol>
<li>
<p><strong>API 费用</strong>：腾讯云 OCR 每个月有1000个请求的免费额度，超出后按量计费</p>
</li>
<li>
<p><strong>权限说明</strong>：</p>
<ul>
<li><code>activeTab</code>：访问当前标签页</li>
<li><code>scripting</code>：注入脚本</li>
<li><code>storage</code>：保存配置</li>
<li><code>sidePanel</code>：侧边栏功能</li>
</ul>
</li>
<li>
<p><strong>兼容性</strong>：</p>
<ul>
<li>Chrome 114+ （Side Panel API 要求）</li>
<li>部分网站可能有额外防护</li>
</ul>
</li>
</ol>
<h2 data-id="heading-10">技术实现原理</h2>
<h3 data-id="heading-11">核心技术栈</h3>
<ul>
<li><strong>Manifest V3</strong>：Chrome 扩展最新规范</li>
<li><strong>Side Panel API</strong>：侧边栏界面</li>
<li><strong>Content Scripts</strong>：页面注入脚本</li>
<li><strong>Tencent Cloud OCR</strong>：腾讯云文字识别 API</li>
<li><strong>Canvas API</strong>：图片裁剪</li>
</ul>
<h3 data-id="heading-12">架构设计</h3>
<pre><code class="hljs language-bash" lang="bash">copy-everything
├── manifest.json         <span class="hljs-comment"># 插件配置</span>
├── icons                 <span class="hljs-comment"># 插件图标</span>
├── background.js         <span class="hljs-comment"># 后台服务</span>
├── content.js            <span class="hljs-comment"># 内容脚本（核心功能）</span>
├── inject.js             <span class="hljs-comment"># 注入页面脚本（核心功能）</span>
├── sidepanel.html        <span class="hljs-comment"># 侧边栏界面</span>
├── sidepanel.js          <span class="hljs-comment"># 侧边栏界面逻辑</span>
├── sidepanel.css         <span class="hljs-comment"># 侧边栏样式</span>
└── tencentOCR.js         <span class="hljs-comment"># OCR SDK</span>

</code></pre>
<h2 data-id="heading-13">核心代码解析</h2>
<h3 data-id="heading-14">1. 解除复制限制  （五层防护）</h3>
<h4 data-id="heading-15">这是插件的核心功能之一，通过多层防护确保解除限制：</h4>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b625ffe3f14f719c51acb48cc6483d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764748905&amp;x-signature=ke%2F2EtVHZzSQrjYga2Gt9AoHwfg%3D" alt="image.png" width="30%" loading="lazy"/>
<h4 data-id="heading-16">实现原理</h4>
<p>通过<strong>五层防护</strong>确保解除限制</p>
<h4 data-id="heading-17">第一层：CSS 强制覆盖</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> style = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'style'</span>);
style.<span class="hljs-property">textContent</span> = <span class="hljs-string">`
  html, body, * {
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    user-select: text !important;
  }
`</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(style);
</code></pre>
<p><strong>作用</strong>：强制允许文本选中，覆盖网站的 CSS 限制。</p>
<h4 data-id="heading-18">第二层：事件拦截（捕获阶段）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 在捕获阶段拦截所有限制事件</span>
<span class="hljs-keyword">const</span> restrictedEvents = [
  <span class="hljs-string">'copy'</span>, <span class="hljs-string">'cut'</span>, <span class="hljs-string">'paste'</span>, <span class="hljs-string">'contextmenu'</span>, 
  <span class="hljs-string">'selectstart'</span>, <span class="hljs-string">'dragstart'</span>, <span class="hljs-string">'keydown'</span>, <span class="hljs-string">'keyup'</span>, <span class="hljs-string">'keypress'</span>
];

<span class="hljs-keyword">const</span> <span class="hljs-title function_">stopEvent</span> = (<span class="hljs-params">e</span>) =&gt; {
  e.<span class="hljs-title function_">stopPropagation</span>();
  e.<span class="hljs-property">stopImmediatePropagation</span>?.(); <span class="hljs-comment">// 阻止其他监听器执行</span>
};

<span class="hljs-comment">// 在 window、document、documentElement、body 四个层级同时监听</span>
[<span class="hljs-variable language_">window</span>, <span class="hljs-variable language_">document</span>, <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>, <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">target</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (target) {
    restrictedEvents.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">eventType</span> =&gt;</span> {
      target.<span class="hljs-title function_">addEventListener</span>(eventType, stopEvent, <span class="hljs-literal">true</span>); <span class="hljs-comment">// ← 捕获阶段</span>
    });
  }
});
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>在<strong>捕获阶段</strong>拦截（优先级最高）</li>
<li>使用 <code>stopImmediatePropagation()</code> 阻止其他监听器</li>
<li>在四个层级监听（window → document → html → body）</li>
</ul>
<p><strong>为什么要用捕获阶段？</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">事件流：捕获阶段 → 目标阶段 → 冒泡阶段 
<span class="hljs-code">        ↓
  我们在这里拦截（优先级最高）
</span></code></pre>
<h4 data-id="heading-19">第三层：移除内联事件属性</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 移除所有事件属性（如 oncopy="return false"）</span>
<span class="hljs-keyword">const</span> eventAttrs = [
  <span class="hljs-string">'oncopy'</span>, <span class="hljs-string">'oncut'</span>, <span class="hljs-string">'onpaste'</span>, <span class="hljs-string">'oncontextmenu'</span>,
  <span class="hljs-string">'onselectstart'</span>, <span class="hljs-string">'onkeydown'</span>, <span class="hljs-string">'ondragstart'</span>
];

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(eventAttrs.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> <span class="hljs-string">`[<span class="hljs-subst">${a}</span>]`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>))
  .<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
    eventAttrs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">attr</span> =&gt;</span> el.<span class="hljs-title function_">removeAttribute</span>(attr));
  });
</code></pre>
<p><strong>作用</strong>：移除 HTML 标签上的内联事件（如 <code>oncopy="return false"</code>）</p>
<h4 data-id="heading-20">第四层：API 劫持（重写 preventDefault）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 注入到页面上下文，重写原生方法</span>
<span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
script.<span class="hljs-property">textContent</span> = <span class="hljs-string">`
  (function() {
    if (window.__preventDefaultDisabled) return;
    window.__preventDefaultDisabled = true;
    
    const blockedEvents = new Set(<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(restrictedEvents)}</span>);
    const originalPreventDefault = Event.prototype.preventDefault;
    
    Event.prototype.preventDefault = function() {
      if (blockedEvents.has(this.type)) return; // ← 禁用 preventDefault
      return originalPreventDefault.call(this);
    };
  })();
`</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">appendChild</span>(script);
script.<span class="hljs-title function_">remove</span>();
</code></pre>
<p><strong>为什么要注入 <code>&lt;script&gt;</code> 标签？</strong></p>
<ul>
<li>Content Script 运行在<strong>隔离环境</strong>（Isolated World）</li>
<li>无法直接修改页面的 <code>Event.prototype</code></li>
<li>通过 <code>&lt;script&gt;</code> 标签注入到<strong>页面上下文</strong>（Main World）</li>
</ul>
<p><code>💡 深入理解脚本通信机制</code></p>
<p>如果你想深入了解插件脚本通信机制，强烈推荐阅读： <strong><a href="https://juejin.cn/post/7573521516324732955" target="_blank" title="https://juejin.cn/post/7573521516324732955">大部分人都错了！这才是 Chrome 插件多脚本通信的正确姿势</a></strong>   <a href="https://juejin.cn/post/7573521516324732955" target="_blank" title="https://juejin.cn/post/7573521516324732955">juejin.cn/post/757352…</a> 这篇文章用原理+示例拆解了常见误区与正确做法，能帮你更透彻地理解本插件的通信机制。</p>
<h4 data-id="heading-21">第五层：动态内容监听</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 监听 DOM 变化，自动处理动态加载的元素</span>
<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(<span class="hljs-function">(<span class="hljs-params">mutations</span>) =&gt;</span> {
  mutations.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">mutation</span>) =&gt;</span> {
    mutation.<span class="hljs-property">addedNodes</span>?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">node</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Element</span>) {
        <span class="hljs-comment">// 移除事件属性</span>
        eventAttrs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">attr</span> =&gt;</span> node.<span class="hljs-title function_">removeAttribute</span>(attr));
        <span class="hljs-comment">// 强制允许选中</span>
        node.<span class="hljs-property">style</span>?.<span class="hljs-title function_">setProperty</span>(<span class="hljs-string">'user-select'</span>, <span class="hljs-string">'text'</span>, <span class="hljs-string">'important'</span>);
      }
    });
  });
});

observer.<span class="hljs-title function_">observe</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>, {
  <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">subtree</span>: <span class="hljs-literal">true</span>
});
</code></pre>
<p><strong>作用</strong>：监听 DOM 变化，自动处理动态加载的元素（如 React/Vue 渲染的内容）。</p>
<h3 data-id="heading-22">2. 自选区域截图</h3>
<h3 data-id="heading-23">三步完成截图</h3>
<ol>
<li><strong>按下按钮</strong> → 屏幕变暗</li>
<li><strong>拖动框</strong> → ：按住鼠标拖出一个框，选出你想要的区域</li>
<li><strong>松开手</strong> → 自动截取框内内容</li>
</ol>
<h4 data-id="heading-24">实现步骤</h4>
<h3 data-id="heading-25"> 这背后发生了什么？</h3>
<h4 data-id="heading-26"><strong>步骤 1：创建选框工具</strong></h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 创建遮罩层（就像给屏幕盖了一层磨砂玻璃）</span>
<span class="hljs-keyword">const</span> overlay = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
overlay.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
  position: fixed;
  left: 0; top: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.5);  /* 半透明黑色 */
  cursor: crosshair;             /* 十字准星 */
  z-index: 999999;
`</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(overlay);

</code></pre>
<p>当你点击"自选区域"后，插件会：</p>
<ul>
<li>在屏幕上盖一层半透明黑色遮罩（让你看清楚要选什么）</li>
<li>鼠标变成十字准星（提示你可以开始拖框了）</li>
<li>准备好一个绿色边框（等你拖出来就显示）</li>
</ul>
<h4 data-id="heading-27"><strong>2. 跟随你的鼠标画框（实时反馈）</strong></h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 鼠标按下 → 记录起点</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMouseDown</span>(<span class="hljs-params">e</span>) {
  startX = e.<span class="hljs-property">clientX</span>;  <span class="hljs-comment">// 记住你点击的 X 坐标</span>
  startY = e.<span class="hljs-property">clientY</span>;  <span class="hljs-comment">// 记住你点击的 Y 坐标</span>
}

<span class="hljs-comment">// 鼠标移动 → 实时更新框的大小</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMouseMove</span>(<span class="hljs-params">e</span>) {
  currentX = e.<span class="hljs-property">clientX</span>;
  currentY = e.<span class="hljs-property">clientY</span>;
  
  <span class="hljs-comment">// 计算框的位置和大小（支持反向拖拽）</span>
  <span class="hljs-keyword">const</span> left = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(startX, currentX);   <span class="hljs-comment">// 取最小值作为左边界</span>
  <span class="hljs-keyword">const</span> top = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(startY, currentY);    <span class="hljs-comment">// 取最小值作为上边界</span>
  <span class="hljs-keyword">const</span> width = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(currentX - startX); <span class="hljs-comment">// 宽度 = 绝对值</span>
  <span class="hljs-keyword">const</span> height = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(currentY - startY);<span class="hljs-comment">// 高度 = 绝对值</span>
  
  <span class="hljs-comment">// 更新绿色边框的位置</span>
  selectionBox.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = left + <span class="hljs-string">'px'</span>;
  selectionBox.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = top + <span class="hljs-string">'px'</span>;
  selectionBox.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = width + <span class="hljs-string">'px'</span>;
  selectionBox.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = height + <span class="hljs-string">'px'</span>;
}

</code></pre>
<p>当你按住鼠标拖动时：</p>
<ul>
<li>记录你<strong>按下的位置</strong>（起点）</li>
<li>记录你<strong>当前的位置</strong>（终点）</li>
<li>用这两个点的横坐标和纵坐标的差值画出一个矩形框</li>
</ul>
<p><strong>支持反向拖拽</strong>：不管你从左上往右下拖，还是从右下往左上拖，都能正确识别！</p>
<p><strong>举个例子</strong>：</p>
<pre><code class="hljs language-js" lang="js">你从 (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>) 拖到 (<span class="hljs-number">300</span>, <span class="hljs-number">300</span>)
→ 框的位置：left=<span class="hljs-number">100</span>, top=<span class="hljs-number">100</span>, width=<span class="hljs-number">200</span>, height=<span class="hljs-number">200</span> ✅

你从 (<span class="hljs-number">300</span>, <span class="hljs-number">300</span>) 拖到 (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>)（反向）
→ 框的位置：left=<span class="hljs-number">100</span>, top=<span class="hljs-number">100</span>, width=<span class="hljs-number">200</span>, height=<span class="hljs-number">200</span> ✅

</code></pre>
<h4 data-id="heading-28"><strong>3. 精准裁剪（像剪刀一样裁图）</strong></h4>
<p>当你松开鼠标后，插件会：</p>
<ol>
<li><strong>先截取整个页面</strong>（就像拍了一张全屏照片）</li>
<li><strong>再裁剪出你选中的部分</strong>（就像用剪刀剪出你要的区域）</li>
</ol>
<p><strong>关键技术：Canvas 画布裁剪</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 创建一个画布（就像准备一张白纸）</span>
<span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'canvas'</span>);
<span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);

<span class="hljs-comment">// 2. 设置画布大小 = 你选中区域的大小</span>
canvas.<span class="hljs-property">width</span> = width;
canvas.<span class="hljs-property">height</span> = height;

<span class="hljs-comment">// 3. 把全屏截图的"选中部分"画到画布上</span>
ctx.<span class="hljs-title function_">drawImage</span>(
  fullScreenImage,  <span class="hljs-comment">// 全屏截图</span>
  left, top,        <span class="hljs-comment">// 从哪里开始裁剪（你选中区域的左上角）</span>
  width, height,    <span class="hljs-comment">// 裁剪多大（你选中区域的宽高）</span>
  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,             <span class="hljs-comment">// 画到画布的哪里（从画布左上角开始）</span>
  width, height     <span class="hljs-comment">// 画多大（填满整个画布）</span>
);

<span class="hljs-comment">// 4. 导出成图片</span>
<span class="hljs-keyword">const</span> croppedImage = canvas.<span class="hljs-title function_">toDataURL</span>(<span class="hljs-string">'image/png'</span>);

</code></pre>
<p><strong>用生活场景类比</strong>：</p>
<ul>
<li>全屏截图 = 拍了一张班级照</li>
<li>你选中的区域 = 你只想要照片里的某个人</li>
<li>Canvas 裁剪 = 用剪刀把那个人剪下来</li>
</ul>
<h4 data-id="heading-29"><strong>步骤 4：四遮罩高亮效果</strong></h4>
<p><strong>问题</strong>：如果只用一个全屏遮罩，选中的区域也会被遮住，用户看不清选了什么。</p>
<p><strong>解决方案</strong>：用 4 个遮罩块围绕选区。</p>
<pre><code class="hljs">┌─────────────────────────────────┐
│    上遮罩（半透明黑色）            │
├──────┬──────────────┬───────────┤
│ 左遮罩│   选区（高亮） │  右遮罩   │
├──────┴──────────────┴───────────┤
│    下遮罩（半透明黑色）            │
└─────────────────────────────────┘

</code></pre>
<p><strong>代码实现</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 创建 4 个遮罩块</span>
<span class="hljs-keyword">const</span> masks = [<span class="hljs-string">'top'</span>, <span class="hljs-string">'right'</span>, <span class="hljs-string">'bottom'</span>, <span class="hljs-string">'left'</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">position</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> mask = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  mask.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
    position: fixed;
    background: rgba(0,0,0,0.5);
    pointer-events: none; /* 不阻挡鼠标事件 */
  `</span>;
  <span class="hljs-keyword">return</span> mask;
});

<span class="hljs-comment">// 根据选区位置更新遮罩块大小</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateMasks</span>(<span class="hljs-params">left, top, width, height</span>) {
  masks[<span class="hljs-number">0</span>].<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> += <span class="hljs-string">`left:0; top:0; width:100vw; height:<span class="hljs-subst">${top}</span>px;`</span>; <span class="hljs-comment">// 上</span>
  masks[<span class="hljs-number">1</span>].<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> += <span class="hljs-string">`left:<span class="hljs-subst">${left+width}</span>px; top:<span class="hljs-subst">${top}</span>px; width:<span class="hljs-subst">${<span class="hljs-variable language_">window</span>.innerWidth-left-width}</span>px; height:<span class="hljs-subst">${height}</span>px;`</span>; <span class="hljs-comment">// 右</span>
  masks[<span class="hljs-number">2</span>].<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> += <span class="hljs-string">`left:0; top:<span class="hljs-subst">${top+height}</span>px; width:100vw; height:<span class="hljs-subst">${<span class="hljs-variable language_">window</span>.innerHeight-top-height}</span>px;`</span>; <span class="hljs-comment">// 下</span>
  masks[<span class="hljs-number">3</span>].<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> += <span class="hljs-string">`left:0; top:<span class="hljs-subst">${top}</span>px; width:<span class="hljs-subst">${left}</span>px; height:<span class="hljs-subst">${height}</span>px;`</span>; <span class="hljs-comment">// 左</span>
}

</code></pre>
<h4 data-id="heading-30">高分屏适配（让图片更清晰）</h4>
<p><strong>问题</strong>：Retina 屏幕（如 MacBook）的像素密度是普通屏幕的 2 倍，如果不处理会导致截图模糊。</p>
<p><strong>解决方案</strong>：乘以设备像素比</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> scale = <span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span> || <span class="hljs-number">1</span>; <span class="hljs-comment">// Retina 屏幕 = 2，普通屏幕 = 1</span>

<span class="hljs-comment">// 设置画布大小时要乘以 scale</span>
canvas.<span class="hljs-property">width</span> = width * scale;
canvas.<span class="hljs-property">height</span> = height * scale;

<span class="hljs-comment">// 裁剪时也要乘以 scale</span>
ctx.<span class="hljs-title function_">drawImage</span>(
  fullScreenImage,
  left * scale, top * scale,     <span class="hljs-comment">// ← 乘以 scale</span>
  width * scale, height * scale, <span class="hljs-comment">// ← 乘以 scale</span>
  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,
  width * scale, height * scale
);

</code></pre>
<h4 data-id="heading-31">完整流程</h4>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ef6def5a66b46c584a8f038e0b0ff3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764748905&amp;x-signature=Myi4TWTPsH05RTxorW%2B1%2BNqRZNw%3D" alt="image.png" width="30%" loading="lazy"/>
<h2 data-id="heading-32">时序图</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
  participant SP as Sidepanel
  participant CT as Content Script
  participant BG as Background

  SP-&gt;&gt;CT: startAreaCapture
  CT-&gt;&gt;CT: createCaptureUI + 事件绑定
  CT-&gt;&gt;CT: 用户拖拽/更新选区
  CT-&gt;&gt;CT: mouseup → captureSelectedArea
  CT-&gt;&gt;BG: captureVisible
  BG--&gt;&gt;CT: DataURL(整页可见区域)
  CT-&gt;&gt;CT: Canvas 裁剪(考虑 devicePixelRatio)
  CT-&gt;&gt;SP: areaCaptureDone(DataURL)
  SP-&gt;&gt;SP: 预览 + OCR 识别
</code></pre>
<h3 data-id="heading-33">3. 本地上传图片</h3>
<h4 data-id="heading-34">方式一：点击上传</h4>
<p><strong>HTML</strong>：</p>
<pre><code class="hljs language-js" lang="js">&lt;input type=<span class="hljs-string">"file"</span> id=<span class="hljs-string">"uploadInput"</span> accept=<span class="hljs-string">"image/*"</span> style=<span class="hljs-string">"display:none"</span>&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"document.getElementById('uploadInput').click()"</span>&gt;</span>
  📁 上传图片
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
</code></pre>
<p><strong>JavaScript</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'uploadInput'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> file = e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> (!file) <span class="hljs-keyword">return</span>;
  
  <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
  reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">async</span> (event) =&gt; {
    <span class="hljs-keyword">const</span> base64 = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">recognizeText</span>(base64);
  };
  reader.<span class="hljs-title function_">readAsDataURL</span>(file);
});

</code></pre>
<h4 data-id="heading-35">方式二：拖拽上传</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> dropZone = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'dropZone'</span>);

<span class="hljs-comment">// 1. 阻止默认行为</span>
[<span class="hljs-string">'dragenter'</span>, <span class="hljs-string">'dragover'</span>, <span class="hljs-string">'dragleave'</span>, <span class="hljs-string">'drop'</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">eventName</span> =&gt;</span> {
  dropZone.<span class="hljs-title function_">addEventListener</span>(eventName, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    e.<span class="hljs-title function_">preventDefault</span>();
    e.<span class="hljs-title function_">stopPropagation</span>();
  });
});

<span class="hljs-comment">// 2. 视觉反馈</span>
[<span class="hljs-string">'dragenter'</span>, <span class="hljs-string">'dragover'</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">eventName</span> =&gt;</span> {
  dropZone.<span class="hljs-title function_">addEventListener</span>(eventName, <span class="hljs-function">() =&gt;</span> {
    dropZone.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'drag-over'</span>);
  });
});

<span class="hljs-comment">// 3. 处理文件</span>
dropZone.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'drop'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> file = e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> (!file.<span class="hljs-property">type</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'image/'</span>)) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'请上传图片文件！'</span>);
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
  reader.<span class="hljs-property">onload</span> = <span class="hljs-keyword">async</span> (event) =&gt; {
    <span class="hljs-keyword">const</span> base64 = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">recognizeText</span>(base64);
  };
  reader.<span class="hljs-title function_">readAsDataURL</span>(file);
});

</code></pre>
<p><strong>CSS</strong>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-id">#dropZone</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> dashed <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-id">#dropZone</span><span class="hljs-selector-class">.drag-over</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#4CAF50</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">76</span>, <span class="hljs-number">175</span>, <span class="hljs-number">80</span>, <span class="hljs-number">0.1</span>);
}

</code></pre>
<ul>
<li>作用：把图片拖进上传图片区域 ，拦住浏览器默认行为，在 drop 时读文件并识别或预览。</li>
</ul>
<h3 data-id="heading-36"> 4.页面截图</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> capturePageBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'capturePageBtn'</span>);

capturePageBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> [tab] = <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">tabs</span>.<span class="hljs-title function_">query</span>({ <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">currentWindow</span>: <span class="hljs-literal">true</span> });
  
  <span class="hljs-keyword">const</span> dataUrl = <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">tabs</span>.<span class="hljs-title function_">captureVisibleTab</span>(tab.<span class="hljs-property">windowId</span>, {
    <span class="hljs-attr">format</span>: <span class="hljs-string">'png'</span>
  });
  
  <span class="hljs-keyword">const</span> base64 = dataUrl.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">recognizeText</span>(base64);
});
</code></pre>
<p>直接使用chrome插件的截图功能
<strong>权限配置</strong>（manifest.json）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"activeTab"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"tabs"</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-37">5. OCR 识别</h3>
<p>使用腾讯云 OCR API，通过 TC3-HMAC-SHA256 签名调用 <code>GeneralBasicOCR</code> 接口，每月 1000 次免费额度。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 核心调用代码</span>
<span class="hljs-keyword">const</span> ocr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TencentOCR</span>(secretId, secretKey);
<span class="hljs-keyword">const</span> text = <span class="hljs-keyword">await</span> ocr.<span class="hljs-title function_">recognizeText</span>(imageBase64);
</code></pre>
<h2 data-id="heading-38">总结</h2>
<p>这个插件解决了日常浏览网页时的两大痛点：</p>
<ol>
<li><strong>解除限制</strong>：让你自由复制任何内容</li>
<li><strong>OCR 识别</strong>：快速提取图片文字</li>
</ol>
<h3 data-id="heading-39">技术亮点</h3>






























<table><thead><tr><th>技术点</th><th>难点</th><th>解决方案</th></tr></thead><tbody><tr><td><strong>解除限制</strong></td><td>网站多层防护</td><td>五层拦截 + API 劫持</td></tr><tr><td><strong>自选截图</strong></td><td>高分屏模糊</td><td>devicePixelRatio 适配</td></tr><tr><td><strong>拖拽上传</strong></td><td>视觉反馈</td><td>CSS 过渡动画</td></tr><tr><td><strong>OCR 识别</strong></td><td>API 签名</td><td>TC3-HMAC-SHA256</td></tr></tbody></table>
<p>希望这个插件能帮到大家！如果有问题或建议，欢迎在评论区交流～</p>
<h2 data-id="heading-40">🔗 相关链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fextensions%2F" target="_blank" title="https://developer.chrome.com/docs/extensions/" ref="nofollow noopener noreferrer">Chrome Extension 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdocument%2Fproduct%2F866" target="_blank" title="https://cloud.tencent.com/document/product/866" ref="nofollow noopener noreferrer">腾讯云 OCR 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FCanvas_API" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API" ref="nofollow noopener noreferrer">Canvas API 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHTML_Drag_and_Drop_API" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API" ref="nofollow noopener noreferrer">Drag and Drop API</a></li>
</ul>
<blockquote>
<p>本插件仅供学习交流使用，请遵守以下原则：</p>
<ol>
<li><strong>合法使用</strong>：请勿用于商业用途或侵犯他人知识产权</li>
<li><strong>尊重版权</strong>：遵守网站服务条款</li>
</ol>
<p>如果觉得对您有帮助，欢迎点赞 👍 收藏 ⭐ 关注 🔔 支持一下！</p>
<p><strong>往期实战推荐：</strong></p>
<ul>
<li>
<p><a href="https://juejin.cn/post/7549096640340426802" target="_blank" title="https://juejin.cn/post/7549096640340426802">Vue3 后台分页写腻了？我用 1 个 Hook 删掉 90% 重复代码（附源码）</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7511332054941188147" target="_blank" title="https://juejin.cn/post/7511332054941188147">⚡ 一个Vue自定义指令搞定丝滑拖拽列表，告别复杂组件封装
</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7543806966926802971" target="_blank" title="https://juejin.cn/post/7543806966926802971">🔥 这才是 Vue 驱动的 Chrome 插件工程化正确打开方式</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7566299971643424819" target="_blank" title="https://juejin.cn/post/7566299971643424819">  老板问我：AI真能一键画广州旅游路线图？我用 MCP 现场开图</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7559124639323242506" target="_blank" title="https://juejin.cn/post/7559124639323242506">【前端效率工具】：告别右键另存，不到 50 行代码一键批量下载网页图片</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7561612065707065390" target="_blank" title="https://juejin.cn/post/7561612065707065390"> 女朋友炸了：刚打开的网页怎么又没了？我反手甩出一键恢复按钮！</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7562859113246343178" target="_blank" title="https://juejin.cn/post/7562859113246343178"> 你家孩子又偷玩网页游戏? 试试这个防沉迷工具</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7563830723057647643" target="_blank" title="https://juejin.cn/post/7563830723057647643">  她说想要浪漫，我把浏览器鼠标换成了柴犬，点一下就有烟花（附源码）</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7566677296801071155" target="_blank" title="https://juejin.cn/post/7566677296801071155"> 女朋友被链接折磨疯了，我写了个工具一键解救</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7568055953310662707" target="_blank" title="https://juejin.cn/post/7568055953310662707"> 上班摸鱼看掘金，老板突然出现在身后...</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7570984257666056238" target="_blank" title="https://juejin.cn/post/7570984257666056238"> 【前端效率工具】再也不用 APIfox 联调！零侵入 Mock，全程不改代码、不开代理</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7573521516324732955" target="_blank" title="https://juejin.cn/post/7573521516324732955"> 大部分人都错了！这才是chrome插件多脚本通信的正确姿势</a></p>
</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE SOLO 正式发布了？我用它将像老乡鸡那样做饭小程序开源了！]]></title>    <link>https://juejin.cn/post/7576210031873409065</link>    <guid>https://juejin.cn/post/7576210031873409065</guid>    <pubDate>2025-11-25T02:46:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576210031873409065" data-draft-id="7576181242582630463" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE SOLO 正式发布了？我用它将像老乡鸡那样做饭小程序开源了！"/> <meta itemprop="keywords" content="前端,Trae,AI编程"/> <meta itemprop="datePublished" content="2025-11-25T02:46:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不如摸鱼去"/> <meta itemprop="url" content="https://juejin.cn/user/26044011388510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE SOLO 正式发布了？我用它将像老乡鸡那样做饭小程序开源了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044011388510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不如摸鱼去
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T02:46:27.000Z" title="Tue Nov 25 2025 02:46:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    172
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是不如摸鱼去，欢迎来到我的 AI 编程分享专栏。</p>
<p>一个月前我发布的一篇文章<a href="https://juejin.cn/post/7554225547117576243" target="_blank" title="https://juejin.cn/post/7554225547117576243">【老乡鸡也开源？我用 Trae SOLO 做了个像老乡鸡那样做饭小程序！】</a>，记录了作为一名爱做饭的程序员的我，使用 TRAE SOLO 快速构建了一个像老乡鸡那样做饭小程序的过程，应朋友们的要求，趁着 TRAE SOLO 正式发布，用它把这个小程序开源了。</p>
<h2 data-id="heading-0">TRAE SOLO 正式版</h2>
<p>11 月 12 日 TRAE SOLO 正式版上线了，新增三栏布局、DiffView 工具、SOLO Coder + Plan，支持多任务并行等功能，并上线了免费体验活动，人人都可以用 SOLO 了。</p>
<p>我可是 TRAE SOLO 老用户了，SOLO 模式（Beta 版）上线的时候我就拿到了 SOLO CODE，并且使用它完成了「复刻童年坦克大战」、「像老乡鸡那样做饭小程序」等实践，并且在实际工作中使用 TRAE 参与了很多任务的开发。如今正式版发布，自然不能错过。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4584916d38934f7e8e12a6e01b47e51d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=TLpMojBXj3XBaDhXyee5K0EOW%2B8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">像老乡鸡那样做饭</h2>
<p>一切都源自于老乡鸡发布的《老乡鸡菜品溯源报告》，<code>CookLikeHOC</code>是一个拥有 22k 星星的 GitHub 仓库，它收录了《老乡鸡菜品溯源报告》中公布的所有菜品。</p>
<h2 data-id="heading-2">技术栈</h2>
<p>我们延续上篇文章选择好的技术栈，这样 AI 可以在我们规划好的路线上进行开发，可以达到事半功倍的效果。</p>
<h3 data-id="heading-3">前端技术栈</h3>
<p>因为我本身就是一个前端程序员，所以前端技术栈比较熟，直接选择常用的技术栈：</p>
<ul>
<li>小程序的开发框架: uni-app</li>
<li>开发模板项目: wot-starter 地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fstarter.wot-ui.cn%2F" target="_blank" title="https://starter.wot-ui.cn/" ref="nofollow noopener noreferrer">starter.wot-ui.cn/</a></li>
<li>组件库: wot-ui 地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwot-ui.cn%2F" target="_blank" title="https://wot-ui.cn/" ref="nofollow noopener noreferrer">wot-ui.cn/</a></li>
</ul>
<h3 data-id="heading-4">后端技术栈</h3>
<p>服务端仍然选择 TRAE SOLO 集成的 Supabase 作为我们的云端服务。</p>
<h2 data-id="heading-5">开始SOLO</h2>
<p>我们之前已经搭建好小程序的基础页面了，现在可以开始优化部分功能整理开发阶段的 SQL 和脚本以便将小程序开源了。</p>
<h3 data-id="heading-6">优化 UI 样式</h3>
<blockquote>
<p>这里我们全程使用 SOLO Coder 模式，因为它更适合解决复杂编程问题。</p>
</blockquote>
<p>更新首页分类展示，支持展示全部分类。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b8993eceada4be5bc69bd61fd4a5838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=m%2FPn4HU0c8M5WkiLefbFz4RkiHA%3D" alt="" loading="lazy"/></p>
<p>可以使用 DiffView 功能查看更新内容</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70a474beefac4f31a37350af42a44c16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=V16kAPUDrJlO8tUOHZcDaNLj0eo%3D" alt="" loading="lazy"/></p>
<p>更新后效果如下，使用 swiper 展示分类，支持左右滑动切换展示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6853318dd74e4aebac5ea01b4beba92f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=NyA%2B8qJigZi2Xc4l2kDiMawUCuA%3D" alt="" loading="lazy"/></p>
<p>同时我使用 即梦AI 给不同分类生成了个可爱的图标，非常简单的提示词。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d975f61a10304aecbd61f80e804dd397~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=%2FvCekxtsx85pqIwZ5Z1QR6BLIxc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">优化数据取值</h3>
<p>打开 TRAE SOLO 模式，可以在这里找到“集成”功能
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee498491217b4596b3d9d71244a5bd70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=%2BPEuy2a6RUgLk%2Bi3XKCBVdPV7lE%3D" alt="" loading="lazy"/></p>
<p>需要注意的是，我们在使用“集成”功能时，最好切换到 SOLO Builder 模式，因为在这个模式下才有“集成”功能，下图是 SOLO Coder 和 SOLO Builder 的区别：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43e0f0c378344ab79ae856060ad2178a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=0S0w0DcQnD%2B0pd3AqpbWMygfa0c%3D" alt="" loading="lazy"/></p>
<p>进入“集成”功能，选择连接我们的 supbase。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20f438517539486a927246697f802626~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=XTpHq0%2BYBbEKmTjp8OnbdUSZp%2B4%3D" alt="" loading="lazy"/></p>
<p>优化首页展示每日推荐菜谱的逻辑，每天随机从每个分类中查询 2 道菜展示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aebc2295121b4eb2ae0d587376fd0ceb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=qucpO5vrAWfjzXER08CC%2BoICQ9M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88d91a6e88b344a9bdbe37e815604be9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=MsqbtMg%2Fj2wwFZ%2Fe5jQbNLl5e5A%3D" alt="" loading="lazy"/></p>
<p>优化菜谱详情页面相关推荐的逻辑，当前菜谱的相同分类中随机推荐五道菜。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/156b0d6199a64c728c790c05ae19b774~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=hinl4KG0O9dHNpcXml9av%2F5C%2BCM%3D" alt="" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d7c2f09b4a0467497e166b77d0e811f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=S5XY0OFa6ALygVmPZuSu0t87bzI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">整理脚本并开源</h3>
<p>由于这个改动涉及文件多，改动大，所以这里我们要在 SOLO Coder 下开启 plan 模式，让 TRAE 提前给出计划，我们确认后再由 TRAE 进行开发。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5e9076d234c4ae3aa3474c1b7615116~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=McOKK0g6SY7Ihaz%2BjTIbJh9co3M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a4ed207aac84810902c68e54f5367be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=i4eq8mRXz6ulLrtSCiu4pGwB7Qs%3D" alt="" loading="lazy"/></p>
<p>我们仔细看一下 SOLO Coder 的方案，没有问题就让它开始执行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bf0d032e47c4bf3b48e780480306063~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=7%2B1TC%2BgIVd%2BCirrwMml2IMCXXLA%3D" alt="" loading="lazy"/></p>
<p>SOLO Coder 执行完毕后，我们点击查看变更，使用 DiffView 功能检查变更文件，判断 SOLO 执行是否正确。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b48b1c8323794644b92b90f592cbe5dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=1HJ7ccJmuonIqxLMwFaEj4c7H80%3D" alt="" loading="lazy"/></p>
<p>需要注意的是，如果你的操作需要操作数据库，可以切换到 SOLO Builder 模式，让它协助操作，建表、执行SQL、获取 supbase 配置，它都可以胜任。</p>
<h3 data-id="heading-9">配置CI/CD</h3>
<p>我们使用 uni-mini-ci 完成本小程序的 CI/CD持续集成，小程序一键部署不再是梦，这里就不贴完整的 GitHub Action 代码了，大家可以小程序的 GitHub 仓库中看。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/866febb66aa94aa4aa33e9fd1dad0fa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=dBE1VUe86LNombeHW5veWLJIg8Q%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54cb9ff2f40444e0aa7940faeef6c1b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=HJ4GBMK6SFaSsNoVuY%2BNQ2Ub7sc%3D" alt="" loading="lazy"/></p>
<p>将 GitHub Action 配置文件推送到 GitHub 上，就可以按照下图操作进行手动发版，当然也可以通过打 tag 触发发版，发版执行会将代码推送到微信小程序后台。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbb678aac5e3427d9329e9997acf4a1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=DFMBEHRk9%2F1ICuvyHhzxl9PpeaM%3D" alt="" loading="lazy"/></p>
<p>我们可以在微信小程序后台看到对应的开发版本：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea6f6297bea543ec870916263ae1f315~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=Ey4cw2WZ5jVEfvDzPs3iuNa1lTw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">完整效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a25e26f54ce44f65a149ecd4085a419d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=pCw1tyb0Yfv4VNZz%2Fk9%2BT9aj8Qo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a76c41632884997a3c38078fd49b09f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=TMIiRJfc1a%2Fm%2Fi%2B%2BWaJlr08y5XQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20963583d96947379c373efe8e9dedd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764650998&amp;x-signature=%2Fg6TuenSlLN5el0uySNaMwVhXbQ%3D" alt="" loading="lazy"/></p>
<p><em><strong>也可以自行搜索「鱼哥菜谱」进行体验</strong></em></p>
<h2 data-id="heading-11">TRAE SOLO 正式版体验</h2>
<p>TRAE SOLO 正式版新增了 Plan 模式和 SOLO Coder 等，对编程体验的提升很大，减少了很多 AI 介入后的善后工作。不过失去 Claude 仍对其能力造成了不小的影响，期待后续可以在 SOLO 模式集成强大的 Gemini 3 和优秀的国产模型 GLM 等，IDE 与模型 2 者是相辅相成的。</p>
<h2 data-id="heading-12">总结</h2>
<p>我们几乎零代码 用 Trae SOLO 完成了「像老乡鸡那样做饭」小程序的开源与 CI/CD 流程，过程中保持数据干净、纯净上下文、增量式沟通等三个原则仍然是使我们事半功倍的利器，这其实和当下很流行的 SDD 规范相符，在这种小型项目中，基于一个优秀的项目模板和良好的需求输入和开发计划，由规范驱动开发，能让项目做的更好、走得更远。</p>
<p>好了，实现这个小程序后，大家也可以像老乡鸡那样做饭了！</p>
<h2 data-id="heading-13">参考资料</h2>
<ul>
<li>小程序：「鱼哥菜谱」</li>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMoonofweisheng%2FMyCookLikeHOC" target="_blank" title="https://github.com/Moonofweisheng/MyCookLikeHOC" ref="nofollow noopener noreferrer">github.com/Moonofweish…</a></li>
<li>CookLikeHOC：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGar-b-age%2FCookLikeHOC" target="_blank" title="https://github.com/Gar-b-age/CookLikeHOC" ref="nofollow noopener noreferrer">github.com/Gar-b-age/C…</a></li>
<li>项目模板：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstarter.wot-ui.cn%2F" target="_blank" title="https://starter.wot-ui.cn/" ref="nofollow noopener noreferrer">starter.wot-ui.cn/</a></li>
</ul>
<p><em><strong>欢迎评论区沟通、讨论👇👇</strong></em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谷歌新论文：为什么当前 AI 无法在训练后继续学习？]]></title>    <link>https://juejin.cn/post/7576181242582892607</link>    <guid>https://juejin.cn/post/7576181242582892607</guid>    <pubDate>2025-11-25T03:15:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576181242582892607" data-draft-id="7576212547235135531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谷歌新论文：为什么当前 AI 无法在训练后继续学习？"/> <meta itemprop="keywords" content="前端,AIGC,人工智能"/> <meta itemprop="datePublished" content="2025-11-25T03:15:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谷歌新论文：为什么当前 AI 无法在训练后继续学习？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T03:15:24.000Z" title="Tue Nov 25 2025 03:15:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>相信大家都经历过这样的疑惑，在使用 AI 的过程中，为什么我明明都纠正过它的问题，但是它下次还是依然会犯同样的错误，以至于我们不得不针对性写大量的规则来约束整个 Vibe Coding 的过程。</p>
<blockquote>
<p>但是就算有详细的 rule ，有些倔强的模型依然喜欢我行我素，比如 Gemini 3 Pro 就容易出现， <strong>写的太详细的 prompt ，效果居然不如模糊的</strong>，你纠正他，他会先肯定你，然后说还是该按照我的来····</p>
</blockquote>
<h2 data-id="heading-0">问题</h2>
<p>谷歌这次公布的论文很直观的解释了这个问题：<strong>因为大模型无法在训练后继续学习</strong> ，论文把当前的大型语言模型（LLM）被比作患有 <strong>“顺行性遗忘症”（Anterograde Amnesia）</strong> 的病人 ，这种病人只能保留发病前的长期记忆，无法形成新的长期记忆，只能依靠短暂的短期记忆生活。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/369b747e84a34869b11b90b1b06394a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764645324&amp;x-signature=SPT%2BjNorfMdl%2FlkYebROM39BP90%3D" alt="image-20251125103150345" loading="lazy"/></p>
<p>具体可以解释为以下三点：</p>
<h3 data-id="heading-1">A. “数字失忆症”：只有两极，没有中间态</h3>
<p>目前的模型只有两种记忆状态，中间存在巨大的断层：</p>
<ol>
<li><strong>极快且短暂的记忆</strong>（In-Context Learning）： 也就是你的 <code>Prompt</code> 或上下文窗口，这部分通过注意力机制（Attention）处理，更新极快，但这只是“临时的”，一旦窗口关闭或超出长度，信息就消失了 ，这也是为什么它并能吸取你的教训的原因</li>
<li><strong>冻结的长期记忆（Pre-trained Weights）：</strong> 对应的是模型的 <code>MLP</code> 层（参数），这部分是在预训练阶段通过海量数据“固化”下来的，一旦部署了，这些参数就是静态的，无法更改 。</li>
</ol>
<p>而目前的问题在于：当前模型缺乏将“即时对话”转化为“长期参数”的机制，也就是它们缺乏中间的频谱：<strong>那些应该从短期逐渐变为长期的记忆</strong>。</p>
<h3 data-id="heading-2">B. 维度单一：只堆叠了“深度”，忽略了“时间”</h3>
<p>在论文里，传统的“深度学习”主要关注堆叠更多的层（Depth）来增加容量 ，但这一维度是静态的。</p>
<p>研究人员发现<strong>真正的学习需要正交的另一个维度：时间（或频率）</strong> ，大脑并不是以统一的速度更新所有神经元的，而是以不同的频率（脑波）运作，而目前的 LLM 就像是一个强制所有楼层都静止不动的建筑，只有最顶层的“接待处”（Context）在工作。</p>
<h3 data-id="heading-3">C. 优化器与架构的分离</h3>
<p>在传统深度学习中，<strong>架构</strong>（如 Transformer）和<strong>优化器</strong>（如 Adam）被看作是两个独立的东西，架构负责推理，优化器负责在训练时更新参数。</p>
<p>而论文的颠覆性观点是： 优化器本质上也是一种<strong>联想记忆模块（Associative Memory）</strong> ，目前的模型在部署后丢弃了优化器，导致它们失去了“自我修改”和“压缩梯度”的能力，从而失去了学习能力。</p>
<h2 data-id="heading-4">解决办法</h2>
<p>为了解决这个问题，谷歌提出了一种新的范式，不再把模型看作一个扁平的神经网络，而是看作<strong>一组嵌套的优化问题</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/412bd2c859c6487a995362d8eb2bc841~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764645324&amp;x-signature=GbFVHZaKtmRueCmIGPhwLQiTjnY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">A. 核心理念：连续记忆频谱 (Continuum Memory System)</h3>
<p>就像人类大脑有不同频率的脑波（Delta波、Theta波、Alpha波等）分别负责不同层级的记忆整合一样 ，模型也应该有不同更新频率的组件。</p>
<ul>
<li>
<p><strong>传统模型：</strong> 频率只有 0 （冻结的参数）和 ♾️（极快的 Attention）。</p>
</li>
<li>
<p><strong>嵌套学习模型：</strong> 创建一个：</p>
<ul>
<li><strong>Level 1 (极快):</strong> 处理当前的 Token。</li>
<li><strong>Level 2 (中等):</strong> 每隔 16 个 Token 更新一次，捕捉短期上下文</li>
<li><strong>Level 3 (慢速):</strong> 每隔 100万 Token 更新一次，捕捉长期知识</li>
<li><strong>Level 4 (极慢):</strong> 类似目前的预训练知识</li>
</ul>
</li>
</ul>
<p>例如，左图（Deep Learning）展示了通常理解的深度学习模型（如 RNN + Attention），是一个扁平的序列 ，这种视角隐藏了内部的梯度流动 。</p>
<p>而右图（Neural Learning Module）：*是论文的核心视角，它将模型看作一个个<strong>嵌套的立方体</strong>，每一个立方体代表一个“优化问题” ，从而实现不同 Level 的连续频谱，每一层都有自己的梯度流（Gradient Flow）和更新目标。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28937766376b45368aa2ef073529650e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764645324&amp;x-signature=7yBZTFJmwdmXzYOvjKLLhmvhF3o%3D" alt="" loading="lazy"/></p>
<p>也就是 <strong>“层（Layer）”不仅仅是空间的堆叠，而是时间上的嵌套</strong>，解释了为什么模型应该包含“内部优化器”：即模型在推理时，内部的小盒子应该在不断自我优化。</p>
<h3 data-id="heading-6">B. 新架构：HOPE (Self-Modifying Titans + Continuum Memory)</h3>
<p>论文作者提出了 <strong>HOPE</strong> 的具体实现模型，它结合了两个关键技术：</p>
<ol>
<li>自我修改的 Titans** (Self-Modifying Titans)</li>
</ol>
<p>模型不再依赖外部的优化器（如 Adam）来告诉它如何更新，而是学习如何修改自己，模型内部包含了一个“学习模块”，它能在运行时计算梯度并更新自己的参数，这意味着模型在和你对话的过程中，实际上在微调它自己的部分结构</p>
<ol start="2">
<li>多级 MLP 系统</li>
</ol>
<p>HOPE 使用了一系列嵌套的 MLP（多层感知机）块，每个块有不同的“块大小”（Chunk Size）和更新频率：</p>
<ul>
<li>有些层更新得很快，负责记住刚才的对话</li>
<li>有些层更新得很慢，负责沉淀知识</li>
</ul>
<p>组合起来，就构成了“梯度记忆曲线” 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc5b0a9cccc041b0b6468a03185b4a0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764645324&amp;x-signature=pBDlZP47djcKi1OWHewdrYZ0aqA%3D" alt="" loading="lazy"/></p>
<p>对比 Transformer 的极端频率，可以看出来 HOPE (左侧)这是一个连续的频谱，</p>
<ul>
<li>High Frequency FFN：块大小（Chunk Length）为 16，更新频率高 。</li>
<li>Mid Frequency FFN：块大小为 1M（一百万），更新频率中等。</li>
<li>Low Frequency FFN：更新极慢 。</li>
</ul>
<p>从而解决“无法继续学习”的问题，展示了如何填补“短期记忆”和“长期记忆”之间的空白，创建了不同速率的记忆层级。</p>
<h3 data-id="heading-7">C. 深度优化器 (Deep Optimizers)</h3>
<p>论文证明了动量梯度下降（Momentum SGD）本质上是一个 2 级的联想记忆系统 ，HOPE 利用这一发现，设计了更具表达能力的优化器，使其成为模型本身的一部分，而不是训练完就扔掉的工具。</p>
<h2 data-id="heading-8">实验结果与意义</h2>
<p>在实验中，HOPE 模型（760M 和 1.3B 参数量）在语言建模和常识推理任务上，<strong>击败了同等规模的 Transformer++、RetNet 和 Mamba (Titans)</strong> ， 更重要的是它展示了更低的困惑度（Perplexity），证明了这种“动态更新”机制的有效性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6b22fce82bb4efb87493f8830614f4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764645324&amp;x-signature=BoT%2BDUA%2BYoU2s2x8fx2pifdNY%2FI%3D" alt="" loading="lazy"/></p>
<p>另外论文的意义不仅仅在于提出了一个新模型，而在于它挑战了“深度学习”这个名字本身 ：</p>
<ul>
<li><strong>从“深度”到“嵌套”：</strong> 未来的 AI 竞争可能不再单纯是堆叠层数和参数规模（Scale），而是设计更合理的<strong>时间更新频率（Time/Frequency）</strong></li>
</ul>

<ul>
<li><strong>终身学习 (Lifelong Learning)：</strong> 如果 HOPE 架构被规模化，也许可以会看到真正的“养成系” AI，它不会在发布那天就停止成长，而是通过每一次交互，将信息从短期记忆逐渐渗透到长期记忆中，真正解决“灾难性遗忘”和“无法持续学习”的痛点。</li>
</ul>
<p>总结起来，之前的 ChatGPT 和 Gemini 像是一个只有“此时此刻”和“出厂设置”的机器；而 Google 提出的 HOPE 架构，试图赋予 AI “从此刻走向永恒”的记忆能力，让模型在运行中通过自我修改来持续进化。</p>
<blockquote>
<p>而实际上对应之前 Deepseek 利用图片来压缩记忆的实现，也是在记忆时效性上的探索。</p>
</blockquote>
<h2 data-id="heading-9">最后</h2>
<p><strong>从这个角度看，能“吃一堑长一智”的 AI 也许离我们就不远了</strong>，不过可以猜测，这种实现也有这相应的局限性问题需要处理，例如 HOPE 架构的核心在于“模型在推理过程中修改自己” ，这意味着它不能像传统 Transformer 那样只进行简单的矩阵乘法，还需要进行梯度的计算和参数更新，也就是：</p>
<ul>
<li>更多的性能开销，例如额外的 MLP 运算和实时梯度计算</li>
<li>更多的内存占用，比如 HOPE 需要存储“优化器状态” 和管理状态大小</li>
<li>HOPE 要求参数在 <code>Forward</code> 过程中动态变化 ，这种“自我修改”的代码实现难度大，且难以利用现有的底层 Kernel 优化</li>
<li>多嵌套下的梯度流管理和独立问题</li>
<li>·····</li>
</ul>
<blockquote>
<p>最后，本文解读主要参考 Gemini 分析。</p>
</blockquote>
<h2 data-id="heading-10">原文链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fabehrouz.github.io%2Ffiles%2FNL.pdf" target="_blank" title="https://abehrouz.github.io/files/NL.pdf" ref="nofollow noopener noreferrer">abehrouz.github.io/files/NL.pd…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这 5 个冷门的 HTML 标签，能让你少写 100 行 JS]]></title>    <link>https://juejin.cn/post/7576468602304495654</link>    <guid>https://juejin.cn/post/7576468602304495654</guid>    <pubDate>2025-11-25T07:38:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576468602304495654" data-draft-id="7576378563574808591" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这 5 个冷门的 HTML 标签，能让你少写 100 行 JS"/> <meta itemprop="keywords" content="前端,JavaScript,HTML"/> <meta itemprop="datePublished" content="2025-11-25T07:38:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这 5 个冷门的 HTML 标签，能让你少写 100 行 JS
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T07:38:13.000Z" title="Tue Nov 25 2025 07:38:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9406a89e16ac4345bc2ecc9958596ff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764661092&amp;x-signature=HKGQlG4tuN2%2BMq1ZIfmDADVmuDU%3D" alt="image.png" loading="lazy"/></p>
<p>大家好!😁。</p>
<p>Code Review 的时候，我最怕看到什么？</p>
<p>不是复杂的算法，也不是什么正则。而是<strong>明明一个 HTML 标签就能搞定的事，有人非要写几百行 JS + CSS 去重新发明轮子</strong> 。</p>
<p>前几天，我看到一个新同学为了写一个折叠面板（Accordion），引入了一个重型的第三方库，还写了一堆 <code>useState</code>、<code>onClick</code> 和动画逻辑。</p>
<p>我默默地把他的代码全删了，换成了 3 行 <code>&lt;details&gt;</code>。他看我的眼神，仿佛在看一个外星人🤣。</p>
<p>在 2025 年的今天，浏览器原生 HTML 的能力早已今非昔比。很多我们习惯用 JS 去模拟的交互，现在不仅有原生支持，而且<strong>性能更好、兼容性更强、无障碍（a11y）更完善</strong>。</p>
<p>今天，我就来盘点 5 个被严重低估的HTML标签👇。</p>
<hr/>
<h3 data-id="heading-0"><strong><code>&lt;details&gt;</code> &amp; <code>&lt;summary&gt;</code>：折叠组件</strong></h3>
<p>你是不是还在写这样的 React 代码？</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// JS 模拟版</span>
<span class="hljs-keyword">const</span> [isOpen, setIsOpen] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"accordion"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"header"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsOpen(!isOpen)}&gt;
      点击展开 {isOpen ? '⬆️' : '⬇️'}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {isOpen &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"content"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
);
</code></pre>
<p>为了这个功能，你还得写 CSS 动画，还得处理键盘事件（Tab 键能不能选到？回车能不能展开？等等）。</p>
<p><strong>HTML 原生写法：</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">details</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span>点击展开<span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
    这里是展开后的内容，原生支持 Ctrl+F 页内搜索！
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">details</span>&gt;</span>
</code></pre>
<ol>
<li><strong>没有任何JS</strong>：自带点击展开/收起交互。</li>
<li><strong>无障碍（a11y）满分</strong>：屏幕阅读器能完美识别，Tab 键、回车键原生支持。</li>
<li><strong>页内搜索</strong>：这是 JS 模拟版最大的痛点。如果内容被 JS 隐藏了（<code>display: none</code>），浏览器的 Ctrl+F 往往搜不到。但 <code>&lt;details&gt;</code> 里的内容，即使折叠，浏览器也能搜到并自动展开！</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9c863dafadc46c4a208d26d6b5641f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764661092&amp;x-signature=vMtXW6eygD%2FdQTk35yZ4ndeH5vI%3D" alt="Untitled ‑ Made with FlexClip.gif" loading="lazy"/></p>
<p>配合 CSS 👇</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">details</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-tag">summary</span> {
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-comment">/* 包住内容，让它能动画高度 */</span>
<span class="hljs-selector-tag">details</span> &gt; <span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: max-height .<span class="hljs-number">45s</span> ease, opacity .<span class="hljs-number">3s</span> ease;
}

<span class="hljs-comment">/* details 处于 open 状态时 */</span>
<span class="hljs-selector-tag">details</span><span class="hljs-selector-attr">[open]</span> &gt; <span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">200px</span>; <span class="hljs-comment">/* 你内容高度大概多少设多少，足够大即可 */</span>
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}
</code></pre>
<p>依然可以做动画。</p>
<hr/>
<h3 data-id="heading-1"><strong><code>&lt;dialog&gt;</code>：弹窗组件</strong></h3>
<p>写模态框（Modal）是前端最大的坑之一。你需要考虑：</p>
<ul>
<li><code>z-index</code> 层级会不会被遮挡？</li>
<li>点击遮罩层关闭？</li>
<li><strong>Focus Trap（焦点锁定）</strong> ：打开弹窗后，Tab 键不能跑到底层页面去。</li>
<li>按下 <code>Esc</code> 键关闭？</li>
</ul>
<p>为了解决这些，我们通常会引入 <code>Antd Modal</code> 或者 <code>React Portal</code>。但在轻量级场景下，原生 <code>&lt;dialog&gt;</code> 才是神🫅。</p>
<p><strong>HTML 原生：</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">dialog</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myModal"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个原生模态框<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>关闭（自动）<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"myModal.showModal()"</span>&gt;</span>打开弹窗⏏<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ae231b2a4af4c8694ff5a0843a5747d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764661092&amp;x-signature=Oi6OWEl7QtlHnfEpPS3hwJBmyrw%3D" alt="Untitled ‑ Made with FlexClip.gif" loading="lazy"/></p>
<ol>
<li><strong>Top Layer（顶层特性）</strong> ：浏览器会把它渲染在所有 DOM 的最上层，<strong>彻底无视</strong>父元素的 <code>z-index</code> 和 <code>overflow: hidden</code>。</li>
<li><strong>::backdrop 伪元素</strong>：直接用 CSS 定制遮罩层样式。</li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 背景遮罩 */</span>
dialog<span class="hljs-selector-pseudo">::backdrop</span> {
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.45</span>);
    backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">3px</span>);
    <span class="hljs-attribute">transition</span>: opacity .<span class="hljs-number">3s</span> ease;
}
</code></pre>
<ol start="3">
<li><strong>原生交互</strong>：自带 <code>Esc</code> 关闭，自带焦点管理，表单提交自动关闭。</li>
</ol>
<hr/>
<h3 data-id="heading-2"><strong><code>&lt;datalist&gt;</code>：搜索自动补全</strong></h3>
<p>当产品经理要求做一个带搜索建议的输入框时，你的第一反应是不是：“快！引入 <code>Select2</code> 或者 <code>Antd AutoComplete</code>！😖</p>
<p>且慢。如果只是简单的建议列表，几 KB 的 JS 库都显得太重了。</p>
<p><strong>HTML 原生版：</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>选择你喜欢的框架：<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">list</span>=<span class="hljs-string">"frameworks"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">datalist</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"frameworks"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"React"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Vue"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Svelte"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Angular"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Solid"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">datalist</span>&gt;</span>
</code></pre>
<ol>
<li><strong>模糊搜索</strong>：浏览器原生支持模糊匹配（打 u 会出来 Vue）。</li>
<li><strong>响应式</strong>：在手机上，它会调用系统原生的下拉选择 UI，体验比网页模拟的更顺滑。</li>
<li><strong>解耦</strong>：它只是一个建议列表，用户依然可以输入列表里没有的值（这点和 Select 不同）。</li>
</ol>
<hr/>
<h3 data-id="heading-3"><strong><code>&lt;fieldset&gt;</code> &amp; <code>disabled</code>：一键禁用整个表单</strong></h3>
<p><strong>场景</strong>：用户点击提交按钮后，为了防止重复提交，我们需要<strong>禁用表单里的所有输入框</strong>。</p>
<p><strong>JS 笨办法：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 还要一个个去拿 DOM，或者维护一个 loading 状态传给所有组件</span>
inputs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">input</span> =&gt;</span> input.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>);
buttons.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> btn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>);
</code></pre>
<p><strong>HTML 原生写法：</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span> <span class="hljs-attr">disabled</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"login-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">legend</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">legend</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"用户名"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"密码"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">// 一行代码搞定状态切换</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'login-group'</span>).<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>; 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d86311c7162b449d9e6b77c5e87b4af3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764661092&amp;x-signature=GIo5a4J0SdBaWGlymX6COE7iqjU%3D" alt="clideo_editor_c3a7f45a392f482ea0added4098a5be3.gif" loading="lazy"/></p>
<p>这是一个极好的<strong>分组</strong>思维。通过给 <code>&lt;fieldset&gt;</code> 设置 <code>disabled</code>，浏览器会自动禁用内部所有的 <code>&lt;input&gt;</code>, <code>&lt;select&gt;</code>, <code>&lt;button&gt;</code>。不用写循环，不用维护复杂的 State。</p>
<hr/>
<h3 data-id="heading-4"><strong><code>&lt;input type="file" capture&gt;</code>：H5 调用手机相机</strong></h3>
<p><strong>场景</strong>：业务需要用户上传一张照片，可以是相册选的，也可以是<strong>当场拍的</strong>。</p>
<p>很多新手的反应是：是不是要接微信 JSSDK？是不是要写个 Bridge 调原生 App 能力？</p>
<p><strong>答案是不需要！</strong></p>
<p><strong>HTML 原生：</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">capture</span>=<span class="hljs-string">"environment"</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">"image/*"</span>&gt;</span>
</code></pre>
<p>只要加上 capture 属性，在移动端（iOS/Android）点击上传时，系统会直接拉起相机，而不是让你去选文件。拍完照后，你拿到的就是一个标准的 File 对象。</p>
<p>不需要什么 JS SDK，实现原生级体验👍。</p>
<hr/>
<p>我总是强调 <strong>最好的代码，是没有代码！</strong></p>
<p>HTML 标准一直在进化，很多曾经需要重型 JS 才能实现的功能，现在已经成了浏览器的出厂设置了。</p>
<p>使用这些原生标签，不仅能减少打包体积，更能让你的应用在<strong>可访问性</strong>和<strong>性能</strong>上天然领先。</p>
<p>下次再想 <code>npm install</code> 一个 UI 库之前，先查查 MDN。说不定，HTML 早就帮你做好了🤔。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UI小姐姐要求有“Duang~Duang”的效果怎么办？]]></title>    <link>https://juejin.cn/post/7576264484688379944</link>    <guid>https://juejin.cn/post/7576264484688379944</guid>    <pubDate>2025-11-25T05:51:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576264484688379944" data-draft-id="7573950036897087528" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UI小姐姐要求有“Duang~Duang”的效果怎么办？"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-11-25T05:51:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端九哥"/> <meta itemprop="url" content="https://juejin.cn/user/3659622444970574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UI小姐姐要求有“Duang~Duang”的效果怎么办？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3659622444970574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端九哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T05:51:59.000Z" title="Tue Nov 25 2025 05:51:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9456ab9014694573909de2733acc5b69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Lmd5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764654719&amp;x-signature=w4sPNHGfhJ%2Bv0Xhu3jDr%2BmOaPz0%3D" alt="test.gif" loading="lazy"/></p>
<blockquote>
<p><strong>设计小姐姐</strong>：  “搞一下这样的<strong>回弹</strong>效果，你行不行？”<br/>
<strong>我</strong>：“行！直接梭哈 50 行 keyframes + transform + 各种百分比，搞定 ”<br/>
<strong>设计小姐姐</strong>：“太硬（撇嘴），不够 Q 弹（鄙视）”<br/>
<strong>我</strong>：(裂开)<br/>
<strong>隔壁老王</strong>：这么简单你都不行，我来一行贝塞尔 cubic-bezier(0.3, 1.15, 0.33, 1.57) 秒了😎<br/>
<strong>设计小姐姐</strong>：哇哦！（兴奋）好帅！（星星眼🌟）好Q弹！（一脸崇拜😍）<br/>
<strong>我</strong>：<strong>“？？？”</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">🧠 一、为什么一行贝塞尔就能“Duang”起来？</h2>
<h3 data-id="heading-1">1️⃣ cubic-bezier 是什么？</h3>
<p>在 CSS 动画里，我们经常写：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span> ease;
</code></pre>
<p>但其实 <code>ease</code>、<code>linear</code>、<code>ease-in-out</code> 这些都只是封装好的贝塞尔曲线。<br/>
底层原理是：</p>
<pre><code class="hljs language-css" lang="css">cubic-bezier(x1, y1, x2, y2)
</code></pre>
<p>这四个参数定义了<strong>时间函数曲线</strong>，控制动画速度的变化。</p>
<ul>
<li><code>x</code>：时间轴（必须在 0～1 之间）</li>
<li><code>y</code>：数值轴（可以超出 0～1！）</li>
</ul>
<p>👉 当 y 超过 1 或小于 0 时，动画值就会<strong>冲过终点再回弹</strong>，<br/>
这就是“回弹感”的核心。</p>
<hr/>
<h3 data-id="heading-2">2️⃣ 回弹的本质：过冲 + 衰减</h3>
<p>想象一个球掉下来：</p>
<ul>
<li><strong>过冲</strong>：球落地时会压扁（超出终点）</li>
<li><strong>回弹</strong>：然后反弹回来，再逐渐稳定</li>
</ul>
<p>在动画中，这个“过冲”就是 y&gt;1 的部分，<br/>
而“回弹”就是曲线回到 y=1 的过程。</p>
<hr/>
<h2 data-id="heading-3">🧪 二、一行贝塞尔的魔法</h2>
<h3 data-id="heading-4">✅ 火箭发射</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d945616e56f74171afda7e6b38b97c8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Lmd5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764654719&amp;x-signature=lUyE6LGLXrjzlCGpwDn2f6gf%2F8M%3D" alt="export_1764044056566.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bounce"</span>&gt;</span>🚀发射！<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.bounce</span> {
 <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.8s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.68</span>, -<span class="hljs-number">0.55</span>, <span class="hljs-number">0.27</span>, <span class="hljs-number">1.55</span>);
}
<span class="hljs-selector-class">.bounce</span><span class="hljs-selector-pseudo">:hover</span> {
 <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">500px</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><span href="https://code.juejin.cn/pen/7576535022065647654" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7576535022065647654" data-src="https://code.juejin.cn/pen/7576535022065647654" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span>
💡 <strong>参数解析：</strong></p>
<ul>
<li>y1 = -0.55 → 先轻微反向缩小</li>
<li>y2 = 1.55 → 再冲过头 55%，最后回弹到原位</li>
</ul>
<h2 data-id="heading-5">🧩 四、常用贝塞尔参数</h2>



































<table><thead><tr><th>效果描述</th><th>贝塞尔参数</th><th>备注</th></tr></thead><tbody><tr><td>微回弹（按钮）</td><td><code>cubic-bezier(0.34, 1.31, 0.7, 1)</code></td><td>轻柔弹性</td></tr><tr><td>强回弹（卡片）</td><td><code>cubic-bezier(0.68, -0.55, 0.27, 1.55)</code></td><td>爆发力强</td></tr><tr><td>柔和出入</td><td><code>cubic-bezier(0.4, 0, 0.2, 1.4)</code></td><td>iOS 风</td></tr><tr><td>弹性放大</td><td><code>cubic-bezier(0.175, 0.885, 0.32, 1.275)</code></td><td>弹簧感</td></tr><tr><td>火箭猛冲</td><td><code>cubic-bezier(0.68, -0.55, 0.27, 1.55)</code></td><td>推背感</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">🧰 五、调试神器推荐</h2>
<ul>
<li>
<p>🎨 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcubic-bezier.com" target="_blank" title="https://cubic-bezier.com" ref="nofollow noopener noreferrer">cubic-bezier.com</a><br/>
拖动手柄实时预览动画，复制参数一键搞定。</p>
</li>
<li>
<p>⚙️ <a href="https://link.juejin.cn?target=https%3A%2F%2Feasings.net" target="_blank" title="https://easings.net" ref="nofollow noopener noreferrer">easings.net</a><br/>
收录各种 easing 函数（含物理弹簧、阻尼等）。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[比 MySQL 轻，比 SQLite 强：终于有人把 AI 数据库做对了]]></title>    <link>https://juejin.cn/post/7576197876716748838</link>    <guid>https://juejin.cn/post/7576197876716748838</guid>    <pubDate>2025-11-25T00:19:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576197876716748838" data-draft-id="7576105442214330418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="比 MySQL 轻，比 SQLite 强：终于有人把 AI 数据库做对了"/> <meta itemprop="keywords" content="GitHub,开源,数据库"/> <meta itemprop="datePublished" content="2025-11-25T00:19:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HelloGitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384091320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            比 MySQL 轻，比 SQLite 强：终于有人把 AI 数据库做对了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384091320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HelloGitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:19:55.000Z" title="Tue Nov 25 2025 00:19:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19f57e8e53b549d2a5fa1eafd945fccb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=D9%2FsddVGJGhrzo7o7qk7aloo6P8%3D" alt="" loading="lazy"/></p>
<p>前几天，我看到了一个来自 Turso 创始人 Pekka 的观点：</p>
<blockquote>
<p>SQLite 被认为是 AI agent 的理想数据库，因为它轻量级且适用于 AI agent 的各种场景，但仍然需要进化。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d656b3e981498f9ebdcbcd8a127606~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=S2tn8ybJo6m058%2BxmEtikklnojk%3D" alt="" loading="lazy"/></p>
<p>评论区里也有意思，有人会和大家分享自己为了 SQLite 的进化做了哪些事情（比如开源了 Super SQLite 之类的项目），也有人会推荐有哪些 SQLite 的进化版产品，并和大家讨论这些产品的优劣。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaea769ca6d24bcc919823f5214e32d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=sCQbdeIC9PdWvm9pnQELxr03n3A%3D" alt="" loading="lazy"/></p>
<p>实际上，AI 应用开发者对轻量级数据库的诉求，远远不止 AI Agent 这一个场景。那些在 Web 时代和移动互联网时代支撑了万亿级应用的传统数据库，如今在面对 AI 应用的敏捷、轻量、高频迭代的需求时，都纷纷开始暴露出它们的水土不服。</p>
<p>除了传统数据库几个最明显的问题 —— <strong>部署复杂度高、资源占用多、过度设计影响执行效率</strong> 以外，很多 AI 应用都会把数据和模型紧密结合，在设备端（如手机、物联网设备）实现本地化运行，传统数据库通过客户端远程连接服务器的模式，也无法满足这种嵌入式，甚至离线嵌入式的需求。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91fb112cc10549f0aa304a3ad341d3da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=sq6yHywgjveQ9Uv0FuuFYSUMX4Y%3D" alt="" loading="lazy"/></p>
<p>为了让 AI 开发者不浪费太多时间在与数据基础设施的搏斗上，而是能够专注于 AI 算法与应用逻辑本身。我们需要一种新型数据库，能够将自己从这种无谓的消耗中解放出来。</p>
<h2 data-id="heading-0">0x01. seekdb 的来龙去脉</h2>
<p>OceanBase 刚开始只是负责淘宝和支付宝的各种交易支付相关业务，然后是各种银行和金融机构，接下来是从泛互联网行业扩展到各行各业，详见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFng44Ft1gNKKP2mYK1vsew" target="_blank" title="https://mp.weixin.qq.com/s/Fng44Ft1gNKKP2mYK1vsew" ref="nofollow noopener noreferrer">《开源 4 年、打磨 15 年、300 万行代码的开源项目》</a>。</p>
<p>但在 AI 时代，对于开发者，类似于 SQLite 这种轻量级数据库的能力非常有限（向量能力和传统 SQL 能力难以兼得），而传统数据库又有部署复杂度高、资源占用多等问题。这两类数据库对于开发者来说，都不够友好。</p>
<p>因此，OceanBase 专门为 AI 时代的开发者，打造了一个开源免费、轻量易用、拥有强大 AI 搜索能力的数据库 —— <strong>seekdb</strong>。个人笔记本安装无压力，让大家只要有机器，就能跑 OB！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb24ebddac6f46579eebf998f5984dde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=%2BRrmzUB7F0L9ADAK7XdQth5P4%2Fw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foceanbase%2Fseekdb" target="_blank" title="https://github.com/oceanbase/seekdb" ref="nofollow noopener noreferrer">github.com/oceanbase/s…</a></p>
</blockquote>
<h2 data-id="heading-1">0x10. seekdb 简介</h2>
<p><strong>seekdb</strong> 是 OceanBase 专门为开发者打造的一款开箱即用、轻量级的数据库产品，专注于为 AI 应用提供高效的混合搜索能力，支持向量、全文及多模数据的统一存储与检索，是构建 AI 应用的新选择。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5db2ad4595541008f207eb1a6bade25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=nlpGMKvs34NjEGJ6JmgfdhJ0srI%3D" alt="" loading="lazy"/></p>
<p>seekdb 在继承了淘宝和支付宝背后的 OceanBase 数据库核心引擎高性能优势与 MySQL 全面兼容特性的基础上，通过深度优化数据搜索架构，为开发者提供了更符合 AI 应用数据处理需求的各项能力。</p>
<h3 data-id="heading-2">产品能力矩阵对比</h3>






























































































































<table><thead><tr><th align="left">特性</th><th align="center">seekdb</th><th align="center">OceanBase</th><th align="center">Chroma</th><th align="center">Milvus</th><th align="center">MySQL 9.0</th><th align="center">PostgreSQL + pgvector</th><th align="center">DuckDB</th><th align="center">Elasticsearch</th></tr></thead><tbody><tr><td align="left"><strong>嵌入式数据库</strong></td><td align="center">✅</td><td align="center">❌</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td></tr><tr><td align="left"><strong>单机数据库</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr><tr><td align="left"><strong>分布式数据库</strong></td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td></tr><tr><td align="left"><strong>MySQL 兼容</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td><td align="center">✅</td><td align="center">❌</td></tr><tr><td align="left"><strong>向量搜索</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr><tr><td align="left"><strong>全文检索</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">⚠️</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td></tr><tr><td align="left"><strong>混合搜索</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">⚠️</td><td align="center">❌</td><td align="center">✅</td></tr><tr><td align="left"><strong>OLTP</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td></tr><tr><td align="left"><strong>OLAP</strong></td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td><td align="center">❌</td><td align="center">❌</td><td align="center">✅</td><td align="center">✅</td><td align="center">⚠️</td></tr><tr><td align="left"><strong>开源协议</strong></td><td align="center">Apache 2.0</td><td align="center">MulanPubL 2.0</td><td align="center">Apache 2.0</td><td align="center">Apache 2.0</td><td align="center">GPL 2.0</td><td align="center">PostgreSQL License</td><td align="center">MIT</td><td align="center">AGPLv3+ SSPLv1+ Elastic 2.0</td></tr></tbody></table>
<blockquote>
<p>MySQL 8.0 移除了嵌入式能力</p>
</blockquote>
<h3 data-id="heading-3">seekdb 的适用场景</h3>
<ul>
<li><strong>RAG 应用</strong>：面向以智能聊天机器人、知识库、领域专家系统为代表的 RAG 场景，seekdb 支持了完整的 RAG Pipeline 解决方案。内置文档解析处理功能，集成向量嵌入（Embedding）、重排序（Rerank）及大语言模型（LLM），支持向量/全文/标量混合搜索，在一个数据库实例内实现 <strong>Doc In Data Out</strong>。</li>
<li><strong>AI 辅助编程</strong>：面向 AI 辅助编程场景，seekdb 支持对代码仓库构建向量和全文索引，基于代码关键词或代码语义，进行高效的代码搜索和生成补全。</li>
<li><strong>AI Agent 平台类应用</strong>：面向 AI Agent 开发场景，seekdb 提供了快速启动和嵌入式部署能力，支持被快速拉起提供服务。提供高频增删改和实时查询能力，避免数据库性能瓶颈引起 AI 开发效率降低的问题。提供向量搜索、全文搜索及混合搜索特性和灵活的元数据管理能力，结合会话管理与记忆存储能力，无需再引入其他库就可快速构建 AI Agent。提供 MCP Server 组件，无缝接入 AI 生态。</li>
<li><strong>语义搜索引擎</strong>：面向以电商商品搜索和推荐、多媒体内容检索、图片搜索等语义搜索场景，seekdb 支持对接主流向量嵌入模型并提供了向量搜索能力。同时提供了 Hybrid Index 功能，支持基于文本查询条件进行语义搜索，对用户屏蔽向量嵌入和查询结果 Rerank 的复杂流程。</li>
<li><strong>MySQL 应用现代化和 AI 化升级</strong>：seekdb 继承了 OceanBase 单机存储引擎、执行引擎、事务引擎、高级查询优化器的完整能力，高度兼容 MySQL，并在此基础上扩展 AI 能力。小规格可用于物联网边缘设备数据采集、小型应用开发和实验教学等场景，中大规格可用于各行业 OLTP、HTAP 或 AI 业务场景。</li>
</ul>
<h3 data-id="heading-4">seekdb 的产品架构</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c0aecd44d5646d8aee38fa0fc4eae7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=x3GUudtrz0ITBIxXTkA0BEfA0rM%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>部署模式</strong>：支持 Client/Server 和嵌入式两种部署模式。嵌入式模式下可将 seekdb 直接集成进 Python 应用，便于进行个人开发。</li>
<li><strong>具有 ACID 事务语义的存储层</strong>：基于 LSM-Tree 架构的行存列存一体化存储引擎，自研高效的编码压缩机制降低存储成本。支持数据高频实时写入，和面向不同负载的高性能查询。</li>
<li><strong>多模数据与索引层</strong>：支持基础类型，向量、大文本、JSON 、GIS、Array 等多模数据类型，并提供高效的索引支持。包括 HNSW / IVF 向量索引及索引量化算法，覆盖多种分词器和查询模式的基于 BM25 相关性计算算法的全文索引，适用于语义搜索的混合索引，及 JSON 多值索引、主键和二级索引、GIS 索引等。</li>
<li><strong>支持混合负载的多模计算层</strong>：支持向量、全文、标量等条件的混合搜索。提供 AI Function 能力，实现库内实时推理。支持完整的 ACID 事务特性及基于 MVCC 的多版本并发访问能力，提供高级查询优化器和具备向量化执行能力的高效执行引擎。</li>
<li><strong>统一应用接口</strong>：兼容 MySQL 原生驱动，提供基于 SQL 的支持多模数据的统一查询语言。并在此基础上提供了面向开发者更加友好的向量库/混搜 SDK。适配 LangChain、LlamaIndex、Dify 等 AI 应用开发框架。提供 MCP Server，无缝接入 AI 生态。</li>
</ul>
<h3 data-id="heading-5">seekdb 的核心特性</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fd01ba9f0714c84b779540f26a20538~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=LVVDo6VRxeKlIZnBSz%2BRBsVOzIk%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>开箱即用，极速开发，易学易用</strong>：单点架构设计，无其他组件依赖。支持 yum、docker、windows/macos 桌面版部署以及原生 Python 嵌入式集成。</li>
<li><strong>支持 1C2G 小规格，垂直弹性扩缩容</strong>：服务端 1 核 CPU + 2GB 内存即可跑 VectorDBBench Performance1536D50K。</li>
<li><strong>高性能向量索引、全文索引，支持向量、全文、标量混合搜索</strong>
<ul>
<li><strong>向量搜索</strong>：支持高达 16,000 维向量存储，兼容 L2、内积、余弦相似度。</li>
<li><strong>全文搜索</strong>：基于 BM25 算法，提供 Space、Beng、Ngram、IK、Jieba 等多种分词器。</li>
<li><strong>混合搜索</strong>：一条 SQL 完成多路查询与重排序。</li>
</ul>
</li>
<li><strong>混搜场景升级，基于 Hybrid Index 指定文本也可进行语义搜索</strong>：只需写入文本数据，系统自动进行 Embedding 并生成向量索引，查询时仅需指定文本搜索条件。</li>
<li><strong>无缝对接各类模型，内置 AI Function 实现库内实时推理</strong>：通过 <code>DBMS_AI_SERVICE</code> 系统包实现模型注册和管理。内置 <code>AI_COMPLETE</code>、<code>AI_PROMPT</code>、<code>AI_EMBED</code>、<code>AI_RERANK</code> 等函数。</li>
<li><strong>基于 JSON 的动态 Schema</strong>：支持 JSON 数据类型及动态 Schema，提供 JSON 函数索引、多值索引。</li>
<li><strong>数据实时写入，实时可查</strong>：基于 LSM-Tree，数据入库成功立即可查，同步构建各类索引。</li>
<li><strong>兼容 MySQL 不止于 MySQL，支撑 HTAP 混合负载</strong>：深度兼容 MySQL 语法协议，一个实例同时支持联机交易和实时分析。</li>
</ol>
<h2 data-id="heading-6">0x11. 快速部署 seekdb 体验环境</h2>
<blockquote>
<p>服务器配置要求详见官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oceanbase.ai%2Fdocs%2Fzh-CN%2Fdeploy-seekdb-testing-environment" target="_blank" title="https://www.oceanbase.ai/docs/zh-CN/deploy-seekdb-testing-environment" ref="nofollow noopener noreferrer">deploy-seekdb-testing-environment</a></p>
</blockquote>
<h3 data-id="heading-7">1. 使用 yum install 快速部署</h3>
<p><strong>添加 seekdb 镜像源：</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo
</code></pre>
<p><strong>安装 seekdb 和 obclient 客户端：</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo yum install seekdb obclient
</code></pre>
<p>如果在启动前需要更改配置，可以直接修改 <code>/etc/oceanbase/seekdb.cnf</code>，配置项很少可按需修改。</p>
<p><strong>建议 <code>cpu_count</code> 和 <code>memory_limit</code> 最好大于 1C2G，亲测 1C1G 也 No Problem。</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 示例配置</span>
<span class="hljs-attr">port</span>=<span class="hljs-number">1234</span>
<span class="hljs-attr">base-dir</span>=/var/lib/oceanbase
<span class="hljs-attr">data-dir</span>=/var/lib/oceanbase/store
<span class="hljs-attr">redo-dir</span>=/var/lib/oceanbase/store/redo
<span class="hljs-attr">datafile_size</span>=<span class="hljs-number">2</span>G
<span class="hljs-attr">datafile_next</span>=<span class="hljs-number">2</span>G
<span class="hljs-attr">datafile_maxsize</span>=<span class="hljs-number">50</span>G
<span class="hljs-attr">cpu_count</span>=<span class="hljs-number">4</span>
<span class="hljs-attr">memory_limit</span>=<span class="hljs-number">2</span>G
<span class="hljs-attr">log_disk_size</span>=<span class="hljs-number">2</span>G
</code></pre>
<p><strong>启动与管理 seekdb：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动 seekdb</span>
sudo systemctl start seekdb

<span class="hljs-comment"># 查看启动状态 (显示 Service is ready 即成功)</span>
sudo systemctl status seekdb

<span class="hljs-comment"># 连接 seekdb</span>
obclient -h127.0.0.1 -uroot -P1234 -A oceanbase

<span class="hljs-comment"># 停止服务</span>
sudo systemctl stop seekdb

<span class="hljs-comment"># 开机启动</span>
sudo systemctl <span class="hljs-built_in">enable</span> seekdb
</code></pre>
<h3 data-id="heading-8">2. 嵌入式安装</h3>
<p>seekdb 提供了嵌入式部署方式，可以作为一个“库”运行在你的应用程序内部。</p>
<p><strong>Python 示例</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> seekdb

<span class="hljs-comment"># Open a database</span>
seekdb.<span class="hljs-built_in">open</span>()

<span class="hljs-comment"># Connect to a database</span>
conn = seekdb.connect()

<span class="hljs-comment"># Use the connection</span>
cursor = conn.cursor()
cursor.execute(<span class="hljs-string">"select version();"</span>)
results = cursor.fetchall()
<span class="hljs-built_in">print</span>(results)

<span class="hljs-comment"># Close the connection</span>
conn.close()
</code></pre>
<p><strong>运行结果</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ python3 sample.py
[(<span class="hljs-string">'1.2.34-OceanBase NewProduct-v5.6.7.8'</span>,)]
</code></pre>
<h3 data-id="heading-9">3. 其他部署方式</h3>
<p>除此之外，OB 官方还提供了 seekdb 的 Docker 镜像和桌面版管理工具，篇幅有限这里就不展开介绍了，感兴趣的同学可以移步文档查看（oceanbase.ai/docs）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d85b5dd0eb994f4c809fa11de6b8d15d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=n4lTC1Ft929%2BUSddEHzXLziw%2FMc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">0xFF. 写在最后</h2>
<p>回想去年，我第一次用 OceanBase 数据库做 RAG 应用，当时用 16GB 内存的 MacBook Pro 启动 OB 竟然还会因为内存不够而失败☹️，那时候的 OB 强大却略显“高冷”。</p>
<p>而 seekdb 的出现，让我有一种“士别三日当刮目相看”的感觉。OceanBase 从昔日“高不可攀”的金融级数据库，到如今“触手可及”的 seekdb，OceanBase 团队这次真正看懂了开发者在 AI 时代对数据库期望的样子：无痛的上手体验，不吃资源、配置简单、开箱即用，却依然强大可靠。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f28ced87a97448884d366a67c63a2fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGVsbG9HaXRIdWI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764634795&amp;x-signature=BM9NWjZsJcEfZkpIo0Qd%2BNx9O48%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>GitHub 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foceanbase%2Fseekdb" target="_blank" title="https://github.com/oceanbase/seekdb" ref="nofollow noopener noreferrer">github.com/oceanbase/s…</a></p>
</blockquote>
<p>现在的 seekdb 也许还不是“最终形态”，但它绝对是一个令人兴奋的起点，让我们一起见证这款“更懂 AI 的数据库”成长之路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Web前端们！我用三年亲身经历，说说从 uniapp 到 Flutter怎么转型的，这条路我爬过，坑我踩过]]></title>    <link>https://juejin.cn/post/7576378563575545871</link>    <guid>https://juejin.cn/post/7576378563575545871</guid>    <pubDate>2025-11-25T08:10:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576378563575545871" data-draft-id="7576208176007905332" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Web前端们！我用三年亲身经历，说说从 uniapp 到 Flutter怎么转型的，这条路我爬过，坑我踩过"/> <meta itemprop="keywords" content="前端,Flutter,uni-app"/> <meta itemprop="datePublished" content="2025-11-25T08:10:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小林的跨端开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/3320949647350765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Web前端们！我用三年亲身经历，说说从 uniapp 到 Flutter怎么转型的，这条路我爬过，坑我踩过
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3320949647350765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小林的跨端开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T08:10:26.000Z" title="Tue Nov 25 2025 08:10:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    118
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>大家好，我是【小林】</p>
<p>说来有点意思，我的后台私信，最近有点热闹热闹，点开一看，翻来覆去都是同一个问题：</p>
<p><strong>“哥们，我一Web前端，能转 RN/Flutter 吗？好转吗？水深不？”</strong></p>
<p>问的人多了，我一个个回实在有点累。而且我发现，这已经不是一个简单的“能不能”的问题，背后是 Web 开发者对未知移动端领域的一系列困惑、焦虑和好奇。</p>
<p>所以，我决定干脆写一篇文章，把我从一个纯粹的 Web 前端，一步步“爬”到 Flutter 开发的经历和思考，掰开揉碎了分享给大家。我不讲某个 API 怎么用，也不贴大段的源码，咱就聊点大实话，聊聊这条路到底是怎么回事。</p>
<p>先自报家门，让大家知道我不是在“瞎忽悠”。</p>
<p>我，22年毕业就做了 Web 前端。第一份工作在上海一家小公司，上来就是硬仗，用 <code>uni-app</code> 从0到1搞换电小程序的微信和支付宝版。后来老板为了融资，说小程序体验不行，要做 App，于是我又临危受命，在 <code>uni-app</code>、<code>RN</code>、<code>Flutter</code> 三个技术里选型，最后硬着头皮上了 <code>Flutter</code>，那时候可没现在这么多 AI 能帮你，全靠一行行手敲，愣是把 App 给干上线了。</p>
<p>后来跳槽到了北京一家上市公司，正式成为一名 Flutter 开发，做 AIGC 项目，就是大家玩的文生图、图生图那些。再后来，我又去了小米（外包），参与钱包里的 AI 记账模块，体验了一把大厂的混合开发模式。现在入职一家中厂，有专门的Flutter技术团队...</p>
<p>一路上，从 <code>uni-app</code> 的 WebView，到 Flutter 的自绘引擎，从一个人单打独斗，到和原生开发协同作战，也自己封装了几个插件发布到 pub.dev，算是混了个脸熟。</p>
<p>所以，关于“Web前端转跨平台”这个话题，我觉得我还是能聊几句的。</p>
<h2 data-id="heading-1">篇章一： 捋直概念，什么是跨平台到开发</h2>
<p>在很多 Web 同学眼里也包括曾经的我，移动端开发就俩物种：<strong>原生（Native）</strong>  和 <strong>跨平台（Cross-Platform）</strong> 。</p>
<h3 data-id="heading-2">原生开发和跨平台开发的区别在哪？</h3>
<p>这个理解没错，但有点笼统。我们用个好懂的比喻来解释。</p>
<p><strong>原生开发（Native Development）</strong></p>
<blockquote>
<p>想象一下，你要在北京和上海各开一家本地特色菜馆。</p>
<p>你会在北京请一位精通京酱肉丝、烤鸭的北京本地厨师（<strong>Android 开发者</strong>），用本地的食材和灶具（<strong>Java/Kotlin + Android SDK</strong>）。</p>
<p>你会在上海请一位精通红烧肉、腌笃鲜的上海本地厨师（<strong>iOS 开发者</strong>），用上海的食材和灶具（<strong>Objective-C/Swift + iOS SDK</strong>）。</p>
<p><strong>优点</strong>：两家菜馆都做出了最地道、最原汁原味、上菜最快的本地菜（<strong>性能最好、体验最棒、最贴合系统特性</strong>）。<br/>
<strong>缺点</strong>：你得雇两个厨师，沟通两套菜单，管理两个厨房，成本直接翻倍（<strong>开发成本高、周期长、团队维护难</strong>）。</p>
</blockquote>
<p><strong>原生开发解决的核心职责是：榨干平台性能，提供极致的用户体验。</strong>  任何与系统底层深度交互的功能，比如定制化的系统级服务、复杂的蓝牙/NFC通信、高性能的图形处理，原生都是当之无愧的王者。在我做AIGC项目时，那两个安卓和iOS的同事，他们不直接参与业务开发，但他们负责打包、负责把算法团队给的 C++ SDK 集成到原生工程里，再暴露接口给我们 Flutter 调用。这就是原生的“特区”，跨平台技术轻易不敢涉足。</p>
<p><strong>跨平台开发（Cross-Platform Development）</strong></p>
<blockquote>
<p>现在，你觉得两家店成本太高，决定开一家融合菜馆。</p>
<p>你请来一位天才大厨（<strong>跨平台框架</strong>），他带来了一套自己独门的万能厨具和标准化的烹饪流程（<strong>一套代码</strong>）。</p>
<p>他用这套流程，既能做出八九不离十的京酱肉丝，也能做出味道不错的红烧肉，而且两道菜可以同时开火，效率极高（<strong>一套代码，多端运行，降本增效</strong>）。</p>
<p><strong>优点</strong>：你只需要管理一个厨师和一个厨房，成本大大降低，上新菜也快（<strong>开发成本低、效率高、UI一致性好</strong>）。<br/>
<strong>缺点</strong>：虽然菜好吃，但终究不是本地老师傅做的，口感上可能差那么点“地道”的感觉（<strong>性能和体验通常有损耗</strong>），而且如果遇到特别刁钻的本地食材（<strong>特定系统API</strong>），这位大厨也得去请教本地厨师怎么处理（<strong>需要原生辅助</strong>）。</p>
</blockquote>
<p><strong>跨平台解决的核心职责是：在保证体验基本盘的情况下，最大化地复用代码，降低成本，提升效率。</strong>  它是商业和技术权衡下的产物，尤其适合那些业务逻辑复杂、UI多样的应用。</p>
<h3 data-id="heading-3">移动端开发需要的思维模式</h3>
<p>在聊技术之前，我们先聊点更重要的东西：<strong>思维模式</strong>。从 Web 转移动端，最大的坎不是学 Dart 或 React，而是你大脑里根深蒂固的“浏览器思维”。</p>
<ul>
<li><strong>从“无状态”的网页到“有状态”的应用</strong><br/>
Web 的世界，本质是请求-响应。用户点一下，页面刷一下，大部分时候我们不关心用户上一步干了啥。而 App 是一个<strong>活物</strong>，它有生命周期：从后台被唤醒、被一个电话打断、被系统因为内存不足而杀死……你写的每一行代码，都得像个操心的老妈子，考虑这个“活物”在各种状态下的表现。这是一种从“面向文档”到“面向状态”的根本转变。</li>
<li><strong>从“温室”的浏览器到“严酷”的移动环境</strong><br/>
在 Web 端，我们是温室里的花朵，背后有强大的服务器和稳定的网络。但在移动端，你的 App 是在一个资源极其有限、环境极其恶劣的“荒野”求生。<strong>性能</strong>不再是锦上添花，而是生死线。我做 AIGC 项目时，一张图的生成过程，如果导致 UI 掉帧，用户会立刻感觉到卡顿；如果内存控制不好，低端机直接闪退。电量、内存、网络抖动、CPU 占用……这些过去我们不太关心的指标，现在成了悬在头上的达摩克利斯之剑。</li>
<li><strong>从“文档流”的布局到“约束”的布局</strong><br/>
Web 布局是“顺流而下”，我们用 Flex、Grid 改变水流方向。而移动端布局是“戴着镣铐跳舞”，每个组件都被父级死死地“约束”在一个矩形内。你必须学会从“我想把它放哪”转变为“我该如何约束它，让它在我想要的位置”。</li>
</ul>
<p>好了，心态摆正了，我们再来看技术，你会发现很多设计的“所以然”。</p>
<h2 data-id="heading-4">篇章二：直击底层：三大跨平台框架的架构原理剖析</h2>
<h3 data-id="heading-5"> uni-app: WebView 容器的集大成者</h3>
<ul>
<li>
<p><strong>核心架构：WebView + JSBridge</strong><br/>
<code>uni-app</code> 在构建 App 时的核心思想，是将你的 Vue.js 应用运行在一个原生的“容器”之内，而这个容器的主要组件就是一个高性能的 <strong>WebView</strong>。WebView 本质上是一个嵌入在 App 内部的、被阉割和强化的浏览器内核（iOS 的 WKWebView，Android 的 WebView）。你的所有页面和组件，实际上都是在渲染一个本地的 HTML、CSS 和 JavaScript 文件。</p>
</li>
<li>
<p><strong>UI 渲染机制</strong><br/>
UI 的渲染工作完全由 WebView 的渲染引擎负责。这意味着，你写的 <code>&lt;view&gt;</code> 标签最终会被渲染成 <code>&lt;div&gt;</code>，动画效果依赖于 CSS Transitions/Animations，布局遵循标准的 Web 文档流和 Flexbox 模型。这对于 Web 开发者是零成本上手，但同时也意味着，<strong>UI 的性能上限被 WebView 本身牢牢锁死</strong>。</p>
</li>
<li>
<p><strong>逻辑与原生通信：JSBridge</strong><br/>
当你的 Web 页面（JS 代码）需要调用原生的能力时，比如扫码、获取地理位置，就需要通过 <strong>JSBridge</strong> 这个“信使”来完成。其工作流程通常是：</p>
<ol>
<li><strong>JavaScript 调用</strong>：你在 JS 中调用 <code>uni.scanCode()</code>。</li>
<li><strong>数据序列化</strong>：JSBridge 将这个调用和参数打包成一个特定格式的字符串（通常是 JSON）。</li>
<li><strong>消息传递</strong>：通过 WebView 提供给原生环境的接口，将这个字符串消息发送给原生代码。</li>
<li><strong>原生执行</strong>：原生代码接收并解析消息，执行真正的扫码操作。</li>
<li><strong>结果返回</strong>：原生将结果再次序列化，通过回调机制传回给 WebView 中的 JavaScript。</li>
</ol>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 在 uni-app 页面里</span>
uni.<span class="hljs-title function_">scanCode</span>({
  <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'条码内容：'</span> + res.<span class="hljs-property">result</span>);
  }
});
<span class="hljs-comment">// uni.scanCode 这个JS API，底层就是通过 JSBridge</span>
<span class="hljs-comment">// 去调用了原生安卓或iOS的扫码功能</span>
</code></pre>
<p>这个过程是<strong>异步</strong>的，并且涉及多次<strong>数据序列化/反序列化</strong>和<strong>线程上下文切换</strong>（JavaScript 线程 ↔ 原生 UI 线程）。对于低频调用，这没有问题；但对于高频交互（如自定义手势、实时通信），JSBridge 就会成为明显的性能瓶颈。</p>
<ul>
<li><strong>架构总结</strong><br/>
<code>uni-app</code> 的架构是一种极致的实用主义。它用 Web 开发者最熟悉的技术栈，以最低的成本实现了跨端。但其代价是性能和体验的天花板较低，永远无法摆脱“网页感”，因为它本质上就是一个高度优化的本地网站。</li>
</ul>
<h3 data-id="heading-6">React Native: 迈向“无桥接”新时代的原生 UI 映射</h3>
<ul>
<li>
<p><strong>核心架构：JavaScript 线程 + 原生 UI 线程</strong><br/>
RN 的设计哲学与 WebView 完全不同。它并没有把你的代码跑在浏览器里，而是启动了一个独立的 <strong>JavaScript 线程</strong>（通常使用为移动端优化的 <strong>Hermes</strong> 引擎）来执行你的 React 代码（业务逻辑）。当你的组件树发生变化时，RN 会计算出最小化的 UI 更新操作，然后通过一套通信机制，告知<strong>原生 UI 线程</strong>去创建、更新或删除对应的<strong>原生 UI 组件</strong>。</p>
</li>
<li>
<p><strong>UI 渲染机制</strong><br/>
你写的 <code>&lt;View&gt;</code> 组件，最终会由 RN 转化为 iOS 上的 <code>UIView</code> 或 Android 上的 <code>android.view.View</code>。<strong>渲染工作是100%由原生系统完成的</strong>。这使得 RN 应用在外观和基础交互上能够达到与原生应用几乎无异的水平。</p>
</li>
<li>
<p><strong>逻辑与原生通信（划重点：架构的演进）</strong><br/>
RN 的通信机制是其性能演进的关键，经历了两个时代：</p>
<ul>
<li>
<p><strong>旧架构 (Bridge)</strong> ：这是 RN 早期的通信核心。它是一个<strong>异步的、可批处理的桥</strong>。JS 线程和原生线程通过这个桥来回传递序列化后的 JSON 消息。这个设计的瓶颈在于：1) <strong>异步</strong>：JS 无法同步调用原生方法并立即获得结果。2) <strong>序列化开销</strong>：对于大量或频繁的数据交换（如列表滚动时的事件数据），JSON 转换的开销很大。这导致了在复杂场景下，UI 响应可能会延迟。</p>
</li>
<li>
<p><strong>新架构 (JSI - JavaScript Interface)</strong> ：这是 RN 的革命性升级。JSI 允许 JavaScript 直接持有一个对 C++ 对象的引用，并通过这个引用<strong>同步调用</strong>该对象的方法。这意味着：</p>
<ol>
<li><strong>告别 JSON 序列化</strong>：数据可以直接在内存中共享，无需低效的字符串转换。</li>
<li><strong>实现同步调用</strong>：JS 可以像调用本地函数一样调用原生功能，这对于需要即时反馈的复杂交互至关重要。<br/>
基于 JSI，RN 推出了新的渲染器 <strong>Fabric</strong> 和新的原生模块系统 <strong>TurboModules</strong>，共同构成了“无桥接”的新时代。</li>
</ol>
</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Text</span>, <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 你写的这个 &lt;View&gt; 和 &lt;Text&gt;</span>
  <span class="hljs-comment">// 最终并不会变成 HTML 标签</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Hello, Native World!<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Click Me"</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> console.log('Button pressed!')} /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
  );
}
<span class="hljs-comment">// React Native 会把这个组件树信息，通过 Bridge 发送给原生</span>
<span class="hljs-comment">// 原生那边收到后，就会去创建真正的 Android.View 和 Android.TextView</span>

</code></pre>
<ul>
<li>
<p><strong>痛点是什么？</strong></p>
<ul>
<li><strong>Bridge 性能瓶颈</strong>：当你的遥控器按得太快（比如频繁的动画、列表快速滚动），信号太多，电视机就可能反应不过来，导致卡顿。这是 RN 历史上一直被诟病的问题，虽然现在有了新的架构（JSI）在改进，但这个通信成本是客观存在的。</li>
<li><strong>“Write once, debug everywhere”</strong> ：因为 RN 只是“调用”原生组件，而两端原生组件的表现有时会有细微差异，所以经常会出现一个布局在 iOS 上好好的，在 Android 上就歪了的情况，需要写平台特定的代码来抹平差异。</li>
</ul>
</li>
<li>
<p><strong>架构总结</strong><br/>
RN 提供的是真正的原生 UI 体验。它的架构演进，本质上是在不断解决“如何让两个分离的世界（JS 与 Native）更高效、更同步地对话”这一核心问题。新架构极大地提升了其性能上限，使其在绝大多数场景下都表现出色。</p>
</li>
</ul>
<h3 data-id="heading-7">Flutter: AOT 编译与自绘引擎的性能猛兽</h3>
<ul>
<li>
<p><strong>核心架构：Dart AOT 编译 + C++ 渲染引擎 (Impeller/Skia)</strong><br/>
Flutter 的架构独树一帜，它完全独立于系统原生 UI 组件。其本质上更像一个游戏引擎，只不过它渲染的是 UI 元素而非游戏角色。</p>
<ul>
<li><strong>代码执行</strong>：你的 Dart 代码在发布模式下，会被 <strong>AOT (Ahead-of-Time) 编译</strong>成平台相关的原生 ARM 机器码。这意味着运行时没有中间层（如 JS 虚拟机）的解释开销，代码执行效率极高，性能稳定可预测。</li>
<li><strong>UI 渲染</strong>：Flutter 接管了整个屏幕的渲染。它要求操作系统提供一块空白的画布（<code>Surface</code>），然后调用其自带的 C++ 渲染引擎，一个像素一个像素地将整个界面绘制出来。</li>
</ul>
</li>
<li>
<p><strong>UI 渲染机制（划重点：引擎的进化）</strong><br/>
Flutter 的渲染引擎是其性能的基石，也经历了一次重大演进：</p>
<ul>
<li><strong>Skia 引擎</strong>：这是 Google 开源的 2D 图形库，也是 Chrome 和 Android 的底层图形引擎。Skia 性能强大，但存在一个被称为“<strong>着色器编译卡顿 (Shader Compilation Jank)</strong> ”的问题。即当一个复杂的动画或效果首次出现时，Skia 需要在运行时动态编译其所需的着色器（Shader），这个编译过程可能导致零点几秒的掉帧，影响首次体验的流畅度。</li>
<li><strong>Impeller 引擎</strong>：为了根治此问题，Flutter 开发了新的渲染引擎 Impeller（目前在 iOS 上已默认启用）。Impeller 的核心优势在于，它会在 App 构建时<strong>预编译所有可能用到的着色器</strong>。这样，在运行时就不再有编译开销，从根本上消除了“首次卡顿”现象，使得动画和过渡效果如黄油般丝滑。</li>
</ul>
</li>
<li>
<p><strong>逻辑与原生通信：Platform Channels</strong><br/>
当 Flutter 需要与平台原生服务（如蓝牙、电量、相机）交互时，它使用一种名为 <strong>Platform Channels</strong> 的机制。这是一种类似于 JSBridge 的异步消息传递系统，同样涉及数据序列化。但关键区别在于：<strong>Flutter 仅在需要调用原生服务时才使用它，而 UI 渲染完全不依赖它</strong>。相比之下，RN 的旧架构中，每一次 UI 更新都需要跨桥通信。</p>
</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Dart 代码</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-comment">// 这个 Container, Center, Text 都是 Flutter 自己画的</span>
    <span class="hljs-comment">// 和原生系统的 UI 组件库没有任何关系</span>
    <span class="hljs-keyword">return</span> Container(
      color: Colors.blue,
      child: Center(
        child: Text(
          <span class="hljs-string">'Hello, I drew this myself!'</span>,
          style: TextStyle(color: Colors.white),
        ),
      ),
    );
  }
}
</code></pre>
<ul>
<li><strong>总结</strong><br/>
Flutter 的架构选择了一条“大包大揽”的道路。通过 AOT 编译和自绘引擎，它在跨平台 UI 渲染的<strong>性能</strong>和<strong>一致性</strong>上达到了巅峰。这种架构确保了复杂的 UI 也能稳定运行在 60/120fps，代价是更大的初始包体和与原生 UI 生态的隔离。</li>
</ul>
<h2 data-id="heading-8">篇章三：巅峰对决：到底谁才是“流畅度之王”？</h2>
<p>聊了这么多底层，最终都要反映在用户指尖的感受上。我们来一场不客观、但很真实的“60/120 FPS 滚动与动画”流畅度对决。</p>
<ul>
<li>
<p>🥇 <strong>并列王者：原生 iOS / Flutter (Impeller 引擎)</strong></p>
<ul>
<li><strong>原生 iOS</strong>：亲儿子，不多解释。最小的系统开销，最直接的硬件访问。</li>
<li><strong>Flutter (Impeller)</strong> ：凭借 Impeller 引擎的“提前备战”策略和 Dart AOT 编译成原生机器码的“肌肉记忆”，Flutter 在 UI 渲染上几乎抹平了与原生的差距。它就像一个顶级的游戏引擎，目标就是稳定地“刷帧”，在 UI 密集型应用中，它的表现令人惊叹。</li>
</ul>
</li>
<li>
<p>🥈 <strong>白银骑士：原生 Android</strong></p>
<ul>
<li>性能同样顶级。但由于安卓机型碎片化和 JVM 偶尔的 GC (垃圾回收) 停顿，在某些低端设备或极端情况下，可能会出现人眼可感知的微小卡顿。但这依然是标杆级的存在。</li>
</ul>
</li>
<li>
<p>🥉 <strong>青铜贵族：React Native (新架构)</strong></p>
<ul>
<li>别误会，“青铜”只是相对于前面几个“怪物”而言。在新架构的加持下，RN 在绝大多数场景下已经非常流畅。但它的“原罪”在于，<strong>JS 线程依然是业务逻辑的中心</strong>。当你的 JS 线程忙于处理复杂计算或海量数据时，它传递给 UI 线程的“心灵感应”就可能延迟，导致动画掉帧。虽然有 “Worklets” 等技术在努力绕开这个问题，但这个架构性特点决定了它的理论上限略低于 Flutter。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-9">最终章：Web前端，你的路在何方？</h2>
<p>好了，故事讲完了，我们回到现实。</p>
<ul>
<li><strong>如果你想“降维打击”小程序，或快速将 Web 应用 App 化</strong>：<br/>
<code>uni-app</code> 是你的不二之选。用你最熟悉的 Vue，快速出活，成本最低。接受它的天花板，用它来解决 80% 的常规需求。</li>
<li><strong>如果你是 React 死忠，团队技术栈统一</strong>：<br/>
拥抱 <code>React Native</code> 的新架构。它能让你在移动端的世界里最大化地复用你的 React 知识。生态庞大，社区活跃，找解决方案也更容易。</li>
<li><strong>如果你追求极致的跨平台体验，不畏惧学习，想成为“全能艺术家”</strong> ：<br/>
<strong>我个人，毫无保留地推荐你，和我一样，跳进 <code>Flutter</code> 的“坑”里</strong>。它可能需要你付出一个周末去学习 Dart，但它回馈给你的是一个性能逼近原生、UI 表现力登峰造极、未来充满想象力的全新世界。从被 WebView 性能束缚，到用 Flutter 随心所欲地绘制 UI，这种从“工匠”到“艺术家”的蜕变，带来的成就感是无与伦比的。</li>
</ul>
<p><strong>技术的演进，永无止境。</strong>  RN 在努力填平“桥”的鸿沟，Flutter 在不断打磨自己的“画笔”。没有最好的技术，只有最适合你和你的业务场景的技术。</p>
<p>从一个 Web 前端出发，这条路或许陡峭，但沿途的风景，绝对值得你为之攀登。你收获的将不仅仅是写出 App 的能力，更是对图形学、操作系统、编译原理更深层次的洞察。</p>
<p>而这些，将让你无论将来回到 Web，还是继续在移动端深耕，都站得更高，看得更远。</p>
<h2 data-id="heading-10">往期文章回顾</h2>
<h4 data-id="heading-11">Flutter 图片编辑器</h4>
<ul>
<li><a href="https://juejin.cn/post/7571067260053585946" target="_blank" title="https://juejin.cn/post/7571067260053585946">掘金文章</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fflutter_monitor_sdk" target="_blank" title="https://pub.dev/packages/flutter_monitor_sdk" ref="nofollow noopener noreferrer">pubdev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Fflutter_monitor_sdk" target="_blank" title="https://github.com/xinqingaa/flutter_monitor_sdk" ref="nofollow noopener noreferrer">github</a></li>
</ul>
<h4 data-id="heading-12">Flutter 全链路监控 SDK</h4>
<ul>
<li><a href="https://juejin.cn/post/7564977973260173338" target="_blank" title="https://juejin.cn/post/7564977973260173338">掘金文章</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fflutter_img_editor" target="_blank" title="https://pub.dev/packages/flutter_img_editor" ref="nofollow noopener noreferrer">pubdev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Fflutter_img_editor" target="_blank" title="https://github.com/xinqingaa/flutter_img_editor" ref="nofollow noopener noreferrer">github</a></li>
</ul>
<h4 data-id="heading-13">Flutter 全场景弹框</h4>
<ul>
<li><a href="https://juejin.cn/post/7538324216594726950" target="_blank" title="https://juejin.cn/post/7538324216594726950">掘金文章</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Funified_popups" target="_blank" title="https://pub.dev/packages/unified_popups" ref="nofollow noopener noreferrer">pubdev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Funified_popups" target="_blank" title="https://github.com/xinqingaa/unified_popups" ref="nofollow noopener noreferrer">github</a></li>
</ul>
<h4 data-id="heading-14">Flutter日历组件</h4>
<ul>
<li><a href="https://juejin.cn/post/7531976064496123931" target="_blank" title="https://juejin.cn/post/7531976064496123931">掘金文章</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fomni_calendar_view" target="_blank" title="https://pub.dev/packages/omni_calendar_view" ref="nofollow noopener noreferrer">pubdev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Fomni_calendar_view" target="_blank" title="https://github.com/xinqingaa/omni_calendar_view" ref="nofollow noopener noreferrer">github</a></li>
</ul>
<h4 data-id="heading-15">日期选择器</h4>
<ul>
<li>
<p><a href="https://juejin.cn/post/7524159959480991753" target="_blank" title="https://juejin.cn/post/7524159959480991753">掘金文章</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fomni_date_picker" target="_blank" title="https://pub.dev/packages/omni_date_picker" ref="nofollow noopener noreferrer">pubdev</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Fomni_date_picker" target="_blank" title="https://github.com/xinqingaa/omni_date_picker" ref="nofollow noopener noreferrer">github</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[五分钟实战 Compose 展开/收起动画]]></title>    <link>https://juejin.cn/post/7576130918078251043</link>    <guid>https://juejin.cn/post/7576130918078251043</guid>    <pubDate>2025-11-25T00:56:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576130918078251043" data-draft-id="7573892650816077839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="五分钟实战 Compose 展开/收起动画"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-11-25T00:56:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            五分钟实战 Compose 展开/收起动画
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T00:56:34.000Z" title="Tue Nov 25 2025 00:56:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64b2a54f63f94ca7a3529032a1b7e8f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=bL%2BUaRKB%2BMIDFnmKPgGF8nenGDc%3D" alt="0.png" loading="lazy"/></p>
<p>假设你正在使用 Jetpack Compose 构建一个屏幕界面，并且希望实现某些内容的展开或收起效果 —— 比如常见问题解答部分、下拉面板或筛选菜单。</p>
<p>你可能会想：</p>
<p>我要如何实现平滑的过渡效果呢？</p>
<p>好消息是：Jetpack Compose 让这个需求变得相当容易实现。</p>
<p>该篇文章，让我为大家详细介绍处理展开/收起动画的所有实用方法 —— 每种方法都适用于不同的用例。</p>
<h2 data-id="heading-0">高度的平滑增长</h2>
<p>假设你有一个方块，当用户点击它时，下方会显示一些内容，而你希望整个过程能够自然展开，不出现跳动。</p>
<p>对于这种情况，Jetpack Compose 有一个非常实用的修饰符：<code>animateContentSize()</code>。</p>
<p>下面是一个简单的示例：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ExpandableBox</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> expanded <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    Column(modifier = Modifier
        .clickable { expanded = !expanded }
        .background(Color.DarkGray)
        .padding(<span class="hljs-number">16.</span>dp)
        .animateContentSize() <span class="hljs-comment">// 高度变化产生动画</span>
    ) {
        Text(<span class="hljs-string">"Q: What is Compose?"</span>, color = Color.White)
        <span class="hljs-keyword">if</span> (expanded) {
            Text(
                <span class="hljs-string">"A: It's a modern UI toolkit for Android that replaces XML."</span>, color = Color.LightGray, modifier = Modifier.padding(top = <span class="hljs-number">8.</span>dp)
            )
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e8abbf6e52f48849732afa0b3e768d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=jXMRnachA4o%2BMvAIOEMsoRKgLHk%3D" alt="11.gif" loading="lazy"/></p>
<p>只需要这一个修饰符——就这样，每当高度发生变化时，就能实现平滑过渡。</p>
<p>当然，它的工作原理实际上是这样的：</p>
<p>当你将 <code>animateContentSize</code> 应用到一个 <code>Composable</code> 上时，Compose 会监听该组件内容宽高的变化。如果内容尺寸发生变化（例如，因为内部文本变长、子元素增删等），它会自动在旧尺寸和新尺寸之间执行一个平滑的过渡动画。</p>
<h2 data-id="heading-1">淡入淡出与滑动</h2>
<p>如果你不只是想增加高度，还希望内容在可见时淡入、滑入或放大。</p>
<p>这就来到了 <code>AnimatedVisibility()</code> 的用武之地。</p>
<p>假设你有一个用于显示/隐藏面板的切换按钮。以下是如何巧妙地实现动画效果：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ToggleInfoPanel</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> show <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">true</span>) }
    
    Column(modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)) {
        Button(onClick = { show = !show }) {
            Text(<span class="hljs-keyword">if</span> (show) <span class="hljs-string">"Hide Info"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"Show Info"</span>)
        }
        AnimatedVisibility(
            visible = show, enter = fadeIn() + slideInVertically(), exit = fadeOut() + slideOutVertically()
        ) {
            Box(
                Modifier
                    .fillMaxWidth()
                    .background(Color.Magenta)
                    .padding(<span class="hljs-number">16.</span>dp)
            ) {
                Text(<span class="hljs-string">"This is a toggleable info section"</span>, color = Color.White)
            }
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47b901f4c52f41f4ae75b4bac16b8928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=Z4uYBkiHbGu2XDjbcrGRJM%2Bf%2FFU%3D" alt="2.gif" loading="lazy"/></p>
<p>在这里，你控制的是它如何出现或消失，而不仅仅是它是否显示。</p>
<p><code>AnimatedVisibility()</code> 包裹另一个 <code>Composable</code>，并根据其 <code>visible</code> 的值（<code>true</code>/<code>false</code>）来决定是否显示内部内容。当 <code>visible</code> 状态改变时，它会自动执行指定的进入动画或退出动画。</p>
<h2 data-id="heading-2">垂直展开/收起的滑动面板</h2>
<p>假设你正在构建一个筛选下拉菜单或手风琴式部分，并且希望它在展开时从顶部向下滑动打开，在收起时向上收缩回去。</p>
<p>你可以在 <code>AnimatedVisibility()</code> 中使用 <code>expandVertically()</code> 和 <code>shrinkVertically()</code>：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FilterDropdown</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> expanded <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    Column(modifier = Modifier.padding(<span class="hljs-number">16.</span>dp)) {

        Text(<span class="hljs-string">"Filters"</span>, modifier = Modifier
            .clickable { expanded = !expanded }
            .background(Color.Gray)
            .padding(<span class="hljs-number">12.</span>dp), color = Color.White)

        AnimatedVisibility(
            visible = expanded, enter = expandVertically(), exit = shrinkVertically()
        ) {
            Column(
                Modifier
                    .fillMaxWidth()
                    .background(Color.LightGray)
                    .padding(<span class="hljs-number">16.</span>dp)
            ) {
                Text(<span class="hljs-string">"Sort by Price"</span>)
                Text(<span class="hljs-string">"Sort by Rating"</span>)
                Text(<span class="hljs-string">"Sort by Availability"</span>)
            }
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa5d12b179b749daad88cd609a0b53dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=GYby4y4yqCPFI7NVixaAHXdmlNA%3D" alt="3.gif" loading="lazy"/></p>
<p>流畅的垂直滑动效果，非常适合可展开的面板。</p>
<h2 data-id="heading-3">多个元素的动画</h2>
<p>如果你想让高度、背景颜色和透明度在展开时同步进行动画处理，该怎么做呢？</p>
<p>轮到 <code>updateTransition()</code> 大显身手了。它的使用稍微复杂一些，但能让你完全掌控动画效果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FancyExpandBox</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> expanded <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    <span class="hljs-keyword">val</span> transition = updateTransition(targetState = expanded, label = <span class="hljs-string">"transition"</span>)
    <span class="hljs-keyword">val</span> txtSize <span class="hljs-keyword">by</span> transition.animateInt(label = <span class="hljs-string">"text"</span>) {
        <span class="hljs-keyword">if</span> (it) <span class="hljs-number">24</span> <span class="hljs-keyword">else</span> <span class="hljs-number">14</span>
    }
    <span class="hljs-keyword">val</span> height <span class="hljs-keyword">by</span> transition.animateDp(label = <span class="hljs-string">"height"</span>) {
        <span class="hljs-keyword">if</span> (it) <span class="hljs-number">200.</span>dp <span class="hljs-keyword">else</span> <span class="hljs-number">60.</span>dp
    }
    <span class="hljs-keyword">val</span> bgColor <span class="hljs-keyword">by</span> transition.animateColor(label = <span class="hljs-string">"color"</span>) {
        <span class="hljs-keyword">if</span> (it) Color.Blue <span class="hljs-keyword">else</span> Color.Gray
    }
    <span class="hljs-keyword">val</span> alpha <span class="hljs-keyword">by</span> transition.animateFloat(label = <span class="hljs-string">"alpha"</span>) {
        <span class="hljs-keyword">if</span> (it) <span class="hljs-number">1f</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.5f</span>
    }
    Box(
        modifier = Modifier
            .clickable { expanded = !expanded }
            .fillMaxWidth()
            .height(height)
            .background(bgColor.copy(alpha = alpha))
            .padding(<span class="hljs-number">16.</span>dp)
    ) {
        Text(<span class="hljs-string">"Tap to expand or collapse"</span>, color = Color.White, fontSize = txtSize.sp)
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47ab002bcdb04b9aa4d72fc3b6a09ff3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=0jUVQU9C1p9GBfW5FLF%2Fuc9V0yw%3D" alt="4.gif" loading="lazy"/></p>
<p><em>该方法需要添加 <code>androidx.compose.animation:animation-core</code> 依赖。</em></p>
<p>你可以在这里对任何属性进行动画处理 —— 边距、形状、文字大小 —— 它们都会一起过渡变化。</p>
<p><code>updateTransition</code> 是一个状态驱动的动画协调器。它通过观察一个关键状态的变化，自动管理一组相关视觉属性的动画，将它们从旧状态的目标值流畅地过渡到新状态的目标值，非常适合处理复杂的、多步骤的 UI 状态切换动画。</p>
<h2 data-id="heading-4">为布局权重做动画</h2>
<p>如果你有两个面板并排放置或垂直堆叠，并且希望一个面板变大而另一个面板变小 —— 那就对权重进行动画处理！</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">WeightAnimationDemo</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> expanded <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    <span class="hljs-keyword">val</span> weight <span class="hljs-keyword">by</span> animateFloatAsState(targetValue = <span class="hljs-keyword">if</span> (expanded) <span class="hljs-number">0.8f</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.3f</span>)
    Column(modifier = Modifier.height(<span class="hljs-number">200.</span>dp)) {
        Box(
            modifier = Modifier
                .weight(weight)
                .fillMaxWidth()
                .background(Color.Blue)
                .clickable { expanded = !expanded })
        Box(
            modifier = Modifier
                .weight(<span class="hljs-number">1f</span> - weight)
                .fillMaxWidth()
                .background(Color.DarkGray)
        )
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7de6907433c345b494afb5efa2a24d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764636993&amp;x-signature=VKU%2BRViYZTo%2FR2c3ssKTFGFc114%3D" alt="5.gif" loading="lazy"/></p>
<p>点击顶部框会平滑地调整两个部分的大小。</p>
<h2 data-id="heading-5">总结</h2>
<ul>
<li>如果你的视图只是大小发生增长或缩小 —— <code>animateContentSize()</code>。</li>
<li>如果你想要淡入、滑动或缩放动画 —— <code>AnimatedVisibility()</code>。</li>
<li>对于更高级的布局变化或组合效果 —— <code>updateTransition()</code>。</li>
<li>想要使用布局权重调整大小？ —— <code>animateFloatAsState()</code>。</li>
</ul>
<p>一旦你熟悉了这些工具，你会发现在 Compose 中构建大多数展开/收起的用户界面变得超级直观 —— 而且它们比使用 <code>XML</code> 时更加流畅，更加直观，更加方便。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面试官说: "你怎么把 Radio 组件玩出花的，教教我！ “]]></title>    <link>https://juejin.cn/post/7576158801972969518</link>    <guid>https://juejin.cn/post/7576158801972969518</guid>    <pubDate>2025-11-25T01:59:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576158801972969518" data-draft-id="7571758212473536563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面试官说: &quot;你怎么把 Radio 组件玩出花的，教教我！ “"/> <meta itemprop="keywords" content="前端,开源"/> <meta itemprop="datePublished" content="2025-11-25T01:59:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟祥_成都"/> <meta itemprop="url" content="https://juejin.cn/user/96412752684744"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面试官说: "你怎么把 Radio 组件玩出花的，教教我！ “
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/96412752684744/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟祥_成都
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-25T01:59:53.000Z" title="Tue Nov 25 2025 01:59:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>面试官问我 <code>radio</code> 组件知道怎么实现吗？我把我的组件库 <code>radio</code> 网页丢给它，我说我这个 <code>radio</code> 组件什么样式都支持，你看这是传统样式：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75c2ad19d3cb4428a13e7c8a0399aa21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764640792&amp;x-signature=ml%2BhD5AE6jLUQLfPnOhfj4l96Io%3D" alt="image.png" loading="lazy"/></p>
<p>你看，这是自定义样式，理论上什么样式都可以：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de85c9e8911649baab344ed9773f44f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764640792&amp;x-signature=iqFlFs2EvF0D0%2BMvItCLhOOOEfw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9bf5a0123034518b14bb1f05482abef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764640792&amp;x-signature=EBol8%2FM%2Bjpwly5V5FEZ%2BCVemlnY%3D" alt="image.png" loading="lazy"/></p>
<p>然后我嘿嘿一笑说："我的 <code>radio</code> 组件本质上不涉及任何样式，只负责岁月静好，使用者负责貌美如花！"</p>
<p>最后面试完毕，面试官很满意，并问这个怎么实现的，我就写一篇文章来说说吧！</p>
<p>这是上面组件的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.frontlight.tech%2Fradio%2Fexample%2Ftailwind-traditional-example" target="_blank" title="https://www.frontlight.tech/radio/example/tailwind-traditional-example" ref="nofollow noopener noreferrer">网站地址</a></p>
<p>更多组件库教程，欢迎在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui" target="_blank" title="https://github.com/lio-mengxiang/t-ui" ref="nofollow noopener noreferrer">github</a> 上给个 star，加群交流哦！</p>
<p>本文章及更多案例已经在官网上了，大家也可以去看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.frontlight.tech%2Fradio" target="_blank" title="https://www.frontlight.tech/radio" ref="nofollow noopener noreferrer">本文链接</a></p>
<h2 data-id="heading-1">可自定义的核心</h2>
<p>正常的 <code>radio</code> 组件主要是通过 <code>&lt;input&gt;</code> 标签属性 <code>type="radio"</code> 实现的，浏览器都会显示一个默认的样式</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6211bf2122614c088f5f3de73dbf1438~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764640792&amp;x-signature=429AOW6GsoGnPXBmS0u5kKNk0jM%3D" alt="image.png" loading="lazy"/></p>
<p>所以我们要自定义样式，就不能使用原生的 <code>radio</code>样式，那么问题来了，你是不是只要实现了 <code>radio</code> 内在的逻辑，其实也就是实现了 <code>radio</code> 组件，有人会问？内在的逻辑是什么呢？</p>
<ul>
<li>其一，选中态逻辑，就是多个元素，我们只要点击，就是选中态（checked）</li>
<li>其二，传入 <code>disabled</code> 参数，那么这个元素就不能点击（或者 <code>cursor</code>（也就是鼠标的状态）设置为 <code>not-allowed</code> 也就是不可选中）</li>
<li>其三，原生 <code>radio</code> 并不支持  <code>readyonly</code> 状态，但我们自定义组件应该实现，在表单中， <code>readyonly</code> 是一种很常见的业务需求。所以传入 <code>readyonly</code> 参数，那么这个元素就不能改变状态，只能看。</li>
<li>最后最最重要的逻辑是多个 <code>radio</code> 元素组合时，你只能选中其中一个，即单选的逻辑。</li>
</ul>
<p>所以我们只要实现了上述逻辑，那就是跟原生的单选就没有区别了。</p>
<p>但问题来了，能不能既保持 <code>radio</code> 组件的原本的逻辑，还能支持自定义呢？也就是用户如果还是希望使用原生 <code>radio</code> 我们支持，自定义也支持呢？这样的话，语义性完好的基础上还能自由拓展，简直完美！</p>
<p>答案是肯定的，我们的组件就是这样的。</p>
<p>在介绍核心逻辑之前，我们先说一个小技巧。</p>
<h2 data-id="heading-2">radio 组件基本结构</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6211bf2122614c088f5f3de73dbf1438~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764640792&amp;x-signature=429AOW6GsoGnPXBmS0u5kKNk0jM%3D" alt="image.png" loading="lazy"/></p>
<p>首先先介绍一一个小技巧，如上图，一般 <code>radio</code> 包含了一个圆圈表示是否选中，圆圈的右边是文字，正常来说，我们点击圆圈才能选中，可这些组件库如何实现的点击圆圈右边的文字也能选中圆圈呢？这就涉及到 <code>&lt;label&gt;</code> 标签了。</p>
<p>如上图是 <code>MDN</code> 中的方式:</p>
<pre><code class="hljs language-html" lang="html">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"huey"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"drone"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"huey"</span> <span class="hljs-attr">checked</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"huey"</span>&gt;</span>Huey<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li>首先需要在 <code>input</code> 上使用 <code>id</code> 属性</li>
<li>然后在 <code>label</code> 组件上使用 <code>for</code>属性，跟 <code>id</code> 的值一致即可实现点击 <code>label</code> 标签就能选中对应的 <code>radio</code></li>
</ul>
<p>但这种方式比较繁琐，我们的组件使用的另一种方式达到同样的效果，就是 <code>label</code> 将 <code>input</code> 标签包裹就好：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"huey"</span> /&gt;</span>
huey
<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
</code></pre>
<p>好了，接下来我们梳理一下状态的切换逻辑，这样我们实现起来就有一个蓝图：</p>
<ul>
<li>首先点击 <code>label</code> ，也就是绑定在  <code>label</code> 上的 <code>onClick</code> 事件</li>
<li>然后这个 <code>onClick</code> 事件会触发 <code>input</code>（radio） 上的 <code>onClick</code> 事件</li>
<li><code>input</code> 上的 <code>onClick</code> 事件会触发自身的 <code>onChange</code> 事件，也就是选中的value 值在 <code>onChange</code> 的时候可以设置为点击的 <code>input</code> 的值，
<ul>
<li>这里有些新同学可能不知道 <code>input</code> 这类表单元素，目的就是收集值，也就是可以传入 <code>value</code> 属性。</li>
</ul>
</li>
</ul>
<p>整体逻辑很清晰，也很简单，但其中的坑不少，我们把坑介绍完，基本上你就可以实现一个自己的 <code>radio</code> 组件了</p>
<h2 data-id="heading-3">核心逻辑梳理</h2>
<p>如上所述，我们第一步是给 <code>label</code> 标签绑定 <code>onClick</code> 事件。</p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-keyword">const</span> onLabelClick = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
    <span class="hljs-comment">// 只读或禁用时，阻止点击产生任何行为</span>
    <span class="hljs-keyword">if</span> (disabled || readonly) {
      e.<span class="hljs-title function_">preventDefault</span>();
      <span class="hljs-keyword">return</span>;
    }
    rest?.<span class="hljs-property">onClick</span>?.(e);
  };

</code></pre>
<p>需要注意</p>
<ul>
<li>当外界传入 <code>disabled</code> 或者 <code>readonly</code> 参数的时候，我们直接 <code>return</code></li>
<li>注意要使用 <code> e.preventDefault();</code> 来组织默认事件，默认事件就是点击 <code>label</code> 触发 <code>input</code> 的 <code>onClick</code> 事件，从而阻止<code>input</code> 上值被选中</li>
</ul>
<p>然后需要给 <code>input</code> 绑定 <code>onClick</code> 事件</p>
<pre><code class="hljs language-javascript" lang="javascript">onClick={<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
   <span class="hljs-comment">// 阻止 input 的点击事件冒泡，避免重复处理</span>
   e.<span class="hljs-title function_">stopPropagation</span>();
}}
</code></pre>
<p>这里需要注意的是</p>
<ul>
<li>调用 <code>e.stopPropagation();</code> 防止用户在直接点击 <code>input</code>（radio） 的时候，事件冒泡到 <code>label</code> 标签，从而多次触发 <code>label</code> 的 <code>onClick</code> 事件。</li>
</ul>
<p>最后，就是在 <code>input</code> 绑定 <code>onChange</code> 事件</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-keyword">const</span> [checked, setChecked] = <span class="hljs-title function_">useMergeValue</span>(<span class="hljs-literal">false</span>, {
    <span class="hljs-attr">value</span>: propsChecked,
    <span class="hljs-attr">defaultValue</span>: mergeProps.<span class="hljs-property">defaultChecked</span>,
  });
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onChange</span> = (<span class="hljs-params">e</span>) =&gt; {
    e.<span class="hljs-title function_">persist</span>();
    e.<span class="hljs-title function_">stopPropagation</span>();

    <span class="hljs-comment">// 禁用或只读都不改变状态，不触发外部 onChange</span>
    <span class="hljs-keyword">if</span> (disabled || readonly) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">group</span>) {
      context?.<span class="hljs-property">onChangeValue</span>?.(value, e);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!(<span class="hljs-string">'checked'</span> <span class="hljs-keyword">in</span> props) &amp;&amp; !checked) {
      <span class="hljs-title function_">setChecked</span>(<span class="hljs-literal">true</span>);
    }
    <span class="hljs-keyword">if</span> (!checked) {
      propsOnChange?.(<span class="hljs-literal">true</span>, e);
    }
  };
</code></pre>
<p>其中细节很多，我们简单说一下：</p>
<ul>
<li><code>e.persist();</code> 在 <code>react</code> 17 之前需要（现在都已经 19 版本，是可以删掉这行代码的），大概介绍下它的作用</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React 16 及之前版本的问题，在 setTimeout 中无法获得正常的事件对象的值</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">type</span>); <span class="hljs-comment">// 正常访问</span>
  
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">type</span>); <span class="hljs-comment">// null 或 undefined！</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">target</span>); <span class="hljs-comment">// null！</span>
  }, <span class="hljs-number">1000</span>);
};
</code></pre>
<ul>
<li><code>e.stopPropagation();</code> 阻止事件冒泡
<ul>
<li>如果 Radio 嵌套 Radio，点击里面的 Radio 就会让 <code>onChnage</code> 事件冒泡到外层去，这不是我们希望的，所以隔离一下</li>
</ul>
</li>
<li><code>if (disabled || readonly) return;</code> 检查是否是 disabled 或者 readonly 状态，这样的状态不能让它触发 <code>onChange</code> 事件</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (context.<span class="hljs-property">group</span>) {
  context?.<span class="hljs-property">onChangeValue</span>?.(value, e);
}
</code></pre>
<p>这个我们暂且不讲，是要配合 <code>Radio.Group</code> 组件使用，这个 context 是使用 <code>useContext</code> api 获取的 <code>Radio.Group</code> 透传的数据。也就是状态最终会被  <code>Radio.Group</code> 接管。</p>
<pre><code class="hljs language-javascript" lang="javascript">} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!(<span class="hljs-string">'checked'</span> <span class="hljs-keyword">in</span> props) &amp;&amp; !checked) {
  <span class="hljs-title function_">setChecked</span>(<span class="hljs-literal">true</span>);
}
</code></pre>
<ul>
<li>
<p>作用：独立使用时的状态管理</p>
</li>
<li>
<p><code>!('checked' in props)</code>：检查是否是<strong>非受控组件</strong>，这是识别是否是受控还是非受控组件的关键。</p>
<ul>
<li>没有传入 <code>checked</code> prop → 组件自己管理状态</li>
</ul>
</li>
</ul>
<p>这里非常非常细节，有人可能疑惑了，为什么要这么做，而不是用 <code>checked === undefined</code> 来判断，因为不传的值默认不是 <code>undefined</code> 吗？我们来解释一下</p>
<p>大家需要注意，假设你这样传入 <code>checked</code> 参数</p>
<pre><code class="hljs language-ini" lang="ini">&lt;Radio <span class="hljs-attr">checked</span>={undefiend} /&gt;
</code></pre>
<ul>
<li><code>'checked' in props</code> 得到的是 <code>true</code> 因为你还是传了 <code>undefined</code> 值</li>
</ul>
<p>只有这样</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Radio</span> /&gt;</span>
</code></pre>
<ul>
<li><code>'checked' in props</code> 得到的是 <code>false</code>, 也就是什么也没传，代表是非受控组件、</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!(<span class="hljs-string">'checked'</span> <span class="hljs-keyword">in</span> props) &amp;&amp; !checked) {
  <span class="hljs-title function_">setChecked</span>(<span class="hljs-literal">true</span>);
}
</code></pre>
<p>然后 <code> setChecked(true);</code> 这个很关键，有的人说，<code>!('checked' in props)</code> 不是代表非受控组件吗，非受控组件是组件自己控制值，怎么还有直接 <code>setCheck</code> 控制，这不是受控组件的控制的方式吗？</p>
<p>这里需要解释两点</p>
<ul>
<li>
<p>首先，很多组件库，一般都会用受控的形式来模拟非受控，为什么呢？因为我们要确确实实拿到 Radio 组件的 <code>checked</code>（选中） 还是 非 <code>checked</code> 状态，如果都交给原生，我们获取很不方便</p>
</li>
<li>
<p>其次 <code>useMergeValue</code> 是组件库很常用函数，它把受控和非受控组合起来，是个非常实用的函数，我们来介绍一下逻辑。相信你写组件库也一定会用到。</p>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-string">'use client'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { isUndefined } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils'</span>;
<span class="hljs-keyword">import</span> { usePrevious } <span class="hljs-keyword">from</span> <span class="hljs-string">'./use-previous'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> useMergeValue&lt;T&gt;(
  <span class="hljs-attr">defaultStateValue</span>: T,
  props?: {
    defaultValue?: T;
    value?: T;
  },
): [T, <span class="hljs-title class_">React</span>.<span class="hljs-property">Dispatch</span>&lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">SetStateAction</span>&lt;T&gt;&gt;, T] {
  <span class="hljs-keyword">const</span> { defaultValue, value } = props || {};
  <span class="hljs-keyword">const</span> firstRenderRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> prevPropsValue = <span class="hljs-title function_">usePrevious</span>(props?.<span class="hljs-property">value</span>);

  <span class="hljs-keyword">const</span> [stateValue, setStateValue] = useState&lt;T&gt;(
    !<span class="hljs-title function_">isUndefined</span>(value) ? value : !<span class="hljs-title function_">isUndefined</span>(defaultValue) ? defaultValue : defaultStateValue,
  );

  <span class="hljs-comment">// 受控转为非受控的时候，需要做转换处理</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (firstRenderRef.<span class="hljs-property">current</span>) {
      firstRenderRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span> &amp;&amp; prevPropsValue !== value) {
      <span class="hljs-title function_">setStateValue</span>(value);
    }
  }, [value]);

  <span class="hljs-keyword">const</span> mergedValue = <span class="hljs-title function_">isUndefined</span>(value) ? stateValue : value;

  <span class="hljs-keyword">return</span> [mergedValue, setStateValue, stateValue];
}
</code></pre>
<p>这里简单解释一下，其实就是你传了 <code>value</code> 我就认为你是受控组件，然后 <code>value</code> 就透传出去， <code>defaultValue</code> 或者组件库想默认给个默认值， 我会用这个值其初始化 <code>stateValue</code> 然后传出去。并且 <code>setStateValue</code> 方法能改变其值。</p>
<p><code>setStateValue</code> 其实在传入 <code>value</code> 的情况下，也没什么用，因为改变不了 <code>value</code> 的值。</p>
<h2 data-id="heading-4">如何将状态传递给子组件</h2>
<p>我们可以使用 <code>context</code> api，将最终的 <code>checked</code>, <code>disabled</code>, <code>readonly</code> 状态让子组件使用 <code>useContext</code> 来获取。</p>
<pre><code class="hljs language-javascript" lang="javascript">    &lt;<span class="hljs-title class_">RadioContext</span>.<span class="hljs-property">Provider</span> value={{ checked, disabled, readonly }}&gt;
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">label</span> {<span class="hljs-attr">...rest</span>} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onLabelClick}</span> <span class="hljs-attr">aria-disabled</span>=<span class="hljs-string">{!!disabled}</span> <span class="hljs-attr">aria-readonly</span>=<span class="hljs-string">{!!readonly}</span> <span class="hljs-attr">aria-checked</span>=<span class="hljs-string">{!!checked}</span>&gt;</span>
        {/* 为什么没有 readonly 状态， 标准里本来也没有 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span>&gt;</span>
        {children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RadioContext.Provider</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-5">如何保持语义性</h2>
<p>我们只需要将 <code>input</code> 组件依然接受之前我们的状态，就能保持原生 <code>radio</code> 组件的语义性，所以我们完善一下 <code>input</code> 组件,也就是把之前的状态传递过去即可：</p>
<pre><code class="hljs language-javascript" lang="javascript">    &lt;<span class="hljs-title class_">RadioContext</span>.<span class="hljs-property">Provider</span> value={{ checked, disabled, readonly }}&gt;
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">label</span> {<span class="hljs-attr">...rest</span>} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onLabelClick}</span> <span class="hljs-attr">aria-disabled</span>=<span class="hljs-string">{!!disabled}</span> <span class="hljs-attr">aria-readonly</span>=<span class="hljs-string">{!!readonly}</span> <span class="hljs-attr">aria-checked</span>=<span class="hljs-string">{!!checked}</span>&gt;</span>
        {/* 为什么没有 readonly 状态， 标准里本来也没有 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span>
          <span class="hljs-attr">disabled</span>=<span class="hljs-string">{!!disabled}</span>
          <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span>
          <span class="hljs-attr">checked</span>=<span class="hljs-string">{!!checked}</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{onChange}</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{(e)</span> =&gt;</span> {
            // 阻止 input 的点击事件冒泡，避免重复处理
            e.stopPropagation();
          }}
          aria-readonly={!!readonly}
        /&gt;
        {children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span>
    &lt;/<span class="hljs-title class_">RadioContext</span>.<span class="hljs-property">Provider</span>&gt;
</code></pre>
<h2 data-id="heading-6">Radio Group 逻辑</h2>
<p>这里简单介绍一下如何使用 <code>Radio Group</code> 组件包裹上面我们完成的 <code>Radio</code> 组件。
核心逻辑为, 使用同样是 <code>useContext</code> api，我们命名为 <code>RadioGroupContext</code> 来把当前选中的 <code>Radio</code> 标签的 <code>value</code> 传递即可 ：</p>
<pre><code class="hljs language-javascript" lang="javascript">    &lt;div role=<span class="hljs-string">"radiogroup"</span> {...rest}&gt;
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RadioGroupContext.Provider</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">onChangeValue</span>,
          <span class="hljs-attr">type</span>,
          <span class="hljs-attr">value</span>,
          <span class="hljs-attr">disabled</span>,
          <span class="hljs-attr">readonly</span>,
          <span class="hljs-attr">group:</span> <span class="hljs-attr">true</span>,
          <span class="hljs-attr">name</span>,
        }}
      &gt;</span>
        {children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">RadioGroupContext.Provider</span>&gt;</span></span>
    &lt;/div&gt;
</code></pre>
<h2 data-id="heading-7">小结</h2>
<p>文章把主要的核心逻辑梳理了一下，并没有过多解释每行代码。如果你想讨论关于如何实现自己组件库的的内容，欢迎加群一起讨论，组件还在不断拓展中，最终会对标大厂组件库。</p>
<p>其实对于一个前端来说，组件库算是囊括所有日常常见的前端技术了，无论是学习还是面试，都是绝佳的项目。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.frontlight.tech%2F" target="_blank" title="https://www.frontlight.tech/" ref="nofollow noopener noreferrer">目前的官网</a></li>
<li>感谢 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui" target="_blank" title="https://github.com/lio-mengxiang/t-ui" ref="nofollow noopener noreferrer">github 点赞</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3样式深度选择器：为什么我们需要:deep()？]]></title>    <link>https://juejin.cn/post/7576129509935546387</link>    <guid>https://juejin.cn/post/7576129509935546387</guid>    <pubDate>2025-11-24T23:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576129509935546387" data-draft-id="7576181242581647423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3样式深度选择器：为什么我们需要:deep()？"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-24T23:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3样式深度选择器：为什么我们需要:deep()？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T23:42:23.000Z" title="Mon Nov 24 2025 23:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    46
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是不是也遇到过这样的场景？在Vue 3项目里，想要修改子组件样式，结果发现不管怎么写CSS都不生效。明明代码看起来没问题，但样式就是无法穿透到子组件内部。</p>
<p>这种情况在前端开发中太常见了。特别是在使用第三方UI库的时候，想要微调某个组件的样式，却发现自己被CSS作用域限制得死死的。</p>
<p>本文将带你深入了解Vue 3中的样式深度选择器<code>:deep()</code>，从它诞生的背景到具体的使用方法，再到实际开发中的最佳实践。读完这篇文章，你将彻底掌握如何优雅地解决组件样式穿透问题，再也不用为修改子组件样式而头疼了。</p>
<h2 data-id="heading-0">为什么需要深度选择器？</h2>
<p>在理解<code>:deep()</code>之前，我们得先明白Vue组件样式的作用域问题。Vue单文件组件中的<code>&lt;style&gt;</code>标签默认是全局作用域的，这意味着你在一个组件里写的样式可能会影响到其他组件。</p>
<p>为了解决这个问题，Vue引入了<code>scoped</code>样式。当你在<code>&lt;style&gt;</code>标签上添加<code>scoped</code>属性时，Vue会自动为组件中的每个元素添加一个唯一的属性，然后通过属性选择器来确保样式只作用于当前组件。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"demo"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.demo</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* 这个样式无法影响到child-component内部的元素 */</span>
<span class="hljs-selector-class">.child-content</span> {
  <span class="hljs-attribute">color</span>: red; <span class="hljs-comment">/* 不会生效！ */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>但这样带来了新的问题：当我们确实需要修改子组件样式时，作用域样式就成了障碍。想象一下，你使用了某个UI库的按钮组件，但需要稍微调整它的内边距，这时候该怎么办？</p>
<p>这就是深度选择器诞生的原因。它提供了一种"穿透"组件样式作用域的方法，让我们能够在父组件中修改子组件的样式。</p>
<h2 data-id="heading-1">:deep()的前世今生</h2>
<p>在Vue 2时代，我们使用<code>&gt;&gt;&gt;</code>、<code>/deep/</code>或<code>::v-deep</code>来实现样式穿透。但这些语法存在一些问题：有的已经被CSS规范废弃，有的浏览器支持不一致，还有的写法比较冗长。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- Vue 2中的各种深度选择器写法 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 原生CSS的深度选择器，某些浏览器不支持 */</span>
<span class="hljs-selector-class">.parent</span> &gt;&gt;&gt; <span class="hljs-selector-class">.child</span> { <span class="hljs-attribute">color</span>: red; }

<span class="hljs-comment">/* Sass等预处理器中的写法 */</span>
<span class="hljs-selector-class">.parent</span> /deep/ <span class="hljs-selector-class">.child</span> { <span class="hljs-attribute">color</span>: red; }

<span class="hljs-comment">/* Vue特有的语法 */</span>
<span class="hljs-selector-class">.parent</span> ::v-deep .child { <span class="hljs-attribute">color</span>: red; }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>Vue 3团队在设计新的样式系统时，决定统一这个语法。他们选择了<code>:deep()</code>作为新的深度选择器，这既符合CSS规范的发展趋势，也提供了更好的开发体验。</p>
<p><code>:deep()</code>本质上是一个CSS伪类，它在编译时会被Vue的处理工具转换为适当的选择器，确保样式能够正确穿透到子组件。</p>
<h2 data-id="heading-2">:deep()的基本用法</h2>
<p>让我们通过几个实际的例子来看看<code>:deep()</code>怎么用。</p>
<p>最基本的用法就是在需要穿透到子组件的选择器前加上<code>:deep()</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child-comp"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* 使用:deep()穿透到子组件 */</span>
<span class="hljs-selector-class">.parent</span> :<span class="hljs-built_in">deep</span>(.child-comp) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f0f0f0</span>;
}

<span class="hljs-comment">/* 也可以这样写 */</span>
:<span class="hljs-built_in">deep</span>(.child-comp) {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
}
</span></code></pre>
<p>在实际项目中，我们经常需要修改第三方组件的样式。比如使用Element Plus的按钮组件：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-btn"</span>&gt;</span>
      自定义按钮
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.page</span> :<span class="hljs-built_in">deep</span>(.custom-btn) {
  <span class="hljs-comment">/* 修改Element Plus按钮的内边距 */</span>
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">24px</span>;
  
  <span class="hljs-comment">/* 修改边框半径 */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  
  <span class="hljs-comment">/* 修改背景颜色 */</span>
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#4f46e5</span>;
}

<span class="hljs-selector-class">.page</span> :<span class="hljs-built_in">deep</span>(.custom-btn:hover) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#4338ca</span>;
}
</span></code></pre>
<p>需要注意的是，<code>:deep()</code>应该用在选择器的开头，或者紧跟在父选择器之后。错误的使用方式会导致样式不生效：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 错误的写法 - :deep()不能放在最后 */</span>
<span class="hljs-selector-class">.parent</span> <span class="hljs-selector-class">.child</span> :<span class="hljs-built_in">deep</span>() {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-comment">/* 错误的写法 - 选择器结构不合理 */</span>
:<span class="hljs-built_in">deep</span>() .parent .child {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-comment">/* 正确的写法 */</span>
<span class="hljs-selector-class">.parent</span> :<span class="hljs-built_in">deep</span>(.child) {
  <span class="hljs-attribute">color</span>: red;
}

:<span class="hljs-built_in">deep</span>(.parent .child) {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-3">实际场景中的应用技巧</h2>
<p>在实际开发中，我们会遇到各种需要使用<code>:deep()</code>的场景。下面分享几个实用的技巧。</p>
<p><strong>场景一：修改UI组件库的默认样式</strong></p>
<p>假设我们在使用Naive UI的表格组件，需要调整表头的样式：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"data-table"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-data-table</span>
      <span class="hljs-attr">:columns</span>=<span class="hljs-string">"columns"</span>
      <span class="hljs-attr">:data</span>=<span class="hljs-string">"data"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-table"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.data-table</span> :<span class="hljs-built_in">deep</span>(.custom-table .n-table-thead) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8fafc</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
}

<span class="hljs-selector-class">.data-table</span> :<span class="hljs-built_in">deep</span>(.custom-table .n-table-th) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">16px</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}

<span class="hljs-selector-class">.data-table</span> :<span class="hljs-built_in">deep</span>(.custom-table .n-table-td) {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
}
</span></code></pre>
<p><strong>场景二：在插槽内容中应用样式</strong></p>
<p>当使用插槽时，插槽内容的样式也需要通过<code>:deep()</code>来穿透：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">modal-dialog</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>自定义标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">content</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这里是对话框内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">modal-dialog</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 修改对话框容器的样式 */</span>
:<span class="hljs-built_in">deep</span>(.modal-container) {
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">25px</span> -<span class="hljs-number">5px</span> <span class="hljs-built_in">rgb</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> / <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 修改插槽内容的样式 */</span>
:<span class="hljs-built_in">deep</span>(.dialog-title) {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1f2937</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
}

:<span class="hljs-built_in">deep</span>(.dialog-content) {
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
}
</span></code></pre>
<p><strong>场景三：配合CSS变量使用</strong></p>
<p><code>:deep()</code>还可以与CSS变量结合，实现更灵活的样式定制：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"theme-wrapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">third-party-component</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-theme"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.theme-wrapper</span> {
  <span class="hljs-comment">/* 定义CSS变量 */</span>
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#3b82f6</span>;
  <span class="hljs-attr">--secondary-color</span>: <span class="hljs-number">#ef4444</span>;
  <span class="hljs-attr">--border-radius</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.theme-wrapper</span> :<span class="hljs-built_in">deep</span>(.custom-theme) {
  <span class="hljs-comment">/* 在深度选择器中使用CSS变量 */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--primary-color);
  <span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">var</span>(--secondary-color);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-built_in">var</span>(--border-radius);
}

<span class="hljs-selector-class">.theme-wrapper</span> :<span class="hljs-built_in">deep</span>(.custom-theme .item) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--border-radius) - <span class="hljs-number">2px</span>);
}
</span></code></pre>
<h2 data-id="heading-4">性能与最佳实践</h2>
<p>虽然<code>:deep()</code>很强大，但滥用会导致样式难以维护和性能问题。下面是一些最佳实践建议：</p>
<p><strong>1. 尽量少用深度选择器</strong></p>
<p>深度选择器破坏了组件的样式封装，应该作为最后的手段。优先考虑通过props传递样式配置，或者使用CSS变量。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 不推荐的写法：过度使用:deep() --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
:<span class="hljs-built_in">deep</span>(.child-component) {
  <span class="hljs-comment">/* 各种样式覆盖 */</span>
}

:<span class="hljs-built_in">deep</span>(.child-component .title) {
  <span class="hljs-comment">/* 更多样式覆盖 */</span>
}

:<span class="hljs-built_in">deep</span>(.child-component .content) {
  <span class="hljs-comment">/* 继续覆盖 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 推荐的写法：通过CSS变量定制 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-child"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.custom-child</span> {
  <span class="hljs-attr">--child-primary-color</span>: <span class="hljs-number">#3b82f6</span>;
  <span class="hljs-attr">--child-padding</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attr">--child-border-radius</span>: <span class="hljs-number">8px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>2. 保持选择器的简洁性</strong></p>
<p>过于复杂的选择器会影响性能，特别是在大型应用中。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 不推荐：选择器过于复杂 */</span>
<span class="hljs-selector-class">.container</span> :<span class="hljs-built_in">deep</span>(.child &gt; .grandchild .item:first-of-type span.text) {
  <span class="hljs-attribute">color</span>: red;
}

<span class="hljs-comment">/* 推荐：尽量简化选择器 */</span>
<span class="hljs-selector-class">.container</span> :<span class="hljs-built_in">deep</span>(.text-highlight) {
  <span class="hljs-attribute">color</span>: red;
}
</span></code></pre>
<p><strong>3. 使用有意义的类名</strong></p>
<p>为需要深度样式的元素添加有意义的类名，提高代码可读性。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">third-party-component</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-styling"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 清晰的类名让代码更易理解 */</span>
<span class="hljs-selector-class">.custom-styling</span> :<span class="hljs-built_in">deep</span>(.tp-button--primary) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#10b981</span>;
}

<span class="hljs-selector-class">.custom-styling</span> :<span class="hljs-built_in">deep</span>(.tp-button--primary:hover) {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#059669</span>;
}
</span></code></pre>
<h2 data-id="heading-5">常见问题与解决方案</h2>
<p>在实际使用<code>:deep()</code>时，开发者经常会遇到一些问题。这里总结几个常见的情况：</p>
<p><strong>问题一：样式不生效</strong></p>
<p>这种情况通常是因为选择器写得不对，或者Vue版本不支持。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 可能的问题：Vue版本过低 */</span>
<span class="hljs-comment">/* 确保使用Vue 3.2+ 版本 */</span>

<span class="hljs-comment">/* 可能的问题：选择器结构错误 */</span>
<span class="hljs-selector-class">.parent</span> :<span class="hljs-built_in">deep</span>(.child .grandchild) {
  <span class="hljs-comment">/* 正确的结构 */</span>
}

<span class="hljs-comment">/* 可能的问题：缺少必要的类名 */</span>
<span class="hljs-comment">/* 检查子组件是否真的有这个类名 */</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>问题二：样式覆盖冲突</strong></p>
<p>当多个<code>:deep()</code>选择器 targeting 同一个元素时，可能会出现样式冲突。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 方案一：提高选择器特异性 */</span>
<span class="hljs-selector-class">.page-container</span> <span class="hljs-selector-class">.section</span> :<span class="hljs-built_in">deep</span>(.target-element) {
  <span class="hljs-attribute">color</span>: blue;
}

<span class="hljs-comment">/* 方案二：使用!important（谨慎使用） */</span>
<span class="hljs-selector-class">.page-container</span> :<span class="hljs-built_in">deep</span>(.target-element) {
  <span class="hljs-attribute">color</span>: blue <span class="hljs-meta">!important</span>;
}

<span class="hljs-comment">/* 方案三：调整样式顺序 */</span>
<span class="hljs-comment">/* 后面的样式会覆盖前面的 */</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>问题三：与预处理器冲突</strong></p>
<p>在使用Sass、Less等预处理器时，需要注意语法兼容性。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span>
.parent {
  padding: 20px;

  /* 在Sass中正常使用 */
  :deep(.child) {
    margin: 10px;
    
    .grandchild {
      color: red;
    }
  }
}

/* 或者使用插值语法 */
.parent :deep(#{$child-selector}) {
  background: white;
}
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">结合Composition API使用</h2>
<p>在Vue 3的Composition API中，我们还可以通过更编程式的方式来处理样式问题。</p>
<p>虽然不能直接通过Composition API修改子组件样式，但我们可以通过动态类名和样式的方式来配合<code>:deep()</code>使用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"containerClass"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">third-party-component</span> 
      <span class="hljs-attr">:class</span>=<span class="hljs-string">"componentClass"</span>
      <span class="hljs-attr">:style</span>=<span class="hljs-string">"componentStyle"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">variant</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'primary'</span>
  }
})

<span class="hljs-keyword">const</span> containerClass = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-string">'theme-container'</span>: <span class="hljs-literal">true</span>,
  [<span class="hljs-string">`theme-<span class="hljs-subst">${props.variant}</span>`</span>]: <span class="hljs-literal">true</span>
}))

<span class="hljs-keyword">const</span> componentClass = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-string">'custom-component'</span>: <span class="hljs-literal">true</span>,
  [<span class="hljs-string">`variant-<span class="hljs-subst">${props.variant}</span>`</span>]: <span class="hljs-literal">true</span>
}))

<span class="hljs-keyword">const</span> componentStyle = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-string">'--custom-primary'</span>: props.<span class="hljs-property">variant</span> === <span class="hljs-string">'primary'</span> ? <span class="hljs-string">'#3b82f6'</span> : <span class="hljs-string">'#ef4444'</span>
}))
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.theme-container</span> :<span class="hljs-built_in">deep</span>(.custom-component) {
  <span class="hljs-comment">/* 基础样式 */</span>
}

<span class="hljs-selector-class">.theme-container</span><span class="hljs-selector-class">.theme-primary</span> :<span class="hljs-built_in">deep</span>(.custom-component.variant-primary) {
  <span class="hljs-comment">/* 主要变体样式 */</span>
}

<span class="hljs-selector-class">.theme-container</span><span class="hljs-selector-class">.theme-danger</span> :<span class="hljs-built_in">deep</span>(.custom-component.variant-danger) {
  <span class="hljs-comment">/* 危险变体样式 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-7">总结</h2>
<p><code>:deep()</code>选择器是Vue 3样式系统中一个非常重要的特性，它为我们提供了一种标准化的方式来处理组件样式穿透的需求。从Vue 2的各种混乱语法到Vue 3的统一<code>:deep()</code>，这反映了Vue团队在改善开发者体验方面的持续努力。</p>
<p>回顾一下我们今天讨论的重点：<code>:deep()</code>解决了组件样式作用域带来的限制，让我们能够在父组件中修改子组件的样式。它的语法简洁明了，与现代CSS标准保持一致，而且与各种预处理器良好兼容。</p>
<p>但是，能力越大责任越大。我们应该谨慎使用<code>:deep()</code>，优先考虑通过组件接口(props、emits)和CSS变量来实现样式定制。只有当这些方法都无法满足需求时，才考虑使用<code>:deep()</code>。</p>
<p>在实际项目中，合理使用<code>:deep()</code>可以让我们的代码更整洁、更易维护。记住我们今天讨论的最佳实践：保持选择器简洁、使用有意义的类名、避免过度使用。</p>
<p>希望这篇文章能够帮助你更好地理解和使用Vue 3的<code>:deep()</code>选择器。现在，当你在项目中遇到需要修改子组件样式的情况时，你应该能够自信地选择最合适的解决方案了。</p>
<p>如果你在使用过程中遇到其他问题，或者有更好的使用技巧，欢迎在评论区分享你的经验。 Happy coding！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>