<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[é‡‘èè¡Œä¸šæ•°æ®åº“é€‰å‹ç›˜ç‚¹â€”â€”Kingbase PLSQLè¿ç§»æŒ‡å—]]></title>    <link>https://juejin.cn/post/7582890166357131290</link>    <guid>https://juejin.cn/post/7582890166357131290</guid>    <pubDate>2025-12-13T08:12:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582890166357131290" data-draft-id="7582815307440357427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é‡‘èè¡Œä¸šæ•°æ®åº“é€‰å‹ç›˜ç‚¹â€”â€”Kingbase PLSQLè¿ç§»æŒ‡å—"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-12-13T08:12:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºçš„çŸ³å¤´_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é‡‘èè¡Œä¸šæ•°æ®åº“é€‰å‹ç›˜ç‚¹â€”â€”Kingbase PLSQLè¿ç§»æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºçš„çŸ³å¤´_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T08:12:07.000Z" title="Sat Dec 13 2025 08:12:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æèµ·é‡‘èï¼Œç”µä¿¡ï¼Œèƒ½æºè¿™äº›å…³é”®è¡Œä¸šï¼ŒOracleä¾é å¼ºå¤§çš„PL/SQLç”Ÿæ€å’Œç¨³å®šæ€§ï¼Œç§°å…¶ä¸ºâ€œè€å¤§å“¥â€å®è‡³åå½’ï¼Œé•¿æ—¶é—´å æ®æ ¸å¿ƒåœ°ä½ï¼Œä½†æ˜¯ï¼Œâ€œä¿¡åˆ›â€æµªæ½®è¢­æ¥ï¼Œè€Œä¸”å¤§å®¶éƒ½æƒ³é™æœ¬å¢æ•ˆï¼Œæ‰€ä»¥ï¼Œâ€œå»Oâ€è¿™ä»¶äº‹å¯ä»¥è¯´æ˜¯åæ‹¿ä¹ç¨³ã€‚</p>
<p>ç„¶è€Œåˆ°äº†çœŸæ­£çš„é€‰å‹é˜¶æ®µï¼Œè®¸å¤š CIO å’Œ æ¶æ„å¸ˆå¯Ÿè§‰åˆ°ä¸€ä¸ªå¤§å‘ï¼š<strong>æ¬è¿æ•°æ®å¹¶ééš¾äº‹ï¼Œä½†ä¸šåŠ¡é€»è¾‘çš„è¿ç§»å´ä»¤äººå¤´ç–¼ä¸å·²</strong>ï¼Œé‚£äº›æ²‰å¯‚äº†æ•°åå¹´ï¼Œä»£ç é‡é«˜è¾¾æ•°ä¸‡è¡Œçš„å­˜å‚¨è¿‡ç¨‹ï¼ŒåŒ…ï¼ˆPackageï¼‰ï¼Œè§¦å‘å™¨ï¼Œè‹¥è¦é äººåŠ›é‡æ–°ç¼–å†™ï¼Œè´¢åŠ›å°†ä¼šå¿«é€Ÿè€—å°½ï¼Œè€Œä¸”é£é™©ä¹Ÿæ— æ³•æŒæ§ã€‚</p>
<p>è¿™ä¸€æœŸçš„ç›˜ç‚¹æ´»åŠ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢ç©¶å›½äº§æ•°æ®åº“ä¸­çš„â€œå­¦é™¢æ´¾â€å…¸å‹â€”â€”é‡‘ä»“æ•°æ®åº“KingbaseESï¼Œæ¢å¯»å…¶ä¸ºä½•ç§°è‡ªå·±å…·å¤‡â€œç¡¬æ ¸â€çš„Oracleå…¼å®¹èƒ½åŠ›ï¼Œåˆæ˜¯æ€æ ·è¢«é€‰ä¸ºé‡‘èçº§æ ¸å¿ƒç³»ç»Ÿæ›¿æ¢ä¹‹é€‰çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0f874bca97344c08e16ce48599a104d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=DXAO6x8CFh71ros41kI8oloLkQc%3D" alt="6afab92a91c68b0136e0917b049a9a1a.jpg" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ ä¸ºä»€ä¹ˆè¯´â€œå…¼å®¹æ€§â€æ˜¯é€‰å‹çš„ç”Ÿæ­»çº¿ï¼Ÿ</h2>
<p>åœ¨é‡‘èåœˆå­é‡Œï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘é‚£æ˜¯é«˜åº¦ä¾èµ– Oracle çš„â€œç‹¬é—¨ç»æŠ€â€çš„ã€‚é€‰å‹çš„æ—¶å€™ä½ è¦æ˜¯åªç›¯ç€â€œæ”¯æŒ SQL æ ‡å‡†â€çœ‹ï¼Œåé¢ç»å¯¹å‘å¾—ä½ æ€€ç–‘äººç”Ÿã€‚è¦æƒ³çœŸæ­£åšåˆ°â€œæ— ç¼è¿ç§»â€ï¼Œå¿…é¡»å¾—é—¯è¿‡è¿™ä¸‰é“å…³ï¼š</p>
<ol>
<li><strong>è¯­æ³•çº§å…¼å®¹</strong>ï¼šå…‰æ”¯æŒä¸ªæ ‡å‡† <code>SELECT</code> å“ªå¤Ÿå•Šï¼Ÿåƒ <code>CONNECT BY</code>ã€<code>DECODE</code>ã€<code>PIVOT</code> è¿™äº› Oracle çš„â€œæ–¹è¨€â€ï¼Œå¿…é¡»å¾—èƒ½ç›´æ¥è·‘ã€‚</li>
<li><strong>å¯¹è±¡çº§å…¼å®¹</strong>ï¼šå­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€åŒ…ã€åºåˆ—ã€åŒä¹‰è¯ã€è§†å›¾è¿™äº›ä¸œè¥¿ï¼Œèƒ½ä¸èƒ½ç›´æ¥å¯¼è¿›å»ï¼Ÿ</li>
<li><strong>è¡Œä¸ºçº§å…¼å®¹</strong>ï¼šç©ºä¸²åˆ°åº•æ˜¯ä¸æ˜¯ NULLï¼Ÿäº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ä¸æ˜¯ä¸€ä¸ªæ ·ï¼Ÿå¼‚å¸¸å¤„ç†æœºåˆ¶èƒ½ä¸èƒ½å¯¹å¾—ä¸Šï¼Ÿ</li>
</ol>
<p><strong>KingbaseESï¼ˆKESï¼‰</strong> æ¯•ç«Ÿæ˜¯æºè‡ªä¸­å›½äººæ°‘å¤§å­¦ï¼Œä½œä¸ºâ€œæ•°æ®åº“å›½å®¶é˜Ÿâ€ï¼Œå®ƒæ‰‹é‡Œæœ€å¤§çš„åº•ç‰Œä¹‹ä¸€ï¼Œå°±æ˜¯<strong>å†…æ ¸çº§çš„ Oracle å…¼å®¹å¼•æ“</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/911c95000d1a4a30a55998e29d750024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=MJOnfzjeIxZXI6jx8NgV99b8bfY%3D" alt="dd7f5fc10c7baf96d588767148905e4.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">äºŒã€ KingbaseES æ ¸å¿ƒæŠ€æœ¯ç›˜ç‚¹ï¼šç¡¬æ ¸ä»£ç å®æµ‹</h2>
<p>ä¸ºäº†éªŒè¯ KingbaseES æ˜¯ä¸æ˜¯çœŸçš„åƒå®ƒè¯´çš„é‚£ä¹ˆèƒ½æ‰“ï¼Œæˆ‘ä»¬ä¸“é—¨æŒ‘äº†å‡ ä¸ªé‡‘èåœºæ™¯é‡Œæœ€è®©äººå¤´ç–¼çš„è¿ç§»ç—›ç‚¹ï¼Œæ¥äº†ä¸€åœºå®æµ‹ã€‚</p>
<h3 data-id="heading-2">1. å±‚æ¬¡æŸ¥è¯¢ï¼ˆHierarchical Queryï¼‰</h3>
<p><strong>ç—›ç‚¹</strong>ï¼šé“¶è¡Œçš„æœºæ„æ ‘ã€è´¦æˆ·å±‚çº§ï¼Œé‚£éƒ½æ˜¯ Oracle <code>CONNECT BY</code> è¯­æ³•çš„é‡ç¾åŒºã€‚å¾ˆå¤šå›½äº§æ•°æ®åº“éƒ½è¦æ±‚æ”¹å†™æˆ <code>WITH RECURSIVE</code>ï¼ˆé€’å½’ CTEï¼‰ï¼Œè¿™è¦æ˜¯æ”¹èµ·æ¥ï¼Œä»£ç é‡å¤§å¾—å“äººã€‚</p>
<p><strong>KingbaseES è¡¨ç°</strong>ï¼š<strong>åŸç”Ÿå°±æ”¯æŒï¼Œä»£ç ä¸€ä¸ªå­—éƒ½ä¸ç”¨æ”¹ã€‚</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. å‡†å¤‡æµ‹è¯•æ•°æ®</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> branch_offices (
    org_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    org_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
    parent_org_id <span class="hljs-type">INT</span>
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'æ€»è¡Œ'</span>, <span class="hljs-keyword">NULL</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">101</span>, <span class="hljs-string">'åŒ—äº¬åˆ†è¡Œ'</span>, <span class="hljs-number">1</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">102</span>, <span class="hljs-string">'ä¸Šæµ·åˆ†è¡Œ'</span>, <span class="hljs-number">1</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10101</span>, <span class="hljs-string">'æµ·æ·€æ”¯è¡Œ'</span>, <span class="hljs-number">101</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10201</span>, <span class="hljs-string">'æµ¦ä¸œæ”¯è¡Œ'</span>, <span class="hljs-number">102</span>);
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 2. æ‰§è¡Œ Oracle å…¼å®¹çš„å±‚æ¬¡æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> 
    org_id, 
    org_name, 
    PRIOR org_name <span class="hljs-keyword">AS</span> parent_name, 
    LEVEL
<span class="hljs-keyword">FROM</span> branch_offices
<span class="hljs-keyword">START</span> <span class="hljs-keyword">WITH</span> parent_org_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
<span class="hljs-keyword">CONNECT</span> <span class="hljs-keyword">BY</span> PRIOR org_id <span class="hljs-operator">=</span> parent_org_id
<span class="hljs-keyword">ORDER</span> SIBLINGS <span class="hljs-keyword">BY</span> org_name;
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/947b8f8a96334785ba1ede0960c4e9d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=FRdFuOilTXuZZq6E%2FAk%2FNxL%2BZBI%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p><strong>ç‚¹è¯„</strong>ï¼šåœ¨ KingbaseES é‡Œï¼Œä¸Šé¢è¿™æ®µ SQL ç›´æ¥å°±èƒ½è·‘ï¼Œä¸éœ€è¦åšä»»ä½•è½¬æ¢ã€‚è¿™å¯¹äºé‚£äº›æœ‰ç€å¤æ‚å±‚çº§å…³ç³»çš„é‡‘èç³»ç»Ÿæ¥è¯´ï¼Œç®€ç›´æ˜¯æ•‘å‘½ç¨»è‰ï¼Œä»·å€¼åƒé‡‘ã€‚</p>
</blockquote>
<h3 data-id="heading-3">2. ä¸“æœ‰å‡½æ•°ä¸ç©ºå€¼å¤„ç†</h3>
<p><strong>ç—›ç‚¹</strong>ï¼šOracle é‡Œçš„ <code>DECODE</code>ã€<code>NVL2</code> ç®€ç›´æ˜¯æ— å¤„ä¸åœ¨ã€‚è€Œä¸” Oracle æœ‰ä¸ªæ€ªç™–ï¼Œå®ƒæŠŠ <code>''</code>ï¼ˆç©ºä¸²ï¼‰å½“æˆ <code>NULL</code>ï¼Œä½†æ ‡å‡† SQL é‡Œè¿™ä¿©å¯æ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœæ•°æ®åº“è¡Œä¸ºå¯¹ä¸ä¸Šï¼ŒæŸ¥å‡ºæ¥çš„ç»“æœé‚£å°±æ˜¯ä¸¤ç äº‹äº†ã€‚</p>
<p><strong>KingbaseES è¡¨ç°</strong>ï¼š<strong>å®Œç¾å¤åˆ»äº† Oracle çš„è¿™äº›è¡Œä¸ºã€‚</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. å‡†å¤‡æµ‹è¯•æ•°æ®</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customers (
    cust_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>), <span class="hljs-comment">-- æ¨èä½¿ç”¨ VARCHARï¼Œé¿å… CHAR(bpchar) å¯èƒ½å¯¼è‡´çš„å‡½æ•°å‚æ•°åŒ¹é…é—®é¢˜</span>
    risk_rating <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),
    mobile_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)
);

<span class="hljs-comment">-- æ’å…¥æ•°æ®ï¼šæ³¨æ„ç¬¬äºŒæ¡æ•°æ®çš„ mobile_no æ˜¯ç©ºä¸² ''</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> customers <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'1'</span>, <span class="hljs-string">'High'</span>, <span class="hljs-string">'13800138000'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> customers <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">''</span>); <span class="hljs-comment">-- Oracleæ¨¡å¼ä¸‹ '' è¢«å­˜ä¸º NULL</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> customers <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-string">'9'</span>, <span class="hljs-string">'Low'</span>, <span class="hljs-string">'13900139000'</span>);
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 2. æ‰§è¡ŒæŸ¥è¯¢ï¼šéªŒè¯ DECODEã€NVL2 åŠç©ºä¸²=NULL çš„è¡Œä¸º</span>
<span class="hljs-comment">-- æ³¨æ„ï¼šè¯·ç¡®ä¿å½“å‰æ•°æ®åº“ä¸º Oracle å…¼å®¹æ¨¡å¼ (database_mode='ORACLE')</span>
<span class="hljs-keyword">SELECT</span> 
    cust_id,
    DECODE(status, <span class="hljs-string">'1'</span>, <span class="hljs-string">'æ­£å¸¸'</span>, <span class="hljs-string">'0'</span>, <span class="hljs-string">'å†»ç»“'</span>, <span class="hljs-string">'æœªçŸ¥'</span>) <span class="hljs-keyword">AS</span> status_desc,
    NVL2(risk_rating, <span class="hljs-string">'å·²è¯„çº§'</span>, <span class="hljs-string">'æœªè¯„çº§'</span>) <span class="hljs-keyword">AS</span> rating_flag
<span class="hljs-keyword">FROM</span> customers
<span class="hljs-keyword">WHERE</span> mobile_no <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5b0dad5294947888865a0847738d351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=Kbun6q5ZYuEHVKl8qaLsMDBQo%2FM%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p><strong>ç‚¹è¯„</strong>ï¼šKingbaseES é€šè¿‡è°ƒæ•´å‚æ•°ï¼ˆæ¯”å¦‚ <code>ora_input_emptystr_isnull</code>ï¼‰ï¼Œèƒ½åœ¨å†…æ ¸å±‚é¢ç›´æ¥æ¨¡æ‹Ÿ Oracle çš„ç©ºå€¼å¤„ç†é€»è¾‘ï¼Œä¿è¯ä½ çš„ä¸šåŠ¡é€»è¾‘èƒ½å¤Ÿâ€œåŸæ±åŸå‘³â€åœ°è¿è¡Œã€‚</p>
</blockquote>
<h3 data-id="heading-4">3. PL/SQL é«˜çº§ç‰¹æ€§ï¼šåŒ…ä¸å¼‚å¸¸å¤„ç†</h3>
<p><strong>ç—›ç‚¹</strong>ï¼šæ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿé‡Œï¼Œå¾€å¾€å°è£…äº†ä¸€å †åˆä¸€å †çš„ <code>PACKAGE</code>ï¼Œé‡Œé¢å…¨æ˜¯ç§æœ‰å˜é‡ã€é‡è½½å‡½æ•°å’Œè‡ªå®šä¹‰å¼‚å¸¸ï¼Œå¤æ‚å¾—å¾ˆã€‚</p>
<p><strong>KingbaseES è¡¨ç°</strong>ï¼šæ”¯æŒ PL/SQL å—ç»“æ„ã€<code>EXCEPTION</code> æ•è·ã€<code>PRAGMA</code> ç­‰é«˜çº§ç‰¹æ€§ï¼Œæ²¡åœ¨æ€•çš„ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ–‡ä»¶å: pkg_test.sql</span>

<span class="hljs-comment">-- 1. å‡†å¤‡è¡¨å’Œæ•°æ®</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> accounts;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> accounts (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    balance NUMBER(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>)
);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> accounts <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">101</span>, <span class="hljs-number">1000.00</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> accounts <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">102</span>, <span class="hljs-number">0.00</span>);
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 2. åˆ›å»ºåŒ…è§„èŒƒ (Package Specification)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE PACKAGE pkg_trans_logic <span class="hljs-keyword">IS</span>
    <span class="hljs-keyword">PROCEDURE</span> transfer(p_from <span class="hljs-type">INT</span>, p_to <span class="hljs-type">INT</span>, p_amount NUMBER);
<span class="hljs-keyword">END</span> pkg_trans_logic;
<span class="hljs-operator">/</span>

<span class="hljs-comment">-- 3. åˆ›å»ºåŒ…ä½“ (Package Body)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE PACKAGE BODY pkg_trans_logic <span class="hljs-keyword">IS</span>
    <span class="hljs-comment">-- ç§æœ‰å˜é‡</span>
    v_min_balance NUMBER :<span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

    <span class="hljs-comment">-- å­˜å‚¨è¿‡ç¨‹å®ç°</span>
    <span class="hljs-keyword">PROCEDURE</span> transfer(p_from <span class="hljs-type">INT</span>, p_to <span class="hljs-type">INT</span>, p_amount NUMBER) <span class="hljs-keyword">IS</span>
    <span class="hljs-keyword">BEGIN</span>
        IF p_amount <span class="hljs-operator">&lt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
            RAISE_APPLICATION_ERROR(<span class="hljs-number">-20001</span>, <span class="hljs-string">'è½¬è´¦é‡‘é¢ä¸èƒ½ä¸ºè´Ÿ'</span>);
        <span class="hljs-keyword">END</span> IF;
        
        <span class="hljs-comment">-- ç®€å•çš„è½¬è´¦é€»è¾‘</span>
        <span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> p_amount <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> p_from;
        <span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> p_amount <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> p_to;
        
        <span class="hljs-keyword">COMMIT</span>;
        DBMS_OUTPUT.PUT_LINE(<span class="hljs-string">'è½¬è´¦æˆåŠŸ'</span>);
    EXCEPTION
        <span class="hljs-keyword">WHEN</span> OTHERS <span class="hljs-keyword">THEN</span>
            <span class="hljs-keyword">ROLLBACK</span>;
            DBMS_OUTPUT.PUT_LINE(<span class="hljs-string">'äº¤æ˜“å¤±è´¥: '</span> <span class="hljs-operator">||</span> SQLERRM);
    <span class="hljs-keyword">END</span>;
<span class="hljs-keyword">END</span> pkg_trans_logic;
<span class="hljs-operator">/</span>

<span class="hljs-comment">-- 4. è°ƒç”¨æµ‹è¯•</span>
<span class="hljs-keyword">BEGIN</span>
    pkg_trans_logic.transfer(<span class="hljs-number">101</span>, <span class="hljs-number">102</span>, <span class="hljs-number">200</span>);
<span class="hljs-keyword">END</span>;
<span class="hljs-operator">/</span>

<span class="hljs-comment">-- 5. éªŒè¯ç»“æœ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> accounts;
</code></pre>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ è¿ç§»ç”Ÿæ€ï¼šä»â€œèƒ½è¿â€åˆ°â€œå¥½è¿â€</h2>
<p>å…‰æ•°æ®åº“å…¼å®¹åšå¾—å¥½è¿˜ä¸å¤Ÿï¼ŒKingbaseES è¿˜å¤‡å¥½äº†ä¸€å¥—è¶æ‰‹çš„å®¶ä¼™äº‹å„¿ï¼Œå·ç§°â€œè¿ç§»ä¸‰å‰‘å®¢â€ï¼ŒæŠŠè¿ç§»é—¨æ§›é™å¾—é‚£æ˜¯ç›¸å½“ä½ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0335ad83e9d4ee2af8178199fa88878~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=cHippH7x65%2BEkzpyRYoarNB4dPY%3D" alt="image.png" loading="lazy"/></p>
<p><strong>KDMSï¼ˆè¯„å®šå·¥å…·ï¼‰</strong> åœ¨å¼€å·¥å‰ä¼šè‡ªåŠ¨æ‰«æOracleåº“ï¼Œå¹¶ç»™å‡ºä¸€ä»½â€œé€‚é…æ€§è¯„å®šæŠ¥å‘Šâ€ï¼Œè¯¥æŠ¥å‘Šå‡†ç¡®å‘ŠçŸ¥å“ªäº›ä»£ç éœ€ä¿®æ”¹ï¼ˆè­¬å¦‚æ˜¾ç¤º99%å¯è‡ªåŠ¨è½¬æ¢ï¼Œå¦æœ‰1%è¦äººå·¥è°ƒæ•´ï¼‰ã€‚</p>
<p><strong>KDTSï¼ˆè¿ç§»å·¥å…·ï¼‰</strong> å…·å¤‡é«˜é€Ÿæ¬è¿èƒ½åŠ›ï¼Œå®ƒæ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œè¿ç§»ï¼Œå¯¹äºå¤§è¡¨ä¼šè‡ªåŠ¨æ‰§è¡Œæ‹†åˆ†ï¼Œå…¶é€Ÿåº¦éå¸¸å¿«ã€‚ <strong>æ–­ç‚¹ç»­ä¼ </strong>ï¼šç½‘ç»œä¸ç¨³å®šä¹Ÿä¸æ€•ï¼Œä»»åŠ¡æ–­äº†èƒ½æ¥ç€ä¼ ï¼Œä¸ç”¨ä»å¤´æ¥ã€‚</p>
<p><strong>KFSï¼ˆåŒæ­¥å·¥å…·ï¼‰</strong> ä¾é æ—¥å¿—åˆ†æï¼ˆCDCï¼‰æŠ€æœ¯ï¼Œå¯ä»¥è¾¾æˆä»Oracleå‘KingbaseESçš„å³æ—¶å¢é‡åŒæ­¥ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99e3ffb052694792b7120572370529ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=w%2F2wUzPeoyqZELAKqThye%2FzeyAM%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">*</span>   <span class="hljs-strong">**åº”ç”¨åœºæ™¯**</span>ï¼šåœ¨å‰²æ¥çš„çª—å£æœŸï¼Œèƒ½ä¿è¯æ–°è€åº“æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œæ”¯æŒâ€œå¹³æ»‘åˆ‡æ¢â€ï¼Œä¸‡ä¸€æœ‰å•¥é—®é¢˜è¿˜èƒ½â€œå›é€€â€ï¼Œç»™ä½ ç•™è¶³äº†åè·¯ã€‚
</code></pre>
<hr/>
<h2 data-id="heading-6">å››ã€ ç¹è£ç”Ÿæ€ï¼šä¸ä»…ä»…æ˜¯æ•°æ®åº“</h2>
<p>é€‰æ•°æ®åº“ï¼Œå…¶å®ä¹Ÿæ˜¯åœ¨é€‰ç”Ÿæ€ã€‚ç”µç§‘é‡‘ä»“ä½œä¸ºâ€œå›½äº§æ•°æ®åº“å››å°é¾™â€ä¹‹ä¸€ï¼Œåœ¨ç”Ÿæ€å»ºè®¾è¿™å—å„¿èµ°å¾—å¯æ˜¯ç›¸å½“é å‰ã€‚</p>
<h3 data-id="heading-7">1. å¼ºå¤§çš„ç¤¾åŒºæ”¯æŒ</h3>
<p>é‡åˆ°æŠ€æœ¯éš¾é¢˜ä¸çŸ¥é“å»å“ªé—®ï¼Ÿ</p>
<ul>
<li><strong>å®˜æ–¹çŸ¥è¯†åº“</strong>ï¼šè¿™é‡Œé¢æ¶µç›–äº†ä»å®‰è£…éƒ¨ç½²åˆ°å†…æ ¸è°ƒä¼˜çš„æµ·é‡å®æˆ˜æ¡ˆä¾‹ï¼Œç®€ç›´å°±æ˜¯ DBA çš„â€œé¿å‘æŒ‡å—â€ã€‚
<ul>
<li>ğŸ”— <strong>æ¨èæ”¶è—</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fbbs.kingbase.com.cn%2Fknowledge%2Fkes%2FKingbaseES%25E7%259F%25A5%25E8%25AF%2586%25E5%25BA%2593%2FKingbaseES%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%25E7%259F%25A5%25E8%25AF%2586%25E5%259B%25BE%25E8%25B0%25B1" target="_blank" title="https://bbs.kingbase.com.cn/knowledge/kes/KingbaseES%E7%9F%A5%E8%AF%86%E5%BA%93/KingbaseES%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1" ref="nofollow noopener noreferrer">KingbaseES çŸ¥è¯†åº“</a></li>
</ul>
</li>
<li><strong>æŠ€æœ¯æ¢ç´¢åšå®¢</strong>ï¼šè¿™é‡Œæ±‡èšäº†ä¸€å¸®èµ„æ·±ä¸“å®¶çš„æ·±åº¦å¥½æ–‡ï¼Œä»å†…æ ¸åŸç†è§£æåˆ°è¡Œä¸šæœ€ä½³å®è·µï¼Œå†…å®¹é‚£æ˜¯ç›¸å½“æœ‰æ·±åº¦ã€‚
<ul>
<li>ğŸ”— <strong>å¿…è¯»å¹²è´§</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fkingbase.com.cn%2Fexplore" target="_blank" title="https://kingbase.com.cn/explore" ref="nofollow noopener noreferrer">é‡‘ä»“æŠ€æœ¯æ¢ç´¢</a></li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">2. å®Œå¤‡çš„è®¤è¯ä½“ç³»</h3>
<p>ä¸ºäº†è§£å†³äººæ‰ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼Œé‡‘ä»“æ¨å‡ºäº† <strong>KCA / KCP / KCM</strong> ä¸‰çº§è®¤è¯ä½“ç³»ï¼Œè¿˜åœ¨å…¨å›½çš„é«˜æ ¡å’ŒåŸ¹è®­æœºæ„é‡Œå¤§åŠ›æ¨å¹¿ã€‚å¯¹äºä¼ä¸šæ¥è¯´ï¼Œè¿™å°±æ„å‘³ç€æ‹›äººæ›´å®¹æ˜“äº†ï¼Œåç»­çš„è¿ç»´ä¹Ÿæœ‰äº†ä¿éšœã€‚</p>
<h3 data-id="heading-9">3. å…¨é¢çš„äº§å“å®¶æ—</h3>
<p>é’ˆå¯¹é‡‘èè¡Œä¸šå„ç§å„æ ·çš„éœ€æ±‚ï¼Œé‡‘ä»“å¯ä¸å…‰æœ‰ KingbaseESï¼Œè¿˜æœ‰ï¼š</p>
<ul>
<li><strong>KingbaseES RAC</strong>ï¼šå…±äº«å­˜å‚¨å¤šæ´»é›†ç¾¤ï¼Œç›´æ¥å¯¹æ ‡ Oracle RACï¼Œä¿ä½ æ ¸å¿ƒä¸šåŠ¡ 7x24 å°æ—¶éƒ½ä¸å¸¦åœæœºçš„ã€‚</li>
<li><strong>KStudio</strong>ï¼šå›¾å½¢åŒ–å¼€å‘å·¥å…·ï¼Œè®©ä¹ æƒ¯äº† PL/SQL Developer çš„å¼€å‘äººå‘˜èƒ½æ— ç¼åˆ‡æ¢ï¼Œä¸Šæ‰‹å°±èƒ½å¹²æ´»ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bc797718a28493fb79c16916a635fa6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=zT0bmwz6HXU3v4Znvy3KY4Ca%2B4o%3D" alt="image.png" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-10">äº”ã€ ç»“è¯­</h2>
<p>åœ¨â€œä¿¡åˆ›â€è¿™åœºé‡å¤§è€ƒéªŒå½“ä¸­ï¼Œâ€œé‡‘ä»“ KingbaseESâ€å¯è¯´äº¤ä¸Šäº†ä¸€ä»½é«˜åˆ†è¯•å·ï¼Œå…¶å¹¶éä»…ä»…å……å½“å­˜å‚¨æ•°æ®çš„å®¹å™¨ï¼Œè€Œæ˜¯ä¸€æ•´å¥—åŒ…å«æœ‰â€œé«˜åº¦å¥‘åˆå†…æ ¸ + æ™ºèƒ½è¿ç§»å·¥å…· + å…¨é¢çŸ¥è¯†ç”Ÿæ€â€çš„å®Œå¤‡æ–¹æ¡ˆã€‚</p>
<p>å¯¹äºé‚£äº›è°‹æ±‚â€œç¨³ï¼Œå¿«ï¼Œå‡†â€è¿ç§»çš„é‡‘èå’Œå…³é”®è¡Œä¸šå®¢æˆ·è€Œè¨€ï¼ŒKingbaseES ç¡®å®ä½“ç°å‡ºè‡ªå·±æ˜¯å¯ä¿¡èµ–çš„â€œOracleå¹³æ›¿â€ï¼Œä¹Ÿæ˜¯æ”¹è‰¯å‡çº§çš„ä¸é”™ä¹‹é€‰ã€‚</p>
<blockquote>
<p><strong>æƒ³äº†è§£æ›´å¤šæŠ€æœ¯å¹²è´§ï¼Ÿ</strong>
æ¬¢è¿æ¥é‡‘ä»“æŠ€æœ¯ç¤¾åŒºé€›é€›ï¼Œå’Œæ•°ä¸‡åå¼€å‘è€…ä¸€èµ·èŠèŠå›½äº§æ•°æ®åº“çš„æœªæ¥ï¼
ğŸŒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fkingbase.com.cn%2Fexplore" target="_blank" title="https://kingbase.com.cn/explore" ref="nofollow noopener noreferrer">kingbase.com.cn/explore</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RBAC èœå•æŸ¥è¯¢çš„â€œæ ‡å‡†å†™æ³•â€]]></title>    <link>https://juejin.cn/post/7582814236583772198</link>    <guid>https://juejin.cn/post/7582814236583772198</guid>    <pubDate>2025-12-13T02:29:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582814236583772198" data-draft-id="7582846276506058790" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RBAC èœå•æŸ¥è¯¢çš„â€œæ ‡å‡†å†™æ³•â€"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2025-12-13T02:29:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼ æ´ªæƒ"/> <meta itemprop="url" content="https://juejin.cn/user/1500154422651518"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RBAC èœå•æŸ¥è¯¢çš„â€œæ ‡å‡†å†™æ³•â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1500154422651518/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼ æ´ªæƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T02:29:57.000Z" title="Sat Dec 13 2025 02:29:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å…ˆçœ‹å®Œæ•´ SQLï¼ˆåŸæ ·ï¼‰</h2>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> m.*
<span class="hljs-keyword">from</span> menu m
left <span class="hljs-keyword">join</span> role_menu rm <span class="hljs-keyword">on</span> rm.menu_id = m.id
<span class="hljs-keyword">where</span> rm.<span class="hljs-function">role_id <span class="hljs-title">in</span> (<span class="hljs-params">
  <span class="hljs-keyword">select</span> role_id <span class="hljs-keyword">from</span> user_role <span class="hljs-keyword">where</span> user_id = ?
</span>)
order <span class="hljs-keyword">by</span> m.parent_id, m.sort</span>;
</code></pre>
<hr/>
<h2 data-id="heading-1">äºŒã€å…ˆææ¸…æ¥š 4 å¼ è¡¨åœ¨å¹²ä»€ä¹ˆï¼ˆéå¸¸å…³é”®ï¼‰</h2>
<h3 data-id="heading-2">1ï¸âƒ£ userï¼ˆç”¨æˆ·ï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash">user
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-built_in">id</span> â”‚ username â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-3">2ï¸âƒ£ roleï¼ˆè§’è‰²ï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash">role
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-built_in">id</span> â”‚ role_codeâ”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-4">3ï¸âƒ£ user_roleï¼ˆç”¨æˆ·-è§’è‰²å…³ç³»ï¼‰</h3>
<blockquote>
<p><strong>ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²</strong></p>
</blockquote>
<pre><code class="hljs">user_role
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_idâ”‚ role_idâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-5">4ï¸âƒ£ menuï¼ˆèœå•ï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash">menu
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-built_in">id</span> â”‚parent_idâ”‚ name     â”‚ path    â”‚ <span class="hljs-built_in">sort</span> â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<blockquote>
<p><code>parent_id</code> ç”¨æ¥è¡¨ç¤ºèœå•å±‚çº§ï¼ˆçˆ¶å­èœå•ï¼‰</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">5ï¸âƒ£ role_menuï¼ˆè§’è‰²-èœå•å…³ç³»ï¼‰</h3>
<blockquote>
<p><strong>è§’è‰²èƒ½è®¿é—®å“ªäº›èœå•</strong></p>
</blockquote>
<pre><code class="hljs">role_menu
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ role_idâ”‚ menu_idâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€æ•´ä½“ä¸€å¥è¯è§£é‡Šè¿™æ¡ SQL åœ¨å¹²å˜›</h2>
<blockquote>
<p><strong>â€œæŸ¥å‡ºæŸä¸ªç”¨æˆ· â†’ æ‰€æœ‰è§’è‰² â†’ èƒ½è®¿é—®çš„æ‰€æœ‰èœå•ï¼Œå¹¶æŒ‰èœå•å±‚çº§æ’åºâ€</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-8">å››ã€é€å¥æ‹†è§£ï¼ˆé‡ç‚¹ï¼‰</h2>
<hr/>
<h3 data-id="heading-9">ğŸ”¹ â‘  å­æŸ¥è¯¢ï¼šå…ˆæŸ¥ç”¨æˆ·æœ‰å“ªäº›è§’è‰²</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> role_id <span class="hljs-keyword">from</span> user_role <span class="hljs-keyword">where</span> user_id = ?
</code></pre>
<h4 data-id="heading-10">å‡è®¾ï¼š</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">user_id</span> = <span class="hljs-number">10</span>
</code></pre>
<h4 data-id="heading-11">user_role è¡¨ï¼š</h4>

















<table><thead><tr><th>user_id</th><th>role_id</th></tr></thead><tbody><tr><td>10</td><td>1</td></tr><tr><td>10</td><td>2</td></tr></tbody></table>
<h4 data-id="heading-12">å­æŸ¥è¯¢ç»“æœï¼š</h4>
<pre><code class="hljs language-scss" lang="scss">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
</code></pre>
<p>ğŸ‘‰ <strong>æ„æ€ï¼šè¿™ä¸ªç”¨æˆ·æœ‰ 2 ä¸ªè§’è‰²</strong></p>
<hr/>
<h3 data-id="heading-13">ğŸ”¹ â‘¡ where rm.role_id in (...)</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">where</span> rm.role_id <span class="hljs-keyword">in</span> (1, 2)
</code></pre>
<p>ğŸ‘‰ <strong>åªè¦æ˜¯è§’è‰² 1 æˆ– è§’è‰² 2 æ‹¥æœ‰çš„èœå•ï¼Œéƒ½è¦</strong></p>
<hr/>
<h3 data-id="heading-14">ğŸ”¹ â‘¢ left join role_menu</h3>
<pre><code class="hljs language-bash" lang="bash">left <span class="hljs-built_in">join</span> role_menu <span class="hljs-built_in">rm</span> on rm.menu_id = m.id
</code></pre>
<h4 data-id="heading-15">ä½œç”¨ä¸€å¥è¯ï¼š</h4>
<blockquote>
<p><strong>æŠŠâ€œèœå•â€å’Œâ€œè§’è‰²-èœå•å…³ç³»â€è¿èµ·æ¥</strong></p>
</blockquote>
<h4 data-id="heading-16">ç¤ºä¾‹ role_menu è¡¨ï¼š</h4>





















<table><thead><tr><th>role_id</th><th>menu_id</th></tr></thead><tbody><tr><td>1</td><td>101</td></tr><tr><td>1</td><td>102</td></tr><tr><td>2</td><td>103</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">ğŸ”¹ â‘£ select m.*</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> m.*
</code></pre>
<p>ğŸ‘‰ <strong>åªè¦èœå•å­—æ®µï¼Œä¸å…³å¿ƒ role_menu çš„å­—æ®µ</strong></p>
<p>æœ€ç»ˆä½ å¾—åˆ°çš„ï¼Œæ˜¯ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">menu</span> è¡¨ä¸­çš„æ•°æ®
</code></pre>
<hr/>
<h2 data-id="heading-18">äº”ã€æ•´ä½“æ‰§è¡Œæµç¨‹ï¼ˆä¸€æ­¥ä¸€æ­¥ï¼‰</h2>
<h3 data-id="heading-19">ğŸ§  æ•°æ®åº“çœŸå®æ‰§è¡Œé€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</h3>
<h3 data-id="heading-20">Step 1ï¸âƒ£ï¼šæŸ¥ç”¨æˆ·è§’è‰²</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">user_id</span> = <span class="hljs-number">10</span>
â†“
è§’è‰² = <span class="hljs-section">[1, 2]</span>
</code></pre>
<hr/>
<h3 data-id="heading-21">Step 2ï¸âƒ£ï¼šæŸ¥è¿™äº›è§’è‰²èƒ½è®¿é—®çš„èœå•</h3>
<pre><code class="hljs language-css" lang="css">role <span class="hljs-number">1</span> â†’ <span class="hljs-selector-tag">menu</span> <span class="hljs-number">101</span>, <span class="hljs-number">102</span>
role <span class="hljs-number">2</span> â†’ <span class="hljs-selector-tag">menu</span> <span class="hljs-number">103</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">Step 3ï¸âƒ£ï¼šåˆå¹¶å»é‡åèœå•</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">menu</span> <span class="hljs-number">101</span>
<span class="hljs-selector-tag">menu</span> <span class="hljs-number">102</span>
<span class="hljs-selector-tag">menu</span> <span class="hljs-number">103</span>
</code></pre>
<hr/>
<h3 data-id="heading-23">Step 4ï¸âƒ£ï¼šæ’åº</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> m.parent_id, m.sort
</code></pre>
<h4 data-id="heading-24">æ’åºç›®çš„ï¼š</h4>
<ul>
<li>å…ˆæŒ‰çˆ¶èœå•åˆ†ç»„</li>
<li>å†æŒ‰èœå•é¡ºåºæ’åˆ—</li>
</ul>
<p>ğŸ‘‰ <strong>æ–¹ä¾¿å‰ç«¯ç›´æ¥ç”Ÿæˆæ ‘å½¢èœå•</strong></p>
<hr/>
<h2 data-id="heading-25">å…­ã€ä¸ºä»€ä¹ˆè¦ç”¨ <code>LEFT JOIN</code> è€Œä¸æ˜¯ <code>INNER JOIN</code>ï¼Ÿ</h2>
<h3 data-id="heading-26">å®é™…ä¸Šï¼š</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-operator">+</span> <span class="hljs-keyword">where</span> rm.role_id <span class="hljs-keyword">in</span> (...)
</code></pre>
<p>â¬‡ï¸<br/>
<strong>æ•ˆæœç­‰åŒäº INNER JOIN</strong></p>
<h3 data-id="heading-27">é‚£ä¸ºä»€ä¹ˆå¾ˆå¤šäººè¿˜å†™ LEFT JOINï¼Ÿ</h3>
<p>1ï¸âƒ£ å†™æ³•æ›´é€šç”¨<br/>
2ï¸âƒ£ ä»¥åå¯ä»¥æ‰©å±•ï¼ˆæ¯”å¦‚å…è®¸ç©ºè§’è‰²ï¼‰<br/>
3ï¸âƒ£ å†å²ä»£ç ä¹ æƒ¯</p>
<p>ğŸ‘‰ <strong>å¦‚æœä½ æ„¿æ„ï¼Œå®Œå…¨å¯ä»¥æ”¹æˆï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> m.*
<span class="hljs-keyword">from</span> menu m
inner <span class="hljs-keyword">join</span> role_menu rm <span class="hljs-keyword">on</span> rm.menu_id = m.id
<span class="hljs-keyword">where</span> rm.<span class="hljs-function">role_id <span class="hljs-title">in</span> (<span class="hljs-params">
  <span class="hljs-keyword">select</span> role_id <span class="hljs-keyword">from</span> user_role <span class="hljs-keyword">where</span> user_id = ?
</span>)
order <span class="hljs-keyword">by</span> m.parent_id, m.sort</span>;
</code></pre>
<hr/>
<h2 data-id="heading-28">ä¸ƒã€ä¸ºä»€ä¹ˆä¸ç”¨ä¸‰è¡¨ç›´æ¥ joinï¼Ÿ</h2>
<p>ä½ ä¹Ÿå¯ä»¥å†™æˆï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> m.*
<span class="hljs-keyword">from</span> user_role ur
<span class="hljs-keyword">join</span> role_menu rm <span class="hljs-keyword">on</span> rm.role_id = ur.role_id
<span class="hljs-keyword">join</span> menu m <span class="hljs-keyword">on</span> m.id = rm.menu_id
<span class="hljs-keyword">where</span> ur.user_id = ?
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> m.parent_id, m.sort;
</code></pre>
<h3 data-id="heading-29">ä¸¤ç§å†™æ³•å¯¹æ¯”</h3>

















<table><thead><tr><th>å†™æ³•</th><th>ä¼˜ç‚¹</th></tr></thead><tbody><tr><td>å­æŸ¥è¯¢ in</td><td>æ˜“è¯»ã€å¥½ç†è§£</td></tr><tr><td>å¤šè¡¨ join</td><td>æ€§èƒ½ç¨å¥½ã€ä¸“ä¸š</td></tr></tbody></table>
<p>ğŸ‘‰ <strong>ä¸­å°é¡¹ç›®ä¸¤ç§éƒ½å®Œå…¨æ²¡é—®é¢˜</strong></p>
<hr/>
<h2 data-id="heading-30">å…«ã€æœ€ç»ˆè¿”å›çš„æ•°æ®é•¿ä»€ä¹ˆæ ·ï¼Ÿ</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[  {    <span class="hljs-string">"id"</span>: 1,    <span class="hljs-string">"parent_id"</span>: 0,    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç³»ç»Ÿç®¡ç†"</span>,    <span class="hljs-string">"path"</span>: <span class="hljs-string">"/system"</span>,    <span class="hljs-string">"sort"</span>: 1  },  {    <span class="hljs-string">"id"</span>: 2,    <span class="hljs-string">"parent_id"</span>: 1,    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç”¨æˆ·ç®¡ç†"</span>,    <span class="hljs-string">"path"</span>: <span class="hljs-string">"/system/user"</span>,    <span class="hljs-string">"sort"</span>: 1  }]</span>
</code></pre>
<p>å‰ç«¯å¯ä»¥ <strong>ç›´æ¥é€’å½’ç”Ÿæˆèœå•æ ‘</strong></p>
<hr/>
<h2 data-id="heading-31">ä¹ã€è¿™æ¡ SQL åœ¨ RBAC ä¸­çš„â€œåœ°ä½â€</h2>
<p>ğŸ‘‰ <strong>90% çš„åå°ç³»ç»Ÿï¼Œèœå•æŸ¥è¯¢å°±æ˜¯è¿™ä¸€ç±» SQL</strong></p>
<p>ä½ å­¦ä¼šè¿™ä¸€æ¡ï¼Œå°±å·²ç»ï¼š</p>
<ul>
<li>âœ” ç†è§£äº† RBAC çš„æ ¸å¿ƒ</li>
<li>âœ” èƒ½ç‹¬ç«‹è®¾è®¡èœå•æƒé™</li>
<li>âœ” çœ‹å¾—æ‡‚å¤§å¤šæ•°åå°æºç </li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå¹¶å‘ç¼–ç¨‹åŸºçŸ³ï¼šæ·±å…¥è§£æAQSåŸç†ä¸åº”ç”¨å®æˆ˜]]></title>    <link>https://juejin.cn/post/7582845425402347560</link>    <guid>https://juejin.cn/post/7582845425402347560</guid>    <pubDate>2025-12-13T03:06:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582845425402347560" data-draft-id="7582783931164327971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå¹¶å‘ç¼–ç¨‹åŸºçŸ³ï¼šæ·±å…¥è§£æAQSåŸç†ä¸åº”ç”¨å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-13T03:06:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç§‘å¨èˆŸçš„ä»£ç ç¬”è®°"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058230174"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå¹¶å‘ç¼–ç¨‹åŸºçŸ³ï¼šæ·±å…¥è§£æAQSåŸç†ä¸åº”ç”¨å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058230174/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç§‘å¨èˆŸçš„ä»£ç ç¬”è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:06:05.000Z" title="Sat Dec 13 2025 03:06:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>[toc]</p>
<h2 data-id="heading-0">1 AQSæ¦‚è¿°ï¼šå¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³</h2>
<p>AbstractQueuedSynchronizerï¼ˆAQSï¼‰æ˜¯Javaå¹¶å‘åŒ…ï¼ˆjava.util.concurrent.locksï¼‰çš„æ ¸å¿ƒåŸºç¡€æ¡†æ¶ï¼Œä¸ºæ„å»ºé”å’ŒåŒæ­¥å™¨æä¾›äº†å¯é‡ç”¨çš„åŸºç¡€è®¾æ–½ã€‚AQSé€šè¿‡<strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>è®©å¼€å‘è€…èƒ½å¤ŸåŸºäºçŠ¶æ€å’Œé˜Ÿåˆ—è½»æ¾æ„å»ºå„ç§åŒæ­¥å™¨ï¼Œå¦‚ReentrantLockã€Semaphoreã€CountDownLatchç­‰å¸¸è§å¹¶å‘å·¥å…·ã€‚</p>
<p>AQSçš„æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯ï¼šå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆå·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ï¼›å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œåˆ™éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ã€‚è¿™å¥—æœºåˆ¶é€šè¿‡<strong>CLHé˜Ÿåˆ—é”</strong>å®ç°ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„synchronizedå…³é”®å­—ç›¸æ¯”ï¼ŒAQSå…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ï¼šå®ƒç”±Javaè¯­è¨€å®ç°ï¼ˆè€ŒéC++ï¼‰ï¼Œæä¾›äº†æ›´çµæ´»çš„APIï¼Œå¹¶ä¸”åœ¨é”ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹æä¾›äº†å¤šç§è§£å†³æ–¹æ¡ˆï¼Œæ€§èƒ½è¡¨ç°æ›´ä¼˜ã€‚</p>
<h2 data-id="heading-1">2 AQSæ ¸å¿ƒåŸç†ä¸æ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-2">2.1 æ ¸å¿ƒç»„ä»¶ï¼šçŠ¶æ€å˜é‡ä¸åŒæ­¥é˜Ÿåˆ—</h3>
<p>AQSçš„æ ¸å¿ƒæ¶æ„å›´ç»•ä¸¤ä¸ªå…³é”®ç»„ä»¶æ„å»ºï¼š<strong>åŒæ­¥çŠ¶æ€ï¼ˆstateï¼‰<strong>å’Œ</strong>ç­‰å¾…é˜Ÿåˆ—</strong>ã€‚</p>
<p>**åŒæ­¥çŠ¶æ€ï¼ˆstateï¼‰**æ˜¯ä¸€ä¸ªvolatile intç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºå…±äº«èµ„æºçš„çŠ¶æ€ã€‚å…¶å…·ä½“è¯­ä¹‰ç”±å­ç±»å®šä¹‰ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åœ¨ReentrantLockä¸­ï¼Œstateè¡¨ç¤ºé”çš„é‡å…¥æ¬¡æ•°</li>
<li>åœ¨Semaphoreä¸­ï¼Œstateè¡¨ç¤ºå¯ç”¨çš„è®¸å¯è¯æ•°é‡</li>
<li>åœ¨CountDownLatchä¸­ï¼Œstateè¡¨ç¤ºæœªå®Œæˆçš„è®¡æ•°</li>
</ul>
<p>AQSæä¾›äº†ä¸‰ç§åŸå­æ“ä½œæ–¹æ³•æ¥ç®¡ç†stateï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> state; }
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(<span class="hljs-type">int</span> newState)</span> { state = newState; }
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSetState</span><span class="hljs-params">(<span class="hljs-type">int</span> expect, <span class="hljs-type">int</span> update)</span> {
    <span class="hljs-comment">// CASæ“ä½œï¼Œä¿è¯åŸå­æ€§</span>
}
</code></pre>
<p><strong>ç­‰å¾…é˜Ÿåˆ—</strong>æ˜¯AQSç®¡ç†çš„CLHï¼ˆCraig, Landin, and Hagerstenï¼‰é˜Ÿåˆ—çš„å˜ä½“ï¼Œæ˜¯ä¸€ä¸ª<strong>FIFOåŒå‘é“¾è¡¨</strong>ï¼Œç”¨äºå­˜å‚¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰åŒ…å«çº¿ç¨‹å¼•ç”¨ã€ç­‰å¾…çŠ¶æ€ä»¥åŠå‰åæŒ‡é’ˆã€‚</p>
<h3 data-id="heading-3">2.2 èŠ‚ç‚¹çŠ¶æ€ä¸é˜Ÿåˆ—ç®¡ç†</h3>
<p>AQSé˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹å­˜åœ¨å¤šç§ç­‰å¾…çŠ¶æ€ï¼Œå†³å®šäº†çº¿ç¨‹çš„æ’é˜Ÿè¡Œä¸ºï¼š</p>
<ul>
<li><strong>CANCELLEDï¼ˆ1ï¼‰</strong>ï¼šèŠ‚ç‚¹å› è¶…æ—¶æˆ–ä¸­æ–­è¢«å–æ¶ˆï¼Œä¸å†å‚ä¸åŒæ­¥</li>
<li><strong>SIGNALï¼ˆ-1ï¼‰</strong>ï¼šåç»§èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’</li>
<li><strong>CONDITIONï¼ˆ-2ï¼‰</strong>ï¼šèŠ‚ç‚¹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…</li>
<li><strong>PROPAGATEï¼ˆ-3ï¼‰</strong>ï¼šå…±äº«æ¨¡å¼ä¸‹çŠ¶æ€å˜æ›´éœ€è¦ä¼ æ’­</li>
<li><strong>0</strong>ï¼šåˆå§‹çŠ¶æ€</li>
</ul>
<p>AQSé€šè¿‡ç²¾ç»†çš„é˜Ÿåˆ—ç®¡ç†æœºåˆ¶å®ç°é«˜æ•ˆçš„çº¿ç¨‹è°ƒåº¦ã€‚å½“çº¿ç¨‹è·å–é”å¤±è´¥æ—¶ï¼Œä¼šè¢«åŒ…è£…æˆNodeèŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨ï¼›å½“é”é‡Šæ”¾æ—¶ï¼Œä¼šå”¤é†’é˜Ÿåˆ—ä¸­çš„åˆé€‚èŠ‚ç‚¹ã€‚</p>
<h2 data-id="heading-4">3 AQSçš„ä¸¤ç§åŒæ­¥æ¨¡å¼</h2>
<h3 data-id="heading-5">3.1 ç‹¬å æ¨¡å¼ï¼ˆExclusive Modeï¼‰</h3>
<p>ç‹¬å æ¨¡å¼ä¸‹ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–åŒæ­¥çŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ã€‚ReentrantLockæ˜¯ç‹¬å æ¨¡å¼çš„å…¸å‹å®ç°ã€‚</p>
<p><strong>è·å–é”æµç¨‹ï¼ˆacquireï¼‰</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨tryAcquire()å°è¯•ç›´æ¥è·å–èµ„æºï¼ˆå­ç±»å®ç°ï¼‰</li>
<li>è‹¥æˆåŠŸï¼Œåˆ™çº¿ç¨‹ç»§ç»­æ‰§è¡Œ</li>
<li>è‹¥å¤±è´¥ï¼Œå°†çº¿ç¨‹åŒ…è£…ä¸ºç‹¬å èŠ‚ç‚¹ï¼ˆNode.EXCLUSIVEï¼‰åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨</li>
<li>çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­è‡ªæ—‹æˆ–é˜»å¡ï¼Œç›´åˆ°è¢«å‰é©±èŠ‚ç‚¹å”¤é†’</li>
<li>è¢«å”¤é†’åï¼Œæ£€æŸ¥å‰é©±æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ï¼Œæ˜¯åˆ™å°è¯•è·å–é”</li>
</ol>
<p><strong>é‡Šæ”¾é”æµç¨‹ï¼ˆreleaseï¼‰</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨tryRelease()å°è¯•é‡Šæ”¾èµ„æºï¼ˆå­ç±»å®ç°ï¼‰</li>
<li>è‹¥é‡Šæ”¾æˆåŠŸï¼ˆstate=0ï¼‰ï¼Œæ£€æŸ¥åç»§èŠ‚ç‚¹æ˜¯å¦éœ€è¦å”¤é†’</li>
<li>å”¤é†’åç»§èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹</li>
</ol>
<p>å¯é‡å…¥æ€§æ˜¯ç‹¬å æ¨¡å¼çš„é‡è¦ç‰¹æ€§ï¼Œé€šè¿‡stateè®¡æ•°å®ç°â€”â€”æ¯æ¬¡é‡å…¥stateåŠ 1ï¼Œé‡Šæ”¾æ—¶ç›¸åº”å‡1ã€‚</p>
<h3 data-id="heading-6">3.2 å…±äº«æ¨¡å¼ï¼ˆShared Modeï¼‰</h3>
<p>å…±äº«æ¨¡å¼ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–åŒæ­¥çŠ¶æ€ï¼Œé€‚ç”¨äºèµ„æºé™æµç­‰åœºæ™¯ã€‚Semaphoreã€CountDownLatchæ˜¯å…±äº«æ¨¡å¼çš„å…¸å‹å®ç°ã€‚</p>
<p><strong>è·å–å…±äº«èµ„æºæµç¨‹</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨tryAcquireShared()å°è¯•è·å–èµ„æº</li>
<li>è¿”å›å€¼è¡¨ç¤ºè·å–ç»“æœï¼šè´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸä½†æ— å‰©ä½™èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸä¸”æœ‰å‰©ä½™èµ„æº</li>
<li>è‹¥å¤±è´¥ï¼Œçº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</li>
<li>æˆåŠŸè·å–èµ„æºåï¼Œè‹¥è¿˜æœ‰å‰©ä½™èµ„æºï¼Œä¼šå”¤é†’åç»­å…±äº«èŠ‚ç‚¹</li>
</ol>
<p><strong>é‡Šæ”¾å…±äº«èµ„æºæµç¨‹</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨tryReleaseShared()é‡Šæ”¾èµ„æº</li>
<li>è‹¥é‡Šæ”¾æˆåŠŸï¼Œå”¤é†’æ‰€æœ‰å¯è·å–èµ„æºçš„åç»§èŠ‚ç‚¹</li>
</ol>
<p>å…±äº«æ¨¡å¼æ”¯æŒ<strong>ä¼ æ’­æœºåˆ¶</strong>ï¼Œå½“èµ„æºå¯ç”¨æ—¶ï¼Œä¼šè¿ç»­å”¤é†’å¤šä¸ªç­‰å¾…çº¿ç¨‹ï¼Œæé«˜ååé‡ã€‚</p>
<h3 data-id="heading-7">3.3 å…¬å¹³ä¸éå…¬å¹³ç­–ç•¥</h3>
<p>AQSæ”¯æŒå…¬å¹³ä¸éå…¬å¹³ä¸¤ç§è°ƒåº¦ç­–ç•¥ï¼š</p>
<ul>
<li><strong>å…¬å¹³é”</strong>ï¼šä¸¥æ ¼æŒ‰ç…§FIFOé¡ºåºåˆ†é…é”ï¼Œä¿è¯æ— é¥¥é¥¿ç°è±¡</li>
<li><strong>éå…¬å¹³é”</strong>ï¼šæ–°çº¿ç¨‹å¯æ’é˜Ÿå°è¯•è·å–é”ï¼Œæé«˜ååé‡ä½†å¯èƒ½å¯¼è‡´é¥¥é¥¿</li>
</ul>
<p>ReentrantLockçš„ä¸¤è€…å®ç°å·®å¼‚ä¸»è¦åœ¨äºtryAcquire()æ–¹æ³•ï¼šå…¬å¹³é”å…ˆæ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œæœ‰åˆ™æ’é˜Ÿï¼›éå…¬å¹³é”ç›´æ¥å°è¯•CASè·å–é”ã€‚</p>
<h2 data-id="heading-8">4 AQSæºç å…³é”®æµç¨‹è§£æ</h2>
<h3 data-id="heading-9">4.1 ç‹¬å æ¨¡å¼è·å–èµ„æºæºç åˆ†æ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp; 
        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))
        selfInterrupt();
}
</code></pre>
<p><strong>addWaiteræ–¹æ³•</strong>å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆNodeèŠ‚ç‚¹å¹¶æ’å…¥é˜Ÿåˆ—å°¾éƒ¨ï¼š</p>
<ul>
<li>ä½¿ç”¨CASæ“ä½œç¡®ä¿å°¾èŠ‚ç‚¹æ’å…¥çš„åŸå­æ€§</li>
<li>é˜Ÿåˆ—ä¸ºç©ºæ—¶è¿›è¡Œåˆå§‹åŒ–</li>
</ul>
<p><strong>acquireQueuedæ–¹æ³•</strong>æ˜¯çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireQueued</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node, <span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-variable">failed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">interrupted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> node.predecessor();
            <span class="hljs-keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) {
                setHead(node);
                p.next = <span class="hljs-literal">null</span>; <span class="hljs-comment">// help GC</span>
                failed = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> interrupted;
            }
            <span class="hljs-keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;
                parkAndCheckInterrupt())
                interrupted = <span class="hljs-literal">true</span>;
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (failed)
            cancelAcquire(node);
    }
}
</code></pre>
<p>æ­¤æ–¹æ³•é€šè¿‡è‡ªæ—‹æ–¹å¼ï¼Œåªæœ‰å½“å‰èŠ‚ç‚¹çš„å‰é©±æ˜¯å¤´èŠ‚ç‚¹æ—¶æ‰å°è¯•è·å–é”ï¼Œé¿å…ä¸å¿…è¦çš„ç«äº‰ã€‚è·å–æˆåŠŸåï¼Œå°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºæ–°å¤´èŠ‚ç‚¹ï¼ˆæ—§å¤´èŠ‚ç‚¹å‡ºé˜Ÿï¼‰ã€‚</p>
<h3 data-id="heading-10">4.2 é‡Šæ”¾èµ„æºä¸å”¤é†’æœºåˆ¶</h3>
<p>é‡Šæ”¾èµ„æºæ—¶ï¼ŒAQSè°ƒç”¨unparkSuccessor()å”¤é†’åˆé€‚çš„åç»§çº¿ç¨‹ï¼š</p>
<ul>
<li>ä»é˜Ÿåˆ—å°¾éƒ¨å‘å‰éå†ï¼Œæ‰¾åˆ°ç¦»å¤´èŠ‚ç‚¹æœ€è¿‘çš„éå–æ¶ˆçŠ¶æ€èŠ‚ç‚¹</li>
<li>é€šè¿‡LockSupport.unpark()å”¤é†’å¯¹åº”çº¿ç¨‹</li>
</ul>
<p>è¿™ç§åå‘éå†æœºåˆ¶ç¡®ä¿å³ä½¿å­˜åœ¨å–æ¶ˆèŠ‚ç‚¹ä¹Ÿèƒ½æ‰¾åˆ°æœ‰æ•ˆåç»§ã€‚</p>
<h2 data-id="heading-11">5 AQSåœ¨Javaå¹¶å‘å·¥å…·ä¸­çš„åº”ç”¨</h2>
<h3 data-id="heading-12">5.1 æ ‡å‡†åŒæ­¥å™¨å®ç°å¯¹æ¯”</h3>



































<table><thead><tr><th>åŒæ­¥å™¨</th><th>åŒæ­¥æ¨¡å¼</th><th>stateå«ä¹‰</th><th>ç‰¹æ€§</th></tr></thead><tbody><tr><td>ReentrantLock</td><td>ç‹¬å </td><td>é‡å…¥æ¬¡æ•°</td><td>æ”¯æŒå…¬å¹³/éå…¬å¹³é”</td></tr><tr><td>Semaphore</td><td>å…±äº«</td><td>å¯ç”¨è®¸å¯è¯æ•°é‡</td><td>æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°</td></tr><tr><td>CountDownLatch</td><td>å…±äº«</td><td>æœªå®Œæˆçš„ä»»åŠ¡æ•°</td><td>ä¸€æ¬¡æ€§å±éšœï¼Œä¸å¯é‡ç½®</td></tr><tr><td>ReentrantReadWriteLock</td><td>ç»„åˆ</td><td>é«˜16ä½è¯»é”ï¼Œä½16ä½å†™é”</td><td>è¯»å†™åˆ†ç¦»ï¼Œå†™é”ä¼˜å…ˆ</td></tr></tbody></table>
<h3 data-id="heading-13">5.2 ReentrantLockå®ç°åŸç†</h3>
<p>ReentrantLocké€šè¿‡å†…éƒ¨ç±»Syncï¼ˆç»§æ‰¿AQSï¼‰å®ç°åŒæ­¥æœºåˆ¶ã€‚å…¶å…¬å¹³ä¸éå…¬å¹³ç­–ç•¥åˆ†åˆ«ç”±FairSyncå’ŒNonfairSyncå®ç°ã€‚</p>
<p>éå…¬å¹³é”å°è¯•è·å–é”æ—¶ç›´æ¥CASæ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-comment">// éå…¬å¹³å°è¯•ï¼Œç›´æ¥æ’é˜Ÿ</span>
    <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {
        setExclusiveOwnerThread(Thread.currentThread());
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>è€Œå…¬å¹³é”å…ˆæ£€æŸ¥é˜Ÿåˆ—ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-comment">// å…ˆæ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…çº¿ç¨‹</span>
    <span class="hljs-keyword">if</span> (hasQueuedPredecessors())
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// ...å°è¯•CASè·å–</span>
}
</code></pre>
<h3 data-id="heading-14">5.3 è¯»å†™é”å®ç°æŠ€å·§</h3>
<p>ReentrantReadWriteLockä½¿ç”¨stateçš„é«˜16ä½è®°å½•è¯»é”æ•°é‡ï¼Œä½16ä½è®°å½•å†™é”é‡å…¥æ¬¡æ•°ã€‚è¿™ç§ä½è¿ç®—æŠ€å·§ä½¿å•ä¸ªstateå˜é‡èƒ½åŒæ—¶ç®¡ç†ä¸¤ç§é”çŠ¶æ€ã€‚</p>
<p>è¯»é”ï¼ˆå…±äº«é”ï¼‰å…è®¸å¤šçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œå†™é”ï¼ˆç‹¬å é”ï¼‰ä¿è¯äº’æ–¥è®¿é—®ã€‚å½“å†™é”æŒæœ‰æ—¶ï¼Œæ‰€æœ‰è¯»é”è¯·æ±‚è¢«é˜»å¡ï¼›å½“è¯»é”æŒæœ‰æ—¶ï¼Œå†™é”è¯·æ±‚è¢«é˜»å¡ã€‚</p>
<h2 data-id="heading-15">6 AQSå®æˆ˜ï¼šè‡ªå®šä¹‰åŒæ­¥å™¨å¼€å‘</h2>
<h3 data-id="heading-16">6.1 å®ç°ç®€å•çš„äº’æ–¥é”</h3>
<p>ä»¥ä¸‹åŸºäºAQSå®ç°ç®€æ˜“äº’æ–¥é”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMutex</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-comment">// CASå°†stateä»0æ”¹ä¸º1è¡¨ç¤ºè·å–é”</span>
            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {
                setExclusiveOwnerThread(Thread.currentThread());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
            <span class="hljs-keyword">if</span> (getState() == <span class="hljs-number">0</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
            setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
            setState(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> getState() == <span class="hljs-number">1</span>;
        }
        
        <span class="hljs-keyword">public</span> Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionObject</span>();
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Sync</span> <span class="hljs-variable">sync</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sync</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> { sync.acquire(<span class="hljs-number">1</span>); }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> { sync.release(<span class="hljs-number">1</span>); }
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> sync.isHeldExclusively(); }
    <span class="hljs-keyword">public</span> Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> sync.newCondition(); }
}
</code></pre>
<p>æ­¤å®ç°æ¼”ç¤ºäº†AQSçš„åŸºæœ¬ç”¨æ³•ï¼šå­ç±»é‡å†™tryAcquire/tryReleaseå®šä¹‰åŒæ­¥è¯­ä¹‰ï¼Œå¤–éƒ¨ç±»å§”æ‰˜è°ƒç”¨AQSæ¨¡æ¿æ–¹æ³•ã€‚</p>
<h3 data-id="heading-17">6.2 å®ç°é™æµå™¨</h3>
<p>åŸºäºAQSå…±äº«æ¨¡å¼å®ç°ç®€å•çš„é™æµå™¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleLimiter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        Sync(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>) { setState(<span class="hljs-keyword">permits</span>); }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">tryAcquireShared</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-keyword">for</span> (;;) {
                <span class="hljs-type">int</span> <span class="hljs-variable">available</span> <span class="hljs-operator">=</span> getState();
                <span class="hljs-type">int</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> available - acquires;
                <span class="hljs-keyword">if</span> (remaining &lt; <span class="hljs-number">0</span> || 
                    compareAndSetState(available, remaining)) {
                    <span class="hljs-keyword">return</span> remaining;
                }
            }
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryReleaseShared</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
            <span class="hljs-keyword">for</span> (;;) {
                <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> getState();
                <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> current + releases;
                <span class="hljs-keyword">if</span> (next &lt; current) <span class="hljs-comment">// overflow</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum permit count exceeded"</span>);
                <span class="hljs-keyword">if</span> (compareAndSetState(current, next))
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sync sync;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleLimiter</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>)</span> { sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sync</span>(<span class="hljs-keyword">permits</span>); }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        sync.acquireSharedInterruptibly(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">()</span> {
        sync.releaseShared(<span class="hljs-number">1</span>);
    }
}
</code></pre>
<p>æ­¤é™æµå™¨ç±»ä¼¼Semaphoreï¼Œé€šè¿‡stateè¡¨ç¤ºå¯ç”¨è®¸å¯è¯æ•°ï¼Œæ”¯æŒå¤šçº¿ç¨‹åŒæ—¶è·å–ã€‚</p>
<h2 data-id="heading-18">7 AQSè¿›é˜¶ç‰¹æ€§ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-19">7.1 æ¡ä»¶å˜é‡ï¼ˆConditionï¼‰</h3>
<p>AQSé€šè¿‡ConditionObjectå®ç°æ¡ä»¶é˜Ÿåˆ—ï¼Œä¸åŒæ­¥é˜Ÿåˆ—åˆ†ç¦»ã€‚æ¡ä»¶å˜é‡æä¾›æ›´çµæ´»çš„çº¿ç¨‹ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚</p>
<p><strong>await()æµç¨‹</strong>ï¼š</p>
<ol>
<li>é‡Šæ”¾é”ï¼ŒçŠ¶æ€ä¿å­˜</li>
<li>çº¿ç¨‹åŠ å…¥æ¡ä»¶é˜Ÿåˆ—</li>
<li>è¢«signal()å”¤é†’åï¼Œé‡æ–°è·å–é”</li>
</ol>
<p><strong>signal()æµç¨‹</strong>ï¼š</p>
<ol>
<li>å°†æ¡ä»¶é˜Ÿåˆ—é¦–èŠ‚ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—</li>
<li>èŠ‚ç‚¹åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–é”</li>
</ol>
<h3 data-id="heading-20">7.2 è¶…æ—¶ä¸ä¸­æ–­æ§åˆ¶</h3>
<p>AQSæä¾›acquireInterruptibly()å’ŒtryAcquireNanos()æ–¹æ³•ï¼Œæ”¯æŒå¯ä¸­æ–­è·å–å’Œè¶…æ—¶æ§åˆ¶ã€‚è¿™åœ¨é¿å…æ­»é”å’Œå®ç°å“åº”å¼ç³»ç»Ÿæ—¶è‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-21">7.3 æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å‡å°‘é”ç«äº‰</strong>ï¼šç¼©å°ä¸´ç•ŒåŒºï¼Œç¼©çŸ­é”æŒæœ‰æ—¶é—´</li>
<li><strong>é¿å…æ­»é”</strong>ï¼šæŒ‰å›ºå®šé¡ºåºè·å–å¤šä¸ªé”</li>
<li><strong>çŠ¶æ€è®¾è®¡</strong>ï¼šå­ç±»åº”ç¡®ä¿stateæ“ä½œçº¿ç¨‹å®‰å…¨ï¼Œé€šå¸¸ä½¿ç”¨CAS</li>
<li><strong>é¿å…é˜»å¡æ“ä½œ</strong>ï¼štryAcquire()ä¸­ä¸åº”è°ƒç”¨å¯èƒ½é˜»å¡çš„æ–¹æ³•</li>
<li><strong>æ­£ç¡®é‡Šæ”¾</strong>ï¼šç¡®ä¿è·å–é”åæœ€ç»ˆé‡Šæ”¾ï¼Œå»ºè®®try-finallyç»“æ„</li>
</ol>
<h2 data-id="heading-22">8 æ€»ç»“</h2>
<p>AQSä½œä¸ºJavaå¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ï¼Œé€šè¿‡stateçŠ¶æ€ç®¡ç†å’ŒCLHé˜Ÿåˆ—æœºåˆ¶ï¼Œä¸ºæ„å»ºå„ç§åŒæ­¥ç»„ä»¶æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„åŸºç¡€è®¾æ–½ã€‚å…¶æ¨¡æ¿æ–¹æ³•è®¾è®¡ä½¿å¼€å‘è€…èƒ½ä¸“æ³¨äºåŒæ­¥è¯­ä¹‰çš„å®ç°ï¼Œè€Œæ— éœ€å…³æ³¨åº•å±‚çº¿ç¨‹æ’é˜Ÿã€é˜»å¡/å”¤é†’ç­‰å¤æ‚ç»†èŠ‚ã€‚</p>
<p>æŒæ¡AQSä¸ä»…æœ‰åŠ©äºç†è§£Javaå¹¶å‘å·¥å…·çš„å®ç°åŸç†ï¼Œæ›´èƒ½ä¸ºæ„å»ºé«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶å¥ å®šåŸºç¡€ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„åŒæ­¥æ¨¡å¼å’Œç­–ç•¥ï¼Œå¹³è¡¡æ€§èƒ½ä¸å…¬å¹³æ€§éœ€æ±‚ã€‚</p>
<p>AQSçš„è®¾è®¡æ€æƒ³ï¼Œå¦‚CASæ“ä½œã€é˜Ÿåˆ—ç®¡ç†ã€çŠ¶æ€æœºæ§åˆ¶ç­‰ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿã€æ•°æ®åº“è¿æ¥æ± ç­‰åœºæ™¯ä¹Ÿæœ‰å¹¿æ³›åº”ç”¨ï¼Œæ˜¯æ¯ä¸ªJavaå¼€å‘è€…å¿…å¤‡çš„è¿›é˜¶æŠ€èƒ½ã€‚</p>
<hr/>
<p>æ›´å¤šæŠ€æœ¯å¹²è´§æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·â€œ<strong>ç§‘å¨èˆŸçš„AIç¬”è®°</strong>â€~</p>
<p>ã€è½¬è½½é¡»çŸ¥ã€‘ï¼š<strong>è½¬è½½è¯·æ³¨æ˜åŸæ–‡å‡ºå¤„åŠä½œè€…ä¿¡æ¯</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaç”Ÿæ€æ–°çºªå…ƒï¼šè™šæ‹Ÿçº¿ç¨‹ã€æ¨¡å¼åŒ¹é…ä¸æœªæ¥çš„ç¼–ç¨‹èŒƒå¼]]></title>    <link>https://juejin.cn/post/7582862885106319410</link>    <guid>https://juejin.cn/post/7582862885106319410</guid>    <pubDate>2025-12-13T03:09:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582862885106319410" data-draft-id="7582846276506206246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaç”Ÿæ€æ–°çºªå…ƒï¼šè™šæ‹Ÿçº¿ç¨‹ã€æ¨¡å¼åŒ¹é…ä¸æœªæ¥çš„ç¼–ç¨‹èŒƒå¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-13T03:09:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·615126561733"/> <meta itemprop="url" content="https://juejin.cn/user/2561190573653467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaç”Ÿæ€æ–°çºªå…ƒï¼šè™šæ‹Ÿçº¿ç¨‹ã€æ¨¡å¼åŒ¹é…ä¸æœªæ¥çš„ç¼–ç¨‹èŒƒå¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2561190573653467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·615126561733
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:09:23.000Z" title="Sat Dec 13 2025 03:09:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Javaç”Ÿæ€æ–°çºªå…ƒï¼šè™šæ‹Ÿçº¿ç¨‹ã€æ¨¡å¼åŒ¹é…ä¸æœªæ¥çš„ç¼–ç¨‹èŒƒå¼</h2>
<p>Javaï¼Œè¿™é—¨æ‹¥æœ‰è¿‘30å¹´å†å²çš„ç¼–ç¨‹è¯­è¨€ï¼Œå§‹ç»ˆä¿æŒç€æƒŠäººçš„æ´»åŠ›å’Œåˆ›æ–°åŠ›ã€‚å®ƒä¸ä»…æ˜¯ä¼ä¸šçº§åº”ç”¨çš„åŸºçŸ³ï¼Œä¹Ÿåœ¨ä¸æ–­æ‹¥æŠ±ç°ä»£ç¼–ç¨‹èŒƒå¼ï¼Œä»¥åº”å¯¹äº‘åŸç”Ÿã€é«˜å¹¶å‘å’Œå¼€å‘æ•ˆç‡çš„æ–°æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†å¸¦ä½ ä¸€è§ˆJavaç”Ÿæ€ä¸­æœ€æ¿€åŠ¨äººå¿ƒçš„æœ€æ–°æŠ€æœ¯å’Œæœªæ¥å‘å±•è¶‹åŠ¿ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€Project Loomï¼šå¼€å¯é«˜å¹¶å‘ç¼–ç¨‹æ–°èŒƒå¼</h3>
<p>ä¼ ç»ŸJavaå¹¶å‘æ¨¡å‹åŸºäºæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œåˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜æ˜‚ï¼Œé™åˆ¶äº†åº”ç”¨çš„å¹¶å‘èƒ½åŠ›ã€‚Project Loomæ—¨åœ¨é€šè¿‡å¼•å…¥**è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰**å½»åº•è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p>
<p>è™šæ‹Ÿçº¿ç¨‹æ˜¯ç”±JVMç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ï¼Œå…¶åˆ›å»ºæˆæœ¬æä½ï¼ˆå‡ ä¹å¯ä»¥ç¬é—´åˆ›å»ºæ•°ç™¾ä¸‡ä¸ªï¼‰ï¼Œå¹¶ä¸”ç”±å°‘é‡å¹³å°çº¿ç¨‹ï¼ˆå³æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼‰æ¥æ‰¿è½½å’Œè°ƒåº¦ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç”¨åŒæ­¥ã€é˜»å¡çš„ä»£ç é£æ ¼ç¼–å†™é«˜å¹¶å‘ã€é«˜ååé‡çš„åº”ç”¨ï¼Œè€Œæ— éœ€å¤æ‚çš„å¼‚æ­¥å›è°ƒæˆ–Reactiveç¼–ç¨‹æ¨¡å‹ã€‚</p>
<h4 data-id="heading-2">ä»£ç ç¤ºä¾‹ï¼šè™šæ‹Ÿçº¿ç¨‹ vs å¹³å°çº¿ç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨ä¼ ç»Ÿçš„çº¿ç¨‹æ± ï¼ˆå¹³å°çº¿ç¨‹ï¼‰</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10_000</span>; i++) {
    executor.submit(() -&gt; {
        <span class="hljs-comment">// æ¨¡æ‹ŸI/Oæ“ä½œ</span>
        <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}
        System.out.println(<span class="hljs-string">"Task completed"</span>);
    });
}

<span class="hljs-comment">// ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10_000</span>; i++) {
        executor.submit(() -&gt; {
            <span class="hljs-comment">// åŒæ ·çš„I/Oæ“ä½œ</span>
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}
            System.out.println(<span class="hljs-string">"Virtual Task completed"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        });
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨å›ºå®šçº¿ç¨‹æ± å¤„ç†1ä¸‡ä¸ªä»»åŠ¡ä¼šå› ä¸ºçº¿ç¨‹æ•°é‡é™åˆ¶è€Œæ’é˜Ÿæ‰§è¡Œï¼Œè€—æ—¶å¾ˆé•¿ã€‚è€Œä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼Œæ‰€æœ‰ä»»åŠ¡å‡ ä¹å¯ä»¥åŒæ—¶å¼€å§‹æ‰§è¡Œï¼Œæå¤§åœ°æå‡äº†ååé‡ã€‚è‡ªJDK 21èµ·ï¼Œè™šæ‹Ÿçº¿ç¨‹å·²æˆä¸ºæ­£å¼ç‰¹æ€§ï¼Œæ˜¯æ„å»ºä¸‹ä¸€ä»£é«˜æ€§èƒ½æœåŠ¡çš„å…³é”®ã€‚</p>
<h3 data-id="heading-3">äºŒã€Project Valhallaï¼šé‡å¡‘Javaçš„å†…å­˜ä¸æ€§èƒ½æ¨¡å‹</h3>
<p>Project Valhallaçš„ç›®æ ‡æ˜¯é€šè¿‡å¼•å…¥<strong>å€¼ç±»å‹ï¼ˆValue Typesï¼‰<strong>å’Œ</strong>åŸå§‹ç±»ï¼ˆPrimitive Classesï¼‰</strong>ï¼Œæ¶ˆé™¤å¯¹è±¡å¤´å¸¦æ¥çš„å†…å­˜å¼€é”€å’Œé—´æ¥è®¿é—®çš„æ€§èƒ½æŸè€—ã€‚</p>
<p>åœ¨å½“å‰çš„Javaæ¨¡å‹ä¸­ï¼Œå³ä½¿æ˜¯ç®€å•çš„<code>Integer</code>æˆ–<code>Point</code>å¯¹è±¡ï¼Œä¹ŸåŒ…å«ä¸€ä¸ªå¯¹è±¡å¤´ï¼ˆé€šå¸¸12å­—èŠ‚ï¼‰ï¼Œè¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ä¼šé€ æˆå·¨å¤§çš„å†…å­˜æµªè´¹å’Œç¼“å­˜æœªå‘½ä¸­ã€‚å€¼ç±»å‹å…è®¸æˆ‘ä»¬å°†è¿™äº›â€œçº¯æ•°æ®â€çš„å®ä¾‹åƒ<code>int</code>ä¸€æ ·å†…è”å­˜å‚¨ï¼Œæ²¡æœ‰èº«ä»½æ ‡è¯†ï¼Œä»è€Œè·å¾—æ¥è¿‘Cè¯­è¨€çš„å†…å­˜æ•ˆç‡å’Œæ€§èƒ½ã€‚</p>
<p>è™½ç„¶Valhallaå°šæœªå®Œå…¨å‘å¸ƒï¼Œä½†å…¶æ¦‚å¿µå·²ç»æ·±åˆ»å½±å“äº†Javaç¤¾åŒºå¯¹æ€§èƒ½ä¼˜åŒ–çš„æ€è€ƒã€‚</p>
<h3 data-id="heading-4">ä¸‰ã€è¯­æ³•ç³–è¿›åŒ–ï¼šæ›´ç®€æ´ã€æ›´å®‰å…¨çš„ä»£ç </h3>
<p>Javaè¯­è¨€æœ¬èº«ä¹Ÿåœ¨æŒç»­è¿›åŒ–ï¼Œå¼•å…¥äº†è®¸å¤šæå‡å¼€å‘ä½“éªŒçš„è¯­æ³•ç‰¹æ€§ã€‚</p>
<h4 data-id="heading-5">1. æ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰</h4>
<p>ä»JDK 14å¼€å§‹å¼•å…¥å¹¶åœ¨åç»­ç‰ˆæœ¬ä¸­å®Œå–„çš„<code>instanceof</code>æ¨¡å¼åŒ¹é…ï¼Œä»¥åŠJDK 21ä¸­é¢„è§ˆçš„<code>switch</code>æ¨¡å¼åŒ¹é…ï¼Œè®©ç±»å‹æ£€æŸ¥å’Œè§£æ„å˜å¾—å¼‚å¸¸ä¼˜é›…ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JDK 14+ çš„ instanceof æ¨¡å¼åŒ¹é…</span>
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span>) {
    System.out.println(s.toUpperCase());
}

<span class="hljs-comment">// JDK 21+ çš„ switch æ¨¡å¼åŒ¹é…ï¼ˆé¢„è§ˆç‰¹æ€§ï¼‰</span>
<span class="hljs-type">String</span> <span class="hljs-variable">formatted</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (obj) {
    <span class="hljs-keyword">case</span> Integer i -&gt; String.format(<span class="hljs-string">"int %d"</span>, i);
    <span class="hljs-keyword">case</span> String s when s.length() &gt; <span class="hljs-number">0</span> -&gt; String.format(<span class="hljs-string">"String of length %d"</span>, s.length());
    <span class="hljs-keyword">case</span> <span class="hljs-literal">null</span> -&gt; <span class="hljs-string">"null"</span>;
    <span class="hljs-keyword">default</span> -&gt; obj.toString();
};
</code></pre>
<h4 data-id="heading-6">2. Recordç±»</h4>
<p>Recordæ˜¯JDK 14å¼•å…¥çš„ç”¨äºå£°æ˜â€œçº¯æ•°æ®è½½ä½“â€ç±»çš„ç®€æ´æ–¹å¼ã€‚ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆ<code>equals</code>, <code>hashCode</code>, <code>toString</code>ä»¥åŠ<code>getter</code>æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">User</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">30</span>);
System.out.println(user.name()); <span class="hljs-comment">// è‡ªåŠ¨ç”Ÿæˆçš„getter</span>
</code></pre>
<h4 data-id="heading-7">3. å¯†å°ç±»ï¼ˆSealed Classesï¼‰</h4>
<p>å¯†å°ç±»ï¼ˆJDK 17æ­£å¼å‘å¸ƒï¼‰å…è®¸ä½ ç²¾ç¡®æ§åˆ¶å“ªäº›ç±»å¯ä»¥ç»§æ‰¿æˆ–å®ç°æŸä¸ªçˆ¶ç±»/æ¥å£ï¼Œè¿™å¯¹äºæ„å»ºé¢†åŸŸæ¨¡å‹å’Œç¡®ä¿<code>switch</code>è¡¨è¾¾å¼çš„ç©·å°½æ€§éå¸¸æœ‰ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">permits</span> Circle, Rectangle {}
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Shape</span> { <span class="hljs-comment">/* ... */</span> }
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Shape</span> { <span class="hljs-comment">/* ... */</span> }
</code></pre>
<h3 data-id="heading-8">å››ã€GraalVMä¸Native Imageï¼šè¿ˆå‘AOTç¼–è¯‘</h3>
<p>GraalVMæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„é€šç”¨è™šæ‹Ÿæœºï¼Œå…¶æœ€å¼•äººæ³¨ç›®çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯èƒ½å¤Ÿå°†Javaåº”ç”¨ç¨‹åºæå‰ç¼–è¯‘ï¼ˆAOTï¼‰æˆç‹¬ç«‹çš„æœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆNative Imageï¼‰ã€‚è¿™å¸¦æ¥äº†å¯åŠ¨é€Ÿåº¦çš„é£è·ƒï¼ˆæ¯«ç§’çº§ï¼‰å’Œæä½çš„å†…å­˜å ç”¨ï¼Œéå¸¸é€‚åˆå¾®æœåŠ¡ã€Serverlessï¼ˆFaaSï¼‰ç­‰åœºæ™¯ã€‚</p>
<p>å°½ç®¡ç›®å‰åœ¨åå°„ã€åŠ¨æ€ä»£ç†ç­‰æ–¹é¢ä»æœ‰ä¸€äº›é™åˆ¶ï¼Œä½†GraalVMç”Ÿæ€æ­£åœ¨å¿«é€Ÿå‘å±•ï¼ŒSpring Nativeç­‰æ¡†æ¶ä¹Ÿæä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚</p>
<h3 data-id="heading-9">ç»“è¯­</h3>
<p>Javaç”Ÿæ€æ­£å¤„åœ¨ä¸€ä¸ªå‰æ‰€æœªæœ‰çš„åˆ›æ–°é«˜å³°æœŸã€‚ä»åº•å±‚çš„å¹¶å‘æ¨¡å‹ï¼ˆLoomï¼‰ã€å†…å­˜æ¨¡å‹ï¼ˆValhallaï¼‰ï¼Œåˆ°ä¸Šå±‚çš„è¯­è¨€è¯­æ³•ï¼ˆRecords, Sealed Classes, Pattern Matchingï¼‰ï¼Œå†åˆ°è¿è¡Œæ—¶çš„é©æ–°ï¼ˆGraalVMï¼‰ï¼Œæ¯ä¸€é¡¹æŠ€æœ¯éƒ½åœ¨ä¸ºå¼€å‘è€…æä¾›æ›´å¼ºå¤§ã€æ›´é«˜æ•ˆã€æ›´ç®€æ´çš„å·¥å…·ã€‚å¯¹äºJavaå­¦ä¹ è€…è€Œè¨€ï¼Œç´§è·Ÿè¿™äº›è¶‹åŠ¿ï¼Œä¸ä»…èƒ½å†™å‡ºæ›´å¥½çš„ä»£ç ï¼Œæ›´èƒ½æ´å¯Ÿæœªæ¥è½¯ä»¶å·¥ç¨‹çš„å‘å±•æ–¹å‘ã€‚æ‹¥æŠ±å˜åŒ–ï¼ŒJavaçš„æœªæ¥ä¾ç„¶å…‰æ˜ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[huggingface_hub 1.0 æ­£å¼ç‰ˆç°å·²å‘å¸ƒï¼šå¼€æºæœºå™¨å­¦ä¹ åŸºç¡€äº”å‘¨å¹´å›é¡¾]]></title>    <link>https://juejin.cn/post/7582846276506730534</link>    <guid>https://juejin.cn/post/7582846276506730534</guid>    <pubDate>2025-12-13T08:40:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582846276506730534" data-draft-id="7582875640308170802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="huggingface_hub 1.0 æ­£å¼ç‰ˆç°å·²å‘å¸ƒï¼šå¼€æºæœºå™¨å­¦ä¹ åŸºç¡€äº”å‘¨å¹´å›é¡¾"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-13T08:40:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HuggingFace"/> <meta itemprop="url" content="https://juejin.cn/user/611789528634712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            huggingface_hub 1.0 æ­£å¼ç‰ˆç°å·²å‘å¸ƒï¼šå¼€æºæœºå™¨å­¦ä¹ åŸºç¡€äº”å‘¨å¹´å›é¡¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/611789528634712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HuggingFace
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T08:40:38.000Z" title="Sat Dec 13 2025 08:40:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>ç®€è¦æ€»ç»“ï¼š</strong> ç»è¿‡äº”å¹´çš„æŒç»­å¼€å‘ï¼Œ<code>huggingface_hub</code> å‘å¸ƒ v1.0 æ­£å¼ç‰ˆï¼è¿™ä¸€é‡Œç¨‹ç¢‘æ ‡å¿—ç€è¿™ä¸ªåº“çš„æˆç†Ÿä¸ç¨³å®šã€‚å®ƒå·²æˆä¸º Python ç”Ÿæ€ä¸­æ”¯æ’‘ <strong>20 ä¸‡ä¸ªä¾èµ–åº“</strong> çš„æ ¸å¿ƒç»„ä»¶ï¼Œå¹¶æä¾›è®¿é—®è¶…è¿‡ <strong>200 ä¸‡å…¬å¼€æ¨¡å‹</strong>ã€<strong>50 ä¸‡å…¬å¼€æ•°æ®é›†</strong> å’Œ <strong>100 ä¸‡ Space åº”ç”¨</strong> çš„åŸºç¡€èƒ½åŠ›ã€‚æœ¬æ¬¡æ›´æ–°åŒ…å«ä¸ºæ”¯æŒæœªæ¥åå¹´å¼€æºæœºå™¨å­¦ä¹ ç”Ÿæ€è€Œåšå‡ºçš„é‡å¤§å˜æ›´ï¼Œç”±è¿‘ 300 ä½è´¡çŒ®è€…å’Œæ•°ç™¾ä¸‡ç”¨æˆ·å…±åŒæ¨åŠ¨å‘å±•ã€‚</p>
<p><strong>ğŸš€ å¼ºçƒˆå»ºè®®å°½å¿«å‡çº§è‡³ v1.0ï¼Œä»¥ä½“éªŒæ›´ä¼˜æ€§èƒ½å’Œå…¨æ–°åŠŸèƒ½ã€‚</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install --upgrade huggingface_hub
</code></pre>
<p>æ­¤æ¬¡é‡å¤§ç‰ˆæœ¬æ›´æ–°åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>httpx</code> ä½œä¸ºæ–°åç«¯è¯·æ±‚åº“ï¼›</li>
<li>å…¨æ–°è®¾è®¡çš„ <code>hf</code> å‘½ä»¤è¡Œå·¥å…·ï¼ˆå–ä»£å·²å¼ƒç”¨çš„ <code>huggingface-cli</code>ï¼‰ï¼Œé‡‡ç”¨ Typer æ„å»ºï¼ŒåŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼›</li>
<li>æ–‡ä»¶ä¼ è¾“å…¨é¢è¿ç§»è‡³ <code>hf_xet</code>ï¼Œå½»åº•æ·˜æ±°æ—§çš„ <code>hf_transfer</code> å·¥å…·ã€‚</li>
</ul>
<p>æŸ¥çœ‹å®Œæ•´çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv1.0.0" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v1.0.0" ref="nofollow noopener noreferrer">v1.0 å‘å¸ƒè¯´æ˜</a></p>
<blockquote>
<p>æˆ‘ä»¬å°½å¯èƒ½ç¡®ä¿ v1.0.0 ä¸æ—§ç‰ˆæœ¬å…¼å®¹ã€‚å¤§å¤šæ•°æœºå™¨å­¦ä¹ åº“æ— éœ€ä¿®æ”¹å³å¯å…¼å®¹ v0.x å’Œ v1.xã€‚ä¸»è¦ä¾‹å¤–æ˜¯ <code>transformers</code>ï¼šv4 ç‰ˆæœ¬ä¾èµ– v0.xï¼Œè®¡åˆ’ä¸­çš„ v5 å°†è½¬å‘ v1.xã€‚æŸ¥çœ‹æ­¤ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Fissues%2F3340" target="_blank" title="https://github.com/huggingface/huggingface_hub/issues/3340" ref="nofollow noopener noreferrer">issue</a> è·å–è¯¦ç»†çš„åº“å…¼å®¹æ€§è¡¨ã€‚</p>
</blockquote>
<h2 data-id="heading-0">èƒŒåçš„æ•…äº‹</h2>
<p>æ¯ä¸ªä¸»æµåº“èƒŒåéƒ½æœ‰ä¸€æ®µæ•…äº‹ã€‚<code>huggingface_hub</code> çš„æ•…äº‹å§‹äºä¸€ä¸ªç®€å•çš„æƒ³æ³•ï¼š<strong>å¦‚æœå…±äº«æœºå™¨å­¦ä¹ æ¨¡å‹åƒåœ¨ GitHub ä¸Šåˆ†äº«ä»£ç ä¸€æ ·å®¹æ˜“ï¼Œä¼šæ€æ ·ï¼Ÿ</strong></p>
<p>åœ¨ Hugging Face Hub çš„æ—©æœŸé˜¶æ®µï¼Œç ”ç©¶äººå‘˜å’Œå¼€å‘è€…å¸¸å¸¸é¢ä¸´ä¸€ä¸ªå›°æ‰°ï¼š
è®­ç»ƒä¸€ä¸ªå…ˆè¿›çš„æ¨¡å‹ä¸ä»…è€—æ—¶ã€è€—èµ„æºï¼Œè€Œä¸”åœ¨è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹å¾€å¾€â€œè¢«å›°â€åœ¨ä¸ªäººç”µè„‘é‡Œï¼Œåªèƒ½é€šè¿‡ä¸ç¨³å®šçš„ Google Drive é“¾æ¥è¿›è¡Œåˆ†äº«ã€‚
è¿™å¯¼è‡´ç¤¾åŒºé‡å¤é€ è½®å­ï¼Œèµ„æºæµªè´¹ä¸¥é‡ï¼Œåä½œæ•ˆç‡æä½ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒHugging Face Hub åº”è¿è€Œç”Ÿã€‚æœ€åˆï¼Œå®ƒçš„åŠŸèƒ½å¾ˆç®€å•ï¼Œåªæ˜¯ç”¨äºå…±äº«å’Œæ‰˜ç®¡ä¸ <code>transformers</code> åº“å…¼å®¹çš„æ¨¡å‹æ£€æŸ¥ç‚¹ã€‚è€Œä¸ Hub äº¤äº’çš„å…¨éƒ¨ Python é€»è¾‘ä»£ç ï¼Œä¹Ÿéƒ½å†…ç½®åœ¨ <code>transformers</code> åº“ä¸­ï¼Œå…¶ä»–åº“æ— æ³•å¤ç”¨è¿™äº›åŠŸèƒ½ã€‚</p>
<p>ç›´åˆ° 2020 å¹´åº•ï¼Œæˆ‘ä»¬æ¨å‡ºäº† <code>huggingface_hub</code> çš„é¦–ä¸ªç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.0.1" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.0.1" ref="nofollow noopener noreferrer">v0.0.1</a>ï¼Œå®ƒçš„åˆè¡·æ˜¯ï¼šå°†åŸæœ¬å°è£…åœ¨ <code>transformers</code> åº“ä¸­çš„å†…éƒ¨é€»è¾‘ç‹¬ç«‹å‡ºæ¥ï¼Œæ„å»ºä¸€ä¸ªä¸“ç”¨åº“ï¼Œç”¨äºç»Ÿä¸€è®¿é—®å’Œå…±äº« Hugging Face Hub ä¸Šçš„æœºå™¨å­¦ä¹ æ¨¡å‹ä¸æ•°æ®é›†ã€‚æœ€æ—©çš„ç‰ˆæœ¬éå¸¸ç®€æ´ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª Git æ“ä½œçš„å°è£…å·¥å…·ï¼Œç”¨äºä¸‹è½½æ–‡ä»¶å’Œç®¡ç†ä»“åº“ã€‚ä½†äº”å¹´è¿‡å»ï¼Œå†ç» 35+ ä¸ªç‰ˆæœ¬è¿­ä»£ï¼Œ<code>huggingface_hub</code> å·²è¿œè¿œè¶…è¶Šæœ€åˆçš„è®¾æƒ³ã€‚</p>
<p>è®©æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾è¿™æ®µå‘å±•å†ç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9edc43755ee64e6289f6adcc3bb98468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVnZ2luZ0ZhY2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766220038&amp;x-signature=7yR%2BJCcZSTlUDWXEBtVpXILKLi0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">å¥ åŸºé˜¶æ®µï¼ˆ2020â€“2021ï¼‰</h3>
<p>æœ€åˆçš„å‡ ä¸ªç‰ˆæœ¬ä¸ºæ•´ä¸ªåº“æ‰“ä¸‹äº†åŸºç¡€ã€‚
ç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.0.8" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.0.8" ref="nofollow noopener noreferrer">0.0.8</a> å¼•å…¥äº†ç¬¬ä¸€ä¸ª APIï¼Œé€šè¿‡å°è£… Git å‘½ä»¤ï¼Œå®ç°ä¸æ¨¡å‹ä»“åº“çš„äº¤äº’ã€‚
æ¥ç€åœ¨ç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.0.17" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.0.17" ref="nofollow noopener noreferrer">0.0.17</a> ä¸­ï¼ŒåŠ å…¥äº†åŸºäº token çš„è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒè®¿é—®ç§æœ‰ä»“åº“å¹¶å®‰å…¨ä¸Šä¼ å†…å®¹ã€‚
è™½ç„¶è¿™äº›åŠŸèƒ½çœ‹èµ·æ¥å¾ˆåŸºç¡€ï¼Œä½†å®ƒä»¬æ„æˆäº†åæ¥æ‰€æœ‰è¿›æ­¥çš„åŸºçŸ³ã€‚</p>
<h3 data-id="heading-2">é‡è¦è½¬æŠ˜ï¼šä» Git åˆ° HTTPï¼ˆ2022ï¼‰</h3>
<p>2022 å¹´ 6 æœˆï¼Œç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.8.1" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.8.1" ref="nofollow noopener noreferrer">0.8.1</a> å‘å¸ƒï¼Œè¿™æ˜¯ Hugging Face Hub å‘å±•å²ä¸Šçš„ä¸€ä¸ªè½¬æŠ˜ç‚¹â€”â€”æˆ‘ä»¬å¼•å…¥äº† HTTP Commit APIã€‚</p>
<p>ä»æ­¤ï¼Œç”¨æˆ·æ— éœ€å†å®‰è£… Git å’Œ Git LFSï¼Œä¹Ÿèƒ½ç›´æ¥é€šè¿‡ HTTP ä¸Šä¼ æ–‡ä»¶ã€‚æ–°æ¨å‡ºçš„ <code>create_commit()</code> API æå¤§ç®€åŒ–äº†ä¸Šä¼ æµç¨‹ï¼Œå°¤å…¶é€‚åˆå¤„ç†å¤§å‹æ¨¡å‹æ–‡ä»¶â€”â€”è¿™äº›æ–‡ä»¶è¿‡å»é€šè¿‡ Git LFS æ“ä½œèµ·æ¥ååˆ†ç¹çã€‚</p>
<p>æ­¤å¤–ï¼Œè¯¥ç‰ˆæœ¬è¿˜å¼•å…¥äº†æ”¯æŒ Git ç»“æ„æ„ŸçŸ¥çš„ç¼“å­˜æœºåˆ¶ã€‚æ‰€æœ‰ä½¿ç”¨ <code>huggingface_hub</code> çš„åº“ï¼ˆæ— è®ºæ˜¯å®˜æ–¹çš„ transformersï¼Œè¿˜æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼‰ç°åœ¨éƒ½èƒ½å…±äº«åŒä¸€å¥—ç¼“å­˜ç³»ç»Ÿï¼Œå…·å¤‡æ˜¾å¼çš„ç‰ˆæœ¬æ§åˆ¶å’Œæ–‡ä»¶å»é‡åŠŸèƒ½ã€‚</p>
<p>è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡æŠ€æœ¯ä¼˜åŒ–ï¼Œæ›´æ˜¯ä¸€æ¬¡ç†å¿µä¸Šçš„é£è·ƒã€‚
æˆ‘ä»¬ä¸å†åªæ˜¯ä¸º transformers æ„å»º Git å·¥å…·ï¼Œè€Œæ˜¯åœ¨æ„å»ºä¸€å¥—ä¸“ä¸ºæœºå™¨å­¦ä¹ æ¨¡å‹å’Œæ•°æ®æ‰“é€ çš„åŸºç¡€è®¾æ–½ï¼Œé¢å‘æ•´ä¸ªæœºå™¨å­¦ä¹ ç”Ÿæ€æœåŠ¡ã€‚</p>
<h3 data-id="heading-3">API èƒ½åŠ›çš„å…¨é¢æ‰©å±•ï¼ˆ2022â€“2024ï¼‰</h3>
<p>éšç€ Hugging Face Hub ä»ä¸€ä¸ªæ¨¡å‹ä»“åº“é€æ­¥å‘å±•ä¸ºä¸€ä¸ªå®Œæ•´çš„å¹³å°ï¼Œ<code>huggingface_hub</code> çš„ API èƒ½åŠ›ä¹Ÿä¸æ–­æ‹“å±•ï¼Œæ»¡è¶³æ›´å¤šåœºæ™¯éœ€æ±‚ã€‚</p>
<p>æ ¸å¿ƒçš„ä»“åº“æ“ä½œåŠŸèƒ½ä¸æ–­æˆç†Ÿï¼Œæ”¯æŒï¼š</p>
<ul>
<li>åˆ—å‡ºæ–‡ä»¶æ ‘ï¼ˆlist treeï¼‰</li>
<li>æµè§ˆå¼•ç”¨ï¼ˆrefsï¼‰ä¸æäº¤è®°å½•ï¼ˆcommitsï¼‰</li>
<li>è¯»å–æ–‡ä»¶æˆ–åŒæ­¥æ•´ä¸ªæ–‡ä»¶å¤¹</li>
<li>ç®¡ç†æ ‡ç­¾ã€åˆ†æ”¯å’Œå‘å¸ƒå‘¨æœŸï¼ˆrelease cycleï¼‰</li>
<li>æŸ¥è¯¢ä»“åº“å…ƒæ•°æ®ä¸è®¾ç½® webhookï¼Œå¸®åŠ©å›¢é˜Ÿå®æ—¶å“åº”å˜æ›´</li>
</ul>
<p>ä¸æ­¤åŒæ—¶ï¼ŒHub ä¸Šçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Fmanage-spaces" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/manage-spaces" ref="nofollow noopener noreferrer">Spaces</a> åŠŸèƒ½å¼€å§‹å´­éœ²å¤´è§’ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•å´å¼ºå¤§çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥åœ¨ Hub ä¸Šæ‰˜ç®¡å’Œåˆ†äº«äº¤äº’å¼çš„æœºå™¨å­¦ä¹ æ¼”ç¤ºé¡¹ç›®ã€‚<code>huggingface_hub</code> ä¹Ÿé€æ­¥å®ç°äº†å¯¹ Spaces çš„å®Œæ•´ç¨‹åºåŒ–ç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬ç¡¬ä»¶èµ„æºç”³è¯·ã€ç¯å¢ƒé…ç½®ã€å¯†é’¥ç®¡ç†ã€æ–‡ä»¶ä¸Šä¼ ç­‰ã€‚</p>
<p>ä¸ºäº†æ”¯æŒæ¨¡å‹åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„éƒ¨ç½²ï¼Œæˆ‘ä»¬è¿˜é›†æˆäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Finference_endpoints" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/inference_endpoints" ref="nofollow noopener noreferrer">Inference Endpoints</a>ã€‚è€Œåœ¨ 2025 å¹´ç¬¬ä¸‰å­£åº¦ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Fjobs" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/jobs" ref="nofollow noopener noreferrer">Jobs API</a> çš„åŠ å…¥ï¼Œè¿›ä¸€æ­¥å®Œå–„äº† Hugging Face çš„è®¡ç®—æœåŠ¡èƒ½åŠ›ã€‚</p>
<p>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œç¤¾åŒºä¸ç¤¾äº¤å±‚ä¹Ÿè¢«æå‡ä¸ºä¸€ç­‰å…¬æ°‘ã€‚ç°åœ¨æ”¯æŒï¼š</p>
<ul>
<li>åˆ›å»ºå’Œç®¡ç† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Fcommunity" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/community" ref="nofollow noopener noreferrer">Pull Requests å’Œè¯„è®º</a></li>
<li>æŸ¥è¯¢ç”¨æˆ·ä¸ç»„ç»‡ä¿¡æ¯</li>
<li>ä»“åº“ç‚¹èµã€å…³æ³¨ã€ç²‰ä¸åŠŸèƒ½</li>
<li>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Fcollections" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/collections" ref="nofollow noopener noreferrer">Collections</a> æ•´ç†å’Œåˆ†äº«èµ„æºåˆé›†</li>
</ul>
<p>åŒæ—¶ï¼Œæ—¥å¸¸ä½¿ç”¨ä½“éªŒä¹Ÿå¾—åˆ°äº†æ˜¾è‘—ä¼˜åŒ–ï¼šColab ä¸­çš„æ— ç¼è®¤è¯ã€å¤§å‹æ–‡ä»¶å¤¹ä¸Šä¼ çš„å¯é æ€§æå‡ã€æ”¯æŒæ–­ç‚¹ç»­ä¼ ç­‰åŠŸèƒ½ï¼Œä½¿å¼€å‘æ›´åŠ é«˜æ•ˆæµç•…ã€‚</p>
<p>éšåï¼Œåœ¨ç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.28.0" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.28.0" ref="nofollow noopener noreferrer">v0.28.0</a> ä¸­ï¼Œæˆ‘ä»¬æ¨å‡ºäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Finference" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/inference" ref="nofollow noopener noreferrer">æ¨ç†æœåŠ¡æä¾›æ–¹ç”Ÿæ€</a>ã€‚ä¸å†ä¾èµ–å•ä¸€çš„æ¨ç†åç«¯ï¼Œè€Œæ˜¯ä¸å¤šå®¶æ— æœåŠ¡å™¨æ¨ç†å¹³å°åˆä½œï¼ŒåŒ…æ‹¬ Together AIã€SambaNovaã€Replicateã€Cerebrasã€Groq ç­‰ï¼Œç”¨æˆ·é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„ API å³å¯è°ƒç”¨å¤šä¸ªåç«¯ï¼Œè·¯ç”±é€æ˜ï¼ŒæŒ‰è¯·æ±‚è®¡è´¹ï¼ŒçœŸæ­£å®ç°äº†â€œæŒ‰éœ€è°ƒç”¨ï¼Œè½»æ¾æ¨ç†â€ã€‚</p>
<h3 data-id="heading-4">Ready. Xet. Go!ï¼ˆ2024â€“2025ï¼‰</h3>
<p>åœ¨ç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.30.0" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.30.0" ref="nofollow noopener noreferrer">v0.30.0</a> ä¸­ï¼Œæˆ‘ä»¬å‘å¸ƒäº† Xet â€”â€” ä¸€ç§é¢ è¦†æ€§çš„ Git å¤§æ–‡ä»¶å­˜å‚¨åè®®ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„ Git LFSï¼ˆåªæ”¯æŒæ–‡ä»¶çº§å»é‡ï¼‰ä¸åŒï¼ŒXet åœ¨æ›´ç²¾ç»†çš„ç²’åº¦ï¼ˆæ¯ 64KB ä¸ºä¸€å—ï¼‰è¿›è¡Œæ•°æ®å»é‡ä¸ä¼ è¾“ä¼˜åŒ–ã€‚å½“ä½ æ›´æ–°ä¸€ä¸ªå¤§å‹æ¨¡å‹æˆ–æ•°æ®æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿåªä¼šä¸Šä¼ æˆ–ä¸‹è½½å‘ç”Ÿå˜æ›´çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–‡ä»¶ã€‚</p>
<p>è¿™åœº<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fspaces%2Fjsulz%2Fready-xet-go" target="_blank" title="https://huggingface.co/spaces/jsulz/ready-xet-go" ref="nofollow noopener noreferrer">å¤§è§„æ¨¡è¿ç§»</a> å§‹äº 50 å¤šä¸‡ä¸ªä»“åº“ï¼Œæ¶‰åŠè¶…è¿‡ 20PB çš„æ•°æ®ã€‚ä½†ä»¤äººæƒŠå–œçš„æ˜¯ï¼Œè¿™ä¸€è¿ç§»è¿‡ç¨‹å¯¹ç”¨æˆ·æ˜¯å®Œå…¨é€æ˜çš„ï¼Œ100% å‘åå…¼å®¹ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œä¹Ÿæ²¡æœ‰ä¸­æ–­ç°æœ‰æµç¨‹ã€‚</p>
<p>ä¸€å¹´åï¼Œè¶…è¿‡ <strong>6,000,000 ä¸ªä»“åº“</strong>ã€<strong>77PB+</strong> çš„æ•°æ®å·²æˆåŠŸè¿ç§»è‡³ Xet åç«¯ï¼Œå¸¦æ¥äº†æ›´å¿«ã€æ›´æ™ºèƒ½çš„ä¸Šä¼ ä¸ä¸‹è½½ä½“éªŒ ğŸ”¥</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3765e1c8418484eb425b2e1f9535404~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVnZ2luZ0ZhY2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766220038&amp;x-signature=wtT%2Fz%2Ftw%2BvpLT7HwxLmKKoo%2FKxA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">æˆé•¿ä¸å½±å“åŠ›è¡¡é‡</h2>
<p>è¡¡é‡ä¸€ä¸ªå¼€æºåº“çš„æˆé•¿å’Œå½±å“åŠ›å¹¶ä¸å®¹æ˜“ï¼Œä½†æœ‰æ—¶ï¼Œæ•°å­—æœ¬èº«å°±æ˜¯æœ€å¥½çš„è¯æ˜ï¼š</p>
<ul>
<li><strong>æ¯æœˆä¸‹è½½é‡è¾¾ 1.135 äº¿æ¬¡</strong>ï¼Œ<strong>ç´¯è®¡ä¸‹è½½è¶… 16 äº¿æ¬¡</strong>ï¼ˆæˆªè‡³ 2025 å¹´ 10 æœˆï¼‰</li>
<li>æä¾›è®¿é—® <strong>200 ä¸‡+ å…¬å…±æ¨¡å‹</strong>ã€<strong>50 ä¸‡+ å…¬å…±æ•°æ®é›†</strong> å’Œ <strong>100 ä¸‡+ å…¬å…± Spaces</strong> â€”â€” å¦‚æœåŒ…æ‹¬ç§æœ‰ä»“åº“ï¼Œæ€»é‡å¤§çº¦ç¿»å€</li>
<li>æ¯æ—¥æ´»è·ƒç”¨æˆ·è¶…è¿‡ <strong>6 ä¸‡äºº</strong>ï¼Œæ¯æœˆæ´»è·ƒç”¨æˆ·è¶…è¿‡ <strong>55 ä¸‡äºº</strong></li>
<li>è¢«å…¨çƒ <strong>20 ä¸‡+ ä¼ä¸š</strong> ä¿¡èµ–ä½¿ç”¨ï¼Œä»åˆåˆ›å…¬å¸åˆ°ã€Šè´¢å¯Œã€‹500 å¼ºä¼ä¸š</li>
</ul>
<p>ä½†çœŸæ­£ä½“ç°å…¶è§„æ¨¡çš„ï¼Œæ˜¯æ•´ä¸ªç”Ÿæ€çš„å¹¿åº¦å’Œæ·±åº¦ã€‚<code>huggingface_hub</code> å·²æˆä¸º GitHub ä¸Š <strong>è¶…è¿‡ 20 ä¸‡ä¸ªä»“åº“</strong> å’Œ PyPI ä¸Š <strong>3,000 ä¸ªè½¯ä»¶åŒ…</strong> çš„ <strong>ä¾èµ–æ ¸å¿ƒ</strong> ï¼Œæ¶µç›–ä¸»æµæ¡†æ¶å¦‚ Kerasã€LangChainã€PaddleOCRã€ChatTTSã€YOLOã€Google Generative AIã€Moshiã€NVIDIA NeMoã€Open Sora ç­‰ï¼Œè¿˜æœ‰æ— æ•°å°å‹å·¥å…·ä¸é¡¹ç›®ã€‚Hugging Face è‡ªå®¶ç”Ÿæ€ï¼ˆå¦‚ transformersã€diffusersã€datasetsã€sentence-transformersã€gradioã€peftã€trl ç­‰ï¼‰ä¹Ÿéƒ½å»ºç«‹åœ¨å…¶ä¹‹ä¸Šã€‚</p>
<p>æœ€ä»¤äººæ¬£æ…°çš„æ˜¯ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹é›†æˆå¤§å¤šæ•°éƒ½æ˜¯è‡ªç„¶å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬å¹¶æœªä¸»åŠ¨æ¨åŠ¨ã€‚è¿™æ­£æ˜¯ Hugging Face Hub é‡Šæ”¾åŠ›é‡çš„ä½“ç°â€”â€”å®ƒè®©æ•´ä¸ªæœºå™¨å­¦ä¹ ç¤¾åŒºèƒ½å¤Ÿæ›´åŠ å¼€æ”¾ã€é«˜æ•ˆåœ°åä½œä¸åˆ›æ–°ï¼Œè€Œå®ƒå¦‚ä»Šçš„å¹¿æ³›ä½¿ç”¨ç¨‹åº¦ï¼Œä¹Ÿè¿œè¶…æˆ‘ä»¬çš„æœ€åˆé¢„æœŸã€‚</p>
<h2 data-id="heading-6">é¢å‘æœªæ¥åå¹´çš„æ„å»º</h2>
<p>v1.0 ä¸åªæ˜¯ä¸€ä¸ªç‰ˆæœ¬å·çš„è·ƒè¿ï¼Œå®ƒä»£è¡¨çš„æ˜¯ï¼š<strong>ä¸ºæœªæ¥åå¹´å¼€æ”¾å¼æœºå™¨å­¦ä¹ å¥ å®šåšå®åŸºç¡€</strong>ã€‚æˆ‘ä»¬åšå‡ºçš„ç ´åæ€§æ›´æ–°å¹¶ééšæ„ä¸ºä¹‹ï¼Œè€Œæ˜¯å‡ºäºæˆ˜ç•¥è€ƒè™‘ï¼Œä¸ºäº†è®© <code>huggingface_hub</code> èƒ½å¤Ÿåº”å¯¹ AI çš„é«˜é€Ÿå‘å±•ï¼Œå¹¶ä¿æŒå…¨çƒæ•°ç™¾ä¸‡å¼€å‘è€…æ‰€ä¾èµ–çš„ç¨³å®šæ€§ä¸å¯é æ€§ã€‚</p>
<h3 data-id="heading-7">ç°ä»£åŒ– HTTP æ¶æ„ï¼šhttpx ä¸ hf_xet</h3>
<p>v1.0 æœ€é‡è¦çš„æ¶æ„å˜æ›´ï¼Œæ˜¯å°†åº•å±‚ HTTP è¯·æ±‚åº“ä» <code>requests</code> è¿ç§»è‡³ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python-httpx.org%2F" target="_blank" title="https://www.python-httpx.org/" ref="nofollow noopener noreferrer"><code>httpx</code></a>ã€‚è¿™ä¸ä»…æ˜¯ä¾èµ–é¡¹çš„æ›¿æ¢ï¼Œè€Œæ˜¯ä¸€æ¬¡çœŸæ­£æ„ä¹‰ä¸Šçš„å‡çº§ï¼Œä½¿æ•´ä¸ªåº“æ­£å¼è¿ˆå…¥ç°ä»£ HTTP æ—¶ä»£ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹© httpxï¼Ÿ</strong>
å®ƒå¸¦æ¥çš„å¥½å¤„éå¸¸æ˜¾è‘—ï¼š</p>
<ul>
<li>åŸç”Ÿæ”¯æŒ HTTP/2ï¼Œè¿æ¥æ•ˆç‡æ›´é«˜</li>
<li>å®Œæ•´çš„çº¿ç¨‹å®‰å…¨ï¼Œå¯åœ¨å¤šçº¿ç¨‹é—´å®‰å…¨å¤ç”¨è¿æ¥</li>
<li>æœ€å…³é”®çš„æ˜¯ï¼šæä¾›ç»Ÿä¸€çš„åŒæ­¥ä¸å¼‚æ­¥æ¥å£ï¼Œå½»åº•æ¶ˆé™¤åŸå…ˆåŒæ­¥ä¸å¼‚æ­¥æ¨ç†å®¢æˆ·ç«¯ä¹‹é—´çš„å¾®å¦™å·®å¼‚</li>
</ul>
<p>æ­¤æ¬¡è¿ç§»çš„è®¾è®¡å°½å¯èƒ½åšåˆ°â€œå¯¹ç”¨æˆ·é€æ˜â€ï¼Œå¤§å¤šæ•°ç”¨æˆ·æ— éœ€åšä»»ä½•ä¿®æ”¹ã€‚å¯¹äºä½¿ç”¨è‡ªå®šä¹‰ HTTP åç«¯çš„å¼€å‘è€…ï¼Œæˆ‘ä»¬æä¾›äº†æ¸…æ™°çš„è¿ç§»è·¯å¾„ï¼Œå°† <code>configure_http_backend()</code> æ›¿æ¢ä¸º <code>set_client_factory()</code> æˆ– <code>set_async_client_factory()</code>ã€‚</p>
<p>åŒæ—¶ï¼Œ<code>hf_xet</code> ç°å·²æˆä¸º Hub ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶çš„é»˜è®¤å·¥å…·åŒ…ï¼Œå®Œå…¨å–ä»£æ­¤å‰çš„å¯é€‰æ–¹æ¡ˆ <code>hf_transfer</code>ï¼Œåè€…å·²è¢«å½»åº•ç§»é™¤ã€‚</p>
<h3 data-id="heading-8">MCP ä¸ Tiny-Agentsï¼šè®©æ™ºèƒ½ä½“å¼€å‘è§¦æ‰‹å¯åŠ</h3>
<p>åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.32.0" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.32.0" ref="nofollow noopener noreferrer">v0.32.0</a> ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº† <strong>Model Context Protocolï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ŒMCPï¼‰é›†æˆ</strong> å’Œ <strong>tiny-agents å·¥å…·é“¾</strong>ï¼Œè¿™ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†æ„å»º AI Agent çš„æ–¹å¼ã€‚æ›¾ç»éœ€è¦å¤æ‚æ¡†æ¶é›†æˆçš„ä»»åŠ¡ï¼Œå¦‚ä»Šåªéœ€å¤§çº¦ 70 è¡Œ Python ä»£ç å³å¯å®Œæˆã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fpackage_reference%2Fmcp" target="_blank" title="https://huggingface.co/docs/huggingface_hub/package_reference/mcp" ref="nofollow noopener noreferrer"><code>MCPClient</code></a> æä¾›äº†ä¸€ä¸ªæ ‡å‡†åŒ–æ¥å£ï¼Œä½¿ AI Agent èƒ½å¤Ÿè½»æ¾ä¸å„ç§å·¥å…·è¿›è¡Œäº¤äº’ï¼›è€Œ <code>tiny-agents</code> CLI å·¥å…·åˆ™å…è®¸ä½ ç›´æ¥ä» Hub å¯åŠ¨ Agentã€‚ä½ å¯ä»¥è¿æ¥æœ¬åœ°æˆ–è¿œç¨‹ MCP æœåŠ¡å™¨ï¼Œå°†ä»»æ„ Gradio Space ç”¨ä½œå·¥å…·ï¼Œå¹¶æ„å»ºå‡ºè‡ªç„¶ã€æµç•…ã€å“åº”è¿…é€Ÿçš„å¯¹è¯å¼æ™ºèƒ½ä½“ã€‚</p>
<p>æ‰€æœ‰è¿™äº›ï¼Œéƒ½æ˜¯åœ¨æˆ‘ä»¬ç°æœ‰çš„ <code>InferenceClient</code> ä»¥åŠå…¶æ”¯æŒçš„å¤šå®¶æ¨ç†æœåŠ¡å•†çš„åŸºç¡€ä¸Šæ„å»ºçš„ã€‚æˆ‘ä»¬åšä¿¡ Agent æ˜¯æœªæ¥ï¼Œè€Œ <code>huggingface_hub</code> å°†æŒç»­æä¾›è¿™äº›æ„å»º AI å·¥å…·çš„åŸºç¡€æ¨¡å—ï¼ŒåŠ©åŠ›å¼€å‘è€…å¿«é€Ÿè½åœ°åˆ›æ–°æƒ³æ³•ã€‚</p>
<h3 data-id="heading-9">é¢å‘ç°ä»£å·¥ä½œæµçš„å…¨åŠŸèƒ½å‘½ä»¤è¡Œå·¥å…·</h3>
<p>Hugging Face çš„ CLI å·¥å…·å·²ç»ä»ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå‘å±•ä¸ºä¸€ä¸ª <strong>åŠŸèƒ½å…¨é¢çš„æœºå™¨å­¦ä¹ æ“ä½œæ¥å£</strong>ã€‚å…¨æ–°è®¾è®¡çš„ <code>hf</code> å‘½ä»¤å–ä»£äº†è€æ—§çš„ <code>huggingface-cli</code>ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„â€œèµ„æº-åŠ¨ä½œâ€æ¨¡å¼ï¼š</p>
<ul>
<li><code>hf auth login</code>ï¼šç”¨æˆ·è®¤è¯</li>
<li><code>hf download</code> å’Œ <code>hf upload</code>ï¼šæ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½</li>
<li><code>hf repo</code>ï¼šä»“åº“ç®¡ç†</li>
<li><code>hf cache ls</code> å’Œ <code>hf cache rm</code>ï¼šç¼“å­˜ç®¡ç†</li>
<li><code>hf jobs run</code>ï¼šè¿è¡Œäº‘ç«¯è®¡ç®—ä»»åŠ¡</li>
</ul>
<p>CLI æä¾›äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Finstallation%23install-the-hugging-face-cli" target="_blank" title="https://huggingface.co/docs/huggingface_hub/installation#install-the-hugging-face-cli" ref="nofollow noopener noreferrer">æ²™ç®±å¼å®‰è£…å™¨</a>ï¼Œå¯ä»¥åœ¨ä¸ç ´åç°æœ‰å¼€å‘ç¯å¢ƒçš„å‰æä¸‹å¿«é€Ÿå®‰è£…æˆ–å‡çº§ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS æˆ– Linux</span>
curl -LsSf https://hf.co/cli/install.sh | sh

<span class="hljs-comment"># Windows</span>
powershell -ExecutionPolicy ByPass -c <span class="hljs-string">"irm https://hf.co/cli/install.ps1 | iex"</span>
</code></pre>
<p>CLI è¿˜æ”¯æŒå‘½ä»¤è‡ªåŠ¨è¡¥å…¨ï¼Œå¹¶åœ¨å„å¤§ä¸»æµå¹³å°ä¸Šéƒ½èƒ½é¡ºåˆ©è¿è¡Œã€‚å¦‚ä»Šçš„ Hugging Face CLIï¼Œå·²ç»å…·å¤‡ä¸ç°ä»£å¼€å‘å·¥å…·åª²ç¾çš„ä½“éªŒå’Œæ˜“ç”¨æ€§ã€‚</p>
<h3 data-id="heading-10">ä¸ºæœªæ¥æ¸…ç†æŠ€æœ¯å€º</h3>
<p>åœ¨ v1.0 ä¸­ï¼Œæˆ‘ä»¬ç§»é™¤äº†éƒ¨åˆ†é˜»ç¢æœªæ¥å‘å±•çš„æ—§åŠŸèƒ½å’Œç”¨æ³•ï¼š</p>
<ul>
<li>åŸºäº Git çš„ <code>Repository</code> ç±»å·²è¢«ç§»é™¤ã€‚</li>
<li>HTTP æ¥å£å¦‚ <code>upload_file()</code> å’Œ <code>create_commit()</code> å˜å¾—æ›´ç®€æ´ã€æ›´ç¨³å®šï¼Œä¹Ÿæ›´é€‚åº”ç°ä»£åŒ–å·¥ä½œæµã€‚</li>
<li><code>HfFolder</code> çš„ token ç®¡ç†æ–¹å¼å·²è¢«æ˜¾å¼çš„ <code>login()</code>ã€<code>logout()</code> å’Œ <code>get_token()</code> å‡½æ•°æ‰€å–ä»£ï¼Œä½¿ç”¨æ–¹å¼æ›´ç›´è§‚ã€‚</li>
<li>åŸæœ‰çš„ <code>InferenceApi</code> ç±»è¢«åŠŸèƒ½æ›´å®Œå–„çš„ <code>InferenceClient</code> æ›¿ä»£ã€‚</li>
<li>æ–‡ä»¶ä¼ è¾“å·¥å…· <code>hf_transfer</code> è¢«å½»åº•æ·˜æ±°ï¼Œç°å·²ç”±å…¨æ–°çš„äºŒè¿›åˆ¶å·¥å…·åŒ… <code>hf_xet</code> å®Œå…¨æ¥ç®¡ã€‚</li>
</ul>
<p>è¿™äº›å˜æ›´å¹¶éä»“ä¿ƒå†³ç­–ï¼Œæˆ‘ä»¬åœ¨æ•°æœˆå‰å°±å·²å‘å¸ƒå¼ƒç”¨é€šçŸ¥ï¼Œé™„å¸¦æ¸…æ™°çš„è¿ç§»æŒ‡å¼•ã€‚æœ€ç»ˆç›®æ ‡æ˜¯æ‰“é€ ä¸€ä¸ª <strong>æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤</strong> çš„ä»£ç åº“ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿé›†ä¸­ç²¾åŠ›å¼€å‘é¢å‘æœªæ¥çš„æ–°ç‰¹æ€§ï¼Œè€Œä¸æ˜¯ç»§ç»­å…¼å®¹è¿‡æ—¶çš„å®ç°æ–¹å¼ã€‚</p>
<h3 data-id="heading-11">è¿ç§»æŒ‡å—</h3>
<p>æˆ‘ä»¬ç†è§£ï¼Œç ´åæ€§æ›´æ–°å¯èƒ½ä¼šå¯¹ç°æœ‰é¡¹ç›®é€ æˆå›°æ‰°ã€‚æ­£å› å¦‚æ­¤ï¼Œæˆ‘ä»¬æŠ•å…¥äº†å¤§é‡ç²¾åŠ›ï¼Œå°½å¯èƒ½è®©è¿ç§»è¿‡ç¨‹é¡ºç•…æ— ç—›ã€‚å®˜æ–¹çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fconcepts%2Fmigration" target="_blank" title="https://huggingface.co/docs/huggingface_hub/concepts/migration" ref="nofollow noopener noreferrer">è¿ç§»æŒ‡å—</a> æä¾›äº†æ¯é¡¹å˜æ›´çš„ <strong>é€æ­¥è¯´æ˜</strong>ï¼Œå¹¶è§£é‡Šäº†èƒŒåçš„åŸå› ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨å¯èƒ½çš„åœ°æ–¹ <strong>ä¿ç•™äº†å‘åå…¼å®¹æ€§</strong>ã€‚ä¾‹å¦‚ <code>HfHubHttpError</code> åŒæ—¶ç»§æ‰¿äº†æ—§ç‰ˆ <code>requests</code> å’Œæ–°ç‰ˆ <code>httpx</code> çš„ <code>HTTPError</code> å¼‚å¸¸ç±»ï¼Œç¡®ä¿åŸæœ‰é”™è¯¯å¤„ç†é€»è¾‘ä¾ç„¶ç”Ÿæ•ˆã€‚</p>
<p>ä» v1.0 èµ·ï¼Œæˆ‘ä»¬å°†<strong>å…¨é¢èšç„¦æ–°ç‰ˆ</strong>çš„å¼€å‘ä¸ç»´æŠ¤ï¼Œç¡®ä¿ä¸ºç¤¾åŒºæä¾›æ›´é«˜æ€§èƒ½ã€æ›´ä¸°å¯ŒåŠŸèƒ½å’Œæ›´å®Œå–„çš„å·¥å…·ã€‚æ—§ç‰ˆï¼ˆv0.*ï¼‰ä»å¯åœ¨ PyPI ä¸‹è½½ï¼Œä½†ä»Šååªä¼šè¿›è¡Œå®‰å…¨æ€§è¡¥ä¸æ›´æ–°ï¼Œä¸å†æ·»åŠ æ–°åŠŸèƒ½ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬å°½åŠ›ç¡®ä¿ <code>huggingface_hub</code> v1.0.0 ä¸æ—§ç‰ˆå…¼å®¹ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¤§å¤šæ•°æœºå™¨å­¦ä¹ åº“åœ¨ v0.x ä¸ v1.x ä¹‹é—´éƒ½èƒ½æ— ç¼åˆ‡æ¢ã€‚ä¸»è¦ä¾‹å¤–æ˜¯ <code>transformers</code>ï¼šå…¶ v4 ç‰ˆæœ¬æ˜ç¡®ä¾èµ– v0.xï¼Œè€Œå³å°†å‘å¸ƒçš„ v5 å°†æ”¹ä¸ºä¾èµ– v1.xã€‚æƒ³äº†è§£å„ä¸»æµåº“çš„å…¼å®¹æƒ…å†µï¼Œè¯·å‚è€ƒè¿™ä¸ª <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Fissues%2F3340" target="_blank" title="https://github.com/huggingface/huggingface_hub/issues/3340" ref="nofollow noopener noreferrer">å…¼å®¹æ€§æ±‡æ€»è¡¨</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-12">ç‰¹åˆ«è‡´è°¢</h2>
<p>æ„Ÿè°¢ 280 å¤šä½ä¸ºæœ¬åº“è´¡çŒ®ä»£ç ã€æ–‡æ¡£ã€ç¿»è¯‘å’Œç¤¾åŒºæ”¯æŒçš„å¼€å‘è€…ä»¬ï¼</p>
<p>åŒæ—¶ä¹Ÿæ„Ÿè°¢ Hugging Face ç¤¾åŒºæä¾›çš„åé¦ˆã€Bug æŠ¥å‘Šä¸å»ºè®®ï¼Œè¿™äº›éƒ½å¸®åŠ©æˆ‘ä»¬ä¸æ–­å®Œå–„äº§å“ã€‚</p>
<p>æœ€åï¼Œè¡·å¿ƒæ„Ÿè°¢å¹¿å¤§ç”¨æˆ· â€”â€” æ— è®ºæ˜¯ç‹¬ç«‹å¼€å‘è€…è¿˜æ˜¯å¤§å‹ä¼ä¸š â€”â€” æ„Ÿè°¢ä½ ä»¬ä¿¡ä»» <code>huggingface_hub</code>ï¼Œè®©å®ƒæˆä¸ºä½ ä»¬å·¥ä½œæµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚æ˜¯ä½ ä»¬çš„æ”¯æŒæ¿€åŠ±æˆ‘ä»¬ä¸æ–­å‰è¡Œã€‚</p>
<p>å¦‚æœä½ å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œæ¬¢è¿åˆ° <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub" target="_blank" title="https://github.com/huggingface/huggingface_hub" ref="nofollow noopener noreferrer">GitHub ç‚¹ä¸ªæ˜Ÿ â­</a>ï¼Œæ”¯æŒæˆ‘ä»¬ç»§ç»­å»ºè®¾å¼€æºæœºå™¨å­¦ä¹ çš„æœªæ¥ï¼</p>
<p>äº”å¹´å·²è¿‡ï¼Œä½†ä¸€åˆ‡æ‰åˆšåˆšå¼€å§‹ï¼</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡: <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fblog%2Fhuggingface-hub-v1" target="_blank" title="https://huggingface.co/blog/huggingface-hub-v1" ref="nofollow noopener noreferrer">huggingface.co/blog/hugginâ€¦</a></p>
<p>åŸæ–‡ä½œè€…: Lucain Pouget, CÃ©lina Hanouti, Lysandre, Julien Chaumond</p>
<p>è¯‘è€…: Luke,  Hugging Face Fellow</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€åç«¯è¿›é˜¶ã€‘å¹¶å‘ç«æ€ä¸é”é€‰å‹]]></title>    <link>https://juejin.cn/post/7582813955212525609</link>    <guid>https://juejin.cn/post/7582813955212525609</guid>    <pubDate>2025-12-13T03:19:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582813955212525609" data-draft-id="7583139562734764075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€åç«¯è¿›é˜¶ã€‘å¹¶å‘ç«æ€ä¸é”é€‰å‹"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-13T03:19:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ›¾å¯Œè´µ"/> <meta itemprop="url" content="https://juejin.cn/user/4212984286289806"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€åç«¯è¿›é˜¶ã€‘å¹¶å‘ç«æ€ä¸é”é€‰å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984286289806/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ›¾å¯Œè´µ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:19:02.000Z" title="Sat Dec 13 2025 03:19:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ äº‹åŠ¡çš„å±€é™æ€§</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å˜æ¸…äº‹åŠ¡çš„æ ¸å¿ƒä½œç”¨ã€‚</p>
<p>å¤§å¤šæ•°å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQL/PostgreSQLï¼‰çš„äº‹åŠ¡ä¸»è¦ä¿è¯ <strong>ACID</strong> ä¸­çš„ <strong>Aï¼ˆåŸå­æ€§ï¼‰</strong>ï¼š</p>
<blockquote>
<p><strong>åŸå­æ€§</strong>ï¼šä¸€ç³»åˆ—æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p>
</blockquote>
<p>ä½†å®ƒ<strong>é»˜è®¤</strong>å¹¶ä¸èƒ½å®Œå…¨è§£å†³å¹¶å‘ä¸‹çš„ <strong>Iï¼ˆéš”ç¦»æ€§ï¼‰</strong> é—®é¢˜ï¼ˆå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°ï¼‰ã€‚</p>
<h3 data-id="heading-1">å…¸å‹çš„â€œè¯»-æ”¹-å†™â€æ­»å±€</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ‰£å‡åº“å­˜çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼ˆä¼ªä»£ç ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¼€å¯äº‹åŠ¡</span>
<span class="hljs-keyword">await</span> prisma.$transaction(<span class="hljs-keyword">async</span> (tx) =&gt; {
  <span class="hljs-comment">// 1. è¯»ï¼šæŸ¥è¯¢å½“å‰åº“å­˜</span>
  <span class="hljs-keyword">const</span> product = <span class="hljs-keyword">await</span> tx.<span class="hljs-property">product</span>.<span class="hljs-title function_">findUnique</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> } });
  
  <span class="hljs-comment">// 2. ç®—ï¼šå†…å­˜åˆ¤æ–­</span>
  <span class="hljs-keyword">if</span> (product.<span class="hljs-property">stock</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'åº“å­˜ä¸è¶³'</span>);
  
  <span class="hljs-comment">// 3. å†™ï¼šæ›´æ–°åº“å­˜</span>
  <span class="hljs-keyword">await</span> tx.<span class="hljs-property">product</span>.<span class="hljs-title function_">update</span>({
    <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> },
    <span class="hljs-attr">data</span>: { <span class="hljs-attr">stock</span>: product.<span class="hljs-property">stock</span> - <span class="hljs-number">1</span> }
  });
});
</code></pre>
<p><strong>å¹¶å‘åœºæ™¯ï¼š</strong>
å¦‚æœ A å’Œ B ä¸¤ä¸ªç”¨æˆ·åŒæ—¶è¿›æ¥ï¼š</p>
<ol>
<li>A è¯»åˆ°åº“å­˜ä¸º 1ã€‚</li>
<li>B è¯»åˆ°åº“å­˜ä¸º 1ï¼ˆå› ä¸º A æ²¡é”æ•°æ®ï¼‰ã€‚</li>
<li>A å‡ 1 å†™å…¥ 0ã€‚</li>
<li>B å‡ 1 å†™å…¥ 0ã€‚
<strong>ç»“æœï¼š</strong> å–å‡ºäº†ä¸¤ä»¶å•†å“ï¼Œåº“å­˜åªå‡äº† 1ã€‚è¿™å°±æ˜¯å…¸å‹çš„ <strong>ä¸¢å¤±æ›´æ–°ï¼ˆLost Updateï¼‰</strong>ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-2">äºŒã€ è§£å†³æ–¹æ¡ˆä¸€ï¼šå•æŒ‡ä»¤åŸå­åŒ–ï¼ˆæ¨èï¼‰</h2>
<p>å¦‚æœä½ çš„ä¸šåŠ¡é€»è¾‘éå¸¸ç®€å•ï¼Œä»…ä»…æ˜¯æ•°å€¼çš„å¢å‡ï¼Œ<strong>æœ€å¥½çš„åŠæ³•æ˜¯å®Œå…¨ç»•è¿‡â€œè¯»-æ”¹-å†™â€çš„æ­¥éª¤</strong>ï¼Œç›´æ¥åˆ©ç”¨æ•°æ®åº“è‡ªèº«çš„åŸå­èƒ½åŠ›ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¸éœ€è¦æŸ¥å‡ºæ¥è®¡ç®—ï¼Œç›´æ¥æ¨ç»™æ•°æ®åº“å»ç®—</span>
<span class="hljs-keyword">await</span> prisma.<span class="hljs-property">product</span>.<span class="hljs-title function_">update</span>({
  <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> },
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">stock</span>: { <span class="hljs-attr">decrement</span>: <span class="hljs-number">1</span> } <span class="hljs-comment">// åŸå­æ“ä½œï¼šUPDATE product SET stock = stock - 1 ...</span>
  }
});
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ€§èƒ½æœ€é«˜ï¼Œä¸éœ€è¦å¤æ‚çš„é”æœºåˆ¶ã€‚
<strong>ç¼ºç‚¹</strong>ï¼šåªèƒ½å¤„ç†ç®€å•é€»è¾‘ã€‚å¦‚æœéœ€è¦åˆ¤æ–­â€œç”¨æˆ·ç­‰çº§â€ã€â€œé™è´­æ•°é‡â€ç­‰å¤æ‚ä¸šåŠ¡ï¼Œå•æ¡ SQL æ— æ³•æ»¡è¶³ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€ è§£å†³æ–¹æ¡ˆäºŒï¼šæ‚²è§‚é”ï¼ˆPessimistic Lockingï¼‰</h2>
<p>å½“é€»è¾‘å¤æ‚å¿…é¡»åˆ†æ­¥æ‰§è¡Œï¼Œä¸”æ˜¯<strong>å†™å¤šï¼ˆé«˜é¢‘å¹¶å‘å†™å…¥ï¼‰</strong> çš„åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬éœ€è¦<strong>æ‚²è§‚é”</strong>ã€‚</p>
<h3 data-id="heading-4">é€šä¿—ç†è§£</h3>
<p>â€œå…¬å…±å•æ‰€çš„å‘ä½ï¼ˆæ•°æ®ï¼‰æœ‰é™ä¸”ç«äº‰æ¿€çƒˆï¼Œä¸ºäº†é˜²æ­¢æˆ‘åœ¨é‡Œé¢åŠäº‹çš„æ—¶å€™è¢«åˆ«äººæ¨é—¨è€Œå…¥ï¼Œæˆ‘è¿›é—¨çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯<strong>å…ˆæŠŠé—¨åé”</strong>ã€‚ç›´åˆ°æˆ‘åŠå®Œäº‹å‡ºæ¥ï¼Œä¸‹ä¸€ä¸ªäººæ‰èƒ½è¿›å»ã€‚â€</p>
<h3 data-id="heading-5">âš ï¸ å…³é”®å‰æï¼šå¿…é¡»é…åˆäº‹åŠ¡</h3>
<p><strong>æ‚²è§‚é”æ˜¯ä¾èµ–æ•°æ®åº“äº‹åŠ¡ï¼ˆTransactionï¼‰çš„ã€‚</strong></p>
<ul>
<li>åªæœ‰åœ¨ <code>BEGIN</code> ... <code>COMMIT/ROLLBACK</code> ä¹‹é—´ï¼Œé”æ‰ç”Ÿæ•ˆã€‚</li>
<li>ä¸€æ—¦äº‹åŠ¡æäº¤æˆ–å›æ»šï¼Œ<strong>é”ä¼šè‡ªåŠ¨è§£é™¤</strong>ã€‚å¦‚æœä¸å¼€å¯äº‹åŠ¡ï¼ŒSQL è¯­å¥æ‰§è¡Œå®Œçš„ç¬é—´é”å°±é‡Šæ”¾äº†ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚</li>
</ul>
<h3 data-id="heading-6">å®ç°æ–¹å¼</h3>
<p>åœ¨ SQL ä¸­ä½¿ç”¨ <code>SELECT ... FOR UPDATE</code>ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¿…é¡»åœ¨äº‹åŠ¡ä¸­è¿›è¡Œï¼</span>
<span class="hljs-keyword">await</span> prisma.$transaction(<span class="hljs-keyword">async</span> (tx) =&gt; {
  <span class="hljs-comment">// 1. æŸ¥å¹¶åŠ é”ï¼ˆæ³¨æ„ï¼šè¿™é‡Œå¿…é¡»ä½¿ç”¨åŸç”Ÿ SQL æˆ–ç‰¹å®š ORM æ–¹æ³•ï¼‰</span>
  <span class="hljs-comment">// è¿™è¡Œä»£ç æ‰§è¡Œåï¼Œæ•°æ®åº“ä¼šç»™è¿™è¡Œæ•°æ®æŒ‚ä¸Šä¸€æŠŠâ€œæ’ä»–é”â€</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> tx.<span class="hljs-property">$queryRaw</span><span class="hljs-string">`SELECT * FROM "Product" WHERE id = <span class="hljs-subst">${id}</span> FOR UPDATE`</span>;
  
  <span class="hljs-keyword">if</span> (result[<span class="hljs-number">0</span>].<span class="hljs-property">stock</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'åº“å­˜ä¸è¶³'</span>);
  
  <span class="hljs-comment">// 2. æ›´æ–°</span>
  <span class="hljs-keyword">await</span> tx.<span class="hljs-property">product</span>.<span class="hljs-title function_">update</span>({ ... });
  
  <span class="hljs-comment">// 3. äº‹åŠ¡ç»“æŸ -&gt; é”è‡ªåŠ¨é‡Šæ”¾</span>
});
</code></pre>
<h3 data-id="heading-7">ğŸ”’ é”çš„é˜»å¡æœºåˆ¶ï¼ˆé‡ç‚¹ï¼‰</h3>
<p>å‡è®¾äº‹åŠ¡ A æ‹¿åˆ°äº†é”ï¼Œä¸”<strong>è¿˜æ²¡æäº¤</strong>ï¼Œæ­¤æ—¶äº‹åŠ¡ B å¦‚æœæƒ³æ“ä½œåŒä¸€è¡Œæ•°æ®ï¼Œä¼šé­é‡ä»¥ä¸‹æƒ…å†µï¼š</p>

























<table><thead><tr><th align="left">äº‹åŠ¡ B çš„æ“ä½œ</th><th align="left">ç»“æœ</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><strong>æ™®é€šæŸ¥è¯¢</strong><br/><code>SELECT * ...</code></td><td align="left"><strong>âœ… é€šè¡Œ</strong></td><td align="left"><strong>ä¸é˜»å¡</strong>ã€‚åŸºäº MVCC æœºåˆ¶ï¼ŒB ä¼šè¯»åˆ° A åŠ é”ä¹‹å‰çš„<strong>å†å²å¿«ç…§</strong>ã€‚è™½ç„¶è¯»ä¸åˆ°æœ€æ–°ä¿®æ”¹ï¼Œä½†ä¸ä¼šè¢«å¡ä½ã€‚</td></tr><tr><td align="left"><strong>æ‚²è§‚é”æŸ¥è¯¢</strong><br/><code>SELECT ... FOR UPDATE</code></td><td align="left"><strong>âŒ é˜»å¡</strong></td><td align="left"><strong>æ’é˜Ÿç­‰å¾…</strong>ã€‚B ä¹Ÿæƒ³ç”³è¯·é”ï¼Œä½†é”åœ¨ A æ‰‹é‡Œï¼Œå¿…é¡»ç­‰ A æäº¤æˆ–å›æ»šã€‚</td></tr><tr><td align="left"><strong>ä¿®æ”¹æ“ä½œ</strong><br/><code>UPDATE / DELETE</code></td><td align="left"><strong>âŒ é˜»å¡</strong></td><td align="left"><strong>æ’é˜Ÿç­‰å¾…</strong>ã€‚ä¿®æ”¹æ•°æ®éœ€è¦è·å–å†™é”ï¼Œå¿…é¡»ç­‰ A é‡Šæ”¾é”ã€‚</td></tr></tbody></table>
<h3 data-id="heading-8">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li><strong>å†™å¤šè¯»å¤š</strong>ã€å¼ºä¸€è‡´æ€§è¦æ±‚é«˜ï¼ˆå¦‚ç§’æ€ã€é“¶è¡Œè½¬è´¦ï¼‰ã€‚</li>
<li><strong>ä»£ä»·</strong>ï¼šæ€§èƒ½è¾ƒå·®ï¼Œå®¹æ˜“é™ä½ç³»ç»Ÿååé‡ï¼Œå¤„ç†ä¸å½“å¯èƒ½å¯¼è‡´æ­»é”ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-9">å››ã€ è§£å†³æ–¹æ¡ˆä¸‰ï¼šä¹è§‚é”ï¼ˆOptimistic Lockingï¼‰</h2>
<p>å½“é€»è¾‘å¤æ‚å¿…é¡»åˆ†æ­¥æ‰§è¡Œï¼Œä¸”æ˜¯<strong>è¯»å¤šå†™å°‘ï¼ˆä½é¢‘å¹¶å‘å†™å…¥ï¼‰</strong> çš„åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨<strong>ä¹è§‚é”</strong>ã€‚</p>
<h3 data-id="heading-10">å®ç°æ–¹å¼</h3>
<p>é€šå¸¸åœ¨æ•°æ®åº“è¡¨ä¸­å¢åŠ ä¸€ä¸ª <code>version</code> å­—æ®µã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. è¯»æ•°æ®ï¼ˆä¸åŠ é”ï¼‰</span>
<span class="hljs-keyword">const</span> product = <span class="hljs-keyword">await</span> repo.<span class="hljs-title function_">findOne</span>(id); <span class="hljs-comment">// å‡è®¾æ­¤æ—¶ version = 1</span>

<span class="hljs-comment">// 2. å†…å­˜è®¡ç®—</span>
<span class="hljs-keyword">const</span> newStock = product.<span class="hljs-property">stock</span> - <span class="hljs-number">1</span>;

<span class="hljs-comment">// 3. æ›´æ–°ï¼ˆå¸¦ç‰ˆæœ¬å·æ¡ä»¶ï¼‰ - CAS (Compare And Swap)</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> repo.<span class="hljs-title function_">update</span>(
  <span class="hljs-comment">// åªæœ‰å½“æ•°æ®åº“é‡Œçš„ version ä¾ç„¶ç­‰äºæˆ‘è¯»åˆ°çš„ 1 æ—¶ï¼Œæ‰æ›´æ–°</span>
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">version</span>: <span class="hljs-number">1</span> }, 
  { <span class="hljs-attr">stock</span>: newStock, <span class="hljs-attr">version</span>: <span class="hljs-number">2</span> }
);

<span class="hljs-comment">// 4. åˆ¤æ–­ç»“æœ</span>
<span class="hljs-keyword">if</span> (result.<span class="hljs-property">affected</span> === <span class="hljs-number">0</span>) {
  <span class="hljs-comment">// è¯´æ˜åœ¨ç¬¬1æ­¥å’Œç¬¬3æ­¥ä¹‹é—´ï¼Œæœ‰äººä¿®æ”¹äº†æ•°æ®</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConflictException</span>(<span class="hljs-string">'æ‰‹æ…¢äº†ï¼Œæ•°æ®å·²è¢«ä¿®æ”¹'</span>);
}
</code></pre>
<h3 data-id="heading-11">å¤±è´¥åçš„ç­–ç•¥</h3>
<p>ä¹è§‚é”æ›´æ–°å¤±è´¥åï¼Œæœ‰ä¸¤ç§å¸¸è§å¤„ç†æ–¹å¼ï¼š</p>
<ol>
<li><strong>Fast Failï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰</strong>ï¼šç›´æ¥æŠ¥é”™è¿”å›ç»™ç”¨æˆ·ï¼ˆå¦‚ï¼šâ€œå½“å‰å†…å®¹å·²è¢«ç¼–è¾‘ï¼Œè¯·åˆ·æ–°â€ï¼‰ã€‚é€‚åˆç”¨æˆ·ç¼–è¾‘è¡¨å•çš„åœºæ™¯ã€‚</li>
<li><strong>Retryï¼ˆè‡ªåŠ¨é‡è¯•ï¼‰</strong>ï¼šä»£ç é‡Œå†™ä¸ªå¾ªç¯ï¼Œé‡æ–°æŸ¥ä¸€éæœ€æ–°æ•°æ®å†è¯•ä¸€æ¬¡ã€‚é€‚åˆåº“å­˜æ‰£å‡ã€ç§¯åˆ†ç´¯åŠ ç­‰åœºæ™¯ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-12">äº”ã€ æ€»ç»“ä¸é€‰å‹æŒ‡å—</h2>
<p>åœ¨å¤„ç†â€œå¤šåŸå­åŒ–æ“ä½œâ€ï¼ˆå³æ— æ³•ç”¨å•æ¡ SQL è§£å†³çš„å¤æ‚ä¸šåŠ¡ï¼‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹å†³ç­–ï¼š</p>



































<table><thead><tr><th align="left">ç»´åº¦</th><th align="left">æ‚²è§‚é” (Pessimistic)</th><th align="left">ä¹è§‚é” (Optimistic)</th></tr></thead><tbody><tr><td align="left"><strong>æœºåˆ¶</strong></td><td align="left"><strong>å…ˆé”åå¹²</strong> (SELECT FOR UPDATE)</td><td align="left"><strong>å¹²å®Œå†æŸ¥</strong> (Version check)</td></tr><tr><td align="left"><strong>å¹¶å‘æ€§èƒ½</strong></td><td align="left">ä½ (ä¸²è¡Œæ’é˜Ÿ)</td><td align="left">é«˜ (å¹¶è¡Œå¥”è·‘)</td></tr><tr><td align="left"><strong>å†²çªå¤„ç†</strong></td><td align="left">é˜»å¡ç­‰å¾…</td><td align="left">æŠ¥é”™æˆ–é‡è¯•</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left"><strong>é«˜å¹¶å‘å†™ã€å¼ºç«äº‰</strong><br/>(ç§’æ€ã€æ”¯ä»˜)</td><td align="left"><strong>ä½å¹¶å‘å†™ã€è¯»å¤šå†™å°‘</strong><br/>(ç¼–è¾‘èµ„æ–™ã€CMSåå°)</td></tr><tr><td align="left"><strong>ç”Ÿæ´»ç±»æ¯”</strong></td><td align="left">åªæœ‰ä¸€ä¸ªå•æ‰€å‘ä½ï¼Œè¿›å»å°±åé”é—¨ï¼Œåé¢çš„äººæ’é˜Ÿã€‚</td><td align="left">å¼€æ”¾å¼æ–‡æ¡£ç¼–è¾‘ï¼Œæäº¤æ—¶å‘ç°ç‰ˆæœ¬è½åï¼Œéœ€è¦åˆå¹¶æˆ–é‡å†™ã€‚</td></tr></tbody></table>
<h3 data-id="heading-13">ğŸš€ æé€Ÿåˆ¤æ–­å¿ƒæ³•ï¼šå†³ç­–æµç¨‹å›¾</h3>
<ol>
<li>
<p><strong>å†™ä»£ç å‰é—®ä¸€å¥ï¼š</strong> ä¼šæœ‰ä¸¤ä¸ªäººåŒæ—¶æ“ä½œè¿™æ¡æ•°æ®å—ï¼Ÿ</p>
<ul>
<li><strong>No</strong> -&gt; éšä¾¿å†™ã€‚</li>
<li><strong>Yes</strong> -&gt; ç»§ç»­å¾€ä¸‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>èƒ½ä¸€æ¡ SQL æ›´æ–°å—ï¼Ÿ</strong> (æ¯”å¦‚ <code>increment</code>)</p>
<ul>
<li><strong>Yes</strong> -&gt; ç”¨å®ƒï¼(åŸå­æ“ä½œï¼Œæœ€å®‰å…¨)</li>
<li><strong>No</strong> -&gt; ç»§ç»­å¾€ä¸‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>åˆ¤æ–­ä¸šåŠ¡åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>å•çº¯å¤šæ­¥å†™</strong> (å¦‚ï¼šå…ˆ Insert Aï¼Œå† Update B)
<ul>
<li>ğŸ‘‰ <strong>çº¯äº‹åŠ¡</strong> (ä¿è¯åŸå­æ€§)ã€‚</li>
</ul>
</li>
<li><strong>å…ˆè¯»åå†™</strong> (å¦‚ï¼šCheck-then-Act)
<ul>
<li>ğŸ‘‰ <strong>ä¸Šé” + äº‹åŠ¡</strong>ã€‚æ ¹æ®ç«äº‰ç¨‹åº¦äºŒé€‰ä¸€ï¼š
<ul>
<li><strong>å†²çªé«˜/åæœä¸¥é‡</strong>ï¼ˆå¦‚åº“å­˜ã€é‡‘é¢ï¼‰ -&gt; <strong>æ‚²è§‚é”</strong> (<code>For Update</code>)ã€‚</li>
<li><strong>å†²çªä½/åæœè½»å¾®</strong>ï¼ˆå¦‚æç¤ºé‡è¯•ï¼‰ -&gt; <strong>ä¹è§‚é”</strong> (<code>version</code>)ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx åå‘ä»£ç† 403 é—®é¢˜å¤ç›˜]]></title>    <link>https://juejin.cn/post/7582787460419338282</link>    <guid>https://juejin.cn/post/7582787460419338282</guid>    <pubDate>2025-12-13T05:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582787460419338282" data-draft-id="7582857981893984297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx åå‘ä»£ç† 403 é—®é¢˜å¤ç›˜"/> <meta itemprop="keywords" content="Nginx"/> <meta itemprop="datePublished" content="2025-12-13T05:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AlianNiew"/> <meta itemprop="url" content="https://juejin.cn/user/928405543463528"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx åå‘ä»£ç† 403 é—®é¢˜å¤ç›˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/928405543463528/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AlianNiew
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T05:42:23.000Z" title="Sat Dec 13 2025 05:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Nginx åå‘ä»£ç† 403 é—®é¢˜å¤ç›˜</h2>
<h3 data-id="heading-1">ä¸€ã€é—®é¢˜ç°è±¡</h3>
<ul>
<li>æµè§ˆå™¨è®¿é—®ï¼š</li>
</ul>
<pre><code class="hljs language-perl" lang="perl">
[https:<span class="hljs-regexp">//</span>www.alancode.top/api/search?keyword=ç‹è²&amp;limit=<span class="hljs-number">5</span>](https:<span class="hljs-regexp">//</span>www.alancode.top/api/search?keyword=%E7%<span class="hljs-number">8</span>E%<span class="hljs-number">8</span>B%E8%<span class="hljs-number">8</span>F%B2&amp;limit=<span class="hljs-number">5</span>)

</code></pre>
<p>è¿”å› <strong>403 Forbidden</strong></p>
<ul>
<li>
<p>Nginx æ—¥å¿—æ˜¾ç¤ºï¼š</p>
</li>
<li>
<p>è¯·æ±‚å·²æˆåŠŸè½¬å‘åˆ°ä¸Šæ¸¸æœåŠ¡å™¨</p>
</li>
<li>
<p>çŠ¶æ€ç  <strong>200</strong></p>
</li>
<li>
<p>å“åº”ä½“é•¿åº¦ä¸º <strong>0</strong></p>
</li>
<li>
<p>ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆ60.204.147.98ï¼‰æ—¥å¿—æ˜¾ç¤ºï¼š</p>
</li>
<li>
<p>è¯·æ±‚æ­£å¸¸æ¥æ”¶</p>
</li>
<li>
<p>å†…éƒ¨è¯·æ±‚æˆåŠŸè¿”å›æ•°æ®ï¼ˆ200ï¼‰</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-2">äºŒã€é—®é¢˜æœ¬è´¨</h3>
<p><strong>è¯·æ±‚åˆ°è¾¾äº†ä¸Šæ¸¸ï¼Œå“åº”ä¹Ÿç”Ÿæˆäº†ï¼Œä½†åœ¨ Nginx åå‘ä»£ç†å±‚è¢«æ‹¦æˆª / ä¸¢å¼ƒï¼Œæœ€ç»ˆå¯¼è‡´å‰ç«¯æ”¶åˆ° 403ã€‚</strong></p>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ï¼š</p>
<blockquote>
<p><strong>Header é…ç½®é”™è¯¯å¯¼è‡´çš„åå‘ä»£ç†å±‚é—®é¢˜</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€å…·ä½“é”™è¯¯ç‚¹</h3>
<h4 data-id="heading-4">1ï¸âƒ£ HTTP Header æ‹¼å†™é”™è¯¯ï¼ˆè‡´å‘½ï¼‰</h4>
<pre><code class="hljs language-nginx" lang="nginx">proxy_set_header X-For/warded-Proto $scheme;
</code></pre>
<ul>
<li>Header ååŒ…å« <code>/</code>ï¼Œå±äº <strong>éæ³• HTTP Header</strong></li>
<li>Nginx ä¸ä¼šæŠ¥é”™ï¼Œä½†è¯¥ Header ä¼šè¢«å¿½ç•¥</li>
<li>ä¸Šæ¸¸æœåŠ¡æ— æ³•è¯†åˆ«è¯·æ±‚æ¥æºåè®®ï¼ˆhttp / httpsï¼‰</li>
<li>åœ¨ HTTPS åœºæ™¯ä¸‹ï¼Œææ˜“è§¦å‘ <strong>403 / å¼ºåˆ¶æ‹’ç»</strong></li>
</ul>
<p>âœ… æ­£ç¡®å†™æ³•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;
</code></pre>
<hr/>
<h4 data-id="heading-5">2ï¸âƒ£ Host å¤´è½¬å‘é”™è¯¯ï¼ˆé«˜é¢‘è¸©å‘ç‚¹ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">proxy_set_header Host <span class="hljs-variable">$host</span>;
</code></pre>
<ul>
<li>
<p><code>$host</code> æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„åŸŸåï¼ˆå¦‚ <code>www.alancode.top</code>ï¼‰</p>
</li>
<li>
<p>ä½†çœŸå®ä¸Šæ¸¸æ˜¯ IP + ç«¯å£</p>
</li>
<li>
<p>å½“ä¸Šæ¸¸å­˜åœ¨ï¼š</p>
<ul>
<li>Host æ ¡éªŒ</li>
<li>é˜²ç›—é“¾</li>
<li>WAF / å®‰å…¨ç­–ç•¥</li>
</ul>
</li>
<li>
<p>å°±å¯èƒ½ç›´æ¥æ‹’ç»è¯·æ±‚ï¼ˆ403ï¼‰</p>
</li>
</ul>
<p>âœ… æ­£ç¡®å†™æ³•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">proxy_set_header Host <span class="hljs-variable">$proxy_host</span>;
</code></pre>
<p>æˆ–ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">proxy_set_header Host 60.204.147.98<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h4 data-id="heading-6">3ï¸âƒ£ è¡¨è±¡è¿·æƒ‘ç‚¹ï¼šNginx access log æ˜¾ç¤º 200</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"GET /search?... HTTP/1.0"</span> <span class="hljs-number">200</span> <span class="hljs-number">0</span>
</code></pre>
<ul>
<li><code>200</code>ï¼šè¯´æ˜ä¸Šæ¸¸è¿”å›æˆåŠŸ</li>
<li><code>0</code>ï¼šè¯´æ˜ <strong>å“åº”ä½“æœªæˆåŠŸè¿”å›ç»™å®¢æˆ·ç«¯</strong></li>
<li>å®é™…å“åº”åœ¨ä»£ç†å±‚è¢«ä¸­æ–­æˆ–æ‹’ç»</li>
</ul>
<p>âš ï¸ è¿™æ˜¯åå‘ä»£ç†é—®é¢˜çš„é‡è¦ä¿¡å·</p>
<hr/>
<h3 data-id="heading-7">å››ã€æœ€ç»ˆæ­£ç¡®é…ç½®</h3>
<pre><code class="hljs language-ini" lang="ini">location /api/ {
    proxy_pass http://60.204.147.98:15001/<span class="hljs-comment">;</span>

    proxy_http_version 1.1<span class="hljs-comment">;</span>

    proxy_set_header Host $proxy_host<span class="hljs-comment">;</span>
    proxy_set_header X-Real-IP $remote_addr<span class="hljs-comment">;</span>
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for<span class="hljs-comment">;</span>
    proxy_set_header X-Forwarded-Proto $scheme<span class="hljs-comment">;</span>

    proxy_redirect off<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-8">äº”ã€ç»éªŒæ€»ç»“ï¼ˆChecklistï¼‰</h3>
<ul>
<li>âŒ ä¸è¦éšæ„æ‹¼å†™ Header åï¼ˆNginx ä¸ä¸€å®šæŠ¥é”™ï¼‰</li>
<li>âŒ ä¸è¦ç›²ç›®ä½¿ç”¨ <code>$host</code> è½¬å‘ç»™ IP å‹ä¸Šæ¸¸</li>
<li>âœ… åå‘ä»£ç† HTTPS æ—¶ä¸€å®šè¦ä¼  <code>X-Forwarded-Proto</code></li>
<li>âœ… <code>200 + å“åº”ä½“ä¸º 0</code> é«˜æ¦‚ç‡æ˜¯ä»£ç†å±‚é—®é¢˜</li>
<li>âœ… å‡ºç° 403 æ—¶ï¼Œä¸è¦åªç›¯åç«¯æ—¥å¿—</li>
</ul>
<hr/>
<h3 data-id="heading-9">å…­ã€ä¸€å¥è¯æ€»ç»“</h3>
<blockquote>
<p><strong>åå‘ä»£ç†é—®é¢˜ï¼Œ80% æ˜¯ Headerï¼›403 ä¸ä¸€å®šæ˜¯åç«¯æ‹’ç»ï¼Œå¾ˆå¯èƒ½æ˜¯ Nginx å¸®ä½ â€œæŒ¡â€äº†è¯·æ±‚ã€‚</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ PHP è§£æ Protobuf çš„å‘ä¸è§£æ³•]]></title>    <link>https://juejin.cn/post/7582849187865264179</link>    <guid>https://juejin.cn/post/7582849187865264179</guid>    <pubDate>2025-12-13T06:04:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582849187865264179" data-draft-id="7582815307440046131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ PHP è§£æ Protobuf çš„å‘ä¸è§£æ³•"/> <meta itemprop="keywords" content="PHP,protobuf"/> <meta itemprop="datePublished" content="2025-12-13T06:04:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ç¢ç‰"/> <meta itemprop="url" content="https://juejin.cn/user/3551890356308556"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ PHP è§£æ Protobuf çš„å‘ä¸è§£æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3551890356308556/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ç¢ç‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T06:04:26.000Z" title="Sat Dec 13 2025 06:04:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰é˜µå­åšçš„ä¸€ä¸ªç›´æ’­å¼¹å¹•çš„æœºå™¨äººï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ä¸Šæ¸¸æ•°æ®æ˜¯é€šè¿‡ Protobuf è¿”å›çš„ã€‚å‡ ä¸ªæœ‹å‹é—®æˆ‘æ€ä¹ˆå¤„ç†ï¼Œä½†æˆ‘å‘ç°å¤§å®¶å¯¹ã€ŒPHP è§£æ Protobufã€è¿™ä»¶äº‹å¤šå°‘æœ‰ç‚¹è¿·ç³Šã€‚ç¡®å®ï¼ŒPHP å¤„ç† Protobuf çš„èµ„æ–™ä¸å¤šï¼Œè€Œä¸”è¸©å‘æˆæœ¬ä¸ç®—ä½ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸æ‰“ç®—ç§‘æ™®ä»€ä¹ˆï¼Œä¹Ÿæ²¡æœ‰æ¨èä»»ä½•æŠ€æœ¯æ ˆçš„æ„æ€ï¼Œå°±æ˜¯æŠŠæˆ‘è‡ªå·±æ‘¸ç´¢çš„è¿‡ç¨‹æ•´ç†å‡ºæ¥ï¼Œç»™é‡åˆ°ç±»ä¼¼é—®é¢˜çš„äººä¸€ä¸ªå‚è€ƒã€‚</p>
<hr/>
<h2 data-id="heading-0">Protobuf æ˜¯ä»€ä¹ˆ</h2>
<p>å¾ˆå¤šäººç¬¬ä¸€æ¬¡æ¥è§¦å®ƒæ—¶ï¼Œä¼šæŠŠå®ƒå’Œ JSONã€XML æ”¾åœ¨ä¸€èµ·ç†è§£ï¼Œä½† Protobuf å¹¶ä¸æ˜¯â€œå¦ä¸€ä¸ª JSONâ€ã€‚å®ƒæ˜¯ä¸€ç§ â€‹<strong>åŸºäº Schema çš„äºŒè¿›åˆ¶æ•°æ®æ ¼å¼</strong>ï¼Œæœ¬è´¨ä¸Šç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>â€‹<code>.proto</code>ï¼šæ•°æ®ç»“æ„çš„æè¿°æ–‡ä»¶ï¼ˆç±»ä¼¼å­—å…¸ï¼‰</li>
<li>äºŒè¿›åˆ¶æ ¼å¼ï¼šæ ¹æ® <code>.proto</code> è§„åˆ™ç¼–ç å‡ºæ¥çš„æ•°æ®</li>
</ul>
<p>Google å‘æ˜å®ƒçš„åŸå› å¤§è‡´æ˜¯ï¼š</p>
<ul>
<li>JSON å¤ªå¤§ã€å¤ªæ…¢</li>
<li>åœ¨é«˜æ€§èƒ½ã€è·¨è¯­è¨€é€šä¿¡åœºæ™¯é‡Œä¸å¤Ÿç†æƒ³</li>
<li>æœåŠ¡ç«¯å†…éƒ¨å¤§é‡ RPC è°ƒç”¨æ—¶ï¼Œåºåˆ—åŒ–æ•ˆç‡å¤ªé‡è¦äº†</li>
</ul>
<p>äºæ˜¯æœ‰äº† Protobufï¼šæ•°æ®æ ¼å¼ç´§å‡‘ã€åºåˆ—åŒ–é€Ÿåº¦å¿«ã€è·¨è¯­è¨€æ”¯æŒä¹Ÿå¼ºã€‚</p>
<p>å®ƒä¸æ˜¯ä¸ºäº†å¯è¯»æ€§ï¼Œè€Œæ˜¯ä¸ºäº†æ€§èƒ½ã€‚</p>
<hr/>
<h2 data-id="heading-1">PHP è§£æ Protobuf ä¸ºä»€ä¹ˆéº»çƒ¦</h2>
<p>PHP èƒ½è§£æ Protobufï¼Œä½†ä½“éªŒä¸å¦‚å…¶ä»–è¯­è¨€ã€‚åŸå› æœ‰å‡ ä¸ªï¼Œç®€å•åˆ—ä¸€ä¸‹ï¼š</p>
<h3 data-id="heading-2">PHP æ— æ³•åŠ¨æ€è§£æ Schema</h3>
<p>åƒ Goã€Pythonã€Java è¿™ç±»è¯­è¨€å¯ä»¥ä¾é  descriptor åŠ¨æ€è§£æ Protobuf æ•°æ®ç»“æ„ï¼Œç”šè‡³å¯ä»¥åœ¨è¿è¡ŒæœŸå¤„ç†æœªçŸ¥ç»“æ„ã€‚</p>
<p>PHP ç›®å‰åšä¸åˆ°ï¼Œæ²¡æœ‰æš´éœ²é‚£ä¸€å¥— APIã€‚</p>
<p>æ‰€ä»¥ PHP â€‹<strong>å¿…é¡»ä¾èµ– .proto æ–‡ä»¶</strong>ï¼Œå¹¶ä¸”å¿…é¡»æå‰ç”¨ protoc ç”Ÿæˆå¯¹åº”çš„ PHP ç±»ã€‚</p>
<h3 data-id="heading-3">PHP çš„ Protobuf æ‰©å±•æ˜¯â€œæœ€å°å®ç°â€</h3>
<p>google/protobuf çš„ PHP æ‰©å±•åªæä¾›ï¼š</p>
<ul>
<li>åºåˆ—åŒ–ï¼šserialize</li>
<li>ååºåˆ—åŒ–ï¼šmergeFrom</li>
<li>åŸºæœ¬çš„ getter/setter æœºåˆ¶</li>
</ul>
<p>å…¶ä»–é«˜çº§èƒ½åŠ›åŸºæœ¬æ²¡æœ‰ã€‚</p>
<h3 data-id="heading-4">PHP çš„ç”Ÿæ€ä¹Ÿä¸ä¼šæŠŠâ€œè§£æäºŒè¿›åˆ¶åè®®â€å½“ä½œä¸»è¦ç”¨é€”</h3>
<p>PHP çš„å¸¸è§ä½¿ç”¨åœºæ™¯å Webï¼Œå› æ­¤å¤„ç†äºŒè¿›åˆ¶åè®®å¹¶ä¸æ˜¯é‡ç‚¹ã€‚</p>
<h3 data-id="heading-5">å¹¶ä¸æ˜¯æˆ‘ä»¬ä¸»åŠ¨é€‰æ‹© Protobuf</h3>
<p>åœ¨ä¸€äº›æœåŠ¡é‡Œï¼Œä¸Šæ¸¸æœåŠ¡å·²ç»å®šæ­»ä½¿ç”¨ Protobufï¼›æˆ–è€… PHP æœåŠ¡åªæ˜¯è¾¹ç¼˜ç½‘å…³ï¼Œéœ€è¦è§£æä¸€æ¬¡å†è½¬å‘ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ç¡¬ç€å¤´çš®æ”¯æŒã€‚</p>
<p>å¦‚æœæ˜¯è‡ªå·±çš„é¡¹ç›®ï¼Œå¹¶æ²¡æœ‰å¼ºçº¦æŸï¼Œå…¶å® JSON è¶³å¤Ÿäº†ã€‚</p>
<hr/>
<h2 data-id="heading-6">PHP å¦‚ä½•ä½¿ç”¨ Protobuf</h2>
<p>æˆ‘è‡ªå·±åœ¨æœåŠ¡å™¨ä¸Šæ²¡æœ‰å®‰è£… Protobuf æ‰©å±•ï¼Œè€Œæ˜¯é‡‡ç”¨æ›´å¸¸è§çš„ä¸€ç§æ–¹å¼ï¼š</p>
<ul>
<li>æœ¬åœ°å®‰è£… <code>protoc</code></li>
<li>ç”¨ <code>.proto</code> æ–‡ä»¶ç”Ÿæˆ PHP ç±»</li>
<li>æœåŠ¡å™¨ç«¯åªéœ€è¦å®‰è£… <code>google/protobuf</code> åŒ…å³å¯å®Œæˆè§£æ</li>
</ul>
<h3 data-id="heading-7">ç¬¬ä¸€æ­¥ï¼šå®‰è£…è¿è¡Œæ—¶åº“</h3>
<pre><code class="hljs language-bash" lang="bash">composer require google/protobuf
</code></pre>
<p>è¿™æ˜¯ PHP è§£æ Protobuf æ‰€éœ€çš„å”¯ä¸€è¿è¡Œæ—¶ä¾èµ–ã€‚</p>
<h3 data-id="heading-8">ç¬¬äºŒæ­¥ï¼šå®‰è£… protocï¼ˆåœ¨æœ¬åœ°ï¼‰</h3>
<p>protoc æ˜¯å®˜æ–¹ç¼–è¯‘å™¨ï¼Œç”¨äºæŠŠ <code>.proto</code> æ–‡ä»¶ç”Ÿæˆå„ç§è¯­è¨€çš„ç±»ï¼ˆåŒ…æ‹¬ PHPï¼‰ã€‚</p>
<p>ä¸‹è½½åœ°å€ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fprotocolbuffers%2Fprotobuf%2Freleases" target="_blank" title="https://github.com/protocolbuffers/protobuf/releases" ref="nofollow noopener noreferrer">github.com/protocolbufâ€¦</a></p>
<p>é€‰æ‹©å¯¹åº”å¹³å°çš„å‹ç¼©åŒ…ï¼Œè§£å‹åæŠŠ <code>protoc</code> æ”¾åˆ° PATH ä¸­å³å¯ã€‚</p>
<p>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<pre><code class="hljs language-bash" lang="bash">protoc --version
</code></pre>
<hr/>
<h2 data-id="heading-9">.proto æ–‡ä»¶æ˜¯ä»€ä¹ˆ</h2>
<p>â€‹<code>.proto</code> æ–‡ä»¶å¯ä»¥ç®€å•ç†è§£ä¸ºâ€œæ•°æ®ç»“æ„çš„ä¸€ä»½å­—å…¸â€ã€‚</p>
<p>å› ä¸º Protobuf çš„äºŒè¿›åˆ¶æ ¼å¼é‡Œæ²¡æœ‰å­—æ®µåï¼Œåªæœ‰å­—æ®µç¼–å·ï¼ˆtagï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-text" lang="text">field #1:  123
field #2: "Alice"
</code></pre>
<p>ä½ ä¸çŸ¥é“ #1 æ˜¯ <code>id</code>â€‹ è¿˜æ˜¯ <code>age</code>â€‹ï¼Œä¹Ÿä¸çŸ¥é“ #2 æ˜¯ <code>name</code> è¿˜æ˜¯åˆ«çš„ä¸œè¥¿ã€‚</p>
<p>æ‰€ä»¥å¿…é¡»ä¾é  <code>.proto</code> æ–‡ä»¶æ‰èƒ½è§£ç ã€‚</p>
<hr/>
<h2 data-id="heading-10">ä½¿ç”¨ protoc ç”Ÿæˆ PHP ç±»</h2>
<p>æˆ‘æœ¬åœ°çš„å‘½ä»¤å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">protoc --php_out=./protobuf \
       --proto_path=./protobuf \
       xxx.proto
</code></pre>
<p>å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>â€‹<code>--php_out</code>ï¼šç”Ÿæˆçš„ PHP æ–‡ä»¶å­˜æ”¾ä½ç½®</li>
<li>â€‹<code>--proto_path</code>â€‹ï¼šå¯»æ‰¾ <code>.proto</code> çš„ç›®å½•</li>
<li>å¤šä¸ª .proto å¯ä»¥ä¸€èµ·ç¼–è¯‘</li>
</ul>
<p>protoc ä¼šæ ¹æ® <code>.proto</code>â€‹ å†…å®¹ç”Ÿæˆä¸€å † PHP ç±»ï¼Œæ¯ä¸ª <code>message</code> å¯¹åº”ä¸€ä¸ª PHP ç±»ï¼Œæœ€ç»ˆè¿™äº›ç±»ä¼šç»§æ‰¿ï¼š</p>
<pre><code class="hljs language-text" lang="text">Google\Protobuf\Internal\Message
</code></pre>
<p>åºåˆ—åŒ–ã€ååºåˆ—åŒ–åŠŸèƒ½éƒ½æ¥è‡ªè¿™ä¸ªåŸºç±»ã€‚</p>
<hr/>
<h2 data-id="heading-11">é…ç½® Composer autoload</h2>
<p>å¦‚æœä½ å¸Œæœ›é€šè¿‡å‘½åç©ºé—´åŠ è½½ç”Ÿæˆçš„ç±»ï¼Œå¯ä»¥åœ¨ <code>composer.json</code> ä¸­åŠ ä¸€æ¡ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"autoload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"psr-4"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"Proto\\"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"protobuf/"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç„¶åæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">composer dumpautoload
</code></pre>
<hr/>
<h2 data-id="heading-12">åœ¨ PHP ä¸­è§£æ Protobuf</h2>
<p>è§£æçš„æ ¸å¿ƒæ–¹æ³•æ˜¯ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$msg</span>-&gt;<span class="hljs-title function_ invoke__">mergeFromString</span>(<span class="hljs-variable">$binary</span>)
</code></pre>
<p>è¯»å®Œåï¼Œæ•°æ®ç»“æ„ä¼šè‡ªåŠ¨å¡«å……åœ¨ message å¯¹è±¡é‡Œã€‚</p>
<hr/>
<h2 data-id="heading-13">åœ¨ PHP ä¸­ç”Ÿæˆ Protobuf æ•°æ®</h2>
<p>åºåˆ—åŒ–å¯¹åº”çš„æ–¹æ³•æ˜¯ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$binary</span> = <span class="hljs-variable">$msg</span>-&gt;<span class="hljs-title function_ invoke__">serializeToString</span>();
</code></pre>
<p>å¾—åˆ°çš„å°±æ˜¯ä¸€æ®µ protobuf äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥å‘é€åˆ°ç½‘ç»œæˆ–å†™å…¥æ–‡ä»¶ã€‚</p>
<hr/>
<h2 data-id="heading-14">å¿«é€Ÿæµ‹è¯•</h2>
<p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">.
â”œâ”€â”€ protobuf
â”‚   â””â”€â”€ TEST_USER_INFO.proto
â””â”€â”€ test.php
</code></pre>
<h3 data-id="heading-15">TEST_USER_INFO.proto</h3>
<pre><code class="hljs language-proto" lang="proto">syntax = "proto3";

option php_namespace = "TestUserInfo";

message User {
  int32 id = 1;
  string name = 2;
}
</code></pre>
<h3 data-id="heading-16">test.php</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/vendor/autoload.php'</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">TestUserInfo</span>\<span class="hljs-title">User</span>;

<span class="hljs-variable">$u1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
<span class="hljs-variable">$u1</span>-&gt;<span class="hljs-title function_ invoke__">setId</span>(<span class="hljs-number">7</span>);
<span class="hljs-variable">$u1</span>-&gt;<span class="hljs-title function_ invoke__">setName</span>(<span class="hljs-string">"PHP Encode Test"</span>);

<span class="hljs-variable">$bin</span> = <span class="hljs-variable">$u1</span>-&gt;<span class="hljs-title function_ invoke__">serializeToString</span>();

<span class="hljs-variable">$u2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
<span class="hljs-variable">$u2</span>-&gt;<span class="hljs-title function_ invoke__">mergeFromString</span>(<span class="hljs-variable">$bin</span>);

<span class="hljs-title function_ invoke__">var_dump</span>([
    <span class="hljs-string">'åŸå§‹æ•°æ®'</span> =&gt; <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-variable">$bin</span>),
    <span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$u2</span>-&gt;<span class="hljs-title function_ invoke__">getId</span>(),
    <span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$u2</span>-&gt;<span class="hljs-title function_ invoke__">getName</span>(),
]);
</code></pre>
<hr/>
<h3 data-id="heading-17">å®‰è£…è¿è¡Œæ—¶åº“</h3>
<pre><code class="hljs language-bash" lang="bash">composer require google/protobuf
</code></pre>
<hr/>
<h3 data-id="heading-18">ç¼–è¯‘ .proto æ–‡ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash">protoc --php_out=./protobuf --proto_path=./protobuf TEST_USER_INFO.proto
</code></pre>
<p>è¿™ä¼šåœ¨ <code>protobuf/</code> ç›®å½•ä¸‹ç”Ÿæˆ PHP ç±»æ–‡ä»¶ï¼Œä¾› PHP ä½¿ç”¨ã€‚</p>
<hr/>
<h3 data-id="heading-19">é…ç½® Composer autoload</h3>
<p>åœ¨ <code>composer.json</code> ä¸­å¢åŠ å‘½åç©ºé—´æ˜ å°„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"google/protobuf"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.33"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"autoload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"psr-4"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"GPBMetadata\\"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"protobuf/GPBMetadata"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"TestUserInfo\\"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"protobuf/TestUserInfo"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç„¶åé‡æ–°åŠ è½½ Composer è‡ªåŠ¨åŠ è½½ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">composer clear-cache &amp;&amp; composer dump-autoload -o
</code></pre>
<h3 data-id="heading-20">è¿è¡Œæµ‹è¯•</h3>
<pre><code class="hljs language-bash" lang="bash">php test.php
</code></pre>
<p>è¿è¡Œåï¼Œä½ ä¼šçœ‹åˆ°åºåˆ—åŒ–å†ååºåˆ—åŒ–çš„æ•°æ®è¢«æ­£ç¡®è¾“å‡ºï¼Œè¯æ˜ PHP æˆåŠŸå¤„ç†äº† Protobuf æ•°æ®ã€‚</p>
<h2 data-id="heading-21">å†™åœ¨æœ€å</h2>
<p>PHP è§£æ Protobuf çš„ä½“éªŒç¡®å®ä¸ç®—å¥½ï¼Œä½†èƒ½ç”¨ï¼Œå¹¶ä¸”åœ¨æŸäº›éœ€è¦å…¼å®¹ä¸Šæ¸¸æœåŠ¡çš„åœºæ™¯é‡Œè¿˜æ˜¯å¿…é¡»ç”¨ã€‚<br/>
å¦‚æœä½ ä¹Ÿæ­£åœ¨å¤„ç†ç±»ä¼¼çš„æ•°æ®ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ å°‘è¸©ç‚¹å‘ã€‚</p>
<p>å¦‚æœæ„Ÿè§‰æ–‡ç« é‡Œå“ªéƒ¨åˆ†è¿˜æ²¡è¯´æ¸…æ¥šï¼Œæ¬¢è¿ç»§ç»­äº¤æµã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot é›†æˆ ElasticSearch çš„ç®€å•ç¤ºä¾‹]]></title>    <link>https://juejin.cn/post/7582863493259624500</link>    <guid>https://juejin.cn/post/7582863493259624500</guid>    <pubDate>2025-12-13T07:12:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582863493259624500" data-draft-id="7582848701268033571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot é›†æˆ ElasticSearch çš„ç®€å•ç¤ºä¾‹"/> <meta itemprop="keywords" content="Spring Boot,è®¾è®¡"/> <meta itemprop="datePublished" content="2025-12-13T07:12:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Somehow007"/> <meta itemprop="url" content="https://juejin.cn/user/2425968473158731"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot é›†æˆ ElasticSearch çš„ç®€å•ç¤ºä¾‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2425968473158731/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Somehow007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:12:59.000Z" title="Sat Dec 13 2025 07:12:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç¤ºä¾‹é‡‡ç”¨ Spring Boot 3.0.7ã€ ElasticSearch 8.16.0ï¼Œå…¶ä¸­ es ä¸ºæœ¬åœ°é…ç½®çš„å•æœºæœåŠ¡</p>
<h3 data-id="heading-0">1. ä¸‹è½½ ElastiSearch</h3>
<p>å®˜æ–¹ GitHub ä¸Šç›®å‰åªæœ‰æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch" target="_blank" title="https://github.com/elastic/elasticsearch" ref="nofollow noopener noreferrer">github.com/elastic/elaâ€¦</a>ï¼Œå¹¶æ²¡æœ‰å‘å¸ƒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› æ­¤æ¨èä½¿ç”¨ docker æ¥ä¸‹è½½ã€‚</p>
<p>å®˜æ–¹æä¾›äº†ä¸€ä¸ª docker ä¸‹è½½çš„è„šæœ¬ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Fstart-local" target="_blank" title="https://github.com/elastic/start-local" ref="nofollow noopener noreferrer">github.com/elastic/staâ€¦</a></p>
<p>è¿™é‡Œç®€å•è¿›è¡Œä»‹ç»ä¸€ä¸‹ï¼š</p>
<h4 data-id="heading-1">1.1. ç³»ç»Ÿè¦æ±‚</h4>
<ul>
<li>æ”¯æŒ Windowsï¼ˆéœ€ä¸‹è½½ WSL2ï¼‰ã€Linuxã€macOS</li>
<li>éœ€è¦æœ‰ docker</li>
<li>éœ€è¦è‡³å°‘ 5GB çš„ç¡¬ç›˜ç©ºé—´</li>
</ul>
<p>å…¶ä¸­ Windows å’Œ macOS æ¨èä¸‹è½½ docker-desktopï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.docker.com%2Fproducts%2Fdocker-desktop%2F" target="_blank" title="https://www.docker.com/products/docker-desktop/" ref="nofollow noopener noreferrer">www.docker.com/products/doâ€¦</a></p>
<h4 data-id="heading-2">1.2. å®‰è£…</h4>
<p>ç»ˆç«¯é‡Œè¾“å…¥ä¸€ä¸‹å‘½ä»¤ï¼ˆéœ€ç¡®ä¿docker-desktopå¯åŠ¨ï¼‰ï¼Œå¯æŒ‡å®šç‰ˆæœ¬</p>
<pre><code class="hljs language-sql" lang="sql">curl <span class="hljs-operator">-</span>fsSL https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>elastic.co<span class="hljs-operator">/</span><span class="hljs-keyword">start</span><span class="hljs-operator">-</span><span class="hljs-keyword">local</span> <span class="hljs-operator">|</span> sh <span class="hljs-operator">-</span>s <span class="hljs-comment">-- -v 8.16.0</span>
</code></pre>
<ul>
<li>è¯¥å‘½ä»¤ä¼šä¸‹è½½è„šæœ¬å¹¶æ‰§è¡Œï¼Œåˆ›å»º<code>elastic-start-local/</code> ç›®å½•ï¼Œä»¥åŠåœ¨ç›®å½•é‡Œç”Ÿæˆå¿…è¦çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚.envã€docker-compose.ymlï¼Œè¿˜ä¼šè‡ªåŠ¨æ‹‰å–å®˜æ–¹é•œåƒå¹¶å¯åŠ¨å®¹å™¨ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53d521aa4d29499cb442a34fbd70bda5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=FAJurrfuJtrvMLhXBkJCR0VOhxY%3D" alt="" loading="lazy"/></p>
<ul>
<li>ä¼šåŒ…å« Elastic ä¼ä¸šç‰ˆ30å¤©ä½¿ç”¨è®¸å¯è¯ï¼Œ30å¤©åè‡ªåŠ¨é™çº§ä¸ºBasicï¼ˆå…è´¹å¼€æºç‰ˆï¼‰</li>
<li>è¿˜ä¼šè®¾ç½®å®‰å…¨è®¿é—®å’Œæ§åˆ¶</li>
</ul>

<ul>
<li>
<ul>
<li>è‡ªåŠ¨ç”Ÿæˆå¼ºå¯†ç ï¼ˆå­˜å‚¨åœ¨.envæ–‡ä»¶ï¼Œæ³¨æ„ï¼Œå¦‚æœéœ€è¦æ›´æ”¹å¯†ç ï¼Œåœ¨.envé‡Œæ›´æ”¹æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ï¼Œéœ€è¦åˆ°dockeré‡Œesçš„å®¹å™¨ä¸­å»æ›´æ”¹ï¼‰</li>
<li>è‡ªåŠ¨ç”Ÿæˆ <strong>API Key</strong></li>
<li><strong>ä»…ç»‘å®š localhost</strong></li>
<li><strong>ç¦ç”¨ HTTPS</strong>ï¼ˆä»… HTTP + Basic Authï¼‰ï¼Œé€‚åˆæœ¬åœ°è°ƒè¯•ã€‚</li>
</ul>
</li>
</ul>

<ul>
<li>è¯¥è„šæœ¬çš„å…¶ä»–è¯¦ç»†ç‰¹æ€§å¯è‡ªè¡Œå»å®˜ç½‘æŸ¥çœ‹ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58f6a918aaba409db04e518dc9d858b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=T7LkC2Xkp8DYc3Vshny3wr0S%2BjE%3D" alt="" loading="lazy"/></p>
<p>å®‰è£…æˆåŠŸçš„é¡µé¢</p>
<p>elastic-searchç«¯å£åœ¨9200ï¼Œkibanaï¼ˆeså¯è§†åŒ–æ§åˆ¶å°ï¼‰åœ¨5601</p>
<h4 data-id="heading-3">1.3. å®‰è£… ik ä¸­æ–‡åˆ†è¯å™¨</h4>
<p><strong>ElasticSearch é»˜è®¤çš„åˆ†è¯å™¨å¯¹ä¸­æ–‡æ”¯æŒå¾ˆå·®</strong>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å®‰è£…ä¸“é—¨çš„ä¸­æ–‡åˆ†è¯å™¨ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fanalysis-ik%2Fblob%2Fmaster%2FREADME.md" target="_blank" title="https://github.com/infinilabs/analysis-ik/blob/master/README.md" ref="nofollow noopener noreferrer">github.com/infinilabs/â€¦</a></p>
<p>æˆ‘ä»¬éœ€è¦åœ¨ docker ä¸­æ‰“å¼€ elasticsearch çš„å®¹å™¨ï¼ˆä¸€èˆ¬å«åš <strong>es-local-dev</strong>ï¼‰ï¼Œç„¶åå°† ik åˆ†è¯å™¨å®‰è£…è‡³ bin/elasticsearch-plugin ç›®å½•ã€‚</p>
<p>å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/8.16.0
</code></pre>
<p>å¦‚æœä½ ä¸‹è½½äº†docker execï¼Œå¯ä»¥æ›´ä¾¿æ·çš„é€šè¿‡å¯è§†åŒ–è¿›å…¥å®¹å™¨ä¸­</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8aa89d113094c81960fe57d9e351e7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=zk%2FKVBWQr6Nw3gh6ke6fZCHYiAc%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç‚¹å‡» es-local-devï¼Œç„¶åå†é€‰æ‹© exec</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffe92ac538b34404a68b9d2f19b23d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=aGOaqO5wyW7xXorMeVGoF5EURyw%3D" alt="" loading="lazy"/></p>
<p>æ­¤æ—¶å°±å¯ä»¥åœ¨è¿™é‡Œçš„ç»ˆç«¯è¾“å…¥ä¸Šè¿°çš„å®‰è£…å‘½ä»¤ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯é‡Œè¾“å…¥</p>
<pre><code class="hljs language-bash" lang="bash">bin/elasticsearch-plugin list
</code></pre>
<p>å¦‚æœå‡ºç° analysis-ikï¼Œå°±å®Œæˆäº†ä¸‹è½½ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99d42f0bc8294741ad6b9f9358766a8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=USJkcj36ygnDbQ%2BVDe8pTjcgFco%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2. ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 data-id="heading-5">2.1. é¦–å…ˆå¯¼å…¥ä¾èµ–</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ElasticSearch --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ï¼Œä¸€èˆ¬ Spring Boot é¡¹ç›®ä¼šç»§æ‰¿ Spring Boot Starter Parentï¼Œæˆ–è€…ä½¿ç”¨ dependencyManagementã€‚å¦‚æœéƒ½æ²¡æœ‰ï¼Œç‰ˆæœ¬å·æŒ‡å®šä¸º Spring Boot çš„ç‰ˆæœ¬å·å³å¯ã€‚</p>
<h4 data-id="heading-6">2.2. é…ç½® application.yaml</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">elasticsearch:</span>
      <span class="hljs-attr">repositories:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-string">//</span> <span class="hljs-string">å¯ç”¨</span> <span class="hljs-string">Spring</span> <span class="hljs-string">Data</span> <span class="hljs-string">Elasticsearch</span> <span class="hljs-string">çš„</span> <span class="hljs-string">Repository</span> <span class="hljs-string">è‡ªåŠ¨ä»£ç†åŠŸèƒ½</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">uris:</span> <span class="hljs-string">http://localhost:9200</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">elastic</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">ä½ çš„å¯†ç </span>
</code></pre>
<h4 data-id="heading-7">2.3. åˆ›å»ºæ–‡æ¡£å®ä½“ï¼ˆES æ–‡æ¡£æ˜ å°„ç±»ï¼‰</h4>
<p>æ ¹æ®ä½ è¦æœç´¢çš„å†…å®¹ï¼Œåˆ›å»ºæ–‡æ¡£å®ä½“</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Builder;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">annotation</span>.Id;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.Document;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.Field;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.FieldType;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-comment">/**
 * ElasticSearch æ–‡æ¡£å®ä½“ç±» | åšå®¢æ–‡ç« 
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@Document(indexName = <span class="hljs-string">"blog_articles"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleDocument</span> {

    <span class="hljs-comment">/**
     * æ–‡æ¡£å”¯ä¸€æ ‡è¯†
     */</span>
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String id;

    <span class="hljs-comment">/**
     * æ–‡ç« æ ‡é¢˜
     * è¿™é‡Œé‡‡ç”¨ikåˆ†è¯å™¨
     * ik_smartç”¨äºå»ºç´¢å¼•æ—¶ç²—ç²’åº¦åˆ†è¯èŠ‚çœç©ºé—´ï¼Œik_max_wordç”¨äºæœç´¢æ—¶ç»†ç²’åº¦åˆ†è¯æé«˜å¬å›ç‡ã€‚
     */</span>
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = <span class="hljs-string">"ik_smart"</span>, searchAnalyzer = <span class="hljs-string">"ik_max_word"</span>)</span>
    <span class="hljs-keyword">private</span> String title;

    <span class="hljs-comment">/**
     * æ–‡ç« å†…å®¹
     */</span>
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = <span class="hljs-string">"ik_smart"</span>, searchAnalyzer = <span class="hljs-string">"ik_max_word"</span>)</span>
    <span class="hljs-keyword">private</span> String content;

    <span class="hljs-comment">/**
     * ä½œè€…id
     */</span>
    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span> <span class="hljs-comment">// ä¸åˆ†è¯ï¼Œç”¨äºç²¾ç¡®åŒ¹é…</span>
    <span class="hljs-keyword">private</span> String authorId;

    <span class="hljs-comment">/**
     * åˆ›å»ºæ—¶é—´
     */</span>
    <span class="hljs-meta">@Field(type = FieldType.Date)</span>
    <span class="hljs-keyword">private</span> Date createTime;
}
</code></pre>
<h4 data-id="heading-8">2.4. åˆ›å»º Respositoryï¼šES çš„æ“ä½œæ¥å£</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> io.github.somehow.mysite.dao.mapper;

<span class="hljs-keyword">import</span> io.github.somehow.mysite.elasticsearch.ArticleDocument;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Page;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;
<span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.repository.ElasticsearchRepository;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * Elasticsearch æŒä¹…å±‚ | åšå®¢æ–‡ç« 
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ArticleEsRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;ArticleDocument, String&gt; {

    <span class="hljs-comment">/**
     * æ ¹æ®æ ‡é¢˜æœç´¢æ–‡ç« 
     *
     * <span class="hljs-doctag">@param</span> title æ ‡é¢˜å…³é”®è¯
     * <span class="hljs-doctag">@param</span> pageable åˆ†é¡µå‚æ•°
     * <span class="hljs-doctag">@return</span> æ–‡ç« åˆ†é¡µç»“æœ
     */</span>
    Page&lt;ArticleDocument&gt; <span class="hljs-title function_">findByTitleContaining</span><span class="hljs-params">(String title, Pageable pageable)</span>;

    <span class="hljs-comment">/**
     * æ ¹æ®å†…å®¹æœç´¢æ–‡ç« 
     *
     * <span class="hljs-doctag">@param</span> content å†…å®¹å…³é”®è¯
     * <span class="hljs-doctag">@param</span> pageable åˆ†é¡µå‚æ•°
     * <span class="hljs-doctag">@return</span> æ–‡ç« åˆ†é¡µç»“æœ
     */</span>
    Page&lt;ArticleDocument&gt; <span class="hljs-title function_">findByContentContaining</span><span class="hljs-params">(String content, Pageable pageable)</span>;

    <span class="hljs-comment">/**
     * æ ¹æ®ä½œè€…IDåˆ—è¡¨æœç´¢æ–‡ç« 
     *
     * <span class="hljs-doctag">@param</span> authorIds ä½œè€…IDåˆ—è¡¨
     * <span class="hljs-doctag">@param</span> pageable åˆ†é¡µå‚æ•°
     * <span class="hljs-doctag">@return</span> æ–‡ç« åˆ†é¡µç»“æœ
     */</span>
    Page&lt;ArticleDocument&gt; <span class="hljs-title function_">findByAuthorIdIn</span><span class="hljs-params">(List&lt;String&gt; authorIds, Pageable pageable)</span>;
}
</code></pre>
<ul>
<li>è¿™é‡Œå®šä¹‰çš„æ–¹æ³•ä¸éœ€è¦å»å®ç°ï¼Œè¿™æ˜¯ <strong>Spring Data çš„ Repository åŠ¨æ€ä»£ç†æœºåˆ¶</strong>ï¼Œ<strong>Spring åœ¨å¯åŠ¨æ—¶ä¼šæ ¹æ®æ–¹æ³•åè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢å®ç°</strong>ï¼Œå› æ­¤æ— éœ€æ‰‹åŠ¨ç¼–å†™ä»£ç ã€‚</li>
<li>æ³¨æ„ï¼Œæ­¤å¤„çš„ <strong>Page</strong> æ˜¯ <strong>org.springframework.data.domain.Page</strong>ï¼Œå¦‚æœä½ ä½¿ç”¨äº† Mybatis-Plusï¼Œéœ€è¦æ³¨æ„å’ŒMybatis-Plus çš„ Page åŒºåˆ«å¼€ã€‚</li>
<li>psï¼šåº•å±‚ ES æŸ¥è¯¢å¹¶ä¸å¼ºåˆ¶åˆ†é¡µï¼›ä¸è¿‡ï¼Œ<strong>Repository</strong> æ¥å£æ–¹æ³•å¦‚æœè¿”å› <strong>Page</strong> ç±»å‹ï¼Œä¼š<strong>è‡ªåŠ¨è¿›è¡Œåˆ†é¡µ</strong>å¤„ç†ï¼Œè¿™æ˜¯<strong>æ¡†æ¶å±‚é¢çš„å°è£…ã€‚</strong></li>
</ul>
<h4 data-id="heading-9">2.5. åœ¨ Service ä¸šåŠ¡é€»è¾‘å±‚ç¼–å†™ ES çš„ç›¸å…³é€»è¾‘</h4>
<pre><code class="hljs language-ini" lang="ini">import cn.hutool.core.bean.BeanUtil<span class="hljs-comment">;</span>
import cn.hutool.core.util.IdUtil<span class="hljs-comment">;</span>
import cn.hutool.core.util.StrUtil<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.core.metadata.IPage<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.core.toolkit.Wrappers<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.extension.plugins.pagination.Page<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.extension.toolkit.SqlHelper<span class="hljs-comment">;</span>
import io.github.somehow.mysite.commons.framework.exception.ClientException<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.entity.ArticleDO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.entity.UserDO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.entity.UserFavoriteArticleDO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.mapper.ArticleEsRepository<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.mapper.ArticleMapper<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.mapper.UserFavoriteArticleMapper<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.mapper.UserMapper<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dto.req.article.*<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dto.resp.ArticlePageQueryRespDTO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dto.resp.ArticleSelectRespDTO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.elasticsearch.ArticleDocument<span class="hljs-comment">;</span>
import io.github.somehow.mysite.service.ArticleService<span class="hljs-comment">;</span>
import lombok.RequiredArgsConstructor<span class="hljs-comment">;</span>
import lombok.extern.slf4j.Slf4j<span class="hljs-comment">;</span>
import org.springframework.dao.DuplicateKeyException<span class="hljs-comment">;</span>
import org.springframework.data.domain.PageRequest<span class="hljs-comment">;</span>
import org.springframework.stereotype.Service<span class="hljs-comment">;</span>
import org.springframework.transaction.annotation.Transactional<span class="hljs-comment">;</span>
import org.springframework.util.CollectionUtils<span class="hljs-comment">;</span>

import java.util.Collections<span class="hljs-comment">;</span>
import java.util.List<span class="hljs-comment">;</span>
import java.util.Objects<span class="hljs-comment">;</span>
import java.util.stream.Collectors<span class="hljs-comment">;</span>

/**
 * æ–‡ç« ä¸šåŠ¡é€»è¾‘å®ç°å±‚
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class ArticleServiceImpl extends ServiceImpl&lt;ArticleMapper, ArticleDO&gt; implements ArticleService {

    private final ArticleEsRepository esRepository<span class="hljs-comment">;</span>
    private final UserMapper userMapper<span class="hljs-comment">;</span>

    @Override
    @Transactional
    public void createArticle(ArticleCreateReqDTO requestParam) {

        // ç•¥ï¼Œæ­¤å¤„ä¸ºæ–‡ç« åˆ›å»ºé€»è¾‘ï¼Œå¹¶å¡«å…¥æ•°æ®åº“
        articleMapper.insert(articleDO)<span class="hljs-comment">;</span>

        // éœ€è¦å°†æ•°æ®åŒæ­¥åˆ° ElasticSearch ä¸­
        ArticleDocument <span class="hljs-attr">doc</span> = ArticleDocument.builder()
                .id(articleDO.getId().toString())
                .title(requestParam.getTitle())
                .content(requestParam.getContent())
                .authorId(articleDO.getAuthorId().toString())
                .createTime(articleDO.getCreateTime())
                .build()<span class="hljs-comment">;</span>
        esRepository.save(doc)<span class="hljs-comment">;</span>
    }

    @Override
    public void updateArticle(ArticleUpdateReqDTO requestParam) {

        // ç•¥ï¼Œæ­¤å¤„ä¸ºæ›´æ–°æ“ä½œ
        baseMapper.update(updateWrapper)<span class="hljs-comment">;</span>

        // æ›´æ–°ESä¸­çš„æ–‡æ¡£
        ArticleDO <span class="hljs-attr">updatedArticle</span> = baseMapper.selectOne(Wrappers.lambdaQuery(ArticleDO.class)
                .eq(ArticleDO::getId, requestParam.getId())
                .eq(ArticleDO::getDelFlag, 0))<span class="hljs-comment">;</span>
        
        if (updatedArticle != null) {
            ArticleDocument <span class="hljs-attr">articleDocument</span> = ArticleDocument.builder()
                    .id(updatedArticle.getId().toString())
                    .title(updatedArticle.getTitle())
                    .content(updatedArticle.getContent())
                    .authorId(updatedArticle.getAuthorId().toString())
                    .createTime(updatedArticle.getCreateTime())
                    .build()<span class="hljs-comment">;</span>

            esRepository.save(articleDocument)<span class="hljs-comment">;</span>
        }
    }

    @Override
    public void deleteArticle(Long id) {

        // ç•¥ï¼Œæ­¤å¤„ä¸ºåˆ é™¤é€»è¾‘
        articleDO.setDelFlag(1)<span class="hljs-comment">;</span>
        baseMapper.update(articleDO, updateWrapper)<span class="hljs-comment">;</span>

        // åˆ é™¤åŒæ­¥åˆ° ES
        esRepository.deleteById(id.toString())<span class="hljs-comment">;</span>
    }

    @Override
    public IPage&lt;ArticlePageQueryRespDTO&gt; pageQueryArticle(ArticlePageQueryReqDTO requestParam) {
        // æ„å»ºESåˆ†é¡µå‚æ•°
        PageRequest <span class="hljs-attr">pageRequest</span> = PageRequest.of(
                (int) (requestParam.getCurrent() - 1), 
                (int) requestParam.getSize())<span class="hljs-comment">;</span>
        
        // è·å–æœç´¢å…³é”®è¯
        String <span class="hljs-attr">keyword</span> = StrUtil.blankToDefault(requestParam.getKeyword(), <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
        
        // è·å–æœç´¢ç±»å‹ï¼Œé»˜è®¤æŒ‰æ ‡é¢˜æœç´¢
        String <span class="hljs-attr">searchType</span> = StrUtil.blankToDefault(requestParam.getSearchType(), <span class="hljs-string">"title"</span>)<span class="hljs-comment">;</span>
        
        org.springframework.data.domain.Page&lt;ArticleDocument&gt; esPage<span class="hljs-comment">;</span>
        switch (searchType) {
            case "title":
                // æŒ‰æ ‡é¢˜æœç´¢
                <span class="hljs-attr">esPage</span> = esRepository.findByTitleContaining(keyword, pageRequest)<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
            case "content":
                // æŒ‰å†…å®¹æœç´¢
                <span class="hljs-attr">esPage</span> = esRepository.findByContentContaining(keyword, pageRequest)<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
            case "author":
                // æŒ‰ä½œè€…æœç´¢
                List&lt;UserDO&gt; <span class="hljs-attr">matchedUsers</span> = userMapper.selectByUsernameLike(keyword)<span class="hljs-comment">;</span>
                if (!CollectionUtils.isEmpty(matchedUsers)) {
                    List&lt;String&gt; <span class="hljs-attr">authorIds</span> = matchedUsers.stream()
                            .map(user -&gt; user.getId().toString())
                            .collect(Collectors.toList())<span class="hljs-comment">;</span>
                    <span class="hljs-attr">esPage</span> = esRepository.findByAuthorIdIn(authorIds, pageRequest)<span class="hljs-comment">;</span>
                } else {
                    // æ²¡æœ‰åŒ¹é…çš„ç”¨æˆ·ï¼Œè¿”å›ç©ºç»“æœ
                    return new Page&lt;&gt;()<span class="hljs-comment">;</span>
                }
                break<span class="hljs-comment">;</span>
            default:
                // é»˜è®¤æŒ‰æ ‡é¢˜æœç´¢
                <span class="hljs-attr">esPage</span> = esRepository.findByTitleContaining(keyword, pageRequest)<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
        }
        
        // å°†ESæŸ¥è¯¢ç»“æœè½¬æ¢ä¸ºéœ€è¦çš„DTOæ ¼å¼
        if (esPage.hasContent()) {
            List&lt;Long&gt; <span class="hljs-attr">articleIds</span> = esPage.getContent().stream()
                    .map(doc -&gt; Long.valueOf(doc.getId()))
                    .collect(Collectors.toList())<span class="hljs-comment">;</span>
                    
            // ä»æ•°æ®åº“è·å–å®Œæ•´æ–‡ç« ä¿¡æ¯
            List&lt;ArticleDO&gt; <span class="hljs-attr">articles</span> = baseMapper.selectList(Wrappers.&lt;ArticleDO&gt;lambdaQuery()
                    .in(ArticleDO::getId, articleIds)
                    .eq(ArticleDO::getDelFlag, 0))<span class="hljs-comment">;</span>
            
            // è·å–ä½œè€…ä¿¡æ¯
            List&lt;Long&gt; <span class="hljs-attr">authorIds</span> = articles.stream()
                    .map(ArticleDO::getAuthorId)
                    .distinct()
                    .collect(Collectors.toList())<span class="hljs-comment">;</span>
            
            List&lt;UserDO&gt; <span class="hljs-attr">authors</span> = userMapper.selectList(Wrappers.&lt;UserDO&gt;lambdaQuery()
                    .in(UserDO::getId, authorIds))<span class="hljs-comment">;</span>
            
            // æ„å»ºè¿”å›ç»“æœ
            List&lt;ArticlePageQueryRespDTO&gt; <span class="hljs-attr">records</span> = articles.stream()
                    .map(article -&gt; {
                        ArticlePageQueryRespDTO <span class="hljs-attr">dto</span> = new ArticlePageQueryRespDTO()<span class="hljs-comment">;</span>
                        dto.setId(article.getId())<span class="hljs-comment">;</span>
                        dto.setTitle(article.getTitle())<span class="hljs-comment">;</span>
                        dto.setSummary(article.getSummary())<span class="hljs-comment">;</span>
                        dto.setViewCount(article.getViewCount())<span class="hljs-comment">;</span>
                        dto.setFavoriteCount(article.getFavoriteCount())<span class="hljs-comment">;</span>
                        
                        // è®¾ç½®ä½œè€…åç§°
                        String <span class="hljs-attr">authorName</span> = authors.stream()
                                .filter(user -&gt; user.getId().equals(article.getAuthorId()))
                                .map(UserDO::getUsername)
                                .findFirst()
                                .orElse("")<span class="hljs-comment">;</span>
                        dto.setAuthorName(authorName)<span class="hljs-comment">;</span>
                        
                        return dto<span class="hljs-comment">;</span>
                    })
                    .collect(Collectors.toList())<span class="hljs-comment">;</span>
            
            // æ„é€ MyBatis Plusåˆ†é¡µå¯¹è±¡
            IPage&lt;ArticlePageQueryRespDTO&gt; <span class="hljs-attr">result</span> = new Page&lt;&gt;(requestParam.getCurrent(), requestParam.getSize(), esPage.getTotalElements())<span class="hljs-comment">;</span>
            result.setRecords(records)<span class="hljs-comment">;</span>
            return result<span class="hljs-comment">;</span>
        } else {
            return new Page&lt;&gt;()<span class="hljs-comment">;</span>
        }
    }

}
</code></pre>
<h4 data-id="heading-10">2.6. Contriller ä¸­è®¾ç½® API æ¥å£</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.commons.framework.result.Result;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.commons.framework.web.Results;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.dto.req.article.*;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.dto.resp.ArticlePageQueryRespDTO;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.dto.resp.ArticleSelectRespDTO;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.service.ArticleService;
<span class="hljs-keyword">import</span> io.swagger.v3.oas.annotations.Operation;
<span class="hljs-keyword">import</span> io.swagger.v3.oas.annotations.tags.Tag;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.*;

<span class="hljs-comment">/**
 * æ–‡ç« æ•°æ®æ§åˆ¶å±‚
 */</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@Tag(name = <span class="hljs-string">"æ–‡ç« æ•°æ®ç®¡ç†"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArticleService articleService;

    <span class="hljs-meta">@Operation(summary = <span class="hljs-string">"åˆ›å»ºæ–‡ç« "</span>)</span>
    <span class="hljs-meta">@PostMapping(<span class="hljs-string">"/api/article/create"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; createArticle(<span class="hljs-meta">@RequestBody</span> ArticleCreateReqDTO requestParam) {
        articleService.createArticle(requestParam);
        <span class="hljs-keyword">return</span> Results.success();
    }

    <span class="hljs-meta">@Operation(summary = <span class="hljs-string">"æ›´æ–°æ–‡ç« "</span>)</span>
    <span class="hljs-meta">@PutMapping(<span class="hljs-string">"/api/article/update"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; updateArticle(<span class="hljs-meta">@RequestBody</span> ArticleUpdateReqDTO requestParam) {
        articleService.updateArticle(requestParam);
        <span class="hljs-keyword">return</span> Results.success();
    }

    <span class="hljs-meta">@Operation(summary = <span class="hljs-string">"åˆ é™¤æ–‡ç« "</span>)</span>
    <span class="hljs-meta">@DeleteMapping(<span class="hljs-string">"/api/article/delete/{id}"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; deleteArticle(<span class="hljs-meta">@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) {
        articleService.deleteArticle(<span class="hljs-built_in">Long</span>.parseLong(id));
        <span class="hljs-keyword">return</span> Results.success();
    }

    <span class="hljs-meta">@Operation(summary = <span class="hljs-string">"åˆ†é¡µæœç´¢æ–‡ç« ä¿¡æ¯"</span>)</span>
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/api/article/search"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;IPage&lt;ArticlePageQueryRespDTO&gt;&gt; pageQueryArticle(ArticlePageQueryReqDTO requestParam) {
        <span class="hljs-keyword">return</span> Results.success(articleService.pageQueryArticle(requestParam));
    }

}
</code></pre>
<p>å¦‚æœæœ‰é”™è¯¯æˆ–çº°æ¼ï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºç•™è¨€æŒ‡æ­£ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘¨æœ«æ‹†è§£ï¼šQLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582814236584329254</link>    <guid>https://juejin.cn/post/7582814236584329254</guid>    <pubDate>2025-12-13T07:30:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582814236584329254" data-draft-id="7582849187865395251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" å‘¨æœ«æ‹†è§£ï¼šQLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,æ¶æ„,ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-13T07:30:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             å‘¨æœ«æ‹†è§£ï¼šQLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:30:31.000Z" title="Sat Dec 13 2025 07:30:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆè¦æ‹†è§£è¿™ä¸ªè½®å­</h2>
<p>é¡¹ç›®é‡Œç”¨äº† QLExpress åšè§„åˆ™å¼•æ“ï¼Œé…ç½®æ»¡å‡è§„åˆ™ã€ç§¯åˆ†è®¡ç®—ä¹‹ç±»çš„éœ€æ±‚ã€‚ä¸€ç›´æœ‰å‡ ä¸ªç–‘é—®ï¼š</p>
<p><strong>ç–‘é—®1ï¼šå®ƒä¸ç”Ÿæˆ class æ–‡ä»¶ï¼Œæ€ä¹ˆæ‰§è¡Œ if è¯­å¥ï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>;
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> runner.execute(script);  <span class="hljs-comment">// ç›´æ¥å°±èƒ½è·‘ï¼Ÿ</span>
</code></pre>
<p><strong>ç–‘é—®2ï¼šå®ƒæ€ä¹ˆè°ƒç”¨æˆ‘è‡ªå·±å†™çš„ Java ç±»ï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java">runner.addFunctionOfClassMethod(<span class="hljs-string">"æŠ˜æ‰£"</span>, MyMath.class.getName(), <span class="hljs-string">"discount"</span>, ...);
<span class="hljs-comment">// è„šæœ¬é‡Œå°±èƒ½ç”¨ï¼šæŠ˜æ‰£(amount, 0.8)</span>
</code></pre>
<p><strong>ç–‘é—®3ï¼šè¿ç®—ç¬¦ä¼˜å…ˆçº§æ€ä¹ˆä¿è¯ï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-string">"2 + 3 * 4"</span>  <span class="hljs-comment">// æ€ä¹ˆçŸ¥é“å…ˆç®—ä¹˜æ³•ï¼Ÿ</span>
</code></pre>
<p>å‘¨æœ«æ­£å¥½æœ‰æ—¶é—´ï¼ŒèŠ±äº†ä¸€å¤©æ‰‹å†™äº†ä¸€ä¸ª 700 è¡Œçš„æç®€ç‰ˆï¼ŒæŠŠè¿™äº›é—®é¢˜éƒ½ææ¸…æ¥šäº†ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æ•´ä½“æµç¨‹ï¼šä»å­—ç¬¦ä¸²åˆ°ç»“æœ</h2>
<p>å…ˆçœ‹å…¨å±€ï¼ŒQLExpress æŠŠè„šæœ¬æ‰§è¡Œåˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[è„šæœ¬å­—ç¬¦ä¸²] --&gt; B[è¯æ³•åˆ†æ&lt;br/&gt;Lexer]
    B --&gt; C[Tokenæµ]
    C --&gt; D[è¯­æ³•åˆ†æ&lt;br/&gt;Parser]
    D --&gt; E[ASTæ ‘]
    E --&gt; F[è§£é‡Šæ‰§è¡Œ&lt;br/&gt;Interpreter]
    F --&gt; G[ç»“æœ]
</code></pre>
<p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java">è¾“å…¥è„šæœ¬ï¼š<span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">100</span>) amount * <span class="hljs-number">0.8</span>
ä¸Šä¸‹æ–‡å˜é‡ï¼šamount = <span class="hljs-number">150</span>
</code></pre>
<h3 data-id="heading-2">é˜¶æ®µä¸€ï¼šè¯æ³•åˆ†æï¼ˆæŠŠå­—ç¬¦ä¸²åˆ‡æˆè¯ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss">è¾“å…¥ï¼š"if (amount &gt; <span class="hljs-number">100</span>) amount * <span class="hljs-number">0.8</span>"
è¾“å‡ºï¼š<span class="hljs-selector-attr">[IF]</span> <span class="hljs-selector-attr">[LPAREN]</span> <span class="hljs-selector-attr">[IDENTIFIER:amount]</span> <span class="hljs-selector-attr">[GREATER]</span> <span class="hljs-selector-attr">[NUMBER:100]</span> <span class="hljs-selector-attr">[RPAREN]</span> 
      <span class="hljs-selector-attr">[IDENTIFIER:amount]</span> <span class="hljs-selector-attr">[MULTIPLY]</span> <span class="hljs-selector-attr">[NUMBER:0.8]</span>
</code></pre>
<p>å°±åƒä¸­æ–‡åˆ†è¯ï¼ŒæŠŠä¸€å¥è¯åˆ‡æˆä¸€ä¸ªä¸ªå•è¯ã€‚ä»£ç é‡Œç”¨çŠ¶æ€æœºå®ç°ï¼Œé€ä¸ªå­—ç¬¦æ‰«æã€‚</p>
<h3 data-id="heading-3">é˜¶æ®µäºŒï¼šè¯­æ³•åˆ†æï¼ˆæŠŠè¯ç»„è£…æˆæ ‘ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss">Tokenæµ â†’ ASTæ ‘

         IfNode
        /      \
   æ¡ä»¶èŠ‚ç‚¹    æ‰§è¡ŒèŠ‚ç‚¹
  (amount&gt;<span class="hljs-number">100</span>) (amount*<span class="hljs-number">0.8</span>)
       |            |
  BinaryOpNode  BinaryOpNode
    /    \        /    \
  amount <span class="hljs-number">100</span>   amount  <span class="hljs-number">0.8</span>
</code></pre>
<p>å°±åƒé€ å¥ï¼ŒæŠŠå•è¯ç»„æˆæœ‰ç»“æ„çš„å¥å­ã€‚ä»£ç é‡Œç”¨é€’å½’ä¸‹é™å®ç°ï¼Œä¸€å±‚å±‚å¾€ä¸‹è§£æã€‚</p>
<h3 data-id="heading-4">é˜¶æ®µä¸‰ï¼šè§£é‡Šæ‰§è¡Œï¼ˆéå†æ ‘ç®—ç»“æœï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">éå† IfNodeï¼š
  1. å…ˆæ‰§è¡Œæ¡ä»¶èŠ‚ç‚¹ï¼š150 &gt; <span class="hljs-attr">100</span> = <span class="hljs-literal">true</span>
  2. å› ä¸ºæ¡ä»¶ä¸º trueï¼Œæ‰§è¡Œ then åˆ†æ”¯
  3. æ‰§è¡Œ then èŠ‚ç‚¹ï¼š150 * <span class="hljs-attr">0.8</span> = <span class="hljs-number">120</span>
  4. è¿”å›ç»“æœï¼š120
</code></pre>
<p>ä¸ç”Ÿæˆå­—èŠ‚ç ï¼Œç›´æ¥ç”¨ Java ä»£ç éå†æ ‘æ‰§è¡Œã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€æ ¸å¿ƒåŸç†ä¸€ï¼šif è¯­å¥çš„ç§˜å¯†</h2>
<h3 data-id="heading-6">å…³é”®é—®é¢˜</h3>
<p>QLExpress çš„ if åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ JVM çš„ if æŒ‡ä»¤å—ï¼Ÿ</p>
<h3 data-id="heading-7">ç­”æ¡ˆï¼šç”¨ Java çš„ if åŒ…è£…</h3>
<p><strong>å…ˆçœ‹ Groovy çš„åšæ³•</strong>ï¼ˆç¼–è¯‘æˆå­—èŠ‚ç ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Groovy ä¼šæŠŠè„šæœ¬ç¼–è¯‘æˆçœŸæ­£çš„ class</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Script123</span> {
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">100</span>) {  <span class="hljs-comment">// â† è¿™æ˜¯ JVM çš„ if æŒ‡ä»¤</span>
            <span class="hljs-keyword">return</span> amount * <span class="hljs-number">0.8</span>;
        }
    }
}
</code></pre>
<p><strong>å†çœ‹ QLExpress çš„åšæ³•</strong>ï¼ˆç”¨ Java ä»£ç æ¨¡æ‹Ÿï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. Parser è§£ææ—¶ï¼Œè¯†åˆ« if å…³é”®å­—</span>
<span class="hljs-keyword">if</span> (peek().getType() == TokenType.IF) {
    <span class="hljs-keyword">return</span> parseIfStatement();  <span class="hljs-comment">// æ„é€  IfNode</span>
}

<span class="hljs-comment">// 2. æ„é€  AST èŠ‚ç‚¹</span>
IfNode {
    condition: BinaryOpNode(amount, &gt;, <span class="hljs-number">100</span>)
    thenBranch: BinaryOpNode(amount, *, <span class="hljs-number">0.8</span>)
}

<span class="hljs-comment">// 3. Interpreter æ‰§è¡Œæ—¶</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">interpretIf</span><span class="hljs-params">(IfNode node, Context context)</span> {
    <span class="hljs-comment">// å…ˆè®¡ç®—æ¡ä»¶è¡¨è¾¾å¼</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">condResult</span> <span class="hljs-operator">=</span> interpret(node.getCondition(), context);
    
    <span class="hljs-comment">// ç”¨ Java çš„ if åˆ¤æ–­</span>
    <span class="hljs-keyword">if</span> (condResult <span class="hljs-keyword">instanceof</span> Boolean &amp;&amp; (Boolean) condResult) {
        <span class="hljs-keyword">return</span> interpret(node.getThenBranch(), context);  <span class="hljs-comment">// æ‰§è¡Œ then åˆ†æ”¯</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>æ ¸å¿ƒå·®å¼‚</strong>ï¼š</p>
<pre><code class="hljs">Groovyï¼š  è„šæœ¬çš„ if â†’ ç¼–è¯‘æˆ JVM çš„ if æŒ‡ä»¤
QLExpressï¼šè„šæœ¬çš„ if â†’ æ„é€  IfNode â†’ ç”¨ Java çš„ if æ¨¡æ‹Ÿæ‰§è¡Œ
</code></pre>
<h3 data-id="heading-8">æ‰§è¡Œæµç¨‹å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[è„šæœ¬: if amount&gt;100] --&gt; B[Lexerè¯†åˆ«å…³é”®å­— IF]
    B --&gt; C[Parser.parseIfStatement]
    C --&gt; D[æ„é€  IfNode]
    D --&gt; E[å­˜å‚¨ condition å’Œ thenBranch]
    E --&gt; F[Interpreter.interpretIf]
    F --&gt; G[å…ˆæ‰§è¡Œ condition èŠ‚ç‚¹]
    G --&gt; H{ç»“æœæ˜¯ true?}
    H --&gt;|æ˜¯| I[æ‰§è¡Œ thenBranch èŠ‚ç‚¹]
    H --&gt;|å¦| J[è¿”å› null]
    I --&gt; K[è¿”å›ç»“æœ]
</code></pre>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Parser.java - å¦‚ä½•è¯†åˆ« if è¯­å¥</span>
<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseIfStatement</span><span class="hljs-params">()</span> {
    consumeToken(TokenType.IF);           <span class="hljs-comment">// æ¶ˆè´¹ 'if'</span>
    consumeToken(TokenType.LPAREN);       <span class="hljs-comment">// æ¶ˆè´¹ '('</span>
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> parseExpression(); <span class="hljs-comment">// é€’å½’è§£ææ¡ä»¶ï¼ˆé‡ç‚¹ï¼ï¼‰</span>
    consumeToken(TokenType.RPAREN);       <span class="hljs-comment">// æ¶ˆè´¹ ')'</span>
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">thenBranch</span> <span class="hljs-operator">=</span> parseExpression();<span class="hljs-comment">// é€’å½’è§£æ then åˆ†æ”¯ï¼ˆé‡ç‚¹ï¼ï¼‰</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IfNode</span>(condition, thenBranch, <span class="hljs-literal">null</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-9">å››ã€æ ¸å¿ƒåŸç†äºŒï¼šå¦‚ä½•è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•</h2>
<h3 data-id="heading-10">å…³é”®é—®é¢˜</h3>
<p>è„šæœ¬é‡Œæ€ä¹ˆè°ƒç”¨ MyMath.discount è¿™ä¸ªæˆ‘è‡ªå·±å†™çš„æ–¹æ³•ï¼Ÿ</p>
<h3 data-id="heading-11">ç­”æ¡ˆï¼šæ³¨å†Œ + åå°„</h3>
<p><strong>ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œæ–¹æ³•</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·ä»£ç </span>
runner.register(<span class="hljs-string">"MyMath"</span>, MyMath.class);

<span class="hljs-comment">// QLExpress å†…éƒ¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(String name, Class&lt;?&gt; clazz)</span> {
    context.registerFunction(name, clazz);  <span class="hljs-comment">// å­˜åˆ° Map é‡Œ</span>
}
</code></pre>
<p><strong>ç¬¬äºŒæ­¥ï¼šè§£æå‡½æ•°è°ƒç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è„šæœ¬ï¼š"MyMath.discount(amount, 0.8)"</span>
<span class="hljs-comment">// Parser è¯†åˆ«åˆ°ï¼šIDENTIFIER.IDENTIFIER(...)</span>
<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseFunctionCall</span><span class="hljs-params">(String className, String methodName)</span> {
    List&lt;ASTNode&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-comment">// è§£æå‚æ•°åˆ—è¡¨</span>
    <span class="hljs-keyword">do</span> {
        args.add(parseExpression());  <span class="hljs-comment">// é€’å½’è§£ææ¯ä¸ªå‚æ•°</span>
    } <span class="hljs-keyword">while</span> (match(TokenType.COMMA));
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FunctionCallNode</span>(className, methodName, args);
}
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šåå°„è°ƒç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Interpreter.java</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">interpretFunctionCall</span><span class="hljs-params">(FunctionCallNode node, Context context)</span> {
    <span class="hljs-comment">// 1. ä»æ³¨å†Œè¡¨æ‰¾åˆ°ç±»</span>
    Class&lt;?&gt; clazz = context.getFunctionClass(node.getClassName());
    
    <span class="hljs-comment">// 2. å‡†å¤‡å‚æ•°</span>
    Object[] argValues = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[node.getArguments().size()];
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; argValues.length; i++) {
        argValues[i] = interpret(node.getArguments().get(i), context);
    }
    
    <span class="hljs-comment">// 3. åå°„è°ƒç”¨</span>
    <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getMethod(node.getMethodName(), getArgTypes(argValues));
    <span class="hljs-keyword">return</span> method.invoke(<span class="hljs-literal">null</span>, argValues);  <span class="hljs-comment">// è°ƒç”¨é™æ€æ–¹æ³•</span>
}
</code></pre>
<h3 data-id="heading-12">æ‰§è¡Œæµç¨‹å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[æ³¨å†Œ: MyMath.class] --&gt; B[å­˜å…¥ Map]
    C[è„šæœ¬: MyMath.discount] --&gt; D[Parserè¯†åˆ«å‡½æ•°è°ƒç”¨]
    D --&gt; E[æ„é€  FunctionCallNode]
    E --&gt; F[Interpreteræ‰§è¡Œ]
    F --&gt; G[ä»Mapå–å‡º MyMath.class]
    G --&gt; H[å‡†å¤‡å‚æ•°: 150, 0.8]
    H --&gt; I[åå°„: method.invoke]
    I --&gt; J[è¿”å›ç»“æœ: 120]
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆå®‰å…¨ï¼Ÿ</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">åªèƒ½è°ƒç”¨æ³¨å†Œè¿‡çš„ç±»ï¼ˆç™½åå•æœºåˆ¶ï¼‰
è„šæœ¬é‡Œå†™ System.<span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>) ä¹Ÿæ²¡ç”¨ï¼Œå› ä¸ºæ²¡æ³¨å†Œ
</code></pre>
<hr/>
<h2 data-id="heading-13">äº”ã€æ ¸å¿ƒåŸç†ä¸‰ï¼šè¿ç®—ç¬¦ä¼˜å…ˆçº§å¦‚ä½•ä¿è¯</h2>
<h3 data-id="heading-14">å…³é”®é—®é¢˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-string">"2 + 3 * 4"</span>  <span class="hljs-comment">// ç»“æœæ˜¯ 14ï¼Œè¯´æ˜å…ˆç®—ä¹˜æ³•</span>
</code></pre>
<p>Parser æ€ä¹ˆçŸ¥é“å…ˆç®—å“ªä¸ªï¼Ÿ</p>
<h3 data-id="heading-15">ç­”æ¡ˆï¼šé€’å½’ä¸‹é™ + è°ƒç”¨é“¾å±‚æ¬¡</h3>
<p><strong>è°ƒç”¨é“¾è®¾è®¡</strong>ï¼ˆä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">parseExpression()       <span class="hljs-comment">// å…¥å£</span>
    â†“
parseConditional()      <span class="hljs-comment">// if è¯­å¥ï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰</span>
    â†“
parseComparison()       <span class="hljs-comment">// æ¯”è¾ƒè¿ç®— &gt;, &lt;, ==</span>
    â†“
parseTerm()             <span class="hljs-comment">// åŠ å‡è¿ç®— +, -</span>
    â†“
parseFactor()           <span class="hljs-comment">// ä¹˜é™¤è¿ç®— *, /</span>
    â†“
parsePrimary()          <span class="hljs-comment">// åŸºæœ¬å…ƒç´ ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong></p>
<p>çœ‹ä¸ªä¾‹å­ï¼š<code>2 + 3 * 4</code></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. <span class="hljs-built_in">parseExpression</span>() è°ƒç”¨ <span class="hljs-built_in">parseTerm</span>()
<span class="hljs-number">2</span>. <span class="hljs-built_in">parseTerm</span>() å…ˆè°ƒç”¨ <span class="hljs-built_in">parseFactor</span>() è§£æå·¦è¾¹
   <span class="hljs-built_in">parseFactor</span>() è§£æ "<span class="hljs-number">2</span>"ï¼Œè¿”å› <span class="hljs-built_in">LiteralNode</span>(<span class="hljs-number">2</span>)
<span class="hljs-number">3</span>. <span class="hljs-built_in">parseTerm</span>() çœ‹åˆ° PLUSï¼Œç»§ç»­è§£æå³è¾¹
<span class="hljs-number">4</span>. å³è¾¹è°ƒç”¨ <span class="hljs-built_in">parseFactor</span>() è§£æ "<span class="hljs-number">3</span> * <span class="hljs-number">4</span>"
<span class="hljs-number">5</span>. <span class="hljs-built_in">parseFactor</span>() çœ‹åˆ° "<span class="hljs-number">3</span>"ï¼Œå†çœ‹åˆ° MULTIPLY
   å®ƒä¼šç»§ç»­è§£æï¼Œæ„é€  <span class="hljs-built_in">BinaryOpNode</span>(<span class="hljs-number">3</span> * <span class="hljs-number">4</span>)
<span class="hljs-number">6</span>. <span class="hljs-built_in">parseTerm</span>() æ‹¿åˆ°å³è¾¹çš„ç»“æœï¼š<span class="hljs-built_in">BinaryOpNode</span>(<span class="hljs-number">3</span> * <span class="hljs-number">4</span>)
<span class="hljs-number">7</span>. æœ€ç»ˆæ„é€ ï¼š<span class="hljs-built_in">BinaryOpNode</span>(<span class="hljs-number">2</span> + (<span class="hljs-number">3</span> * <span class="hljs-number">4</span>))
</code></pre>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<pre><code class="hljs">ä¼˜å…ˆçº§é«˜çš„è¿ç®—ç¬¦ï¼Œåœ¨é€’å½’è°ƒç”¨çš„æ›´æ·±å±‚
æ‰€ä»¥ä¼šå…ˆè¢«è§£æã€å…ˆè¢«è®¡ç®—
</code></pre>
<h3 data-id="heading-16">ä»£ç å±•ç¤º</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Parser.java</span>
<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseTerm</span><span class="hljs-params">()</span> {
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> parseFactor();  <span class="hljs-comment">// å…ˆè§£æé«˜ä¼˜å…ˆçº§çš„</span>
    
    <span class="hljs-keyword">while</span> (match(TokenType.PLUS, TokenType.MINUS)) {
        <span class="hljs-type">Token</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> previous();
        <span class="hljs-type">ASTNode</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> parseFactor();  <span class="hljs-comment">// é€’å½’è§£æå³è¾¹</span>
        left = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BinaryOpNode</span>(operator.getType(), left, right);
    }
    
    <span class="hljs-keyword">return</span> left;
}

<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseFactor</span><span class="hljs-params">()</span> {
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> parsePrimary();  <span class="hljs-comment">// è§£ææœ€é«˜ä¼˜å…ˆçº§çš„</span>
    
    <span class="hljs-keyword">while</span> (match(TokenType.MULTIPLY, TokenType.DIVIDE)) {
        <span class="hljs-type">Token</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> previous();
        <span class="hljs-type">ASTNode</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> parsePrimary();  <span class="hljs-comment">// é€’å½’è§£æå³è¾¹</span>
        left = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BinaryOpNode</span>(operator.getType(), left, right);
    }
    
    <span class="hljs-keyword">return</span> left;
}
</code></pre>
<h3 data-id="heading-17">è§£ææ ‘å¯¹æ¯”</h3>
<pre><code class="hljs language-markdown" lang="markdown">é”™è¯¯çš„è§£æï¼ˆå¦‚æœä¸åˆ†ä¼˜å…ˆçº§ï¼‰ï¼š
<span class="hljs-bullet">    +</span>
   / \
  2   *
<span class="hljs-code">     / \
    3   4
</span>
æ­£ç¡®çš„è§£æï¼ˆparseFactor å…ˆå¤„ç†ä¹˜æ³•ï¼‰ï¼š
<span class="hljs-bullet">    +</span>
   / \
  2   *
<span class="hljs-code">     / \
    3   4
</span></code></pre>
<hr/>
<h2 data-id="heading-18">å…­ã€é€’å½’ï¼šè´¯ç©¿å§‹ç»ˆçš„è®¾è®¡</h2>
<p>æ•´ä¸ª QLExpress çš„å®ç°ï¼Œåˆ°å¤„éƒ½æ˜¯é€’å½’ï¼š</p>
<h3 data-id="heading-19">é€’å½’ä¸€ï¼šè§£ææ—¶çš„é€’å½’ä¸‹é™</h3>
<pre><code class="hljs language-java" lang="java">ASTNode <span class="hljs-title function_">parseExpression</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (å½“å‰æ˜¯<span class="hljs-keyword">if</span>) {
        <span class="hljs-type">ASTNode</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> parseExpression();  <span class="hljs-comment">// é€’å½’è§£ææ¡ä»¶</span>
        <span class="hljs-type">ASTNode</span> <span class="hljs-variable">thenBranch</span> <span class="hljs-operator">=</span> parseExpression(); <span class="hljs-comment">// é€’å½’è§£æåˆ†æ”¯</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IfNode</span>(condition, thenBranch, <span class="hljs-literal">null</span>);
    }
    <span class="hljs-keyword">return</span> parseComparison();  <span class="hljs-comment">// ç»§ç»­é€’å½’</span>
}
</code></pre>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">æ¡ä»¶å¯ä»¥æ˜¯ä»»æ„å¤æ‚çš„è¡¨è¾¾å¼
if ((<span class="hljs-selector-tag">a</span> &gt; <span class="hljs-number">10</span> &amp;&amp; <span class="hljs-selector-tag">b</span> &lt; <span class="hljs-number">20</span>) || c == <span class="hljs-number">30</span>) ...
ä¸éœ€è¦å•ç‹¬å¤„ç†ï¼Œé€’å½’è‡ªåŠ¨æå®š
</code></pre>
<h3 data-id="heading-20">é€’å½’äºŒï¼šæ‰§è¡Œæ—¶çš„é€’å½’éå†</h3>
<pre><code class="hljs language-java" lang="java">Object <span class="hljs-title function_">interpret</span><span class="hljs-params">(ASTNode node, Context context)</span> {
    <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> IfNode) {
        <span class="hljs-type">Object</span> <span class="hljs-variable">cond</span> <span class="hljs-operator">=</span> interpret(node.getCondition(), context);  <span class="hljs-comment">// é€’å½’</span>
        <span class="hljs-keyword">if</span> ((Boolean) cond) {
            <span class="hljs-keyword">return</span> interpret(node.getThenBranch(), context);     <span class="hljs-comment">// é€’å½’</span>
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> BinaryOpNode) {
        <span class="hljs-type">Object</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> interpret(node.getLeft(), context);        <span class="hljs-comment">// é€’å½’</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> interpret(node.getRight(), context);      <span class="hljs-comment">// é€’å½’</span>
        <span class="hljs-keyword">return</span> calculate(left, op, right);
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<pre><code class="hljs">æ ‘æœ‰å¤šæ·±ï¼Œè‡ªåŠ¨é€’å½’å¤šæ·±
ä»£ç ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°
</code></pre>
<h3 data-id="heading-21">é€’å½’è°ƒç”¨æ ˆç¤ºä¾‹</h3>
<pre><code class="hljs language-scss" lang="scss">è„šæœ¬ï¼šif (amount &gt; <span class="hljs-number">100</span>) amount * <span class="hljs-number">0.8</span>

æ‰§è¡Œæ—¶çš„è°ƒç”¨æ ˆï¼š
<span class="hljs-built_in">interpret</span>(IfNode)
  â”œâ”€ <span class="hljs-built_in">interpret</span>(BinaryOpNode &gt;)
  â”‚    â”œâ”€ <span class="hljs-built_in">interpret</span>(VariableNode amount) â†’ <span class="hljs-number">150</span>
  â”‚    â””â”€ <span class="hljs-built_in">interpret</span>(LiteralNode <span class="hljs-number">100</span>) â†’ <span class="hljs-number">100</span>
  â”‚    â””â”€ è¿”å› true
  â””â”€ <span class="hljs-built_in">interpret</span>(BinaryOpNode *)
       â”œâ”€ <span class="hljs-built_in">interpret</span>(VariableNode amount) â†’ <span class="hljs-number">150</span>
       â””â”€ <span class="hljs-built_in">interpret</span>(LiteralNode <span class="hljs-number">0.8</span>) â†’ <span class="hljs-number">0.8</span>
       â””â”€ è¿”å› <span class="hljs-number">120</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">ä¸ƒã€å…³é”®ä»£ç å±•ç¤º</h2>
<h3 data-id="heading-23">è¯æ³•åˆ†æå™¨ï¼ˆLexerï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> List&lt;Token&gt; <span class="hljs-title function_">tokenize</span><span class="hljs-params">(String script)</span> {
    List&lt;Token&gt; tokens = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-type">int</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">while</span> (position &lt; script.length()) {
        <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> script.charAt(position);
        
        <span class="hljs-keyword">if</span> (Character.isWhitespace(c)) {
            position++;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Character.isDigit(c)) {
            tokens.add(readNumber(script, position));
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Character.isLetter(c)) {
            <span class="hljs-type">Token</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> readIdentifier(script, position);
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯å…³é”®å­—</span>
            <span class="hljs-keyword">if</span> (token.getText().equals(<span class="hljs-string">"if"</span>)) {
                tokens.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Token</span>(TokenType.IF, <span class="hljs-string">"if"</span>));
            } <span class="hljs-keyword">else</span> {
                tokens.add(token);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c == <span class="hljs-string">'&gt;'</span>) {
            tokens.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Token</span>(TokenType.GREATER, <span class="hljs-string">"&gt;"</span>));
            position++;
        }
        <span class="hljs-comment">// ...</span>
    }
    
    <span class="hljs-keyword">return</span> tokens;
}
</code></pre>
<h3 data-id="heading-24">è¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> ASTNode <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> parseExpression();
}

<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseExpression</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> parseConditional();
}

<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseConditional</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (peek().getType() == TokenType.IF) {
        <span class="hljs-keyword">return</span> parseIfStatement();
    }
    <span class="hljs-keyword">return</span> parseComparison();
}

<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseIfStatement</span><span class="hljs-params">()</span> {
    consumeToken(TokenType.IF);
    consumeToken(TokenType.LPAREN);
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> parseExpression();  <span class="hljs-comment">// é€’å½’</span>
    consumeToken(TokenType.RPAREN);
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">thenBranch</span> <span class="hljs-operator">=</span> parseExpression(); <span class="hljs-comment">// é€’å½’</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IfNode</span>(condition, thenBranch, <span class="hljs-literal">null</span>);
}
</code></pre>
<h3 data-id="heading-25">è§£é‡Šæ‰§è¡Œå™¨ï¼ˆInterpreterï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">interpret</span><span class="hljs-params">(ASTNode node, Context context)</span> {
    <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> IfNode) {
        <span class="hljs-keyword">return</span> interpretIf((IfNode) node, context);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> BinaryOpNode) {
        <span class="hljs-keyword">return</span> interpretBinaryOp((BinaryOpNode) node, context);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> FunctionCallNode) {
        <span class="hljs-keyword">return</span> interpretFunctionCall((FunctionCallNode) node, context);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> VariableNode) {
        <span class="hljs-keyword">return</span> context.getVariable(((VariableNode) node).getName());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> LiteralNode) {
        <span class="hljs-keyword">return</span> ((LiteralNode) node).getValue();
    }
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Unknown node type"</span>);
}

<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">interpretBinaryOp</span><span class="hljs-params">(BinaryOpNode node, Context context)</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> interpret(node.getLeft(), context);   <span class="hljs-comment">// é€’å½’</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> interpret(node.getRight(), context); <span class="hljs-comment">// é€’å½’</span>
    
    <span class="hljs-keyword">switch</span> (node.getOperator()) {
        <span class="hljs-keyword">case</span> PLUS:     <span class="hljs-keyword">return</span> (Double) left + (Double) right;
        <span class="hljs-keyword">case</span> MULTIPLY: <span class="hljs-keyword">return</span> (Double) left * (Double) right;
        <span class="hljs-keyword">case</span> GREATER:  <span class="hljs-keyword">return</span> (Double) left &gt; (Double) right;
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-26">å…«ã€ä¸‰æ¿æ–§æ€»ç»“</h2>
<p>å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼ŒQLExpress çš„æ ¸å¿ƒå°±æ˜¯ä¸‰æ¿æ–§ï¼š</p>
<h3 data-id="heading-27">ç¬¬ä¸€æ–§ï¼šè¯æ³•åˆ†æ + è¯­æ³•åˆ†æ + AST</h3>
<pre><code class="hljs">å­—ç¬¦ä¸² â†’ Tokenæµ â†’ ASTæ ‘

æŠ€æœ¯ï¼šæ‰‹å†™çŠ¶æ€æœº + é€’å½’ä¸‹é™
ç›®çš„ï¼šæŠŠè„šæœ¬å˜æˆå¯æ“ä½œçš„æ ‘å½¢ç»“æ„
</code></pre>
<h3 data-id="heading-28">ç¬¬äºŒæ–§ï¼šæ ˆå¼é€’å½’æ‰§è¡Œ</h3>
<pre><code class="hljs">éå† AST æ ‘ï¼Œé€’å½’è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹

æŠ€æœ¯ï¼šè®¿é—®è€…æ¨¡å¼ + é€’å½’éå†
ç›®çš„ï¼šç”¨ Java ä»£ç æ¨¡æ‹Ÿè„šæœ¬æ‰§è¡Œ
</code></pre>
<h3 data-id="heading-29">ç¬¬ä¸‰æ–§ï¼šåå°„è°ƒç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript">é€šè¿‡æ³¨å†Œè¡¨ + åå°„è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•

æŠ€æœ¯ï¼š<span class="hljs-title class_">Map</span> å­˜å‚¨ + <span class="hljs-title class_">Java</span> åå°„
ç›®çš„ï¼šå®‰å…¨åœ°æ‰©å±•è„šæœ¬èƒ½åŠ›
</code></pre>
<hr/>
<h2 data-id="heading-30">ä¹ã€å¯¹æ¯”çœŸå®çš„ QLExpress</h2>
<p>æ‰‹å†™ç‰ˆæœ¬å’ŒçœŸå®çš„ QLExpress æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>








































<table><thead><tr><th>ç»´åº¦</th><th>æ‰‹å†™ç‰ˆ</th><th>QLExpress</th></tr></thead><tbody><tr><td>è¯æ³•åˆ†æ</td><td>æ‰‹å†™çŠ¶æ€æœº</td><td>ANTLR è‡ªåŠ¨ç”Ÿæˆ</td></tr><tr><td>è¯­æ³•åˆ†æ</td><td>é€’å½’ä¸‹é™</td><td>ANTLR è‡ªåŠ¨ç”Ÿæˆ</td></tr><tr><td>æ‰§è¡Œæ–¹å¼</td><td>AST è§£é‡Šæ‰§è¡Œ</td><td>æŒ‡ä»¤è™šæ‹Ÿæœºï¼ˆQVMï¼‰</td></tr><tr><td>ä»£ç é‡</td><td>700 è¡Œ</td><td>20000+ è¡Œ</td></tr><tr><td>åŠŸèƒ½å®Œæ•´æ€§</td><td>åŸºç¡€åŠŸèƒ½</td><td>ä¼ä¸šçº§å®Œæ•´</td></tr><tr><td>ä¾èµ–</td><td>é›¶ä¾èµ–</td><td>antlr4-runtime</td></tr></tbody></table>
<p><strong>çœŸå® QLExpress çš„é¢å¤–ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å˜é‡èµ‹å€¼</li>
<li>å¾ªç¯è¯­å¥ï¼ˆfor/whileï¼‰</li>
<li>å‡½æ•°å®šä¹‰</li>
<li>å¼‚å¸¸å¤„ç†</li>
<li>æ€§èƒ½ä¼˜åŒ–ï¼ˆæŒ‡ä»¤ç¼“å­˜ã€å¯¹è±¡æ± ï¼‰</li>
</ul>
<p>ä½†æ ¸å¿ƒæ€æƒ³æ˜¯ä¸€æ ·çš„ï¼šä¸ç”Ÿæˆ classï¼Œç”¨ Java ä»£ç æ¨¡æ‹Ÿæ‰§è¡Œã€‚</p>
<hr/>
<h2 data-id="heading-31">åã€å®Œæ•´æµ‹è¯•</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">MiniQLExpress</span> <span class="hljs-variable">runner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniQLExpress</span>();
        runner.register(<span class="hljs-string">"MyMath"</span>, MyMath.class);
        runner.getContext().addVariable(<span class="hljs-string">"amount"</span>, <span class="hljs-number">150.0</span>);
        
        test(runner, <span class="hljs-string">"2 + 3 * 4"</span>);
        test(runner, <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>);
        test(runner, <span class="hljs-string">"MyMath.discount(100, 0.8)"</span>);
        test(runner, <span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(MiniQLExpress runner, String script)</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> runner.execute(script);
        System.out.println(<span class="hljs-string">"Result of \""</span> + script + <span class="hljs-string">"\": "</span> + result);
    }
}
</code></pre>
<p><strong>è¿è¡Œç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-type">Result</span> of <span class="hljs-string">"2 + 3 * 4"</span>: <span class="hljs-number">14.0</span>
<span class="hljs-type">Result</span> of <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>: <span class="hljs-number">120.0</span>
<span class="hljs-type">Result</span> of <span class="hljs-string">"MyMath.discount(100, 0.8)"</span>: <span class="hljs-number">80.0</span>
<span class="hljs-type">Result</span> of <span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>: <span class="hljs-number">120.0</span>
</code></pre>
<p>å…¨éƒ¨é€šè¿‡ã€‚</p>
<hr/>
<h2 data-id="heading-32">åä¸€ã€æ”¶è·</h2>
<p>èŠ±ä¸€å¤©æ—¶é—´æ‰‹å†™ 700 è¡Œä»£ç ï¼Œææ¸…æ¥šäº†å‡ ä¸ªé—®é¢˜ï¼š</p>
<p><strong>1. QLExpress çš„ if ä¸æ˜¯ JVM çš„ if</strong></p>
<pre><code class="hljs">å®ƒæ˜¯ç”¨ Java çš„ if åŒ…è£…å‡ºæ¥çš„
æ‰€ä»¥ä¸éœ€è¦ç¼–è¯‘æˆå­—èŠ‚ç 
</code></pre>
<p><strong>2. åå°„ä¸æ˜¯é­”æ³•</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">æå‰æ³¨å†Œ â†’ å­˜ <span class="hljs-title class_">Map</span>
è„šæœ¬è°ƒç”¨ â†’ ä» <span class="hljs-title class_">Map</span> å– â†’ method.<span class="hljs-property">invoke</span>
</code></pre>
<p><strong>3. é€’å½’æ˜¯çµé­‚</strong></p>
<pre><code class="hljs">è§£ææ—¶é€’å½’ â†’ å¯ä»¥å¤„ç†ä»»æ„åµŒå¥—
æ‰§è¡Œæ—¶é€’å½’ â†’ å¯ä»¥å¤„ç†ä»»æ„å¤æ‚åº¦
</code></pre>
<p><strong>4. ä¸æ˜¯æ‰€æœ‰è½®å­éƒ½éœ€è¦ ANTLR</strong></p>
<pre><code class="hljs">ç®€å•åœºæ™¯ï¼Œæ‰‹å†™ Parser è¶³å¤Ÿäº†
ä»£ç æ¸…æ™°ï¼Œå®¹æ˜“è°ƒè¯•
</code></pre>
<hr/>
<h2 data-id="heading-33">åäºŒã€ä»£ç è·å–</h2>
<p>å®Œæ•´ä»£ç å·²å¼€æºï¼ˆ700 è¡Œï¼‰ï¼š</p>
<ul>
<li>Lexer.javaï¼ˆè¯æ³•åˆ†æï¼‰</li>
<li>Parser.javaï¼ˆè¯­æ³•åˆ†æï¼‰</li>
<li>Interpreter.javaï¼ˆè§£é‡Šæ‰§è¡Œï¼‰</li>
<li>AST èŠ‚ç‚¹å®šä¹‰</li>
<li>å®Œæ•´æµ‹è¯•ç”¨ä¾‹</li>
</ul>
<p>å¯ä»¥ç›´æ¥è¿è¡Œï¼Œé›¶ä¾èµ–ã€‚</p>
<hr/>
<h2 data-id="heading-34">å†™åœ¨æœ€å</h2>
<p>æ‹†è½®å­çš„ç›®çš„ä¸æ˜¯é‡å¤é€ è½®å­ï¼Œè€Œæ˜¯ç†è§£åŸç†ã€‚</p>
<p>ä¸‹æ¬¡ç”¨ QLExpress çš„æ—¶å€™ï¼Œå¿ƒé‡Œå°±æœ‰åº•äº†ï¼š</p>
<ul>
<li>çŸ¥é“å®ƒä¸ºä»€ä¹ˆå¿«ï¼ˆä¸ç¼–è¯‘ï¼‰</li>
<li>çŸ¥é“å®ƒä¸ºä»€ä¹ˆå®‰å…¨ï¼ˆç™½åå•ï¼‰</li>
<li>çŸ¥é“å®ƒçš„å±€é™ï¼ˆåŠŸèƒ½ç›¸å¯¹ç®€å•ï¼‰</li>
</ul>
<p>å‘¨æœ«æ„‰å¿«ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Paimonæºç è§£è¯» -- FULL_COMPACTION_DELTA_COMMITS]]></title>    <link>https://juejin.cn/post/7582872365522173990</link>    <guid>https://juejin.cn/post/7582872365522173990</guid>    <pubDate>2025-12-13T08:01:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582872365522173990" data-draft-id="7582809606067830810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Paimonæºç è§£è¯» -- FULL_COMPACTION_DELTA_COMMITS"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Flink"/> <meta itemprop="datePublished" content="2025-12-13T08:01:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="expect7g"/> <meta itemprop="url" content="https://juejin.cn/user/3514471387235735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Paimonæºç è§£è¯» -- FULL_COMPACTION_DELTA_COMMITS
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3514471387235735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    expect7g
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T08:01:06.000Z" title="Sat Dec 13 2025 08:01:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬æ–‡é‡ç‚¹ä»‹ç»Paimonå‹ç¼©å‚æ•°<code>full-compaction.delta-commits</code>çš„æ•´ä½“è°ƒç”¨æµç¨‹ï¼Œæ¶‰åŠåˆ°CompactTaskçš„è¯¦æƒ…ï¼š<a href="https://juejin.cn/post/7577609608828239898" target="_blank" title="https://juejin.cn/post/7577609608828239898">Paimonæºç è§£è¯» -- Compaction-1.MergeTreeCompactTask</a></p>
<h2 data-id="heading-1">ä¸€.<code>full-compaction.delta-commits</code>Â å‚æ•°æºç åˆ†æ</h2>
<h3 data-id="heading-2">1ï¸.å‚æ•°å®šä¹‰ï¼ˆCoreOptionsï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ConfigOption&lt;Integer&gt; FULL_COMPACTION_DELTA_COMMITS =
    key(<span class="hljs-string">"full-compaction.delta-commits"</span>)
        .intType()
        .noDefaultValue()  <span class="hljs-comment">// æ²¡æœ‰é»˜è®¤å€¼</span>
        .withDescription(
            <span class="hljs-string">"Full compaction will be constantly triggered after delta commits."</span>);
</code></pre>
<p><strong>å…³é”®ä¿¡æ¯ï¼š</strong></p>
<ul>
<li><strong>å‚æ•°ç±»å‹</strong>ï¼š<code>Integer</code></li>
<li><strong>é»˜è®¤å€¼</strong>ï¼šæ— ï¼ˆ<code>noDefaultValue()</code>ï¼‰</li>
<li><strong>å«ä¹‰</strong>ï¼šç»è¿‡æŒ‡å®šæ•°é‡çš„ delta æäº¤åï¼Œè§¦å‘ä¸€æ¬¡å…¨é‡å‹ç¼©</li>
</ul>
<h3 data-id="heading-3">2.å…¥å£<code>FlinkSink.createWriteProvider()</code></h3>
<p>CASE-1: write-only = trueï¼Œåç»­èµ°ä¸“ç”¨å‹ç¼©ä»»åŠ¡<br/>
CASE-2: write-only = falseï¼Œèµ°è‡ªåŠ¨å‹ç¼©</p>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨ <code>full-compaction.delta-commits</code> å‚æ•°ï¼Œå…¶æ¬¡ä½¿ç”¨ <code>compaction.optimization-interval</code> å‚æ•°</strong></li>
</ol>
<blockquote>
<p>deltaCommitså‚æ•°å–å€¼</p>
<ul>
<li>ç­‰äºfull-compaction.delta-commits</li>
<li>ç­‰äº(compaction.optimization-interval / cpé—´éš”)å–æ•´</li>
</ul>
</blockquote>
<ol start="2">
<li>å…ˆåˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>changelog-producer = full-compaction</code> æˆ– é…ç½®äº†ä»»æ„ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œèµ°<code>GlobalFullCompactionSinkWrite</code></li>
<li>å†åˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>force-lookup = true ä¸” lookup-wait = false</code>æ‰èµ°å¼‚æ­¥<code>AsyncLookupSinkWrite</code></li>
</ol>
<p>æœ€åå…œåº•<code>StoreSinkWriteImpl</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> StoreSinkWrite.Provider <span class="hljs-title function_">createWriteProvider</span><span class="hljs-params">(
        CheckpointConfig checkpointConfig, <span class="hljs-type">boolean</span> isStreaming, <span class="hljs-type">boolean</span> hasSinkMaterializer)</span> {
    <span class="hljs-type">SerializableRunnable</span> <span class="hljs-variable">assertNoSinkMaterializer</span> <span class="hljs-operator">=</span>
            () -&gt;
                    Preconditions.checkArgument(
                            !hasSinkMaterializer,
                            String.format(
                                    <span class="hljs-string">"Sink materializer must not be used with Paimon sink. "</span>
                                            + <span class="hljs-string">"Please set '%s' to '%s' in Flink's config."</span>,
                                    ExecutionConfigOptions.TABLE_EXEC_SINK_UPSERT_MATERIALIZE
                                            .key(),
                                    ExecutionConfigOptions.UpsertMaterialize.NONE.name()));

    <span class="hljs-type">Options</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> table.coreOptions().toConfiguration();
    <span class="hljs-type">ChangelogProducer</span> <span class="hljs-variable">changelogProducer</span> <span class="hljs-operator">=</span> table.coreOptions().changelogProducer();
    <span class="hljs-type">boolean</span> waitCompaction;
    <span class="hljs-type">CoreOptions</span> <span class="hljs-variable">coreOptions</span> <span class="hljs-operator">=</span> table.coreOptions();
    <span class="hljs-comment">// CASE-1: write-only = trueï¼Œåç»­èµ°ä¸“ç”¨å‹ç¼©ä»»åŠ¡</span>
    <span class="hljs-keyword">if</span> (coreOptions.writeOnly()) {
        waitCompaction = <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// CASE-2: write-only = falseï¼Œèµ°è‡ªåŠ¨å‹ç¼©</span>
    <span class="hljs-keyword">else</span> {
        waitCompaction = coreOptions.prepareCommitWaitCompaction();
        <span class="hljs-type">int</span> <span class="hljs-variable">deltaCommits</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;
        <span class="hljs-comment">// ä¼˜å…ˆä½¿ç”¨ full-compaction.delta-commits å‚æ•°</span>
        <span class="hljs-keyword">if</span> (options.contains(FULL_COMPACTION_DELTA_COMMITS)) {
            deltaCommits = options.get(FULL_COMPACTION_DELTA_COMMITS);
        }
        <span class="hljs-comment">// å…¶æ¬¡ä½¿ç”¨ compaction.optimization-interval å‚æ•°</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.contains(CHANGELOG_PRODUCER_FULL_COMPACTION_TRIGGER_INTERVAL)) {
            <span class="hljs-type">long</span> <span class="hljs-variable">fullCompactionThresholdMs</span> <span class="hljs-operator">=</span>
                    options.get(CHANGELOG_PRODUCER_FULL_COMPACTION_TRIGGER_INTERVAL).toMillis();
            <span class="hljs-comment">// æ ¹æ® checkpoint é—´éš”å°†æ—¶é—´è½¬æ¢ä¸ºæäº¤æ¬¡æ•° = compaction.optimization-interval / cpé—´éš”</span>
            deltaCommits =
                    (<span class="hljs-type">int</span>)
                            (fullCompactionThresholdMs
                                    / checkpointConfig.getCheckpointInterval());
        }
        <span class="hljs-comment">// (1) è‹¥é…ç½®äº†changelog-producer = full-compaction æˆ– é…ç½®äº†ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œèµ°GlobalFullCompactionSinkWrite</span>
        <span class="hljs-keyword">if</span> (changelogProducer == ChangelogProducer.FULL_COMPACTION || deltaCommits &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-type">int</span> <span class="hljs-variable">finalDeltaCommits</span> <span class="hljs-operator">=</span> Math.max(deltaCommits, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span> (table, commitUser, state, ioManager, memoryPool, metricGroup) -&gt; {
                assertNoSinkMaterializer.run();
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GlobalFullCompactionSinkWrite</span>(
                        table,
                        commitUser,
                        state,
                        ioManager,
                        ignorePreviousFiles,
                        waitCompaction,
                        finalDeltaCommits, <span class="hljs-comment">// ä¼ é€’deltaCommitså‚æ•°</span>
                        isStreaming,
                        memoryPool,
                        metricGroup);
            };
        }
    }

    <span class="hljs-comment">// (2) è‹¥é…ç½®äº†force-lookup = true ä¸” lookup-wait = falseæ‰èµ°å¼‚æ­¥AsyncLookupSinkWrite</span>
    <span class="hljs-keyword">if</span> (coreOptions.needLookup() &amp;&amp; !coreOptions.prepareCommitWaitCompaction()) {
        <span class="hljs-keyword">return</span> (table, commitUser, state, ioManager, memoryPool, metricGroup) -&gt; {
            assertNoSinkMaterializer.run();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncLookupSinkWrite</span>(
                    table,
                    commitUser,
                    state,
                    ioManager,
                    ignorePreviousFiles,
                    waitCompaction,
                    isStreaming,
                    memoryPool,
                    metricGroup);
        };
    }
    <span class="hljs-comment">// CASE-1æœ€åèµ°è¿™</span>
    <span class="hljs-keyword">return</span> (table, commitUser, state, ioManager, memoryPool, metricGroup) -&gt; {
        assertNoSinkMaterializer.run();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreSinkWriteImpl</span>(
                table,
                commitUser,
                state,
                ioManager,
                ignorePreviousFiles,
                waitCompaction,
                isStreaming,
                memoryPool,
                metricGroup);
    };
}
</code></pre>
<h3 data-id="heading-4">3.<code>GlobalFullCompactionSinkWrite</code>æäº¤å…¨é‡å‹ç¼©ä»»åŠ¡</h3>
<p>è¯¥ç±»çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbe14ae6414048e8bc9fc7f162c940ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZXhwZWN0N2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766217666&amp;x-signature=r2p9RKaFKZIQVpb33rKUWB%2F8FZA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">(1) <code>prepareCommit()</code> -- æ¯æ¬¡cpéƒ½æ£€æŸ¥æ˜¯å¦éœ€è¦æäº¤å…¨é‡å‹ç¼©ä»»åŠ¡</h4>
<p>æ­¥éª¤å¦‚ä¸‹</p>
<ol>
<li>æ£€æŸ¥ä¹‹å‰æäº¤çš„å…¨é‡å‹ç¼©æ˜¯å¦æˆåŠŸ</li>
<li>æ”¶é›†å½“å‰cpé˜¶æ®µå‰æ‰€æœ‰å·²ç»å†™å…¥çš„buckets -- èµ‹å€¼ç»™writtenBuckets</li>
<li>åˆ¤æ–­æ˜¯å¦åº”è¯¥è§¦å‘å…¨é‡å‹ç¼©</li>
</ol>
<blockquote>
<p><strong>åˆ¤æ–­ä¾æ®</strong>: writtenBuckets ä¸ä¸ºç©ºï¼Œä¸”å½“å‰cpid % deltaCommits==0 æ—¶æäº¤è§¦å‘ä¸€æ¬¡å…¨é‡å‹ç¼©ï¼Œä¾‹å¦‚ï¼šdeltaCommits=5ï¼Œåˆ™åœ¨ checkpointId=5,10,15,20... æ—¶è§¦å‘</p>
</blockquote>
<ol start="4">
<li>éœ€è¦è§¦å‘å…¨é‡å‹ç¼©ï¼Œè°ƒ<code>submitFullCompaction()</code>å»æäº¤å…¨é‡å‹ç¼©ä»»åŠ¡</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> List&lt;Committable&gt; <span class="hljs-title function_">prepareCommit</span><span class="hljs-params">(<span class="hljs-type">boolean</span> waitCompaction, <span class="hljs-type">long</span> checkpointId)</span>
        <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// 1.æ£€æŸ¥ä¹‹å‰æäº¤çš„å…¨é‡å‹ç¼©æ˜¯å¦æˆåŠŸ</span>
    checkuccessfulFullCompaction();

    <span class="hljs-comment">// 2.æ”¶é›†å½“å‰cpé˜¶æ®µå†™å…¥çš„buckets</span>
    <span class="hljs-keyword">if</span> (!currentWrittenBuckets.isEmpty()) {
        writtenBuckets
                .computeIfAbsent(checkpointId, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;())
                .addAll(currentWrittenBuckets);
        currentWrittenBuckets.clear();
    }

    <span class="hljs-keyword">if</span> (LOG.isDebugEnabled()) {
        <span class="hljs-keyword">for</span> (Map.Entry&lt;Long, Set&lt;Tuple2&lt;BinaryRow, Integer&gt;&gt;&gt; checkpointIdAndBuckets :
                writtenBuckets.entrySet()) {
            LOG.debug(
                    <span class="hljs-string">"Written buckets for checkpoint #{} are:"</span>, checkpointIdAndBuckets.getKey());
            <span class="hljs-keyword">for</span> (Tuple2&lt;BinaryRow, Integer&gt; bucket : checkpointIdAndBuckets.getValue()) {
                LOG.debug(<span class="hljs-string">"  * partition {}, bucket {}"</span>, bucket.f0, bucket.f1);
            }
        }
    }
    <span class="hljs-comment">// 3.åˆ¤æ–­æ˜¯å¦åº”è¯¥è§¦å‘å…¨é‡å‹ç¼©</span>
    <span class="hljs-comment">// åˆ¤æ–­ä¾æ®: å½“å‰writtenBucketsä¸ä¸ºnull ä¸” (checkpointId % deltaCommits == 0 || checkpointId == Long.MAX_VALUE)</span>
    <span class="hljs-comment">// isFullCompactedIdentifier()ä½œç”¨: æ¯éš” deltaCommits æ¬¡æäº¤è§¦å‘ä¸€æ¬¡å…¨é‡å‹ç¼©</span>
    <span class="hljs-comment">// ä¾‹å¦‚ï¼šdeltaCommits=5ï¼Œåˆ™åœ¨ checkpointId=5,10,15,20... æ—¶è§¦å‘</span>
    <span class="hljs-keyword">if</span> (!writtenBuckets.isEmpty() &amp;&amp; isFullCompactedIdentifier(checkpointId, deltaCommits)) {
        waitCompaction = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-comment">// 4.è°ƒ`submitFullCompaction()`å»æäº¤å…¨é‡å‹ç¼©ä»»åŠ¡</span>
    <span class="hljs-keyword">if</span> (waitCompaction) {
        <span class="hljs-keyword">if</span> (LOG.isDebugEnabled()) {
            LOG.debug(<span class="hljs-string">"Submit full compaction for checkpoint #{}"</span>, checkpointId);
        }
        submitFullCompaction(checkpointId);
        commitIdentifiersToCheck.add(checkpointId);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.prepareCommit(waitCompaction, checkpointId);
}
</code></pre>
<h4 data-id="heading-6">(2) <code>submitFullCompaction()</code></h4>
<p>å®ƒå…¶å®è¿˜æ˜¯è°ƒçˆ¶ç±»<code>StoreSinkWriteImplçš„å±æ€§TableWriteImpl</code>å¯¹æ¯ä¸ªbucketæ¡¶æ‰§è¡Œå…¨é‡å‹ç¼©æ“ä½œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submitFullCompaction</span><span class="hljs-params">(<span class="hljs-type">long</span> currentCheckpointId)</span> {
    <span class="hljs-keyword">if</span> (LOG.isDebugEnabled()) {
        LOG.debug(<span class="hljs-string">"Submit full compaction for checkpoint #{}"</span>, currentCheckpointId);
    }
    <span class="hljs-comment">// compactedBucketså­˜å‚¨å½“æ¬¡å‹ç¼©ä»»åŠ¡è¦å‹ç¼©çš„bucketsæ˜¯å“ªäº›</span>
    Set&lt;Tuple2&lt;BinaryRow, Integer&gt;&gt; compactedBuckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
    <span class="hljs-comment">// éå†æ‰€æœ‰å†å²å†™å…¥çš„ buckets</span>
    writtenBuckets.forEach(
            (checkpointId, buckets) -&gt; {
                <span class="hljs-keyword">for</span> (Tuple2&lt;BinaryRow, Integer&gt; bucket : buckets) {
                    <span class="hljs-keyword">if</span> (compactedBuckets.contains(bucket)) {
                        <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// é¿å…é‡å¤å‹ç¼©</span>
                    }
                    compactedBuckets.add(bucket);
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// è°ƒçˆ¶ç±»StoreSinkWriteImplçš„å±æ€§TableWriteImplå¯¹æ¯ä¸ªbucketæ¡¶æ‰§è¡Œå…¨é‡å‹ç¼©æ“ä½œ</span>
                        write.compact(bucket.f0, bucket.f1, <span class="hljs-literal">true</span>);<span class="hljs-comment">// trueè¡¨ç¤ºæ‰§è¡ŒfullCompaction</span>
                    } <span class="hljs-keyword">catch</span> (Exception e) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                    }
                }
            });
}
</code></pre>
<h3 data-id="heading-7">4.<code>TableWriteImpl.compact()</code></h3>
<p>ä½œç”¨ï¼šè°ƒ<code>FileStoreWriteçš„å®ç°ç±»çš„compact()</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket, <span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// è¿™é‡Œçš„writeæ˜¯FileStoreWriteçš„å®ç°ç±»ï¼Œå¦‚KeyValueFileStoreWrite</span>
    write.compact(partition, bucket, fullCompaction); 
}
</code></pre>
<h3 data-id="heading-8">5.<code>FileStoreWriteå®ç°ç±»çš„compact()</code></h3>
<p>è¿™æ˜¯ä¸ªæ¥å£ï¼Œå…¶å®ç°ç±»å¦‚ä¸‹
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1e1efd28aa4629b9a4571c2b5bc969~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZXhwZWN0N2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766217666&amp;x-signature=duDDhzxe%2Fr2y2xD%2Brp%2BE6ebgy9w%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸‹é¢çœ‹<code>AbstractFileStoreWriteå®ç°çš„comapct()</code>ï¼Œæ¶‰åŠKeyValueFileStoreWriteè¯¦æƒ…è¯·çœ‹<a href="https://juejin.cn/editor/drafts/7582872365522141222" target="_blank" title="https://juejin.cn/editor/drafts/7582872365522141222">Paimonæºç è§£è¯» -- KeyValueFileStoreWrite</a></p>
<p>æ­¥éª¤å¦‚ä¸‹:</p>
<ol>
<li>å…ˆè°ƒ<code>getWriterWrapper()</code>è·å–å¯¹åº”<code>partition-bucket</code>çš„<code>WriterContainer(å…¶å®å°±æ˜¯RecordWriteråŒ…è£…èµ·æ¥)</code></li>
<li>ç”¨å…¶çš„<code>RecordWriterå®ç°ç±»å¦‚MergeTreeWriterçš„compact()</code>è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¼ å…¥<code>fullCompaction</code>è¡¨ç¤ºæ˜¯å¦éœ€è¦å…¨é‡å‹ç¼©</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket, <span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 1.å…ˆè°ƒgetWriterWrapper()è·å–å¯¹äºpartition-bucketçš„WriterContainer</span>
    <span class="hljs-comment">// 2.ç”¨å…¶ä¸­çš„MergeTreeWriterå®ç°ç±»çš„compactæ–¹æ³•è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¼ å…¥fullCompactionæ˜¯å¦éœ€è¦å…¨é‡å‹ç¼©</span>
    getWriterWrapper(partition, bucket).writer.compact(fullCompaction);
}

<span class="hljs-comment">// è°ƒç”¨çš„getWriterWrapper()</span>
<span class="hljs-keyword">protected</span> WriterContainer&lt;T&gt; <span class="hljs-title function_">getWriterWrapper</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket)</span> {
    <span class="hljs-comment">// 1.è·å–å½“å‰å¯¹åº”partitionçš„buckets</span>
    Map&lt;Integer, WriterContainer&lt;T&gt;&gt; buckets = writers.get(partition);
    <span class="hljs-keyword">if</span> (buckets == <span class="hljs-literal">null</span>) {
        buckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        writers.put(partition.copy(), buckets);
    }
    <span class="hljs-comment">// 2.ä¸ºæ¯ä¸ªbucketåˆ›å»ºWriterContainerå¯¹è±¡(å…¶å®å°±æ˜¯RecordWriteråŒ…è£…èµ·æ¥)</span>
    <span class="hljs-keyword">return</span> buckets.computeIfAbsent(
            bucket, k -&gt; createWriterContainer(partition.copy(), bucket, ignorePreviousFiles));
}
</code></pre>
<h3 data-id="heading-9">6.<code>RecordWriterå®ç°ç±»çš„compact()</code></h3>
<p>è¿™æ˜¯ä¸ªæ¥å£ï¼Œå…¶å®ç°ç±»å¦‚ä¸‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e964e03ecf74e2ebf65cbe492a5ec82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZXhwZWN0N2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766217666&amp;x-signature=gKMqooK9rSBVR9lJ8Bm%2BExHnLAA%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸‹é¢ä»¥<code>MergeTreeWriter</code>ä¸ºä¾‹</p>
<h4 data-id="heading-10">(1) <code>compact()</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(<span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// è°ƒflushWriteBuffer(true, fullCompaction)</span>
    flushWriteBuffer(<span class="hljs-literal">true</span>, fullCompaction);
}
</code></pre>
<h4 data-id="heading-11">(2) <code>flushWriteBuffer()</code> -- æ ¸å¿ƒæµç¨‹</h4>
<p>è¿™æ˜¯è§¦å‘å‹ç¼©çš„æ ¸å¿ƒæµç¨‹ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹</p>
<ol>
<li>æ£€æŸ¥æ˜¯å¦éœ€è¦ç­‰å¾…æœ€è¿‘çš„å‹ç¼©</li>
</ol>
<blockquote>
<ul>
<li>å¦‚æœé…ç½®çš„æ˜¯write-only=trueï¼Œåˆ™ä¸éœ€è¦ç­‰å¾…ï¼›</li>
<li>å…¶ä»–æƒ…å†µï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­ï¼Œå½“å‰levelsçš„Sorted Runæ–‡ä»¶æ•° &gt; num-sorted-run.stop-triggeræ¯”è¾ƒï¼Œåˆ™éœ€è¦ç­‰å¾…å‹ç¼©ï¼›å¦åˆ™ï¼Œä¸éœ€è¦</li>
</ul>
</blockquote>
<ol start="2">
<li>ç”¨<code>KeyValueFileWriterFactory</code>å»åˆ›å»ºçš„Writer(changelogã€Merge)</li>
<li>å°†<code>writeBuffer</code>ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œç”¨åˆ›å»ºçš„writerå»å†™å…¥åˆ°L0å±‚</li>
<li>è°ƒ<code>writer.result()</code>æ”¶é›†å†™å…¥åçš„<code>DataFileMetaæ–‡ä»¶æ•°æ®</code>å¹¶å°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° <code>CompactManagerå®ç°ç±»</code>ï¼Œä»¥ä¾¿åç»­å‹ç¼©æ‰§è¡Œ</li>
<li>è°ƒ<code>trySyncLatestCompaction(waitForLatestCompaction)</code>ç­‰å¾…ä¹‹å‰çš„å‹ç¼©ä»»åŠ¡å®Œæˆ</li>
<li>è°ƒ<code>CompactManagerå®ç°ç±»çš„triggerCompaction()</code>å»è§¦å‘æ–°å‹ç¼©ï¼Œæºå¸¦æ˜¯å¦å…¨é‡å‹ç¼©å‚æ•°ï¼Œè¯¦æƒ…è¯·çœ‹<a href="https://juejin.cn/editor/drafts/7582814236584181798" target="_blank" title="https://juejin.cn/editor/drafts/7582814236584181798">Paimonæºç è§£è¯» -- CompactManager</a></li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å‹ç¼©çš„æ ¸å¿ƒè§¦å‘ä»£ç ,compact()ä¸­è°ƒç”¨è¯¥æ–¹æ³•
 * <span class="hljs-doctag">@param</span> waitForLatestCompaction: æ˜¯å¦ç­‰å¾…æœ€è¿‘çš„å‹ç¼©å®Œæˆ
 * <span class="hljs-doctag">@param</span> forcedFullCompaction: æ˜¯å¦å…¨é‡å‹ç¼©
 * <span class="hljs-doctag">@throws</span> Exception
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">flushWriteBuffer</span><span class="hljs-params">(<span class="hljs-type">boolean</span> waitForLatestCompaction, <span class="hljs-type">boolean</span> forcedFullCompaction)</span>
        <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-keyword">if</span> (writeBuffer.size() &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 1.æ£€æŸ¥æ˜¯å¦éœ€è¦ç­‰å¾…æœ€è¿‘çš„å‹ç¼©</span>
        <span class="hljs-comment">// å¦‚æœé…ç½®çš„æ˜¯write-only=trueï¼Œåˆ™ä¸éœ€è¦ç­‰å¾…ï¼›</span>
        <span class="hljs-comment">// å…¶ä»–æƒ…å†µï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­ï¼Œå½“å‰levelsçš„Sorted Runæ–‡ä»¶æ•° &gt; num-sorted-run.stop-triggeræ¯”è¾ƒï¼Œåˆ™éœ€è¦ç­‰å¾…å‹ç¼©ï¼›å¦åˆ™ï¼Œä¸éœ€è¦</span>
        <span class="hljs-keyword">if</span> (compactManager.shouldWaitForLatestCompaction()) {
            waitForLatestCompaction = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-comment">// 2.ç”¨KeyValueFileWriterFactoryå»åˆ›å»ºçš„Writer</span>
        <span class="hljs-comment">// changelog-producer = input ä¸” å¹¶ä¸æ˜¯åªå†™å…¥+Iï¼Œåˆ™éœ€è¦changelogWriterå»ç”Ÿæˆchangelog</span>
        <span class="hljs-keyword">final</span> RollingFileWriter&lt;KeyValue, DataFileMeta&gt; changelogWriter =
                (changelogProducer == ChangelogProducer.INPUT &amp;&amp; !isInsertOnly)
                        ? writerFactory.createRollingChangelogFileWriter(<span class="hljs-number">0</span>)
                        : <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// åˆ›å»ºdataWriterï¼Œä»¥ä¾¿å†™å…¥æ•°æ®</span>
        <span class="hljs-keyword">final</span> RollingFileWriter&lt;KeyValue, DataFileMeta&gt; dataWriter =
                writerFactory.createRollingMergeTreeFileWriter(<span class="hljs-number">0</span>, FileSource.APPEND);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3.å°†writeBufferç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œç”¨writerå»å†™å…¥åˆ°L0å±‚</span>
            writeBuffer.forEach(
                    keyComparator,
                    mergeFunction,
                    changelogWriter == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : changelogWriter::write,
                    dataWriter::write);
        } <span class="hljs-keyword">finally</span> {
            writeBuffer.clear();
            <span class="hljs-keyword">if</span> (changelogWriter != <span class="hljs-literal">null</span>) {
                changelogWriter.close();
            }
            dataWriter.close();
        }
        <span class="hljs-comment">// 4.æ”¶é›†å†™å…¥åçš„DataFileMetaæ–‡ä»¶æ•°æ®</span>
        List&lt;DataFileMeta&gt; dataMetas = dataWriter.result();
        <span class="hljs-keyword">if</span> (changelogWriter != <span class="hljs-literal">null</span>) {
            newFilesChangelog.addAll(changelogWriter.result());
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (changelogProducer == ChangelogProducer.INPUT &amp;&amp; isInsertOnly) {
            List&lt;DataFileMeta&gt; changelogMetas = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (DataFileMeta dataMeta : dataMetas) {
                <span class="hljs-type">String</span> <span class="hljs-variable">newFileName</span> <span class="hljs-operator">=</span> writerFactory.newChangelogFileName(<span class="hljs-number">0</span>);
                <span class="hljs-type">DataFileMeta</span> <span class="hljs-variable">changelogMeta</span> <span class="hljs-operator">=</span> dataMeta.rename(newFileName);
                writerFactory.copyFile(dataMeta, changelogMeta);
                changelogMetas.add(changelogMeta);
            }
            newFilesChangelog.addAll(changelogMetas);
        }
        <span class="hljs-comment">// å°†æ–°æ–‡ä»¶æ·»åŠ åˆ° compactManager</span>
        <span class="hljs-keyword">for</span> (DataFileMeta dataMeta : dataMetas) {
            newFiles.add(dataMeta);
            compactManager.addNewFile(dataMeta);
        }
    }
    <span class="hljs-comment">// 5.ç­‰å¾…ä¹‹å‰çš„å‹ç¼©ä»»åŠ¡å®Œæˆ</span>
    trySyncLatestCompaction(waitForLatestCompaction);
    <span class="hljs-comment">// 6.è°ƒCompactManagerå®ç°ç±»çš„triggerCompaction()å»è§¦å‘æ–°å‹ç¼©ï¼Œæºå¸¦æ˜¯å¦å…¨é‡å‹ç¼©å‚æ•°</span>
    compactManager.triggerCompaction(forcedFullCompaction);
}
</code></pre>
<h2 data-id="heading-12">äºŒ.æ€»ç»“</h2>
<h3 data-id="heading-13">(1) write-only = true</h3>
<p>ç”¨<code>NoopCompactManager()</code>ï¼Œä¸æ‰§è¡Œä»»ä½•å‹ç¼©æ“ä½œï¼Œè€Œæ˜¯ç”±åç»­ä¸“ç”¨å‹ç¼©ä»»åŠ¡å»æ‰§è¡Œç›¸åº”çš„å‹ç¼©æ“ä½œ</p>
<h3 data-id="heading-14">(2) write-only = false</h3>
<p>write-only = falseï¼Œèµ°è‡ªåŠ¨å‹ç¼©ï¼Œç”¨<code>MergeTreeCompactManager</code></p>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨ <code>full-compaction.delta-commits</code> å‚æ•°ï¼Œå…¶æ¬¡ä½¿ç”¨ <code>compaction.optimization-interval</code> å‚æ•°</strong></li>
</ol>
<blockquote>
<p>deltaCommitså‚æ•°å–å€¼</p>
<ul>
<li>ç­‰äºfull-compaction.delta-commits</li>
<li>ç­‰äº(compaction.optimization-interval / cpé—´éš”)å–æ•´</li>
</ul>
</blockquote>
<ol start="2">
<li>å…ˆåˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>changelog-producer = full-compaction</code> æˆ– é…ç½®äº†ä»»æ„ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œèµ°<code>GlobalFullCompactionSinkWrite</code></li>
<li>åœ¨åˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>force-lookup = true ä¸” lookup-wait = false</code>æ‰èµ°å¼‚æ­¥<code>AsyncLookupSinkWrite</code></li>
</ol>
<p>æœ€åå…œåº•<code>StoreSinkWriteImpl</code></p>
<p>ä»¥<code>GlobalFullCompactionSinkWrite</code>ä¸ºä¾‹</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant GFC as GlobalFullCompactionSinkWrite
    participant TW as TableWriteImpl
    participant AFW as AbstractFileStoreWrite
    participant MTW as MergeTreeWriter
    participant CM as MergeTreeCompactManager
    participant Executor as CompactExecutor

    GFC-&gt;&gt;TW: compact(partition, bucket, true)
    TW-&gt;&gt;AFW: write.compact(partition, bucket, true)
    AFW-&gt;&gt;AFW: getWriterWrapper(partition, bucket)
    AFW-&gt;&gt;MTW: writer.compact(true)
    
    MTW-&gt;&gt;MTW: flushWriteBuffer(true, true)
    
    Note over MTW: 1. åˆ·å†™WriteBufferåˆ°æ–‡ä»¶
    MTW-&gt;&gt;MTW: writeBuffer.forEach() -&gt; å†™å…¥Level 0æ–‡ä»¶
    MTW-&gt;&gt;CM: addNewFile(dataMeta)
    
    Note over MTW: 2. ç­‰å¾…ä¹‹å‰çš„å‹ç¼©å®Œæˆ
    MTW-&gt;&gt;CM: trySyncLatestCompaction(true)
    
    Note over MTW: 3. è§¦å‘å…¨é‡å‹ç¼©
    MTW-&gt;&gt;CM: triggerCompaction(true)
    
    CM-&gt;&gt;CM: pickFullCompaction() - é€‰æ‹©æ‰€æœ‰æ–‡ä»¶
    CM-&gt;&gt;Executor: submit(MergeTreeCompactTask)
    Executor--&gt;&gt;CM: taskFuture
    
    Note over Executor: å¼‚æ­¥æ‰§è¡Œå‹ç¼©ä»»åŠ¡&lt;br/&gt;è¯»å–æ‰€æœ‰æ–‡ä»¶ -&gt; Merge -&gt; å†™å…¥æ–°æ–‡ä»¶
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æ React å²ä¸Šæœ€ä¸¥é‡çš„ RCE æ¼æ´ CVE-2025-55182]]></title>    <link>https://juejin.cn/post/7582814236583362598</link>    <guid>https://juejin.cn/post/7582814236583362598</guid>    <pubDate>2025-12-12T16:23:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582814236583362598" data-draft-id="7582809606067306522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æ React å²ä¸Šæœ€ä¸¥é‡çš„ RCE æ¼æ´ CVE-2025-55182"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,å®‰å…¨"/> <meta itemprop="datePublished" content="2025-12-12T16:23:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Cr4zy_Uru5"/> <meta itemprop="url" content="https://juejin.cn/user/3438928100072813"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æ React å²ä¸Šæœ€ä¸¥é‡çš„ RCE æ¼æ´ CVE-2025-55182
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3438928100072813/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Cr4zy_Uru5
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T16:23:05.000Z" title="Fri Dec 12 2025 16:23:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 å¹´ 12 æœˆ 3 æ—¥ï¼ŒReact å®˜æ–¹è”åˆ Vercel å‘å¸ƒç´§æ€¥å®‰å…¨å…¬å‘Šï¼ŒæŠ«éœ² React Server Componentsï¼ˆRSCï¼‰å­˜åœ¨è‡´å‘½è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2025-55182ï¼‰ï¼ŒCVSS è¯„åˆ†é«˜è¾¾ <strong>10.0</strong>ï¼ˆæœ€é«˜é£é™©ç­‰çº§ï¼‰ã€‚è¯¥æ¼æ´å¯é€šè¿‡æ„é€ æ¶æ„è¡¨å•è¯·æ±‚ï¼Œåœ¨æœªæˆæƒæƒ…å†µä¸‹æ‰§è¡ŒæœåŠ¡å™¨ä»»æ„ä»£ç ï¼Œå½±å“æ•°ç™¾ä¸‡åŸºäº React RSC å’Œ Next.js çš„åº”ç”¨ã€‚</p>
<p>è¿™ä¸ªæ¼æ´æ³¢åŠæ‰€æœ‰ä½¿ç”¨äº†å—å½±å“ç‰ˆæœ¬ React Server Components çš„åº”ç”¨ã€‚RSC ä½œä¸º React 18 çš„æ˜æ˜Ÿç‰¹æ€§ï¼Œä»¥å…¶ç‹¬ç‰¹çš„â€œæœåŠ¡å™¨ç›´å‡ºç»„ä»¶â€èƒ½åŠ›ï¼Œæ­£è¢«è¶Šæ¥è¶Šå¤šçš„æ¡†æ¶ï¼ˆå¦‚ Next.jsï¼‰æ‰€é›†æˆã€‚ç„¶è€Œï¼Œæ­£æ˜¯è¿™ä¸ªè¢«å¯„äºˆåšæœ›çš„ç‰¹æ€§ï¼Œå´æ‰“å¼€äº†æ½˜å¤šæ‹‰çš„é­”ç›’ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä¸è´¹å¹ç°ä¹‹åŠ›ï¼Œåœ¨ä½ çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä½ çš„æœåŠ¡å™¨åœ¨ä»–ä»¬é¢å‰å‡ ä¹æ˜¯â€œè£¸å¥”â€çŠ¶æ€ã€‚å½“ç„¶ï¼Œå¦‚æœä½ åªæ˜¯ä½¿ç”¨ React åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œæ˜¯ä¸å—è¯¥æ¼æ´å½±å“çš„ã€‚</p>
<p>æœ¬æ–‡å°†è¯¦ç»†è§£æè¿™ä¸€ä¸¥é‡æ¼æ´ï¼Œæ­å¼€ CVE-2025-55182ï¼ˆåˆç§° React2Shellï¼‰çš„ç¥ç§˜é¢çº±ã€‚ä¸»è¦åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><strong>ç†è§£æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼šä»€ä¹ˆæ˜¯ RSCï¼Ÿä»€ä¹ˆæ˜¯ååºåˆ—åŒ–æ¼æ´ï¼Ÿ</li>
<li><strong>æ·±å…¥æ”»å‡»åŸç†</strong>ï¼šæ”»å‡»è€…æ˜¯å¦‚ä½•æ„é€ æ¶æ„â€œæ•°æ®åŒ…â€çš„ï¼Ÿ</li>
<li><strong>æºç çº§å‰–æ</strong>ï¼š<code>react-server-dom</code> çš„ä»£ç é‡Œåˆ°åº•è—ç€ä»€ä¹ˆâ€œåé—¨â€ï¼Ÿ</li>
<li><strong>å­¦ä¹ ä¸åæ€</strong>ï¼šæˆ‘ä»¬èƒ½ä»è¿™æ¬¡äº‹ä»¶ä¸­å­¦åˆ°ä»€ä¹ˆï¼Ÿ</li>
</ul>
<h2 data-id="heading-0">ä¸€ã€ç†è§£æ¼æ´çš„å¿…å¤‡çŸ¥è¯†</h2>
<p>åœ¨è§£ææ¼æ´ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆç†è§£ä¸‰ä¸ªå…³é”®æ¦‚å¿µï¼šRSCã€Flight åè®®å’Œååºåˆ—åŒ–æ¼æ´ã€‚</p>
<h3 data-id="heading-1">1. React Server Componentsï¼šå‰ç«¯å¼€å‘çš„â€œæ–°ç§‘æŠ€â€</h3>
<p>ä½ å¯ä»¥æŠŠ RSC æƒ³è±¡æˆä¸€ç§â€œæ··è¡€â€ç»„ä»¶ã€‚å®ƒåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå¯ä»¥ç›´æ¥è¯»æ•°æ®åº“ã€è®¿é—®æ–‡ä»¶ï¼Œå°±åƒåç«¯ä»£ç ä¸€æ ·ï¼›ä½†å®ƒçš„äº§ç‰©åˆä¸æ˜¯å†·å†°å†°çš„ HTMLï¼Œè€Œæ˜¯ä¸€ç§èƒ½è¢«å®¢æˆ·ç«¯ React â€œå¬æ‡‚â€çš„ç‰¹æ®ŠæŒ‡ä»¤ã€‚</p>
<p><strong>å’Œä¼ ç»ŸæœåŠ¡ç«¯æ¸²æŸ“ (SSR) æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ</strong></p>
<p>å…ˆçœ‹ä¸¤è€…çš„åŠ è½½æµç¨‹å›¾ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph "ä¼ ç»Ÿ SSR (Server-Side Rendering)"
        A[æµè§ˆå™¨è¯·æ±‚é¡µé¢] --&gt; B(æœåŠ¡å™¨);
        B --&gt; C[React ç»„ä»¶æ¸²æŸ“æˆ HTML å­—ç¬¦ä¸²];
        C --&gt; D[è¿”å›å®Œæ•´ HTML];
        D --&gt; E(å®¢æˆ·ç«¯);
        E --&gt; F[åŠ è½½ JS è¿›è¡Œ Hydration];
    end

    subgraph "RSC (React Server Components)"
        G[æµè§ˆå™¨è¯·æ±‚æˆ–è§¦å‘ UI æ›´æ–°] --&gt; H(æœåŠ¡å™¨);
        H --&gt; I[æœåŠ¡å™¨ç»„ä»¶æ‰§è¡Œå¹¶åºåˆ—åŒ–ä¸º Flight æ•°æ®æµ];
        I --&gt; J[è¿”å› Flight æ•°æ®æµ];
        J --&gt; K(å®¢æˆ·ç«¯ React);
        K --&gt; L[è§£ææ•°æ®æµå¹¶æ— ç¼æ›´æ–° UI];
    end
</code></pre>
<p>ç®€å•æ¥è¯´ï¼š</p>
<ul>
<li><strong>SSR</strong> è¿”å›çš„æ˜¯â€œæ­»â€çš„ HTMLï¼Œå®¢æˆ·ç«¯éœ€è¦åŠ è½½ JavaScript æ‰èƒ½è®©é¡µé¢â€œæ´»â€è¿‡æ¥ï¼ˆè¿™ä¸ªè¿‡ç¨‹å«<strong>æ°´åˆ</strong>ï¼ŒHydrationï¼‰ã€‚</li>
<li><strong>RSC</strong> è¿”å›çš„æ˜¯â€œæ´»â€çš„æŒ‡ä»¤ï¼Œå®¢æˆ·ç«¯ React ç›´æ¥æ‰§è¡Œè¿™äº›æŒ‡ä»¤æ¥æ›´æ–° UIï¼Œæ•´ä¸ªè¿‡ç¨‹æ›´ä¸æ»‘ï¼Œè€Œä¸”æœåŠ¡å™¨ç»„ä»¶çš„ä»£ç å®Œå…¨ä¸å½±å“å®¢æˆ·ç«¯çš„åŒ…ä½“ç§¯ã€‚</li>
</ul>
<h3 data-id="heading-2">2. "Flight" åè®®ï¼šRSC çš„ä¸“å±â€œèˆªç­â€</h3>
<p>RSC çš„æŒ‡ä»¤æ˜¯å¦‚ä½•ä»æœåŠ¡å™¨é£åˆ°å®¢æˆ·ç«¯çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ­ä¹˜â€œFlightâ€è¿™è¶Ÿä¸“å±èˆªç­ã€‚</p>
<p>Flight åè®®å°±æ˜¯ React å®šä¹‰çš„ä¸€å¥—æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œä¸“é—¨ç”¨æ¥æ‰“åŒ…å’Œè¿è¾“ RSC çš„æ¸²æŸ“ç»“æœã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client as å®¢æˆ·ç«¯ (React App)
    participant Server as æœåŠ¡å™¨ (Node.js)

    Client-&gt;&gt;Server: å‘èµ· Flight è¯·æ±‚ (éœ€è¦ UserProfile ç»„ä»¶)
    Server-&gt;&gt;Server: æ‰§è¡Œ  UserProfile  æœåŠ¡å™¨ç»„ä»¶
    Server-&gt;&gt;Server: å°†ç»„ä»¶è¾“å‡ºåºåˆ—åŒ–ä¸º Flight æ•°æ®æ ¼å¼
    Server--&gt;&gt;Client: æµå¼è¿”å› Flight æ•°æ®
    Client-&gt;&gt;Client: æ¥æ”¶å¹¶è§£æ Flight æ•°æ®
    Client-&gt;&gt;Client: å°†æ–° UI æ›´æ–°åˆ° DOM ä¸­
</code></pre>
<h3 data-id="heading-3">3. ååºåˆ—åŒ–æ¼æ´ï¼šè¿‡äºä¿¡ä»»</h3>
<p>è¿™æ˜¯æˆ‘ä»¬ç†è§£æœ¬æ¬¡æ¼æ´çš„æ ¸å¿ƒ</p>
<ul>
<li><strong>åºåˆ—åŒ–</strong>ï¼šæŠŠç¨‹åºä¸­çš„æ•°æ®ï¼ˆæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡ï¼‰å˜æˆä¸€ä¸²æ–‡æœ¬ï¼ˆæ¯”å¦‚ JSON å­—ç¬¦ä¸²ï¼‰ï¼Œæ–¹ä¾¿å­˜å‚¨æˆ–ä¼ è¾“</li>
<li><strong>ååºåˆ—åŒ–</strong>ï¼šæŠŠé‚£ä¸²æ–‡æœ¬å†å˜å›ç¨‹åºé‡Œçš„æ•°æ®ï¼ˆæ¯”å¦‚å°† JSON è½¬æ¢ä¸ºå¯¹è±¡ï¼‰</li>
</ul>
<p><strong>æ¼æ´å‡ºåœ¨å“ªï¼Ÿ</strong></p>
<p>å‡ºåœ¨è§£ææ—¶å­˜åœ¨ä¸å®‰å…¨çš„æ–‡æœ¬ã€‚å¦‚æœæœåŠ¡å™¨åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå®Œå…¨ä¿¡ä»»æ”¶åˆ°çš„æ•°æ®ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥åœ¨æ–‡æœ¬é‡Œè—ä¸€é¢—â€œç‚¸å¼¹â€ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph "æ­£å¸¸æµç¨‹"
        A["å¯¹è±¡ï¼š{user: 'React'}"] -- åºåˆ—åŒ– --&gt; B["JSONï¼š{&amp;quot;user&amp;quot;:&amp;quot;React&amp;quot;}"];
        B -- ç½‘ç»œä¼ è¾“ --&gt; C(æ¥æ”¶ç«¯);
        C -- ååºåˆ—åŒ– --&gt; D["è¿˜åŸå¯¹è±¡ï¼š{user: 'React'}"];
    end

    subgraph "æ”»å‡»åœºæ™¯"
        E["æ¶æ„å¯¹è±¡"] -- åºåˆ—åŒ– --&gt; F["æ¶æ„ JSONï¼š{&amp;quot;user&amp;quot;:&amp;quot;hacker&amp;quot;,callback:&amp;quot;æ¶æ„ä»£ç &amp;quot;}"];
        F -- ç½‘ç»œä¼ è¾“ --&gt; G(æ¥æ”¶ç«¯);
        G -- ä¸å®‰å…¨çš„ååºåˆ—åŒ– --&gt; H["æ‰§è¡Œæ¶æ„ callback"];
        H -- RCE --&gt; I[æœåŠ¡å™¨è¢«æ§åˆ¶];
    end
</code></pre>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªåº”ç”¨åœ¨ååºåˆ—åŒ–ç”¨æˆ·è®¾ç½®æ—¶ï¼Œå¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶ JSONï¼Œå¹¶ä¼ å…¥è¿™æ ·çš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"attacker"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"on_load"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"function() { require('child_process').execSync('rm -rf /'); }"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¦‚æœæœåŠ¡å™¨å‚»å‚»åœ°æŠŠ <code>on_load</code> çš„å€¼å½“ä½œå‡½æ•°æ¥æ‰§è¡Œï¼Œé‚£åæœä¸å ªè®¾æƒ³ã€‚</p>
<p><strong>React2Shell æ¼æ´ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ <code>react-server-dom</code> åœ¨å¤„ç† Flight â€œèˆªç­â€é€æ¥çš„â€œåŒ…è£¹â€æ—¶ï¼Œå‘ç”Ÿäº†æå…¶å±é™©çš„ä¸å®‰å…¨ååºåˆ—åŒ–ã€‚</strong></p>
<p>ç°åœ¨ï¼ŒåŸºç¡€çŸ¥è¯†å·²ç»é“ºå«å®Œæ¯•ã€‚ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ­£å¼è¿›å…¥æºç ï¼Œçœ‹çœ‹æ”»å‡»è€…æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥åˆ©ç”¨è¿™ä¸ªç¼ºé™·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰çš„ã€‚</p>
<h2 data-id="heading-4">äºŒã€æ·±å…¥æºç ï¼šRCE çš„ä¸‰æ­¥å¿…æ€æŠ€</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥æ­¥è¿˜åŸæ”»å‡»è€…æ˜¯å¦‚ä½•åˆ©ç”¨ <code>react-server-dom</code> çš„è®¾è®¡ç¼ºé™·ï¼Œå®Œæˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰è¿™è‡´å‘½ä¸€å‡»çš„ã€‚</p>
<p>æ•´ä¸ªæ”»å‡»è¿‡ç¨‹ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºâ€œä¸‰æ­¥å¿…æ€â€ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€æ­¥ï¼šç©ºæŠ•â€œç‰¹æ´›ä¼Šæœ¨é©¬â€</strong> â€”â€” æ„é€ ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„æ¶æ„ Flight æ•°æ®åŒ…</li>
<li><strong>ç¬¬äºŒæ­¥ï¼šå·å–â€œä¸‡èƒ½é’¥åŒ™â€</strong> â€”â€” ä» JavaScript çš„åŸå‹é“¾ä¸­â€œå·â€å‡º <code>Function</code> æ„é€ å‡½æ•°è¿™ä¸ªå±é™©çš„å·¥å…·</li>
<li><strong>ç¬¬ä¸‰æ­¥ï¼šå¼•çˆ†â€œé€»è¾‘ç‚¸å¼¹â€</strong> â€”â€” è¯±å¯¼ React çš„è§£æå™¨æ‰§è¡Œä¸€ä¸ªçœ‹ä¼¼æ— å®³ã€å®åˆ™è‡´å‘½çš„æ“ä½œï¼Œå¼•çˆ†ç‚¸å¼¹</li>
</ol>
<p>è®©æˆ‘ä»¬é€ä¸€åˆ†è§£ã€‚</p>
<h3 data-id="heading-5">1. ç©ºæŠ•â€œç‰¹æ´›ä¼Šæœ¨é©¬â€ï¼ˆæ¶æ„ Payloadï¼‰</h3>
<p>æ”»å‡»çš„èµ·ç‚¹ï¼Œæ˜¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚çš„ body éƒ¨åˆ†ï¼Œæ˜¯ä¸€ä¸ª <code>multipart/form-data</code> æ ¼å¼çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„ Flight â€œåŒ…è£¹â€ã€‚</p>
<p>è¿™ä¸ªâ€œåŒ…è£¹â€é‡Œè—ç€æ”»å‡»è€…çš„â€œç‰¹æ´›ä¼Šæœ¨é©¬â€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ Payloadï¼Œæˆ‘ä»¬ä¼šé€ä¸€æ‹†è§£ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ Payload</span>
<span class="hljs-keyword">const</span> payload = {
    <span class="hljs-comment">// å…¥å£ç‚¹ï¼Œå‘Šè¯‰è§£æå™¨ä»å¯¹è±¡ '1' å¼€å§‹å¤„ç†</span>
    <span class="hljs-string">'0'</span>: <span class="hljs-string">'$1'</span>,
    <span class="hljs-comment">// ä¼ªè£…æˆä¸€ä¸ª Promise çš„æ ¸å¿ƒå¯¹è±¡</span>
    <span class="hljs-string">'1'</span>: {
        <span class="hljs-comment">// ... (ä¸€äº›è¿·æƒ‘æ€§çš„å±æ€§)</span>
        <span class="hljs-string">'value'</span>: <span class="hljs-string">'{"then":"$3:map","0":{"then":"$B3"},"length":1}'</span>, <span class="hljs-comment">// è§¦å‘ Promise é“¾çš„æ ¸å¿ƒ</span>
        <span class="hljs-string">'_response'</span>: <span class="hljs-string">'$4'</span>, <span class="hljs-comment">// æŒ‡å‘æˆ‘ä»¬ä¼ªé€ çš„â€œå“åº”â€å¯¹è±¡ï¼Œé‡Œé¢è—ç€â€œæ­¦å™¨â€</span>
        <span class="hljs-string">'then'</span>: <span class="hljs-string">'$2:then'</span> <span class="hljs-comment">// è®©è‡ªå·±è¡¨ç°å¾—åƒä¸€ä¸ª Promise</span>
    },
    <span class="hljs-comment">// ä¸€ä¸ªçœŸæ­£çš„ Promiseï¼Œç”¨æ¥é©±åŠ¨æµç¨‹</span>
    <span class="hljs-string">'2'</span>: <span class="hljs-string">'$@3'</span>,
    <span class="hljs-comment">// ä¸€ä¸ªæ™®é€šçš„ç©ºæ•°ç»„ï¼Œä½†å®ƒçš„æ„é€ å‡½æ•°æ˜¯æˆ‘ä»¬çš„ç›®æ ‡</span>
    <span class="hljs-string">'3'</span>: [],
    <span class="hljs-comment">// ä¼ªé€ çš„â€œResponseâ€å¯¹è±¡ï¼Œæºå¸¦äº†æˆ‘ä»¬çš„â€œæ­¦å™¨â€å’Œâ€œå¼¹è¯â€</span>
    <span class="hljs-string">'4'</span>: {
        <span class="hljs-comment">// â€œå¼¹è¯â€ï¼šæƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç </span>
        <span class="hljs-string">'_prefix'</span>: <span class="hljs-string">'require("child_process").execSync("touch /tmp/pwned"); //'</span>,
        <span class="hljs-comment">// â€œæ­¦å™¨â€ï¼šæŒ‡å‘ Function æ„é€ å‡½æ•°çš„â€œå°å·¥å…·â€ (Gadget)</span>
        <span class="hljs-string">'_formData'</span>: {
            <span class="hljs-string">'get'</span>: <span class="hljs-string">'$3:constructor:constructor'</span>
        },
    }
}
</code></pre>
<p>è¿™ä¸ª <code>payload</code> çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨ Flight åè®®çš„å¼•ç”¨æœºåˆ¶ï¼ˆ<code>$</code> ç¬¦å·ï¼‰ï¼Œå°†ä¸€å †æ™®é€šçš„æ•°æ®å¯¹è±¡ï¼ˆ<code>'1'</code>, <code>'4'</code> ç­‰ï¼‰åŒ…è£…æ‰“æ‰®æˆ React å†…éƒ¨å¤„ç†æµç¨‹ä¸­çš„å…³é”®è§’è‰²ï¼Œæ¯”å¦‚ <code>Chunk</code>ï¼ˆæ•°æ®å—ï¼‰å’Œ <code>Response</code>ï¼ˆå“åº”å¯¹è±¡ï¼‰ï¼Œä»è€Œéª—è¿‡æœåŠ¡å™¨çš„è§£æå™¨ã€‚</p>
<h3 data-id="heading-6">2. å·å–â€œä¸‡èƒ½é’¥åŒ™â€ï¼ˆ<code>Function</code> æ„é€ å‡½æ•°ï¼‰</h3>
<p>åœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œ<code>eval()</code> å‡½æ•°å› ä¸ºèƒ½ç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç ï¼Œæ—©å·²è‡­åæ˜­è‘—ã€‚ä½†å®ƒæœ‰ä¸ªâ€œå…„å¼Ÿâ€â€”â€”<code>Function()</code> æ„é€ å‡½æ•°ï¼ŒåŒæ ·èƒ½å®ç°åŠ¨æ€ä»£ç æ‰§è¡Œï¼Œå´æ›´å®¹æ˜“è¢«å¿½è§†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¿™ä¸¤ç§æ–¹å¼éƒ½èƒ½æ‰§è¡Œå­—ç¬¦ä¸²é‡Œçš„ä»£ç </span>
<span class="hljs-built_in">eval</span>(<span class="hljs-string">'console.log("Hello from eval")'</span>);

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">'console.log("Hello from Function constructor")'</span>)();
</code></pre>
<p>æ”»å‡»è€…çš„ç›®æ ‡ï¼Œå°±æ˜¯æ‹¿åˆ°è¿™ä¸ª <code>Function</code> æ„é€ å‡½æ•°ã€‚ä»–ä»¬æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿç­”æ¡ˆè—åœ¨ <code>payload</code> çš„ <code>'4'</code> å·å¯¹è±¡é‡Œï¼š</p>
<p><code>'get': '$3:constructor:constructor'</code></p>
<p>å½“ <code>react-server-dom</code> çš„è§£æå™¨çœ‹åˆ°è¿™ä¸ªå¼•ç”¨æ—¶ï¼Œå®ƒä¼šè¿›è¡Œä¸€åœºæƒŠå¿ƒåŠ¨é­„çš„â€œåŸå‹é“¾æ”€çˆ¬â€ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A("$3") -- è§£æä¸º --&gt; B("ç©ºæ•°ç»„ []");
    B -- .constructor --&gt; C(æ•°ç»„çš„æ„é€ å‡½æ•° Array);
    C -- .constructor --&gt; D(Array æ„é€ å‡½æ•°çš„æ„é€ å‡½æ•°&lt;br&gt;å³å…¨å±€ Function å¯¹è±¡);
    D -- èµ‹å€¼ç»™ --&gt; E(_formData.get å±æ€§);
</code></pre>
<p>é€šè¿‡ä¸¤æ¬¡ <code>.constructor</code> çš„è®¿é—®ï¼Œæ”»å‡»è€…ä»ä¸€ä¸ªå¹³å¹³æ— å¥‡çš„ç©ºæ•°ç»„ <code>[]</code> å‡ºå‘ï¼Œæœ€ç»ˆæ‘¸åˆ°äº† JavaScript çš„â€œä¸‡èƒ½é’¥åŒ™â€â€”â€”å…¨å±€ <code>Function</code> å¯¹è±¡ï¼</p>
<p>ç°åœ¨ï¼Œæ”»å‡»è€…çš„çŠ¶æ€æ˜¯ï¼š</p>
<ul>
<li><strong>â€œå¼¹è¯â€å·²ä¸Šè†›</strong>ï¼šæ¶æ„ä»£ç å­—ç¬¦ä¸² <code>require('child_process')...</code> å­˜æ”¾åœ¨ <code>_prefix</code> å±æ€§ä¸­ã€‚</li>
<li><strong>â€œæ­¦å™¨â€å·²åˆ°æ‰‹</strong>ï¼š<code>_formData.get</code> å±æ€§å·²ç»å˜æˆäº† <code>Function</code> æ„é€ å‡½æ•°ã€‚</li>
</ul>
<p>è‡³æ­¤ä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¸œé£ã€‚</p>
<h3 data-id="heading-7">3. ç¬¬ä¸‰æ­¥ï¼šå¼•çˆ†â€œé€»è¾‘ç‚¸å¼¹â€ (è§¦å‘ RCE)</h3>
<p>æœ€åçš„å¼•çˆ†ç‚¹ï¼Œéšè—åœ¨ <code>react-server-dom</code> åŒ…å¤„ç† Flight æ•°æ®çš„æŸä¸ªå‡½æ•°ï¼ˆå¦‚ <code>parseModel</code>ï¼‰ä¸­ï¼ˆå·²ç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// react-server-dom-webpack/server.node.js (ç®€åŒ–å)</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveModel</span>(<span class="hljs-params">response, id, model</span>) {
  <span class="hljs-comment">// ... çœç•¥å¤§é‡ä»£ç  ...</span>

  <span class="hljs-keyword">const</span> value = model.<span class="hljs-property">value</span>; <span class="hljs-comment">// value å¯èƒ½æ˜¯ '{"then":"$B3"...}'</span>

  <span class="hljs-comment">// å½“è§£æå™¨é‡åˆ° '$B' å¼€å¤´çš„ç‰¹æ®ŠæŒ‡ä»¤æ—¶</span>
  <span class="hljs-keyword">if</span> (value[<span class="hljs-number">0</span>] === <span class="hljs-string">'$'</span> &amp;&amp; value[<span class="hljs-number">1</span>] === <span class="hljs-string">'B'</span>) {
    <span class="hljs-keyword">const</span> props = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(value.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// props ä¼šè¢«è§£æä¸º 3</span>

    <span class="hljs-comment">// è‡´å‘½çš„å¼•çˆ†ç‚¹</span>
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">_formData</span>.<span class="hljs-title function_">get</span>(response.<span class="hljs-property">_prefix</span> + props.<span class="hljs-title function_">toString</span>());
  }

  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å½“æˆ‘ä»¬çš„æ¶æ„ <code>payload</code> è¢«é€åˆ°è¿™é‡Œæ—¶ï¼Œä¸€åœºâ€œå®Œç¾çš„é£æš´â€å½¢æˆäº†ï¼š</p>
<ol>
<li>è§£æå™¨å¤„ç†åˆ°å¯¹è±¡ <code>'1'</code> çš„ <code>value</code> å±æ€§ï¼Œå‘ç°é‡Œé¢æœ‰ <code>'$B3'</code> è¿™ä¸ªç‰¹æ®ŠæŒ‡ä»¤ï¼Œè¿›å…¥äº† <code>if</code> åˆ†æ”¯ã€‚</li>
<li><code>props</code> è¢«è§£æä¸ºæ•°å­— <code>3</code>ã€‚</li>
<li>æœ€å…³é”®çš„ä¸€è¡Œä»£ç è¢«æ‰§è¡Œï¼š<code>response._formData.get(response._prefix + props.toString())</code>ã€‚</li>
</ol>
<p>æˆ‘ä»¬æŠŠå˜é‡æ›¿æ¢æˆæ”»å‡»è€…å‡†å¤‡å¥½çš„ä¸œè¥¿ï¼š</p>
<ul>
<li><code>response</code>ï¼šå°±æ˜¯æˆ‘ä»¬ä¼ªé€ çš„ <code>'4'</code> å·å¯¹è±¡ã€‚</li>
<li><code>response._formData.get</code>ï¼šå°±æ˜¯ <code>Function</code> æ„é€ å‡½æ•°ã€‚</li>
<li><code>response._prefix</code>ï¼šå°±æ˜¯æ¶æ„ä»£ç å­—ç¬¦ä¸² <code>require('child_process')...</code>ã€‚</li>
<li><code>props.toString()</code>ï¼šå°±æ˜¯å­—ç¬¦ä¸² <code>'3'</code>ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œè¿™è¡Œä»£ç å®é™…ä¸Šç­‰ä»·äºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Function</span>(<span class="hljs-string">'require("child_process").execSync("touch /tmp/pwned"); //'</span> + <span class="hljs-string">'3'</span>)
</code></pre>
<p>ä¸€ä¸ªæ–°çš„åŒ¿åå‡½æ•°è¢«åŠ¨æ€åˆ›å»ºï¼Œå‡½æ•°ä½“å°±æ˜¯æ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚</p>
<p>ç”±äº React å†…éƒ¨çš„ Promise é“¾å¤„ç†æœºåˆ¶ï¼Œè¿™ä¸ªåˆšåˆšè¯ç”Ÿçš„å‡½æ•°ä¼šè¢«ç«‹å³è°ƒç”¨æ‰§è¡Œã€‚</p>
<p>æ”»å‡»è€…æˆåŠŸåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œäº†ä»»æ„ä»£ç ï¼ŒRCE è¾¾æˆã€‚æœåŠ¡å™¨çš„æ§åˆ¶æƒå°±æ­¤æ˜“æ‰‹ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[æ¥æ”¶æ¶æ„ Flight æ•°æ®åŒ…] --&gt; B{è§£æ Payload};
    B --&gt; C(æŒ‰å¼•ç”¨ '$3:constructor:constructor' æŸ¥æ‰¾);
    C --&gt; D[è·å¾— Function æ„é€ å‡½æ•°å¹¶èµ‹å€¼ç»™ _formData.get];
    B --&gt; E[è§£æåˆ° '$B3' æŒ‡ä»¤];
    E --&gt; F["æ‰§è¡Œ _formData.get(_prefix + '3')"];
    F --&gt; G["ç­‰ä»·äº Function('æ¶æ„ä»£ç ' + '3')()"];
    G --&gt; H[æ¶æ„ä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ];
    H --&gt; I((RCE æˆåŠŸ));
</code></pre>
<h2 data-id="heading-8">ä¸‰ã€ä¿®å¤æ–¹æ¡ˆ</h2>
<p>åœ¨å¦‚æ­¤ä¸¥é‡çš„æ¼æ´é¢å‰ï¼ŒReact å›¢é˜Ÿçš„å“åº”æ˜¯è¿…é€Ÿçš„ã€‚ä»–ä»¬å¾ˆå¿«å‘å¸ƒäº†è¡¥ä¸ï¼Œä¿®å¤äº† React2Shellã€‚é‚£ä¹ˆï¼Œä»–ä»¬æ˜¯å¦‚ä½•ä¿®å¤çš„å‘¢ï¼Ÿ</p>
<h3 data-id="heading-9">ä¿®å¤çš„æ ¸å¿ƒæ€æƒ³ï¼šâ€œä¸å†ä¿¡ä»»â€</h3>
<p>è¿™æ¬¡æ¼æ´çš„æ ¹æºåœ¨äºå¯¹å®¢æˆ·ç«¯è¾“å…¥æ•°æ®çš„â€œè¿‡åº¦ä¿¡ä»»â€ã€‚å› æ­¤ï¼Œä¿®å¤çš„æ ¸å¿ƒæ€æƒ³å°±é¡ºç†æˆç« åœ°å˜æˆäº†â€”â€”<strong>â€œä¸å†ä¿¡ä»»â€</strong>ã€‚</p>
<p>å…·ä½“çš„ä¿®å¤æªæ–½å¯ä»¥æ€»ç»“ä¸ºä¸‰æ¿æ–§ï¼š</p>
<ol>
<li>
<p><strong>å¢å¼ºéªŒè¯</strong>ï¼šåœ¨ååºåˆ—åŒ– Flight æ•°æ®æµçš„æ¯ä¸€æ­¥ï¼Œéƒ½åŠ å…¥äº†ä¸¥æ ¼çš„ç±»å‹å’Œæ ¼å¼æ ¡éªŒã€‚è§£æå™¨ä¸å†æ˜¯â€œç›²ç›®â€æ‰§è¡Œï¼Œè€Œæ˜¯åƒä¸€ä¸ªä¸¥æ ¼çš„å®‰æ£€å‘˜ï¼Œæ£€æŸ¥æ¯ä¸ªâ€œåŒ…è£¹â€çš„å°ºå¯¸ã€å½¢çŠ¶ã€å†…å®¹æ˜¯å¦ç¬¦åˆè§„å®šï¼Œä»»ä½•ä¸ç¬¦åˆé¢„æœŸçš„å¯ç–‘æ•°æ®éƒ½ä¼šè¢«ç›´æ¥æ‹’ç»ã€‚</p>
</li>
<li>
<p><strong>é˜»æ–­åŸå‹é“¾</strong>ï¼šè¡¥ä¸ç‰¹åˆ«å°å µäº†é€šè¿‡ <code>.constructor</code> å±æ€§è¿›è¡ŒåŸå‹é“¾æ”€çˆ¬çš„è·¯å¾„ã€‚è¿™æ„å‘³ç€ï¼Œæ”»å‡»è€…æ— æ³•å†é€šè¿‡ <code>[].constructor.constructor</code> è¿™ç§æ–¹å¼è½»æ˜“åœ°æ‹¿åˆ° <code>Function</code> æ„é€ å‡½æ•°æˆ–å…¶ä»–å±é™©çš„å…¨å±€å¯¹è±¡ã€‚é€šå¾€â€œä¸‡èƒ½é’¥åŒ™â€çš„å¯†é“è¢«å½»åº•å µæ­»äº†ã€‚</p>
</li>
<li>
<p><strong>éš”ç¦»å†…éƒ¨çŠ¶æ€</strong>ï¼šä¿®æ”¹äº†è§£æé€»è¾‘ï¼Œä¸¥æ ¼é™åˆ¶äº†åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹ React å†…éƒ¨çŠ¶æ€å¯¹è±¡ï¼ˆå¦‚ <code>_response</code>ï¼‰çš„è®¿é—®å’Œä¿®æ”¹ã€‚è¿™ç›¸å½“äºç»™è§£æå™¨çš„æ ¸å¿ƒåŒºåŸŸåŠ äº†ä¸€é“â€œé˜²ç«å¢™â€ï¼Œé˜²æ­¢æ”»å‡»è€…é€šè¿‡ä¼ªé€ çš„æ•°æ®æ¥ç¯¡æ”¹å…¶å†…éƒ¨è¡Œä¸ºã€‚</p>
</li>
</ol>
<h2 data-id="heading-10">å››ã€æ€»ç»“</h2>
<p>CVE-2025-55182 æ¼æ´è™½ç„¶å·²ç»è¢«ä¿®å¤ï¼Œä½†å®ƒç»™æˆ‘ä»¬æ‰€æœ‰å¼€å‘è€…ï¼Œå°¤å…¶æ˜¯å‰ç«¯å¼€å‘è€…ï¼Œæ•²å“äº†ä¸€è®°å“äº®çš„è­¦é’Ÿï¼š</p>
<blockquote>
<p><strong>æ°¸è¿œä¸è¦ä¿¡ä»»æ¥è‡ªå¤–éƒ¨çš„ä»»ä½•æ•°æ®</strong></p>
</blockquote>
<p>æ— è®ºæ˜¯ç”¨æˆ·çš„è¾“å…¥ã€API çš„è¿”å›ï¼Œè¿˜æ˜¯åƒ Flight è¿™æ ·çœ‹ä¼¼â€œå†…éƒ¨â€çš„åè®®æ•°æ®ï¼Œåªè¦å®ƒæ¥æºäºä½ çš„åº”ç”¨ä¹‹å¤–ï¼Œå°±å¿…é¡»è¢«è§†ä¸ºæœ‰æ½œåœ¨å¨èƒçš„ã€‚ä¸å®‰å…¨ååºåˆ—åŒ–æ¼æ´çš„æœ¬è´¨ï¼Œå°±æ˜¯è¿èƒŒäº†è¿™æ¡æ³•åˆ™ï¼Œç ´åäº†å®‰å…¨çš„åŸºçŸ³ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2æ€ä¹ˆæ­å»ºå‰ç«¯æ€§èƒ½/é”™è¯¯/è¡Œä¸ºç›‘æ§ä½“ç³»]]></title>    <link>https://juejin.cn/post/7582846276505747494</link>    <guid>https://juejin.cn/post/7582846276505747494</guid>    <pubDate>2025-12-12T16:55:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582846276505747494" data-draft-id="7582422818311716915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2æ€ä¹ˆæ­å»ºå‰ç«¯æ€§èƒ½/é”™è¯¯/è¡Œä¸ºç›‘æ§ä½“ç³»"/> <meta itemprop="keywords" content="ç›‘æ§,Vue.js,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-12T16:55:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aniugel"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824198407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2æ€ä¹ˆæ­å»ºå‰ç«¯æ€§èƒ½/é”™è¯¯/è¡Œä¸ºç›‘æ§ä½“ç³»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824198407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aniugel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T16:55:20.000Z" title="Fri Dec 12 2025 16:55:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>åœ¨ Vue2 é¡¹ç›®ä¸­æ­å»º<strong>å‰ç«¯ç›‘æ§ä½“ç³»</strong>ï¼Œæ ¸å¿ƒè¦è¦†ç›–ã€Œæ€§èƒ½ç›‘æ§ã€é”™è¯¯ç›‘æ§ã€ç”¨æˆ·è¡Œä¸ºç›‘æ§ã€ä¸‰å¤§ç»´åº¦ï¼Œä»¥ä¸‹æ˜¯ä¸€å¥—å¯è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ŒåŒ…å«æŠ€æœ¯é€‰å‹ã€ä»£ç å®ç°ã€æ•°æ®ä¸ŠæŠ¥ã€å¯è§†åŒ–åˆ†æå…¨æµç¨‹ï¼š</p>
<h4 data-id="heading-0">ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡</h4>
<p>ç›‘æ§ä½“ç³»åˆ†ä¸º 3 å±‚ï¼Œè½»é‡åŒ–æ¥å…¥ä¸”ä¸å½±å“ä¸»æµç¨‹æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-js" lang="js">å‰ç«¯é‡‡é›†å±‚ï¼ˆ<span class="hljs-title class_">Vue2</span> é¡¹ç›®ï¼‰â†’ æ•°æ®ä¸ŠæŠ¥å±‚ï¼ˆæ¥å£/åŸ‹ç‚¹å¹³å°ï¼‰â†’ åå°åˆ†æå±‚ï¼ˆå¯è§†åŒ–/å‘Šè­¦ï¼‰
</code></pre>
<ul>
<li>é‡‡é›†å±‚ï¼šé€šè¿‡ Vue é’©å­ã€æµè§ˆå™¨ API é‡‡é›†æ€§èƒ½ / é”™è¯¯ / è¡Œä¸ºæ•°æ®ï¼›</li>
<li>ä¸ŠæŠ¥å±‚ï¼šæ‰¹é‡ + é˜²æŠ–ä¸ŠæŠ¥ï¼Œé¿å…é¢‘ç¹è¯·æ±‚ï¼›</li>
<li>åˆ†æå±‚ï¼šå¯é€‰å¼€æºå·¥å…·ï¼ˆGrafana/ELKï¼‰æˆ–ç¬¬ä¸‰æ–¹å¹³å°ï¼ˆFundebug / ç›‘æ§å®ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-1">äºŒã€æ€§èƒ½ç›‘æ§ï¼ˆæ ¸å¿ƒç›‘æ§é¦–å± / é¡µé¢åŠ è½½ / æ¥å£æ€§èƒ½ï¼‰</h3>
<h4 data-id="heading-2">1. æ ¸å¿ƒé‡‡é›†æŒ‡æ ‡</h4>
<ul>
<li>é¡µé¢æ€§èƒ½ï¼šFP/FCP/LCP/TTIï¼ˆé€šè¿‡Â <code>performance</code>Â APIï¼‰ï¼›</li>
<li>æ¥å£æ€§èƒ½ï¼šè¯·æ±‚è€—æ—¶ / æˆåŠŸç‡ / çŠ¶æ€ç ï¼›</li>
<li>Vue æ€§èƒ½ï¼šç»„ä»¶æ¸²æŸ“è€—æ—¶ï¼ˆé€šè¿‡ Vue é’©å­ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-3">2. ä»£ç å®ç°ï¼ˆVue2 ä¸­å°è£…æ€§èƒ½ç›‘æ§æ¨¡å—ï¼‰</h4>
<p>æ–°å»ºÂ <code>src/utils/performanceMonitor.js</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * æ€§èƒ½ç›‘æ§æ ¸å¿ƒæ¨¡å—
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// åˆå§‹åŒ–æ€§èƒ½ç›‘æ§</span>
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. é¡µé¢åŠ è½½æ€§èƒ½ï¼ˆDOMContentLoaded åé‡‡é›†ï¼‰</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">collectPagePerformance</span>);
    <span class="hljs-comment">// 2. æ¥å£æ€§èƒ½ç›‘æ§ï¼ˆé‡å†™ axiosï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wrapAxios</span>();
    <span class="hljs-comment">// 3. Vue ç»„ä»¶æ¸²æŸ“æ€§èƒ½ï¼ˆå…¨å±€æ··å…¥ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wrapVueComponent</span>();
  },

  <span class="hljs-comment">// é‡‡é›†é¡µé¢æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡</span>
  <span class="hljs-title function_">collectPagePerformance</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> perf = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'navigation'</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (!perf) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ï¼ˆå¯¹åº”é¦–å±/åŠ è½½ç›¸å…³ï¼‰</span>
    <span class="hljs-keyword">const</span> performanceData = {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'performance'</span>,
      <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-comment">// åŸºç¡€åŠ è½½æŒ‡æ ‡</span>
      <span class="hljs-attr">domReadyTime</span>: perf.<span class="hljs-property">domContentLoadedEventEnd</span> - perf.<span class="hljs-property">navigationStart</span>, <span class="hljs-comment">// DOM å°±ç»ªæ—¶é—´</span>
      <span class="hljs-attr">loadTime</span>: perf.<span class="hljs-property">loadEventEnd</span> - perf.<span class="hljs-property">navigationStart</span>, <span class="hljs-comment">// é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´</span>
      <span class="hljs-comment">// å…³é”®ç»˜åˆ¶æŒ‡æ ‡</span>
      <span class="hljs-attr">fp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFP</span>(), <span class="hljs-comment">// é¦–æ¬¡ç»˜åˆ¶</span>
      <span class="hljs-attr">fcp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFCP</span>(), <span class="hljs-comment">// é¦–æ¬¡å†…å®¹ç»˜åˆ¶</span>
      <span class="hljs-attr">lcp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLCP</span>(), <span class="hljs-comment">// æœ€å¤§å†…å®¹ç»˜åˆ¶</span>
    };

    <span class="hljs-comment">// ä¸ŠæŠ¥æ€§èƒ½æ•°æ®ï¼ˆé˜²æŠ–æ‰¹é‡ä¸ŠæŠ¥ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>(performanceData);
  },

  <span class="hljs-comment">// è·å– FPï¼ˆé¦–æ¬¡ç»˜åˆ¶ï¼‰</span>
  <span class="hljs-title function_">getFP</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> entries = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'paint'</span>);
    <span class="hljs-keyword">const</span> fpEntry = entries.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">name</span> === <span class="hljs-string">'first-paint'</span>);
    <span class="hljs-keyword">return</span> fpEntry ? fpEntry.<span class="hljs-property">startTime</span> : <span class="hljs-number">0</span>;
  },

  <span class="hljs-comment">// è·å– FCPï¼ˆé¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼‰</span>
  <span class="hljs-title function_">getFCP</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> entries = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'paint'</span>);
    <span class="hljs-keyword">const</span> fcpEntry = entries.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">name</span> === <span class="hljs-string">'first-contentful-paint'</span>);
    <span class="hljs-keyword">return</span> fcpEntry ? fcpEntry.<span class="hljs-property">startTime</span> : <span class="hljs-number">0</span>;
  },

  <span class="hljs-comment">// è·å– LCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰</span>
  <span class="hljs-title function_">getLCP</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">entryList</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> entries = entryList.<span class="hljs-title function_">getEntries</span>();
        <span class="hljs-keyword">const</span> lcpEntry = entries[entries.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
        <span class="hljs-title function_">resolve</span>(lcpEntry ? lcpEntry.<span class="hljs-property">startTime</span> : <span class="hljs-number">0</span>);
      }).<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'largest-contentful-paint'</span>, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
    });
  },

  <span class="hljs-comment">// é‡å†™ axios ç›‘æ§æ¥å£æ€§èƒ½</span>
  <span class="hljs-title function_">wrapAxios</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);
    <span class="hljs-keyword">const</span> originalRequest = axios.<span class="hljs-property">request</span>;

    axios.<span class="hljs-property">request</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">config</span>) {
      <span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-comment">// å‘é€è¯·æ±‚</span>
      <span class="hljs-keyword">return</span> originalRequest.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, config).<span class="hljs-title function_">then</span>(
        <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
          <span class="hljs-comment">// æˆåŠŸï¼šé‡‡é›†è€—æ—¶/çŠ¶æ€ç </span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'api'</span>,
            <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
            <span class="hljs-attr">url</span>: config.<span class="hljs-property">url</span>,
            <span class="hljs-attr">method</span>: config.<span class="hljs-property">method</span>,
            <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
            <span class="hljs-attr">costTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime,
            <span class="hljs-attr">isSuccess</span>: <span class="hljs-literal">true</span>,
          });
          <span class="hljs-keyword">return</span> response;
        },
        <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
          <span class="hljs-comment">// å¤±è´¥ï¼šé‡‡é›†é”™è¯¯ä¿¡æ¯</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'api'</span>,
            <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
            <span class="hljs-attr">url</span>: config.<span class="hljs-property">url</span>,
            <span class="hljs-attr">method</span>: config.<span class="hljs-property">method</span>,
            <span class="hljs-attr">status</span>: error.<span class="hljs-property">response</span>?.<span class="hljs-property">status</span> || <span class="hljs-string">'network error'</span>,
            <span class="hljs-attr">costTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime,
            <span class="hljs-attr">isSuccess</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">errorMsg</span>: error.<span class="hljs-property">message</span>,
          });
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
        }
      );
    };
  },

  <span class="hljs-comment">// ç›‘æ§ Vue ç»„ä»¶æ¸²æŸ“è€—æ—¶</span>
  <span class="hljs-title function_">wrapVueComponent</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>({
      <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$performanceStart</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      },
      <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> renderTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">$performanceStart</span>;
        <span class="hljs-comment">// ä»…ç›‘æ§æ¸²æŸ“è€—æ—¶ &gt; 100ms çš„ç»„ä»¶ï¼ˆè¿‡æ»¤å°ç»„ä»¶ï¼Œå‡å°‘æ•°æ®é‡ï¼‰</span>
        <span class="hljs-keyword">if</span> (renderTime &gt; <span class="hljs-number">100</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'vue-component'</span>,
            <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
            <span class="hljs-attr">componentName</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">name</span> || <span class="hljs-string">'unknown'</span>,
            renderTime,
          });
        }
      },
    });
  },

  <span class="hljs-comment">// æ•°æ®ä¸ŠæŠ¥ï¼ˆé˜²æŠ–+æ‰¹é‡ï¼Œé¿å…é¢‘ç¹è¯·æ±‚ï¼‰</span>
  <span class="hljs-title function_">report</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-comment">// 1. ç¼“å­˜æ•°æ®åˆ°æ•°ç»„</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span> || [];
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span>.<span class="hljs-title function_">push</span>(data);

    <span class="hljs-comment">// 2. é˜²æŠ–ä¸ŠæŠ¥ï¼ˆ5s å†…åªä¸ŠæŠ¥ä¸€æ¬¡ï¼Œæˆ–ç¼“å­˜è¶…è¿‡ 10 æ¡ç«‹å³ä¸ŠæŠ¥ï¼‰</span>
    <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorTimer</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span>.<span class="hljs-property">length</span> &gt;= <span class="hljs-number">10</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendReport</span>();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorTimer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendReport</span>();
      }, <span class="hljs-number">5000</span>);
    }
  },

  <span class="hljs-comment">// å‘é€ä¸ŠæŠ¥è¯·æ±‚ï¼ˆå¯¹æ¥åå°/ç¬¬ä¸‰æ–¹å¹³å°ï¼‰</span>
  <span class="hljs-title function_">sendReport</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> cache = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span> || [];
    <span class="hljs-keyword">if</span> (cache.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// ä¸ŠæŠ¥æ¥å£ï¼ˆæ›¿æ¢ä¸ºä½ çš„åå°æ¥å£ï¼‰</span>
    axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/monitor/report'</span>, {
      <span class="hljs-attr">data</span>: cache,
      <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span>,
      <span class="hljs-attr">userId</span>: <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'userId'</span>) || <span class="hljs-string">'anonymous'</span>, <span class="hljs-comment">// å…³è”ç”¨æˆ·</span>
    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      <span class="hljs-comment">// ä¸ŠæŠ¥å¤±è´¥ï¼šç¼“å­˜åˆ° localStorageï¼Œä¸‹æ¬¡é‡è¯•</span>
      <span class="hljs-keyword">const</span> failCache = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'monitorFailCache'</span>) || <span class="hljs-string">'[]'</span>);
      failCache.<span class="hljs-title function_">push</span>(...cache);
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'monitorFailCache'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(failCache));
    });

    <span class="hljs-comment">// æ¸…ç©ºç¼“å­˜</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span> = [];
  },
};
</code></pre>
<h4 data-id="heading-4">3. åœ¨ Vue2 å…¥å£æŒ‚è½½</h4>
<p>ä¿®æ”¹Â <code>src/main.js</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> performanceMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/performanceMonitor'</span>;

<span class="hljs-comment">// åˆå§‹åŒ–æ€§èƒ½ç›‘æ§ï¼ˆç”Ÿäº§ç¯å¢ƒæ‰å¼€å¯ï¼‰</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  performanceMonitor.<span class="hljs-title function_">init</span>();
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>)
});
</code></pre>
<hr/>
<h3 data-id="heading-5">ä¸‰ã€é”™è¯¯ç›‘æ§ï¼ˆæ•è·ä»£ç  / æ¥å£ / Vue è¿è¡Œæ—¶é”™è¯¯ï¼‰</h3>
<h4 data-id="heading-6">1. æ ¸å¿ƒæ•è·åœºæ™¯</h4>
<ul>
<li>Vue è¿è¡Œæ—¶é”™è¯¯ï¼ˆé€šè¿‡Â <code>Vue.config.errorHandler</code>ï¼‰ï¼›</li>
<li>JS å…¨å±€é”™è¯¯ï¼ˆ<code>window.onerror</code>ï¼‰ï¼›</li>
<li>èµ„æºåŠ è½½é”™è¯¯ï¼ˆå›¾ç‰‡ / è„šæœ¬ / æ ·å¼ï¼Œ<code>window.addEventListener('error')</code>ï¼‰ï¼›</li>
<li>Promise æœªæ•è·é”™è¯¯ï¼ˆ<code>window.addEventListener('unhandledrejection')</code>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-7">2. ä»£ç å®ç°ï¼ˆæ–°å»ºÂ <code>src/utils/errorMonitor.js</code>ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * é”™è¯¯ç›‘æ§æ ¸å¿ƒæ¨¡å—
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. æ•è· Vue è¿è¡Œæ—¶é”™è¯¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchVueError</span>();
    <span class="hljs-comment">// 2. æ•è· JS å…¨å±€é”™è¯¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchJsError</span>();
    <span class="hljs-comment">// 3. æ•è·èµ„æºåŠ è½½é”™è¯¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchResourceError</span>();
    <span class="hljs-comment">// 4. æ•è· Promise æœªå¤„ç†é”™è¯¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchPromiseError</span>();
  },

  <span class="hljs-comment">// æ•è· Vue å†…éƒ¨é”™è¯¯</span>
  <span class="hljs-title function_">catchVueError</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">errorHandler</span> = <span class="hljs-function">(<span class="hljs-params">err, vm, info</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'vue-error'</span>,
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>,
        <span class="hljs-attr">stack</span>: err.<span class="hljs-property">stack</span>,
        <span class="hljs-attr">component</span>: vm.<span class="hljs-property">$options</span>.<span class="hljs-property">name</span> || <span class="hljs-string">'unknown'</span>,
        <span class="hljs-attr">info</span>: info, <span class="hljs-comment">// Vue é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ç”Ÿå‘½å‘¨æœŸé’©å­ï¼‰</span>
      });
    };
  },

  <span class="hljs-comment">// æ•è· JS å…¨å±€é”™è¯¯</span>
  <span class="hljs-title function_">catchJsError</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">message, source, line, column, error</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'js-error'</span>,
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        message,
        source, <span class="hljs-comment">// é”™è¯¯æ–‡ä»¶åœ°å€</span>
        line, <span class="hljs-comment">// è¡Œå·</span>
        column, <span class="hljs-comment">// åˆ—å·</span>
        <span class="hljs-attr">stack</span>: error?.<span class="hljs-property">stack</span> || <span class="hljs-string">''</span>,
      });
      <span class="hljs-comment">// é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œé¿å…æµè§ˆå™¨æ§åˆ¶å°é‡å¤è¾“å‡º</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    };
  },

  <span class="hljs-comment">// æ•è·èµ„æºåŠ è½½é”™è¯¯ï¼ˆå›¾ç‰‡/è„šæœ¬/æ ·å¼ï¼‰</span>
  <span class="hljs-title function_">catchResourceError</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span>;
      <span class="hljs-comment">// è¿‡æ»¤èµ„æºé”™è¯¯ï¼ˆéå…ƒç´ é”™è¯¯è·³è¿‡ï¼‰</span>
      <span class="hljs-keyword">if</span> (target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLImageElement</span> || target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLLinkElement</span> || target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLScriptElement</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'resource-error'</span>,
          <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
          <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
          <span class="hljs-attr">resourceType</span>: target.<span class="hljs-property">tagName</span>.<span class="hljs-title function_">toLowerCase</span>(),
          <span class="hljs-attr">resourceUrl</span>: target.<span class="hljs-property">src</span> || target.<span class="hljs-property">href</span>,
          <span class="hljs-attr">message</span>: <span class="hljs-string">`Resource load failed: <span class="hljs-subst">${target.src || target.href}</span>`</span>,
        });
      }
    }, <span class="hljs-literal">true</span>); <span class="hljs-comment">// æ•è·é˜¶æ®µè§¦å‘ï¼Œé¿å…å†’æ³¡ä¸¢å¤±</span>
  },

  <span class="hljs-comment">// æ•è· Promise æœªå¤„ç†é”™è¯¯</span>
  <span class="hljs-title function_">catchPromiseError</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'promise-error'</span>,
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">message</span>: e.<span class="hljs-property">reason</span>?.<span class="hljs-property">message</span> || <span class="hljs-string">'Promise rejection'</span>,
        <span class="hljs-attr">stack</span>: e.<span class="hljs-property">reason</span>?.<span class="hljs-property">stack</span> || <span class="hljs-string">''</span>,
      });
      <span class="hljs-comment">// é˜»æ­¢é»˜è®¤è¡Œä¸º</span>
      e.<span class="hljs-title function_">preventDefault</span>();
    });
  },

  <span class="hljs-comment">// å¤ç”¨æ€§èƒ½ç›‘æ§çš„ä¸ŠæŠ¥æ–¹æ³•ï¼ˆç»Ÿä¸€ä¸ŠæŠ¥å…¥å£ï¼‰</span>
  <span class="hljs-attr">report</span>: performanceMonitor.<span class="hljs-property">report</span>,
};
</code></pre>
<h4 data-id="heading-8">3. æŒ‚è½½åˆ°å…¥å£ï¼ˆ<code>main.js</code>ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> errorMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/errorMonitor'</span>;

<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  performanceMonitor.<span class="hljs-title function_">init</span>();
  errorMonitor.<span class="hljs-title function_">init</span>(); <span class="hljs-comment">// æ–°å¢é”™è¯¯ç›‘æ§</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9">å››ã€ç”¨æˆ·è¡Œä¸ºç›‘æ§ï¼ˆè¿˜åŸæ“ä½œè·¯å¾„ï¼Œå®šä½é—®é¢˜æ ¹å› ï¼‰</h3>
<h4 data-id="heading-10">1. æ ¸å¿ƒç›‘æ§è¡Œä¸º</h4>
<ul>
<li>é¡µé¢è·³è½¬ï¼ˆè·¯ç”±å˜åŒ–ï¼‰ï¼›</li>
<li>ç‚¹å‡»äº‹ä»¶ï¼ˆæŒ‰é’® / é“¾æ¥ï¼‰ï¼›</li>
<li>è¾“å…¥è¡Œä¸ºï¼ˆè¡¨å•ï¼‰ï¼›</li>
<li>æ¥å£è°ƒç”¨ï¼ˆå’Œé”™è¯¯ / æ€§èƒ½å…³è”ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-11">2. ä»£ç å®ç°ï¼ˆæ–°å»ºÂ <code>src/utils/behaviorMonitor.js</code>ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * ç”¨æˆ·è¡Œä¸ºç›‘æ§æ ¸å¿ƒæ¨¡å—
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. ç›‘æ§è·¯ç”±å˜åŒ–ï¼ˆVue Routerï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchRouterChange</span>();
    <span class="hljs-comment">// 2. å…¨å±€ç›‘å¬ç‚¹å‡»äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchClickEvent</span>();
    <span class="hljs-comment">// 3. ç›‘æ§è¡¨å•è¾“å…¥</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchFormInput</span>();
  },

  <span class="hljs-comment">// ç›‘æ§è·¯ç”±å˜åŒ–</span>
  <span class="hljs-title function_">catchRouterChange</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> router = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./router/index.js'</span>); <span class="hljs-comment">// å¼•å…¥è·¯ç”±å®ä¾‹</span>
    router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'router-change'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">from</span>: <span class="hljs-keyword">from</span>.<span class="hljs-property">fullPath</span>,
        <span class="hljs-attr">to</span>: to.<span class="hljs-property">fullPath</span>,
        <span class="hljs-attr">pageTitle</span>: to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span> || <span class="hljs-string">'unknown'</span>,
      });
    });
  },

  <span class="hljs-comment">// å…¨å±€ç›‘å¬ç‚¹å‡»äº‹ä»¶ï¼ˆè¿‡æ»¤éä¸šåŠ¡å…ƒç´ ï¼‰</span>
  <span class="hljs-title function_">catchClickEvent</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span>;
      <span class="hljs-comment">// åªç›‘æ§å¸¦ data-behavior æ ‡è®°çš„å…ƒç´ ï¼ˆé¿å…å…¨é‡é‡‡é›†ï¼‰</span>
      <span class="hljs-keyword">const</span> behaviorKey = target.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-behavior'</span>);
      <span class="hljs-keyword">if</span> (!behaviorKey) <span class="hljs-keyword">return</span>;

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'click'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        behaviorKey, <span class="hljs-comment">// è‡ªå®šä¹‰æ ‡è®°ï¼ˆå¦‚ "btn-submit-order"ï¼‰</span>
        <span class="hljs-attr">targetText</span>: target.<span class="hljs-property">innerText</span>.<span class="hljs-title function_">trim</span>(),
        <span class="hljs-attr">targetSelector</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSelector</span>(target), <span class="hljs-comment">// å…ƒç´ é€‰æ‹©å™¨</span>
      });
    }, <span class="hljs-literal">true</span>);
  },

  <span class="hljs-comment">// ç›‘æ§è¡¨å•è¾“å…¥ï¼ˆå¸¦ data-behavior çš„è¾“å…¥æ¡†ï¼‰</span>
  <span class="hljs-title function_">catchFormInput</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span>;
      <span class="hljs-keyword">const</span> behaviorKey = target.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-behavior'</span>);
      <span class="hljs-keyword">if</span> (!behaviorKey || ![<span class="hljs-string">'INPUT'</span>, <span class="hljs-string">'TEXTAREA'</span>].<span class="hljs-title function_">includes</span>(target.<span class="hljs-property">tagName</span>)) <span class="hljs-keyword">return</span>;

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'form-input'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        behaviorKey,
        <span class="hljs-attr">inputValue</span>: target.<span class="hljs-property">value</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>), <span class="hljs-comment">// åªé‡‡é›†å‰100å­—ç¬¦ï¼Œé¿å…æ•æ„Ÿä¿¡æ¯</span>
      });
    }, <span class="hljs-literal">true</span>);
  },

  <span class="hljs-comment">// è·å–å…ƒç´ å”¯ä¸€é€‰æ‹©å™¨ï¼ˆä¾¿äºå®šä½ï¼‰</span>
  <span class="hljs-title function_">getSelector</span>(<span class="hljs-params">el</span>) {
    <span class="hljs-keyword">if</span> (!el) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    <span class="hljs-keyword">let</span> selector = el.<span class="hljs-property">tagName</span>.<span class="hljs-title function_">toLowerCase</span>();
    <span class="hljs-keyword">if</span> (el.<span class="hljs-property">id</span>) selector += <span class="hljs-string">`#<span class="hljs-subst">${el.id}</span>`</span>;
    <span class="hljs-keyword">if</span> (el.<span class="hljs-property">className</span>) selector += <span class="hljs-string">`.<span class="hljs-subst">${el.className.replace(/\s+/g, <span class="hljs-string">'.'</span>)}</span>`</span>;
    <span class="hljs-keyword">return</span> selector;
  },

  <span class="hljs-comment">// å¤ç”¨ä¸ŠæŠ¥æ–¹æ³•</span>
  <span class="hljs-attr">report</span>: performanceMonitor.<span class="hljs-property">report</span>,
};
</code></pre>
<h4 data-id="heading-12">3. ä¸šåŠ¡ä¸­åŸ‹ç‚¹ä½¿ç”¨</h4>
<p>åœ¨éœ€è¦ç›‘æ§çš„å…ƒç´ ä¸Šæ·»åŠ Â <code>data-behavior</code>Â æ ‡è®°ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- æŒ‰é’®ç‚¹å‡»ç›‘æ§ --&gt;
  &lt;button data-behavior="btn-home-search" @click="search"&gt;æœç´¢&lt;/button&gt;
  
  &lt;!-- è¡¨å•è¾“å…¥ç›‘æ§ --&gt;
  &lt;input data-behavior="input-home-keyword" v-model="keyword" placeholder="è¯·è¾“å…¥å…³é”®è¯"&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-13">4. æŒ‚è½½åˆ°å…¥å£ï¼ˆ<code>main.js</code>ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> behaviorMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/behaviorMonitor'</span>;

<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  performanceMonitor.<span class="hljs-title function_">init</span>();
  errorMonitor.<span class="hljs-title function_">init</span>();
  behaviorMonitor.<span class="hljs-title function_">init</span>(); <span class="hljs-comment">// æ–°å¢è¡Œä¸ºç›‘æ§</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-14">äº”ã€è¿›é˜¶ä¼˜åŒ–ï¼ˆé¿å…ç›‘æ§æœ¬èº«å½±å“æ€§èƒ½ï¼‰</h3>
<h4 data-id="heading-15">1. ç™½åå• / é»‘åå•</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸ŠæŠ¥æ—¶è¿‡æ»¤æ— éœ€ç›‘æ§çš„é¡µé¢/æ¥å£</span>
<span class="hljs-title function_">report</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> blacklist = [<span class="hljs-string">'/login'</span>, <span class="hljs-string">'/test'</span>]; <span class="hljs-comment">// è¿‡æ»¤æµ‹è¯•/ç™»å½•é¡µ</span>
  <span class="hljs-keyword">if</span> (blacklist.<span class="hljs-title function_">includes</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>)) <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">// ... åŸæœ‰é€»è¾‘</span>
}
</code></pre>
<h4 data-id="heading-16">2. æ•æ„Ÿä¿¡æ¯è¿‡æ»¤</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸ŠæŠ¥å‰è¿‡æ»¤æ‰‹æœºå·/å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯</span>
<span class="hljs-title function_">filterSensitiveData</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">inputValue</span>) {
    data.<span class="hljs-property">inputValue</span> = data.<span class="hljs-property">inputValue</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/1[3-9]\d{9}/g</span>, <span class="hljs-string">'****'</span>); <span class="hljs-comment">// æ‰‹æœºå·è„±æ•</span>
  }
  <span class="hljs-keyword">return</span> data;
}
</code></pre>
<h4 data-id="heading-17">3. ç¦»çº¿ç¼“å­˜é‡è¯•</h4>
<p>ä¸ŠæŠ¥å¤±è´¥æ—¶ç¼“å­˜åˆ° localStorageï¼Œä¸‹æ¬¡é¡µé¢åŠ è½½æ—¶é‡è¯•ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœ¨ sendReport å¤±è´¥å</span>
<span class="hljs-keyword">const</span> failCache = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'monitorFailCache'</span>) || <span class="hljs-string">'[]'</span>);
failCache.<span class="hljs-title function_">push</span>(...cache);
<span class="hljs-comment">// é™åˆ¶ç¼“å­˜å¤§å°ï¼ˆæœ€å¤š 100 æ¡ï¼‰</span>
<span class="hljs-keyword">if</span> (failCache.<span class="hljs-property">length</span> &gt; <span class="hljs-number">100</span>) failCache.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, failCache.<span class="hljs-property">length</span> - <span class="hljs-number">100</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'monitorFailCache'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(failCache));

<span class="hljs-comment">// é¡µé¢åŠ è½½æ—¶é‡è¯•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> failCache = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'monitorFailCache'</span>) || <span class="hljs-string">'[]'</span>);
  <span class="hljs-keyword">if</span> (failCache.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/monitor/report'</span>, { <span class="hljs-attr">data</span>: failCache })
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'monitorFailCache'</span>));
  }
});
</code></pre>
<hr/>
<h3 data-id="heading-18">å…­ã€æ•°æ®å¯è§†åŒ–ä¸å‘Šè­¦ï¼ˆå¯é€‰æ–¹æ¡ˆï¼‰</h3>
<h4 data-id="heading-19">1. å¼€æºæ–¹æ¡ˆï¼ˆè‡ªå»ºï¼‰</h4>
<ul>
<li>æ•°æ®å­˜å‚¨ï¼šMySQL/ClickHouseï¼ˆé€‚åˆæµ·é‡æ•°æ®ï¼‰ï¼›</li>
<li>å¯è§†åŒ–ï¼šGrafana/ELKï¼ˆKibanaï¼‰ï¼›</li>
<li>å‘Šè­¦ï¼šPrometheus + AlertManagerï¼ˆè§¦å‘é˜ˆå€¼æ—¶é‚®ä»¶ / é’‰é’‰å‘Šè­¦ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-20">2. ç¬¬ä¸‰æ–¹å¹³å°ï¼ˆå¿«é€Ÿæ¥å…¥ï¼‰</h4>
<ul>
<li>é”™è¯¯ç›‘æ§ï¼šFundebugã€Sentryã€FrontJSï¼›</li>
<li>æ€§èƒ½ç›‘æ§ï¼šé˜¿é‡Œäº‘ ARMSã€ç™¾åº¦ç»Ÿè®¡ã€è…¾è®¯ç›‘æ§å®ï¼›</li>
<li>è¡Œä¸ºåˆ†æï¼šç™¾åº¦ç»Ÿè®¡ã€å‹ç›Ÿ +ã€GrowingIOã€‚</li>
</ul>
<h4 data-id="heading-21">3. æ ¸å¿ƒå‘Šè­¦é˜ˆå€¼å‚è€ƒ</h4>

























<table><thead><tr><th>æŒ‡æ ‡</th><th>å‘Šè­¦é˜ˆå€¼</th></tr></thead><tbody><tr><td>JS é”™è¯¯ç‡</td><td>&gt; 0.1%</td></tr><tr><td>æ¥å£å¤±è´¥ç‡</td><td>&gt; 1%</td></tr><tr><td>LCP</td><td>&gt; 4s</td></tr><tr><td>é¦–å±åŠ è½½æ—¶é—´</td><td>&gt; 5s</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-22">ä¸ƒã€æœ€ç»ˆé›†æˆï¼ˆmain.js å®Œæ•´ç¤ºä¾‹ï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> performanceMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/performanceMonitor'</span>;
<span class="hljs-keyword">import</span> errorMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/errorMonitor'</span>;
<span class="hljs-keyword">import</span> behaviorMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/behaviorMonitor'</span>;

<span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒå¼€å¯ç›‘æ§</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  <span class="hljs-comment">// å…¨å±€æŒ‚è½½ axiosï¼ˆä¾›ç›‘æ§æ¨¡å—ä½¿ç”¨ï¼‰</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">axios</span> = axios;
  <span class="hljs-comment">// åˆå§‹åŒ–ç›‘æ§</span>
  performanceMonitor.<span class="hljs-title function_">init</span>();
  errorMonitor.<span class="hljs-title function_">init</span>();
  behaviorMonitor.<span class="hljs-title function_">init</span>();
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  router,
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>)
});
</code></pre>
<p>è¿™å¥—æ–¹æ¡ˆè½»é‡åŒ–ã€å¯æ‰©å±•ï¼Œæ—¢å¯ä»¥å¯¹æ¥è‡ªå»ºåå°ï¼Œä¹Ÿèƒ½å¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬ä¸‰æ–¹ç›‘æ§å¹³å°ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯ï¼š</p>
<ol>
<li>æ— ä¾µå…¥ï¼šé€šè¿‡å…¨å±€æ··å…¥ã€äº‹ä»¶ç›‘å¬å®ç°ï¼Œä¸ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼›</li>
<li>é«˜æ€§èƒ½ï¼šæ‰¹é‡ + é˜²æŠ–ä¸ŠæŠ¥ï¼Œæœ¬åœ°ç¼“å­˜é‡è¯•ï¼Œä¸é˜»å¡ä¸»æµç¨‹ï¼›</li>
<li>å…¨è¦†ç›–ï¼šæ€§èƒ½ / é”™è¯¯ / è¡Œä¸ºç»´åº¦å®Œæ•´ï¼Œå¯è¿˜åŸé—®é¢˜ç°åœºã€‚</li>
</ol>
<h2 data-id="heading-23">Vue2ä¸­é¡¹ç›®å®æˆ˜é«˜é¢‘ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›</h2>
<p>åœ¨ Vue2 é¡¹ç›®å®æˆ˜ä¸­ï¼Œä»¥ä¸‹æ˜¯é«˜é¢‘ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼Œç»“åˆ Vue2 çš„ç‰¹æ€§ï¼ˆå¦‚é€‰é¡¹å¼ APIã€ç»„ä»¶åŒ–ã€å“åº”å¼ï¼‰ï¼Œå®ƒä»¬èƒ½æœ‰æ•ˆæå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ï¼š</p>
<h4 data-id="heading-24">1.Â <strong>å•ä¾‹æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šå…¨å±€å”¯ä¸€çš„å®ä¾‹ï¼ˆå¦‚ Vuex Storeã€å…¨å±€å¼¹çª—ã€è¯·æ±‚æ‹¦æˆªå™¨ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>Vuex çš„<code>store</code>æ˜¯å•ä¾‹ï¼Œå…¨å±€å…±äº«çŠ¶æ€ï¼›</li>
<li>å…¨å±€æç¤ºç»„ä»¶ï¼ˆå¦‚<code>Toast</code>ï¼‰ï¼Œé€šè¿‡<code>Vue.prototype.$toast = new Toast()</code>æŒ‚è½½ä¸ºå•ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»ºå®ä¾‹ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-25">2.Â <strong>å·¥å‚æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šæ‰¹é‡åˆ›å»ºç›¸ä¼¼çš„ç»„ä»¶ / å®ä¾‹ï¼Œé¿å…é‡å¤ä»£ç ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>è¡¨å•æ§ä»¶å·¥å‚ï¼šæ ¹æ®é…ç½®ï¼ˆå¦‚<code>{ type: 'input', label: 'å§“å' }</code>ï¼‰åŠ¨æ€ç”Ÿæˆ<code>Input</code>ã€<code>Select</code>ç­‰è¡¨å•ç»„ä»¶ï¼›</li>
<li>å¼¹çª—å·¥å‚ï¼šå°è£…<code>createModal</code>å‡½æ•°ï¼Œä¼ å…¥ç»„ä»¶å’Œå‚æ•°ï¼Œè‡ªåŠ¨åˆ›å»ºå¹¶æŒ‚è½½å¼¹çª—å®ä¾‹ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-26">3.Â <strong>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå‘å¸ƒ - è®¢é˜…æ¨¡å¼ï¼‰</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šVue2 çš„å“åº”å¼ç³»ç»Ÿæœ¬èº«åŸºäºè§‚å¯Ÿè€…æ¨¡å¼ï¼ˆ<code>data</code>æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œæ¨¡æ¿ / è®¡ç®—å±æ€§æ˜¯è§‚å¯Ÿè€…ï¼‰ï¼›æ­¤å¤–å¸¸ç”¨äºè·¨ç»„ä»¶é€šä¿¡ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>ç”¨<code>Vue.prototype.$bus = new Vue()</code>å®ç°å…¨å±€äº‹ä»¶æ€»çº¿ï¼ˆå‘å¸ƒ<code>this.$bus.$emit('event')</code>ï¼Œè®¢é˜…<code>this.$bus.$on('event', () =&gt; {})</code>ï¼‰ï¼›</li>
<li>è®¡ç®—å±æ€§ä¾èµ–<code>data</code>å˜åŒ–è‡ªåŠ¨æ›´æ–°ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-27">4.Â <strong>ä»£ç†æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šå¯¹å¤æ‚æ“ä½œè¿›è¡Œå°è£…ï¼Œå¯¹å¤–æš´éœ²ç®€åŒ–çš„æ¥å£ï¼ˆå¦‚<strong>è¯·æ±‚ä»£ç†ã€æƒé™ä»£ç†</strong>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li><strong>å°è£…<code>api.js</code></strong> ä½œä¸ºæ¥å£ä»£ç†ï¼Œç»Ÿä¸€å¤„ç†è¯·æ±‚çš„ URL æ‹¼æ¥ã€å‚æ•°æ ¼å¼åŒ–ã€é”™è¯¯æ‹¦æˆªï¼›</li>
<li><strong>æƒé™ä»£ç†ç»„ä»¶</strong>ï¼šå°è£…ä¸€ä¸ª<code>AuthButton</code>ç»„ä»¶ï¼Œæ ¹æ®ç”¨æˆ·æƒé™å†³å®šæŒ‰é’®æ˜¯å¦æ¸²æŸ“ / å¯ç”¨ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-28">5.Â <strong>è£…é¥°å™¨æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼š<strong>åœ¨ä¸ä¿®æ”¹åŸç»„ä»¶çš„å‰æä¸‹ï¼ŒåŠ¨æ€æ‰©å±•å…¶åŠŸèƒ½</strong>ï¼ˆVue2 ä¸­å¸¸ç”¨<code>mixin</code>æˆ–é«˜é˜¶ç»„ä»¶å®ç°ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>ç”¨<code>mixin</code>ç»™å¤šä¸ªç»„ä»¶æ·»åŠ  â€œåŠ è½½çŠ¶æ€ç®¡ç†â€ åŠŸèƒ½ï¼ˆå¦‚<code>loadingMixin</code>åŒ…å«<code>loading</code>æ•°æ®å’Œ<code>setLoading</code>æ–¹æ³•ï¼‰ï¼›</li>
<li><strong>é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰</strong>ï¼šå°è£…<code>withAuth</code>å‡½æ•°ï¼Œæ¥æ”¶ç»„ä»¶å¹¶è¿”å› â€œå¸¦æƒé™æ ¡éªŒâ€ çš„æ–°ç»„ä»¶ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-29">6.Â <strong>ç­–ç•¥æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼š<strong>å°†å¤šç§ â€œç®—æ³• / é€»è¾‘â€ å°è£…ä¸ºç‹¬ç«‹ç­–ç•¥</strong>ï¼Œæ ¹æ®æ¡ä»¶åŠ¨æ€åˆ‡æ¢ï¼ˆæ›¿ä»£å¤§é‡<code>if-else</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li><strong>è¡¨å•éªŒè¯ç­–ç•¥</strong>ï¼šå®šä¹‰<code>required</code>ã€<code>email</code>ã€<code>maxLength</code>ç­‰éªŒè¯ç­–ç•¥ï¼Œæ ¹æ®è¡¨å•é¡¹çš„<code>rules</code>åŠ¨æ€é€‰æ‹©ï¼›</li>
<li>æ”¯ä»˜æ–¹å¼ç­–ç•¥ï¼šå°è£…<code>Alipay</code>ã€<code>WechatPay</code>ç­‰æ”¯ä»˜ç­–ç•¥ï¼Œæ ¹æ®ç”¨æˆ·é€‰æ‹©åˆ‡æ¢æ”¯ä»˜é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™äº›æ¨¡å¼åœ¨ Vue2 é¡¹ç›®ä¸­å¹¶éå­¤ç«‹ä½¿ç”¨ï¼ˆä¾‹å¦‚ â€œç»„ä»¶åŒ– + ç­–ç•¥æ¨¡å¼â€ å®ç°åŠ¨æ€è¡¨å•ï¼‰ï¼Œç»“åˆ Vue2 çš„ç‰¹æ€§ï¼ˆå¦‚ mixinã€Vuexã€äº‹ä»¶æ€»çº¿ï¼‰èƒ½æ›´å¥½åœ°è½åœ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue æ•°ç»„å“åº”å¼åŸç†æ·±åº¦è§£æï¼šè¿™äº›æ–¹æ³•ä¸ºä½•èƒ½è¢«ç›‘å¬åˆ°ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582815307439472691</link>    <guid>https://juejin.cn/post/7582815307439472691</guid>    <pubDate>2025-12-13T01:45:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582815307439472691" data-draft-id="7582814236583690278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue æ•°ç»„å“åº”å¼åŸç†æ·±åº¦è§£æï¼šè¿™äº›æ–¹æ³•ä¸ºä½•èƒ½è¢«ç›‘å¬åˆ°ï¼Ÿ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-13T01:45:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue æ•°ç»„å“åº”å¼åŸç†æ·±åº¦è§£æï¼šè¿™äº›æ–¹æ³•ä¸ºä½•èƒ½è¢«ç›‘å¬åˆ°ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T01:45:11.000Z" title="Sat Dec 13 2025 01:45:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¼€ç¯‡ï¼šä¸ºä»€ä¹ˆæ™®é€šæ•°ç»„æ“ä½œæ— æ³•è¢«Vueç›‘å¬ï¼Ÿ</h2>
<p>åœ¨Vueå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„å›°æƒ‘ï¼šä¸ºä»€ä¹ˆç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼Œæˆ–è€…ä¿®æ”¹æ•°ç»„é•¿åº¦æ—¶ï¼Œè§†å›¾ä¸ä¼šæ›´æ–°ï¼Ÿ</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">//Â è¿™äº›æ“ä½œæ— æ³•è§¦å‘å“åº”å¼æ›´æ–°</span>
<span class="hljs-keyword">const</span>Â <span class="hljs-variable constant_">vmÂ </span>=Â <span class="hljs-keyword">new</span><span class="hljs-title function_ invoke__">Â Vue</span>({
<span class="hljs-attr">Â Â data</span>:Â {
<span class="hljs-attr">Â Â Â Â items</span>:Â [<span class="hljs-string">'a'</span>,Â <span class="hljs-string">'b'</span>,Â <span class="hljs-string">'c'</span>]
Â Â }
})

vm.items[<span class="hljs-number">1</span>]Â =Â <span class="hljs-string">'x'</span>Â Â <span class="hljs-comment">//Â âŒÂ è§†å›¾ä¸ä¼šæ›´æ–°</span>
vm.items.lengthÂ =Â <span class="hljs-number">1</span>Â <span class="hljs-comment">//Â âŒÂ è§†å›¾ä¸ä¼šæ›´æ–°</span>
</code></pre>
<p>è¿™æ˜¯å› ä¸ºVue 2.xä½¿ç”¨çš„æ˜¯<code>Object.defineProperty</code>è¿›è¡Œæ•°æ®åŠ«æŒï¼Œè€ŒJavaScriptçš„æ•°ç»„ç´¢å¼•å¹¶ä¸æ˜¯å¯¹è±¡çš„"å±æ€§"ï¼Œæ•°ç»„é•¿åº¦çš„å˜åŒ–ä¹Ÿæ— æ³•é€šè¿‡å±æ€§æ‹¦æˆªæ¥ç›‘å¬ã€‚</p>
<h2 data-id="heading-1">äºŒã€Vueèƒ½ç›‘å¬çš„æ•°ç»„æ–¹æ³•</h2>
<p>Vueé€šè¿‡é‡å†™æ•°ç»„çš„åŸå‹æ–¹æ³•ï¼Œå®ç°äº†å¯¹ä»¥ä¸‹7ç§æ•°ç»„å˜æ›´æ–¹æ³•çš„ç›‘å¬ï¼š</p>
<h3 data-id="heading-2">1. å˜æ›´æ–¹æ³•ï¼ˆä¼šè§¦å‘è§†å›¾æ›´æ–°ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â 1.Â push()Â -Â æœ«å°¾æ·»åŠ å…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.push</span>('d')Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 2.Â pop()Â -Â åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.pop</span>()Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 3.Â shift()Â -Â åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.shift</span>()Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 4.Â unshift()Â -Â å¼€å¤´æ·»åŠ å…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.unshift</span>('z')Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 5.Â splice()Â -Â åˆ é™¤/æ›¿æ¢/æ·»åŠ å…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.splice</span>(<span class="hljs-number">1</span>,Â <span class="hljs-number">1</span>,Â 'new')Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 6.Â sort()Â -Â æ’åº</span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.sort</span>()Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 7.Â reverse()Â -Â åè½¬</span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.reverse</span>()Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>
</code></pre>
<h3 data-id="heading-3">2. æ›¿æ¢æ–¹æ³•ï¼ˆéœ€é‡æ–°èµ‹å€¼ï¼‰</h3>
<p>å¯¹äºè¿”å›æ–°æ•°ç»„çš„æ–¹æ³•ï¼Œéœ€è¦é‡æ–°èµ‹å€¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â filter(),Â concat(),Â slice()Â ç­‰</span>
vm.<span class="hljs-property">items</span>Â =Â vm.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span>Â =&gt;</span>Â itemÂ !==Â <span class="hljs-string">'b'</span>)Â Â <span class="hljs-comment">//Â âœ…Â éœ€è¦é‡æ–°èµ‹å€¼</span>
</code></pre>
<h2 data-id="heading-4">ä¸‰ã€æºç è§£æï¼šVueå¦‚ä½•å®ç°æ•°ç»„å“åº”å¼</h2>
<h3 data-id="heading-5">1. æ ¸å¿ƒå®ç°åŸç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â ç®€åŒ–ç‰ˆçš„Vueæ•°ç»„å“åº”å¼å®ç°</span>
<span class="hljs-keyword">const</span>Â arrayProtoÂ =Â <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
<span class="hljs-keyword">const</span>Â arrayMethodsÂ =Â <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(arrayProto)

<span class="hljs-keyword">const</span>Â methodsToPatchÂ =Â [
Â Â <span class="hljs-string">'push'</span>,
Â Â <span class="hljs-string">'pop'</span>,
Â Â <span class="hljs-string">'shift'</span>,
Â Â <span class="hljs-string">'unshift'</span>,
Â Â <span class="hljs-string">'splice'</span>,
Â Â <span class="hljs-string">'sort'</span>,
Â Â <span class="hljs-string">'reverse'</span>
]

methodsToPatch.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>Â (<span class="hljs-params">method</span>)Â {
Â Â <span class="hljs-comment">//Â ç¼“å­˜åŸå§‹æ–¹æ³•</span>
Â Â <span class="hljs-keyword">const</span>Â originalÂ =Â arrayProto[method]
Â Â 
Â Â <span class="hljs-comment">//Â é‡å†™æ•°ç»„æ–¹æ³•</span>
Â Â <span class="hljs-title function_">def</span>(arrayMethods,Â method,Â <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">mutator</span>(<span class="hljs-params">...args</span>)Â {
Â Â Â Â <span class="hljs-comment">//Â 1.Â æ‰§è¡ŒåŸå§‹æ–¹æ³•</span>
Â Â Â Â <span class="hljs-keyword">const</span>Â resultÂ =Â original.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,Â args)
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â 2.Â è·å–æ•°ç»„çš„Observerå®ä¾‹</span>
Â Â Â Â <span class="hljs-keyword">const</span>Â obÂ =Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â 3.Â å¯¹æ–°å¢å…ƒç´ è¿›è¡Œå“åº”å¼å¤„ç†</span>
Â Â Â Â <span class="hljs-keyword">let</span>Â inserted
Â Â Â Â <span class="hljs-keyword">switch</span>Â (method)Â {
Â Â Â Â Â Â <span class="hljs-keyword">case</span>Â <span class="hljs-string">'push'</span>:
Â Â Â Â Â Â <span class="hljs-keyword">case</span>Â <span class="hljs-string">'unshift'</span>:
Â Â Â Â Â Â Â Â insertedÂ =Â args
Â Â Â Â Â Â Â Â <span class="hljs-keyword">break</span>
Â Â Â Â Â Â <span class="hljs-keyword">case</span>Â <span class="hljs-string">'splice'</span>:
Â Â Â Â Â Â Â Â insertedÂ =Â args.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>)
Â Â Â Â Â Â Â Â <span class="hljs-keyword">break</span>
Â Â Â Â }
Â Â Â Â <span class="hljs-keyword">if</span>Â (inserted)Â ob.<span class="hljs-title function_">observeArray</span>(inserted)
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â 4.Â é€šçŸ¥ä¾èµ–æ›´æ–°</span>
Â Â Â Â ob.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
Â Â Â Â 
Â Â Â Â <span class="hljs-keyword">return</span>Â result
Â Â })
})

<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">def</span>(<span class="hljs-params">obj,Â key,Â val,Â enumerable</span>)Â {
Â Â <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj,Â key,Â {
Â Â Â Â <span class="hljs-attr">value</span>:Â val,
Â Â Â Â <span class="hljs-attr">enumerable</span>:Â !!enumerable,
Â Â Â Â <span class="hljs-attr">writable</span>:Â <span class="hljs-literal">true</span>,
Â Â Â Â <span class="hljs-attr">configurable</span>:Â <span class="hljs-literal">true</span>
Â Â })
}
</code></pre>
<h3 data-id="heading-6">2. Observerç±»çš„å…³é”®ä»£ç </h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Observer</span>Â {
Â Â <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>Â =Â value
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Dep</span>()
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â ç»™æ•°ç»„æ·»åŠ __ob__å±æ€§ï¼ŒæŒ‡å‘Observerå®ä¾‹</span>
Â Â Â Â <span class="hljs-title function_">def</span>(value,Â <span class="hljs-string">'__ob__'</span>,Â <span class="hljs-variable language_">this</span>)
Â Â Â Â 
Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value))Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â é‡å†™æ•°ç»„çš„åŸå‹æ–¹æ³•</span>
Â Â Â Â Â Â value.<span class="hljs-property">__proto__</span>Â =Â arrayMethods
Â Â Â Â Â Â <span class="hljs-comment">//Â å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè§‚å¯Ÿ</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observeArray</span>(value)
Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(value)
Â Â Â Â }
Â Â }
Â Â 
Â Â <span class="hljs-title function_">observeArray</span>(<span class="hljs-params">items</span>)Â {
Â Â Â Â <span class="hljs-keyword">for</span>Â (<span class="hljs-keyword">let</span>Â iÂ =Â <span class="hljs-number">0</span>,Â lÂ =Â items.<span class="hljs-property">length</span>;Â iÂ &lt;Â l;Â i++)Â {
Â Â Â Â Â Â <span class="hljs-title function_">observe</span>(items[i])
Â Â Â Â }
Â Â }
}
</code></pre>
<h2 data-id="heading-7">å››ã€æµç¨‹å›¾è§£ï¼šæ•°ç»„å“åº”å¼çš„å·¥ä½œæµç¨‹</h2>
<pre><code class="hljs">æ˜¯

å¦

æ˜¯

å¦

åˆå§‹åŒ–å“åº”å¼æ•°ç»„åˆ›å»ºObserverå®ä¾‹æ˜¯å¦ä¸ºæ•°ç»„é‡å†™æ•°ç»„åŸå‹æ–¹æ³•éå†å¯¹è±¡å±æ€§æ‹¦æˆª7ä¸ªå˜æ›´æ–¹æ³•æ‰§è¡ŒåŸå§‹æ•°ç»„æ–¹æ³•æ˜¯å¦æœ‰æ–°å¢å…ƒç´ å¯¹æ–°å…ƒç´ è¿›è¡Œå“åº”å¼å¤„ç†è·³è¿‡é€šçŸ¥ä¾èµ–æ›´æ–°è§†å›¾æ›´æ–°
</code></pre>
<h2 data-id="heading-8">äº”ã€å®æˆ˜åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-9">åœºæ™¯1ï¼šåŠ¨æ€åˆ—è¡¨æ“ä½œ</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">li</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item,Â index)Â inÂ list"</span>Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
Â Â Â Â Â Â Â Â {{Â item.nameÂ }}
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"removeItem(index)"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"addItem"</span>&gt;</span>æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"sortList"</span>&gt;</span>æ’åº<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">list</span>:Â [
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">1</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'ItemÂ 1'</span>Â },
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">2</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'é¡¹ç›®Â 2'</span>Â },
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">3</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'ã‚¢ã‚¤ãƒ†ãƒ Â 3'</span>Â }
Â Â Â Â Â Â ],
Â Â Â Â Â Â <span class="hljs-attr">nextId</span>:Â <span class="hljs-number">4</span>
Â Â Â Â }
Â Â },
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-title function_">addItem</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä½¿ç”¨pushæ–¹æ³•ï¼ŒVueèƒ½ç›‘å¬åˆ°</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">push</span>({
Â Â Â Â Â Â Â Â <span class="hljs-attr">id</span>:Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">nextId</span>++,
Â Â Â Â Â Â Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">`æ–°é¡¹ç›®Â <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.nextId}</span>`</span>
Â Â Â Â Â Â })
Â Â Â Â },
Â Â Â Â <span class="hljs-title function_">removeItem</span>(<span class="hljs-params">index</span>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä½¿ç”¨spliceæ–¹æ³•ï¼ŒVueèƒ½ç›‘å¬åˆ°</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">splice</span>(index,Â <span class="hljs-number">1</span>)
Â Â Â Â },
Â Â Â Â <span class="hljs-title function_">sortList</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä½¿ç”¨sortæ–¹æ³•ï¼ŒVueèƒ½ç›‘å¬åˆ°</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a,Â b</span>)Â =&gt;</span>Â a.<span class="hljs-property">name</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">name</span>))
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œä¼˜åŒ–</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â æ‰¹é‡æ·»åŠ å…ƒç´ çš„é«˜æ•ˆå†™æ³•</span>
addMultipleItems()Â {
Â Â <span class="hljs-comment">//Â æ–¹æ³•1ï¼šä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼ˆéœ€è¦é‡æ–°èµ‹å€¼ï¼‰</span>
Â Â <span class="hljs-keyword">this</span>.listÂ =Â [...<span class="hljs-keyword">this</span>.list,Â ...newItems]
Â Â 
Â Â <span class="hljs-comment">//Â æ–¹æ³•2ï¼šä½¿ç”¨pushÂ +Â æ‰©å±•è¿ç®—ç¬¦</span>
Â Â <span class="hljs-keyword">this</span>.list.push(...newItems)
Â Â 
Â Â <span class="hljs-comment">//Â æ–¹æ³•3ï¼šä½¿ç”¨splice</span>
Â Â <span class="hljs-keyword">this</span>.list.splice(<span class="hljs-keyword">this</span>.list.length,Â <span class="hljs-number">0</span>,Â ...newItems)
}
</code></pre>
<h2 data-id="heading-11">å…­ã€Vue 3çš„æ”¹è¿›ï¼šProxyå®ç°</h2>
<p>åœ¨Vue 3ä¸­ï¼Œä½¿ç”¨Proxyæ›¿ä»£äº†Object.definePropertyï¼Œå¤©ç„¶æ”¯æŒæ•°ç»„ç´¢å¼•çš„ç›‘å¬ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â VueÂ 3ä¸­ä½¿ç”¨Proxyï¼Œå¯ä»¥ç›‘å¬æ•°ç»„ç´¢å¼•æ“ä½œ</span>
<span class="hljs-type">const</span>Â reactiveArrayÂ =Â <span class="hljs-built_in">reactive</span>([<span class="hljs-string">'a'</span>,Â <span class="hljs-string">'b'</span>,Â <span class="hljs-string">'c'</span>])

<span class="hljs-comment">//Â âœ…Â è¿™äº›æ“ä½œåœ¨VueÂ 3ä¸­éƒ½èƒ½è¢«ç›‘å¬</span>
reactiveArray[<span class="hljs-number">1</span>]Â =Â <span class="hljs-string">'x'</span>Â Â <span class="hljs-comment">//Â ç›´æ¥ä¿®æ”¹ç´¢å¼•</span>
reactiveArray.lengthÂ =Â <span class="hljs-number">1</span>Â Â <span class="hljs-comment">//Â ä¿®æ”¹é•¿åº¦</span>
</code></pre>
<h2 data-id="heading-12">ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-13">é—®é¢˜1ï¼šå¦‚ä½•ç›‘å¬æ•°ç»„é•¿åº¦å˜åŒ–ï¼Ÿ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â ä½¿ç”¨è®¡ç®—å±æ€§ç›‘å¬æ•°ç»„é•¿åº¦</span>
computed:Â {
Â Â listLength()Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">this</span>.items.length
Â Â }
}

<span class="hljs-comment">//Â æˆ–è€…ä½¿ç”¨$setå¼ºåˆ¶æ›´æ–°</span>
<span class="hljs-keyword">this</span>.$<span class="hljs-keyword">set</span>(<span class="hljs-keyword">this</span>.items,Â <span class="hljs-string">'length'</span>,Â newLength)
</code></pre>
<h3 data-id="heading-14">é—®é¢˜2ï¼šå¦‚ä½•å¤„ç†åµŒå¥—æ•°ç»„ï¼Ÿ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â åµŒå¥—æ•°ç»„ä¹Ÿéœ€è¦ä½¿ç”¨å“åº”å¼æ–¹æ³•</span>
<span class="hljs-keyword">data</span>()Â {
Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â nestedArray:Â [
Â Â Â Â Â Â {Â items:Â [<span class="hljs-string">'a'</span>,Â <span class="hljs-string">'b'</span>]Â },
Â Â Â Â Â Â {Â items:Â [<span class="hljs-string">'c'</span>,Â <span class="hljs-string">'d'</span>]Â }
Â Â Â Â ]
Â Â }
},
methods:Â {
Â Â updateNestedArray()Â {
Â Â Â Â <span class="hljs-comment">//Â æ­£ç¡®åšæ³•ï¼šä½¿ç”¨Vue.setæˆ–æ•°ç»„æ–¹æ³•</span>
Â Â Â Â <span class="hljs-keyword">this</span>.$<span class="hljs-keyword">set</span>(<span class="hljs-keyword">this</span>.nestedArray[<span class="hljs-number">0</span>].items,Â <span class="hljs-number">1</span>,Â <span class="hljs-string">'new'</span>)
Â Â Â Â <span class="hljs-comment">//Â æˆ–è€…</span>
Â Â Â Â <span class="hljs-keyword">this</span>.nestedArray[<span class="hljs-number">0</span>].items.splice(<span class="hljs-number">1</span>,Â <span class="hljs-number">1</span>,Â <span class="hljs-string">'new'</span>)
Â Â }
}
</code></pre>
<h3 data-id="heading-15">é—®é¢˜3ï¼šæ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â 1.Â é¿å…åœ¨æ¨¡æ¿ä¸­ç›´æ¥æ“ä½œæ•°ç»„</span>
<span class="hljs-comment">//Â âŒÂ ä¸æ¨è</span>
&lt;divÂ v-<span class="hljs-keyword">for</span>=<span class="hljs-string">"itemÂ inÂ list.reverse()"</span>&gt;

<span class="hljs-comment">//Â âœ…Â æ¨è</span>
&lt;divÂ v-<span class="hljs-keyword">for</span>=<span class="hljs-string">"itemÂ inÂ reversedList"</span>&gt;
computed:Â {
Â Â reversedList()Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â [...<span class="hljs-keyword">this</span>.list].reverse()
Â Â }
}

<span class="hljs-comment">//Â 2.Â å¤§æ•°æ®é‡ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨</span>
</code></pre>
<h2 data-id="heading-16">å…«ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<ol>
<li>1.Â <strong>å§‹ç»ˆä½¿ç”¨Vueæä¾›çš„æ•°ç»„æ–¹æ³•</strong>è¿›è¡Œæ•°ç»„å˜æ›´æ“ä½œ</li>
<li>2.Â <strong>å¯¹äºè¿”å›æ–°æ•°ç»„çš„æ–¹æ³•</strong>ï¼Œè®°å¾—é‡æ–°èµ‹å€¼</li>
<li>3.Â <strong>ä½¿ç”¨Vue.set/$set</strong>å¤„ç†æ— æ³•ç›‘å¬çš„æƒ…å†µ</li>
<li>4.Â <strong>åœ¨Vue 2ä¸­</strong>ï¼Œé¿å…ç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹æ•°ç»„</li>
<li>5.Â <strong>å‡çº§åˆ°Vue 3</strong>å¯ä»¥è·å¾—æ›´å¥½çš„æ•°ç»„å“åº”å¼æ”¯æŒ</li>
</ol>
<p>ç†è§£Vueæ•°ç»„å“åº”å¼çš„å®ç°åŸç†ï¼Œä¸ä»…èƒ½å¸®åŠ©æˆ‘ä»¬é¿å…å¸¸è§çš„å‘ï¼Œè¿˜èƒ½å†™å‡ºæ›´é«˜æ•ˆã€æ›´å¯é çš„Vueåº”ç”¨ã€‚è®°ä½è¿™äº›èƒ½è§¦å‘å“åº”å¼æ›´æ–°çš„æ•°ç»„æ–¹æ³•ï¼Œè®©ä½ çš„Vueå¼€å‘æ›´åŠ å¾—å¿ƒåº”æ‰‹ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å·æ¨¡å‹äº†ï¼ä¸Šä¸‹æ–‡å·¥ç¨‹æ‰æ˜¯å¤§æ¨¡å‹åº”ç”¨çš„ç‹é“ï¼]]></title>    <link>https://juejin.cn/post/7582857981894131753</link>    <guid>https://juejin.cn/post/7582857981894131753</guid>    <pubDate>2025-12-13T07:10:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582857981894131753" data-draft-id="7582787460419502122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å·æ¨¡å‹äº†ï¼ä¸Šä¸‹æ–‡å·¥ç¨‹æ‰æ˜¯å¤§æ¨¡å‹åº”ç”¨çš„ç‹é“ï¼"/> <meta itemprop="keywords" content="é¢è¯•,Java,åç«¯"/> <meta itemprop="datePublished" content="2025-12-13T07:10:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜é£é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/1665088861772688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å·æ¨¡å‹äº†ï¼ä¸Šä¸‹æ–‡å·¥ç¨‹æ‰æ˜¯å¤§æ¨¡å‹åº”ç”¨çš„ç‹é“ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1665088861772688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜é£é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:10:25.000Z" title="Sat Dec 13 2025 07:10:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>ç°åœ¨å·²ç»æ˜¯AIæ—¶ä»£äº†ï¼Œæˆ‘ä¹‹å‰å­¦è¿‡ä¸€äº›AIçš„ä¸œè¥¿ï¼Œæ‰€ä»¥åç»­å¼€å§‹åˆ†äº«ä¸€äº›AIç›¸å…³çš„å†…å®¹äº†ã€‚</p>
<blockquote>
<p>å¦‚AIå·¥å…·ï¼ŒAIç§‘æ™®ï¼ŒAIæœ€æ–°æŠ€æœ¯ç­‰ç­‰ï¼Œå¤§å®¶ä¸€èµ·æ‹¥æŠ±AIï¼Œå­¦ä¹ AIï¼Œåˆ©ç”¨AIã€‚</p>
</blockquote>
<p><strong>æ–‡ç« å†…å®¹æ”¶å½•åˆ°ä¸ªäººç½‘ç«™ï¼Œæ–¹ä¾¿é˜…è¯»</strong>ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fhardyfish.top%2F" target="_blank" title="http://hardyfish.top/" ref="nofollow noopener noreferrer">hardyfish.top/</a></p>
<p>å¯¹äºå¤§å¤šæ•°äººæ¥è¯´ï¼Œå¤„ç†å¤§é‡çš„æç¤ºè¯éå¸¸ä»¤äººå¤´ç–¼ï¼Œå‡ ä¹æ²¡äººæ„¿æ„èŠ±è´¹å¤§é‡çš„æ—¶é—´å»ç²¾å¿ƒè®¾è®¡è¿™äº›è¯ã€‚</p>
<blockquote>
<p>ç”¨æˆ·æ›´å€¾å‘äºç”¨ä¸€å¥è¯ã€ä¸€ä¸ªç®€å•æŒ‡ä»¤ï¼Œæ¥è¡¨è¾¾éœ€æ±‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸Šä¸‹æ–‡å·¥ç¨‹åšçš„äº‹æƒ…å°±æ˜¯åŸºäºç”¨æˆ·çš„<strong>ä¸Šä¸‹æ–‡</strong>æ¥è¡¥å……ä¿¡æ¯ã€‚</p>
</blockquote>
<p>ä½†è¿™é‡Œçš„ä¸Šä¸‹æ–‡ä¸å¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡ç»´åº¦æœ‰æ‰€ä¸åŒï¼š</p>
<blockquote>
<p>å¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡é€šå¸¸æ˜¯åŸºäºå•æ¬¡è¾“å…¥çš„ä¸Šä¸‹æ–‡ï¼Œè€Œ<strong>è¿™é‡Œæ‰€æŒ‡çš„ä¸Šä¸‹æ–‡åˆ™æ˜¯ç”¨æˆ·çš„å…¨éƒ¨å†å²æ•°æ®</strong>ã€‚</p>
<ul>
<li>ç”šè‡³å¯èƒ½è¿½æº¯åˆ°ç”¨æˆ·æœ€åˆä½¿ç”¨å¹³å°æ—¶çš„æ•°æ®ã€‚</li>
</ul>
<p>åœ¨ä¸Šä¸‹æ–‡çš„å¤„ç†ä¸Šï¼Œé€šå¸¸é‡‡ç”¨çš„æ–¹å¼å¤§ä½“ç›¸ä¼¼ï¼ŒåŒ…æ‹¬æ£€ç´¢å¬å›ã€çŸ¥è¯†åº“ã€å‘é‡åº“ã€çŸ¥è¯†å›¾è°±ç­‰ã€‚</p>
<ul>
<li>ä½†å…³é”®é—®é¢˜åœ¨äºå¦‚ä½•é«˜æ•ˆåœ°åˆ©ç”¨å’Œæ•´åˆè¿™äº›æ•°æ®ã€‚</li>
</ul>
</blockquote>
<p><strong>é‚£ç°åœ¨åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„èŠå¤©åº”ç”¨ä¸­çš„ä¸Šä¸‹æ–‡æ˜¯æ€ä¹ˆå¤„ç†çš„?</strong></p>
<blockquote>
<p>å¤§æ¨¡å‹ä½œä¸ºçº¯ç²¹çš„æ¨ç†å¼•æ“ï¼Œä¸è®°ä½ä»»ä½•å†å²ä¿¡æ¯ã€‚</p>
<ul>
<li>åº”ç”¨å±‚è´Ÿè´£ç»´æŠ¤å®Œæ•´çš„å¯¹è¯å†å²ã€‚</li>
</ul>
<p>æ¯æ¬¡å‘æ¨¡å‹å‘èµ·è¯·æ±‚æ—¶ï¼Œéƒ½éœ€è¦æºå¸¦å®Œæ•´çš„ä¸Šä¸‹æ–‡ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fcc53a841dd4152b877da0c820cb37b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6aOe6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214624&amp;x-signature=uCoSG5W78WirR0DkH0QmpSETzhQ%3D" alt="" loading="lazy"/></p>
<p>ä½†å½“åº”ç”¨åœºæ™¯æ˜¯ Agentic AI æ—¶ï¼Œä¸Šä¸‹æ–‡ç®¡ç†çš„å¤æ‚åº¦ä¼šå¾ˆé«˜ã€‚</p>
<blockquote>
<p>Agentic AI å…·å¤‡ä»»åŠ¡åˆ†è§£ã€å¤šæ­¥éª¤æ‰§è¡Œã€è‡ªä¸»æ€è€ƒå’Œå·¥å…·è°ƒç”¨ç­‰é«˜çº§èƒ½åŠ›ã€‚</p>
<p>è¿™äº›èƒ½åŠ›çš„å®ç°éƒ½ä¾èµ–äºæ›´åŠ ä¸°å¯Œå’Œå¤æ‚çš„ä¸Šä¸‹æ–‡ç»“æ„ã€‚</p>
</blockquote>
<p><strong>æ¯”å¦‚å•Agentåœºæ™¯</strong></p>
<blockquote>
<p>å‡è®¾ä¸€ä¸ªä»»åŠ¡è¢« Agent åˆ†è§£æˆäº† 10 ä¸ªå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡éœ€è¦è°ƒç”¨ä¸¤æ¬¡å·¥å…·æ‰èƒ½å®Œæˆã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªå¤§ä»»åŠ¡æ€»å…±ä¼šäº§ç”Ÿ 41 æ¡æ–°å¢çš„ä¸Šä¸‹æ–‡è®°å½•ï¼š</p>
<ul>
<li>1 æ¡åˆå§‹çš„ä»»åŠ¡åˆ†è§£æ€è€ƒï¼ŒåŠ ä¸Š 10 ä¸ªå­ä»»åŠ¡å„è‡ªäº§ç”Ÿçš„ 4 æ¡è®°å½•ï¼ˆ1 æ¬¡å·¥å…·è°ƒç”¨è¯·æ±‚ + 1 æ¬¡å·¥å…·è°ƒç”¨è¿”å›ï¼Œé‡å¤ä¸¤æ¬¡ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>é‚£ç›®å‰ä¸šç•Œæ˜¯å¦‚ä½•åœ¨ Agent åº”ç”¨ä¸Šç®¡ç†ä¸Šä¸‹æ–‡çš„å‘¢ï¼Ÿ</p>
<blockquote>
<p>ä¸Šä¸‹æ–‡ä¼˜åŒ–å™¨ä¼šæ ¹æ®å½“å‰ç”¨æˆ·è¾“å…¥ã€ä»»åŠ¡ç›®æ ‡å’Œæ¨¡å‹çŠ¶æ€å†³å®šæ˜¯å¦è¿›è¡Œå‹ç¼©ã€‚</p>
<p>è¿˜æœ‰é‡‡ç”¨ä½•ç§å‹ç¼©ç­–ç•¥ã€ä¸¢å¼ƒå“ªäº›å†…å®¹ã€å­˜å‚¨ä¸ºè®°å¿†ï¼Œä»¥åŠä½•æ—¶è¿›è¡Œè®°å¿†å›å¡«ç­‰æ“ä½œã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b858d928c1384112b1b5ae6aa7329c00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6aOe6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214624&amp;x-signature=7bt4ZmYGww3iMP1%2BOLla8h3MFX4%3D" alt="" loading="lazy"/></p>
<p><strong>Context Engineeringçš„å…·ä½“å®ç°æ–¹æ³•ï¼ˆå‚è€ƒLangChainï¼‰</strong></p>
<p>ä¿å­˜Contextï¼š</p>
<blockquote>
<p>å°†Contextç­›é€‰æ€»ç»“åä¿å­˜åˆ°å†…å­˜ã€ç¡¬ç›˜ç­‰åœ°æ–¹ï¼Œåœ¨æ¨¡å‹éœ€è¦æ—¶å†å‘é€ç»™å®ƒã€‚</p>
<p>å¦‚ChatGPTçš„è®°å¿†åŠŸèƒ½ï¼Œå¯å°†ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯å­˜å…¥è®°å¿†åº“ã€‚</p>
</blockquote>
<p>é€‰æ‹©Contextï¼š</p>
<blockquote>
<p>é™æ€é€‰æ‹©ï¼šæŠŠæ°¸è¿œé‡è¦ã€å¿…é¡»éµå®ˆçš„ä¿¡æ¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½æ”¾å…¥Contextã€‚</p>
<ul>
<li>å¦‚Cursorçš„Rulesæ–‡ä»¶ã€Claude Codeçš„Claude.mdæ–‡ä»¶ï¼Œç¡®ä¿AIè¡Œä¸ºç¬¦åˆé¢„æœŸã€‚</li>
</ul>
<p>åŠ¨æ€é€‰æ‹©ï¼šé€‰æ‹©ä¸ç”¨æˆ·é—®é¢˜æœ€ç›¸å…³çš„å†…å®¹æ”¾å…¥Contextã€‚</p>
<p>å¦‚ChatGPTä»è®°å¿†åº“ä¸­æŒ‘é€‰ç›¸å…³è®°å¿†ï¼Œä»ä¼—å¤šå·¥å…·ä¸­æŒ‘é€‰ç›¸å…³å·¥å…·ã€‚</p>
<ul>
<li>å…¶ä¸­æœ€æœ‰åçš„å®ç°æ–¹å¼æ˜¯Ragã€‚</li>
</ul>
</blockquote>
<p>å‹ç¼©Contextï¼š</p>
<blockquote>
<p>Agentè¿è¡Œæ—¶ï¼ŒContexté‡Œä¼šç§¯ç´¯å¤§é‡å†å²æ¶ˆæ¯ï¼Œæœ€å ç©ºé—´çš„æ˜¯æ¨¡å‹è¾“å‡ºã€æ–‡æœ¬å’Œå·¥å…·æ‰§è¡Œç»“æœã€‚</p>
<p>Claude Codeåœ¨ä½¿ç”¨é‡è¶…è¿‡95%æ—¶ï¼Œä¼šè¿è¡ŒAutocomPactç¨‹åºå¯¹Contextè¿›è¡Œå‹ç¼©ã€‚</p>
</blockquote>
<p>éš”ç¦»Contextï¼š</p>
<blockquote>
<p>ä¸åŒæ¨¡å—çš„Contextäº’ç›¸éš”ç¦»ã€‚</p>
<p>Lead Agentè´Ÿè´£ä»»åŠ¡ä¸‹å‘å’Œå½’çº³æ€»ç»“ï¼ŒSub Agentæœ‰ç‹¬ç«‹çš„å·¥å…·ã€è¿è¡Œå†å²å’Œè®°å¿†ä½“ç³»ï¼ŒContextäº’ä¸å½±å“ã€‚</p>
<p>Claude Codeä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„SubAgentæ¦‚å¿µã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…³äºAndroid Composeæ¶æ„çš„æ€è€ƒ]]></title>    <link>https://juejin.cn/post/7582857981894148137</link>    <guid>https://juejin.cn/post/7582857981894148137</guid>    <pubDate>2025-12-13T07:11:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582857981894148137" data-draft-id="7582787460419420202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…³äºAndroid Composeæ¶æ„çš„æ€è€ƒ"/> <meta itemprop="keywords" content="Android,å‰ç«¯,MVVM"/> <meta itemprop="datePublished" content="2025-12-13T07:11:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°è™ç‰™007"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036155640"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…³äºAndroid Composeæ¶æ„çš„æ€è€ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036155640/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°è™ç‰™007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:11:36.000Z" title="Sat Dec 13 2025 07:11:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Compose æœ¬èº«æ˜¯<strong>å£°æ˜å¼ UI æ¡†æ¶</strong>ï¼Œå¤©ç„¶é€‚é…ã€Œå“åº”å¼æ¶æ„ã€ï¼Œä¼ ç»Ÿçš„ MVC/MVP å› ã€Œå‘½ä»¤å¼æ€ç»´ã€ï¼ˆæ‰‹åŠ¨æ›´æ–° UIï¼‰å·²ä¸å†é€‚é…ï¼Œä¸»æµæ¶æ„æ˜¯ <strong>MVVMï¼ˆæœ€è´´åˆï¼‰</strong>ï¼Œè¿›é˜¶åœºæ™¯ä¼šç»“åˆã€Œå•å‘æ•°æ®æµï¼ˆUDFï¼‰ã€ã€ŒClean Architectureï¼ˆæ•´æ´æ¶æ„ï¼‰ã€è®¾è®¡ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯è®©<strong>æ•°æ®çŠ¶æ€å•å‘æµè½¬</strong>ï¼Œé¿å… UI ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆã€‚</p>
<h3 data-id="heading-0">ä¸€ã€å…ˆæ˜ç¡®ï¼šCompose ä¸ºä»€ä¹ˆâ€œæŠ›å¼ƒâ€MVC/MVPï¼Ÿ</h3>





















<table><thead><tr><th>æ¶æ„</th><th>æ ¸å¿ƒé—®é¢˜ï¼ˆé€‚é… Compose æ—¶ï¼‰</th></tr></thead><tbody><tr><td>MVC</td><td>Controller ç›´æ¥æ“ä½œ UIï¼ˆCompose ä¸­ UI ç”±çŠ¶æ€é©±åŠ¨ï¼Œæ— â€œ findViewById + æ›´æ–°â€çš„æ“ä½œå…¥å£ï¼‰ï¼Œæ˜“å¯¼è‡´çŠ¶æ€æ··ä¹±</td></tr><tr><td>MVP</td><td>Presenter æŒæœ‰ View æ¥å£ï¼Œé€šè¿‡æ¥å£å›è°ƒæ›´æ–° UIï¼ˆCompose ä¸­æ— â€œView æ¥å£â€ï¼Œå›è°ƒä¼šç ´åå£°æ˜å¼æ€æƒ³ï¼Œå¢åŠ æ¨¡æ¿ä»£ç ï¼‰</td></tr><tr><td>MVVM</td><td>ViewModel æŒæœ‰å¯è§‚å¯ŸçŠ¶æ€ï¼ŒUI ä»…è®¢é˜…çŠ¶æ€ï¼ˆå®Œå…¨è´´åˆ Compose â€œçŠ¶æ€é©±åŠ¨ UIâ€çš„æ ¸å¿ƒï¼Œæ— æ‰‹åŠ¨æ›´æ–°é€»è¾‘ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-1">äºŒã€Compose ä¸»æµæ¶æ„ï¼šMVVM + å•å‘æ•°æ®æµï¼ˆUDFï¼‰</h3>
<p>è¿™æ˜¯ Google å®˜æ–¹æ¨èçš„æ¶æ„ï¼Œæ ¸å¿ƒæ˜¯ã€ŒçŠ¶æ€ä¸Šç§»ã€å•å‘æµè½¬ã€ï¼Œåˆ†ä¸º 4 å±‚ï¼ŒèŒè´£æ¸…æ™°ä¸”é€‚é… Compose çš„é‡ç»„ç‰¹æ€§ï¼š</p>
<h4 data-id="heading-2">1. æ¶æ„åˆ†å±‚ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">UI</span> å±‚ï¼ˆ<span class="hljs-type">Composable</span> å‡½æ•°ï¼‰ <span class="hljs-operator">â”‚</span> ä»…è®¢é˜…çŠ¶æ€<span class="hljs-operator">ã€</span>è§¦å‘äº‹ä»¶ï¼Œæ— ä¸šåŠ¡é€»è¾‘
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
              <span class="hljs-operator">â”‚</span> å‘é€äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»ï¼‰<span class="hljs-operator">/</span> æ¥æ”¶çŠ¶æ€æ›´æ–°
<span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">ViewModel</span> å±‚ï¼ˆçŠ¶æ€æŒæœ‰ï¼‰ <span class="hljs-operator">â”‚</span> å¤„ç†<span class="hljs-type">UIäº‹ä»¶</span><span class="hljs-operator">ã€</span>ç®¡ç†çŠ¶æ€<span class="hljs-operator">ã€</span>è°ƒç”¨ä»“åº“å±‚ï¼Œä¸æŒæœ‰<span class="hljs-type">UIå¼•ç”¨</span>
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
              <span class="hljs-operator">â”‚</span> è°ƒç”¨æ¥å£<span class="hljs-operator">/</span>æœ¬åœ°æ•°æ®
<span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Repository</span> å±‚ï¼ˆæ•°æ®ä»“åº“ï¼‰<span class="hljs-operator">â”‚</span> ç»Ÿä¸€ç®¡ç†æ•°æ®æ¥æºï¼ˆç½‘ç»œ<span class="hljs-operator">/</span>æœ¬åœ°<span class="hljs-type">DB</span><span class="hljs-operator">/</span><span class="hljs-type">SharedPrefï¼‰ï¼Œè§£è€¦æ•°æ®é€»è¾‘</span>
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
              <span class="hljs-operator">â”‚</span> æ•°æ®è¯·æ±‚<span class="hljs-operator">/</span>å­˜å‚¨
<span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Data</span> å±‚ï¼ˆæ•°æ®æºï¼‰<span class="hljs-operator">â”‚</span> ç½‘ç»œæ¥å£ï¼ˆ<span class="hljs-type">Retrofitï¼‰</span><span class="hljs-operator">ã€</span>æœ¬åœ°<span class="hljs-type">DBï¼ˆRoomï¼‰</span><span class="hljs-operator">ã€</span><span class="hljs-type">SPç­‰</span>
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<h4 data-id="heading-3">2. æ ¸å¿ƒåŸåˆ™ï¼šå•å‘æ•°æ®æµï¼ˆUDFï¼‰</h4>
<p>æ•°æ®åªèƒ½æ²¿ã€ŒData â†’ Repository â†’ ViewModel â†’ UIã€æ–¹å‘æµè½¬ï¼Œåå‘ä»…é€šè¿‡ã€Œäº‹ä»¶ã€è§¦å‘ï¼Œé¿å…çŠ¶æ€æ··ä¹±ï¼š</p>
<pre><code class="hljs">UI è§¦å‘äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ï¼‰â†’ ViewModel å¤„ç†äº‹ä»¶ â†’ è°ƒç”¨ Repository è·å–æ•°æ® â†’ ViewModel æ›´æ–°çŠ¶æ€ â†’ UI è‡ªåŠ¨é‡ç»„ 
</code></pre>
<h3 data-id="heading-4">ä¸‰ã€å®Œæ•´ç¤ºä¾‹ï¼šMVVM + å•å‘æ•°æ®æµ</h3>
<p>ä»¥â€œç™»å½•é¡µâ€ä¸ºä¾‹ï¼Œè¦†ç›–çŠ¶æ€ç®¡ç†ã€äº‹ä»¶å¤„ç†ã€æ•°æ®è¯·æ±‚å…¨æµç¨‹ï¼š</p>
<h4 data-id="heading-5">Step 1ï¼šData å±‚ï¼ˆç½‘ç»œè¯·æ±‚ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. æ•°æ®æ¨¡å‹</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginRequest</span>(<span class="hljs-keyword">val</span> username: String, <span class="hljs-keyword">val</span> password: String)
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginResponse</span>(<span class="hljs-keyword">val</span> token: String, <span class="hljs-keyword">val</span> userId: String)

<span class="hljs-comment">// 2. ç½‘ç»œæ¥å£ï¼ˆRetrofitï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoginApi</span> {
    <span class="hljs-meta">@POST(<span class="hljs-string">"login"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-meta">@Body</span> request: <span class="hljs-type">LoginRequest</span>)</span></span>: LoginResponse
}

<span class="hljs-comment">// 3. æœ¬åœ°æ•°æ®æºï¼ˆç¤ºä¾‹ï¼šSharedPref ä¿å­˜ Tokenï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginLocalDataSource</span>(context: Context) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sp = context.getSharedPreferences(<span class="hljs-string">"login"</span>, Context.MODE_PRIVATE)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">saveToken</span><span class="hljs-params">(token: <span class="hljs-type">String</span>)</span></span> {
        sp.edit().putString(<span class="hljs-string">"token"</span>, token).apply()
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getToken</span><span class="hljs-params">()</span></span>: String? = sp.getString(<span class="hljs-string">"token"</span>, <span class="hljs-literal">null</span>)
}
</code></pre>
<h4 data-id="heading-6">Step 2ï¼šRepository å±‚ï¼ˆæ•°æ®ä»“åº“ï¼‰</h4>
<p>ç»Ÿä¸€ç®¡ç†æ•°æ®æ¥æºï¼ŒViewModel æ— éœ€å…³å¿ƒæ•°æ®ä»ç½‘ç»œ/æœ¬åœ°æ¥ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api: LoginApi,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> localDataSource: LoginLocalDataSource
) {
    <span class="hljs-comment">// ç™»å½•è¯·æ±‚ï¼ˆæŒ‚èµ·å‡½æ•°ï¼Œé€‚é…åç¨‹ï¼‰</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">login</span><span class="hljs-params">(username: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>)</span></span>: LoginResponse {
        <span class="hljs-keyword">val</span> response = api.login(LoginRequest(username, password))
        <span class="hljs-comment">// ç™»å½•æˆåŠŸåä¿å­˜ Token åˆ°æœ¬åœ°</span>
        localDataSource.saveToken(response.token)
        <span class="hljs-keyword">return</span> response
    }
}
</code></pre>
<h4 data-id="heading-7">Step 3ï¼šViewModel å±‚ï¼ˆçŠ¶æ€æŒæœ‰ + äº‹ä»¶å¤„ç†ï¼‰</h4>
<p>æ ¸å¿ƒæ˜¯ç”¨ <code>StateFlow</code>/<code>LiveData</code> æŒæœ‰å¯è§‚å¯ŸçŠ¶æ€ï¼ŒCompose è®¢é˜…åè‡ªåŠ¨é‡ç»„ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: LoginRepository
) : ViewModel() {
    <span class="hljs-comment">// 1. UI çŠ¶æ€ï¼ˆèšåˆæ‰€æœ‰éœ€è¦é©±åŠ¨ UI çš„æ•°æ®ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow(LoginUiState())
    <span class="hljs-keyword">val</span> uiState: StateFlow&lt;LoginUiState&gt; = _uiState.asStateFlow() <span class="hljs-comment">// å¯¹å¤–æš´éœ²åªè¯»æµ</span>

    <span class="hljs-comment">// 2. å¤„ç†ç™»å½•äº‹ä»¶ï¼ˆUI ç‚¹å‡»åè°ƒç”¨ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleLogin</span><span class="hljs-params">(username: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// æ ‡è®°åŠ è½½ä¸­</span>
        _uiState.update { it.copy(isLoading = <span class="hljs-literal">true</span>, errorMsg = <span class="hljs-string">""</span>) }
        
        <span class="hljs-comment">// åç¨‹å¤„ç†å¼‚æ­¥è¯·æ±‚ï¼ˆviewModelScope è‡ªåŠ¨ç»‘å®šç”Ÿå‘½å‘¨æœŸï¼‰</span>
        viewModelScope.launch {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> response = repository.login(username, password)
                <span class="hljs-comment">// ç™»å½•æˆåŠŸï¼šæ›´æ–°çŠ¶æ€</span>
                _uiState.update { 
                    it.copy(
                        isLoading = <span class="hljs-literal">false</span>,
                        isLoginSuccess = <span class="hljs-literal">true</span>,
                        token = response.token
                    )
                }
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                <span class="hljs-comment">// ç™»å½•å¤±è´¥ï¼šæ›´æ–°é”™è¯¯çŠ¶æ€</span>
                _uiState.update { 
                    it.copy(
                        isLoading = <span class="hljs-literal">false</span>,
                        errorMsg = e.message ?: <span class="hljs-string">"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•"</span>
                    )
                }
            }
        }
    }

    <span class="hljs-comment">// å®šä¹‰ UI çŠ¶æ€æ•°æ®ç±»ï¼ˆèšåˆæ‰€æœ‰ UI æ‰€éœ€çŠ¶æ€ï¼‰</span>
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginUiState</span>(
        <span class="hljs-keyword">val</span> isLoading: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
        <span class="hljs-keyword">val</span> errorMsg: String = <span class="hljs-string">""</span>,
        <span class="hljs-keyword">val</span> isLoginSuccess: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
        <span class="hljs-keyword">val</span> token: String = <span class="hljs-string">""</span>
    )
}
</code></pre>
<h4 data-id="heading-8">Step 4ï¼šUI å±‚ï¼ˆComposable å‡½æ•°ï¼‰</h4>
<p>ä»…è®¢é˜… ViewModel çŠ¶æ€ã€è§¦å‘äº‹ä»¶ï¼Œæ— ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">@Composable
fun LoginScreen(
    viewModel: <span class="hljs-attr">LoginViewModel</span> = viewModel(), // è‡ªåŠ¨æ³¨å…¥ ViewModel
    onLoginSuccess: (String) -&gt; Unit // ç™»å½•æˆåŠŸåçš„è·³è½¬å›è°ƒ
) {
    // 1. æ”¶é›† ViewModel çŠ¶æ€ï¼ˆcollectAsState è‡ªåŠ¨è®¢é˜…ï¼ŒçŠ¶æ€å˜åŒ–è§¦å‘é‡ç»„ï¼‰
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()
    
    // 2. è¾“å…¥æ¡†çŠ¶æ€ï¼ˆUI çº§ä¸´æ—¶çŠ¶æ€ï¼Œæ— éœ€æ”¾ ViewModelï¼‰
    var username by remember { mutableStateOf("") }
    var password by remember { mutableStateOf("") }

    Column(
        <span class="hljs-attr">modifier</span> = Modifier
            .fillMaxSize()
            .padding(16.dp),
        <span class="hljs-attr">horizontalAlignment</span> = Alignment.CenterHorizontally,
        <span class="hljs-attr">verticalArrangement</span> = Arrangement.Center
    ) {
        // ç”¨æˆ·åè¾“å…¥æ¡†
        OutlinedTextField(
            <span class="hljs-attr">value</span> = username,
            <span class="hljs-attr">onValueChange</span> = { username = it },
            <span class="hljs-attr">label</span> = { Text(<span class="hljs-string">"ç”¨æˆ·å"</span>) },
            <span class="hljs-attr">singleLine</span> = <span class="hljs-literal">true</span>,
            <span class="hljs-attr">modifier</span> = Modifier.fillMaxWidth()
        )
        
        Spacer(<span class="hljs-attr">modifier</span> = Modifier.height(<span class="hljs-number">16</span>.dp))
        
        // å¯†ç è¾“å…¥æ¡†
        OutlinedTextField(
            <span class="hljs-attr">value</span> = password,
            <span class="hljs-attr">onValueChange</span> = { password = it },
            <span class="hljs-attr">label</span> = { Text(<span class="hljs-string">"å¯†ç "</span>) },
            <span class="hljs-attr">singleLine</span> = <span class="hljs-literal">true</span>,
            <span class="hljs-attr">visualTransformation</span> = PasswordVisualTransformation(),
            <span class="hljs-attr">modifier</span> = Modifier.fillMaxWidth()
        )
        
        // é”™è¯¯æç¤º
        if (uiState.errorMsg.isNotBlank()) {
            Text(
                <span class="hljs-attr">text</span> = uiState.errorMsg,
                <span class="hljs-attr">color</span> = Color.Red,
                <span class="hljs-attr">modifier</span> = Modifier.padding(top = <span class="hljs-number">8</span>.dp)
            )
        }
        
        Spacer(<span class="hljs-attr">modifier</span> = Modifier.height(<span class="hljs-number">16</span>.dp))
        
        // ç™»å½•æŒ‰é’®ï¼ˆåŠ è½½ä¸­ç¦ç”¨ï¼‰
        Button(
            <span class="hljs-attr">onClick</span> = { viewModel.handleLogin(username, password) },
            <span class="hljs-attr">enabled</span> = !uiState.isLoading,
            <span class="hljs-attr">modifier</span> = Modifier.fillMaxWidth()
        ) {
            if (uiState.isLoading) {
                CircularProgressIndicator(
                    <span class="hljs-attr">modifier</span> = Modifier.size(<span class="hljs-number">20</span>.dp),
                    <span class="hljs-attr">strokeWidth</span> = <span class="hljs-number">2</span>.dp
                )
            } else {
                Text("ç™»å½•")
            }
        }
    }

    // ç™»å½•æˆåŠŸï¼šè§¦å‘è·³è½¬ï¼ˆå‰¯ä½œç”¨ï¼Œç”¨ LaunchedEffect é¿å…é‡ç»„é‡å¤æ‰§è¡Œï¼‰
    LaunchedEffect(uiState.isLoginSuccess) {
        if (uiState.isLoginSuccess) {
            onLoginSuccess(uiState.token)
        }
    }
}
</code></pre>
<h4 data-id="heading-9">Step 5ï¼šActivity å±‚ï¼ˆä»…æ‰¿è½½ UIï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContent {
            MyAppTheme {
                LoginScreen(onLoginSuccess = { token -&gt;
                    <span class="hljs-comment">// ç™»å½•æˆåŠŸè·³è½¬åˆ°é¦–é¡µ</span>
                    navController.navigate(<span class="hljs-string">"home"</span>)
                })
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-10">å››ã€çŠ¶æ€è®¾è®¡çš„æ ¸å¿ƒè§„åˆ™ï¼ˆé¿å‘å…³é”®ï¼‰</h3>
<h4 data-id="heading-11">1. çŠ¶æ€åˆ†ç±»ï¼šåŒºåˆ†â€œUI ä¸´æ—¶çŠ¶æ€â€å’Œâ€œä¸šåŠ¡çŠ¶æ€â€</h4>























<table><thead><tr><th>çŠ¶æ€ç±»å‹</th><th>ç¤ºä¾‹</th><th>å­˜æ”¾ä½ç½®</th><th>åŸå› </th></tr></thead><tbody><tr><td>UI ä¸´æ—¶çŠ¶æ€</td><td>è¾“å…¥æ¡†å†…å®¹ã€åˆ—è¡¨æ»šåŠ¨ä½ç½®ã€å¼¹çª—æ˜¾éš</td><td>Composable å†…ï¼ˆrememberï¼‰</td><td>ä»…å½±å“å•ä¸ª UI ç»„ä»¶ï¼Œæ— éœ€å…±äº«/æŒä¹…åŒ–</td></tr><tr><td>ä¸šåŠ¡çŠ¶æ€</td><td>ç™»å½•çŠ¶æ€ã€ç”¨æˆ·ä¿¡æ¯ã€æ¥å£è¿”å›æ•°æ®</td><td>ViewModelï¼ˆStateFlowï¼‰</td><td>éœ€è·¨ç»„ä»¶å…±äº«ã€æŒä¹…åŒ–ï¼Œæˆ–éšç”Ÿå‘½å‘¨æœŸä¿æ´»</td></tr></tbody></table>
<h4 data-id="heading-12">2. çŠ¶æ€ä¸Šç§»ï¼šé¿å…å±€éƒ¨çŠ¶æ€è€¦åˆ</h4>
<ul>
<li>è‹¥å¤šä¸ªå­ç»„ä»¶éœ€è¦å…±äº«çŠ¶æ€ï¼ˆå¦‚â€œç™»å½•æŒ‰é’®â€å’Œâ€œé”™è¯¯æç¤ºâ€å…±äº« <code>isLoading</code>ï¼‰ï¼Œå°†çŠ¶æ€ä¸Šç§»åˆ°çˆ¶ç»„ä»¶/ViewModelï¼›</li>
<li>ç¤ºä¾‹ï¼šè¾“å…¥æ¡†å†…å®¹æ˜¯â€œå±€éƒ¨çŠ¶æ€â€ï¼Œä½†â€œç™»å½•æ˜¯å¦æˆåŠŸâ€æ˜¯â€œå…¨å±€ä¸šåŠ¡çŠ¶æ€â€ï¼Œéœ€æ”¾åœ¨ ViewModelã€‚</li>
</ul>
<h4 data-id="heading-13">3. ä¸å¯å˜çŠ¶æ€ï¼šç”¨ data class + copy æ›´æ–°</h4>
<ul>
<li>æ‰€æœ‰çŠ¶æ€æ•°æ®ç±»ï¼ˆå¦‚ <code>LoginUiState</code>ï¼‰è®¾è®¡ä¸ºä¸å¯å˜ï¼ˆvalï¼‰ï¼Œæ›´æ–°æ—¶é€šè¿‡ <code>copy</code> ç”Ÿæˆæ–°å¯¹è±¡ï¼›</li>
<li>åŸå› ï¼šCompose ä¾èµ–â€œçŠ¶æ€å¯¹è±¡å¼•ç”¨å˜åŒ–â€è§¦å‘é‡ç»„ï¼Œå¯å˜å¯¹è±¡ä¼šå¯¼è‡´é‡ç»„å¤±æ•ˆã€‚</li>
</ul>
<h4 data-id="heading-14">4. ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼šç”¨ collectAsStateWithLifecycle</h4>
<ul>
<li>æ”¶é›† StateFlow æ—¶ï¼Œä¼˜å…ˆç”¨ <code>collectAsStateWithLifecycle()</code>ï¼ˆè€Œé <code>collectAsState()</code>ï¼‰ï¼Œè‡ªåŠ¨åœ¨ Activity/Fragment è¿›å…¥åå°æ—¶æš‚åœæ”¶é›†ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
</ul>
<h3 data-id="heading-15">äº”ã€è¿›é˜¶ï¼šMVVM + Clean Architectureï¼ˆæ•´æ´æ¶æ„ï¼‰</h3>
<p>ä¸­å¤§å‹é¡¹ç›®å¯åœ¨ MVVM åŸºç¡€ä¸Šå¼•å…¥ Clean Architectureï¼Œè¿›ä¸€æ­¥åˆ†å±‚è§£è€¦ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Presentation å±‚ â”‚ UI + ViewModelï¼ˆä¸ MVVM ä¸€è‡´ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Domain å±‚       â”‚ ç”¨ä¾‹ï¼ˆUseCaseï¼‰+ é¢†åŸŸæ¨¡å‹ï¼ˆEntityï¼‰ï¼Œå°è£…æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚                 â”‚ ç¤ºä¾‹ï¼šLoginUseCase å°è£…â€œæ ¡éªŒå‚æ•° + è°ƒç”¨ä»“åº“ + å¤„ç†ç»“æœâ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data å±‚         â”‚ Repository + æ•°æ®æºï¼ˆç½‘ç»œ/æœ¬åœ°ï¼‰ï¼ŒDomain å±‚ä¸å…³å¿ƒæ•°æ®æ¥æº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<p>æ ¸å¿ƒä¼˜åŠ¿ï¼šDomain å±‚å®Œå…¨ç‹¬ç«‹äº UI å’Œæ•°æ®å±‚ï¼Œä¸šåŠ¡é€»è¾‘å¯å•ç‹¬æµ‹è¯•ï¼Œä¸”æ˜“é€‚é…å¤šç«¯ï¼ˆå¦‚ Compose Multiplatform å¤ç”¨ Domain å±‚ï¼‰ã€‚</p>
<h3 data-id="heading-16">å…­ã€æ€»ç»“</h3>
<p>1.<strong>ä¸»æµæ¶æ„</strong>ï¼šCompose é¦–é€‰ã€ŒMVVM + å•å‘æ•°æ®æµã€ï¼Œæ˜¯å®˜æ–¹æ¨èã€é€‚é…æ€§æœ€å¥½çš„æ–¹æ¡ˆï¼›</p>
<p>2.<strong>çŠ¶æ€æµè½¬</strong>ï¼šUI è§¦å‘äº‹ä»¶ â†’ ViewModel å¤„ç† â†’ Repository è·å–æ•°æ® â†’ ViewModel æ›´æ–°çŠ¶æ€ â†’ UI é‡ç»„ï¼›</p>
<p>3.<strong>æ ¸å¿ƒè§„åˆ™</strong>ï¼šçŠ¶æ€åˆ†ç±»å­˜æ”¾ã€ä¸å¯å˜è®¾è®¡ã€ç”Ÿå‘½å‘¨æœŸç»‘å®šã€çŠ¶æ€ä¸Šç§»ï¼›</p>
<p>4.<strong>è¿›é˜¶ä¼˜åŒ–</strong>ï¼šä¸­å¤§å‹é¡¹ç›®åŠ  Clean Architecture çš„ Domain å±‚ï¼Œè§£è€¦ä¸šåŠ¡é€»è¾‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨å·¥å…·æ³›æ»¥çš„æ—¶ä»£ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªâ€œä¸ä¸€æ ·â€œçš„å·¥å…·ç«™]]></title>    <link>https://juejin.cn/post/7582861402278051874</link>    <guid>https://juejin.cn/post/7582861402278051874</guid>    <pubDate>2025-12-13T07:09:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582861402278051874" data-draft-id="7582845425402871848" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨å·¥å…·æ³›æ»¥çš„æ—¶ä»£ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªâ€œä¸ä¸€æ ·â€œçš„å·¥å…·ç«™"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-13T07:09:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èˆ’ä¸€ç¬‘ä¸ç§ƒå¤´"/> <meta itemprop="url" content="https://juejin.cn/user/4257747754552599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨å·¥å…·æ³›æ»¥çš„æ—¶ä»£ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªâ€œä¸ä¸€æ ·â€œçš„å·¥å…·ç«™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4257747754552599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èˆ’ä¸€ç¬‘ä¸ç§ƒå¤´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:09:51.000Z" title="Sat Dec 13 2025 07:09:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å†™åœ¨å‰é¢</h2>
<p>è¿™ä¸æ˜¯ä¸€ç¯‡äº§å“æ¨å¹¿æ–‡ã€‚</p>
<p>æˆ–è€…è¯´ï¼Œæˆ‘ä¸æƒ³è®©å®ƒçœ‹èµ·æ¥åƒã€‚</p>
<p>å¦‚æœä½ ç‚¹è¿›æ¥æ˜¯æƒ³çœ‹"åŠŸèƒ½å¼ºå¤§"ã€"ä¸€ç«™å¼è§£å†³"ã€"æ•ˆç‡æå‡ 300%"è¿™ç±»è¯æœ¯ï¼Œå¯èƒ½è¦è®©ä½ å¤±æœ›äº†ã€‚æˆ‘æƒ³èŠçš„ï¼Œæ˜¯åœ¨è¿™ä¸ªå·¥å…·ç«™èƒŒåï¼Œä¸€ä¸ªå¼€å‘è€…å¯¹"ä»·å€¼"è¿™ä»¶äº‹çš„æ€è€ƒã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€å½“æˆ‘ä»¬è°ˆè®ºå·¥å…·æ—¶ï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºä»€ä¹ˆ</h2>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œæœç´¢"JSON æ ¼å¼åŒ–å·¥å…·"ï¼Œä½ ä¼šå¾—åˆ°å‡ åä¸‡ä¸ªç»“æœã€‚</p>
<p>å†æœ"Base64 ç¼–ç "ã€"å›¾ç‰‡æ–‡å­—è¯†åˆ«"ï¼Œç»“æœåªä¼šæ›´å¤šã€‚</p>
<p>å·¥å…·ç«™ï¼Œæ—©å·²æ˜¯çº¢æµ·ä¸­çš„çº¢æµ·ã€‚æ¯ä¸€ä¸ªçœ‹èµ·æ¥éƒ½å·®ä¸å¤šï¼šè¾“å…¥æ¡†ã€æŒ‰é’®ã€è¾“å‡ºæ¡†ï¼Œå†é…ä¸Šæ»¡å±çš„å¹¿å‘Šå’Œ"ç«‹å³å‡çº§ VIP"çš„å¼¹çª—ã€‚</p>
<p>é‚£æˆ‘ä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªï¼Ÿ</p>
<p>ç­”æ¡ˆå¾ˆç®€å•ï¼š<strong>å› ä¸ºæˆ‘è‡ªå·±éœ€è¦ï¼Œè€Œå¸‚é¢ä¸Šçš„å·¥å…·è®©æˆ‘ä¸èˆ’æœã€‚</strong></p>
<p>ä¸æ˜¯åŠŸèƒ½ä¸å¤Ÿï¼Œæ°æ°ç›¸åï¼Œæ˜¯"å¤ªå¤šäº†"ã€‚</p>
<p>å¤ªå¤šçš„å¼¹çª—ã€å¤ªå¤šçš„è¿½è¸ªã€å¤ªå¤šçš„"æ™ºèƒ½æ¨è"ã€å¤ªå¤šçš„"ä¼šå‘˜ä¸“äº«"ã€‚æˆ‘åªæ˜¯æƒ³æ ¼å¼åŒ–ä¸€æ®µ JSONï¼Œä¸ºä»€ä¹ˆè¦æ³¨å†Œè´¦å·ï¼Ÿæˆ‘åªæ˜¯æƒ³è§£ç ä¸€æ®µ Base64ï¼Œä¸ºä»€ä¹ˆè¦çœ‹ä¸‰ç§’å¹¿å‘Šï¼Ÿ</p>
<p><strong>å·¥å…·çš„æœ¬è´¨ï¼Œåº”è¯¥æ˜¯è§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯åˆ¶é€ é—®é¢˜ã€‚</strong></p>
<p>äºæ˜¯ï¼Œæˆ‘åšäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fstrloom.com" target="_blank" title="https://strloom.com" ref="nofollow noopener noreferrer">StrLoom</a>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e1fe722f2c546ef97a6d9ad6a1dd0d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IiS5LiA56yR5LiN56eD5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214591&amp;x-signature=ucf%2FIMQ01iWVSMjGtcrBlepdUi4%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">äºŒã€ä»·å€¼æºè‡ªéœ€æ±‚ï¼šä¸€ä¸ªå¼€å‘è€…çš„æ—¥å¸¸å›°å¢ƒ</h2>
<p>ä½œä¸ºä¸€ä¸ªå¼€å‘è€…ï¼Œæˆ‘æ¯å¤©éƒ½åœ¨å’Œå­—ç¬¦ä¸²æ‰“äº¤é“ã€‚</p>
<ul>
<li>åç«¯è¿”å›çš„ JSON æ˜¯å‹ç¼©çš„ï¼Œçœ‹ä¸æ¸…ç»“æ„</li>
<li>æ¥å£ä¼ å‚éœ€è¦ Base64 ç¼–ç ï¼Œæ‰‹åŠ¨è½¬æ¢å¤ªéº»çƒ¦</li>
<li>äº§å“å‘æ¥ä¸€å¼ æˆªå›¾ï¼Œé‡Œé¢æœ‰ä¸€æ®µä»£ç ï¼Œæˆ‘éœ€è¦æŠŠå®ƒæå–å‡ºæ¥</li>
<li>ä» PDF å¤åˆ¶çš„æ–‡æœ¬ï¼Œæ»¡æ˜¯æ¢è¡Œç¬¦å’Œå¤šä½™ç©ºæ ¼ï¼Œç²˜è´´åˆ°ä»£ç é‡Œå°±æŠ¥é”™</li>
</ul>
<p>è¿™äº›åœºæ™¯ï¼Œæ¯å¤©éƒ½åœ¨å‘ç”Ÿã€‚</p>
<p>æˆ‘éœ€è¦çš„ï¼Œä¸æ˜¯ä¸€ä¸ª"åŠŸèƒ½å…¨é¢"çš„å·¥å…·ç«™ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>å¿«é€Ÿã€å¹²å‡€ã€ä¸æ‰“æ‰°æˆ‘çš„å·¥å…·</strong>ã€‚</p>
<ul>
<li>ä¸éœ€è¦æ³¨å†Œ</li>
<li>ä¸éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨</li>
<li>ä¸éœ€è¦ç­‰å¾…åŠ è½½</li>
<li>ä¸éœ€è¦å…³é—­å¹¿å‘Š</li>
</ul>
<p><strong>åªéœ€è¦æ‰“å¼€ï¼Œç²˜è´´ï¼Œç‚¹å‡»ï¼Œå¤åˆ¶ã€‚</strong></p>
<p>è¿™å°±æ˜¯ StrLoom çš„å…¨éƒ¨ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€StrLoom å’Œå…¶ä»–å·¥å…·ç«™æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h2>
<h3 data-id="heading-4">1. çº¯å‰ç«¯ï¼Œé›¶è¿½è¸ª</h3>
<p>æ‰€æœ‰å¤„ç†éƒ½åœ¨ä½ çš„æµè§ˆå™¨ä¸­å®Œæˆã€‚</p>
<p>ä½ çš„æ•°æ®ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼Œä¸ä¼šè¢«è®°å½•ï¼Œä¸ä¼šè¢«åˆ†æï¼Œä¸ä¼šè¢«"ç”¨äºæ”¹è¿›æœåŠ¡"ã€‚</p>
<p><strong>ä½ çš„æ•°æ®ï¼Œåªå±äºä½ ã€‚</strong></p>
<h3 data-id="heading-5">2. æç®€è®¾è®¡ï¼Œä¸“æ³¨ä½“éªŒ</h3>
<p>æ²¡æœ‰å¹¿å‘Šï¼Œæ²¡æœ‰å¼¹çª—ï¼Œæ²¡æœ‰"å‡çº§ä¼šå‘˜"ã€‚</p>
<p>ç•Œé¢æ˜¯èµ›åšæœ‹å…‹é£æ ¼çš„æ·±è‰²ä¸»é¢˜ï¼Œé…è‰²æ˜¯éœ“è™¹é’ã€ç´«ã€ç²‰ï¼Œè§†è§‰ä¸Šèˆ’é€‚ï¼ŒåŠŸèƒ½ä¸Šç›´è§‚ã€‚</p>
<p><strong>å·¥å…·å°±æ˜¯å·¥å…·ï¼Œä¸åº”è¯¥æˆä¸ºè´Ÿæ‹…ã€‚</strong></p>
<h3 data-id="heading-6">3. åŠŸèƒ½ç²¾å‡†ï¼Œä¸è´ªå¤š</h3>
<p>StrLoom åªåšå››ä»¶äº‹ï¼š</p>
<ul>
<li><strong>JSON æ ¼å¼åŒ–</strong>ï¼šæ”¯æŒæ ¼å¼åŒ–ã€å‹ç¼©ã€æ¨¡æ¿åˆå¹¶ï¼ˆè¿™æ˜¯å…¶ä»–å·¥å…·å°‘æœ‰çš„åŠŸèƒ½ï¼‰</li>
<li><strong>ç¼–ç /è§£ç </strong>ï¼šBase64ã€URLã€Unicodeã€Hexï¼Œä¸€é”®åˆ‡æ¢</li>
<li><strong>å›¾ç‰‡ OCR</strong>ï¼šæ”¯æŒç²˜è´´å›¾ç‰‡ï¼Œæœ¬åœ°è¯†åˆ«æ–‡å­—ï¼ˆåŸºäº Tesseract.jsï¼‰</li>
<li><strong>æ–‡æœ¬æ¸…ç†</strong>ï¼šå»é™¤æ¢è¡Œã€å¤šä½™ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ï¼Œè®©æ–‡æœ¬"å¹²å‡€"</li>
</ul>
<p>æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯æˆ‘è‡ªå·±é«˜é¢‘ä½¿ç”¨çš„ï¼Œæ¯ä¸ªç»†èŠ‚éƒ½æ˜¯æˆ‘åå¤æ‰“ç£¨çš„ã€‚</p>
<p><strong>ä¸æ±‚å¤§è€Œå…¨ï¼Œåªæ±‚å°è€Œç¾ã€‚</strong></p>
<hr/>
<h2 data-id="heading-7">å››ã€ä»·å€¼ã€å…±è¯†ã€æ¨¡å¼ï¼šä¸€ä¸ªè¶…çº§ä¸ªä½“çš„å•†ä¸šæ€è€ƒ</h2>
<p>åš StrLoomï¼Œä¸åªæ˜¯ä¸ºäº†è§£å†³è‡ªå·±çš„éœ€æ±‚ã€‚</p>
<p>æˆ‘æƒ³è¡¨è¾¾çš„ï¼Œæ˜¯ä¸€ç§å¯¹"ä»·å€¼"çš„ç†è§£ï¼š</p>
<blockquote>
<p><strong>ä»·å€¼æºè‡ªéœ€æ±‚ï¼Œå› ä¸ºè¢«éœ€æ±‚ï¼Œæ‰€ä»¥æ‰æœ‰ä»·å€¼ã€‚</strong><br/>
<strong>å…±è¯†æ¥è‡ªäºåˆ†æ­§çš„è¶…è¶Šï¼Œå…±è¯†çš„æˆæœæ˜¯æˆäº¤ä¸å…³ç³»ã€‚</strong><br/>
<strong>æ¨¡å¼æ˜¯è‡ªå·±å¦‚ä½•ç”Ÿå­˜ä¸å‘å±•ï¼Œæ¯ä¸ªäººã€æ¯ä¸ªä¼ä¸šéƒ½æ˜¯è‡ªèº«æ¨¡å¼ä¸ç¯å¢ƒäº’åŠ¨çš„äº§ç‰©ã€‚</strong></p>
</blockquote>
<p>è¿™ä¸‰å¥è¯ï¼Œæ„æˆäº†ä¸€ä¸ªå•†ä¸šé—­ç¯ï¼š</p>
<ol>
<li><strong>æ´å¯Ÿéœ€æ±‚</strong> â†’ æˆ‘å‘ç°å¼€å‘è€…éœ€è¦ä¸€ä¸ªå¹²å‡€ã€å¿«é€Ÿã€éšç§çš„å·¥å…·ç«™</li>
<li><strong>æä¾›ä»·å€¼</strong> â†’ æˆ‘åšäº† StrLoomï¼Œè§£å†³è¿™ä¸ªéœ€æ±‚</li>
<li><strong>è¾¾æˆå…±è¯†</strong> â†’ ç”¨æˆ·è®¤å¯è¿™ä¸ªä»·å€¼ï¼Œä½¿ç”¨ã€åˆ†äº«ã€æ¨è</li>
<li><strong>è·å¾—æˆäº¤ä¸å…³ç³»</strong> â†’ æˆ‘è·å¾—äº†ç”¨æˆ·ã€åé¦ˆã€å½±å“åŠ›</li>
<li><strong>æŠ•èµ„è‡ªå·±</strong> â†’ æˆ‘ç”¨è¿™äº›èµ„æºç»§ç»­ä¼˜åŒ–äº§å“ï¼Œæå‡ç«äº‰åŠ›</li>
</ol>
<p>è¿™å°±æ˜¯æˆ‘ç†è§£çš„"è¶…çº§ä¸ªä½“"çš„ç”Ÿå­˜æ–¹å¼ã€‚</p>
<p><strong>ä¸ä¾é™„äºå¹³å°ï¼Œä¸è¿½é€é£å£ï¼Œä¸ç›²ç›®æ‰©å¼ ã€‚</strong></p>
<p><strong>åªåšè‡ªå·±æ“…é•¿çš„äº‹ï¼ŒåªæœåŠ¡çœŸæ­£éœ€è¦çš„äººï¼Œåªå»ºç«‹çœŸå®çš„è¿æ¥ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25684cd4d90d4bd3a4649702e235b792~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IiS5LiA56yR5LiN56eD5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214591&amp;x-signature=rS%2Fs6GWgrNvh4tcoI0dlFK9Gcxc%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-8">äº”ã€æˆ‘ä¸æƒ³æˆä¸ºæ—¶ä»£çš„ API</h2>
<p>è¿™ä¸ªæ—¶ä»£ï¼Œå¤ªå¤šäººåœ¨åš"API"ã€‚</p>
<p>ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
<p>å°±æ˜¯æŠŠè‡ªå·±å˜æˆä¸€ä¸ª"æ¥å£"ï¼Œè¾“å…¥éœ€æ±‚ï¼Œè¾“å‡ºç»“æœï¼Œä¸­é—´æ²¡æœ‰æ€è€ƒï¼Œæ²¡æœ‰ä¸ªæ€§ï¼Œæ²¡æœ‰æ¸©åº¦ã€‚</p>
<ul>
<li>çœ‹åˆ° AI ç«äº†ï¼Œå°±åš AI å·¥å…·</li>
<li>çœ‹åˆ°çŸ­è§†é¢‘ç«äº†ï¼Œå°±åšçŸ­è§†é¢‘å·¥å…·</li>
<li>çœ‹åˆ° Web3 ç«äº†ï¼Œå°±åš Web3 å·¥å…·</li>
</ul>
<p><strong>è¿½ç€é£å£è·‘ï¼Œå´ä¸çŸ¥é“è‡ªå·±åœ¨è·‘ä»€ä¹ˆã€‚</strong></p>
<p>æˆ‘ä¸æƒ³è¿™æ ·ã€‚</p>
<p>æˆ‘æƒ³åšä¸€ä¸ª<strong>æœ‰è‡ªå·±èº«ä»½çš„è¶…çº§ä¸ªä½“</strong>ã€‚</p>
<p>æˆ‘æœ‰è‡ªå·±çš„å®¡ç¾ã€è‡ªå·±çš„ä»·å€¼è§‚ã€è‡ªå·±çš„èŠ‚å¥ã€‚</p>
<p>æˆ‘åš StrLoomï¼Œä¸æ˜¯å› ä¸º"å·¥å…·ç«™"æ˜¯é£å£ï¼Œè€Œæ˜¯å› ä¸º<strong>æˆ‘è‡ªå·±éœ€è¦ï¼Œæˆ‘ç›¸ä¿¡ä¹Ÿæœ‰äººå’Œæˆ‘ä¸€æ ·éœ€è¦</strong>ã€‚</p>
<p>æˆ‘å¸Œæœ›é€šè¿‡è¿™ä¸ªå·¥å…·ç«™ï¼Œè¿æ¥æ›´å¤š<strong>æœ‰çœŸå®éœ€æ±‚ã€æœ‰è¡¨è¾¾æ¬²ã€æœ‰åˆ›é€ åŠ›çš„æ„å»ºè€…</strong>ã€‚</p>
<p><strong>æˆ‘ä»¬ä¸æ˜¯åœ¨æ¶ˆè´¹å·¥å…·ï¼Œè€Œæ˜¯åœ¨å…±åŒåˆ›é€ ä¸€ç§æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e36dc2ae9542198803d3e23bbab54a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IiS5LiA56yR5LiN56eD5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214591&amp;x-signature=l2%2BawoTwFF2%2F3VTA9HPlFoUkT1g%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-9">å…­ã€StrLoom çš„æœªæ¥</h2>
<p>StrLoom ç°åœ¨è¿˜å¾ˆç®€å•ï¼Œåªæœ‰å››ä¸ªåŠŸèƒ½ã€‚</p>
<p>ä½†æˆ‘ä¸æ‰“ç®—è®©å®ƒå˜æˆ"å¤§è€Œå…¨"çš„å·¥å…·ç«™ã€‚</p>
<p>æˆ‘ä¼šç»§ç»­æ‰“ç£¨è¿™å››ä¸ªåŠŸèƒ½ï¼Œè®©å®ƒä»¬æ›´å¿«ã€æ›´ç¨³å®šã€æ›´å¥½ç”¨ã€‚</p>
<p>æˆ‘ä¹Ÿä¼šæ ¹æ®ç”¨æˆ·çš„åé¦ˆï¼Œæ…¢æ…¢åŠ å…¥æ–°çš„åŠŸèƒ½â€”â€”ä½†å‰ææ˜¯ï¼Œ<strong>è¿™äº›åŠŸèƒ½æ˜¯çœŸå®éœ€æ±‚ï¼Œè€Œä¸æ˜¯ä¸ºäº†"çœ‹èµ·æ¥åŠŸèƒ½å¤š"</strong>ã€‚</p>
<p>æˆ‘å¸Œæœ› StrLoom æˆä¸ºä¸€ä¸ª<strong>æœ‰æ¸©åº¦çš„å·¥å…·ç«™</strong>ã€‚</p>
<p>ä¸æ˜¯å†·å†°å†°çš„"è¾“å…¥-è¾“å‡º"ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>è®©å¼€å‘è€…æ„Ÿåˆ°èˆ’é€‚ã€ä¿¡ä»»ã€æ„‰æ‚¦çš„åœ°æ–¹</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-10">ä¸ƒã€å†™åœ¨æœ€å</h2>
<p>å¦‚æœä½ çœ‹åˆ°è¿™é‡Œï¼Œè°¢è°¢ä½ çš„è€å¿ƒã€‚</p>
<p>æˆ‘çŸ¥é“è¿™ç¯‡æ–‡ç« æœ‰ç‚¹é•¿ï¼Œæœ‰ç‚¹"ä¸åƒæ¨å¹¿æ–‡"ã€‚</p>
<p>ä½†æˆ‘æƒ³è¯´çš„ï¼Œä¸åªæ˜¯"æ¥ç”¨æˆ‘çš„å·¥å…·å§"ï¼Œè€Œæ˜¯ï¼š</p>
<p><strong>åœ¨è¿™ä¸ªå·¥å…·æ³›æ»¥çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜èƒ½åšä¸€äº›"ä¸ä¸€æ ·"çš„ä¸œè¥¿ï¼Ÿ</strong></p>
<p><strong>åœ¨è¿™ä¸ªè¿½é€æµé‡çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜èƒ½åšæŒä¸€äº›"æ…¢"çš„ä»·å€¼ï¼Ÿ</strong></p>
<p><strong>åœ¨è¿™ä¸ªäººäººéƒ½æƒ³æˆä¸º"API"çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜èƒ½ä¿æŒè‡ªå·±çš„èº«ä»½ï¼Ÿ</strong></p>
<p>StrLoom æ˜¯æˆ‘çš„ç­”æ¡ˆã€‚</p>
<p>å¦‚æœä½ ä¹Ÿè®¤åŒè¿™äº›æƒ³æ³•ï¼Œæ¬¢è¿æ¥è¯•è¯•ï¼š</p>
<p>ğŸ‘‰ <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fstrloom.com" target="_blank" title="https://strloom.com" ref="nofollow noopener noreferrer">strloom.com</a></strong></p>
<p>å¦‚æœä½ æœ‰ä»»ä½•å»ºè®®ã€åé¦ˆã€æˆ–è€…åªæ˜¯æƒ³èŠèŠå¤©ï¼Œæ¬¢è¿è”ç³»æˆ‘ã€‚</p>
<p><strong>è®©æˆ‘ä»¬ä¸€èµ·ï¼Œç”¨å¿ƒç¼–ç ï¼Œä¸€æ¬¡ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</strong></p>
<hr/>
<h2 data-id="heading-11">é™„ï¼šStrLoom åŠŸèƒ½é€Ÿè§ˆ</h2>
<h3 data-id="heading-12">1. JSON æ ¼å¼åŒ–</h3>
<ul>
<li>ä¸€é”®æ ¼å¼åŒ–/å‹ç¼© JSON</li>
<li>æ”¯æŒæ¨¡æ¿åˆå¹¶ï¼ˆç‹¬ç‰¹åŠŸèƒ½ï¼‰</li>
<li>å®æ—¶é”™è¯¯æç¤º</li>
</ul>
<h3 data-id="heading-13">2. ç¼–ç /è§£ç </h3>
<ul>
<li>æ”¯æŒ Base64ã€URLã€Unicodeã€Hex</li>
<li>ä¸€é”®åˆ‡æ¢ç¼–ç ç±»å‹</li>
<li>åŒå‘è½¬æ¢</li>
</ul>
<h3 data-id="heading-14">3. å›¾ç‰‡ OCR</h3>
<ul>
<li>æ”¯æŒç²˜è´´å›¾ç‰‡ï¼ˆCtrl+Vï¼‰</li>
<li>æœ¬åœ°è¯†åˆ«ï¼Œæ— éœ€ä¸Šä¼ </li>
<li>åŸºäº Tesseract.js</li>
</ul>
<h3 data-id="heading-15">4. æ–‡æœ¬æ¸…ç†</h3>
<ul>
<li>å»é™¤æ¢è¡Œã€å¤šä½™ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦</li>
<li>å®æ—¶æ˜¾ç¤ºå­—ç¬¦æ•°å˜åŒ–</li>
<li>ä¸€é”®å¤åˆ¶ç»“æœ</li>
</ul>
<hr/>
<p><strong>StrLoom: è®©å­—ç¬¦ä¸²æ‰¾åˆ°å½’å®¿ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šuber H3ç½‘æ ¼]]></title>    <link>https://juejin.cn/post/7582861402277871650</link>    <guid>https://juejin.cn/post/7582861402277871650</guid>    <pubDate>2025-12-13T06:38:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582861402277871650" data-draft-id="7573710392212324379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šuber H3ç½‘æ ¼"/> <meta itemprop="keywords" content="åç«¯,ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-13T06:38:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰å¹´ä¹‹çº¦"/> <meta itemprop="url" content="https://juejin.cn/user/3448523142729784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šuber H3ç½‘æ ¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3448523142729784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰å¹´ä¹‹çº¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T06:38:45.000Z" title="Sat Dec 13 2025 06:38:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>H3 æ˜¯ä¸€ä¸ª<strong>å…­è¾¹å½¢å±‚æ¬¡ç©ºé—´ç´¢å¼•ç³»ç»Ÿ</strong>ï¼Œå®ƒå°†åœ°çƒè¡¨é¢åˆ’åˆ†ä¸ºä¸€ä¸ªç”±å…­è¾¹å½¢ï¼ˆå’Œå°‘é‡äº”è¾¹å½¢ï¼‰ç»„æˆçš„ç½‘æ ¼ã€‚Java å¼€å‘è€…å¯ä»¥é€šè¿‡å®˜æ–¹æä¾›çš„Â <code>com.uber.h3core</code>Â åº“æ¥ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-0">æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong>å…­è¾¹å½¢ç½‘æ ¼</strong>ï¼šåŸºç¡€å•å…ƒæ˜¯å…­è¾¹å½¢ï¼Œåœ¨12ä¸ªåˆ†è¾¨ç‡ä¸‹å…·æœ‰ä¸åŒçš„é¢ç§¯ã€‚</li>
<li><strong>H3 ç´¢å¼•</strong>ï¼šæ¯ä¸ªå…­è¾¹å½¢ï¼ˆæˆ–äº”è¾¹å½¢ï¼‰éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ 64 ä½Â <code>H3Index</code>Â æ¥è¡¨ç¤ºï¼Œå¯ä»¥ç®€å•åœ°ç”¨ä¸€ä¸ªÂ <code>long</code>Â ç±»å‹æˆ–åå…­è¿›åˆ¶å­—ç¬¦ä¸²æ¥å¤„ç†ã€‚</li>
<li><strong>åˆ†è¾¨ç‡</strong>ï¼šå…±16çº§ï¼ˆ0-15ï¼‰ã€‚åˆ†è¾¨ç‡ 0 çš„å…­è¾¹å½¢æœ€å¤§ï¼ˆå¹³å‡é¢ç§¯çº¦4350 kmÂ²ï¼‰ï¼Œåˆ†è¾¨ç‡ 15 çš„å…­è¾¹å½¢æœ€å°ï¼ˆå¹³å‡é¢ç§¯å°äº1 mÂ²ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-1">Java å¼€å‘ä¸­ H3 æ”¯æŒçš„æ ¸å¿ƒèƒ½åŠ›</h3>
<p>ä»¥ä¸‹æ˜¯æ‚¨å¯ä»¥åœ¨ Java ä»£ç ä¸­ç›´æ¥ä½¿ç”¨çš„ä¸»è¦åŠŸèƒ½ç±»åˆ«ï¼š</p>
<h4 data-id="heading-2">1. åœ°ç†åæ ‡ â†” H3 ç´¢å¼•è½¬æ¢ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰</h4>
<p>è¿™æ˜¯æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„åŠŸèƒ½ï¼Œç”¨äºåœ¨ç»çº¬åº¦å’Œ H3 ç´¢å¼•ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<ul>
<li>
<p><strong><code>geoToH3(double lat, double lng, int resolution)</code></strong></p>
<ul>
<li>
<p><strong>åŠŸèƒ½</strong>ï¼šå°†ç»™å®šçš„ç»çº¬åº¦åæ ‡è½¬æ¢ä¸ºæŒ‡å®šåˆ†è¾¨ç‡çš„ H3 ç´¢å¼•ã€‚</p>
</li>
<li>
<p>åˆ†è¾¨ç‡ï¼šæ•´æ•°ï¼ŒæŒ‡å®š H3 ç½‘æ ¼çš„ç²¾åº¦çº§åˆ«ï¼ˆä¾‹å¦‚ 0 åˆ° 15ï¼‰ï¼Œåˆ†è¾¨ç‡è¶Šé«˜ï¼Œç½‘æ ¼å•å…ƒè¶Šå°ï¼Œè¦†ç›–é¢ç§¯è¶Šç²¾ç»†</p>
</li>
<li>
<p><strong>Java ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">H3Core</span> <span class="hljs-variable">h3</span> <span class="hljs-operator">=</span> H3Core.newInstance();
<span class="hljs-type">long</span> <span class="hljs-variable">h3Index</span> <span class="hljs-operator">=</span> h3.geoToH3(<span class="hljs-number">40.7128</span>, -<span class="hljs-number">74.0060</span>, <span class="hljs-number">9</span>); <span class="hljs-comment">// çº½çº¦å¸‚åæ ‡ï¼Œåˆ†è¾¨ç‡9</span>
System.out.println(Long.toHexString(h3Index)); <span class="hljs-comment">// è¾“å‡ºï¼š8928308280fffff</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><code>h3ToGeo(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå°† H3 ç´¢å¼•è½¬æ¢å›å…¶ä¸­å¿ƒç‚¹çš„ç»çº¬åº¦åæ ‡ã€‚</li>
<li><strong>è¿”å›</strong>ï¼šä¸€ä¸ªÂ <code>List&lt;Double&gt;</code>ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯çº¬åº¦ï¼Œç¬¬äºŒä¸ªæ˜¯ç»åº¦ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3ToGeoBoundary(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç»™å®š H3 ç´¢å¼•æ‰€ä»£è¡¨çš„å…­è¾¹å½¢çš„è¾¹ç•Œåæ ‡ã€‚</li>
<li><strong>è¿”å›</strong>ï¼šä¸€ä¸ªÂ <code>List&lt;List&lt;Double&gt;&gt;</code>ï¼Œå…¶ä¸­æ¯ä¸ªå†…å±‚ List ä»£è¡¨ä¸€ä¸ªé¡¶ç‚¹çš„Â <code>[lat, lng]</code>ã€‚è¿™å¯¹äºåœ¨åœ°å›¾ä¸Šç»˜åˆ¶å…­è¾¹å½¢è‡³å…³é‡è¦ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">2. ç½‘æ ¼æ‹“æ‰‘ä¸é‚»åŸŸåˆ†æ</h4>
<p>è¿™ç±»åŠŸèƒ½ç”¨äºåˆ†æå…­è¾¹å½¢ä¹‹é—´çš„ç©ºé—´å…³ç³»ã€‚</p>
<ul>
<li>
<p><strong><code>kRing(long h3Index, int k)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–æŒ‡å®šç´¢å¼•å‘¨å›´Â <code>k</code>Â ç¯ï¼ˆâ€œç¯â€å¯ä»¥ç†è§£ä¸ºè·ç¦»ï¼‰å†…çš„æ‰€æœ‰ H3 ç´¢å¼•ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š<code>kRing(index, 1)</code>Â ä¼šè¿”å›ç›®æ ‡å…­è¾¹å½¢æœ¬èº«å’Œä¸å…¶ç›´æ¥ç›¸é‚»çš„6ä¸ªå…­è¾¹å½¢ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>hexRange(long h3Index, int k)</code></strong></p>
<ul>
<li>ç±»ä¼¼Â <code>kRing</code>ï¼Œä½†èƒ½å¤„ç†ç½‘æ ¼å˜å½¢ï¼Œåœ¨è·¨è¶Šå¤§é¢ç§¯æ—¶æ›´å¯é ï¼Œä½†å¯èƒ½å›  pentagon distortionï¼ˆäº”è¾¹å½¢æ‰­æ›²ï¼‰è€Œå¤±è´¥ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3Distance(long origin, long target)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè®¡ç®—ä¸¤ä¸ª H3 ç´¢å¼•åœ¨ç½‘æ ¼ç©ºé—´ä¸Šçš„è·ç¦»ï¼ˆä»¥å…­è¾¹å½¢æ•°é‡ä¸ºå•ä½ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getH3UnidirectionalEdge(long origin, long target)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ä¸¤ä¸ªç›¸é‚» H3 ç´¢å¼•ä¹‹é—´çš„æœ‰å‘è¾¹ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getOriginH3IndexFromUnidirectionalEdge(long edge)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šä»æœ‰å‘è¾¹è·å–èµ·å§‹ H3 ç´¢å¼•ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">3. ç´¢å¼•å±‚çº§ä¸å…³ç³»</h4>
<p>è¿™ç±»åŠŸèƒ½ç”¨äºåœ¨ä¸åŒåˆ†è¾¨ç‡ä¹‹é—´è¿›è¡Œè½¬æ¢å’Œæ£€æŸ¥ã€‚</p>
<ul>
<li>
<p><strong><code>h3GetResolution(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç»™å®š H3 ç´¢å¼•çš„åˆ†è¾¨ç‡ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3ToParent(long h3Index, int parentResolution)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç»™å®šç´¢å¼•åœ¨æ›´ä½åˆ†è¾¨ç‡ï¼ˆçˆ¶çº§ï¼‰ä¸‹çš„ H3 ç´¢å¼•ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šä¸€ä¸ªåˆ†è¾¨ç‡ 9 çš„å…­è¾¹å½¢çš„çˆ¶çº§æ˜¯åˆ†è¾¨ç‡ 8 çš„ä¸€ä¸ªæ›´å¤§çš„å…­è¾¹å½¢ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3ToChildren(long h3Index, int childResolution)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç»™å®šç´¢å¼•åœ¨æ›´é«˜åˆ†è¾¨ç‡ï¼ˆå­çº§ï¼‰ä¸‹çš„æ‰€æœ‰ H3 ç´¢å¼•ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šä¸€ä¸ªåˆ†è¾¨ç‡ 8 çš„å…­è¾¹å½¢é€šå¸¸ä¼šè¢«åˆ’åˆ†ä¸º 7 ä¸ªåˆ†è¾¨ç‡ 9 çš„å­å…­è¾¹å½¢ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">4. åŒºåŸŸå¡«å……ä¸çº¿è¦†ç›–</h4>
<p>è¿™æ˜¯éå¸¸å¼ºå¤§çš„ç©ºé—´åˆ†æåŠŸèƒ½ã€‚</p>
<ul>
<li>
<p><strong><code>polyfill(List&lt;List&lt;Double&gt;&gt; polygon, List&lt;List&lt;Double&gt;&gt; holes, int resolution)</code></strong></p>
<ul>
<li>
<p><strong>åŠŸèƒ½</strong>ï¼šç”¨ä¸€ä¸ªå¤šè¾¹å½¢ï¼ˆå¸¦å¯é€‰ç©ºæ´ï¼‰è¦†ç›–åœ°çƒè¡¨é¢ï¼Œå¹¶è¿”å›æ‰€æœ‰è¢«è¯¥å¤šè¾¹å½¢è¦†ç›–çš„ H3 ç´¢å¼•é›†åˆã€‚</p>
</li>
<li>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>polygon</code>ï¼šå¤šè¾¹å½¢çš„å¤–è¾¹ç•Œï¼Œæ˜¯ä¸€ä¸ªÂ <code>List</code>Â çš„Â <code>[lat, lng]</code>Â ç‚¹ã€‚</li>
<li><code>holes</code>ï¼šå¤šè¾¹å½¢å†…çš„æ´ï¼Œæ ¼å¼åŒå¤–è¾¹ç•Œã€‚</li>
<li><code>resolution</code>ï¼šç”¨äºå¡«å……çš„ H3 ç½‘æ ¼åˆ†è¾¨ç‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šè®¡ç®—ä¸€ä¸ªåŸå¸‚è¡Œæ”¿åŒºã€ä¸€ä¸ªæ¹–æ³Šæˆ–ä¸€ä¸ªé…é€åŒºåŸŸå†…åŒ…å«äº†å“ªäº› H3 å…­è¾¹å½¢ã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong><code>h3Line(long start, long end)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè®¡ç®—ä¸¤ä¸ª H3 ç´¢å¼•ä¹‹é—´åœ¨ç½‘æ ¼ç©ºé—´ä¸Šçš„æœ€çŸ­è·¯å¾„æ‰€ç»è¿‡çš„ H3 ç´¢å¼•é›†åˆã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">5. ç´¢å¼•éªŒè¯ä¸å±æ€§</h4>
<ul>
<li>
<p><strong><code>h3IsValid(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šæ£€æŸ¥ä¸€ä¸ª long å€¼æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ H3 ç´¢å¼•ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3IsResClassIII(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šæ£€æŸ¥ç´¢å¼•æ˜¯å¦æ˜¯ â€œClass IIIâ€ åˆ†è¾¨ç‡ï¼ˆå¥‡æ•°åˆ†è¾¨ç‡ï¼‰çš„ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getHexAreaKm2(int resolution)</code>Â /Â <code>getHexAreaM2(int resolution)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç‰¹å®šåˆ†è¾¨ç‡çš„å…­è¾¹å½¢çš„å¹³å‡é¢ç§¯ï¼ˆå¹³æ–¹å…¬é‡Œæˆ–å¹³æ–¹ç±³ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getNumCells(int resolution)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–å…¨çƒåœ¨ç‰¹å®šåˆ†è¾¨ç‡ä¸‹çš„å…­è¾¹å½¢æ€»æ•°ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-7">geoToH3æ‰§è¡Œæ•ˆç‡å¦‚ä½•ï¼Œåº•å±‚å¦‚ä½•å®ç°</h2>
<p><code>geoToH3</code>Â çš„æ‰§è¡Œæ•ˆç‡éå¸¸é«˜ï¼Œé€šå¸¸å¯ä»¥è¾¾åˆ°Â <strong>å¾®ç§’çº§</strong>Â ç”šè‡³Â <strong>çº³ç§’çº§</strong>Â çš„å»¶è¿Ÿã€‚</p>
<p>è¿™æ„å‘³ç€åœ¨å•æ ¸CPUä¸Šï¼Œæ¯ç§’å¯ä»¥æ‰§è¡Œæ•°åä¸‡åˆ°ä¸Šç™¾ä¸‡æ¬¡çš„è½¬æ¢æ“ä½œã€‚è¿™å¯¹äºç»å¤§å¤šæ•°éœ€è¦å®æ—¶å¤„ç†æµ·é‡åœ°ç†ä½ç½®æ•°æ®çš„åº”ç”¨åœºæ™¯ï¼ˆå¦‚ç½‘çº¦è½¦æ´¾å•ã€å¤–å–é…é€ã€åœ°ç†å›´æ ã€å®æ—¶æ•°æ®åˆ†æï¼‰æ¥è¯´æ˜¯ç»°ç»°æœ‰ä½™çš„ã€‚</p>
<ul>
<li>
<p><strong>æ€§èƒ½åŸºå‡†</strong>ï¼šæ ¹æ® Uber å®˜æ–¹å’Œéå®˜æ–¹çš„æ€§èƒ½æµ‹è¯•ï¼Œåœ¨ç°ä»£CPUï¼ˆå¦‚ Intel Xeonï¼‰ä¸Šï¼Œå•æ¬¡Â <code>geoToH3</code>Â è°ƒç”¨çš„è€—æ—¶é€šå¸¸åœ¨Â <strong>100 ~ 300 çº³ç§’</strong>Â ä¹‹é—´ã€‚</p>
</li>
<li>
<p><strong>å½±å“å› ç´ </strong>ï¼š</p>
<ul>
<li><strong>åˆ†è¾¨ç‡</strong>ï¼šè½¬æ¢åˆ°ä¸åŒåˆ†è¾¨ç‡å¯¹æ€§èƒ½å½±å“æå°ï¼Œå› ä¸ºæ ¸å¿ƒç®—æ³•æ˜¯ä¸€è‡´çš„ã€‚</li>
<li><strong>CPU æ¶æ„å’Œä¸»é¢‘</strong>ï¼šç›´æ¥å½±å“è®¡ç®—é€Ÿåº¦ã€‚</li>
<li><strong>JVM çŠ¶æ€</strong>ï¼šåœ¨ HotSpot JVM ä¸­ï¼Œæ–¹æ³•ç»è¿‡ JIT ç¼–è¯‘ä¼˜åŒ–åï¼ˆæˆä¸ºæœ¬åœ°ä»£ç ï¼‰æ€§èƒ½ä¼šè¾¾åˆ°æœ€ä½³ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ç§æé«˜çš„æ€§èƒ½æ˜¯ H3 èƒ½å¤Ÿè¢«å¹¿æ³›åº”ç”¨äºå¤§æ•°æ®å’Œå®æ—¶ç³»ç»Ÿçš„å…³é”®åŸå› ä¹‹ä¸€ã€‚</p>
<hr/>
<h3 data-id="heading-8">åº•å±‚å®ç°åŸç†</h3>
<p><code>geoToH3</code>Â çš„åº•å±‚å®ç°æ˜¯ä¸€ä¸ªéå¸¸ç²¾å¦™çš„å‡ ä½•å­¦å’Œè®¡ç®—æœºå›¾å½¢å­¦ç®—æ³•ã€‚å®ƒçš„ç›®æ ‡æ˜¯å°†ä¸€ä¸ªçƒé¢åæ ‡ï¼ˆç»çº¬åº¦ï¼‰å¿«é€Ÿã€ç¡®å®šæ€§åœ°æ˜ å°„åˆ°ä¸€ä¸ªç‰¹å®šçš„å…­è¾¹å½¢ç½‘æ ¼ç´¢å¼•ä¸Šã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼š</p>
<ol>
<li><strong>çƒé¢åæ ‡ -&gt; ä¸‰ç»´ç¬›å¡å°”åæ ‡</strong></li>
<li><strong>ä¸‰ç»´åæ ‡ -&gt; é¢ç‰‡ç´¢å¼•ï¼ˆIJK åæ ‡ï¼‰</strong></li>
<li><strong>é¢ç‰‡ç´¢å¼• -&gt; H3 ç´¢å¼•ï¼ˆ64ä½æ•´æ•°ï¼‰</strong></li>
</ol>
<p>è®©æˆ‘ä»¬æ¥è¯¦ç»†æ‹†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<h4 data-id="heading-9">æ­¥éª¤ 1ï¼šåæ ‡ç³»ç»Ÿè½¬æ¢å’ŒæŠ•å½±</h4>
<ol>
<li>
<p><strong>è¾“å…¥</strong>ï¼šç»çº¬åº¦Â <code>(lat, lng)</code>ã€‚</p>
</li>
<li>
<p><strong>è½¬æ¢åˆ°ä¸‰ç»´å‘é‡</strong>ï¼šé¦–å…ˆå°†ç»çº¬åº¦è½¬æ¢ä¸ºä¸‰ç»´ç©ºé—´ä¸­çš„ä¸€ä¸ªå•ä½å‘é‡Â <code>(x, y, z)</code>ã€‚è¿™ä¸ªå‘é‡ä½äºä¸€ä¸ªåŠå¾„ä¸º1çš„â€œå•ä½çƒâ€ä¸Šã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç </span>
x = cos(lat) * cos(lng);
y = cos(lat) * sin(lng);
z = sin(lat);
</code></pre>
</li>
<li>
<p><strong>é€‰æ‹©æ­£äºŒåé¢ä½“é¢ç‰‡</strong>ï¼šH3 çš„æ ¸å¿ƒåŸºç¡€æ˜¯ä¸€ä¸ª<strong>å±•å¼€çš„æ­£äºŒåé¢ä½“</strong>ã€‚è¿™ä¸ªå¤šé¢ä½“æœ‰20ä¸ªæ­£ä¸‰è§’å½¢é¢ç‰‡ã€‚ç®—æ³•ä¼šå¿«é€Ÿç¡®å®šè¾“å…¥çš„ä¸‰ç»´å‘é‡æŒ‡å‘äº†è¿™20ä¸ªé¢ç‰‡ä¸­çš„å“ªä¸€ä¸ªã€‚è¿™æ˜¯ä¸€ä¸ªé€šè¿‡å‘é‡ä¸é¢ç‰‡æ³•å‘é‡ç‚¹ç§¯æ¥å®Œæˆçš„å¿«é€ŸæŸ¥æ‰¾è¿‡ç¨‹ã€‚</p>
</li>
</ol>
<h4 data-id="heading-10">æ­¥éª¤ 2ï¼šåœ¨é€‰å®šçš„é¢ç‰‡ä¸Šè¿›è¡Œå…­è¾¹å½¢åŒ–ç½‘æ ¼åˆ’åˆ†</h4>
<p>è¿™æ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„ä¸€æ­¥ã€‚ç®—æ³•éœ€è¦åœ¨é€‰å®šçš„é‚£ä¸ª<strong>ä¸‰è§’å½¢é¢ç‰‡</strong>ä¸Šï¼Œæ„å»ºä¸€ä¸ªç”±å…­è¾¹å½¢å’Œäº”è¾¹å½¢ç»„æˆçš„ç½‘æ ¼ã€‚</p>
<ol>
<li>
<p><strong>å°†ä¸‰è§’å½¢é¢ç‰‡å±•å¼€ä¸ºå¹³é¢</strong>ï¼šé€šè¿‡ä¸€ç§ç‰¹å®šçš„<strong>æ˜ å°„å‡½æ•°</strong>ï¼ˆå¦‚ gnomonic projection æˆ–è‡ªå®šä¹‰çš„ä»¿å°„å˜æ¢ï¼‰ï¼Œå°†ä¸‰ç»´ä¸‰è§’å½¢é¢ç‰‡ä¸Šçš„ç‚¹æŠ•å½±åˆ°ä¸€ä¸ªäºŒç»´å¹³é¢ä¸Šã€‚</p>
</li>
<li>
<p><strong>å®šä¹‰åˆ†è¾¨ç‡å’Œç½‘æ ¼</strong>ï¼šåœ¨æŠ•å½±åçš„äºŒç»´å¹³é¢ä¸Šï¼Œå®šä¹‰ä¸åŒåˆ†è¾¨ç‡ä¸‹çš„å…­è¾¹å½¢ç½‘æ ¼ã€‚æ¯ä¸ªåˆ†è¾¨ç‡éƒ½å¯¹åº”ä¸€ä¸ªæ›´ç»†ç²’åº¦çš„ç½‘æ ¼åˆ’åˆ†ã€‚</p>
</li>
<li>
<p><strong>è®¡ç®— IJ åæ ‡</strong>ï¼šå¯¹äºæŠ•å½±åˆ°äºŒç»´å¹³é¢ä¸Šçš„ç‚¹Â <code>(u, v)</code>ï¼Œç®—æ³•ä¼šè®¡ç®—å®ƒåœ¨å½“å‰åˆ†è¾¨ç‡ç½‘æ ¼ä¸­çš„Â <strong>IJ åæ ‡</strong>ã€‚è¿™å¯ä»¥æƒ³è±¡æˆåœ¨ä¸€ä¸ªç”±è®¸å¤šå°å…­è¾¹å½¢ç»„æˆçš„â€œæ£‹ç›˜â€ä¸Šï¼Œæ‰¾åˆ°ç‚¹Â <code>(u, v)</code>Â è½åœ¨äº†å“ªä¸ªæ ¼å­é‡Œã€‚</p>
<ul>
<li><strong>å…³é”®ç®—æ³•</strong>ï¼šè¿™é‡Œä½¿ç”¨äº†ä¸€ç§åŸºäºÂ  <strong>â€œè½´åæ ‡â€</strong> Â çš„ç½‘æ ¼ç³»ç»Ÿã€‚ç¡®å®šä¸€ä¸ªç‚¹å±äºå“ªä¸ªå…­è¾¹å½¢ï¼Œé€šå¸¸æ˜¯é€šè¿‡è®¡ç®—å®ƒä¸å„ä¸ªå…­è¾¹å½¢ä¸­å¿ƒç‚¹çš„è·ç¦»ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ç§æ›´é«˜æ•ˆçš„ã€åŸºäºå¹³é¢åˆ†å‰²çš„æŸ¥æ‰¾æ–¹æ³•ã€‚</li>
<li><strong>åº“å®ç°</strong>ï¼šåœ¨ H3 çš„ C è¯­è¨€åº•å±‚åº“ä¸­ï¼Œè¿™éƒ¨åˆ†æ˜¯é€šè¿‡é«˜åº¦ä¼˜åŒ–çš„ã€æ— åˆ†æ”¯æˆ–å°‘åˆ†æ”¯çš„æ•´æ•°è¿ç®—å’ŒæŸ¥æ‰¾è¡¨æ¥å®ç°çš„ï¼Œä»¥è¿½æ±‚æè‡´çš„æ€§èƒ½ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">æ­¥éª¤ 3ï¼šç¼–ç ä¸º H3Index</h4>
<p>ä¸€æ—¦å¾—åˆ°äº†Â <strong>é¢ç‰‡ç´¢å¼•</strong>Â å’Œè¯¥é¢ç‰‡å†…çš„Â <strong>IJ åæ ‡</strong>Â ä»¥åŠÂ <strong>åˆ†è¾¨ç‡</strong>ï¼Œæœ€åä¸€æ­¥å°±æ˜¯å°†å®ƒä»¬æ‰“åŒ…æˆä¸€ä¸ª 64 ä½çš„Â <code>long</code>Â å‹æ•´æ•°ï¼Œå³Â <code>H3Index</code>ã€‚</p>
<p><code>H3Index</code>Â çš„ 64 ä½ç»“æ„å¦‚ä¸‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<pre><code class="hljs language-text" lang="text">| 0 (1 bit) | Reserved (4 bits) | Mode (4 bits) | Resolution (4 bits) | Base Cell (7 bits) | å­å•å…ƒç´¢å¼• (3 bits * (15 - res)) | 0 (1 bit) |
</code></pre>
<ul>
<li><strong>Mode (4 bits)</strong> ï¼šæ ‡è¯†è¿™ä¸ªç´¢å¼•çš„ç±»å‹ï¼Œä¾‹å¦‚æ˜¯å¦æ˜¯å…­è¾¹å½¢å•å…ƒã€æœ‰å‘è¾¹ç­‰ã€‚å¯¹äºæ™®é€šçš„å…­è¾¹å½¢ï¼Œè¿™ä¸ªå€¼æ˜¯å›ºå®šçš„ã€‚</li>
<li><strong>Resolution (4 bits)</strong> ï¼šå­˜å‚¨åˆ†è¾¨ç‡ï¼ˆ0-15ï¼‰ã€‚</li>
<li><strong>Base Cell (7 bits)</strong> ï¼šå¯¹åº”æ­¥éª¤1ä¸­æ‰¾åˆ°çš„<strong>æ­£äºŒåé¢ä½“é¢ç‰‡</strong>ï¼ˆå®é™…ä¸Šæ˜¯ 122 ä¸ªåŸºç¡€ç»†èƒä¹‹ä¸€ï¼Œè¿™äº›åŸºç¡€ç»†èƒæ¥è‡ªäºå¯¹20ä¸ªé¢ç‰‡çš„è¿›ä¸€æ­¥åˆ’åˆ†ï¼‰ã€‚</li>
<li><strong>å­å•å…ƒç´¢å¼•</strong>ï¼šå‰©ä½™çš„ä½ç”¨äºå­˜å‚¨ä»åŸºç¡€ç»†èƒåˆ°ç›®æ ‡åˆ†è¾¨ç‡ç»†èƒè·¯å¾„ä¸Šçš„æ–¹å‘åºåˆ—ã€‚è¿™å°±åƒæ˜¯ä»ä¸€ä¸ªç²—ç²’åº¦çš„å…­è¾¹å½¢å¼€å§‹ï¼Œé€šè¿‡ä¸€ç³»åˆ—â€œä½ æ˜¯æˆ‘ç¬¬å‡ ä¸ªå­©å­â€çš„æŒ‡å‘ï¼Œæœ€ç»ˆç²¾ç¡®å®šä½åˆ°ç›®æ ‡å…­è¾¹å½¢ã€‚è¿™ç§è¡¨ç¤ºæ–¹æ³•éå¸¸ç´§å‡‘å’Œé«˜æ•ˆã€‚</li>
</ul>
<h3 data-id="heading-12">Java å±‚çš„å®ç°</h3>
<p>åœ¨ Java ä¸­ï¼Œæ‚¨ä½¿ç”¨çš„Â <code>com.uber.h3core.H3Core</code>Â åº“å®é™…ä¸Šæ˜¯ä¸€ä¸ªÂ <strong>JNI (Java Native Interface) åŒ…è£…å™¨</strong>ã€‚</p>
<ul>
<li>
<p><strong>æ ¸å¿ƒé€»è¾‘åœ¨ C è¯­è¨€ä¸­</strong>ï¼šæ‰€æœ‰ä¸Šè¿°å¤æ‚çš„å‡ ä½•è®¡ç®—å’Œç´¢å¼•ç”Ÿæˆç®—æ³•ï¼Œéƒ½æ˜¯ç”¨é«˜åº¦ä¼˜åŒ–çš„ C è¯­è¨€å®ç°çš„ï¼Œå¹¶ç¼–è¯‘ä¸ºæœ¬åœ°åŠ¨æ€åº“ï¼ˆå¦‚Â <code>.so</code>,Â <code>.dll</code>,Â <code>.dylib</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>Java å±‚æ˜¯è–„å°è£…</strong>ï¼š<code>H3Core</code>Â ç±»é€šè¿‡ JNI è°ƒç”¨è¿™äº›åº•å±‚çš„ C å‡½æ•°ã€‚å½“æ‚¨è°ƒç”¨Â <code>h3.geoToH3(lat, lng, res)</code>Â æ—¶ï¼š</p>
<ol>
<li>Java æ–¹æ³•å°†å‚æ•°Â <code>lat</code>,Â <code>lng</code>,Â <code>res</code>Â é€šè¿‡ JNI ä¼ é€’åˆ°æœ¬åœ°ä¾§ã€‚</li>
<li>æœ¬åœ°ä¾§çš„ C å‡½æ•°æ‰§è¡Œä¸Šè¿°ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ã€‚</li>
<li>è®¡ç®—ç»“æœï¼ˆä¸€ä¸ªÂ <code>uint64_t</code>ï¼‰é€šè¿‡ JNI è¿”å›ç»™ Java å±‚ï¼Œä½œä¸ºÂ <code>long</code>Â ç±»å‹ã€‚</li>
</ol>
</li>
</ul>
<p><strong>è¿™ç§æ¶æ„çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>æ€§èƒ½</strong>ï¼šå…³é”®è·¯å¾„ç”±é«˜æ•ˆçš„ C ä»£ç å¤„ç†ã€‚</li>
<li><strong>è·¨å¹³å°</strong>ï¼šåŒä¸€å¥— Java API å¯ä»¥åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œåªéœ€åŠ è½½å¯¹åº”çš„æœ¬åœ°åº“å³å¯ã€‚</li>
<li><strong>ç»´æŠ¤æ€§</strong>ï¼šæ ¸å¿ƒç®—æ³•åªæœ‰ä¸€ä»½ C å®ç°ï¼Œè¢«æ‰€æœ‰è¯­è¨€ï¼ˆJava, Python, Go, Rustç­‰ï¼‰çš„ç»‘å®šåº“å…±äº«ã€‚</li>
</ul>
<h3 data-id="heading-13">æ€»ç»“</h3>
<p><code>geoToH3</code>Â çš„é«˜æ•ˆæ€§æºäºï¼š</p>
<ol>
<li><strong>åŸºäºæ­£äºŒåé¢ä½“çš„å·§å¦™å»ºæ¨¡</strong>ï¼šç”¨20ä¸ªé¢ç‰‡è¿‘ä¼¼çƒé¢ï¼Œå°†å¤æ‚çš„çƒé¢å‡ ä½•é—®é¢˜åˆ†è§£ä¸º20ä¸ªæ›´ç®€å•çš„å¹³é¢é—®é¢˜ã€‚</li>
<li><strong>é«˜åº¦ä¼˜åŒ–çš„åº•å±‚ç®—æ³•</strong>ï¼šæ ¸å¿ƒè®¡ç®—ä½¿ç”¨ C è¯­è¨€å®ç°ï¼Œå¤§é‡ä½¿ç”¨æ•´æ•°è¿ç®—å’ŒæŸ¥æ‰¾è¡¨ï¼Œé¿å…äº†æ˜‚è´µçš„æµ®ç‚¹æ•°è¿ç®—å’Œå‡½æ•°è°ƒç”¨ã€‚</li>
<li><strong>ç´§å‡‘çš„ç´¢å¼•ç¼–ç </strong>ï¼šå°†å¤æ‚çš„ç©ºé—´å…³ç³»ç¼–ç ä¸ºä¸€ä¸ª 64 ä½æ•´æ•°ï¼Œä½¿å¾—å­˜å‚¨ã€ä¼ è¾“å’Œè®¡ç®—éƒ½éå¸¸é«˜æ•ˆã€‚</li>
<li><strong>JNI æ¶æ„</strong>ï¼šJava å±‚åªè´Ÿè´£ç®€å•çš„è°ƒç”¨å’Œå°è£…ï¼Œè®¡ç®—é‡ä»»ç”±æœ¬åœ°åº“æ‰¿æ‹…ã€‚</li>
</ol>
<p>æ­£æ˜¯è¿™äº›è®¾è®¡ï¼Œä½¿å¾— H3 æˆä¸ºä¸€ä¸ªåœ¨æ€§èƒ½å’ŒåŠŸèƒ½ä¸Šéƒ½æå…¶å‡ºè‰²çš„ç©ºé—´ç´¢å¼•å·¥å…·ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å‘éœ€æŒæ¡çš„çŸ¥è¯†ï¼šMQTTåè®®]]></title>    <link>https://juejin.cn/post/7582845425402757160</link>    <guid>https://juejin.cn/post/7582845425402757160</guid>    <pubDate>2025-12-13T06:29:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582845425402757160" data-draft-id="7572776177690083337" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å‘éœ€æŒæ¡çš„çŸ¥è¯†ï¼šMQTTåè®®"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-13T06:29:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰å¹´ä¹‹çº¦"/> <meta itemprop="url" content="https://juejin.cn/user/3448523142729784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å‘éœ€æŒæ¡çš„çŸ¥è¯†ï¼šMQTTåè®®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3448523142729784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰å¹´ä¹‹çº¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T06:29:28.000Z" title="Sat Dec 13 2025 06:29:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MQTTï¼ˆMessage Queuing Telemetry Transportï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„ã€åŸºäºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯ä¼ è¾“åè®®ï¼Œå¹¿æ³›ç”¨äºç‰©è”ç½‘ï¼ˆIoTï¼‰å’Œç§»åŠ¨åº”ç”¨ç­‰ä½å¸¦å®½ã€ä¸ç¨³å®šç½‘ç»œç¯å¢ƒä¸‹çš„æ¶ˆæ¯æ¨é€ã€‚ä»¥ä¸‹æ˜¯å…³äºMQTTåè®®æ¨é€çš„æ ¸å¿ƒæ¦‚å¿µã€å·¥ä½œåŸç†åŠå…³é”®ç‰¹æ€§çš„ç»“æ„åŒ–è¯´æ˜ï¼š</p>
<hr/>
<h3 data-id="heading-0"><strong>1. MQTTåè®®æ ¸å¿ƒè§’è‰²</strong></h3>
<ul>
<li><strong>å‘å¸ƒè€…ï¼ˆPublisherï¼‰</strong><br/>
å‘ç‰¹å®šä¸»é¢˜ï¼ˆTopicï¼‰å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼šä¼ æ„Ÿå™¨ä¸ŠæŠ¥æ•°æ®ã€‚</li>
<li><strong>è®¢é˜…è€…ï¼ˆSubscriberï¼‰</strong><br/>
è®¢é˜…æ„Ÿå…´è¶£çš„ä¸»é¢˜å¹¶æ¥æ”¶æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼šä»ªè¡¨ç›˜æ˜¾ç¤ºä¼ æ„Ÿå™¨æ•°æ®ã€‚</li>
<li><strong>ä»£ç†æœåŠ¡å™¨ï¼ˆBrokerï¼‰</strong><br/>
æ¥æ”¶ã€è½¬å‘æ¶ˆæ¯çš„æ ¸å¿ƒæœåŠ¡å™¨ï¼ˆå¦‚Mosquittoã€EMQXï¼‰ã€‚è´Ÿè´£ä¸»é¢˜ç®¡ç†ã€æ¶ˆæ¯è·¯ç”±ã€QoSæ§åˆ¶ç­‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-1"><strong>2. ä¸»é¢˜ï¼ˆTopicï¼‰ä¸æ¶ˆæ¯è·¯ç”±</strong></h3>
<ul>
<li>
<p><strong>Topicç»“æ„</strong><br/>
ä½¿ç”¨å±‚çº§è·¯å¾„æ ‡è¯†ï¼ˆå¦‚Â <code>home/room1/temperature</code>ï¼‰ï¼Œæ”¯æŒé€šé…ç¬¦ï¼š</p>
<ul>
<li><code>+</code>ï¼šå•å±‚é€šé…ç¬¦ï¼ˆ<code>home/+/temperature</code>Â åŒ¹é…æ‰€æœ‰æˆ¿é—´æ¸©åº¦ï¼‰ã€‚</li>
<li><code>#</code>ï¼šå¤šå±‚é€šé…ç¬¦ï¼ˆ<code>home/#</code>Â åŒ¹é…æ‰€æœ‰å­ä¸»é¢˜ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ¶ˆæ¯è·¯ç”±</strong><br/>
Brokeræ ¹æ®Topicå°†æ¶ˆæ¯æ¨é€ç»™æ‰€æœ‰è®¢é˜…äº†è¯¥Topicçš„å®¢æˆ·ç«¯ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-2"><strong>3. æ¶ˆæ¯æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰</strong></h3>

























<table><thead><tr><th>QoSç­‰çº§</th><th>æè¿°</th><th>åœºæ™¯ç¤ºä¾‹</th></tr></thead><tbody><tr><td>0</td><td>æœ€å¤šä¸€æ¬¡ï¼Œä¸ä¿è¯é€è¾¾ï¼ˆFire-and-Forgetï¼‰</td><td>å®æ—¶ä¼ æ„Ÿå™¨æ•°æ®æµ</td></tr><tr><td>1</td><td>è‡³å°‘ä¸€æ¬¡ï¼Œå¯èƒ½é‡å¤ï¼ˆBrokeréœ€å›å¤ACKï¼‰</td><td>ç¡®ä¿è®¾å¤‡æŒ‡ä»¤åˆ°è¾¾</td></tr><tr><td>2</td><td>æ°å¥½ä¸€æ¬¡ï¼Œä¸¥æ ¼ä¸é‡ä¸ä¸¢ï¼ˆéœ€ä¸¤æ¬¡æ¡æ‰‹ï¼‰</td><td>é‡‘èäº¤æ˜“ã€é«˜æ•æ„Ÿæ“ä½œ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3"><strong>4. æ¨é€æµç¨‹ç¤ºä¾‹</strong></h3>
<ol>
<li><strong>è¿æ¥</strong><br/>
å®¢æˆ·ç«¯é€šè¿‡TCP/IPè¿æ¥Brokerï¼Œä½¿ç”¨ç”¨æˆ·å/å¯†ç æˆ–Tokené‰´æƒï¼ˆå¯é…ç½®TLSåŠ å¯†ï¼‰ã€‚</li>
<li><strong>è®¢é˜…</strong><br/>
Subscriberè®¢é˜…Topicï¼ˆå¦‚Â <code>home/room1/+</code>ï¼‰ï¼ŒBrokerä¿ç•™å…¶è®¢é˜…å…³ç³»ã€‚</li>
<li><strong>å‘å¸ƒ</strong><br/>
Publisherå‘é€æ¶ˆæ¯è‡³Brokerï¼ŒåŒ…å«Topicå’ŒPayloadã€‚</li>
<li><strong>æ¨é€</strong><br/>
Brokerå°†æ¶ˆæ¯æ¨é€ç»™æ‰€æœ‰è®¢é˜…è€…ï¼Œæ ¹æ®QoSç­‰å¾…ACKæˆ–é‡è¯•ã€‚</li>
<li><strong>æ–­è¿</strong><br/>
æ”¯æŒé—å˜±æ¶ˆæ¯ï¼ˆLast Willï¼‰æœºåˆ¶ï¼Œå®¢æˆ·ç«¯æ–­è¿æ—¶Brokerä¸»åŠ¨æ¨é€é¢„è®¾æ¶ˆæ¯ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-4"><strong>5. å…³é”®ç‰¹æ€§</strong></h3>
<ul>
<li><strong>ä½å»¶è¿Ÿä¸ä½å¸¦å®½</strong><br/>
åè®®å¤´ä»…2å­—èŠ‚ï¼Œé€‚åˆåµŒå…¥å¼è®¾å¤‡ã€‚</li>
<li><strong>ä¼šè¯ä¿æŒï¼ˆPersistent Sessionï¼‰</strong><br/>
Brokerä¿å­˜ç¦»çº¿å®¢æˆ·ç«¯çš„è®¢é˜…å…³ç³»å’Œæœªæ¥æ”¶æ¶ˆæ¯ï¼ˆéœ€Clean Session=0ï¼‰ã€‚</li>
<li><strong>åŒå‘é€šä¿¡</strong><br/>
è®¢é˜…è€…ä¹Ÿå¯å‘å¸ƒæ¶ˆæ¯ï¼Œæ”¯æŒè¯·æ±‚/å“åº”æ¨¡å¼ã€‚</li>
<li><strong>å®‰å…¨æœºåˆ¶</strong><br/>
æ”¯æŒTLS/SSLåŠ å¯†ã€OAuth2.0ã€å®¢æˆ·ç«¯è¯ä¹¦ç­‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5"><strong>6. å…¸å‹åº”ç”¨åœºæ™¯</strong></h3>
<ul>
<li><strong>ç‰©è”ç½‘è®¾å¤‡é¥æµ‹</strong><br/>
ä¼ æ„Ÿå™¨å®æ—¶æ•°æ®ä¸Šä¼ è‡³äº‘ç«¯åˆ†æã€‚</li>
<li><strong>ç§»åŠ¨æ¨é€é€šçŸ¥</strong><br/>
åº”ç”¨é€šè¿‡MQTTå®ç°ä½åŠŸè€—æ¨é€ï¼ˆå¯¹æ¯”HTTPé•¿è½®è¯¢ï¼‰ã€‚</li>
<li><strong>å·¥ä¸šè®¾å¤‡ç›‘æ§</strong><br/>
å·¥å‚è®¾å¤‡çŠ¶æ€å®æ—¶æ¨é€åˆ°ç›‘æ§å¤§å±ã€‚</li>
</ul>
<h3 data-id="heading-6"><strong>6. MQTTä¸MQå¯¹æ¯”</strong></h3>
<p>ä»¥ä¸‹æ˜¯MQTTä¸å¸¸è§ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Â <strong>RabbitMQã€Kafkaã€RocketMQ</strong>ï¼‰çš„å¯¹æ¯”ï¼Œä»Javaå¼€å‘è§†è§’æ•´ç†å…³é”®å·®å¼‚ç‚¹ï¼š</p>
































































































<table><thead><tr><th><strong>ç»´åº¦</strong></th><th><strong>MQTT</strong></th><th><strong>ä¼ ç»ŸMQï¼ˆRabbitMQ/Kafka/RocketMQï¼‰</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td><strong>è®¾è®¡ç›®æ ‡</strong></td><td>ä½åŠŸè€—ã€å¼±ç½‘ç¯å¢ƒï¼Œè®¾å¤‡ç«¯-äº‘ç«¯é€šä¿¡</td><td>é«˜ååã€ä¼ä¸šçº§æœåŠ¡å™¨é—´é€šä¿¡</td><td>MQTTçš„<code>IoTåœºæ™¯</code>Â vs MQçš„<code>å¤§æ•°æ®/å¾®æœåŠ¡åœºæ™¯</code></td></tr><tr><td><strong>åè®®å¤´å¤§å°</strong></td><td>æœ€å°2å­—èŠ‚ï¼ˆæ— æ¶ˆæ¯ä½“æ—¶ï¼‰</td><td>å¤æ‚åè®®å¤´ï¼š â€¢ AMQP(KBçº§) â€¢ Kafka(åŠ¨æ€)</td><td>MQTTåœ¨ç§»åŠ¨ç½‘ç»œä¸‹æ˜¾è‘—é™ä½æµé‡æ¶ˆè€—</td></tr><tr><td><strong>è¿æ¥æ–¹å¼</strong></td><td>é•¿è¿æ¥ï¼ˆåŸºäºTCP/IPï¼‰</td><td>é•¿è¿æ¥ï¼ˆTCPï¼‰æˆ–çŸ­è¿æ¥ï¼ˆHTTPï¼‰</td><td>MQTTçš„<code>Keep-Alive</code>æœºåˆ¶æ›´çœç”µ</td></tr><tr><td><strong>é€šä¿¡æ¨¡å‹</strong></td><td>ä¸¥æ ¼<strong>å‘å¸ƒ/è®¢é˜…</strong>ï¼ŒTopicå¤šå¯¹å¤š</td><td>å¤šæ ·åŒ–æ¨¡å‹ï¼š â€¢ Queueç‚¹å¯¹ç‚¹ â€¢ Exchange Pub/Sub â€¢ Kafka Stream</td><td>MQçš„æ¨¡å‹æ›´çµæ´»ï¼Œä½†éœ€å¤æ‚é…ç½®ï¼ˆå¦‚Kafkaåˆ†åŒºã€RabbitMQ Exchangeç»‘å®šï¼‰</td></tr><tr><td><strong>æœåŠ¡è´¨é‡(QoS)</strong></td><td>0/1/2ä¸‰çº§ï¼Œåè®®å±‚ä¿è¯</td><td>ä¾èµ–ä¸šåŠ¡å±‚å®ç°ï¼ˆå¦‚Kafkaçš„<code>acks=all</code>+ç”Ÿäº§æ¶ˆè´¹ç¡®è®¤ï¼‰</td><td>MQTT QoSå¯¹Javaå¼€å‘è€…æ›´é€æ˜ï¼Œå‡å°‘ä¸šåŠ¡ä»£ç </td></tr><tr><td><strong>å®æ—¶æ€§</strong></td><td><strong>æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€</strong>ï¼Œå»¶è¿Ÿå¯ä½è‡³100ms</td><td>æ¶ˆè´¹è€…éœ€ä¸»åŠ¨æ‹‰å–ï¼ˆPollï¼‰ï¼Œå»¶è¿Ÿé€šå¸¸100ms-1s</td><td>MQTTé€‚åˆ<code>ç§»åŠ¨ç«¯é€šçŸ¥</code>ã€<code>å®æ—¶ç›‘æ§</code></td></tr><tr><td><strong>æ¶ˆæ¯ä¿åº</strong></td><td>ä»…æ”¯æŒå•ä¸»é¢˜å†…æœ‰åº</td><td>Kafkaï¼šåˆ†åŒºå†…ä¸¥æ ¼æœ‰åº RabbitMQï¼šéœ€å…¨å±€é˜Ÿåˆ—</td><td>MQåœ¨<code>äº¤æ˜“æµæ°´</code>ç­‰åœºæ™¯æœ‰ä¼˜åŠ¿</td></tr><tr><td><strong>ååé‡</strong></td><td>å•Brokeræ”¯æŒ10K-100Kçº§æ¶ˆæ¯/ç§’</td><td>Kafkaå¯æ”¯æŒç™¾ä¸‡çº§/ç§’ï¼ŒRabbitMQ 10K-50K/ç§’</td><td>MQåœ¨<code>æ—¥å¿—æ”¶é›†</code>ã€<code>æ•°æ®ç®¡é“</code>åœºæ™¯æ›´ä¼˜</td></tr><tr><td><strong>æ¶ˆæ¯å¤§å°</strong></td><td>æœ€å¤§256MBï¼Œä½†æ¨è&lt;1MBï¼ˆé¿å…å¼±ç½‘é˜»å¡ï¼‰</td><td>æ”¯æŒè¶…å¤§æ¶ˆæ¯ï¼š â€¢ Kafkaé»˜è®¤1MB-10MB â€¢ RabbitMQæ— é™åˆ¶</td><td>MQTTä¼˜å…ˆä¼˜åŒ–å°åŒ…åœºæ™¯</td></tr><tr><td><strong>å®¢æˆ·ç«¯èµ„æºå ç”¨</strong></td><td>æä½ï¼ˆPaho Javaåº“ä»…50KB-100KBï¼‰</td><td>è¾ƒé«˜ï¼š â€¢ Kafkaå®¢æˆ·ç«¯å †å†…å­˜&gt;100MB â€¢ Spring AMQPéœ€å¤šæ¨¡å—ä¾èµ–</td><td>MQTTé€‚åˆ<code>åµŒå…¥å¼Java</code>ï¼ˆå¦‚Android Appï¼‰</td></tr><tr><td><strong>æ–­è¿æ¢å¤</strong></td><td>è‡ªåŠ¨ï¼š â€¢ QoS1/2é‡ä¼  â€¢ Persistent Session</td><td>éœ€æ‰‹åŠ¨ï¼š â€¢ Kafkaï¼šRebalanceç›‘å¬ â€¢ RabbitMQï¼šæ¶ˆè´¹è€…æ¢å¤ç›‘å¬</td><td>MQTTå¼±ç½‘ä¸‹å¯¹Javaå¼€å‘è€…æ›´å‹å¥½</td></tr><tr><td><strong>ä¸»é¢˜ç®¡ç†</strong></td><td>åŠ¨æ€Topicï¼ˆæ— éœ€é¢„åˆ›å»ºï¼‰</td><td>éœ€é¢„å£°æ˜ï¼š â€¢ Exchange/Queue â€¢ Kafka Topic</td><td>MQTTçš„Javaä»£ç æ— éœ€ç®¡ç†Topicç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td><strong>å®‰å…¨æœºåˆ¶</strong></td><td>æ”¯æŒTLS/SSLï¼Œè®¤è¯ç®€å•ï¼ˆç”¨æˆ·å/Tokenï¼‰</td><td>å¤æ‚ï¼š â€¢ Kafkaï¼šSASL/Kerberos â€¢ RabbitMQï¼šOAuth2+Policy</td><td>MQçš„å®‰å…¨åŠŸèƒ½é€‚åˆ<code>ä¼ä¸šçº§ç³»ç»Ÿ</code></td><td/></tr><tr><td><strong>é€‚ç”¨Javaåœºæ™¯</strong></td><td>â€¢ IoTè®¾å¤‡ç®¡ç† â€¢ ç§»åŠ¨æ¨é€ â€¢ è·¨å…¬ç½‘é€šä¿¡</td><td>â€¢ å¾®æœåŠ¡è§£è€¦ â€¢ å¤§æ•°æ®ç®¡é“ â€¢ é‡‘èçº§äº‹åŠ¡</td><td>ä¸¤è€…å¯ç»“åˆä½¿ç”¨ï¼ˆå¦‚è®¾å¤‡â†’MQTTâ†’Kafkaâ†’åˆ†æï¼‰</td></tr></tbody></table>
<hr/>
<p>ä»¥ä¸‹æ˜¯<strong>å¼±ç½‘åœºæ™¯</strong>çš„MQTTä¸MQå¯¹æ¯”ï¼š</p>





















































<table><thead><tr><th><strong>å¼±ç½‘é—®é¢˜</strong></th><th><strong>MQTTçš„è§£å†³æ–¹æ¡ˆ</strong></th><th><strong>ä¼ ç»ŸMQçš„å±€é™æ€§</strong></th><th><strong>å¯¹Javaå¼€å‘è€…çš„æ„ä¹‰</strong></th></tr></thead><tbody><tr><td><strong>æ¶ˆæ¯ä¸¢å¤±ï¼ˆç½‘ç»œä¸­æ–­ï¼‰</strong></td><td>â€¢Â <strong>QoS1/2</strong>ï¼šåè®®å±‚è‡ªåŠ¨é‡ä¼  â€¢Â <strong>Persistent Session</strong>ï¼šæ–­ç½‘åBrokerä¿ç•™ç¦»çº¿æ¶ˆæ¯ï¼ˆè®¢é˜…è€…æ¢å¤åè¡¥å‘ï¼‰ â€¢Â <strong>æœ¬åœ°æŒä¹…åŒ–</strong>ï¼šPahoå®¢æˆ·ç«¯æœ¬åœ°ç£ç›˜ç¼“å­˜æ¶ˆæ¯</td><td>â€¢ ä¾èµ–ä¸šåŠ¡å±‚é‡è¯•ï¼ˆå¦‚Kafkaçš„<code>retries=3</code>ï¼‰ â€¢ æ–­è¿åæœªæ¶ˆè´¹æ¶ˆæ¯éœ€ä¾èµ–å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚Redisï¼‰ â€¢ æ¶ˆè´¹è€…éœ€ç›‘å¬<code>ConsumerRebalance</code>äº‹ä»¶æ‰‹åŠ¨æ¢å¤æ¶ˆè´¹</td><td>å‡å°‘Javaä»£ç ä¸­<strong>æ‰‹åŠ¨å®ç°é‡è¯•ã€æ–­è¿æ¢å¤</strong>çš„å¤æ‚åº¦ï¼ŒMQTTåè®®å±‚è‡ªåŠ¨å¤„ç†ï¼Œå¼€å‘è€…åªéœ€é…ç½®QoSå‚æ•°å’Œä¼šè¯æ¨¡å¼</td></tr><tr><td><strong>å»¶è¿Ÿæ•æ„Ÿï¼ˆé«˜æŠ–åŠ¨ï¼‰</strong></td><td>â€¢Â <strong>é•¿è¿æ¥+å¿ƒè·³</strong>ï¼šæŒç»­ä¿æ´»ï¼Œé¿å…é‡å»ºTCP â€¢Â <strong>ä¸»åŠ¨æ¨é€</strong>ï¼šæœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯æ— å»¶è¿Ÿ â€¢Â <strong>åŠ¨æ€QoS</strong>ï¼šç½‘ç»œå·®æ—¶å¯è‡ªåŠ¨é™çº§ï¼ˆå¦‚QoS2â†’1ï¼‰</td><td>â€¢Â <strong>çŸ­è¿æ¥è½®è¯¢</strong>ï¼šHTTPæ¨¡å¼å¢åŠ å»¶è¿Ÿï¼ˆå¦‚RabbitMQçš„Web STOMPï¼‰ â€¢Â <strong>æ‹‰å–æ¨¡å¼</strong>ï¼š<code>poll()</code>é—´éš”å¯¼è‡´å»¶è¿Ÿï¼ˆKafkaæœ€å°é—´éš”500msï¼‰</td><td>Javaå®¢æˆ·ç«¯æ— éœ€å¤æ‚é€»è¾‘å³å¯å®ç°<strong>ä½å»¶è¿Ÿé€šä¿¡</strong>ï¼Œå°¤å…¶åœ¨ç§»åŠ¨è®¾å¤‡ï¼ˆå¦‚Android Appï¼‰ä¸­æ˜¾è‘—ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</td></tr><tr><td><strong>é¢‘ç¹æ–­è¿ï¼ˆç½‘ç»œåˆ‡æ¢ï¼‰</strong></td><td>â€¢Â <strong>é—å˜±æ¶ˆæ¯</strong>ï¼šæ–­è¿æ—¶Brokerè‡ªåŠ¨é€šçŸ¥ï¼ˆå¦‚<code>device/123/offline</code>ï¼‰ â€¢Â <strong>ä¼šè¯ä¿æŒ</strong>ï¼šå¿«é€Ÿé‡è¿åæ¢å¤è®¢é˜…çŠ¶æ€ï¼ˆæ— éœ€é‡å¤è®¢é˜…ï¼‰</td><td>â€¢ éœ€ä¸šåŠ¡å±‚ç›‘å¬<code>connection_closed</code>äº‹ä»¶ â€¢ æ–­è¿åéœ€æ‰‹åŠ¨é‡å»ºèµ„æºï¼ˆå¦‚Kafkaçš„<code>consumer.seek()</code>é‡æ–°å®šä½ï¼‰</td><td>é€šè¿‡MQTTçš„<strong>è‡ªåŠ¨æ–­è¿æ£€æµ‹ä¸é€šçŸ¥</strong>ï¼ŒJavaå¼€å‘åªéœ€å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€å¼€å‘å¿ƒè·³æ£€æµ‹ã€èµ„æºé‡å»ºç­‰é€šç”¨é€»è¾‘</td></tr><tr><td><strong>å°åŒ…é«˜é¢‘ï¼ˆå¸¦å®½æœ‰é™ï¼‰</strong></td><td>â€¢Â <strong>æç®€åè®®å¤´</strong>ï¼šæœ€å°2å­—èŠ‚ï¼ˆvs AMQP/Kafkaçš„KBçº§ï¼‰ â€¢Â <strong>æ¶ˆæ¯åˆå¹¶</strong>ï¼šå•æ¬¡TCPå‘é€å¤šä¸ªæ¶ˆæ¯</td><td>â€¢ å›ºå®šåè®®å¤´å¤§ï¼ˆå¦‚Kafkaæ¯æ¡æ¶ˆæ¯å›ºå®šå…ƒæ•°æ®ï¼‰ â€¢ å¤šæ¶ˆæ¯éœ€æ‰¹é‡ï¼ˆå¦‚Kafka Producerçš„<code>batch.size</code>ï¼‰</td><td>åœ¨4G/WiFiæ··åˆç½‘ç»œä¸­ï¼ŒMQTTçš„<strong>å°æ•°æ®åŒ…</strong>é™ä½æµé‡æ¶ˆè€—ï¼ŒJavaä¸šåŠ¡å±‚æ— éœ€æ‰‹åŠ¨ä¼˜åŒ–</td></tr><tr><td><strong>æœåŠ¡ç«¯å‹åŠ›å¤§ï¼ˆæµ·é‡å¼±ç½‘è®¾å¤‡ï¼‰</strong></td><td>â€¢Â <strong>Brokeråˆ†å±‚é›†ç¾¤</strong>ï¼šEMQXæ”¯æŒç™¾ä¸‡çº§è¿æ¥ â€¢Â <strong>ä½å¿ƒè·³é¢‘ç‡</strong>ï¼šæ”¯æŒ90-120ç§’é•¿å¿ƒè·³é—´éš”</td><td>â€¢ å¤§é‡é•¿è¿æ¥æ¶ˆè€—å†…å­˜ï¼ˆå¦‚Kafkaå•è¿æ¥éœ€2MBï¼‰ â€¢ å¿«é€Ÿé‡è¿å¯¼è‡´è´Ÿè½½å³°å€¼ï¼ˆå¦‚RabbitMQçš„TCPæ´ªæ°´ï¼‰</td><td>JavaæœåŠ¡å¯é€šè¿‡<strong>æ¨ªå‘æ‰©å±•MQTT Broker</strong>åº”å¯¹è®¾å¤‡æš´å¢ï¼Œè€Œä¼ ç»ŸMQéœ€é¢„å…ˆè®¡ç®—åˆ†åŒº/é˜Ÿåˆ—æ•°é‡ï¼Œå¼¹æ€§ä¸è¶³</td></tr><tr><td><strong>å¼±ç½‘é˜»å¡ï¼ˆæ¶ˆæ¯ç§¯å‹ï¼‰</strong></td><td>â€¢Â <strong>Max Inflighté™åˆ¶</strong>ï¼šæ§åˆ¶å•å®¢æˆ·ç«¯æœªACKæ¶ˆæ¯æ•°ï¼ˆé»˜è®¤20ï¼‰ â€¢Â <strong>Backoffç­–ç•¥</strong>ï¼šè‡ªåŠ¨é€€é¿é‡ä¼ ï¼ˆå¦‚60ç§’ï¼‰</td><td>â€¢ éœ€æ‰‹åŠ¨é…ç½®æ¶ˆè´¹è€…é™æµï¼ˆå¦‚RabbitMQçš„<code>prefetch_count</code>ï¼‰ â€¢ ç§¯å‹åéœ€ç›‘æ§Consumer Lagï¼ˆå¦‚Kafkaçš„JMXï¼‰</td><td>é€šè¿‡<code>setMaxInflight(50)</code>ç­‰å‚æ•°ï¼ŒJavaå¼€å‘è€…<strong>ä¸€é”®æ§åˆ¶å¼±ç½‘ä¸‹çš„å†…å­˜å ç”¨</strong>ï¼Œæ— éœ€è‡ªå·±å®ç°æ¶ˆæ¯å †ç§¯å¤„ç†é€»è¾‘</td></tr><tr><td><strong>å®‰å…¨æ¡æ‰‹å¤±è´¥ï¼ˆé«˜å»¶è¿ŸSSLï¼‰</strong></td><td>â€¢Â <strong>TLSä¼šè¯å¤ç”¨</strong>ï¼šå‡å°‘æ¡æ‰‹æ¬¡æ•° â€¢Â <strong>å¼±ç½‘ä¼˜åŒ–Cipher</strong>ï¼šæ”¯æŒä½è®¡ç®—é‡ç®—æ³•ï¼ˆå¦‚<code>TLS_PSK</code>ï¼‰</td><td>â€¢ å®Œæ•´SSLæ¡æ‰‹è€—æ—¶1-2ç§’ï¼ˆé«˜å»¶è¿Ÿä¸‹æ˜“å¤±è´¥ï¼‰ â€¢ éœ€æ‰‹åŠ¨è°ƒæ•´SSLå‚æ•°ï¼ˆå¦‚Kafkaçš„<code>ssl.enabled.protocols</code>ï¼‰</td><td>MQTTçš„<strong>è½»é‡çº§åŠ å¯†</strong>é€‚åº”å¼±ç½‘ï¼ŒJavaä»£ç ä¸­ä»…éœ€é…ç½®<code>SSLContext</code>ï¼Œæ— éœ€é¢å¤–ä¼˜åŒ–</td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[K8S ä¸­ä½¿ç”¨ YAML å®‰è£… ECK]]></title>    <link>https://juejin.cn/post/7582769411994583092</link>    <guid>https://juejin.cn/post/7582769411994583092</guid>    <pubDate>2025-12-12T14:53:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582769411994583092" data-draft-id="7582776967818100736" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="K8S ä¸­ä½¿ç”¨ YAML å®‰è£… ECK"/> <meta itemprop="keywords" content="Elasticsearch,Kubernetes"/> <meta itemprop="datePublished" content="2025-12-12T14:53:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°é™ˆè¿ç»´"/> <meta itemprop="url" content="https://juejin.cn/user/3315782802482007"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            K8S ä¸­ä½¿ç”¨ YAML å®‰è£… ECK
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3315782802482007/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°é™ˆè¿ç»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T14:53:37.000Z" title="Fri Dec 12 2025 14:53:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">K8S ä¸­ä½¿ç”¨ YAML å®‰è£… ECK</h2>
<p>Kubernetes æ˜¯ç›®å‰æœ€å—æ¬¢è¿çš„å®¹å™¨ç¼–æ’æŠ€æœ¯ï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨å¼€å§‹å¾€ Kubernetes ä¸­è¿ç§»ã€‚Kubernetes ç°æœ‰çš„ ReplicaSetã€Deploymentã€Service ç­‰èµ„æºå¯¹è±¡å·²ç»å¯ä»¥æ»¡è¶³æ— çŠ¶æ€åº”ç”¨å¯¹äºè‡ªåŠ¨æ‰©ç¼©å®¹ã€è´Ÿè½½å‡è¡¡ç­‰åŸºæœ¬éœ€æ±‚ã€‚ä½†æ˜¯å¯¹äºæœ‰çŠ¶æ€çš„ã€åˆ†å¸ƒå¼çš„åº”ç”¨ï¼Œé€šå¸¸æ‹¥æœ‰å„è‡ªçš„ä¸€å¥—æ¨¡å‹å®šä¹‰è§„èŒƒï¼Œä¾‹å¦‚ Prometheusï¼ŒEtcdï¼ŒZookeeperï¼ŒElasticsearch ç­‰ç­‰ã€‚éƒ¨ç½²è¿™äº›åˆ†å¸ƒå¼åº”ç”¨å¾€å¾€éœ€è¦ç†Ÿæ‚‰ç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†ï¼Œå¹¶ä¸”åœ¨æ‰©ç¼©å®¹å’Œå‡çº§æ—¶éœ€è¦è€ƒè™‘å¦‚ä½•ä¿è¯åº”ç”¨æœåŠ¡çš„å¯ç”¨æ€§ç­‰é—®é¢˜ã€‚ä¸ºäº†ç®€åŒ–æœ‰çŠ¶æ€ã€åˆ†å¸ƒå¼åº”ç”¨çš„éƒ¨ç½²ï¼ŒKubernetes Operator åº”è¿è€Œç”Ÿã€‚</p>
<p>Kubernetes Operator æ˜¯ä¸€ç§ç‰¹å®šçš„åº”ç”¨æ§åˆ¶å™¨ï¼Œé€šè¿‡ CRDï¼ˆCustom Resource Definitionsï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰æ‰©å±• Kubernetes API çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºã€é…ç½®å’Œç®¡ç†ç‰¹å®šçš„æœ‰çŠ¶æ€åº”ç”¨ï¼Œè€Œä¸éœ€è¦ç›´æ¥å»ä½¿ç”¨ Kubernetes ä¸­æœ€åŸå§‹çš„ä¸€äº›èµ„æºå¯¹è±¡ï¼Œæ¯”å¦‚ Podï¼ŒDeploymentï¼ŒService ç­‰ç­‰ã€‚</p>
<p>Elastic Cloud on Kubernetesï¼ˆECKï¼‰ æ˜¯å…¶ä¸­çš„ä¸€ç§ Kubernetes Operatorï¼Œæ–¹ä¾¿æˆ‘ä»¬ç®¡ç† Elastic Stack å®¶æ—ä¸­çš„å„ç§ç»„ä»¶ï¼Œä¾‹å¦‚ Elasticsearchï¼ŒKibanaï¼ŒAPMï¼ŒBeats ç­‰ç­‰ã€‚æ¯”å¦‚åªéœ€è¦å®šä¹‰ä¸€ä¸ª Elasticsearch ç±»å‹çš„ CRD å¯¹è±¡ï¼ŒECK å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»ºå‡ºä¸€å¥— Elasticsearch é›†ç¾¤ã€‚</p>
<h3 data-id="heading-1">ä½¿ç”¨createå®‰è£…Elasticçš„è‡ªå®šä¹‰èµ„æºå®šä¹‰</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl create -f https://download.elastic.co/downloads/eck/3.2.0/crds.yaml
customresourcedefinition.apiextensions.k8s.io/agents.agent.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/apmservers.apm.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/beats.beat.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/elasticmapsservers.maps.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/elasticsearchautoscalers.autoscaling.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/elasticsearches.elasticsearch.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/enterprisesearches.enterprisesearch.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/kibanas.kibana.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/logstashes.logstash.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/stackconfigpolicies.stackconfigpolicy.k8s.elastic.co created
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-2">ä½¿ç”¨kubectl apply å®‰è£…operatoråŠå…¶RBACè§„åˆ™</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl apply -f https://download.elastic.co/downloads/eck/3.2.0/operator.yaml
namespace/elastic-system created
serviceaccount/elastic-operator created
secret/elastic-webhook-server-cert created
configmap/elastic-operator created
clusterrole.rbac.authorization.k8s.io/elastic-operator created
clusterrole.rbac.authorization.k8s.io/elastic-operator-view created
clusterrole.rbac.authorization.k8s.io/elastic-operator-edit created
clusterrolebinding.rbac.authorization.k8s.io/elastic-operator created
service/elastic-webhook-server created
statefulset.apps/elastic-operator created
validatingwebhookconfiguration.admissionregistration.k8s.io/elastic-webhook.k8s.elastic.co created
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-3">æŸ¥çœ‹æ˜¯å¦å¯åŠ¨å®Œæˆ</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]kubectl get -n elastic-system pods
NAME                 READY   STATUS    RESTARTS   AGE
elastic-operator-0   1/1     Running   0          8m38s
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-4">å¯åŠ¨éƒ¨ç½²</h3>
<p>Operatorè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†Kubernetesèµ„æºï¼Œä»¥å®ç°Elasticsearché›†ç¾¤çš„æœŸæœ›çŠ¶æ€ã€‚å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´æ‰èƒ½åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶å‡†å¤‡å¥½ä½¿ç”¨ç¾¤é›†ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: quickstart
spec:
  version: 9.2.2
  nodeSets:
  - name: default
    count: 1
    config:
      node.store.allow_mmap: false
EOF
</code></pre>
<h3 data-id="heading-5">å­˜å‚¨ç”¨é‡</h3>
<p>åˆ›å»ºæ—¶é»˜è®¤ä¸º1Gå­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥åœ¨åˆ›å»ºæ—¶é…ç½®ç”³æ˜ç©ºé—´</p>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: quickstart
spec:
  version: 9.2.2
  nodeSets:
  - name: default
    count: 1
    volumeClaimTemplates:
    - metadata:
        name: elasticsearch-data
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 5Gi
        storageClassName: nfs-storage
    config:
      node.store.allow_mmap: false
EOF
</code></pre>
<h3 data-id="heading-6">æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# kubectl get pod -A
NAMESPACE        NAME                                       READY   STATUS    RESTARTS            AGE
default          nginx-66686b6766-tdwt2                     1/1     Running   2 (&lt;invalid&gt; ago)   81d
default          quickstart-es-default-0                    0/1     Pending   0                   2m1s
elastic-system   elastic-operator-0                         1/1     Running   0                   12m
kube-system      calico-kube-controllers-78dcb7b647-8f2ph   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      calico-node-hpwvr                          1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      coredns-6746f4cb74-bhkv8                   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      metrics-server-55c56cb875-bwbpr            1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      node-local-dns-nz4q7                       1/1     Running   2 (&lt;invalid&gt; ago)   81d
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-7">æŸ¥çœ‹æ—¥å¿—</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl logs -f quickstart-es-default-0
Defaulted container "elasticsearch" out of: elasticsearch, elastic-internal-init-filesystem (init), elastic-internal-suspend (init)
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-8">å®‰è£…NFSåŠ¨æ€æŒ‚è½½</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# yum  install  nfs-utils -y
[root@k8s-192-168-1-140 ~]# mkdir /nfs
[root@k8s-192-168-1-140 ~]#  vim /etc/exports
/nfs *(rw,sync,no_root_squash,no_subtree_check)

[root@k8s-192-168-1-140 ~]# systemctl restart rpcbind
[root@k8s-192-168-1-140 ~]# systemctl restart nfs-server
[root@k8s-192-168-1-140 ~]# systemctl  enable  rpcbind
[root@k8s-192-168-1-140 ~]# systemctl  enable  nfs-server
</code></pre>
<h3 data-id="heading-9">K8S ç¼–å†™NFSä¾›ç»™</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]#  vim nfs-storage.yaml
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]#  cat nfs-storage.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: nfs-storage
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: k8s-sigs.io/nfs-subdir-external-provisioner
parameters:
  archiveOnDelete: "true"  ## åˆ é™¤pvçš„æ—¶å€™ï¼Œpvçš„å†…å®¹æ˜¯å¦è¦å¤‡ä»½


---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nfs-client-provisioner
  labels:
    app: nfs-client-provisioner
<span class="hljs-meta prompt_">  # </span><span class="bash">replace with namespace <span class="hljs-built_in">where</span> provisioner is deployed</span>
  namespace: default
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: nfs-client-provisioner
  template:
    metadata:
      labels:
        app: nfs-client-provisioner
    spec:
      serviceAccountName: nfs-client-provisioner
      containers:
        - name: nfs-client-provisioner
          image: registry.cn-hangzhou.aliyuncs.com/chenby/nfs-subdir-external-provisioner:v4.0.2
          # resources:
          #    limits:
          #      cpu: 10m
          #    requests:
          #      cpu: 10m
          volumeMounts:
            - name: nfs-client-root
              mountPath: /persistentvolumes
          env:
            - name: PROVISIONER_NAME
              value: k8s-sigs.io/nfs-subdir-external-provisioner
            - name: NFS_SERVER
              value: 192.168.1.140 ## æŒ‡å®šè‡ªå·±nfsæœåŠ¡å™¨åœ°å€
            - name: NFS_PATH  
              value: /nfs/  ## nfsæœåŠ¡å™¨å…±äº«çš„ç›®å½•
      volumes:
        - name: nfs-client-root
          nfs:
            server: 192.168.1.140
            path: /nfs/
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: nfs-client-provisioner
<span class="hljs-meta prompt_">  # </span><span class="bash">replace with namespace <span class="hljs-built_in">where</span> provisioner is deployed</span>
  namespace: default
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: nfs-client-provisioner-runner
rules:
  - apiGroups: [""]
    resources: ["nodes"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["persistentvolumes"]
    verbs: ["get", "list", "watch", "create", "delete"]
  - apiGroups: [""]
    resources: ["persistentvolumeclaims"]
    verbs: ["get", "list", "watch", "update"]
  - apiGroups: ["storage.k8s.io"]
    resources: ["storageclasses"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "update", "patch"]
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: run-nfs-client-provisioner
subjects:
  - kind: ServiceAccount
    name: nfs-client-provisioner
    # replace with namespace where provisioner is deployed
    namespace: default
roleRef:
  kind: ClusterRole
  name: nfs-client-provisioner-runner
  apiGroup: rbac.authorization.k8s.io
---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: leader-locking-nfs-client-provisioner
<span class="hljs-meta prompt_">  # </span><span class="bash">replace with namespace <span class="hljs-built_in">where</span> provisioner is deployed</span>
  namespace: default
rules:
  - apiGroups: [""]
    resources: ["endpoints"]
    verbs: ["get", "list", "watch", "create", "update", "patch"]
---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: leader-locking-nfs-client-provisioner
<span class="hljs-meta prompt_">  # </span><span class="bash">replace with namespace <span class="hljs-built_in">where</span> provisioner is deployed</span>
  namespace: default
subjects:
  - kind: ServiceAccount
    name: nfs-client-provisioner
    # replace with namespace where provisioner is deployed
    namespace: default
roleRef:
  kind: Role
  name: leader-locking-nfs-client-provisioner
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<h3 data-id="heading-10">å¼€å§‹å®‰è£…</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]#  kubectl apply -f nfs-storage.yaml
storageclass.storage.k8s.io/nfs-storage created
deployment.apps/nfs-client-provisioner created
serviceaccount/nfs-client-provisioner created
clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created
clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created
role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-11">æŸ¥çœ‹å­˜å‚¨</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl get storageclasses.storage.k8s.io
NAME                    PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
nfs-storage (default)   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           false                  6h7m
[root@k8s-192-168-1-140 ~]# 

[root@k8s-192-168-1-140 ~]# kubectl get pvc
NAME                                         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
elasticsearch-data-quickstart-es-default-0   Bound    pvc-2df832aa-1c54-4af6-8384-5e5c5f167445   5Gi        RWO            nfs-storage    &lt;unset&gt;                 39s
[root@k8s-192-168-1-140 ~]# 

[root@k8s-192-168-1-140 ~]# kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pvc-2df832aa-1c54-4af6-8384-5e5c5f167445   5Gi        RWO            Delete           Bound    default/elasticsearch-data-quickstart-es-default-0   nfs-storage    &lt;unset&gt;                          43s
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-12">æŸ¥çœ‹ESæœåŠ¡å‘ç°</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl get service
NAME                          TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
kubernetes                    ClusterIP   10.68.0.1      &lt;none&gt;        443/TCP        81d
nginx                         NodePort    10.68.148.53   &lt;none&gt;        80:30330/TCP   81d
quickstart-es-default         ClusterIP   None           &lt;none&gt;        9200/TCP       74s
quickstart-es-http            ClusterIP   10.68.66.232   &lt;none&gt;        9200/TCP       75s
quickstart-es-internal-http   ClusterIP   10.68.121.73   &lt;none&gt;        9200/TCP       75s
quickstart-es-transport       ClusterIP   None           &lt;none&gt;        9300/TCP       75s
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-13">æŸ¥çœ‹ESå¯†ç </h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# PASSWORD=$(kubectl get secret quickstart-es-elastic-user -o go-template='{{.data.elastic | base64decode}}')
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# kubectl get secret quickstart-es-elastic-user -o go-template='{{.data.elastic | base64decode}}'
V3VPqwQMURTSg6zFYvVIsH13[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# curl -u "elastic:$PASSWORD" -k "https://10.68.66.232:9200"
{
  "name" : "quickstart-es-default-0",
  "cluster_name" : "quickstart",
  "cluster_uuid" : "JNqGubnmSeao_LO-JmypHg",
  "version" : {
    "number" : "9.2.2",
    "build_flavor" : "default",
    "build_type" : "docker",
    "build_hash" : "ed771e6976fac1a085affabd45433234a4babeaf",
    "build_date" : "2025-11-27T08:06:51.614397514Z",
    "build_snapshot" : false,
    "lucene_version" : "10.3.2",
    "minimum_wire_compatibility_version" : "8.19.0",
    "minimum_index_compatibility_version" : "8.0.0"
  },
  "tagline" : "You Know, for Search"
}
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-14">å®‰è£…KibanaæœåŠ¡</h3>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: kibana.k8s.elastic.co/v1
kind: Kibana
metadata:
  name: quickstart
spec:
  version: 9.2.2
  count: 1
  elasticsearchRef:
    name: quickstart
EOF
</code></pre>
<h3 data-id="heading-15">æŸ¥çœ‹æœåŠ¡çŠ¶æ€ä»¥åŠå¯†ç ä¿¡æ¯</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl get kibana
NAME         HEALTH   NODES   VERSION   AGE
quickstart   red              9.2.2     16s
[root@k8s-192-168-1-140 ~]# 
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹å¯†ç </span>
[root@k8s-192-168-1-140 ~]# kubectl get secret quickstart-es-elastic-user -o=jsonpath='{.data.elastic}' | base64 --decode; echo
V3VPqwQMURTSg6zFYvVIsH13
[root@k8s-192-168-1-140 ~]#


[root@k8s-192-168-1-140 ~]# kubectl get service 
NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
kubernetes                    ClusterIP   10.68.0.1       &lt;none&gt;        443/TCP        81d
nginx                         NodePort    10.68.148.53    &lt;none&gt;        80:30330/TCP   81d
quickstart-es-default         ClusterIP   None            &lt;none&gt;        9200/TCP       2m47s
quickstart-es-http            ClusterIP   10.68.66.232    &lt;none&gt;        9200/TCP       2m48s
quickstart-es-internal-http   ClusterIP   10.68.121.73    &lt;none&gt;        9200/TCP       2m48s
quickstart-es-transport       ClusterIP   None            &lt;none&gt;        9300/TCP       2m48s
quickstart-kb-http            ClusterIP   10.68.103.103   &lt;none&gt;        5601/TCP       24s
[root@k8s-192-168-1-140 ~]# 

[root@k8s-192-168-1-140 ~]# kubectl get service quickstart-kb-http
NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
quickstart-kb-http   ClusterIP   10.68.103.103   &lt;none&gt;        5601/TCP   2m39s
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-16">å¼€å¯è®¿é—®</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~] kubectl port-forward --address 0.0.0.0 service/quickstart-kb-http 5601
Forwarding from 0.0.0.0:5601 -&gt; 5601
<span class="hljs-meta prompt_">


# </span><span class="bash">ç™»å½•åœ°å€</span>
https://192.168.1.140:5601/login

ç”¨æˆ·ï¼š
elastic

å¯†ç ï¼š
V3VPqwQMURTSg6zFYvVIsH13
</code></pre>
<h3 data-id="heading-17">ä¿®æ”¹ESå‰¯æœ¬æ•°</h3>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: quickstart
spec:
  version: 9.2.2
  nodeSets:
  - name: default
    count: 3
    config:
      node.store.allow_mmap: false
EOF
</code></pre>
<h3 data-id="heading-18">æŸ¥çœ‹çŠ¶æ€</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl get pod -A
NAMESPACE        NAME                                       READY   STATUS    RESTARTS            AGE
default          nfs-client-provisioner-58d465c998-w8mfq    1/1     Running   0                   5h38m
default          nginx-66686b6766-tdwt2                     1/1     Running   2 (&lt;invalid&gt; ago)   81d
default          quickstart-es-default-0                    1/1     Running   0                   5h51m
default          quickstart-kb-57cc78f6b8-b8fpf             1/1     Running   0                   5h24m
elastic-system   elastic-operator-0                         1/1     Running   0                   6h2m
kube-system      calico-kube-controllers-78dcb7b647-8f2ph   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      calico-node-hpwvr                          1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      coredns-6746f4cb74-bhkv8                   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      metrics-server-55c56cb875-bwbpr            1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      node-local-dns-nz4q7                       1/1     Running   2 (&lt;invalid&gt; ago)   81d
[root@k8s-192-168-1-140 ~]# kubectl get pod -A -w
NAMESPACE        NAME                                       READY   STATUS    RESTARTS            AGE
default          nfs-client-provisioner-58d465c998-w8mfq    1/1     Running   0                   5h38m
default          nginx-66686b6766-tdwt2                     1/1     Running   2 (&lt;invalid&gt; ago)   81d
default          quickstart-es-default-0                    1/1     Running   0                   5h51m
default          quickstart-kb-57cc78f6b8-b8fpf             1/1     Running   0                   5h24m
elastic-system   elastic-operator-0                         1/1     Running   0                   6h2m
kube-system      calico-kube-controllers-78dcb7b647-8f2ph   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      calico-node-hpwvr                          1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      coredns-6746f4cb74-bhkv8                   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      metrics-server-55c56cb875-bwbpr            1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      node-local-dns-nz4q7                       1/1     Running   2 (&lt;invalid&gt; ago)   81d




default          quickstart-es-default-1                    0/1     Pending   0                   0s
default          quickstart-es-default-1                    0/1     Pending   0                   0s
default          quickstart-es-default-1                    0/1     Pending   0                   0s
default          quickstart-es-default-1                    0/1     Init:0/2   0                   0s
default          quickstart-es-default-1                    0/1     Init:0/2   0                   1s
default          quickstart-es-default-0                    1/1     Running    0                   5h51m
default          quickstart-es-default-1                    0/1     Init:0/2   0                   1s
default          quickstart-es-default-0                    1/1     Running    0                   5h51m
default          quickstart-es-default-1                    0/1     Init:0/2   0                   2s
default          quickstart-es-default-1                    0/1     Init:1/2   0                   3s
default          quickstart-es-default-1                    0/1     PodInitializing   0                   4s
default          quickstart-es-default-1                    0/1     Running           0                   5s
default          quickstart-es-default-1                    1/1     Running           0                   26s
default          quickstart-es-default-2                    0/1     Pending           0                   0s
default          quickstart-es-default-2                    0/1     Pending           0                   0s
default          quickstart-es-default-2                    0/1     Pending           0                   0s
default          quickstart-es-default-2                    0/1     Init:0/2          0                   0s
default          quickstart-es-default-2                    0/1     Init:0/2          0                   1s
default          quickstart-es-default-0                    1/1     Running           0                   5h51m
default          quickstart-es-default-1                    1/1     Running           0                   30s
default          quickstart-es-default-2                    0/1     Init:0/2          0                   2s
default          quickstart-es-default-1                    1/1     Running           0                   30s
default          quickstart-es-default-2                    0/1     Init:0/2          0                   2s
default          quickstart-es-default-0                    1/1     Running           0                   5h51m
default          quickstart-es-default-2                    0/1     Init:1/2          0                   3s
default          quickstart-es-default-2                    0/1     PodInitializing   0                   4s
default          quickstart-es-default-2                    0/1     Running           0                   5s
default          quickstart-es-default-2                    1/1     Running           0                   33s
^C[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# kubectl get pod -A -w

NAMESPACE        NAME                                       READY   STATUS    RESTARTS            AGE
default          nfs-client-provisioner-58d465c998-w8mfq    1/1     Running   0                   5h40m
default          nginx-66686b6766-tdwt2                     1/1     Running   2 (&lt;invalid&gt; ago)   81d
default          quickstart-es-default-0                    1/1     Running   0                   5h53m
default          quickstart-es-default-1                    1/1     Running   0                   2m19s
default          quickstart-es-default-2                    1/1     Running   0                   111s
default          quickstart-kb-57cc78f6b8-b8fpf             1/1     Running   0                   5h26m
elastic-system   elastic-operator-0                         1/1     Running   0                   6h4m
kube-system      calico-kube-controllers-78dcb7b647-8f2ph   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      calico-node-hpwvr                          1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      coredns-6746f4cb74-bhkv8                   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      metrics-server-55c56cb875-bwbpr            1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      node-local-dns-nz4q7                       1/1     Running   2 (&lt;invalid&gt; ago)   81d

</code></pre>
<h3 data-id="heading-19">å¸è½½åˆ é™¤</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">
# </span><span class="bash">åˆ é™¤æ‰€æœ‰å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰Elasticèµ„æº</span>
kubectl get namespaces --no-headers -o custom-columns=:metadata.name \
  | xargs -n1 kubectl delete elastic --all -n
<span class="hljs-meta prompt_">
# </span><span class="bash">åˆ é™¤operator</span>
kubectl delete -f https://download.elastic.co/downloads/eck/3.2.0/operator.yaml
kubectl delete -f https://download.elastic.co/downloads/eck/3.2.0/crds.yaml
</code></pre>
<p><strong>å…³äº</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oiox.cn%2F" target="_blank" title="https://www.oiox.cn/" ref="nofollow noopener noreferrer">www.oiox.cn/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oiox.cn%2Findex.php%2Fstart-page.html" target="_blank" title="https://www.oiox.cn/index.php/start-page.html" ref="nofollow noopener noreferrer">www.oiox.cn/index.php/sâ€¦</a></p>
<p><strong>CSDNã€GitHubã€çŸ¥ä¹ã€å¼€æºä¸­å›½ã€æ€å¦ã€æ˜é‡‘ã€ç®€ä¹¦ã€åä¸ºäº‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€å“”å“©å“”å“©ã€ä»Šæ—¥å¤´æ¡ã€æ–°æµªå¾®åšã€ä¸ªäººåšå®¢</strong></p>
<p><strong>å…¨ç½‘å¯æœã€Šå°é™ˆè¿ç»´ã€‹</strong></p>
<p><strong>æ–‡ç« ä¸»è¦å‘å¸ƒäºå¾®ä¿¡å…¬ä¼—å·ï¼šã€ŠLinuxè¿ç»´äº¤æµç¤¾åŒºã€‹</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day5ï¼šçº¿ç¨‹æ± è¿›é˜¶â€”â€”æˆ‘ä»ã€Œåªä¼šè·‘ void ä»»åŠ¡ã€åˆ°ã€Œèƒ½è¿”å› futureã€ï¼Œå¹¶ç”¨ Demo éªŒè¯è·‘é€š]]></title>    <link>https://juejin.cn/post/7582849187864657971</link>    <guid>https://juejin.cn/post/7582849187864657971</guid>    <pubDate>2025-12-12T14:55:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582849187864657971" data-draft-id="7582814236583264294" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day5ï¼šçº¿ç¨‹æ± è¿›é˜¶â€”â€”æˆ‘ä»ã€Œåªä¼šè·‘ void ä»»åŠ¡ã€åˆ°ã€Œèƒ½è¿”å› futureã€ï¼Œå¹¶ç”¨ Demo éªŒè¯è·‘é€š"/> <meta itemprop="keywords" content="æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-12T14:55:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‚†å¿†_"/> <meta itemprop="url" content="https://juejin.cn/user/3898194938326714"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day5ï¼šçº¿ç¨‹æ± è¿›é˜¶â€”â€”æˆ‘ä»ã€Œåªä¼šè·‘ void ä»»åŠ¡ã€åˆ°ã€Œèƒ½è¿”å› futureã€ï¼Œå¹¶ç”¨ Demo éªŒè¯è·‘é€š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3898194938326714/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‚†å¿†_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T14:55:08.000Z" title="Fri Dec 12 2025 14:55:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™æ˜¯æˆ‘æ“ä½œç³»ç»Ÿ / å¤šçº¿ç¨‹æ‰‹æ’•é¢˜çš„ <strong>Day5</strong>ã€‚<br/>
Day4 æˆ‘å·²ç»å†™å‡ºäº†åŸºç¡€çº¿ç¨‹æ± ï¼šé˜Ÿåˆ—é‡Œæ”¾ <code>std::function&lt;void()&gt;</code>ï¼Œworker çº¿ç¨‹å¾ªç¯å–ä»»åŠ¡æ‰§è¡Œã€‚</p>
<p>ä½†æˆ‘ Day5 çš„æ ¸å¿ƒè¯‰æ±‚å¾ˆç°å®ï¼š</p>
<blockquote>
<p><strong>æˆ‘å¸Œæœ›çº¿ç¨‹æ± æäº¤ä¸€ä¸ª <code>int()</code> ä»»åŠ¡åï¼Œèƒ½æ‹¿åˆ°è¿”å›å€¼ã€‚</strong><br/>
æˆ‘æƒ³è¦çš„æ˜¯ï¼šæäº¤ä»»åŠ¡ç«‹åˆ»è¿”å›ï¼›ç»“æœä»€ä¹ˆæ—¶å€™å–ç”±è°ƒç”¨è€…å†³å®šã€‚</p>
</blockquote>
<p>æœ€ç»ˆæˆ‘æŠŠè¿›é˜¶ç‰ˆæœ¬è·‘é€šäº†ï¼Œå¹¶ç”¨ä¸€ä¸ªéªŒè¯ demo å¾—åˆ°è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[main]</span> submit tasks, main thread <span class="hljs-attr">id</span> = <span class="hljs-number">111212</span>
<span class="hljs-section">[task1]</span> submit tasks, task1 thread <span class="hljs-attr">id</span> = <span class="hljs-number">111172</span>
<span class="hljs-section">[task2]</span> submit tasks, task2 thread <span class="hljs-attr">id</span> = <span class="hljs-number">125744</span>
<span class="hljs-section">[task3]</span> submit tasks, task3 thread <span class="hljs-attr">id</span> = <span class="hljs-number">111172</span>
<span class="hljs-section">[main]</span> f2 not ready after 50ms (expected timeout)
<span class="hljs-section">[main]</span> results: 1, 2, 3
<span class="hljs-section">[main]</span> done
</code></pre>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æˆ‘ä¸€å¼€å§‹æ²¡æ‡‚çš„ã€Œè¿›é˜¶çº¿ç¨‹æ± ç»“æ„ã€åˆ°åº•é•¿å•¥æ ·ï¼Ÿ</h2>
<h3 data-id="heading-1">1.1 Day4 çš„çº¿ç¨‹æ± ç»“æ„ï¼ˆæˆ‘å·²ç»ä¼šäº†ï¼‰</h3>
<ul>
<li>ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼š<code>queue&lt;function&lt;void()&gt;&gt; tasks_</code></li>
<li>ä¸€å † worker çº¿ç¨‹ï¼šå¾ªç¯ wait â†’ pop â†’ æ‰§è¡Œ <code>fn()</code></li>
<li><code>Enqueue()</code> å¾€é˜Ÿåˆ—é‡Œå¡ <code>void()</code> ä»»åŠ¡</li>
</ul>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚æœä»»åŠ¡æœ‰è¿”å›å€¼ï¼ˆæ¯”å¦‚ <code>int()</code>ï¼‰ï¼Œworker åªä¼šæ‰§è¡Œ <code>void()</code>ï¼Œè¿”å›å€¼æ€ä¹ˆä¼ å›æ¥ï¼Ÿ</p>
<h3 data-id="heading-2">1.2 æˆ‘ Day5 çš„ç›®æ ‡ç»“æ„ï¼ˆä»Šå¤©æ‰çœŸæ­£ç†è§£ï¼‰</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ‰§è¡Œç«¯ï¼ˆworkerï¼‰ä¸éœ€è¦ç†è§£â€œè¿”å›å€¼â€ï¼Œå®ƒåªéœ€è¦æ‰§è¡Œ <code>void()</code>ã€‚<br/>
è¿”å›å€¼èµ°å¦ä¸€æ¡é€šé“ï¼š<code>future</code>ã€‚</p>
<ul>
<li>
<p>é˜Ÿåˆ—é‡Œä»ç„¶åªæ”¾ï¼š<code>std::function&lt;void()&gt;</code></p>
</li>
<li>
<p>ä½†æ˜¯æˆ‘å¯ä»¥æŠŠä¸€ä¸ª <code>int()</code> ä»»åŠ¡åŒ…è£…æˆ <code>void()</code>ï¼š</p>
<ul>
<li><code>void()</code> é‡Œæ‰§è¡Œ <code>packaged_task&lt;int()&gt;</code></li>
<li><code>packaged_task</code> ä¼šæŠŠç»“æœå†™è¿› <code>future&lt;int&gt;</code> çš„å…±äº«çŠ¶æ€</li>
</ul>
</li>
<li>
<p><code>EnqueueInt()</code> è¿”å› <code>future&lt;int&gt;</code> ç»™è°ƒç”¨è€…</p>
</li>
<li>
<p>è°ƒç”¨è€…æƒ³ä»€ä¹ˆæ—¶å€™æ‹¿ç»“æœï¼Œå°±ä»€ä¹ˆæ—¶å€™ <code>get()</code> / <code>wait_for()</code></p>
</li>
</ul>
<p>è¿™å°±æ˜¯æˆ‘ä»Šå¤©åå¤ç¡®è®¤çš„é‚£å¥è¯ï¼š</p>
<blockquote>
<p><strong>è°ƒç”¨è€…è‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™ get()ï¼ˆä¹Ÿå¯ä»¥ä¸ getã€ä¹Ÿå¯ä»¥ wait_forï¼‰</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-3">äºŒã€æˆ‘é—®è¿‡çš„å°é—®é¢˜ï¼šè¿™é‡Œçš„â€œè°ƒç”¨è€…â€åˆ°åº•æŒ‡è°ï¼Ÿ</h2>
<p>æˆ‘å½“æ—¶æœ‰ç‚¹å¡åœ¨è¯ä¸Šï¼šåˆ°åº•è°æ˜¯è°ƒç”¨è€…ï¼Ÿ</p>
<p><strong>ç»“è®º</strong>ï¼šè°ƒç”¨è€…å°±æ˜¯â€œè°ƒç”¨ <code>EnqueueInt()</code> çš„é‚£ä¸ªäººâ€ã€‚åœ¨æˆ‘çš„ demo é‡Œå°±æ˜¯ <code>main()</code>ã€‚</p>
<ul>
<li><code>EnqueueInt()</code> çš„èŒè´£ï¼šæäº¤ä»»åŠ¡ + è¿”å› <code>future&lt;int&gt;</code></li>
<li><code>main()</code> çš„èŒè´£ï¼šå†³å®šä»€ä¹ˆæ—¶å€™å–ç»“æœï¼ˆ<code>get()</code> / <code>wait()</code> / <code>wait_for()</code>ï¼‰</li>
</ul>
<p>è¿™ä¹Ÿè§£é‡Šäº†æˆ‘è‡ªå·±çš„é‚£æ®µç†è§£ï¼ˆåæ¥ä½ ä¹Ÿç¡®è®¤äº†æˆ‘æ–¹å‘å¯¹ï¼‰ï¼š</p>
<blockquote>
<p><code>EnqueueInt()</code> è¿”å› futureï¼›çœŸæ­£çš„è¿”å›å€¼ç”±è°ƒç”¨è€…ä»€ä¹ˆæ—¶å€™ <code>get()</code> å†³å®šã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ç‰ˆæœ¬è¿­ä»£ 1ï¼šæˆ‘å†™å‡ºäº† EnqueueIntï¼Œä½†å‡ºç°äº†ä¸¤ä¸ªâ€œç†è§£å‹å‘â€</h2>
<p>æˆ‘å½“æ—¶çš„é›å½¢æ˜¯ï¼š</p>
<ul>
<li><code>std::packaged_task&lt;int()&gt; pt(task);</code></li>
<li><code>auto fut = pt.get_future();</code></li>
<li>æŠŠ <code>pt</code> æ”¾è¿›é˜Ÿåˆ—ï¼Œè®© worker æ‰§è¡Œ</li>
<li>return <code>fut</code></li>
</ul>
<p>è¿™é‡Œå‡ºç°ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼Œéƒ½æ˜¯æˆ‘åæ¥é€æ­¥é—®å‡ºæ¥çš„ã€‚</p>
<h3 data-id="heading-5">3.1 æˆ‘é—®ï¼šä¸ºä»€ä¹ˆ <code>&amp;ThreadPool::Work, this</code> è¿™ä¹ˆå†™ï¼Ÿæˆ‘ä»¥å‰ä¸æ˜¯ä¹Ÿèƒ½å†™å—ï¼Ÿ</h3>
<p>æˆ‘å½“æ—¶è§‰å¾—â€œWork å’Œæ„é€ å‡½æ•°éƒ½åœ¨ä¸€ä¸ªç±»é‡Œâ€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†™å¾—è¿™ä¹ˆéº»çƒ¦ã€‚</p>
<h4 data-id="heading-6">æ­£ç¡®ç†è§£</h4>
<p><code>Work</code> æ˜¯<strong>æˆå‘˜å‡½æ•°</strong>ï¼Œä¸æ˜¯æ™®é€šå‡½æ•°ã€‚æˆå‘˜å‡½æ•°å¿…é¡»ä¾èµ–å¯¹è±¡æ‰èƒ½è¢«è°ƒç”¨ï¼Œæœ¬è´¨ä¸Šæ˜¯ï¼š</p>
<ul>
<li>æ™®é€šå‡½æ•°ï¼š<code>Work()</code></li>
<li>æˆå‘˜å‡½æ•°ï¼š<code>this-&gt;Work()</code></li>
</ul>
<p>å½“æˆ‘ç”¨ <code>std::thread</code> å¯åŠ¨çº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹å…¥å£éœ€è¦ä¸€ä¸ªâ€œå¯è°ƒç”¨å¯¹è±¡â€ã€‚<br/>
æˆå‘˜å‡½æ•°è¦æˆä¸ºâ€œå¯è°ƒç”¨â€ï¼Œå¿…é¡»åŒæ—¶æä¾›ä¸¤æ ·ä¸œè¥¿ï¼š</p>
<ol>
<li>æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼š<code>&amp;ThreadPool::Work</code></li>
<li>å¯¹è±¡æŒ‡é’ˆï¼š<code>this</code></li>
</ol>
<p>æ‰€ä»¥æ ‡å‡†å†™æ³•æ˜¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">workers_.emplace_back(&amp;ThreadPool::Work, <span class="hljs-keyword">this</span>);
</code></pre>
<h4 data-id="heading-7">æˆ‘è¿½é—®çš„â€œæ˜¯ä¸æ˜¯å› ä¸ºå‡½æ•°ç±»å‹æ‰€ä»¥è¦åŠ  &amp;ï¼Ÿâ€</h4>
<p>æ›´å‡†ç¡®ï¼šä¸æ˜¯â€œå› ä¸ºå‡½æ•°ç±»å‹â€ï¼Œè€Œæ˜¯â€œå› ä¸ºè¦å–æˆå‘˜å‡½æ•°æŒ‡é’ˆâ€ã€‚<br/>
<code>&amp;ThreadPool::Work</code> è¡¨ç¤ºâ€œæŒ‡å‘æˆå‘˜å‡½æ•° Work çš„æŒ‡é’ˆâ€ï¼ˆpointer-to-member-functionï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-8">3.2 æˆ‘é—®ï¼š<code>pt</code> ä¸æ˜¯å’Œ <code>fut</code> ç»‘å®šå—ï¼Ÿ<code>pt</code> æ˜¯å±€éƒ¨å˜é‡é”€æ¯åï¼Œ<code>fut</code> è¿˜èƒ½æœ‰æ•ˆå—ï¼Ÿ</h3>
<p>è¿™ä¸ªé—®é¢˜éå¸¸å…³é”®ï¼Œæˆ‘å½“æ—¶ç¡®å®æ²¡æƒ³é€šã€‚</p>
<h4 data-id="heading-9">æ­£ç¡®ç†è§£ï¼š<code>future</code> ä¸â€œç»‘åœ¨ pt èº«ä¸Šâ€ï¼Œå®ƒä»¬æ˜¯<strong>å…±äº«åŒä¸€ä»½å…±äº«çŠ¶æ€</strong></h4>
<ul>
<li><code>packaged_task</code> å†…éƒ¨æŒæœ‰ä¸€ä¸ªâ€œå…±äº«çŠ¶æ€â€ï¼ˆshared stateï¼‰</li>
<li><code>pt.get_future()</code> è¿”å›çš„ <code>future</code> ä¹ŸæŒ‡å‘è¿™ä»½å…±äº«çŠ¶æ€</li>
<li><strong>å…±äº«çŠ¶æ€æ‰æ˜¯â€œç»“æœå­˜æ”¾åœ°â€</strong></li>
</ul>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>
<p><code>pt</code> æ˜¯å±€éƒ¨å˜é‡å¹¶ä¸ç­‰äº <code>fut</code> ç«‹åˆ»å¤±æ•ˆ</p>
</li>
<li>
<p>ä½†å¦‚æœ <code>pt</code> è¢«é”€æ¯æ—¶å…±äº«çŠ¶æ€è¿˜æ²¡è¢«å†™å…¥ç»“æœï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>è¦ä¹ˆ <code>future</code> æ°¸è¿œç­‰ä¸åˆ°ç»“æœï¼ˆå¡ä½ï¼‰</li>
<li>è¦ä¹ˆå˜æˆâ€œbroken promiseâ€ï¼ˆ<code>get()</code> æŠ›å¼‚å¸¸ï¼‰</li>
<li>æ›´ç³Ÿç³•çš„æ˜¯ï¼šä½ å¦‚æœè®© worker æ‰§è¡Œä¸€ä¸ªâ€œå¼•ç”¨äº†å·²é”€æ¯ pt çš„å‡½æ•°â€ï¼Œä¼šå‡ºç°æ‚¬ç©ºå¼•ç”¨ï¼ˆUBï¼‰</li>
</ul>
</li>
</ul>
<p>æ‰€ä»¥å…³é”®ä¸æ˜¯â€œpt é”€æ¯ fut æ˜¯å¦æœ‰æ•ˆâ€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>å¿…é¡»ä¿è¯ worker æœ€ç»ˆä¸€å®šä¼šæ‰§è¡Œé‚£æ¬¡ <code>pt()</code>ï¼Œå¹¶ä¸”æ‰§è¡Œæ—¶ pt ä»ç„¶æ´»ç€ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-10">å››ã€ç‰ˆæœ¬è¿­ä»£ 2ï¼šæˆ‘ä¿®åˆ°äº†â€œèƒ½ç¼–è¯‘â€ï¼Œä½†åˆçŠ¯äº†ä¸€ä¸ªå¾ˆçœŸå®çš„å°å‘ï¼š<code>{ p; }</code> ä¸ç­‰äºæ‰§è¡Œä»»åŠ¡</h2>
<p>ä½ é‚£æ—¶æŒ‡å‡ºæˆ‘æœ‰ä¸€ç‰ˆå†™æˆï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[p = std::move(pt)]</span> { <span class="hljs-selector-tag">p</span>; }
</code></pre>
<p>æˆ‘å½“æ—¶çš„çœŸå®é—®é¢˜å°±æ˜¯ï¼šæˆ‘ä»¥ä¸ºâ€œæŠŠ p å†™åœ¨é‡Œé¢å°±ç®—ç”¨äº†â€ï¼Œç»“æœå®ƒæ ¹æœ¬æ²¡æ‰§è¡Œã€‚</p>
<ul>
<li><code>{ p; }</code>ï¼šåªæ˜¯ä¸€ä¸ªæ— æ„ä¹‰è¡¨è¾¾å¼</li>
<li>æˆ‘çœŸæ­£éœ€è¦çš„æ˜¯ï¼š<code>p();</code>ï¼ˆè°ƒç”¨ packaged_taskï¼‰</li>
</ul>
<p>è€Œä¸” <code>packaged_task::operator()</code> ä¸æ˜¯ constï¼Œæ‰€ä»¥ä¸€èˆ¬ lambda è¦å†™ <code>mutable</code> æ‰èƒ½è°ƒç”¨å®ƒã€‚</p>
<p>è¿™ä¸ªå‘æˆ‘åæ¥è‡ªå·±ä¹Ÿè®¤å¯ï¼šå®ƒå±äºâ€œåˆšå­¦æ—¶å¾ˆå®¹æ˜“çŠ¯çš„ä½çº§ä½†çœŸå®é”™è¯¯â€ï¼š</p>
<hr/>
<h2 data-id="heading-11">äº”ã€ç‰ˆæœ¬è¿­ä»£ 3ï¼šæˆ‘æŠŠé€»è¾‘å†™å¯¹äº†ï¼Œä½† VS2022 ç»™æˆ‘ä¸€ä¸ªâ€œç±»å‹ç³»ç»Ÿçš„ç¡¬é™åˆ¶â€æŠ¥é”™ï¼ˆæœ€å…³é”®çš„å‘ï¼‰</h2>
<p>å½“æˆ‘ç»ˆäºå†™æˆâ€œmove æ•è· pt åˆ° lambdaï¼Œç„¶åå¡è¿› tasks_â€æ—¶ï¼Œæˆ‘é‡åˆ°äº†è¿™ä¸ªç¼–è¯‘é”™è¯¯ï¼š</p>
<blockquote>
<p><code>std::function</code> çš„ target å¿…é¡»å¯æ‹·è´ï¼ˆcopy constructibleï¼‰</p>
</blockquote>
<p>æ ¹å› æ˜¯ï¼š</p>
<ul>
<li><code>std::packaged_task</code> æ˜¯ <strong>move-only</strong></li>
<li>lambda æ•è· move-only çš„ pt â†’ lambda ä¹Ÿå˜æˆ <strong>move-only</strong></li>
<li>ä½†æˆ‘çš„é˜Ÿåˆ—ç±»å‹æ˜¯ <code>std::function&lt;void()&gt;</code></li>
<li><strong>MSVC çš„ <code>std::function</code> è¦æ±‚å¯æ‹·è´ï¼Œä¸èƒ½è£… move-only callable</strong></li>
<li>æ‰€ä»¥ static_assert ç›´æ¥ç‚¸æ‰</li>
</ul>
<p>è¿™ä¸€æ­¥æˆ‘å­¦åˆ°ä¸€ä¸ªéå¸¸â€œå·¥ç¨‹â€çš„ç‚¹ï¼š</p>
<blockquote>
<p><strong>ä¸æ˜¯æˆ‘å¹¶å‘é€»è¾‘é”™ï¼Œæ˜¯å®¹å™¨/ç±»å‹æ“¦é™¤å·¥å…·çš„çº¦æŸä¸å…è®¸æˆ‘è¿™ä¹ˆå­˜ã€‚</strong><br/>
åœ¨ VS2022 ä¸‹è¿™æ˜¯ç¡¬é™åˆ¶ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">å…­ã€ç‰ˆæœ¬è¿­ä»£ 4ï¼ˆæœ€ç»ˆè·‘é€šï¼‰ï¼šæˆ‘ç”¨ shared_ptr è®© lambda å¯æ‹·è´ï¼ŒæˆåŠŸå¡è¿› <code>std::function&lt;void()&gt;</code></h2>
<p>è§£å†³æ€è·¯å¾ˆæœ´ç´ ï¼š</p>
<ul>
<li>æ—¢ç„¶ <code>std::function</code> è¦æ±‚å¯æ‹·è´</li>
<li>é‚£æˆ‘å°±è®© lambda æ•è·ä¸€ä¸ª<strong>å¯æ‹·è´çš„å¯¹è±¡</strong></li>
<li><code>std::shared_ptr</code> å¯æ‹·è´</li>
<li>æŠŠ <code>packaged_task</code> æ”¾è¿› <code>shared_ptr</code>ï¼Œlambda æ•è· <code>shared_ptr</code>ï¼Œå°±æ»¡è¶³ <code>std::function</code> çš„è¦æ±‚äº†</li>
</ul>
<p>æœ€ç»ˆæˆ‘å†™æˆäº†è¿™æ ·ï¼ˆä¹Ÿæ˜¯æˆ‘æœ€ç»ˆç‰ˆé‡Œä¿ç•™çš„å†™æ³•ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-built_in">std</span>::packaged_task&lt;<span class="hljs-title function_">int</span><span class="hljs-params">()</span>&gt; <span class="hljs-title function_">pt</span><span class="hljs-params">(task)</span>;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">future</span>&lt;<span class="hljs-type">int</span>&gt; fut = pt.get_future();
<span class="hljs-keyword">auto</span> pt_ptr = <span class="hljs-built_in">std</span>::make_shared&lt;<span class="hljs-built_in">std</span>::packaged_task&lt;<span class="hljs-type">int</span>()&gt;&gt;(<span class="hljs-built_in">std</span>::move(pt));

tasks_.emplace([pt_ptr]() mutable { (*pt_ptr)(); });
<span class="hljs-keyword">return</span> fut;
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œç»“æ„å®Œå…¨é—­ç¯ï¼š</p>
<ul>
<li><code>EnqueueInt</code> è¿”å› <code>future&lt;int&gt;</code></li>
<li>worker æ‰§è¡Œ <code>void()</code> åŒ…è£…ä»»åŠ¡</li>
<li>åŒ…è£…ä»»åŠ¡æ‰§è¡Œ <code>(*pt_ptr)()</code>ï¼ŒæŠŠç»“æœå†™å…¥ future çš„å…±äº«çŠ¶æ€</li>
</ul>
<hr/>
<h2 data-id="heading-13">ä¸ƒã€éªŒè¯ Demoï¼šæˆ‘ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸ª demoï¼Ÿå®ƒéªŒè¯äº†ä»€ä¹ˆï¼Ÿ</h2>
<p>æˆ‘åŒæ„ä½ æè®®â€œå…ˆåšéªŒè¯ demoâ€ï¼Œå› ä¸ºå®ƒèƒ½è®©æˆ‘ç¡®ä¿¡è¿™ä¸æ˜¯â€œæˆ‘ä»¥ä¸ºå†™å¯¹äº†â€ã€‚</p>
<h3 data-id="heading-14">7.1 æˆ‘å†™ demo çš„ç›®çš„ï¼ˆæˆ‘è‡ªå·±çš„æ£€æŸ¥ç‚¹ï¼‰</h3>
<ol>
<li>
<p><strong>ä»»åŠ¡ç¡®å®è·‘åœ¨ worker çº¿ç¨‹ï¼Œä¸æ˜¯åœ¨ main çº¿ç¨‹åŒæ­¥æ‰§è¡Œ</strong></p>
<ul>
<li>é€šè¿‡æ‰“å° <code>std::this_thread::get_id()</code></li>
</ul>
</li>
<li>
<p><strong>future ç¡®å®èƒ½æ‹¿åˆ°ç»“æœ</strong></p>
<ul>
<li><code>get()</code> è¿”å› 1ã€2ã€3</li>
</ul>
</li>
<li>
<p><strong>wait_for èƒ½åæ˜ â€œè¿˜æ²¡å®Œæˆâ€è¿™ç§çŠ¶æ€</strong></p>
<ul>
<li>task2 ç¡ 500ms</li>
<li>main å¯¹ fut2 <code>wait_for(50ms)</code> åº”è¯¥ timeout</li>
</ul>
</li>
</ol>
<p>è¾“å‡ºç¡®å®ç¬¦åˆé¢„æœŸï¼š</p>
<ul>
<li>task thread id â‰  main thread id</li>
<li><code>wait_for(50ms)</code> timeout</li>
<li><code>get()</code> å¾—åˆ° 1,2,3</li>
</ul>
<hr/>
<h2 data-id="heading-15">å…«ã€Day5 æˆ‘å­¦åˆ°çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼ˆè¿™éƒ¨åˆ†æˆ‘æŒ‰â€œå¤ä¹ ç¬”è®°â€æ¥å†™ï¼‰</h2>
<h3 data-id="heading-16">8.1 <code>std::packaged_task&lt;R()&gt;</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>å®ƒæŠŠâ€œä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡â€åŒ…è£…æˆâ€œèƒ½äº§ç”Ÿ future çš„ä»»åŠ¡â€ã€‚</p>
<ul>
<li>
<p><code>packaged_task&lt;int()&gt; pt(task);</code></p>
</li>
<li>
<p><code>future&lt;int&gt; fut = pt.get_future();</code></p>
</li>
<li>
<p>å½“æ‰§è¡Œ <code>pt()</code> æ—¶ï¼š</p>
<ul>
<li>task è¢«æ‰§è¡Œ</li>
<li>è¿”å›å€¼ï¼ˆæˆ–å¼‚å¸¸ï¼‰ä¼šå†™è¿› fut å¯¹åº”çš„å…±äº«çŠ¶æ€</li>
</ul>
</li>
</ul>
<p><strong>å…³é”®ç‚¹</strong>ï¼šæ‰§è¡Œç«¯æ‰§è¡Œ <code>pt()</code>ï¼Œè°ƒç”¨ç«¯æŒæœ‰ <code>fut</code>ã€‚</p>
<hr/>
<h3 data-id="heading-17">8.2 <code>std::future</code> å¸¸ç”¨æ–¹æ³•ï¼ˆé¢è¯•é«˜é¢‘ï¼‰</h3>
<ul>
<li><code>get()</code>ï¼šå–ç»“æœã€‚è‹¥æœªå°±ç»ªï¼Œä¼šé˜»å¡ï¼›åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼ˆå–èµ°ç»“æœï¼‰</li>
<li><code>wait()</code>ï¼šåªç­‰å¾…å°±ç»ªï¼Œä¸å–ç»“æœ</li>
<li><code>wait_for(duration)</code>ï¼šç­‰ä¸€æ®µæ—¶é—´ï¼Œè¿”å› <code>future_status</code></li>
<li><code>wait_until(time_point)</code>ï¼šç­‰åˆ°æŸä¸ªæ—¶é—´ç‚¹</li>
</ul>
<h4 data-id="heading-18"><code>wait_for</code> çš„è¿”å›å€¼ï¼š<code>std::future_status</code></h4>
<ul>
<li><code>ready</code>ï¼šå·²å°±ç»ª</li>
<li><code>timeout</code>ï¼šè¶…æ—¶æœªå°±ç»ª</li>
<li><code>deferred</code>ï¼šå»¶è¿Ÿæ‰§è¡Œï¼ˆå¸¸è§äº <code>std::async</code> çš„ deferred ç­–ç•¥ï¼›çº¿ç¨‹æ± ä¸€èˆ¬ä¸ä¼šå‡ºç°ï¼‰</li>
</ul>
<p>æˆ‘çš„ demo å°±æ˜¯åœ¨ç”¨å®ƒè§‚å¯Ÿâ€œ50ms æ—¶è¿˜æ²¡å¥½â€ã€‚</p>
<hr/>
<h3 data-id="heading-19">8.3 <code>using namespace std::chrono_literals;</code> æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h3>
<p>ä¸ºäº†èƒ½ç›´æ¥å†™ï¼š</p>
<ul>
<li><code>50ms</code></li>
<li><code>100ms</code></li>
<li><code>2s</code></li>
</ul>
<p>å¦åˆ™è¦å†™ï¼š</p>
<ul>
<li><code>std::chrono::milliseconds(50)</code></li>
</ul>
<p>æ‰€ä»¥è¿™å¥æœ¬è´¨ä¸Šæ˜¯ï¼š<strong>å¼€å¯ chrono çš„å­—é¢é‡åç¼€</strong>ï¼Œè®© demo æ›´ç›´è§‚ã€‚</p>
<hr/>
<h3 data-id="heading-20">8.4 ä¸ºä»€ä¹ˆä»»åŠ¡é˜Ÿåˆ—é‡Œå–å‡ºä»»åŠ¡åè¦ <code>unlock()</code> å†æ‰§è¡Œï¼Ÿ</h3>
<p>åœ¨ worker é‡Œæˆ‘å†™çš„æ˜¯ï¼š</p>
<pre><code class="hljs language-php" lang="php">std::<span class="hljs-variable constant_">function</span>&lt;<span class="hljs-keyword">void</span>()&gt; <span class="hljs-function"><span class="hljs-keyword">fn</span> = <span class="hljs-title">std</span>::<span class="hljs-title">move</span>(<span class="hljs-params">tasks_.front(<span class="hljs-params"/>)</span>)</span>;
tasks_.<span class="hljs-title function_ invoke__">pop</span>();
lock.<span class="hljs-title function_ invoke__">unlock</span>();
<span class="hljs-function"><span class="hljs-keyword">fn</span>(<span class="hljs-params"/>)</span>;
</code></pre>
<p>åŸå› æ˜¯ï¼šé”åº”è¯¥åªä¿æŠ¤â€œé˜Ÿåˆ—ç»“æ„â€ï¼Œä¸åº”è¯¥åŒ…ä½â€œä»»åŠ¡æ‰§è¡Œâ€ã€‚</p>
<ul>
<li>
<p>å¦‚æœæ‰§è¡Œä»»åŠ¡æ—¶è¿˜æŒé”ï¼š</p>
<ul>
<li>å…¶å®ƒçº¿ç¨‹æ— æ³•å…¥é˜Ÿ</li>
<li>å…¶å®ƒ worker ä¹ŸæŠ¢ä¸åˆ°é”å–ä»»åŠ¡</li>
<li>çº¿ç¨‹æ± ä¼šé€€åŒ–å¾—å¾ˆä¸¥é‡</li>
</ul>
</li>
</ul>
<p>è¿™æ˜¯çº¿ç¨‹æ± é¢˜é‡Œéå¸¸å…³é”®çš„å·¥ç¨‹ç‚¹ï¼š<strong>é”ç²’åº¦å¿…é¡»å°</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-21">8.5 <code>std::function</code> åœ¨ VS2022 ä¸‹çš„é™åˆ¶ï¼šå¿…é¡»å¯æ‹·è´</h3>
<p>è¿™æ˜¯ Day5 æœ€å¤§å‘ï¼š<br/>
<strong>lambda æ•è·äº† move-onlyï¼ˆæ¯”å¦‚ packaged_taskï¼‰â†’ lambda move-only â†’ std::function è£…ä¸ä¸‹</strong>ã€‚</p>
<p>è§£å†³åŠæ³•ï¼ˆæˆ‘æœ€ç»ˆç”¨çš„ï¼‰ï¼š</p>
<ul>
<li>ç”¨ <code>shared_ptr</code> è®©æ•è·å¯¹è±¡å¯æ‹·è´</li>
<li>ä½¿ lambda å¯æ‹·è´</li>
<li>ä½¿ <code>std::function&lt;void()&gt;</code> èƒ½å­˜</li>
</ul>
<hr/>
<h2 data-id="heading-22">ä¹ã€æˆ‘æœ€ç»ˆè·‘é€šçš„ç‰ˆæœ¬</h2>
<p>ä¸‹é¢æ˜¯æˆ‘ Day5 æœ€ç»ˆç‰ˆã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;future&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPool</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">ThreadPool</span><span class="hljs-params">(<span class="hljs-type">size_t</span> thread_count)</span></span>;
    ~<span class="hljs-built_in">ThreadPool</span>();

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Enqueue</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; task)</span></span>;
    <span class="hljs-function">std::future&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">EnqueueInt</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">int</span>()&gt; task)</span></span>;

<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Work</span><span class="hljs-params">()</span></span>;

    std::vector&lt;std::thread&gt; workers_;
    std::queue&lt;std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; tasks_;
    std::mutex mtx_;
    std::condition_variable cv_;
    <span class="hljs-type">bool</span> stop_ = <span class="hljs-literal">false</span>;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ThreadPool::Work</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx_)</span></span>;
        cv_.<span class="hljs-built_in">wait</span>(lock, [<span class="hljs-keyword">this</span>] { <span class="hljs-keyword">return</span> !tasks_.<span class="hljs-built_in">empty</span>() || stop_; });
        <span class="hljs-keyword">if</span> (stop_ &amp;&amp; tasks_.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">break</span>;

        std::function&lt;<span class="hljs-type">void</span>()&gt; fn = std::<span class="hljs-built_in">move</span>(tasks_.<span class="hljs-built_in">front</span>());
        tasks_.<span class="hljs-built_in">pop</span>();

        lock.<span class="hljs-built_in">unlock</span>();
        <span class="hljs-built_in">fn</span>();
    }
}

ThreadPool::<span class="hljs-built_in">ThreadPool</span>(<span class="hljs-type">size_t</span> thread_count) {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(thread_count); ++i) {
        workers_.<span class="hljs-built_in">emplace_back</span>(&amp;ThreadPool::Work, <span class="hljs-keyword">this</span>);
    }
}

ThreadPool::~<span class="hljs-built_in">ThreadPool</span>() {
    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx_)</span></span>;
    stop_ = <span class="hljs-literal">true</span>;
    lock.<span class="hljs-built_in">unlock</span>();

    cv_.<span class="hljs-built_in">notify_all</span>();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; t : workers_) {
        t.<span class="hljs-built_in">join</span>();
    }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ThreadPool::Enqueue</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; task)</span> </span>{
    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx_)</span></span>;
    <span class="hljs-built_in">assert</span>(!stop_ &amp;&amp; <span class="hljs-string">"ThreadPool stopped"</span>);
    tasks_.<span class="hljs-built_in">push</span>(std::<span class="hljs-built_in">move</span>(task));
    lock.<span class="hljs-built_in">unlock</span>();
    cv_.<span class="hljs-built_in">notify_one</span>();
}

<span class="hljs-function">std::future&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ThreadPool::EnqueueInt</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">int</span>()&gt; task)</span> </span>{
    <span class="hljs-function">std::packaged_task&lt;<span class="hljs-title">int</span><span class="hljs-params">()</span>&gt; <span class="hljs-title">pt</span><span class="hljs-params">(task)</span></span>;
    std::future&lt;<span class="hljs-type">int</span>&gt; fut = pt.<span class="hljs-built_in">get_future</span>();
    <span class="hljs-keyword">auto</span> pt_ptr = std::make_shared&lt;std::packaged_task&lt;<span class="hljs-built_in">int</span>()&gt;&gt;(std::<span class="hljs-built_in">move</span>(pt));

    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx_)</span></span>;
    <span class="hljs-built_in">assert</span>(!stop_ &amp;&amp; <span class="hljs-string">"ThreadPool stopped"</span>);
    tasks_.<span class="hljs-built_in">emplace</span>([pt_ptr]() <span class="hljs-keyword">mutable</span> { (*pt_ptr)(); });
    lock.<span class="hljs-built_in">unlock</span>();

    cv_.<span class="hljs-built_in">notify_one</span>();
    <span class="hljs-keyword">return</span> fut;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std::chrono_literals;

    <span class="hljs-function">ThreadPool <span class="hljs-title">pool</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span>;

    std::cout &lt;&lt; <span class="hljs-string">"[main] submit tasks, main thread id = "</span>
              &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;

    <span class="hljs-keyword">auto</span> fut1 = pool.<span class="hljs-built_in">EnqueueInt</span>([] {
        std::cout &lt;&lt; <span class="hljs-string">"[task1] submit tasks, task1 thread id = "</span>
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    });

    <span class="hljs-keyword">auto</span> fut2 = pool.<span class="hljs-built_in">EnqueueInt</span>([] {
        std::cout &lt;&lt; <span class="hljs-string">"[task2] submit tasks, task2 thread id = "</span>
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(<span class="hljs-number">500</span>ms);
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
    });

    <span class="hljs-keyword">auto</span> fut3 = pool.<span class="hljs-built_in">EnqueueInt</span>([] {
        std::cout &lt;&lt; <span class="hljs-string">"[task3] submit tasks, task3 thread id = "</span>
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(<span class="hljs-number">100</span>ms);
        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;
    });

    <span class="hljs-keyword">auto</span> st = fut2.<span class="hljs-built_in">wait_for</span>(<span class="hljs-number">50</span>ms);
    <span class="hljs-keyword">if</span> (st == std::future_status::ready) {
        std::cout &lt;&lt; <span class="hljs-string">"[main] f2 is ready (unexpected)\n"</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (st == std::future_status::timeout) {
        std::cout &lt;&lt; <span class="hljs-string">"[main] f2 not ready after 50ms (expected timeout)\n"</span>;
    } <span class="hljs-keyword">else</span> {
        std::cout &lt;&lt; <span class="hljs-string">"[main] f2 deferred (usually not in thread pool)\n"</span>;
    }

    <span class="hljs-type">int</span> r1 = fut1.<span class="hljs-built_in">get</span>();
    <span class="hljs-type">int</span> r2 = fut2.<span class="hljs-built_in">get</span>();
    <span class="hljs-type">int</span> r3 = fut3.<span class="hljs-built_in">get</span>();

    std::cout &lt;&lt; <span class="hljs-string">"[main] results: "</span> &lt;&lt; r1 &lt;&lt; <span class="hljs-string">", "</span> &lt;&lt; r2 &lt;&lt; <span class="hljs-string">", "</span> &lt;&lt; r3 &lt;&lt; <span class="hljs-string">"\n"</span>;
    std::cout &lt;&lt; <span class="hljs-string">"[main] done\n"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-23">åã€Day5 å°ç»“ï¼šæˆ‘ä»Šå¤©çœŸæ­£â€œä»é›¶åˆ°æœ‰â€å­¦ä¼šäº†ä»€ä¹ˆï¼Ÿ</h2>
<p>ä»Šå¤©æˆ‘è§‰å¾—æˆ‘å­¦åˆ°çš„ä¸æ˜¯â€œä¼šå†™ EnqueueIntâ€ï¼Œè€Œæ˜¯ä¸‰ä»¶æ›´é‡è¦çš„äº‹ï¼š</p>
<ol>
<li>
<p><strong>çº¿ç¨‹æ± çš„æ‰§è¡Œç«¯åªåšä¸€ä»¶äº‹ï¼šæ‰§è¡Œ <code>void()</code> ä»»åŠ¡</strong><br/>
è¿”å›å€¼ä¸é  returnï¼Œé  future çš„å…±äº«çŠ¶æ€é€šé“ã€‚</p>
</li>
<li>
<p><strong>future/packaged_task çš„è´£ä»»è¾¹ç•Œéå¸¸æ¸…æ¥š</strong></p>
<ul>
<li>packaged_taskï¼šè´Ÿè´£æŠŠç»“æœå†™è¿›å»</li>
<li>futureï¼šè´Ÿè´£è®©è°ƒç”¨è€…åœ¨åˆé€‚çš„æ—¶é—´å–å‡ºæ¥</li>
</ul>
</li>
<li>
<p><strong>å·¥ç¨‹å®ç°ä¼šé‡åˆ°åº“çº¦æŸï¼ˆVS2022 + std::functionï¼‰</strong><br/>
move-only callable ä¸èƒ½è¿› std::function â†’ ç”¨ shared_ptr è®©å®ƒå¯æ‹·è´ï¼Œè¿™æ˜¯é¢è¯•æ—¶ä¹Ÿèƒ½è®²æ¸…æ¥šçš„â€œå·¥ç¨‹ç‚¹â€ã€‚</p>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cè¯­è¨€å®æˆ˜ï¼šæ‰‹æ“é«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ï¼ˆåŸºäº Ring Buffer + ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰]]></title>    <link>https://juejin.cn/post/7582785032852078655</link>    <guid>https://juejin.cn/post/7582785032852078655</guid>    <pubDate>2025-12-12T12:36:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582785032852078655" data-draft-id="7582637280218791990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cè¯­è¨€å®æˆ˜ï¼šæ‰‹æ“é«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ï¼ˆåŸºäº Ring Buffer + ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰"/> <meta itemprop="keywords" content="å¼€æº"/> <meta itemprop="datePublished" content="2025-12-12T12:36:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlp666hub"/> <meta itemprop="url" content="https://juejin.cn/user/2965810860569131"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cè¯­è¨€å®æˆ˜ï¼šæ‰‹æ“é«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ï¼ˆåŸºäº Ring Buffer + ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965810860569131/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlp666hub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T12:36:28.000Z" title="Fri Dec 12 2025 12:36:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»32åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Cè¯­è¨€å®æˆ˜ï¼šæ‰‹æ“é«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ï¼ˆåŸºäº Ring Buffer + ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰</strong></h2>
<h2 data-id="heading-1">1. ä¸ºä»€ä¹ˆ <code>printf</code> ä¸å¤Ÿç”¨ï¼Ÿ</h2>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå°¤å…¶æ˜¯åµŒå…¥å¼è®¾å¤‡ã€å®æ—¶ç³»ç»Ÿæˆ–é«˜å¹¶å‘æœåŠ¡ç«¯ç¨‹åºé‡Œï¼Œå¾ˆå¤šäººä¸€å¼€å§‹éƒ½ä¹ æƒ¯ç›´æ¥ç”¨ printfã€fprintf æˆ– write æŠŠæ—¥å¿—æ‰“åˆ°ä¸²å£ã€æ–‡ä»¶ã€Flashã€‚è¿™ç§åšæ³•åœ¨demoé˜¶æ®µæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†ä¸€æ—¦ä¸Šäº†ç”Ÿäº§ç¯å¢ƒæ‰å‘ç°è¿™ç©æ„å„¿æ˜¯ä¸ªéšå½¢çš„æ€§èƒ½æ€æ‰‹ã€‚</p>
<p>æˆ‘ä¸‹é¢åˆ—ä¸¾ä¸€ä¸‹å¸¸è§çš„å‡ ä¸ª<strong>è‡´å‘½é—®é¢˜</strong>ï¼ˆæœ¬äººä¹Ÿä¸å¹¸è¸©åˆ°è¿‡ï¼‰ï¼š</p>
<ol>
<li>
<p>åŒæ­¥é˜»å¡ï¼šåƒ<code>write</code>è¿™æ ·çš„åº•å±‚æ¥å£æ˜¯é˜»å¡çš„ï¼Œè€Œç£ç›˜ / Flash / ä¸²å£é€šå¸¸æ˜¯æ¯”è¾ƒæ…¢çš„ï¼ˆFlash æ“¦é™¤ç”šè‡³èƒ½åˆ°å‡ ç™¾æ¯«ç§’ï¼‰ï¼Œä¸šåŠ¡çº¿ç¨‹å°±åªèƒ½å¹²ç­‰ç€ã€‚</p>
<p>æˆ‘ä¹‹å‰å†™äº†ä¸ªdemoå®æµ‹äº†ä¸€ä¸‹ï¼Œç›´æ¥å†™å…¥ 2000 æ¡æ—¥å¿—è€—æ—¶ <strong>7ç§’</strong>ï¼Œè€Œä½¿ç”¨å¼‚æ­¥æ—¥å¿—ä»…éœ€ <strong>0.02ç§’</strong>ï¼Œæ€§èƒ½å·®è·è¾¾ <strong>300å€</strong>ã€‚</p>
</li>
<li>
<p>çº¿ç¨‹ä¸­æ–­é—®é¢˜ï¼šå¤šä»»åŠ¡æˆ–ä¸­æ–­é‡ŒåŒæ—¶ printfï¼Œæ²¡æœ‰é”çš„è¯æ—¥å¿—ç«‹åˆ»èŠ±å±ï¼ˆAçº¿ç¨‹æ‰“å°ä¸€åŠï¼ŒBçº¿ç¨‹æ’è¿›æ¥äº†ï¼‰ï¼Œå¯¼è‡´æ—¥å¿—æ²¡æ³•çœ‹ï¼Œè€ŒåŠ é”åˆä¼šå¸¦æ¥æ–°çš„æ€§èƒ½å’Œæ­»é”é£é™©ã€‚</p>
</li>
<li>
<p>ç¼“å­˜åˆ·æ–°ç­–ç•¥å¤±æ§ï¼š<code>printf</code> é»˜è®¤<strong>è¡Œç¼“å­˜</strong>ï¼ˆé‡åˆ° \n æˆ–ç¼“å†²åŒºæ»¡æ‰åˆ·ï¼‰ï¼Œåœ¨åµŒå…¥å¼é‡Œç»å¸¸å¿˜è®° <code>fflush</code>ï¼Œåœ¨åµŒå…¥å¼ç³»ç»Ÿå´©æºƒæˆ–æ–­ç”µçš„ç¬é—´ï¼Œç¼“å†²åŒºé‡Œé‡è¦çš„æ•°æ®å¾€å¾€è¿˜æ²¡æ¥å¾—åŠåˆ·å…¥ç£ç›˜å°±ä¸¢å¤±äº†<strong>å¯¼è‡´æ—¥å¿—ä¸¢å¤±</strong>éƒ½ä¸çŸ¥é“ã€‚</p>
</li>
<li>
<p>CPU å ç”¨ç‡çˆ†ç‚¸ï¼šé«˜é¢‘ç‡æ‰“æ—¥å¿—æ—¶ï¼ŒCPU å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰ I/Oï¼Œè€Œä¸æ˜¯å¹²æ­£äº‹ã€‚</p>
</li>
</ol>
<p>é‚£ä¹ˆæ­£ç¡®çš„æ“ä½œåº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬è¦æŠŠè®°å½•æ—¥å¿—å’Œå†™å…¥ç£ç›˜å½»åº•è§£è€¦ã€‚<strong>ä¸šåŠ¡çº¿ç¨‹</strong>åªè´Ÿè´£æŠŠæ—¥å¿—æ‰”è¿›ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºï¼ˆå¤§æ¦‚å‡ å¾®ç§’ï¼‰ï¼Œç„¶åç«‹åˆ»è¿”å›ç»§ç»­å¹²æ´»ã€‚ ç”±ä¸€ä¸ªç‹¬ç«‹çš„<strong>åå°çº¿ç¨‹</strong>æ…¢æ…¢æŠŠç¼“å†²åŒºå†…å®¹åˆ·åˆ°ç£ç›˜/Flash/ä¸²å£å»ã€‚è¿™å°±æ˜¯ç»å…¸çš„ â€œ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ â€ å’Œç¯å½¢ç¼“å†²åŒºçš„ç»„åˆã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šå·¥ä¸šçº§æ—¥å¿—åº“çš„åº•å±‚åŸç†ã€‚</p>
<h2 data-id="heading-2">2. ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</h2>
<p>ä¸ºäº†è§£å†³ä¸Šé¢æåˆ°çš„åŒæ­¥é˜»å¡é—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½è®©ä¸šåŠ¡çº¿ç¨‹ç›´æ¥å»â€œç¢°â€ç£ç›˜ã€‚æˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªä¸­é—´å±‚ï¼Œå°†<strong>äº§ç”Ÿæ—¥å¿—</strong>å’Œ<strong>å†™å…¥ç£ç›˜</strong>è¿™ä¸¤ä¸ªåŠ¨ä½œå½»åº•å‰¥ç¦»ã€‚è¿™æ­£æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ç»å…¸çš„<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong>çš„æœ€ä½³åº”ç”¨åœºæ™¯ã€‚</p>
<h3 data-id="heading-3">2.1 ç³»ç»Ÿæ¶æ„</h3>
<p>ä¸‹é¢è¦ä»‹ç»çš„è¿™ä¸ªæ¶æ„ä¹Ÿå°±æ˜¯<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong>è¿™ä¸ªåå­—çš„ç”±æ¥ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªæ—¥å¿—ç³»ç»Ÿçœ‹æˆä¸€ä¸ªç¹å¿™çš„é¤å…çš„å¨æˆ¿ã€‚å¯èƒ½æœ‰äººä¼šæƒ³â€œé‚£ç”Ÿäº§è€…å°±æ˜¯å¨å¸ˆï¼Œæ¶ˆè´¹è€…å°±æ˜¯é¡¾å®¢å‘—â€ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªæƒ³æ³•æ—¢åˆç†åˆä¸åˆç†ï¼Œåˆç†æ˜¯å› ä¸ºè¿™ä¸ªæƒ³æ³•æ˜¯ç¬¦åˆæˆ‘ä»¬çš„å¸¸è¯†çš„ï¼Œä¸åˆç†æ˜¯å› ä¸ºåœ¨æ—¥å¿—ç³»ç»Ÿè¿™ä¸ªç¯å¢ƒä¸‹ï¼Œæ˜¯æœ‰ç‰¹æ®Šæƒ…å†µå­˜åœ¨çš„ï¼Œåé¢ä¼šè§£é‡Šã€‚åœ¨è¿™é‡Œï¼Œå…¶å®ç”Ÿäº§è€…ç›¸å½“äºæœåŠ¡å‘˜ï¼Œæ¶ˆè´¹è€…ç›¸å½“äºå¨å¸ˆï¼Œè€Œä»–ä»¬ä¹‹é—´æœ‰ä¸€ä¸ªçª—å£ï¼Œå°±æ˜¯ç¼“å†²åŒºï¼ˆæ”¾èœå•ï¼‰ã€‚æ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯æœåŠ¡å‘˜å»ç»™å¤§é‡çš„å®¢äººç‚¹èœï¼Œç„¶åæŠŠèœå•æ”¾åœ¨çª—å£ï¼Œå¨å¸ˆä»çª—å£æ‹¿èœå•ï¼Œç„¶ååšé¥­ï¼Œåšé¥­å¯ä»¥ç±»æ¯”ä¸ºå†™ç£ç›˜ã€‚åˆ°è¿™é‡Œå°±ç»“æŸï¼Œè‡³å°‘åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä¸‹ï¼Œè¿™ä¸ªåœºæ™¯å·²ç»å¾ˆå®Œå–„äº†ã€‚æ‰€ä»¥å‰é¢é‚£ä¸ªæŠŠé¡¾å®¢å½“æˆæ¶ˆè´¹è€…çš„æƒ³æ³•æœ‰ç‚¹ä¸å¤ªåˆé€‚ï¼Œå¦‚æœè¿™æ ·ç†è§£å°±ç›¸å½“äºä¸€ä¸ªé¡¾å®¢åé‚£ä¸€ç›´åƒåƒåƒ......ï¼ˆèƒƒå£å¤§çš„è¯å…¶å®ä¹Ÿä¸æ˜¯ä¸è¡ŒğŸŒï¼‰</p>
<p>å¯èƒ½æœ‰çš„æœ‹å‹è¿˜æ˜¯è§‰å¾—ä¸å¤Ÿå½¢è±¡ï¼Œä¸‹é¢æˆ‘æ”¾ä¸€å¼ å›¾å¤§å®¶å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼šï¼ˆçº¯æ‰‹ç”»çš„ï¼Œæ„Ÿè§‰ç”»çš„ä¸é”™çš„æœ‹å‹ç‚¹èµåŠ å…³æ³¨ï¼Œä¸æƒ³çš„è¯å°±ç®—äº†ğŸ˜Šï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45bdb3055f634675a5cb1fde633fd717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=%2Fs%2Bt7FNsPqgKPmUkHdLOFhFg%2Bys%3D" alt="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ç³»ç»Ÿæ¶æ„å›¾.png.png" loading="lazy"/></p>
<p>å¯èƒ½æœ‰ç»†å¿ƒçš„æœ‹å‹æ³¨æ„åˆ°äº†ï¼Œæˆ‘åœ¨å›¾ç‰‡ä¸­ç”Ÿäº§è€…ç”¨çš„Producersï¼Œè€Œæ¶ˆè´¹è€…å´ç”¨çš„Consumerï¼Œä»–ä»¬ä¸€ä¸ªæ˜¯å¤æ•°ï¼Œä¸€ä¸ªæ˜¯å•æ•°ï¼Œæ„æ€æ˜¯æœ‰å¤šä¸ªç”Ÿäº§è€…è€Œåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚è¿™ä¸ªæ¨¡å‹çš„åç§°æ˜¯<strong>MPSC (Multi-Producer Single-Consumer) ï¼Œè¿™æ˜¯é«˜æ€§èƒ½æ—¥å¿—ç³»ç»Ÿçš„æ ‡å‡†æ¶æ„ã€‚</strong></p>
<p>ä¸ºä»€ä¹ˆæ¶ˆè´¹è€…åªæœ‰ä¸€ä¸ªå‘¢ï¼Ÿå¤šä¸ªæ¶ˆè´¹è€…ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p>
<ol start="0">
<li>æ—¥å¿—æ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆlog.txtï¼‰ã€‚å¦‚æœä½ æäº† 5 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹åŒæ—¶å¾€ä¸€ä¸ªæ–‡ä»¶é‡Œå†™ï¼Œä½ éœ€è¦åŠ å¾ˆé‡çš„é”æ¥é˜²æ­¢æ•°æ®é”™ä¹±ï¼ˆæ¯”å¦‚çº¿ç¨‹ A å†™äº†ä¸€åŠâ€œError...â€ï¼Œçº¿ç¨‹ B æ’è¿›æ¥å†™äº†â€œWarning...â€ï¼‰ã€‚æ—¢ç„¶æœ€ç»ˆéƒ½è¦<strong>åŠ é”æ’é˜Ÿå†™æ–‡ä»¶</strong>ï¼Œé‚£å¤šæå‡ ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä¸ä»…æ²¡å˜å¿«ï¼Œåè€Œå¢åŠ äº†<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€</strong>ï¼Œè¿˜ä¸å¦‚å°±ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨æ’é˜Ÿå†™ã€‚</li>
<li>å¯¹äºæœºæ¢°ç¡¬ç›˜æˆ–åµŒå…¥å¼ Flashï¼Œ<strong>é¡ºåºå†™å…¥</strong>æ˜¯æœ€å¿«çš„ã€‚å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…å¹¶å‘å†™ï¼Œç£å¤´ï¼ˆæˆ– Flash ä¸»æ§ï¼‰å¯èƒ½éœ€è¦è·³æ¥è·³å»ï¼Œæ€§èƒ½åè€Œä¼šä¸‹é™ã€‚</li>
<li>ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œé€»è¾‘æ¸…æ™°ï¼Œä¸å®¹æ˜“å‡º Bugã€‚</li>
</ol>
<p>å› æ­¤ï¼Œå¯¹äºæ—¥å¿—è½ç›˜è¿™ç§<strong>I/Oå¯†é›†å‹</strong>çš„ä»»åŠ¡ï¼Œå•æ¶ˆè´¹è€…æ˜¯æœ€é«˜æ•ˆçš„é€‰æ‹©ã€‚</p>
<p>è¿˜æœ‰çš„æœ‹å‹å¯èƒ½ä¼šé—®ï¼Œä½ ç¬¬ä¸€ç« æ˜æ˜å†™äº†å¼‚æ­¥æ—¥å¿—å¿«ï¼ŒåŒæ­¥é˜»å¡æ˜¯è‡´å‘½é—®é¢˜ï¼Œæ€ä¹ˆä¸Šé¢çš„æ¶æ„å›¾åˆè¯´å®ç°äº†çº¿ç¨‹åŒæ­¥å‘¢ï¼Ÿè¿™ä¸æ˜¯å·¦è„‘æ”»å‡»å³è„‘å—ï¼Ÿå•Šï¼Œè¿™é‡Œç¡®å®æ¯”è¾ƒç»•ï¼Œæˆ‘æœ‰æ—¶ä¹Ÿå¾—æƒ³å¥½ä¹…æ‰èƒ½æƒ³é€šã€‚ä¸‹é¢æˆ‘ä»¬è¯¦ç»†æ‹†è§£ä¸€ä¸‹ï¼š</p>
<ol start="0">
<li>
<p>åœ¨å®è§‚å±‚é¢ï¼šä¸šåŠ¡æµç¨‹æ˜¯å¼‚æ­¥çš„</p>
<p>è¿™é‡Œçš„å¼‚æ­¥æè¿°çš„æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„åä½œå…³ç³»ã€‚</p>
<p>åŒæ­¥æ—¥å¿—ï¼ˆå­˜åœ¨ç¼ºé™·ï¼‰ï¼šä¸šåŠ¡çº¿ç¨‹è¯´ï¼šâ€œæˆ‘è¦å†™æ—¥å¿—â€ï¼Œç„¶åå°±åœ¨é‚£<strong>æ­»ç­‰</strong>ï¼Œç›´åˆ°ç£ç›˜å†™å®Œæ‰èµ°ã€‚è¿™å«â€œåŒæ­¥é˜»å¡â€ã€‚</p>
<p>å¼‚æ­¥æ—¥å¿—ï¼šä¸šåŠ¡çº¿ç¨‹è¯´ï¼šâ€œæˆ‘è¦å†™æ—¥å¿—â€ï¼ŒæŠŠæ•°æ®æ‰”è¿›ç¼“å†²åŒºï¼Œ<strong>è½¬èº«å°±èµ°</strong>ï¼Œå»å¹²åˆ«çš„äº‹äº†ã€‚å†™ç£ç›˜çš„äº‹ç•™ç»™åå°æ…¢æ…¢åšã€‚è¿™å«â€œå¼‚æ­¥éé˜»å¡â€ã€‚</p>
<p>å› ä¸ºä¸šåŠ¡çº¿ç¨‹ä¸éœ€è¦ç­‰ I/Oï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¹‹ä¸º<strong>å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿ</strong>ã€‚è¿™æ˜¯æ€§èƒ½å¤§å¹…åº¦æå‡çš„åŸå› ã€‚</p>
</li>
<li>
<p>åœ¨å¾®è§‚å±‚é¢ï¼šå†…å­˜è®¿é—®æ˜¯éœ€è¦åŒæ­¥çš„</p>
<p>è¿™é‡Œçš„åŒæ­¥æè¿°çš„æ˜¯ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å—å†…å­˜æ—¶çš„å®‰å…¨è§„åˆ™ã€‚</p>
<p>å¦‚æœä¸šåŠ¡çº¿ç¨‹æ­£åœ¨å¾€ <code>Buffer[0]</code> å†™æ•°æ®ï¼Œè¿˜æ²¡å†™å®Œï¼Œåå°çº¿ç¨‹çªç„¶è·‘è¿‡æ¥è¦æŠŠ <code>Buffer[5]</code> è¯»èµ°ã€‚è¿™å°±ä¹±å¥—äº†ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œè®©ä»–ä»¬åè°ƒä¸€ä¸‹ï¼šâ€œæˆ‘è¦å†™äº†ï¼Œä½ å…ˆåˆ«åŠ¨â€ï¼ˆäº’æ–¥é”ï¼‰ï¼Œâ€œæˆ‘å†™å®Œäº†ï¼Œè¯¥ä½ è¯»äº†â€ï¼ˆæ¡ä»¶å˜é‡ï¼‰ã€‚</p>
<p>è¿™ç§ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ã€ä¸æ‰“æ¶çš„åè°ƒæœºåˆ¶ï¼Œåœ¨æ“ä½œç³»ç»Ÿé‡Œå«<strong>çº¿ç¨‹åŒæ­¥</strong>ã€‚</p>
</li>
</ol>
<p>ä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥æ¯”å–»ä¸€ä¸‹ï¼š</p>
<p>æˆ‘ä»¬æŠŠä¸šåŠ¡çº¿ç¨‹çœ‹ä½œæœåŠ¡å‘˜ï¼ŒæŠŠ<code>Ring buffer</code>çœ‹ä½œçª—å£çš„èœå•é’‰ï¼ˆå›ºå®šèœå•ï¼‰ï¼ŒæŠŠæ—¥å¿—çº¿ç¨‹çœ‹ä½œå¨å¸ˆã€‚è¿™é‡Œå…ˆç®€å•æä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆæŠŠ<code>Ring Buffer</code>çœ‹ä½œèœå•é’‰ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¯å½¢ç¼“å†²åŒº<code>Ring Buffer</code>æ­£æ˜¯ä¸€ä¸ª<code>malloc</code>å¾—æ¥çš„å·¨å¤§æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„<strong>å¤§å°æ˜¯å›ºå®šçš„</strong>ï¼Œæ­£å¦‚èœå•é’‰åªæœ‰ä¸€ä¸ªï¼Œèœå•åªèƒ½æŒ‰é¡ºåºä¸€ä¸ªä¸€ä¸ªæ’ï¼Œèƒ½æ’çš„èœå•æ•°é‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œè¿™ä¸ªåé¢è¿˜ä¼šè¯¦ç»†ä»‹ç»ï¼Œå…ˆå›å½’ä¸»é¢˜ã€‚</p>
<p>åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ç†è§£å°±å®¹æ˜“å¤šäº†ã€‚</p>
<p>å¼‚æ­¥ï¼šæœåŠ¡å‘˜å†™å¥½èœå•ï¼Œå¾€å§å°ä¸Šä¸€æ’ï¼Œè½¬èº«å°±å»æ‹›å‘¼ä¸‹ä¸€æ¡Œå®¢äººäº† <strong>ï¼ˆå¼‚æ­¥ï¼‰</strong> ï¼Œä»–ä¸éœ€è¦ç«™åœ¨å¨æˆ¿é—¨å£ç­‰ç€å¨å¸ˆæŠŠèœç‚’å¥½ï¼ˆåŒæ­¥ï¼‰ã€‚è¿™å°±æ˜¯æ•ˆç‡é«˜çš„åŸå› ã€‚</p>
<p>çº¿ç¨‹åŒæ­¥ï¼šå§å°åªæœ‰ä¸€ä¸ªï¼Œèœå•é’‰åªæœ‰ä¸€ä¸ªã€‚å¦‚æœæœåŠ¡å‘˜æ­£åœ¨å¾€ä¸Šæ’èœå•ï¼Œå¨å¸ˆæ­£å¥½ä¼¸æ‰‹å»æ‹”èœå•ï¼Œä¸¤äººçš„æ‰‹å°±ä¼šæ’åœ¨ä¸€èµ·ï¼ˆç–¼ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè§„åˆ™ï¼ˆäº’æ–¥é”ï¼‰ï¼š<strong>å½“ä¸€ä¸ªäººæ‰‹åœ¨æ¥è§¦èœå•é’‰æ—¶ï¼Œå¦ä¸€ä¸ªäººå¿…é¡»åœ¨æ—è¾¹ç­‰ç€ã€‚</strong> è¿™å°±æ˜¯<strong>çº¿ç¨‹åŒæ­¥</strong>ï¼Œå¹¶ä¸æ˜¯è¯´æˆ‘ä»¬è¦ä¸€èµ·åŠ¨ä½œï¼Œè€Œæ˜¯æˆ‘ä»¬è¦<strong>åè°ƒå¥½é¡ºåºï¼Œä¸è¦æ‰“æ¶</strong>ã€‚</p>
<h3 data-id="heading-4">2.2 æ ¸å¿ƒè§’è‰²å®šä¹‰</h3>
<p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè§’è‰²éƒ½æœ‰è‡ªå·±çš„èŒè´£ï¼š</p>
<ol start="0">
<li>
<p>ç”Ÿäº§è€…ï¼š</p>
<p>ç³»ç»Ÿä¸­çš„ä¸šåŠ¡é€»è¾‘çº¿ç¨‹ï¼ˆå¦‚ä¼ æ„Ÿå™¨ä¿¡æ¯é‡‡é›†ï¼‰ï¼Œå®ƒè°ƒç”¨ <code>log_push</code> æ¥å£ï¼Œå°†æ ¼å¼åŒ–å¥½çš„æ—¥å¿—å­—ç¬¦ä¸²<strong>å†™å…¥ç¼“å†²åŒº</strong>ã€‚å¦‚æœç¼“å†²åŒºæ²¡æ»¡ï¼Œå†™å…¥åŠ¨ä½œå‡ ä¹æ˜¯ç¬æ—¶çš„ï¼Œå¦‚æœæ»¡äº†ï¼Œå¯ä»¥é€‰æ‹©ä¸¢å¼ƒæˆ–çŸ­æš‚ç­‰å¾…ï¼ˆè¿™å–å†³äºç­–ç•¥ï¼‰ã€‚</p>
</li>
<li>
<p>ç¯å½¢ç¼“å†²åŒºï¼š</p>
<p>ä¸€æ®µå›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚ä½œä¸ºâ€œè“„æ°´æ± â€ï¼Œå¹³æ»‘ä¸šåŠ¡çº¿ç¨‹çš„æµé‡æ³¢å³°ã€‚ä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿç¯å½¢é˜Ÿåˆ—ï¼Œé¿å…é¢‘ç¹çš„å†…å­˜ç”³è¯·ä¸é‡Šæ”¾ã€‚</p>
</li>
<li>
<p>æ¶ˆè´¹è€…ï¼š</p>
<p>ä¸€ä¸ªç‹¬ç«‹çš„åå°å®ˆæŠ¤çº¿ç¨‹ã€‚æ­»å¾ªç¯æ£€æŸ¥ç¼“å†²åŒºã€‚æœ‰æ•°æ®å°±å–å‡ºï¼Œå†™å…¥æ–‡ä»¶ <code>write</code>ï¼Œæ²¡æ•°æ®å°±æŒ‚èµ· <code>wait</code>ï¼ŒèŠ‚çœ CPU èµ„æºã€‚è™½ç„¶å®ƒå†™ç£ç›˜æ…¢ï¼Œä½†å®ƒä¸€ç›´åœ¨åå°é»˜é»˜å·¥ä½œï¼Œ<strong>ä¸å½±å“å‰å°ä¸šåŠ¡</strong>ã€‚</p>
</li>
</ol>
<h3 data-id="heading-5">2.3 ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</h3>
<p>è§£è€¦ï¼šè¿™æ ·è®¾è®¡å¯ä»¥<strong>è®©ä¸šåŠ¡é€»è¾‘ä¸å†ä¾èµ–ç£ç›˜ I/O çš„é€Ÿåº¦</strong>ã€‚å“ªæ€•ç£ç›˜çªç„¶å¡é¡¿äº† 1 ç§’ï¼Œä¸šåŠ¡çº¿ç¨‹ä¾ç„¶å¯ä»¥æµç•…è¿è¡Œï¼Œåªè¦ç¼“å†²åŒºæ²¡æ»¡ã€‚</p>
<p>å‰Šå³°å¡«è°·ï¼šåœ¨æŸä¸€ç¬é—´ï¼Œæ—¥å¿—é‡å¯èƒ½<strong>ç¬é—´çˆ†å‘</strong>ã€‚ç¼“å†²åŒºå¯ä»¥<strong>æš‚æ—¶å…œä½</strong>è¿™äº›æ•°æ®ï¼Œåå°çº¿ç¨‹å†æ…¢æ…¢æ¶ˆåŒ–ã€‚å¦‚æœæ²¡æœ‰ç¼“å†²åŒºï¼Œè¿™ç§ç¬é—´çš„å¤§é‡ I/O è¯·æ±‚å¯èƒ½ä¼šç›´æ¥æŠŠç³»ç»Ÿæ‹–å®ã€‚</p>
<p>æ‰¹é‡å†™å…¥ï¼šè¿™é‡Œè¦å…ˆæä¸€å˜´ï¼Œæœ¬é¡¹ç›®æ¼”ç¤ºçš„æ˜¯åŸºç¡€å¼‚æ­¥å†™å…¥ï¼Œæ²¡æœ‰é‡‡ç”¨æ‰¹é‡å†™å…¥ã€‚å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…åˆ<strong>æ‰¹é‡å†™å…¥</strong>ï¼ˆæ”’å¤Ÿ 4KB å†è½ç›˜ï¼‰ï¼Œæ€§èƒ½è¿˜èƒ½è¿›ä¸€æ­¥å‹æ¦¨ï¼Œè¿™ä¹Ÿæ˜¯ 300 å€å·®è·çš„æ¥æºä¹‹ä¸€ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸‹æ‰¹é‡å†™å…¥ï¼Œçœ‹çœ‹æ€§èƒ½å·®è·ç›¸æ¯”æ¯æ¡æ—¥å¿—å†™ä¸€æ¬¡æœ‰å¤šå¤§ã€‚åœ¨è¿›é˜¶ä¼˜åŒ–ä¸­ï¼Œæ¶ˆè´¹è€…å¯ä»¥<strong>ä¸€æ¬¡ç§¯æ”’ 4KB æ•°æ®å†ä¸€æ¬¡æ€§å†™å…¥ç£ç›˜</strong>ï¼Œè¿›ä¸€æ­¥å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œå»¶é•¿ Flash å¯¿å‘½ã€‚</p>
<h2 data-id="heading-6">3. æ•°æ®ç»“æ„é€‰å‹ï¼šä¸ºä½•æŠ›å¼ƒé“¾è¡¨ï¼Ÿ</h2>
<p>åœ¨è®¾è®¡æ—¥å¿—ç¼“å†²åŒºçš„å­˜å‚¨ç»“æ„æ—¶ï¼Œæœ‰ä¸¤ç§æ•°æ®ç»“æ„å¯ä»¥ä¾›æˆ‘ä»¬æŒ‘é€‰ï¼š</p>
<ol start="0">
<li>é“¾è¡¨ï¼šåŠ¨æ€å¢é•¿ï¼Œç†è®ºä¸Šæ— é™å¤§ã€‚</li>
<li>ç¯å½¢ç¼“å†²åŒºï¼šåŸºäºå®šé•¿æ•°ç»„ï¼Œå¾ªç¯ä½¿ç”¨ã€‚</li>
</ol>
<p>åˆå­¦è€…å¾€å¾€<strong>å–œæ¬¢ç”¨é“¾è¡¨</strong>ï¼Œå› ä¸ºç®€å•ä¸”ä¸éœ€è¦è€ƒè™‘å†…å­˜å æ»¡çš„æƒ…å†µã€‚ä½†åœ¨<strong>é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€é•¿æœŸè¿è¡Œ</strong>çš„åµŒå…¥å¼/æœåŠ¡ç«¯åœºæ™¯ä¸‹ï¼Œé“¾è¡¨æœ‰ç€è‡´å‘½çš„ç¼ºé™·ã€‚</p>
<h3 data-id="heading-7">3.1 é“¾è¡¨çš„ä¸‰å¤§ç¼ºé™·</h3>
<p>æ—¥å¿—ç³»ç»Ÿä¸€èˆ¬æ˜¯è¦é•¿æœŸè¿è¡Œçš„ï¼Œé‡‡ç”¨é“¾è¡¨çš„æ—¥å¿—ç³»ç»Ÿåœ¨å‹æµ‹å’Œé•¿æœŸè¿è¡Œä¸‹é€šå¸¸ä¼šæš´éœ²ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼š</p>
<h4 data-id="heading-8">3.1.1 å†…å­˜ç¢ç‰‡åŒ–</h4>
<p>æ¯å½“æœ‰æ–°æ—¥å¿—äº§ç”Ÿï¼Œéƒ½éœ€è¦è°ƒç”¨ <code>malloc</code> åˆ†é…ä¸€ä¸ªå°èŠ‚ç‚¹ï¼Œæ¶ˆè´¹åè°ƒç”¨ freeé‡Šæ”¾å†…å­˜ã€‚ä½†åœ¨é«˜é¢‘æ—¥å¿—åœºæ™¯ä¸‹ï¼ˆå¦‚æ¯ç§’ 1000 æ¬¡ï¼‰ï¼Œé¢‘ç¹çš„ç”³è¯·é‡Šæ”¾ä¼šå°†<strong>å †å†…å­˜ç¢ç‰‡åŒ–</strong>ã€‚åœ¨åµŒå…¥å¼è®¾å¤‡é•¿æœŸè¿è¡Œçš„æ¡ä»¶ä¸‹ï¼ˆ7x24å°æ—¶ï¼‰ï¼Œææ˜“å¯¼è‡´ <strong>OOM (Out Of Memory)</strong> ï¼Œå³ä½¿å‰©ä½™æ€»å†…å­˜è¶³å¤Ÿï¼Œå´ç”³è¯·ä¸åˆ°è¿ç»­çš„å¤§å—å†…å­˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42b3db74a455461f8156b444220e271e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=LPRsoj83ibKJ4lrLyNu%2FMqrMRzs%3D" alt="ç‘å£«å¥¶é…ª.png" loading="lazy"/></p>
<p>è¿™å¼ å›¾ç‰‡åº”è¯¥æ˜¯æ¯”è¾ƒå½¢è±¡çš„ï¼Œå¤§å®¶çœ‹åˆ°è¿™å¼ å›¾ç‰‡åº”è¯¥èƒ½å¤Ÿæ˜ç™½å†…å­˜ç¢ç‰‡åŒ–å¤§æ¦‚æ˜¯ä»€ä¹ˆæ„æ€äº†ã€‚</p>
<h4 data-id="heading-9">3.1.2 å†…å­˜åˆ†é…çš„æ€§èƒ½å¼€é”€</h4>
<p><code>malloc</code> å’Œ <code>free</code> å¹¶ä¸æ˜¯ç®€å•çš„ C è¯­å¥ï¼Œå®ƒä»¬æ˜¯<strong>ç³»ç»Ÿåº“å‡½æ•°</strong>ã€‚å®ƒä»¬å†…éƒ¨ç»´æŠ¤ç€å¤æ‚çš„å†…å­˜é“¾è¡¨ï¼Œå¹¶ä¸”ä¸ºäº†<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œmalloc å†…éƒ¨é€šå¸¸ä¹Ÿæœ‰<strong>é”</strong>ã€‚</p>
<p>å¹¶ä¸”åœ¨å†…å­˜ç¢ç‰‡åŒ–åï¼Œ<code>malloc</code>è°ƒç”¨äº§ç”Ÿçš„<strong>å¼€é”€ä¼šè¶Šæ¥è¶Šå¤§</strong>ï¼Œå› ä¸ºå†…å­˜ä¸Šçš„å­”æ´è¶Šæ¥è¶Šå¤šï¼Œè¿™ä½¿å¾—å¯»æ‰¾ä¸€å—åˆé€‚å¤§å°çš„å†…å­˜è¶Šæ¥è¶Šå›°éš¾ã€‚é«˜é¢‘è°ƒç”¨ <code>malloc</code> æœ¬èº«å°±ä¼šæ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œè¿™å·²ç»è¿èƒŒäº†æˆ‘ä»¬æé€Ÿå†™å…¥çš„åˆè¡·ã€‚</p>
<h4 data-id="heading-10">3.1.3 CPU ç¼“å­˜å¯¹é“¾è¡¨ä¸å‹å¥½</h4>
<p>æœ‰æœ‹å‹å°±æƒ³é—®äº†ï¼šâ€œä¸ºä»€ä¹ˆCPUç¼“å­˜å¯¹é“¾è¡¨ä¸å‹å¥½å‘¢ï¼Ÿéš¾é“å®ƒå¯¹æ•°ç»„å°±å¾ˆå‹å¥½å—ï¼Ÿâ€ã€‚æ˜¯çš„ï¼Œä»–å¯¹æ•°ç»„ç¡®å®å‹å¥½ï¼Œä½†è¿™å¹¶ä¸æ˜¯å®ƒæ­§è§†é“¾è¡¨ï¼Œè€Œæ˜¯ç”±CPUæœ¬èº«çš„ç‰¹æ€§å†³å®šçš„ã€‚</p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ•°ç»„çš„å†…å­˜æ˜¯è¿ç»­çš„ï¼Œè€Œé“¾è¡¨çš„èŠ‚ç‚¹åœ¨å †å†…å­˜ä¸­åˆ†æ•£åˆ†å¸ƒç€ï¼Œéå†é“¾è¡¨éœ€è¦éšæœºè·³è·ƒè®¿é—®å†…å­˜ï¼Œå¯¼è‡´ <strong>Cache Missï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰</strong> ç‡æé«˜ï¼Œä¸¥é‡æ‹–æ…¢ CPU æ•ˆç‡ã€‚</p>
<p>å¹¶ä¸”CPUè¯»å–å†…å­˜æ—¶ï¼Œä¼šåˆ©ç”¨ <strong>ç©ºé—´å±€éƒ¨æ€§</strong> å°†ç›¸é‚»çš„æ•°æ®é¢„å–åˆ° <strong>L1/L2 Cache</strong> ä¸­ï¼Œå› æ­¤æ•°ç»„å°±å æ®äº†å¤©ç„¶çš„ä¼˜åŠ¿ã€‚</p>
<p>è¿™é‡Œæœ‰å¿…è¦æ‹“å±•ä¸€ä¸‹ <strong>Cache Miss</strong> ï¼Œç”¨ä¸€å¥é€šä¿—ç‚¹çš„è¯æ¥è®²ï¼šç°ä»£ CPU æ€§èƒ½çš„æå¤§ç¨‹åº¦ä¸Šå–å†³äºæ•°æ®ç¦»æ ¸å¿ƒæœ‰å¤šè¿‘ï¼Œè€Œ <strong>Cache Miss</strong> æ­£æ˜¯ç”±äºè¦è®¿é—®çš„æ•°æ®å¤ªè¿œæ‰€å¯¼è‡´çš„ã€‚</p>
<p>ä¸‹é¢è¦èŠçš„æ˜¯è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­æ¯”è¾ƒç»å…¸çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ï¼Œä½†æˆ‘ä¼šå°½åŠ›æŠŠå®ƒæè¿°çš„å½¢è±¡ä¸€ç‚¹ï¼š</p>
<h5 data-id="heading-11">3.1.3.1 Cacheçš„å±‚çº§ç»“æ„</h5>
<p>é€šå¸¸æˆ‘ä»¬è¯´L1ï¼ŒL2ï¼ŒL3ä¸‰å±‚ç¼“å­˜ã€‚</p>
<p><strong>L1 Cacheï¼ˆä¸€çº§ç¼“å­˜ï¼‰</strong> ï¼šç¦» CPU æ ¸å¿ƒæœ€è¿‘ï¼Œå°±åœ¨æ ¸å¿ƒå†…éƒ¨ã€‚é€Ÿåº¦æœ€å¿«ï¼Œä½†å†…å­˜æœ€å°ï¼Œå¤§å°ä¸º32æˆ–64KBï¼Œé€Ÿåº¦çº¦<strong>1çº³ç§’</strong>ã€‚</p>
<p><strong>L2 Cacheï¼ˆäºŒçº§ç¼“å­˜ï¼‰</strong> ï¼šç¨å¾®è¿œä¸€ç‚¹ï¼Œ<strong>é€šå¸¸</strong>ä¹Ÿæ˜¯æ¯ä¸ªæ ¸å¿ƒç‹¬äº«ã€‚æ¯” L1 æ…¢ä¸€ç‚¹ï¼Œä½†å†…å­˜æ›´å¤§ï¼Œ256KB æˆ– 512KBã€‚é€Ÿåº¦çº¦ <strong>3-10 çº³ç§’</strong>ã€‚</p>
<p><strong>L3 Cacheï¼ˆä¸‰çº§ç¼“å­˜ï¼‰</strong> ï¼šæ‰€æœ‰ CPU æ ¸å¿ƒ<strong>å…±äº«</strong>çš„ã€‚æ›´å¤§ï¼Œä½†æ›´æ…¢ï¼Œå‡  MB åˆ°å‡ å MBï¼Œé€Ÿåº¦çº¦ <strong>10-20 çº³ç§’</strong>ã€‚</p>
<p><strong>å†…å­˜</strong>ï¼šä¸»æ¿ä¸Šçš„å†…å­˜æ¡ã€‚å·¨å¤§ä½†ææ…¢ï¼Œé€Ÿåº¦çº¦ <strong>60-100 çº³ç§’</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fac7d7927354f9395727ac8483640c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=XoES%2BtXzfjuhuFYRxitnylI6ITE%3D" alt="ä¸‰å±‚ç¼“å­˜.png" loading="lazy"/></p>
<p>è¿™å¼ å›¾æ˜¯æˆ‘ç”µè„‘çš„é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯16æ ¸çš„ã€‚L1ç¼“å­˜ä¸º1MBï¼Œå¹³æ‘Šåˆ°æ¯ä¸ªæ ¸ä¸Šé¢å°±æ˜¯64KB/æ ¸ã€‚L2ç¼“å­˜å¹³æ‘Šåˆ°æ¯ä¸ªæ ¸ä¸Šé¢æ˜¯1MB/æ ¸ã€‚L3ç¼“å­˜çš„64MBæ˜¯æ‰€æœ‰16ä¸ªæ ¸å¿ƒå…±äº«çš„ã€‚</p>
<p>è¿™ä¸ªé…ç½®çœ‹èµ·æ¥æ¯”ä¸Šé¢ä»‹ç»çš„å‚æ•°è¦å¤§ä¸€ç‚¹ï¼ˆå®é™…ä¸Šå¤§å·®ä¸å·®ï¼‰ï¼Œä½†æ˜¯åšåµŒå…¥å¼å¼€å‘æ—¶ï¼Œé¢å¯¹çš„æ¿å­å¯èƒ½æ ¹æœ¬å°±æ²¡æœ‰L2å’ŒL3ç¼“å­˜ã€‚<strong>Cache Miss</strong> çš„ä»£ä»·ä¼šç›´æ¥ååº”åœ¨è®¾å¤‡å¡é¡¿ä¸Šã€‚</p>
<h5 data-id="heading-12">3.1.3.2 ä»€ä¹ˆæ˜¯ Cache Miss</h5>
<p>å…ˆä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <strong>Cache Lineï¼ˆç¼“å­˜è¡Œï¼‰</strong> ï¼Œå¦‚æœCPUè¦è®¿é—®ä¸€ä¸ªå­—èŠ‚ï¼Œç³»ç»Ÿä¸ä¼šåªç»™å®ƒè¿™ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªå­—èŠ‚æ‰€åœ¨çš„ <strong>Cache Line</strong> å…¨éƒ¨ç»™å®ƒï¼Œè¿™ä¸ª <strong>Cache Line</strong> é€šå¸¸æ˜¯<strong>64å­—èŠ‚</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå½“è¯»å–å†…å­˜åœ°å€ 0x1000 æ—¶ï¼ŒCPU ä¼šè‡ªåŠ¨æŠŠ 0x1000 åˆ° 0x103F çš„ 64 å­—èŠ‚å…¨éƒ¨åŠ è½½åˆ° Cache ä¸­ã€‚</p>
<p><strong>æ¯ä¸€æ¬¡æŸ¥æ‰¾å¤±è´¥ï¼Œéƒ½å«ä¸€æ¬¡ Missã€‚</strong></p>
<p>å½“CPUè¦è¯»å–ä¸€ä¸ªå˜é‡æ—¶ï¼Œå®ƒä¼šå…ˆæŸ¥L1ï¼Œå¦‚æœL1å‘½ä¸­å°±ç›´æ¥ä½¿ç”¨ï¼Œè€—æ—¶1nsã€‚å¦‚æœL1æœªå‘½ä¸­å°±æŸ¥L2ã€‚</p>
<p>å¦‚æœL2å‘½ä¸­ï¼ŒæŠŠæ•°æ®æ¬åˆ°L1å†ç»™CPUï¼Œè€—æ—¶5nsã€‚å¦‚æœL2æœªå‘½ä¸­å°±æŸ¥L3ã€‚</p>
<p>å¦‚æœL3å‘½ä¸­ï¼ŒæŠŠæ•°æ®æ¬åˆ°L2ï¼Œå†æ¬åˆ°L1å†ç»™CPUï¼Œè€—æ—¶15nsã€‚å¦‚æœL3ä¹ŸæŸ¥ä¸åˆ°ï¼Œé‚£å°±æ‚²å‰§äº†ã€‚</p>
<p>æ­¤æ—¶ï¼ŒCPUåªèƒ½æŒ‚èµ·ç­‰å¾…ï¼Œè®©å†…å­˜æ§åˆ¶å™¨å»RAMé‡Œé¢æ‰¾è¿™ä¸€ç­‰å¯èƒ½å°±æ˜¯ä¸Šç™¾çº³ç§’ã€‚å¯¹äº 2GHz çš„ CPU æ¥è¯´ï¼Œ100ns æ„å‘³ç€å®ƒå¯ä»¥ç©ºè½¬ <strong>200 ä¸ªå‘¨æœŸ</strong>ã€‚è¿™æ®µæ—¶é—´ CPU ä»€ä¹ˆéƒ½å¹²ä¸äº†ï¼Œçº¯æµªè´¹ã€‚</p>
<p>å¯¹äºæ•°ç»„ï¼šæ•°ç»„åœ¨å†…å­˜é‡Œæ˜¯<strong>è¿ç»­å­˜æ”¾</strong>çš„ã€‚å½“CPUè¦è®¿é—®<strong>æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ </strong>ï¼Œå¤§æ¦‚ç‡æ˜¯ä¸åœ¨ä¸‰å±‚ç¼“å­˜çš„ï¼Œä»–å¯èƒ½è¦ç­‰å¾ˆä¹…æ•°æ®æ‰èƒ½è¢«æ‹¿è¿‡æ¥ï¼Œé€Ÿåº¦å½“ç„¶å°±æ¯”è¾ƒæ…¢äº†ï¼Œè¿™å« <strong>Cache Miss</strong> ã€‚ä½†å®ƒæ‹¿å›æ¥çš„æ˜¯æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€åœ¨çš„ <strong>Cache Line</strong> ï¼Œå…±64ä¸ªå­—èŠ‚ã€‚å½“ä»–å¤„ç†å®Œç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¦å¤„ç†ç¬¬äºŒä¸ªæ—¶ï¼Œå“ï¼Œå®ƒå‘ç°ç¬¬äºŒä¸ªå…ƒç´ å°±åœ¨ä»–æ‰‹è¾¹ï¼Œå®ƒå¯ä»¥å¾ˆå¿«çš„å¤„ç†å®Œç¬¬äºŒä¸ªå…ƒç´ ï¼Œè¿™å« <strong>Cache Hitï¼ˆç¼“å­˜å‘½ä¸­ï¼‰</strong> ã€‚å¹¶ä¸”åé¢å®ƒè¦å¤„ç†çš„å…ƒç´ å¯èƒ½å…¨éƒ½åœ¨å®ƒæ‰‹è¾¹ï¼Œä¹Ÿå°±æ˜¯è¯´åé¢å¯èƒ½å…¨éƒ¨ <strong>Cache Hit</strong> ï¼Œè¿™æ ·æ•ˆç‡æ˜¯æé«˜çš„ã€‚</p>
<p>å¯¹äºé“¾è¡¨ï¼šé“¾è¡¨çš„ç»“ç‚¹æ˜¯<code>malloc</code>å‡ºæ¥çš„ï¼Œåœ¨å †å†…å­˜é‡Œé¢çš„åˆ†å¸ƒæ˜¯æ²¡æœ‰è§„çŸ©å¯è¨€çš„ã€‚è¿™æ—¶CPUè¦è®¿é—®æ¯ä¸€ä¸ªç»“ç‚¹ï¼Œè€Œè¿™äº›ç»“ç‚¹å­˜åœ¨äºä¸‰å±‚ç¼“å­˜çš„æ¦‚ç‡å¾ˆå°ï¼Œå¹¶ä¸”é“¾è¡¨æ²¡æœ‰åƒæ•°ç»„é‚£æ ·ï¼Œä¸€æ¬¡è®¿é—®æ…¢ä½†å¯¹åé¢å¤šæ¬¡è®¿é—®æ•ˆç‡æå‡å…·æœ‰ä¿ƒè¿›ä½œç”¨çš„æœºåˆ¶ã€‚å› æ­¤ï¼Œå¦‚æœä½¿ç”¨é“¾è¡¨ï¼Œ<strong>Cache Miss</strong> çš„æ¦‚ç‡æé«˜ã€‚</p>
<h5 data-id="heading-13">3.1.3.3 ä¸€ç‚¹å°è¡¥å……</h5>
<p>åœ¨é«˜ç«¯åµŒå…¥å¼ SoCï¼ˆå¦‚æ ‘è“æ´¾ã€æ‰‹æœº Cortex-Aï¼‰ä¸­ï¼Œé€šå¸¸æœ‰ L1/L2/L3 ä¸‰çº§ç¼“å­˜ã€‚ä½†åœ¨ä½ç«¯å•ç‰‡æœºï¼ˆå¦‚ STM32 Cortex-M3/M4ï¼‰ä¸­ï¼Œé€šå¸¸<strong>æ²¡æœ‰ Cache</strong> æˆ–è€…åªæœ‰ç®€å•çš„ <strong>æŒ‡ä»¤/æ•°æ®ç¼“å­˜</strong>ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œ<strong>RAM çš„çªå‘è¯»å–ï¼ˆBurst Readï¼‰</strong> ç‰¹æ€§ä¾ç„¶ä½¿å¾—é¡ºåºè®¿é—®ï¼ˆæ•°ç»„ï¼‰æ¯”éšæœºè®¿é—®ï¼ˆé“¾è¡¨ï¼‰å¿«å¾—å¤šã€‚</p>
<p>ç°ä»£ RAM çš„ Burst Read ç‰¹æ€§è®©é¡ºåºè¯»å†™ 64 å­—èŠ‚å’Œéšæœºè¯» 1 å­—èŠ‚çš„ç¡¬ä»¶æˆæœ¬å‡ ä¹ä¸€æ ·ã€‚ é…åˆ CPU ç¡¬ä»¶é¢„å–å™¨å’Œå¤šçº§ç¼“å­˜ï¼ŒçœŸæ­£è¿ç»­ã€64 å­—èŠ‚å¯¹é½çš„é¡ºåºè®¿é—®ï¼ˆRing Bufferï¼‰å¯ä»¥æ¯”éšæœºè·³è·ƒçš„é“¾è¡¨å¿« 10ï½50 å€ï¼Œè€Œä¸”è¿™ä¸æ˜¯è½¯ä»¶ä¼˜åŒ–ï¼Œæ˜¯ç‰©ç†åº•å±‚çš„ç¡¬åŠ é€Ÿï¼Œæ²¡å¾—é€‰ã€‚</p>
<p>æ‰€ä»¥ï¼š <strong>Ring Buffer å¿«ä¸æ˜¯å› ä¸ºä»£ç å†™å¾—å¥½ï¼Œè€Œæ˜¯å› ä¸ºå®ƒåƒåˆ°äº† CPU + Cache + DRAM ä¸‰è€…è”åˆçš„çº¢åˆ©</strong>ã€‚ é“¾è¡¨å†ä¼˜é›…ï¼Œä¹Ÿæ‰“ä¸è¿‡ç‰©ç†å®šå¾‹ã€‚</p>
<h3 data-id="heading-14">3.2 ç¯å½¢ç¼“å†²åŒºè®¾è®¡åŸç†</h3>
<p>ç¯å½¢ç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>å›ºå®šå¤§å°çš„æ•°ç»„</strong>ï¼Œé€šè¿‡ç»´æŠ¤ <code>head</code>ï¼ˆè¯»æŒ‡é’ˆï¼‰å’Œ <code>tail</code>ï¼ˆå†™æŒ‡é’ˆï¼‰ä¸¤ä¸ªç´¢å¼•ï¼Œå’Œ<strong>å–æ¨¡è¿ç®—</strong>æ¥å®ç°é¦–å°¾ç›¸æ¥çš„å¾ªç¯çš„æ•ˆæœã€‚</p>
<p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹å®ç°çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<ol start="0">
<li>
<p>åˆå§‹åŒ–ï¼šç”³è¯·ä¸€å—å¤§å†…å­˜ï¼ˆä¾‹å¦‚ 1MBï¼‰ï¼Œè¿™æ˜¾ç„¶ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡åŒ–ã€‚ç»™ <code>head</code> å’Œ <code>tail</code> èµ‹0 ã€‚</p>
</li>
<li>
<p>å†™å…¥ (Push)ï¼šæ•°æ®å­˜å…¥ <code>buffer[tail]</code>ï¼Œç„¶å <code>tail</code> å‘åç§»åŠ¨ã€‚</p>
<p>ç„¶å <code>tail = (tail + 1) % capacity</code></p>
</li>
<li>
<p>è¯»å– (Pop)ï¼šä» <code>buffer[head]</code> å–å‡ºæ•°æ®ï¼Œç„¶å <code>head</code> å‘åç§»åŠ¨ã€‚</p>
<p>ç„¶å <code>head = (head + 1) % capacity</code></p>
</li>
<li>
<p>åˆ¤æ–­æ˜¯å¦ç©ºæˆ–è€…æ»¡ï¼šé€šè¿‡ä¸€ä¸ª <code>count</code> è®¡æ•°å™¨ï¼Œæˆ–è€…é€šè¿‡ <code>head</code> å’Œ <code>tail</code> çš„ç›¸å¯¹ä½ç½®æ¥åˆ¤æ–­ã€‚</p>
</li>
</ol>
<p>åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œä¸ºäº†ç®€åŒ–å¤šçº¿ç¨‹ä¸‹çš„çŠ¶æ€åˆ¤æ–­ï¼Œæˆ‘å¼•å…¥äº†ä¸€ä¸ª<code>count</code>è®¡æ•°å™¨é…åˆäº’æ–¥é”æ¥ç²¾ç¡®æ§åˆ¶ã€‚</p>
<p>å°çŸ¥è¯†ï¼šåœ¨æåº¦è¿½æ±‚æ€§èƒ½çš„åœºæ™¯ä¸‹ï¼ˆå¦‚ Linux å†…æ ¸ kfifoï¼‰ï¼Œé€šå¸¸ä¼šå°†ç¼“å†²åŒºå¤§å°è®¾ç½®ä¸º <strong>2 çš„å¹‚æ¬¡æ–¹</strong>ï¼ˆå¦‚ 1024, 4096ï¼‰ã€‚è¿™æ ·å¯ä»¥ç”¨ <strong>ä½è¿ç®— (&amp;)</strong> ä»£æ›¿ <strong>å–æ¨¡è¿ç®— (%)</strong> ï¼š</p>
<p>å–æ¨¡ï¼š<code>tail = (tail + 1) % 1024</code></p>
<p>å¯¹åº”çš„ä½è¿ç®—ï¼š<code>tail = (tail + 1) &amp; (1024 - 1)</code></p>
<h3 data-id="heading-15">3.3 æ ¸å¿ƒæ•°æ®ç»“æ„å®šä¹‰</h3>
<p>ä¸ºäº†å®ç°é€šç”¨æ€§ä¸å°è£…æ€§ï¼Œæˆ‘å®šä¹‰äº†ä¸‹é¢ç»“æ„ä½“ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// å•æ¡æ—¥å¿—çš„æœ€å¤§é•¿åº¦</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_MSG_SIZE 128</span>
â€‹
<span class="hljs-comment">// æ—¥å¿—</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> {
 Â  Â <span class="hljs-type">char</span> data[LOG_MSG_SIZE];
} Log;
â€‹
<span class="hljs-comment">// ç¯å½¢ç¼“å†²åŒºç®¡ç†</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> {
 Â  Â Log *entries; Â  Â  Â  Â  <span class="hljs-comment">// æŒ‡å‘ malloc çš„å¤§æ•°ç»„</span>
 Â  Â 
 Â  Â <span class="hljs-type">int</span> capacity; Â  Â  Â  Â  <span class="hljs-comment">// ç¼“å†²åŒºæ€»å®¹é‡</span>
 Â  Â <span class="hljs-type">int</span> count; Â  Â  Â  Â  Â  Â <span class="hljs-comment">// å½“å‰å·²å­˜å‚¨çš„æ—¥å¿—æ•°é‡</span>
 Â  Â 
 Â  Â <span class="hljs-type">int</span> head; Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// è¯»ç´¢å¼• (Consumer ç”¨)</span>
 Â  Â <span class="hljs-type">int</span> tail; Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// å†™ç´¢å¼• (Producer ç”¨)</span>
 Â  Â 
 Â  Â <span class="hljs-comment">// ç”¨äºä¼˜é›…é€€å‡º</span>
 Â  Â <span class="hljs-type">int</span> is_running; Â  Â  Â  <span class="hljs-comment">// 1: æ­£å¸¸è¿è¡Œ Â  0: åœæ­¢</span>
â€‹
 Â  Â <span class="hljs-comment">// çº¿ç¨‹åŒæ­¥å·¥å…·</span>
 Â  Â <span class="hljs-type">pthread_mutex_t</span> mutex;
 Â  Â <span class="hljs-type">pthread_cond_t</span> cond_producer; <span class="hljs-comment">// è‹¥ç¼“å†²åŒºæ»¡  ç”Ÿäº§è€…ç¡è§‰</span>
 Â  Â <span class="hljs-type">pthread_cond_t</span> cond_consumer; <span class="hljs-comment">// è‹¥ç¼“å†²åŒºç©º  æ¶ˆè´¹è€…ç¡è§‰</span>
 Â  Â 
 Â  Â <span class="hljs-comment">//å­˜æ”¾æ—¥å¿—å†…å®¹çš„æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦</span>
 Â  Â <span class="hljs-type">int</span> file_fd;
} RingBuffer;
</code></pre>
<p>è¿™ç§è®¾è®¡å³ä¿è¯äº†<strong>å†…å­˜çš„è¿ç»­æ€§</strong>ï¼Œåˆé€šè¿‡äº’æ–¥é”å’Œæ¡ä»¶å˜é‡ä¿è¯äº†<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚åœ¨ç¨‹åºå¯åŠ¨æ—¶ <code>rb_init</code> ä¸€æ¬¡æ€§åˆ†é…å†…å­˜ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­å†æ— å†…å­˜ç”³è¯·æ“ä½œï¼Œæå…¶ç¨³å®šã€‚</p>
<p>è¿™é‡Œçš„æ–‡ä»¶æè¿°ç¬¦éœ€è¦å†æä¸€å˜´ï¼Œåˆå§‹åŒ–çš„æ—¶å€™æˆ‘ä¼šæŠŠå®ƒç½®ä¸º1ï¼Œä»£è¡¨<code>stdout</code>ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤çš„æ—¥å¿—è¾“å‡ºä½ç½®æ˜¯ç»ˆç«¯ã€‚åé¢å¦‚æœè¦æ‰“å¼€æ–‡ä»¶æ—¶é‚£å°±ç»™ä»–å†æ¬¡èµ‹å€¼ã€‚å¦‚æœåªæ˜¯ç”¨æ¥æµ‹è¯•ï¼ŒæŸ¥çœ‹ç»ˆç«¯å†…å®¹ï¼Œå› è€Œä¸è¿›è¡Œå¯¹æ–‡ä»¶æè¿°ç¬¦é‡æ–°èµ‹å€¼çš„æ“ä½œï¼Œé‚£å°±è¦åœ¨<code>close</code>ä¹‹å‰è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ–‡ä»¶æè¿°ç¬¦çš„å€¼ä¸º1ï¼Œå°±ä¸è¿›è¡Œ<code>close</code>æ“ä½œã€‚ä½†æ˜¯ä¸ºäº†ä¿é™©èµ·è§ï¼Œæˆ‘å»ºè®®ä¸è®ºä¼šä¸ä¼šå¯¹æ–‡ä»¶æè¿°ç¬¦é‡æ–°èµ‹å€¼ï¼Œåœ¨å…³é—­æ–‡ä»¶æè¿°ç¬¦ä¹‹å‰éƒ½æ£€æŸ¥ä¸€ä¸‹å®ƒçš„å€¼ã€‚</p>
<h2 data-id="heading-16">4. æ ¸å¿ƒä»£ç å®ç°</h2>
<p>ä¸ºäº†ä¿è¯ä»£ç çš„<strong>å¥å£®æ€§</strong>ä¸<strong>å¯ç»´æŠ¤æ€§</strong>ï¼Œæˆ‘å°†æ ¸å¿ƒé€»è¾‘å°è£…åœ¨ ring_buffer.c ä¸­ï¼Œå¯¹å¤–æä¾›ç®€æ´çš„ APIã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªæœ€å…³é”®çš„å®ç°ç»†èŠ‚ã€‚</p>
<h3 data-id="heading-17">4.1 åˆå§‹åŒ– â€”â€” ä¸€åˆ‡çš„èµ·ç‚¹</h3>
<p>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦ç”³è¯·å†…å­˜æ± ï¼Œå¹¶åˆå§‹åŒ–æ‰€æœ‰çš„åŒæ­¥å·¥å…·ï¼ˆé”ä¸æ¡ä»¶å˜é‡ï¼‰ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªè®¾è®¡ç»†èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„ï¼šæˆ‘ä»¬å°† <code>file_fd</code> é»˜è®¤åˆå§‹åŒ–ä¸º <code>STDOUT_FILENO</code> (1)ï¼Œè¿™æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹æ—¥å¿—ä¼šè¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">void rb_init(RingBuffer *rb, int capacity) {
 Â  Â //ä¸€æ¬¡æ€§ç”³è¯·å †å†…å­˜
 Â  Â rb-&gt;<span class="hljs-attr">entries</span> = (Log *)malloc(sizeof(Log) * capacity)<span class="hljs-comment">;</span>
 Â  Â if (rb-&gt;<span class="hljs-attr">entries</span> == NULL) {
 Â  Â  Â  Â perror("malloc failed")<span class="hljs-comment">;</span>
 Â  Â  Â  Â exit(1)<span class="hljs-comment">;</span>
 Â   }
â€‹
 Â  Â //åˆå§‹åŒ–çŠ¶æ€
 Â  Â rb-&gt;<span class="hljs-attr">capacity</span> = capacity<span class="hljs-comment">;</span>
 Â  Â rb-&gt;<span class="hljs-attr">head</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â rb-&gt;<span class="hljs-attr">tail</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â rb-&gt;<span class="hljs-attr">count</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â rb-&gt;<span class="hljs-attr">is_running</span> = <span class="hljs-number">1</span><span class="hljs-comment">; //æ ‡è®°ç³»ç»Ÿè¿è¡Œä¸­</span>
â€‹
 Â  Â //é»˜è®¤è¾“å‡ºåˆ°ç»ˆç«¯
 Â  Â rb-&gt;<span class="hljs-attr">file_fd</span> = STDOUT_FILE<span class="hljs-literal">NO</span><span class="hljs-comment">;</span>
â€‹
 Â  Â //åˆå§‹åŒ–äº’æ–¥é”å’Œæ¡ä»¶å˜é‡
 Â  Â pthread_mutex_init(&amp;(rb-&gt;mutex), NULL)<span class="hljs-comment">;</span>
 Â  Â pthread_cond_init(&amp;(rb-&gt;cond_producer), NULL)<span class="hljs-comment">;</span>
 Â  Â pthread_cond_init(&amp;(rb-&gt;cond_consumer), NULL)<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¿™ä¸ªåˆå§‹åŒ–å‡½æ•°çš„å†…å­˜åˆ†é…æ­£æ˜¯ç»“åˆäº†æˆ‘ä»¬å‰é¢ä¸€æ¬¡æ€§ç”³è¯·ä¸€å¤§å—è¿ç»­å†…å­˜çš„æ€è·¯ï¼Œåœ¨åŠ å¿«è®¿é—®é€Ÿåº¦çš„åŸºç¡€ä¸Šè¿˜ä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤äº†Flashã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹<code>is_running</code>æ˜¯ä¸º1çš„ï¼Œä»è¿™ä¸ªæˆå‘˜çš„åå­—å¾ˆå®¹æ˜“å°±èƒ½çœ‹å‡ºå®ƒä¸º1æ˜¯æ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚åé¢åœ¨<code>main</code>å‡½æ•°æˆåŠŸå›æ”¶å…¨éƒ¨ç”Ÿäº§è€…æ—¶å°†è¿™ä¸ªå€¼ç½®ä¸º0ï¼Œåœ¨æ¶ˆè´¹è€…ä¸­æ£€æµ‹è¿™ä¸ªå€¼ä¸º0åæ‰§è¡Œç›¸åº”çš„é€€å‡ºç¨‹åºï¼Œ<strong>é˜²æ­¢ç”Ÿäº§è€…å·²ç»å…¨éƒ¨é€€å‡ºäº†æ¶ˆè´¹è€…è¿˜åœ¨è‹¦è‹¦ç­‰å¾…</strong>æ—¥å¿—ä½œæ— ç”¨åŠŸè¿™ç§æƒ…å†µå‘ç”Ÿã€‚</p>
<p>æ—¥å¿—å†…å®¹çš„é»˜è®¤è¾“å‡ºä½ç½®å°±æ²¡å¿…è¦å†è®²äº†ï¼Œè¿™é‡Œåªæ˜¯ç”¨å®ä»£æ›¿äº†1ï¼Œç›´æ¥ç”¨1ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé™¤äº†<strong>å¯è¯»æ€§ä¸‹é™</strong>æ²¡æœ‰ä»€ä¹ˆåå¤„ã€‚</p>
<p>æœ€åå°±æ˜¯åˆå§‹åŒ–é”å’Œæ¡ä»¶å˜é‡äº†ï¼Œè¿™é‡Œæˆ‘è®¾è®¡äº†ä¸¤ä¸ªæ¡ä»¶å˜é‡ï¼Œä»åå­—æ¥çœ‹ä¸€ä¸ªæ˜¯å±äºç”Ÿäº§è€…çš„ï¼Œå¦ä¸€ä¸ªæ˜¯å±äºæ¶ˆè´¹è€…çš„ã€‚è‹¥ç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™æ¶ˆè´¹è€…ç¡è§‰ï¼Œç›´åˆ°ç”Ÿäº§è€…ç”Ÿäº§å‡ºæ—¥å¿—å†…å®¹ï¼Œä¼šç”¨ <code>cond_consumer</code> æ¥å«é†’æ¶ˆè´¹è€…ã€‚è‹¥ç¼“å†²åŒºå·²æ»¡ï¼Œåˆ™ç”Ÿäº§è€…ç¡è§‰ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹æ—¥å¿—å†…å®¹ä½¿å¾—ç¼“å†²åŒºç©ºé—´ç©ºå‡ºæ¥æ—¶ï¼Œä»–ä¼šä½¿ç”¨ <code>cond_producer</code> å«é†’ç”Ÿäº§è€…ã€‚è¿™åœ¨åé¢çš„å…·ä½“ä»£ç å®ç°ä¸­ä¼šç›´è§‚çš„çœ‹åˆ°ã€‚</p>
<h3 data-id="heading-18">4.2 ç”Ÿäº§è€… (<code>Push</code>)æ‹’ç»è™šå‡å”¤é†’</h3>
<p>è¿™æ˜¯<strong>é«˜å¹¶å‘å†™</strong>çš„æ ¸å¿ƒé€»è¾‘ã€‚ä¸ºäº†é˜²æ­¢â€œæƒŠç¾¤æ•ˆåº”â€å’Œâ€œè™šå‡å”¤é†’â€ï¼Œå¿…é¡»ä¸¥æ ¼éµå®ˆ POSIX å¤šçº¿ç¨‹ç¼–ç¨‹è§„èŒƒã€‚</p>
<pre><code class="hljs language-scss" lang="scss">void <span class="hljs-built_in">rb_push</span>(RingBuffer *rb, const Log *entry) {
 Â  Â <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;(rb-&gt;mutex));
â€‹
 Â  Â while (rb-&gt;count == rb-&gt;capacity) {
 Â  Â  Â  Â <span class="hljs-built_in">pthread_cond_wait</span>(&amp;(rb-&gt;cond_producer), &amp;(rb-&gt;mutex));
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ç›´æ¥ memcpy åˆ°æ•°ç»„å¯¹åº”ä½ç½®</span>
 Â  Â <span class="hljs-built_in">memcpy</span>(&amp;(rb-&gt;entries[rb-&gt;tail]), entry, <span class="hljs-built_in">sizeof</span>(Log));
â€‹
 Â  Â <span class="hljs-comment">// æ›´æ–°ç´¢å¼•</span>
 Â  Â rb-&gt;tail = (rb-&gt;tail + <span class="hljs-number">1</span>) % rb-&gt;capacity;
 Â  Â rb-&gt;count++;
 Â  Â 
 Â  Â <span class="hljs-comment">// å”¤é†’æ¶ˆè´¹è€…</span>
 Â  Â <span class="hljs-built_in">pthread_cond_signal</span>(&amp;(rb-&gt;cond_consumer));
 Â  Â <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;(rb-&gt;mutex));
}
</code></pre>
<p><code>Push</code>è¿™ä¸ªå•è¯å¾ˆå½¢è±¡ï¼Œæˆ‘ç›¸ä¿¡ä¸è§£é‡Šå¤§å®¶ä¹Ÿèƒ½çŸ¥é“è¿™é‡Œåœ¨å¹²ä»€ä¹ˆï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥æŠŠæ—¥å¿—å†…å®¹<code>Push</code>è¿›<code>RingBuffer</code>çš„ã€‚</p>
<p>è¿™é‡Œçš„åˆ¤æ–­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>while</code>å‘¢ï¼Œå¯èƒ½ä¼šæœ‰äº›å–œæ¬¢æ€è€ƒçš„æœ‹å‹è®¤çœŸçœ‹äº†ä¹‹åå‘ç°ï¼Œè¿™é‡Œåªæ˜¯åˆ¤æ–­ä¸€ä¸‹ç¼“å†²åŒºå†…çš„æ—¥å¿—æ•°é‡æ˜¯å¦ç­‰äºç¼“å†²åŒºæœ€å¤§å®¹é‡ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­ç¼“å†²åŒºæ»¡äº†æ²¡æœ‰ã€‚å¦‚æœæ»¡äº†é‚£å°±ç­‰å‘—ï¼Œæ²¡æ»¡é‚£å°±ç»§ç»­ç”Ÿäº§æ—¥å¿—å‘—ã€‚é‚£æŒ‰é“ç†æ¥è¯´ç”¨<code>if</code>æ¥åˆ¤æ–­ä¹Ÿè¡Œå•Šï¼Ÿå…¶å®æ˜¯ä¸è¡Œçš„ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ª<strong>è™šå‡å”¤é†’</strong>çš„æƒ…å†µã€‚</p>
<p><strong>è™šå‡å”¤é†’</strong>æ˜¯æŒ‡ï¼Œçº¿ç¨‹åœ¨è°ƒç”¨ <code>pthread_cond_wait()</code> å¼€å§‹ç¡è§‰ä¹‹åï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•äººè°ƒç”¨ <code>pthread_cond_signal()</code> æˆ–è€… <code>pthread_cond_broadcast()</code> ï¼Œçº¿ç¨‹ä¹Ÿæœ‰å¯èƒ½è«åå…¶å¦™çš„é†’æ¥ã€‚ä½†è¿™ä¸ªçœ‹ä¼¼å­˜åœ¨æ¼æ´çš„è¡Œä¸ºå…¶å®æ˜¯ POSIX æ ‡å‡†æ˜ç¡®å…è®¸çš„è¡Œä¸ºã€‚å¯¼è‡´è™šå‡å”¤é†’æ¯”è¾ƒå¸¸è§çš„åŸå› æœ‰ï¼šæ“ä½œç³»ç»Ÿè°ƒåº¦å™¨çš„å†…éƒ¨ä¼˜åŒ–ï¼Œå†…å­˜ä¼ªå…±äº«ï¼Œä¿¡å·ä¸­æ–­ç­‰ã€‚æ‰€ä»¥è¯´é†’æ¥å¹¶ä¸ä¸€å®šæ˜¯è¢« <code>signal</code> æˆ–è€… <code>broadcast</code> å”¤é†’çš„ï¼Œæ„æ€å°±æ˜¯æ¡ä»¶ä¸ä¸€å®šèƒ½æ»¡è¶³ã€‚</p>
<p>å¤§å®¶ç°åœ¨æ¥æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼Œå‡å¦‚çº¿ç¨‹<strong>ç”±äºè™šå‡å”¤é†’é†’æ¥</strong>äº†ï¼Œä½†å®é™…ä¸Šè¿™æ—¶ç¼“å†²åŒºè¿˜æ˜¯æ»¡çš„ï¼Œå®ƒåº”è¯¥ç¡è§‰ï¼Œä¸åº”è¯¥é†’ç€ã€‚å¦‚æœä½¿ç”¨äº† <code>if</code> æ¥åˆ¤æ–­ï¼Œå®ƒä¼šä»€ä¹ˆéƒ½ä¸ç®¡ï¼Œç›´æ¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå…ˆæŠŠ <code>entry</code> çš„å†…å®¹æ‹·è´åˆ° <code>RingBuffer</code> ï¼Œç„¶åæ›´æ–°ç´¢å¼•å’Œæ—¥å¿—æ¡æ•°ï¼Œç„¶åå°±å®Œè›‹äº†(â•¯Â°â–¡Â°)â•¯ï¸µ â”»â”â”»ã€‚å› ä¸º<strong>ç¼“å†²åŒºå·²ç»æº¢å‡º</strong>äº†ã€‚</p>
<p>ä½†æ˜¯å¦‚æœè¿™é‡Œä½¿ç”¨<code>while</code>è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨è§¦å‘è™šå‡å”¤é†’åï¼Œä»–ä¼š<strong>é‡æ–°æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦æ»¡äº†</strong>ï¼Œå¦‚æœæ²¡æ»¡å°±è·³å‡º <code>while</code> ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å¦‚æœæ»¡äº†é‚£å°±åœ¨æ‰§è¡Œ <code>pthread_cond_wait(&amp;(rb-&gt;cond_producer), &amp;(rb-&gt;mutex));</code> è¿›å…¥ç¡çœ ã€‚ä¸ä¼šå‘ç”Ÿåƒ<code>if</code>é‚£æ ·çš„å¯æ€•åœºæ™¯ã€‚</p>
<h3 data-id="heading-19">4.3 æ¶ˆè´¹è€… (<code>Pop</code>) ä¸ä¼˜é›…é€€å‡º</h3>
<p>æ¶ˆè´¹è€…ä¸ä»…è¦å¤„ç†æ•°æ®ï¼Œè¿˜è¦è´Ÿè´£ç›‘å¬<strong>åœæœºæŒ‡ä»¤</strong>ã€‚å¦‚æœåªæ˜¯ä¸€ä¸ª demo ï¼Œé‚£è®©æ¶ˆè´¹è€…ç›´æ¥æ— é™å¾ªç¯å°±å®Œäº‹äº†ï¼Œåé¢ç›´æ¥ Ctrl+C æš´åŠ›ç»ˆæ­¢ã€‚ä½†æ˜¯å¦‚æœæƒ³çœŸæ­£åº”ç”¨åˆ°å·¥ç¨‹ä¸Šï¼Œé‚£å°±è¦å®ç°<strong>ä¼˜é›…é€€å‡º</strong>ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å‡½æ•°è¿”å›å€¼ï¼š1 è¡¨ç¤ºæˆåŠŸæ‹¿åˆ°æ•°æ®ï¼Œ0 è¡¨ç¤ºç³»ç»Ÿå…³é—­ä¸”æ— æ•°æ®</span>
int <span class="hljs-built_in">rb_pop</span>(RingBuffer *rb, Log *entry) {
 Â  Â <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;(rb-&gt;mutex));
â€‹
 Â  Â <span class="hljs-comment">// åªæœ‰å½“ç¼“å†²åŒºä¸ºç©ºï¼Œä¸”ç³»ç»Ÿè¿˜åœ¨è¿è¡Œæ—¶ï¼Œæ‰é€‰æ‹©ç­‰å¾…</span>
 Â  Â while (rb-&gt;count == <span class="hljs-number">0</span> &amp;&amp; rb-&gt;is_running) {
 Â  Â  Â  Â <span class="hljs-built_in">pthread_cond_wait</span>(&amp;(rb-&gt;cond_consumer), &amp;(rb-&gt;mutex));
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// å¦‚æœé†’æ¥å‘ç°æ²¡æ•°æ®äº†ï¼Œè€Œä¸”ç³»ç»Ÿæ ‡å¿—ä½å·²å…³é—­ï¼Œé‚£å°±è§£é”åé€€å‡º</span>
 Â  Â if (rb-&gt;count == <span class="hljs-number">0</span> &amp;&amp; !rb-&gt;is_running) {
 Â  Â  Â  Â <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;(rb-&gt;mutex));
 Â  Â  Â  Â return <span class="hljs-number">0</span>; 
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// æ­£å¸¸æ¶ˆè´¹</span>
 Â  Â <span class="hljs-built_in">memcpy</span>(entry, &amp;(rb-&gt;entries[rb-&gt;head]), <span class="hljs-built_in">sizeof</span>(Log));
 Â  Â rb-&gt;head = (rb-&gt;head + <span class="hljs-number">1</span>) % rb-&gt;capacity;
 Â  Â rb-&gt;count--;
â€‹
 Â  Â <span class="hljs-comment">// å”¤é†’ç”Ÿäº§è€…</span>
 Â  Â <span class="hljs-built_in">pthread_cond_signal</span>(&amp;(rb-&gt;cond_producer));
 Â  Â <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;(rb-&gt;mutex));
 Â  Â return <span class="hljs-number">1</span>;
}
</code></pre>
<p>ä»£ç ä¸­å·²ç»æœ‰äº†æ¯”è¾ƒè¯¦ç»†çš„æ³¨é‡Šï¼Œä½†ä¸ºäº†å†…å®¹çš„å…¨é¢æ€§ï¼Œæˆ‘è¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ã€‚</p>
<p>å…ˆæ¥çœ‹ <code>while</code> å¾ªç¯ï¼Œåªæœ‰å½“ç¼“å†²åŒºä¸ºç©ºï¼Œè€Œä¸”ç³»ç»Ÿè¿˜åœ¨è¿è¡Œæ—¶ï¼Œæ‰ç­‰å¾…ã€‚</p>
<p>å¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œä½† <code>is_running</code> è¢«ç½®ä¸º0äº†ï¼Œé‚£å°±è·³å‡ºå¾ªç¯ï¼Œå¾€ä¸‹æ‰§è¡Œåˆ° <code>if</code> ï¼Œæ¡ä»¶æ»¡è¶³ï¼Œè§£é”åç›´æ¥è¿”å›0ï¼Œåé¢åœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ä¼šæ£€æŸ¥è¿™ä¸ªè¿”å›å€¼ï¼Œè¿™ä¸ªåˆ°åé¢å†è¯´å§ã€‚</p>
<p>å¦‚æœç¼“å†²åŒºä¸ä¸ºç©ºï¼Œä¸” <code>is_running</code> ä¸º1ï¼Œæ­£å¸¸è¿è¡Œï¼Œé‚£å°±æ˜¯æ­£å¸¸æ¶ˆè´¹åå”¤é†’ç”Ÿäº§è€…ï¼Œå‡½æ•°è¿”å›1ã€‚</p>
<p>å¦‚æœç¼“å†²åŒºä¸ä¸ºç©ºï¼Œä¸” <code>is_running</code> ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿäº§è€…å·²ç»å…¨éƒ¨é€€å‡ºäº†ï¼Œä½†ç¼“å†²åŒºè¿˜æœ‰äº›æ—¥å¿—å†…å®¹æ²¡æœ‰è¢«æ¶ˆè´¹ã€‚é‚£æˆ‘ä»¬çš„é€»è¾‘å°±æ˜¯<strong>æ¶ˆè´¹å®Œè¿™äº›æ—¥å¿—å†é€€å‡º</strong>ã€‚æ¥çœ‹ä»£ç ï¼Œè¿™ç§æƒ…å†µä¾ç„¶ä¼šè·³å‡º <code>while</code> å¾ªç¯ï¼Œåœ¨ <code>if</code> åˆ¤æ–­æ˜¯ï¼Œæ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨ <code>if</code> é‡Œé¢é€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ­£å¸¸æ¶ˆè´¹æ—¥å¿—ï¼Œå®Œäº†è¿”å›1ï¼Œåˆ°åé¢å¤§å®¶ä¼šçŸ¥é“ï¼Œ<strong>æ¶ˆè´¹è€…çº¿ç¨‹æ˜¯åœ¨å¾ªç¯è°ƒç”¨</strong>è¿™ä¸ªå‡½æ•°çš„ï¼Œæ‰€ä»¥ä¼šä¸€ç›´é‡å¤ä¸Šé¢æè¿°çš„è¿‡ç¨‹ï¼Œç›´åˆ°æ—¥å¿—å…¨éƒ¨è¢«æ¶ˆè´¹å®Œï¼Œç¼“å†²åŒºç©ºäº†ï¼Œè¿™æ—¶æ»¡è¶³ <code>if</code> çš„æ¡ä»¶äº†ï¼Œè¿”å›0ã€‚æ¶ˆè´¹è€…çº¿ç¨‹æ£€æµ‹åˆ°0åä¼˜é›…é€€å‡ºã€‚</p>
<p>è¿™é‡Œæˆ‘è¿˜æƒ³æä¸€ç‚¹ï¼Œæˆ‘åœ¨ 4.2 å’Œ æœ¬èŠ‚4.3 é‡Œéƒ½ç”¨äº† <code>memcpy</code>ã€‚åœ¨è¿™é‡Œä½¿ç”¨ <code>memcpy</code> æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ <code>log_push</code> é‡Œå·²ç»ç”¨ <code>snprintf</code> ä¿è¯äº†æºæ•°æ®é•¿åº¦ä¸ä¼šè¶…è¿‡ <code>LOG_MSG_SIZE</code>ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿè¶Šç•Œæ‹·è´ã€‚</p>
<p>ä¼˜é›…é€€å‡ºçš„ä»£ç æ²¡ä»€ä¹ˆæ·±åº¦ï¼Œæˆ‘å°±ä¸è§£é‡Šäº†ï¼Œç›´æ¥æ”¾åœ¨ä¸‹é¢ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//ä¼˜é›…é€€å‡º</span>
void <span class="hljs-built_in">rb_stop</span>(RingBuffer *rb)
{
    <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;(rb-&gt;mutex));
â€‹
    rb-&gt;is_running = false;
â€‹
    <span class="hljs-built_in">pthread_cond_broadcast</span>(&amp;(rb-&gt;cond_consumer));<span class="hljs-comment">//å”¤é†’æ¶ˆè´¹è€…</span>
â€‹
    <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;(rb-&gt;mutex));
}
</code></pre>
<h3 data-id="heading-20">4.4 å®‰å…¨æ€§å°è£…æ‹’ç»ç¼“å†²åŒºæº¢å‡º</h3>
<p>åœ¨ C è¯­è¨€ä¸­ï¼Œ<code>strncpy</code> å’Œ <code>sprintf</code> éƒ½æ˜¯ç¼“å†²åŒºæº¢å‡ºçš„é‡ç¾åŒºã€‚ä¸ºäº†ä¿è¯æ—¥å¿—å†…å®¹çš„å®‰å…¨ï¼Œæˆ‘åœ¨ä¸šåŠ¡å°è£…å±‚ä½¿ç”¨äº† <code>snprintf</code>ã€‚</p>
<p><code>snprintf</code> æ˜¯ C è¯­è¨€ä¸­æœ€é‡è¦ï¼Œæœ€å®‰å…¨çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•°ä¹‹ä¸€ï¼Œå®ƒå‡ ä¹å®Œå…¨å–ä»£äº†è€çš„ <code>sprintf</code>ï¼Œä¹Ÿæ˜¯ç°ä»£ C ä»£ç ä¸­<strong>å”¯ä¸€æ¨èä½¿ç”¨çš„æ ¼å¼åŒ–è¾“å‡ºåˆ°å­—ç¬¦ä¸²çš„å‡½æ•°</strong>ã€‚</p>
<p>MISRA C 2012ï¼ˆæ±½è½¦åµŒå…¥å¼è§„èŒƒï¼‰ï¼š<strong>ç¦æ­¢</strong>ä½¿ç”¨åº“å‡½æ•°<code>sprintf</code>ï¼Œ<code>vsprintf</code> ï¼Œå¿…é¡»ä½¿ç”¨å¸¦é•¿åº¦é™åˆ¶çš„æ›¿ä»£å‡½æ•°ï¼Œå¦‚<code>snprintf</code>ã€<code>vsnprintf</code>ã€‚</p>
<p>Linux å†…æ ¸ã€GNUã€LLVMã€Chromeã€Firefox ç­‰å¤§å‹é¡¹ç›®ï¼šå…¨éƒ¨<strong>ç¦æ­¢</strong> <code>sprintf</code>ï¼Œå¼ºåˆ¶ <code>snprintf</code>ã€‚</p>
<p>é™¤äº†ä¸€äº›å¤§å‹é¡¹ç›®å¯èƒ½è¿˜å­˜åœ¨å†å²é—ç•™çš„<code>sprintf()</code>è°ƒç”¨é—®é¢˜ã€‚åœ¨ç°åœ¨çš„æ–°é¡¹ç›®ä¸­ï¼Œç»å¯¹åº”è¯¥ä½¿ç”¨<code>snprintf</code>è€Œä¸æ˜¯<code>sprintf</code> ï¼Œè¿™æ˜¯å·¥ä¸šç•Œçš„å…±è¯†ï¼Œä¸æ˜¯å¯æœ‰å¯æ— çš„é£æ ¼é—®é¢˜ï¼Œè€Œæ˜¯å®‰å…¨é—®é¢˜ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">log_push</span><span class="hljs-params">(RingBuffer *rb, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg)</span> </span>{
 Â  Â Log log_entry = {<span class="hljs-number">0</span>};
 Â  Â 
 Â  Â <span class="hljs-comment">// å¯ä»¥è‡ªåŠ¨å¤„ç† \0 ç»“å°¾ï¼Œé˜²æ­¢ msg è¿‡é•¿å¯¼è‡´çš„è¶Šç•Œè®¿é—®</span>
 Â  Â <span class="hljs-built_in">snprintf</span>(log_entry.data, LOG_MSG_SIZE, <span class="hljs-string">"%s"</span>, msg);
 Â  Â  Â  Â 
 Â  Â <span class="hljs-built_in">rb_push</span>(rb, &amp;log_entry);
}
</code></pre>
<h2 data-id="heading-21">5. æ€§èƒ½å‹æµ‹ä¸æ€»ç»“</h2>
<p>ä¸ºäº†éªŒè¯è¿™ä¸ªå¼‚æ­¥æ—¥å¿—åº“çš„å¥å£®æ€§ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ª<strong>é«˜å¹¶å‘ + æå°ç¼“å†²åŒº</strong>çš„æµ‹è¯•åœºæ™¯ã€‚</p>
<h3 data-id="heading-22">5.1 å‹æµ‹åœºæ™¯è®¾è®¡</h3>
<p>ä¸ºäº†æ¨¡æ‹Ÿæœ€æ¶åŠ£çš„ç«äº‰ç¯å¢ƒï¼Œæˆ‘ç‰¹æ„å°†ç¼“å†²åŒºå®¹é‡è®¾ç½®å¾—æå°ï¼Œå¼ºè¿«çº¿ç¨‹<strong>é¢‘ç¹å‘ç”Ÿé˜»å¡å’Œå”¤é†’</strong>ã€‚</p>
<p>ç”Ÿäº§è€…ï¼š2ä¸ªçº¿ç¨‹ï¼ˆProducer1ï¼ŒProducer2ï¼‰ï¼Œæ¯ä¸ªç‹‚å‘1000æ¡æ—¥å¿—ã€‚</p>
<p>æ¶ˆè´¹è€…ï¼š1ä¸ªåå°çº¿ç¨‹ã€‚</p>
<p>ç¼“å†²åŒºå®¹é‡ï¼šè®¾ä¸º10ï¼Œè¿™æ„å‘³ç€ç”Ÿäº§è€…æ¯ç”Ÿäº§å‡ æ¡æ—¥å¿—å°±è¦è¢«è¿«ç¡è§‰ï¼Œé”ç«äº‰å°†ä¼šéå¸¸æ¿€çƒˆã€‚</p>
<p>é¢„æœŸç»“æœï¼šæ—¥å¿—æ–‡ä»¶åº”è¯¥åŒ…å«æ•´æ•´2000æ¡æ•°æ®ï¼Œæ— ä¸¢å¤±ï¼Œæ— ä¹±åºï¼ˆçº¿ç¨‹å†…éƒ¨æœ‰åºï¼‰ï¼Œå¹¶ä¸”ç¨‹åºå¯ä»¥ä¼˜é›…é€€å‡ºã€‚</p>
<p>è¿™æ˜¯ main.c çš„å†…å®¹ï¼Œå¤§å®¶å¯ä»¥ç…§ç€æˆ‘ä¸Šé¢çš„è§£é‡Šæ¢³ç†ä¸€ä¸‹é€»è¾‘:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ring_buffer.h"</span></span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">define</span> FILE_NAME <span class="hljs-string">"log.txt"</span></span>
â€‹
<span class="hljs-type">void</span> <span class="hljs-title function_">log_push</span><span class="hljs-params">(RingBuffer *rb,<span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg)</span>
{
    Log log_entry = {<span class="hljs-number">0</span>};
â€‹
    <span class="hljs-built_in">snprintf</span>(log_entry.data,LOG_MSG_SIZE,<span class="hljs-string">"%s"</span>,msg);<span class="hljs-comment">//æœ€æ¨èçš„å‡½æ•°</span>
        
    rb_push(rb,&amp;log_entry);
}
â€‹
<span class="hljs-type">void</span> *<span class="hljs-title function_">pthread_producer1</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>
{
    RingBuffer *rb = (RingBuffer *)arg;
â€‹
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">1000</span>;i++)
    {
        <span class="hljs-type">char</span> buf[<span class="hljs-number">64</span>];
â€‹
        <span class="hljs-built_in">snprintf</span>(buf, <span class="hljs-keyword">sizeof</span>(buf), <span class="hljs-string">"Producer1 code:%d\n"</span>, i);
â€‹
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Producer1 pushing:%s\n"</span>,buf);
â€‹
        log_push(rb,buf);
â€‹
        usleep(<span class="hljs-number">100</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
â€‹
<span class="hljs-type">void</span> *<span class="hljs-title function_">pthread_producer2</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>
{
    RingBuffer *rb = (RingBuffer *)arg;
â€‹
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">1000</span>;i++)
    {
        <span class="hljs-type">char</span> buf[<span class="hljs-number">64</span>];
â€‹
        <span class="hljs-built_in">snprintf</span>(buf, <span class="hljs-keyword">sizeof</span>(buf), <span class="hljs-string">"Producer2 code:%d\n"</span>, i);
â€‹
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Producer2 pushing:%s\n"</span>,buf);
â€‹
        log_push(rb,buf);
â€‹
        usleep(<span class="hljs-number">100</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
â€‹
<span class="hljs-type">void</span> *<span class="hljs-title function_">pthread_consumer</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>
{
    RingBuffer *rb = (RingBuffer *)arg;
    Log entry;
    <span class="hljs-keyword">while</span>(rb_pop(rb,&amp;entry))<span class="hljs-comment">//å¾ªç¯æ£€æµ‹è¿”å›å€¼ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¦é€€å‡º</span>
    {
        write(rb-&gt;file_fd,entry.data,<span class="hljs-built_in">strlen</span>(entry.data));
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ¶ˆè´¹è€…çº¿ç¨‹ï¼šä¼˜é›…é€€å‡º\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
    RingBuffer rb;
â€‹
    rb_init(&amp;rb,<span class="hljs-number">10</span>);
â€‹
    rb.file_fd = open(FILE_NAME,O_RDWR|O_CREAT|O_APPEND,<span class="hljs-number">0644</span>);
    <span class="hljs-keyword">if</span>(rb.file_fd == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"æ–‡ä»¶æ‰“å¼€å¤±è´¥"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
â€‹
    <span class="hljs-type">pthread_t</span> consumer,producer1,producer2;
    pthread_create(&amp;consumer,<span class="hljs-literal">NULL</span>,pthread_consumer,(<span class="hljs-type">void</span> *)&amp;rb);
    pthread_create(&amp;producer1,<span class="hljs-literal">NULL</span>,pthread_producer1,(<span class="hljs-type">void</span> *)&amp;rb);
    pthread_create(&amp;producer2,<span class="hljs-literal">NULL</span>,pthread_producer2,(<span class="hljs-type">void</span> *)&amp;rb);
â€‹
    pthread_join(producer1,<span class="hljs-literal">NULL</span>);
    pthread_join(producer2,<span class="hljs-literal">NULL</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ‰€æœ‰ç”Ÿäº§è€…å·²ç»ç»“æŸä»»åŠ¡\n"</span>);
â€‹
    rb_stop(&amp;rb);
    pthread_join(consumer,<span class="hljs-literal">NULL</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ¶ˆè´¹è€…å·²ç»é€€å‡º\n"</span>);
â€‹
    close(rb.file_fd);
    rb_destroy(&amp;rb);
 Â  Â 
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>ç”±äºç¯‡å¹…å·²ç»æ¯”è¾ƒé•¿äº†ï¼Œä¸‹é¢æˆ‘ç›´æ¥è´´å‡º Makefile ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile">CC = gcc
CFLAGS = -Wall -g -pthread
â€‹
TARGET = app
SRCS = main.c ring_buffer.c
OBJS = $(SRCS:.c=.o)
â€‹
<span class="hljs-section">all: <span class="hljs-variable">$(TARGET)</span></span>
â€‹
<span class="hljs-variable">$(TARGET)</span>: <span class="hljs-variable">$(OBJS)</span>
    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(CFLAGS)</span> -o <span class="hljs-variable">$(TARGET)</span> <span class="hljs-variable">$(OBJS)</span>
â€‹
<span class="hljs-section">%.o: %.c ring_buffer.h</span>
    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(CFLAGS)</span> -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span>
â€‹
â€‹
<span class="hljs-meta"><span class="hljs-keyword">.PHONY</span>: clean test</span>
â€‹
<span class="hljs-section">clean:</span>
    rm -f <span class="hljs-variable">$(OBJS)</span> <span class="hljs-variable">$(TARGET)</span> log.txt
â€‹
<span class="hljs-section">test: <span class="hljs-variable">$(TARGET)</span></span>
    ./<span class="hljs-variable">$(TARGET)</span>
â€‹
</code></pre>
<p>ç®€å•ä»‹ç»ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨ï¼Œé¦–å…ˆå‘½ä»¤è¡Œè¾“å…¥makeè¿›è¡Œç¼–è¯‘ï¼Œç„¶åè¾“å…¥./appè¿è¡Œç¨‹åºã€‚æˆ–è€…å«Œéº»çƒ¦çš„å¯ä»¥ç›´æ¥å‘½ä»¤è¡Œè¾“å…¥make testï¼Œè¿™ä¼šç›´æ¥ç¼–è¯‘å¹¶ä¸”è¿è¡Œç¨‹åºã€‚è¿è¡Œå®Œæˆåå¯ä»¥ä½¿ç”¨make cleanæ¸…é™¤ç¨‹åºè¿è¡Œäº§ç”Ÿçš„æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-23">5.2 æµ‹è¯•ç»“æœéªŒè¯</h3>
<p>è¿è¡Œä¹‹åç»ˆç«¯è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ea5248382774f89b4c9d3136e06afdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=9XAYDK424GhAtbqI%2FYGTslXB4jI%3D" alt="ç»ˆç«¯è¿è¡Œç»“æœ1.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82c875e35c244b999d2d65d1c4254a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=OolOP7ml7YuWIaMwN7he370%2BRQc%3D" alt="ç»ˆç«¯è¿è¡Œç»“æœ2.png" loading="lazy"/></p>
<p>ç”±äºæˆ‘åœ¨ä¸¤ä¸ªç”Ÿäº§è€…ä¸­éƒ½æ·»åŠ äº†<code>printf</code>å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ç»ˆç«¯ä¼šçœ‹åˆ°ä»–ä»¬æ‰“å°å‡ºæ¥çš„å†…å®¹ï¼Œæ€»å…±2000æ¡ï¼Œæˆ‘åªæˆªå›¾äº†æœ€å‰é¢å’Œæœ€åé¢çš„éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»<strong>å®ç°äº†ä¼˜é›…é€€å‡º</strong>ï¼ˆç”Ÿäº§è€…å…¨éƒ¨é€€å‡ºåï¼Œæ¶ˆè´¹è€…è‡ªåŠ¨é€€å‡ºï¼‰ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å†æ¥æŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—å†…å®¹æ˜¯å¦å­˜æ”¾åˆ°äº† log.txt é‡Œé¢ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c80bd751d6914d57a3084604c2530846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=od0ZKrt2fMOBKJvPbGvjx%2B2Yib4%3D" alt="log.txtå‰é¢.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49f10a6da1484d768bbe7a38c4724968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=dFx8gDe5MYtcgsLj5MyNsU6U01k%3D" alt="log.txtåé¢.png" loading="lazy"/></p>
<p>æˆ‘ä»¬åŒæ ·åªæˆªå»æœ€å‰é¢å’Œæœ€åé¢çš„éƒ¨åˆ†ï¼Œä¸¤ä¸ªç”Ÿäº§è€…çº¿ç¨‹äº§ç”Ÿçš„æ—¥å¿—å†…å®¹éƒ½æ˜¯ä»0-999ï¼Œä¹Ÿå°±æ˜¯å„1000ä¸ªï¼Œæ€»å…±2000ä¸ªã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e8d32684484e5fa04a1415e3db3f76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=mgni668%2Bbdx2YAFJU6yBGRQBp2s%3D" alt="æ—¥å¿—è¡Œæ•°.png" loading="lazy"/></p>
<p>å†æ¥æŸ¥çœ‹ log.txt æ–‡ä»¶çš„è¡Œæ•°ï¼Œå‘ç°ä¹Ÿæ˜¯2000è¡Œã€‚è¿™è¶³ä»¥è¯´æ˜<strong>ä¸€æ¡æ—¥å¿—éƒ½æ²¡æœ‰ä¸¢å¤±</strong>ã€‚</p>
<p>ç»“æœåˆ†æï¼šåœ¨å®¹é‡ä»…ä¸º 10 çš„æƒ…å†µä¸‹ï¼Œ2000 æ¡æ—¥å¿—å…¨éƒ¨è½ç›˜ï¼Œè¯æ˜<strong>æ¡ä»¶å˜é‡çš„ <code>wait</code> &amp; <code>signal</code> é€»è¾‘</strong>å¾ˆä¸¥å¯†ã€‚ä¸»çº¿ç¨‹æˆåŠŸç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹ç»“æŸï¼Œè¯æ˜<strong>ä¼˜é›…é€€å‡º</strong>æœºåˆ¶ç”Ÿæ•ˆï¼Œæ²¡æœ‰çº¿ç¨‹å¡åœ¨ <code>wait</code> çŠ¶æ€ã€‚ä»ç»ˆç«¯è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªç”Ÿäº§è€…<strong>äº¤æ›¿æŠ¢å </strong>æ—¶é—´ç‰‡ï¼Œè¯æ˜<strong>äº’æ–¥é”</strong>æœ‰æ•ˆä¿æŠ¤äº†ä¸´ç•ŒåŒºã€‚</p>
<h3 data-id="heading-24">5.3 é¡¹ç›®æ€»ç»“ä¸æ€è€ƒ</h3>
<p>ä»æœ€å¼€å§‹ç®€å•çš„æ¯äº§ç”Ÿä¸€æ¡æ—¥å¿—å°±ç”¨ <code>write</code> ç›´æ¥å†™ç›˜ï¼Œåˆ°æœ€ç»ˆå®Œæˆè¿™ä¸ª<strong>å¼‚æ­¥æ—¥å¿—åº“</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ä»…ä»…æ˜¯ä»£ç é‡çš„å¢åŠ ï¼Œæ›´æ˜¯<strong>å·¥ç¨‹æ€ç»´</strong>çš„æå‡ã€‚ä¸‹é¢æ˜¯æˆ‘åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­çš„ä¸€äº›æ€è€ƒï¼š</p>
<h4 data-id="heading-25">5.3.1 å‘ç¡¬ä»¶ç‰©ç†ç‰¹æ€§å¦¥å</h4>
<p>æœ‰äººå¯èƒ½æ›´å…³æ³¨ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†åœ¨åµŒå…¥å¼åº•å±‚å¼€å‘ä¸­ï¼Œ<strong>ç¡¬ä»¶ç‰¹æ€§</strong>æ‰æ˜¯æ€§èƒ½çš„å¤©èŠ±æ¿ã€‚</p>
<p>æ”¾å¼ƒé“¾è¡¨é€‰æ‹© <strong>Ring Buffer</strong>ï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œæ›´æ˜¯ä¸ºäº†<strong>ç¡®å®šæ€§</strong>ã€‚åœ¨é•¿æœŸè¿è¡Œçš„åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œé¿å…é¢‘ç¹ <code>malloc/free</code> é€ æˆçš„å †å†…å­˜ç¢ç‰‡æ˜¯ç³»ç»Ÿç¨³å®šçš„åŸºçŸ³ã€‚</p>
<p>åˆ©ç”¨æ•°ç»„çš„<strong>ç©ºé—´å±€éƒ¨æ€§</strong>ï¼Œå¤§å¹…å‡å°‘ <strong>Cache Miss</strong>ï¼Œè®© CPU æµæ°´çº¿è·‘å¾—æ›´é¡ºç•…ã€‚</p>
<h4 data-id="heading-26">5.3.2 è§£è€¦ä¸å‰Šå³°å¡«è°·</h4>
<p>åˆ©ç”¨ <strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong> ï¼Œå°†ä¸šåŠ¡é€»è¾‘ï¼ˆå¿«ï¼‰ä¸ç£ç›˜ I/Oï¼ˆæ…¢ï¼‰å½»åº•åˆ†ç¦»ã€‚</p>
<p><code>Ring Buffer</code> åœ¨è¿™é‡Œæ‰®æ¼”äº†â€œè“„æ°´æ± â€çš„è§’è‰²ã€‚é¢å¯¹çªå‘æµé‡ï¼Œç¼“å†²åŒºèƒ½èµ·åˆ°<strong>å‰Šå³°å¡«è°·</strong>çš„ä½œç”¨ï¼Œé˜²æ­¢ç¬é—´çš„é«˜é¢‘ I/O è¯·æ±‚å°†ç³»ç»Ÿæ‹–å®ã€‚</p>
<p>è™½ç„¶ä½¿ç”¨äº†äº’æ–¥é”ï¼Œä½†é…åˆ<strong>æ¡ä»¶å˜é‡</strong> é¿å…äº†å¿™ç­‰å¾…ï¼Œåœ¨ä¿è¯æ•°æ®å®‰å…¨çš„åŒæ—¶ï¼Œæœ€å¤§ç¨‹åº¦é™ä½äº† CPU å ç”¨ç‡ã€‚</p>
<h4 data-id="heading-27">5.3.3 é˜²å¾¡æ€§ç¼–ç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ</h4>
<p>å…¨é¢ç¦ç”¨ <code>strcpy/sprintf</code>ï¼Œä¸¥æ ¼ä½¿ç”¨ <code>snprintf</code> é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºã€‚</p>
<p>å®ç°äº†<strong>ä¼˜é›…é€€å‡º</strong> æœºåˆ¶ã€‚é€šè¿‡ <code>is_running</code> æ ‡å¿—ä½å’Œå¹¿æ’­å”¤é†’ï¼Œç¡®ä¿ç¨‹åºé€€å‡ºæ—¶ï¼Œç¼“å†²åŒºå†…æ®‹ç•™çš„æ—¥å¿—èƒ½è¢«<strong>å…¨éƒ¨æ¶ˆè´¹</strong>ï¼Œåšåˆ°æ•°æ®é›¶ä¸¢å¤±ã€‚</p>
<p>é€šè¿‡ç»“æ„ä½“å°è£…æ–‡ä»¶æè¿°ç¬¦ä¸äº’æ–¥é”å’Œæ¡ä»¶å˜é‡ï¼Œå®ç°äº†é«˜å†…èšä½è€¦åˆï¼Œæ‹’ç»å…¨å±€å˜é‡çš„æ±¡æŸ“ã€‚</p>
<h3 data-id="heading-28">5.4 è¿›é˜¶ä¼˜åŒ–æ–¹å‘</h3>
<p>è™½ç„¶ç›®å‰çš„ç‰ˆæœ¬å·²ç»æ˜¯ä¸€ä¸ª<strong>ç¨³å®šã€é«˜æ•ˆ</strong>çš„å¼‚æ­¥æ—¥å¿—åº“ï¼Œä½†åœ¨é¢å¯¹æ›´è‹›åˆ»çš„å·¥ä¸šçº§åœºæ™¯ï¼ˆå¦‚è½¦è§„çº§åµŒå…¥å¼ã€é«˜é¢‘äº¤æ˜“ç³»ç»Ÿï¼‰æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼š</p>
<h4 data-id="heading-29">5.4.1 æ‰¹é‡å†™å…¥ä¸é¡µç¼“å­˜å¯¹é½</h4>
<p>å‰é¢å·²ç»æåˆ°æ‰¹é‡å†™å…¥çš„å†…å®¹ï¼Œå¦‚æœé‡‡ç”¨æ‰¹é‡å†™å…¥ï¼Œè¿˜èƒ½åœ¨æœ¬é¡¹ç›®çš„åŸºç¡€ä¸ŠæŠŠ<strong>æ€§èƒ½è¿›ä¸€æ­¥å‹æ¦¨</strong>ã€‚è€Œç›®å‰çš„å®ç°æ˜¯æ¶ˆè´¹è€…æ¯æ¬¡ <code>Pop</code> ä¸€æ¡æ—¥å¿—å°±è°ƒç”¨ä¸€æ¬¡ <code>write</code> ã€‚</p>
<p>è€Œ <code>write</code> æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œæ¶‰åŠ<strong>ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼Œå­˜åœ¨ç€å·¨å¤§çš„å¼€é”€ã€‚</p>
<p>ä¼˜åŒ–æ€è·¯ï¼šåœ¨æ¶ˆè´¹è€…çº¿ç¨‹å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong>4KBï¼ˆä¸€é¡µå†…å­˜ï¼‰</strong> çš„ä¸­é—´ç¼“å†²åŒºã€‚å½“ç§¯æ”’çš„æ•°æ®è¾¾åˆ° 4KB æˆ–è€…è¶…æ—¶ï¼ˆå¯ä»¥è‡ªå·±è®¾å®šä¸€ä¸ªæ—¶é—´ï¼‰æ—¶ï¼Œå†ä¸€æ¬¡æ€§è°ƒç”¨ <code>write</code> è½ç›˜ã€‚è¿™èƒ½å°†ç³»ç»Ÿè°ƒç”¨çš„é¢‘ç‡é™ä½ä¸€ä¸ªæ•°é‡çº§ï¼Œå¹¶æ›´å¥½åœ°åˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„ <strong>Page Cache</strong>ã€‚</p>
<h4 data-id="heading-30">5.4.2 å­˜å‚¨ç®¡ç†</h4>
<p>åµŒå…¥å¼è®¾å¤‡çš„å­˜å‚¨ç©ºé—´ï¼ˆFlash/SDå¡ï¼‰æ˜¯æœ‰é™çš„ï¼Œæˆ‘ä»¬ä¸èƒ½è®© log.txt æ— é™å¢é•¿ã€‚</p>
<p>ä¼˜åŒ–æ€è·¯ï¼šå½“ log.txt è¾¾åˆ° 10MB æ—¶ï¼Œè‡ªåŠ¨å°†å…¶é‡å‘½åä¸º log.txt.1ï¼Œå¹¶åˆ›å»ºæ–°çš„ log.txtã€‚å¯ä»¥ä¿ç•™æœ€è¿‘ N ä¸ªå¤‡ä»½ï¼Œè‡ªåŠ¨åˆ é™¤æœ€æ—§çš„æ—¥å¿—ï¼Œé˜²æ­¢ç£ç›˜å†™æ»¡å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</p>
<h4 data-id="heading-31">5.4.3 æ— é”é˜Ÿåˆ—</h4>
<p>ç›®å‰çš„å®ç°ä½¿ç”¨äº† <code>Mutex</code> + <code>Cond</code>ã€‚åœ¨æé«˜å¹¶å‘ï¼ˆå‡ åä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥ï¼‰ä¸‹ï¼Œé”ç«äº‰ä¼šå¯¼è‡´ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¢å¤§ã€‚</p>
<p>ä¼˜åŒ–æ€è·¯ï¼šå‚è€ƒ Linux å†…æ ¸ <strong>kfifo</strong> çš„å®ç°ï¼Œåˆ©ç”¨ <strong>åŸå­æ“ä½œ</strong> å’Œ <strong>å†…å­˜å±éšœ</strong> æ¥ç®¡ç† head å’Œ tail æŒ‡é’ˆã€‚æœ€ç»ˆç›®æ ‡æ˜¯å®ç°<strong>å•ç”Ÿäº§è€…-å•æ¶ˆè´¹è€…</strong>æ¨¡å¼ä¸‹çš„å®Œå…¨æ— é”ï¼Œæˆ–<strong>å¤šç”Ÿäº§è€…</strong>æ¨¡å¼ä¸‹çš„æ— é”å…¥é˜Ÿï¼Œå°†æ€§èƒ½å‹æ¦¨åˆ°ç‰©ç†æé™ã€‚</p>
<h4 data-id="heading-32">5.4.4 é›¶æ‹·è´</h4>
<p>å½“å‰çš„ <code>log_push</code> æ¶‰åŠä¸¤æ¬¡æ‹·è´ï¼ˆ<code>snprintf</code> åˆ°æ ˆï¼Œ<code>memcpy</code> åˆ° <code>RingBuffer</code>ï¼‰ã€‚</p>
<p>ä¼˜åŒ–æ€è·¯ï¼šè®¾è®¡å‡½æ•°æ¥å£å…è®¸ä¸šåŠ¡çº¿ç¨‹ç›´æ¥åœ¨ RingBuffer çš„å†…å­˜åŒºåŸŸå†…è¿›è¡Œæ ¼å¼åŒ–å†™å…¥ï¼ˆé€šè¿‡è¿”å›å†™æŒ‡é’ˆï¼‰ï¼Œçœå»ä¸­é—´çš„æ ˆå†…å­˜æ‹·è´è¿‡ç¨‹ï¼Œè¿›ä¸€æ­¥é™ä½å†…å­˜å¸¦å®½å ç”¨ã€‚</p>
<h2 data-id="heading-33">6. é¡¹ç›®æºç </h2>
<p><em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxlp666hub%2FAsyncLog-RingBuffer" target="_blank" title="https://github.com/xlp666hub/AsyncLog-RingBuffer" ref="nofollow noopener noreferrer">ğŸ‘‰ <strong>ç‚¹å‡»è·³è½¬åˆ° GitHub ä»“åº“</strong></a></em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Guavaå·¥å…·åº“å®æˆ˜]]></title>    <link>https://juejin.cn/post/7582846276505960486</link>    <guid>https://juejin.cn/post/7582846276505960486</guid>    <pubDate>2025-12-13T00:37:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582846276505960486" data-draft-id="7582849187864903731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Guavaå·¥å…·åº“å®æˆ˜"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-13T00:37:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Guavaå·¥å…·åº“å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T00:37:25.000Z" title="Sat Dec 13 2025 00:37:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Guavaå·¥å…·åº“å®æˆ˜ï¼šMapã€Listã€Splitterã€Joineré«˜æ•ˆä½¿ç”¨</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae92d257680b431299aeb022e2a09ced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=i224q4JIQTjwZs166YHgkL6YC1Y%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸€ã€å¼•è¨€ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Guavaï¼Ÿ</h3>
<p>åœ¨Javaå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„ç—›ç‚¹ï¼š</p>
<ul>
<li><strong>åˆ›å»ºä¸å¯å˜é›†åˆ</strong>ï¼šJDKåŸç”ŸAPIè¿‡äºç¹ç</li>
<li><strong>å¤„ç†nullå€¼</strong>ï¼šéœ€è¦å¤§é‡çš„åˆ¤ç©ºä»£ç </li>
<li><strong>å­—ç¬¦ä¸²åˆ†å‰²</strong>ï¼š<code>String.split()</code>åŠŸèƒ½æœ‰é™ï¼Œæ— æ³•ä¼˜é›…å¤„ç†ç©ºç™½</li>
<li><strong>é›†åˆæ“ä½œ</strong>ï¼šç¼ºå°‘ä¾¿æ·çš„å·¥å…·æ–¹æ³•</li>
</ul>
<p>Google Guavaæ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œç”Ÿã€‚å®ƒæ˜¯Googleå¼€æºçš„Javaæ ¸å¿ƒåº“ï¼Œæä¾›äº†å¤§é‡ä¼˜é›…ã€é«˜æ•ˆçš„å·¥å…·ç±»ï¼Œè¢«Springã€Hibernateã€MyBatisç­‰ä¼—å¤šçŸ¥åæ¡†æ¶å¹¿æ³›ä½¿ç”¨ã€‚</p>
<p><strong>Guavaçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<p>âœ… <strong>ä»£ç ç®€æ´</strong>ï¼šä¸€è¡Œä»£ç å®Œæˆå¤æ‚æ“ä½œ
âœ… <strong>ç©ºå€¼å®‰å…¨</strong>ï¼šå†…ç½®nullå¤„ç†æœºåˆ¶
âœ… <strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç»è¿‡Googleç”Ÿäº§ç¯å¢ƒéªŒè¯
âœ… <strong>æ˜“äºä½¿ç”¨</strong>ï¼šæµç•…çš„APIè®¾è®¡ï¼Œé“¾å¼è°ƒç”¨</p>
<p>æœ¬æ–‡å°†æ·±å…¥ä»‹ç»Guavaä¸­æœ€å¸¸ç”¨çš„å››å¤§å·¥å…·ï¼š<strong>Mapã€Listã€Splitterã€Joiner</strong>ï¼Œé€šè¿‡çœŸå®æ¡ˆä¾‹å±•ç¤ºå®ƒä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ã€‚</p>
<h3 data-id="heading-2">äºŒã€Guava Mapï¼šå¼ºå¤§çš„æ˜ å°„é›†åˆ</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33b230e91b2a4fa893e18181ec215d6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=f%2FYfEJwV0G4DDTrHaF2FvfQPCEQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>Guavaæä¾›äº†å¤šç§å¢å¼ºçš„Mapå®ç°ï¼Œæ¯ç§éƒ½é’ˆå¯¹ç‰¹å®šåœºæ™¯ä¼˜åŒ–ã€‚</p>
<h4 data-id="heading-3">2.1 ImmutableMapï¼šä¸å¯å˜æ˜ å°„</h4>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€åŒæ­¥</li>
<li>åˆ›å»ºåä¸å¯ä¿®æ”¹</li>
<li>æ€§èƒ½ä¼˜äºCollections.unmodifiableMap()</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.ImmutableMap;

<span class="hljs-comment">// æ–¹å¼1ï¼šç›´æ¥æ„å»º</span>
ImmutableMap&lt;String, Integer&gt; map = ImmutableMap.of(
    <span class="hljs-string">"Java"</span>, <span class="hljs-number">1</span>,
    <span class="hljs-string">"Python"</span>, <span class="hljs-number">2</span>,
    <span class="hljs-string">"Go"</span>, <span class="hljs-number">3</span>
);

<span class="hljs-comment">// æ–¹å¼2ï¼šBuilderæ¨¡å¼ï¼ˆè¶…è¿‡5ä¸ªé”®å€¼å¯¹æ—¶ä½¿ç”¨ï¼‰</span>
ImmutableMap&lt;String, String&gt; configMap = ImmutableMap.&lt;String, String&gt;builder()
    .put(<span class="hljs-string">"db.host"</span>, <span class="hljs-string">"localhost"</span>)
    .put(<span class="hljs-string">"db.port"</span>, <span class="hljs-string">"3306"</span>)
    .put(<span class="hljs-string">"db.name"</span>, <span class="hljs-string">"test"</span>)
    .put(<span class="hljs-string">"db.user"</span>, <span class="hljs-string">"root"</span>)
    .put(<span class="hljs-string">"db.password"</span>, <span class="hljs-string">"123456"</span>)
    .build();

<span class="hljs-comment">// æ–¹å¼3ï¼šä»å·²æœ‰Mapå¤åˆ¶</span>
Map&lt;String, Integer&gt; originalMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
originalMap.put(<span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>);
originalMap.put(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>);
ImmutableMap&lt;String, Integer&gt; immutableCopy = ImmutableMap.copyOf(originalMap);
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šé…ç½®ç®¡ç†</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConfig</span> {

    <span class="hljs-comment">// ç¯å¢ƒé…ç½®æ˜ å°„ï¼Œä¸å¯å˜ä¸”çº¿ç¨‹å®‰å…¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ImmutableMap&lt;String, String&gt; ENV_CONFIG = ImmutableMap.of(
        <span class="hljs-string">"dev"</span>, <span class="hljs-string">"jdbc:mysql://dev-db:3306/app"</span>,
        <span class="hljs-string">"test"</span>, <span class="hljs-string">"jdbc:mysql://test-db:3306/app"</span>,
        <span class="hljs-string">"prod"</span>, <span class="hljs-string">"jdbc:mysql://prod-db:3306/app"</span>
    );

    <span class="hljs-comment">// HTTPçŠ¶æ€ç æ˜ å°„</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ImmutableMap&lt;Integer, String&gt; HTTP_STATUS =
        ImmutableMap.&lt;Integer, String&gt;builder()
            .put(<span class="hljs-number">200</span>, <span class="hljs-string">"OK"</span>)
            .put(<span class="hljs-number">201</span>, <span class="hljs-string">"Created"</span>)
            .put(<span class="hljs-number">400</span>, <span class="hljs-string">"Bad Request"</span>)
            .put(<span class="hljs-number">401</span>, <span class="hljs-string">"Unauthorized"</span>)
            .put(<span class="hljs-number">403</span>, <span class="hljs-string">"Forbidden"</span>)
            .put(<span class="hljs-number">404</span>, <span class="hljs-string">"Not Found"</span>)
            .put(<span class="hljs-number">500</span>, <span class="hljs-string">"Internal Server Error"</span>)
            .build();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getDbUrl</span><span class="hljs-params">(String env)</span> {
        <span class="hljs-keyword">return</span> ENV_CONFIG.getOrDefault(env, ENV_CONFIG.get(<span class="hljs-string">"dev"</span>));
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getStatusMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> code)</span> {
        <span class="hljs-keyword">return</span> HTTP_STATUS.getOrDefault(code, <span class="hljs-string">"Unknown Status"</span>);
    }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>é¿å…äº†åŒæ­¥å¼€é”€</li>
<li>å†…å­˜å ç”¨æ›´å°‘ï¼ˆä¼˜åŒ–çš„å†…éƒ¨ç»“æ„ï¼‰</li>
<li>ç¼–è¯‘æœŸå°±èƒ½å‘ç°ä¿®æ”¹é”™è¯¯</li>
</ul>
<h4 data-id="heading-4">2.2 BiMapï¼šåŒå‘æ˜ å°„</h4>
<p>BiMapå…è®¸ä½ æ ¹æ®å€¼åå‘æŸ¥æ‰¾é”®ï¼Œéå¸¸é€‚åˆåŒå‘æ˜ å°„åœºæ™¯ã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.BiMap;
<span class="hljs-keyword">import</span> com.google.common.collect.HashBiMap;

<span class="hljs-comment">// åˆ›å»ºBiMap</span>
BiMap&lt;String, Integer&gt; userIdMap = HashBiMap.create();
userIdMap.put(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">1001</span>);
userIdMap.put(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">1002</span>);
userIdMap.put(<span class="hljs-string">"Charlie"</span>, <span class="hljs-number">1003</span>);

<span class="hljs-comment">// æ­£å‘æŸ¥æ‰¾</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">aliceId</span> <span class="hljs-operator">=</span> userIdMap.get(<span class="hljs-string">"Alice"</span>);  <span class="hljs-comment">// 1001</span>

<span class="hljs-comment">// åå‘æŸ¥æ‰¾</span>
BiMap&lt;Integer, String&gt; inverse = userIdMap.inverse();
<span class="hljs-type">String</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> inverse.get(<span class="hljs-number">1002</span>);  <span class="hljs-comment">// "Bob"</span>

<span class="hljs-comment">// æ³¨æ„ï¼šå€¼å¿…é¡»å”¯ä¸€ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸</span>
userIdMap.put(<span class="hljs-string">"David"</span>, <span class="hljs-number">1001</span>);  <span class="hljs-comment">// æŠ›å‡ºIllegalArgumentException</span>

<span class="hljs-comment">// å¼ºåˆ¶æ›¿æ¢</span>
userIdMap.forcePut(<span class="hljs-string">"David"</span>, <span class="hljs-number">1001</span>);  <span class="hljs-comment">// Aliceè¢«ç§»é™¤ï¼ŒDavidæ˜ å°„åˆ°1001</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šé”™è¯¯ç ç®¡ç†</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorCodeManager</span> {

    <span class="hljs-comment">// é”™è¯¯ç ä¸æ¶ˆæ¯çš„åŒå‘æ˜ å°„</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> BiMap&lt;String, Integer&gt; ERROR_CODES = HashBiMap.create();

    <span class="hljs-keyword">static</span> {
        ERROR_CODES.put(<span class="hljs-string">"USER_NOT_FOUND"</span>, <span class="hljs-number">1001</span>);
        ERROR_CODES.put(<span class="hljs-string">"INVALID_PASSWORD"</span>, <span class="hljs-number">1002</span>);
        ERROR_CODES.put(<span class="hljs-string">"ACCOUNT_LOCKED"</span>, <span class="hljs-number">1003</span>);
        ERROR_CODES.put(<span class="hljs-string">"PERMISSION_DENIED"</span>, <span class="hljs-number">1004</span>);
    }

    <span class="hljs-comment">// æ ¹æ®é”™è¯¯åè·å–é”™è¯¯ç </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title function_">getErrorCode</span><span class="hljs-params">(String errorName)</span> {
        <span class="hljs-keyword">return</span> ERROR_CODES.get(errorName);
    }

    <span class="hljs-comment">// æ ¹æ®é”™è¯¯ç è·å–é”™è¯¯å</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getErrorName</span><span class="hljs-params">(Integer errorCode)</span> {
        <span class="hljs-keyword">return</span> ERROR_CODES.inverse().get(errorCode);
    }

    <span class="hljs-comment">// ç¤ºä¾‹ï¼šæ—¥å¿—è®°å½•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logError</span><span class="hljs-params">(Integer errorCode)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">errorName</span> <span class="hljs-operator">=</span> getErrorName(errorCode);
        System.out.println(<span class="hljs-string">"Error ["</span> + errorCode + <span class="hljs-string">"]: "</span> + errorName);
    }
}
</code></pre>
<h4 data-id="heading-5">2.3 Multimapï¼šä¸€é”®å¤šå€¼æ˜ å°„</h4>
<p>Multimapå…è®¸ä¸€ä¸ªé”®å¯¹åº”å¤šä¸ªå€¼ï¼Œé¿å…äº†<code>Map&lt;K, List&lt;V&gt;&gt;</code>çš„ç¹çæ“ä½œã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.ArrayListMultimap;
<span class="hljs-keyword">import</span> com.google.common.collect.Multimap;

<span class="hljs-comment">// åˆ›å»ºMultimap</span>
Multimap&lt;String, String&gt; tagMap = ArrayListMultimap.create();

<span class="hljs-comment">// æ·»åŠ å¤šä¸ªå€¼</span>
tagMap.put(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Spring"</span>);
tagMap.put(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"MyBatis"</span>);
tagMap.put(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Guava"</span>);
tagMap.put(<span class="hljs-string">"Python"</span>, <span class="hljs-string">"Django"</span>);
tagMap.put(<span class="hljs-string">"Python"</span>, <span class="hljs-string">"Flask"</span>);

<span class="hljs-comment">// è·å–æŸä¸ªé”®çš„æ‰€æœ‰å€¼</span>
Collection&lt;String&gt; javaTags = tagMap.get(<span class="hljs-string">"Java"</span>);
<span class="hljs-comment">// ["Spring", "MyBatis", "Guava"]</span>

<span class="hljs-comment">// è·å–æ‰€æœ‰é”®å€¼å¯¹</span>
<span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : tagMap.entries()) {
    System.out.println(entry.getKey() + <span class="hljs-string">" -&gt; "</span> + entry.getValue());
}

<span class="hljs-comment">// ç§»é™¤ç‰¹å®šå€¼</span>
tagMap.remove(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"MyBatis"</span>);
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šæ–‡ç« æ ‡ç­¾ç³»ç»Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleTagService</span> {

    <span class="hljs-comment">// æ–‡ç« ID -&gt; æ ‡ç­¾åˆ—è¡¨çš„æ˜ å°„</span>
    <span class="hljs-keyword">private</span> Multimap&lt;Long, String&gt; articleTags = ArrayListMultimap.create();

    <span class="hljs-comment">// æ·»åŠ æ ‡ç­¾</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTag</span><span class="hljs-params">(Long articleId, String tag)</span> {
        articleTags.put(articleId, tag);
    }

    <span class="hljs-comment">// æ‰¹é‡æ·»åŠ æ ‡ç­¾</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTags</span><span class="hljs-params">(Long articleId, List&lt;String&gt; tags)</span> {
        articleTags.putAll(articleId, tags);
    }

    <span class="hljs-comment">// è·å–æ–‡ç« çš„æ‰€æœ‰æ ‡ç­¾</span>
    <span class="hljs-keyword">public</span> Collection&lt;String&gt; <span class="hljs-title function_">getTags</span><span class="hljs-params">(Long articleId)</span> {
        <span class="hljs-keyword">return</span> articleTags.get(articleId);
    }

    <span class="hljs-comment">// ç§»é™¤æ ‡ç­¾</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeTag</span><span class="hljs-params">(Long articleId, String tag)</span> {
        articleTags.remove(articleId, tag);
    }

    <span class="hljs-comment">// æŸ¥æ‰¾åŒ…å«æŸæ ‡ç­¾çš„æ‰€æœ‰æ–‡ç« </span>
    <span class="hljs-keyword">public</span> List&lt;Long&gt; <span class="hljs-title function_">findArticlesByTag</span><span class="hljs-params">(String tag)</span> {
        <span class="hljs-keyword">return</span> articleTags.entries().stream()
            .filter(entry -&gt; entry.getValue().equals(tag))
            .map(Map.Entry::getKey)
            .collect(Collectors.toList());
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-type">ArticleTagService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleTagService</span>();
service.addTags(<span class="hljs-number">1001L</span>, Arrays.asList(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Spring"</span>, <span class="hljs-string">"åç«¯"</span>));
service.addTags(<span class="hljs-number">1002L</span>, Arrays.asList(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"MyBatis"</span>, <span class="hljs-string">"æ•°æ®åº“"</span>));

Collection&lt;String&gt; tags = service.getTags(<span class="hljs-number">1001L</span>);
<span class="hljs-comment">// ["Java", "Spring", "åç«¯"]</span>

List&lt;Long&gt; javaArticles = service.findArticlesByTag(<span class="hljs-string">"Java"</span>);
<span class="hljs-comment">// [1001, 1002]</span>
</code></pre>
<h4 data-id="heading-6">2.4 Tableï¼šåŒé”®æ˜ å°„è¡¨</h4>
<p>Tableæä¾›äº†ç±»ä¼¼æ•°æ®åº“è¡¨çš„ç»“æ„ï¼Œæ”¯æŒè¡Œé”®å’Œåˆ—é”®ã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.HashBasedTable;
<span class="hljs-keyword">import</span> com.google.common.collect.Table;

<span class="hljs-comment">// åˆ›å»ºTable</span>
Table&lt;String, String, Integer&gt; scoreTable = HashBasedTable.create();

<span class="hljs-comment">// æ·»åŠ æ•°æ®ï¼ˆå­¦ç”Ÿã€ç§‘ç›®ã€åˆ†æ•°ï¼‰</span>
scoreTable.put(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Math"</span>, <span class="hljs-number">95</span>);
scoreTable.put(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"English"</span>, <span class="hljs-number">88</span>);
scoreTable.put(<span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Math"</span>, <span class="hljs-number">82</span>);
scoreTable.put(<span class="hljs-string">"Bob"</span>, <span class="hljs-string">"English"</span>, <span class="hljs-number">90</span>);

<span class="hljs-comment">// è·å–ç‰¹å®šå•å…ƒæ ¼çš„å€¼</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">aliceMath</span> <span class="hljs-operator">=</span> scoreTable.get(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Math"</span>);  <span class="hljs-comment">// 95</span>

<span class="hljs-comment">// è·å–æŸä¸€è¡Œ</span>
Map&lt;String, Integer&gt; aliceScores = scoreTable.row(<span class="hljs-string">"Alice"</span>);
<span class="hljs-comment">// {Math=95, English=88}</span>

<span class="hljs-comment">// è·å–æŸä¸€åˆ—</span>
Map&lt;String, Integer&gt; mathScores = scoreTable.column(<span class="hljs-string">"Math"</span>);
<span class="hljs-comment">// {Alice=95, Bob=82}</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šæƒé™çŸ©é˜µ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionMatrix</span> {

    <span class="hljs-comment">// ç”¨æˆ·è§’è‰²ã€èµ„æºã€æƒé™çš„æ˜ å°„è¡¨</span>
    <span class="hljs-keyword">private</span> Table&lt;String, String, Set&lt;String&gt;&gt; permissionTable = HashBasedTable.create();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PermissionMatrix</span><span class="hljs-params">()</span> {
        initPermissions();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initPermissions</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç®¡ç†å‘˜æƒé™</span>
        permissionTable.put(<span class="hljs-string">"ADMIN"</span>, <span class="hljs-string">"USER"</span>, Sets.newHashSet(<span class="hljs-string">"CREATE"</span>, <span class="hljs-string">"READ"</span>, <span class="hljs-string">"UPDATE"</span>, <span class="hljs-string">"DELETE"</span>));
        permissionTable.put(<span class="hljs-string">"ADMIN"</span>, <span class="hljs-string">"ORDER"</span>, Sets.newHashSet(<span class="hljs-string">"CREATE"</span>, <span class="hljs-string">"READ"</span>, <span class="hljs-string">"UPDATE"</span>, <span class="hljs-string">"DELETE"</span>));

        <span class="hljs-comment">// æ™®é€šç”¨æˆ·æƒé™</span>
        permissionTable.put(<span class="hljs-string">"USER"</span>, <span class="hljs-string">"USER"</span>, Sets.newHashSet(<span class="hljs-string">"READ"</span>, <span class="hljs-string">"UPDATE"</span>));
        permissionTable.put(<span class="hljs-string">"USER"</span>, <span class="hljs-string">"ORDER"</span>, Sets.newHashSet(<span class="hljs-string">"CREATE"</span>, <span class="hljs-string">"READ"</span>));

        <span class="hljs-comment">// è®¿å®¢æƒé™</span>
        permissionTable.put(<span class="hljs-string">"GUEST"</span>, <span class="hljs-string">"USER"</span>, Sets.newHashSet(<span class="hljs-string">"READ"</span>));
        permissionTable.put(<span class="hljs-string">"GUEST"</span>, <span class="hljs-string">"ORDER"</span>, Sets.newHashSet(<span class="hljs-string">"READ"</span>));
    }

    <span class="hljs-comment">// æ£€æŸ¥æƒé™</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPermission</span><span class="hljs-params">(String role, String resource, String action)</span> {
        Set&lt;String&gt; permissions = permissionTable.get(role, resource);
        <span class="hljs-keyword">return</span> permissions != <span class="hljs-literal">null</span> &amp;&amp; permissions.contains(action);
    }

    <span class="hljs-comment">// è·å–è§’è‰²åœ¨æŸèµ„æºä¸Šçš„æ‰€æœ‰æƒé™</span>
    <span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title function_">getPermissions</span><span class="hljs-params">(String role, String resource)</span> {
        <span class="hljs-keyword">return</span> permissionTable.get(role, resource);
    }
}
</code></pre>
<h3 data-id="heading-7">ä¸‰ã€Guava Listï¼šå¼ºå¤§çš„åˆ—è¡¨å·¥å…·</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3927c675242f4108a99abfc78f374e4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=bsCn%2B%2FSZjwnN9CjPza%2FYbP268jE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-8">3.1 ImmutableListï¼šä¸å¯å˜åˆ—è¡¨</h4>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.ImmutableList;

<span class="hljs-comment">// æ–¹å¼1ï¼šç›´æ¥æ„å»º</span>
ImmutableList&lt;String&gt; languages = ImmutableList.of(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Python"</span>, <span class="hljs-string">"Go"</span>);

<span class="hljs-comment">// æ–¹å¼2ï¼šBuilderæ¨¡å¼</span>
ImmutableList&lt;Integer&gt; numbers = ImmutableList.&lt;Integer&gt;builder()
    .add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    .add(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
    .build();

<span class="hljs-comment">// æ–¹å¼3ï¼šä»å·²æœ‰é›†åˆå¤åˆ¶</span>
List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>));
ImmutableList&lt;String&gt; immutableCopy = ImmutableList.copyOf(list);
</code></pre>
<h4 data-id="heading-9">3.2 Listså·¥å…·ç±»</h4>
<p><strong>åˆ›å»ºåˆ—è¡¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.Lists;

<span class="hljs-comment">// åˆ›å»ºArrayListå¹¶åˆå§‹åŒ–</span>
List&lt;String&gt; list = Lists.newArrayList(<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>);

<span class="hljs-comment">// åˆ›å»ºæŒ‡å®šå®¹é‡çš„ArrayList</span>
List&lt;String&gt; listWithCapacity = Lists.newArrayListWithCapacity(<span class="hljs-number">100</span>);

<span class="hljs-comment">// åˆ›å»ºLinkedList</span>
List&lt;Integer&gt; linkedList = Lists.newLinkedList();
</code></pre>
<p><strong>åˆ—è¡¨åˆ†å‰²ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å°†å¤§åˆ—è¡¨åˆ†å‰²ä¸ºå›ºå®šå¤§å°çš„å­åˆ—è¡¨</span>
List&lt;Integer&gt; bigList = Lists.newArrayList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>);
List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(bigList, <span class="hljs-number">3</span>);

<span class="hljs-comment">// ç»“æœï¼š[[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]</span>
<span class="hljs-keyword">for</span> (List&lt;Integer&gt; partition : partitions) {
    System.out.println(partition);
}
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šæ‰¹é‡å¤„ç†</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchProcessor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

    <span class="hljs-comment">// æ‰¹é‡æ’å…¥æ•°æ®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchInsert</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
        <span class="hljs-comment">// å°†ç”¨æˆ·åˆ—è¡¨åˆ†å‰²ä¸ºæ¯100ä¸ªä¸€æ‰¹</span>
        List&lt;List&lt;User&gt;&gt; batches = Lists.partition(users, BATCH_SIZE);

        <span class="hljs-keyword">for</span> (List&lt;User&gt; batch : batches) {
            <span class="hljs-comment">// æ‰¹é‡æ’å…¥åˆ°æ•°æ®åº“</span>
            userDao.batchInsert(batch);

            <span class="hljs-comment">// é¿å…è¿‡å¿«çš„æ’å…¥å¯¼è‡´æ•°æ®åº“å‹åŠ›</span>
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">100</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
    }

    <span class="hljs-comment">// æ‰¹é‡å‘é€é€šçŸ¥</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchNotify</span><span class="hljs-params">(List&lt;Long&gt; userIds, String message)</span> {
        Lists.partition(userIds, <span class="hljs-number">50</span>).forEach(batch -&gt; {
            <span class="hljs-comment">// æ¯æ‰¹æœ€å¤š50ä¸ªç”¨æˆ·</span>
            notificationService.sendBatch(batch, message);
        });
    }
}
</code></pre>
<p><strong>åˆ—è¡¨åè½¬ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; list = Lists.newArrayList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>);
List&lt;String&gt; reversed = Lists.reverse(list);
<span class="hljs-comment">// ["D", "C", "B", "A"]</span>
</code></pre>
<p><strong>åˆ—è¡¨è½¬æ¢ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; names = Lists.newArrayList(<span class="hljs-string">"alice"</span>, <span class="hljs-string">"bob"</span>, <span class="hljs-string">"charlie"</span>);

<span class="hljs-comment">// è½¬æ¢ä¸ºå¤§å†™</span>
List&lt;String&gt; upperNames = Lists.transform(names, String::toUpperCase);
<span class="hljs-comment">// ["ALICE", "BOB", "CHARLIE"]</span>

<span class="hljs-comment">// æ³¨æ„ï¼štransformè¿”å›çš„æ˜¯è§†å›¾ï¼Œä¸æ˜¯æ–°åˆ—è¡¨</span>
</code></pre>
<p><strong>ç¬›å¡å°”ç§¯ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; colors = Lists.newArrayList(<span class="hljs-string">"Red"</span>, <span class="hljs-string">"Green"</span>);
List&lt;String&gt; sizes = Lists.newArrayList(<span class="hljs-string">"S"</span>, <span class="hljs-string">"M"</span>, <span class="hljs-string">"L"</span>);

List&lt;List&lt;String&gt;&gt; product = Lists.cartesianProduct(colors, sizes);
<span class="hljs-comment">// [[Red, S], [Red, M], [Red, L], [Green, S], [Green, M], [Green, L]]</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šå•†å“SKUç”Ÿæˆ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductSkuGenerator</span> {

    <span class="hljs-keyword">public</span> List&lt;ProductSku&gt; <span class="hljs-title function_">generateSkus</span><span class="hljs-params">(Product product)</span> {
        <span class="hljs-comment">// è·å–æ‰€æœ‰å±æ€§å€¼</span>
        List&lt;String&gt; colors = product.getColors();      <span class="hljs-comment">// ["é»‘è‰²", "ç™½è‰²"]</span>
        List&lt;String&gt; sizes = product.getSizes();        <span class="hljs-comment">// ["S", "M", "L"]</span>
        List&lt;String&gt; materials = product.getMaterials(); <span class="hljs-comment">// ["æ£‰è´¨", "æ¶¤çº¶"]</span>

        <span class="hljs-comment">// è®¡ç®—ç¬›å¡å°”ç§¯</span>
        List&lt;List&lt;String&gt;&gt; combinations = Lists.cartesianProduct(
            colors, sizes, materials
        );

        <span class="hljs-comment">// ç”ŸæˆSKU</span>
        <span class="hljs-keyword">return</span> combinations.stream()
            .map(combo -&gt; {
                <span class="hljs-type">ProductSku</span> <span class="hljs-variable">sku</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductSku</span>();
                sku.setProductId(product.getId());
                sku.setColor(combo.get(<span class="hljs-number">0</span>));
                sku.setSize(combo.get(<span class="hljs-number">1</span>));
                sku.setMaterial(combo.get(<span class="hljs-number">2</span>));
                sku.setSkuCode(generateSkuCode(combo));
                <span class="hljs-keyword">return</span> sku;
            })
            .collect(Collectors.toList());
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateSkuCode</span><span class="hljs-params">(List&lt;String&gt; attributes)</span> {
        <span class="hljs-keyword">return</span> Joiner.on(<span class="hljs-string">"-"</span>).join(attributes);
    }
}
</code></pre>
<h3 data-id="heading-10">å››ã€Splitterï¼šæ™ºèƒ½å­—ç¬¦ä¸²åˆ†å‰²</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99312c4744e54be2b452997064040c1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=OAmI9fu5n13uDgMnzoYSgtXLXEE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>JDKçš„<code>String.split()</code>å­˜åœ¨è¯¸å¤šé—®é¢˜ï¼šæ— æ³•ä¼˜é›…å¤„ç†ç©ºç™½ã€ç©ºå­—ç¬¦ä¸²ç­‰ã€‚Guavaçš„Splitteræä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-11">4.1 åŸºç¡€ç”¨æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.base.Splitter;

<span class="hljs-comment">// æŒ‰é€—å·åˆ†å‰²</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"a,b,c,d"</span>;
Iterable&lt;String&gt; parts = Splitter.on(<span class="hljs-string">','</span>).split(str);
<span class="hljs-comment">// ["a", "b", "c", "d"]</span>

<span class="hljs-comment">// è½¬æ¢ä¸ºList</span>
List&lt;String&gt; list = Splitter.on(<span class="hljs-string">','</span>).splitToList(str);
</code></pre>
<h4 data-id="heading-12">4.2 å¤„ç†ç©ºç™½å’Œç©ºå­—ç¬¦ä¸²</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">messyStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"a,b,,c, ,d,  ,e"</span>;

<span class="hljs-comment">// å»é™¤ç©ºæ ¼å¹¶å¿½ç•¥ç©ºå­—ç¬¦ä¸²</span>
List&lt;String&gt; cleaned = Splitter.on(<span class="hljs-string">','</span>)
    .trimResults()           <span class="hljs-comment">// å»é™¤æ¯ä¸ªå…ƒç´ çš„é¦–å°¾ç©ºæ ¼</span>
    .omitEmptyStrings()      <span class="hljs-comment">// å¿½ç•¥ç©ºå­—ç¬¦ä¸²</span>
    .splitToList(messyStr);

<span class="hljs-comment">// ç»“æœï¼š["a", "b", "c", "d", "e"]</span>
</code></pre>
<p><strong>å¯¹æ¯”JDKæ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JDKæ–¹å¼ï¼šç¹çä¸”å®¹æ˜“å‡ºé”™</span>
String[] parts = messyStr.split(<span class="hljs-string">","</span>);
List&lt;String&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (String part : parts) {
    <span class="hljs-type">String</span> <span class="hljs-variable">trimmed</span> <span class="hljs-operator">=</span> part.trim();
    <span class="hljs-keyword">if</span> (!trimmed.isEmpty()) {
        result.add(trimmed);
    }
}

<span class="hljs-comment">// Guavaæ–¹å¼ï¼šä¸€è¡Œæå®š</span>
List&lt;String&gt; result = Splitter.on(<span class="hljs-string">','</span>)
    .trimResults()
    .omitEmptyStrings()
    .splitToList(messyStr);
</code></pre>
<h4 data-id="heading-13">4.3 é™åˆ¶åˆ†å‰²æ¬¡æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"key:value:extra:data"</span>;

<span class="hljs-comment">// æœ€å¤šåˆ†å‰²ä¸º2éƒ¨åˆ†</span>
List&lt;String&gt; parts = Splitter.on(<span class="hljs-string">':'</span>)
    .limit(<span class="hljs-number">2</span>)
    .splitToList(str);

<span class="hljs-comment">// ç»“æœï¼š["key", "value:extra:data"]</span>
</code></pre>
<h4 data-id="heading-14">4.4 MapSplitterï¼šåˆ†å‰²ä¸ºMap</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">queryString</span> <span class="hljs-operator">=</span> <span class="hljs-string">"name=Alice&amp;age=25&amp;city=Beijing"</span>;

<span class="hljs-comment">// åˆ†å‰²ä¸ºMap</span>
Map&lt;String, String&gt; params = Splitter.on(<span class="hljs-string">'&amp;'</span>)
    .withKeyValueSeparator(<span class="hljs-string">'='</span>)
    .split(queryString);

<span class="hljs-comment">// ç»“æœï¼š{name=Alice, age=25, city=Beijing}</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šURLå‚æ•°è§£æ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UrlParamParser</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Splitter.<span class="hljs-type">MapSplitter</span> <span class="hljs-variable">PARAM_SPLITTER</span> <span class="hljs-operator">=</span>
        Splitter.on(<span class="hljs-string">'&amp;'</span>)
            .trimResults()
            .omitEmptyStrings()
            .withKeyValueSeparator(<span class="hljs-string">'='</span>);

    <span class="hljs-comment">// è§£æURLå‚æ•°</span>
    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">parseQueryString</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">questionMarkIndex</span> <span class="hljs-operator">=</span> url.indexOf(<span class="hljs-string">'?'</span>);
        <span class="hljs-keyword">if</span> (questionMarkIndex == -<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> Collections.emptyMap();
        }

        <span class="hljs-type">String</span> <span class="hljs-variable">queryString</span> <span class="hljs-operator">=</span> url.substring(questionMarkIndex + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> PARAM_SPLITTER.split(queryString);
    }

    <span class="hljs-comment">// ç¤ºä¾‹ä½¿ç”¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">UrlParamParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlParamParser</span>();

        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.example.com/search?keyword=guava&amp;page=1&amp;size=20"</span>;
        Map&lt;String, String&gt; params = parser.parseQueryString(url);

        System.out.println(<span class="hljs-string">"å…³é”®è¯: "</span> + params.get(<span class="hljs-string">"keyword"</span>));  <span class="hljs-comment">// guava</span>
        System.out.println(<span class="hljs-string">"é¡µç : "</span> + params.get(<span class="hljs-string">"page"</span>));      <span class="hljs-comment">// 1</span>
        System.out.println(<span class="hljs-string">"å¤§å°: "</span> + params.get(<span class="hljs-string">"size"</span>));      <span class="hljs-comment">// 20</span>
    }
}
</code></pre>
<h4 data-id="heading-15">4.5 æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2024-01-15 10:30:45 ERROR User not found"</span>;

<span class="hljs-comment">// æŒ‰ç©ºæ ¼åˆ†å‰²</span>
List&lt;String&gt; parts = Splitter.onPattern(<span class="hljs-string">"\\s+"</span>)
    .splitToList(log);

<span class="hljs-comment">// ç»“æœï¼š["2024-01-15", "10:30:45", "ERROR", "User", "not", "found"]</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šæ—¥å¿—è§£æ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogParser</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Splitter</span> <span class="hljs-variable">LOG_SPLITTER</span> <span class="hljs-operator">=</span> Splitter.onPattern(<span class="hljs-string">"\\s+"</span>)
        .limit(<span class="hljs-number">4</span>);

    <span class="hljs-keyword">public</span> LogEntry <span class="hljs-title function_">parseLog</span><span class="hljs-params">(String logLine)</span> {
        List&lt;String&gt; parts = LOG_SPLITTER.splitToList(logLine);

        <span class="hljs-keyword">if</span> (parts.size() &lt; <span class="hljs-number">4</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Invalid log format"</span>);
        }

        <span class="hljs-type">LogEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogEntry</span>();
        entry.setDate(parts.get(<span class="hljs-number">0</span>));
        entry.setTime(parts.get(<span class="hljs-number">1</span>));
        entry.setLevel(parts.get(<span class="hljs-number">2</span>));
        entry.setMessage(parts.get(<span class="hljs-number">3</span>));  <span class="hljs-comment">// å‰©ä½™éƒ¨åˆ†ä½œä¸ºæ¶ˆæ¯</span>

        <span class="hljs-keyword">return</span> entry;
    }
}
</code></pre>
<h4 data-id="heading-16">4.6 å›ºå®šé•¿åº¦åˆ†å‰²</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"123456789012"</span>;

<span class="hljs-comment">// æ¯3ä¸ªå­—ç¬¦åˆ†å‰²</span>
Iterable&lt;String&gt; parts = Splitter.fixedLength(<span class="hljs-number">3</span>).split(str);
<span class="hljs-comment">// ["123", "456", "789", "012"]</span>
</code></pre>
<h3 data-id="heading-17">äº”ã€Joinerï¼šä¼˜é›…çš„å­—ç¬¦ä¸²è¿æ¥</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aae7decb74da44b3ba19080a46660abe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=ofiV6RC8hlJvRoHkmCX91Ak74D0%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-18">5.1 åŸºç¡€ç”¨æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.base.Joiner;

List&lt;String&gt; list = Arrays.asList(<span class="hljs-string">"Google"</span>, <span class="hljs-string">"Guava"</span>, <span class="hljs-string">"Java"</span>);

<span class="hljs-comment">// ç”¨é€—å·è¿æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>).join(list);
<span class="hljs-comment">// "Google, Guava, Java"</span>

<span class="hljs-comment">// ç”¨æ¢è¡Œç¬¦è¿æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">multiLine</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">"\n"</span>).join(list);
</code></pre>
<h4 data-id="heading-19">5.2 å¤„ç†nullå€¼</h4>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; listWithNull = Arrays.asList(<span class="hljs-string">"A"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);

<span class="hljs-comment">// è·³è¿‡nullå€¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">skipNull</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>)
    .skipNulls()
    .join(listWithNull);
<span class="hljs-comment">// "A, B, C"</span>

<span class="hljs-comment">// ç”¨é»˜è®¤å€¼æ›¿æ¢null</span>
<span class="hljs-type">String</span> <span class="hljs-variable">useForNull</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>)
    .useForNull(<span class="hljs-string">"N/A"</span>)
    .join(listWithNull);
<span class="hljs-comment">// "A, N/A, B, C"</span>
</code></pre>
<h4 data-id="heading-20">5.3 è¿æ¥Map</h4>
<pre><code class="hljs language-java" lang="java">Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
map.put(<span class="hljs-string">"host"</span>, <span class="hljs-string">"localhost"</span>);
map.put(<span class="hljs-string">"port"</span>, <span class="hljs-string">"8080"</span>);
map.put(<span class="hljs-string">"path"</span>, <span class="hljs-string">"/api"</span>);

<span class="hljs-comment">// è¿æ¥Mapä¸ºå­—ç¬¦ä¸²</span>
<span class="hljs-type">String</span> <span class="hljs-variable">mapStr</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">"&amp;"</span>)
    .withKeyValueSeparator(<span class="hljs-string">"="</span>)
    .join(map);

<span class="hljs-comment">// ç»“æœï¼š"host=localhost&amp;port=8080&amp;path=/api"</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šç”ŸæˆURLæŸ¥è¯¢å‚æ•°</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UrlBuilder</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Joiner.<span class="hljs-type">MapJoiner</span> <span class="hljs-variable">QUERY_JOINER</span> <span class="hljs-operator">=</span>
        Joiner.on(<span class="hljs-string">'&amp;'</span>).withKeyValueSeparator(<span class="hljs-string">'='</span>);

    <span class="hljs-keyword">private</span> String baseUrl;
    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UrlBuilder</span><span class="hljs-params">(String baseUrl)</span> {
        <span class="hljs-built_in">this</span>.baseUrl = baseUrl;
    }

    <span class="hljs-keyword">public</span> UrlBuilder <span class="hljs-title function_">addParam</span><span class="hljs-params">(String key, String value)</span> {
        <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
            params.put(key, value);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (params.isEmpty()) {
            <span class="hljs-keyword">return</span> baseUrl;
        }
        <span class="hljs-keyword">return</span> baseUrl + <span class="hljs-string">"?"</span> + QUERY_JOINER.join(params);
    }

    <span class="hljs-comment">// ç¤ºä¾‹ä½¿ç”¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlBuilder</span>(<span class="hljs-string">"https://api.example.com/search"</span>)
            .addParam(<span class="hljs-string">"q"</span>, <span class="hljs-string">"guava"</span>)
            .addParam(<span class="hljs-string">"page"</span>, <span class="hljs-string">"1"</span>)
            .addParam(<span class="hljs-string">"size"</span>, <span class="hljs-string">"20"</span>)
            .build();

        System.out.println(url);
        <span class="hljs-comment">// https://api.example.com/search?q=guava&amp;page=1&amp;size=20</span>
    }
}
</code></pre>
<h4 data-id="heading-21">5.4 è¿½åŠ åˆ°StringBuilder</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">"Results: "</span>);
List&lt;String&gt; items = Arrays.asList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);

Joiner.on(<span class="hljs-string">", "</span>).appendTo(sb, items);
<span class="hljs-comment">// sbå†…å®¹ï¼š"Results: A, B, C"</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šSQLç”Ÿæˆ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlBuilder</span> {

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">buildInsertSql</span><span class="hljs-params">(String tableName, Map&lt;String, Object&gt; data)</span> {
        List&lt;String&gt; columns = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(data.keySet());
        List&lt;String&gt; placeholders = Collections.nCopies(columns.size(), <span class="hljs-string">"?"</span>);

        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">"INSERT INTO "</span>);
        sql.append(tableName).append(<span class="hljs-string">" ("</span>);

        Joiner.on(<span class="hljs-string">", "</span>).appendTo(sql, columns);
        sql.append(<span class="hljs-string">") VALUES ("</span>);
        Joiner.on(<span class="hljs-string">", "</span>).appendTo(sql, placeholders);
        sql.append(<span class="hljs-string">")"</span>);

        <span class="hljs-keyword">return</span> sql.toString();
    }

    <span class="hljs-comment">// ç¤ºä¾‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">SqlBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlBuilder</span>();

        Map&lt;String, Object&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
        data.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"Alice"</span>);
        data.put(<span class="hljs-string">"age"</span>, <span class="hljs-number">35</span>);
        data.put(<span class="hljs-string">"email"</span>, <span class="hljs-string">"alice@example.com"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> builder.buildInsertSql(<span class="hljs-string">"users"</span>, data);
        System.out.println(sql);
        <span class="hljs-comment">// INSERT INTO users (name, age, email) VALUES (?, ?, ?)</span>
    }
}
</code></pre>
<h3 data-id="heading-22">å…­ã€Guava vs JDKï¼šæ€§èƒ½ä¸æ˜“ç”¨æ€§å¯¹æ¯”</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bfd106efd0e4c1d8371bb1ae46a936a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=YSyZX50%2BxJEcOaIlB77dC3UxgIA%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-23">6.1 ä»£ç ç®€æ´åº¦å¯¹æ¯”</h4>
<p><strong>åœºæ™¯ï¼šåˆ›å»ºä¸å¯å˜Map</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JDKæ–¹å¼</span>
Map&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
map.put(<span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>);
map.put(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>);
map.put(<span class="hljs-string">"C"</span>, <span class="hljs-number">3</span>);
Map&lt;String, Integer&gt; immutableMap = Collections.unmodifiableMap(map);

<span class="hljs-comment">// Guavaæ–¹å¼</span>
ImmutableMap&lt;String, Integer&gt; immutableMap = ImmutableMap.of(
    <span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>,
    <span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>,
    <span class="hljs-string">"C"</span>, <span class="hljs-number">3</span>
);
</code></pre>
<p><strong>åœºæ™¯ï¼šå­—ç¬¦ä¸²åˆ†å‰²å¹¶å¤„ç†ç©ºç™½</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JDKæ–¹å¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"a,b,,c, ,d"</span>;
String[] parts = str.split(<span class="hljs-string">","</span>);
List&lt;String&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (String part : parts) {
    <span class="hljs-type">String</span> <span class="hljs-variable">trimmed</span> <span class="hljs-operator">=</span> part.trim();
    <span class="hljs-keyword">if</span> (!trimmed.isEmpty()) {
        result.add(trimmed);
    }
}

<span class="hljs-comment">// Guavaæ–¹å¼</span>
List&lt;String&gt; result = Splitter.on(<span class="hljs-string">','</span>)
    .trimResults()
    .omitEmptyStrings()
    .splitToList(str);
</code></pre>
<h4 data-id="heading-24">6.2 æ€§èƒ½å¯¹æ¯”</h4>
<p>Guavaåœ¨å¾ˆå¤šåœºæ™¯ä¸‹æ€§èƒ½ä¼˜äºJDKï¼š</p>
<p><strong>ImmutableMap vs HashMapï¼š</strong></p>
<ul>
<li>å†…å­˜å ç”¨ï¼šImmutableMapæ›´å°‘ï¼ˆä¼˜åŒ–çš„æ•°æ®ç»“æ„ï¼‰</li>
<li>è®¿é—®é€Ÿåº¦ï¼šImmutableMapç•¥å¿«ï¼ˆæ— é”å¼€é”€ï¼‰</li>
<li>çº¿ç¨‹å®‰å…¨ï¼šImmutableMapæ— éœ€åŒæ­¥</li>
</ul>
<p><strong>Splitter vs String.split()ï¼š</strong></p>
<ul>
<li>å¤ç”¨æ€§ï¼šSplitterå¯å¤ç”¨ï¼Œé¿å…é‡å¤ç¼–è¯‘æ­£åˆ™</li>
<li>çµæ´»æ€§ï¼šSplitteræ”¯æŒé“¾å¼é…ç½®</li>
</ul>
<h3 data-id="heading-25">ä¸ƒã€ç”Ÿäº§å®æˆ˜æ¡ˆä¾‹</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fdb0964b50b46c9bca930d1758505d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=h06UNGgjzj8nbq%2BGYl%2FhlPUVmiE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-26">æ¡ˆä¾‹ä¸€ï¼šCSVæ–‡ä»¶è§£æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CsvParser</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Splitter</span> <span class="hljs-variable">CSV_SPLITTER</span> <span class="hljs-operator">=</span> Splitter.on(<span class="hljs-string">','</span>)
        .trimResults()
        .omitEmptyStrings();

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">parseCsvFile</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> IOException {
        List&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(filePath))) {
            <span class="hljs-comment">// è·³è¿‡æ ‡é¢˜è¡Œ</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">header</span> <span class="hljs-operator">=</span> reader.readLine();

            String line;
            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                List&lt;String&gt; fields = CSV_SPLITTER.splitToList(line);

                <span class="hljs-keyword">if</span> (fields.size() &gt;= <span class="hljs-number">3</span>) {
                    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
                    user.setName(fields.get(<span class="hljs-number">0</span>));
                    user.setAge(Integer.parseInt(fields.get(<span class="hljs-number">1</span>)));
                    user.setEmail(fields.get(<span class="hljs-number">2</span>));
                    users.add(user);
                }
            }
        }

        <span class="hljs-keyword">return</span> users;
    }
}
</code></pre>
<h4 data-id="heading-27">æ¡ˆä¾‹äºŒï¼šé…ç½®æ–‡ä»¶è§£æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigLoader</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Splitter.<span class="hljs-type">MapSplitter</span> <span class="hljs-variable">CONFIG_SPLITTER</span> <span class="hljs-operator">=</span>
        Splitter.on(<span class="hljs-string">'\n'</span>)
            .trimResults()
            .omitEmptyStrings()
            .withKeyValueSeparator(<span class="hljs-string">'='</span>);

    <span class="hljs-keyword">public</span> ImmutableMap&lt;String, String&gt; <span class="hljs-title function_">loadConfig</span><span class="hljs-params">(String configText)</span> {
        <span class="hljs-comment">// ç§»é™¤æ³¨é‡Šè¡Œ</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">cleanedConfig</span> <span class="hljs-operator">=</span> Splitter.on(<span class="hljs-string">'\n'</span>)
            .splitToStream(configText)
            .filter(line -&gt; !line.trim().startsWith(<span class="hljs-string">"#"</span>))
            .collect(Collectors.joining(<span class="hljs-string">"\n"</span>));

        <span class="hljs-keyword">return</span> ImmutableMap.copyOf(CONFIG_SPLITTER.split(cleanedConfig));
    }
}
</code></pre>
<h4 data-id="heading-28">æ¡ˆä¾‹ä¸‰ï¼šç”Ÿæˆç¼“å­˜Key</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheKeyGenerator</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Joiner</span> <span class="hljs-variable">KEY_JOINER</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">':'</span>).skipNulls();

    <span class="hljs-comment">// ç”Ÿæˆç”¨æˆ·ç¼“å­˜é”®</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateUserKey</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> KEY_JOINER.join(<span class="hljs-string">"user"</span>, userId);
        <span class="hljs-comment">// "user:12345"</span>
    }

    <span class="hljs-comment">// ç”Ÿæˆè®¢å•ç¼“å­˜é”®</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateOrderKey</span><span class="hljs-params">(String userId, String orderId)</span> {
        <span class="hljs-keyword">return</span> KEY_JOINER.join(<span class="hljs-string">"order"</span>, userId, orderId);
        <span class="hljs-comment">// "order:user123:order456"</span>
    }

    <span class="hljs-comment">// ç”Ÿæˆå•†å“ç¼“å­˜é”®ï¼ˆå¸¦åˆ†ç±»ï¼‰</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateProductKey</span><span class="hljs-params">(String category, String productId)</span> {
        <span class="hljs-keyword">return</span> KEY_JOINER.join(<span class="hljs-string">"product"</span>, category, productId);
        <span class="hljs-comment">// "product:electronics:prod789"</span>
    }
}
</code></pre>
<h3 data-id="heading-29">å…«ã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-30">8.1 Splitterå’ŒJoinerå¤ç”¨</h4>
<p>Splitterå’ŒJoineræ˜¯ä¸å¯å˜çš„ï¼Œåº”è¯¥å£°æ˜ä¸ºé™æ€å¸¸é‡å¤ç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Constants</span> {
    <span class="hljs-comment">// æ¨èï¼šå£°æ˜ä¸ºé™æ€å¸¸é‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Splitter</span> <span class="hljs-variable">COMMA_SPLITTER</span> <span class="hljs-operator">=</span> Splitter.on(<span class="hljs-string">','</span>)
        .trimResults()
        .omitEmptyStrings();

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Joiner</span> <span class="hljs-variable">COMMA_JOINER</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">','</span>).skipNulls();

    <span class="hljs-comment">// ä¸æ¨èï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°å®ä¾‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">badExample</span><span class="hljs-params">(String str)</span> {
        List&lt;String&gt; parts = Splitter.on(<span class="hljs-string">','</span>).splitToList(str);  <span class="hljs-comment">// æ¯æ¬¡åˆ›å»º</span>
    }
}
</code></pre>
<h4 data-id="heading-31">8.2 ImmutableMapçš„å¤§å°é™åˆ¶</h4>
<p>ImmutableMap.of()æœ€å¤šæ”¯æŒ5ä¸ªé”®å€¼å¯¹ï¼Œè¶…è¿‡éœ€è¦ä½¿ç”¨Builderï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯ï¼šè¶…è¿‡5ä¸ªé”®å€¼å¯¹ä¼šç¼–è¯‘é”™è¯¯</span>
ImmutableMap&lt;String, Integer&gt; map = ImmutableMap.of(
    <span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>, <span class="hljs-string">"C"</span>, <span class="hljs-number">3</span>, <span class="hljs-string">"D"</span>, <span class="hljs-number">4</span>, <span class="hljs-string">"E"</span>, <span class="hljs-number">5</span>, <span class="hljs-string">"F"</span>, <span class="hljs-number">6</span>  <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯</span>
);

<span class="hljs-comment">// æ­£ç¡®ï¼šä½¿ç”¨Builder</span>
ImmutableMap&lt;String, Integer&gt; map = ImmutableMap.&lt;String, Integer&gt;builder()
    .put(<span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>)
    .put(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>)
    .put(<span class="hljs-string">"C"</span>, <span class="hljs-number">3</span>)
    .put(<span class="hljs-string">"D"</span>, <span class="hljs-number">4</span>)
    .put(<span class="hljs-string">"E"</span>, <span class="hljs-number">5</span>)
    .put(<span class="hljs-string">"F"</span>, <span class="hljs-number">6</span>)
    .build();
</code></pre>
<h4 data-id="heading-32">8.3 BiMapçš„å€¼å”¯ä¸€æ€§</h4>
<p>BiMapè¦æ±‚å€¼å¿…é¡»å”¯ä¸€ï¼Œé‡å¤ä¼šæŠ›å¼‚å¸¸ï¼š</p>
<pre><code class="hljs language-java" lang="java">BiMap&lt;String, Integer&gt; map = HashBiMap.create();
map.put(<span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>);
map.put(<span class="hljs-string">"B"</span>, <span class="hljs-number">1</span>);  <span class="hljs-comment">// æŠ›å‡ºIllegalArgumentException</span>

<span class="hljs-comment">// ä½¿ç”¨forcePutå¼ºåˆ¶æ›¿æ¢</span>
map.forcePut(<span class="hljs-string">"B"</span>, <span class="hljs-number">1</span>);  <span class="hljs-comment">// Aè¢«ç§»é™¤ï¼ŒBæ˜ å°„åˆ°1</span>
</code></pre>
<h4 data-id="heading-33">8.4 Lists.transform()çš„è§†å›¾ç‰¹æ€§</h4>
<p>transform()è¿”å›çš„æ˜¯è§†å›¾ï¼Œä¸æ˜¯æ–°åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; original = Lists.newArrayList(<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>);
List&lt;String&gt; transformed = Lists.transform(original, String::toUpperCase);

<span class="hljs-comment">// ä¿®æ”¹åŸåˆ—è¡¨ä¼šå½±å“è§†å›¾</span>
original.set(<span class="hljs-number">0</span>, <span class="hljs-string">"x"</span>);
System.out.println(transformed.get(<span class="hljs-number">0</span>));  <span class="hljs-comment">// "X"</span>

<span class="hljs-comment">// å¦‚æœéœ€è¦ç‹¬ç«‹çš„åˆ—è¡¨ï¼Œåº”è¯¥å¤åˆ¶</span>
List&lt;String&gt; independent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(transformed);
</code></pre>
<h3 data-id="heading-34">ä¹ã€æ€»ç»“</h3>
<p>Guavaå·¥å…·åº“ä¸ºJavaå¼€å‘æä¾›äº†å¼ºå¤§è€Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<p><strong>Mapå·¥å…·ï¼š</strong></p>
<ul>
<li>âœ… ImmutableMapï¼šçº¿ç¨‹å®‰å…¨çš„ä¸å¯å˜æ˜ å°„</li>
<li>âœ… BiMapï¼šåŒå‘æŸ¥æ‰¾çš„æ˜ å°„</li>
<li>âœ… Multimapï¼šä¸€é”®å¤šå€¼çš„ä¾¿æ·æ“ä½œ</li>
<li>âœ… Tableï¼šåŒé”®æ˜ å°„çš„å¼ºå¤§åŠŸèƒ½</li>
</ul>
<p><strong>Listå·¥å…·ï¼š</strong></p>
<ul>
<li>âœ… ImmutableListï¼šä¸å¯å˜åˆ—è¡¨</li>
<li>âœ… Lists.partition()ï¼šæ‰¹é‡å¤„ç†çš„åˆ©å™¨</li>
<li>âœ… Lists.transform()ï¼šå‡½æ•°å¼è½¬æ¢</li>
</ul>
<p><strong>Splitterï¼š</strong></p>
<ul>
<li>âœ… æ™ºèƒ½å¤„ç†ç©ºç™½å’Œnull</li>
<li>âœ… é“¾å¼APIï¼Œä»£ç æ›´ç®€æ´</li>
<li>âœ… MapSplitterè§£æé”®å€¼å¯¹</li>
</ul>
<p><strong>Joinerï¼š</strong></p>
<ul>
<li>âœ… ä¼˜é›…çš„å­—ç¬¦ä¸²è¿æ¥</li>
<li>âœ… çµæ´»çš„nullå¤„ç†</li>
<li>âœ… Mapå’Œé›†åˆçš„ç»Ÿä¸€è¿æ¥</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ Google MCP Toolbox for Databases ä¸­å¼•å…¥ Elasticsearch æ”¯æŒ]]></title>    <link>https://juejin.cn/post/7583139562734567467</link>    <guid>https://juejin.cn/post/7583139562734567467</guid>    <pubDate>2025-12-13T01:29:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583139562734567467" data-draft-id="7583139562734551083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ Google MCP Toolbox for Databases ä¸­å¼•å…¥ Elasticsearch æ”¯æŒ"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-13T01:29:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ Google MCP Toolbox for Databases ä¸­å¼•å…¥ Elasticsearch æ”¯æŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T01:29:19.000Z" title="Sat Dec 13 2025 01:29:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šæ¥è‡ª ElasticÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fenrico-zimuel" title="https://www.elastic.co/search-labs/author/enrico-zimuel" target="_blank" ref="nofollow noopener noreferrer">Enrico Zimuel</a>Â åŠÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Flaurent-saint-felix" title="https://www.elastic.co/search-labs/author/laurent-saint-felix" target="_blank" ref="nofollow noopener noreferrer">Laurent Saint-FÃ©lix</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e01c6927ec064114996a85a6aecc8f63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=PDK8Sb%2FSZcUhFnyNj4IY7iyGbzk%3D" alt="" loading="lazy"/></p>
<p>æ¢ç´¢ Elasticsearch æ”¯æŒç°å·²åœ¨ Google MCP Toolbox for Databases ä¸­å¯ç”¨ï¼Œå¹¶åˆ©ç”¨ ES|QL å·¥å…·å®‰å…¨åœ°å°†ä½ çš„ç´¢å¼•ä¸ä»»ä½• MCP å®¢æˆ·ç«¯é›†æˆã€‚</p>
<p>åŠ¨æ‰‹ä½“éªŒ Elasticsearchï¼šæ·±å…¥äº†è§£æˆ‘ä»¬çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch-labs%3Ftab%3Dreadme-ov-file" title="https://github.com/elastic/elasticsearch-labs?tab=readme-ov-file" target="_blank" ref="nofollow noopener noreferrer">ç¤ºä¾‹ notebooks</a>ï¼Œå¼€å§‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fcloud-trial-overview" title="https://www.elastic.co/cloud/cloud-trial-overview" target="_blank" ref="nofollow noopener noreferrer">å…è´¹çš„ cloud è¯•ç”¨</a>ï¼Œæˆ–ç«‹å³åœ¨ä½ çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">æœ¬åœ°æœºå™¨</a>ä¸Šè¯•ç”¨ Elasticã€‚</p>
<hr/>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•å°† Google MCP Toolbox ä¸ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch" title="https://github.com/elastic/elasticsearch" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch</a> ä¸€èµ·ä½¿ç”¨ï¼Œæ„å»ºä¸€ä¸ªç”¨äºä» Elasticsearch ç´¢å¼•ä¸­æå–ä¿¡æ¯çš„ç®€å•å·¥å…·ã€‚</p>
<p>æˆ‘ä»¬æœ€è¿‘ä¸º <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogleapis%2Fgenai-toolbox" title="https://github.com/googleapis/genai-toolbox" target="_blank" ref="nofollow noopener noreferrer">Google MCP Toolbox for Databases</a> å¼€æºé¡¹ç›®åšå‡ºäº†è´¡çŒ®ï¼Œæ–°å¢äº†å¯¹ Elasticsearch ä½œä¸ºæ•°æ®åº“çš„æ”¯æŒã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæ–°åŠŸèƒ½ï¼Œä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ Google MCP Toolbox è¿æ¥åˆ° Elasticsearchï¼Œå¹¶ç›´æ¥ä¸ä½ çš„æ•°æ®è¿›è¡Œ â€œå¯¹è¯â€ã€‚</p>
<h2 data-id="heading-0">Elasticsearch</h2>
<p>æˆ‘ä»¬éœ€è¦è¿è¡Œä¸€ä¸ª Elasticsearch å®ä¾‹ã€‚ä½ å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud" title="https://www.elastic.co/cloud" target="_blank" ref="nofollow noopener noreferrer">Elastic Cloud</a> ä¸Šæ¿€æ´»ä¸€ä¸ªå…è´¹è¯•ç”¨ï¼Œæˆ–è€…ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">start-local</a> è„šæœ¬åœ¨æœ¬åœ°å®‰è£…ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">`curl <span class="hljs-operator">-</span>fsSL https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>elastic.co<span class="hljs-operator">/</span><span class="hljs-keyword">start</span><span class="hljs-operator">-</span><span class="hljs-keyword">local</span> <span class="hljs-operator">|</span> sh`AIå†™ä»£ç 
</code></pre>
<p>è¿™å°†ä¼šåœ¨ä½ çš„ç”µè„‘ä¸Šå®‰è£… Elasticsearch å’Œ Kibanaï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª API keyï¼Œç”¨äºé…ç½® Google MCP Toolboxã€‚</p>
<p>API key å°†ä½œä¸ºå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºæ˜¾ç¤ºï¼Œå¹¶å­˜å‚¨åœ¨ elastic-start-local æ–‡ä»¶å¤¹ä¸­çš„ .env æ–‡ä»¶é‡Œã€‚</p>
<h2 data-id="heading-1">å®‰è£…ç¤ºä¾‹æ•°æ®é›†</h2>
<p>å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨ç”¨æˆ·å elastic å’Œç”± start-local è„šæœ¬ç”Ÿæˆçš„å¯†ç ç™»å½• Kibanaï¼ˆå­˜å‚¨åœ¨ .env æ–‡ä»¶ä¸­ï¼‰ã€‚</p>
<p>ä½ å¯ä»¥å®‰è£… Kibana ä¸­æä¾›çš„ <strong>eCommerce orders</strong> ç¤ºä¾‹æ•°æ®é›†ã€‚å®ƒåŒ…å«ä¸€ä¸ªåä¸º <strong>kibana_sample_data_ecommerce</strong> çš„ç´¢å¼•ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fenterprise-search%2Fecommerce" title="https://www.elastic.co/enterprise-search/ecommerce" target="_blank" ref="nofollow noopener noreferrer">ç”µå•†</a>ç½‘ç«™çš„ 4,675 ä¸ªè®¢å•çš„ä¿¡æ¯ã€‚å¯¹äºæ¯ä¸ªè®¢å•ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>å®¢æˆ·ä¿¡æ¯ï¼ˆå§“åã€IDã€å‡ºç”Ÿæ—¥æœŸã€é‚®ç®±ç­‰ï¼‰</li>
<li>è®¢å•æ—¥æœŸ</li>
<li>è®¢å• ID</li>
<li>äº§å“ï¼ˆæ‰€æœ‰äº§å“çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬ä»·æ ¼ã€æ•°é‡ã€IDã€ç±»åˆ«ã€æŠ˜æ‰£ç­‰ï¼‰</li>
<li>SKU</li>
<li>æ€»ä»·ï¼ˆæœªå«ç¨ã€å«ç¨ï¼‰</li>
<li>æ€»æ•°é‡</li>
<li>åœ°ç†ä¿¡æ¯ï¼ˆåŸå¸‚ã€å›½å®¶ã€å¤§æ´²ã€ä½ç½®ã€åœ°åŒºï¼‰</li>
</ul>
<p>è¦å®‰è£…ç¤ºä¾‹æ•°æ®ï¼Œè¯·åœ¨ Kibana ä¸­æ‰“å¼€ <strong>Integrations</strong> é¡µé¢ï¼ˆåœ¨é¡¶éƒ¨æœç´¢æ ä¸­æœç´¢ â€œIntegrationâ€ï¼‰ï¼Œå¹¶å®‰è£… â€œSample Dataâ€ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒè¿™é‡Œçš„æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2F%23gs-get-data-into-kibana%25E3%2580%2582" title="https://www.elastic.co/docs/explore-analyze/#gs-get-data-into-kibana%E3%80%82" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/docs/explorâ€¦</a></p>
<p>æœ¬æ–‡çš„ç›®æ ‡æ˜¯å±•ç¤ºé…ç½® Google MCP Toolbox è¿æ¥åˆ° Elasticsearchï¼Œå¹¶ä½¿ç”¨è‡ªç„¶è¯­è¨€ä¸ <strong>kibana_sample_data_ecommerce</strong> ç´¢å¼•äº¤äº’æ˜¯å¤šä¹ˆç®€å•ã€‚</p>
<h2 data-id="heading-2">Google MCP Toolbox</h2>
<p>Google MCP Toolbox æ˜¯ä¸€ä¸ªå¼€æºçš„ MCP serverï¼Œæ—¨åœ¨è®©åº”ç”¨å’Œ AI agents èƒ½å¤Ÿå®‰å…¨ã€é«˜æ•ˆåœ°ä¸ databases äº¤äº’ã€‚è¯¥é¡¹ç›®ä¹‹å‰åä¸º â€œGenAI Toolbox for Databasesâ€ï¼Œåœ¨é‡‡ç”¨äº†å¯¹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fmodel-context-protocol" title="https://www.anthropic.com/news/model-context-protocol" target="_blank" ref="nofollow noopener noreferrer">Model Context Protocolï¼ˆMCPï¼‰</a>çš„å®Œå…¨å…¼å®¹ä¹‹åè¿›è¡Œäº†é‡å‘½åã€‚å®ƒçš„ç›®æ ‡æ˜¯æ¶ˆé™¤ agents è¿æ¥ databases æ—¶ä¼ ç»Ÿä¸Šæ‰€éœ€çš„ç¹é‡å·¥ä½œï¼Œé€šè¿‡åœ¨åå°å¤„ç† connection poolingã€authenticationã€observability ä»¥åŠå…¶ä»–è¿ç»´ç›¸å…³é—®é¢˜ã€‚</p>
<p>ä»æ ¸å¿ƒæ¥çœ‹ï¼ŒToolbox å…è®¸å¼€å‘è€…å®šä¹‰å¯å¤ç”¨çš„é«˜å±‚ toolsï¼Œç”¨äºå°è£… database äº¤äº’ã€‚è¿™äº› tools éšåå¯ä»¥è¢«ä»»ä½•å…¼å®¹ MCP çš„ clientï¼ˆä¾‹å¦‚ AI agentï¼‰è°ƒç”¨ï¼Œè€Œæ— éœ€ client å®ç°åº•å±‚çš„ SQL queries æˆ–ç®¡ç† database connectionsã€‚è¿™ç§æ–¹å¼å¤§å¹…å‡å°‘äº†æ„å»ºå…·å¤‡ database èƒ½åŠ›çš„ agents æ‰€éœ€çš„æ ·æ¿ä»£ç ï¼Œä½¿å¾—åªéœ€å‡ è¡Œåº”ç”¨é€»è¾‘å°±èƒ½é›†æˆé«˜çº§çš„æ•°æ®æ“ä½œã€‚ä¸€æ—¦å®šä¹‰äº†ä¸€ä¸ª toolï¼Œå®ƒå°±å¯ä»¥åœ¨å¤šä¸ª agentsã€frameworks æˆ– languages ä¹‹é—´å…±äº«ï¼ˆFigure 1ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9779b900c344d15a007ba0354141d19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=4iDMFzW%2B9h6g7SDk3SwcFswrlKw%3D" alt="" loading="lazy"/> å›¾ 1ï¼šGoogle MCP Toolbox çš„æ•´ä½“æ¶æ„</p>
<h2 data-id="heading-3">å¦‚ä½•å®‰è£… MCP Toolbox</h2>
<p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ Linux ä¸Šå®‰è£… MCP Toolbox serverï¼š</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  <span class="hljs-built_in">export</span> VERSION=0.21.0
2.  curl -L -o toolbox https://storage.googleapis.com/genai-toolbox/v<span class="hljs-variable">$VERSION</span>/linux/amd64/toolbox
3.  <span class="hljs-built_in">chmod</span> +x toolbox

`AIå†™ä»£ç 
</code></pre>
<p>å¦‚æœä½ æƒ³åœ¨ macOS æˆ– Windows ä¸Šå®‰è£…ï¼Œå¯ä»¥æŒ‰ç…§è¿™é‡Œè¯¦ç»†è¯´æ˜çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚</p>
<h2 data-id="heading-4">ä¸º Elasticsearch é…ç½® Toolbox</h2>
<p>è¦ä¸º Elasticsearch é…ç½® MCP Toolboxï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª tools.yaml æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">`</span>

<span class="hljs-attr">1.  sources:</span>
<span class="hljs-attr">2.    my-cluster:</span>
<span class="hljs-attr">3.      kind:</span> <span class="hljs-string">elasticsearch</span>
<span class="hljs-attr">4.      addresses:</span>
<span class="hljs-number">5</span><span class="hljs-string">.</span>        <span class="hljs-bullet">-</span> <span class="hljs-string">http://localhost:9200</span>
<span class="hljs-attr">6.      apikey:</span> <span class="hljs-string">&lt;insert-here-api-key&gt;</span>

<span class="hljs-attr">8.  tools:</span>
<span class="hljs-attr">9.    customer-orders:</span>
<span class="hljs-attr">10.      kind:</span> <span class="hljs-string">elasticsearch-esql</span>
<span class="hljs-attr">11.      source:</span> <span class="hljs-string">my-cluster</span>
<span class="hljs-attr">12.      description:</span> <span class="hljs-string">Get</span> <span class="hljs-string">the</span> <span class="hljs-string">orders</span> <span class="hljs-string">made</span> <span class="hljs-string">by</span> <span class="hljs-string">a</span> <span class="hljs-string">customer</span> <span class="hljs-string">identified</span> <span class="hljs-string">by</span> <span class="hljs-string">name.</span>
<span class="hljs-attr">13.      query:</span> <span class="hljs-string">|</span>
<span class="hljs-number">14</span><span class="hljs-string">.</span>      	<span class="hljs-string">FROM</span> <span class="hljs-string">kibana_sample_data_ecommerce</span> <span class="hljs-string">|</span> <span class="hljs-string">WHERE</span> <span class="hljs-string">MATCH(customer_full_name,</span> <span class="hljs-string">?name,</span> {<span class="hljs-attr">"operator":</span> <span class="hljs-string">"AND"</span>}<span class="hljs-string">)</span>
<span class="hljs-attr">15.      parameters:</span>
<span class="hljs-attr">16.        - name:</span> <span class="hljs-string">name</span>
<span class="hljs-attr">17.          type:</span> <span class="hljs-string">string</span>
<span class="hljs-attr">18.          description:</span> <span class="hljs-string">The</span> <span class="hljs-string">customer</span> <span class="hljs-string">name.</span>

<span class="hljs-attr">20.  toolsets:</span>
<span class="hljs-attr">21.    elasticsearch-tools:</span>
<span class="hljs-number">22</span><span class="hljs-string">.</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">customer-orders</span>

<span class="hljs-string">`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p>ä½ éœ€è¦å°† <strong/> æ›¿æ¢ä¸ºæœ‰æ•ˆçš„ Elasticsearch API keyã€‚å¦‚æœä½ ä½¿ç”¨ start-local åœ¨æœ¬åœ°è¿è¡Œ Elasticsearchï¼Œå¯ä»¥åœ¨ start-local ç”Ÿæˆçš„ .env æ–‡ä»¶ä¸­æ‰¾åˆ°è¯¥ API keyï¼Œå˜é‡åä¸º <strong>ES_LOCAL_API_KEY</strong>ã€‚å¦‚æœä½ ä½¿ç”¨ Elastic Cloudï¼Œå¯ä»¥æŒ‰ç…§<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fapi-keys%2Felastic-cloud-api-keys" title="https://www.elastic.co/docs/deploy-manage/api-keys/elastic-cloud-api-keys" target="_blank" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>æè¿°çš„æ­¥éª¤ç”Ÿæˆ API keyã€‚</p>
<p>å‰é¢çš„ tools åŒ…å«ä»¥ä¸‹ç”¨äº Elasticsearch çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> æŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">`<span class="hljs-keyword">FROM</span> kibana_sample_data_ecommerce <span class="hljs-operator">|</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(customer_full_name, ?name)`AIå†™ä»£ç 
</code></pre>
<p>å¦‚æœä½ ä¸ç†Ÿæ‚‰ ES|QLï¼Œå®ƒæ˜¯ç”± Elastic å¼€å‘çš„ä¸€ç§æŸ¥è¯¢è¯­è¨€ï¼Œç±»ä¼¼äº SQLï¼Œå¯ç”¨äºæœç´¢ä¸€ä¸ªæˆ–å¤šä¸ªç´¢å¼•ã€‚ä½ å¯ä»¥åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Freference%2Fquery-languages%2Fesql" title="https://www.elastic.co/docs/reference/query-languages/esql" target="_blank" ref="nofollow noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>ä¸­äº†è§£æ›´å¤šå…³äº ES|QL çš„ä¿¡æ¯ã€‚</p>
<p>ä¸Šé¢çš„æŸ¥è¯¢ä¼šæœç´¢å­˜å‚¨åœ¨ <strong>kibana_sample_data_ecommerce</strong> ç´¢å¼•ä¸­ã€åŒ…å«æŒ‡å®šå®¢æˆ·å§“åçš„æ‰€æœ‰è®¢å•ï¼Œä½¿ç”¨ <strong>?name</strong> å‚æ•°ï¼ˆé—®å·è¡¨ç¤ºå‚æ•°ï¼‰ã€‚</p>
<p>å®¢æˆ·å§“ååœ¨ä¹‹å‰çš„ YAML é…ç½®ä¸­å®šä¹‰ï¼Œç±»å‹ä¸º stringï¼Œæè¿°ä¸º â€œThe customer nameâ€ã€‚</p>
<p>è¯¥å·¥å…·å¯ç”¨äºå›ç­”æœ‰å…³å®¢æˆ·è®¢å•çš„é—®é¢˜â€”â€”ä¾‹å¦‚ï¼š<em>How many orders did customer Foo place in October 2025?</em></p>
<p>å·¥å…·åŠå…¶å‚æ•°çš„æè¿°å¯¹äºä»ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€è¯·æ±‚ä¸­æå–ç›¸å…³ä¿¡æ¯è‡³å…³é‡è¦ã€‚æ­¤æå–é€šè¿‡ Large Language Model (LLM) çš„ <strong>function-calling</strong> åŠŸèƒ½æ¥æ‰§è¡Œã€‚åœ¨å®é™…æ“ä½œä¸­ï¼ŒLLM å¯ä»¥ç¡®å®šéœ€è¦æ‰§è¡Œå“ªä¸ªå‡½æ•°ï¼ˆå·¥å…·ï¼‰ä»¥è·å–æ‰€éœ€ä¿¡æ¯ï¼Œä»¥åŠè¯¥å‡½æ•°çš„é€‚å½“å‚æ•°ã€‚</p>
<p>å…³äº function calls çš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬å»ºè®®é˜…è¯» Ashish Tiwari æ’°å†™çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F139544698" title="https://elasticstack.blog.csdn.net/article/details/139544698" target="_blank" ref="nofollow noopener noreferrer">OpenAI function calling with Elasticsearch</a> æ–‡ç« ã€‚</p>
<h2 data-id="heading-5">è¿è¡Œ Toolbox server</h2>
<p>ä½ å¯ä»¥ä½¿ç”¨å‰é¢çš„ tools.yaml æ–‡ä»¶é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œ MCP Toolboxï¼š</p>
<pre><code class="hljs language-css" lang="css">`./toolbox <span class="hljs-attr">--tools-file</span> tools<span class="hljs-selector-class">.yaml</span> <span class="hljs-attr">--ui</span>`AIå†™ä»£ç 
</code></pre>
<p>â€“ui å‚æ•°ä¼šåœ¨ <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A5000%2Fui" title="http://127.0.0.1:5000/ui" target="_blank" ref="nofollow noopener noreferrer">http://127.0.0.1:5000/ui</a> è¿è¡Œä¸€ä¸ª web åº”ç”¨ï¼ˆå›¾ 2ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dd43507748f45aab3c0ed9e65a95c1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=uGs91kN62hLnxT91a8DIHLtogas%3D" alt="" loading="lazy"/> å›¾ 2ï¼šMCP Toolbox UI</p>
<p>ä½ å¯ä»¥é€‰æ‹© Tools &gt; customer-ordersï¼Œå¹¶åœ¨å‚æ•° name ä¸­è¾“å…¥å®¢æˆ·å§“åï¼ˆä¾‹å¦‚ Gwen Sandersï¼‰ï¼Œç„¶åç‚¹å‡» Run Tool æŒ‰é’®ã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚å›¾ 3 æ‰€ç¤ºçš„ JSON å“åº”ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86fda6be990f4b9a930e9b0ce3264dfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=G9udZciatj%2FVS%2B37BLO3gvQUgAI%3D" alt="" loading="lazy"/> å›¾ 3ï¼šä½¿ç”¨ name å€¼ â€œGwenâ€ æ‰§è¡Œ customer-orders å·¥å…·çš„ç»“æœ</p>
<p>è®¾ç½®å®Œæˆåï¼ŒMCP Toolbox å¯ä»¥æ‰§è¡Œ <strong>customer-orders</strong> å·¥å…·ï¼Œä¸ Elasticsearch é€šä¿¡å¹¶è¿è¡Œ ES|QL æŸ¥è¯¢ã€‚</p>
<h2 data-id="heading-6">ä½¿ç”¨ MCP Toolbox ä¸ Gemini CLI</h2>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½• MCP client ä¸ MCP Toolbox for Databases è¿›è¡Œé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli" title="https://github.com/google-gemini/gemini-cli" target="_blank" ref="nofollow noopener noreferrer">Gemini CLI</a>ï¼Œè¿™æ˜¯ä¸€æ¬¾ç”¨äºä½¿ç”¨ Gemini çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ä½ å¯ä»¥æŒ‰ç…§<a href="https://link.juejin.cn?target=https%3A%2F%2Fgeminicli.com%2Fdocs%2Fget-started%2Finstallation%2F" title="https://geminicli.com/docs/get-started/installation/" target="_blank" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>çš„è¯´æ˜å®‰è£… Gemini CLIã€‚</p>
<p>Gemini CLI æä¾›äº†ä¸€ä¸ªä¸º MCP Toolbox é¢„é…ç½®çš„æ‰©å±•ï¼Œä½äº <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgemini-cli-extensions%2Fmcp-toolbox" title="https://github.com/gemini-cli-extensions/mcp-toolbox" target="_blank" ref="nofollow noopener noreferrer">gemini-cli-extensions/mcp-toolbox</a>ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…æ­¤æ‰©å±•ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">`gemini extensions install https:<span class="hljs-comment">//github.com/gemini-cli-extensions/mcp-toolbox`AIå†™ä»£ç </span>
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œä½ éœ€è¦è¿›å…¥å­˜æ”¾ MCP Toolbox tools.yaml é…ç½®æ–‡ä»¶çš„ç›®å½•ï¼Œå¹¶æŒ‰å¦‚ä¸‹æ–¹å¼æ‰§è¡Œ Gemini CLIï¼ˆæ­¤æ­¥éª¤æ˜¯ä¸ºäº†è®© Gemini CLI è‡ªåŠ¨é…ç½® MCP Toolboxï¼‰ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`gemini`</span>AIå†™ä»£ç 
</code></pre>
<p>ä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚å›¾ 4 æ‰€ç¤ºçš„è¾“å‡ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f68e53e89804cf5a92b7126c13e9357~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=D%2FaJ4MvJvCUd4ClM%2FcyRSDFZDsQ%3D" alt="" loading="lazy"/> å›¾ 4ï¼šGemini CLI ç»ˆç«¯</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ MCP Toolbox æ˜¯å¦å·²è¿æ¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">`/mcp list`AIå†™ä»£ç 
</code></pre>
<p>ä½ åº”è¯¥ä¼šçœ‹åˆ° mcp_toolbox åŠå…¶åˆ—å‡ºçš„ customer-orders å·¥å…·ï¼ˆå›¾ 5ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99ec3fbc9fb64de791bcef4d4adc008d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=BdMW9Pe26A8MzUrEFPcOECOX7U0%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœ MCP Toolbox å·²è¿æ¥åˆ° Gemini CLIï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°è¯•æå‡ºä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼šâ€œGive me the orders for the customer Gwen Sanders.â€ ç„¶å Gemini CLI ä¼šè¯·æ±‚æ‰§è¡Œæ¥è‡ª mcp_toolbox server çš„ customer-orders å·¥å…·çš„æƒé™ï¼ˆè§å›¾ 6ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab36fae23e534de5b268cf91c53fc2fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=GU4QqI6u2Rv7SvI46n9oE8wA3nA%3D" alt="" loading="lazy"/> å›¾ 6ï¼šæ‰§è¡Œ customer-orders å·¥å…·çš„æƒé™è¯·æ±‚</p>
<p>ç¡®è®¤åï¼ŒGemini CLI ä¼šå‘ MCP Toolbox æ‰§è¡Œè¯·æ±‚ï¼Œå¾—åˆ° JSON å“åº”ä½œä¸ºç»“æœï¼Œå¹¶ç”¨å®ƒæ¥æ ¼å¼åŒ–å“åº”ï¼ˆå›¾ 7ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a11aa5f9065f48b9b022501b37c873be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=Ipp2rAcq8b%2F5SlJ1C%2BvFd2K9Gog%3D" alt="" loading="lazy"/> å›¾ 7ï¼šæ¥è‡ª MCP Toolbox çš„å“åº”ä»¥åŠ Gemini CLI çš„æœ€ç»ˆå“åº”</p>
<p>æ¥è‡ª Gemini CLI çš„å“åº”ä¼šæ˜¾ç¤º Gwen Sanders åªä¸‹äº†ä¸€ç¬”åŒ…å« 2 ä¸ªäº§å“çš„è®¢å•ï¼Œæ€»ä»·ä¸º 132 eurosã€‚</p>
<h2 data-id="heading-7">MCP Toolbox SDKs</h2>
<p>Google MCP Toolbox è¿˜æä¾›äº† SDKï¼Œå¯ä»ç”¨ Goã€Python å’Œ Javascript ç¼–å†™çš„ç¨‹åºè®¿é—®æ‰€æœ‰åŠŸèƒ½ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒPython SDK å¯åœ¨ Github ä¸Šçš„ä»¥ä¸‹é¡µé¢è·å–ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogleapis%2Fmcp-toolbox-sdk-python%25E3%2580%2582" title="https://github.com/googleapis/mcp-toolbox-sdk-python%E3%80%82" target="_blank" ref="nofollow noopener noreferrer">github.com/googleapis/â€¦</a></p>
<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„ agent æ¥è¿æ¥ MCP Toolboxã€‚éœ€è¦å®‰è£…ä»¥ä¸‹åŒ…ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  pip install toolbox-core
<span class="hljs-bullet">2.</span>  pip install google-adk

`AIå†™ä»£ç 
</code></pre>
<p>å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„ agent é¡¹ç›®ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`adk create my_agent`</span>AIå†™ä»£ç 
</code></pre>
<p>è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º my_agent çš„æ–°ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–‡ä»¶ agent.pyã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å†…å®¹æ›´æ–° my_agent/agent.py ä»¥è¿æ¥ Toolboxï¼š</p>
<pre><code class="hljs language-ini" lang="ini">`

1.  from google.adk import Agent
2.  from google.adk.apps import App
3.  from toolbox_core import ToolboxSyncClient

<span class="hljs-attr">5.  client</span> = ToolboxSyncClient(<span class="hljs-string">"http://127.0.0.1:5000"</span>)

<span class="hljs-attr">7.  root_agent</span> = Agent(
<span class="hljs-attr">8.      name</span>=<span class="hljs-string">'root_agent'</span>,
<span class="hljs-attr">9.      model</span>=<span class="hljs-string">'gemini-2.5-flash'</span>,
<span class="hljs-attr">10.      instruction</span>=<span class="hljs-string">"You are a helpful AI assistant designed to search information about a dataset of ecommerce orders."</span>,
<span class="hljs-attr">11.      tools</span>=client.load_toolset(),
12.  )

<span class="hljs-attr">14.  app</span> = App(root_agent=root_agent, )

`AIå†™ä»£ç !<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªåŒ…å«ä½ çš„ Google API key çš„ .env æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">`<span class="hljs-built_in">echo</span> <span class="hljs-string">'GOOGLE_API_KEY="YOUR_API_KEY"'</span> &gt; my_agent/.env`AIå†™ä»£ç 
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ agent å¹¶è§‚å¯Ÿç»“æœã€‚è¦æ‰§è¡Œ agentï¼Œä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">`adk run my_agent`AIå†™ä»£ç 
</code></pre>
<p>æˆ–è€…ï¼Œä½ å¯ä»¥é€šè¿‡ web ç•Œé¢æ¥è¿è¡Œå®ƒï¼š</p>
<pre><code class="hljs language-css" lang="css">`adk web <span class="hljs-attr">--port</span> <span class="hljs-number">8000</span>`AIå†™ä»£ç 
</code></pre>
<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨é—®ç­”ç•Œé¢ä¸ MCP Toolbox äº¤äº’ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æå‡ºä¹‹å‰çš„é—®é¢˜ï¼šGive me the orders of the customer Gwen Sandersã€‚</p>
<p>æœ‰å…³ä¸åŒ SDK çš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogleapis.github.io%2Fgenai-toolbox%2Fsdks%2F" title="https://googleapis.github.io/genai-toolbox/sdks/" target="_blank" ref="nofollow noopener noreferrer">æ­¤æ–‡æ¡£é¡µé¢</a>ã€‚</p>
<h2 data-id="heading-8">ç»“è®º</h2>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº† Google MCP Toolbox for Databases çš„ Elasticsearch é›†æˆã€‚é€šè¿‡ä¸€ä¸ªç®€å•çš„ YAML é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ç»„å·¥å…·ï¼Œå°†è‡ªç„¶è¯­è¨€é—®é¢˜è½¬æ¢ä¸ºä½¿ç”¨ ES|QL è¯­è¨€çš„ Elasticsearch æŸ¥è¯¢ã€‚</p>
<p>æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä¸ kibana_sample_data_ecommerce æ•°æ®é›†äº¤äº’ï¼Œè¯¥æ•°æ®é›†åŒ…å«æ¥è‡ªä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fenterprise-search%2Fecommerce" title="https://www.elastic.co/enterprise-search/ecommerce" target="_blank" ref="nofollow noopener noreferrer">ç”µå•†</a>ç½‘ç«™çš„è®¢å•ã€‚ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¿è¡Œ MCP Toolbox serverï¼Œå°±å¯ä»¥ä»ä»»ä½• MCP client è¿æ¥åˆ°å®ƒã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Gemini CLI ä½œä¸ºå®¢æˆ·ç«¯è¿æ¥åˆ° MCP Toolbox for Databasesï¼Œå¹¶æŸ¥è¯¢å­˜å‚¨åœ¨ Elasticsearch ä¸­çš„ç”µå•†æ•°æ®ã€‚æˆ‘ä»¬æ‰§è¡Œäº†ä¸€ä¸ªè‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œä»¥æ£€ç´¢ç‰¹å®šå®¢æˆ·ï¼ˆé€šè¿‡å§“åæ ‡è¯†ï¼‰çš„è®¢å•ä¿¡æ¯ã€‚</p>
<p>éšç€ MCP ç”Ÿæ€ç³»ç»Ÿçš„ä¸æ–­å‘å±•ï¼Œè¿™ç§æ¨¡å¼â€”â€”è½»é‡çº§å·¥å…·å®šä¹‰ï¼Œä¾æ‰˜å®‰å…¨ã€ç”Ÿäº§å°±ç»ªçš„åŸºç¡€è®¾æ–½â€”â€”ä¸ºæ„å»ºè¶Šæ¥è¶Šå¼ºå¤§ã€å…·å¤‡æ•°æ®æ„ŸçŸ¥èƒ½åŠ›çš„ agents æä¾›äº†æ–°çš„æœºä¼šï¼Œä¸”å‡ ä¹æ— éœ€é¢å¤–å·¥ä½œã€‚æ— è®ºä½ æ˜¯åœ¨æœ¬åœ°ä½¿ç”¨ Elastic çš„ç¤ºä¾‹æ•°æ®é›†è¿›è¡Œå®éªŒï¼Œè¿˜æ˜¯å°†æœç´¢åŠŸèƒ½é›†æˆåˆ°æ›´å¤§çš„åº”ç”¨ä¸­ï¼ŒMCP Toolbox éƒ½ä¸ºä½¿ç”¨è‡ªç„¶è¯­è¨€ä¸ Elasticsearch æ•°æ®äº¤äº’æä¾›äº†å¯é ä¸”å¯æ‰©å±•çš„åŸºç¡€ã€‚</p>
<p>æœ‰å…³ agentic AI åº”ç”¨å¼€å‘çš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥é˜…è¯» Anish Mathur å’Œ Dana Juratoni æ’°å†™çš„ ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F152024448" title="https://elasticstack.blog.csdn.net/article/details/152024448" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch æ„å»º AI Agentic å·¥ä½œæµç¨‹</a> æ–‡ç« ã€‚</p>
<p>æœ‰å…³ Google MCP Toolbox çš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogleapis.github.io%2Fgenai-toolbox%2Fgetting-started%2Fintroduction%2F%25E3%2580%2582" title="https://googleapis.github.io/genai-toolbox/getting-started/introduction/%E3%80%82" target="_blank" ref="nofollow noopener noreferrer">googleapis.github.io/genai-toolbâ€¦</a></p>
<p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fgoogle-mcp-toolbox-elasticsearch-support" title="https://www.elastic.co/search-labs/blog/google-mcp-toolbox-elasticsearch-support" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labsâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 18å¹¶å‘æ¸²æŸ“å®æˆ˜ï¼š5ä¸ªæ ¸å¿ƒAPIè®©ä½ çš„åº”ç”¨æ€§èƒ½é£™å‡50%]]></title>    <link>https://juejin.cn/post/7582783931164426275</link>    <guid>https://juejin.cn/post/7582783931164426275</guid>    <pubDate>2025-12-13T04:17:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582783931164426275" data-draft-id="7582844980399226920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 18å¹¶å‘æ¸²æŸ“å®æˆ˜ï¼š5ä¸ªæ ¸å¿ƒAPIè®©ä½ çš„åº”ç”¨æ€§èƒ½é£™å‡50%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-13T04:17:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 18å¹¶å‘æ¸²æŸ“å®æˆ˜ï¼š5ä¸ªæ ¸å¿ƒAPIè®©ä½ çš„åº”ç”¨æ€§èƒ½é£™å‡50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T04:17:24.000Z" title="Sat Dec 13 2025 04:17:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>React 18å¹¶å‘æ¸²æŸ“å®æˆ˜ï¼š5ä¸ªæ ¸å¿ƒAPIè®©ä½ çš„åº”ç”¨æ€§èƒ½é£™å‡50%</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>React 18çš„å‘å¸ƒæ ‡å¿—ç€Reactç”Ÿæ€æ­£å¼è¿ˆå…¥äº†å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰æ—¶ä»£ã€‚è¿™ä¸€é‡å¤§å‡çº§ä¸ä»…å¸¦æ¥äº†æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒï¼Œè¿˜ä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥ä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚æ®ç»Ÿè®¡ï¼Œåˆç†ä½¿ç”¨React 18çš„å¹¶å‘ç‰¹æ€§å¯ä»¥è®©åº”ç”¨æ€§èƒ½æå‡é«˜è¾¾50%ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æReact 18çš„5ä¸ªæ ¸å¿ƒAPIï¼Œå¹¶é€šè¿‡å®æˆ˜æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•åˆ©ç”¨å®ƒä»¬å®ç°æ€§èƒ½é£è·ƒã€‚</p>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯å¹¶å‘æ¸²æŸ“ï¼Ÿ</h3>
<p>å¹¶å‘æ¸²æŸ“æ˜¯React 18çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒå…è®¸Reactåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¸­æ–­å’Œæ¢å¤å·¥ä½œï¼Œä»è€Œä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·äº¤äº’ï¼‰ï¼Œé¿å…ç•Œé¢å¡é¡¿ã€‚è¿™ä¸ä¼ ç»Ÿçš„åŒæ­¥æ¸²æŸ“æ¨¡å¼æœ‰æœ¬è´¨åŒºåˆ«ï¼šåŒæ­¥æ¸²æŸ“å¿…é¡»ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰å·¥ä½œï¼Œè€Œå¹¶å‘æ¸²æŸ“åˆ™æ›´åŠ çµæ´»ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨æµè§ˆå™¨çš„ä¸»çº¿ç¨‹èµ„æºã€‚</p>
<h3 data-id="heading-3">5ä¸ªæ ¸å¿ƒAPIè§£æä¸å®æˆ˜</h3>
<h4 data-id="heading-4">1. <code>createRoot</code>ï¼šå¯ç”¨å¹¶å‘æ¨¡å¼çš„ç¬¬ä¸€æ­¥</h4>
<p>åœ¨React 18ä¸­ï¼Œä¼ ç»Ÿçš„<code>ReactDOM.render</code>è¢«æ–°çš„<code>createRoot</code> APIå–ä»£ã€‚è¿™æ˜¯å¯ç”¨å¹¶å‘æ¸²æŸ“çš„åŸºç¡€æ­¥éª¤ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>;

<span class="hljs-keyword">const</span> root = <span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));
root.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ</strong></p>
<ul>
<li><code>createRoot</code>æ˜¯å¹¶å‘æ¸²æŸ“çš„å…¥å£ï¼Œåªæœ‰é€šè¿‡å®ƒåˆ›å»ºçš„æ ¹èŠ‚ç‚¹æ‰èƒ½äº«å—å¹¶å‘ç‰¹æ€§ã€‚</li>
<li>ä¸æ—§ç‰ˆ<code>render</code>ç›¸æ¯”ï¼Œ<code>createRoot</code>æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶èƒ½åŠ›ï¼Œä¾‹å¦‚æ”¯æŒæ‰¹é‡æ›´æ–°å’Œä¼˜å…ˆçº§è°ƒåº¦ã€‚</li>
</ul>
<h4 data-id="heading-5">2. <code>startTransition</code>ï¼šåŒºåˆ†ç´§æ€¥ä¸éç´§æ€¥æ›´æ–°</h4>
<p><code>startTransition</code>æ˜¯React 18ä¸­ç”¨äºæ ‡è®°éç´§æ€¥æ›´æ–°çš„APIã€‚é€šè¿‡å®ƒï¼Œå¼€å‘è€…å¯ä»¥æ˜ç¡®å‘Šè¯‰Reactå“ªäº›æ›´æ–°å¯ä»¥å»¶è¿Ÿæ‰§è¡Œï¼Œä»è€Œç¡®ä¿é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ï¼‰ä¸è¢«é˜»å¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { startTransition, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchBox</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [results, setResults] = <span class="hljs-title function_">useState</span>([]);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-title function_">setInput</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// ç´§æ€¥æ›´æ–°ï¼šç«‹å³åæ˜ ç”¨æˆ·è¾“å…¥</span>
    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">fetchResults</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>).<span class="hljs-title function_">then</span>(setResults); <span class="hljs-comment">// éç´§æ€¥æ›´æ–°ï¼šå»¶è¿Ÿæ‰§è¡Œ</span>
    });
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{input}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span> /&gt;</span></span>;
}
</code></pre>
<p><strong>æ€§èƒ½æå‡ç‚¹ï¼š</strong></p>
<ul>
<li>ç”¨æˆ·è¾“å…¥ä¸å†å› ä¸ºåç«¯è¯·æ±‚è€Œå¡é¡¿ã€‚</li>
<li>Reactä¼šåœ¨æµè§ˆå™¨ç©ºé—²æ—¶å¤„ç†è¿‡æ¸¡ä»»åŠ¡ï¼Œæ˜¾è‘—æå‡äº¤äº’æµç•…åº¦ã€‚</li>
</ul>
<h4 data-id="heading-6">3. <code>useDeferredValue</code>ï¼šå»¶è¿Ÿæ´¾ç”Ÿå€¼çš„æ›´æ–°</h4>
<p><code>useDeferredValue</code>æ˜¯ä¸€ä¸ªHookï¼Œç”¨äºå»¶è¿ŸæŸä¸ªå€¼çš„æ›´æ–°ï¼Œç›´åˆ°æ›´é‡è¦çš„ä»»åŠ¡å®Œæˆåå†å¤„ç†ã€‚å®ƒæ˜¯ä¼˜åŒ–æ´¾ç”ŸçŠ¶æ€ï¼ˆå¦‚æœç´¢ç»“æœçš„è¿‡æ»¤ï¼‰çš„å¼ºå¤§å·¥å…·ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useDeferredValue, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ResultsList</span>(<span class="hljs-params">{ query }</span>) {
  <span class="hljs-keyword">const</span> deferredQuery = <span class="hljs-title function_">useDeferredValue</span>(query);
  <span class="hljs-keyword">const</span> results = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">filterResults</span>(deferredQuery), [deferredQuery]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{results}</span> /&gt;</span></span>;
}
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å½“è®¡ç®—å¯†é›†å‹æ“ä½œï¼ˆå¦‚å¤§å‹åˆ—è¡¨è¿‡æ»¤ï¼‰å¯èƒ½é˜»å¡ä¸»çº¿ç¨‹æ—¶ã€‚</li>
<li><code>deferredQuery</code>ä¼šåœ¨é«˜ä¼˜å…ˆçº§ä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ›´æ–°ï¼Œç¡®ä¿ç•Œé¢å“åº”æ€§ã€‚</li>
</ul>
<h4 data-id="heading-7">4. <code>&lt;Suspense&gt;</code> + <code>lazy</code>ï¼šæ›´æ™ºèƒ½çš„ä»£ç æ‹†åˆ†ä¸åŠ è½½çŠ¶æ€ç®¡ç†</h4>
<p>è™½ç„¶<code>Suspense</code>å’Œ<code>lazy</code>åœ¨Reactä¹‹å‰ç‰ˆæœ¬ä¸­å°±å·²å­˜åœ¨ï¼Œä½†åœ¨React 18ä¸­å®ƒä»¬çš„è¡¨ç°æ›´åŠ å‡ºè‰²ï¼Œå°¤å…¶æ˜¯åœ¨å¹¶å‘æ¨¡å¼ä¸‹ï¼š</p>
<ul>
<li><code>&lt;Suspense&gt;</code>ç°åœ¨å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œå¹¶æ”¯æŒæ›´ç²¾ç»†çš„å›é€€ï¼ˆfallbackï¼‰æ§åˆ¶ã€‚</li>
<li><code>lazy</code>ç»„ä»¶åŠ è½½æ—¶å¯ä»¥ä¸å…¶ä»–å¹¶å‘ä»»åŠ¡åè°ƒå·¥ä½œã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./HeavyComponent'</span>));

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>}&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>ä¼˜åŒ–æ•ˆæœï¼š</strong></p>
<ul>
<li>å‡å°‘é¦–å±åŠ è½½æ—¶é—´ï¼Œæå‡LCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰æŒ‡æ ‡ã€‚</li>
<li>Reactä¼šä¼˜å…ˆæ¸²æŸ“å·²å‡†å¤‡å¥½çš„å†…å®¹ï¼Œé¿å…â€œå…¨æœ‰æˆ–å…¨æ— â€çš„åŠ è½½é—®é¢˜ã€‚</li>
</ul>
<h4 data-id="heading-8">5. <code>useId</code>ï¼šè§£å†³SSRä¸­çš„Hydrationä¸åŒ¹é…é—®é¢˜</h4>
<p>åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„IDç”Ÿæˆä¸ä¸€è‡´å¯èƒ½å¯¼è‡´Hydrationé”™è¯¯ã€‚<code>useId</code>æä¾›äº†ä¸€ç§ç¨³å®šçš„IDç”Ÿæˆæœºåˆ¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Checkbox</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">useId</span>();
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">{id}</span>&gt;</span>Accept terms<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{id}</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
);
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong></p>
<ul>
<li>SSRåº”ç”¨ä¸­å¸¸è§çš„â€œWarning: Text content did not matchâ€é—®é¢˜é€šå¸¸æºäºåŠ¨æ€IDçš„ä¸ä¸€è‡´ã€‚</li>
<li><code>useId</code>ç”Ÿæˆçš„IDåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¿æŒä¸€è‡´ï¼Œå½»åº•è§£å†³æ­¤ç±»é—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-9">å®æˆ˜æ¡ˆä¾‹ï¼šä¼˜åŒ–ä¸€ä¸ªå¤§å‹æ•°æ®è¡¨</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€è¦æ¸²æŸ“10,000è¡Œæ•°æ®çš„è¡¨æ ¼ã€‚ä¼ ç»ŸåŒæ­¥æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°æ˜æ˜¾çš„å¡é¡¿ï¼›è€Œé€šè¿‡å¹¶å‘ç‰¹æ€§æ”¹é€ åï¼š</p>
<ol>
<li><strong>ä½¿ç”¨<code>startTransition</code>å»¶è¿Ÿæ’åº/ç­›é€‰æ“ä½œ</strong>ï¼šç¡®ä¿æ»šåŠ¨å’Œç‚¹å‡»ç­‰é«˜ä¼˜å…ˆçº§äº¤äº’ä¸è¢«é˜»å¡ã€‚</li>
<li><strong>ç»“åˆ<code>useDeferredValue</code>ä¼˜åŒ–æ´¾ç”ŸçŠ¶æ€</strong>ï¼šä»…åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ›´æ–°è¿‡æ»¤åçš„æ•°æ®ã€‚</li>
<li><strong>è™šæ‹Ÿæ»šåŠ¨ + <code>&lt;Suspense&gt;</code>åˆ†å—åŠ è½½</strong>ï¼šæŒ‰éœ€æ¸²æŸ“å¯è§åŒºåŸŸçš„è¡Œæ•°æ®ã€‚</li>
</ol>
<p>æ”¹é€ åçš„æ€§èƒ½å¯¹æ¯”ï¼š</p>
<ul>
<li><strong>é¦–æ¬¡åŠ è½½æ—¶é—´å‡å°‘40%</strong>ï¼ˆå¾—ç›Šäºä»£ç æ‹†åˆ†å’Œåˆ†å—Hydrationï¼‰ã€‚</li>
<li><strong>äº¤äº’å»¶è¿Ÿé™ä½50%ä»¥ä¸Š</strong>ï¼ˆé€šè¿‡ä¼˜å…ˆçº§è°ƒåº¦é¿å…ä¸»çº¿ç¨‹é˜»å¡ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-10">Reactå¹¶å‘æ¨¡å¼çš„åº•å±‚åŸç†</h3>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™äº›APIçš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬éœ€è¦ç®€è¦æ¢è®¨Fiberæ¶æ„å’Œè°ƒåº¦å™¨ï¼ˆSchedulerï¼‰çš„å®ç°ï¼š</p>
<ol>
<li><strong>FiberèŠ‚ç‚¹çš„å¯ä¸­æ–­æ€§</strong>ï¼šæ¯ä¸ªFiberèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå·¥ä½œå•å…ƒï¼ŒReactå¯ä»¥æš‚åœæˆ–æ¢å¤å…¶æ¸²æŸ“ã€‚</li>
<li><strong>åŸºäºä¼˜å…ˆçº§çš„è°ƒåº¦</strong>ï¼š
<ul>
<li>Immediateï¼ˆç«‹å³æ‰§è¡Œï¼‰ï¼šå¦‚ç”¨æˆ·è¾“å…¥ã€‚</li>
<li>Defaultï¼ˆé»˜è®¤ï¼‰ï¼šæ™®é€šUIæ›´æ–°ã€‚</li>
<li>Transitionï¼ˆè¿‡æ¸¡ï¼‰ï¼šå¯ä¸­æ–­çš„ä½ä¼˜å…ˆçº§ä»»åŠ¡ã€‚</li>
</ul>
</li>
<li><strong>æ—¶é—´åˆ‡ç‰‡ï¼ˆTime Slicingï¼‰</strong>ï¼šå°†é•¿ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ª5msçš„å°å—æ‰§è¡Œã€‚</li>
</ol>
<p>###æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</p>
<p>å°½ç®¡å¹¶å‘æ¨¡å¼å¼ºå¤§ä½†å¹¶éé“¶å¼¹ï¼š</p>
<ol>
<li><strong>é€æ­¥é‡‡ç”¨ç­–ç•¥</strong>ï¼š
-å…ˆé€šè¿‡éƒ¨åˆ†è·¯ç”±æˆ–ç»„ä»¶è¯•ç”¨æ–°ç‰¹æ€§ã€‚
-ä½¿ç”¨StrictModeæ£€æµ‹æ½œåœ¨é—®é¢˜ã€‚</li>
<li><strong>æ€§èƒ½ç›‘æ§å¿…ä¸å¯å°‘</strong>
-å…³æ³¨TBT(æ€»é˜»å¡æ—¶é—´)å’ŒINP(äº¤äº’åˆ°ä¸‹ä¸€æ¬¡ç»˜åˆ¶)æŒ‡æ ‡ã€‚</li>
</ol>
<p>3.<strong>é¿å…è¿‡åº¦ä¼˜åŒ–</strong>
-å¯¹ç®€å•ç»„ä»¶å¯èƒ½å¼•å…¥ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</p>
<p>###æ€»ç»“</p>
<p>ä»ä¼ ç»ŸåŒæ­¥æ¨¡å¼åˆ°ç°ä»£Webåº”ç”¨çš„æµç•…ä½“éªŒä¹‹é—´éš”ç€ä¸€é“å·¨å¤§çš„é¸¿æ²Ÿâ€”â€”è€ŒReact18æä¾›çš„è¿™5ä¸ªæ ¸å¿ƒAPIæ­£æ˜¯è·¨è¶Šå®ƒçš„æ¡¥æ¢ï¼š</p>
<p>1.createRootå¼€å¯æ–°æ—¶ä»£çš„å¤§é—¨ï¼›
2.startTransitionåˆ’åˆ†ä»»åŠ¡çš„è½»é‡ç¼“æ€¥ï¼›
3.useDeferredValueè®©æ´¾ç”ŸçŠ¶æ€ä¼˜é›…é™çº§ï¼›
4.Suspenseå®¶æ—ç»Ÿä¸€å¼‚æ­¥å¤„ç†çš„ç”¨æˆ·ä½“éªŒï¼›
5.useIdè§£å†³SSRä¸­çš„é¡½ç–¾ã€‚</p>
<p>å½“ä½ å°†è¿™äº›å·¥å…·ç»„åˆä½¿ç”¨æ—¶ç”šè‡³å¯ä»¥å®ç°è¶…è¿‡50%çš„æ€§èƒ½æå‡â€”â€”è¿™ä¸ä»…æ˜¯ä¸€ä¸ªæ•°å­—æ›´æ˜¯ç”¨æˆ·ä½“éªŒè´¨çš„é£è·ƒã€‚</p>
<p>æœªæ¥éšç€æ›´å¤šæ¡†æ¶(å¦‚Next.js)æ·±åº¦æ•´åˆè¿™äº›ç‰¹æ€§æˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡:2024å¹´å°†æˆä¸ºçœŸæ­£æ„ä¹‰ä¸Šçš„"Webåº”ç”¨é«˜æ€§èƒ½å…ƒå¹´"ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jacksonåºåˆ—åŒ–è®©éªŒç­¾å¤±è´¥ï¼Ÿç ´è§£JSONè½¬ä¹‰é™·é˜±]]></title>    <link>https://juejin.cn/post/7582815307439882291</link>    <guid>https://juejin.cn/post/7582815307439882291</guid>    <pubDate>2025-12-13T04:26:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582815307439882291" data-draft-id="7582809606067781658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jacksonåºåˆ—åŒ–è®©éªŒç­¾å¤±è´¥ï¼Ÿç ´è§£JSONè½¬ä¹‰é™·é˜±"/> <meta itemprop="keywords" content="åç«¯,Java,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-13T04:26:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="9å·è¾¾äºº"/> <meta itemprop="url" content="https://juejin.cn/user/2450136052270077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jacksonåºåˆ—åŒ–è®©éªŒç­¾å¤±è´¥ï¼Ÿç ´è§£JSONè½¬ä¹‰é™·é˜±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2450136052270077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    9å·è¾¾äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T04:26:32.000Z" title="Sat Dec 13 2025 04:26:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªçš„æŒºæœ‰æ„æ€çš„éªŒç­¾é—®é¢˜ã€‚æˆ‘ä»¬çš„é¡¹ç›®é‡‡ç”¨äº†å‰åç«¯ç­¾åéªŒè¯æœºåˆ¶æ¥ä¿è¯æ•°æ®å®‰å…¨ï¼š</p>
<ul>
<li><strong>å‰ç«¯</strong>ï¼šè¯·æ±‚æ—¶å¯¹ body è¿›è¡Œç­¾å</li>
<li><strong>åç«¯</strong>ï¼šæ¥æ”¶åå¯¹ body è¿›è¡ŒéªŒç­¾</li>
</ul>
<p>æ­£å¸¸æƒ…å†µä¸‹éƒ½æ²¡å•¥é—®é¢˜ï¼Œä½†è¿™æ¬¡æ¯”è¾ƒå¥‡æ€ªï¼š</p>
<ol>
<li>åç«¯æ¥å£ A è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­æŸä¸ªå­—æ®µæ˜¯ <strong>JSON å­—ç¬¦ä¸²</strong>ï¼ˆString ç±»å‹ï¼‰</li>
<li>å‰ç«¯æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡åï¼Œä¼šæŠŠè¿™ä¸ªjsonå­—ç¬¦ä¸²åŸæ¨¡åŸæ ·çš„ä½œä¸ºå‚æ•°ä¼ ç»™åç«¯æ¥å£ B</li>
<li>ç„¶åå°±ã€‚ã€‚ã€‚éªŒç­¾å¤±è´¥äº†</li>
</ol>
<p>æˆ‘ä»¬å°±é™·å…¥äº†äº’ç›¸ç”©é”…çš„å±€é¢ï¼š</p>
<ul>
<li><strong>åç«¯</strong>è®¤ä¸ºï¼šå‰ç«¯éªŒç­¾æ—¶åšäº†ç‰¹æ®Šå¤„ç†</li>
<li><strong>å‰ç«¯</strong>å¾ˆæ— è¾œï¼šç”¨çš„æ˜¯å…¬å…±åº“ï¼Œä»æ²¡æ”¹è¿‡</li>
<li><strong>æŠ˜ä¸­å…±è¯†</strong>ï¼šå¯èƒ½æ˜¯ HTTP ä¼ è¾“è¿‡ç¨‹ä¸­å¯¹ JSON åšäº†è½¬ä¹‰</li>
</ul>
<p>ç»è¿‡ä¸€ç•ªè°ƒè¯•å‘ç°ï¼š</p>
<ul>
<li>å‰ç«¯éªŒç­¾æ—¶ï¼ŒJSON å­—ç¬¦ä¸²å­—æ®µæœ‰<strong>ä¸€æ¬¡è½¬ä¹‰å­—ç¬¦</strong>ï¼ˆå¦‚ <code>"</code>)</li>
<li>åç«¯æ”¶åˆ°çš„ body ä¸­ï¼ŒJSON å­—ç¬¦ä¸²å­—æ®µæœ‰<strong>äºŒæ¬¡è½¬ä¹‰å­—ç¬¦</strong>ï¼ˆå¦‚ <code>\"</code>)</li>
</ul>
<p>åŒæ–¹éªŒç­¾çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè‡ªç„¶éªŒè¯å¤±è´¥ã€‚</p>
<p>ä¸´æ—¶æ–¹æ¡ˆï¼šå¯¹è¿™ä¸ªå­—æ®µåš Base64 ç¼–ç ï¼Œç»•è¿‡è½¬ä¹‰é—®é¢˜ã€‚</p>
<p>ä½†äº‹å®çœŸçš„æ˜¯ HTTP ä¼ è¾“å¯¼è‡´çš„è½¬ä¹‰å—ï¼Ÿ<strong>å½“ç„¶ä¸æ˜¯</strong></p>
<p><strong>HTTP è¯·æ±‚æœ¬èº«ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œè½¬ä¹‰</strong>ã€‚é‚£è½¬ä¹‰å­—ç¬¦æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ</p>
<h3 data-id="heading-0">é—®é¢˜æ ¹æº</h3>
<p>æ•´ä¸ªæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<h4 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šåç«¯æ¥å£ A è¿”å›æ•°æ®ï¼ˆç¬¬ä¸€æ¬¡åºåˆ—åŒ–ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â åç«¯è¿”å›çš„å¯¹è±¡</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Response</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ <span class="hljs-keyword">data</span>;Â Â <span class="hljs-comment">//Â è¿™é‡Œå­˜å‚¨çš„æ˜¯Â JSONÂ å­—ç¬¦ä¸²</span>
}

<span class="hljs-comment">//Â æ¥å£Â AÂ è¿”å›æ•°æ®</span>
<span class="hljs-keyword">return</span>Â newÂ Response(<span class="hljs-string">"{"</span>name<span class="hljs-string">":"</span>å¼ ä¸‰<span class="hljs-string">","</span>age<span class="hljs-string">":25}"</span>);
</code></pre>
<p>Spring Boot åœ¨å“åº”æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œ JSON åºåˆ—åŒ–ï¼Œç”±äº <code>data</code> å­—æ®µæœ¬èº«æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šå¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
Â Â <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"{"</span>name<span class="hljs-string">":"</span>å¼ ä¸‰<span class="hljs-string">","</span>age<span class="hljs-string">":25}"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-2">ç¬¬äºŒæ­¥ï¼šå‰ç«¯éªŒç­¾ï¼ˆåŸºäºä¸€æ¬¡è½¬ä¹‰çš„æ•°æ®ï¼‰</h4>
<p>å‰ç«¯æ‹¿åˆ°å“åº”åï¼Œå¯¹æ•´ä¸ªå¯¹è±¡è¿›è¡ŒéªŒç­¾ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â å‰ç«¯æ”¶åˆ°çš„æ•°æ®</span>
<span class="hljs-keyword">const</span>Â responseÂ =Â {
Â Â <span class="hljs-attr">data</span>:Â <span class="hljs-string">"{"</span>name<span class="hljs-string">":"</span>å¼ ä¸‰<span class="hljs-string">","</span>age<span class="hljs-string">":25}"</span>Â Â <span class="hljs-comment">//Â å¸¦æœ‰ä¸€æ¬¡è½¬ä¹‰</span>
};

<span class="hljs-comment">//Â å¯¹è¿™ä¸ªå¯¹è±¡åšéªŒç­¾</span>
<span class="hljs-keyword">const</span>Â signatureÂ =Â <span class="hljs-title function_">sign</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response));
</code></pre>
<p>æ­¤æ—¶éªŒç­¾çš„åŸå§‹æ•°æ®åŒ…å«<strong>ä¸€æ¬¡è½¬ä¹‰å­—ç¬¦</strong>ã€‚</p>
<h4 data-id="heading-3">ç¬¬ä¸‰æ­¥ï¼šå‰ç«¯è¯·æ±‚æ¥å£ Bï¼ˆç¬¬äºŒæ¬¡åºåˆ—åŒ–ï¼‰</h4>
<p>å‰ç«¯å°†è¿™ä¸ªå¯¹è±¡ä½œä¸º body è¯·æ±‚æ¥å£ Bï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â å°†å¯¹è±¡å‘é€ç»™æ¥å£Â B</span>
axios.<span class="hljs-built_in">post</span>(<span class="hljs-string">'/api/b'</span>,Â response);
</code></pre>
<p>æµè§ˆå™¨æˆ– HTTP åº“ä¼šå†æ¬¡å¯¹ body è¿›è¡Œ JSON åºåˆ—åŒ–ï¼ŒJSON å­—ç¬¦ä¸²åˆä¼šè¢«è½¬ä¹‰ä¸€æ¬¡ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">{
Â Â <span class="hljs-string">"data"</span>:Â <span class="hljs-string">"{<span class="hljs-subst">\"</span>name<span class="hljs-subst">\"</span>:<span class="hljs-subst">\"</span>å¼ ä¸‰<span class="hljs-subst">\"</span>,<span class="hljs-subst">\"</span>age<span class="hljs-subst">\"</span>:25}"</span>
}
</code></pre>
<p>æ³¨æ„ï¼š<code>"</code> å˜æˆäº† <code>\"</code>ï¼ˆäºŒæ¬¡è½¬ä¹‰ï¼‰</p>
<h4 data-id="heading-4">ç¬¬å››æ­¥ï¼šåç«¯æ¥å£ B éªŒç­¾ï¼ˆåŸºäºäºŒæ¬¡è½¬ä¹‰çš„æ•°æ®ï¼‰</h4>
<p>åç«¯æ”¶åˆ°è¯·æ±‚åï¼Œæ‹¿åˆ°çš„æ˜¯ç»è¿‡<strong>äºŒæ¬¡è½¬ä¹‰</strong>çš„æ•°æ®è¿›è¡ŒéªŒç­¾ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">//Â åç«¯æ”¶åˆ°çš„Â bodyï¼ˆäºŒæ¬¡è½¬ä¹‰ï¼‰</span>
<span class="hljs-type">String</span>Â bodyÂ <span class="hljs-operator">=</span>Â <span class="hljs-string">"{<span class="hljs-subst">\"</span>name<span class="hljs-subst">\"</span>:<span class="hljs-subst">\"</span>å¼ ä¸‰<span class="hljs-subst">\"</span>,<span class="hljs-subst">\"</span>age<span class="hljs-subst">\"</span>:25}"</span>;

<span class="hljs-comment">//Â éªŒç­¾å¤±è´¥ï¼å› ä¸ºè½¬ä¹‰å­—ç¬¦æ•°é‡ä¸ä¸€è‡´</span>
</code></pre>
<h3 data-id="heading-5">ä¸ºä»€ä¹ˆéªŒç­¾ä¼šå¤±è´¥ï¼Ÿ</h3>
<ul>
<li><strong>å‰ç«¯éªŒç­¾</strong>ï¼šåŸºäºä¸€æ¬¡è½¬ä¹‰çš„æ•°æ® <code>{"name":...}</code></li>
<li><strong>åç«¯éªŒç­¾</strong>ï¼šåŸºäºäºŒæ¬¡è½¬ä¹‰çš„æ•°æ® <code>{\"name\":...}</code></li>
</ul>
<p>ä¸¤è¾¹è®¡ç®—ç­¾åçš„åŸå§‹æ•°æ®ä¸ä¸€è‡´ï¼Œè‡ªç„¶å°±éªŒç­¾å¤±è´¥äº†</p>
<h2 data-id="heading-6">æœ€å¿«çš„æ–¹æ¡ˆ</h2>
<p><strong>ä¸è¦åœ¨å¯¹è±¡ä¸­åµŒå¥— JSON å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å› JSON å¯¹è±¡</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â é”™è¯¯åšæ³•</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Response</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ <span class="hljs-keyword">data</span>;Â Â <span class="hljs-comment">//Â JSONÂ å­—ç¬¦ä¸²</span>
}

<span class="hljs-comment">//Â æ­£ç¡®åšæ³•</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Response</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â UserInfoÂ <span class="hljs-keyword">data</span>;Â Â <span class="hljs-comment">//Â JSONÂ å¯¹è±¡</span>
}

<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UserInfo</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ name;
Â Â Â Â <span class="hljs-keyword">private</span>Â IntegerÂ age;
}
</code></pre>
<p>è¿™æ · Spring Boot åªä¼šè¿›è¡Œä¸€æ¬¡åºåˆ—åŒ–ï¼Œä¸ä¼šäº§ç”Ÿè½¬ä¹‰å­—ç¬¦ï¼Œå‰åç«¯å¤„ç†çš„æ•°æ®æ ¼å¼å®Œå…¨ä¸€è‡´ã€‚</p>
<h2 data-id="heading-7">çŸ¥å·±çŸ¥å½¼</h2>
<p>æ—¢ç„¶æ‰¾åˆ°äº†é—®é¢˜æ ¹æºï¼Œæ­£å¥½å°±æ·±å…¥æºç çœ‹çœ‹ Jackson æ˜¯å¦‚ä½•å¯¹å­—ç¬¦ä¸²è¿›è¡Œåºåˆ—åŒ–çš„ã€‚Spring Boot é»˜è®¤ä½¿ç”¨ Jackson ä½œä¸º JSON åºåˆ—åŒ–æ¡†æ¶ã€‚</p>
<h3 data-id="heading-8">åºåˆ—åŒ–è°ƒç”¨é“¾è·¯</h3>
<h4 data-id="heading-9">1. BeanSerializerBase - å¯¹è±¡åºåˆ—åŒ–å…¥å£</h4>
<p>åºåˆ—åŒ–ä¸€èˆ¬ä¼šè°ƒç”¨ <code>BeanSerializer</code>ï¼Œå…¶æ ¸å¿ƒå®ç°åœ¨ <code>BeanSerializerBase</code> ä¸­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">protectedÂ voidÂ serializeFields(ObjectÂ bean,Â JsonGeneratorÂ gen,Â SerializerProviderÂ provider)
Â Â Â Â Â Â Â Â throwsÂ IOExceptionÂ {
Â Â Â Â finalÂ BeanPropertyWriter<span class="hljs-section">[]</span>Â props<span class="hljs-comment">;Â Â //Â å¯¹è±¡çš„æ‰€æœ‰å­—æ®µå±æ€§</span>
Â Â Â Â ifÂ (_filteredPropsÂ !=Â nullÂ &amp;&amp;Â provider.getActiveView()Â !=Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-attr">props</span>Â =Â _filteredProps<span class="hljs-comment">;</span>
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â <span class="hljs-attr">props</span>Â =Â _props<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">;</span>
Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â //Â éå†æ‰€æœ‰å­—æ®µè¿›è¡Œåºåˆ—åŒ–
Â Â Â Â Â Â Â Â forÂ (finalÂ intÂ <span class="hljs-attr">len</span>Â =Â props.length<span class="hljs-comment">;Â iÂ &lt;Â len;Â ++i)Â {</span>
Â Â Â Â Â Â Â Â Â Â Â Â BeanPropertyWriterÂ <span class="hljs-attr">prop</span>Â =Â props[i]<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (propÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â prop.serializeAsField(bean,Â gen,Â provider)<span class="hljs-comment">;Â Â //Â å…³é”®è°ƒç”¨</span>
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â //Â ...Â çœç•¥å…¶ä»–ä»£ç 
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-10">2. BeanPropertyWriter - å­—æ®µåºåˆ—åŒ–å¤„ç†</h4>
<p>æ¯ä¸ªå­—æ®µä¼šè°ƒç”¨ <code>serializeAsField</code> æ–¹æ³•ï¼Œæ ¹æ®å­—æ®µç±»å‹é€‰æ‹©å¯¹åº”çš„åºåˆ—åŒ–å™¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">publicÂ voidÂ serializeAsField(ObjectÂ bean,Â JsonGeneratorÂ gen,Â SerializerProviderÂ prov)
Â Â Â Â Â Â Â Â throwsÂ ExceptionÂ {
Â Â Â Â //Â è·å–å­—æ®µå€¼
Â Â Â Â finalÂ ObjectÂ <span class="hljs-attr">value</span>Â =Â (_accessorMethodÂ ==Â null)
Â Â Â Â Â Â Â Â ?Â _field.get(bean)
Â Â Â Â Â Â Â Â :Â _accessorMethod.invoke(bean,Â (Object<span class="hljs-section">[]</span>)Â null)<span class="hljs-comment">;</span>

Â Â Â Â //Â å¤„ç†Â nullÂ å€¼
Â Â Â Â ifÂ (<span class="hljs-attr">value</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â ifÂ (_nullSerializerÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â gen.writeFieldName(_name)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â _nullSerializer.serialize(null,Â gen,Â prov)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â return<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â //Â è·å–åºåˆ—åŒ–å™¨ï¼ˆå…³é”®ï¼šæ ¹æ®å­—æ®µç±»å‹é€‰æ‹©ä¸åŒçš„åºåˆ—åŒ–å™¨ï¼‰
Â Â Â Â JsonSerializer&lt;Object&gt;Â <span class="hljs-attr">ser</span>Â =Â _serializer<span class="hljs-comment">;</span>
Â Â Â Â ifÂ (<span class="hljs-attr">ser</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â Class&lt;?&gt;Â <span class="hljs-attr">cls</span>Â =Â value.getClass()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â PropertySerializerMapÂ <span class="hljs-attr">m</span>Â =Â _dynamicSerializers<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â <span class="hljs-attr">ser</span>Â =Â m.serializerFor(cls)<span class="hljs-comment">;Â Â //Â StringÂ ç±»å‹ä¼šè¿”å›Â StringSerializer</span>
Â Â Â Â Â Â Â Â ifÂ (<span class="hljs-attr">ser</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">ser</span>Â =Â _findAndAddDynamic(m,Â cls,Â prov)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â //Â å†™å…¥å­—æ®µåå’Œå€¼
Â Â Â Â gen.writeFieldName(_name)<span class="hljs-comment">;</span>
Â Â Â Â ser.serialize(value,Â gen,Â prov)<span class="hljs-comment">;Â Â //Â è°ƒç”¨å…·ä½“çš„åºåˆ—åŒ–å™¨</span>
}
</code></pre>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p>
<ul>
<li>å¦‚æœå­—æ®µæ˜¯å¯¹è±¡ï¼Œä¼šé€’å½’è°ƒç”¨ <code>BeanSerializer</code></li>
<li>å¦‚æœå­—æ®µæ˜¯å­—ç¬¦ä¸²ï¼Œä¼šè°ƒç”¨ <code>StringSerializer</code></li>
</ul>
<h4 data-id="heading-11">3. StringSerializer</h4>
<p>å½“å­—æ®µç±»å‹æ˜¯ <code>String</code> æ—¶ï¼Œä½¿ç”¨ <code>StringSerializer</code> è¿›è¡Œåºåˆ—åŒ–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">serialize</span><span class="hljs-params">(ObjectÂ value,Â JsonGeneratorÂ gen,Â SerializerProviderÂ provider)</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">throws</span>Â IOExceptionÂ {
Â Â Â Â gen.writeString((String)Â value);Â Â <span class="hljs-comment">//Â è°ƒç”¨Â JsonGeneratorÂ å†™å…¥å­—ç¬¦ä¸²</span>
}
</code></pre>
<h4 data-id="heading-12">4. UTF8JsonGenerator</h4>
<p>ç”±äºé»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ <code>UTF8JsonGenerator.writeString</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span>Â voidÂ writeString(StringÂ text)Â throwsÂ IOExceptionÂ {
Â Â Â Â <span class="hljs-keyword">this</span>._verifyValueWrite(<span class="hljs-string">"writeÂ aÂ string"</span>);
Â Â Â Â <span class="hljs-keyword">if</span>Â (textÂ ==Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._writeNull();
Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â Â Â intÂ lenÂ =Â text.length();
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (lenÂ &gt;Â <span class="hljs-keyword">this</span>._outputMaxContiguous)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._writeStringSegments(text,Â <span class="hljs-literal">true</span>);
Â Â Â Â Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-keyword">this</span>._outputTailÂ +Â lenÂ &gt;=Â <span class="hljs-keyword">this</span>._outputEnd)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._flushBuffer();
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ·»åŠ å¼€å§‹å¼•å·</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._outputBuffer[<span class="hljs-keyword">this</span>._outputTail++]Â =Â <span class="hljs-keyword">this</span>._quoteChar;

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å†™å…¥å­—ç¬¦ä¸²å†…å®¹ï¼ˆè¿™é‡Œä¼šå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼ï¼‰</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._writeStringSegment((String)text,Â <span class="hljs-number">0</span>,Â len);

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-keyword">this</span>._outputTailÂ &gt;=Â <span class="hljs-keyword">this</span>._outputEnd)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._flushBuffer();
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ·»åŠ ç»“æŸå¼•å·</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._outputBuffer[<span class="hljs-keyword">this</span>._outputTail++]Â =Â <span class="hljs-keyword">this</span>._quoteChar;
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š<code>_writeStringSegment</code> æ–¹æ³•ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ <code>"</code>ã€``ã€æ¢è¡Œç¬¦ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚</p>
<h3 data-id="heading-13">è½¬ä¹‰ç¤ºä¾‹å¯¹æ¯”</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b702a100de444dfaa7164c85df8612e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgOeWPt-i-vuS6ug==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766204792&amp;x-signature=UNxR7zkOHVHIvq4YSqd7j9C4Siw%3D" alt="" loading="lazy"/> åºåˆ—åŒ–ä¹‹åå°±å¤šäº†ä¸€å±‚è½¬ä¹‰ç¬¦å·</p>
<h3 data-id="heading-14">ä¸»è¦çš„è°ƒç”¨é“¾è·¯</h3>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡åºåˆ—åŒ–
Â Â â†“
BeanSerializerBase<span class="hljs-selector-class">.serializeFields</span>()Â Â <span class="hljs-comment">//Â éå†å¯¹è±¡å­—æ®µ</span>
Â Â â†“
BeanPropertyWriter<span class="hljs-selector-class">.serializeAsField</span>()Â Â <span class="hljs-comment">//Â å¤„ç†å•ä¸ªå­—æ®µ</span>
Â Â â†“
StringSerializer<span class="hljs-selector-class">.serialize</span>()Â Â <span class="hljs-comment">//Â StringÂ ç±»å‹èµ°è¿™é‡Œ</span>
Â Â â†“
UTF8JsonGenerator<span class="hljs-selector-class">.writeString</span>()Â Â <span class="hljs-comment">//Â æ‰§è¡Œè½¬ä¹‰</span>
Â Â â†“
<span class="hljs-built_in">_writeStringSegment</span>()Â Â <span class="hljs-comment">//Â è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼ˆ"Â â†’Â "ï¼‰</span>
</code></pre>
<p>ç†è§£äº†è¿™ä¸ªè°ƒç”¨é“¾è·¯ï¼Œå°±èƒ½æ˜ç™½ä¸ºä»€ä¹ˆ JSON å­—ç¬¦ä¸²åœ¨åºåˆ—åŒ–æ—¶ä¼šäº§ç”Ÿè½¬ä¹‰å­—ç¬¦ï¼Œä»¥åŠä¸ºä»€ä¹ˆå¤šæ¬¡åºåˆ—åŒ–ä¼šå¯¼è‡´å¤šå±‚è½¬ä¹‰ã€‚</p>
<h2 data-id="heading-15">æ€»ç»“</h2>
<ol>
<li><strong>å°½é‡é¿å…åœ¨å¯¹è±¡ä¸­åµŒå¥— JSON å­—ç¬¦ä¸²</strong>ï¼Œåº”è¯¥ä½¿ç”¨å¼ºç±»å‹å¯¹è±¡ï¼Œé¿å…å¤šæ¬¡åºåˆ—åŒ–å¸¦æ¥çš„è½¬ä¹‰é—®é¢˜</li>
<li><strong>HTTP ä¼ è¾“ä¸ä¼šç¯¡æ”¹æ•°æ®</strong>ï¼Œé—®é¢˜å¾€å¾€å‡ºåœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–ç¯èŠ‚</li>
<li><strong>ç†è§£åºåˆ—åŒ–çš„æœ¬è´¨</strong>ï¼šæ¯åºåˆ—åŒ–ä¸€æ¬¡ï¼ŒJSON å­—ç¬¦ä¸²å°±ä¼šå¤šä¸€å±‚è½¬ä¹‰</li>
<li><strong>é‡åˆ°éªŒç­¾é—®é¢˜</strong>ï¼Œä¼˜å…ˆæ£€æŸ¥åŒæ–¹å¤„ç†æ•°æ®æ—¶ç»å†äº†å‡ æ¬¡åºåˆ—åŒ–</li>
</ol>
<p>éªŒç­¾è™½ç„¶å¥½ï¼Œä½†æœ‰æ—¶å€™ä¹ŸæŒºéº»çƒ¦çš„ã€‚æ‰€ä»¥ç†è§£æ•°æ®åœ¨å‰åç«¯ä¹‹é—´çš„æµè½¬è¿‡ç¨‹å’Œåºåˆ—åŒ–æ—¶æœºï¼Œå¯ä»¥æ›´å¥½é¿å…è¿™æ ·çš„éªŒç­¾é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å¸¸ç”¨æ¨¡å¼ï¼šæå‡ä»£ç è´¨é‡çš„å››å¤§æ ¸å¿ƒæ¨¡å¼]]></title>    <link>https://juejin.cn/post/7583139562735190059</link>    <guid>https://juejin.cn/post/7583139562735190059</guid>    <pubDate>2025-12-13T05:00:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583139562735190059" data-draft-id="7582787460419321898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å¸¸ç”¨æ¨¡å¼ï¼šæå‡ä»£ç è´¨é‡çš„å››å¤§æ ¸å¿ƒæ¨¡å¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2025-12-13T05:00:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024è‚¥å®…"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å¸¸ç”¨æ¨¡å¼ï¼šæå‡ä»£ç è´¨é‡çš„å››å¤§æ ¸å¿ƒæ¨¡å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024è‚¥å®…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T05:00:57.000Z" title="Sat Dec 13 2025 05:00:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">å¼•è¨€</h4>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œéšç€åº”ç”¨å¤æ‚åº¦ä¸æ–­å¢åŠ ï¼Œä»£ç çš„ç»„ç»‡å’Œç®¡ç†å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å‰ç«¯å¼€å‘ä¸­å››ç§æå…¶æœ‰ç”¨çš„æ¨¡å¼ï¼šä¸­é—´ä»¶æ¨¡å¼ã€ç®¡é“æ¨¡å¼ã€é“¾å¼è°ƒç”¨å’Œæƒ°æ€§åŠ è½½ã€‚è¿™äº›æ¨¡å¼ä¸ä»…èƒ½æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¿˜èƒ½æ˜¾è‘—ä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚</p>
<h4 data-id="heading-1">ä¸€ã€ä¸­é—´ä»¶æ¨¡å¼ï¼ˆMiddleware Patternï¼‰</h4>
<p>ä¸­é—´ä»¶æ¨¡å¼å…è®¸æˆ‘ä»¬åœ¨è¯·æ±‚å’Œå“åº”çš„å¤„ç†æµç¨‹ä¸­æ’å…¥å¤šä¸ªå¤„ç†é˜¶æ®µ, è¿™ç§æ¨¡å¼åœ¨Node.jsæ¡†æ¶(ä¾‹å¦‚Koaã€Express)ä¸­å¹¿æ³›åº”ç”¨, ä½†åœ¨å‰ç«¯åŒæ ·æœ‰å…¶ç”¨æ­¦ä¹‹åœ°ã€‚</p>
<h5 data-id="heading-2">1.1 æ ¸å¿ƒæ¦‚å¿µ</h5>
<p>ä¸­é—´ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°, å®ƒå¯ä»¥:</p>
<ul>
<li>è®¿é—®è¯·æ±‚(request)å’Œå“åº”(response)å¯¹è±¡</li>
<li>æ‰§è¡Œä»»ä½•ä»£ç </li>
<li>ä¿®æ”¹è¯·æ±‚å’Œå“åº”å¯¹è±¡</li>
<li>ç»“æŸè¯·æ±‚-å“åº”å‘¨æœŸ</li>
<li>è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</li>
</ul>
<h5 data-id="heading-3">1.2 åŸºç¡€å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€å•ä¸­é—´ä»¶ç³»ç»Ÿå®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MiddlewareSystem</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> = {};
  }

  <span class="hljs-comment">// æ·»åŠ ä¸­é—´ä»¶</span>
  <span class="hljs-title function_">use</span>(<span class="hljs-params">middleware</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> middleware !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Middleware must be a function'</span>);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">push</span>(middleware);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// æ”¯æŒé“¾å¼è°ƒç”¨</span>
  }

  <span class="hljs-comment">// æ‰§è¡Œä¸­é—´ä»¶</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">input</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> = { ...input };
    
    <span class="hljs-comment">// åˆ›å»ºnextå‡½æ•°</span>
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> middleware = <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>[index++];
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, next);
      }
    };
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Middleware execution error:'</span>, error);
      <span class="hljs-keyword">throw</span> error;
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> system = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiddlewareSystem</span>();

<span class="hljs-comment">// æ·»åŠ ä¸­é—´ä»¶</span>
system
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 1: Start'</span>);
    ctx.<span class="hljs-property">timestamp</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 1: End'</span>);
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 2: Start'</span>);
    ctx.<span class="hljs-property">user</span> = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> };
    <span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 2: End'</span>);
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 3: Start'</span>);
    ctx.<span class="hljs-property">data</span> = { <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello World'</span> };
    <span class="hljs-comment">// ä¸å†è°ƒç”¨next()ï¼Œç»“æŸæ‰§è¡Œ</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 3: End (no next call)'</span>);
  });

<span class="hljs-comment">// è¿è¡Œä¸­é—´ä»¶</span>
system.<span class="hljs-title function_">run</span>({ <span class="hljs-attr">requestId</span>: <span class="hljs-string">'123'</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Final context:'</span>, result);
});
</code></pre>
<h5 data-id="heading-4">1.3 é”™è¯¯å¤„ç†ä¸­é—´ä»¶</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorHandlingMiddleware</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMiddlewares</span> = [];
  }

  <span class="hljs-title function_">use</span>(<span class="hljs-params">middleware</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">push</span>(middleware);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">useError</span>(<span class="hljs-params">errorMiddleware</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMiddlewares</span>.<span class="hljs-title function_">push</span>(errorMiddleware);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">input</span>) {
    <span class="hljs-keyword">const</span> context = { ...input };
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> errorIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> error = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">err</span>) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        error = err;
        errorIndex = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextError</span>();
      }

      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> middleware = <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>[index++];
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">middleware</span>(context, next);
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>(err);
        }
      }
    };

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">nextError</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (errorIndex &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMiddlewares</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> errorMiddleware = <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMiddlewares</span>[errorIndex++];
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">errorMiddleware</span>(error, context, nextError);
        } <span class="hljs-keyword">catch</span> (err) {
          error = err;
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextError</span>();
        }
      }
    };

    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-keyword">return</span> { context, error };
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> errorSystem = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorHandlingMiddleware</span>();

errorSystem
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Processing...'</span>);
    <span class="hljs-comment">// æ¨¡æ‹Ÿé”™è¯¯</span>
    <span class="hljs-keyword">if</span> (!ctx.<span class="hljs-property">user</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'User not found'</span>);
    }
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  })
  .<span class="hljs-title function_">useError</span>(<span class="hljs-keyword">async</span> (err, ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error caught:'</span>, err.<span class="hljs-property">message</span>);
    ctx.<span class="hljs-property">error</span> = err.<span class="hljs-property">message</span>;
    ctx.<span class="hljs-property">status</span> = <span class="hljs-string">'error'</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  });

errorSystem.<span class="hljs-title function_">run</span>({}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Result with error handling:'</span>, result);
});
</code></pre>
<h5 data-id="heading-5">1.4 å‰ç«¯åº”ç”¨åœºæ™¯</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯è¯·æ±‚æ‹¦æˆªä¸­é—´ä»¶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestInterceptor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultConfig</span> = {
      <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
      <span class="hljs-attr">headers</span>: {}
    };
  }

  <span class="hljs-title function_">use</span>(<span class="hljs-params">interceptor</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span>.<span class="hljs-title function_">push</span>(interceptor);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">url, config = {}</span>) {
    <span class="hljs-keyword">const</span> context = {
      url,
      <span class="hljs-attr">config</span>: { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultConfig</span>, ...config },
      <span class="hljs-attr">response</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>
    };

    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> interceptor = <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span>[index++];
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">interceptor</span>(context, next);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ‰§è¡Œå®é™…è¯·æ±‚</span>
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeRequest</span>(context);
      }
    };

    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-keyword">return</span> context;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeRequest</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(context.<span class="hljs-property">url</span>, context.<span class="hljs-property">config</span>);
      context.<span class="hljs-property">response</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    } <span class="hljs-keyword">catch</span> (error) {
      context.<span class="hljs-property">error</span> = error;
    }
  }
}

<span class="hljs-comment">// åˆ›å»ºè¯·æ±‚æ‹¦æˆªå™¨</span>
<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestInterceptor</span>();

api
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Auth interceptor'</span>);
    ctx.<span class="hljs-property">config</span>.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-variable language_">localStorage</span>.getItem(<span class="hljs-string">'token'</span>)}</span>`</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Logging interceptor'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request to <span class="hljs-subst">${ctx.url}</span>`</span>, ctx.<span class="hljs-property">config</span>);
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request completed in <span class="hljs-subst">${duration}</span>ms`</span>);
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Cache interceptor'</span>);
    <span class="hljs-keyword">const</span> cacheKey = <span class="hljs-string">`cache_<span class="hljs-subst">${ctx.url}</span>`</span>;
    <span class="hljs-keyword">const</span> cached = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(cacheKey);
    
    <span class="hljs-keyword">if</span> (cached &amp;&amp; !ctx.<span class="hljs-property">config</span>.<span class="hljs-property">noCache</span>) {
      ctx.<span class="hljs-property">response</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(cached);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Using cached response'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
      <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">response</span> &amp;&amp; !ctx.<span class="hljs-property">error</span>) {
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(cacheKey, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(ctx.<span class="hljs-property">response</span>));
      }
    }
  });

<span class="hljs-comment">// ä½¿ç”¨æ‹¦æˆªå™¨</span>
api.<span class="hljs-title function_">request</span>(<span class="hljs-string">'https://api.example.com/data'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span> })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Response:'</span>, result.<span class="hljs-property">response</span>));
</code></pre>
<h4 data-id="heading-6">äºŒã€ç®¡é“æ¨¡å¼ï¼ˆPipeline Patternï¼‰</h4>
<p>ç®¡é“æ¨¡å¼å°†å¤šä¸ªå¤„ç†å‡½æ•°è¿æ¥èµ·æ¥, æ•°æ®åƒæµæ°´ä¸€æ ·ç»è¿‡è¿™äº›å‡½æ•°è¿›è¡Œå¤„ç†å’Œè½¬æ¢ã€‚</p>
<h5 data-id="heading-7">2.1 åŸºæœ¬å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŒæ­¥ç®¡é“</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">pipeline</span> = (<span class="hljs-params">...fns</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">initialValue</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> fns.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">value, fn</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Pipeline expects functions, got <span class="hljs-subst">${<span class="hljs-keyword">typeof</span> fn}</span>`</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(value);
  }, initialValue);
};

<span class="hljs-comment">// å¼‚æ­¥ç®¡é“</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">asyncPipeline</span> = (<span class="hljs-params">...fns</span>) =&gt; <span class="hljs-keyword">async</span> (initialValue) =&gt; {
  <span class="hljs-keyword">let</span> result = initialValue;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> fn <span class="hljs-keyword">of</span> fns) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Pipeline expects functions, got <span class="hljs-subst">${<span class="hljs-keyword">typeof</span> fn}</span>`</span>);
    }
    result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(result);
  }
  <span class="hljs-keyword">return</span> result;
};

<span class="hljs-comment">// å¯ä¸­æ–­çš„ç®¡é“</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">breakablePipeline</span> = (<span class="hljs-params">...fns</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">initialValue</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> shouldBreak = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">let</span> breakValue = <span class="hljs-literal">null</span>;
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">breakFn</span> = (<span class="hljs-params">value</span>) =&gt; {
    shouldBreak = <span class="hljs-literal">true</span>;
    breakValue = value;
  };
  
  <span class="hljs-keyword">const</span> result = fns.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">value, fn</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (shouldBreak) <span class="hljs-keyword">return</span> breakValue;
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(value, breakFn);
  }, initialValue);
  
  <span class="hljs-keyword">return</span> shouldBreak ? breakValue : result;
};
</code></pre>
<h5 data-id="heading-8">2.2 æ•°æ®å¤„ç†ç®¡é“ç¤ºä¾‹</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ•°æ®æ¸…æ´—ç®¡é“</span>
<span class="hljs-keyword">const</span> dataCleaningPipeline = <span class="hljs-title function_">pipeline</span>(
  <span class="hljs-comment">// 1. ç§»é™¤ç©ºå€¼</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item != <span class="hljs-literal">null</span>),
  
  <span class="hljs-comment">// 2. æ ‡å‡†åŒ–å­—æ®µ</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
    ...item,
    <span class="hljs-attr">name</span>: item.<span class="hljs-property">name</span>?.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">toLowerCase</span>() || <span class="hljs-string">'unknown'</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-title class_">Number</span>(item.<span class="hljs-property">value</span>) || <span class="hljs-number">0</span>
  })),
  
  <span class="hljs-comment">// 3. å»é‡</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> key = <span class="hljs-string">`<span class="hljs-subst">${item.name}</span>-<span class="hljs-subst">${item.value}</span>`</span>;
      <span class="hljs-keyword">if</span> (seen.<span class="hljs-title function_">has</span>(key)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      seen.<span class="hljs-title function_">add</span>(key);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
  },
  
  <span class="hljs-comment">// 4. æ’åº</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.<span class="hljs-property">value</span> - a.<span class="hljs-property">value</span>),
  
  <span class="hljs-comment">// 5. é™åˆ¶æ•°é‡</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)
);

<span class="hljs-comment">// ä½¿ç”¨ç®¡é“</span>
<span class="hljs-keyword">const</span> rawData = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'  John  '</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'100'</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Jane'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">200</span> },
  <span class="hljs-literal">null</span>,
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'100'</span> }, <span class="hljs-comment">// é‡å¤</span>
  { <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'invalid'</span> }
];

<span class="hljs-keyword">const</span> cleanedData = <span class="hljs-title function_">dataCleaningPipeline</span>(rawData);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Cleaned data:'</span>, cleanedData);
</code></pre>
<h5 data-id="heading-9">2.3 è¡¨å•éªŒè¯ç®¡é“</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éªŒè¯è§„åˆ™</span>
<span class="hljs-keyword">const</span> validators = {
  <span class="hljs-attr">required</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: value != <span class="hljs-literal">null</span> &amp;&amp; value.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'This field is required'</span>
  }),
  
  <span class="hljs-attr">minLength</span>: <span class="hljs-function">(<span class="hljs-params">min</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: value?.<span class="hljs-title function_">toString</span>().<span class="hljs-property">length</span> &gt;= min,
    <span class="hljs-attr">message</span>: <span class="hljs-string">`Minimum length is <span class="hljs-subst">${min}</span> characters`</span>
  }),
  
  <span class="hljs-attr">maxLength</span>: <span class="hljs-function">(<span class="hljs-params">max</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: value?.<span class="hljs-title function_">toString</span>().<span class="hljs-property">length</span> &lt;= max,
    <span class="hljs-attr">message</span>: <span class="hljs-string">`Maximum length is <span class="hljs-subst">${max}</span> characters`</span>
  }),
  
  <span class="hljs-attr">email</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.<span class="hljs-title function_">test</span>(value),
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Invalid email format'</span>
  }),
  
  <span class="hljs-attr">numeric</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">parseFloat</span>(value)) &amp;&amp; <span class="hljs-built_in">isFinite</span>(value),
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Must be a number'</span>
  })
};

<span class="hljs-comment">// è¡¨å•éªŒè¯ç®¡é“</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FormValidator</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">rules</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span> = rules;
  }

  <span class="hljs-title function_">validate</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> errors = {};
    <span class="hljs-keyword">const</span> results = {};

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [field, fieldRules] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>)) {
      <span class="hljs-keyword">const</span> value = data[field];
      <span class="hljs-keyword">const</span> fieldErrors = [];

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rule <span class="hljs-keyword">of</span> fieldRules) {
        <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">rule</span>(value);
        <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">isValid</span>) {
          fieldErrors.<span class="hljs-title function_">push</span>(result.<span class="hljs-property">message</span>);
        }
      }

      <span class="hljs-keyword">if</span> (fieldErrors.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        errors[field] = fieldErrors;
      } <span class="hljs-keyword">else</span> {
        results[field] = value;
      }
    }

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">isValid</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(errors).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>,
      errors,
      results
    };
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> registrationRules = {
  <span class="hljs-attr">username</span>: [
    validators.<span class="hljs-property">required</span>,
    validators.<span class="hljs-title function_">minLength</span>(<span class="hljs-number">3</span>),
    validators.<span class="hljs-title function_">maxLength</span>(<span class="hljs-number">20</span>)
  ],
  <span class="hljs-attr">email</span>: [
    validators.<span class="hljs-property">required</span>,
    validators.<span class="hljs-property">email</span>
  ],
  <span class="hljs-attr">age</span>: [
    validators.<span class="hljs-property">required</span>,
    validators.<span class="hljs-property">numeric</span>,
    <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
      <span class="hljs-attr">isValid</span>: value &gt;= <span class="hljs-number">18</span> &amp;&amp; value &lt;= <span class="hljs-number">100</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'Age must be between 18 and 100'</span>
    })
  ]
};

<span class="hljs-keyword">const</span> validator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormValidator</span>(registrationRules);
<span class="hljs-keyword">const</span> userData = {
  <span class="hljs-attr">username</span>: <span class="hljs-string">'johndoe'</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
};

<span class="hljs-keyword">const</span> validationResult = validator.<span class="hljs-title function_">validate</span>(userData);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Validation result:'</span>, validationResult);
</code></pre>
<h4 data-id="heading-10">ä¸‰ã€é“¾å¼è°ƒç”¨ï¼ˆChaining Patternï¼‰</h4>
<p>é“¾å¼è°ƒç”¨é€šè¿‡è¿”å›å¯¹è±¡å®ä¾‹æœ¬èº«(<code>this</code>), å…è®¸è¿ç»­è°ƒç”¨å¤šä¸ªæ–¹æ³•, ä½¿ä»£ç æ›´åŠ æµç•…æ˜“è¯»ã€‚</p>
<h5 data-id="heading-11">3.1 åŸºç¡€é“¾å¼è°ƒç”¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// jQueryé£æ ¼çš„é“¾å¼è°ƒç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryBuilder</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = {
      <span class="hljs-attr">select</span>: [],
      <span class="hljs-attr">from</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">where</span>: [],
      <span class="hljs-attr">orderBy</span>: [],
      <span class="hljs-attr">limit</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">offset</span>: <span class="hljs-literal">null</span>
    };
  }

  <span class="hljs-title function_">select</span>(<span class="hljs-params">...fields</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">select</span>.<span class="hljs-title function_">push</span>(...fields);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">from</span>(<span class="hljs-params">table</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">from</span> = table;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">where</span>(<span class="hljs-params">condition</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">where</span>.<span class="hljs-title function_">push</span>(condition);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">orderBy</span>(<span class="hljs-params">field, direction = <span class="hljs-string">'ASC'</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">orderBy</span>.<span class="hljs-title function_">push</span>({ field, direction });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">limit</span>(<span class="hljs-params">count</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span> = count;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">offset</span>(<span class="hljs-params">count</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">offset</span> = count;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> { select, <span class="hljs-keyword">from</span>, where, orderBy, limit, offset } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>;
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">from</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'FROM clause is required'</span>);
    }

    <span class="hljs-keyword">let</span> sql = <span class="hljs-string">`SELECT <span class="hljs-subst">${select.length &gt; <span class="hljs-number">0</span> ? select.join(<span class="hljs-string">', '</span>) : <span class="hljs-string">'*'</span>}</span> FROM <span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span>`</span>;
    
    <span class="hljs-keyword">if</span> (where.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      sql += <span class="hljs-string">` WHERE <span class="hljs-subst">${where.join(<span class="hljs-string">' AND '</span>)}</span>`</span>;
    }
    
    <span class="hljs-keyword">if</span> (orderBy.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> orderClauses = orderBy.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">{ field, direction }</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${field}</span> <span class="hljs-subst">${direction}</span>`</span>);
      sql += <span class="hljs-string">` ORDER BY <span class="hljs-subst">${orderClauses.join(<span class="hljs-string">', '</span>)}</span>`</span>;
    }
    
    <span class="hljs-keyword">if</span> (limit !== <span class="hljs-literal">null</span>) {
      sql += <span class="hljs-string">` LIMIT <span class="hljs-subst">${limit}</span>`</span>;
    }
    
    <span class="hljs-keyword">if</span> (offset !== <span class="hljs-literal">null</span>) {
      sql += <span class="hljs-string">` OFFSET <span class="hljs-subst">${offset}</span>`</span>;
    }
    
    <span class="hljs-keyword">return</span> sql + <span class="hljs-string">';'</span>;
  }

  <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = {
      <span class="hljs-attr">select</span>: [],
      <span class="hljs-attr">from</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">where</span>: [],
      <span class="hljs-attr">orderBy</span>: [],
      <span class="hljs-attr">limit</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">offset</span>: <span class="hljs-literal">null</span>
    };
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> sql = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryBuilder</span>()
  .<span class="hljs-title function_">select</span>(<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>)
  .<span class="hljs-title function_">from</span>(<span class="hljs-string">'users'</span>)
  .<span class="hljs-title function_">where</span>(<span class="hljs-string">'active = true'</span>)
  .<span class="hljs-title function_">where</span>(<span class="hljs-string">'age &gt;= 18'</span>)
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'ASC'</span>)
  .<span class="hljs-title function_">limit</span>(<span class="hljs-number">10</span>)
  .<span class="hljs-title function_">offset</span>(<span class="hljs-number">0</span>)
  .<span class="hljs-title function_">build</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Generated SQL:'</span>, sql);
</code></pre>
<h5 data-id="heading-12">3.2 DOMæ“ä½œé“¾å¼è°ƒç”¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DOMElement</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">selector</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> selector === <span class="hljs-string">'string'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span> = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(selector));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (selector <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Element</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span> = [selector];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(selector)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span> = selector;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span> = [];
    }
  }

  <span class="hljs-comment">// CSSç›¸å…³æ–¹æ³•</span>
  <span class="hljs-title function_">css</span>(<span class="hljs-params">property, value</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> property === <span class="hljs-string">'object'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(el.<span class="hljs-property">style</span>, property);
      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        el.<span class="hljs-property">style</span>[property] = value;
      });
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">addClass</span>(<span class="hljs-params">className</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(className);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">removeClass</span>(<span class="hljs-params">className</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(className);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">toggleClass</span>(<span class="hljs-params">className</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(className);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// å†…å®¹æ“ä½œ</span>
  <span class="hljs-title function_">text</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">if</span> (content !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        el.<span class="hljs-property">textContent</span> = content;
      });
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">textContent</span> || <span class="hljs-string">''</span>;
  }

  <span class="hljs-title function_">html</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">if</span> (content !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        el.<span class="hljs-property">innerHTML</span> = content;
      });
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">innerHTML</span> || <span class="hljs-string">''</span>;
  }

  <span class="hljs-comment">// å±æ€§æ“ä½œ</span>
  <span class="hljs-title function_">attr</span>(<span class="hljs-params">name, value</span>) {
    <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        el.<span class="hljs-title function_">setAttribute</span>(name, value);
      });
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>[<span class="hljs-number">0</span>]?.<span class="hljs-title function_">getAttribute</span>(name) || <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">// äº‹ä»¶å¤„ç†</span>
  <span class="hljs-title function_">on</span>(<span class="hljs-params">event, handler, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-title function_">addEventListener</span>(event, handler, options);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">off</span>(<span class="hljs-params">event, handler, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-title function_">removeEventListener</span>(event, handler, options);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// éå†</span>
  <span class="hljs-title function_">each</span>(<span class="hljs-params">callback</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">el, index</span>) =&gt;</span> {
      callback.<span class="hljs-title function_">call</span>(el, index, el);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æŸ¥æ‰¾å­å…ƒç´ </span>
  <span class="hljs-title function_">find</span>(<span class="hljs-params">selector</span>) {
    <span class="hljs-keyword">const</span> found = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      found.<span class="hljs-title function_">push</span>(...<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(el.<span class="hljs-title function_">querySelectorAll</span>(selector)));
    });
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMElement</span>(found);
  }

  <span class="hljs-comment">// è·å–çˆ¶å…ƒç´ </span>
  <span class="hljs-title function_">parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> parents = <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> el.<span class="hljs-property">parentElement</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMElement</span>(parents.<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>));
  }

  <span class="hljs-comment">// æ˜¾ç¤º/éšè—</span>
  <span class="hljs-title function_">show</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'display'</span>, <span class="hljs-string">''</span>);
  }

  <span class="hljs-title function_">hide</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>);
  }

  <span class="hljs-comment">// åŠ¨ç”»</span>
  <span class="hljs-title function_">animate</span>(<span class="hljs-params">properties, duration = <span class="hljs-number">300</span>, easing = <span class="hljs-string">'ease'</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">`all <span class="hljs-subst">${duration}</span>ms <span class="hljs-subst">${easing}</span>`</span>;
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(el.<span class="hljs-property">style</span>, properties);
      
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        el.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">''</span>;
      }, duration);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-comment">// å‡è®¾HTMLä¸­æœ‰: &lt;div id="myDiv"&gt;Hello&lt;/div&gt;</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">$</span> = (<span class="hljs-params">selector</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMElement</span>(selector);

$(<span class="hljs-string">'#myDiv'</span>)
  .<span class="hljs-title function_">css</span>({
    <span class="hljs-attr">color</span>: <span class="hljs-string">'white'</span>,
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'blue'</span>,
    <span class="hljs-attr">padding</span>: <span class="hljs-string">'10px'</span>
  })
  .<span class="hljs-title function_">addClass</span>(<span class="hljs-string">'highlight'</span>)
  .<span class="hljs-title function_">text</span>(<span class="hljs-string">'Hello, World!'</span>)
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    $(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">toggleClass</span>(<span class="hljs-string">'active'</span>);
  })
  .<span class="hljs-title function_">animate</span>({
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.8</span>,
    <span class="hljs-attr">transform</span>: <span class="hljs-string">'scale(1.1)'</span>
  }, <span class="hljs-number">300</span>);
</code></pre>
<h5 data-id="heading-13">3.3 æ„å»ºå™¨æ¨¡å¼ä¸é“¾å¼è°ƒç”¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é…ç½®å¯¹è±¡æ„å»ºå™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationBuilder</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = {
      <span class="hljs-attr">api</span>: {},
      <span class="hljs-attr">ui</span>: {},
      <span class="hljs-attr">features</span>: {},
      <span class="hljs-attr">performance</span>: {}
    };
  }

  <span class="hljs-comment">// APIé…ç½®</span>
  <span class="hljs-title function_">withApi</span>(<span class="hljs-params">baseUrl</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">api</span>.<span class="hljs-property">baseUrl</span> = baseUrl;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withApiVersion</span>(<span class="hljs-params">version</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">api</span>.<span class="hljs-property">version</span> = version;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withTimeout</span>(<span class="hljs-params">ms</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">api</span>.<span class="hljs-property">timeout</span> = ms;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// UIé…ç½®</span>
  <span class="hljs-title function_">withTheme</span>(<span class="hljs-params">theme</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">ui</span>.<span class="hljs-property">theme</span> = theme;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withLanguage</span>(<span class="hljs-params">lang</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">ui</span>.<span class="hljs-property">language</span> = lang;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withDarkMode</span>(<span class="hljs-params">enabled</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">ui</span>.<span class="hljs-property">darkMode</span> = enabled;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// åŠŸèƒ½é…ç½®</span>
  <span class="hljs-title function_">enableFeature</span>(<span class="hljs-params">feature</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">features</span>[feature] = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">disableFeature</span>(<span class="hljs-params">feature</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">features</span>[feature] = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æ€§èƒ½é…ç½®</span>
  <span class="hljs-title function_">withCache</span>(<span class="hljs-params">enabled</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">cache</span> = enabled;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withLazyLoad</span>(<span class="hljs-params">enabled</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">lazyLoad</span> = enabled;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withCompression</span>(<span class="hljs-params">enabled</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">compression</span> = enabled;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æ„å»ºæ–¹æ³•</span>
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// éªŒè¯é…ç½®</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validate</span>();
    <span class="hljs-comment">// è¿”å›ä¸å¯å˜é…ç½®</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>)));
  }

  <span class="hljs-title function_">validate</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> { api } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>;
    <span class="hljs-keyword">if</span> (!api.<span class="hljs-property">baseUrl</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'API base URL is required'</span>);
    }
    <span class="hljs-keyword">if</span> (api.<span class="hljs-property">timeout</span> &amp;&amp; api.<span class="hljs-property">timeout</span> &lt; <span class="hljs-number">100</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Timeout must be at least 100ms'</span>);
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationBuilder</span>()
  .<span class="hljs-title function_">withApi</span>(<span class="hljs-string">'https://api.example.com'</span>)
  .<span class="hljs-title function_">withApiVersion</span>(<span class="hljs-string">'v1'</span>)
  .<span class="hljs-title function_">withTimeout</span>(<span class="hljs-number">5000</span>)
  .<span class="hljs-title function_">withTheme</span>(<span class="hljs-string">'dark'</span>)
  .<span class="hljs-title function_">withLanguage</span>(<span class="hljs-string">'en'</span>)
  .<span class="hljs-title function_">withDarkMode</span>(<span class="hljs-literal">true</span>)
  .<span class="hljs-title function_">enableFeature</span>(<span class="hljs-string">'analytics'</span>)
  .<span class="hljs-title function_">enableFeature</span>(<span class="hljs-string">'notifications'</span>)
  .<span class="hljs-title function_">disableFeature</span>(<span class="hljs-string">'debug'</span>)
  .<span class="hljs-title function_">withCache</span>(<span class="hljs-literal">true</span>)
  .<span class="hljs-title function_">withLazyLoad</span>(<span class="hljs-literal">true</span>)
  .<span class="hljs-title function_">build</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'App configuration:'</span>, config);
</code></pre>
<h4 data-id="heading-14">å››ã€æƒ°æ€§åŠ è½½/æ±‚å€¼ï¼ˆLazy Loading/Evaluationï¼‰</h4>
<p>æƒ°æ€§åŠ è½½å»¶è¿Ÿè®¡ç®—æˆ–åˆå§‹åŒ–, ç›´åˆ°çœŸæ­£éœ€è¦æ—¶æ‰æ‰§è¡Œ, å¯ä»¥æ˜¾è‘—æé«˜åº”ç”¨æ€§èƒ½ã€‚</p>
<h5 data-id="heading-15">4.1 æƒ°æ€§æ±‚å€¼å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æƒ°æ€§å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">lazy</span>(<span class="hljs-params">fn</span>) {
  <span class="hljs-keyword">let</span> result;
  <span class="hljs-keyword">let</span> evaluated = <span class="hljs-literal">false</span>;
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (!evaluated) {
      result = fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
      evaluated = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> result;
  };
}

<span class="hljs-comment">// æƒ°æ€§å±æ€§</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">lazyProperty</span>(<span class="hljs-params">target, propertyName, getter</span>) {
  <span class="hljs-keyword">let</span> value;
  <span class="hljs-keyword">let</span> evaluated = <span class="hljs-literal">false</span>;
  
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, propertyName, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (!evaluated) {
        value = getter.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>);
        evaluated = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">return</span> value;
    },
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
  });
}

<span class="hljs-comment">// æƒ°æ€§ç±»å±æ€§</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyClass</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span> = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">get</span> <span class="hljs-title function_">expensiveData</span>() {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span> === <span class="hljs-literal">null</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Computing expensive data...'</span>);
      <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeExpensiveData</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span>;
  }

  <span class="hljs-title function_">computeExpensiveData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å¤æ‚çš„è®¡ç®—é€»è¾‘</span>
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
      result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(i);
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Computed in <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now() - start}</span>ms`</span>);
    <span class="hljs-keyword">return</span> result;
  }

  <span class="hljs-comment">// é‡ç½®æƒ°æ€§å€¼</span>
  <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span> = <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<h5 data-id="heading-16">4.2 å›¾ç‰‡æ‡’åŠ è½½</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyImageLoader</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = {
      <span class="hljs-attr">root</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">rootMargin</span>: <span class="hljs-string">'0px'</span>,
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.1</span>,
      <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'</span>,
      ...options
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initObserver</span>();
  }

  <span class="hljs-title function_">initObserver</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'IntersectionObserver'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleIntersection</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>
      );
    }
  }

  <span class="hljs-title function_">registerImage</span>(<span class="hljs-params">imgElement, src</span>) {
    <span class="hljs-keyword">if</span> (!imgElement || !src) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// ä¿å­˜åŸå§‹src</span>
    <span class="hljs-keyword">const</span> originalSrc = imgElement.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-src'</span>) || src;
    imgElement.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-src'</span>, originalSrc);
    
    <span class="hljs-comment">// è®¾ç½®å ä½ç¬¦</span>
    imgElement.<span class="hljs-property">src</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">placeholder</span>;
    imgElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'lazy-load'</span>);
    
    <span class="hljs-comment">// æ·»åŠ åˆ°è§‚å¯Ÿåˆ—è¡¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-title function_">set</span>(imgElement, {
      <span class="hljs-attr">src</span>: originalSrc,
      <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>
    });
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>.<span class="hljs-title function_">observe</span>(imgElement);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// é™çº§æ–¹æ¡ˆï¼šç«‹å³åŠ è½½</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(imgElement);
    }
  }

  <span class="hljs-title function_">handleIntersection</span>(<span class="hljs-params">entries</span>) {
    entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
        <span class="hljs-keyword">const</span> img = entry.<span class="hljs-property">target</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(img);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>?.<span class="hljs-title function_">unobserve</span>(img);
      }
    });
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadImage</span>(<span class="hljs-params">imgElement</span>) {
    <span class="hljs-keyword">const</span> imageData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-title function_">get</span>(imgElement);
    <span class="hljs-keyword">if</span> (!imageData || imageData.<span class="hljs-property">loaded</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// é¢„åŠ è½½å›¾ç‰‡</span>
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">preloadImage</span>(imageData.<span class="hljs-property">src</span>);
      
      <span class="hljs-comment">// åº”ç”¨å®é™…å›¾ç‰‡</span>
      imgElement.<span class="hljs-property">src</span> = imageData.<span class="hljs-property">src</span>;
      imgElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'lazy-load'</span>);
      imgElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'lazy-loaded'</span>);
      
      imageData.<span class="hljs-property">loaded</span> = <span class="hljs-literal">true</span>;
      
      <span class="hljs-comment">// è§¦å‘åŠ è½½å®Œæˆäº‹ä»¶</span>
      imgElement.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'lazyload'</span>, {
        <span class="hljs-attr">detail</span>: { <span class="hljs-attr">src</span>: imageData.<span class="hljs-property">src</span> }
      }));
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load image:'</span>, imageData.<span class="hljs-property">src</span>, error);
      imgElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'lazy-error'</span>);
      
      imgElement.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'lazyloaderror'</span>, {
        <span class="hljs-attr">detail</span>: { <span class="hljs-attr">src</span>: imageData.<span class="hljs-property">src</span>, error }
      }));
    }
  }

  <span class="hljs-title function_">preloadImage</span>(<span class="hljs-params">src</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();
      img.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(img);
      img.<span class="hljs-property">onerror</span> = reject;
      img.<span class="hljs-property">src</span> = src;
    });
  }

  <span class="hljs-comment">// æ‰¹é‡æ³¨å†Œå›¾ç‰‡</span>
  <span class="hljs-title function_">registerAll</span>(<span class="hljs-params">selector = <span class="hljs-string">'img[data-src]'</span></span>) {
    <span class="hljs-keyword">const</span> images = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(selector);
    images.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> src = img.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-src'</span>);
      <span class="hljs-keyword">if</span> (src) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerImage</span>(img, src);
      }
    });
  }

  <span class="hljs-comment">// å¼ºåˆ¶åŠ è½½ç‰¹å®šå›¾ç‰‡</span>
  <span class="hljs-title function_">forceLoad</span>(<span class="hljs-params">imgElement</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(imgElement);
  }

  <span class="hljs-comment">// æ¸…ç†</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>?.<span class="hljs-title function_">disconnect</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-title function_">clear</span>();
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> lazyLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyImageLoader</span>({
    <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.5</span>,
    <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'/images/placeholder.png'</span>
  });
  
  <span class="hljs-comment">// æ³¨å†Œç°æœ‰å›¾ç‰‡</span>
  lazyLoader.<span class="hljs-title function_">registerAll</span>();
  
  <span class="hljs-comment">// åŠ¨æ€æ·»åŠ çš„å›¾ç‰‡</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'newImagesAdded'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> newImages = event.<span class="hljs-property">detail</span>.<span class="hljs-property">images</span>;
    newImages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
      lazyLoader.<span class="hljs-title function_">registerImage</span>(img, img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>);
    });
  });
  
  <span class="hljs-comment">// é¡µé¢ç¦»å¼€æ—¶æ¸…ç†</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-function">() =&gt;</span> {
    lazyLoader.<span class="hljs-title function_">destroy</span>();
  });
});
</code></pre>
<h5 data-id="heading-17">4.3 ç»„ä»¶æ‡’åŠ è½½(Vue/Reactç¤ºä¾‹)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Reactç»„ä»¶æ‡’åŠ è½½</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { <span class="hljs-title class_">Suspense</span>, lazy } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// æ‡’åŠ è½½ç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./ExpensiveComponent'</span>));

<span class="hljs-comment">// ä½¿ç”¨SuspenseåŒ…è£¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>My App<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// Vueç»„ä»¶æ‡’åŠ è½½</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">LazyComponent</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./ExpensiveComponent.vue'</span>);

<span class="hljs-comment">// è·¯ç”±é…ç½®ä¸­ä½¿ç”¨æ‡’åŠ è½½</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Dashboard.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/settings'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Settings.vue'</span>)
  }
];

<span class="hljs-comment">// è‡ªå®šä¹‰æ‡’åŠ è½½å°è£…</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createLazyLoader</span>(<span class="hljs-params">importFn, loadingComponent, errorComponent</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">component</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>
      };
    },
    
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> importFn();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">component</span> = <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span> || <span class="hljs-variable language_">module</span>;
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">error</span> = err;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load component:'</span>, err);
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
      }
    },
    
    <span class="hljs-title function_">render</span>(<span class="hljs-params">h</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> &amp;&amp; loadingComponent) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(loadingComponent);
      }
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">error</span> &amp;&amp; errorComponent) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(errorComponent, { <span class="hljs-attr">error</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">error</span> });
      }
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">component</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">component</span>);
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  };
}
</code></pre>
<h5 data-id="heading-18">4.4 æ•°æ®æ‡’åŠ è½½(æ— é™æ»šåŠ¨)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">InfiniteScroll</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = {
      <span class="hljs-attr">container</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>,
      <span class="hljs-attr">distance</span>: <span class="hljs-number">100</span>,
      <span class="hljs-attr">throttle</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">onLoadMore</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(),
      ...options
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span> = <span class="hljs-literal">null</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">container</span> === <span class="hljs-string">'string'</span> 
      ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">container</span>)
      : <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">container</span>;
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Container not found'</span>);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindEvents</span>();
  }

  <span class="hljs-title function_">bindEvents</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleScroll</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleScroll</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
  }

  <span class="hljs-title function_">handleScroll</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span>) {
      <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span>);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkPosition</span>();
    }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">throttle</span>);
  }

  <span class="hljs-title function_">checkPosition</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">scrollTop</span>;
    <span class="hljs-keyword">const</span> scrollHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">scrollHeight</span>;
    <span class="hljs-keyword">const</span> clientHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">clientHeight</span>;
    
    <span class="hljs-keyword">const</span> distanceToBottom = scrollHeight - (scrollTop + clientHeight);
    
    <span class="hljs-keyword">if</span> (distanceToBottom &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">distance</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadMore</span>();
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadMore</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'loadstart'</span>));
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-title function_">onLoadMore</span>();
      
      <span class="hljs-keyword">if</span> (result &amp;&amp; <span class="hljs-keyword">typeof</span> result.<span class="hljs-property">hasMore</span> === <span class="hljs-string">'boolean'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span> = result.<span class="hljs-property">hasMore</span>;
      }
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'load'</span>, { 
        <span class="hljs-attr">detail</span>: result 
      }));
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'error'</span>, { 
        <span class="hljs-attr">detail</span>: error 
      }));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load more data:'</span>, error);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'loadend'</span>));
      
      <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿˜éœ€è¦ç»§ç»­åŠ è½½ï¼ˆæ•°æ®å¯èƒ½æ²¡æœ‰å¡«æ»¡å±å¹•ï¼‰</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkPosition</span>(), <span class="hljs-number">100</span>);
      }
    }
  }

  <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘åŠ è½½</span>
  <span class="hljs-title function_">triggerLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadMore</span>();
  }

  <span class="hljs-comment">// é‡ç½®çŠ¶æ€</span>
  <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span> = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">// é”€æ¯</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleScroll</span>);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleScroll</span>);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span>) {
      <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span>);
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> infiniteScroll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfiniteScroll</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-string">'#scrollContainer'</span>,
  <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">throttle</span>: <span class="hljs-number">300</span>,
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onLoadMore</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ¨¡æ‹ŸAPIè°ƒç”¨</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/items?page=<span class="hljs-subst">${currentPage}</span>`</span>);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    
    <span class="hljs-comment">// æ¸²æŸ“æ–°æ•°æ®</span>
    <span class="hljs-title function_">renderItems</span>(data.<span class="hljs-property">items</span>);
    
    <span class="hljs-comment">// è¿”å›æ˜¯å¦æœ‰æ›´å¤šæ•°æ®</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">hasMore</span>: data.<span class="hljs-property">hasMore</span> };
  }
});

<span class="hljs-comment">// åŠ¨æ€æ›´æ–°é€‰é¡¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateInfiniteScroll</span>(<span class="hljs-params">options</span>) {
  infiniteScroll.<span class="hljs-property">options</span> = { ...infiniteScroll.<span class="hljs-property">options</span>, ...options };
}
</code></pre>
<h4 data-id="heading-19">äº”ã€æ¨¡å¼å¯¹æ¯”ä¸åº”ç”¨åœºæ™¯</h4>



































<table><thead><tr><th align="left">æ¨¡å¼</th><th align="left">ä¼˜ç‚¹</th><th align="left">ç¼ºç‚¹</th><th align="left">é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td align="left">ä¸­é—´ä»¶æ¨¡å¼</td><td align="left">è§£è€¦ã€å¯ç»„åˆã€æ˜“äºæµ‹è¯•</td><td align="left">å¯èƒ½å¢åŠ å¤æ‚æ€§ã€è°ƒè¯•å›°éš¾</td><td align="left">è¯·æ±‚å¤„ç†ã€æ•°æ®å¤„ç†ç®¡é“ã€æ’ä»¶ç³»ç»Ÿ</td></tr><tr><td align="left">ç®¡é“æ¨¡å¼</td><td align="left">æ¸…æ™°çš„æ•°æ®æµå‘ã€æ˜“äºæµ‹è¯•å’Œå¤ç”¨</td><td align="left">å¯èƒ½åˆ›å»ºå¤ªå¤šå°å‡½æ•°ã€é”™è¯¯å¤„ç†å¤æ‚</td><td align="left">æ•°æ®è½¬æ¢ã€éªŒè¯ã€æ¸…æ´—æµç¨‹</td></tr><tr><td align="left">é“¾å¼è°ƒç”¨</td><td align="left">ä»£ç æµç•…ã€æ˜“è¯»ã€å‡å°‘ä¸´æ—¶å˜é‡</td><td align="left">å¯èƒ½æ©ç›–é”™è¯¯æ¥æºã€è°ƒè¯•å›°éš¾</td><td align="left">æ„å»ºå™¨æ¨¡å¼ã€DOMæ“ä½œã€é…ç½®è®¾ç½®</td></tr><tr><td align="left">æƒ°æ€§åŠ è½½</td><td align="left">æé«˜æ€§èƒ½ã€‘å‡å°‘å†…å­˜ä½¿ç”¨</td><td align="left">åˆå§‹åŒ–å»¶è¿Ÿã€å¤æ‚æ€§å¢åŠ </td><td align="left">å›¾ç‰‡åŠ è½½ã€ç»„ä»¶åŠ è½½ã€æ•°æ®è®¡ç®—</td></tr></tbody></table>
<h5 data-id="heading-20">5.1 å¦‚ä½•é€‰æ‹©æ¨¡å¼?</h5>
<ol>
<li><strong>éœ€è¦å¤„ç†è¯·æ±‚/å“åº”æµç¨‹</strong> â†’ ä¸­é—´ä»¶æ¨¡å¼</li>
<li><strong>éœ€è¦æ•°æ®è½¬æ¢æµæ°´çº¿</strong> â†’ ç®¡é“æ¨¡å¼</li>
<li><strong>éœ€è¦æµç•…çš„APIæ¥å£</strong> â†’ é“¾å¼è°ƒç”¨</li>
<li><strong>éœ€è¦ä¼˜åŒ–æ€§èƒ½ï¼Œå»¶è¿Ÿåˆå§‹åŒ–</strong> â†’ æƒ°æ€§åŠ è½½</li>
</ol>
<h4 data-id="heading-21">å…­ã€ç»¼åˆåº”ç”¨å®ä¾‹</h4>
<h5 data-id="heading-22">6.1 å®Œæ•´çš„APIå®¢æˆ·ç«¯</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiClient</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">baseURL</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseURL</span> = baseURL;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultHeaders</span> = {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
    };
  }

  <span class="hljs-comment">// æ·»åŠ ä¸­é—´ä»¶</span>
  <span class="hljs-title function_">use</span>(<span class="hljs-params">middleware</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">push</span>(middleware);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// åˆ›å»ºè¯·æ±‚ç®¡é“</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">endpoint, options = {}</span>) {
    <span class="hljs-keyword">const</span> context = {
      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.baseURL}</span><span class="hljs-subst">${endpoint}</span>`</span>,
      <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
        <span class="hljs-attr">headers</span>: { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultHeaders</span>, ...options.<span class="hljs-property">headers</span> },
        ...options
      },
      <span class="hljs-attr">response</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
    };

    <span class="hljs-comment">// æ‰§è¡Œä¸­é—´ä»¶ç®¡é“</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeMiddleware</span>(context);
    
    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">error</span>) {
      <span class="hljs-keyword">throw</span> context.<span class="hljs-property">error</span>;
    }

    <span class="hljs-keyword">return</span> context.<span class="hljs-property">response</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeMiddleware</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> middlewares = <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>;
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (index &lt; middlewares.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> middleware = middlewares[index++];
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">middleware</span>(context, next);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ‰§è¡Œå®é™…è¯·æ±‚</span>
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeRequest</span>(context);
      }
    };
    
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeRequest</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(context.<span class="hljs-property">url</span>, context.<span class="hljs-property">options</span>);
      context.<span class="hljs-property">response</span> = {
        <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
        <span class="hljs-attr">headers</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">entries</span>()),
        <span class="hljs-attr">data</span>: <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
      };
    } <span class="hljs-keyword">catch</span> (error) {
      context.<span class="hljs-property">error</span> = error;
    }
  }

  <span class="hljs-comment">// å¿«æ·æ–¹æ³•ï¼ˆé“¾å¼è°ƒç”¨ï¼‰</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params">endpoint, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(endpoint, { ...options, <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span> });
  }

  <span class="hljs-title function_">post</span>(<span class="hljs-params">endpoint, data, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(endpoint, {
      ...options,
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
    });
  }

  <span class="hljs-title function_">put</span>(<span class="hljs-params">endpoint, data, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(endpoint, {
      ...options,
      <span class="hljs-attr">method</span>: <span class="hljs-string">'PUT'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
    });
  }

  <span class="hljs-title function_">delete</span>(<span class="hljs-params">endpoint, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(endpoint, { ...options, <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span> });
  }
}

<span class="hljs-comment">// åˆ›å»ºAPIå®¢æˆ·ç«¯å¹¶é…ç½®ä¸­é—´ä»¶</span>
<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiClient</span>(<span class="hljs-string">'https://api.example.com'</span>)
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-comment">// è®¤è¯ä¸­é—´ä»¶</span>
    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'auth_token'</span>);
    <span class="hljs-keyword">if</span> (token) {
      ctx.<span class="hljs-property">options</span>.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
    }
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-comment">// æ—¥å¿—ä¸­é—´ä»¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[API] <span class="hljs-subst">${ctx.options.method}</span> <span class="hljs-subst">${ctx.url}</span>`</span>);
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[API] Completed in <span class="hljs-subst">${duration}</span>ms`</span>);
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-comment">// é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'[API] Request failed:'</span>, error);
      <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œå®ç°é‡è¯•é€»è¾‘</span>
      <span class="hljs-keyword">throw</span> error;
    }
  });

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUserData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/1'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User data:'</span>, response.<span class="hljs-property">data</span>);
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to fetch user:'</span>, error);
  }
}
</code></pre>
<h5 data-id="heading-23">6.2 è¡¨å•å¤„ç†ç³»ç»Ÿ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FormProcessor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">formElement</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span> = formElement;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transformers</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitHandlers</span> = [];
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ”¶é›†è¡¨å•å­—æ®µ</span>
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-property">elements</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (element.<span class="hljs-property">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">set</span>(element.<span class="hljs-property">name</span>, element);
      }
    });
    
    <span class="hljs-comment">// ç»‘å®šæäº¤äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleSubmit</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
  }

  <span class="hljs-comment">// æ·»åŠ éªŒè¯å™¨</span>
  <span class="hljs-title function_">addValidator</span>(<span class="hljs-params">fieldName, validator</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span>.<span class="hljs-title function_">has</span>(fieldName)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span>.<span class="hljs-title function_">set</span>(fieldName, []);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span>.<span class="hljs-title function_">get</span>(fieldName).<span class="hljs-title function_">push</span>(validator);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æ·»åŠ æ•°æ®è½¬æ¢å™¨</span>
  <span class="hljs-title function_">addTransformer</span>(<span class="hljs-params">transformer</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transformers</span>.<span class="hljs-title function_">push</span>(transformer);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æ·»åŠ æäº¤å¤„ç†å™¨</span>
  <span class="hljs-title function_">onSubmit</span>(<span class="hljs-params">handler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitHandlers</span>.<span class="hljs-title function_">push</span>(handler);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// è·å–è¡¨å•æ•°æ®</span>
  <span class="hljs-title function_">getData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">element, name</span>) =&gt;</span> {
      data[name] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getValue</span>(element);
    });
    <span class="hljs-keyword">return</span> data;
  }

  <span class="hljs-title function_">getValue</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-keyword">if</span> (element.<span class="hljs-property">type</span> === <span class="hljs-string">'checkbox'</span>) {
      <span class="hljs-keyword">return</span> element.<span class="hljs-property">checked</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">type</span> === <span class="hljs-string">'radio'</span>) {
      <span class="hljs-keyword">return</span> element.<span class="hljs-property">checked</span> ? element.<span class="hljs-property">value</span> : <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">type</span> === <span class="hljs-string">'select-multiple'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(element.<span class="hljs-property">selectedOptions</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> opt.<span class="hljs-property">value</span>);
    }
    <span class="hljs-keyword">return</span> element.<span class="hljs-property">value</span>;
  }

  <span class="hljs-comment">// éªŒè¯è¡¨å•</span>
  <span class="hljs-title function_">validate</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> errors = {};
    <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getData</span>();
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">validators, fieldName</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> value = data[fieldName];
      <span class="hljs-keyword">const</span> fieldErrors = [];
      
      validators.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">validator</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">validator</span>(value, data);
        <span class="hljs-keyword">if</span> (result !== <span class="hljs-literal">true</span>) {
          fieldErrors.<span class="hljs-title function_">push</span>(result || <span class="hljs-string">`Validation failed for <span class="hljs-subst">${fieldName}</span>`</span>);
        }
      });
      
      <span class="hljs-keyword">if</span> (fieldErrors.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        errors[fieldName] = fieldErrors;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showFieldError</span>(fieldName, fieldErrors[<span class="hljs-number">0</span>]);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearFieldError</span>(fieldName);
      }
    });
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">isValid</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(errors).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>,
      errors,
      data
    };
  }

  <span class="hljs-title function_">showFieldError</span>(<span class="hljs-params">fieldName, message</span>) {
    <span class="hljs-keyword">const</span> field = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">get</span>(fieldName);
    <span class="hljs-keyword">if</span> (field) {
      field.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'error'</span>);
      
      <span class="hljs-keyword">let</span> errorElement = field.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.error-message'</span>);
      <span class="hljs-keyword">if</span> (!errorElement) {
        errorElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
        errorElement.<span class="hljs-property">className</span> = <span class="hljs-string">'error-message'</span>;
        field.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">appendChild</span>(errorElement);
      }
      errorElement.<span class="hljs-property">textContent</span> = message;
    }
  }

  <span class="hljs-title function_">clearFieldError</span>(<span class="hljs-params">fieldName</span>) {
    <span class="hljs-keyword">const</span> field = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">get</span>(fieldName);
    <span class="hljs-keyword">if</span> (field) {
      field.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'error'</span>);
      <span class="hljs-keyword">const</span> errorElement = field.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.error-message'</span>);
      <span class="hljs-keyword">if</span> (errorElement) {
        errorElement.<span class="hljs-title function_">remove</span>();
      }
    }
  }

  <span class="hljs-comment">// å¤„ç†æäº¤</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">event</span>) {
    event.<span class="hljs-title function_">preventDefault</span>();
    
    <span class="hljs-comment">// éªŒè¯</span>
    <span class="hljs-keyword">const</span> validation = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validate</span>();
    <span class="hljs-keyword">if</span> (!validation.<span class="hljs-property">isValid</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Form validation failed:'</span>, validation.<span class="hljs-property">errors</span>);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// æ•°æ®è½¬æ¢ç®¡é“</span>
    <span class="hljs-keyword">let</span> processedData = validation.<span class="hljs-property">data</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> transformer <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">transformers</span>) {
      processedData = <span class="hljs-title function_">transformer</span>(processedData);
    }
    
    <span class="hljs-comment">// æ‰§è¡Œæäº¤å¤„ç†å™¨</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> handler <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitHandlers</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">handler</span>(processedData);
        <span class="hljs-keyword">if</span> (result === <span class="hljs-literal">false</span> || result?.<span class="hljs-property">stopPropagation</span>) {
          <span class="hljs-keyword">break</span>;
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Submit handler error:'</span>, error);
        <span class="hljs-keyword">break</span>;
      }
    }
  }

  <span class="hljs-comment">// é‡ç½®è¡¨å•</span>
  <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-title function_">reset</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">field, name</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearFieldError</span>(name);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> formProcessor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormProcessor</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myForm'</span>))
  .<span class="hljs-title function_">addValidator</span>(<span class="hljs-string">'email'</span>, <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!value) <span class="hljs-keyword">return</span> <span class="hljs-string">'Email is required'</span>;
    <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.<span class="hljs-title function_">test</span>(value)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'Invalid email format'</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  })
  .<span class="hljs-title function_">addValidator</span>(<span class="hljs-string">'password'</span>, <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!value) <span class="hljs-keyword">return</span> <span class="hljs-string">'Password is required'</span>;
    <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &lt; <span class="hljs-number">8</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Password must be at least 8 characters'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  })
  .<span class="hljs-title function_">addTransformer</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-comment">// è½¬æ¢æ•°æ®</span>
    <span class="hljs-keyword">return</span> {
      ...data,
      <span class="hljs-attr">email</span>: data.<span class="hljs-property">email</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">trim</span>(),
      <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
    };
  })
  .<span class="hljs-title function_">onSubmit</span>(<span class="hljs-keyword">async</span> (data) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Submitting data:'</span>, data);
    
    <span class="hljs-comment">// æ¨¡æ‹ŸAPIè°ƒç”¨</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/register'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
    });
    
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Registration failed'</span>);
    }
    
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'Registration successful!'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  })
  .<span class="hljs-title function_">onSubmit</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-comment">// ç¬¬äºŒä¸ªå¤„ç†å™¨ï¼šå‘é€åˆ†æäº‹ä»¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Analytics event sent for registration'</span>);
  });
</code></pre>
<h4 data-id="heading-24">ä¸ƒã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h4>
<h5 data-id="heading-25">7.1 ä¸­é—´ä»¶æ¨¡å¼æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>ä¿æŒä¸­é—´ä»¶ç®€æ´å•ä¸€:</strong> æ¯ä¸ªä¸­é—´ä»¶åªåšä¸€ä»¶äº‹</li>
<li><strong>é”™è¯¯å¤„ç†:</strong> ç¡®ä¿ä¸­é—´ä»¶æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
<li><strong>æ€§èƒ½è€ƒè™‘:</strong> é¿å…åœ¨ä¸­é—´ä»¶ä¸­è¿›è¡Œæ˜‚è´µçš„åŒæ­¥æ“ä½œ</li>
<li><strong>é¡ºåºå¾ˆé‡è¦:</strong> æ³¨æ„ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºå¯¹ä¸šåŠ¡é€»è¾‘çš„å½±å“</li>
</ol>
<h5 data-id="heading-26">7.2 ç®¡é“æ¨¡å¼æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>çº¯å‡½æ•°ä¼˜å…ˆ:</strong> ç¡®ä¿ç®¡é“ä¸­çš„å‡½æ•°æ˜¯çº¯å‡½æ•°ï¼Œé¿å…å‰¯ä½œç”¨</li>
<li><strong>ç±»å‹æ£€æŸ¥:</strong> è€ƒè™‘æ·»åŠ è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥</li>
<li><strong>é”™è¯¯å¤„ç†:</strong> ç°ç®¡é“çº§åˆ«çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–:</strong> è€ƒè™‘ä½¿ç”¨æµå¼å¤„ç†å¤§æ•°æ®é›†</li>
</ol>
<h5 data-id="heading-27">7.3 é“¾å¼è°ƒç”¨æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>è¿”å›this:</strong> ç¡®ä¿æ¯ä¸ªé“¾å¼æ–¹æ³•éƒ½è¿”å›å®ä¾‹æœ¬èº«</li>
<li><strong>ä¸å¯å˜æ“ä½œ:</strong> è€ƒè™‘å®ç°ä¸å¯å˜ç‰ˆæœ¬çš„é“¾å¼è°ƒç”¨</li>
<li><strong>æ¸…æ™°çš„æ–¹æ³•å:</strong> æ–¹æ³•ååº”è¯¥æ¸…æ™°è¡¨è¾¾å…¶åŠŸèƒ½</li>
<li><strong>æ–‡æ¡£å®Œå–„:</strong> é“¾å¼è°ƒç”¨å¯èƒ½éšè—å¤æ‚åº¦ï¼Œéœ€è¦è‰¯å¥½æ–‡æ¡£</li>
</ol>
<h5 data-id="heading-28">7.4 æƒ°æ€§åŠ è½½æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>é€‚åº¦ä½¿ç”¨:</strong> ä¸è¦è¿‡åº¦ä½¿ç”¨æƒ°æ€§åŠ è½½ï¼Œä¼šå¢åŠ å¤æ‚åº¦</li>
<li><strong>é¢„åŠ è½½ç­–ç•¥:</strong> å¯¹äºå¯èƒ½å¾ˆå¿«éœ€è¦çš„å†…å®¹ï¼Œè€ƒè™‘é¢„åŠ è½½</li>
<li><strong>é”™è¯¯å¤„ç†:</strong> ç¡®ä¿æƒ°æ€§åŠ è½½å¤±è´¥æ—¶æœ‰é™çº§æ–¹æ¡ˆ</li>
<li><strong>ç”¨æˆ·åé¦ˆ:</strong> åŠ è½½è¿‡ç¨‹ä¸­ç»™ç”¨æˆ·é€‚å½“çš„åé¦ˆ</li>
</ol>
<h4 data-id="heading-29">æ€»ç»“</h4>
<p>è¿™å››ç§å‰ç«¯æ¨¡å¼-ä¸­é—´ä»¶æ¨¡å¼ã€ç®¡é“æ¨¡å¼ã€é“¾å¼è°ƒç”¨å’Œæƒ°æ€§åŠ è½½---éƒ½æ˜¯ç°ä»£å‰ç«¯å¼€å‘ä¸­æå…¶æœ‰ç”¨çš„å·¥å…·ã€‚å®ƒä»¬å„è‡ªè§£å†³äº†ä¸åŒçš„é—®é¢˜:</p>
<ul>
<li><strong>ä¸­é—´ä»¶æ¨¡å¼</strong>æä¾›äº†å¤„ç†å¤æ‚æµç¨‹çš„æ¨¡å—åŒ–æ–¹å¼</li>
<li><strong>ç®¡é“æ¨¡å¼</strong>è®©æ•°æ®è½¬æ¢å˜å¾—æ¸…æ™°å’Œå¯ç»„åˆ</li>
<li><strong>é“¾å¼è°ƒç”¨</strong>åˆ›é€ äº†æµç•…ã€æ˜“è¯»çš„API</li>
<li><strong>æƒ°æ€§åŠ è½½</strong>ä¼˜åŒ–äº†æ€§èƒ½å’Œèµ„æºä½¿ç”¨</li>
</ul>
<p>æŒæ¡è¿™äº›æ¨¡å¼å¹¶çŸ¥é“ä½•æ—¶ä½¿ç”¨å®ƒä»¬ï¼Œå°†å¸®åŠ©ä½ ç¼–å†™æ›´å¯ç»´æŠ¤ã€æ›´é«˜æ•ˆçš„å‰ç«¯ä»£ç ã€‚è®°ä½ï¼Œè®¾è®¡æ¨¡å¼æ˜¯å·¥å…·ï¼Œè€Œä¸æ˜¯é“¶å¼¹ã€‚æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å¼ï¼Œå¹¶å§‹ç»ˆä»¥ä»£ç æ¸…æ™°æ€§å’Œå¯ç»´æŠ¤æ€§ä¸ºé¦–è¦è€ƒè™‘ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™äº›æ¨¡å¼ç»å¸¸ç»„åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªAPIå®¢æˆ·ç«¯å¯èƒ½åŒæ—¶ä½¿ç”¨ä¸­é—´ä»¶æ¨¡å¼å¤„ç†è¯·æ±‚ã€ç®¡é“æ¨¡å¼å¤„ç†æ•°æ®è½¬æ¢ã€é“¾å¼è°ƒç”¨æä¾›æµç•…APIï¼Œå¹¶åœ¨é€‚å½“çš„åœ°æ–¹ä½¿ç”¨æƒ°æ€§åŠ è½½ä¼˜åŒ–æ€§èƒ½ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ åœ¨å‰ç«¯å¼€å‘ä¸­æ›´å¥½åœ°åº”ç”¨è¿™äº›å¼ºå¤§çš„æ¨¡å¼ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Django 6.0æ¥è¢­ï¼è¿™äº›æ–°ç‰¹æ€§ï¼ŒçœŸçš„ä»¤äººæŒ¯å¥‹ï¼]]></title>    <link>https://juejin.cn/post/7582786655474171947</link>    <guid>https://juejin.cn/post/7582786655474171947</guid>    <pubDate>2025-12-13T03:04:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582786655474171947" data-draft-id="7582785032852701247" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Django 6.0æ¥è¢­ï¼è¿™äº›æ–°ç‰¹æ€§ï¼ŒçœŸçš„ä»¤äººæŒ¯å¥‹ï¼"/> <meta itemprop="keywords" content="Python,Django,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-13T03:04:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºé’é“œä¸‰"/> <meta itemprop="url" content="https://juejin.cn/user/2942757076730455"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Django 6.0æ¥è¢­ï¼è¿™äº›æ–°ç‰¹æ€§ï¼ŒçœŸçš„ä»¤äººæŒ¯å¥‹ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2942757076730455/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºé’é“œä¸‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:04:24.000Z" title="Sat Dec 13 2025 03:04:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fadamj.eu%2Ftech%2F2025%2F12%2F03%2Fdjango-whats-new-6.0%2F" target="_blank" title="https://adamj.eu/tech/2025/12/03/django-whats-new-6.0/" ref="nofollow noopener noreferrer">adamj.eu/tech/2025/1â€¦</a><br/>
ä½œè€…ï¼šAdam Johnson<br/>
è¯‘è€…ï¼šå€”å¼ºé’é“œä¸‰</p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯<strong>å€”å¼ºé’é“œä¸‰</strong>ã€‚æ¬¢è¿å…³æ³¨æˆ‘ï¼Œ<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šå€”å¼ºé’é“œä¸‰</strong>ã€‚æ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä¸€é”®ä¸‰è¿ï¼ï¼ï¼</p>
<p>Django 6.0 å·²äº 2025 å¹´ 12 æœˆ 3 æ—¥å‘å¸ƒï¼Œä¸ºè¿™ä¸ªå·²ç» 20 å²çš„ Python Web æ¡†æ¶å¼€å¯äº†æ–°çš„å‘å¸ƒå‘¨æœŸã€‚è¯¥ç‰ˆæœ¬å¸¦æ¥äº†ä¼—å¤šæ–°ç‰¹æ€§ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›äº®ç‚¹ã€‚</p>
<h2 data-id="heading-1">ä½¿ç”¨ django-upgrade å‡çº§é¡¹ç›®</h2>
<p>å¦‚æœä½ æ­£åœ¨ä» Django 5.2 æˆ–æ›´æ—©ç‰ˆæœ¬å‡çº§é¡¹ç›®ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨æˆ‘çš„å·¥å…· <a href="https://link.juejin.cn?target=https%3A%2F%2Fdjango-upgrade.readthedocs.io%2Fen%2Flatest%2F" target="_blank" title="https://django-upgrade.readthedocs.io/en/latest/" ref="nofollow noopener noreferrer">django-upgrade</a>ã€‚å®ƒä¼šè‡ªåŠ¨æ›´æ–°æ—§çš„ Django ä»£ç ä»¥ä½¿ç”¨æ–°ç‰¹æ€§ï¼Œä¿®å¤ä¸€äº›å¼ƒç”¨è­¦å‘Šï¼ŒåŒ…æ‹¬é’ˆå¯¹ Django 6.0 çš„äº”ä¸ªä¿®å¤ç¨‹åºã€‚</p>
<h2 data-id="heading-2">æ¨¡æ¿å±€éƒ¨å®šä¹‰ï¼ˆTemplate Partialsï¼‰</h2>
<p>Django æ¨¡æ¿è¯­è¨€ç°åœ¨æ”¯æŒæ¨¡æ¿å±€éƒ¨å®šä¹‰ï¼ˆtemplate partialsï¼‰ï¼Œè¿™ä½¿å¾—åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­å°è£…å’Œé‡ç”¨å°å‹å‘½åç‰‡æ®µå˜å¾—æ›´åŠ å®¹æ˜“ã€‚å±€éƒ¨å®šä¹‰ç”±æ–°çš„ <code>{% partialdef %}</code> å’Œ <code>{% endpartialdef %}</code> æ ‡ç­¾æ ‡è®°ï¼Œå¯ä»¥åœ¨åŒä¸€æ¨¡æ¿ä¸­é‡å¤ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å•ç‹¬æ¸²æŸ“ã€‚</p>
<h3 data-id="heading-3">åœ¨åŒä¸€æ¨¡æ¿ä¸­é‡å¤ä½¿ç”¨å±€éƒ¨å®šä¹‰</h3>
<p>ä»¥ä¸‹æ¨¡æ¿åœ¨åŒä¸€ä¸ªæ¨¡æ¿ä¸­é‡å¤ä½¿ç”¨äº†ä¸€ä¸ªåä¸º <code>filter_controls</code> çš„å±€éƒ¨å®šä¹‰ã€‚å®ƒåœ¨æ¨¡æ¿é¡¶éƒ¨å®šä¹‰ä¸€æ¬¡ï¼Œç„¶ååœ¨åé¢ä¸¤æ¬¡ä½¿ç”¨ã€‚ä½¿ç”¨å±€éƒ¨å®šä¹‰å¯ä»¥è®©æ¨¡æ¿é¿å…é‡å¤ï¼Œè€Œæ— éœ€å°†å†…å®¹æ¨é€åˆ°å•ç‹¬çš„åŒ…å«æ–‡ä»¶ä¸­ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"videos"</span>&gt;</span>
  {% partialdef filter_controls %}
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      {{ filter_form }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
  {% endpartialdef %}

  {% partial filter_controls %}

  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    {% for video in videos %}
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{{ video.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        ...
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    {% endfor %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

  {% partial filter_controls %}
<span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
</code></pre>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ <code>partialdef</code> æ ‡ç­¾ä¸Šä½¿ç”¨ <code>inline</code> é€‰é¡¹ï¼Œè¿›ä¸€æ­¥ç®€åŒ–è¿™ç§æ¨¡å¼ï¼Œè¿™ä¼šå¯¼è‡´å®šä¹‰åœ¨åŸåœ°æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"videos"</span>&gt;</span>
  {% partialdef filter_controls inline %}
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      {{ filter_form }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
  {% endpartialdef %}

  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    {% for video in videos %}
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{{ video.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        ...
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    {% endfor %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

  {% partial filter_controls %}
<span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
</code></pre>
<p>å½“ä½ å‘ç°è‡ªå·±åœ¨åŒä¸€ä¸ªæ¨¡æ¿ä¸­é‡å¤æ¨¡æ¿ä»£ç æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚å› ä¸ºå±€éƒ¨å®šä¹‰å¯ä»¥ä½¿ç”¨å˜é‡ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ¶ˆé™¤é‡å¤ï¼Œå½“æ¸²æŸ“å…·æœ‰ä¸åŒæ•°æ®çš„ç±»ä¼¼æ§ä»¶æ—¶ã€‚</p>
<h3 data-id="heading-4">å•ç‹¬æ¸²æŸ“å±€éƒ¨å®šä¹‰</h3>
<p>ä»¥ä¸‹æ¨¡æ¿å®šä¹‰äº†ä¸€ä¸ª <code>view_count</code> å±€éƒ¨å®šä¹‰ï¼Œå®ƒæ—¨åœ¨å•ç‹¬é‡æ–°æ¸²æŸ“ã€‚å®ƒä½¿ç”¨äº† <code>inline</code> é€‰é¡¹ï¼Œå› æ­¤å½“æ•´ä¸ªæ¨¡æ¿è¢«æ¸²æŸ“æ—¶ï¼Œå±€éƒ¨å®šä¹‰ä¼šè¢«åŒ…å«ã€‚</p>
<p>é¡µé¢ä½¿ç”¨äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhtmx.org%2F" target="_blank" title="https://htmx.org/" ref="nofollow noopener noreferrer">htmx</a>ï¼Œé€šè¿‡æˆ‘çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdjango-htmx.readthedocs.io%2Fen%2Flatest%2F" target="_blank" title="https://django-htmx.readthedocs.io/en/latest/" ref="nofollow noopener noreferrer">django-htmx åŒ…</a>ï¼Œé€šè¿‡ <code>hx-*</code> å±æ€§å®šæœŸåˆ·æ–°æŸ¥çœ‹æ¬¡æ•°ã€‚æ¥è‡ª htmx çš„è¯·æ±‚ä¼šå‘é€åˆ°ä¸€ä¸ªä¸“ç”¨è§†å›¾ï¼Œè¯¥è§†å›¾é‡æ–°æ¸²æŸ“ <code>view_count</code> å±€éƒ¨å®šä¹‰ã€‚</p>
<pre><code class="hljs language-html" lang="html">{% load django_htmx %}
<span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{ video.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"1280"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"720"</span> <span class="hljs-attr">controls</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{{ video.file.url }}"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/mp4"</span>&gt;</span>
      Your browser does not support the video tag.
    <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>

    {% partialdef view_count inline %}
    <span class="hljs-tag">&lt;<span class="hljs-name">section</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"view-count"</span>
      <span class="hljs-attr">hx-trigger</span>=<span class="hljs-string">"every 1s"</span>
      <span class="hljs-attr">hx-swap</span>=<span class="hljs-string">"outerHTML"</span>
      <span class="hljs-attr">hx-get</span>=<span class="hljs-string">"{% url 'video-view-count' video.id %}"</span>
    &gt;</span>
      {{ video.view_count }} views
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
    {% endpartialdef %}

    {% htmx_script %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>ä¸¤ä¸ªè§†å›¾çš„ç›¸å…³ä»£ç å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render

<span class="hljs-keyword">def</span> <span class="hljs-title function_">video</span>(<span class="hljs-params">request, video_id</span>):
    ...
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">"video.html"</span>, {<span class="hljs-string">"video"</span>: video})

<span class="hljs-keyword">def</span> <span class="hljs-title function_">video_view_count</span>(<span class="hljs-params">request, video_id</span>):
    ...
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">"video.html#view_count"</span>, {<span class="hljs-string">"video"</span>: video})
</code></pre>
<p>åˆå§‹çš„ <code>video</code> è§†å›¾æ¸²æŸ“äº†å®Œæ•´çš„æ¨¡æ¿ <code>video.html</code>ã€‚<code>video_view_count</code> è§†å›¾é€šè¿‡åœ¨æ¨¡æ¿åç§°åé™„åŠ  <code>#view_count</code> æ¥ä»…æ¸²æŸ“ <code>view_count</code> å±€éƒ¨å®šä¹‰ã€‚è¿™ç§è¯­æ³•ç±»ä¼¼äºåœ¨ URL ä¸­é€šè¿‡å…¶ ID å¼•ç”¨ HTML ç‰‡æ®µçš„æ–¹å¼ã€‚</p>
<h2 data-id="heading-5">ä»»åŠ¡æ¡†æ¶ï¼ˆTasks Frameworkï¼‰</h2>
<p>Django ç°åœ¨åŒ…å«äº†ä¸€ä¸ªå†…ç½®çš„ä»»åŠ¡æ¡†æ¶ï¼Œç”¨äºåœ¨ HTTP è¯·æ±‚ - å“åº”å‘¨æœŸä¹‹å¤–è¿è¡Œä»£ç ã€‚è¿™ä½¿å¾—å¯ä»¥å°†å·¥ä½œï¼ˆå¦‚å‘é€ç”µå­é‚®ä»¶æˆ–å¤„ç†æ•°æ®ï¼‰å¸è½½åˆ°åå°å·¥ä½œç¨‹åºä¸­ã€‚</p>
<p>æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œæ’é˜Ÿåå°ä»»åŠ¡çš„æ–° APIâ€”â€”éå¸¸é…·ï¼</p>
<p>åå°ä»»åŠ¡æ˜¯ä¸€ç§åœ¨è¯·æ±‚ - å“åº”å‘¨æœŸä¹‹å¤–è¿è¡Œä»£ç çš„æ–¹å¼ã€‚å®ƒä»¬æ˜¯ Web åº”ç”¨ç¨‹åºä¸­çš„å¸¸è§éœ€æ±‚ï¼Œç”¨äºå‘é€ç”µå­é‚®ä»¶ã€å¤„ç†å›¾åƒã€ç”ŸæˆæŠ¥å‘Šç­‰ã€‚</p>
<p>å†å²ä¸Šï¼ŒDjango æ²¡æœ‰æä¾›ä»»ä½•åå°ä»»åŠ¡ç³»ç»Ÿï¼Œè€Œæ˜¯å®Œå…¨å¿½ç•¥äº†è¿™ä¸ªé—®é¢˜ã€‚å¼€å‘äººå‘˜ä¾èµ–äºç¬¬ä¸‰æ–¹åŒ…ï¼Œå¦‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.celeryq.dev%2Fen%2Fstable%2F" target="_blank" title="https://docs.celeryq.dev/en/stable/" ref="nofollow noopener noreferrer">Celery</a> æˆ– <a href="https://link.juejin.cn?target=https%3A%2F%2Fdjango-q2.readthedocs.io%2Fen%2Fmaster%2F" target="_blank" title="https://django-q2.readthedocs.io/en/master/" ref="nofollow noopener noreferrer">Django Q2</a>ã€‚å°½ç®¡è¿™äº›ç³»ç»Ÿå¾ˆå¥½ï¼Œä½†å®ƒä»¬è®¾ç½®å’Œç»´æŠ¤èµ·æ¥å¯èƒ½å¾ˆå¤æ‚ï¼Œè€Œä¸”é€šå¸¸ä¸ç¬¦åˆ Django çš„â€œè‡ªç„¶â€é£æ ¼ã€‚</p>
<p>æ–°çš„ä»»åŠ¡æ¡†æ¶é€šè¿‡æä¾›ä¸€ä¸ªå®šä¹‰åå°ä»»åŠ¡çš„æ¥å£æ¥å¡«è¡¥è¿™ä¸€ç©ºç™½ï¼Œä»»åŠ¡è¿è¡Œå™¨åŒ…å¯ä»¥ä¸ä¹‹é›†æˆã€‚è¿™ä¸ªå…±åŒçš„åŸºç¡€å…è®¸ç¬¬ä¸‰æ–¹ Django åŒ…ä»¥æ ‡å‡†æ–¹å¼å®šä¹‰ä»»åŠ¡ï¼Œå‡è®¾ä½ ä¼šä½¿ç”¨å…¼å®¹çš„ä»»åŠ¡è¿è¡Œå™¨æ¥æ‰§è¡Œå®ƒä»¬ã€‚</p>
<p>ä½¿ç”¨æ–°çš„ <code>@task</code> è£…é¥°å™¨å®šä¹‰ä»»åŠ¡ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.tasks <span class="hljs-keyword">import</span> task

<span class="hljs-meta">@task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">resize_video</span>(<span class="hljs-params">video_id</span>):
    ...
</code></pre>
<p>ç„¶åä½¿ç”¨ <code>Task.enqueue()</code> æ–¹æ³•å°†å®ƒä»¬æ’é˜Ÿè¿›è¡Œåå°æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> example.tasks <span class="hljs-keyword">import</span> resize_video

<span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_video</span>(<span class="hljs-params">request</span>):
    ...
    resize_video.enqueue(video.<span class="hljs-built_in">id</span>)
    ...
</code></pre>
<h3 data-id="heading-6">æ‰§è¡Œä»»åŠ¡</h3>
<p>ç›®å‰ï¼ŒDjango å¹¶æ²¡æœ‰åŒ…å«ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„ä»»åŠ¡åç«¯ï¼Œåªæœ‰ä¸¤ä¸ªé€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•çš„åç«¯ï¼š</p>
<ul>
<li><code>ImmediateBackend</code>ï¼šåŒæ­¥è¿è¡Œä»»åŠ¡ï¼Œç›´åˆ°å®ƒä»¬å®Œæˆæ‰ä¼šé˜»å¡ã€‚</li>
<li><code>DummyBackend</code>ï¼šå½“ä»»åŠ¡è¢«æ’é˜Ÿæ—¶ä»€ä¹ˆéƒ½ä¸åšï¼Œä½†å…è®¸ä¹‹åæ£€æŸ¥ä»»åŠ¡ã€‚åœ¨æµ‹è¯•ä¸­å¾ˆæœ‰ç”¨ï¼Œä½ å¯ä»¥æ–­è¨€ä»»åŠ¡è¢«æ’é˜Ÿäº†ï¼Œè€Œæ— éœ€å®é™…è¿è¡Œå®ƒä»¬ã€‚</li>
</ul>
<p>å¯¹äºç”Ÿäº§ä½¿ç”¨ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹åŒ…ï¼Œå…¶ä¸­ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpypi.org%2Fproject%2Fdjango-tasks%2F" target="_blank" title="https://pypi.org/project/django-tasks/" ref="nofollow noopener noreferrer">django-tasks</a> æ˜¯ä¸»è¦çš„é€‰æ‹©ã€‚å®ƒæä¾›äº† <code>DatabaseBackend</code>ï¼Œç”¨äºå°†ä»»åŠ¡å­˜å‚¨åœ¨ä½ çš„ SQL æ•°æ®åº“ä¸­ï¼Œå¯¹äºè®¸å¤šé¡¹ç›®æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œé¿å…äº†é¢å¤–çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶å…è®¸åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­åŸå­æ€§åœ°æ’é˜Ÿä»»åŠ¡ã€‚æˆ‘ä»¬å¯èƒ½ä¼šåœ¨é€‚å½“çš„æ—¶å€™çœ‹åˆ°è¿™ä¸ªåç«¯åˆå¹¶åˆ° Django ä¸­ï¼Œæˆ–è€…è‡³å°‘æˆä¸ºä¸€ä¸ªå®˜æ–¹åŒ…ï¼Œä»¥å¸®åŠ©ä½¿ Django åœ¨åå°ä»»åŠ¡æ–¹é¢â€œå¼€ç®±å³ç”¨â€ã€‚</p>
<p>è¦ä½¿ç”¨ django-tasks çš„ <code>DatabaseBackend</code>ï¼Œé¦–å…ˆå®‰è£…è¯¥åŒ…ï¼š</p>
<p>å…¶æ¬¡ï¼Œå°†è¿™ä¸¤ä¸ªåº”ç”¨æ·»åŠ åˆ°ä½ çš„ <code>INSTALLED_APPS</code> è®¾ç½®ä¸­ï¼š</p>
<pre><code class="hljs language-python" lang="python">INSTALLED_APPS = [
    <span class="hljs-comment"># ...</span>
    <span class="hljs-string">"django_tasks"</span>,
    <span class="hljs-string">"django_tasks.backends.database"</span>,
    <span class="hljs-comment"># ...</span>
]
</code></pre>
<p>ç¬¬ä¸‰ï¼Œå°† <code>DatabaseBackend</code> é…ç½®ä¸ºä½ çš„ä»»åŠ¡åç«¯ï¼Œä½¿ç”¨æ–°çš„ <code>TASKS</code> è®¾ç½®ï¼š</p>
<pre><code class="hljs language-python" lang="python">TASKS = {
    <span class="hljs-string">"default"</span>: {
        <span class="hljs-string">"BACKEND"</span>: <span class="hljs-string">"django_tasks.backends.database.DatabaseBackend"</span>,
    },
}
</code></pre>
<p>ç¬¬å››ï¼Œè¿è¡Œè¿ç§»ä»¥åˆ›å»ºå¿…è¦çš„æ•°æ®åº“è¡¨ã€‚</p>
<p>æœ€åï¼Œè¦è¿è¡Œä»»åŠ¡å·¥ä½œè¿›ç¨‹ï¼Œä½¿ç”¨åŒ…çš„ <code>db_worker</code> ç®¡ç†å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ ./manage.py db_worker
Starting worker worker_id=jWLMLrms3C2NcUODYeatsqCFvd5rK6DM queues=default
</code></pre>
<p>è¯¥è¿›ç¨‹ä¼šæ— é™æœŸè¿è¡Œï¼Œè½®è¯¢ä»»åŠ¡å¹¶æ‰§è¡Œå®ƒä»¬ï¼ŒåŒæ—¶è®°å½•äº‹ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Task <span class="hljs-built_in">id</span>=10b794ed-9b64-4eed-950c-fcc92cd6784b path=example.tasks.echo state=RUNNING
Hello from <span class="hljs-built_in">test</span> task!
Task <span class="hljs-built_in">id</span>=10b794ed-9b64-4eed-950c-fcc92cd6784b path=example.tasks.echo state=SUCCEEDED
</code></pre>
<p>ä½ å¸Œæœ›åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ <code>db_worker</code>ï¼Œå¹¶ä¸”å¦‚æœä½ å¸Œæœ›åœ¨å¼€å‘ä¸­æµ‹è¯•åå°ä»»åŠ¡æ‰§è¡Œï¼Œä¹Ÿåº”è¯¥è¿è¡Œå®ƒã€‚</p>
<h2 data-id="heading-7">å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰æ”¯æŒ</h2>
<p>Django ç°åœ¨æä¾›äº†å¯¹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Ftopics%2Fsecurity%2F%23security-csp" target="_blank" title="https://docs.djangoproject.com/en/stable/topics/security/#security-csp" ref="nofollow noopener noreferrer">å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰</a> æ ‡å‡†çš„å†…ç½®æ”¯æŒï¼Œè¿™ä½¿å¾—ä¿æŠ¤ Web åº”ç”¨ç¨‹åºå…å—å†…å®¹æ³¨å…¥æ”»å‡»ï¼ˆå¦‚è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ï¼‰å˜å¾—æ›´åŠ å®¹æ˜“ã€‚CSP å…è®¸é€šè¿‡ä¸ºæµè§ˆå™¨æä¾›ä¸¥æ ¼çš„è§„åˆ™æ¥å£°æ˜å“ªäº›è„šæœ¬ã€æ ·å¼ã€å›¾åƒæˆ–å…¶ä»–èµ„æºå¯ä»¥è¢«åŠ è½½ï¼Œä»è€Œå£°æ˜å¯ä¿¡çš„å†…å®¹æ¥æºã€‚</p>
<p>æˆ‘å¯¹æ­¤æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼Œå› ä¸ºæˆ‘æ˜¯ä¸€ä¸ªå®‰å…¨çˆ±å¥½è€…ï¼Œå¤šå¹´æ¥ä¸€ç›´åœ¨ä¸ºå®¢æˆ·é¡¹ç›®éƒ¨ç½² CSPã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTTP%2FGuides%2FCSP" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CSP" ref="nofollow noopener noreferrer">CSP</a> æ˜¯ä¸€ç§å®‰å…¨æ ‡å‡†ï¼Œå¯ä»¥ä¿æŠ¤ä½ çš„ç½‘ç«™å…å—è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰å’Œå…¶ä»–ä»£ç æ³¨å…¥æ”»å‡»ã€‚ä½ è®¾ç½®ä¸€ä¸ª <code>content-security-policy</code> æ ‡å¤´æ¥å£°æ˜å“ªäº›å†…å®¹æ¥æºå¯¹ä½ çš„ç½‘ç«™æ˜¯å¯ä¿¡çš„ï¼Œç„¶åæµè§ˆå™¨ä¼šé˜»æ­¢æ¥è‡ªå…¶ä»–æ¥æºçš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šå£°æ˜åªæœ‰ä½ åŸŸåä¸‹çš„è„šæœ¬æ‰æ˜¯å…è®¸çš„ï¼Œå› æ­¤å¦‚æœæ”»å‡»è€…è®¾æ³•æ³¨å…¥ä¸€ä¸ªæŒ‡å‘ evil.com çš„ <code>&lt;script&gt;</code> æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¼šé˜»æ­¢åŠ è½½å®ƒï¼Œå› ä¸ºè¯¥æ¥æºæœªè¢«ä¿¡ä»»ã€‚</p>
<p>ä»¥å‰ï¼ŒDjango æ²¡æœ‰å†…ç½®çš„ CSP æ”¯æŒï¼Œå¼€å‘äººå‘˜ä¸å¾—ä¸ä¾èµ–äºè‡ªå·±æ„å»ºï¼Œæˆ–è€…ä½¿ç”¨åƒéå¸¸æµè¡Œçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdjango-csp.readthedocs.io%2Fen%2Flatest%2F" target="_blank" title="https://django-csp.readthedocs.io/en/latest/" ref="nofollow noopener noreferrer">django-csp</a> è¿™æ ·çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚ä½†è¿™æœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒæ„å‘³ç€å…¶ä»–ç¬¬ä¸‰æ–¹åŒ…æ— æ³•å¯é åœ°ä¸ CSP é›†æˆï¼Œå› ä¸ºæ²¡æœ‰é€šç”¨çš„ API å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>æ–°çš„ CSP æ”¯æŒæä¾›äº† django-csp æ‰€æœ‰çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶ä¸”å…·æœ‰ç¨å¾®æ•´æ´ä¸€äº›ä¸”æ›´ç¬¦åˆ Django é£æ ¼çš„ APIã€‚è¦å¼€å§‹ä½¿ç”¨ï¼Œ<strong>é¦–å…ˆ</strong> å°† <code>ContentSecurityPolicyMiddleware</code> æ·»åŠ åˆ°ä½ çš„ <code>MIDDLEWARE</code> è®¾ç½®ä¸­ï¼š</p>
<pre><code class="hljs language-python" lang="python">MIDDLEWARE = [
    <span class="hljs-comment"># ...</span>
    <span class="hljs-string">"django.middleware.csp.ContentSecurityPolicyMiddleware"</span>,
    <span class="hljs-comment"># ...</span>
]
</code></pre>
<p>å°†å…¶æ”¾ç½®åœ¨ <code>SecurityMiddleware</code> é™„è¿‘ï¼Œå› ä¸ºå®ƒç±»ä¼¼äºä¸ºæ‰€æœ‰å“åº”æ·»åŠ å®‰å…¨ç›¸å…³æ ‡å¤´ã€‚ï¼ˆä½ ç¡®å®å¯ç”¨äº† <code>SecurityMiddleware</code>ï¼Œå¯¹å§ï¼Ÿï¼‰</p>
<p><strong>å…¶æ¬¡</strong>ï¼Œä½¿ç”¨æ–°çš„è®¾ç½®é…ç½®ä½ çš„ CSP ç­–ç•¥ï¼š</p>
<ul>
<li><code>SECURE_CSP</code>ï¼šé…ç½® <code>content-security-policy</code> æ ‡å¤´ï¼Œè¿™æ˜¯ä½ å®é™…æ‰§è¡Œçš„ç­–ç•¥ã€‚</li>
<li><code>SECURE_CSP_REPORT_ONLY</code>ï¼šé…ç½® <code>content-security-policy-report-only</code> æ ‡å¤´ï¼Œè¿™è®¾ç½®äº†ä¸€ä¸ªéå¼ºåˆ¶ç­–ç•¥ï¼Œæµè§ˆå™¨ä¼šå‘æŒ‡å®šçš„ç«¯ç‚¹æŠ¥å‘Šè¿åç­–ç•¥çš„æƒ…å†µã€‚è¿™ä¸ªé€‰é¡¹å¯¹äºåœ¨å¼ºåˆ¶æ‰§è¡Œç­–ç•¥ä¹‹å‰æµ‹è¯•å’Œç›‘æ§ç­–ç•¥éå¸¸æœ‰ç”¨ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œè¦é‡‡ç”¨ web.dev æ¨èçš„åŸºäº nonce çš„ä¸¥æ ¼ CSPï¼Œä½ å¯ä»¥ä»ä»¥ä¸‹è®¾ç½®å¼€å§‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.utils.csp <span class="hljs-keyword">import</span> CSP

SECURE_CSP_REPORT_ONLY = {
    <span class="hljs-string">"script-src"</span>: [CSP.NONCE, CSP.STRICT_DYNAMIC],
    <span class="hljs-string">"object-src"</span>: [CSP.NONE],
    <span class="hljs-string">"base-uri"</span>: [CSP.NONE],
}
</code></pre>
<p>ä¸Šé¢ä½¿ç”¨çš„ <code>CSP</code> æšä¸¾æä¾›äº† CSP æŒ‡ä»¤çš„å¸¸é‡ï¼Œä»¥å¸®åŠ©é¿å…æ‹¼å†™é”™è¯¯ã€‚</p>
<p>è¿™ä¸ªç­–ç•¥éå¸¸ä¸¥æ ¼ï¼Œå¦‚æœç›´æ¥éƒ¨ç½²ï¼Œä¼šç ´åå¤§å¤šæ•°ç°æœ‰ç½‘ç«™ï¼Œå› ä¸ºå®ƒéœ€è¦ä½¿ç”¨ nonceï¼Œæ¥ä¸‹æ¥ä¼šä»‹ç»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¤ºä¾‹ä¸­æ˜¾ç¤ºä»æŠ¥å‘Šæ¨¡å¼æ ‡å¤´å¼€å§‹ï¼Œä»¥å¸®åŠ©åœ¨å¼ºåˆ¶æ‰§è¡Œç­–ç•¥ä¹‹å‰è·Ÿè¸ªéœ€è¦ä¿®å¤çš„åœ°æ–¹ã€‚ä½ ä¹‹åä¼šå°† <code>SECURE_CSP</code> è®¾ç½®æ”¹ä¸ºå¼ºåˆ¶æ‰§è¡Œç­–ç•¥ã€‚</p>
<p>æ€»ä¹‹ï¼Œè¿™äº›å°±æ˜¯è®¾ç½®æ–°çš„ CSP æ”¯æŒçš„ä¸¤ä¸ªåŸºæœ¬æ­¥éª¤ï¼</p>
<h3 data-id="heading-8">éšæœºæ•°ç”Ÿæˆï¼ˆNonce Generationï¼‰</h3>
<p>æ–°ç‰¹æ€§çš„å…³é”®éƒ¨åˆ†ä¹‹ä¸€æ˜¯ï¼Œå½“ä½¿ç”¨ CSP ä¸­é—´ä»¶æ—¶ï¼ŒDjango ç°åœ¨å†…ç½®äº† <strong>éšæœºæ•°ç”Ÿæˆ</strong> åŠŸèƒ½ã€‚éšæœºæ•°æ˜¯ CSP ä¸­çš„ä¸€ç§å®‰å…¨ç‰¹æ€§ï¼Œå…è®¸ä½ é€šè¿‡åœ¨ <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾ä¸Šä½¿ç”¨ <code>nonce</code> å±æ€§æ¥æ ‡è®°ç‰¹å®šçš„æ ‡ç­¾ä¸ºå¯ä¿¡çš„ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/app.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">"55vsH4w7ATHB85C3MbPr_g"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>éšæœºæ•°å€¼æ˜¯æŒ‰è¯·æ±‚éšæœºç”Ÿæˆçš„ï¼Œå¹¶åŒ…å«åœ¨ CSP æ ‡å¤´ä¸­ã€‚æ‰§è¡Œå†…å®¹æ³¨å…¥çš„æ”»å‡»è€…æ— æ³•çŒœæµ‹éšæœºæ•°ï¼Œå› æ­¤æµè§ˆå™¨å¯ä»¥åªä¿¡ä»»é‚£äº›åŒ…å«æ­£ç¡®éšæœºæ•°çš„æ ‡ç­¾ã€‚å› ä¸ºéšæœºæ•°ç”Ÿæˆç°åœ¨æ˜¯ Django çš„ä¸€éƒ¨åˆ†ï¼Œç¬¬ä¸‰æ–¹åŒ…å¯ä»¥ä¾èµ–å®ƒä¸ºå®ƒä»¬çš„ <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾æä¾›éšæœºæ•°ï¼Œå¦‚æœä½ é‡‡ç”¨å¸¦æœ‰éšæœºæ•°çš„ CSPï¼Œå®ƒä»¬å°†ç»§ç»­å·¥ä½œã€‚</p>
<p>éšæœºæ•°æ˜¯å½“ä»Šä½¿ç”¨ CSP çš„æ¨èæ–¹å¼ï¼Œé¿å…äº†ä»¥å‰åŸºäºå…è®¸åˆ—è¡¨çš„æ–¹æ³•æ‰€å¸¦æ¥çš„é—®é¢˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸Šé¢æ¨èçš„ç­–ç•¥å¯ç”¨äº†éšæœºæ•°ã€‚è¦é‡‡ç”¨åŸºäºéšæœºæ•°çš„ç­–ç•¥ï¼Œä½ éœ€è¦é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä¸º <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾æ·»åŠ éšæœºæ•°å€¼ã€‚</p>
<p><strong>é¦–å…ˆ</strong>ï¼Œå°†æ–°çš„ <code>csp</code> æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨æ·»åŠ åˆ°ä½ çš„ <code>TEMPLATES</code> è®¾ç½®ä¸­ï¼š</p>
<pre><code class="hljs language-python" lang="python">TEMPLATES = [
    {
        <span class="hljs-string">"BACKEND"</span>: <span class="hljs-string">"django.template.backends.django.DjangoTemplates"</span>,
        <span class="hljs-string">"OPTIONS"</span>: {
            <span class="hljs-string">"context_processors"</span>: [
                <span class="hljs-comment"># ...</span>
                <span class="hljs-string">"django.template.context_processors.csp"</span>,
            ],
        },
    },
]
</code></pre>
<p><strong>å…¶æ¬¡</strong>ï¼Œä½¿ç”¨ <code>nonce="{{ csp_nonce }}"</code> ä¸º <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾æ·»åŠ æ³¨é‡Šï¼š</p>
<pre><code class="hljs language-html" lang="html">-   <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{% static 'app.js' %}"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
+   <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{% static 'app.js' %}"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">"{{ csp_nonce }}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¿™å¯èƒ½ä¼šå¾ˆç¹çä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤é¦–å…ˆä½¿ç”¨æŠ¥å‘Šæ¨¡å¼æ¥ç›‘æ§è¿è§„æƒ…å†µå¯èƒ½ä¼šå¾ˆæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ã€‚</p>
<p>æ€»ä¹‹ï¼Œæ­£ç¡®éƒ¨ç½² CSP å¯èƒ½ä¼šæˆä¸ºå¦ä¸€ç¯‡åšæ–‡çš„ä¸»é¢˜ï¼Œç”šè‡³æ˜¯ä¸€æœ¬ä¹¦çš„ç« èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å…ˆè¯´åˆ°è¿™é‡Œã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev%2Farticles%2Fstrict-csp" target="_blank" title="https://web.dev/articles/strict-csp" ref="nofollow noopener noreferrer">web.dev æ–‡ç« </a>å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTTP%2FCSP" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" ref="nofollow noopener noreferrer">MDN CSP æŒ‡å—</a>ã€‚</p>
<h2 data-id="heading-9">é‚®ä»¶ API æ›´æ–°</h2>
<p>Django ä¸­çš„é‚®ä»¶å¤„ç†ç°åœ¨ä½¿ç”¨äº† Python çš„ç°ä»£é‚®ä»¶ APIï¼Œè¯¥ API åœ¨ Python 3.6 ä¸­å¼•å…¥ã€‚è¿™ä¸ªä»¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Femail.message.html%23email.message.EmailMessage" target="_blank" title="https://docs.python.org/3/library/email.message.html#email.message.EmailMessage" ref="nofollow noopener noreferrer"><code>email.message.EmailMessage</code></a> ç±»ä¸ºä¸­å¿ƒçš„ APIï¼Œä¸ºæ’°å†™å’Œå‘é€é‚®ä»¶æä¾›äº†ä¸€ä¸ªæ›´ç®€æ´ä¸”æ”¯æŒ Unicode çš„æ¥å£ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªé‡å¤§å˜åŒ–ï¼Œä½†å¦‚æœä½ çš„é¡¹ç›®åªä½¿ç”¨åŸºæœ¬çš„é‚®ä»¶åŠŸèƒ½ï¼Œå¯èƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚ä½ ä»ç„¶å¯ä»¥åƒä»¥å‰ä¸€æ ·ä½¿ç”¨ Django çš„ <code>send_mail()</code> å‡½æ•°å’Œ <code>EmailMessage</code> ç±»ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> EmailMessage

email = EmailMessage(
    subject=<span class="hljs-string">"ğŸ¼ éœ€è¦æ›´å¤šç«¹å­"</span>,
    body=<span class="hljs-string">"æˆ‘ä»¬çš„ç«¹å­å¿«æ²¡äº†ï¼Œè¯·åœ¨ç†ŠçŒ«å‘ç°ä¹‹å‰è¡¥è´§ï¼"</span>,
    from_email=<span class="hljs-string">"zookeeper@example.com"</span>,
    to=[<span class="hljs-string">"supplies@example.com"</span>],
)
email.attach_file(<span class="hljs-string">"/media/bamboo_cupboard.jpg"</span>)
email.send()
</code></pre>
<p>å…³é”®çš„å˜åŒ–æ˜¯ï¼Œåœ¨ä½ è°ƒç”¨ Django <code>EmailMessage</code> å¯¹è±¡çš„ <code>send()</code> æ–¹æ³•æ—¶ï¼Œå®ƒç°åœ¨ä¼šåœ¨å‘é€ä¹‹å‰å°†è‡ªå·±è½¬æ¢ä¸º Python çš„æ–° <code>email.message.EmailMessage</code> ç±»å‹ã€‚</p>
<p>ç°ä»£åŒ–å¸¦æ¥äº†ä»¥ä¸‹å¥½å¤„ï¼š</p>
<ol>
<li><strong>æ›´å°‘çš„é”™è¯¯</strong>ï¼šPython æ—§é‚®ä»¶ API ä¸­çš„è®¸å¤šè¾¹ç¼˜æƒ…å†µé”™è¯¯å·²åœ¨æ–° API ä¸­ä¿®å¤ã€‚</li>
<li><strong>Django æ›´ç®€æ´</strong>ï¼šDjango é‚®ä»¶ä»£ç ä¸­çš„ä¸€ç³»åˆ—å˜é€šæ–¹æ³•å’Œå®‰å…¨ä¿®å¤å·²è¢«ç§»é™¤ã€‚</li>
<li><strong>æ›´æ–¹ä¾¿çš„ API</strong>ï¼šæ–° API æ”¯æŒä¸€äº›ä¾¿åˆ©åŠŸèƒ½ï¼Œä¾‹å¦‚ä¸‹é¢çš„å†…è”é™„ä»¶ç¤ºä¾‹ã€‚</li>
</ol>
<h3 data-id="heading-10">ä½¿ç”¨ <code>MIMEPart</code> æ›´å®¹æ˜“åœ°æ·»åŠ å†…è”é™„ä»¶</h3>
<p>Django çš„ <code>EmailMessage.attach()</code> æ–¹æ³•å…è®¸ä½ å°†æ–‡ä»¶ä½œä¸ºé™„ä»¶æ·»åŠ ã€‚ç”µå­é‚®ä»¶æ”¯æŒå›¾åƒä½œä¸º <strong>å†…è”é™„ä»¶</strong>ï¼Œè¿™äº›å›¾åƒå¯ä»¥æ˜¾ç¤ºåœ¨ HTML é‚®ä»¶æ­£æ–‡ä¸­ã€‚</p>
<p>è™½ç„¶ä½ ä»¥å‰å¯ä»¥ä½¿ç”¨ <code>EmailMessage.attach()</code> æ·»åŠ å†…è”é™„ä»¶ï¼Œä½†æ“ä½œèµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªé—ç•™ç±»ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨è¯¥æ–¹æ³•å¹¶ä¼ å…¥ä¸€ä¸ª Python çš„ <code>email.message.MIMEPart</code> å¯¹è±¡ï¼Œåœ¨å‡ ä¸ªæ­¥éª¤ä¸­æ·»åŠ å†…è”é™„ä»¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> email.utils
<span class="hljs-keyword">from</span> email.message <span class="hljs-keyword">import</span> MIMEPart
<span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> EmailMultiAlternatives

message = EmailMultiAlternatives(
    subject=<span class="hljs-string">"å¯çˆ±ç†ŠçŒ«è­¦æŠ¥"</span>,
    body=<span class="hljs-string">"è¿™é‡Œæœ‰ä¸€å¼ å¯çˆ±çš„ç†ŠçŒ«ç…§ç‰‡é€ç»™ä½ ï¼"</span>,
    from_email=<span class="hljs-string">"cute@example.com"</span>,
    to=[<span class="hljs-string">"fans@example.com"</span>],
)
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"panda.jpg"</span>, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> f:
    panda_jpeg = f.read()

cid = email.utils.make_msgid()
inline_image = MIMEPart()
inline_image.set_content(
    panda_jpeg,
    maintype=<span class="hljs-string">"image"</span>,
    subtype=<span class="hljs-string">"jpeg"</span>,
    disposition=<span class="hljs-string">"inline"</span>,
    cid=cid,
)
message.attach(inline_image)
message.attach_alternative(
    <span class="hljs-string">f'&lt;h1&gt;å¯çˆ±ç†ŠçŒ«å®å®è­¦æŠ¥ï¼&lt;/h1&gt;&lt;img src="cid:<span class="hljs-subst">{cid[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>]}</span>"&gt;'</span>,
    <span class="hljs-string">"text/html"</span>,
)
</code></pre>
<p>è¿™ä¸ª API å¹¶ä¸ç®€å•ï¼Œä½†å®ƒç¡®å®æä¾›äº†åº•å±‚é‚®ä»¶ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½ï¼Œå¹¶ä¸”æ¯”è¿‡å»çš„æƒ…å†µæ›´å¥½ã€‚</p>
<h2 data-id="heading-11">ä½ç½®å‚æ•°åœ¨ <code>django.core.mail</code> API ä¸­çš„å¼ƒç”¨</h2>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†ä¸»è¦åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸ä¸Šè¿°é‚®ä»¶æ›´æ”¹ç›¸å…³çš„â€œæ¬¡è¦â€æ›´æ”¹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼š</p>
<blockquote>
<p><code>django.core.mail</code> API ç°åœ¨è¦æ±‚å¯¹äºä¸å¤ªå¸¸ç”¨çš„å‚æ•°ä½¿ç”¨å…³é”®å­—å‚æ•°ã€‚ä½¿ç”¨è¿™äº›å‚æ•°çš„ä½ç½®å‚æ•°ç°åœ¨ä¼šå‘å‡ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œå¹¶ä¸”åœ¨å¼ƒç”¨æœŸç»“æŸåå°†å¼•å‘ä¸€ä¸ª <code>TypeError</code>ï¼š</p>
<ul>
<li>æ‰€æœ‰å¯é€‰å‚æ•°ï¼ˆ<code>fail_silently</code> åŠä¹‹åçš„å‚æ•°ï¼‰å¿…é¡»ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™ <code>get_connection()</code>ã€<code>mail_admins()</code>ã€<code>mail_managers()</code>ã€<code>send_mail()</code> å’Œ <code>send_mass_mail()</code>ã€‚</li>
<li>åœ¨åˆ›å»º <code>EmailMessage</code> æˆ– <code>EmailMultiAlternatives</code> å®ä¾‹æ—¶ï¼Œé™¤äº†å‰å››ä¸ªå‚æ•°ï¼ˆ<code>subject</code>ã€<code>body</code>ã€<code>from_email</code> å’Œ <code>to</code>ï¼‰å¯ä»¥ä½œä¸ºä½ç½®å‚æ•°æˆ–å…³é”®å­—å‚æ•°ä¼ é€’å¤–ï¼Œæ‰€æœ‰å…¶ä»–å‚æ•°éƒ½å¿…é¡»ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ã€‚</li>
</ul>
</blockquote>
<p>ä»¥å‰ï¼ŒDjango å…è®¸ä½ å°†æ‰€æœ‰å‚æ•°ä½œä¸ºä½ç½®å‚æ•°ä¼ é€’ï¼Œè¿™åœ¨å‚æ•°åˆ—è¡¨è¾ƒé•¿æ—¶ä¼šæ˜¾å¾—æœ‰äº›æ„šè ¢ä¸”éš¾ä»¥é˜…è¯»ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> send_mail

send_mail(
    <span class="hljs-string">"ğŸ¼ æœ¬å‘¨çš„ç†ŠçŒ«"</span>,
    <span class="hljs-string">"æœ¬å‘¨çš„ç†ŠçŒ«æ˜¯ Po Pingï¼Œsha-sha booeyï¼"</span>,
    <span class="hljs-string">"updates@example.com"</span>,
    [<span class="hljs-string">"adam@example.com"</span>],
    <span class="hljs-literal">True</span>,
)
</code></pre>
<p>æœ€åä¸€ä¸ª <code>True</code> æ²¡æœ‰æä¾›ä»»ä½•çº¿ç´¢ï¼Œé™¤éä½ æŸ¥æ‰¾å‡½æ•°ç­¾åã€‚ç°åœ¨ï¼Œä½¿ç”¨è¿™äº›ä¸å¤ªå¸¸ç”¨çš„å‚æ•°çš„ä½ç½®å‚æ•°ä¼šå‘å‡ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œæç¤ºä½ å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> send_mail

send_mail(
    subject=<span class="hljs-string">"ğŸ¼ æœ¬å‘¨çš„ç†ŠçŒ«"</span>,
    body=<span class="hljs-string">"æœ¬å‘¨çš„ç†ŠçŒ«æ˜¯ Po Pingï¼Œsha-sha booeyï¼"</span>,
    from_email=<span class="hljs-string">"updates@example.com"</span>,
    recipient_list=[<span class="hljs-string">"adam@example.com"</span>],
    fail_silently=<span class="hljs-literal">True</span>,
)
</code></pre>
<p>è¿™ç§å˜åŒ–æœ‰åŠ©äºæé«˜ API çš„æ¸…æ™°åº¦ï¼ŒDjango æ­£åœ¨é€æ­¥æ›´å¤šåœ°ä½¿ç”¨ä»…å…³é”®å­—å‚æ•°ã€‚django-upgrade å¯ä»¥é€šè¿‡å…¶ <code>mail_api_kwargs</code> ä¿®å¤ç¨‹åºè‡ªåŠ¨ä¸ºä½ ä¿®å¤è¿™ä¸€é—®é¢˜ã€‚</p>
<p>å†æ¬¡æ„Ÿè°¢ Mike Edmunds åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F36163" target="_blank" title="https://code.djangoproject.com/ticket/36163" ref="nofollow noopener noreferrer">Ticket #36163</a> ä¸­æ¨åŠ¨äº†è¿™ä¸€æ”¹è¿›ã€‚</p>
<h2 data-id="heading-12">æ‰©å±•è‡ªåŠ¨ <code>shell</code> å¯¼å…¥</h2>
<p>æ¥ä¸‹æ¥ï¼š</p>
<blockquote>
<p>ç°åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>django.conf.settings</code> ç­‰å¸¸ç”¨å·¥å…·ä¼šè‡ªåŠ¨å¯¼å…¥åˆ° shell ä¸­ã€‚</p>
</blockquote>
<p>Django 5.2 çš„ä¸€ä¸ªä¸»è¦åŠŸèƒ½æ˜¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fadamj.eu%2Ftech%2F2025%2F04%2F07%2Fdjango-whats-new-5.2%2F%23automatic-model-imports-in-the-shell" target="_blank" title="https://adamj.eu/tech/2025/04/07/django-whats-new-5.2/#automatic-model-imports-in-the-shell" ref="nofollow noopener noreferrer">shell ä¸­çš„è‡ªåŠ¨æ¨¡å‹å¯¼å…¥</a>ï¼Œä½¿å¾— <code>./manage.py shell</code> è‡ªåŠ¨å¯¼å…¥æ‰€æœ‰æ¨¡å‹ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒDjango 6.0 ç°åœ¨è¿˜å¯¼å…¥äº†å…¶ä»–å¸¸ç”¨å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œ <code>./manage.py shell</code> å¹¶æ·»åŠ  <code>-v 2</code> å‚æ•°æ¥æŸ¥çœ‹å®Œæ•´çš„å¯¼å…¥åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ ./manage.py shell -v 2
6 objects imported automatically:

  from django.conf import settings
  from django.db import connection, models, reset_queries
  from django.db.models import <span class="hljs-built_in">functions</span>
  from django.utils import timezone

...
</code></pre>
<p>ï¼ˆè¿™æ˜¯ä»ä¸€ä¸ªæ²¡æœ‰æ¨¡å‹çš„é¡¹ç›®ä¸­å¾—åˆ°çš„è¾“å‡ºï¼Œå› æ­¤åªåˆ—å‡ºäº†å·¥å…·ã€‚ï¼‰</p>
<p>æ‰€ä»¥ï¼Œè¿™äº›åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>settings</code>ï¼šç”¨äºæ£€æŸ¥è¿è¡Œæ—¶é…ç½®ï¼Œéå¸¸æœ‰ç”¨ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">In [<span class="hljs-number">1</span>]: settings.DEBUG
Out[<span class="hljs-number">1</span>]: <span class="hljs-literal">False</span>
</code></pre>
<ul>
<li><code>connection</code> å’Œ <code>reset_queries()</code>ï¼šéå¸¸é€‚åˆ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Ffaq%2Fmodels%2F%23how-can-i-see-the-raw-sql-queries-django-is-running" target="_blank" title="https://docs.djangoproject.com/en/stable/faq/models/#how-can-i-see-the-raw-sql-queries-django-is-running" ref="nofollow noopener noreferrer">æ£€æŸ¥æ‰§è¡Œçš„æŸ¥è¯¢</a>ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">In [<span class="hljs-number">1</span>]: Book.objects.select_related(<span class="hljs-string">'author'</span>)
Out[<span class="hljs-number">1</span>]: &lt;QuerySet []&gt;

In [<span class="hljs-number">2</span>]: connection.queries
Out[<span class="hljs-number">2</span>]:
[{<span class="hljs-string">'sql'</span>: <span class="hljs-string">'SELECT "example_book"."id", "example_book"."title", "example_book"."author_id", "example_author"."id", "example_author"."name" FROM "example_book" INNER JOIN "example_author" ON ("example_book"."author_id" = "example_author"."id") LIMIT 21'</span>,
    <span class="hljs-string">'time'</span>: <span class="hljs-string">'0.000'</span>}]
</code></pre>
<ul>
<li><code>models</code> å’Œ <code>functions</code>ï¼šå¯¹äºé«˜çº§ ORM å·¥ä½œéå¸¸æœ‰ç”¨ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">In [<span class="hljs-number">1</span>]: Book.objects.annotate(
     ...:   title_lower=functions.Lower(<span class="hljs-string">"title"</span>)
     ...: ).<span class="hljs-built_in">filter</span>(
     ...:   title_lower__startswith=<span class="hljs-string">"a"</span>
     ...: ).count()
Out[<span class="hljs-number">1</span>]: <span class="hljs-number">71</span>
</code></pre>
<ul>
<li><code>timezone</code>ï¼šç”¨äºä½¿ç”¨ Django çš„æ—¶åŒºæ„ŸçŸ¥æ—¥æœŸå’Œæ—¶é—´å·¥å…·ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">In [<span class="hljs-number">1</span>]: timezone.now()
Out[<span class="hljs-number">1</span>]: datetime.datetime(<span class="hljs-number">2025</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">23</span>, <span class="hljs-number">42</span>, <span class="hljs-number">22</span>, <span class="hljs-number">558418</span>, tzinfo=datetime.timezone.utc)
</code></pre>
<p>ä»ç„¶å¯ä»¥æŒ‰ç…§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Fhowto%2Fcustom-shell%2F" target="_blank" title="https://docs.djangoproject.com/en/stable/howto/custom-shell/" ref="nofollow noopener noreferrer">å¦‚ä½•è‡ªå®šä¹‰ <code>shell</code> å‘½ä»¤</a> æ–‡æ¡£é¡µé¢ä¸­æ‰€è¿°ï¼Œæ‰©å±•è‡ªåŠ¨å¯¼å…¥å†…å®¹ã€‚</p>
<p>Salvo Polizzi åœ¨ Django 5.2 ä¸­è´¡çŒ®äº†åŸå§‹çš„è‡ªåŠ¨ shell å¯¼å…¥åŠŸèƒ½ã€‚ç„¶åï¼Œä»–åœ¨ Django 6.0 ä¸­åˆå›æ¥æä¾›äº†è¿™äº›é¢å¤–çš„å¯¼å…¥ï¼Œåœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F35680" target="_blank" title="https://code.djangoproject.com/ticket/35680" ref="nofollow noopener noreferrer">Ticket #35680</a> ä¸­ã€‚æ„Ÿè°¢å‚ä¸è®ºå›è®¨è®ºå¹¶è¾¾æˆä¸€è‡´æ„è§çš„æ¯ä¸ªäººï¼Œä»¥åŠ Natalia Bidart å’Œ Sarah Boyce çš„å®¡æŸ¥ï¼</p>
<h2 data-id="heading-13">ä¿å­˜æ—¶åŠ¨æ€å­—æ®µåˆ·æ–°</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬è®¨è®ºä¸€ç³»åˆ— ORM æ”¹è¿›ï¼Œä»è¿™ä¸ªé‡å¤§æ”¹è¿›å¼€å§‹ï¼š</p>
<blockquote>
<p>åœ¨æ”¯æŒ <code>RETURNING</code> å­å¥çš„åç«¯ï¼ˆSQLiteã€PostgreSQL å’Œ Oracleï¼‰ä¸Šï¼Œ<code>GeneratedField</code> å’Œè¢«èµ‹å€¼ä¸ºè¡¨è¾¾å¼çš„å­—æ®µåœ¨è°ƒç”¨ <code>save()</code> ä¹‹åä¼šä»æ•°æ®åº“ä¸­åˆ·æ–°ã€‚åœ¨ä¸æ”¯æŒå®ƒçš„åç«¯ï¼ˆMySQL å’Œ MariaDBï¼‰ä¸Šï¼Œå­—æ®µä¼šè¢«æ ‡è®°ä¸ºå»¶è¿ŸåŠ è½½ï¼Œä»¥åœ¨åç»­è®¿é—®æ—¶è§¦å‘åˆ·æ–°ã€‚</p>
</blockquote>
<p>Django æ¨¡å‹æ”¯æŒåœ¨ä¸‰ç§æƒ…å†µä¸‹è®©æ•°æ®åº“ä¸ºä½ ç”Ÿæˆå­—æ®µå€¼ï¼š</p>
<ol>
<li><code>db_default</code> å­—æ®µé€‰é¡¹ï¼Œå®ƒå…è®¸æ•°æ®åº“åœ¨åˆ›å»ºå®ä¾‹æ—¶ç”Ÿæˆé»˜è®¤å€¼ï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.db.models.functions <span class="hljs-keyword">import</span> Now

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Video</span>(models.Model):
    ...
    created = models.DateTimeField(db_default=Now())
</code></pre>
<ol start="2">
<li><code>GeneratedField</code> å­—æ®µç±»å‹ï¼Œå®ƒå§‹ç»ˆåŸºäºåŒä¸€å®ä¾‹ä¸­çš„å…¶ä»–å­—æ®µç”±æ•°æ®åº“è®¡ç®—å¾—å‡ºï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.db.models.functions <span class="hljs-keyword">import</span> Concat

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Video</span>(models.Model):
    ...
    full_title = models.GeneratedField(
        models.TextField(),
        expression=Concat(
            <span class="hljs-string">"title"</span>,
            models.Value(<span class="hljs-string">" - "</span>),
            <span class="hljs-string">"subtitle"</span>,
        ),
    )
</code></pre>
<ol start="3">
<li>åœ¨ä¿å­˜ä¹‹å‰ä¸ºå­—æ®µåˆ†é…è¡¨è¾¾å¼å€¼ï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.db.models.functions <span class="hljs-keyword">import</span> Now

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Video</span>(models.Model):
    ...
    last_updated = models.DateTimeField()

video = Video.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)
...
video.last_updated = Now()
video.save()
</code></pre>
<p>ä»¥å‰ï¼Œåªæœ‰ç¬¬ä¸€ç§æ–¹æ³•ï¼ˆä½¿ç”¨ <code>db_default</code>ï¼‰ä¼šåœ¨ä¿å­˜åä»æ•°æ®åº“ä¸­åˆ·æ–°å­—æ®µå€¼ã€‚å…¶ä»–ä¸¤ç§æ–¹æ³•ä¼šç•™ä¸‹æ—§å€¼æˆ–è¡¨è¾¾å¼å¯¹è±¡ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ éœ€è¦è·å–æ›´æ–°åçš„å€¼ï¼Œå°±éœ€è¦è°ƒç”¨ <code>Model.refresh_from_db()</code>ã€‚è¿™å¾ˆéš¾è®°ä½ï¼Œå¹¶ä¸”ä¼šé¢å¤–äº§ç”Ÿä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ã€‚</p>
<p>ç°åœ¨ï¼ŒDjango åˆ©ç”¨ <code>RETURNING</code> SQL å­å¥åœ¨æ”¯æŒå®ƒçš„åç«¯ï¼ˆSQLiteã€PostgreSQL å’Œ Oracleï¼‰ä¸Šä¿å­˜æ¨¡å‹å®ä¾‹ï¼Œå¹¶åœ¨å•ä¸ªæŸ¥è¯¢ä¸­è·å–æ›´æ–°åçš„åŠ¨æ€å­—æ®µå€¼ã€‚<code>save()</code> è°ƒç”¨ç°åœ¨å¯èƒ½ä¼šå‘å‡ºå¦‚ä¸‹æŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> "example_video"
<span class="hljs-keyword">SET</span> "last_updated" <span class="hljs-operator">=</span> NOW()
<span class="hljs-keyword">WHERE</span> "example_video"."id" <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
RETURNING "example_video"."last_updated"
</code></pre>
<p>Django å°†è¿”å›å€¼æ”¾å…¥æ¨¡å‹å­—æ®µä¸­ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä¿å­˜åç«‹å³è¯»å–å®ƒï¼š</p>
<pre><code class="hljs language-python" lang="python">video = Video.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)
...
video.last_updated = Now()
video.save()
<span class="hljs-built_in">print</span>(video.last_updated)  <span class="hljs-comment"># æ•°æ®åº“ä¸­çš„æ›´æ–°å€¼</span>
</code></pre>
<p>åœ¨ä¸æ”¯æŒ <code>RETURNING</code>ï¼ˆMySQL å’Œ MariaDBï¼‰çš„åç«¯ä¸Šï¼ŒDjango ç°åœ¨ä¼šåœ¨ä¿å­˜åå°†åŠ¨æ€å­—æ®µæ ‡è®°ä¸ºå»¶è¿ŸåŠ è½½ã€‚è¿™æ ·ï¼Œåç»­è®¿é—®ï¼ˆå¦‚ä¸Šé¢çš„ç¤ºä¾‹ï¼‰å°†è‡ªåŠ¨è°ƒç”¨ <code>Model.refresh_from_db()</code>ã€‚è¿™ç¡®ä¿äº†ä½ æ€»æ˜¯è¯»å–æ›´æ–°åçš„å€¼ï¼Œå³ä½¿è¿™ä¼šé¢å¤–äº§ç”Ÿä¸€ä¸ªæŸ¥è¯¢ã€‚</p>
<h3 data-id="heading-14">å†å²</h3>
<p>è¿™ä¸ªåŠŸèƒ½åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F27222" target="_blank" title="https://code.djangoproject.com/ticket/27222" ref="nofollow noopener noreferrer">Ticket #27222</a> ä¸­äº 2016 å¹´è¢«æå‡ºï¼Œç”± Anssi KÃ¤Ã¤riÃ¤inen æå‡ºã€‚åœ¨è¿‡å»çš„ä¹å¹´ä¸­ï¼Œè¿™ä¸ªæè®®å¤§éƒ¨åˆ†æ—¶é—´éƒ½å¤„äºä¼‘çœ çŠ¶æ€ï¼Œä½† ORM è´Ÿè´£äºº Simon Charette ä»Šå¹´æ—©äº›æ—¶å€™æ¥æ‰‹äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå®ç°æ–¹æ¡ˆï¼Œå¹¶å°†å…¶æ¨åŠ¨å®Œæˆã€‚æ„Ÿè°¢ Simon ç»§ç»­æ¨åŠ¨ ORM çš„å‘å±•ï¼Œä»¥åŠæ‰€æœ‰å‚ä¸å®¡æŸ¥çš„äººå‘˜ï¼šDavid Sandersã€Jacob Wallsã€Mariusz Felisiakã€nessitaã€Paolo Melchiorreã€Simon Charette å’Œ Tim Grahamã€‚</p>
<h2 data-id="heading-15">é€šç”¨ <code>StringAgg</code> èšåˆå‡½æ•°</h2>
<p>æ¥ä¸‹æ¥æ˜¯ ORM çš„å¦ä¸€ä¸ªå˜åŒ–ï¼š</p>
<blockquote>
<p>æ–°çš„ <code>StringAgg</code> èšåˆå‡½æ•°å°†è¾“å…¥å€¼è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥ <code>delimiter</code> å­—ç¬¦ä¸²åˆ†éš”ã€‚è¿™ä¸ªèšåˆå‡½æ•°ä»¥å‰ä»…æ”¯æŒ PostgreSQLã€‚</p>
</blockquote>
<p>è¿™ä¸ªèšåˆå‡½æ•°é€šå¸¸ç”¨äºç”Ÿæˆç›¸å…³é¡¹ç›®çš„é€—å·åˆ†éš”åˆ—è¡¨ç­‰ã€‚ä»¥å‰ï¼Œå®ƒä»…ä½œä¸º <code>django.contrib.postgres</code> çš„ä¸€éƒ¨åˆ†æ”¯æŒ PostgreSQLï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.contrib.postgres.aggregates <span class="hljs-keyword">import</span> StringAgg
<span class="hljs-keyword">from</span> example.models <span class="hljs-keyword">import</span> Video

videos = Video.objects.annotate(
    chapter_ids=StringAgg(<span class="hljs-string">"chapter"</span>, delimiter=<span class="hljs-string">","</span>),
)

<span class="hljs-keyword">for</span> video <span class="hljs-keyword">in</span> videos:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Video <span class="hljs-subst">{video.<span class="hljs-built_in">id</span>}</span> has chapters: <span class="hljs-subst">{video.chapter_ids}</span>"</span>)
</code></pre>
<p>è¿™å¯èƒ½ä¼šè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Video</span> <span class="hljs-number">104</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">chapters</span>: <span class="hljs-number">71</span>,<span class="hljs-number">72</span>,<span class="hljs-number">74</span>
<span class="hljs-selector-tag">Video</span> <span class="hljs-number">107</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">chapters</span>: <span class="hljs-number">88</span>,<span class="hljs-number">89</span>,<span class="hljs-number">138</span>,<span class="hljs-number">90</span>,<span class="hljs-number">91</span>,<span class="hljs-number">93</span>
</code></pre>
<p>ç°åœ¨ï¼Œè¿™ä¸ªèšåˆå‡½æ•°å·²ç»å¯ä»¥åœ¨ Django æ”¯æŒçš„æ‰€æœ‰æ•°æ®åº“åç«¯ä¸­ä½¿ç”¨ï¼Œä» <code>django.db.models</code> ä¸­å¯¼å…¥ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> StringAgg, Value
<span class="hljs-keyword">from</span> example.models <span class="hljs-keyword">import</span> Video

videos = Video.objects.annotate(
    chapter_ids=StringAgg(<span class="hljs-string">"chapter"</span>, delimiter=Value(<span class="hljs-string">","</span>)),
)

<span class="hljs-keyword">for</span> video <span class="hljs-keyword">in</span> videos:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Video <span class="hljs-subst">{video.<span class="hljs-built_in">id</span>}</span> has chapters: <span class="hljs-subst">{video.chapter_ids}</span>"</span>)
</code></pre>
<p>æ³¨æ„ï¼Œ<code>delimiter</code> å‚æ•°ç°åœ¨éœ€è¦ä¸€ä¸ª <code>Value()</code> è¡¨è¾¾å¼åŒ…è£…å™¨æ¥å¤„ç†å­—é¢å­—ç¬¦ä¸²ï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚è¿™ç§å˜åŒ–å…è®¸ä½ ä½¿ç”¨æ•°æ®åº“å‡½æ•°æˆ–å­—æ®µä½œä¸ºåˆ†éš”ç¬¦ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚</p>
<p>è™½ç„¶å¤§å¤šæ•° Django é¡¹ç›®éƒ½ä½¿ç”¨ PostgreSQLï¼Œä½†åœ¨æ‰€æœ‰åç«¯ä¸Šæä¾›è¿™ä¸ªèšåˆå‡½æ•°æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ”¹è¿›ï¼Œå®ƒæé«˜äº†è·¨æ•°æ®åº“çš„å…¼å®¹æ€§ï¼Œå¹¶ä¸”æ„å‘³ç€ç¬¬ä¸‰æ–¹åŒ…å¯ä»¥ä½¿ç”¨å®ƒè€Œä¸ä¼šå½±å“å…¶æ•°æ®åº“æ”¯æŒã€‚</p>
<h3 data-id="heading-16">å†å²</h3>
<p>PostgreSQL ç‰¹æœ‰çš„ <code>StringAgg</code> æœ€æ—©åœ¨ Django 1.9ï¼ˆ2015 å¹´ï¼‰ç”± Andriy Sokolovskiy æ·»åŠ ï¼Œè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F24301" target="_blank" title="https://code.djangoproject.com/ticket/24301" ref="nofollow noopener noreferrer">Ticket #24301</a>ã€‚åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F35444" target="_blank" title="https://code.djangoproject.com/ticket/35444" ref="nofollow noopener noreferrer">Ticket #35444</a> ä¸­ï¼ŒChris Muthig æå‡ºäº†æ·»åŠ  <code>Aggregate.order_by</code> é€‰é¡¹ï¼Œè¿™æ˜¯ <code>StringAgg</code> ç”¨æ¥æŒ‡å®šè¿æ¥å…ƒç´ é¡ºåºçš„é€‰é¡¹ï¼Œè€Œä½œä¸ºå‰¯ä½œç”¨ï¼Œè¿™ä¹Ÿä½¿å¾—å°† <code>StringAgg</code> æ¨å¹¿åˆ°æ‰€æœ‰åç«¯æˆä¸ºå¯èƒ½ã€‚</p>
<p>æ„Ÿè°¢ Chris æå‡ºå¹¶å®ç°äº†è¿™ä¸€å˜åŒ–ï¼Œä»¥åŠæ‰€æœ‰å‚ä¸å®¡æŸ¥çš„äººå‘˜ï¼šPaolo Melchiorreã€Sarah Boyce å’Œ Simon Charetteã€‚</p>
<h2 data-id="heading-17"><code>BigAutoField</code> ä½œä¸ºé»˜è®¤ä¸»é”®ç±»å‹</h2>
<p>æ¥ä¸‹æ¥ï¼š</p>
<blockquote>
<p><code>DEFAULT_AUTO_FIELD</code> è®¾ç½®çš„é»˜è®¤å€¼ç°åœ¨æ”¹ä¸º <code>BigAutoField</code>ã€‚</p>
</blockquote>
<p>è¿™ä¸€é‡è¦å˜åŒ–æœ‰åŠ©äºé”å®šæ›´å¤§è§„æ¨¡çš„å¯æ‰©å±•ä¸»é”®ã€‚</p>
<p>Django 3.2ï¼ˆ2021 å¹´ï¼‰å¼•å…¥äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Fref%2Fsettings%2F%23default-auto-field" target="_blank" title="https://docs.djangoproject.com/en/stable/ref/settings/#default-auto-field" ref="nofollow noopener noreferrer">DEFAULT_AUTO_FIELD è®¾ç½®</a>ï¼Œç”¨äºæ›´æ”¹æ¨¡å‹ä¸­ä½¿ç”¨çš„é»˜è®¤ä¸»é”®ç±»å‹ã€‚Django ä½¿ç”¨è¿™ä¸ªè®¾ç½®ä¸ºæœªæ˜¾å¼å®šä¹‰ä¸»é”®å­—æ®µçš„æ¨¡å‹æ·»åŠ ä¸€ä¸ªåä¸º <code>id</code> çš„ä¸»é”®å­—æ®µã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å®šä¹‰äº†ä¸€ä¸ªæ¨¡å‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Video</span>(models.Model):
    title = models.TextField()
</code></pre>
<p>é‚£ä¹ˆå®ƒå°†æœ‰ä¸¤ä¸ªå­—æ®µï¼š<code>id</code> å’Œ <code>title</code>ï¼Œå…¶ä¸­ <code>id</code> ä½¿ç”¨ <code>DEFAULT_AUTO_FIELD</code> å®šä¹‰çš„ç±»å‹ã€‚</p>
<p>è¿™ä¸ªè®¾ç½®ä¹Ÿå¯ä»¥é€šè¿‡åœ¨åº”ç”¨çš„ <code>apps.py</code> æ–‡ä»¶ä¸­å®šä¹‰ <code>AppConfig.default_auto_field</code> æ¥åœ¨æ¯ä¸ªåº”ç”¨çš„åŸºç¡€ä¸Šè¦†ç›–ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.apps <span class="hljs-keyword">import</span> AppConfig

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelConfig</span>(<span class="hljs-title class_ inherited__">AppConfig</span>):
    name = <span class="hljs-string">"channel"</span>
    default_auto_field = <span class="hljs-string">"django.db.models.BigAutoField"</span>
</code></pre>
<p>æ·»åŠ è¿™ä¸ªè®¾ç½®çš„ä¸€ä¸ªä¸»è¦åŠ¨æœºæ˜¯å…è®¸é¡¹ç›®ä» <code>AutoField</code>ï¼ˆ32 ä½æ•´æ•°ï¼‰åˆ‡æ¢åˆ° <code>BigAutoField</code>ï¼ˆ64 ä½æ•´æ•°ï¼‰ä½œä¸ºä¸»é”®ï¼Œè€Œæ— éœ€æ›´æ”¹æ¯ä¸ªæ¨¡å‹ã€‚<code>AutoField</code> å¯ä»¥å­˜å‚¨çš„å€¼æœ€å¤šçº¦ä¸º 21 äº¿ï¼Œè™½ç„¶å¬èµ·æ¥å¾ˆå¤§ï¼Œä½†åœ¨å¤§è§„æ¨¡åº”ç”¨ä¸­å¾ˆå®¹æ˜“è¾¾åˆ°ã€‚<code>BigAutoField</code> å¯ä»¥å­˜å‚¨çš„å€¼æœ€å¤šçº¦ä¸º 92 äº¬ï¼Œè¿™åœ¨å®é™…ç”¨é€”ä¸­æ˜¯â€œç»°ç»°æœ‰ä½™â€çš„ã€‚</p>
<p>å¦‚æœä½¿ç”¨ <code>AutoField</code> çš„æ¨¡å‹è¾¾åˆ°äº†å…¶æœ€å¤§å€¼ï¼Œå®ƒå°†æ— æ³•å†æ¥å—æ–°è¡Œï¼Œè¿™ä¸ªé—®é¢˜è¢«ç§°ä¸º <strong>ä¸»é”®è€—å°½</strong>ã€‚è¯¥è¡¨å®é™…ä¸Šè¢«é˜»å¡äº†ï¼Œéœ€è¦é€šè¿‡é”å®šæ•°æ®åº“è¿ç§»åœ¨å¤§å‹è¡¨ä¸Šç´§æ€¥å°†æ¨¡å‹ä» <code>AutoField</code> åˆ‡æ¢åˆ° <code>BigAutoField</code>ã€‚å…³äº Kraken å¦‚ä½•ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è§‚çœ‹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DkZ4q0k_FNhw" target="_blank" title="https://www.youtube.com/watch?v=kZ4q0k_FNhw" ref="nofollow noopener noreferrer">Tim Bell åœ¨ 2025 å¹´ DjangoCon Europe çš„æ¼”è®²</a>ï¼Œå…¶ä¸­è¯¦ç»†ä»‹ç»äº†ä¸»åŠ¨è¿ç§»å¤§å‹è¡¨ä»¥å‡å°‘åœæœºæ—¶é—´çš„ä¸€äº›å·§å¦™æŠ€æœ¯ã€‚</p>
<p>ä¸ºäº†é¿å…æ–°é¡¹ç›®å‡ºç°è¿™ä¸ªé—®é¢˜ï¼ŒDjango 3.2 ä½¿å¾—é€šè¿‡ <code>startproject</code> åˆ›å»ºçš„æ–°é¡¹ç›®å°† <code>DEFAULT_AUTO_FIELD</code> è®¾ç½®ä¸º <code>BigAutoField</code>ï¼Œå¹¶ä¸”é€šè¿‡ <code>startapp</code> åˆ›å»ºçš„æ–°åº”ç”¨å°†å®ƒä»¬çš„ <code>AppConfig.default_auto_field</code> è®¾ç½®ä¸º <code>BigAutoField</code>ã€‚å®ƒè¿˜æ·»åŠ äº†ä¸€ä¸ªç³»ç»Ÿæ£€æŸ¥ï¼Œä»¥ç¡®ä¿é¡¹ç›®æ˜¾å¼è®¾ç½® <code>DEFAULT_AUTO_FIELD</code>ï¼Œä»¥ç¡®ä¿ç”¨æˆ·äº†è§£è¯¥åŠŸèƒ½å¹¶èƒ½å¤Ÿåšå‡ºæ˜æ™ºçš„é€‰æ‹©ã€‚</p>
<p>ç°åœ¨ï¼ŒDjango 6.0 å°†è®¾ç½®å’Œåº”ç”¨é…ç½®å±æ€§çš„å®é™…é»˜è®¤å€¼æ”¹ä¸º <code>BigAutoField</code>ã€‚ä½¿ç”¨ <code>BigAutoField</code> çš„é¡¹ç›®å¯ä»¥ç§»é™¤è¯¥è®¾ç½®ï¼š</p>
<pre><code class="hljs language-python" lang="python">-DEFAULT_AUTO_FIELD = <span class="hljs-string">"django.db.models.BigAutoField"</span>
</code></pre>
<p>ä»¥åŠåº”ç”¨é…ç½®å±æ€§ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.apps <span class="hljs-keyword">import</span> AppConfig

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelConfig</span>(<span class="hljs-title class_ inherited__">AppConfig</span>):
    name = <span class="hljs-string">"channel"</span>
-    default_auto_field = <span class="hljs-string">"django.db.models.BigAutoField"</span>
</code></pre>
<p>é»˜è®¤çš„ <code>startproject</code> å’Œ <code>startapp</code> æ¨¡æ¿ä¹Ÿä¸å†è®¾ç½®è¿™äº›å€¼ã€‚è¿™ä¸€å˜åŒ–å‡å°‘äº†æ–°é¡¹ç›®çš„æ ·æ¿ä»£ç ï¼Œä¸»é”®è€—å°½é—®é¢˜ä¹Ÿå°†é€æ¸æˆä¸ºå†å²ï¼Œæˆä¸ºå¤§å¤šæ•° Django ç”¨æˆ·ä¸å†éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-18">å†å²</h3>
<p>åœ¨ Django 3.2 ä¸­æ·»åŠ  <code>DEFAULT_AUTO_FIELD</code> æ˜¯ç”± Caio Ariede æå‡ºå¹¶ç”± Tom Forbes å®ç°çš„ï¼Œè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F31007" target="_blank" title="https://code.djangoproject.com/ticket/31007" ref="nofollow noopener noreferrer">Ticket #31007</a>ã€‚Django 6.0 ä¸­çš„è¿™ä¸€æ–°å˜åŒ–æ˜¯ç”±å‰ Fellow Tim Graham æå‡ºå¹¶å®ç°çš„ï¼Œè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F36564" target="_blank" title="https://code.djangoproject.com/ticket/36564" ref="nofollow noopener noreferrer">Ticket #36564</a>ã€‚æ„Ÿè°¢ Tim å‘ç°ç°åœ¨å¯ä»¥è¿›è¡Œè¿™ä¸€æ¸…ç†å·¥ä½œï¼Œä»¥åŠ Jacob Walls å’Œ Clifford Gama çš„å®¡æŸ¥ï¼</p>
<h2 data-id="heading-19">æ¨¡æ¿å˜é‡ <code>forloop.length</code></h2>
<p>ç»§ç»­æ¥çœ‹æ¨¡æ¿æ–¹é¢çš„æ”¹è¿›ï¼Œé¦–å…ˆæ˜¯è¿™ä¸ªå°è€Œå®ç”¨çš„æ–°å¢åŠŸèƒ½ï¼š</p>
<blockquote>
<p>åœ¨ <code>for</code> å¾ªç¯ä¸­ç°åœ¨å¯ä»¥ä½¿ç”¨æ–°çš„å˜é‡ <code>forloop.length</code>ã€‚</p>
</blockquote>
<p>è¿™ä¸€å°æ‰©å±•ä½¿å¾—ä½ å¯ä»¥ç¼–å†™å¦‚ä¸‹æ¨¡æ¿å¾ªç¯ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
  {% for goose in geese %}
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{{ forloop.counter }}/{{ forloop.length }}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>: {{ goose.name }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  {% endfor %}
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>ä»¥å‰ï¼Œä½ éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼å¼•ç”¨é•¿åº¦ï¼Œä¾‹å¦‚ <code>{{ geese|length }}</code>ï¼Œè¿™ç¨æ˜¾ä¸å¤Ÿçµæ´»ã€‚</p>
<p>æ„Ÿè°¢ Jonathan StrÃ¶bele åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F36186" target="_blank" title="https://code.djangoproject.com/ticket/36186" ref="nofollow noopener noreferrer">Ticket #36186</a> ä¸­è´¡çŒ®äº†è¿™ä¸ªæƒ³æ³•å’Œå®ç°ï¼Œä»¥åŠ David Smithã€Paolo Melchiorre å’Œ Sarah Boyce çš„å®¡æŸ¥ã€‚</p>
<h2 data-id="heading-20"><code>querystring</code> æ¨¡æ¿æ ‡ç­¾å¢å¼º</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Fref%2Ftemplates%2Fbuiltins%2F%23django-template" target="_blank" title="https://docs.djangoproject.com/en/stable/ref/templates/builtins/#django-template" ref="nofollow noopener noreferrer">Django 5.1 ä¸­å¼•å…¥çš„ <code>querystring</code> æ¨¡æ¿æ ‡ç­¾</a> ç”¨äºå¸®åŠ©æ„å»ºä¿®æ”¹å½“å‰è¯·æ±‚æŸ¥è¯¢å‚æ•°çš„é“¾æ¥ï¼Œç°åœ¨æœ‰äº†ä¸¤ä¸ªæ‰©å±•ã€‚</p>
<ol>
<li>å‘è¡Œè¯´æ˜ï¼š</li>
</ol>
<blockquote>
<p><code>querystring</code> æ¨¡æ¿æ ‡ç­¾ç°åœ¨å§‹ç»ˆåœ¨è¿”å›çš„æŸ¥è¯¢å­—ç¬¦ä¸²å‰åŠ ä¸Š <code>?</code>ï¼Œç¡®ä¿é“¾æ¥ç”Ÿæˆè¡Œä¸ºçš„å¯é æ€§ã€‚</p>
</blockquote>
<p>è¿™ä¸€å°å˜åŒ–æ”¹è¿›äº†åœ¨æä¾›ç©ºæŸ¥è¯¢å‚æ•°æ˜ å°„æ—¶æ ‡ç­¾çš„è¡Œä¸ºã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªæ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-django" lang="django">&lt;a href="{% querystring params %}"&gt;Reset search&lt;/a&gt;
</code></pre>
<p>å…¶ä¸­ <code>params</code> æ˜¯ä¸€ä¸ªå¯èƒ½æœ‰æ—¶ä¸ºç©ºçš„å­—å…¸ã€‚ä»¥å‰ï¼Œå¦‚æœ <code>params</code> ä¸ºç©ºï¼Œè¾“å‡ºå°†æ˜¯ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">""</span>&gt;</span>Reset search<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>æµè§ˆå™¨ä¼šå°†æ­¤è§†ä¸ºæŒ‡å‘ç›¸åŒ URLï¼ˆåŒ…æ‹¬æŸ¥è¯¢å‚æ•°ï¼‰çš„é“¾æ¥ï¼Œå› æ­¤ä¸ä¼šæ¸…é™¤æŸ¥è¯¢å‚æ•°ï¼Œè¿™ä¸é¢„æœŸä¸ç¬¦ã€‚ç°åœ¨ï¼Œæœ‰äº†è¿™ä¸€å˜åŒ–ï¼Œè¾“å‡ºå°†æ˜¯ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"?"</span>&gt;</span>Reset search<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>æµè§ˆå™¨ä¼šå°† <code>?</code> è§†ä¸ºæŒ‡å‘ç›¸åŒ URLï¼ˆä¸å¸¦ä»»ä½•æŸ¥è¯¢å‚æ•°ï¼‰çš„é“¾æ¥ï¼Œä»è€Œæ¸…é™¤æŸ¥è¯¢å‚æ•°ï¼Œç¬¦åˆç”¨æˆ·çš„æœŸæœ›ã€‚</p>
<p>æ„Ÿè°¢ Django Fellow Sarah Boyce å‘ç°è¿™ä¸€æ”¹è¿›å¹¶å®ç°äº†ä¿®å¤ï¼Œè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F36268" target="_blank" title="https://code.djangoproject.com/ticket/36268" ref="nofollow noopener noreferrer">Ticket #36268</a>ï¼Œä»¥åŠ Django Fellow Natalia Bidart çš„å®¡æŸ¥ï¼</p>
<ol start="2">
<li>å‘è¡Œè¯´æ˜ï¼š</li>
</ol>
<blockquote>
<p><code>querystring</code> æ¨¡æ¿æ ‡ç­¾ç°åœ¨å¯ä»¥æ¥å—å¤šä¸ªä½ç½®å‚æ•°ï¼Œè¿™äº›å‚æ•°å¿…é¡»æ˜¯æ˜ å°„ï¼Œä¾‹å¦‚ <code>QueryDict</code> æˆ– <code>dict</code>ã€‚</p>
</blockquote>
<p>è¿™ä¸€å¢å¼ºåŠŸèƒ½å…è®¸æ ‡ç­¾åœ¨æ„å»ºè¾“å‡ºæ—¶åˆå¹¶å¤šä¸ªæŸ¥è¯¢å‚æ•°æ¥æºã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªæ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-django" lang="django">&lt;a href="{% querystring request.GET super_search_params %}"&gt;Super search&lt;/a&gt;
</code></pre>
<p>å…¶ä¸­ <code>super_search_params</code> æ˜¯ä¸€ä¸ªåŒ…å«é¢å¤–å‚æ•°çš„å­—å…¸ï¼Œç”¨äºå°†å½“å‰æœç´¢å‡çº§ä¸ºâ€œè¶…çº§æœç´¢â€ã€‚è¯¥æ ‡ç­¾ä¼šåˆå¹¶è¿™ä¸¤ä¸ªæ˜ å°„ï¼Œå¯¹äºé‡å¤çš„é”®ï¼Œåé¢çš„æ˜ å°„å°†ä¼˜å…ˆã€‚</p>
<p>å†æ¬¡æ„Ÿè°¢ Sarah Boyce åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F35529" target="_blank" title="https://code.djangoproject.com/ticket/35529" ref="nofollow noopener noreferrer">Ticket #35529</a> ä¸­æå‡ºè¿™ä¸€æ”¹è¿›ï¼ŒGiannis Terzopoulos å®ç°äº†å®ƒï¼Œä»¥åŠ Natalia Bidartã€Sarah Boyce å’Œ Tom Carrick çš„å®¡æŸ¥ï¼</p>
<h2 data-id="heading-21">ç»“è¯­</h2>
<p>ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡ Django 6.0 çš„äº®ç‚¹æ€»ç»“ï¼æ„Ÿè°¢ä½ çš„é˜…è¯»ã€‚æ›´å¤šå˜åŒ–å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Freleases%2F6.0%2F" target="_blank" title="https://docs.djangoproject.com/en/stable/releases/6.0/" ref="nofollow noopener noreferrer">å‘è¡Œè¯´æ˜</a> ä¸­æŸ¥çœ‹ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰è®¸å¤šæœªè¿›å…¥å‘è¡Œè¯´æ˜çš„å¹•åæ”¹è¿›å’Œé”™è¯¯ä¿®å¤ã€‚ä¼˜åŒ–å’Œå¾®å°æ”¹è¿›ä¸€ç›´åœ¨è¢«åˆå¹¶ï¼Œæ‰€ä»¥ä¸è¦å»¶è¿Ÿï¼Œç°åœ¨å°±å‡çº§å§ï¼</p>
<p>æ„Ÿè°¢ä¸º Django 6.0 è´¡çŒ®çš„ <strong>174 äºº</strong>ï¼Œè¿™ä¸€æ•°å­—ç”± Mariusz Felisiak åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgist.github.com%2Ffelixxm%2F99501cdbf6ed5a69295b4cb3f8c21d80" target="_blank" title="https://gist.github.com/felixxm/99501cdbf6ed5a69295b4cb3f8c21d80" ref="nofollow noopener noreferrer">æ­¤åˆ—è¡¨</a> ä¸­ç»Ÿè®¡ã€‚</p>
<p>æ„¿ä½ çš„å‡çº§è¿‡ç¨‹è¿…é€Ÿã€é¡ºåˆ©ã€å®‰å…¨ä¸”å¯é ï¼</p>
<blockquote>
<p>æœ€åæ„Ÿè°¢é˜…è¯»ï¼æ¬¢è¿å…³æ³¨æˆ‘ï¼Œå¾®ä¿¡å…¬ä¼—å·ï¼š <strong>å€”å¼ºé’é“œä¸‰</strong>ã€‚<br/>
<strong>ç‚¹èµã€æ”¶è—ã€å…³æ³¨</strong>ï¼Œä¸€é”®ä¸‰è¿ï¼ï¼<br/>
æ¬¢è¿ ç‚¹å‡» <strong>ã€ğŸ‘å–œæ¬¢ä½œè€…ã€‘</strong> æŒ‰é’®è¿›è¡Œ <strong>æ‰“èµğŸ’°ğŸ’°</strong>ï¼Œè¯·æˆ‘å–ä¸€æ¯å’–å•¡â˜•ï¸ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LINQé›†åˆä¿®æ”¹å¼‚å¸¸æ·±åº¦è§£æï¼šToList()çš„æ•‘åœºæ—¶åˆ»]]></title>    <link>https://juejin.cn/post/7582849187864723507</link>    <guid>https://juejin.cn/post/7582849187864723507</guid>    <pubDate>2025-12-12T15:35:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582849187864723507" data-draft-id="7582809606067339290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LINQé›†åˆä¿®æ”¹å¼‚å¸¸æ·±åº¦è§£æï¼šToList()çš„æ•‘åœºæ—¶åˆ»"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-12T15:35:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="guchen66"/> <meta itemprop="url" content="https://juejin.cn/user/3191200923270394"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LINQé›†åˆä¿®æ”¹å¼‚å¸¸æ·±åº¦è§£æï¼šToList()çš„æ•‘åœºæ—¶åˆ»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3191200923270394/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    guchen66
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T15:35:42.000Z" title="Fri Dec 12 2025 15:35:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜èƒŒæ™¯</h2>
<p>åœ¨æœ€è¿‘çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªç»å…¸çš„.NETå¼‚å¸¸ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">System.InvalidOperationException: <span class="hljs-string">"é›†åˆåœ¨æšä¸¾æ•°å®ä¾‹åŒ–åè¿›è¡Œäº†ä¿®æ”¹ã€‚"</span>
</code></pre>
<p>è¿™ä¸ªå¼‚å¸¸å‡ºç°åœ¨ä½¿ç”¨LINQå¤„ç†å­—å…¸é›†åˆæ—¶ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title class_">UpdateSVReportValues</span>(<span class="hljs-title class_">List</span>&lt;<span class="hljs-built_in">string</span>&gt; allDatas)
{
 Â  Â <span class="hljs-keyword">if</span> (allDatas == <span class="hljs-literal">null</span> || allDatas.<span class="hljs-property">Count</span> != _svData.<span class="hljs-property">Count</span>)
 Â   {
 Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArgumentException</span>(<span class="hljs-string">"æ•°æ®æ•°é‡ä¸keyæ•°é‡ä¸åŒ¹é…"</span>);
 Â   }
 Â  Â 
 Â  Â <span class="hljs-comment">// ä½¿ç”¨Zipç»„åˆé”®å€¼å¯¹</span>
 Â  Â <span class="hljs-keyword">var</span> updates = _svData.<span class="hljs-property">Keys</span>.<span class="hljs-title class_">Zip</span>(allDatas, <span class="hljs-function">(<span class="hljs-params">key, value</span>) =&gt;</span> <span class="hljs-keyword">new</span> { <span class="hljs-title class_">Key</span> = key, <span class="hljs-title class_">Value</span> = value });
â€‹
 Â  Â foreach (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> updates) Â <span class="hljs-comment">// å¼‚å¸¸å‘ç”Ÿåœ¨è¿™é‡Œ</span>
 Â   {
 Â  Â  Â  Â _svData.<span class="hljs-title class_">AddOrUpdate</span>(item.<span class="hljs-property">Key</span>, item.<span class="hljs-property">Value</span>, <span class="hljs-function">(<span class="hljs-params">k, oldValue</span>) =&gt;</span> item.<span class="hljs-property">Value</span>); Â <span class="hljs-comment">// ä¿®æ”¹é›†åˆ</span>
 Â   }
}
</code></pre>
<h2 data-id="heading-1">é—®é¢˜æ ¹æºï¼šLINQçš„å»¶è¿Ÿæ‰§è¡Œ</h2>
<p>ç»è¿‡æ·±å…¥åˆ†æï¼Œæˆ‘å‘ç°é—®é¢˜çš„æ ¹æºåœ¨äº<strong>LINQçš„å»¶è¿Ÿæ‰§è¡Œç‰¹æ€§</strong>ã€‚</p>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯å»¶è¿Ÿæ‰§è¡Œï¼Ÿ</h3>
<p>å½“æˆ‘ä»¬å†™ä¸‹LINQæŸ¥è¯¢æ—¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> updates = _svData.<span class="hljs-property">Keys</span>.<span class="hljs-title class_">Zip</span>(allDatas, <span class="hljs-function">(<span class="hljs-params">key, value</span>) =&gt;</span> <span class="hljs-keyword">new</span> { <span class="hljs-title class_">Key</span> = key, <span class="hljs-title class_">Value</span> = value });
</code></pre>
<p>å®é™…ä¸Šå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•è®¡ç®—ï¼Œ<code>updates</code>åªæ˜¯ä¸€ä¸ª"æŸ¥è¯¢å®šä¹‰"ï¼Œå®ƒè®°å½•äº†"è¦åšä»€ä¹ˆ"ï¼Œä½†æ²¡æœ‰ç«‹å³æ‰§è¡Œã€‚</p>
<h3 data-id="heading-3">ä½•æ—¶çœŸæ­£æ‰§è¡Œï¼Ÿ</h3>
<p>åªæœ‰å½“æˆ‘ä»¬å¼€å§‹<strong>æšä¸¾</strong>æŸ¥è¯¢ç»“æœæ—¶ï¼ˆå¦‚<code>foreach</code>å¾ªç¯ï¼‰ï¼ŒLINQæ‰ä¼šçœŸæ­£æ‰§è¡ŒæŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> updates) Â <span class="hljs-comment">// è¿™é‡Œå¼€å§‹è§¦å‘å®é™…æ‰§è¡Œ</span>
{
 Â  Â <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-4">å¾ªç¯å†…éƒ¨çš„æ‰§è¡Œæœºåˆ¶</h3>
<p>æ¯æ¬¡è¿­ä»£<code>foreach</code>å¾ªç¯æ—¶ï¼ŒLINQä¼šï¼š</p>
<ol start="0">
<li>ä»<code>_svData.Keys</code>ä¸­è·å–ä¸‹ä¸€ä¸ªé”®</li>
<li>ä»<code>allDatas</code>ä¸­è·å–å¯¹åº”çš„å€¼</li>
<li>åˆ›å»ºåŒ¿åå¯¹è±¡å¹¶è¿”å›</li>
</ol>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼š<strong>æ¯æ¬¡è¿­ä»£éƒ½ä¼šé‡æ–°è®¿é—®<code>_svData.Keys</code>é›†åˆ</strong>ï¼</p>
<h3 data-id="heading-5">ä¸ºä»€ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸</h3>
<p>å½“åœ¨å¾ªç¯å†…éƒ¨ä¿®æ”¹é›†åˆæ—¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">_svData.<span class="hljs-title class_">AddOrUpdate</span>(item.<span class="hljs-property">Key</span>, item.<span class="hljs-property">Value</span>, <span class="hljs-function">(<span class="hljs-params">k, oldValue</span>) =&gt;</span> item.<span class="hljs-property">Value</span>);
</code></pre>
<p>è¿™è¡Œä»£ç ä¿®æ”¹äº†<code>_svData</code>å­—å…¸ã€‚ç”±äº<code>_svData.Keys</code>æ˜¯ä¸€ä¸ª<strong>åŠ¨æ€è§†å›¾</strong>ï¼ˆä¸æ˜¯é™æ€å‰¯æœ¬ï¼‰ï¼Œå®ƒä¼šå®æ—¶åæ˜ <code>_svData</code>çš„å˜åŒ–ã€‚</p>
<p>å› æ­¤ï¼Œå½“å¾ªç¯è¿›è¡Œåˆ°ç¬¬äºŒæ¬¡è¿­ä»£æ—¶ï¼š</p>
<ul>
<li>LINQå°è¯•å†æ¬¡è®¿é—®<code>_svData.Keys</code></li>
<li>å‘ç°è¿™ä¸ªé›†åˆå·²ç»åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­è¢«ä¿®æ”¹</li>
<li>ç«‹å³æŠ›å‡º"é›†åˆåœ¨æšä¸¾æ•°å®ä¾‹åŒ–åè¿›è¡Œäº†ä¿®æ”¹"çš„å¼‚å¸¸</li>
</ul>
<h2 data-id="heading-6">è§£å†³æ–¹æ¡ˆï¼šToList()çš„æ•‘åœº</h2>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®æ˜¯<strong>æ‰“ç ´å»¶è¿Ÿæ‰§è¡Œé“¾</strong>ï¼Œåˆ›å»ºæŸ¥è¯¢ç»“æœçš„é™æ€å‰¯æœ¬ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> updates = _svData.<span class="hljs-property">Keys</span>.<span class="hljs-title class_">Zip</span>(allDatas, <span class="hljs-function">(<span class="hljs-params">key, value</span>) =&gt;</span> <span class="hljs-keyword">new</span> { <span class="hljs-title class_">Key</span> = key, <span class="hljs-title class_">Value</span> = value })
 Â   .<span class="hljs-title class_">ToList</span>(); Â <span class="hljs-comment">// åˆ›å»ºé™æ€å‰¯æœ¬</span>
â€‹
foreach (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> updates)
{
 Â  Â _svData.<span class="hljs-title class_">AddOrUpdate</span>(item.<span class="hljs-property">Key</span>, item.<span class="hljs-property">Value</span>, <span class="hljs-function">(<span class="hljs-params">k, oldValue</span>) =&gt;</span> item.<span class="hljs-property">Value</span>);
}
</code></pre>
<h3 data-id="heading-7">ToList()çš„å·¥ä½œåŸç†</h3>
<p><code>ToList()</code>æ–¹æ³•ä¼šï¼š</p>
<ol start="0">
<li>ç«‹å³æ‰§è¡Œæ•´ä¸ªLINQæŸ¥è¯¢</li>
<li>å°†æ‰€æœ‰ç»“æœä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­çš„<code>List&lt;&gt;</code>å¯¹è±¡</li>
<li>è¿”å›è¿™ä¸ªå®Œæ•´çš„é™æ€å‰¯æœ¬</li>
</ol>
<p>ä¹‹åçš„<code>foreach</code>å¾ªç¯åªæšä¸¾è¿™ä¸ªé™æ€å‰¯æœ¬ï¼Œä¸å†è®¿é—®åŸå§‹çš„<code>_svData.Keys</code>é›†åˆã€‚å› æ­¤ï¼Œå³ä½¿åœ¨å¾ªç¯å†…éƒ¨ä¿®æ”¹äº†<code>_svData</code>ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°æ­£åœ¨æšä¸¾çš„å‰¯æœ¬ã€‚</p>
<h2 data-id="heading-8">ToList()çš„ä½¿ç”¨åœºæ™¯</h2>
<p>é™¤äº†é¿å…é›†åˆä¿®æ”¹å¼‚å¸¸å¤–ï¼Œ<code>ToList()</code>è¿˜æœ‰å¾ˆå¤šå…¶ä»–é€‚ç”¨åœºæ™¯ï¼š</p>
<h3 data-id="heading-9">1. å¤šæ¬¡æšä¸¾åŒä¸€æŸ¥è¯¢ç»“æœ</h3>
<p>é¿å…é‡å¤æ‰§è¡ŒLINQæŸ¥è¯¢å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// ä¸å¥½çš„åšæ³•ï¼šå¤šæ¬¡æ‰§è¡ŒåŒä¸€æŸ¥è¯¢
var <span class="hljs-attr">query</span> = db.Users.Where(u =&gt; u.Age &gt; <span class="hljs-number">18</span>)<span class="hljs-comment">;</span>
var <span class="hljs-attr">count</span> = query.Count()<span class="hljs-comment">;</span>
var <span class="hljs-attr">firstUser</span> = query.First()<span class="hljs-comment">;</span>
â€‹
// å¥½çš„åšæ³•ï¼šåˆ›å»ºå‰¯æœ¬åå¤šæ¬¡ä½¿ç”¨
var <span class="hljs-attr">users</span> = db.Users.Where(u =&gt; u.Age &gt; <span class="hljs-number">18</span>).ToList()<span class="hljs-comment">;</span>
var <span class="hljs-attr">count</span> = users.Count<span class="hljs-comment">;</span>
var <span class="hljs-attr">firstUser</span> = users.First()<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-10">2. éœ€è¦éšæœºè®¿é—®æŸ¥è¯¢ç»“æœ</h3>
<p><code>List&lt;&gt;</code>æ”¯æŒç´¢å¼•è®¿é—®ï¼Œè€ŒLINQæŸ¥è¯¢ç»“æœé€šå¸¸ä¸æ”¯æŒï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">users</span> = db.Users.OrderBy(u =&gt; u.Name).ToList()<span class="hljs-comment">;</span>
var <span class="hljs-attr">thirdUser</span> = users[<span class="hljs-number">2</span>]<span class="hljs-comment">; Â // ç›´æ¥é€šè¿‡ç´¢å¼•è®¿é—®</span>
</code></pre>
<h3 data-id="heading-11">3. éœ€è¦ä¿®æ”¹æŸ¥è¯¢ç»“æœ</h3>
<p>å½“éœ€è¦å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ·»åŠ ã€åˆ é™¤ç­‰æ“ä½œæ—¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">users</span> = db.Users.Where(u =&gt; u.Age &gt; <span class="hljs-number">18</span>).ToList()<span class="hljs-comment">;</span>
users.Add(new User { <span class="hljs-attr">Name</span> = <span class="hljs-string">"New User"</span>, Age = <span class="hljs-number">20</span> })<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-12">4. æ§åˆ¶å†…å­˜ä½¿ç”¨</h3>
<p>å¯¹äºå°å‹æ•°æ®é›†ï¼Œåˆ›å»ºå‰¯æœ¬çš„å†…å­˜å¼€é”€å¯æ¥å—ï¼Œä¸”èƒ½æé«˜ä»£ç å®‰å…¨æ€§ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">smallDataset</span> = largeDataset.Where(item =&gt; item.IsActive).ToList()<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-13">LINQå»¶è¿Ÿæ‰§è¡Œçš„å…¶ä»–æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-14">1. é“¾å¼è°ƒç”¨çš„å»¶è¿Ÿæ€§</h3>
<p>å¤šä¸ªLINQæ“ä½œç¬¦é“¾æ¥åœ¨ä¸€èµ·æ—¶ï¼Œæ•´ä¸ªé“¾éƒ½æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æ•´ä¸ªé“¾éƒ½æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„
var <span class="hljs-attr">result</span> = collection.Where(item =&gt; item.IsActive)
    .OrderBy(<span class="hljs-attr">item</span> =&gt; item.Name)
    .Select(<span class="hljs-attr">item</span> =&gt; item.Id)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-15">2. ç«‹å³æ‰§è¡Œçš„æ“ä½œç¬¦</h3>
<p>å¹¶éæ‰€æœ‰LINQæ“ä½œç¬¦éƒ½æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ï¼Œä»¥ä¸‹æ“ä½œç¬¦ä¼šç«‹å³æ‰§è¡Œï¼š</p>
<ul>
<li>èšåˆå‡½æ•°ï¼š<code>Count()</code>, <code>Sum()</code>, <code>Average()</code>, <code>Min()</code>, <code>Max()</code></li>
<li>å…ƒç´ æ“ä½œï¼š<code>First()</code>, <code>Last()</code>, <code>Single()</code>, <code>ElementAt()</code></li>
<li>è½¬æ¢æ“ä½œï¼š<code>ToList()</code>, <code>ToArray()</code>, <code>ToDictionary()</code></li>
</ul>
<h3 data-id="heading-16">3. å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„é£é™©</h3>
<p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå»¶è¿Ÿæ‰§è¡Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// çº¿ç¨‹1ï¼šå®šä¹‰æŸ¥è¯¢
var <span class="hljs-attr">query</span> = sharedCollection.Where(item =&gt; item.IsValid)<span class="hljs-comment">;</span>

// çº¿ç¨‹2ï¼šä¿®æ”¹é›†åˆ
sharedCollection.Add(new Item { <span class="hljs-attr">IsValid</span> = <span class="hljs-literal">true</span> })<span class="hljs-comment">;</span>

// çº¿ç¨‹1ï¼šæ‰§è¡ŒæŸ¥è¯¢ï¼ˆæ­¤æ—¶ç»“æœå·²åŒ…å«çº¿ç¨‹2æ·»åŠ çš„é¡¹ï¼‰
var <span class="hljs-attr">result</span> = query.ToList()<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-17">æœ€ä½³å®è·µæ€»ç»“</h2>
<ol start="0">
<li><strong>å½“éœ€è¦åœ¨æšä¸¾è¿‡ç¨‹ä¸­ä¿®æ”¹åŸå§‹é›†åˆæ—¶</strong>ï¼šä½¿ç”¨<code>ToList()</code>åˆ›å»ºå‰¯æœ¬</li>
<li><strong>å½“éœ€è¦å¤šæ¬¡æšä¸¾åŒä¸€æŸ¥è¯¢ç»“æœæ—¶</strong>ï¼šä½¿ç”¨<code>ToList()</code>é¿å…é‡å¤æ‰§è¡Œ</li>
<li><strong>å½“æŸ¥è¯¢ç»“æœè¾ƒå°ä¸”å†…å­˜å¼€é”€å¯æ¥å—æ—¶</strong>ï¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨<code>ToList()</code>æé«˜ä»£ç å®‰å…¨æ€§</li>
<li><strong>å¯¹äºå¤§æ•°æ®é›†</strong>ï¼šæƒè¡¡å†…å­˜ä½¿ç”¨å’Œä»£ç å®‰å…¨æ€§ï¼Œè€ƒè™‘å…¶ä»–è§£å†³æ–¹æ¡ˆ</li>
<li><strong>ç†è§£å»¶è¿Ÿæ‰§è¡Œç‰¹æ€§</strong>ï¼šåœ¨ç¼–å†™LINQæŸ¥è¯¢æ—¶ï¼Œå§‹ç»ˆç‰¢è®°å…¶æ‰§è¡Œæ—¶æœº</li>
</ol>
<h2 data-id="heading-18">ç»“è®º</h2>
<p><code>ToList()</code>ä¸ä»…æ˜¯ä¸€ä¸ªç®€å•çš„é›†åˆè½¬æ¢æ–¹æ³•ï¼Œå®ƒè¿˜æ˜¯è§£å†³LINQé›†åˆä¿®æ”¹å¼‚å¸¸çš„"æ•‘åœºè‹±é›„"ã€‚é€šè¿‡ç†è§£LINQçš„å»¶è¿Ÿæ‰§è¡Œç‰¹æ€§å’Œ<code>ToList()</code>çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å‡ºæ›´å®‰å…¨ã€æ›´é«˜æ•ˆçš„ä»£ç ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†ä½¿ç”¨<code>ToList()</code>å¯ä»¥é¿å…å¾ˆå¤šæ½œåœ¨çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚çš„é›†åˆæ“ä½œæ—¶ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è¿™ä¸ªå¼ºå¤§çš„LINQå·¥å…·ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CDN æŠ€æœ¯æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7582759716188274688</link>    <guid>https://juejin.cn/post/7582759716188274688</guid>    <pubDate>2025-12-12T10:16:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582759716188274688" data-draft-id="7582779306730766371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CDN æŠ€æœ¯æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,CDN"/> <meta itemprop="datePublished" content="2025-12-12T10:16:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="asing"/> <meta itemprop="url" content="https://juejin.cn/user/1412191054738446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CDN æŠ€æœ¯æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1412191054738446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    asing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:16:51.000Z" title="Fri Dec 12 2025 10:16:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åºè¨€</h2>
<p>ä» Q3 å¼€å§‹å…¬å¸å¦‚ç«å¦‚è¼å¼€å±•äº†å·ç§°æˆ˜ç•¥çº§çš„é¡¹ç›®ã€Šè½¦å•†åŸã€‹ï¼Œè¯¥é¡¹ç›®æ¨ªè·¨äº† 5 ä¸ª BU ç›¸äº’é…åˆï¼Œç”±äºæˆ‘æ‰€åœ¨çš„ç»„å±äºå‰ç«¯ä¸­å°æ¶æ„ç»„ï¼Œç†æ‰€å½“ç„¶çš„ä¸€äº›ä¸­å°éƒ¨åˆ†å·¥ä½œå°±è½åœ¨äº†æˆ‘ä»¬è¿™è¾¹ï¼Œæ¯”å¦‚æ”¯ä»˜ï¼Œç»“ç®—ï¼Œé€šç”¨è®¢å•è¯¦æƒ…ç­‰ï¼Œåˆšå¥½æˆ‘ä¹‹å‰å°±æ˜¯è´Ÿè´£çš„æ”¯ä»˜ä¾§ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®é‡Œæˆ‘ä¹Ÿé¦–å½“å…¶å†²çš„å†²åœ¨äº†æœ€å‰çº¿ã€‚</p>
<blockquote>
<p>å¥½äº†ï¼Œè¯´äº†ä¸€æ®µåºŸè¯ï¼Œè®²ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« å§ï¼Œåœ¨é¡¹ç›®åˆæœŸçš„è®¾è®¡ï¼Œä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œå®Œæˆç§’å¼€ç‡ç­‰æŒ‡æ ‡ï¼ŒæŠŠé™æ€èµ„æº CDN åŠ é€Ÿå¼•å…¥åˆ°äº†é¡¹ç›®æ¶æ„ä¸­æ¥ï¼Œé¡¹ç›®è½åœ°è¿‡ç¨‹ä¸­åœ¨å…¬å¸æ­å»ºçš„ CDN æœåŠ¡çš„ä½¿ç”¨ä¸Šä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œéšç€é¡¹ç›®é€æ­¥ä¸Šçº¿ï¼Œå°±æŠŠè¯¥éƒ¨åˆ†ç»™æ€»ç»“ä¸€ä¸‹ç»™å›¢é˜Ÿåˆ†äº«ä¸€ä¸‹æŠ€æœ¯å¿ƒå¾—ã€‚ï¼ˆPSï¼š å·²éšå»ä¸€äº›å†…éƒ¨æ•æ„Ÿéƒ¨åˆ†ï¼‰</p>
</blockquote>
<h2 data-id="heading-1"><strong>ä¸€ã€CDN æ ¸å¿ƒæ¦‚å¿µä¸ä»·å€¼</strong></h2>
<h3 data-id="heading-2"><strong>1.1 ä»€ä¹ˆæ˜¯ CDNï¼Ÿ</strong></h3>
<p>CDNï¼ˆContent Delivery Networkï¼‰ï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œï¼Œæ˜¯é€šè¿‡åœ¨ç°æœ‰äº’è”ç½‘åŸºç¡€ä¸Šæ„å»ºçš„ä¸€å±‚æ™ºèƒ½è™šæ‹Ÿç½‘ç»œï¼Œå°†æºç«™å†…å®¹åˆ†å‘è‡³å…¨çƒå„åœ°çš„è¾¹ç¼˜èŠ‚ç‚¹ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå°±è¿‘è·å–æ‰€éœ€å†…å®¹ã€‚</p>
<h3 data-id="heading-3"><strong>1.2 ä¸ºä»€ä¹ˆéœ€è¦ CDNï¼Ÿ</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">ä¼ ç»Ÿè®¿é—®æ¨¡å¼ç—›ç‚¹ï¼š
ç”¨æˆ· â†’ é•¿é€”ç½‘ç»œä¼ è¾“ â†’ æºç«™æœåŠ¡å™¨
<span class="hljs-code">      â†“
é—®é¢˜ï¼šå»¶è¿Ÿé«˜ã€æ‹¥å¡ã€å•ç‚¹æ•…éšœ
      
CDNè®¿é—®æ¨¡å¼ï¼š
ç”¨æˆ· â†’ æœ€è¿‘ CDN èŠ‚ç‚¹ï¼ˆé€šå¸¸&lt;50msï¼‰
      â†“
ä¼˜åŠ¿ï¼šå¿«é€Ÿã€ç¨³å®šã€å¯æ‰©å±•
</span></code></pre>
<h3 data-id="heading-4"><strong>1.3 CDN çš„æ ¸å¿ƒä»·å€¼</strong></h3>






























<table><thead><tr><th>ç»´åº¦</th><th>æ”¶ç›Š</th><th>é‡åŒ–æŒ‡æ ‡</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>è®¿é—®é€Ÿåº¦æå‡ 50%-70%</td><td>é¦–å±åŠ è½½æ—¶é—´â†“</td></tr><tr><td>æˆæœ¬</td><td>èŠ‚çœæºç«™å¸¦å®½ 40%-60%</td><td>å¸¦å®½è´¹ç”¨â†“</td></tr><tr><td>å¯ç”¨æ€§</td><td>å¯è¾¾ 99.99%</td><td>SLA æå‡</td></tr><tr><td>å®‰å…¨</td><td>DDoS é˜²æŠ¤èƒ½åŠ›å¢å¼º</td><td>æ”»å‡»æ‹¦æˆªç‡â†‘</td></tr></tbody></table>
<p>Â </p>
<h2 data-id="heading-5"><strong>äºŒã€CDN æ ¸å¿ƒå·¥ä½œåŸç†</strong></h2>
<h3 data-id="heading-6"><strong>2.1 å®Œæ•´è¯·æ±‚æµç¨‹å›¾è§£</strong></h3>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/103bd2ef595e4dd0b1cb2c6ce3de276a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXNpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766139411&amp;x-signature=mNNki37x%2FQFvh4L35gVqSUyIkUw%3D" alt="è¯·æ±‚æµç¨‹.png" width="30%" loading="lazy"/>
Â 
<h3 data-id="heading-7"><strong>2.2 DNSæ™ºèƒ½è°ƒåº¦æœºåˆ¶</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
<span class="hljs-bullet">1.</span> ç”¨æˆ·è®¿é—® www.example.com
<span class="hljs-bullet">2.</span> æœ¬åœ° DNS â†’ æƒå¨ DNSï¼ˆCNAME æŒ‡å‘ CDN å‚å•†ï¼‰
<span class="hljs-bullet">3.</span> CDN çš„ DNS åŸºäºä»¥ä¸‹å› ç´ å†³ç­–ï¼š
<span class="hljs-bullet">   -</span> ç”¨æˆ· IP åœ°ç†ä½ç½®
<span class="hljs-bullet">   -</span> è¿è¥å•†çº¿è·¯è´¨é‡
<span class="hljs-bullet">   -</span> èŠ‚ç‚¹å¥åº·çŠ¶æ€
<span class="hljs-bullet">   -</span> å®æ—¶è´Ÿè½½æƒ…å†µ
<span class="hljs-bullet">4.</span> è¿”å›æœ€ä¼˜è¾¹ç¼˜èŠ‚ç‚¹ IP
</code></pre>
<h3 data-id="heading-8"><strong>2.3 ç¼“å­˜å±‚çº§æ¶æ„</strong></h3>
<pre><code class="hljs">ä¸‰å±‚ç¼“å­˜ä½“ç³»ï¼š
è¾¹ç¼˜å±‚ï¼ˆEdgeï¼‰ - æœ€æ¥è¿‘ç”¨æˆ·ï¼Œæ•°é‡æœ€å¤š
åŒºåŸŸå±‚ï¼ˆRegionalï¼‰ - çœçº§/å¤§åŒºçº§èŠ‚ç‚¹
ä¸­å¿ƒå±‚ï¼ˆCoreï¼‰ - å…¨å›½/å…¨çƒçº§æ ¸å¿ƒèŠ‚ç‚¹


å›æºè·¯å¾„ï¼šè¾¹ç¼˜ â†’ åŒºåŸŸ â†’ ä¸­å¿ƒ â†’ æºç«™
</code></pre>
<h2 data-id="heading-9"><strong>ä¸‰ã€CDN å…³é”®æŠ€æœ¯ç‰¹æ€§</strong></h2>
<h3 data-id="heading-10"><strong>3.1 åŠ é€Ÿæ€§èƒ½ä¼˜åŒ–</strong></h3>
<p>é™æ€èµ„æºåŠ é€Ÿï¼š</p>
<ul>
<li>å›¾ç‰‡ã€CSSã€JS ç­‰é™æ€æ–‡ä»¶</li>
<li>ç¼“å­˜å‘½ä¸­ç‡é€šå¸¸ &gt; 95%</li>
<li>æ”¯æŒ HTTP/2ã€QUIC ç­‰æ–°åè®®</li>
</ul>
<p>åŠ¨æ€å†…å®¹åŠ é€Ÿï¼š</p>
<ul>
<li>æ™ºèƒ½è·¯ç”±é€‰æ‹©</li>
<li>TCP ä¼˜åŒ–ï¼ˆæ‹¥å¡æ§åˆ¶ã€çª—å£è°ƒæ•´ï¼‰</li>
<li>é“¾è·¯ä¼˜åŒ–ï¼ˆBGP Anycastï¼‰</li>
</ul>
<h3 data-id="heading-11"><strong>3.2 å®‰å…¨é˜²æŠ¤ä½“ç³»</strong></h3>
<pre><code class="hljs">é˜²æŠ¤å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å±‚é˜²æŠ¤    â”‚ â† DDoS/CC æ”»å‡»é˜²æŠ¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åè®®å±‚é˜²æŠ¤    â”‚ â† TCP/UDP Flood é˜²æŠ¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç½‘ç»œå±‚é˜²æŠ¤    â”‚ â† å¸¦å®½è€—å°½æ”»å‡»é˜²æŠ¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-12"><strong>3.3 è·¨åœ°åŸŸ/è·¨è¿è¥å•†ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-diff" lang="diff">é—®é¢˜æ ¹æºï¼š
ç”µä¿¡ â†’ è”é€š â†’ ç§»åŠ¨ â†’ æ•™è‚²ç½‘
  â†“      â†“      â†“       â†“
äº’é€šå¸¦å®½æœ‰é™ï¼Œè·¨ç½‘å»¶è¿Ÿé«˜


CDN è§£å†³æ–¹æ¡ˆï¼š
<span class="hljs-deletion">- å¤šçº¿ BGP æ¥å…¥</span>
<span class="hljs-deletion">- è¿è¥å•†æ·±åº¦åˆä½œ</span>
<span class="hljs-deletion">- è¾¹ç¼˜èŠ‚ç‚¹è¦†ç›–æ‰€æœ‰è¿è¥å•†</span>
</code></pre>
<h2 data-id="heading-13"><strong>å››ã€CDN ç¼“å­˜è§£æ</strong></h2>
<h3 data-id="heading-14"><strong>4.1 ç¼“å­˜å·¥ä½œæœºåˆ¶</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ec0b95d74d24b23b3d14d1d998e144c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXNpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766139411&amp;x-signature=5qANvvmJxnHhFElOVUSp36QVphg%3D" alt="ç¼“å­˜æœºåˆ¶.png" loading="lazy"/></p>
<h3 data-id="heading-15"><strong>4.2 ç¼“å­˜æ›´æ–°ç­–ç•¥å¯¹æ¯”</strong></h3>



































<table><thead><tr><th>ç­–ç•¥</th><th>åŸç†</th><th>é€‚ç”¨åœºæ™¯</th><th>ä¼˜ç¼ºç‚¹</th></tr></thead><tbody><tr><td>è¢«åŠ¨æ›´æ–°</td><td>ç¼“å­˜å¤±æ•ˆæ—¶å›æº</td><td>æ›´æ–°ä¸é¢‘ç¹çš„å†…å®¹</td><td>ç®€å•ï¼Œä½†æœ‰å»¶è¿Ÿ</td></tr><tr><td>ä¸»åŠ¨é¢„çƒ­</td><td>æå‰æ¨é€è‡³CDN</td><td>é‡è¦æ´»åŠ¨ã€æ–°å“å‘å¸ƒ</td><td>ä½“éªŒå¥½ï¼Œæˆæœ¬ç•¥é«˜</td></tr><tr><td>ç‰ˆæœ¬åŒ– URL</td><td>URL å¸¦ç‰ˆæœ¬å·æˆ–å“ˆå¸Œ</td><td>é™æ€èµ„æºæ›´æ–°</td><td>ç¼“å­˜æ§åˆ¶ç²¾å‡†</td></tr><tr><td>æ—¶é—´æˆ³å‚æ•°</td><td>URL å¸¦æ—¶é—´æˆ³å‚æ•°</td><td>å¼€å‘è°ƒè¯•é˜¶æ®µ</td><td>ç®€å•ä½†ç¼“å­˜å‘½ä¸­ç‡ä½</td></tr></tbody></table>
<p>Â </p>
<h3 data-id="heading-16"><strong>4.3 CDN é¢„çƒ­è¯¦è§£</strong></h3>
<ol>
<li><strong>ä»€ä¹ˆæ˜¯é¢„çƒ­ï¼Ÿ</strong></li>
</ol>
<p>é¢„çƒ­æ˜¯æŒ‡ä¸»åŠ¨å°†å†…å®¹æ¨é€åˆ° CDN è¾¹ç¼˜èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶æ‰å›æºæ‹‰å–ã€‚</p>
<p>Â </p>
<ol start="2">
<li><strong>ä¸ºä»€ä¹ˆéœ€è¦é¢„çƒ­ï¼Ÿ</strong></li>
</ol>

<pre><code class="hljs language-css" lang="css">é¦–æ¬¡è®¿é—®é—®é¢˜ï¼š
ç”¨æˆ·<span class="hljs-selector-tag">A</span>è¯·æ±‚æ–°èµ„æº â†’ CDNæœªç¼“å­˜ â†’ å›æºæ‹‰å–ï¼ˆæ…¢ï¼‰
é¢„çƒ­è§£å†³ï¼š
æå‰æ¨é€èµ„æºåˆ°CDN â†’ æ‰€æœ‰ç”¨æˆ·éƒ½å¿«é€Ÿè®¿é—®
</code></pre>
<p>3.  <strong>é¢„çƒ­å®æ–½æ–¹å¼ï¼š</strong></p>
<p>API ä¸»åŠ¨æ¨é€</p>
<pre><code class="hljs language-vbnet" lang="vbnet"># ä½¿ç”¨ CDN å‚å•† API æ¥å£
curl -X POST <span class="hljs-string">"https://cdn-api.example.com/prefetch"</span> \
  -H <span class="hljs-string">"Authorization: Bearer YOUR_TOKEN"</span> \
  -d <span class="hljs-comment">'{</span>
    <span class="hljs-string">"urls"</span>: [
      <span class="hljs-string">"https://cdn.example.com/product/new.jpg"</span>,
      <span class="hljs-string">"https://cdn.example.com/static/v2.0/app.js"</span>
    ]
  }<span class="hljs-comment">'</span>
</code></pre>
<p>Â </p>
<ol start="4">
<li><strong>é¢„çƒ­ vs åˆ·æ–°ï¼š</strong></li>
</ol>























<table><thead><tr><th>æ“ä½œ</th><th>ç›®çš„</th><th>æ—¶æœº</th><th>å½±å“</th></tr></thead><tbody><tr><td>é¢„çƒ­</td><td>æå‰å¡«å……ç¼“å­˜</td><td>å†…å®¹å‘å¸ƒå‰</td><td>æ”¹å–„é¦–æ¬¡è®¿é—®ä½“éªŒ</td></tr><tr><td>åˆ·æ–°</td><td>å¼ºåˆ¶æ›´æ–°ç¼“å­˜</td><td>å†…å®¹æ›´æ–°å</td><td>ç¡®ä¿ç”¨æˆ·è·å–æœ€æ–°å†…å®¹</td></tr></tbody></table>
<p>Â </p>
<h2 data-id="heading-17"><strong>äº”ã€CDNåº”ç”¨åœºæ™¯</strong></h2>
<h3 data-id="heading-18"><strong>5.1 åœºæ™¯åŒ–é…ç½®æ–¹æ¡ˆ</strong></h3>
<p>ç”µå•†ç½‘ç«™æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs">é™æ€èµ„æºï¼šé•¿æœŸç¼“å­˜ï¼ˆ30å¤©ï¼‰
å•†å“å›¾ç‰‡ï¼šç‰ˆæœ¬åŒ–ç®¡ç†
æ´»åŠ¨é¡µé¢ï¼šé¢„çƒ­+çŸ­ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
APIæ¥å£ï¼šåŠ¨æ€åŠ é€Ÿ+é€‚å½“ç¼“å­˜
</code></pre>
<h3 data-id="heading-19"><strong>5.2 ç›‘æ§ä¸å‘Šè­¦</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š
<span class="hljs-bullet">1.</span> å‘½ä¸­ç‡ï¼ˆ&gt;95%ä¸ºå¥åº·ï¼‰
<span class="hljs-bullet">2.</span> å¹³å‡å“åº”æ—¶é—´ï¼ˆ&lt;100msä¸ºä¼˜ï¼‰
<span class="hljs-bullet">3.</span> å¸¦å®½ä½¿ç”¨ï¼ˆå¼‚å¸¸çªå¢éœ€é¢„è­¦ï¼‰
<span class="hljs-bullet">4.</span> é”™è¯¯ç‡ï¼ˆ5xxé”™è¯¯&lt;0.1%ï¼‰
<span class="hljs-bullet">5.</span> å›æºæ¯”ä¾‹ï¼ˆ&lt;10%ä¸ºä½³ï¼‰


å‘Šè­¦ç­–ç•¥ï¼š
<span class="hljs-bullet">-</span> å®æ—¶å‘Šè­¦ï¼šé”™è¯¯ç‡çªå¢
<span class="hljs-bullet">-</span> å®šæ—¶æŠ¥å‘Šï¼šæ¯æ—¥å‘½ä¸­ç‡æ±‡æ€»
<span class="hljs-bullet">-</span> å®¹é‡é¢„è­¦ï¼šå¸¦å®½ä½¿ç”¨è¾¾80%
</code></pre>
<h2 data-id="heading-20"><strong>å…­ã€æœ€ä½³å®è·µ</strong></h2>
<h3 data-id="heading-21"><strong>6.1</strong> Nginx ä¼˜åŒ–</h3>
<p>ç°ä»£ Nginx ä¼˜åŒ–å®è·µï¼šæ¶æ„ã€é…ç½®ä¸æ€§èƒ½è°ƒä¼˜: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FJvSx9rkCqHWtFVil90dJqw" target="_blank" title="https://mp.weixin.qq.com/s/JvSx9rkCqHWtFVil90dJqw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/JvSx9rkCqâ€¦</a></p>
<h3 data-id="heading-22"><strong>6.2</strong> ä¹‹å®¶ä½¿ç”¨çš„ CDN ä¾›åº”å•†</h3>



















<table><thead><tr><th>ç™¾åº¦</th><th>Ageå¤´æ ‡è¯†è¾¹ç¼˜æ˜¯å¦æœ‰ç¼“å­˜åŠç¼“å­˜æ—¶é•¿ï¼›å­˜åœ¨è¡¨ç¤ºå‘½ä¸­è¾¹ç¼˜ç¼“å­˜ï¼Œä¸å­˜åœ¨è¡¨ç¤ºè¾¹ç¼˜æ²¡æœ‰ç¼“å­˜ï¼Œè¯·æ±‚å›äº†ä¸Šçº§æˆ–è€…æºç«™ï¼›Ohc-Global-Saved-Timeå¤´æ ‡è¯†å…¨å±€é¦–æ¬¡ç¼“å­˜æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡è¯¥å“åº”å¤´åˆ¤æ–­ç¬¬ä¸€æ¬¡ç¼“å­˜æ—¶é—´ï¼Œå¦‚æœè¯¥å€¼å’Œè¯·æ±‚æ—¶é—´æ¥è¿‘æˆ–ç›¸ç­‰åˆ™è¯´æ˜è¯·æ±‚å›æºï¼Œæ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ï¼›</th><th>Â </th><th>&lt; Age: 4&lt; Ohc-Global-Saved-Time: Thu, 14 Sep 2023 07:55:28 GMT</th><th><a href="https://link.juejin.cn?target=http%3A%2F%2Fpic-b.autoimg.cn" target="_blank" title="http://pic-b.autoimg.cn" ref="nofollow noopener noreferrer">pic-b.autoimg.cn</a></th></tr></thead><tbody><tr><td>åä¸º</td><td>æœ‰â€œx-hcs-proxy-typeâ€å¤´éƒ¨ï¼Œå€¼ä¸ºâ€œ1â€å³å‘½ä¸­ç¼“å­˜ï¼Œå€¼ä¸ºâ€œ0â€å³æœªå‘½ä¸­ç¼“å­˜ï¼Œä¸å†æŸ¥çœ‹å…¶å®ƒå¤´éƒ¨ï¼›</td><td>Â </td><td>ç¤ºä¾‹ç¼“å­˜å‘½ä¸­å¤´éƒ¨å¦‚ä¸‹x-hcs-proxy-type: 1</td><td>Â </td></tr></tbody></table>
<h3 data-id="heading-23"><strong>6.4 ç™¾åº¦ CDN å“åº”å¤´è§£æ</strong></h3>
<p><strong>1.</strong> <code>ohc-cache-hit: lf6ct205 [2], xaix205 [1]</code></p>
<p>å«ä¹‰ï¼šCDNç¼“å­˜å‘½ä¸­çŠ¶æ€å’Œè·¯å¾„è¿½è¸ª</p>
<p>è¯¦ç»†è§£è¯»ï¼š</p>
<ul>
<li>lf6ct205 [2]ï¼š</li>
<li>
<ul>
<li><code>lf6ct205</code>ï¼šè¡¨ç¤ºç¬¬ä¸€ä¸ªå“åº”èŠ‚ç‚¹ï¼ˆå¯èƒ½æ˜¯è¾¹ç¼˜èŠ‚ç‚¹ï¼‰çš„æ ‡è¯†</li>
<li><code>[2]</code>ï¼šç¼“å­˜å‘½ä¸­çŠ¶æ€ç ï¼Œå¸¸è§å«ä¹‰ï¼š</li>
<li>
<ul>
<li><code>0</code>ï¼šMISSï¼ˆæœªå‘½ä¸­ï¼Œå›æºï¼‰</li>
<li><code>1</code>ï¼šHITï¼ˆå®Œå…¨å‘½ä¸­ï¼‰</li>
<li><code>2</code>ï¼šPARTIAL_HIT/HIT_REVALIDATEDï¼ˆéƒ¨åˆ†å‘½ä¸­/éªŒè¯åå‘½ä¸­ï¼‰</li>
<li>è¿™é‡Œ<code>[2]</code>è¡¨ç¤ºè¯¥èŠ‚ç‚¹å¯èƒ½è¿›è¡Œäº†æ¡ä»¶éªŒè¯ï¼ˆIf-Modified-Since/If-None-Matchï¼‰åç¡®è®¤èµ„æºæœ‰æ•ˆ</li>
</ul>
</li>
</ul>
</li>
<li>xaix205 [1]ï¼š</li>
<li>
<ul>
<li><code>xaix205</code>ï¼šç¬¬äºŒä¸ªå“åº”èŠ‚ç‚¹ï¼ˆå¯èƒ½æ˜¯çˆ¶å±‚æˆ–ä¸­é—´å±‚èŠ‚ç‚¹ï¼‰çš„æ ‡è¯†</li>
<li><code>[1]</code>ï¼šè¡¨ç¤ºåœ¨è¯¥èŠ‚ç‚¹å®Œå…¨å‘½ä¸­ç¼“å­˜</li>
</ul>
</li>
</ul>
<p>Â </p>
<p>ç»¼åˆç†è§£ï¼šè¯·æ±‚ç»è¿‡äº†<code>xaix205â†’lf6ct205</code>ä¸¤çº§CDNèŠ‚ç‚¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹éƒ½å‘½ä¸­ç¼“å­˜ï¼Œå…¶ä¸­çˆ¶èŠ‚ç‚¹å®Œå…¨å‘½ä¸­ï¼Œè¾¹ç¼˜èŠ‚ç‚¹ç»è¿‡éªŒè¯åå‘½ä¸­ã€‚</p>
<p>Â </p>
<p><strong>2.</strong> <code>ohc-file-size: 2108</code></p>
<p>å«ä¹‰ï¼šCDN ç¼“å­˜çš„æ–‡ä»¶å¤§å°</p>
<p>è¯¦ç»†è§£è¯»ï¼š</p>
<ul>
<li>å•ä½ï¼šå­—èŠ‚ï¼ˆBytesï¼‰</li>
<li>å€¼ï¼š2108å­—èŠ‚ â‰ˆ 2.06KB</li>
<li>è¡¨ç¤ºCDNç¼“å­˜çš„è¿™ä¸ªèµ„æºæ–‡ä»¶çš„å®é™…å¤§å°</li>
<li>ç”¨äºç›‘æ§å’Œè¯Šæ–­ï¼Œç¡®è®¤ç¼“å­˜çš„æ–‡ä»¶ä¸æºç«™æ–‡ä»¶å¤§å°æ˜¯å¦ä¸€è‡´</li>
</ul>
<p>Â </p>
<p><strong>3.</strong> <code>ohc-global-saved-time: Thu, 11 Dec 2025 09:17:19 GMT</code></p>
<p>å«ä¹‰ï¼šèµ„æºåœ¨ CDN ä¸Šé¦–æ¬¡ç¼“å­˜çš„æ—¶é—´æˆ³</p>
<p>è¯¦ç»†è§£è¯»ï¼š</p>
<ul>
<li>æ ¼å¼ï¼šRFC 1123æ ¼å¼çš„GMTæ—¶é—´</li>
<li>æ—¶é—´å€¼ï¼š2025å¹´12æœˆ11æ—¥ 09:17:19ï¼ˆGMTï¼‰</li>
<li>æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªæœªæ¥æ—¶é—´ï¼Œå¯èƒ½æœ‰ä»¥ä¸‹æƒ…å†µï¼š</li>
<li>
<ul>
<li>æ—¶é—´åŒæ­¥é—®é¢˜ï¼šæºç«™æˆ–CDNæœåŠ¡å™¨æ—¶é—´è®¾ç½®é”™è¯¯</li>
<li>ç¼“å­˜ç­–ç•¥é…ç½®ï¼šå¯èƒ½è®¾ç½®äº†å¾ˆé•¿çš„ç¼“å­˜æ—¶é—´ï¼ˆåˆ°2025å¹´ï¼‰</li>
<li>è°ƒè¯•/æµ‹è¯•ç¯å¢ƒï¼šå¯èƒ½æ˜¯æµ‹è¯•é…ç½®</li>
</ul>
</li>
<li>æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯è¿‡å»çš„æ—¶é—´ç‚¹ï¼Œè¡¨ç¤ºèµ„æºä½•æ—¶è¢«ç¼“å­˜</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¼ä¸šçº§ Vue 3 é¡¹ç›®å›¾æ ‡ç³»ç»Ÿé‡æ„å®è·µï¼šä»å¤šæºæ··ä¹±åˆ°å•ä¸€æ•°æ®æº]]></title>    <link>https://juejin.cn/post/7582779306730946595</link>    <guid>https://juejin.cn/post/7582779306730946595</guid>    <pubDate>2025-12-12T10:25:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582779306730946595" data-draft-id="7582759716188258304" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¼ä¸šçº§ Vue 3 é¡¹ç›®å›¾æ ‡ç³»ç»Ÿé‡æ„å®è·µï¼šä»å¤šæºæ··ä¹±åˆ°å•ä¸€æ•°æ®æº"/> <meta itemprop="keywords" content="Vue.js,æ¶æ„,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-12T10:25:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¼ä¸šçº§ Vue 3 é¡¹ç›®å›¾æ ‡ç³»ç»Ÿé‡æ„å®è·µï¼šä»å¤šæºæ··ä¹±åˆ°å•ä¸€æ•°æ®æº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§è±¡çš„é¼»å­é‚£ä¹ˆé•¿
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 èä¼šè´¯é€š
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 èä¼šè´¯é€š" title="VIP.4 èä¼šè´¯é€š" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:25:04.000Z" title="Fri Dec 12 2025 10:25:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æ—¥æœŸ</strong>: 2025-12-12<br/>
<strong>æŠ€æœ¯æ ˆ</strong>: Vue 3 + TypeScript + iconfont</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨å¤§å‹å‰ç«¯é¡¹ç›®ä¸­ï¼Œå›¾æ ‡ç®¡ç†æ˜¯ä¸€ä¸ªçœ‹ä¼¼ç®€å•å´å®¹æ˜“å¤±æ§çš„é—®é¢˜ã€‚éšç€ä¸šåŠ¡è¿­ä»£ï¼Œå¾€å¾€ä¼šå‡ºç°å¤šå¥—å›¾æ ‡æ–¹æ¡ˆå¹¶å­˜çš„æƒ…å†µï¼šæœ‰äººç”¨ SVG æ–‡ä»¶ï¼Œæœ‰äººç”¨ iconfontï¼Œæœ‰äººç›´æ¥ç”¨å›¾ç‰‡â€¦â€¦è¿™ä¸ä»…å¢åŠ äº†ç»´æŠ¤æˆæœ¬ï¼Œè¿˜å®¹æ˜“å¯¼è‡´å›¾æ ‡é£æ ¼ä¸ç»Ÿä¸€ã€æ‰“åŒ…ä½“ç§¯è†¨èƒ€ç­‰é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡å°†åˆ†äº«æˆ‘ä»¬åœ¨ CMC Link IBS Web é¡¹ç›®ä¸­è¿›è¡Œçš„ä¸€æ¬¡å›¾æ ‡ç³»ç»Ÿé‡æ„å®è·µï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š<strong>ç»Ÿä¸€å›¾æ ‡æ¥æºï¼Œé™ä½ç»´æŠ¤æˆæœ¬ï¼Œæå‡å¼€å‘ä½“éªŒ</strong>ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€é—®é¢˜è¯Šæ–­ï¼šæ··ä¹±çš„å›¾æ ‡ç°çŠ¶</h2>
<h3 data-id="heading-2">1.1 ç°çŠ¶åˆ†æ</h3>
<p>é‡æ„å‰ï¼Œé¡¹ç›®ä¸­å­˜åœ¨ä¸¤å¥—å¹¶è¡Œçš„å›¾æ ‡æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-css" lang="css">å›¾æ ‡æ¥æº
â”œâ”€â”€ iconfontï¼ˆé˜¿é‡Œå›¾æ ‡åº“ï¼‰
â”‚   â”œâ”€â”€ iconfont<span class="hljs-selector-class">.css</span>     â†’ <span class="hljs-attribute">Font</span> Class æ¨¡å¼
â”‚   â””â”€â”€ iconfont<span class="hljs-selector-class">.js</span>      â†’ Symbol æ¨¡å¼ï¼ˆæ”¯æŒå½©è‰²ï¼‰
â”‚
â””â”€â”€ æœ¬åœ° SVG å›¾æ ‡
    â””â”€â”€ <span class="hljs-attribute">src</span>/assets/icons/ â†’ <span class="hljs-number">150</span>+ ä¸ª SVG æ–‡ä»¶
        â””â”€â”€ vite-plugin-svg-spritemap å¤„ç†
</code></pre>
<h3 data-id="heading-3">1.2 ç—›ç‚¹æ€»ç»“</h3>





























<table><thead><tr><th>é—®é¢˜</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>åŒé‡ç»´æŠ¤</strong></td><td>æ–°å¢å›¾æ ‡éœ€è¦å†³å®šæ”¾å“ªé‡Œï¼Œè€å‘˜å·¥ç”¨ SVGï¼Œæ–°å‘˜å·¥ç”¨ iconfont</td></tr><tr><td><strong>å¤„ç†é€»è¾‘å¤æ‚</strong></td><td>SVG éœ€è¦ SVGO æ’ä»¶å¤„ç† fill/stroke/width/height å±æ€§</td></tr><tr><td><strong>å½©è‰²å›¾æ ‡è¯†åˆ«å›°éš¾</strong></td><td>éœ€è¦é€šè¿‡æ–‡ä»¶åçº¦å®šï¼ˆ<code>c-</code> å‰ç¼€ï¼‰æˆ–å†…å®¹åˆ†ææ¥åˆ¤æ–­</td></tr><tr><td><strong>æ„å»ºä¾èµ–</strong></td><td>é¢å¤–å¼•å…¥ <code>@spiriit/vite-plugin-svg-spritemap</code> ä¾èµ–</td></tr><tr><td><strong>å¿ƒæ™ºè´Ÿæ‹…</strong></td><td>å¼€å‘è€…éœ€è¦äº†è§£ä¸¤å¥—æ–¹æ¡ˆçš„å·®å¼‚å’Œé€‚ç”¨åœºæ™¯</td></tr></tbody></table>
<h3 data-id="heading-4">1.3 æ ¸å¿ƒçŸ›ç›¾</h3>
<pre><code class="hljs language-markdown" lang="markdown">å¼€å‘æ•ˆç‡ vs æŠ€æœ¯å€ºåŠ¡
<span class="hljs-code">    â†“
æ¯æ¬¡æ–°å¢å›¾æ ‡éƒ½åœ¨ç´¯ç§¯æŠ€æœ¯å€º
    â†“
ç»´æŠ¤æˆæœ¬éšé¡¹ç›®è§„æ¨¡çº¿æ€§å¢é•¿
</span></code></pre>
<h2 data-id="heading-5">äºŒã€æ–¹æ¡ˆè®¾è®¡ï¼šå•ä¸€æ•°æ®æºæ¶æ„</h2>
<h3 data-id="heading-6">2.1 è®¾è®¡åŸåˆ™</h3>
<ol>
<li><strong>å•ä¸€æ•°æ®æº</strong>ï¼šæ‰€æœ‰å›¾æ ‡ç»Ÿä¸€ä» iconfont è·å–</li>
<li><strong>å‘åå…¼å®¹</strong>ï¼šç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯å·¥ä½œ</li>
<li><strong>æ¸è¿›è¿ç§»</strong>ï¼šæ”¯æŒæ–°æ—§å†™æ³•å¹¶å­˜ï¼Œé€æ­¥è¿‡æ¸¡</li>
<li><strong>å¼€å‘ä½“éªŒä¼˜å…ˆ</strong>ï¼šæ–°å¢å›¾æ ‡æµç¨‹ç®€åŒ–</li>
</ol>
<h3 data-id="heading-7">2.2 æ¶æ„è®¾è®¡</h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ä½¿ç”¨å±‚                          â”‚
â”‚  &lt;SvgIcon name="search" /&gt;  (æ—§ä»£ç ï¼Œæ— éœ€ä¿®æ”¹)    â”‚
â”‚  &lt;CmcIcon name="<span class="hljs-attribute">icon</span>-search" /&gt; (æ–°ä»£ç )         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SvgIcon (å…¼å®¹å±‚)                    â”‚
â”‚  - æ¥æ”¶æ—§çš„ name/<span class="hljs-attribute">icon</span> å±æ€§                       â”‚
â”‚  - é€šè¿‡æ˜ å°„è¡¨è½¬æ¢ä¸º iconfont åç§°                 â”‚
â”‚  - è‡ªåŠ¨åˆ¤æ–­å½©è‰²/å•è‰²                             â”‚
â”‚  - å†…éƒ¨æ¸²æŸ“ CmcIcon                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CmcIcon (æ ¸å¿ƒç»„ä»¶)                  â”‚
â”‚  - <span class="hljs-attribute">Font</span> Class æ¨¡å¼ï¼ˆå•è‰²ï¼Œå¯æ”¹é¢œè‰²ï¼‰              â”‚
â”‚  - Symbol æ¨¡å¼ï¼ˆå½©è‰²ï¼Œä¿ç•™åŸè‰²ï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           iconfont èµ„æº (å•ä¸€æ•°æ®æº)             â”‚
â”‚  - iconfont<span class="hljs-selector-class">.css</span> (Font Class)                    â”‚
â”‚  - iconfont<span class="hljs-selector-class">.js</span> (Symbol)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-8">2.3 å…³é”®è®¾è®¡å†³ç­–</h3>
<h4 data-id="heading-9">å†³ç­–1ï¼šä¸ºä»€ä¹ˆé€‰æ‹© iconfont ä½œä¸ºå•ä¸€æ•°æ®æºï¼Ÿ</h4>




















<table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜åŠ¿</th><th>åŠ£åŠ¿</th></tr></thead><tbody><tr><td><strong>æœ¬åœ° SVG</strong></td><td>å®Œå…¨å¯æ§ã€ç¦»çº¿å¯ç”¨</td><td>éœ€è¦æ„å»ºå¤„ç†ã€ç»´æŠ¤æˆæœ¬é«˜</td></tr><tr><td><strong>iconfont</strong></td><td>åœ¨çº¿ç®¡ç†ã€å›¢é˜Ÿåä½œã€æ”¯æŒå½©è‰²</td><td>ä¾èµ–å¤–éƒ¨æœåŠ¡</td></tr></tbody></table>
<p>é€‰æ‹© iconfont çš„åŸå› ï¼š</p>
<ul>
<li>å·²æœ‰æˆç†Ÿçš„å›¾æ ‡åº“ï¼ˆ400+ å›¾æ ‡ï¼‰</li>
<li>æ”¯æŒ Symbol æ¨¡å¼ï¼ˆå½©è‰²å›¾æ ‡ï¼‰</li>
<li>å›¢é˜Ÿåä½œå‹å¥½ï¼ˆè®¾è®¡å¸ˆå¯ç›´æ¥ä¸Šä¼ ï¼‰</li>
<li>æ— éœ€é¢å¤–æ„å»ºæ’ä»¶</li>
</ul>
<h4 data-id="heading-10">å†³ç­–2ï¼šå…¼å®¹å±‚è®¾è®¡</h4>
<p>ä¸ç ´åç°æœ‰ä»£ç æ˜¯é‡æ„çš„åº•çº¿ã€‚é€šè¿‡ä»£ç†æ¨¡å¼ï¼Œè®©æ—§çš„ <code>SvgIcon</code> ç»„ä»¶å†…éƒ¨è°ƒç”¨æ–°çš„ <code>CmcIcon</code>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- SvgIcon.vue - å…¼å®¹å±‚ --&gt;
&lt;script setup lang="ts"&gt;
import CmcIcon from '../CmcIcon/CmcIcon.vue'
import { getIconfontName, isColorfulIcon } from '../CmcIcon/icon-mapping'

// ... props å®šä¹‰

const iconfontName = computed(() =&gt; getIconfontName(rawIconName.value))
const colorful = computed(() =&gt; isColorfulIcon(rawIconName.value))
&lt;/script&gt;

&lt;template&gt;
  &lt;CmcIcon
    :name="iconfontName"
    :size="size"
    :color="color"
    :colorful="colorful"
  /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-11">å†³ç­–3ï¼šæ˜ å°„è¡¨ç­–ç•¥</h4>
<p>å¯¹äºåç§°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé€šè¿‡æ˜ å°„è¡¨è§£å†³ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// icon-mapping.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">SVG_TO_ICONFONT_MAP</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {
  <span class="hljs-string">'dingcangicon'</span>: <span class="hljs-string">'icon-menu-dingcang'</span>,
  <span class="hljs-string">'billoflading'</span>: <span class="hljs-string">'icon-menu-tidan'</span>,
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">COLORFUL_ICONS</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([
  <span class="hljs-string">'menu-chukou'</span>,
  <span class="hljs-string">'menu-jinkou'</span>,
  <span class="hljs-string">'USD'</span>, <span class="hljs-string">'CNY'</span>, <span class="hljs-string">'EUR'</span>,
  <span class="hljs-comment">// ...</span>
])
</code></pre>
<h2 data-id="heading-12">ä¸‰ã€å®ç°ç»†èŠ‚</h2>
<h3 data-id="heading-13">3.1 CmcIcon æ ¸å¿ƒç»„ä»¶</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;script lang="ts" setup&gt;
interface Props {
  name: string           // å›¾æ ‡åç§°ï¼ˆéœ€å¸¦ icon- å‰ç¼€ï¼‰
  size?: number | string // å°ºå¯¸ï¼Œé»˜è®¤ 16px
  color?: string         // é¢œè‰²ï¼ˆä»…å•è‰²æœ‰æ•ˆï¼‰
  colorful?: boolean     // æ˜¯å¦ä¸ºå½©è‰²å›¾æ ‡
}

const props = withDefaults(defineProps&lt;Props&gt;(), {
  size: 16,
  color: 'currentColor',
  colorful: false,
})
&lt;/script&gt;

&lt;template&gt;
  &lt;!-- å½©è‰²å›¾æ ‡ï¼šSymbol æ¨¡å¼ --&gt;
  &lt;svg v-if="colorful" class="cmc-icon" :style="{ width: sizeValue, height: sizeValue }"&gt;
    &lt;use :xlink:href="`#${iconName}`" /&gt;
  &lt;/svg&gt;

  &lt;!-- å•è‰²å›¾æ ‡ï¼šFont Class æ¨¡å¼ --&gt;
  &lt;i v-else class="cmc-icon iconfont-cmc" :class="iconName" :style="{ fontSize: sizeValue, color }" /&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-14">3.2 iconfont çš„ä¸¤ç§æ¨¡å¼</h3>
<p><strong>Font Class æ¨¡å¼</strong>ï¼ˆå•è‰²å›¾æ ‡ï¼‰ï¼š</p>
<ul>
<li>é€šè¿‡ CSS ç±»åå¼•ç”¨å›¾æ ‡</li>
<li>æ”¯æŒ <code>color</code> å±æ€§åŠ¨æ€æ”¹å˜é¢œè‰²</li>
<li>æ–‡ä»¶ï¼š<code>iconfont.css</code></li>
</ul>
<p><strong>Symbol æ¨¡å¼</strong>ï¼ˆå½©è‰²å›¾æ ‡ï¼‰ï¼š</p>
<ul>
<li>é€šè¿‡ SVG <code>&lt;use&gt;</code> å¼•ç”¨</li>
<li>ä¿ç•™å›¾æ ‡åŸå§‹é¢œè‰²</li>
<li>æ–‡ä»¶ï¼š<code>iconfont.js</code></li>
</ul>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å•è‰²ï¼šå¯é€šè¿‡ color æ§åˆ¶é¢œè‰² --&gt;
&lt;CmcIcon name="icon-search" color="red" /&gt;

&lt;!-- å½©è‰²ï¼šä¿ç•™åŸå§‹å¤šè‰² --&gt;
&lt;CmcIcon name="icon-menu-chukou" colorful /&gt;
</code></pre>
<h3 data-id="heading-15">3.3 æ¸…ç†å†—ä½™ä»£ç </h3>
<p>ç§»é™¤äº†ä¸å†éœ€è¦çš„æ„å»ºé…ç½®ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">// build/plugins.ts
<span class="hljs-deletion">- import VitePluginSVGSpritemap from '@spiriit/vite-plugin-svg-spritemap'</span>

export function createVitePlugins() {
  return [
    // ...å…¶ä»–æ’ä»¶
<span class="hljs-deletion">-   createSvgIconsPlugin(),  // ç§»é™¤ SVG å¤„ç†æ’ä»¶</span>
  ]
}

<span class="hljs-deletion">- // ç§»é™¤ 138 è¡Œ SVG å¤„ç†ä»£ç </span>
<span class="hljs-deletion">- function createSvgIconsPlugin() { ... }</span>
<span class="hljs-deletion">- function processMonoIcon() { ... }</span>
<span class="hljs-deletion">- function processRootIcon() { ... }</span>
<span class="hljs-deletion">- function traverseSvgNodes() { ... }</span>
</code></pre>
<h2 data-id="heading-16">å››ã€æ”¶ç›Šåˆ†æ</h2>
<h3 data-id="heading-17">4.1 é‡åŒ–æ”¶ç›Š</h3>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>é‡æ„å‰</th><th>é‡æ„å</th><th>å˜åŒ–</th></tr></thead><tbody><tr><td>å›¾æ ‡æ¥æº</td><td>2 å¥—</td><td>1 å¥—</td><td>-50%</td></tr><tr><td>æ„å»ºä¾èµ–</td><td>+1</td><td>0</td><td>-100%</td></tr><tr><td>plugins.ts ä»£ç è¡Œæ•°</td><td>241</td><td>103</td><td>-57%</td></tr><tr><td>æ–°å¢å›¾æ ‡æ­¥éª¤</td><td>5 æ­¥</td><td>3 æ­¥</td><td>-40%</td></tr></tbody></table>
<h3 data-id="heading-18">4.2 å®šæ€§æ”¶ç›Š</h3>
<ol>
<li><strong>é™ä½å¿ƒæ™ºè´Ÿæ‹…</strong>ï¼šå¼€å‘è€…åªéœ€äº†è§£ä¸€å¥—æ–¹æ¡ˆ</li>
<li><strong>ç®€åŒ–æ–°å¢æµç¨‹</strong>ï¼šä¸Šä¼  iconfont â†’ æ›´æ–°èµ„æº â†’ ä½¿ç”¨</li>
<li><strong>å‡å°‘æ„å»ºæ—¶é—´</strong>ï¼šç§»é™¤ SVGO å¤„ç†ç¯èŠ‚</li>
<li><strong>ä»£ç æ›´ç®€æ´</strong>ï¼šæ ¸å¿ƒç»„ä»¶ &lt; 100 è¡Œ</li>
</ol>
<h3 data-id="heading-19">4.3 æ–°å¢å›¾æ ‡æµç¨‹å¯¹æ¯”</h3>
<p><strong>é‡æ„å‰</strong>ï¼ˆSVG æ–¹æ¡ˆï¼‰ï¼š</p>
<ol>
<li>è·å– SVG æ–‡ä»¶</li>
<li>åˆ¤æ–­æ˜¯å•è‰²è¿˜æ˜¯å½©è‰²</li>
<li>å¦‚æœå•è‰²ï¼Œæ‰‹åŠ¨å¤„ç† fill/stroke å±æ€§</li>
<li>æ”¾å…¥å¯¹åº”ç›®å½•ï¼ˆmono/ æˆ– colorful/ï¼‰</li>
<li>ä½¿ç”¨ <code>&lt;SvgIcon name="xxx" /&gt;</code></li>
</ol>
<p><strong>é‡æ„å</strong>ï¼ˆiconfont æ–¹æ¡ˆï¼‰ï¼š</p>
<ol>
<li>ä¸Šä¼ åˆ° iconfont é¡¹ç›®</li>
<li>ä¸‹è½½æ›´æ–°èµ„æºæ–‡ä»¶</li>
<li>ä½¿ç”¨ <code>&lt;CmcIcon name="icon-xxx" /&gt;</code></li>
</ol>
<h2 data-id="heading-20">äº”ã€ç»éªŒæ€»ç»“</h2>
<h3 data-id="heading-21">5.1 é‡æ„åŸåˆ™</h3>
<ol>
<li><strong>å‘åå…¼å®¹æ˜¯åº•çº¿</strong>ï¼šé€šè¿‡å…¼å®¹å±‚ä¿è¯ç°æœ‰ä»£ç æ­£å¸¸å·¥ä½œ</li>
<li><strong>æ¸è¿›å¼è¿ç§»</strong>ï¼šæ–°ä»£ç ç”¨æ–°æ–¹æ¡ˆï¼Œæ—§ä»£ç æŒ‰éœ€è¿ç§»</li>
<li><strong>å•ä¸€æ•°æ®æº</strong>ï¼šé¿å…å¤šæºå¹¶å­˜çš„æ··ä¹±</li>
<li><strong>ç®€åŒ–ä¼˜äºå®Œç¾</strong>ï¼šå¤Ÿç”¨å°±å¥½ï¼Œä¸è¿‡åº¦è®¾è®¡</li>
</ol>
<h3 data-id="heading-22">5.2 æŠ€æœ¯é€‰å‹æ€è€ƒ</h3>
<p>é€‰æ‹© iconfont è€Œéè‡ªå»º SVG æ–¹æ¡ˆçš„æ ¸å¿ƒåŸå› ï¼š</p>
<ul>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šè®¾è®¡å¸ˆå¯ç›´æ¥åœ¨ iconfont ç®¡ç†å›¾æ ‡</li>
<li><strong>æˆæœ¬æ•ˆç›Š</strong>ï¼šåˆ©ç”¨ç°æœ‰æˆç†Ÿæ–¹æ¡ˆï¼Œé¿å…é‡å¤é€ è½®å­</li>
<li><strong>å½©è‰²æ”¯æŒ</strong>ï¼šSymbol æ¨¡å¼åŸç”Ÿæ”¯æŒå¤šè‰²å›¾æ ‡</li>
</ul>
<h3 data-id="heading-23">5.3 é€‚ç”¨åœºæ™¯</h3>
<p>æœ¬æ–¹æ¡ˆé€‚åˆï¼š</p>
<ul>
<li>å·²åœ¨ä½¿ç”¨ iconfont çš„é¡¹ç›®</li>
<li>å›¢é˜Ÿè§„æ¨¡ä¸­ç­‰ä»¥ä¸Šï¼Œéœ€è¦è®¾è®¡å¸ˆåä½œ</li>
<li>å›¾æ ‡æ›´æ–°é¢‘ç¹çš„ä¸šåŠ¡ç³»ç»Ÿ</li>
</ul>
<p>ä¸å¤ªé€‚åˆï¼š</p>
<ul>
<li>å¯¹ç¦»çº¿å¯ç”¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯</li>
<li>å›¾æ ‡éœ€è¦å¤æ‚åŠ¨ç”»çš„åœºæ™¯</li>
<li>å®Œå…¨ç§æœ‰åŒ–éƒ¨ç½²ã€æ— æ³•è®¿é—®å¤–ç½‘çš„ç¯å¢ƒ</li>
</ul>
<h2 data-id="heading-24">å…­ã€åç»­ä¼˜åŒ–æ–¹å‘</h2>
<ol>
<li><strong>è‡ªåŠ¨åŒ–æ›´æ–°</strong>ï¼šç¼–å†™è„šæœ¬è‡ªåŠ¨ä» iconfont æ‹‰å–æœ€æ–°èµ„æº</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç”Ÿæˆå›¾æ ‡åç§°çš„ TypeScript ç±»å‹å®šä¹‰</li>
<li><strong>æŒ‰éœ€åŠ è½½</strong>ï¼šå¯¹äºå¤§å‹å›¾æ ‡åº“ï¼Œè€ƒè™‘æŒ‰éœ€åŠ è½½ç­–ç•¥</li>
<li><strong>æ–‡æ¡£è‡ªåŠ¨åŒ–</strong>ï¼šä» iconfont.json è‡ªåŠ¨ç”Ÿæˆå›¾æ ‡æ–‡æ¡£</li>
</ol>
<h2 data-id="heading-25">ç»“è¯­</h2>
<p>å›¾æ ‡ç³»ç»Ÿçœ‹ä¼¼æ˜¯ä¸ªå°é—®é¢˜ï¼Œä½†åœ¨å¤§å‹é¡¹ç›®ä¸­å´èƒ½æ˜¾è‘—å½±å“å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚è¿™æ¬¡é‡æ„çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼š<strong>è¯†åˆ«æŠ€æœ¯å€ºåŠ¡ â†’ è®¾è®¡å…¼å®¹æ–¹æ¡ˆ â†’ ç»Ÿä¸€æ•°æ®æº â†’ æ¸è¿›å¼è¿ç§»</strong>ã€‚</p>
<p>å¸Œæœ›æœ¬æ–‡çš„å®è·µç»éªŒèƒ½ä¸ºä½ çš„é¡¹ç›®æä¾›ä¸€äº›å‚è€ƒã€‚è®°ä½ï¼Œæœ€å¥½çš„æ¶æ„ä¸æ˜¯æœ€å¤æ‚çš„ï¼Œè€Œæ˜¯æœ€é€‚åˆå›¢é˜Ÿçš„ã€‚</p>
<hr/>
<p><em>æœ¬æ–‡åŸºäºå…¬å¸é¡¹ç›®çš„çœŸå®é‡æ„å®è·µæ•´ç†ï¼Œå¦‚æœ‰é—®é¢˜æ¬¢è¿è®¨è®ºã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¼«è°ˆ JS è§£æä¸ä½œç”¨åŸŸé”å®š]]></title>    <link>https://juejin.cn/post/7582785032851947583</link>    <guid>https://juejin.cn/post/7582785032851947583</guid>    <pubDate>2025-12-12T10:37:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582785032851947583" data-draft-id="7582808491606818870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¼«è°ˆ JS è§£æä¸ä½œç”¨åŸŸé”å®š"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-12T10:37:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€é”¤æŒæ‹¾"/> <meta itemprop="url" content="https://juejin.cn/user/565561530002222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¼«è°ˆ JS è§£æä¸ä½œç”¨åŸŸé”å®š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/565561530002222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€é”¤æŒæ‹¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:37:46.000Z" title="Fri Dec 12 2025 10:37:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™éƒ¨åˆ†å†…å®¹ï¼Œå­¦äº†å½“ç„¶æœ€å¥½ï¼Œæ²¡å­¦ï¼Œä¹Ÿä¸å½±å“å‰ç«¯å¼€å‘ã€‚å½“ç„¶ï¼Œèƒ½äº†è§£è‚¯å®šæ˜¯æ¯”ä¸äº†è§£çš„å¼ºã€‚</p>
<p>ä¾æ—§æ˜¯æ— å›¾æ— ç ï¼Œç½‘æ–‡é£æ ¼ã€‚æˆ‘è§‰å¾—ï¼Œèƒ½ç”¨æ–‡å­—æŠŠé€»è¾‘æˆ–è€…æ¦‚å¿µè¡¨è¿°æ¸…æ¥šï¼Œä¸€æ˜¯å¯¹ä½œè€…æœ¬èº«çš„èƒ½åŠ›æå‡æœ‰å¥½å¤„ï¼ŒäºŒæ˜¯å¯¹è¯»è€…æ¥è¯´ æ€è€ƒæ–‡å­—è¡¨è¾¾çš„å†…å®¹ æœ‰åŠ©äºå¤šä½¿ç”¨æŠ½è±¡æ€ç»´å’Œé€»è¾‘æ€ç»´èƒ½åŠ›ï¼Œæ„å»ºè‡ªå·±çš„æ€è€ƒæ¨¡å¼ï¼Œç”¨ç°åœ¨æµè¡Œçš„è¯´æ³•  å°±æ˜¯å¿ƒæ™ºæ¨¡å‹ã€‚ä½ è‡ªå·±ä»€ä¹ˆéƒ½å¯ä»¥è„‘è¡¥ï¼Œé‚£ä¸æ˜¯å‰å®³å¤§äº†å˜›ã€‚</p>
<p>ä¸Šé¢çš„è¯ä¸è¦ç›¸ä¿¡ï¼Œå…¶å®æˆ‘å°±æ˜¯ä¸ºè‡ªå·±æ‡’æ‰¾çš„å€Ÿå£ã€‚</p>
<p>å› ä¸ºæ ‡é¢˜å°±è¯´äº†  æ˜¯æ¼«è°ˆï¼Œæ‰€ä»¥æœ‰äº›ç»†èŠ‚åšäº†çœç•¥  æœ‰äº›è¾¹ç•Œæƒ…å†µåšäº†ç®€åŒ–è¡¨è¿°ã€‚ä½†æ˜¯æ€»ä½“æ¥è¯´  å‡†ç¡®æ€§è¿˜æ˜¯å¯ä»¥çš„ã€‚å¦‚æœæœ‰é”™æ¼çš„åœ°æ–¹ï¼Œè¿˜è¯·å¤šå¤šæŒ‡æ­£ã€‚ è¿™æ˜¯ç¬¬ä¸€éƒ¨åˆ† è¯æ³•å’Œè¯­æ³•åˆ†æã€‚</p>
<h2 data-id="heading-0">ä¸€.è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æ</h2>
<p>å½“æµè§ˆå™¨ä»ç½‘ç»œä¸‹è½½äº†jsæ–‡ä»¶ï¼Œæ¯”å¦‚app.jsï¼Œæµè§ˆå™¨å¼•æ“æ‹¿åˆ°çš„æœ€åˆå½¢æ€æ˜¯ä¸€ä¸²**å­—èŠ‚æµ **ã€‚</p>
<ol>
<li>
<p><strong>è¯†åˆ«ï¼š</strong> V8 é¦–å…ˆè¦å¤„ç†ç¼–ç ï¼ŒV8 æ¥æ”¶çš„æ˜¯ UTF-8 ç¼–ç çš„å­—èŠ‚æµï¼Œå†…éƒ¨ä¼šè½¬æ¢ä¸º UTF-16 å¤„ç†å­—ç¬¦ä¸²ã€‚</p>
</li>
<li>
<p><strong>æµå¼å¿«é€Ÿå¤„ç†ï¼š</strong> å¼•æ“å¹¶ä¸æ˜¯ç­‰æ•´ä¸ªæ–‡ä»¶ä¸‹è½½å®Œæ‰å¼€å§‹å¹²æ´»çš„ã€‚åªè¦ç½‘ç»œä¼ è¿‡æ¥ä¸€æ®µæ•°æ®ï¼ŒV8 çš„<strong>æ‰«æå™¨</strong>å°±å¼€å§‹å·¥ä½œäº†ã€‚ è¿™æ ·å¯ä»¥åŠ å¿«å¯åŠ¨é€Ÿåº¦ã€‚æ­¤æ—¶çš„çŠ¶æ€å°±æ˜¯æ¯«æ— æ„ä¹‰çš„å­—ç¬¦  <code>c</code>, <code>o</code>, <code>n</code>, <code>s</code>, <code>t</code>, <code>     </code>, <code>a</code>, <code>     </code>, <code>=</code>, <code>     </code>, <code>1</code>, <code>;</code> ...</p>
</li>
<li>
<p>ç„¶åçš„è¿™ä¸€æ­¥å« <strong>Tokenization è¯è¯­åˆ‡åˆ†</strong>ã€‚ è´Ÿè´£è¿™ä¸€æ­¥çš„ç»„ä»¶å°±æ˜¯ä¸Šé¢æåˆ°çš„å« <strong>Scannerï¼ˆæ‰«æå™¨ï¼‰</strong>ã€‚å®ƒçš„å·¥ä½œå°±åƒæ˜¯ä¸€ä¸ªåˆ‡èœå·¥ï¼ŒæŠŠæ»”æ»”ä¸ç»è¿ç»µä¸æ–­çš„å­—ç¬¦ä¸²åˆ‡æˆä¸€ä¸ªä¸ªæœ‰è¯­æ³•æ„ä¹‰çš„æœ€å°å•ä½ï¼Œå«åš <strong>Tokenï¼ˆè®°å·ï¼‰</strong>ã€‚çœ‹åˆ°è¿™ä¸ªè¯ ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯æƒŠè§‰å¿ƒä¸€ç¼©ï¼Œæ²¡é”™ï¼Œå°±æ˜¯å®ƒï¼Œ<strong>å®ƒä»¬</strong>å°±æ˜¯ä»¥å®ƒä¸ºå•ä½æ¥æ”¶å’±é’±çš„ã€‚</p>
<p>scanner å†…éƒ¨æ˜¯ä¸€ä¸ªçŠ¶æ€æœºã€‚å®ƒé€ä¸ªè¯»å–å­—ç¬¦ï¼š</p>
<ul>
<li>è¯»åˆ° <code>c</code>  å¯èƒ½æ˜¯ <code>const</code>ï¼Œä¹Ÿå¯èƒ½æ˜¯å˜é‡åï¼Œç»§ç»­ã€‚</li>
<li>è¯»åˆ° <code>o</code>, <code>n</code>, <code>s</code>, <code>t</code>  å‡‘é½äº†5ä¸ªå¨ƒï¼Œ<strong>ä¸”ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯å­—æ¯ï¼ˆæ¯”å¦‚æ˜¯ç©ºæ ¼ï¼‰</strong>ï¼Œç¡®è®¤è¿™æ˜¯ä¸€ä¸ªå…³é”®å­— constã€‚â€ï¼ˆé˜²æ­¢è¯¯åˆ¤ <code>constant</code> è¿™ç§å˜é‡åï¼‰</li>
<li>è¯»åˆ° <code>     </code> ç©ºæ ¼ å¿½ç•¥ï¼Œè·³è¿‡å»ã€‚</li>
<li>è¯»åˆ° <code>1</code>   è¿™æ˜¯ä¸€ä¸ªæ•°å­—ã€‚</li>
</ul>
<p>è¿™æ ·å°±ç”±åŸæ¥çš„å­—èŠ‚æµå˜æˆäº† <strong>Token æµ</strong>ã€‚è¿™æ˜¯ä¸€ç§æ‰å¹³çš„åˆ—è¡¨ç»“æ„ã€‚</p>
<ul>
<li><strong>æºç ï¼š</strong> <code>const a = 1;</code></li>
<li><strong>Token æµï¼š</strong>
<ul>
<li><code>CONST</code> (å…³é”®å­—)</li>
<li><code>IDENTIFIER</code> (å€¼ä¸º "a")</li>
<li><code>ASSIGN</code> (ç¬¦å· "=")</li>
<li><code>SMI</code> (å°æ•´æ•° "1")</li>
<li><code>SEMICOLON</code> (ç¬¦å· ";")</li>
</ul>
</li>
</ul>
<p>è¿™ä¸€æ­¥ï¼Œæ³¨é‡Šå’Œå¤šä½™çš„ç©ºæ ¼å’Œæ¢è¡Œç¬¦ä¼šè¢«æŠ›å¼ƒã€‚</p>
</li>
<li>
<p>ç°åœ¨å°±æ˜¯è§£æé˜¶æ®µäº†</p>
<p>å…¶å®è§£ææ˜¯ä¸€ä¸ªæ€»ç§°ï¼Œå®ƒåˆ†ä¸º å…¨é‡è§£æ å’Œ é¢„è§£æ ä¸¤ç§å½¢å¼ã€‚</p>
<p>è¿™å°±æ˜¯v8çš„æ‡’è§£ææœºåˆ¶ã€‚çœ‹åˆ°è¿™ä¸ªæ‡’å­—ï¼Œä¹Ÿå·®ä¸å¤šèƒ½æ˜ç™½äº†å§ã€‚</p>
<p>å¯¹äºé‚£äº›<strong>ä¸æ˜¯ç«‹å³æ‰§è¡Œ</strong>çš„å‡½æ•°ï¼ˆæ¯”å¦‚ç‚¹å‡»æŒ‰é’®æ‰è§¦å‘çš„å›è°ƒï¼‰ï¼ŒV8 ä¼šå…ˆç”¨é¢„è§£æå¿«é€Ÿæ‰«ä¸€éã€‚</p>
<p>æ£€æŸ¥åŸºæœ¬çš„è¯­æ³•é”™è¯¯ï¼ˆæ¯”å¦‚æœ‰æ²¡æœ‰å°‘å†™æ‹¬å·ï¼‰ï¼Œ<strong>ç¡®è®¤è¿™æ˜¯ä¸€ä¸ªå‡½æ•°</strong>ã€‚å¹¶ä¸ä¼šç”Ÿæˆå¤æ‚çš„ AST ç»“æ„ï¼Œä¹Ÿä¸å»ºç«‹å…·ä½“çš„å˜é‡ç»‘å®šï¼Œåªè¿›è¡Œæœ€åŸºç¡€çš„é—­åŒ…å¼•ç”¨æ£€æŸ¥ã€‚å¾¡å§å–œçš„ç»“æœæ˜¯è¿™ä¸ªå‡½æ•°åœ¨å†…å­˜é‡Œåªæ˜¯ä¸€ä¸ªå¾ˆå°çš„<strong>å ä½ç¬¦</strong>ï¼Œè·³è¿‡å†…éƒ¨ç»†èŠ‚ã€‚</p>
<p>è€Œåªæœ‰é‚£äº›<strong>ç«‹å³æ‰§è¡Œå‡½æ•°</strong>æˆ–è€…é¡¶å±‚ä»£ç ï¼Œæ‰ä¼šè¿›å…¥çœŸæ­£çš„å…¨é‡è§£æï¼Œè¿›è¡Œå®Œæ•´çš„ AST æ„å»ºã€‚</p>
<p>é‚£ä¹ˆï¼Œé—®é¢˜å°±æ¥äº†ï¼Œv8æ€ä¹ˆåˆ¤æ–­åˆ°åº•æ˜¯ä½¿ç”¨é¢„è§£æè¿˜æ˜¯ä½¿ç”¨å…¨é‡è§£æå‘¢ï¼Ÿ</p>
<p>å®ƒçš„åŸåˆ™å°±æ˜¯  æ‡’æƒ°ä¸ºä¸»  å…¨é‡ä¸ºè¾…</p>
<p>å°±æ˜¯v8é»˜è®¤ä½ å†™çš„å‡½æ•°æš‚æ—¶ä¸ä¼šæ‰§è¡Œï¼Œé™¤éæ˜¯å·²ç»æ˜¾å¼çš„é€šè¿‡è¯­æ³•å‘Šè¯‰å®ƒï¼Œè¿™æ®µè¿™è¡Œä»£ç  é©¬ä¸Šå°±è¦è·‘ ä½ èµ¶å¿«å…¨é‡è§£æã€‚</p>
<p>ä¸‹é¢ æˆ‘ä»¬ç¨å¾®è¯¦ç»†çš„è¯´ä¸€ä¸‹</p>
<ul>
<li>
<p>é»˜è®¤ç»å¤§å¤šæ•°å‡½æ•°éƒ½æ˜¯é¢„è§£æ</p>
<p>v8è®¤ä¸ºjsåœ¨åˆå§‹è¿è¡Œæ—¶ï¼Œä»…ä»…åªæœ‰å¾ˆå°‘å¾ˆå°‘ä¸€éƒ¨åˆ†ä»£ç  æ˜¯éœ€è¦é©¬ä¸Šä½¿ç”¨çš„  å…¶ä»–è§‰å¾—å¤§éƒ¨åˆ† éƒ½æ˜¯è¦ä¹ˆæ˜¯å›è°ƒ è¦ä¹ˆæ˜¯å…¶ä»–çš„æš‚æ—¶ç”¨ä¸åˆ°çš„ï¼Œæ‰€ä»¥ï¼Œ<strong>å‡¡æ˜¯å…·åå‡½æ•°å£°æ˜ã€åµŒå¥—å‡½æ•°</strong>ï¼Œé»˜è®¤éƒ½æ˜¯é¢„è§£æã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">clickHandler</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"è¦ä¸è¦è§£ææˆ‘"</span>);
}
<span class="hljs-comment">// å¼•æ“è®¤ä¸º è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å£°æ˜  çœ‹èµ·æ¥è¿˜æ²¡äººè°ƒå‹‡å®ƒ</span>
<span class="hljs-comment">// å…ˆä¸æµªè´¹æ—¶é—´äº†ï¼Œåªæ£€æŸ¥ä¸€ä¸‹æ‹¬å·åŒ¹é…å§ï¼Œ</span>
<span class="hljs-comment">// æŠŠå®ƒæ ‡è®°ä¸º 'uncompiled'ï¼Œç„¶åè·³è¿‡ã€‚"</span>
</code></pre>
</li>
<li>
<p>é‚£ä¹ˆ  å¦‚ä½•æ‰èƒ½ç¬¦åˆå®ƒè¿›è¡Œå…¨é‡è§£æçš„æ¡ä»¶å‘¢</p>
<ol>
<li>
<p>é¡¶å±‚ä»£ç </p>
<p>å†™åœ¨æœ€å¤–å±‚ ä¸åœ¨ä»»ä½•å‡½æ•°å†… çš„ä»£ç ï¼ŒåŠ è½½å®Œå¿…é¡»ç«‹å³æ‰§è¡Œã€‚</p>
<p><strong>åˆ¤æ–­ä¾æ®ï¼š</strong> åªè¦ä¸åœ¨ <code>function</code> å—é‡Œçš„ä»£ç ï¼Œå…¨æ˜¯é¡¶å±‚ä»£ç ï¼Œå¿…é¡»å…¨é‡è§£æã€‚</p>
</li>
<li>
<p>ç«‹å³æ‰§è¡Œå‡½æ•°</p>
<p>é‚£ä¹ˆè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯V8 å¦‚ä½•åœ¨è¿˜æ²¡è¿è¡Œä»£ç æ—¶ï¼Œå°±çŸ¥é“è¿™ä¸ªå‡½æ•°æ˜¯ç«‹å³è°ƒç”¨æ‰§è¡Œå‡½æ•°å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆå°±æ˜¯  çœ‹æ‹¬å·ï¼ˆï¼‰</p>
<p>å½“è§£æå™¨æ‰«æåˆ°ä¸€ä¸ªå‡½æ•°å…³é”®å­— <code>function</code> æ—¶ï¼Œå®ƒä¼šçœ‹ä¸€çœ¼<strong>è¿™ä¸ª function ä¹‹å‰æœ‰æ²¡æœ‰å·¦æ‹¬å· <code>(</code></strong></p>
<ul>
<li>
<p>æ²¡æ‹¬å·</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">function <span class="hljs-title">foo</span>()</span> { ... }
<span class="hljs-comment">// æ²¡çœ‹åˆ°å·¦æ‹¬å·ï¼Œé‚£ä½ å…ˆé è¾¹å§ï¼Œ å¯¹å®ƒé¢„è§£æã€‚</span>
</code></pre>
</li>
<li>
<p>æœ‰æ‹¬å·</p>
<pre><code class="hljs language-javascript" lang="javascript">(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { ... })();
<span class="hljs-comment">// æ‰«æå™¨æ‰«åˆ°äº†è¿™ä¸ªå·¦æ‹¬å·</span>
<span class="hljs-comment">// æ¬¸ï¼Œè¿™æœ‰ä¸ªå·¦æ‹¬å·åŒ…ç€ function</span>
<span class="hljs-comment">// æ ¹æ®ä¸‡å¹´ç»éªŒï¼Œè¿™æ˜¯ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œé©¬ä¸Šå°±è¦æ‰§è¡Œã€‚</span>
<span class="hljs-comment">// ç›´æ¥ä¸Šå¤§èœï¼Œå…¨é‡è§£æï¼Œç”Ÿæˆ AST</span>
</code></pre>
</li>
<li>
<p>å…¶ä»–çš„ç«‹å³æ‰§è¡Œçš„è¿¹è±¡ï¼šé™¤äº†æ‹¬å·ï¼Œ<code>!</code>ã€<code>+</code>ã€<code>-</code> ç­‰ä¸€å…ƒè¿ç®—ç¬¦æ”¾åœ¨ <code>function</code> å‰é¢ï¼Œä¹Ÿä¼šè§¦å‘å…¨é‡è§£æ</p>
<pre><code class="hljs language-scss" lang="scss">!<span class="hljs-built_in">function</span>() { ... }(); <span class="hljs-comment">// å…¨é‡è§£æ</span>
</code></pre>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p>å¦‚æœæœ‰åµŒå¥—å‡½æ•°å’‹åŠå‘¢</p>
<p>åµŒå¥—å‡½æ•°é»˜è®¤æ˜¯é¢„è§£æï¼Œå³ä½¿å¤–éƒ¨å‡½æ•°è¿›è¡Œçš„æ˜¯å…¨é‡è§£æï¼Œå®ƒå†…éƒ¨å®šä¹‰çš„å­å‡½æ•°ï¼Œé»˜è®¤ä¾ç„¶æ˜¯é¢„è§£æã€‚åªæœ‰å½“å­å‡½æ•°çœŸçš„è¢«<strong>è°ƒç”¨</strong>æ—¶ï¼ŒV8 æ‰ä¼šæš‚åœæ‰§è¡Œï¼Œå»æŠŠå­å‡½æ•°çš„å…¨é‡è§£æåšå®Œ æŠŠ AST è¡¥é½</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">//é¡¶å±‚ä»£ç å…¨é‡è§£æ</span>
(<span class="hljs-function">function <span class="hljs-title">outer</span>()</span> {
  <span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;

  <span class="hljs-comment">// å†…éƒ¨å‡½æ•° innerï¼š</span>
  <span class="hljs-comment">// è™½ç„¶ outer æ­£åœ¨æ‰§è¡Œï¼Œä½† inner è¿˜æ²¡è¢«è°ƒç”¨</span>
  <span class="hljs-comment">// å¼•æ“ä¹Ÿä¸ç¡®å®š inner ä¼šä¸ä¼šè¢«è°ƒç”¨ã€‚</span>
  <span class="hljs-comment">// æ‰€ä»¥inner é»˜è®¤é¢„è§£æã€‚</span>
  <span class="hljs-function">function <span class="hljs-title">inner</span>()</span> {
    <span class="hljs-keyword">var</span> b = <span class="hljs-number">2</span>;
  }

  inner(); <span class="hljs-comment">// ç›´åˆ°æ‰§è¡Œåˆ°è¿™ä¸€è¡Œï¼Œå¼•æ“æ‰ä¼šå›å¤´å»å¯¹ inner è¿›è¡Œå…¨é‡è§£æ</span>
})();
</code></pre>
</li>
<li>
<p>é‚£ä¹ˆ  å¼•æ“æ ¹æ®è‡ªå·±çš„åˆ¤æ–­ è¿›è¡Œå…¨é‡è§£ææˆ–è€…é¢„è§£æï¼Œä¼šå‡ºé”™å—</p>
<p>å½“ç„¶ä¼šï¼Œ</p>
<p>å¦‚æœæ˜¯æœ¬è¯¥é¢„è§£æçš„  ç»“æœåˆ¤æ–­é”™äº†  è¿›è¡Œäº†å…¨é‡è§£æ   æµªè´¹äº†æ—¶é—´å’Œå†…å­˜ç”Ÿæˆäº† AST å’Œå­—èŠ‚ç ï¼Œç»“æœè¿™ä»£ç æ ¹æœ¬æ²¡è·‘ã€‚</p>
<p>å¦‚æœæ˜¯æœ¬è¯¥å…¨é‡è§£æçš„åˆå·¨åˆå¤§åˆé‡çš„å‡½æ•°  ç»“æœåˆ¤æ–­é”™äº†  è¿›è¡Œäº†é¢„è§£æï¼Œç„¶åé©¬ä¸Šä¸‹ä¸€è¡Œä»£ç å°±è°ƒç”¨äº†ï¼Œç»“æœå°±æ˜¯  ç™½ç™½é¢„è§£æäº†ä¸€éï¼Œæµªè´¹äº†æ—¶é—´ï¼Œå‘ç°é©¬ä¸Šè¢«è°ƒç”¨ï¼Œåˆé©¬ä¸Šå›å¤´å…¨é‡è§£æä¸€è¾¹ åˆèŠ±äº†æ—¶é—´ï¼Œä¸¤æ¬¡çš„èŠ±è´¹ã€‚</p>
</li>
</ul>
</li>
<li>
<p>åœ¨ä¸Šé¢åªæ˜¯è®²äº†è§£æé˜¶æ®µçš„é¢„è§£æå’Œå…¨é‡è§£æçš„ä¸åŒï¼Œç°åœ¨æˆ‘ä»¬è®²è§£æé˜¶æ®µçš„è¿‡ç¨‹</p>
<p>V8 ä½¿ç”¨çš„æ˜¯é€’å½’ä¸‹é™åˆ†ææ³•ã€‚å®ƒæ ¹æ®js çš„è¯­æ³•è§„åˆ™æ¥åŒ¹é… Tokenã€‚</p>
<p>å®ƒçš„è§„åˆ™ç±»ä¼¼äºï¼šå½“æˆ‘ä»¬é‡åˆ° <code>const</code>ï¼Œæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåé¢å¿…é¡»è·Ÿä¸€ä¸ªå˜é‡åï¼Œç„¶åæ˜¯ä¸€ä¸ªèµ‹å€¼å·ï¼Œç„¶åæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚</p>
<p>è¿‡ç¨‹ç¤ºä¾‹ï¼š</p>
<p>çœ‹åˆ° <code>const</code>  åˆ›å»ºä¸€ä¸ªå˜é‡å£°æ˜èŠ‚ç‚¹ã€‚</p>
<p>çœ‹åˆ° <code>a</code> æŠŠå®ƒä½œä¸ºå£°æ˜çš„<strong>æ ‡è¯†ç¬¦</strong>ã€‚</p>
<p>çœ‹åˆ° <code>= </code> çŸ¥é“åé¢æ˜¯<strong>åˆå§‹å€¼</strong>ã€‚</p>
<p>çœ‹åˆ° <code>1</code> åˆ›å»ºä¸€ä¸ªå­—é¢é‡èŠ‚ç‚¹ï¼ŒæŒ‚åœ¨ <code>=</code> çš„å³è¾¹ã€‚</p>
<p>è€Œåœ¨è¿™ä¸ªé˜¶æ®µçš„åŒæ—¶ï¼Œä½œç”¨åŸŸåˆ†æä¹Ÿåœ¨åŒæ­¥è¿›è¡Œï¼Œå› ä¸ºåœ¨æ„å»º AST çš„è¿‡ç¨‹ä¸­ï¼Œè§£æå™¨å¿…é¡»è¦ææ¸…æ¥š<strong>å˜é‡åœ¨å“ªé‡Œ</strong>ã€‚</p>
<p>å®ƒä¼šç›˜ç®— è¿™ä¸ª <code>a</code> æ˜¯å…¨å±€å˜é‡ï¼Œè¿˜æ˜¯å‡½æ•°å†…çš„å±€éƒ¨å˜é‡ï¼Ÿ</p>
<p>å¦‚æœå½“å‰å‡½æ•°å†…éƒ¨å¼•ç”¨äº†å¤–å±‚çš„å˜é‡ï¼Œè§£æå™¨ä¼šåœ¨è¿™ä¸ªé˜¶æ®µæ‰“ä¸Šæ ‡è®°ï¼šâ€œè¦å°å¿ƒï¼Œè¿™ä¸ªå˜é‡è¢«é€®ä½äº†ï¼Œå°†æ¥å¯èƒ½éœ€è¦ä¸Šä¸‹æ–‡æ¥åˆ†é…â€ã€‚</p>
<p>è¿™ä¸ªä½œç”¨åŸŸåˆ†ææ¯”è¾ƒé‡è¦ï¼Œæˆ‘ä»¬ç”¨ç¨å¾®å¤§ç‚¹çš„ç¯‡å¹…æ¥è®²è®²ã€‚</p>
<p>é¦–å…ˆ å¼ºçƒˆå»ºè®® ä¸è¦å†å»ç”¨ä»¥å‰çš„ æ´»åŠ¨å¯¹è±¡AO  vo ç­‰ç­‰çš„è¯´æ³•æ¥æ€è€ƒé—®é¢˜ã€‚åº”è¯¥ä½¿ç”¨ç°åœ¨çš„è¯æ³•ä½œç”¨åŸŸ ç¯å¢ƒè®°å½• ç­‰ç­‰æ€è€ƒæ¨¡å‹ã€‚</p>
<h4 data-id="heading-1"><strong>è¯æ³•ä½œç”¨åŸŸ (Lexical Scoping)â€</strong> çš„å®šä¹‰ï¼š<strong>ä½œç”¨åŸŸæ˜¯ç”±ä»£ç ä¹¦å†™çš„ä½ç½®å†³å®šçš„ï¼Œè€Œä¸æ˜¯ç”±è°ƒç”¨ä½ç½®å†³å®šçš„ã€‚</strong></h4>
<p>è¿™è¯´æ˜ï¼Œå¼•æ“åœ¨è¿˜æ²¡å¼€å§‹æ‰§è¡Œä»£ç ï¼Œä»…ä»…é€šè¿‡â€œæ‰«æâ€æºä»£ç ç”Ÿæˆ AST çš„é˜¶æ®µï¼Œå°±å·²ç»æŠŠâ€œè°èƒ½è®¿é—®è°â€ã€â€œè°è¢«è°é€®ä½â€è¿™ç¬”è´¦ç®—å¾—æ¸…æ¸…æ¥šæ¥šäº†ã€‚</p>
<p>ä¸€æ—¦ASTè¢«ç”Ÿæˆï¼Œé‚£ä¹ˆè‡³å°‘æ„å‘³ç€ä¸‹é¢çš„æƒ…å†µ</p>
<h3 data-id="heading-2"/>
<p>ä½œç”¨åŸŸå±‚çº§<strong>è¢«ç¡®å®š</strong></p>
<p>AST æœ¬èº«çš„æ ‘çŠ¶ç»“æ„ï¼Œå°±æ˜¯ä½œç”¨åŸŸå±‚çº§çš„ç‰©ç†ä½“ç°ã€‚</p>
<ul>
<li>
<p><strong>AST èŠ‚ç‚¹ï¼š</strong> å½“è§£æå™¨é‡åˆ°ä¸€ä¸ª <code>function</code> å…³é”®å­—ï¼Œå®ƒä¼šåœ¨ AST ä¸Šç”Ÿæˆä¸€ä¸ª <code>FunctionLiteral</code> èŠ‚ç‚¹ã€‚</p>
</li>
<li>
<p><strong>Scope å¯¹è±¡ï¼š</strong> åœ¨ V8 å†…éƒ¨ï¼Œéšç€ AST çš„ç”Ÿæˆï¼Œè§£æå™¨ä¼šåŒæ—¶ç»´æŠ¤ä¸€æ£µ <strong>â€œä½œç”¨åŸŸæ ‘â€</strong>ã€‚</p>
<ul>
<li>æ¯è¿›å…¥ä¸€ä¸ªå‡½æ•°ï¼ŒV8 å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Scope</code> å¯¹è±¡ã€‚</li>
<li>è¿™ä¸ª <code>Scope</code> å¯¹è±¡ä¼šæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒçš„ <code>Outer Scope</code>çˆ¶ä½œç”¨åŸŸã€‚</li>
</ul>
</li>
<li>
<p><strong>ç»“æœï¼š</strong> è¿™ç§â€œçˆ¶å­å…³ç³»â€æ˜¯é™æ€é”å®šçš„ã€‚æ— è®ºä½ å°†æ¥åœ¨å“ªé‡Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå®ƒçš„â€œçˆ¶çº§â€æ°¸è¿œæ˜¯å®šä¹‰æ—¶çš„é‚£ä¸ªä½œç”¨åŸŸã€‚</p>
</li>
</ul>
<p>å˜é‡å¼•ç”¨å…³ç³»<strong>è¢«è¯†åˆ«</strong></p>
<p>è¿™æ˜¯è§£æå™¨æœ€å¿™ç¢Œçš„å·¥ä½œä¹‹ä¸€ï¼Œå«åš <strong>å˜é‡è§£æ</strong>ã€‚</p>
<ul>
<li><strong>å£°æ˜ï¼š</strong> å½“è§£æå™¨é‡åˆ° <code>let a = 1</code>ï¼Œå®ƒä¼šåœ¨å½“å‰ Scope è®°å½•ï¼šâ€œæˆ‘æœ‰äº†ä¸€ä¸ªå« <code>a</code> çš„å˜é‡â€ã€‚</li>
<li><strong>å¼•ç”¨ï¼š</strong> å½“è§£æå™¨é‡åˆ° <code>console.log(a)</code> æ—¶ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ª <strong>å˜é‡ä»£ç†</strong>ã€‚</li>
<li><strong>é“¾æ¥è¿‡ç¨‹ï¼š</strong> è§£æå™¨ä¼šå°è¯•â€œè¿æ¥â€è¿™ä¸ªä»£ç†å’Œå£°æ˜ï¼š
<ol>
<li>å…ˆåœ¨å½“å‰ Scope æ‰¾ <code>a</code>ã€‚</li>
<li>æ‰¾ä¸åˆ°ï¼Ÿæ²¿ç€ Scope Tree å¾€ä¸Šæ‰¾çˆ¶ä½œç”¨åŸŸã€‚</li>
<li>æ‰¾åˆ°äº†ï¼Ÿ<strong>å»ºç«‹ç»‘å®šã€‚</strong></li>
<li>ä¸€ç›´åˆ°äº†å…¨å±€è¿˜æ²¡æ‰¾åˆ°ï¼Ÿæ ‡è®°ä¸ºå…¨å±€å˜é‡ï¼ˆæˆ–è€…æŠ¥é”™ï¼‰ã€‚</li>
</ol>
</li>
</ul>
<p><strong>è¿™é‡Œè¦æ³¨æ„ï¼š</strong> è¿™ä¸ªâ€œæ‰¾â€çš„è¿‡ç¨‹æ˜¯åœ¨<strong>ç¼–è¯‘é˜¶æ®µ</strong>å®Œæˆçš„é€»è¾‘æ¨å¯¼ã€‚</p>
<h3 data-id="heading-3"/>
<p>é—­åŒ…çš„è“å›¾<strong>è¢«é¢„åˆ¤</strong></p>
<p>è¿™ä¸€æ­¥æ˜¯ V8 æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ï¼Œä¹Ÿå°±æ˜¯ä½œç”¨åŸŸåˆ†æã€‚</p>
<ul>
<li><strong>å‘ç°é—­åŒ…ï¼š</strong> è§£æå™¨å‘ç°å†…éƒ¨å‡½æ•° <code>inner</code> å¼•ç”¨äº†å¤–éƒ¨å‡½æ•° <code>outer</code> çš„å˜é‡ <code>x</code>ã€‚</li>
<li><strong>æ‰“ä¸ªå¤§æ ‡ç­¾ï¼š</strong>
<ul>
<li>è§£æå™¨ä¼šç»™ <code>x</code> æ‰“ä¸Šä¸€ä¸ªæ ‡ç­¾ï¼š<strong>â€œå¼ºåˆ¶ä¸Šä¸‹æ–‡åˆ†é…â€</strong>ã€‚</li>
<li>æ„æ€æ˜¯ï¼šâ€œè™½ç„¶ <code>x</code> æ˜¯å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºæœ‰äººè·¨ä½œç”¨åŸŸå¼•ç”¨å®ƒï¼Œæ‰€ä»¥å®ƒä¸èƒ½ä½åœ¨æ™®é€šçš„æ ˆï¼ˆStackï¼‰ä¸Šäº†... å¿…é¡»æ¬å®¶ï¼Œä½åˆ°å †ï¼ˆHeapï¼‰é‡Œä¸“é—¨å¼€è¾Ÿçš„ <strong>Contextï¼ˆä¸Šä¸‹æ–‡å¯¹è±¡ï¼‰</strong> ä¸­å»ã€‚â€</li>
</ul>
</li>
<li><strong>è¿˜æ²¡æœ‰å®ä¾‹åŒ–ï¼š</strong>
<ul>
<li>æ­¤æ—¶å†…å­˜é‡Œ<strong>æ²¡æœ‰</strong>ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä¹Ÿ<strong>æ²¡æœ‰</strong>å˜é‡ <code>x</code> çš„å€¼ï¼ˆé‚£æ˜¯è¿è¡Œæ—¶çš„äº‹ï¼‰ã€‚</li>
<li>AST åªæ˜¯ç”Ÿæˆäº†ä¸€å¼ **â€œè“å›¾â€**ï¼Œå›¾çº¸ä¸Šå†™ç€ï¼šâ€œæ³¨æ„ï¼Œå°†æ¥è¿è¡Œçš„æ—¶å€™ï¼Œè¿™ä¸ª <code>x</code> è¦æ”¾åœ¨ç‰¹åˆ«çš„åœ°æ–¹ - Contexté‡Œï¼Œåˆ«æ”¾åœ¨æ ˆä¸Šã€‚â€</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>ä¸‹é¢å°±æ˜¯è§£é‡Šå™¨Ignitionè¯¥ç™»åœºäº†ã€‚æˆ‘ä»¬ç¬¬äºŒéƒ¨åˆ†å†è§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Server Components å†æ›é«˜å±æ¼æ´ï¼šæ‹’ç»æœåŠ¡ä¸æºç æ³„éœ²æ¥è¸µè€Œè‡³]]></title>    <link>https://juejin.cn/post/7582769411994320948</link>    <guid>https://juejin.cn/post/7582769411994320948</guid>    <pubDate>2025-12-12T12:00:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582769411994320948" data-draft-id="7582769411994239028" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Server Components å†æ›é«˜å±æ¼æ´ï¼šæ‹’ç»æœåŠ¡ä¸æºç æ³„éœ²æ¥è¸µè€Œè‡³"/> <meta itemprop="keywords" content="å‰ç«¯,å®‰å…¨"/> <meta itemprop="datePublished" content="2025-12-12T12:00:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="timeweaver"/> <meta itemprop="url" content="https://juejin.cn/user/1341831509187863"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Server Components å†æ›é«˜å±æ¼æ´ï¼šæ‹’ç»æœåŠ¡ä¸æºç æ³„éœ²æ¥è¸µè€Œè‡³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1341831509187863/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    timeweaver
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T12:00:54.000Z" title="Fri Dec 12 2025 12:00:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¦‚æœæ‚¨çš„å›¢é˜Ÿåˆšåˆšåœ¨å‡ å¤©å‰ä¸ºäº†ä¿®å¤é‚£ä¸ªæ»¡åˆ†æ ¸å¼¹çº§æ¼æ´ <strong>React2Shell (CVE-2025-55182)</strong> è€Œç†¬å¤œåŠ ç­ï¼Œé‚£ä¹ˆç°åœ¨å¯èƒ½éœ€è¦è¯·å¤§å®¶å†å–ä¸€æ¯å’–å•¡äº†ã€‚</p>
<p>å°±åœ¨å®‰å…¨ç¤¾åŒºæ·±å…¥ç ”ç©¶ä¸Šå‘¨çš„ RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰æ¼æ´è¡¥ä¸æ—¶ï¼Œå‰§æƒ…å‡ºç°äº†åè½¬â€”â€”ç ”ç©¶äººå‘˜åœ¨é˜²å¾¡å·¥äº‹ä¸­å‘ç°äº†æ–°çš„è£‚ç¼ã€‚<strong>React å®˜æ–¹å’Œ Next.js å›¢é˜Ÿåˆšåˆšç¡®è®¤äº†ä¸‰ä¸ªæ–°çš„ CVE ç¼–å·</strong>ï¼Œè™½ç„¶è¿™æ¬¡ä¸æ˜¯ç›´æ¥çš„ RCEï¼Œä½†å®ƒä»¬ä¾ç„¶èƒ½è®©æ‚¨çš„æœåŠ¡å™¨â€œç½¢å·¥â€æˆ–è€…æ³„éœ²æ•æ„Ÿä»£ç ã€‚</p>
<p>åˆ«æ…Œï¼Œå°†ç”¨æœ€ç®€å•çš„å¤§ç™½è¯å¸¦æ‚¨çœ‹æ‡‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»¥åŠ<strong>ä¸ºä»€ä¹ˆæ‚¨ä¹‹å‰æ‰“çš„è¡¥ä¸å¯èƒ½å·²ç»å¤±æ•ˆäº†</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9b265755f234f318da18432db3668fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGltZXdlYXZlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766145942&amp;x-signature=o%2FXgrzHcq2rEaAFJUpkYWvRAH4Y%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æ–°å¨èƒç™»åœºï¼šä¸ä»…æ˜¯å´©æºƒï¼Œè¿˜æœ‰æ³„å¯†</h2>
<p>è¿™æ¬¡çš„ä¸»è§’æ˜¯ä¸¤ä¸ªæ–°å‘ç°çš„æ¼æ´ï¼Œå®ƒä»¬éƒ½æ½œä¼åœ¨ React Server Components (RSC) å¤„ç†ç½‘ç»œè¯·æ±‚çš„æœºåˆ¶ä¸­ï¼š</p>
<h3 data-id="heading-1">ğŸ”¥ æ¼æ´ä¸€ï¼šè®©æœåŠ¡å™¨â€œé™·å…¥æ²‰æ€â€çš„ DoS æ”»å‡» (CVE-2025-55184)</h3>
<ul>
<li><strong>ä¸¥é‡ç­‰çº§ï¼š</strong> é«˜å± (CVSS 7.5)</li>
<li><strong>è¿™æ˜¯ä»€ä¹ˆï¼Ÿ</strong> è¿™æ˜¯ä¸€ä¸ªâ€œæ‹’ç»æœåŠ¡â€ï¼ˆDenial of Serviceï¼‰æ¼æ´ã€‚</li>
<li><strong>é€šä¿—è§£é‡Šï¼š</strong> æƒ³è±¡ä¸€ä¸‹ï¼Œæ”»å‡»è€…ç»™æ‚¨çš„æœåŠ¡å™¨å‘äº†ä¸€ä¸ªç‰¹åˆ¶çš„â€œè®¢å•â€ï¼ˆHTTP è¯·æ±‚ï¼‰ã€‚è¿™ä¸ªè®¢å•é‡ŒåŒ…å«äº†ä¸€ä¸ªæ­»å¾ªç¯é€»è¾‘ï¼ˆæ¯”å¦‚â€œAä¾æ‡’äºBï¼ŒBåˆä¾æ‡’äºAâ€çš„å¾ªç¯ Promise å¼•ç”¨ï¼‰ã€‚</li>
<li><strong>åæœï¼š</strong> æœåŠ¡å™¨åœ¨è¯•å›¾è§£æè¿™ä¸ªè®¢å•æ—¶ï¼Œä¼šé™·å…¥æ— é™å¾ªç¯çš„æ·±æ¸Šã€‚è¿™ä¼šå¯¼è‡´æœåŠ¡å™¨è¿›ç¨‹æŒ‚èµ·ï¼ŒCPU ç‹‚è½¬ï¼Œä½†å°±æ˜¯ä¸å¹²æ´»ã€‚å³ä½¿æ‚¨çš„åº”ç”¨æ²¡æœ‰æ˜¾å¼ä½¿ç”¨ Server Functionsï¼Œåªè¦å¼€å¯äº† RSC æ”¯æŒï¼Œå°±å¯èƒ½ä¸­æ‹›ã€‚ç»“æœå°±æ˜¯ï¼š<strong>çœŸå®ç”¨æˆ·çš„è¯·æ±‚è¿›ä¸æ¥ï¼Œæ‚¨çš„æœåŠ¡ç›¸å½“äºâ€œå®•æœºâ€äº†</strong>ã€‚</li>
</ul>
<h3 data-id="heading-2">ğŸ•µï¸ æ¼æ´äºŒï¼šæŠŠä»£ç â€œåå‡ºæ¥â€çš„æºç æ³„éœ² (CVE-2025-55183)</h3>
<ul>
<li><strong>ä¸¥é‡ç­‰çº§ï¼š</strong> ä¸­å± (CVSS 5.3)</li>
<li><strong>è¿™æ˜¯ä»€ä¹ˆï¼Ÿ</strong> è¿™æ˜¯ä¸€ä¸ªä¿¡æ¯æ³„éœ²æ¼æ´ã€‚</li>
<li><strong>é€šä¿—è§£é‡Šï¼š</strong> æ”»å‡»è€…é€šè¿‡ç‰¹å®šçš„è¯·æ±‚ï¼Œè¯±éª—æœåŠ¡å™¨å°†æŸä¸ª Server Functionï¼ˆæœåŠ¡å™¨ç«¯å‡½æ•°ï¼‰è¯¯è®¤ä¸ºæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li>
<li><strong>åæœï¼š</strong> React ä¼šâ€œå¥½å¿ƒâ€åœ°æŠŠè¿™ä¸ªå‡½æ•°çš„<strong>å®Œæ•´æºä»£ç </strong>ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ç»™æ”»å‡»è€…ã€‚å¦‚æœæ‚¨çš„ä»£ç é‡Œç¡¬ç¼–ç äº† API Keyã€æ•°æ®åº“å¯†ç æˆ–è€…å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™äº›ç§˜å¯†å°±ä¼šè¢«æ”»å‡»è€…ä¸€è§ˆæ— ä½™ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd1cce26d6494c90a0dfa9c7399f5852~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGltZXdlYXZlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766145942&amp;x-signature=3IZSnGAJhMQQbrR4pPUzE3y8qOs%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">äºŒã€æ”»å‡»åŸç†</h2>
<p>è¿™äº› React Server Components (RSC) æ¼æ´ï¼ˆCVE-2025-55184, CVE-2025-55183, CVE-2025-67779ï¼‰çš„è§¦å‘æœºåˆ¶ä¸»è¦é›†ä¸­åœ¨ <strong>React Flight åè®®</strong> çš„ååºåˆ—åŒ–å¤„ç†é€»è¾‘ä¸Šã€‚æ”»å‡»è€…ä¸éœ€è¦èº«ä»½éªŒè¯ï¼Œåªéœ€å‘æœåŠ¡å™¨å‘é€ç‰¹åˆ¶çš„ HTTP è¯·æ±‚å³å¯è§¦å‘ã€‚</p>
<p>ä»¥ä¸‹æ˜¯é’ˆå¯¹ä¸åŒæ¼æ´çš„å…·ä½“è§¦å‘åŸç†ï¼š</p>
<h3 data-id="heading-4">1. è§¦å‘æ‹’ç»æœåŠ¡ (DoS)</h3>
<p><strong>æ¶‰åŠæ¼æ´ï¼š</strong> CVE-2025-55184, CVE-2025-67779 <strong>æ ¸å¿ƒæœºåˆ¶ï¼š</strong> å¾ªç¯ Promise å¼•ç”¨ (Cyclical Promise References)</p>
<ul>
<li><strong>è§¦å‘æ–¹å¼ï¼š</strong> æ”»å‡»è€…æ„é€ ä¸€ä¸ªæ¶æ„çš„ RSC Flight Payloadï¼ˆé€šå¸¸åŒ…å«åœ¨ HTTP POST è¯·æ±‚ä¸­ï¼‰ï¼Œå‘é€ç»™ä»»æ„ Server Function ç«¯ç‚¹ï¼ˆæˆ–è€…æ”¯æŒ RSC çš„åº”ç”¨å…¥å£ï¼‰ã€‚</li>
<li><strong>Payload ç‰¹å¾ï¼š</strong> è¿™ä¸ª Payload å†…éƒ¨åŒ…å«ç²¾å¿ƒè®¾è®¡çš„ <strong>å¾ªç¯ Promise å¼•ç”¨</strong>ï¼ˆCyclical Promise referencesï¼‰ã€‚</li>
<li><strong>æœåŠ¡å™¨ååº”ï¼š</strong> å½“ React æœåŠ¡å™¨å°è¯•ååºåˆ—åŒ–è¿™ä¸ª Payload æ—¶ï¼Œè¿è¡Œæ—¶ä¼šé™·å…¥è§£æåµŒå¥— Promise çš„ <strong>æ— é™é€’å½’</strong> æˆ– <strong>æ­»å¾ªç¯</strong>ã€‚</li>
<li><strong>åæœï¼š</strong> ç”±äº Node.js é€šå¸¸æ˜¯å•çº¿ç¨‹äº‹ä»¶å¾ªç¯ï¼Œè¿™ä¸ªæ­»å¾ªç¯ä¼šç›´æ¥å¯¼è‡´æœåŠ¡å™¨è¿›ç¨‹æŒ‚èµ·ï¼ˆHangï¼‰ï¼ŒCPU å ç”¨ç‡é£™å‡ï¼Œæ— æ³•å¤„ç†åç»­çš„ä»»ä½•è¯·æ±‚ï¼Œä»è€Œé€ æˆæ‹’ç»æœåŠ¡ã€‚</li>
<li><strong>è¡¥ä¸ç»•è¿‡ (CVE-2025-67779)ï¼š</strong> ä¹‹å‰çš„è¡¥ä¸æœªèƒ½å®Œå…¨è¦†ç›–æ‰€æœ‰ç±»å‹çš„å¾ªç¯å¼•ç”¨ Payloadï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥è°ƒæ•´ Payload ç»“æ„ç»•è¿‡ç¬¬ä¸€è½®ä¿®å¤ï¼Œå†æ¬¡è§¦å‘æ­»å¾ªç¯ã€‚</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[æ”»å‡»è€…å‘é€æ¶æ„è¯·æ±‚] --&gt; B[PayloadåŒ…å«å¾ªç¯Promiseå¼•ç”¨]
    B --&gt; C{ReactæœåŠ¡å™¨ååºåˆ—åŒ–}
    C --&gt; D[è¿›å…¥æ— é™é€’å½’/æ­»å¾ªç¯]
    D --&gt; E[CPUå ç”¨ç‡é£™å‡è‡³100%]
    E --&gt; F[æœåŠ¡å™¨è¿›ç¨‹æŒ‚èµ·]
    F --&gt; G[æœåŠ¡å®Œå…¨ä¸å¯ç”¨]
</code></pre>
<h3 data-id="heading-5">2. è§¦å‘æºä»£ç æ³„éœ² (Source Code Exposure)</h3>
<p><strong>æ¶‰åŠæ¼æ´ï¼š</strong> CVE-2025-55183 <strong>æ ¸å¿ƒæœºåˆ¶ï¼š</strong> å­—ç¬¦ä¸²å¼ºåˆ¶è½¬æ¢ (String Coercion)</p>
<ul>
<li>
<p><strong>è§¦å‘æ–¹å¼ï¼š</strong> æ”»å‡»è€…å‘é€ä¸€ä¸ªæ¶æ„çš„ HTTP è¯·æ±‚ï¼Œå°†æŸä¸ªå‚æ•°ä¼ªé€ æˆæŒ‡å‘ <strong>å¦ä¸€ä¸ª Server Function çš„å¼•ç”¨</strong>ã€‚</p>
</li>
<li>
<p><strong>è§¦å‘æ¡ä»¶ï¼š</strong> ç›®æ ‡ Server Function å¿…é¡»åŒ…å«å°†ä¼ å…¥å‚æ•° <strong>è½¬æ¢ä¸ºå­—ç¬¦ä¸²</strong> çš„æ“ä½œï¼ˆæ˜¾å¼æˆ–éšå¼ï¼‰ã€‚ä¾‹å¦‚ï¼Œä»£ç ä¸­ä½¿ç”¨äº†æ¨¡æ¿å­—ç¬¦ä¸² <code>`Hello ${name}`</code>ï¼Œæˆ–è€…å°†å‚æ•°ä¼ é€’ç»™éœ€è¦å­—ç¬¦ä¸²çš„ APIï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p>
<ol>
<li>æ”»å‡»è€…å‘é€è¯·æ±‚ï¼Œå°†å‚æ•°ï¼ˆå¦‚ <code>name</code>ï¼‰çš„å€¼è®¾ä¸ºä¸€ä¸ªæŒ‡å‘æœåŠ¡å™¨ç«¯å‡½æ•°ï¼ˆServer Functionï¼‰çš„å¼•ç”¨å¯¹è±¡ã€‚</li>
<li>æœåŠ¡å™¨ä»£ç æ‰§è¡Œæ—¶ï¼Œè¯•å›¾å°†è¯¥å‚æ•°â€œå­—ç¬¦ä¸²åŒ–â€ï¼ˆè°ƒç”¨ <code>.toString()</code>ï¼‰ã€‚</li>
<li>ç”±äºæ¼æ´å­˜åœ¨ï¼ŒReact ä¸å®‰å…¨åœ°è¿”å›äº†è¯¥å‡½æ•°çš„ <strong>å®Œæ•´æºä»£ç </strong> å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡æ ‡è¯†ã€‚</li>
</ol>
</li>
<li>
<p><strong>æ³„éœ²å†…å®¹ï¼š</strong> æ”»å‡»è€…å¯ä»¥åœ¨ HTTP å“åº”ä¸­ç›´æ¥çœ‹åˆ°å‡½æ•°çš„æºä»£ç ã€‚å¦‚æœä»£ç ä¸­åŒ…å«ç¡¬ç¼–ç çš„å¯†é’¥ï¼ˆå¦‚ <code>db.connect('SECRET_KEY')</code>ï¼‰ï¼Œè¿™äº›æ•æ„Ÿä¿¡æ¯å°±ä¼šè¢«çªƒå–ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[æ”»å‡»è€…æ„é€ æ¶æ„å‚æ•°] --&gt; B[å‚æ•°ä¼ªè£…æˆServer Functionå¼•ç”¨]
    B --&gt; C[æœåŠ¡å™¨æ‰§è¡Œå­—ç¬¦ä¸²è½¬æ¢]
    C --&gt; D{Reactä¸å®‰å…¨å¤„ç†}
    D --&gt; E[è¿”å›å‡½æ•°å®Œæ•´æºä»£ç ]
    E --&gt; F[æ³„éœ²APIå¯†é’¥/æ•°æ®åº“å¯†ç ]
    E --&gt; G[æ³„éœ²ä¸šåŠ¡é€»è¾‘ä»£ç ]
</code></pre>
<h3 data-id="heading-6">3. æ”»å‡»å…¥å£ä¸é€šç”¨å‰æ</h3>
<ul>
<li><strong>æ— éœ€ç™»å½•ï¼š</strong> è¿™äº›æ”»å‡»æ˜¯é¢„è®¤è¯çš„ï¼ˆPre-authenticationï¼‰ï¼Œæ”»å‡»è€…ä¸éœ€è¦ç™»å½•å³å¯å‘èµ·ã€‚</li>
<li><strong>HTTP è¯·æ±‚ï¼š</strong> æ”»å‡»é€šè¿‡å‘ Server Function ç«¯ç‚¹å‘é€ HTTP è¯·æ±‚å®ç°ã€‚å³ä¾¿åº”ç”¨æ²¡æœ‰æ˜¾å¼ä½¿ç”¨ Server Functionï¼Œåªè¦å¼€å¯äº† RSC æ”¯æŒï¼Œæ¡†æ¶ï¼ˆå¦‚ Next.js App Routerï¼‰é»˜è®¤æš´éœ²çš„ç«¯ç‚¹ä¹Ÿå¯èƒ½æˆä¸ºæ”»å‡»å…¥å£ã€‚</li>
<li><strong>åè®®å±‚æ¼æ´ï¼š</strong> é—®é¢˜å‡ºåœ¨åº•å±‚çš„ <code>react-server</code> åŒ…å¤„ç† Flight åè®®æ•°æ®æµçš„æ–¹å¼ä¸Šï¼Œè¿™æ„å‘³ç€ä½¿ç”¨è¯¥åè®®çš„å¤šç§æ¡†æ¶ï¼ˆNext.js, Waku, Hydrogen ç­‰ï¼‰éƒ½å¯èƒ½å—åˆ°æ³¢åŠã€‚</li>
</ul>
<h2 data-id="heading-7">ä¸‰ã€å…³é”®åè½¬ï¼šä¸ºä»€ä¹ˆè¯´æ‚¨çš„è¡¥ä¸å¯èƒ½â€œç™½æ‰“äº†â€ï¼Ÿ</h2>
<p>è¿™æ‰æ˜¯æœ¬æ¬¡äº‹ä»¶ä¸­æœ€ä»¤äººå¤´ç–¼çš„åœ°æ–¹ã€‚</p>
<p>åœ¨ä¿®å¤ DoS æ¼æ´ (CVE-2025-55184) çš„è¿‡ç¨‹ä¸­ï¼Œå®˜æ–¹å‘å¸ƒäº†ç¬¬ä¸€ç‰ˆè¡¥ä¸ï¼ˆä¾‹å¦‚ React 19.0.2ï¼‰ã€‚ä½†å®‰å…¨ç ”ç©¶äººå‘˜å¾ˆå¿«å‘ç°ï¼Œè¿™ä¸ªä¿®å¤<strong>ä¸å®Œæ•´</strong>ï¼æ”»å‡»è€…ä¾ç„¶å¯ä»¥ç»•è¿‡è¿™ä¸ªè¡¥ä¸è®©æœåŠ¡å™¨æŒ‚èµ·ã€‚</p>
<p>è¿™å°±æ˜¯ç¬¬ä¸‰ä¸ªæ¼æ´ <strong>CVE-2025-67779</strong> çš„ç”±æ¥ã€‚</p>
<p><strong>âš ï¸ åˆ’é‡ç‚¹ï¼š</strong> å¦‚æœæ‚¨åœ¨æœ¬å‘¨æ—©äº›æ—¶å€™æ›´æ–°åˆ°äº† <strong>React 19.0.2ã€19.1.3 æˆ– 19.2.2</strong>ï¼Œ<strong>æ‚¨ä¾ç„¶æ˜¯è„†å¼±çš„ï¼</strong> æ‚¨éœ€è¦å†æ¬¡å‡çº§ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[ç¬¬ä¸€è½®ä¿®å¤ CVE-2025-55184] --&gt; B[ä¿®å¤ç‰¹å®šç±»å‹å¾ªç¯å¼•ç”¨]
    B --&gt; C[æ”»å‡»è€…è°ƒæ•´Payloadç»“æ„]
    C --&gt; D[å‘ç°æ–°çš„å¾ªç¯å¼•ç”¨æ¨¡å¼]
    D --&gt; E[ç»•è¿‡ç¬¬ä¸€è½®è¡¥ä¸]
    E --&gt; F[éœ€è¦ç¬¬äºŒè½®ä¿®å¤ CVE-2025-67779]
</code></pre>
<hr/>
<h2 data-id="heading-8">å››ã€æˆ‘å—å½±å“äº†å—ï¼Ÿï¼ˆè‡ªæŸ¥æ¸…å•ï¼‰</h2>
<p>å¦‚æœæ‚¨çš„é¡¹ç›®ä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ ˆï¼Œè¯·ç«‹å³è‡ªæŸ¥ï¼š</p>
<ul>
<li><strong>React:</strong> ç‰ˆæœ¬ <strong>19.0.0 åˆ° 19.2.2</strong> ä¹‹é—´çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚</li>
<li><strong>Next.js (App Router):</strong> ç‰ˆæœ¬ <strong>13.x åˆ° 16.x</strong>ã€‚å°¤å…¶æ˜¯ä½¿ç”¨äº† App Router çš„é¡¹ç›®ã€‚</li>
<li><strong>å…¶ä»–æ¡†æ¶:</strong> ä»»ä½•ä½¿ç”¨äº† <code>react-server-dom-webpack/parcel/turbopack</code> çš„æ¡†æ¶ï¼Œå¦‚ Waku, RedwoodJS, React Router ç­‰ã€‚</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> å¦‚æœæ‚¨çš„ React ä»£ç åªåœ¨å®¢æˆ·ç«¯è¿è¡Œï¼ˆä¸æ¶‰åŠ Server Componentsï¼‰ï¼Œæˆ–è€…ä½¿ç”¨çš„æ˜¯è€ç‰ˆæœ¬çš„ Next.js (Pages Router)ï¼Œæ­å–œæ‚¨ï¼Œè¿™æ³¢é£æš´ç”±äºæ‚¨â€œç”±äºæŠ€æœ¯æ ˆä¸å¤Ÿæ–°â€è€Œå®Œç¾é¿å¼€ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">äº”ã€ç«‹å³è¡ŒåŠ¨ï¼šç»ˆæä¿®å¤æ–¹æ¡ˆ</h2>
<p>ä¸è¦çŠ¹è±«ï¼Œç«‹å³å‡çº§åˆ°ä»¥ä¸‹â€œæœ€ç»ˆå®‰å…¨ç‰ˆæœ¬â€ã€‚è¯·è·³è¿‡ä¸­é—´çš„è¿‡æ¸¡ç‰ˆæœ¬ï¼Œç›´æ¥å‡åˆ°æœ€æ–°ï¼</p>
<p><strong>React æ ¸å¿ƒåŒ…å‡çº§æŒ‡å—ï¼š</strong></p>

























<table><thead><tr><th align="left">æ‚¨å½“å‰çš„ç‰ˆæœ¬ç³»åˆ—</th><th align="left"><strong>âŒ ä¾ç„¶è„†å¼±çš„ç‰ˆæœ¬</strong></th><th align="left"><strong>âœ… å¿…é¡»å‡çº§åˆ°çš„å®‰å…¨ç‰ˆæœ¬</strong></th></tr></thead><tbody><tr><td align="left"><strong>19.0.x</strong></td><td align="left">19.0.0 - 19.0.2</td><td align="left"><strong>19.0.3</strong> (åŠä»¥ä¸Š)</td></tr><tr><td align="left"><strong>19.1.x</strong></td><td align="left">19.1.0 - 19.1.3</td><td align="left"><strong>19.1.4</strong> (åŠä»¥ä¸Š)</td></tr><tr><td align="left"><strong>19.2.x</strong></td><td align="left">19.2.0 - 19.2.2</td><td align="left"><strong>19.2.3</strong> (åŠä»¥ä¸Š)</td></tr></tbody></table>
<p><strong>Next.js ç”¨æˆ·å‡çº§æŒ‡å—ï¼š</strong></p>
<p>è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤å°† Next.js å‡çº§åˆ°æœ€æ–°çš„è¡¥ä¸ç‰ˆæœ¬ï¼š</p>
<ul>
<li><strong>Next.js 15.x:</strong> å‡çº§è‡³ <strong>15.0.7+, 15.1.11+, 15.2.8+, 15.3.8+, 15.4.10+</strong></li>
<li><strong>Next.js 14.x:</strong> å‡çº§è‡³ <strong>14.2.35+</strong></li>
<li><strong>Next.js 16.x (Canary):</strong> å‡çº§è‡³ <strong>16.0.10+</strong></li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€é”®å‡çº§åˆ°æœ€æ–°å®‰å…¨ç‰ˆæœ¬</span>
npm install next@latest react@latest react-dom@latest

<span class="hljs-comment"># æˆ–æŒ‡å®šç¡®åˆ‡ç‰ˆæœ¬</span>
npm install next@15.0.7 react@19.0.3 react-dom@19.0.3
</code></pre>
<h2 data-id="heading-10">å…­ã€å†™åœ¨æœ€åï¼šç»™å¼€å‘è€…çš„å»ºè®®</h2>
<p>ç”±äºåˆ©ç”¨é—¨æ§›æä½ä¸”å·²æœ‰è‡ªåŠ¨åŒ–æ‰«æå·¥å…·å‡ºç°ï¼Œä¾é  WAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰åªèƒ½ä½œä¸ºä¸´æ—¶ç¼“è§£æªæ–½ï¼Œ<strong>å”¯ä¸€å½»åº•çš„ä¿®å¤æ–¹æ³•æ˜¯ç«‹å³å‡çº§ React å’Œ Next.js åˆ°æœ€æ–°çš„å®‰å…¨ç‰ˆæœ¬</strong>ï¼ˆå¦‚ React 19.0.3+, Next.js 15.0.7+ ç­‰ï¼‰ã€‚</p>
<p>è¿™æ¬¡çš„ä¸€è¿ä¸²æ¼æ´ï¼ˆä» RCE åˆ° DoS å†åˆ° Info Leakï¼‰æé†’æˆ‘ä»¬ï¼ŒReact Server Components (RSC) æå¤§åœ°ç®€åŒ–äº†å‰åç«¯çš„æ•°æ®äº¤äº’ï¼Œä½†åŒæ—¶ä¹Ÿæ¨¡ç³Šäº†<strong>ä¿¡ä»»è¾¹ç•Œ</strong>ã€‚</p>
<ul>
<li><strong>ä¸è¦ç¡¬ç¼–ç å¯†é’¥ï¼š</strong> å³ä½¿è¡¥ä¸æ‰“å¥½äº†ï¼Œä¹Ÿæ°¸è¿œä¸è¦åœ¨ä»£ç é‡Œç›´æ¥å†™ <code>const API_KEY = "sk-..."</code>ã€‚è¯·åŠ¡å¿…ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆ<code>process.env</code>ï¼‰ï¼Œå› ä¸ºè¿è¡Œæ—¶æ³¨å…¥çš„å˜é‡é€šå¸¸ä¸ä¼šå› æºç æ³„éœ²è€Œè¢«ç›´æ¥è¯»å–ã€‚</li>
<li><strong>ä¿æŒè­¦æƒ•ï¼š</strong> æ–°æŠ€æœ¯æ ˆå¾€å¾€ä¼´éšç€æ–°çš„æ”»å‡»é¢ã€‚å…³æ³¨å®˜æ–¹å…¬å‘Šï¼ŒåŠæ—¶å“åº”ã€‚</li>
</ul>
<p>ç°åœ¨ï¼Œå»æ£€æŸ¥æ‚¨çš„ <code>package.json</code> å§ï¼Œç¥å¤§å®¶éƒ¨ç½²é¡ºåˆ©ï¼ŒæœåŠ¡å¸¸é’ï¼</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2025%2F12%2F11%2Fdenial-of-service-and-source-code-exposure-in-react-server-components" target="_blank" title="https://react.dev/blog/2025/12/11/denial-of-service-and-source-code-exposure-in-react-server-components" ref="nofollow noopener noreferrer">React Blog: Denial of Service and Source Code Exposure in React Server Components</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fkb%2Fbulletin%2Fsecurity-bulletin-cve-2025-55184-and-cve-2025-55183" target="_blank" title="https://vercel.com/kb/bulletin/security-bulletin-cve-2025-55184-and-cve-2025-55183" ref="nofollow noopener noreferrer">Vercel Security Bulletin: CVE-2025-55184 and CVE-2025-55183</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnvd.nist.gov%2Fvuln%2Fdetail%2FCVE-2025-55184" target="_blank" title="https://nvd.nist.gov/vuln/detail/CVE-2025-55184" ref="nofollow noopener noreferrer">NVD - CVE-2025-55184 Detail</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthehackernews.com%2F2025%2F12%2Fnew-react-rsc-vulnerabilities-enable.html" target="_blank" title="https://thehackernews.com/2025/12/new-react-rsc-vulnerabilities-enable.html" ref="nofollow noopener noreferrer">The Hacker News: New React RSC Vulnerabilities Enable DoS and Source Code Exposure</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java Mapéå†çš„â€œä¼˜é›…â€åˆé›†]]></title>    <link>https://juejin.cn/post/7582791876366827558</link>    <guid>https://juejin.cn/post/7582791876366827558</guid>    <pubDate>2025-12-12T12:15:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582791876366827558" data-draft-id="7582814236583034918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java Mapéå†çš„â€œä¼˜é›…â€åˆé›†"/> <meta itemprop="keywords" content="å‰ç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-12T12:15:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AAAç®€å•ç©è½¬ç¨‹åºè®¾è®¡"/> <meta itemprop="url" content="https://juejin.cn/user/4294056357689099"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java Mapéå†çš„â€œä¼˜é›…â€åˆé›†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4294056357689099/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AAAç®€å•ç©è½¬ç¨‹åºè®¾è®¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T12:15:55.000Z" title="Fri Dec 12 2025 12:15:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æèµ·Javaä¸­Mapçš„éå†ï¼Œå¾ˆå¤šäººç¬¬ä¸€ååº”è¿˜æ˜¯ï¼šÂ for (Map.Entry&lt;K,V&gt; entry : map.entrySet())Â ã€‚ä½†å…¶å®Mapéå†è—ç€å¤šç§ç©æ³•ï¼Œæœ‰çš„ä¼˜é›…ç®€æ´ï¼Œæœ‰çš„æ€§èƒ½æ‹‰æ»¡ï¼Œä»Šå¤©å’±ä»¬ç›˜ä¸€ç›˜è¿™äº›è¿›é˜¶ååŸºç¡€çš„éå†æ–¹å¼ï¼Œå‘Šåˆ«é‡å¤åˆè‡ƒè‚¿çš„ä»£ç ï½</p>
<h2 data-id="heading-0">ä¸€ã€å…ˆææ‡‚ï¼šMapéå†çš„æ ¸å¿ƒç›®æ ‡</h2>
<p>éå†Mapæœ¬è´¨æ˜¯è·å–<code>ã€Œé”®ï¼ˆKeyï¼‰ã€ã€ã€Œå€¼ï¼ˆValueï¼‰ã€æˆ–ã€Œé”®å€¼å¯¹ï¼ˆEntryï¼‰ã€</code>ï¼Œä¸åŒåœºæ™¯å¯¹åº”ä¸åŒéå†æ–¹å¼ï¼Œå…ˆä¸ŠåŸºç¡€å‡†å¤‡ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapTraversalDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        Map&lt;String, Integer&gt; fruitPrice = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        fruitPrice.put(<span class="hljs-string">"è‹¹æœ"</span>, <span class="hljs-number">10</span>);
        fruitPrice.put(<span class="hljs-string">"é¦™è•‰"</span>, <span class="hljs-number">5</span>);
        fruitPrice.put(<span class="hljs-string">"æ©™å­"</span>, <span class="hljs-number">8</span>);
        
        <span class="hljs-comment">// å„ç§éå†æ–¹å¼å†™åœ¨è¿™é‡Œï½</span>
    }
}
</code></pre>
<p>Â </p>
<h2 data-id="heading-1">äºŒã€å‡ ç§éå†æ–¹å¼çš„å¯¹æ¯”</h2>
<h4 data-id="heading-2">1. ä¼ ç»ŸEntrySetéå†ï¼ˆæœ€é€šç”¨ï¼‰</h4>
<p>è¿™æ˜¯æœ€åŸºç¡€ä¹Ÿæœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œæ”¯æŒåŒæ—¶è·å–é”®å’Œå€¼ï¼Œå…¼å®¹æ‰€æœ‰Javaç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ–¹å¼1ï¼šæ™®é€šforå¾ªç¯+EntrySet</span>
<span class="hljs-keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : fruitPrice.entrySet()) {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> entry.getKey();
    <span class="hljs-type">Integer</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> entry.getValue();
    System.out.println(key + <span class="hljs-string">"ï¼š"</span> + value + <span class="hljs-string">"å…ƒ"</span>);
}
Â 
</code></pre>
<h2 data-id="heading-3">2. Lambdaè¡¨è¾¾å¼éå†ï¼ˆJava 8+ï¼Œæç®€ï¼‰</h2>
<p>Java 8å¼•å…¥çš„forEach+Lambdaï¼Œä¸€è¡Œä»£ç æå®šï¼Œå‘Šåˆ«å†—ä½™ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ–¹å¼2ï¼šLambda+forEach</span>
fruitPrice.forEach((key, value) -&gt; System.out.println(key + <span class="hljs-string">"ï¼š"</span> + value + <span class="hljs-string">"å…ƒ"</span>));
</code></pre>
<p>Â </p>
<h4 data-id="heading-4">3. åªéå†Key/Valueï¼ˆæŒ‰éœ€é€‰æ‹©ï¼‰</h4>
<p>å¦‚æœåªéœ€è¦é”®æˆ–å€¼ï¼Œä¸ç”¨éå†EntrySetï¼Œç›´æ¥é’ˆå¯¹æ€§è·å–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åªéå†Key</span>
<span class="hljs-keyword">for</span> (String key : fruitPrice.keySet()) {
    System.out.println(<span class="hljs-string">"æ°´æœï¼š"</span> + key);
}

<span class="hljs-comment">// åªéå†Value</span>
<span class="hljs-keyword">for</span> (Integer value : fruitPrice.values()) {
    System.out.println(<span class="hljs-string">"ä»·æ ¼ï¼š"</span> + value + <span class="hljs-string">"å…ƒ"</span>);
}
</code></pre>
<p>Â </p>
<h4 data-id="heading-5">4. è¿­ä»£å™¨éå†ï¼ˆæ”¯æŒåˆ é™¤å…ƒç´ ï¼‰</h4>
<p>å¦‚æœéå†è¿‡ç¨‹ä¸­éœ€è¦åˆ é™¤å…ƒç´ ï¼Œè¿­ä»£å™¨æ˜¯å®‰å…¨é€‰æ‹©ï¼ˆforeachéå†åˆ é™¤ä¼šæŠ›å¼‚å¸¸ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ–¹å¼4ï¼šè¿­ä»£å™¨éå†ï¼ˆæ”¯æŒåˆ é™¤ï¼‰</span>
Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; iterator = fruitPrice.entrySet().iterator();
<span class="hljs-keyword">while</span> (iterator.hasNext()) {
    Map.Entry&lt;String, Integer&gt; entry = iterator.next();
    <span class="hljs-keyword">if</span> (entry.getValue() &lt; <span class="hljs-number">8</span>) {
        iterator.remove(); <span class="hljs-comment">// å®‰å…¨åˆ é™¤ä»·æ ¼ä½äº8çš„æ°´æœ</span>
    }
}
System.out.println(<span class="hljs-string">"åˆ é™¤åçš„Mapï¼š"</span> + fruitPrice);
</code></pre>
<p>Â </p>
<h2 data-id="heading-6">ä¸‰ã€é¿å‘æé†’</h2>
<p>1.Â éå†è¿‡ç¨‹ä¸­ä¿®æ”¹Mapï¼ˆå¦‚put/removeï¼‰ï¼šé™¤äº†è¿­ä»£å™¨çš„removeæ–¹æ³•ï¼Œå…¶ä»–æ–¹å¼å¯èƒ½è§¦å‘Â ConcurrentModificationExceptionÂ ï¼›</p>
<p>2.Â æ€§èƒ½ä¼˜å…ˆçº§ï¼šEntrySetéå† &gt; åˆ†åˆ«éå†Key+getValueï¼ˆåè€…ä¼šé‡å¤æŸ¥è¯¢Mapï¼‰ï¼›</p>
<p>3.Â Lambdaéå†è™½ç„¶ç®€æ´ï¼Œä½†æ— æ³•åœ¨å†…éƒ¨ä½¿ç”¨break/continueç»ˆæ­¢éå†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vueç»„ä»¶ç¼“å­˜ç»ˆææŒ‡å—ï¼škeep-aliveåŸç†ä¸åŠ¨æ€æ›´æ–°å®æˆ˜]]></title>    <link>https://juejin.cn/post/7582846276505501734</link>    <guid>https://juejin.cn/post/7582846276505501734</guid>    <pubDate>2025-12-12T13:48:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582846276505501734" data-draft-id="7582777037864337458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vueç»„ä»¶ç¼“å­˜ç»ˆææŒ‡å—ï¼škeep-aliveåŸç†ä¸åŠ¨æ€æ›´æ–°å®æˆ˜"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-12T13:48:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vueç»„ä»¶ç¼“å­˜ç»ˆææŒ‡å—ï¼škeep-aliveåŸç†ä¸åŠ¨æ€æ›´æ–°å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T13:48:09.000Z" title="Fri Dec 12 2025 13:48:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ç»„ä»¶ç¼“å­˜ï¼Ÿ</h2>
<p>åœ¨Vueå•é¡µåº”ç”¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼šç”¨æˆ·åœ¨æ•°æ®ç­›é€‰é¡µé¢è®¾ç½®äº†å¤æ‚çš„æŸ¥è¯¢æ¡ä»¶ï¼Œç„¶åè¿›å…¥è¯¦æƒ…é¡µæŸ¥çœ‹ï¼Œå½“è¿”å›æ—¶å¸Œæœ›ä¹‹å‰çš„ç­›é€‰æ¡ä»¶è¿˜èƒ½ä¿ç•™ã€‚å¦‚æœæ¯æ¬¡åˆ‡æ¢è·¯ç”±éƒ½é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œä¼šå¯¼è‡´ç”¨æˆ·ä½“éªŒä¸‹é™ã€æ•°æ®ä¸¢å¤±ã€æ€§èƒ½æŸè€—ç­‰é—®é¢˜ã€‚</p>
<p><strong>ç»„ä»¶ç¼“å­˜çš„æ ¸å¿ƒä»·å€¼ï¼š</strong></p>
<ol>
<li>
<ol>
<li>ä¿æŒç»„ä»¶çŠ¶æ€ï¼Œé¿å…é‡å¤æ¸²æŸ“</li>
</ol>
</li>
<li>
<ol start="2">
<li>æå‡åº”ç”¨æ€§èƒ½ï¼Œå‡å°‘ä¸å¿…è¦çš„DOMæ“ä½œ</li>
</ol>
</li>
<li>
<ol start="3">
<li>æ”¹å–„ç”¨æˆ·ä½“éªŒï¼Œç»´æŒç”¨æˆ·æ“ä½œä¸Šä¸‹æ–‡</li>
</ol>
</li>
</ol>
<h2 data-id="heading-1">äºŒã€Vueçš„ç¼“å­˜ç¥å™¨ï¼škeep-alive</h2>
<h3 data-id="heading-2">2.1 keep-aliveåŸºç¡€ç”¨æ³•</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
Â Â Â Â <span class="hljs-comment">&lt;!--Â åŸºæœ¬ç”¨æ³•Â --&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">component</span>Â <span class="hljs-attr">:is</span>=<span class="hljs-string">"currentComponent"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">&lt;!--Â ç»“åˆrouter-viewÂ --&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>Â <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$route.meta.keepAlive"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>Â <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!$route.meta.keepAlive"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">currentComponent</span>:Â <span class="hljs-string">'UserList'</span>
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2.2 keep-aliveçš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–</h3>
<p>å½“ç»„ä»¶è¢«ç¼“å­˜æ—¶ï¼Œæ­£å¸¸çš„ç”Ÿå‘½å‘¨æœŸä¼šå‘ç”Ÿå˜åŒ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'UserList'</span>,
Â Â 
Â Â <span class="hljs-comment">//Â æ­£å¸¸ç”Ÿå‘½å‘¨æœŸï¼ˆæœªç¼“å­˜æ—¶ï¼‰</span>
Â Â <span class="hljs-title function_">created</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶åˆ›å»º'</span>)
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadData</span>()
Â Â },
Â Â 
Â Â <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶æŒ‚è½½'</span>)
Â Â },
Â Â 
Â Â <span class="hljs-title function_">destroyed</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶é”€æ¯'</span>)
Â Â },
Â Â 
Â Â <span class="hljs-comment">//Â ç¼“å­˜ç‰¹æœ‰ç”Ÿå‘½å‘¨æœŸ</span>
Â Â <span class="hljs-title function_">activated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶è¢«æ¿€æ´»ï¼ˆè¿›å…¥ç¼“å­˜ç»„ä»¶ï¼‰'</span>)
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refreshData</span>()Â <span class="hljs-comment">//Â é‡æ–°è·å–æ•°æ®</span>
Â Â },
Â Â 
Â Â <span class="hljs-title function_">deactivated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç»„ä»¶è¢«åœç”¨ï¼ˆç¦»å¼€ç¼“å­˜ç»„ä»¶ï¼‰'</span>)
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveState</span>()Â <span class="hljs-comment">//Â ä¿å­˜å½“å‰çŠ¶æ€</span>
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾ï¼š</strong></p>
<pre><code class="hljs">é¦–æ¬¡è¿›å…¥ç»„ä»¶ï¼š
createdÂ â†’Â mountedÂ â†’Â activated

ç¦»å¼€ç¼“å­˜ç»„ä»¶ï¼š
deactivated

å†æ¬¡è¿›å…¥ç¼“å­˜ç»„ä»¶ï¼š
activatedï¼ˆè·³è¿‡createdå’Œmountedï¼‰

ç»„ä»¶è¢«é”€æ¯ï¼š
deactivatedÂ â†’Â destroyedï¼ˆå¦‚æœå®Œå…¨é”€æ¯ï¼‰
</code></pre>
<h2 data-id="heading-4">ä¸‰ã€é«˜çº§ç¼“å­˜ç­–ç•¥</h2>
<h3 data-id="heading-5">3.1 æ¡ä»¶ç¼“å­˜ä¸æ’é™¤ç¼“å­˜</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â <span class="hljs-comment">&lt;!--Â ç¼“å­˜ç‰¹å®šç»„ä»¶Â --&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span>Â <span class="hljs-attr">:include</span>=<span class="hljs-string">"cachedComponents"</span>Â <span class="hljs-attr">:exclude</span>=<span class="hljs-string">"excludedComponents"</span>Â <span class="hljs-attr">:max</span>=<span class="hljs-string">"5"</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â åªç¼“å­˜è¿™äº›ç»„ä»¶ï¼ˆåŸºäºç»„ä»¶nameï¼‰</span>
Â Â Â Â Â Â <span class="hljs-attr">cachedComponents</span>:Â [<span class="hljs-string">'UserList'</span>,Â <span class="hljs-string">'ProductList'</span>,Â <span class="hljs-string">'OrderList'</span>],
Â Â Â Â Â Â 
Â Â Â Â Â Â <span class="hljs-comment">//Â ä¸ç¼“å­˜è¿™äº›ç»„ä»¶</span>
Â Â Â Â Â Â <span class="hljs-attr">excludedComponents</span>:Â [<span class="hljs-string">'Login'</span>,Â <span class="hljs-string">'Register'</span>]
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">3.2 åŠ¨æ€è·¯ç”±ç¼“å­˜æ–¹æ¡ˆ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â router/index.js</span>
<span class="hljs-keyword">const</span>Â routesÂ =Â [
Â Â {
Â Â Â Â <span class="hljs-attr">path</span>:Â <span class="hljs-string">'/user/list'</span>,
Â Â Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'UserList'</span>,
Â Â Â Â <span class="hljs-attr">component</span>:Â <span class="hljs-function">()Â =&gt;</span>Â <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/UserList.vue'</span>),
Â Â Â Â <span class="hljs-attr">meta</span>:Â {
Â Â Â Â Â Â <span class="hljs-attr">title</span>:Â <span class="hljs-string">'ç”¨æˆ·åˆ—è¡¨'</span>,
Â Â Â Â Â Â <span class="hljs-attr">keepAlive</span>:Â <span class="hljs-literal">true</span>,Â <span class="hljs-comment">//Â éœ€è¦ç¼“å­˜</span>
Â Â Â Â Â Â <span class="hljs-attr">isRefresh</span>:Â <span class="hljs-literal">true</span>Â Â <span class="hljs-comment">//Â æ˜¯å¦éœ€è¦åˆ·æ–°</span>
Â Â Â Â }
Â Â },
Â Â {
Â Â Â Â <span class="hljs-attr">path</span>:Â <span class="hljs-string">'/user/detail/:id'</span>,
Â Â Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'UserDetail'</span>,
Â Â Â Â <span class="hljs-attr">component</span>:Â <span class="hljs-function">()Â =&gt;</span>Â <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/UserDetail.vue'</span>),
Â Â Â Â <span class="hljs-attr">meta</span>:Â {
Â Â Â Â Â Â <span class="hljs-attr">title</span>:Â <span class="hljs-string">'ç”¨æˆ·è¯¦æƒ…'</span>,
Â Â Â Â Â Â <span class="hljs-attr">keepAlive</span>:Â <span class="hljs-literal">false</span>Â <span class="hljs-comment">//Â ä¸éœ€è¦ç¼“å­˜</span>
Â Â Â Â }
Â Â }
]

<span class="hljs-comment">//Â App.vue</span>
&lt;template&gt;
Â Â <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>Â <span class="hljs-attr">v-if</span>=<span class="hljs-string">"$route.meta.keepAlive"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>Â <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!$route.meta.keepAlive"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;
</code></pre>
<h2 data-id="heading-7">å››ã€ç¼“å­˜åçš„æ•°æ®æ›´æ–°ç­–ç•¥</h2>
<h3 data-id="heading-8">4.1 æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨activatedé’©å­</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'ProductList'</span>,
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">products</span>:Â [],
Â Â Â Â Â Â <span class="hljs-attr">filterParams</span>:Â {
Â Â Â Â Â Â Â Â <span class="hljs-attr">category</span>:Â <span class="hljs-string">''</span>,
Â Â Â Â Â Â Â Â <span class="hljs-attr">priceRange</span>:Â [<span class="hljs-number">0</span>,Â <span class="hljs-number">1000</span>],
Â Â Â Â Â Â Â Â <span class="hljs-attr">sortBy</span>:Â <span class="hljs-string">'createdAt'</span>
Â Â Â Â Â Â },
Â Â Â Â Â Â <span class="hljs-attr">lastUpdateTime</span>:Â <span class="hljs-literal">null</span>
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-title function_">activated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-comment">//Â æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ·æ–°æ•°æ®ï¼ˆæ¯”å¦‚è¶…è¿‡5åˆ†é’Ÿï¼‰</span>
Â Â Â Â <span class="hljs-keyword">const</span>Â nowÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
Â Â Â Â <span class="hljs-keyword">if</span>Â (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdateTime</span>Â ||Â (nowÂ -Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdateTime</span>)Â &gt;Â <span class="hljs-number">5</span>Â *Â <span class="hljs-number">60</span>Â *Â <span class="hljs-number">1000</span>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refreshData</span>()
Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œä½†æ›´æ–°ä¸€äº›å®æ—¶æ€§è¦æ±‚é«˜çš„å†…å®¹</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateRealTimeData</span>()
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-keyword">async</span>Â <span class="hljs-title function_">refreshData</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">try</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â responseÂ =Â <span class="hljs-keyword">await</span>Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">$api</span>.<span class="hljs-title function_">getProducts</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">filterParams</span>)
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">products</span>Â =Â response.<span class="hljs-property">data</span>
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdateTime</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
Â Â Â Â Â Â }Â <span class="hljs-keyword">catch</span>Â (error)Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ•°æ®åˆ·æ–°å¤±è´¥:'</span>,Â error)
Â Â Â Â Â Â }
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">updateRealTimeData</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â åªæ›´æ–°åº“å­˜ã€ä»·æ ¼ç­‰å®æ—¶æ•°æ®</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">products</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span>Â (product)Â =&gt;Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â stockInfoÂ =Â <span class="hljs-keyword">await</span>Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">$api</span>.<span class="hljs-title function_">getProductStock</span>(product.<span class="hljs-property">id</span>)
Â Â Â Â Â Â Â Â product.<span class="hljs-property">stock</span>Â =Â stockInfo.<span class="hljs-property">quantity</span>
Â Â Â Â Â Â Â Â product.<span class="hljs-property">price</span>Â =Â stockInfo.<span class="hljs-property">price</span>
Â Â Â Â Â Â })
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-9">4.2 æ–¹æ¡ˆäºŒï¼šäº‹ä»¶æ€»çº¿æ›´æ–°</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â utils/eventBus.js</span>
<span class="hljs-keyword">import</span>Â <span class="hljs-title class_">Vue</span>Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Vue</span>()

<span class="hljs-comment">//Â ProductList.vueï¼ˆç¼“å­˜ç»„ä»¶ï¼‰</span>
&lt;script&gt;
<span class="hljs-keyword">import</span>Â eventBusÂ <span class="hljs-keyword">from</span>Â <span class="hljs-string">'@/utils/eventBus'</span>

<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">created</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-comment">//Â ç›‘å¬æ•°æ®æ›´æ–°äº‹ä»¶</span>
Â Â Â Â eventBus.$on(<span class="hljs-string">'refresh-product-list'</span>,Â <span class="hljs-function">(<span class="hljs-params">params</span>)Â =&gt;</span>Â {
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">this</span>.<span class="hljs-property">filterParams</span>.<span class="hljs-property">category</span>Â !==Â params.<span class="hljs-property">category</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">filterParams</span>Â =Â {Â ...paramsÂ }
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refreshData</span>()
Â Â Â Â Â Â }
Â Â Â Â })
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â ç›‘å¬å¼ºåˆ¶åˆ·æ–°äº‹ä»¶</span>
Â Â Â Â eventBus.$on(<span class="hljs-string">'force-refresh'</span>,Â <span class="hljs-function">()Â =&gt;</span>Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refreshData</span>()
Â Â Â Â })
Â Â },
Â Â 
Â Â <span class="hljs-title function_">deactivated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-comment">//Â ç¦»å¼€æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬ï¼Œé¿å…å†…å­˜æ³„æ¼</span>
Â Â Â Â eventBus.$off(<span class="hljs-string">'refresh-product-list'</span>)
Â Â Â Â eventBus.$off(<span class="hljs-string">'force-refresh'</span>)
Â Â },
Â Â 
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-title function_">handleSearch</span>(<span class="hljs-params">params</span>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â è§¦å‘æœç´¢æ—¶ï¼Œé€šçŸ¥å…¶ä»–ç»„ä»¶</span>
Â Â Â Â Â Â eventBus.$emit(<span class="hljs-string">'search-params-changed'</span>,Â params)
Â Â Â Â }
Â Â }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-10">4.3 æ–¹æ¡ˆä¸‰ï¼šVuexçŠ¶æ€ç®¡ç† + ç›‘å¬</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â store/modules/product.js</span>
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-attr">state</span>:Â {
Â Â Â Â <span class="hljs-attr">list</span>:Â [],
Â Â Â Â <span class="hljs-attr">filterParams</span>:Â {},
Â Â Â Â <span class="hljs-attr">lastFetchTime</span>:Â <span class="hljs-literal">null</span>
Â Â },
Â Â 
Â Â <span class="hljs-attr">mutations</span>:Â {
Â Â Â Â <span class="hljs-title function_">SET_PRODUCT_LIST</span>(<span class="hljs-params">state,Â products</span>)Â {
Â Â Â Â Â Â state.<span class="hljs-property">list</span>Â =Â products
Â Â Â Â Â Â state.<span class="hljs-property">lastFetchTime</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">UPDATE_FILTER_PARAMS</span>(<span class="hljs-params">state,Â params</span>)Â {
Â Â Â Â Â Â state.<span class="hljs-property">filterParams</span>Â =Â {Â ...state.<span class="hljs-property">filterParams</span>,Â ...paramsÂ }
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-attr">actions</span>:Â {
Â Â Â Â <span class="hljs-keyword">async</span>Â <span class="hljs-title function_">fetchProducts</span>(<span class="hljs-params">{Â commit,Â stateÂ },Â forceRefreshÂ =Â <span class="hljs-literal">false</span></span>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â å¦‚æœä¸æ˜¯å¼ºåˆ¶åˆ·æ–°ä¸”æ•°æ®åœ¨æœ‰æ•ˆæœŸå†…ï¼Œåˆ™ä½¿ç”¨ç¼“å­˜</span>
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â nowÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (!forceRefreshÂ &amp;&amp;Â state.<span class="hljs-property">lastFetchTime</span>Â &amp;&amp;Â 
Â Â Â Â Â Â Â Â Â Â (nowÂ -Â state.<span class="hljs-property">lastFetchTime</span>)Â &lt;Â <span class="hljs-number">10</span>Â *Â <span class="hljs-number">60</span>Â *Â <span class="hljs-number">1000</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>
Â Â Â Â Â Â }
Â Â Â Â Â Â 
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â responseÂ =Â <span class="hljs-keyword">await</span>Â api.<span class="hljs-title function_">getProducts</span>(state.<span class="hljs-property">filterParams</span>)
Â Â Â Â Â Â <span class="hljs-title function_">commit</span>(<span class="hljs-string">'SET_PRODUCT_LIST'</span>,Â response.<span class="hljs-property">data</span>)
Â Â Â Â }
Â Â }
}

<span class="hljs-comment">//Â ProductList.vue</span>
&lt;script&gt;
<span class="hljs-keyword">import</span>Â {Â mapState,Â mapActionsÂ }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'vuex'</span>

<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-attr">computed</span>:Â {
Â Â Â Â ...<span class="hljs-title function_">mapState</span>(<span class="hljs-string">'product'</span>,Â [<span class="hljs-string">'list'</span>,Â <span class="hljs-string">'filterParams'</span>])
Â Â },
Â Â 
Â Â <span class="hljs-title function_">activated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-comment">//Â ç›‘å¬VuexçŠ¶æ€å˜åŒ–</span>
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">unwatch</span>Â =Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">watch</span>(
Â Â Â Â Â Â <span class="hljs-function">(<span class="hljs-params">state</span>)Â =&gt;</span>Â state.<span class="hljs-property">product</span>.<span class="hljs-property">filterParams</span>,
Â Â Â Â Â Â <span class="hljs-function">(<span class="hljs-params">newParams,Â oldParams</span>)Â =&gt;</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(newParams)Â !==Â <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(oldParams))Â {
Â Â Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchProducts</span>()
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â }
Â Â Â Â )
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°</span>
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkAndUpdate</span>()
Â Â },
Â Â 
Â Â <span class="hljs-title function_">deactivated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-comment">//Â å–æ¶ˆç›‘å¬</span>
Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">this</span>.<span class="hljs-property">unwatch</span>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unwatch</span>()
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â ...<span class="hljs-title function_">mapActions</span>(<span class="hljs-string">'product'</span>,Â [<span class="hljs-string">'fetchProducts'</span>]),
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">checkAndUpdate</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â lastFetchTimeÂ =Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-property">state</span>.<span class="hljs-property">product</span>.<span class="hljs-property">lastFetchTime</span>
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â nowÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
Â Â Â Â Â Â 
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (!lastFetchTimeÂ ||Â (nowÂ -Â lastFetchTime)Â &gt;Â <span class="hljs-number">10</span>Â *Â <span class="hljs-number">60</span>Â *Â <span class="hljs-number">1000</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchProducts</span>()
Â Â Â Â Â Â }
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">handleFilterChange</span>(<span class="hljs-params">params</span>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">commit</span>(<span class="hljs-string">'product/UPDATE_FILTER_PARAMS'</span>,Â params)
Â Â Â Â }
Â Â }
}
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-11">äº”ã€å®æˆ˜ï¼šåŠ¨æ€ç¼“å­˜ç®¡ç†</h2>
<h3 data-id="heading-12">5.1 ç¼“å­˜ç®¡ç†å™¨å®ç°</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â components/CacheManager.vueÂ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"cache-manager"</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">keep-alive</span>Â <span class="hljs-attr">:include</span>=<span class="hljs-string">"dynamicInclude"</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">keep-alive</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'CacheManager'</span>,
Â Â 
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">cachedViews</span>:Â [],Â <span class="hljs-comment">//Â ç¼“å­˜çš„ç»„ä»¶ååˆ—è¡¨</span>
Â Â Â Â Â Â <span class="hljs-attr">maxCacheCount</span>:Â <span class="hljs-number">10</span>Â <span class="hljs-comment">//Â æœ€å¤§ç¼“å­˜æ•°é‡</span>
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-attr">computed</span>:Â {
Â Â Â Â <span class="hljs-title function_">dynamicInclude</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-title function_">created</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initCache</span>()
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â ç›‘å¬è·¯ç”±å˜åŒ–</span>
Â Â Â Â <span class="hljs-variable language_">this</span>.$watch(
Â Â Â Â Â Â <span class="hljs-function">()Â =&gt;</span>Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>,
Â Â Â Â Â Â <span class="hljs-function">(<span class="hljs-params">to,Â <span class="hljs-keyword">from</span></span>)Â =&gt;</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCache</span>(to)
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">manageCacheSize</span>()
Â Â Â Â Â Â },
Â Â Â Â Â Â {Â <span class="hljs-attr">immediate</span>:Â <span class="hljs-literal">true</span>Â }
Â Â Â Â )
Â Â },
Â Â 
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-title function_">initCache</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä»localStorageæ¢å¤ç¼“å­˜è®¾ç½®</span>
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â savedCacheÂ =Â <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'vue-cache-views'</span>)
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (savedCache)Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>Â =Â <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(savedCache)
Â Â Â Â Â Â }
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">addCache</span>(<span class="hljs-params">route</span>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (route.<span class="hljs-property">meta</span>Â &amp;&amp;Â route.<span class="hljs-property">meta</span>.<span class="hljs-property">keepAlive</span>Â &amp;&amp;Â route.<span class="hljs-property">name</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â cacheNameÂ =Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCacheName</span>(route)
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>.<span class="hljs-title function_">includes</span>(cacheName))Â {
Â Â Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>.<span class="hljs-title function_">push</span>(cacheName)
Â Â Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveCacheToStorage</span>()
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â }
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">removeCache</span>(<span class="hljs-params">routeName</span>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â indexÂ =Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>.<span class="hljs-title function_">indexOf</span>(routeName)
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (indexÂ &gt;Â -<span class="hljs-number">1</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>.<span class="hljs-title function_">splice</span>(index,Â <span class="hljs-number">1</span>)
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveCacheToStorage</span>()
Â Â Â Â Â Â }
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">clearCache</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>Â =Â []
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveCacheToStorage</span>()
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">refreshCache</span>(<span class="hljs-params">routeName</span>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â åˆ·æ–°ç‰¹å®šç¼“å­˜</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeCache</span>(routeName)
Â Â Â Â Â Â <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()Â =&gt;</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCache</span>({Â <span class="hljs-attr">name</span>:Â routeName,Â <span class="hljs-attr">meta</span>:Â {Â <span class="hljs-attr">keepAlive</span>:Â <span class="hljs-literal">true</span>Â }Â })
Â Â Â Â Â Â },Â <span class="hljs-number">0</span>)
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">manageCacheSize</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç¼“å­˜ç­–ç•¥</span>
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>.<span class="hljs-property">length</span>Â &gt;Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxCacheCount</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>.<span class="hljs-title function_">shift</span>()Â <span class="hljs-comment">//Â ç§»é™¤æœ€æ—§çš„ç¼“å­˜</span>
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveCacheToStorage</span>()
Â Â Â Â Â Â }
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">getCacheName</span>(<span class="hljs-params">route</span>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä¸ºåŠ¨æ€è·¯ç”±ç”Ÿæˆå”¯ä¸€çš„ç¼“å­˜key</span>
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (route.<span class="hljs-property">params</span>Â &amp;&amp;Â route.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">`<span class="hljs-subst">${route.name}</span>-<span class="hljs-subst">${route.params.id}</span>`</span>
Â Â Â Â Â Â }
Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â route.<span class="hljs-property">name</span>
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">saveCacheToStorage</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'vue-cache-views'</span>,Â <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedViews</span>))
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-13">5.2 ç¼“å­˜çŠ¶æ€æŒ‡ç¤ºå™¨</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â components/CacheIndicator.vueÂ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"cache-indicator"</span>Â <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showIndicator"</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"cache-status"</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"cache-icon"</span>&gt;</span>ğŸ’¾<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">span</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"cache-text"</span>&gt;</span>æ•°æ®å·²ç¼“å­˜Â {{Â cacheTimeÂ }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"refreshData"</span>Â <span class="hljs-attr">class</span>=<span class="hljs-string">"refresh-btn"</span>&gt;</span>åˆ·æ–°<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-attr">props</span>:Â {
Â Â Â Â <span class="hljs-attr">componentName</span>:Â {
Â Â Â Â Â Â <span class="hljs-attr">type</span>:Â <span class="hljs-title class_">String</span>,
Â Â Â Â Â Â <span class="hljs-attr">required</span>:Â <span class="hljs-literal">true</span>
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">lastUpdate</span>:Â <span class="hljs-literal">null</span>,
Â Â Â Â Â Â <span class="hljs-attr">showIndicator</span>:Â <span class="hljs-literal">false</span>,
Â Â Â Â Â Â <span class="hljs-attr">updateInterval</span>:Â <span class="hljs-literal">null</span>
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-attr">computed</span>:Â {
Â Â Â Â <span class="hljs-title function_">cacheTime</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span>)Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">''</span>
Â Â Â Â Â Â 
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â nowÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>()
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â diffÂ =Â <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((nowÂ -Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span>)Â /Â <span class="hljs-number">1000</span>)
Â Â Â Â Â Â 
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (diffÂ &lt;Â <span class="hljs-number">60</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">`<span class="hljs-subst">${diff}</span>ç§’å‰`</span>
Â Â Â Â Â Â }Â <span class="hljs-keyword">else</span>Â <span class="hljs-keyword">if</span>Â (diffÂ &lt;Â <span class="hljs-number">3600</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(diffÂ /Â <span class="hljs-number">60</span>)}</span>åˆ†é’Ÿå‰`</span>
Â Â Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(diffÂ /Â <span class="hljs-number">3600</span>)}</span>å°æ—¶å‰`</span>
Â Â Â Â Â Â }
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-title function_">activated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadCacheTime</span>()
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">showIndicator</span>Â =Â <span class="hljs-literal">true</span>
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startTimer</span>()
Â Â },
Â Â 
Â Â <span class="hljs-title function_">deactivated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">showIndicator</span>Â =Â <span class="hljs-literal">false</span>
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopTimer</span>()
Â Â },
Â Â 
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-title function_">loadCacheTime</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â cacheDataÂ =Â <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">`cache-<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.componentName}</span>`</span>)
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (cacheData)Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(cacheData).<span class="hljs-property">timestamp</span>)
Â Â Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>()
Â Â Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveCacheTime</span>()
Â Â Â Â Â Â }
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">saveCacheTime</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â cacheDataÂ =Â {
Â Â Â Â Â Â Â Â <span class="hljs-attr">timestamp</span>:Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
Â Â Â Â Â Â Â Â <span class="hljs-attr">component</span>:Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentName</span>
Â Â Â Â Â Â }
Â Â Â Â Â Â <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">`cache-<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.componentName}</span>`</span>,Â <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(cacheData))
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Date</span>()
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">refreshData</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'refresh'</span>)
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveCacheTime</span>()
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">startTimer</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">updateInterval</span>Â =Â <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">()Â =&gt;</span>Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ›´æ–°æ˜¾ç¤ºæ—¶é—´</span>
Â Â Â Â Â Â },Â <span class="hljs-number">60000</span>)Â <span class="hljs-comment">//Â æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æ˜¾ç¤º</span>
Â Â Â Â },
Â Â Â Â 
Â Â Â Â <span class="hljs-title function_">stopTimer</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">this</span>.<span class="hljs-property">updateInterval</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">updateInterval</span>)
Â Â Â Â Â Â }
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>Â <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.cache-indicator</span>Â {
Â Â <span class="hljs-attribute">position</span>:Â fixed;
Â Â <span class="hljs-attribute">bottom</span>:Â <span class="hljs-number">20px</span>;
Â Â <span class="hljs-attribute">right</span>:Â <span class="hljs-number">20px</span>;
Â Â <span class="hljs-attribute">background</span>:Â <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,Â <span class="hljs-number">0</span>,Â <span class="hljs-number">0</span>,Â <span class="hljs-number">0.8</span>);
Â Â <span class="hljs-attribute">color</span>:Â white;
Â Â <span class="hljs-attribute">padding</span>:Â <span class="hljs-number">10px</span>Â <span class="hljs-number">15px</span>;
Â Â <span class="hljs-attribute">border-radius</span>:Â <span class="hljs-number">20px</span>;
Â Â <span class="hljs-attribute">font-size</span>:Â <span class="hljs-number">14px</span>;
Â Â <span class="hljs-attribute">z-index</span>:Â <span class="hljs-number">9999</span>;
}

<span class="hljs-selector-class">.cache-status</span>Â {
Â Â <span class="hljs-attribute">display</span>:Â flex;
Â Â <span class="hljs-attribute">align-items</span>:Â center;
Â Â <span class="hljs-attribute">gap</span>:Â <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.refresh-btn</span>Â {
Â Â <span class="hljs-attribute">background</span>:Â <span class="hljs-number">#4CAF50</span>;
Â Â <span class="hljs-attribute">color</span>:Â white;
Â Â <span class="hljs-attribute">border</span>:Â none;
Â Â <span class="hljs-attribute">padding</span>:Â <span class="hljs-number">4px</span>Â <span class="hljs-number">12px</span>;
Â Â <span class="hljs-attribute">border-radius</span>:Â <span class="hljs-number">4px</span>;
Â Â <span class="hljs-attribute">cursor</span>:Â pointer;
Â Â <span class="hljs-attribute">font-size</span>:Â <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.refresh-btn</span><span class="hljs-selector-pseudo">:hover</span>Â {
Â Â <span class="hljs-attribute">background</span>:Â <span class="hljs-number">#45a049</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-14">å…­ã€æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-15">6.1 å†…å­˜ç®¡ç†å»ºè®®</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â ç›‘æ§ç¼“å­˜ç»„ä»¶æ•°é‡</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>({
Â Â <span class="hljs-title function_">activated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">window</span>.<span class="hljs-property">keepAliveInstances</span>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">window</span>.<span class="hljs-property">keepAliveInstances</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>)
Â Â Â Â Â Â <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å½“å‰ç¼“å­˜ç»„ä»¶æ•°é‡:Â <span class="hljs-subst">${<span class="hljs-variable language_">window</span>.keepAliveInstances.size}</span>`</span>)
Â Â Â Â }
Â Â },
Â Â 
Â Â <span class="hljs-title function_">deactivated</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">window</span>.<span class="hljs-property">keepAliveInstances</span>)Â {
Â Â Â Â Â Â <span class="hljs-variable language_">window</span>.<span class="hljs-property">keepAliveInstances</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-variable language_">this</span>)
Â Â Â Â }
Â Â }
})

<span class="hljs-comment">//Â åº”ç”¨åˆå§‹åŒ–æ—¶</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">keepAliveInstances</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Set</span>()
</code></pre>
<h3 data-id="heading-16">6.2 ç¼“å­˜ç­–ç•¥é€‰æ‹©æŒ‡å—</h3>






























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åˆ—è¡¨é¡µ â†’ è¯¦æƒ…é¡µ â†’ è¿”å›åˆ—è¡¨</td><td>keep-alive + activatedåˆ·æ–°</td><td>ä¿æŒåˆ—è¡¨çŠ¶æ€ï¼Œè¿”å›æ—¶å¯é€‰åˆ·æ–°</td></tr><tr><td>å¤šæ ‡ç­¾é¡µç®¡ç†</td><td>åŠ¨æ€include + LRUç­–ç•¥</td><td>é¿å…å†…å­˜æ³„æ¼ï¼Œè‡ªåŠ¨æ¸…ç†</td></tr><tr><td>å®æ—¶æ•°æ®å±•ç¤º</td><td>Vuex + çŸ­æ—¶é—´ç¼“å­˜</td><td>ä¿è¯æ•°æ®å®æ—¶æ€§</td></tr><tr><td>å¤æ‚è¡¨å•å¡«å†™</td><td>keep-alive + æœ¬åœ°å­˜å‚¨å¤‡ä»½</td><td>é˜²æ­¢æ•°æ®ä¸¢å¤±</td></tr></tbody></table>
<h3 data-id="heading-17">6.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>é—®é¢˜1ï¼šç¼“å­˜ç»„ä»¶æ•°æ®ä¸æ›´æ–°</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â è§£å†³æ–¹æ¡ˆï¼šå¼ºåˆ¶åˆ·æ–°ç‰¹å®šç»„ä»¶</span>
<span class="hljs-keyword">this</span>.$nextTick(()Â =&gt;Â {
Â Â <span class="hljs-keyword">const</span>Â cacheÂ =Â <span class="hljs-keyword">this</span>.$vnode.parent.componentInstance.cache
Â Â <span class="hljs-keyword">const</span>Â keysÂ =Â <span class="hljs-keyword">this</span>.$vnode.parent.componentInstance.keys
Â Â 
Â Â <span class="hljs-keyword">if</span>Â (cacheÂ &amp;&amp;Â keys)Â {
Â Â Â Â <span class="hljs-keyword">const</span>Â keyÂ =Â <span class="hljs-keyword">this</span>.$vnode.key
Â Â Â Â <span class="hljs-keyword">if</span>Â (keyÂ !=Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â deleteÂ cache[key]
Â Â Â Â Â Â <span class="hljs-keyword">const</span>Â indexÂ =Â keys.indexOf(key)
Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (indexÂ &gt;Â -<span class="hljs-number">1</span>)Â {
Â Â Â Â Â Â Â Â keys.splice(index,Â <span class="hljs-number">1</span>)
Â Â Â Â Â Â }
Â Â Â Â }
Â Â }
})
</code></pre>
<p><strong>é—®é¢˜2ï¼šæ»šåŠ¨ä½ç½®ä¿æŒ</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â åœ¨è·¯ç”±é…ç½®ä¸­</span>
{
Â Â <span class="hljs-attr">path</span>:Â <span class="hljs-string">'/list'</span>,
Â Â <span class="hljs-attr">component</span>:Â <span class="hljs-title class_">ListPage</span>,
Â Â <span class="hljs-attr">meta</span>:Â {
Â Â Â Â <span class="hljs-attr">keepAlive</span>:Â <span class="hljs-literal">true</span>,
Â Â Â Â <span class="hljs-attr">scrollToTop</span>:Â <span class="hljs-literal">false</span>Â <span class="hljs-comment">//Â ä¸æ»šåŠ¨åˆ°é¡¶éƒ¨</span>
Â Â }
}

<span class="hljs-comment">//Â åœ¨ç»„ä»¶ä¸­</span>
<span class="hljs-title function_">deactivated</span>(<span class="hljs-params"/>)Â {
Â Â <span class="hljs-comment">//Â ä¿å­˜æ»šåŠ¨ä½ç½®</span>
Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span>Â =Â <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span>Â ||Â <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span>
},

<span class="hljs-title function_">activated</span>(<span class="hljs-params"/>)Â {
Â Â <span class="hljs-comment">//Â æ¢å¤æ»šåŠ¨ä½ç½®</span>
Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span>)Â {
Â Â Â Â <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>,Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">scrollTop</span>)
Â Â }
}
</code></pre>
<h2 data-id="heading-18">ä¸ƒã€æ€»ç»“</h2>
<p>Vueç»„ä»¶ç¼“å­˜æ˜¯æå‡åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒçš„é‡è¦æ‰‹æ®µï¼Œä½†éœ€è¦åˆç†ä½¿ç”¨ã€‚å…³é”®ç‚¹æ€»ç»“ï¼š</p>
<ol>
<li>1.Â <strong>åˆç†é€‰æ‹©ç¼“å­˜ç­–ç•¥</strong>ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©é€‚å½“çš„ç¼“å­˜æ–¹æ¡ˆ</li>
<li>2.Â <strong>æ³¨æ„å†…å­˜ç®¡ç†</strong>ï¼šä½¿ç”¨maxå±æ€§é™åˆ¶ç¼“å­˜æ•°é‡ï¼Œå®ç°LRUç­–ç•¥</li>
<li>3.Â <strong>æ•°æ®æ›´æ–°è¦çµæ´»</strong>ï¼šç»“åˆactivatedé’©å­ã€äº‹ä»¶æ€»çº¿ã€Vuexç­‰å¤šç§æ–¹å¼</li>
<li>4.Â <strong>ç›‘æ§ç¼“å­˜çŠ¶æ€</strong>ï¼šå®ç°ç¼“å­˜æŒ‡ç¤ºå™¨ï¼Œè®©ç”¨æˆ·äº†è§£æ•°æ®çŠ¶æ€</li>
<li>5.Â <strong>æä¾›åˆ·æ–°æœºåˆ¶</strong>ï¼šå§‹ç»ˆç»™ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°çš„é€‰æ‹©æƒ</li>
</ol>
<p>æ­£ç¡®ä½¿ç”¨keep-aliveå’Œç›¸å…³ç¼“å­˜æŠ€æœ¯ï¼Œå¯ä»¥è®©ä½ çš„Vueåº”ç”¨æ—¢ä¿æŒæµç•…çš„ç”¨æˆ·ä½“éªŒï¼Œåˆèƒ½ä¿è¯æ•°æ®çš„å‡†ç¡®æ€§å’Œå®æ—¶æ€§ã€‚è®°ä½ï¼Œç¼“å­˜ä¸æ˜¯ç›®çš„ï¼Œè€Œæ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„æ‰‹æ®µï¼Œè¦æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚çµæ´»è¿ç”¨ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡è¯¦ç»†çš„æŒ‡å—èƒ½å¸®åŠ©ä½ åœ¨å®é™…é¡¹ç›®ä¸­æ›´å¥½åœ°åº”ç”¨Vueç»„ä»¶ç¼“å­˜æŠ€æœ¯ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨Trae SOLOæ¨¡å¼å¼€å‘ä¸€ä¸ªè§†é¢‘æå–æ–‡å­—å¹¶æ€»ç»“å½’çº³çš„å·¥å…·â€”â€”é™„çº¿ä¸Šé¢„è§ˆåœ°å€]]></title>    <link>https://juejin.cn/post/7582779306731585571</link>    <guid>https://juejin.cn/post/7582779306731585571</guid>    <pubDate>2025-12-12T15:35:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582779306731585571" data-draft-id="7582149417768599602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨Trae SOLOæ¨¡å¼å¼€å‘ä¸€ä¸ªè§†é¢‘æå–æ–‡å­—å¹¶æ€»ç»“å½’çº³çš„å·¥å…·â€”â€”é™„çº¿ä¸Šé¢„è§ˆåœ°å€"/> <meta itemprop="keywords" content="Trae,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-12T15:35:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ°´å†—æ°´å­š"/> <meta itemprop="url" content="https://juejin.cn/user/1406974769508679"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨Trae SOLOæ¨¡å¼å¼€å‘ä¸€ä¸ªè§†é¢‘æå–æ–‡å­—å¹¶æ€»ç»“å½’çº³çš„å·¥å…·â€”â€”é™„çº¿ä¸Šé¢„è§ˆåœ°å€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1406974769508679/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ°´å†—æ°´å­š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T15:35:01.000Z" title="Fri Dec 12 2025 15:35:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬æ–‡è®°å½•ä½¿ç”¨Trae SOLOæ¨¡å¼å¼€å‘ä¸€ä¸ªè§†é¢‘æå–æ–‡å­—å¹¶æ€»ç»“å½’çº³çš„å·¥å…·</p>
<p>çº¿ä¸Šåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fashuai.site%3A24680%2F" target="_blank" title="https://ashuai.site:24680/" ref="nofollow noopener noreferrer">ashuai.site:24680/</a></p>
<h2 data-id="heading-1">éœ€æ±‚åœºæ™¯è¡¨è¿°</h2>
<ul>
<li>
<p>ç¬”è€…æ˜¯å‰ç«¯å¼€å‘ï¼Œä½†æ˜¯å¯¹äº§å“ç»ç†çš„çŸ¥è¯†äº†è§£ä¸å¤šï¼Œæ‰€ä»¥æƒ³å­¦ä¹ äº§å“ç»ç†çš„çŸ¥è¯†ï¼Œé—®ä¹‹å‰çš„äº§å“åŒäº‹è¦äº†ä¸€ä»½è§†é¢‘è¯¾ç¨‹ï¼Œæ— å¥ˆè¯¾ç¨‹æ—¶é•¿èµ·æ­¥ä¸€ä¸ªå¤šå°æ—¶ï¼Œå¦‚æœä¸€ç‚¹ç‚¹å¼€ï¼Œæˆ–è€…å¿«è¿›çœ‹ï¼Œä¹Ÿæ˜¯æ•ˆç‡ç•¥ä½ã€‚</p>
</li>
<li>
<p>å› æ­¤ï¼Œç¬”è€…æƒ³å¼€å‘ä¸€ä¸ªå·¥å…·ï¼Œèƒ½å¤Ÿä¸€é”®æå–è§†é¢‘ä¸­çš„å†…å®¹æ–‡å­—ï¼Œå¹¶æŠŠå†…å®¹æ–‡å­—äº¤ç»™å¤§æ¨¡å‹ï¼Œç”±å¤§æ¨¡å‹æ€»ç»“æ‘˜è¦</p>
</li>
<li>
<p>è¿™æ ·æˆ‘å°±å¯ä»¥å¿«é€Ÿå­¦ä¹ äº§å“ç»ç†çš„çŸ¥è¯†ï¼Œè€Œä¸æ˜¯æµªè´¹æ—¶é—´åœ¨çœ‹è§†é¢‘ä¸Š</p>
</li>
</ul>
<p>é¦–å…ˆï¼Œæˆ‘éœ€è¦åšæŠ€æœ¯æ¡†æ¶é€‰å‹ï¼Œé™å®šä¸ºreact+vite+ts+antd+tailwindcss</p>
<blockquote>
<p>ç¯‡å¹…åŸå› ï¼ŒæŠŠå†…å®¹æ–‡å­—äº¤ç»™å¤§æ¨¡å‹ï¼Œç”±å¤§æ¨¡å‹æ€»ç»“æ‘˜è¦è¿™ä¸€æ­¥ï¼Œç¬”è€…æ²¡æœ‰å†solo</p>
</blockquote>
<blockquote>
<p>åŒè´¨åŒ–è°ƒç”¨å¤§æ¨¡å‹apiçš„æ–‡ç« ï¼Œå¯ä»¥å‚è€ƒç¬”è€…å…ˆå‰çš„æ–‡ç« ï¼š<a href="https://juejin.cn/post/7578003302487425024" target="_blank" title="https://juejin.cn/post/7578003302487425024">ã€Šæ•ˆèƒ½å·¥å…·ï¼ˆåï¼‰ä¹‹æ¥å…¥deepseekå®ç°AIå­¦ä¹ PDFæ–‡æ¡£è¯»åæ„Ÿæ–‡ä»¶æ‰¹é‡ç”ŸæˆåŠŸèƒ½ã€‹</a></p>
</blockquote>
<h2 data-id="heading-2">Traeçš„SOLOæ¨¡å¼å¼€å‘</h2>
<h3 data-id="heading-3">1. åŸºäºç”¨æˆ·éœ€æ±‚ï¼Œç”Ÿæˆå¯¹åº”æ–‡æ¡£</h3>
<p>ç¬”è€…æŠŠä¸Šè¿°éœ€æ±‚ï¼Œå‘ŠçŸ¥Trae ä»¥åï¼ŒTraeè‡ªåŠ¨å¸®æˆ‘ç”Ÿæˆä¸€ä¸ªæ–‡æ¡£ï¼Œè§„åˆ’å¥½ï¼Œå®ƒéœ€è¦åšçš„äº‹æƒ…ï¼Œå¹¶ä¸”å…è®¸æˆ‘è°ƒæ•´è¿™ä¸ªè§„åˆ’æ–‡æ¡£ï¼Œå¦‚ä¸‹ï¼š</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d99eeec70f7b4e229f13eae966358e3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=lrkDVzTZwvUEb39w%2BG7dlEy5OWY%3D" alt="1.png" width="70%" loading="lazy"/>
<ul>
<li>å¦‚æœæˆ‘è§‰å¾—è§„åˆ’æ–‡æ¡£å†—ä½™ï¼Œæˆ–è€…ç¼ºå°‘ä¸œè¥¿ï¼Œå¯ä»¥ä¿®ä¿®æ”¹æ”¹</li>
<li>è¿™ä¸€æ­¥ï¼Œå¾ˆåƒé¡¹ç›®ç»ç†æå‡ºéœ€æ±‚åï¼Œäº§å“æä¾›çš„éœ€æ±‚æ‹†è§£æ–‡æ¡£ï¼ˆåŒ…å«æŠ€æœ¯å¼€å‘è¦ç‚¹ï¼‰</li>
</ul>
<h3 data-id="heading-4">2. è®©å…¶æŒ‰ç…§æ–‡æ¡£ï¼Œè¿›è¡Œå¼€å·¥</h3>
<p>è®©å…¶æŒ‰ç…§æ–‡æ¡£ï¼Œè¿›è¡Œå¼€å·¥ï¼ŒTrae SOLOä¼šè‡ªåŠ¨åœ¨å‘½ä»¤è¡Œæ‰§è¡Œç›¸å…³å‘½ä»¤ï¼Œç„¶ååœ¨å³ä¾§ç”Ÿæˆå¯¹åº”ä»£ç </p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a81f2aa5553e4f5cb4381b3a99317591~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=Wh3Zb%2F0IxETvgB12%2BYPpoXyNsYM%3D" alt="2.png" width="70%" loading="lazy"/>
<p>ç„¶åï¼Œå®‰è£…å„ç§ä¾èµ–</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f2e8733b50044ec8d0a454d91f20929~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=tSOcbXNDT2g%2FAjooXds0eR54cYM%3D" alt="4.png" width="70%" loading="lazy"/>
<h3 data-id="heading-5">3. äº§ç‰©å˜æ›´</h3>
<p>å½“Trae SOLOå®Œæ¯•ä»¥åï¼Œä¼šæä¾›ä¸€ä¸ªäº§ç‰©æ±‡æ€»ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å˜æ›´ï¼Œè¿™æ ·èƒ½å¤Ÿå…·ä½“çœ‹å‡ºæ¥ï¼ŒTraeå¸®æˆ‘ä»¬å†™äº†é‚£äº›ä»£ç </p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8b3bd4ebe094e17a56e5d25303174db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=FFFftoIBG7Y4upgSXEngS1VYhgU%3D" alt="5.png" width="70%" loading="lazy"/>
<p>ç„¶åï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ç»ˆç«¯</p>
<h3 data-id="heading-6">4. å¯åŠ¨é¡¹ç›®è·‘èµ·æ¥ï¼Œæµè§ˆå™¨çœ‹æ•ˆæœ</h3>
<p>é»˜è®¤è¿è¡Œåœ¨5173ç«¯å£ä¸Š</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/179713c9ad2747c68f5f3260babc4711~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=MgU7AdeW%2FFwyfgdOyzBx9q7Ji1w%3D" alt="6.png" width="70%" loading="lazy"/>
<p>çœ‹çœ‹æµè§ˆå™¨çš„æ•ˆæœï¼Œå‘ç°äº†ä¸€ä¸ªå°bug</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cab0ec12a6c94b788aff68af0d64e601~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=hFRFBkBGphRGmAtvrCYljI3Yaiw%3D" alt="7.png" width="70%" loading="lazy"/>
<h3 data-id="heading-7">5. å‘ŠçŸ¥ä¿®å¤antdçš„å±æ€§å¼ƒç”¨çš„bug</h3>
<p>è¿™é‡Œå¯ä»¥æˆªå›¾ï¼Œæˆ–è€…æ–‡å­—è¾“å…¥ï¼ŒæŠŠæµè§ˆå™¨çš„bugç²˜è´´ï¼Œå‘ŠçŸ¥Traeï¼Œå¦‚ä¸‹</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c89aac2bcd649c087755d556abf6801~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=dd%2B9mfUSbcoyT8FZsYOiG%2FVh5xQ%3D" alt="8.png" width="70%" loading="lazy"/>
<p>ç„¶åï¼ŒTraeä¼šè¿›è¡Œæ€è€ƒï¼Œå¹¶å®šä½åˆ°é—®é¢˜ä»£ç ï¼Œè‡ªåŠ¨ä¿®å¤</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e148f4fc6a77419d95bb1e21b63ce63a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=0tUhUZCeAF7rMMEnimxG%2BZkpIsU%3D" alt="9.png" width="70%" loading="lazy"/>
<p>è¿™æ ·çš„è¯ï¼ŒåŸºæœ¬çš„æ ·å­å°±å‡ºæ¥äº†ï¼Œæ¥ä¸‹æ¥ï¼Œéœ€è¦æˆ‘è¿›è¡Œäººå·¥ä»‹å…¥</p>
<h3 data-id="heading-8">6. è§†é¢‘æå–æ–‡å­—ï¼ŒæŠ€æœ¯æ‹†è§£</h3>
<p>è§†é¢‘æå–æ–‡å­—ï¼Œåˆ†ä¸ºè¿™å‡ ä¸ªæ­¥éª¤</p>
<ol>
<li>æŠŠè§†é¢‘ä¸­çš„éŸ³é¢‘å‰¥ç¦»å‡ºæ¥â€”â€”ä½¿ç”¨fluent-ffmpegè¿™ä¸ªåŒ…</li>
<li>æŠŠéŸ³é¢‘è½¬æˆæ–‡å­—â€”â€”ä½¿ç”¨whisper-nodeè¿™ä¸ªåŒ…</li>
</ol>
<p>fluent-ffmpegéœ€è¦ä¸‹è½½ffmepgè¿™ä¸ªå·¥å…·çš„æœ¬åœ°</p>
<p>whisper-nodeä¸‹è½½tinyå¾®å°ç‰ˆæ¨¡å‹å°±è¡Œäº†</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦ Windows å¹³å°ï¼Œä¸‹è½½ffmepg</p>
<p>å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2FNatsuago%2Farticle%2Fdetails%2F143231558" target="_blank" title="https://blog.csdn.net/Natsuago/article/details/143231558" ref="nofollow noopener noreferrer">blog.csdn.net/Natsuago/arâ€¦</a></p>
<p>æœ€ç»ˆï¼Œç¬”è€…æŠŠffmpegå®‰è£…å¥½äº†ï¼Œå¦‚ä¸‹</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92c18abc08ca43748988a5bef7cca78f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=lkUwGltKzVgczRl%2BTG6SFNDXBPI%3D" alt="10.png" width="70%" loading="lazy"/>
<h3 data-id="heading-9">7. å‘ç°è¿˜å¾—å†™åç«¯</h3>
<p>fluent-ffmpegå’Œwhisper-nodeéœ€è¦åç«¯æœåŠ¡ï¼Œæ‰æ–¹ä¾¿è¿è¡Œï¼Œæ‰€ä»¥ï¼Œæˆ‘å’ŒTraeæ²Ÿé€šåï¼Œå®ƒåˆå¸®æˆ‘ç»§ç»­åˆ›å»ºåç«¯ä»£ç </p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6810094991f84cbc9163d23a75b12a73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=d8GJ%2BCbXvVBtQzAYchRUF8mqTWQ%3D" alt="11.png" width="70%" loading="lazy"/>
<h3 data-id="heading-10">8. é’ˆå¯¹äºé«˜é£é™©çš„å‘½ä»¤ä¼šæš‚åœå¹¶æç¤ºç”¨æˆ·</h3>
<p>æ¯”å¦‚åˆ é™¤æ–‡ä»¶æ“ä½œï¼ŒTraeä¼šåœä¸‹æ¥soloï¼Œç„¶åè¯¢é—®ç”¨æˆ·æ˜¯å¦è¿™æ ·æ“ä½œï¼Œè¿™æ ·è¿˜æ˜¯ä¸é”™çš„ï¼Œé˜²æ­¢AIç¼–ç¨‹è¯¯åˆ ä¸€äº›é‡è¦çš„æ–‡ä»¶</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf311a5ff6f04fa2a9a4930dfbd55a32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=rdy5hpHgp9Q3Z6xKEf%2Foy2cTtjU%3D" alt="12.png" width="70%" loading="lazy"/>
<h3 data-id="heading-11">9. è‹¥æ˜¯æ–¹å‘é”™è¯¯ï¼Œå‘ŠçŸ¥å¯çº æ­£</h3>
<ul>
<li>å®é™…ä¸Šï¼Œæ¶‰åŠåˆ°è§†é¢‘è½¬æ–‡æœ¬çš„åŠŸèƒ½ï¼Œè¿˜æ˜¯pythonç”Ÿæ€æ›´åŠ åˆé€‚</li>
<li>ç¬”è€…ä¸€å¼€å§‹ï¼Œè®©å…¶ä½¿ç”¨nodejsç”Ÿæ€å†™åç«¯ï¼Œè€Œåï¼Œsoloä¹Ÿå‘ç°äº†å¹¶æ¨èæ”¹æˆpythonç”Ÿæ€</li>
<li>ç¬”è€…ç‚¹å‡»åŒæ„ï¼Œé€‰æ‹©è®©å…¶æŠŠåç«¯ä»£ç æ”¹æˆpythonç”Ÿæ€</li>
<li>ç„¶åtraeä¹Ÿå¾ˆæ¸…æ™°åœ°ç†è§£äº†éœ€æ±‚</li>
<li>è¿›è¡Œäº†é‡æ„</li>
<li>é‡æ„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¹Ÿä¼šå‡ºç°ä¸€äº›æŠ¥é”™ï¼Œä¹Ÿéœ€è¦äººå·¥ä»‹å…¥ï¼Œä½†æ˜¯è¿™å¹¶ä¸Traeçš„é—®é¢˜ï¼Œè€Œæ˜¯æ‰€æœ‰AIç¼–ç¨‹çš„é—®é¢˜</li>
</ul>
<p><strong>å’Œäººæ²Ÿé€šï¼Œæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå’ŒAIæ²Ÿé€šä¹Ÿä¼šæœ‰</strong></p>
<p><strong>æœ‰æ—¶å€™ï¼Œé”…ä¸åœ¨AIï¼Œè€Œåœ¨æˆ‘ä»¬ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ¸…æ™°åœ°è¡¨è¾¾æ˜ç™½éœ€æ±‚</strong></p>
<h3 data-id="heading-12">10. æ¥å›soloæœ€ç»ˆå¾—åˆ°ç»“æœæˆå“</h3>
<p>åœ¨æ¥å›çš„soloäº¤æµä¸­ï¼Œæœ€ç»ˆï¼Œå®ç°äº†ç¬”è€…æƒ³è¦çš„æ•ˆæœ</p>
<h2 data-id="heading-13">å·¥å…·æˆå“</h2>
<h3 data-id="heading-14">æŠ€æœ¯æ ˆä»‹ç»</h3>
<p>æ³¨æ„ï¼Œä»¥ä¸‹è¿™æ€»ç»“æ–‡æ¡£ï¼Œä¹Ÿæ˜¯soloå‡ºæ¥ï¼Œæˆ‘å†ä¿®æ”¹çš„</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d10c89a9b6ab470292893ffa86d60af3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=HtJLMNX1uPZKvbj0jpKQlTujXdE%3D" alt="ä»‹ç»å›¾ç‰‡.png" width="70%" loading="lazy"/>
<h3 data-id="heading-15">æ•ˆæœå›¾</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4c7eade29f7422ebab5bf22c2ffd1c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rC05YaX5rC05a2a:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766158501&amp;x-signature=oMFpx31Xw1DuCR0VH1T9%2BdX0WIk%3D" alt="æ•ˆæœå›¾.gif" loading="lazy"/></p>
<h3 data-id="heading-16">çº¿ä¸Šåœ°å€ï¼ˆä¸åŒ…å«åç«¯ï¼‰</h3>
<p>åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fashuai.site%3A24680%2F" target="_blank" title="https://ashuai.site:24680/" ref="nofollow noopener noreferrer">ashuai.site:24680/</a></p>
<p>æœåŠ¡å™¨å†…å­˜å®¹é‡åƒç´§ï¼Œå°±ä¸éƒ¨ç½²åç«¯äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±æ‹‰å–ä»£ç ï¼Œè‡ªå·±æœ¬æœºè·‘èµ·æ¥</p>
<h3 data-id="heading-17">githubä»“åº“ä»£ç </h3>
<p>åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshuirongshuifu%2Fvideo2txt" target="_blank" title="https://github.com/shuirongshuifu/video2txt" ref="nofollow noopener noreferrer">github.com/shuirongshuâ€¦</a></p>
<h3 data-id="heading-18">æ³¨æ„ï¼Œè‹¥æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œé«˜å¯ç”¨ï¼Œç¬”è€…è¿˜æ˜¯å»ºè®®ï¼Œä½¿ç”¨äº‘æœåŠ¡å•†çš„ä»˜è´¹æ¥å£</h3>
<p>åŸå› ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p>
<p>1.å¼€æºæ¨¡å‹çš„è¯†åˆ«å‡†ç¡®ç‡ã€2.æœåŠ¡å™¨ç»´æŠ¤æˆæœ¬</p>
<h2 data-id="heading-19">æ€»ç»“Trae SOLOæ¨¡å¼</h2>
<ul>
<li><strong>Trae SOLOæ¨¡å¼å°±æ˜¯æˆ‘ä»¬å¼€å‘è€…åŒ–èº«é¡¹ç›®ç»ç†è§’è‰²</strong></li>
<li><strong>Trea SOLOåŒ–èº«äº§å“ç»ç†å†™æ–‡æ¡£ã€åŠ ç¨‹åºå‘˜å†™ä»£ç è§’è‰²</strong></li>
<li><strong>æˆ‘ä»¬å¼€å‘è€…ï¼Œä¸»è¦æ˜¯è¿›è¡ŒæŠŠæ§ã€ç®¡æ§ã€è°ƒæ•´</strong></li>
<li><strong>ä»è€Œè®©å¼€å‘å‡ºæ¥çš„é¡¹ç›®ï¼Œç¬¦åˆé¢„æœŸ</strong></li>
</ul>
<p>æ•´ä½“ç”¨ä¸‹æ¥ï¼Œè¿˜æ˜¯èƒ½å¤Ÿæå‡å¾ˆå¤§çš„å¼€å‘æ•ˆç‡çš„</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç†è§£ Proxy åŸç†åŠå¦‚ä½•æ‹¦æˆª Mapã€Set ç­‰é›†åˆæ–¹æ³•è°ƒç”¨å®ç°è‡ªå®šä¹‰æ‹¦æˆªå’Œæ—¥å¿—â€”â€”å«ç¤ºä¾‹ä»£ç è§£æ]]></title>    <link>https://juejin.cn/post/7582776967818395648</link>    <guid>https://juejin.cn/post/7582776967818395648</guid>    <pubDate>2025-12-12T15:45:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582776967818395648" data-draft-id="7582783931163508771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç†è§£ Proxy åŸç†åŠå¦‚ä½•æ‹¦æˆª Mapã€Set ç­‰é›†åˆæ–¹æ³•è°ƒç”¨å®ç°è‡ªå®šä¹‰æ‹¦æˆªå’Œæ—¥å¿—â€”â€”å«ç¤ºä¾‹ä»£ç è§£æ"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-12T15:45:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¦‚æœä½ å¥½"/> <meta itemprop="url" content="https://juejin.cn/user/2272012281328215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç†è§£ Proxy åŸç†åŠå¦‚ä½•æ‹¦æˆª Mapã€Set ç­‰é›†åˆæ–¹æ³•è°ƒç”¨å®ç°è‡ªå®šä¹‰æ‹¦æˆªå’Œæ—¥å¿—â€”â€”å«ç¤ºä¾‹ä»£ç è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272012281328215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¦‚æœä½ å¥½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T15:45:04.000Z" title="Fri Dec 12 2025 15:45:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å…ˆç†è§£ Proxy çš„æ ¸å¿ƒæ€æƒ³</h2>
<p>Proxy å°±åƒä¸€ä¸ªâ€œæ‹¦æˆªå™¨â€ï¼Œå®ƒå¯ä»¥â€œç›‘å¬â€ä¸€ä¸ªå¯¹è±¡çš„æ“ä½œï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>è®¿é—®å¯¹è±¡çš„å±æ€§ï¼ˆè¯»å–ï¼‰ â†’ è§¦å‘ <code>get</code> æ‹¦æˆªå™¨</li>
<li>ç»™å¯¹è±¡çš„å±æ€§èµ‹å€¼ï¼ˆå†™å…¥ï¼‰ â†’ è§¦å‘ <code>set</code> æ‹¦æˆªå™¨</li>
<li>è°ƒç”¨å¯¹è±¡çš„æ–¹æ³• â†’ å…¶å®æ˜¯å…ˆè®¿é—®æ–¹æ³•ï¼ˆè§¦å‘ <code>get</code>ï¼‰ï¼Œå†æ‰§è¡Œå®ƒ</li>
</ul>
<hr/>
<h2 data-id="heading-1">ä½†é›†åˆç±»å‹ï¼ˆMapã€Set ç­‰ï¼‰ä¸ç›´æ¥ç”¨å±æ€§èµ‹å€¼æ¥å†™å…¥æ•°æ®</h2>
<ul>
<li>Map å†™å…¥æ•°æ®æ˜¯è°ƒç”¨å®ƒçš„ <code>set(key, value)</code> æ–¹æ³•</li>
<li>Set å†™å…¥æ•°æ®æ˜¯è°ƒç”¨å®ƒçš„ <code>add(value)</code> æ–¹æ³•</li>
<li>è¯»å–æ•°æ®æ˜¯è°ƒç”¨ Map çš„ <code>get(key)</code> æˆ– Set çš„ <code>has(value)</code> æ–¹æ³•</li>
</ul>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³æ‹¦æˆªâ€œå†™å…¥â€æ“ä½œï¼Œå°±è¦æ‹¦æˆªè¿™äº›æ–¹æ³•çš„è°ƒç”¨ã€‚</p>
<hr/>
<h2 data-id="heading-2">Proxy æ€ä¹ˆæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Ÿ</h2>
<ul>
<li>å½“ä½ è®¿é—® <code>proxyMap.set</code>ï¼Œä¼šè§¦å‘ Proxy çš„ <code>get</code> æ‹¦æˆªå™¨ï¼Œå‘Šè¯‰ä½ è®¿é—®äº† <code>set</code> æ–¹æ³•ã€‚</li>
<li>è¿™æ—¶æˆ‘ä»¬è¿”å›ä¸€ä¸ªâ€œåŒ…è£…å‡½æ•°â€ï¼Œè¿™ä¸ªå‡½æ•°å†…éƒ¨å¯ä»¥æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼ˆæ¯”å¦‚æ‰“å°æ—¥å¿—ï¼‰ï¼Œç„¶åå†è°ƒç”¨åŸå§‹çš„ <code>set</code> æ–¹æ³•ã€‚</li>
<li>è¿™æ ·å°±å®ç°äº†â€œæ‹¦æˆªå†™å…¥æ“ä½œâ€ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-3">å…·ä½“ç¤ºä¾‹ï¼šæ‹¦æˆª Map çš„è¯»å–å’Œå†™å…¥</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop, receiver</span>) {
    <span class="hljs-comment">// è®¿é—®å±æ€§æˆ–æ–¹æ³•æ—¶è§¦å‘</span>
    <span class="hljs-keyword">const</span> origMethod = target[prop];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> origMethod === <span class="hljs-string">'function'</span>) {
      <span class="hljs-comment">// å¦‚æœè®¿é—®çš„æ˜¯æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªåŒ…è£…å‡½æ•°</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'set'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å†™å…¥æ“ä½œï¼šset(<span class="hljs-subst">${args[<span class="hljs-number">0</span>]}</span>, <span class="hljs-subst">${args[<span class="hljs-number">1</span>]}</span>)`</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'get'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è¯»å–æ“ä½œï¼šget(<span class="hljs-subst">${args[<span class="hljs-number">0</span>]}</span>)`</span>);
        }
        <span class="hljs-comment">// è°ƒç”¨åŸå§‹æ–¹æ³•</span>
        <span class="hljs-keyword">return</span> origMethod.<span class="hljs-title function_">apply</span>(target, args);
      };
    }
    <span class="hljs-comment">// è®¿é—®æ™®é€šå±æ€§ï¼Œç›´æ¥è¿”å›</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
  }
};

<span class="hljs-keyword">const</span> proxyMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(map, handler);

proxyMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'CodeMoss'</span>);  <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šå†™å…¥æ“ä½œï¼šset(name, CodeMoss)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxyMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">'name'</span>)); <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šè¯»å–æ“ä½œï¼šget(name)</span>
                                   <span class="hljs-comment">// è¾“å‡ºï¼šCodeMoss</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">å¯ä»¥æŠŠå®ƒç†è§£æˆï¼š</h2>
<ul>
<li>è®¿é—® <code>proxyMap.set</code> â†’ Proxy æ‹¦æˆªï¼Œè¿”å›ä¸€ä¸ªâ€œå¸¦æ—¥å¿—â€çš„å‡½æ•°</li>
<li>è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œå…ˆæ‰“å°æ—¥å¿—ï¼Œå†è°ƒç”¨çœŸæ­£çš„ <code>map.set</code></li>
</ul>
<hr/>
<h2 data-id="heading-5">Set ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯å†™å…¥æ–¹æ³•å« <code>add</code>ï¼Œè¯»å–æ–¹æ³•å« <code>has</code></h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();

<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop, receiver</span>) {
    <span class="hljs-keyword">const</span> origMethod = target[prop];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> origMethod === <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'add'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å†™å…¥æ“ä½œï¼šadd(<span class="hljs-subst">${args[<span class="hljs-number">0</span>]}</span>)`</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'has'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è¯»å–æ“ä½œï¼šhas(<span class="hljs-subst">${args[<span class="hljs-number">0</span>]}</span>)`</span>);
        }
        <span class="hljs-keyword">return</span> origMethod.<span class="hljs-title function_">apply</span>(target, args);
      };
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
  }
};

<span class="hljs-keyword">const</span> proxySet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(set, handler);

proxySet.<span class="hljs-title function_">add</span>(<span class="hljs-number">123</span>);  <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šå†™å…¥æ“ä½œï¼šadd(123)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxySet.<span class="hljs-title function_">has</span>(<span class="hljs-number">123</span>)); <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šè¯»å–æ“ä½œï¼šhas(123)</span>
                               <span class="hljs-comment">// è¾“å‡ºï¼štrue</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">WeakMap å’Œ WeakSet ä¹Ÿä¸€æ ·ï¼Œåªæ˜¯å®ƒä»¬çš„é”®æˆ–å€¼å¿…é¡»æ˜¯å¯¹è±¡ï¼Œä¸”ä¸èƒ½éå†</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> weakMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop, receiver</span>) {
    <span class="hljs-keyword">const</span> origMethod = target[prop];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> origMethod === <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'set'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WeakMap å†™å…¥æ“ä½œï¼Œé”®:'</span>, args[<span class="hljs-number">0</span>], <span class="hljs-string">'å€¼:'</span>, args[<span class="hljs-number">1</span>]);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'get'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WeakMap è¯»å–æ“ä½œï¼Œé”®:'</span>, args[<span class="hljs-number">0</span>]);
        }
        <span class="hljs-keyword">return</span> origMethod.<span class="hljs-title function_">apply</span>(target, args);
      };
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
  }
};

<span class="hljs-keyword">const</span> proxyWeakMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(weakMap, handler);

<span class="hljs-keyword">const</span> objKey = {};
proxyWeakMap.<span class="hljs-title function_">set</span>(objKey, <span class="hljs-string">'secret'</span>);  <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šWeakMap å†™å…¥æ“ä½œï¼Œé”®: {} å€¼: secret</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxyWeakMap.<span class="hljs-title function_">get</span>(objKey)); <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šWeakMap è¯»å–æ“ä½œï¼Œé”®: {}</span>
                                       <span class="hljs-comment">// è¾“å‡ºï¼šsecret</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">æ€»ç»“</h2>
<ul>
<li>Proxy çš„ <code>get</code> æ‹¦æˆªå™¨æ‹¦æˆªçš„æ˜¯â€œå±æ€§è®¿é—®â€ï¼Œæ–¹æ³•è°ƒç”¨æ˜¯å…ˆè®¿é—®æ–¹æ³•å†æ‰§è¡Œã€‚</li>
<li>é›†åˆçš„å†™å…¥å’Œè¯»å–éƒ½æ˜¯é€šè¿‡è°ƒç”¨æ–¹æ³•å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹¦æˆªæ–¹æ³•è®¿é—®ï¼Œè¿”å›åŒ…è£…å‡½æ•°ã€‚</li>
<li>åŒ…è£…å‡½æ•°é‡Œå¯ä»¥æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼ˆæ—¥å¿—ã€æƒé™ç­‰ï¼‰ï¼Œç„¶åè°ƒç”¨åŸå§‹æ–¹æ³•å®Œæˆæ“ä½œã€‚</li>
</ul>
<hr/>
<p>æŠŠ const objKey = {}; æ¢æˆ mapâ€ï¼ŒæŠŠ WeakMap çš„é”®ä»ä¸€ä¸ªæ™®é€šå¯¹è±¡ <code>{}</code> æ¢æˆä¸€ä¸ª Map å¯¹è±¡ã€‚</p>
<hr/>
<h3 data-id="heading-8">å…ˆè¯´æ˜ä¸€ç‚¹ï¼š</h3>
<p>WeakMap çš„é”®å¿…é¡»æ˜¯<strong>å¯¹è±¡</strong>ï¼Œè€Œ Map æœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå®ƒæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°å®ä¾‹ï¼‰ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ˜¯å¯ä»¥ä½œä¸º WeakMap çš„é”®çš„ã€‚</p>
<hr/>
<h3 data-id="heading-9">å¯ä»¥è¿™æ ·å†™ï¼š</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> weakMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop, receiver</span>) {
    <span class="hljs-keyword">const</span> origMethod = target[prop];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> origMethod === <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
        <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'set'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WeakMap å†™å…¥æ“ä½œï¼Œé”®:'</span>, args[<span class="hljs-number">0</span>], <span class="hljs-string">'å€¼:'</span>, args[<span class="hljs-number">1</span>]);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'get'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WeakMap è¯»å–æ“ä½œï¼Œé”®:'</span>, args[<span class="hljs-number">0</span>]);
        }
        <span class="hljs-keyword">return</span> origMethod.<span class="hljs-title function_">apply</span>(target, args);
      };
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
  }
};

<span class="hljs-keyword">const</span> proxyWeakMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(weakMap, handler);

<span class="hljs-comment">// è¿™é‡Œç”¨ Map ä½œä¸ºé”®</span>
<span class="hljs-keyword">const</span> mapKey = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

proxyWeakMap.<span class="hljs-title function_">set</span>(mapKey, <span class="hljs-string">'secret'</span>);  <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šWeakMap å†™å…¥æ“ä½œï¼Œé”®: Map {} å€¼: secret</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxyWeakMap.<span class="hljs-title function_">get</span>(mapKey)); <span class="hljs-comment">// æ§åˆ¶å°è¾“å‡ºï¼šWeakMap è¯»å–æ“ä½œï¼Œé”®: Map {}</span>
                                       <span class="hljs-comment">// è¾“å‡ºï¼šsecret</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">è§£é‡Šï¼š</h3>
<ul>
<li><code>mapKey</code> æ˜¯ä¸€ä¸ª Map å®ä¾‹ï¼Œå±äºå¯¹è±¡ç±»å‹ï¼Œå¯ä»¥ä½œä¸º WeakMap çš„é”®ã€‚</li>
<li>WeakMap å…è®¸ä»»ä½•å¯¹è±¡ä½œä¸ºé”®ï¼ŒåŒ…æ‹¬æ™®é€šå¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ã€ç”šè‡³ Mapã€Set ç­‰å®ä¾‹ã€‚</li>
<li>ç”¨ Map ä½œä¸ºé”®ï¼Œå®Œå…¨æ²¡é—®é¢˜ã€‚</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€èŠ‚ç‚¹ã€‘[Adjustment-InvertColorsèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨]]></title>    <link>https://juejin.cn/post/7582854603060183082</link>    <guid>https://juejin.cn/post/7582854603060183082</guid>    <pubDate>2025-12-13T03:26:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582854603060183082" data-draft-id="7582813955212656681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€èŠ‚ç‚¹ã€‘[Adjustment-InvertColorsèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨"/> <meta itemprop="keywords" content="æ¸¸æˆå¼€å‘,å›¾å½¢å­¦,Unity3D"/> <meta itemprop="datePublished" content="2025-12-13T03:26:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€èŠ‚ç‚¹ã€‘[Adjustment-InvertColorsèŠ‚ç‚¹]åŸç†è§£æä¸å®é™…åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:26:32.000Z" title="Sat Dec 13 2025 03:26:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€Unity Shader Graph ä½¿ç”¨ä¸ç‰¹æ•ˆå®ç°ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong></p>
</blockquote>
<p>Unity URP Shader Graphä¸­çš„Invert ColorsèŠ‚ç‚¹æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„é¢œè‰²å¤„ç†å·¥å…·ï¼Œèƒ½å¤ŸåŸºäºæ¯ä¸ªé€šé“å•ç‹¬åè½¬è¾“å…¥é¢œè‰²çš„æ•°å€¼ã€‚å…¶è®¾è®¡ç†å¿µæ˜¯é€šè¿‡æ•°å­¦è¿ç®—å°†é¢œè‰²å€¼åœ¨å…¶å–å€¼èŒƒå›´å†…ç¿»è½¬ï¼Œä»¥åˆ›é€ å¤šæ ·çš„è§†è§‰æ•ˆæœå’Œè‰ºæœ¯è¡¨ç°ã€‚åœ¨è®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼Œé¢œè‰²åè½¬æ˜¯ä¸€é¡¹åŸºç¡€ä¸”é‡è¦çš„å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œå¯ä¸ºæ¸¸æˆå¼€å‘è€…æä¾›ä¸°å¯Œçš„è§†è§‰è¡¨ç°æ‰‹æ®µã€‚</p>
<p>è¯¥èŠ‚ç‚¹å‡è®¾æ‰€æœ‰è¾“å…¥å€¼å‡å¤„äº0åˆ°1çš„æ ‡å‡†èŒƒå›´å†…ï¼Œè¿™æ˜¯è®¡ç®—æœºå›¾å½¢å­¦ä¸­é¢œè‰²å€¼çš„æ ‡å‡†è¡¨ç¤ºæ–¹å¼ã€‚åœ¨Unityçš„Shader Graphç¯å¢ƒä¸­ï¼Œé¢œè‰²é€šé“é€šå¸¸ä»¥æµ®ç‚¹æ•°è¡¨ç¤ºï¼Œå…¶ä¸­0è¡¨ç¤ºè¯¥é¢œè‰²çš„æœ€ä½å¼ºåº¦ï¼ˆå³å®Œå…¨æ— è¯¥é¢œè‰²ï¼‰ï¼Œ1è¡¨ç¤ºè¯¥é¢œè‰²çš„æœ€é«˜å¼ºåº¦ï¼ˆå³å®Œå…¨é¥±å’Œï¼‰ã€‚è¿™ç§æ ‡å‡†åŒ–å¤„ç†ä½¿é¢œè‰²è®¡ç®—æ›´åŠ ç»Ÿä¸€å’Œå¯é¢„æµ‹ã€‚</p>
<p>é¢œè‰²åè½¬çš„æ ¸å¿ƒåŸç†æ˜¯ä»åŸºå‡†å€¼ä¸­å‡å»å½“å‰é¢œè‰²å€¼ï¼Œä»è€Œå¾—åˆ°ç›¸åçš„é¢œè‰²æ•ˆæœã€‚åœ¨RGBé¢œè‰²æ¨¡å‹ä¸­ï¼Œè¿™ç›¸å½“äºè®¡ç®—æ¯ä¸ªé¢œè‰²é€šé“çš„â€œè¡¥è‰²â€ã€‚ä¾‹å¦‚ï¼Œçº¯çº¢è‰²ï¼ˆ1,0,0ï¼‰åè½¬åä¼šå˜ä¸ºé’è‰²ï¼ˆ0,1,1ï¼‰ï¼Œçº¯ç»¿è‰²ï¼ˆ0,1,0ï¼‰ä¼šå˜ä¸ºå“çº¢è‰²ï¼ˆ1,0,1ï¼‰ï¼Œè€Œçº¯è“è‰²ï¼ˆ0,0,1ï¼‰åˆ™ä¼šå˜ä¸ºé»„è‰²ï¼ˆ1,1,0ï¼‰ã€‚è¿™ç§é¢œè‰²è½¬æ¢å…³ç³»åŸºäºè‰²å½©ç†è®ºä¸­çš„äº’è¡¥è‰²æ¦‚å¿µï¼Œä¸ºæ¸¸æˆè§†è§‰æ•ˆæœè®¾è®¡æä¾›äº†ç†è®ºåŸºç¡€ã€‚</p>
<h2 data-id="heading-0">ç«¯å£è¯¦è§£</h2>
<p><img src="https://docs.unity.cn/cn/Packages-cn/com.unity.shadergraph@14.0/manual/images/InvertColorsNodeThumb.png" alt="img" loading="lazy"/>
è¾“å…¥ç«¯å£æ˜¯èŠ‚ç‚¹æ¥æ”¶æ•°æ®çš„æ¥å£ï¼ŒInvert ColorsèŠ‚ç‚¹çš„è¾“å…¥ç«¯å£è®¾è®¡ä½“ç°äº†å…¶çµæ´»æ€§å’Œé€‚åº”æ€§ï¼š</p>
<p><strong>è¾“å…¥ç«¯å£ï¼ˆInï¼‰</strong></p>
<ul>
<li>æ–¹å‘ï¼šè¾“å…¥</li>
<li>ç±»å‹ï¼šåŠ¨æ€çŸ¢é‡</li>
<li>ç»‘å®šï¼šæ— </li>
<li>åŠŸèƒ½æè¿°ï¼šè¯¥ç«¯å£æ¥æ”¶å¾…å¤„ç†çš„é¢œè‰²æˆ–çŸ¢é‡æ•°æ®ã€‚ä½œä¸ºåŠ¨æ€çŸ¢é‡ç±»å‹ï¼Œå®ƒå¯ä»¥æ¥å—ä¸åŒç»´åº¦çš„è¾“å…¥æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
<ul>
<li>æµ®ç‚¹æ•°ï¼ˆå•é€šé“ï¼‰</li>
<li>äºŒç»´çŸ¢é‡ï¼ˆä¸¤ä¸ªé€šé“ï¼‰</li>
<li>ä¸‰ç»´çŸ¢é‡ï¼ˆRGBé¢œè‰²ï¼‰</li>
<li>å››ç»´çŸ¢é‡ï¼ˆRGBAé¢œè‰²ï¼‰</li>
</ul>
</li>
</ul>
<p>è¿™ç§åŠ¨æ€ç‰¹æ€§ä½¿èŠ‚ç‚¹èƒ½å¤Ÿé€‚åº”å„ç§ä½¿ç”¨åœºæ™¯ï¼Œä»ç®€å•çš„å•å€¼åè½¬åˆ°å¤æ‚çš„å¤šé€šé“é¢œè‰²å¤„ç†å‡å¯èƒœä»»ã€‚</p>
<p><strong>è¾“å‡ºç«¯å£ï¼ˆOutï¼‰</strong></p>
<ul>
<li>æ–¹å‘ï¼šè¾“å‡º</li>
<li>ç±»å‹ï¼šåŠ¨æ€çŸ¢é‡</li>
<li>ç»‘å®šï¼šæ— </li>
<li>åŠŸèƒ½æè¿°ï¼šè¾“å‡ºç»è¿‡é¢œè‰²åè½¬å¤„ç†åçš„ç»“æœã€‚è¾“å‡ºæ•°æ®çš„ç»´åº¦ä¸è¾“å…¥æ•°æ®ä¿æŒä¸€è‡´ï¼Œç¡®ä¿æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§ã€‚è¾“å‡ºå€¼çš„è®¡ç®—åŸºäºæ¯ä¸ªå¯ç”¨åè½¬çš„é€šé“å•ç‹¬è¿›è¡Œï¼Œæœªå¯ç”¨çš„é€šé“åˆ™ä¿æŒåŸå€¼ä¸å˜ã€‚</li>
</ul>
<h2 data-id="heading-1">æ§ä»¶ç³»ç»Ÿ</h2>
<p>Invert ColorsèŠ‚ç‚¹çš„æ§ä»¶ç³»ç»Ÿæä¾›äº†ç²¾ç»†çš„é€šé“æ§åˆ¶èƒ½åŠ›ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæ ¹æ®å…·ä½“éœ€æ±‚å®šåˆ¶åè½¬æ•ˆæœï¼š</p>
<p><strong>çº¢è‰²é€šé“æ§åˆ¶ï¼ˆRedï¼‰</strong></p>
<ul>
<li>ç±»å‹ï¼šå¸ƒå°”å¼€å…³</li>
<li>é€‰é¡¹ï¼šTrueï¼ˆå¯ç”¨ï¼‰ã€Falseï¼ˆç¦ç”¨ï¼‰</li>
<li>åŠŸèƒ½è¯´æ˜ï¼šå½“è®¾ç½®ä¸ºtrueæ—¶ï¼Œå¯¹è¾“å…¥å€¼çš„çº¢è‰²é€šé“è¿›è¡Œåè½¬å¤„ç†ã€‚åè½¬è®¡ç®—é‡‡ç”¨æ ‡å‡†çš„é¢œè‰²åè½¬ç®—æ³•ï¼šOut.r = 1 - In.rã€‚è¿™ä¸€ç®€å•çš„æ•°å­¦è¿ç®—èƒ½å¤Ÿäº§ç”Ÿæ˜¾è‘—çš„è§†è§‰æ•ˆæœï¼Œçº¢è‰²è¶Šå¼ºçš„åŒºåŸŸåœ¨åè½¬åé’è‰²è¶Šæ˜æ˜¾ã€‚</li>
</ul>
<p><strong>ç»¿è‰²é€šé“æ§åˆ¶ï¼ˆGreenï¼‰</strong></p>
<ul>
<li>ç±»å‹ï¼šå¸ƒå°”å¼€å…³</li>
<li>é€‰é¡¹ï¼šTrueï¼ˆå¯ç”¨ï¼‰ã€Falseï¼ˆç¦ç”¨ï¼‰</li>
<li>åŠŸèƒ½ç‰¹ç‚¹ï¼šè¯¥æ§ä»¶å…·æœ‰æ™ºèƒ½çš„ç»´åº¦æ„ŸçŸ¥åŠŸèƒ½ã€‚å½“è¾“å…¥çŸ¢é‡ç»´åº¦å°äº2æ—¶ï¼ˆå¦‚å•é€šé“æ ‡é‡ï¼‰ï¼Œç»¿è‰²é€šé“æ§ä»¶ä¼šè‡ªåŠ¨ç¦ç”¨ï¼Œå› ä¸ºæ­¤æ—¶ä¸å­˜åœ¨ç»¿è‰²é€šé“å¯ä¾›æ“ä½œã€‚è¿™ç§è®¾è®¡é¿å…äº†æ— æ•ˆæ“ä½œï¼Œæå‡äº†èŠ‚ç‚¹çš„ç”¨æˆ·å‹å¥½æ€§ã€‚</li>
</ul>
<p><strong>è“è‰²é€šé“æ§åˆ¶ï¼ˆBlueï¼‰</strong></p>
<ul>
<li>ç±»å‹ï¼šå¸ƒå°”å¼€å…³</li>
<li>é€‰é¡¹ï¼šTrueï¼ˆå¯ç”¨ï¼‰ã€Falseï¼ˆç¦ç”¨ï¼‰</li>
<li>æ™ºèƒ½æ£€æµ‹ï¼šä¸ç»¿è‰²é€šé“ç±»ä¼¼ï¼Œè“è‰²é€šé“æ§ä»¶ä¹Ÿä¼šæ ¹æ®è¾“å…¥æ•°æ®çš„ç»´åº¦è‡ªåŠ¨è°ƒæ•´å¯ç”¨æ€§ã€‚åªæœ‰å½“è¾“å…¥çŸ¢é‡åŒ…å«è‡³å°‘ä¸‰ä¸ªé€šé“æ—¶ï¼Œè“è‰²é€šé“æ§ä»¶æ‰å¤„äºå¯æ“ä½œçŠ¶æ€ã€‚è¿™ç§ç»´åº¦æ„ŸçŸ¥æœºåˆ¶ç¡®ä¿äº†æ“ä½œçš„åˆç†æ€§å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li>
</ul>
<p><strong>Alphaé€šé“æ§åˆ¶ï¼ˆAlphaï¼‰</strong></p>
<ul>
<li>ç±»å‹ï¼šå¸ƒå°”å¼€å…³</li>
<li>é€‰é¡¹ï¼šTrueï¼ˆå¯ç”¨ï¼‰ã€Falseï¼ˆç¦ç”¨ï¼‰</li>
<li>ç‰¹æ®ŠåŠŸèƒ½ï¼šAlphaé€šé“æ§åˆ¶ä¸“é—¨å¤„ç†é€æ˜åº¦ä¿¡æ¯çš„åè½¬ã€‚å½“è¾“å…¥æ•°æ®ä¸ºå››ç»´çŸ¢é‡æ—¶ï¼Œè¯¥æ§ä»¶å¯ç”¨ã€‚Alphaé€šé“åè½¬èƒ½å¤Ÿåˆ›é€ å‡ºç‹¬ç‰¹çš„é€æ˜åº¦æ•ˆæœï¼Œä¾‹å¦‚å°†å®Œå…¨ä¸é€æ˜çš„åŒºåŸŸå˜ä¸ºå®Œå…¨é€æ˜ï¼Œæˆ–åˆ›å»ºç‰¹æ®Šçš„é®ç½©æ•ˆæœã€‚</li>
</ul>
<h2 data-id="heading-2">æ•°å­¦åŸç†ä¸ç®—æ³•å®ç°</h2>
<p>Invert ColorsèŠ‚ç‚¹çš„æ ¸å¿ƒç®—æ³•åŸºäºå‘é‡è¿ç®—å’Œé€šé“åˆ†ç¦»å¤„ç†ã€‚å…¶æ•°å­¦è¡¨è¾¾å¼å¯åˆ†è§£ä¸ºï¼š</p>
<p>å¯¹äºæ¯ä¸ªé¢œè‰²é€šé“iï¼ˆi âˆˆ {r, g, b, a}ï¼‰ï¼Œåè½¬è®¡ç®—éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š Out.i = Control.i ? (1 - In.i) : In.i</p>
<p>å…¶ä¸­Control.iè¡¨ç¤ºå¯¹åº”é€šé“çš„å¸ƒå°”æ§åˆ¶å€¼ã€‚è¿™ç§æŒ‰é€šé“ç‹¬ç«‹å¤„ç†çš„æ–¹å¼æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œå…è®¸å¼€å‘è€…åˆ›å»ºå¤æ‚çš„åˆ†é€šé“åè½¬æ•ˆæœã€‚</p>
<p>åœ¨Shader Graphçš„åº•å±‚å®ç°ä¸­ï¼Œè¯¥èŠ‚ç‚¹ç”Ÿæˆç›¸åº”çš„HLSLä»£ç ã€‚èŠ‚ç‚¹å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªæ§åˆ¶å‘é‡_InvertColors_InvertColorsï¼Œè¯¥å‘é‡å­˜å‚¨äº†å„ä¸ªé€šé“çš„åè½¬çŠ¶æ€ã€‚å®é™…çš„é¢œè‰²åè½¬æ“ä½œåœ¨Unity_InvertColors_float4å‡½æ•°ä¸­å®Œæˆï¼Œè¯¥å‡½æ•°æ¥æ”¶è¾“å…¥é¢œè‰²ã€åè½¬æ§åˆ¶å‘é‡ï¼Œå¹¶è¾“å‡ºå¤„ç†åçš„é¢œè‰²å€¼ã€‚</p>
<h2 data-id="heading-3">å®é™…åº”ç”¨åœºæ™¯</h2>
<p><strong>æ¸¸æˆè§†è§‰æ•ˆæœ</strong></p>
<ul>
<li>ä¼¤å®³æ•ˆæœè¡¨ç°ï¼šå½“è§’è‰²å—åˆ°ä¼¤å®³æ—¶ï¼Œé€šè¿‡çŸ­æš‚çš„é¢œè‰²åè½¬åˆ›é€ è§†è§‰å†²å‡»</li>
<li>ç‰¹æ®ŠçŠ¶æ€æŒ‡ç¤ºï¼šç”¨äºè¡¨ç°è§’è‰²çš„ä¸­æ¯’ã€çœ©æ™•ã€é­”æ³•æ•ˆæœç­‰å¼‚å¸¸çŠ¶æ€</li>
<li>åœºæ™¯è½¬æ¢è¿‡æ¸¡ï¼šåœ¨åœºæ™¯åˆ‡æ¢æ—¶ä½¿ç”¨é¢œè‰²åè½¬ä½œä¸ºè½¬åœºæ•ˆæœ</li>
<li>è¶…è‡ªç„¶ç°è±¡æ¨¡æ‹Ÿï¼šè¡¨ç°å¹½çµã€å¹»å½±ã€å¼‚ä¸–ç•Œç­‰è¶…è‡ªç„¶è§†è§‰æ•ˆæœ</li>
</ul>
<p><strong>ç”¨æˆ·ç•Œé¢è®¾è®¡</strong></p>
<ul>
<li>æŒ‰é’®äº¤äº’åé¦ˆï¼šåœ¨æŒ‰é’®æŒ‰ä¸‹æ—¶ä½¿ç”¨éƒ¨åˆ†é€šé“åè½¬åˆ›é€ è§†è§‰åé¦ˆ</li>
<li>é«˜äº®æç¤ºæ•ˆæœï¼šé€šè¿‡é€‰æ‹©æ€§åè½¬çªå‡ºæ˜¾ç¤ºé‡è¦UIå…ƒç´ </li>
<li>ä¸»é¢˜åˆ‡æ¢è¿‡æ¸¡ï¼šåœ¨ä¸åŒç•Œé¢ä¸»é¢˜é—´åˆ‡æ¢æ—¶ä½¿ç”¨é¢œè‰²åè½¬å¹³æ»‘è¿‡æ¸¡</li>
<li>çŠ¶æ€æŒ‡ç¤ºå™¨ï¼šç”¨é¢œè‰²åè½¬è¡¨ç¤ºç³»ç»ŸçŠ¶æ€å˜åŒ–ï¼Œå¦‚ç”µé‡ä¸è¶³ã€ç½‘ç»œæ–­å¼€ç­‰</li>
</ul>
<p><strong>è‰ºæœ¯é£æ ¼åŒ–å¤„ç†</strong></p>
<ul>
<li>è´Ÿç‰‡æ•ˆæœåˆ›ä½œï¼šå®Œå…¨åè½¬æ‰€æœ‰é¢œè‰²é€šé“åˆ›å»ºç…§ç‰‡è´Ÿç‰‡æ•ˆæœ</li>
<li>è‰²è°ƒåˆ†ç¦»æŠ€æœ¯ï¼šç»“åˆå…¶ä»–ç€è‰²å™¨èŠ‚ç‚¹åˆ›å»ºå¤æ‚çš„è‰²å½©åˆ†ç¦»æ•ˆæœ</li>
<li>åŠ¨æ€è‰²å½©å¾ªç¯ï¼šé€šè¿‡åŠ¨ç”»æ§åˆ¶åè½¬å‚æ•°åˆ›å»ºæµåŠ¨çš„è‰²å½©æ•ˆæœ</li>
<li>æè´¨ç‰¹æ€§è¡¨ç°ï¼šç”¨äºå¼ºè°ƒç‰¹å®šæè´¨çš„åå°„ã€æŠ˜å°„ç­‰å…‰å­¦ç‰¹æ€§</li>
</ul>
<h2 data-id="heading-4">æ€§èƒ½åˆ†æä¸ä¼˜åŒ–å»ºè®®</h2>
<p>Invert ColorsèŠ‚ç‚¹åœ¨æ€§èƒ½æ–¹é¢çš„è¡¨ç°ä¸»è¦å–å†³äºä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š</p>
<p><strong>è®¡ç®—å¤æ‚åº¦åˆ†æ</strong></p>
<ul>
<li>å•ä¸ªé€šé“åè½¬æ“ä½œéœ€è¦ä¸€æ¬¡å‡æ³•è¿ç®—</li>
<li>å››é€šé“å®Œå…¨åè½¬å…±éœ€è¦å››æ¬¡å‡æ³•è¿ç®—</li>
<li>æ¡ä»¶åˆ¤æ–­åŸºäºé™æ€æ§ä»¶ï¼Œåœ¨ç¼–è¯‘æ—¶å³å¯ä¼˜åŒ–</li>
</ul>
<p><strong>ä¼˜åŒ–ç­–ç•¥</strong></p>
<ul>
<li>é¿å…åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­é¢‘ç¹åˆ‡æ¢åè½¬çŠ¶æ€</li>
<li>åˆç†ä½¿ç”¨é€šé“é€‰æ‹©æ€§åè½¬ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—</li>
<li>ç»“åˆLODç³»ç»Ÿï¼Œåœ¨è¿œè·ç¦»é™ä½åè½¬æ•ˆæœç²¾åº¦</li>
<li>ä½¿ç”¨å®ä¾‹åŒ–å‡å°‘é‡å¤è®¡ç®—</li>
</ul>
<p><strong>å¹³å°å…¼å®¹æ€§è€ƒè™‘</strong></p>
<ul>
<li>åœ¨æ‰€æœ‰æ”¯æŒShader Graphçš„å¹³å°ä¸Šéƒ½èƒ½ç¨³å®šè¿è¡Œ</li>
<li>ç§»åŠ¨è®¾å¤‡ä¸Šæ€§èƒ½å¼€é”€å¯æ§ï¼Œé€‚åˆé€‚åº¦ä½¿ç”¨</li>
<li>WebGLå¹³å°éœ€è¦æ³¨æ„ç²¾åº¦å’Œæ€§èƒ½å¹³è¡¡</li>
</ul>
<h2 data-id="heading-5">é«˜çº§ä½¿ç”¨æŠ€å·§</h2>
<p><strong>ä¸å…¶ä»–èŠ‚ç‚¹çš„ç»„åˆåº”ç”¨</strong>Invert ColorsèŠ‚ç‚¹å¯ä»¥ä¸å…¶ä»–Shader GraphèŠ‚ç‚¹ç»„åˆä½¿ç”¨ï¼Œåˆ›é€ å‡ºæ›´åŠ ä¸°å¯Œå¤šæ ·çš„è§†è§‰æ•ˆæœï¼š</p>
<ul>
<li>ä¸BlendèŠ‚ç‚¹ç»“åˆï¼šåˆ›å»ºå¤æ‚çš„é¢œè‰²æ··åˆæ•ˆæœ</li>
<li>ä¸TimeèŠ‚ç‚¹è”åŠ¨ï¼šåˆ¶ä½œåŠ¨æ€çš„é¢œè‰²åè½¬åŠ¨ç”»</li>
<li>ä¸GradientèŠ‚ç‚¹é…åˆï¼šå®ç°è‡ªå®šä¹‰çš„é¢œè‰²è¿‡æ¸¡æ•ˆæœ</li>
<li>ä¸NoiseèŠ‚ç‚¹ç»„åˆï¼šæ·»åŠ æœ‰æœºçš„çº¹ç†å˜åŒ–</li>
</ul>
<p><strong>å‚æ•°åŠ¨ç”»åŒ–æŠ€æœ¯</strong>é€šè¿‡å°†åè½¬æ§åˆ¶å‚æ•°ä¸æ—¶é—´ã€ç©å®¶è¾“å…¥æˆ–å…¶ä»–æ¸¸æˆå˜é‡ç»‘å®šï¼Œå¯ä»¥åˆ›å»ºåŠ¨æ€çš„é¢œè‰²åè½¬æ•ˆæœï¼š</p>
<ul>
<li>å‘¨æœŸæ€§åè½¬ï¼šä½¿ç”¨æ­£å¼¦å‡½æ•°æ§åˆ¶åè½¬å¼ºåº¦ï¼Œåˆ›å»ºå‘¼å¸ç¯æ•ˆæœ</li>
<li>äº¤äº’é©±åŠ¨åè½¬ï¼šåŸºäºç©å®¶æ“ä½œå®æ—¶è°ƒæ•´åè½¬å‚æ•°</li>
<li>ç¯å¢ƒå“åº”åè½¬ï¼šæ ¹æ®æ¸¸æˆç¯å¢ƒå˜åŒ–è‡ªåŠ¨è°ƒæ•´åè½¬æ•ˆæœ</li>
<li>æ¸è¿›å¼åè½¬ï¼šä½¿ç”¨ç¼“åŠ¨å‡½æ•°å®ç°å¹³æ»‘çš„åè½¬è¿‡æ¸¡</li>
</ul>
<p><strong>å¤šå±‚åè½¬æ•ˆæœ</strong>é€šè¿‡ä¸²è”å¤šä¸ªInvert ColorsèŠ‚ç‚¹ï¼Œå¯ä»¥å®ç°å¤æ‚çš„åˆ†å±‚åè½¬æ•ˆæœï¼š</p>
<ul>
<li>éƒ¨åˆ†é€šé“å¤šæ¬¡åè½¬ï¼šåˆ›å»ºç‹¬ç‰¹çš„è‰²å½©å¾ªç¯</li>
<li>æ¡ä»¶æ€§åè½¬é“¾ï¼šåŸºäºæ¸¸æˆçŠ¶æ€é€‰æ‹©ä¸åŒçš„åè½¬è·¯å¾„</li>
<li>ç©ºé—´å˜åŒ–åè½¬ï¼šç»“åˆUVåæ ‡åˆ›å»ºåŒºåŸŸæ€§çš„åè½¬æ•ˆæœ</li>
<li>æ—¶é—´å»¶è¿Ÿåè½¬ï¼šåœ¨ä¸åŒæ—¶é—´ç‚¹å¯ç”¨ä¸åŒé€šé“çš„åè½¬</li>
</ul>
<h2 data-id="heading-6">æ•…éšœæ’é™¤ä¸å¸¸è§é—®é¢˜</h2>
<p><strong>è§†è§‰æ•ˆæœå¼‚å¸¸æ’æŸ¥</strong>å½“Invert ColorsèŠ‚ç‚¹äº§ç”Ÿä¸ç¬¦åˆé¢„æœŸçš„æ•ˆæœæ—¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ’æŸ¥ï¼š</p>
<ul>
<li>æ£€æŸ¥è¾“å…¥æ•°æ®èŒƒå›´ï¼šç¡®ä¿æ‰€æœ‰é¢œè‰²å€¼åœ¨0-1èŒƒå›´å†…</li>
<li>éªŒè¯æ§ä»¶çŠ¶æ€ï¼šç¡®è®¤å„ä¸ªé€šé“çš„åè½¬å¼€å…³è®¾ç½®æ­£ç¡®</li>
<li>æ£€æŸ¥èŠ‚ç‚¹è¿æ¥ï¼šç¡®ä¿æ•°æ®æµè¿æ¥æ­£ç¡®æ— è¯¯</li>
<li>æµ‹è¯•éš”ç¦»æ•ˆæœï¼šå•ç‹¬æµ‹è¯•åè½¬èŠ‚ç‚¹æ’é™¤å…¶ä»–èŠ‚ç‚¹å½±å“</li>
</ul>
<p><strong>æ€§èƒ½é—®é¢˜è¯Šæ–­</strong>å¦‚æœå‘ç°ä½¿ç”¨Invert ColorsèŠ‚ç‚¹åæ€§èƒ½ä¸‹é™ï¼Œå¯ä»¥è€ƒè™‘ï¼š</p>
<ul>
<li>åˆ†æç»˜åˆ¶è°ƒç”¨æ¬¡æ•°ï¼šæ£€æŸ¥æ˜¯å¦å› åè½¬æ•ˆæœå¯¼è‡´æ‰¹æ¬¡åˆå¹¶å¤±è´¥</li>
<li>ç›‘æ§GPUè´Ÿè½½ï¼šä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·æ£€æµ‹å…·ä½“ç“¶é¢ˆ</li>
<li>ä¼˜åŒ–ç€è‰²å™¨å˜ä½“ï¼šå‡å°‘ä¸å¿…è¦çš„åŠŸèƒ½å˜ä½“ç”Ÿæˆ</li>
<li>ç®€åŒ–èŠ‚ç‚¹ç½‘ç»œï¼šé‡æ„ç€è‰²å™¨å›¾æé«˜æ‰§è¡Œæ•ˆç‡</li>
</ul>
<p><strong>è·¨å¹³å°å…¼å®¹æ€§é—®é¢˜</strong>åœ¨ä¸åŒå¹³å°ä¸Šå¯èƒ½ä¼šé‡åˆ°ä¸åŒçš„è¡¨ç°é—®é¢˜ï¼š</p>
<ul>
<li>ç²¾åº¦å·®å¼‚ï¼šç§»åŠ¨è®¾å¤‡ä¸Šå¯èƒ½å‡ºç°çš„ç²¾åº¦é—®é¢˜</li>
<li>è‰²å½©ç©ºé—´ï¼šçº¿æ€§ç©ºé—´ä¸ä¼½é©¬ç©ºé—´çš„è½¬æ¢é—®é¢˜</li>
<li>ç‰¹æ€§æ”¯æŒï¼šä¸åŒå›¾å½¢APIå¯¹ç‰¹å®šåŠŸèƒ½çš„æ”¯æŒå·®å¼‚</li>
<li>å†…å­˜é™åˆ¶ï¼šç§»åŠ¨è®¾å¤‡ä¸Šçš„å†…å­˜ä½¿ç”¨é™åˆ¶</li>
</ul>
<h2 data-id="heading-7">æœ€ä½³å®è·µæŒ‡å—</h2>
<p><strong>é¡¹ç›®ç»„ç»‡è§„èŒƒ</strong>ä¸ºäº†ç¡®ä¿ç€è‰²å™¨é¡¹ç›®çš„å¯ç»´æŠ¤æ€§å’Œå›¢é˜Ÿåä½œæ•ˆç‡ï¼Œå»ºè®®éµå¾ªä»¥ä¸‹è§„èŒƒï¼š</p>
<ul>
<li>ç»Ÿä¸€çš„å‘½åçº¦å®šï¼šä¸ºåè½¬æ§åˆ¶å‚æ•°åˆ¶å®šæ˜ç¡®çš„å‘½åè§„åˆ™</li>
<li>æ¨¡å—åŒ–è®¾è®¡ï¼šå°†å¸¸ç”¨çš„åè½¬æ•ˆæœå°è£…ä¸ºå­å›¾é‡ç”¨</li>
<li>æ–‡æ¡£åŒ–é…ç½®ï¼šä¸ºå¤æ‚çš„åè½¬è®¾ç½®æä¾›è¯´æ˜æ–‡æ¡£</li>
<li>ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ï¼šåˆç†ç®¡ç†ç€è‰²å™¨èµ„æºçš„ç‰ˆæœ¬å†å²</li>
</ul>
<p><strong>æ€§èƒ½ä¸è´¨é‡å¹³è¡¡</strong>åœ¨è¿½æ±‚è§†è§‰æ•ˆæœçš„åŒæ—¶ï¼Œéœ€è¦å…¼é¡¾æ€§èƒ½è€ƒé‡ï¼š</p>
<ul>
<li>è´¨é‡çº§åˆ«åˆ’åˆ†ï¼šä¸ºä¸åŒè®¾å¤‡ç­‰çº§è®¾ç½®ä¸åŒçš„åè½¬æ•ˆæœè´¨é‡</li>
<li>åŠ¨æ€ç»†èŠ‚è°ƒæ•´ï¼šæ ¹æ®è¿è¡Œå¸§ç‡è‡ªåŠ¨è°ƒæ•´åè½¬æ•ˆæœå¤æ‚åº¦</li>
<li>èµ„æºé¢„ç®—ç®¡ç†ï¼šä¸ºåè½¬æ•ˆæœåˆ†é…åˆç†çš„æ€§èƒ½é¢„ç®—</li>
<li>æµ‹è¯•è¦†ç›–å…¨é¢ï¼šåœ¨å„ç§ç¡¬ä»¶é…ç½®ä¸Šæµ‹è¯•åè½¬æ•ˆæœè¡¨ç°</li>
</ul>
<p><strong>åˆ›æ„åº”ç”¨æ‹“å±•</strong>é¼“åŠ±å¼€å‘è€…å‘æŒ¥åˆ›æ„ï¼Œæ¢ç´¢Invert ColorsèŠ‚ç‚¹çš„æ›´å¤šå¯èƒ½æ€§ï¼š</p>
<ul>
<li>å®éªŒæ€§è‰ºæœ¯æ•ˆæœï¼šå°è¯•éä¼ ç»Ÿçš„åè½¬å‚æ•°ç»„åˆ</li>
<li>æŠ€æœ¯åˆ›æ–°åº”ç”¨ï¼šå°†åè½¬æŠ€æœ¯åº”ç”¨äºæ–°çš„æ¸²æŸ“é¢†åŸŸ</li>
<li>è·¨åª’ä½“é€‚åº”ï¼šè°ƒæ•´åè½¬æ•ˆæœé€‚åº”ä¸åŒçš„è¾“å‡ºä»‹è´¨</li>
<li>ç”¨æˆ·å¯å®šåˆ¶åŒ–ï¼šæä¾›åè½¬å‚æ•°è®©ç©å®¶è‡ªå®šä¹‰è§†è§‰æ•ˆæœ</li>
</ul>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">ã€Unity Shader Graph ä½¿ç”¨ä¸ç‰¹æ•ˆå®ç°ã€‘</a><strong>ä¸“æ -ç›´è¾¾</strong>
ï¼ˆæ¬¢è¿<em>ç‚¹èµç•™è¨€</em>æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ¯å¤©ä¸€ä¸ªå®‰å“æµ‹è¯•å¼€å‘å°çŸ¥è¯†ä¹‹ ï¼ˆä¸ƒï¼‰---å¸¸ç”¨çš„adb å‘½ä»¤ç¬¬äº”æœŸ]]></title>    <link>https://juejin.cn/post/7582787460418699306</link>    <guid>https://juejin.cn/post/7582787460418699306</guid>    <pubDate>2025-12-12T14:24:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582787460418699306" data-draft-id="7582786655473582123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ¯å¤©ä¸€ä¸ªå®‰å“æµ‹è¯•å¼€å‘å°çŸ¥è¯†ä¹‹ ï¼ˆä¸ƒï¼‰---å¸¸ç”¨çš„adb å‘½ä»¤ç¬¬äº”æœŸ"/> <meta itemprop="keywords" content="æµ‹è¯•"/> <meta itemprop="datePublished" content="2025-12-12T14:24:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹å–µå–µå–µ"/> <meta itemprop="url" content="https://juejin.cn/user/335810321976697"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ¯å¤©ä¸€ä¸ªå®‰å“æµ‹è¯•å¼€å‘å°çŸ¥è¯†ä¹‹ ï¼ˆä¸ƒï¼‰---å¸¸ç”¨çš„adb å‘½ä»¤ç¬¬äº”æœŸ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/335810321976697/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹å–µå–µå–µ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T14:24:51.000Z" title="Fri Dec 12 2025 14:24:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¯å¤©ä¸€ä¸ªå®‰å“æµ‹è¯•å¼€å‘å°çŸ¥è¯†ä¹‹ ï¼ˆä¸ƒï¼‰---å¸¸ç”¨çš„adb å‘½ä»¤ç¬¬äº”æœŸ</h2>
<p><em>helloï¼Œå®å­ä»¬ï¼Œæœ€è¿‘æ²¡æœ‰æ›´æ–°æ˜¯å› ä¸ºå·¥ä½œå¤ªå¿™äº†ï¼Œåˆšç»“æŸå®Œæœ¬å¹´åº¦ç­”è¾©ï¼Œ ä»¥åè¿˜ä¼šç»§ç»­æ›´æ–°ï¼Œå¦‚æœæœ‰æƒ³äº†è§£çš„å¯ä»¥è¯„è®ºï¼Œä½ ä»¬çš„è¯„è®ºæˆ‘éƒ½ä¼šçœ‹ï¼Œç¬”å¿ƒ</em></p>
<blockquote>
<p>ä¸ŠæœŸä»‹ç»äº†å¦‚ä½•é€šè¿‡adbå‘½ä»¤è¾“å…¥æ–‡å­—ï¼Œæœ¬æœŸä»‹ç»å¦‚ä½•é€šè¿‡adb ç‚¹å‡»åæ ‡</p>
<ul>
<li>adbå‘½ä»¤è·å–æ‰‹æœºå±å¹•å¤§å°ï¼ˆåˆ†è¾¨ç‡ï¼‰</li>
<li>adbå‘½ä»¤ç‚¹å‡»åæ ‡</li>
<li>adbå‘½ä»¤æŒ‰ä¸‹ç‰©ç†æŒ‰é”®</li>
<li>adbå‘½ä»¤è·å–å½“å‰æ‰‹æœºçš„æ—‹è½¬æ–¹å‘</li>
<li>adbå‘½ä»¤è·å–å½“å‰æ‰‹æœºçš„æŠ˜å çŠ¶æ€ã€é’ˆå¯¹æŠ˜å å±æ‰‹æœºã€‘</li>
</ul>
</blockquote>
<h2 data-id="heading-1">1. è·å–æ‰‹æœºå±å¹•å¤§å°ï¼ˆåˆ†è¾¨ç‡ï¼‰</h2>
<pre><code class="hljs language-bash" lang="bash">adb shell wm size
</code></pre>
<p>å±å¹•åˆ†è¾¨ç‡ æ¨ª <code>1080</code> ç«– <code>2520</code>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75a9061f4ebd443189012ccb028eaafe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=XxS6cqXZr5ehaDRHxXRf0VqZCAY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ul>
<li>æ‰©å±•</li>
</ul>
<ol>
<li>æŸ¥çœ‹ wm å‘½ä»¤å¸®åŠ©</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">adb shell wm <span class="hljs-built_in">help</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1bdfb73a6d147d2b2957baa9e9b26b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=YDe4uZYbFcty6WeWQ4T1YlYoisw%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
2. è§£é”å±å¹•ã€æ²¡æœ‰é”å±å¯†ç ï¼Œå±å¹•å·²ç»ç‚¹äº®ã€‘</p>
<pre><code class="hljs language-bash" lang="bash"> adb shell wm dismiss-keyguard
</code></pre>
<ol start="3">
<li>æ–¹å‘é”å®š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">adb shell wm user-rotation lock
</code></pre>
<p>ä¸é”å®šæ–¹å‘</p>
<pre><code class="hljs language-bash" lang="bash">adb shell wm user-rotation free
</code></pre>
<ol start="4">
<li>wm shellå‘½ä»¤
4.1 è·å–å¸®åŠ©</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">adb  shell wm shell <span class="hljs-built_in">help</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e942f6e71389461aaa5d94bf3e68fb0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=2mdFSoGltO3b5YpW75Ci0lluz0E%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
4.2 æ¸…é™¤æœ€è¿‘ä»»åŠ¡</p>
<blockquote>
<p>adb shell wm shell recents clearAll
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2115aa3d57964ac6971fe35f090c8dc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=%2Fno8O98%2FfwctyVFeBkaJSl9ZNXg%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</blockquote>
<h2 data-id="heading-2">2. ç‚¹å‡»åæ ‡</h2>
<pre><code class="hljs language-bash" lang="bash">adb shell input tap 500 1000
</code></pre>
<p>æŸ¥çœ‹inputå‘½ä»¤å¸®åŠ©</p>
<pre><code class="hljs language-bash" lang="bash">adb shell input <span class="hljs-built_in">help</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b38e33a3aadb40e5b2b34e6e16c46a13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=0TxfAaiHXd3PgElJXRtiaxvb%2Bj8%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
input å‘½ä»¤å¯æ‰§è¡Œçš„æŒ‡ä»¤åŒ…æ‹¬</p>
<ul>
<li><code>tap &lt;x&gt; &lt;y&gt; (Default: touchscreen)</code> ç‚¹å‡»</li>
<li><code>swipe &lt;x1&gt; &lt;y1&gt; &lt;x2&gt; &lt;y2&gt; [duration(ms)] (Default: touchscreen)</code> æ»‘åŠ¨</li>
<li><code>text &lt;string&gt; (Default: keyboard)</code> è¾“å…¥æ–‡å­—</li>
<li><code>keyevent [--longpress|--duration &lt;duration to hold key down in ms&gt;] [--doubletap] [--async] [--delay &lt;duration between keycodes in ms&gt;] &lt;key code number or name&gt; ... (Default: keyboard)</code> æ¨¡æ‹ŸæŒ‰ä¸‹å’Œé‡Šæ”¾ç‰©ç†æŒ‰é”®
æ¯”å¦‚ home <code>adb shell input keyevent 3</code></li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ•°å­—é”® 0-9</span>
adb shell input keyevent 7    <span class="hljs-comment"># 0</span>
adb shell input keyevent 8    <span class="hljs-comment"># 1</span>
adb shell input keyevent 9    <span class="hljs-comment"># 2</span>
adb shell input keyevent 10   <span class="hljs-comment"># 3</span>
adb shell input keyevent 11   <span class="hljs-comment"># 4</span>
adb shell input keyevent 12   <span class="hljs-comment"># 5</span>
adb shell input keyevent 13   <span class="hljs-comment"># 6</span>
adb shell input keyevent 14   <span class="hljs-comment"># 7</span>
adb shell input keyevent 15   <span class="hljs-comment"># 8</span>
adb shell input keyevent 16   <span class="hljs-comment"># 9</span>

<span class="hljs-comment"># å­—æ¯é”® A-Z</span>
adb shell input keyevent 29   <span class="hljs-comment"># A</span>
adb shell input keyevent 30   <span class="hljs-comment"># B</span>
adb shell input keyevent 31   <span class="hljs-comment"># C</span>
<span class="hljs-comment"># ... ä»¥æ­¤ç±»æ¨</span>
</code></pre>
<h2 data-id="heading-3">3. è·å–å½“å‰æ‰‹æœºçš„æ—‹è½¬æ–¹å‘</h2>
<pre><code class="hljs language-bash" lang="bash">adb shell settings get system user_rotation
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2e57521a5ef44afa8bfaa22f5750ab7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=UR3j9QUjQnYLbPXaRXcCcwixVvI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å‘½ä»¤<code>settings</code>è¡¨ç¤ºç›´æ¥æ“ä½œæ‰‹æœºè®¾ç½®ï¼Œæ‰‹æœºé‡Œå¾ˆå¤šè®¾ç½®é¡¹éƒ½å¯ä»¥ä½¿ç”¨ <code>get</code> è·å–å¯¹åº”çš„å€¼  <code>put</code> è®¾ç½®å¯¹åº”çš„å€¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7c2a75cad734797a6ce4b9e68088d86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=OHc%2B1f2Cs057iUIu4lkN7IFRj14%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h2 data-id="heading-4">4. å½“å‰æ‰‹æœºçš„æŠ˜å çŠ¶æ€</h2>
<pre><code class="hljs language-bash" lang="bash"> adb shell cmd device_state print-state
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35c002881366467083211e6c517bc099~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=e5iVc9d8qRyhJPeS1v6g%2BYgYfAQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
0 å®Œå…¨åˆä¸Š 3 å®Œå…¨æ‰“å¼€
<code>device_state</code> å‘½ä»¤æ‰©å±•</p>
<ul>
<li>æŸ¥çœ‹å¸®åŠ©</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">adb shell cmd device_state
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6078134c7f54ff99d8cf114b7334e50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=4wtJf%2F9jdcZt9OjkBQ9fCXYZghk%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
æ¯”å¦‚è·å–å½“å‰æ‰‹æœºæ”¯æŒçš„çŠ¶æ€</p>
<pre><code class="hljs language-bash" lang="bash"> adb shell cmd device_state print-states
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99e7a47d91c44bec81877c9604adc233~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg546L5Za15Za15Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766154291&amp;x-signature=K0sDyJKNDgS2Wr1uu8ftaxEqsl8%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">adb shell cmd 
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤è¿˜æœ‰å¾ˆå¤šå…¶ä»–åŠŸèƒ½ æˆ‘ä»¬åç»­ç»§ç»­åˆ†äº«
æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼ï¼ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš«æ±‚æ±‚ä½ åˆ«å†æ‰‹åŠ¨æ”¹ç±»åäº†ï¼Swift è‡ªåŠ¨æ··æ·†è„šæœ¬ä¸Šçº¿ï¼Œ4.3 å¤´å‘ä¿å«æˆ˜æ­£å¼å¼€å§‹ï¼]]></title>    <link>https://juejin.cn/post/7582759716188323840</link>    <guid>https://juejin.cn/post/7582759716188323840</guid>    <pubDate>2025-12-12T10:50:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582759716188323840" data-draft-id="7582769411994157108" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš«æ±‚æ±‚ä½ åˆ«å†æ‰‹åŠ¨æ”¹ç±»åäº†ï¼Swift è‡ªåŠ¨æ··æ·†è„šæœ¬ä¸Šçº¿ï¼Œ4.3 å¤´å‘ä¿å«æˆ˜æ­£å¼å¼€å§‹ï¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-12T10:50:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="StarkCoder"/> <meta itemprop="url" content="https://juejin.cn/user/207173399875662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš«æ±‚æ±‚ä½ åˆ«å†æ‰‹åŠ¨æ”¹ç±»åäº†ï¼Swift è‡ªåŠ¨æ··æ·†è„šæœ¬ä¸Šçº¿ï¼Œ4.3 å¤´å‘ä¿å«æˆ˜æ­£å¼å¼€å§‹ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/207173399875662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    StarkCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:50:23.000Z" title="Fri Dec 12 2025 10:50:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸš«æ±‚æ±‚ä½ åˆ«å†æ‰‹åŠ¨æ”¹ç±»åäº†ï¼Swift è‡ªåŠ¨æ··æ·†è„šæœ¬ä¸Šçº¿ï¼Œ4.3 å¤´å‘ä¿å«æˆ˜æ­£å¼å¼€å§‹ï¼</h2>
<p>æœ€è¿‘åˆè¢«è‹¹æœçˆ¸çˆ¸ 4.3 æ‹¿æäº†å—ï¼Ÿ<br/>
æ˜¯ä¸æ˜¯å·²ç»ä¹ æƒ¯äº†ä»¥ä¸‹è¿™äº›ã€Œçµé­‚æŠ˜ç£¨ã€ï¼š</p>
<ul>
<li>ä¸ºäº†ä¸Šæ¶ä¸å¾—ä¸æ‰‹åŠ¨ç”»å‡ ä¸ªç±»å â€”â€” ä¸€æ”¹ä¸€ä¸ªé”™</li>
<li>Storyboard å’Œ XIB çš„ customClass æ€»æœ‰æ¼ç½‘ä¹‹é±¼</li>
<li>project.pbxproj åŠ¨äº†ä¸‹æ•´ä¸ªå·¥ç¨‹éƒ½çº¢äº†</li>
<li>æ–‡ä»¶åã€ç±»åã€åè®®åã€åˆå§‹åŒ–åâ€¦â€¦æ¯ä¸ªåœ°æ–¹éƒ½è¦ä½ è‡ªå·±æ‰¾</li>
<li>æ”¹å®Œè¾›è¾›è‹¦è‹¦æäº¤ï¼Œç»“æœè‹¹æœä¸€å¥ã€Œä¸ä½ çš„å…¶ä»– App ç›¸ä¼¼ã€ï¼š<strong>4.3ï¼Œé‡æ¥ï¼</strong></li>
</ul>
<p>è¿™æ—¶å€™çš„ä½ ï¼š</p>
<blockquote>
<p>â€œæˆ‘åˆ°åº•æ˜¯å¼€å‘è€…ï¼Œè¿˜æ˜¯é‡æ„å·¥å…·ï¼Ÿâ€</p>
</blockquote>
<p>åœã€‚é†’é†’ã€‚<br/>
<strong>2025 å¹´äº†ï¼Œæˆ‘ä»¬çœŸä¸éœ€è¦å†ç”¨æ‰‹æ”¹ä»£ç æ¥å¯¹æŠ—æœºå™¨å®¡æ ¸äº†ã€‚</strong></p>
<p>äºæ˜¯æˆ‘å†™äº†ä¸€ä¸ªè„šæœ¬ï¼Œä¸“é—¨æ‹¯æ•‘è¢« 4.3 æŠ˜ç£¨å¾—å¤´å‘éƒ½è¦æ‰å…‰çš„å¼€å‘è€…ï¼š<br/>
ğŸ‘‰ <strong>Swift å…¨è‡ªåŠ¨æ··æ·†è„šæœ¬ï¼ˆå·²å¼€æºï¼‰</strong><br/>
<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchengshixin%2Fobfuscate_swift" target="_blank" title="https://github.com/chengshixin/obfuscate_swift" ref="nofollow noopener noreferrer">github.com/chengshixinâ€¦</a></strong></p>
<p>ä¸‹é¢ï¼Œè®©æˆ‘å¸¦ä½ çœ‹çœ‹å®ƒåˆ°åº•èƒ½å¸®ä½ åšäº›ä»€ä¹ˆã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ¯è„šæœ¬èƒ½è§£å†³ä½ ä»€ä¹ˆç—›ç‚¹ï¼Ÿ</h2>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p><strong>ä½ æ— éœ€æ‰‹åŠ¨æ”¹ä»»ä½•ä¸œè¥¿ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆå…¨éƒ¨å·®å¼‚åŒ–å·¥ä½œã€‚</strong></p>
</blockquote>
<p>çœŸæ­£çš„ã€Œå…¨è‡ªåŠ¨ã€æ˜¯è¿™æ ·çš„ï¼š</p>
<hr/>
<h2 data-id="heading-2">ğŸš€1. è‡ªåŠ¨é‡å‘½åæ‰€æœ‰ Swift ç±» + Swift æ–‡ä»¶å</h2>
<p>ä½ çš„æ–‡ä»¶åŸæœ¬å«ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">HomeViewController.swift
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeViewController</span> { ... }
</code></pre>
<p>æ··æ·†åå¯èƒ½å˜æˆï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">AuroraVertexNimbus_3f91a2b1.swift
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AuroraVertexNimbus_3f91a2b1</span> { ... }
</code></pre>
<p>è¯æ±‡éšæœºã€é•¿åº¦éšæœºã€å“ˆå¸Œéšæœºã€‚<br/>
ä¸æ˜¯â€œæ¢ä¸ªåå­—â€ï¼Œæ˜¯ <strong>â€œæ¢ä¸ªçµé­‚â€</strong> ã€‚</p>
<hr/>
<h2 data-id="heading-3">ğŸš€2. å…¨å·¥ç¨‹æ™ºèƒ½æ›¿æ¢ï¼ˆSwift + Storyboard + XIBï¼‰</h2>
<p>è„šæœ¬ä¼šè‡ªåŠ¨æ‰«ææ•´ä¸ªé¡¹ç›®å¹¶æ›¿æ¢æ‰€æœ‰å¼•ç”¨åˆ°çš„åå­—ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>Swift é‡Œçš„åˆå§‹åŒ–ã€ç»§æ‰¿ã€æ³›å‹ã€ç±»å‹å£°æ˜</li>
<li>xib / storyboard çš„ customClass</li>
<li>StoryboardID</li>
<li>reuseIdentifier</li>
<li>xml ä¸­çš„å„ç§ç±»åå¼•ç”¨</li>
<li>project.pbxproj é‡Œçš„æ–‡ä»¶åå¼•ç”¨</li>
</ul>
<p>å¹¶ä¸”è¿™é‡Œæœ‰ä¸€ç‚¹å¾ˆå…³é”® â€”â€”</p>
<blockquote>
<p><strong>è„šæœ¬æ˜¯â€œæ ¹æ®æ‰«æåˆ°çš„ Swift æ–‡ä»¶åâ€è¿›è¡ŒåŒ¹é…ä¸æ›¿æ¢çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæ–‡ä»¶åæ˜¯ä»€ä¹ˆï¼Œå®ƒå°±ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶åå½“ä½œéœ€è¦æ··æ·†çš„ç±»åæ¥å…¨å±€æ›¿æ¢ã€‚</strong></p>
</blockquote>
<p>æ‰€ä»¥å¦‚æœä½ çš„é¡¹ç›®æ˜¯â€œä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªç±»ï¼Œæ–‡ä»¶åå’Œç±»åä¸€è‡´â€ï¼Œæ•ˆæœä¼šéå¸¸å®Œç¾ã€éå¸¸è‡ªåŠ¨åŒ–ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼š</p>
<blockquote>
<p>ä½ èƒ½ç”¨åˆ°ç±»åçš„åœ°æ–¹ï¼Œå®ƒéƒ½èƒ½è‡ªåŠ¨æ›¿æ¢å¹²å‡€ã€‚<br/>
ä½ ä¸éœ€è¦æŸ¥æ‰¾ï¼Œä¹Ÿä¸éœ€è¦æ‹…å¿ƒæ¼æ”¹ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">ğŸš€3. è‡ªåŠ¨æ³¨å…¥â€œæ— æ„ä¹‰â€æ–¹æ³•å’Œå±æ€§ï¼ˆæ¯ä¸ªç±»éƒ½ä¸ä¸€æ ·ï¼‰</h2>
<p>æ¯ä¸ªç±»éƒ½ä¼šè¢«æ’å…¥ä¸€äº›éšæœºç”Ÿæˆçš„æ— æ„ä¹‰ä»£ç ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> auroraGlow_12fd98ab: Int = <span class="hljs-number">0</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> nimbusEcho_aa2c1f3d: String = <span class="hljs-string">""</span>

<span class="hljs-function"><span class="hljs-keyword">private</span> func <span class="hljs-title">metaDrift_99ab12cd</span>() -&gt; Bool</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}
</code></pre>
<p>ä½œç”¨æœ‰ä¸‰ï¼š</p>
<ul>
<li>è®©ç±»ç»“æ„çœ‹èµ·æ¥æ›´å¤æ‚</li>
<li>æ¯æ¬¡æ··æ·†ç”Ÿæˆçš„äºŒè¿›åˆ¶å·®å¼‚æ›´å¤§</li>
<li>å½¢æˆæ›´å¤šâ€œåŒºåˆ†åº¦â€ï¼Œå‡å°‘ 4.3 åˆ¤é‡æ¦‚ç‡</li>
</ul>
<p>è¿™ä¸€æ­¥æ‰‹å†™ä½ å¯èƒ½ç´¯æ­»ï¼Œä½†è„šæœ¬ 0.1 ç§’å°±æå®šã€‚</p>
<hr/>
<h2 data-id="heading-5">ğŸš€4. è‡ªåŠ¨åˆ‡æ¢ Git æ–°åˆ†æ”¯ï¼Œä¸æ±¡æŸ“ä¸»å·¥ç¨‹</h2>
<p>è„šæœ¬ä¼šè‡ªåŠ¨ï¼š</p>
<pre><code class="hljs language-css" lang="css">git checkout -<span class="hljs-selector-tag">b</span> obfuscate_20251212173345
</code></pre>
<p>æ··æ·†çš„æ‰€æœ‰å˜æ›´éƒ½åœ¨å•ç‹¬åˆ†æ”¯å†…ã€‚<br/>
å¦‚æœä½ ä¸æ»¡æ„ï¼Ÿ</p>
<pre><code class="hljs language-css" lang="css">git checkout <span class="hljs-selector-tag">main</span>
</code></pre>
<p>èµ°äººå³å¯ï¼Œéå¸¸å®‰å…¨ã€‚</p>
<hr/>
<h2 data-id="heading-6">ğŸš€5. è‡ªåŠ¨ç”Ÿæˆæ··æ·†æ˜ å°„æ—¥å¿—ï¼ˆæ’æŸ¥ç¥å™¨ï¼‰</h2>
<p>æ—¥å¿—ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"HomeViewController"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AuroraNimbusFlux_29f3ab1c"</span>
</code></pre>
<p>ä¸€æ—¦ç¼–è¯‘æŠ¥é”™ï¼Œä½ å¯ä»¥è¿…é€Ÿæ ¹æ®æ—¥å¿—æ‰¾åˆ°åŸå§‹ç±»åã€‚<br/>
ä¸ç”¨å†çŒœå“ªä¸ªæ–‡ä»¶è¢«é‡å‘½åã€å“ªä¸ªç±»æ›¿æ¢é”™ã€‚</p>
<hr/>
<h2 data-id="heading-7">ğŸ¤–ä¸ºä»€ä¹ˆè¿™è„šæœ¬å¯¹ 4.3 ç‰¹åˆ«æœ‰æ•ˆï¼Ÿ</h2>
<p>4.3 çš„æ ¸å¿ƒä¸æ˜¯äººå·¥åˆ¤æ–­ï¼Œè€Œæ˜¯<strong>æœºå™¨ç›¸ä¼¼åº¦æ£€æµ‹</strong>ã€‚<br/>
å®ƒä¼šåˆ†æï¼š</p>
<ul>
<li>ç±»åç»“æ„</li>
<li>æ–‡ä»¶å</li>
<li>ä»£ç ç‰¹å¾å‘é‡</li>
<li>æ–¹æ³•æ•°é‡ã€å±æ€§æ•°é‡</li>
<li>ç¼–è¯‘åç¬¦å·è¡¨</li>
<li>å·¥ç¨‹ç»“æ„</li>
<li>Storyboard / XIB å…ƒä¿¡æ¯</li>
</ul>
<p>ä½ æ‰‹åŠ¨æ”¹å‡ ä¸ªç±»åï¼Œæœºå™¨æ ¹æœ¬ä¸çœ‹ä½ ä¸€çœ¼ã€‚<br/>
ä½†è„šæœ¬è¿™ç§çº§åˆ«çš„â€œæ·±åº¦éšæœºåŒ–â€ï¼š</p>
<ul>
<li>æ–‡ä»¶åå…¨æ¢</li>
<li>ç±»åå…¨æ¢ï¼ˆéšæœºè¯ + hashï¼‰</li>
<li>ç±»ç»“æ„ä¸ä¸€æ ·</li>
<li>æ— æ„ä¹‰ä»£ç æ³¨å…¥</li>
<li>ç¬¦å·è¡¨å®Œå…¨ä¸åŒ</li>
<li>Storyboard / XIB å…¨é‡æ›¿æ¢</li>
<li>å·¥ç¨‹é…ç½®éšæœºå˜åŒ–</li>
</ul>
<p>è¿™æ‰æ˜¯â€œçœŸæ­£çš„å·®å¼‚åŒ–â€ã€‚</p>
<hr/>
<h2 data-id="heading-8">ğŸ› ï¸æ€ä¹ˆç”¨ï¼Ÿå¾ˆç®€å•</h2>
<ol>
<li>æŠŠè„šæœ¬æ”¾åœ¨ <code>.xcodeproj</code> åŒçº§ç›®å½•</li>
<li>ä¿®æ”¹è„šæœ¬é‡Œçš„é¡¹ç›®åï¼š</li>
</ol>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">PROJECT_NAME</span> = <span class="hljs-string">"YourProjectName"</span>
</code></pre>
<ol start="3">
<li>éœ€è¦æ’é™¤çš„æ–‡ä»¶å¤¹å¯è‡ªè¡Œè®¾ç½®ï¼š</li>
</ol>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">EXCLUDE_FOLDERS</span> = [<span class="hljs-string">'Extension'</span>, <span class="hljs-string">'Database'</span>, ...]
</code></pre>
<ol start="4">
<li>æ‰§è¡Œï¼š</li>
</ol>
<pre><code class="hljs">python3 obfuscate_swift.py
</code></pre>
<p>å–å£æ°´ï¼Œç­‰ 5 ç§’ã€‚</p>
<p>ä½ çš„é¡¹ç›®ç¬é—´å®Œæˆï¼š</p>
<ul>
<li>ç±»åå…¨æ··æ·†</li>
<li>æ–‡ä»¶åå…¨é‡å‘½å</li>
<li>Storyboard / XIB å…¨æ›¿æ¢</li>
<li>å·¥ç¨‹é…ç½®åŒæ­¥æ›´æ–°</li>
<li>Git åˆ†æ”¯è‡ªåŠ¨åˆ›å»º</li>
<li>æ—¥å¿—è‡ªåŠ¨ç”Ÿæˆ</li>
</ul>
<p>ä½ åªéœ€è¦æ‰“å¼€ Xcode ç¼–è¯‘ä¸€ä¸‹ï¼Œæäº¤ä¸Šæ¶ã€‚</p>
<hr/>
<h2 data-id="heading-9">ğŸŒˆæœ€åè¯´ä¸€å¥</h2>
<p>æ··æ·†ä¸æ˜¯ç›®çš„ã€‚<br/>
ç›®çš„ï¼Œæ˜¯<strong>å‡å°‘é‡å¤åŠ³åŠ¨ã€æé«˜ä¸Šæ¶æˆåŠŸç‡ï¼Œè®©ä½ å¤šç‚¹æ—¶é—´å†™ä½ æƒ³å†™çš„ä»£ç </strong>ã€‚</p>
<p>ä»¥å‰çš„ä½ ï¼šæ‰‹åŠ¨é‡å‘½åå‡ åä¸ªæ–‡ä»¶ï¼Œæ”¹åˆ°æ€€ç–‘äººç”Ÿã€‚<br/>
ç°åœ¨çš„ä½ ï¼šä¸€æ¡å‘½ä»¤ï¼Œè„šæœ¬å¸®ä½ å®Œæˆæ‰€æœ‰è„æ´»ç´¯æ´»ã€‚</p>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œç‚¹ä¸ªèµğŸ‘è®©æˆ‘çŸ¥é“ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»é€šç”¨å¯¹è¯åˆ°ä¸“å±æ™ºåº“ï¼šä¸¤ç§AIéƒ¨ç½²æ¨¡å¼ï¼Œè®©ä¼ä¸šæ•°æ®çœŸæ­£â€œæ´»â€œèµ·æ¥]]></title>    <link>https://juejin.cn/post/7582786292087652403</link>    <guid>https://juejin.cn/post/7582786292087652403</guid>    <pubDate>2025-12-12T10:30:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582786292087652403" data-draft-id="7582763878675021851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»é€šç”¨å¯¹è¯åˆ°ä¸“å±æ™ºåº“ï¼šä¸¤ç§AIéƒ¨ç½²æ¨¡å¼ï¼Œè®©ä¼ä¸šæ•°æ®çœŸæ­£â€œæ´»â€œèµ·æ¥"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-12T10:30:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç å†œçªå›´NO1"/> <meta itemprop="url" content="https://juejin.cn/user/1843250655412046"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»é€šç”¨å¯¹è¯åˆ°ä¸“å±æ™ºåº“ï¼šä¸¤ç§AIéƒ¨ç½²æ¨¡å¼ï¼Œè®©ä¼ä¸šæ•°æ®çœŸæ­£â€œæ´»â€œèµ·æ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1843250655412046/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç å†œçªå›´NO1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:30:42.000Z" title="Fri Dec 12 2025 10:30:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<ol>
<li>ç›´æ¥è°ƒç”¨ vs RAGå¢å¼ºçš„å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ</li>
<li>æ„å»ºä¼ä¸šçº§æ™ºèƒ½çŸ¥è¯†åº“ï¼šä»æŠ€æœ¯åŸç†åˆ°è½åœ°å®è·µ</li>
</ol>
</blockquote>
<h2 data-id="heading-0">å¼•è¨€ï¼šé€‰æ‹©é€‚åˆçš„AIéƒ¨ç½²æ¶æ„</h2>
<p>åœ¨æ„å»ºä¼ä¸šçº§AIåº”ç”¨æ—¶ï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªå…³é”®å†³ç­–ï¼šæ˜¯ç›´æ¥éƒ¨ç½²å¤§æ¨¡å‹æä¾›æœåŠ¡ï¼Œè¿˜æ˜¯æ„å»ºåŒ…å«çŸ¥è¯†æ£€ç´¢çš„RAGç³»ç»Ÿï¼Ÿè¿™ä¸¤ç§æ–¹æ¡ˆå„æœ‰é€‚ç”¨åœºæ™¯ï¼Œæœ¬æ–‡å°†æ·±å…¥æ¢è®¨ä¸¤ç§æ¨¡å¼çš„æŠ€æœ¯å®ç°ã€ä¼˜ç¼ºç‚¹å’Œå…·ä½“åº”ç”¨ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€æ¨¡å¼ä¸€ï¼šç›´æ¥éƒ¨ç½²ä¸è°ƒç”¨</h2>
<h3 data-id="heading-2">1.1 æ ¸å¿ƒæ¶æ„ï¼šæ¨¡å‹æœåŠ¡ â†’ åç«¯API â†’ å‰ç«¯</h3>
<p>ç›´æ¥éƒ¨ç½²æ¨¡å¼ä¸“æ³¨äºæä¾›çº¯å‡€çš„å¤§æ¨¡å‹èƒ½åŠ›ï¼Œé€‚åˆé€šç”¨å¯¹è¯å’Œåˆ›æ„ç”Ÿæˆåœºæ™¯ã€‚</p>
<p><strong>æ¶æ„ç¤ºæ„å›¾ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[ç”¨æˆ·å‰ç«¯]</span> â†â†’ <span class="hljs-selector-attr">[åç«¯åŒ…è£…API]</span> â†â†’ <span class="hljs-selector-attr">[æ¨¡å‹æœåŠ¡(VLLM/Ollama)]</span>
</code></pre>
<h3 data-id="heading-3">1.2 æ¨¡å‹æœåŠ¡çš„åŸç”Ÿæ¥å£éƒ¨ç½²</h3>
<p><strong>VLLM éƒ¨ç½²ï¼ˆç”Ÿäº§çº§ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨VLLMæœåŠ¡ï¼Œè‡ªåŠ¨æä¾›OpenAIå…¼å®¹æ¥å£</span>
python -m vllm.entrypoints.openai.api_server \
    --model Qwen/Qwen2-7B-Instruct \
    --served-model-name qwen-7b \
    --api-key token-abc123 \
    --host 0.0.0.0 \
    --port 8000
</code></pre>
<p><strong>Ollama éƒ¨ç½²ï¼ˆå¼€å‘æµ‹è¯•ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€é”®éƒ¨ç½²ï¼Œé€‚åˆå¿«é€ŸåŸå‹</span>
ollama pull qwen2:7b
ollama run qwen2:7b
</code></pre>
<h3 data-id="heading-4">1.3 ä¸ºä»€ä¹ˆéœ€è¦åç«¯åŒ…è£…ï¼Ÿ</h3>
<p>è™½ç„¶æ¨¡å‹æœåŠ¡æœ¬èº«æš´éœ²æ¥å£ï¼Œä½†ç”Ÿäº§ç¯å¢ƒéœ€è¦åç«¯åŒ…è£…ï¼š</p>
<p><strong>å®‰å…¨æ€§éœ€æ±‚ï¼š</strong></p>
<ul>
<li>APIå¯†é’¥ç®¡ç†å’Œè½®è½¬</li>
<li>è®¿é—®é¢‘ç‡é™åˆ¶å’Œé˜²æ»¥ç”¨</li>
<li>è¾“å…¥å†…å®¹å®‰å…¨è¿‡æ»¤</li>
<li>JWTç”¨æˆ·èº«ä»½è®¤è¯</li>
</ul>
<p><strong>ä¸šåŠ¡é€»è¾‘éœ€æ±‚ï¼š</strong></p>
<ul>
<li>å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†</li>
<li>å¯¹è¯å†å²æŒä¹…åŒ–å­˜å‚¨</li>
<li>å“åº”æ ¼å¼æ ‡å‡†åŒ–</li>
<li>å¤æ‚çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶</li>
</ul>
<h3 data-id="heading-5">1.4 åç«¯åŒ…è£…å®ç°ç¤ºä¾‹</h3>
<p><strong>FastAPI åç«¯æœåŠ¡ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException, Depends
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> uuid

app = FastAPI(title=<span class="hljs-string">"å¤§æ¨¡å‹æœåŠ¡ç½‘å…³"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatRequest</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    message: <span class="hljs-built_in">str</span>
    conversation_id: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span>
    max_tokens: <span class="hljs-built_in">int</span> = <span class="hljs-number">1000</span>
    temperature: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.7</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatResponse</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    response: <span class="hljs-built_in">str</span>
    conversation_id: <span class="hljs-built_in">str</span>
    usage: <span class="hljs-built_in">dict</span>

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/api/chat"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_endpoint</span>(<span class="hljs-params">request: ChatRequest</span>):
    <span class="hljs-string">"""ç»Ÿä¸€çš„èŠå¤©æ¥å£"""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># è°ƒç”¨VLLMæœåŠ¡</span>
        vllm_response = call_vllm_service(
            request.message, 
            request.max_tokens, 
            request.temperature
        )
        
        <span class="hljs-keyword">return</span> ChatResponse(
            response=vllm_response,
            conversation_id=request.conversation_id <span class="hljs-keyword">or</span> <span class="hljs-built_in">str</span>(uuid.uuid4()),
            usage={<span class="hljs-string">"prompt_tokens"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"completion_tokens"</span>: <span class="hljs-number">0</span>}
        )
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">f"æœåŠ¡è°ƒç”¨å¤±è´¥: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_vllm_service</span>(<span class="hljs-params">message: <span class="hljs-built_in">str</span>, max_tokens: <span class="hljs-built_in">int</span>, temperature: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""è°ƒç”¨VLLMåŸç”Ÿæ¥å£"""</span>
    headers = {
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
        <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">f"Bearer token-abc123"</span>
    }
    
    payload = {
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"qwen-7b"</span>,
        <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: message}],
        <span class="hljs-string">"max_tokens"</span>: max_tokens,
        <span class="hljs-string">"temperature"</span>: temperature
    }
    
    response = requests.post(
        <span class="hljs-string">"http://localhost:8000/v1/chat/completions"</span>,
        headers=headers,
        json=payload,
        timeout=<span class="hljs-number">30</span>
    )
    
    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:
        <span class="hljs-keyword">return</span> response.json()[<span class="hljs-string">"choices"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"message"</span>][<span class="hljs-string">"content"</span>]
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f"VLLM APIé”™è¯¯: <span class="hljs-subst">{response.text}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
    uvicorn.run(app, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8080</span>)
</code></pre>
<h3 data-id="heading-6">1.5 å‰ç«¯è°ƒç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯è°ƒç”¨å°è£…åçš„API</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectChatService</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">apiUrl = <span class="hljs-string">'http://localhost:8080'</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiUrl</span> = apiUrl;
    }
    
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params">message, conversationId = <span class="hljs-literal">null</span></span>) {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiUrl}</span>/api/chat`</span>, {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
            <span class="hljs-attr">headers</span>: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>},
            <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
                <span class="hljs-attr">message</span>: message,
                <span class="hljs-attr">conversation_id</span>: conversationId
            })
        });
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> chatService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectChatService</span>();
chatService.<span class="hljs-title function_">sendMessage</span>(<span class="hljs-string">"ç¼–å†™ä¸€ä¸ªPythonå¿«é€Ÿæ’åºå‡½æ•°"</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"AIå›å¤:"</span>, result.<span class="hljs-property">response</span>);
    });
</code></pre>
<h3 data-id="heading-7">1.6 é€‚ç”¨åœºæ™¯</h3>
<p><strong>é€‚åˆç›´æ¥è°ƒç”¨çš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>é€šç”¨å¯¹è¯å’ŒèŠå¤©</li>
<li>ä»£ç ç”Ÿæˆå’Œè°ƒè¯•</li>
<li>åˆ›æ„å†™ä½œå’Œå†…å®¹ç”Ÿæˆ</li>
<li>è¯­è¨€ç¿»è¯‘å’Œæ€»ç»“</li>
<li>é€»è¾‘æ¨ç†å’Œæ•°å­¦è®¡ç®—</li>
</ul>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ¶æ„ç®€å•ï¼Œéƒ¨ç½²å¿«é€Ÿ</li>
<li>å“åº”å»¶è¿Ÿä½</li>
<li>å……åˆ†åˆ©ç”¨æ¨¡å‹åŸå§‹èƒ½åŠ›</li>
<li>ç»´æŠ¤æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
</ul>
<h2 data-id="heading-8">äºŒã€æ¨¡å¼äºŒï¼šRAGå¢å¼ºçš„çŸ¥è¯†åº“ç³»ç»Ÿ</h2>
<h3 data-id="heading-9">2.1 æ ¸å¿ƒæ¶æ„ï¼šDify ä½œä¸º"æ€»è°ƒåº¦ä¸­å¿ƒ"</h3>
<p>å½“éœ€è¦ç»“åˆä¼ä¸šç§æœ‰çŸ¥è¯†æ—¶ï¼ŒRAGç³»ç»Ÿæˆä¸ºå¿…è¦é€‰æ‹©ã€‚Difyåœ¨è¿™é‡Œæ‰®æ¼”"æ€»ç»ç†"è§’è‰²ï¼Œåè°ƒæ‰€æœ‰æŠ€æœ¯æœåŠ¡ã€‚</p>
<p><strong>æœåŠ¡è§’è‰²åˆ’åˆ†ï¼š</strong></p>
<ul>
<li><strong>Dify</strong> = æ€»ç»ç†ï¼ˆæ€»è°ƒåº¦ï¼‰</li>
<li><strong>Ollama/VLLM</strong> = æŠ€æœ¯ä¸“å®¶éƒ¨é—¨</li>
<li><strong>Xinference(åµŒå…¥æ¨¡å‹)</strong> = æ¡£æ¡ˆæ£€ç´¢éƒ¨é—¨</li>
<li><strong>Xinference(é‡æ’åºæ¨¡å‹)</strong> = è´¨é‡å®¡æ ¸éƒ¨é—¨</li>
<li><strong>å‘é‡æ•°æ®åº“</strong> = æ¡£æ¡ˆä»“åº“</li>
</ul>
<h3 data-id="heading-10">2.2 RAG ç³»ç»Ÿå®Œæ•´éƒ¨ç½²</h3>
<p><strong>æ¨¡å‹æœåŠ¡éƒ¨ç½²ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># VLLMå¤§æ¨¡å‹æœåŠ¡</span>
python -m vllm.entrypoints.openai.api_server --model qwen-7b --port 8000

<span class="hljs-comment"># XinferenceåµŒå…¥å’Œé‡æ’åºæœåŠ¡</span>
xinference-local --port 9997

<span class="hljs-comment"># éƒ¨ç½²æ‰€éœ€æ¨¡å‹</span>
curl -X POST <span class="hljs-string">"http://localhost:9997/v1/models"</span> \
  -d <span class="hljs-string">'{"model_name": "bge-large-zh", "model_type": "embedding"}'</span>
  
curl -X POST <span class="hljs-string">"http://localhost:9997/v1/models"</span> \
  -d <span class="hljs-string">'{"model_name": "bge-reranker-large", "model_type": "rerank"}'</span>
</code></pre>
<h3 data-id="heading-11">2.3 Dify çš„è°ƒåº¦æµç¨‹</h3>
<p>å½“ç”¨æˆ·æé—®æ—¶ï¼ŒDifyè‡ªåŠ¨æ‰§è¡Œå®Œæ•´çš„RAGæµç¨‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·æé—®ï¼š"å…¬å¸å¹´å‡æ”¿ç­–æ˜¯æ€æ ·çš„ï¼Ÿ"
    â†“
<span class="hljs-selector-attr">[Dify æ¥æ”¶é—®é¢˜]</span>
    â†“
<span class="hljs-selector-attr">[Dify è°ƒç”¨ XinferenceåµŒå…¥æ¨¡å‹]</span> â†’ ç”Ÿæˆé—®é¢˜å‘é‡
    â†“
<span class="hljs-selector-attr">[Dify è°ƒç”¨å‘é‡æ•°æ®åº“]</span> â†’ æ£€ç´¢ç›¸å…³æ–‡æ¡£(ç²—æ’)
    â†“  
<span class="hljs-selector-attr">[Dify è°ƒç”¨ Xinferenceé‡æ’åºæ¨¡å‹]</span> â†’ ç²¾æ’<span class="hljs-attribute">Top</span> <span class="hljs-number">3</span>æ–‡æ¡£
    â†“
<span class="hljs-selector-attr">[Dify æ„å»ºå¢å¼ºæç¤ºè¯]</span> â†’ ç»„åˆé—®é¢˜+ä¸Šä¸‹æ–‡
    â†“
<span class="hljs-selector-attr">[Dify è°ƒç”¨ VLLMå¤§æ¨¡å‹]</span> â†’ ç”ŸæˆåŸºäºçŸ¥è¯†çš„ç­”æ¡ˆ
    â†“
<span class="hljs-selector-attr">[Dify è¿”å›ç­”æ¡ˆç»™ç”¨æˆ·]</span>
</code></pre>
<h3 data-id="heading-12">2.4 RAGç³»ç»Ÿæ ¸å¿ƒä»£ç é€»è¾‘</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RAGSystem</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.embedder = XinferenceEmbedding()
        self.reranker = XinferenceReranker()
        self.llm_client = OpenAI(base_url=<span class="hljs-string">"http://localhost:8000/v1"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_question</span>(<span class="hljs-params">self, user_question</span>):
        <span class="hljs-comment"># 1. å‘é‡æ£€ç´¢</span>
        query_vector = self.embedder.get_embedding(user_question)
        candidate_chunks = self.vector_search(query_vector, top_k=<span class="hljs-number">10</span>)
        
        <span class="hljs-comment"># 2. é‡æ’åºç²¾æ’</span>
        ranked_chunks = self.reranker.rerank(
            question=user_question,
            documents=[chunk.content <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> candidate_chunks],
            top_k=<span class="hljs-number">3</span>
        )
        
        <span class="hljs-comment"># 3. å¢å¼ºç”Ÿæˆ</span>
        context = <span class="hljs-string">"\n"</span>.join(ranked_chunks)
        prompt = self.build_rag_prompt(user_question, context)
        
        answer = self.llm_client.chat.completions.create(
            model=<span class="hljs-string">"qwen-7b"</span>,
            messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}]
        )
        
        <span class="hljs-keyword">return</span> answer.choices[<span class="hljs-number">0</span>].message.content

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_rag_prompt</span>(<span class="hljs-params">self, question, context</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"""è¯·ä¸¥æ ¼æ ¹æ®ä»¥ä¸‹èƒŒæ™¯ä¿¡æ¯å›ç­”é—®é¢˜ã€‚å¦‚æœä¿¡æ¯ä¸è¶³ï¼Œè¯·è¯´æ˜ã€‚

èƒŒæ™¯ä¿¡æ¯:
<span class="hljs-subst">{context}</span>

é—®é¢˜: <span class="hljs-subst">{question}</span>

è¯·æ ¹æ®èƒŒæ™¯ä¿¡æ¯å›ç­”:"""</span>
</code></pre>
<h3 data-id="heading-13">2.5 é‡æ’åºæ¨¡å‹çš„ä»·å€¼</h3>
<p><strong>æ•ˆæœå¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ²¡æœ‰é‡æ’åºï¼š
æ£€ç´¢ç»“æœï¼š<span class="hljs-selector-attr">[<span class="hljs-string">"å…¬å¸æˆç«‹äº2010å¹´"</span>, <span class="hljs-string">"å¹´å‡æ”¿ç­–æ˜¯15å¤©"</span>, <span class="hljs-string">"å…¬å¸åœ°å€åœ¨åŒ—äº¬"</span>]</span>

åŠ å…¥é‡æ’åºåï¼š  
æ£€ç´¢ç»“æœï¼š<span class="hljs-selector-attr">[<span class="hljs-string">"å¹´å‡æ”¿ç­–ï¼šå·¥ä½œæ»¡1å¹´15å¤©"</span>, <span class="hljs-string">"å¹´å‡ç”³è¯·æµç¨‹..."</span>, <span class="hljs-string">"å‡æœŸè®¡ç®—è§„åˆ™..."</span>]</span>
</code></pre>
<p><strong>æ€§èƒ½æå‡ï¼š</strong> å‡†ç¡®ç‡æå‡15-30%ï¼Œæœ‰æ•ˆå‡å°‘æ¨¡å‹å¹»è§‰ã€‚</p>
<h3 data-id="heading-14">2.6 é€‚ç”¨åœºæ™¯</h3>
<p><strong>é€‚åˆRAGç³»ç»Ÿçš„åœºæ™¯ï¼š</strong></p>
<ul>
<li>ä¼ä¸šçŸ¥è¯†åº“é—®ç­”</li>
<li>æŠ€æœ¯æ–‡æ¡£æŸ¥è¯¢</li>
<li>å®¢æˆ·æ”¯æŒç³»ç»Ÿ</li>
<li>åˆè§„æ”¿ç­–å’¨è¯¢</li>
<li>å†…éƒ¨æµç¨‹æŒ‡å¯¼</li>
</ul>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>å›ç­”åŸºäºä¼ä¸šçœŸå®çŸ¥è¯†</li>
<li>å‡å°‘æ¨¡å‹å¹»è§‰ç°è±¡</li>
<li>çŸ¥è¯†æ›´æ–°ä¾¿æ·ï¼ˆåªéœ€æ›´æ–°æ–‡æ¡£ï¼‰</li>
<li>ç­”æ¡ˆå¯è¿½æº¯æ¥æº</li>
</ul>
<h2 data-id="heading-15">ä¸‰ã€ä¸¤ç§æ¨¡å¼å¯¹æ¯”åˆ†æ</h2>
<h3 data-id="heading-16">3.1 æ¶æ„å¤æ‚åº¦å¯¹æ¯”</h3>






























<table><thead><tr><th>æ–¹é¢</th><th>ç›´æ¥è°ƒç”¨æ¨¡å¼</th><th>RAGå¢å¼ºæ¨¡å¼</th></tr></thead><tbody><tr><td><strong>ç»„ä»¶æ•°é‡</strong></td><td>2-3ä¸ªç»„ä»¶</td><td>5-7ä¸ªç»„ä»¶</td></tr><tr><td><strong>éƒ¨ç½²éš¾åº¦</strong></td><td>ç®€å•</td><td>ä¸­ç­‰</td></tr><tr><td><strong>ç»´æŠ¤æˆæœ¬</strong></td><td>ä½</td><td>ä¸­é«˜</td></tr><tr><td><strong>æ•°æ®æµ</strong></td><td>ç®€å•ç›´æ¥</td><td>å¤æ‚ç®¡é“</td></tr></tbody></table>
<h3 data-id="heading-17">3.2 èƒ½åŠ›èŒƒå›´å¯¹æ¯”</h3>






























<table><thead><tr><th>èƒ½åŠ›ç»´åº¦</th><th>ç›´æ¥è°ƒç”¨</th><th>RAGå¢å¼º</th></tr></thead><tbody><tr><td><strong>é€šç”¨çŸ¥è¯†</strong></td><td>âœ… ä¼˜ç§€</td><td>âœ… ä¼˜ç§€</td></tr><tr><td><strong>ç§æœ‰çŸ¥è¯†</strong></td><td>âŒ æ— æ³•è®¿é—®</td><td>âœ… å®Œæ•´è®¿é—®</td></tr><tr><td><strong>äº‹å®å‡†ç¡®æ€§</strong></td><td>ä¸­ç­‰ï¼ˆå¯èƒ½å¹»è§‰ï¼‰</td><td>é«˜ï¼ˆåŸºäºæ–‡æ¡£ï¼‰</td></tr><tr><td><strong>çŸ¥è¯†æ—¶æ•ˆæ€§</strong></td><td>ä¾èµ–è®­ç»ƒæ•°æ®</td><td>å®æ—¶æ›´æ–°</td></tr></tbody></table>
<h3 data-id="heading-18">3.3 æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”</h3>






























<table><thead><tr><th>æ€§èƒ½æŒ‡æ ‡</th><th>ç›´æ¥è°ƒç”¨</th><th>RAGå¢å¼º</th></tr></thead><tbody><tr><td><strong>å“åº”å»¶è¿Ÿ</strong></td><td>100-500ms</td><td>500-2000ms</td></tr><tr><td><strong>ååé‡</strong></td><td>é«˜</td><td>ä¸­</td></tr><tr><td><strong>å‡†ç¡®æ€§</strong></td><td>ä¾èµ–æ¨¡å‹èƒ½åŠ›</td><td>ä¾èµ–æ£€ç´¢è´¨é‡</td></tr><tr><td><strong>å¯è§£é‡Šæ€§</strong></td><td>ä½</td><td>é«˜ï¼ˆå¯è¿½æº¯æ¥æºï¼‰</td></tr></tbody></table>
<h2 data-id="heading-19">å››ã€æ··åˆæ¶æ„ï¼šæœ€ä½³å®è·µå»ºè®®</h2>
<h3 data-id="heading-20">4.1 æ™ºèƒ½è·¯ç”±ç­–ç•¥</h3>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥ç»“åˆä¸¤ç§æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HybridAISystem</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">route_question</span>(<span class="hljs-params">self, question</span>):
        <span class="hljs-string">"""æ™ºèƒ½è·¯ç”±é—®é¢˜åˆ°åˆé€‚çš„å¤„ç†æ¨¡å¼"""</span>
        
        <span class="hljs-comment"># åˆ¤æ–­é—®é¢˜ç±»å‹</span>
        <span class="hljs-keyword">if</span> self.is_general_question(question):
            <span class="hljs-comment"># é€šç”¨é—®é¢˜ä½¿ç”¨ç›´æ¥è°ƒç”¨</span>
            <span class="hljs-keyword">return</span> self.direct_chat(question)
        <span class="hljs-keyword">elif</span> self.is_knowledge_question(question):
            <span class="hljs-comment"># çŸ¥è¯†æ€§é—®é¢˜ä½¿ç”¨RAG</span>
            <span class="hljs-keyword">return</span> self.rag_chat(question)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># é»˜è®¤ä½¿ç”¨ç›´æ¥è°ƒç”¨</span>
            <span class="hljs-keyword">return</span> self.direct_chat(question)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_general_question</span>(<span class="hljs-params">self, question</span>):
        <span class="hljs-string">"""åˆ¤æ–­æ˜¯å¦ä¸ºé€šç”¨é—®é¢˜"""</span>
        general_keywords = [<span class="hljs-string">'ä½ å¥½'</span>, <span class="hljs-string">'è°¢è°¢'</span>, <span class="hljs-string">'å¸®åŠ©'</span>, <span class="hljs-string">'ä»‹ç»'</span>, <span class="hljs-string">'è§£é‡Š'</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">any</span>(keyword <span class="hljs-keyword">in</span> question <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> general_keywords)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_knowledge_question</span>(<span class="hljs-params">self, question</span>):
        <span class="hljs-string">"""åˆ¤æ–­æ˜¯å¦ä¸ºçŸ¥è¯†æ€§é—®é¢˜"""</span>
        knowledge_keywords = [<span class="hljs-string">'æ”¿ç­–'</span>, <span class="hljs-string">'æµç¨‹'</span>, <span class="hljs-string">'è§„å®š'</span>, <span class="hljs-string">'æ‰‹å†Œ'</span>, <span class="hljs-string">'å¦‚ä½•æ“ä½œ'</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">any</span>(keyword <span class="hljs-keyword">in</span> question <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> knowledge_keywords)
</code></pre>
<h3 data-id="heading-21">4.2 éƒ¨ç½²å»ºè®®</h3>
<p><strong>å¼€å‘æµ‹è¯•ç¯å¢ƒï¼š</strong></p>
<ul>
<li>ç›´æ¥è°ƒç”¨ï¼šOllama + ç®€å•åç«¯</li>
<li>RAGç³»ç»Ÿï¼šOllama + Xinference + Chroma</li>
</ul>
<p><strong>ç”Ÿäº§ç¯å¢ƒï¼š</strong></p>
<ul>
<li>ç›´æ¥è°ƒç”¨ï¼šVLLMé›†ç¾¤ + è´Ÿè½½å‡è¡¡</li>
<li>RAGç³»ç»Ÿï¼šVLLM + Xinferenceé›†ç¾¤ + Milvus + Dify</li>
</ul>
<h2 data-id="heading-22">äº”ã€æ€»ç»“ä¸é€‰æ‹©æŒ‡å—</h2>
<h3 data-id="heading-23">5.1 å¦‚ä½•é€‰æ‹©ï¼Ÿ</h3>
<p><strong>é€‰æ‹©ç›´æ¥è°ƒç”¨å½“ï¼š</strong></p>
<ul>
<li>éœ€è¦æ¨¡å‹é€šç”¨èƒ½åŠ›å’Œåˆ›é€ åŠ›</li>
<li>å“åº”é€Ÿåº¦æ˜¯é¦–è¦è€ƒè™‘å› ç´ </li>
<li>åº”ç”¨åœºæ™¯ä¸ä¾èµ–ç‰¹å®šé¢†åŸŸçŸ¥è¯†</li>
<li>èµ„æºå’Œå›¢é˜Ÿæœ‰é™</li>
</ul>
<p><strong>é€‰æ‹©RAGç³»ç»Ÿå½“ï¼š</strong></p>
<ul>
<li>éœ€è¦åŸºäºä¼ä¸šç§æœ‰çŸ¥è¯†å›ç­”</li>
<li>äº‹å®å‡†ç¡®æ€§è‡³å…³é‡è¦</li>
<li>éœ€è¦ç­”æ¡ˆå¯è¿½æº¯å’Œå¯éªŒè¯</li>
<li>æœ‰è¶³å¤Ÿçš„æŠ€æœ¯å›¢é˜Ÿæ”¯æŒ</li>
</ul>
<h3 data-id="heading-24">5.2 æ¼”è¿›è·¯å¾„</h3>
<p>å¯¹äºå¤§å¤šæ•°ä¼ä¸šï¼Œå»ºè®®çš„æ¼”è¿›è·¯å¾„ï¼š</p>
<ol>
<li><strong>é˜¶æ®µä¸€</strong>ï¼šä»ç›´æ¥è°ƒç”¨å¼€å§‹ï¼ŒéªŒè¯åŸºç¡€éœ€æ±‚</li>
<li><strong>é˜¶æ®µäºŒ</strong>ï¼šé’ˆå¯¹ç‰¹å®šåœºæ™¯å¼•å…¥RAGèƒ½åŠ›</li>
<li><strong>é˜¶æ®µä¸‰</strong>ï¼šæ„å»ºæ··åˆç³»ç»Ÿï¼Œæ™ºèƒ½è·¯ç”±</li>
<li><strong>é˜¶æ®µå››</strong>ï¼šå®Œå–„ç›‘æ§ã€è¯„ä¼°å’Œä¼˜åŒ–ä½“ç³»</li>
</ol>
<p>ä¸¤ç§æ¨¡å¼å¹¶éäº’æ–¥ï¼Œè€Œæ˜¯äº’è¡¥çš„æŠ€æœ¯æ–¹æ¡ˆã€‚ç†è§£å„è‡ªçš„ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯ï¼Œæ‰èƒ½ä¸ºä¼ä¸šæ„å»ºæœ€åˆé€‚çš„AIèƒ½åŠ›ä½“ç³»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¡¹ç›®å¤§æ‰«é™¤ç¥å™¨ï¼šKnip â€”â€” å°†ä½ çš„ä»£ç åº“â€œç˜¦èº«â€åˆ°åº•]]></title>    <link>https://juejin.cn/post/7582861402277609506</link>    <guid>https://juejin.cn/post/7582861402277609506</guid>    <pubDate>2025-12-13T03:34:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582861402277609506" data-draft-id="7582861402277593122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¡¹ç›®å¤§æ‰«é™¤ç¥å™¨ï¼šKnip â€”â€” å°†ä½ çš„ä»£ç åº“â€œç˜¦èº«â€åˆ°åº•"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2025-12-13T03:34:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°˜ä¸–ä¸­ä¸€ä½è¿·é€”å°ä¹¦ç«¥"/> <meta itemprop="url" content="https://juejin.cn/user/3315782802490568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¡¹ç›®å¤§æ‰«é™¤ç¥å™¨ï¼šKnip â€”â€” å°†ä½ çš„ä»£ç åº“â€œç˜¦èº«â€åˆ°åº•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3315782802490568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°˜ä¸–ä¸­ä¸€ä½è¿·é€”å°ä¹¦ç«¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:34:18.000Z" title="Sat Dec 13 2025 03:34:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4121cbabaaf8414abd3325e75f5ad6b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCY5LiW5Lit5LiA5L2N6L-36YCU5bCP5Lmm56ul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766201776&amp;x-signature=8fjpS9GYqhlNjnRMb66GTXy39pk%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œéšç€é¡¹ç›®è¿­ä»£å‘¨æœŸçš„æ‹‰é•¿ï¼Œä»£ç åº“ä¸­å¾€å¾€ä¼šå †ç§¯è¶Šæ¥è¶Šå¤šçš„â€œåƒµå°¸ä»£ç â€ï¼šä¸å†ä½¿ç”¨çš„ç»„ä»¶ã€åºŸå¼ƒçš„å·¥å…·å‡½æ•°ã€é—ç•™åœ¨ <code>package.json</code> ä¸­çš„ä¾èµ–é¡¹â€¦â€¦è¿™äº›å†—ä½™ä¸ä»…å¢åŠ äº†é¡¹ç›®çš„ç»´æŠ¤æˆæœ¬ï¼Œæ‹–æ…¢äº†æ„å»ºé€Ÿåº¦ï¼Œè¿˜å¯èƒ½å› ä¸ºæœªåŠæ—¶æ›´æ–°çš„åºŸå¼ƒä¾èµ–å¸¦æ¥å®‰å…¨éšæ‚£ã€‚</p>
<p>é€šå¸¸æˆ‘ä»¬å¯èƒ½ä¼šç”¨ ESLint æ¥æ£€æŸ¥æœªä½¿ç”¨çš„å˜é‡ï¼Œæˆ–è€…æ‰‹åŠ¨å®šæœŸæ¸…ç†ã€‚ä½†å¯¹äºè·¨æ–‡ä»¶çš„æœªä½¿ç”¨å¯¼å‡ºã€æˆ–è€…æ•´ä¸ªæœªè¢«å¼•ç”¨çš„æ–‡ä»¶ï¼Œæ™®é€šçš„ Linter å¾€å¾€æ— èƒ½ä¸ºåŠ›ã€‚</p>
<p>ä»Šå¤©æˆ‘è¦ä»‹ç»çš„è¿™æ¬¾ç¥å™¨ â€”â€” <strong>Knip</strong>ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿçš„ã€‚å®ƒåƒä¸€æŠŠé”‹åˆ©çš„ç‘å£«å†›åˆ€ï¼Œèƒ½ç²¾å‡†åœ°åˆ‡å‰²æ‰ä½ é¡¹ç›®ä¸­çš„é‚£äº›â€œç´¯èµ˜â€ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯ Knipï¼Ÿ</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fknip.dev%2F" target="_blank" title="https://knip.dev/" ref="nofollow noopener noreferrer">Knip</a> æ˜¯ä¸€ä¸ªåŸºäº TypeScript ç¼–å†™çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸“é—¨ç”¨äºæŸ¥æ‰¾ JavaScript å’Œ TypeScript é¡¹ç›®ä¸­çš„<strong>æœªä½¿ç”¨æ–‡ä»¶ã€ä¾èµ–é¡¹å’Œå¯¼å‡º</strong>ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„ Linter ä¸åŒï¼ŒKnip ä¸ä»…ä»…ç›¯ç€å•ä¸ªæ–‡ä»¶çœ‹ï¼Œå®ƒä¼šåˆ†ææ•´ä¸ªé¡¹ç›®çš„ä¾èµ–å…³ç³»å›¾ã€‚è¿™æ„å‘³ç€å®ƒèƒ½å‘ç°é‚£äº›â€œè™½ç„¶è¢«å®šä¹‰äº†ä¸”æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œä½†å®é™…ä¸Šä»æœªè¢«å…¶ä»–æ–‡ä»¶å¼•ç”¨è¿‡â€çš„å­¤ç«‹ä»£ç ã€‚</p>
<h2 data-id="heading-1">Knip çš„æ ¸å¿ƒç»æŠ€</h2>
<p>Knip çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä¸»è¦æ¶µç›–ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<h3 data-id="heading-2">1. âœ‚ æŸ¥æ‰¾æœªä½¿ç”¨çš„æ–‡ä»¶ (Unused Files)</h3>
<p>å®ƒèƒ½æ‰¾å‡ºé¡¹ç›®ä¸­é‚£äº›é™é™èººç€å´ä»æœªè¢«å¯¼å…¥è¿‡çš„æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-3">2.  æŸ¥æ‰¾æœªä½¿ç”¨çš„ä¾èµ– (Unused Dependencies)</h3>
<p>å®ƒä¼šæ‰«æä½ çš„ <code>package.json</code>ï¼Œå‘Šè¯‰ä½ å“ªäº› <code>dependencies</code> å’Œ <code>devDependencies</code> å®é™…ä¸Šåœ¨ä»£ç ä¸­ä¸€æ¬¡éƒ½æ²¡ç”¨åˆ°ã€‚è¿™å¯¹äºæ¸…ç†é™ˆæ—§ä¾èµ–éå¸¸æœ‰å¸®åŠ©ã€‚</p>
<h3 data-id="heading-4">3.  æŸ¥æ‰¾æœªä½¿ç”¨çš„å¯¼å‡º (Unused Exports)</h3>
<p>è¿™æ˜¯ Knip æœ€æ€æ‰‹çº§çš„åŠŸèƒ½ã€‚é€šè¿‡åˆ†æå¯¼å…¥å¯¼å‡ºå…³ç³»ï¼Œå®ƒèƒ½æ‰¾å‡ºé‚£äº›è¢« <code>export</code> å‡ºæ¥ï¼Œä½†ä¸ä»…å½“å‰æ–‡ä»¶æ²¡ç”¨ï¼Œæ•´ä¸ªé¡¹ç›®å…¶ä»–åœ°æ–¹ä¹Ÿæ²¡ç”¨çš„å˜é‡ã€å‡½æ•°æˆ–ç±»ã€‚</p>
<h3 data-id="heading-5">4.  æŸ¥æ‰¾æœªåˆ—å‡ºçš„ä¾èµ– (Unlisted Dependencies)</h3>
<p>åè¿‡æ¥ï¼Œå®ƒä¹Ÿèƒ½å¸®ä½ å‘ç°é‚£äº›ä½ åœ¨ä»£ç é‡Œ <code>import</code> äº†ï¼Œä½†å¿˜è®°å†™åœ¨ <code>package.json</code> é‡Œçš„ä¾èµ–ï¼Œé¿å…ä¸Šçº¿åå› ä¸ºç¼ºåŒ…è€Œ crashã€‚</p>
<h3 data-id="heading-6">5.  å¼ºå¤§çš„ç”Ÿæ€æ”¯æŒ</h3>
<p>Knip å†…ç½®äº†å¯¹å„ç§ä¸»æµæ¡†æ¶å’Œå·¥å…·çš„æ’ä»¶æ”¯æŒï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li>Next.js</li>
<li>Vite, Webpack, Rollup</li>
<li>Jest, Vitest</li>
<li>Tailwind CSS</li>
<li>Storybook</li>
<li>GitHub Actions ç­‰ç­‰</li>
</ul>
<p>è¿™æ„å‘³ç€å®ƒèƒ½ç†è§£è¿™äº›å·¥å…·çš„é…ç½®æ–‡ä»¶å’Œç‰¹å®šç”¨æ³•ï¼Œä¸ä¼šè¯¯æŠ¥ï¼ˆæ¯”å¦‚æŠŠ Next.js çš„ <code>pages</code> ç›®å½•ä¸‹çš„æ–‡ä»¶å½“æˆæœªä½¿ç”¨æ–‡ä»¶ï¼‰ã€‚</p>
<h2 data-id="heading-7">å¿«é€Ÿä¸Šæ‰‹</h2>
<h3 data-id="heading-8">å®‰è£…</h3>
<p>ä½ å¯ä»¥å°† Knip ä½œä¸ºå¼€å‘ä¾èµ–å®‰è£…åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install -D knip typescript @types/node
<span class="hljs-comment"># æˆ–è€…</span>
yarn add -D knip typescript @types/node
<span class="hljs-comment"># æˆ–è€…</span>
pnpm add -D knip typescript @types/node
</code></pre>
<p><em>æ³¨æ„ï¼šKnip ä¾èµ– TypeScript è¿›è¡Œåˆ†æï¼Œå³ä½¿ä½ æ˜¯ JS é¡¹ç›®ä¹Ÿå»ºè®®å®‰è£…ã€‚</em></p>
<h3 data-id="heading-9">é…ç½® script</h3>
<p>åœ¨ <code>package.json</code> ä¸­æ·»åŠ ä¸€ä¸ªè„šæœ¬ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"knip"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"knip"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-10">è¿è¡Œ</h3>
<p>åœ¨ç»ˆç«¯æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm run knip
</code></pre>
<p>Knip ä¼šå¼€å§‹æ‰«æä½ çš„é¡¹ç›®ï¼Œå¹¶è¾“å‡ºä¸€ä»½è¯¦ç»†çš„æŠ¥å‘Šï¼Œåˆ—å‡ºæ‰€æœ‰ç–‘ä¼¼æœªä½¿ç”¨çš„é¡¹ç›®ã€‚</p>
<h2 data-id="heading-11">è¿›é˜¶é…ç½®</h2>
<p>è™½ç„¶ Knip å¾ˆæœ‰â€œçœ¼åŠ›è§â€ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å¾ˆå¤šé…ç½®ï¼Œä½†å¯¹äºå¤æ‚çš„é¡¹ç›®ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ª <code>knip.json</code> (æˆ– <code>knip.ts</code>, <code>knip.js</code>) é…ç½®æ–‡ä»¶æ¥å¾®è°ƒå®ƒçš„è¡Œä¸ºã€‚</p>
<p>ä¾‹å¦‚ï¼ŒæŒ‡å®šå…¥å£æ–‡ä»¶ï¼ˆEntry filesï¼‰å’Œå¿½ç•¥ç‰¹å®šçš„æ–‡ä»¶æˆ–ä¾èµ–ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://unpkg.com/knip@5/schema.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"entry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/index.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/cli.ts"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"project"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/*.ts!"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"ignore"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/legacy/**"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"ignoreDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"eslint-config-prettier"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"ignoreExportsUsedInFile"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><code>entry</code>: å‘Šè¯‰ Knip ä»å“ªé‡Œå¼€å§‹åˆ†æä¾èµ–å›¾ã€‚é€šå¸¸æ˜¯ä½ çš„ <code>main</code> æ–‡ä»¶æˆ–é¡µé¢å…¥å£ã€‚</li>
<li><code>ignore</code>: å¿½ç•¥æŸäº›æ–‡ä»¶ä¸è¿›è¡Œæ£€æŸ¥ã€‚</li>
<li><code>ignoreDependencies</code>: æœ‰äº›ä¾èµ–å¯èƒ½æ˜¯å…¨å±€ä½¿ç”¨çš„æˆ–è€…é€šè¿‡ Babel æ’ä»¶æ³¨å…¥çš„ï¼ŒKnip ä¹Ÿå°±æ˜¯é™æ€åˆ†ææ‰«ä¸åˆ°ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¿½ç•¥ä»¥æ¶ˆé™¤è¯¯æŠ¥ã€‚</li>
</ul>
<h2 data-id="heading-12">æœ€ä½³å®è·µå·¥ä½œæµ</h2>
<ol>
<li><strong>åˆæ¬¡æ‰«æ</strong>ï¼šè¿è¡Œ <code>knip</code>ï¼Œä½ ä¼šå¤§æ¦‚ç‡è¢«å“ä¸€è·³ï¼ˆç”šè‡³æœ‰æˆç™¾ä¸Šåƒä¸ªæŠ¥é”™ï¼‰ã€‚ä¸è¦æ…Œï¼Œè¿™å¾ˆæ­£å¸¸ã€‚</li>
<li><strong>æ’é™¤è¯¯æŠ¥</strong>ï¼šä»”ç»†æ£€æŸ¥æŠ¥å‘Šã€‚å¦‚æœæ˜¯å·¥å…·é…ç½®ï¼ˆå¦‚ Jest é…ç½®ã€Webpack é…ç½®ï¼‰è¢«è¯¯æŠ¥ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦å¯ç”¨å¯¹åº”çš„ Knip æ’ä»¶æˆ–åœ¨ <code>knip.json</code> ä¸­é…ç½®å…¥å£ã€‚</li>
<li><strong>é€æ­¥æ¸…ç†</strong>ï¼š
<ul>
<li><strong>å…ˆåˆ æ–‡ä»¶</strong>ï¼šæœªä½¿ç”¨çš„æ–‡ä»¶æ˜¯æœ€å®¹æ˜“ç¡®è®¤å’Œåˆ é™¤çš„ã€‚</li>
<li><strong>å†åˆ ä¾èµ–</strong>ï¼šç¡®è®¤ <code>package.json</code> ä¸­æœªä½¿ç”¨çš„ä¾èµ–ï¼Œå¸è½½å®ƒä»¬ã€‚</li>
<li><strong>æœ€åå¤„ç†å¯¼å‡º</strong>ï¼šå¯¹äºæœªä½¿ç”¨çš„ <code>export</code>ï¼Œä½ å¯ä»¥é€‰æ‹©åˆ é™¤å¯¼å‡ºå…³é”®å­—å˜æˆå±€éƒ¨å˜é‡ï¼Œæˆ–è€…ç›´æ¥åˆ é™¤è¯¥å‡½æ•°ã€‚</li>
</ul>
</li>
<li><strong>CI é›†æˆ</strong>ï¼šå°† <code>knip</code> åŠ å…¥åˆ°ä½ çš„ CI æµç¨‹ä¸­ï¼ˆå¦‚ GitHub Actionsï¼‰ã€‚è¿™æ ·æ¯æ¬¡æäº¤ MR æ—¶ï¼ŒKnip éƒ½ä¼šè‡ªåŠ¨æ£€æŸ¥ï¼Œé˜²æ­¢æ–°çš„â€œåƒåœ¾ä»£ç â€æ··å…¥ä¸»åˆ†æ”¯ã€‚</li>
</ol>
<h2 data-id="heading-13">æ€»ç»“</h2>
<p>ä»£ç åº“çš„ç»´æŠ¤å°±åƒæ‰“æ‰«æˆ¿é—´ï¼Œä¸ä»…è¦å‹¤æ‹‚æ‹­ï¼Œæ›´è¦å®šæœŸâ€œæ–­èˆç¦»â€ã€‚Knip ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä¸Šå¸è§†è§’ï¼Œè®©æˆ‘ä»¬èƒ½æ¸…æ™°åœ°çœ‹åˆ°é¡¹ç›®ä¸­é‚£äº›è¢«é—å¿˜çš„è§’è½ã€‚</p>
<p>å»ºè®®å¤§å®¶éƒ½åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­è¯•è¿è¡Œä¸€ä¸‹ Knipï¼Œç›¸ä¿¡æˆ‘ï¼Œå®ƒä¸€å®šä¼šç»™ä½ å¸¦æ¥â€œæƒŠå–œâ€ï¼ˆæˆ–è€…æ˜¯æƒŠå“ï¼Œå“ˆå“ˆï¼‰ã€‚è®©æˆ‘ä»¬çš„é¡¹ç›®ä¿æŒè½»é‡ã€æ•´æ´ï¼Œä»ä½¿ç”¨ Knip å¼€å§‹ï¼</p>
<hr/>
<p><strong>å‚è€ƒé“¾æ¥ï¼š</strong></p>
<ul>
<li>Knip å®˜æ–¹æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fknip.dev%2F" target="_blank" title="https://knip.dev/" ref="nofollow noopener noreferrer">knip.dev/</a></li>
<li>Knip GitHub ä»“åº“: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwebpro%2Fknip" target="_blank" title="https://github.com/webpro/knip" ref="nofollow noopener noreferrer">github.com/webpro/knip</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨ Claude Agent SDK å†™ä¸€ä¸ª DeepResearch Agent]]></title>    <link>https://juejin.cn/post/7582776967817838592</link>    <guid>https://juejin.cn/post/7582776967817838592</guid>    <pubDate>2025-12-12T10:36:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582776967817838592" data-draft-id="7582779306730995747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨ Claude Agent SDK å†™ä¸€ä¸ª DeepResearch Agent"/> <meta itemprop="keywords" content="JavaScript,AIGC,Agent"/> <meta itemprop="datePublished" content="2025-12-12T10:36:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="liruifengvæç‘ä¸°"/> <meta itemprop="url" content="https://juejin.cn/user/237150239994471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨ Claude Agent SDK å†™ä¸€ä¸ª DeepResearch Agent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/237150239994471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    liruifengvæç‘ä¸°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:36:58.000Z" title="Fri Dec 12 2025 10:36:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>æœ¬æ–‡å°†ä½¿ç”¨ Claude Agent TS SDK å†™ä¸€ä¸ª DeepResearch Agentï¼Œè¿™æ˜¯æ¥è‡ªäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-agent-sdk-demos" target="_blank" title="https://github.com/anthropics/claude-agent-sdk-demos" ref="nofollow noopener noreferrer">Claude å®˜æ–¹ç¤ºä¾‹ä»“åº“ï¼ˆPython ç‰ˆï¼‰</a> çš„ TS ç‰ˆæœ¬å®ç°ã€‚</p>
<p>å®Œæ•´ä»£ç åœ¨æˆ‘çš„ GitHub ä»“åº“ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliruifengv%2Fclaude-agent-demo" target="_blank" title="https://github.com/liruifengv/claude-agent-demo" ref="nofollow noopener noreferrer">liruifengv/claude-agent-demo</a>ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯ DeepResearch Agentï¼Ÿ</h2>
<p>DeepResearch Agent æ˜¯ä¸€ä¸ª <strong>å¤š Agent åä½œç³»ç»Ÿ</strong>ï¼Œå®ƒèƒ½å¤ŸåƒçœŸæ­£çš„ç ”ç©¶å›¢é˜Ÿä¸€æ ·å·¥ä½œï¼š</p>
<ol>
<li><strong>Lead Agentï¼ˆåè°ƒè€…ï¼‰</strong>ï¼šè´Ÿè´£åˆ†è§£ç ”ç©¶ä»»åŠ¡ï¼Œè°ƒåº¦å…¶ä»– Agent</li>
<li><strong>Researcherï¼ˆç ”ç©¶å‘˜ï¼‰</strong>ï¼šè´Ÿè´£æœç´¢ç½‘ç»œã€æ”¶é›†èµ„æ–™</li>
<li><strong>Report Writerï¼ˆæŠ¥å‘Šç¼–å†™ï¼‰</strong>ï¼šè´Ÿè´£å°†ç ”ç©¶ç»“æœæ•´ç†æˆæŠ¥å‘Š</li>
</ol>
<h2 data-id="heading-1">ä½¿ç”¨ Subagents çš„å¥½å¤„</h2>
<ul>
<li>å­ä»£ç†ä¸ä¸»ä»£ç†ä¿æŒç‹¬ç«‹çš„ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢ä¿¡æ¯è¿‡è½½å¹¶ä¿æŒäº¤äº’çš„ä¸“æ³¨ã€‚è¿™ç§éš”ç¦»ç¡®ä¿äº†ä¸“é—¨çš„ä»»åŠ¡ä¸ä¼šå°†æ— å…³çš„ç»†èŠ‚æ±¡æŸ“åˆ°ä¸»å¯¹è¯ä¸Šä¸‹æ–‡ä¸­ã€‚</li>
<li>å¤šä¸ªå­ä»£ç†å¯ä»¥åŒæ—¶è¿è¡Œï¼Œæ˜¾è‘—åŠ å¿«å¤æ‚å·¥ä½œæµç¨‹ã€‚</li>
<li>æ¯ä¸ªå­ä»£ç†éƒ½å¯ä»¥æ‹¥æœ‰å®šåˆ¶åŒ–çš„ç³»ç»Ÿæç¤ºè¯ï¼ŒåŒ…æ‹¬ç‰¹å®šé¢†åŸŸçš„ä¸“ä¸šçŸ¥è¯†ã€æœ€ä½³å®è·µå’Œé™åˆ¶ã€‚</li>
<li>å­ä»£ç†å¯ä»¥è¢«é™åˆ¶åœ¨ç‰¹å®šçš„å·¥å…·ä¸Šï¼Œä»¥é™ä½æ„å¤–è¡Œä¸ºçš„é£é™©ã€‚</li>
</ul>
<p>ä½¿ç”¨ Claude Agent TS SDKï¼Œå®ç° Subagents ç‰¹åˆ«ç®€å•ã€‚</p>
<h2 data-id="heading-2">æ¶æ„å›¾</h2>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      <span class="hljs-function">Lead <span class="hljs-title">Agent</span> <span class="hljs-params">(åè°ƒè€…)</span>                      â”‚
â”‚                   åªæœ‰ <span class="hljs-built_in">Task</span> å·¥å…·ï¼Œè´Ÿè´£è°ƒåº¦                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                   â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Researcher Ã—N   â”‚   â”‚   Report-Writer   â”‚
          â”‚  WebSearch, Write â”‚   â”‚ Glob, Read, Write â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<h2 data-id="heading-3">æ ¸å¿ƒå®ç°</h2>
<h3 data-id="heading-4">1. å®šä¹‰ Subagent</h3>
<p>åœ¨ <code>agent.ts</code> ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªä¸“ä¸šåŒ–çš„ subagentï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰ä¸“ä¸šåŒ–çš„ subagent</span>
<span class="hljs-keyword">const</span> agents = {
  <span class="hljs-attr">researcher</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">"Use this agent when you need to gather research information on any topic. "</span> +
      <span class="hljs-string">"The researcher uses web search to find relevant information, articles, and sources "</span> +
      <span class="hljs-string">"from across the internet. Writes research findings to files/research_notes/ "</span> +
      <span class="hljs-string">"for later use by report writers."</span>,
    <span class="hljs-attr">tools</span>: [<span class="hljs-string">"WebSearch"</span>, <span class="hljs-string">"Write"</span>],  <span class="hljs-comment">// å¯ä»¥æœç´¢ç½‘ç»œå’Œå†™å…¥æ–‡ä»¶</span>
    <span class="hljs-attr">prompt</span>: researcherPrompt,        <span class="hljs-comment">// ç ”ç©¶å‘˜çš„ç³»ç»Ÿæç¤ºè¯</span>
    <span class="hljs-attr">model</span>: <span class="hljs-string">"haiku"</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>,
  },
  <span class="hljs-string">"report-writer"</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">"Use this agent when you need to create a formal research report document. "</span> +
      <span class="hljs-string">"The report-writer reads research findings from files/research_notes/ and synthesizes "</span> +
      <span class="hljs-string">"them into clear, concise, professionally formatted reports in files/reports/."</span>,
    <span class="hljs-attr">tools</span>: [<span class="hljs-string">"Skill"</span>, <span class="hljs-string">"Write"</span>, <span class="hljs-string">"Glob"</span>, <span class="hljs-string">"Read"</span>], <span class="hljs-comment">// å¯ä»¥æŸ¥æ‰¾ã€è¯»å–å’Œå†™å…¥æ–‡ä»¶</span>
    <span class="hljs-attr">prompt</span>: reportWriterPrompt,     <span class="hljs-comment">// æŠ¥å‘Šæ’°å†™ç³»ç»Ÿæç¤ºè¯</span>
    <span class="hljs-attr">model</span>: <span class="hljs-string">"haiku"</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>,
  },
};
</code></pre>
<p><strong>å…³é”®ç‚¹è§£é‡Šï¼š</strong></p>
<ul>
<li><code>description</code>ï¼šå‘Šè¯‰ Lead Agent ä»€ä¹ˆæ—¶å€™åº”è¯¥è°ƒç”¨è¿™ä¸ª subagent</li>
<li><code>tools</code>ï¼šè¯¥ subagent å¯ä»¥ä½¿ç”¨çš„å·¥å…·</li>
<li><code>prompt</code>ï¼šè¯¥ subagent çš„ç³»ç»Ÿæç¤ºè¯ï¼Œå®šä¹‰å®ƒçš„è¡Œä¸º</li>
<li><code>model</code>ï¼šä½¿ç”¨çš„æ¨¡å‹</li>
</ul>
<h3 data-id="heading-5">2. Lead Agent çš„æç¤ºè¯</h3>
<p><code>prompts/lead-agent.ts</code> ä¸­å®šä¹‰äº†åè°ƒè€…çš„è¡Œä¸ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> leadAgentPrompt = <span class="hljs-string">`You are a lead research coordinator who orchestrates comprehensive multi-agent research projects.

**CRITICAL RULES:**
1. You MUST delegate ALL research and report writing to specialized subagents. You NEVER research or write reports yourself.
2. Keep ALL responses SHORT - maximum 2-3 sentences.
3. Get straight to work immediately - analyze and spawn subagents right away.

&lt;workflow&gt;
**STEP 1: ANALYZE USER REQUEST**
- Understand the research topic and scope
- Identify 2-4 distinct subtopics or angles to investigate

**STEP 2: SPAWN RESEARCHER SUBAGENTS (IN PARALLEL)**
- Use Task tool to spawn 2-4 researcher subagents simultaneously
- Give EACH researcher a specific, focused subtopic to investigate

**STEP 3: WAIT FOR RESEARCH COMPLETION**
- All researchers will complete their work and save findings
- Do NOT proceed until all researchers have finished

**STEP 4: SPAWN REPORT-WRITER SUBAGENT**
- Use Task tool to spawn ONE report-writer subagent
- Instruct it to read ALL research notes and create a synthesis report
&lt;/workflow&gt;

&lt;task_tool_usage&gt;
For researchers:
- subagent_type: "researcher"
- description: Brief description of the subtopic
- prompt: Detailed instructions on what to research

For report-writer:
- subagent_type: "report-writer"  
- description: "Synthesize research into final report"
- prompt: "Read all research notes from files/research_notes/ and create a report in files/reports/"
&lt;/task_tool_usage&gt;

// æ›´å¤šè¯·æŸ¥çœ‹ä»£ç ä»“åº“...
`</span>;
</code></pre>
<h3 data-id="heading-6">3. ç ”ç©¶å‘˜çš„æç¤ºè¯</h3>
<p><code>prompts/researcher.ts</code> å®šä¹‰äº†ç ”ç©¶å‘˜å¦‚ä½•å·¥ä½œï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> researcherPrompt = <span class="hljs-string">`You are a research specialist focused on information gathering.

**CRITICAL: You MUST use WebSearch for ALL research. You MUST save research summaries to files/research_notes/ folder.**

&lt;workflow&gt;
1. IMMEDIATELY use WebSearch with well-crafted queries
2. Use WebSearch multiple times (3-7 searches) with different angles
3. Extract key findings from WebSearch results
4. SAVE findings to files/research_notes/{topic_name}.md using Write tool
5. Return brief confirmation that research was saved

CRITICAL: NEVER rely on your own knowledge - ONLY use WebSearch results.
&lt;/workflow&gt;
// æ›´å¤šè¯·æŸ¥çœ‹ä»£ç ä»“åº“...
`</span>;
</code></pre>
<h3 data-id="heading-7">4. æŠ¥å‘Šç¼–å†™çš„æç¤ºè¯</h3>
<p><code>prompts/report-writer.ts</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> reportWriterPrompt = <span class="hljs-string">`You are a professional report writer who creates clear, concise research summaries.

**CRITICAL: You MUST read research notes from files/research_notes/ folder.**

&lt;workflow&gt;
1. Use Glob to find all research notes in files/research_notes/
2. Use Read to load each research note file
3. Synthesize all research notes into a cohesive report
4. Save to files/reports/ folder as .txt file
&lt;/workflow&gt;

&lt;requirements&gt;
- One-page length (500-800 words)
- Every claim must have a citation
- Clear, professional language
&lt;/requirements&gt;
// æ›´å¤šè¯·æŸ¥çœ‹ä»£ç ä»“åº“...
`</span>;
</code></pre>
<h3 data-id="heading-8">5. å¯åŠ¨ Agent</h3>
<p>åœ¨ <code>agent.ts</code> çš„ <code>chat()</code> å‡½æ•°ä¸­ï¼ŒæŠŠæ‰€æœ‰éƒ¨åˆ†ç»„åˆèµ·æ¥ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { query, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Query</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">SDKAssistantMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@anthropic-ai/claude-agent-sdk"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-comment">// ... çœç•¥åˆå§‹åŒ–ä»£ç </span>

  <span class="hljs-comment">// ç”¨äºä¼šè¯è¿ç»­æ€§çš„ Session ID</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">sessionId</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;

  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> userInput = <span class="hljs-keyword">await</span> <span class="hljs-title function_">askQuestion</span>();
    <span class="hljs-keyword">if</span> (!userInput) <span class="hljs-keyword">break</span>;

    <span class="hljs-comment">// å‘é€ç»™ agent</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">Query</span> = <span class="hljs-title function_">query</span>({
      <span class="hljs-attr">prompt</span>: userInput,
      <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">resume</span>: sessionId,                    <span class="hljs-comment">// æ¢å¤ä¼šè¯</span>
        <span class="hljs-attr">permissionMode</span>: <span class="hljs-string">"bypassPermissions"</span>,  <span class="hljs-comment">// è·³è¿‡æƒé™ç¡®è®¤</span>
        <span class="hljs-attr">systemPrompt</span>: leadAgentPrompt,        <span class="hljs-comment">// Lead Agent çš„æç¤ºè¯</span>
        <span class="hljs-attr">allowedTools</span>: [<span class="hljs-string">"Task"</span>],               <span class="hljs-comment">// Lead Agent åªèƒ½ç”¨ Task è°ƒåº¦ subagent</span>
        agents,                               <span class="hljs-comment">// æ³¨å†Œçš„ subagent å®šä¹‰</span>
        <span class="hljs-attr">model</span>: <span class="hljs-string">"haiku"</span>,
      },
    });

    <span class="hljs-comment">// æµå¼å¤„ç†å“åº”</span>
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> msg <span class="hljs-keyword">of</span> result) {
      <span class="hljs-keyword">switch</span> (msg.<span class="hljs-property">type</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"system"</span>:
          <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">subtype</span> === <span class="hljs-string">"init"</span>) {
            sessionId = msg.<span class="hljs-property">session_id</span>;  <span class="hljs-comment">// ä¿å­˜ session ID</span>
          }
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"assistant"</span>:
          <span class="hljs-title function_">processAssistantMessage</span>(msg, tracker, transcript);
          <span class="hljs-keyword">break</span>;
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-9">6. å¤„ç† Assistant æ¶ˆæ¯</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processAssistantMessage</span>(<span class="hljs-params">
  msg: SDKAssistantMessage,
  tracker: SubagentTracker,
  transcript: TranscriptWriter
</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// ä½¿ç”¨æ¶ˆæ¯ä¸­çš„ parent_tool_use_id æ›´æ–° tracker ä¸Šä¸‹æ–‡</span>
  <span class="hljs-keyword">const</span> parentId = msg.<span class="hljs-property">parent_tool_use_id</span>;
  tracker.<span class="hljs-title function_">setCurrentContext</span>(parentId ?? <span class="hljs-literal">undefined</span>);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> block <span class="hljs-keyword">of</span> msg.<span class="hljs-property">message</span>.<span class="hljs-property">content</span>) {
    <span class="hljs-keyword">if</span> (block.<span class="hljs-property">type</span> === <span class="hljs-string">"text"</span> &amp;&amp; block.<span class="hljs-property">text</span>) {
      <span class="hljs-comment">// è¾“å‡ºæ–‡æœ¬å†…å®¹</span>
      transcript.<span class="hljs-title function_">write</span>(block.<span class="hljs-property">text</span>, <span class="hljs-string">""</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (block.<span class="hljs-property">type</span> === <span class="hljs-string">"tool_use"</span> &amp;&amp; block.<span class="hljs-property">name</span> === <span class="hljs-string">"Task"</span>) {
      <span class="hljs-comment">// æ£€æµ‹åˆ°ç”Ÿæˆ subagent</span>
      <span class="hljs-keyword">const</span> input = block.<span class="hljs-property">input</span> || {};
      <span class="hljs-keyword">const</span> subagentType = <span class="hljs-title class_">String</span>(input.<span class="hljs-property">subagent_type</span> || <span class="hljs-string">"unknown"</span>);
      <span class="hljs-keyword">const</span> description = <span class="hljs-title class_">String</span>(input.<span class="hljs-property">description</span> || <span class="hljs-string">"no description"</span>);
      <span class="hljs-keyword">const</span> prompt = <span class="hljs-title class_">String</span>(input.<span class="hljs-property">prompt</span> || <span class="hljs-string">""</span>);

      <span class="hljs-comment">// æ³¨å†Œ subagent</span>
      <span class="hljs-keyword">const</span> subagentId = tracker.<span class="hljs-title function_">registerSubagentSpawn</span>(
        block.<span class="hljs-property">id</span> || <span class="hljs-string">""</span>,
        subagentType,
        description,
        prompt
      );

      <span class="hljs-comment">// é¢å‘ç”¨æˆ·çš„è¾“å‡º</span>
      transcript.<span class="hljs-title function_">write</span>(<span class="hljs-string">`\n\n[ğŸš€ Spawning <span class="hljs-subst">${subagentId}</span>: <span class="hljs-subst">${description}</span>]\n`</span>, <span class="hljs-string">""</span>);
    }
  }
}
</code></pre>
<h2 data-id="heading-10">è¿è¡Œæ•ˆæœ</h2>
<p>å½“ä½ è¾“å…¥"Research quantum computing developments"æ—¶ï¼Œç³»ç»Ÿä¼šï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Agent: Breaking this into 4 research areas: hardware/qubits, algorithms/applications, 
industry players/investments, and challenges/timeline. Spawning researchers.

============================================================
ğŸš€ SUBAGENT SPAWNED: <span class="hljs-attr">RESEARCHER-1</span>
============================================================
Task: Quantum hardware and qubit <span class="hljs-attr">technology</span>
============================================================

<span class="hljs-section">[ğŸš€ Spawning RESEARCHER-1: Quantum hardware and qubit technology]</span>

============================================================
ğŸš€ SUBAGENT SPAWNED: <span class="hljs-attr">RESEARCHER-2</span>
============================================================
Task: Quantum algorithms and <span class="hljs-attr">applications</span>
============================================================

<span class="hljs-section">[RESEARCHER-1]</span> â†’ WebSearch
<span class="hljs-section">[RESEARCHER-2]</span> â†’ WebSearch
<span class="hljs-section">[RESEARCHER-1]</span> â†’ Write
<span class="hljs-section">[RESEARCHER-2]</span> â†’ <span class="hljs-attr">Write</span>

============================================================
ğŸš€ SUBAGENT SPAWNED: <span class="hljs-attr">REPORT-WRITER-1</span>
============================================================
Task: Synthesize research into final <span class="hljs-attr">report</span>
============================================================

<span class="hljs-section">[REPORT-WRITER-1]</span> â†’ Glob
<span class="hljs-section">[REPORT-WRITER-1]</span> â†’ Read
<span class="hljs-section">[REPORT-WRITER-1]</span> â†’ Write

Agent: Research complete. Report saved to files/reports/quantum_computing_summary.txt
</code></pre>
<h2 data-id="heading-11">å…³é”®æ¦‚å¿µæ€»ç»“</h2>





























<table><thead><tr><th>æ¦‚å¿µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>agents</code></td><td>å®šä¹‰å¯ç”¨çš„ subagentï¼ŒåŒ…æ‹¬ descriptionã€toolsã€promptã€model</td></tr><tr><td><code>allowedTools: ["Task"]</code></td><td>Lead Agent åªèƒ½ç”¨ Task å·¥å…·æ¥è°ƒåº¦ subagent</td></tr><tr><td><code>Task</code> å·¥å…·</td><td>SDK å†…ç½®å·¥å…·ï¼Œç”¨äºç”Ÿæˆ subagent</td></tr><tr><td><code>parent_tool_use_id</code></td><td>ç”¨äºè¿½è¸ªå“ªä¸ª subagent åœ¨æ‰§è¡Œ</td></tr><tr><td><code>resume: sessionId</code></td><td>ä¿æŒä¼šè¯è¿ç»­æ€§ï¼Œæ”¯æŒå¤šè½®å¯¹è¯</td></tr></tbody></table>
<h2 data-id="heading-12">è¿è¡Œé¡¹ç›®</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½® API Key</span>
<span class="hljs-built_in">export</span> ANTHROPIC_API_KEY=your_key

<span class="hljs-comment"># è¿è¡Œ</span>
npx tsx src/research-agent/agent.ts
</code></pre>
<p>è¿™å°±æ˜¯ä½¿ç”¨ Claude Agent SDK æ„å»º DeepResearch Agent çš„æ ¸å¿ƒå®ç°â€”â€”é€šè¿‡å®šä¹‰ä¸“ä¸šåŒ–çš„ subagentï¼Œè®© AI åƒä¸€ä¸ªç ”ç©¶å›¢é˜Ÿä¸€æ ·åä½œå®Œæˆå¤æ‚çš„ç ”ç©¶ä»»åŠ¡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GLM-4.6V å®æµ‹ï¼šå½“è§†è§‰æ¨¡å‹å­¦ä¼šâ€œåŠ¨æ‰‹â€ï¼Œå®ƒç¦»â€œé¡¶å°–â€è¿˜å·®ä»€ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582763878675054619</link>    <guid>https://juejin.cn/post/7582763878675054619</guid>    <pubDate>2025-12-12T10:49:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582763878675054619" data-draft-id="7582763878674874395" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GLM-4.6V å®æµ‹ï¼šå½“è§†è§‰æ¨¡å‹å­¦ä¼šâ€œåŠ¨æ‰‹â€ï¼Œå®ƒç¦»â€œé¡¶å°–â€è¿˜å·®ä»€ä¹ˆï¼Ÿ"/> <meta itemprop="keywords" content="LLM,ChatGLM (æ™ºè°±)"/> <meta itemprop="datePublished" content="2025-12-12T10:49:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="302AI"/> <meta itemprop="url" content="https://juejin.cn/user/4158793214076603"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GLM-4.6V å®æµ‹ï¼šå½“è§†è§‰æ¨¡å‹å­¦ä¼šâ€œåŠ¨æ‰‹â€ï¼Œå®ƒç¦»â€œé¡¶å°–â€è¿˜å·®ä»€ä¹ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4158793214076603/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    302AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:49:34.000Z" title="Fri Dec 12 2025 10:49:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4beb558855fb44579149e8f6a57e39f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=YcJ9b34mwsa735yEha6I%2FzSSMco%3D" alt="20251212-183330.jpg" loading="lazy"/></p>
<p>æ™ºè°± AI äº 12 æœˆ 8 æ—¥æ­£å¼å¼€æºäº†å…¶æ–°ä¸€ä»£å¤šæ¨¡æ€æ¨¡å‹ <strong>GLM-4.6V</strong> ç³»åˆ—ï¼ŒåŒ…å«é¢å‘é«˜æ€§èƒ½åœºæ™¯çš„ 106B ç‰ˆæœ¬ä¸è½»é‡æœ¬åœ°éƒ¨ç½²çš„ 9B Flash ç‰ˆã€‚æ­¤æ¬¡å‡çº§ä¸ä»…å°†è®­ç»ƒä¸Šä¸‹æ–‡çª—å£ä¸€ä¸¾æ¨è‡³ 128K tokensï¼Œæ›´åœ¨æ¨¡å‹æ¶æ„ä¸­åšäº†ä¸€ä¸ªå…³é”®å˜é©ï¼šè®©å·¥å…·è°ƒç”¨ï¼ˆFunction Callï¼‰æˆä¸ºè§†è§‰æ¨¡å‹çš„åŸç”Ÿèƒ½åŠ›ã€‚è¿™æ„å‘³ç€ï¼Œæ¨¡å‹ä¸å†æ­¢æ­¥äºè¯†åˆ«å›¾åƒï¼Œè€Œæ˜¯èƒ½è‡ªä¸»è°ƒç”¨å·¥å…·ã€å¤„ç†ç»“æœå¹¶æŒç»­æ‰§è¡Œâ€”â€”ä»çœ‹æ¸…ä¸–ç•Œåˆ°åŠ¨æ‰‹å®Œæˆçš„è·¯å¾„è¢«é¦–æ¬¡å½»åº•æ‰“é€šã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cecf310a9b342199e020eadf50c9293~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=pKvIv9dMlJ9T7%2B4n2Nw9DyswhFE%3D" alt="" loading="lazy"/></p>
<p>å…¶ä¸­æœ€å€¼å¾—å…³æ³¨çš„çªç ´ï¼Œæ˜¯ â€œ<strong>å›¾åƒå³å‚æ•°ï¼Œç»“æœå³ä¸Šä¸‹æ–‡</strong>â€ è¿™ä¸€è®¾è®¡ç†å¿µã€‚ä¼ ç»Ÿå¤šæ¨¡æ€æµç¨‹ä¸­ï¼Œå›¾åƒéœ€å…ˆè½¬ä¸ºæ–‡å­—æè¿°å†è°ƒç”¨å·¥å…·ï¼Œç¯èŠ‚ç¹çä¸”ä¿¡æ¯æ˜“æŸè€—ã€‚è€Œ GLM-4.6V å…è®¸æˆªå›¾ã€å›¾è¡¨ã€æ–‡æ¡£é¡µé¢ç­‰ç›´æ¥ä½œä¸ºå·¥å…·å‚æ•°è¾“å…¥ï¼Œå¹¶å¯å°†å·¥å…·è¿”å›çš„å›¾ç‰‡ã€ç½‘é¡µç­‰é‡æ–°çº³å…¥è§†è§‰ç†è§£é“¾è·¯ï¼Œå®ç°é—­ç¯ä»»åŠ¡å¤„ç†ã€‚æ— è®ºæ˜¯æ ¹æ®è¡—æ‹å›¾è‡ªåŠ¨è°ƒç”¨æœå›¾å·¥å…·æ¯”ä»·ç”Ÿæˆå¯¼è´­æ¸…å•ï¼Œè¿˜æ˜¯è§£æé•¿æ–‡æ¡£åè·¨é¡µæŠ½å–æ•°æ®åˆ¶æˆå¯¹æ¯”è¡¨æ ¼ï¼Œæ¨¡å‹éƒ½èƒ½åœ¨å•æ¬¡æ¨ç†ä¸­è‡ªä¸»è§„åˆ’å¹¶å®Œæˆã€‚</p>
<p>åœ¨æ€§èƒ½è¡¨ç°ä¸Šï¼ŒGLM-4.6V åŒæ ·ç»™å‡ºäº†æ‰å®çš„æˆç»©ã€‚åœ¨ MMBenchã€MathVistaã€OCRBench ç­‰ <strong>30 ä½™é¡¹å¤šæ¨¡æ€è¯„æµ‹ä¸­ï¼Œå…¶æ•´ä½“ç²¾åº¦è¾¾åˆ°åŒå‚æ•°è§„æ¨¡ä¸‹çš„</strong> <strong>SOTA</strong> <strong>æ°´å¹³</strong>ã€‚å…·ä½“æ¥çœ‹ï¼Œ9B è½»é‡ç‰ˆæ•´ä½“è¡¨ç°å·²è¶…è¶Š Qwen3-VL-8Bï¼Œè€Œ 106B ç‰ˆæœ¬åˆ™å‡­å€Ÿ 12B æ¿€æ´»å‚æ•°ï¼Œåœ¨å¤šé¡¹ä»»åŠ¡ä¸­æ¯”è‚©å‚æ•°é‡ 2 å€äºè‡ªèº«çš„ Qwen3-VL-235Bï¼Œæ˜¾ç¤ºå‡ºä¼˜å¼‚çš„æ•ˆç‡ä¸èƒ½åŠ›ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12db2b9ed57b43a2bd1fc2ef6868d46c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=trASKF8Lo06GJklVma%2F40ElC6Bo%3D" alt="" loading="lazy"/></p>
<p>å…·ä½“è½åœ°åˆ°åº”ç”¨å±‚é¢ï¼ŒGLM-4.6V é€‚é…å››å¤§æ ¸å¿ƒåœºæ™¯ï¼š</p>
<ol>
<li>
<p><strong>æ™ºèƒ½å›¾æ–‡åˆ›ä½œ</strong>ï¼šèƒ½ç†è§£å¤æ‚å›¾æ–‡å¹¶è‡ªåŠ¨è°ƒç”¨å·¥å…·é…å›¾ã€å®¡æ ¸è´¨é‡ï¼Œç›´æ¥è¾“å‡ºç»“æ„åŒ–å†…å®¹</p>
</li>
<li>
<p><strong>è§†è§‰è´­ç‰©å¯¼è´­</strong>ï¼šå¯å®Œæˆä»è¯†å›¾ã€æ¯”ä»·åˆ°ç”Ÿæˆå¯¼è´­æ¸…å•çš„å®Œæ•´æµç¨‹</p>
</li>
<li>
<p><strong>å‰ç«¯ä»£ç å¤åˆ»</strong>ï¼šèƒ½å¤Ÿå®ç°æ¥è¿‘åƒç´ çº§çš„ç½‘é¡µè®¾è®¡ç¨¿è¿˜åŸï¼Œå¹¶æ”¯æŒåŸºäºæˆªå›¾çš„è‡ªç„¶è¯­è¨€äº¤äº’ä¿®æ”¹</p>
</li>
<li>
<p><strong>é•¿æ–‡æ¡£ä¸è§†é¢‘ç†è§£</strong>ï¼šå¾—ç›Šäº 128K é•¿ä¸Šä¸‹æ–‡ï¼Œå¯ä¸€æ¬¡æ€§å¤„ç†ç™¾ä½™é¡µæ–‡æ¡£æˆ–å°æ—¶çº§è§†é¢‘ï¼Œå®ç°è·¨é¡µã€è·¨å¸§çš„æ·±åº¦åˆ†æä¸ä¿¡æ¯ç²¾å‡†å®šä½</p>
</li>
</ol>
<p>æ­¤ç•ªå‡çº§è¿˜ä¼´éšç€å¤§å¹…é™ä»·â€”â€”API è°ƒç”¨ä»·æ ¼è¾ƒä¸Šä¸€ä»£é™ä½ 50%ï¼Œè½»é‡ç‰ˆ GLM-4.6V-Flash æ›´å°†å…è´¹å¼€æ”¾ã€‚å¯è°“æ˜¯èƒ½åŠ›è·ƒè¿›ä¸æˆæœ¬ä¼˜åŒ–åŒé‡é©±åŠ¨ã€‚</p>
<p>302.AI ç°å·²æ¥å…¥ GML-4.6V ç³»åˆ—æ¨¡å‹ APIï¼Œæœ¬æœŸå®æµ‹å°†é’ˆå¯¹ GLM-4.6V å±•å¼€å¤šç»´åº¦çš„å®æµ‹å¯¹æ¯”ï¼Œç›´è§‚æ„Ÿå—å…¶åœ¨å¤šæ¨¡æ€ä»»åŠ¡ä¸­çš„å®é™…åº”ç”¨è¡¨ç°ã€‚</p>
<h3 data-id="heading-0">I. å®æµ‹æ¨¡å‹åŸºç¡€ä¿¡æ¯</h3>
<p><strong>ï¼ˆ1ï¼‰å„å®æµ‹æ¨¡å‹åœ¨ 302.AI çš„ä»·æ ¼ï¼š</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf1631bc229445cd9672a2ff939f6445~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=e7tXhDPaPEyhHITJK44Gi4UYdPE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-1">ï¼ˆ2ï¼‰æµ‹è¯„ç›®çš„ï¼š</h4>
<p>æœ¬è¯„æµ‹ä¾§é‡æ¨¡å‹å¯¹é€»è¾‘ï¼Œæ•°å­¦ï¼Œç¼–ç¨‹ï¼Œäººç±»ç›´è§‰ï¼Œå¤šæ¨¡æ€ç­‰é—®é¢˜çš„æµ‹è¯•ï¼Œéä¸“ä¸šå‰æ²¿é¢†åŸŸçš„æƒå¨æµ‹è¯•ã€‚æ—¨åœ¨è§‚å¯Ÿå¯¹æ¯”æ¨¡å‹çš„è¿›åŒ–è¶‹åŠ¿ï¼Œæä¾›é€‰å‹å‚è€ƒã€‚</p>
<h4 data-id="heading-2">ï¼ˆ3ï¼‰æµ‹è¯„æ–¹æ³•ï¼š</h4>
<p>æœ¬æ¬¡æµ‹è¯„ä½¿ç”¨302.AIæ”¶å½•çš„é¢˜åº“è¿›è¡Œç‹¬ç«‹æµ‹è¯•ã€‚3æ¬¾æ¨¡å‹åˆ†åˆ«å°±é€»è¾‘ä¸æ•°å­¦ï¼ˆå…±10é¢˜ï¼‰ï¼Œäººç±»ç›´è§‰ï¼ˆå…±7é¢˜ï¼‰ï¼Œç¼–ç¨‹æ¨¡æ‹Ÿï¼ˆå…±12é¢˜ï¼‰ä»¥åŠå¤šæ¨¡æ€æ¨ç†ï¼ˆå…±20é¢˜ï¼‰è¿›è¡Œæ¡ˆä¾‹æµ‹è¯•ï¼Œå¯¹åº”è®°åˆ†è§„åˆ™å–æœ€ç»ˆç»“æœï¼Œä¸‹æ–‡é€‰å–ä»£è¡¨æ€§æ¡ˆä¾‹è¿›è¡Œå±•ç¤ºã€‚</p>
<p>é¢˜åº“åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fspreadsheets%2Fd%2F1sBxs60yWsxc9I5Va8Rjc1_le1Omg2hOXbwqOzpImZio%2Fedit%3Fgid%3D0%23gid%3D0" target="_blank" title="https://docs.google.com/spreadsheets/d/1sBxs60yWsxc9I5Va8Rjc1_le1Omg2hOXbwqOzpImZio/edit?gid=0#gid=0" ref="nofollow noopener noreferrer">docs.google.com/spreadsheetâ€¦</a></p>
<p>ğŸ’¡<strong>è®°åˆ†è§„åˆ™ï¼š</strong></p>
<p>æŒ‰æ»¡åˆ†10åˆ†è®°åˆ†ï¼Œè®¾å®šå¯¹åº”æ‰£åˆ†æ ‡å‡†ï¼Œæœ€ç»ˆå–æ¯è½®å¾—åˆ†çš„å¹³å‡å€¼ã€‚</p>
<h4 data-id="heading-3">ï¼ˆ4ï¼‰æµ‹è¯„å·¥å…·ï¼š</h4>
<p>302.AI çš„APIè¶…å¸‚â†’åœ¨çº¿ä½¿ç”¨</p>
<h3 data-id="heading-4"><strong>II. æµ‹è¯•ç»“æœæ€»è§ˆ</strong></h3>
<h4 data-id="heading-5"><strong>302.AI é¢˜åº“æµ‹è¯•ç»“æœï¼š</strong></h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/936e8524398b4459bc5f639e2d9c23e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=cvKsvG3FuYi2%2FYIqy%2BMHBJZJC2c%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffdededf9e004ef3980f68c4275510fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=owSTBsGkmVV6IjYct25R0HahkKo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6"><strong>302.AI å¤šæ¨¡æ€æ¨¡å‹æµ‹è¯„åˆ†æ•°æ€»æ¦œå•ï¼š</strong></h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78af8656b6d54429b255a182a2528685~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=bywaXYg9tG6lIPSJGJyix90131Q%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7"><strong>III. æ¡ˆä¾‹å±•ç¤º</strong></h3>
<p>ä¸‹æ–‡ä¸»è¦å±•ç¤ºå¤šæ¨¡æ€ç›¸å…³æ¡ˆä¾‹</p>
<h4 data-id="heading-8">æ¡ˆä¾‹1ï¼šé€»è¾‘æ¨ç†</h4>
<p><strong>æµ‹è¯•ç‚¹ï¼šç»†ç²’åº¦æ„ŸçŸ¥ï¼Œæ¨ç†èƒ½åŠ›ï¼Œå› æœä¸äº‹ä»¶åˆ¤æ–­</strong></p>
<blockquote>
<p><strong>æç¤ºè¯</strong>ï¼šä¸‰ç»´è§†è§’å›¾å½¢æ¨æ–­ï¼šè¯·ä»ABCDä¸­é€‰å‡ºæ­£ç¡®è§†è§’</p>
<p><strong>ç­”æ¡ˆ</strong>ï¼šC</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1395ddca2fda4821859a9730bea503c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=49crpq4roCZ3v3p2534ixFWZkEU%3D" alt="" loading="lazy"/></p>
<p><strong>GLM-4.6V æ¨æ–­é”™è¯¯</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2d7a291a8114008bc445d500727c9ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=f7AE6zBEZO%2FScx4ahUmv77lfHhc%3D" alt="" loading="lazy"/></p>
<p>é™„ <strong>GPT-5.1</strong> å’Œ <strong>Gemini 3 Pro</strong> çš„ç­”æ¡ˆï¼Œå‡æ¨æ–­æ­£ç¡®ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9313632a82134fc6a1c13cc34cdf358e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=Q1B2UUyA97Czvzhh5skzXD1ZjVo%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c20904049f7e4152b6a250ee7d306bd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=0LEMJr3VXYDQ%2BHYAGOghVnSexSs%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>æç¤ºè¯</strong>ï¼šè¯·å°†å›¾ä¸­æ‰“ä¹±é¡ºåºçš„æ¼«ç”»æŒ‰ç…§é€»è¾‘æ’åˆ—å‡ºæ­£ç¡®é¡ºåº <strong>æ­£ç¡®ç­”æ¡ˆ</strong>ï¼šEâ†’Fâ†’Aâ†’Câ†’Bâ†’D</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a342fbb2813a47d48064dc5b98cf0a28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=dUH%2FI1SYcXsDf51GYgizzC12%2FNI%3D" alt="" loading="lazy"/></p>
</blockquote>
<p><strong>GLM-4.6V è¯¯è¯»äº†å›¾Fæ‰€ç¤ºçš„é¸ŸæŒæªçš„æ„å›¾ï¼Œ</strong> åç¦»æ¼«ç”»åŸæœ¬é€»è¾‘å¯¼è‡´æ’åºç­”æ¡ˆé”™è¯¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11a8fbfdea5e4c579f2c2b9765b9801f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=ABP3cVsOjadhqjTQZgVu8P7qQFQ%3D" alt="" loading="lazy"/></p>
<p>é™„ <strong>GPT-5.1</strong> çš„å›ç­”ï¼Œä»…æœ‰Bå’ŒCè¿™ä¸¤ä¸ªå®¹æ˜“æ··æ·†çš„å›¾é¡ºåºé”™è¯¯ï¼Œå…¶ä»–é¡ºåºæ’åˆ—æ­£ç¡®ï¼Œæ¼«ç”»å†…æ¶µè§£è¯»ä¸Šå·²ç»éå¸¸æ¥è¿‘åŸæ„äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9449372b30040a4893094f813fd85a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=ScRaIg69rnonfYb%2FB7mc%2FX9Ztpw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-9">æ¡ˆä¾‹2ï¼šè®¤çŸ¥ä¸æ–‡åŒ–ç†è§£</h4>
<p><strong>æµ‹è¯•ç‚¹ï¼šåŸºç¡€æ„ŸçŸ¥ï¼Œé€»è¾‘å…³è”ï¼Œä¸–ç•ŒçŸ¥è¯†ï¼Œæ–‡åŒ–ç†è§£</strong></p>
<blockquote>
<p><strong>æç¤ºè¯</strong>ï¼š</p>
<p>å›¾ä¸­ä½œå“å±äºä»¥ä¸‹å“ªä¸€ç§é£æ ¼ï¼Ÿ</p>
<p>Aï¼šå°è±¡æ´¾ï¼ŒBï¼šåå°è±¡æ´¾ï¼ŒCï¼šç°ä»£ä¸»ä¹‰ï¼ŒDï¼šè¾¾è¾¾ä¸»ä¹‰</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bba3c7c4e1342ffa0e29e8a839f28ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=O65qeFLb5cxnl4yC6ljR%2FjG1ONU%3D" alt="" loading="lazy"/></p>
</blockquote>
<p><strong>GLM-4.6V åˆ¤æ–­æ­£ç¡®</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56b31ab0c5914f15932094bf4004a131~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=DKT3HKkUy0DjZ86gToHeEbwFmaQ%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>æç¤ºè¯</strong>ï¼šè¯·åˆ¤æ–­å›¾ä¸Šè¡¨æƒ…åŒ…æƒ³è¡¨è¾¾ä»€ä¹ˆï¼Ÿ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34a86fb2f55d41358567a6a0fc0b3150~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=SqXp%2Br%2BMePQ9bYQeR7RFQgwawSc%3D" alt="" loading="lazy"/></p>
</blockquote>
<p><strong>GLM-4.6V ä¼¼ä¹å¹¶æœªèƒ½ç†è§£</strong>è¿™ä¸ªæ¢—å›¾çš„èƒŒåå«ä¹‰ï¼Œåªè¾“å‡ºäº†ä¸€äº›è¡¨å±‚ç†è§£ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bd4ef30822a438c84f1809ad7d49252~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=lOc%2BY1ruu0xHTLhrZFwyrn6rAm0%3D" alt="" loading="lazy"/></p>
<p>é™„ <strong>Gemini 3</strong> <strong>Pro</strong> çš„æ»¡åˆ†å›ç­”ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/777334a0e83d4ffaaefe75085f8a8a3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=vEnWVHYlIhrfly2%2BMjLaNztNO4Q%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>æç¤ºè¯</strong>ï¼šè¿™åˆ™æ¼«ç”»æƒ³è¡¨è¾¾ä»€ä¹ˆï¼Ÿ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d97d7ccb6085495793304a5eca18f145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=ocs%2Fq1XQmFzGDlNxKbRl4yMn9GM%3D" alt="" loading="lazy"/></p>
</blockquote>
<p><strong>GLM-4.6V åˆ¤æ–­åŸºæœ¬æ­£ç¡®ï¼Œæ¨æ–­åˆç†</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7caa928ed615444fb61cba09414ef4e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=E8caKnBqKnLnj%2FZzDBx%2FqKOKUEk%3D" alt="" loading="lazy"/></p>
<p>å†æ¥çœ‹çœ‹ä¾ç„¶ç¨³å®šå‘æŒ¥çš„ <strong>Gemini 3 Pro</strong> çš„å›ç­”ï¼Œä»å¹½é»˜æ„Ÿå’Œâ€œä¸ªæ€§â€æ¥è®²ï¼Œä¸ Gemini 3 Pro çš„å¯¹æ¯”æ˜¾å¾— GLM-4.6V çš„è¾“å‡ºè¾ƒä¸ºç†æ€§åŠ¡å®</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/713de30fd41a45caa94d7d8282da86aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=WnmThB3aMGYEGwpOnIJomQgyx%2Bk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-10">æ¡ˆä¾‹3ï¼šOCRè¯†åˆ«</h4>
<p><strong>æµ‹è¯•ç‚¹ï¼šæ¨¡ç³Šä¿¡æ¯è¯†åˆ«ã€æ•°æ®æå–ã€å›¾è¡¨åˆ†æ</strong></p>
<p>ç»™å‡ºä¸€å¼ æ¨¡ç³Šä¸”æœ‰å­—è¿¹é®ç›–çš„ä¿¡æ¯å›¾ç‰‡</p>
<blockquote>
<p><strong>æç¤ºè¯</strong>ï¼šå°†å›¾ä¸­è¡¨æ ¼è¯†åˆ«ä¸ºå¯ç›´æ¥å¤åˆ¶çš„Markdownå†…å®¹</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/778a3d1ac5dc4496add535481e40a320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=WmcGkJXBHt5GGoUoKo8EUF%2BTeWQ%3D" alt="" loading="lazy"/></p>
<p><strong>GLM-4.6V è¿”å›çš„å†…å®¹å¦‚ä¸‹ï¼Œæ¸…æ™°ç›´è§‚ï¼ŒåŸºæœ¬æ— è¯¯</strong>ï¼Œä¿¡æ¯ç¼ºå¤±éƒ¨åˆ†ä¹Ÿæ ‡æ³¨äº†â€œæœªå¡«å†™â€</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88c85e036f9a46ee8bd9151fa95a994a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=kiHhcG4rWuFr5idrWGpOjmxC2zE%3D" alt="" loading="lazy"/></p>
<p>è¿›é˜¶ä¸€ä¸‹ï¼Œå°è¯•è®©æ¨¡å‹å°†è¿™ä¸ªå›¾è¡¨ä¿¡æ¯å¤„ç†ä¸ºå¯è§†åŒ–æ•°æ®å›¾ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9a10ec9410948678ae6734f6353c024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=J9D2SyAeI5%2BmlJoYQrPO8tmUdUQ%3D" alt="" loading="lazy"/></p>
<p>GLM-4.6V å‡†ç¡®æå–ä¿¡æ¯åç”Ÿæˆäº†å¯¹åº”çš„åŸºç¡€æ•°æ®è¡¨æ ¼ã€ç¥¨æˆ¿å æ¯”é¥¼çŠ¶å›¾ã€å‘¨åº¦ç¥¨æˆ¿æŸ±çŠ¶å›¾ä»¥åŠæ•°æ®å¡ç‰‡ï¼Œ<strong>ä½†æ˜¯ç”Ÿæˆçš„é¥¼çŠ¶å›¾å­˜åœ¨æ˜æ˜¾æ•°æ®é”™è¯¯ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8d156f840a84bc898cec4d1164cd6f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=VII9b5VDb6UtJw47Dt2VfM6sadc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">æ¡ˆä¾‹4ï¼šå‰ç«¯å¤åˆ»</h4>
<p><strong>æµ‹è¯•ç‚¹ï¼šè§†è§‰ç†è§£åŠ +å·¥å…·è°ƒç”¨</strong></p>
<blockquote>
<p><strong>æç¤ºè¯</strong>ï¼šå¤åˆ»å›¾ä¸­ç½‘é¡µ</p>
</blockquote>
<p>å¯¹äºè¿™ä¸ª Suno ç½‘é¡µçš„å¤åˆ»æ¡ˆä¾‹ï¼ŒGLM-4.6V çš„å®Œæˆåº¦ç®—ä¸­è§„ä¸­çŸ©ï¼ŒæŠ›å¼€å¤æ‚çš„äº¤äº’é€»è¾‘ï¼Œ<strong>å•ä»å¸ƒå±€å’ŒåŸºæœ¬å†…å®¹çš„è§†è§‰è¿˜åŸæ¥è®²ï¼Œå¹¶æœªå®ç°æ‰€è°“â€œ</strong> <strong>åƒç´ </strong> <strong>çº§å‰ç«¯å¤åˆ»â€</strong> ï¼ˆä¾‹å¦‚ç¬¬äºŒé¡µä½œè€…åâ€œMojanoâ€å†™é”™ä¸ºâ€œMojavaâ€ï¼‰ï¼Œæ ·å¼ç»†èŠ‚ä¹Ÿå­˜åœ¨åå·®ï¼ˆç¬¬äºŒé¡µæ­Œæ›²å¡ç‰‡çš„æ’­æ”¾é‡ä½ç½®å˜ä¸ºäº†å³ä¸‹è§’ï¼‰ç­‰é—®é¢˜</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3aed82b6ba8f415d8d6b9850708d116f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=W6V8%2B2RDNiP%2BbkAB7PDGNYsoD4k%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12">æ¡ˆä¾‹5ï¼šè§†é¢‘ç†è§£</h4>
<p><strong>æµ‹è¯•ç‚¹ï¼šè§†é¢‘ç†è§£ï¼Œç»†ç²’åº¦æ¨ç†</strong></p>
<p>ç»™å‡ºä¸€æ®µ AI ç”Ÿæˆå­˜åœ¨æ˜æ˜¾bugçš„è§†é¢‘ï¼Œè®©æ¨¡å‹åˆ†æè¿™æ®µè§†é¢‘æ‰€å‡ºç°çš„ä¸åˆç†ä¹‹å¤„</p>
<p><strong>GLM-4.6V çš„å›ç­”å¹¶æœªæŠ“ä½é‡ç‚¹</strong>ï¼Œçœ‹ä¼¼è¨€ä¹‹æœ‰ç†ï¼Œä½†è§†é¢‘æ‰€æè¿°ç”»é¢å¹¶éå‘ç”Ÿåœ¨ç½šçƒæƒ…å†µä¸‹ï¼Œæ•…æ¨ç†æœ‰è¯¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f07e6f8481f4475a8b539ebfb029eb0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=sw7prT2jn4Yw2QZuffDALsUgndg%3D" alt="" loading="lazy"/></p>
<p>é™„ <strong>Gemini 3</strong> <strong>Pro</strong> ****çš„å›ç­”ï¼Œèµ·ç æ˜ç¡®æŒ‡å‡ºäº†ç©¿æ¨¡æ¼æ´å’Œäººç‰©è¿åŠ¨è½¨è¿¹è¿åç‰©ç†å¸¸è¯†çš„é—®é¢˜ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e9ea8cb6a2e464e9db542d709b1d98c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=dUTtY5uXo68xq3xnQC6ZJ%2BktC8Q%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-13"><strong>IV. GLM-4.6V æ¨¡å‹å®æµ‹ç»“è®º</strong></h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f6ee9f36b474455abfec10aab6a531b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=zWpOQ2m3n7b6yjxExxCQape12Q8%3D" alt="" loading="lazy"/></p>
<p>åŸºäºæœ¬æ¬¡å®æµ‹ï¼Œæˆ‘ä»¬å¯¹ GLM-4.6V å¯ä»¥å¾—å‡ºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»“è®ºï¼š</p>
<p>é¦–å…ˆï¼Œå¿…é¡»æ‰¿è®¤ï¼ŒGLM-4.6V ç±»ä¼¼äºä¸€ä½ç‰¹ç‚¹é²œæ˜çš„â€œåç§‘ç”Ÿâ€ï¼Œä»å…¶åœ¨ä¸åŒç»´åº¦çš„æµ‹è¯„è¡¨ç°æ¥çœ‹ï¼Œæ¨¡å‹å‘æŒ¥å­˜åœ¨æ˜¾è‘—çš„åœºæ™¯åˆ†åŒ–ï¼Œå·¥ç¨‹å®ç”¨æ€§å¼ºï¼Œè€Œè®¤çŸ¥çµæ´»æ€§ç¨æ˜¾ä¸è¶³ï¼Œè¿™è¡¨æ˜æ¨¡å‹çš„æ ¸å¿ƒèƒ½åŠ›èšç„¦äºæ‰§è¡Œè€Œéæ„ŸçŸ¥ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>å…¶çªç ´ç‚¹åœ¨äºæ¶æ„è®¾è®¡æ‰€æŒ‡å‘çš„å·¥å…·è°ƒç”¨ä¸ä»»åŠ¡é—­ç¯èƒ½åŠ›</strong> <strong>ï¼Œ</strong> <strong>è€Œéæ³›åŒ–çš„å¤šæ¨¡æ€ç†è§£ç²¾åº¦</strong>ã€‚</p>
<p>å…¶æ¬¡ï¼Œè¿™ç§â€œåç§‘â€ä½“ç°åœ¨å…·ä½“è¡¨ç°ä¸Šï¼šåœ¨OCRè¡¨æ ¼è¯†åˆ«ã€è‰ºæœ¯é£æ ¼åˆ¤æ–­ç­‰ç»“æ„åŒ–ã€æœ‰æ˜ç¡®è§„åˆ™çš„ä»»åŠ¡ä¸­ï¼Œå®ƒè¾“å‡ºç¨³å®šã€ç†æ€§è§„èŒƒï¼Œå±•ç°å‡ºæ‰å®çš„å·¥ç¨‹åŒ–æ½œåŠ›ã€‚ç„¶è€Œï¼Œä¸€æ—¦é¢ä¸´éœ€è¦å¼ºæ¨ç†ï¼ˆå¦‚ä¸‰ç»´ç©ºé—´æƒ³è±¡ã€æ¼«ç”»é€»è¾‘æ’åºï¼‰æˆ–æ·±å±‚æ¬¡æ–‡åŒ–ç†è§£ï¼ˆå¦‚è§£è¯»ç½‘ç»œæ¢—å›¾ï¼‰çš„åœºæ™¯æ—¶ï¼Œå®ƒä¾¿å®¹æ˜“æ˜¾å¾—ç…§æœ¬å®£ç§‘ï¼Œç¼ºä¹ä¸€ä¸çµæ€§å’Œç²¾å‡†åº¦ã€‚</p>
<p>è¿™ä¸€åˆ†åŒ–æ°æ°æ­ç¤ºäº†å®ƒçš„é€‚ç”¨åœºæ™¯â€”â€”å³<strong>åœ¨å¤„ç†å®šä¹‰æ¸…æ™°çš„ä»»åŠ¡æ—¶æ›´å…·ä¼˜åŠ¿</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºé‚£äº›éœ€è¦ä»å¤æ‚æ–‡æ¡£ä¸­æå–ä¿¡æ¯ã€å°†å›¾è¡¨è½¬åŒ–ä¸ºæ•°æ®ã€æˆ–è¿›è¡Œæ ‡å‡†åŒ–è¯†åˆ«çš„å®é™…ä»»åŠ¡ï¼ŒGLM-4.6V ä¼šæ˜¯ä¸€ä¸ªé«˜æ•ˆã€å¯ä¿¡çš„å·¥å…·ã€‚ç»“åˆ API ä»·æ ¼çš„å¤§å¹…ä¸‹è°ƒä¸è½»é‡ç‰ˆçš„å…è´¹å¼€æºç­–ç•¥ï¼Œä¹Ÿç®—æ˜¯ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªé«˜æ€§ä»·æ¯”çš„è§†è§‰ä»»åŠ¡è‡ªåŠ¨åŒ–å…¥å£ã€‚</p>
<p>ç»¼åˆè€Œè¨€ï¼ŒGLM-4.6V ä»£è¡¨äº†ä¸€æ¡åŠ¡å®çš„æŠ€æœ¯è·¯å¾„ï¼š å®ƒä¸æ‰§ç€äºåœ¨æ‰€æœ‰æ„ŸçŸ¥èµ›é“ä¸Šäº‰å† ï¼Œè€Œæ˜¯èšç„¦äºå°†è§†è§‰ä¿¡å·åˆ‡å®è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„åŠ¨ä½œã€‚ä½†åŒæ—¶ï¼Œå…¶åœ¨çœŸå®ä»»åŠ¡ä¸­ä¸é¡¶å°–é—­æºæ¨¡å‹çš„å¯¹æ¯”è¡¨ç°ä¹Ÿæ¸…æ™°åœ°æé†’æˆ‘ä»¬ï¼š åœ¨å¥‹åŠ›å¥”å‘æ‰§è¡Œé«˜åœ°æ—¶ï¼Œä½œä¸ºåŸºçŸ³çš„æ„ŸçŸ¥ä¸è®¤çŸ¥åŸºæœ¬åŠŸï¼Œä»éœ€æŒç»­é”¤ç‚¼ï¼Œé‚£æ®µå¯æå‡ç©ºé—´ä¾ç„¶æ˜¯å…¶è¿ˆå‘é¡¶å°–è¿‡ç¨‹ä¸­ä¸å¯å¿½è§†çš„è¿½ç´¢ä¹‹è·¯ã€‚</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26e0c9b096e44506936c033ce0386450~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzAyQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766141374&amp;x-signature=LaT7zg0fC%2B7x6%2BiBP5iEulLeOpk%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NL2SQLè§£å†³äº†ï¼Ÿåˆ«é—¹äº†ï¼å¤§æ¨¡å‹è®©ä½ å’Œæ•°æ®åº“èŠå¤©èƒŒåçš„çœŸç›¸]]></title>    <link>https://juejin.cn/post/7582786292087799859</link>    <guid>https://juejin.cn/post/7582786292087799859</guid>    <pubDate>2025-12-12T11:02:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582786292087799859" data-draft-id="7582786292087783475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NL2SQLè§£å†³äº†ï¼Ÿåˆ«é—¹äº†ï¼å¤§æ¨¡å‹è®©ä½ å’Œæ•°æ®åº“èŠå¤©èƒŒåçš„çœŸç›¸"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-12T11:02:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="martinzh"/> <meta itemprop="url" content="https://juejin.cn/user/2524134426030232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NL2SQLè§£å†³äº†ï¼Ÿåˆ«é—¹äº†ï¼å¤§æ¨¡å‹è®©ä½ å’Œæ•°æ®åº“èŠå¤©èƒŒåçš„çœŸç›¸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134426030232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    martinzh
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T11:02:26.000Z" title="Fri Dec 12 2025 11:02:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€åœºç™½ï¼šå½“è€æ¿è¯´"éšä¾¿æŸ¥ä¸ªæ•°æ®"</h2>
<p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼šè€æ¿çªç„¶èµ°è¿‡æ¥è¯´ï¼Œ"å°æå•Šï¼Œå¸®æˆ‘æŸ¥ä¸€ä¸‹ä¸Šä¸ªæœˆå’±ä»¬å…¬å¸å“ªä¸ªéƒ¨é—¨ä¸šç»©æœ€å¥½ã€‚"å¬èµ·æ¥å¾ˆç®€å•å¯¹å§ï¼Ÿä½†ä½ å¿ƒé‡Œæƒ³çš„æ˜¯ï¼š"ä¸Šä¸ªæœˆæ˜¯æŒ‡è‡ªç„¶æœˆè¿˜æ˜¯è´¢åŠ¡æœˆï¼Ÿä¸šç»©æ˜¯æŒ‡é”€å”®é¢è¿˜æ˜¯åˆ©æ¶¦ï¼Ÿéƒ¨é—¨æ˜¯æŒ‰ç»„ç»‡æ¶æ„è¿˜æ˜¯æŒ‰æˆæœ¬ä¸­å¿ƒåˆ†ï¼Ÿ"</p>
<p>è¿™å°±æ˜¯è‡ªç„¶è¯­è¨€è½¬SQLï¼ˆNL2SQLï¼‰æŠ€æœ¯è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜â€”â€”è®©äººå’Œæ•°æ®åº“ä¹‹é—´çš„å¯¹è¯å˜å¾—åƒæ—¥å¸¸èŠå¤©ä¸€æ ·ç®€å•ã€‚</p>
<p>éšç€ChatGPTç­‰å¤§è¯­è¨€æ¨¡å‹çš„å…´èµ·ï¼Œå¾ˆå¤šäººéƒ½è§‰å¾—è¿™ä¸ªé—®é¢˜å·²ç»è¢«å®Œç¾è§£å†³äº†ã€‚ç½‘ä¸Šåˆ°å¤„éƒ½æ˜¯"ä¸€è¡Œä»£ç æå®šæ•°æ®æŸ¥è¯¢"çš„æ•™ç¨‹ï¼Œä»¿ä½›æˆ‘ä»¬å·²ç»è¿›å…¥äº†äººäººéƒ½æ˜¯æ•°æ®åˆ†æå¸ˆçš„ç¾å¥½æ—¶ä»£ã€‚</p>
<p>ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿä»Šå¤©æˆ‘ä»¬å°±æ¥æ­ç§˜ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¼ä¸šçº§çš„NL2SQLæŠ€æœ¯è¿œæ¯”ä½ æƒ³è±¡çš„å¤æ‚ã€‚</p>
<h2 data-id="heading-1">ç¬¬ä¸€å¤§æŒ‘æˆ˜ï¼šæ•°æ®åº“ç»“æ„å¤æ‚åˆ°è®©äººæ€€ç–‘äººç”Ÿ</h2>
<h3 data-id="heading-2">ä½ ä»¥ä¸ºçš„æ•°æ®åº“ vs å®é™…çš„æ•°æ®åº“</h3>
<p>ä½ ä»¥ä¸ºä¼ä¸šæ•°æ®åº“å°±åƒæ•™ç§‘ä¹¦é‡Œé‚£æ ·ï¼Œå‡ å¼ ç®€å•çš„è¡¨ï¼Œåˆ—åéƒ½å«<code>student_name</code>ã€<code>course_id</code>è¿™æ ·ä¸€ç›®äº†ç„¶çš„åå­—ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œä¼ä¸šæ•°æ®åº“æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ceb0ce59d504999875ab3d444895d5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbWFydGluemg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766142271&amp;x-signature=%2BKfRBRAmqD3FZwYwRvLM%2BIKs3kY%3D" alt="å›¾1ï¼šä¼ä¸šæ•°æ®åº“çš„ç°å®æƒ…å†µ - å°±åƒèµ°è¿›äº†ä¸€ä¸ªæ ‡è¯†éƒ½æ˜¯å¤–æ˜Ÿæ–‡å­—çš„è¿·å®«" loading="lazy"/></p>
<p>å›¾1ï¼šä¼ä¸šæ•°æ®åº“çš„ç°å®æƒ…å†µ - å°±åƒèµ°è¿›äº†ä¸€ä¸ªæ ‡è¯†éƒ½æ˜¯å¤–æ˜Ÿæ–‡å­—çš„è¿·å®«</p>
<p>å¾®è½¯çš„ä¸€ä¸ªå†…éƒ¨è´¢åŠ¡æ•°æ®ä»“åº“æœ‰632å¼ è¡¨ï¼ŒåŒ…å«è¶…è¿‡4000ä¸ªåˆ—ï¼Œè¿˜æœ‰200ä¸ªè§†å›¾åŒ…å«7400å¤šä¸ªåˆ—ã€‚è¿™è¿˜ä¸æ˜¯æœ€è¦å‘½çš„ï¼Œæœ€è¦å‘½çš„æ˜¯è¿™äº›å­—æ®µåéƒ½æ˜¯ç¼©å†™ï¼Œæ¯”å¦‚<code>SLAMT_TTL_EXCL_TX</code>ï¼ˆé”€å”®æ€»é¢ä¸å«ç¨ï¼‰ï¼Œåªæœ‰å†™è¿™ä¸ªå­—æ®µçš„é‚£ä¸ªå·²ç»ç¦»èŒçš„è€ç‹çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€...</p>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆ"å…¨ç›˜æ‰˜å‡º"åè€Œæ•ˆæœæ›´å·®ï¼Ÿ</h3>
<p>è¿™é‡Œæœ‰ä¸ªåç›´è§‰çš„å‘ç°ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5c1f01cda4c4fd29ce7dfdae1aa28d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbWFydGluemg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766142271&amp;x-signature=ITQBvwTb4fJw1ilUQWkkmkOZLZg%3D" alt="å›¾2ï¼šæ›´å¤šä¿¡æ¯ä¸ç­‰äºæ›´å¥½çš„ç»“æœ - å°±åƒä½ é—®è·¯æ—¶ï¼Œå¯¹æ–¹æŠŠæ•´ä¸ªåŸå¸‚åœ°å›¾éƒ½èƒŒç»™ä½ å¬" loading="lazy"/></p>
<p>å›¾2ï¼šæ›´å¤šä¿¡æ¯ä¸ç­‰äºæ›´å¥½çš„ç»“æœ - å°±åƒä½ é—®è·¯æ—¶ï¼Œå¯¹æ–¹æŠŠæ•´ä¸ªåŸå¸‚åœ°å›¾éƒ½èƒŒç»™ä½ å¬</p>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼š"æ—¢ç„¶æ•°æ®åº“è¿™ä¹ˆå¤æ‚ï¼Œé‚£æˆ‘æŠŠæ‰€æœ‰è¡¨ç»“æ„éƒ½å‘Šè¯‰ChatGPTä¸å°±è¡Œäº†ï¼Ÿ"</p>
<p>é”™äº†ï¼å°±åƒä½ é—®è·¯çš„æ—¶å€™ï¼Œå¦‚æœå¯¹æ–¹æŠŠæ•´ä¸ªåŸå¸‚çš„è¡—é“åéƒ½æŠ¥ç»™ä½ ï¼Œä½ åè€Œä¼šæ›´å›°æƒ‘ã€‚å®éªŒè¡¨æ˜ï¼Œå½“æŠŠå®Œæ•´çš„æ•°æ®åº“ç»“æ„å–‚ç»™GPT-3.5æ—¶ï¼Œå‡†ç¡®ç‡åªæœ‰22.7%ã€‚ä½†å¦‚æœåªé€‰æ‹©ç›¸å…³çš„è¡¨å’Œå­—æ®µï¼Œå‡†ç¡®ç‡èƒ½æå‡7ä¸ªç™¾åˆ†ç‚¹ï¼</p>
<p>è¿™å°±åƒç‚¹èœæ—¶ï¼Œèœå•å¤ªåšåè€Œä¸çŸ¥é“ç‚¹ä»€ä¹ˆå¥½ï¼Œä½†å¦‚æœæœåŠ¡å‘˜æ¨èå‡ é“æ‹›ç‰Œèœï¼Œä½ åè€Œèƒ½å¿«é€Ÿåšå†³å®šã€‚</p>
<h2 data-id="heading-4">ç¬¬äºŒå¤§æŒ‘æˆ˜ï¼šè‡ªç„¶è¯­è¨€çš„"ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹"é—®é¢˜</h2>
<h3 data-id="heading-5">å½“"é”€å”®è¯¦æƒ…"æœ‰æ— æ•°ç§ç†è§£æ–¹å¼</h3>
<p>è¿˜è®°å¾—é‚£å¥è¯å—ï¼š"ä¸€åƒä¸ªäººçœ¼ä¸­æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹ã€‚"åœ¨NL2SQLçš„ä¸–ç•Œé‡Œï¼Œä¸€å¥"æ˜¾ç¤ºé”€å”®è¯¦æƒ…"å¯èƒ½æœ‰ä¸€åƒç§ä¸åŒçš„SQLæŸ¥è¯¢æ–¹å¼ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<p><strong>ç”¨æˆ·é—®ï¼š</strong> "æœ€å±é™©çš„åœ°åŒºåœ¨å“ªé‡Œï¼Ÿ"</p>
<p><strong>æ•°æ®åº“æœ‰ä¸¤ä¸ªåœ°ç†ä½ç½®å­—æ®µï¼š</strong></p>
<ul>
<li><code>Location</code>ï¼ˆåœ°ç‚¹ï¼‰</li>
<li><code>LSOA</code>ï¼ˆä½å±‚è¶…çº§è¾“å‡ºåŒºåŸŸï¼‰</li>
</ul>
<p>è¿™å°±åƒä½ é—®æœ‹å‹"åŒ—äº¬æœ€å¥½ç©çš„åœ°æ–¹åœ¨å“ªé‡Œ"ï¼Œä»–å¯èƒ½å‘Šè¯‰ä½ "æœé˜³åŒº"ï¼Œä¹Ÿå¯èƒ½å‘Šè¯‰ä½ "ä¸‰é‡Œå±¯"ã€‚ä¸¤ä¸ªç­”æ¡ˆéƒ½å¯¹ï¼Œä½†ç²’åº¦ä¸åŒã€‚</p>
<h3 data-id="heading-6">ä¸‰ç§ä¸»è¦çš„æ­§ä¹‰ç±»å‹</h3>
<p>é€šè¿‡å¯¹272ä¸ªæŸ¥è¯¢çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å‘ç°äº†ä¸‰ç§ä¸»è¦çš„æ­§ä¹‰ç±»å‹ï¼š</p>
<ol>
<li>
<p><strong>æ•°æ®åº“ç»“æ„æ˜ å°„æ­§ä¹‰</strong>ï¼ˆ36.6%ï¼‰</p>
<ul>
<li>å°±åƒä¸Šé¢çš„åœ°ç†ä½ç½®ä¾‹å­ï¼ŒçŸ¥é“è¦æŸ¥ä»€ä¹ˆï¼Œä½†ä¸çŸ¥é“æŸ¥å“ªä¸ªå­—æ®µ</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®å€¼æ˜ å°„æ­§ä¹‰</strong>ï¼ˆ19.6%ï¼‰</p>
<ul>
<li>æ¯”å¦‚é—®"æ—¥æœ¬æœ‰å¤šå°‘æ ¸ç”µç«™åœ¨å‡†å¤‡ä½¿ç”¨ï¼Ÿ"</li>
<li>ä½ è§‰å¾—åº”è¯¥æŸ¥è¯¢<code>status LIKE '%å‡†å¤‡%'</code></li>
<li>ä½†å®é™…æ•°æ®åº“é‡Œç”¨çš„æ˜¯<code>status = 'å»ºè®¾ä¸­'</code></li>
</ul>
</li>
<li>
<p><strong>è‡ªç„¶è¯­è¨€æœ¬èº«æ¨¡ç³Š</strong>ï¼ˆ34.8%ï¼‰</p>
<ul>
<li>"å“ªç§å†œè¯æœ€å®¹æ˜“æ£€æµ‹ï¼Ÿ"</li>
<li>å®¹æ˜“ç¨‹åº¦å¯èƒ½åŸºäºï¼šæµ“åº¦ã€æ ·å“æ•°é‡ã€æ£€æµ‹æ—¶é—´...</li>
</ul>
</li>
</ol>
<h3 data-id="heading-7">è¿äººç±»ä¸“å®¶éƒ½ä¼š"æ‰“æ¶"</h3>
<p>æ›´æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬è®©ä¸¤ä¸ªäººç±»ä¸“å®¶æ¥åˆ¤æ–­åŒä¸€ä¸ªæŸ¥è¯¢æ˜¯å¦æœ‰æ­§ä¹‰ï¼Œä»–ä»¬çš„ä¸€è‡´æ€§åªæœ‰62%ï¼è¿™è¯´æ˜ä»€ä¹ˆï¼Ÿè¿äººéƒ½æä¸æ¸…æ¥šçš„é—®é¢˜ï¼Œå‡­ä»€ä¹ˆæŒ‡æœ›AIèƒ½ææ¸…æ¥šï¼Ÿ</p>
<p>å°±åƒä¸¤ä¸ªäººçœ‹åŒä¸€æœµäº‘ï¼Œä¸€ä¸ªè¯´åƒå°ç‹—ï¼Œä¸€ä¸ªè¯´åƒå°çŒ«ï¼Œéƒ½æœ‰é“ç†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe4238e9d3c54fd4979339b00e8f42d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbWFydGluemg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766142271&amp;x-signature=dpnoya%2FZY%2Fql2tDAA9U9W2xg6Lk%3D" alt="å›¾3ï¼šæ­§ä¹‰è¯†åˆ«çš„&quot;æˆ˜å›½æ—¶ä»£&quot; - è¿ä¸“å®¶éƒ½åœ¨äº‰è®ºï¼ŒAIèƒ½åšåˆ°65%å·²ç»ä¸é”™äº†" loading="lazy"/></p>
<p>å›¾3ï¼šæ­§ä¹‰è¯†åˆ«çš„"æˆ˜å›½æ—¶ä»£" - è¿ä¸“å®¶éƒ½åœ¨äº‰è®ºï¼ŒAIèƒ½åšåˆ°65%å·²ç»ä¸é”™äº†</p>
<p>ä½†æœ‰ä¸ªå¥½æ¶ˆæ¯ï¼šGPT-4åœ¨è¯†åˆ«æ­§ä¹‰æ–¹é¢å·²ç»èƒ½è¾¾åˆ°ä¸äººç±»ä¸“å®¶65%çš„ä¸€è‡´æ€§ï¼Œè¶…è¿‡äº†GPT-3.5çš„44%ã€‚è¿™è¯´æ˜AIæ­£åœ¨å¿«é€Ÿå­¦ä¹ ç†è§£äººç±»è¯­è¨€çš„å¾®å¦™ä¹‹å¤„ã€‚</p>
<h2 data-id="heading-8">ç¬¬ä¸‰å¤§æŒ‘æˆ˜ï¼šå½“ç”¨æˆ·é—®çš„é—®é¢˜æ•°æ®åº“æ ¹æœ¬ç­”ä¸ä¸Šæ¥</h2>
<h3 data-id="heading-9">"è¯­ä¹‰ä¸åŒ¹é…"ï¼šå°±åƒç”¨è®¡ç®—å™¨é—®ä»Šå¤©å¤©æ°”</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ‹¿ç€è®¡ç®—å™¨é—®ï¼š"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"è®¡ç®—å™¨è‚¯å®šä¸€è„¸æ‡µé€¼ã€‚åŒæ ·åœ°ï¼Œç”¨æˆ·ç»å¸¸ä¼šé—®æ•°æ®åº“ä¸€äº›å®ƒæ ¹æœ¬æ— æ³•å›ç­”çš„é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚ï¼Œç”¨æˆ·é—®HRæ•°æ®åº“ï¼š"ä¸Šå­£åº¦å“ªä¸ªäº§å“å–å¾—æœ€å¥½ï¼Ÿ"è¿™å°±åƒé—®å›¾ä¹¦ç®¡ç†å‘˜ï¼š"ä½ ä»¬è¿™é‡Œå“ªé“èœæœ€å¥½åƒï¼Ÿ"å®Œå…¨ä¸åœ¨ä¸€ä¸ªé¢‘é“ä¸Šã€‚</p>
<h3 data-id="heading-10">æ›´å¾®å¦™çš„é™·é˜±ï¼šå­—æ®µåç›¸åŒä½†è¯­ä¹‰ä¸åŒ</h3>
<p>è¿˜æœ‰æ›´å¾®å¦™çš„æƒ…å†µã€‚å‡è®¾æœ‰ä¸ªæ­Œæ‰‹è¡¨ï¼š<code>singers(name, cause_of_death, year)</code></p>
<p>ç”¨æˆ·é—®ï¼š"2021å¹´æœ‰å¤šå°‘æ­Œæ‰‹æ­»äºæ–°å† ï¼Ÿ"</p>
<p>LLMå¾ˆå¯èƒ½ç”Ÿæˆï¼š</p>
<ul>
<li>ounter(line</li>
<li>ounter(line</li>
<li>ounter(line</li>
</ul>

<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> singers <span class="hljs-keyword">WHERE</span> cause_of_death <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%covid%'</span> <span class="hljs-keyword">AND</span> <span class="hljs-keyword">year</span> <span class="hljs-operator">=</span> <span class="hljs-number">2021</span>
</code></pre>
<p>çœ‹èµ·æ¥å¾ˆåˆç†å¯¹å§ï¼Ÿä½†é—®é¢˜æ˜¯ï¼Œè¿™é‡Œçš„<code>year</code>å­—æ®µå­˜çš„æ˜¯æ­Œæ‰‹å‘å¸ƒç¬¬ä¸€å¼ ä¸“è¾‘çš„å¹´ä»½ï¼Œè€Œä¸æ˜¯æ­»äº¡å¹´ä»½ï¼</p>
<p>è¿™å°±åƒä½ é—®ï¼š"2021å¹´ä¹°è½¦çš„äººä¸­ï¼Œæœ‰å¤šå°‘æ˜¯90åï¼Ÿ"ç»“æœæ•°æ®åº“é‡Œçš„<code>year</code>å­—æ®µè®°å½•çš„æ˜¯è½¦è¾†ç”Ÿäº§å¹´ä»½ï¼Œä¸æ˜¯è´­ä¹°å¹´ä»½ã€‚ç­”æ¡ˆå®Œå…¨ç‰›å¤´ä¸å¯¹é©¬å˜´ã€‚</p>
<h3 data-id="heading-11">AIçš„è¿›æ­¥ï¼šGPT-4 vs GPT-3.5</h3>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼ŒGPT-4åœ¨è¯†åˆ«è¿™ç§è¯­ä¹‰ä¸åŒ¹é…æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­ï¼š</p>
<ul>
<li>GPT-3.5ï¼šåªèƒ½æ­£ç¡®è¯†åˆ«60%çš„ä¸å¯å›ç­”é—®é¢˜</li>
<li>GPT-4ï¼š100%æ­£ç¡®è¯†åˆ«æ‰€æœ‰ä¸å¯å›ç­”çš„é—®é¢˜</li>
</ul>
<p>ä½†åæ¶ˆæ¯æ˜¯ï¼ŒGPT-4çš„æˆæœ¬æ˜¯GPT-3.5çš„30å€ï¼Œå»¶è¿Ÿä¹Ÿæ›´é«˜ã€‚è¿™å°±åƒä¹°äº†å°æ³•æ‹‰åˆ©å»é€å¤–å–ï¼Œæ€§èƒ½æ˜¯å¥½ï¼Œä½†ç»æµä¸Šä¸åˆ’ç®—ã€‚</p>
<h2 data-id="heading-12">ç¬¬å››å¤§æŒ‘æˆ˜ï¼šåŸºå‡†æµ‹è¯•çš„"æ©è€³ç›—é“ƒ"</h2>
<h3 data-id="heading-13">å½“è€ƒè¯•é¢˜ç›®æœ¬èº«å°±æœ‰é—®é¢˜</h3>
<p>ç°åœ¨æˆ‘ä»¬æ¥è¯´è¯´NL2SQLé¢†åŸŸæœ€å¤§çš„é—®é¢˜ä¹‹ä¸€ï¼šå¦‚ä½•è¯„ä¼°ç³»ç»Ÿæ˜¯å¦çœŸçš„"èªæ˜"ã€‚</p>
<p>ä¼ ç»Ÿçš„è¯„ä¼°æ–¹æ³•å°±åƒæ˜¯ä¸¥è‹›çš„è¯­æ–‡è€å¸ˆï¼Œè¦æ±‚ä½ çš„ç­”æ¡ˆå¿…é¡»å’Œæ ‡å‡†ç­”æ¡ˆä¸€å­—ä¸å·®ã€‚ä½†é—®é¢˜æ˜¯ï¼Œå¯¹äº"æ‰¾åˆ°åŒæ—¶æœ‰ç¡•å£«ç”Ÿå’Œæœ¬ç§‘ç”Ÿæ³¨å†Œçš„å­¦æœŸ"è¿™ä¸ªé—®é¢˜ï¼Œè¿”å›<code>semester_ID</code>å’Œè¿”å›<code>semester_name</code>éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆå•Šï¼</p>
<p>å°±åƒä½ é—®æœ‹å‹"ä»Šå¤©æ˜ŸæœŸå‡ ï¼Ÿ"ï¼Œä»–å›ç­”"æ˜ŸæœŸä¸‰"æˆ–"Wednesday"éƒ½å¯¹ï¼Œä½†ä¼ ç»Ÿè¯„ä¼°ç³»ç»Ÿä¼šè¯´ï¼š"ä¸å¯¹ï¼æ ‡å‡†ç­”æ¡ˆæ˜¯'æ˜ŸæœŸä¸‰'ï¼Œä½ ç­”æˆ'Wednesday'ï¼Œé›¶åˆ†ï¼"</p>
<h3 data-id="heading-14">å¼•å…¥"æ„å›¾å¯¼å‘"çš„è¯„ä¼°ï¼šä¸çœ‹å½¢å¼çœ‹æ•ˆæœ</h3>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†"æ„å›¾å¯¼å‘æ‰§è¡ŒåŒ¹é…"çš„æ–°è¯„ä¼°æ ‡å‡†ï¼Œå…è®¸ä»¥ä¸‹æƒ…å†µï¼š</p>
<ol>
<li><strong>é¡ºåºä¸é‡è¦</strong>ï¼šé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚æ’åº</li>
<li><strong>å¤šè¿”å›å‡ åˆ—æ²¡å…³ç³»</strong>ï¼šç”¨æˆ·è¦å‘˜å·¥å§“åï¼Œä½ è¿”å›å§“å+å·¥èµ„ï¼Œä¹Ÿç®—å¯¹</li>
<li><strong>å…³é”®å­—æ®µå¯äº’æ¢</strong>ï¼šè¿”å›å‘˜å·¥IDæˆ–å‘˜å·¥å§“åéƒ½ç®—å¯¹ï¼ˆéƒ½èƒ½å”¯ä¸€è¯†åˆ«å‘˜å·¥ï¼‰</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d28a1a6525ee48a5831d1c12943b9d5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbWFydGluemg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766142271&amp;x-signature=8SBFwFIFloQzQfa%2B%2BpDdwx0qFhU%3D" alt="å›¾4ï¼šè¯„ä¼°æ ‡å‡†çš„é©å‘½ - ä»&quot;æ ‡å‡†ç­”æ¡ˆ&quot;åˆ°&quot;è§£å†³é—®é¢˜&quot;çš„è½¬å˜" loading="lazy"/></p>
<p>å›¾4ï¼šè¯„ä¼°æ ‡å‡†çš„é©å‘½ - ä»"æ ‡å‡†ç­”æ¡ˆ"åˆ°"è§£å†³é—®é¢˜"çš„è½¬å˜</p>
<p>ç»“æœä»¤äººéœ‡æƒŠï¼åœ¨SpideråŸºå‡†æµ‹è¯•ä¸­ï¼Œä¼ ç»Ÿä¸¥æ ¼åŒ¹é…çš„å‡†ç¡®ç‡åªæœ‰26.32%ï¼Œä½†é‡‡ç”¨æ„å›¾å¯¼å‘è¯„ä¼°åï¼Œå‡†ç¡®ç‡é£™å‡åˆ°92.50%ï¼</p>
<p>è¿™ä¸æ˜¯åœ¨"æ”¾æ°´"ï¼Œè€Œæ˜¯æ›´å‡†ç¡®åœ°åæ˜ äº†ç”¨æˆ·çš„çœŸå®éœ€æ±‚ã€‚æ¯•ç«Ÿï¼Œç”¨æˆ·è¦çš„æ˜¯è§£å†³é—®é¢˜ï¼Œä¸æ˜¯å‚åŠ è¯­æ³•è€ƒè¯•ã€‚</p>
<h2 data-id="heading-15">ç¬¬äº”å¤§æŒ‘æˆ˜ï¼šAIçš„"ç¤¾ä¼šè´£ä»»"é—®é¢˜</h2>
<h3 data-id="heading-16">å½“æ•°æ®åº“é‡Œæœ‰"å±é™©å†…å®¹"</h3>
<p>AIæ—¶ä»£çš„NL2SQLé¢ä¸´ç€å‰æ‰€æœªæœ‰çš„è´£ä»»é—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š</p>
<p><strong>è­¦å¯Ÿå±€æ•°æ®åº“</strong>åŒ…å«çŠ¯ç½ªè®°å½•ï¼Œè­¦å®˜é—®ï¼š"æŸ¥è¯¢æ‰€æœ‰æš´åŠ›çŠ¯ç½ªæ¡ˆä»¶" <strong>ä¼ä¸šäººäº‹æ•°æ®åº“</strong>ï¼Œæœ‰äººé—®ï¼š"å“ªäº›å‘˜å·¥å¯èƒ½ä¼šè¢«è£å‘˜ï¼Ÿ"</p>
<p>ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ˜¯åˆæ³•çš„å·¥ä½œéœ€è¦ï¼Œç¬¬äºŒä¸ªå¯èƒ½æ¶‰åŠæ­§è§†å’Œåè§ã€‚ä½†AIå¦‚ä½•åŒºåˆ†å‘¢ï¼Ÿ</p>
<h3 data-id="heading-17">åè§é—®é¢˜ï¼šå½“AIå­¦ä¼šäº†"æœ‰è‰²çœ¼é•œ"</h3>
<p>æ›´å¾®å¦™çš„æ˜¯åè§é—®é¢˜ã€‚æ¯”å¦‚ç”¨æˆ·é—®ï¼š"æˆ‘åº”è¯¥é¿å…å‘è°æ”¾è´·ï¼Ÿ"AIå¯èƒ½ç”Ÿæˆï¼š</p>
<ul>
<li>ounter(line</li>
</ul>

<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> ethnicity <span class="hljs-operator">=</span> <span class="hljs-string">'X'</span>  <span class="hljs-comment">-- ç›´æ¥æ­§è§†</span>
</code></pre>
<p>æˆ–è€…ï¼š</p>
<ul>
<li>ounter(line</li>
</ul>

<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> location <span class="hljs-operator">=</span> <span class="hljs-string">'Y'</span>   <span class="hljs-comment">-- é—´æ¥æ­§è§†ï¼ˆåŸºäºåœ°åŒº-ç§æ—å…³è”ï¼‰</span>
</code></pre>
<p>è¿™å°±åƒè®©ä¸€ä¸ªè§è¿‡ä¸–é¢ä½†æœ‰åˆ»æ¿å°è±¡çš„è€å¸ˆå‚…æ¥ç­›é€‰ç®€å†ï¼Œä»–å¯èƒ½ä¼š"å‡­ç»éªŒ"åšå‡ºæœ‰åè§çš„åˆ¤æ–­ã€‚</p>
<h3 data-id="heading-18">å¤šè¯­è¨€æ”¯æŒï¼šè‹±è¯­ä¹‹å¤–çš„"æ•°å­—é¸¿æ²Ÿ"</h3>
<p>æœ€åï¼Œè¿˜æœ‰è¯­è¨€æ”¯æŒé—®é¢˜ã€‚å½“æˆ‘ä»¬æŠŠè‹±æ–‡æŸ¥è¯¢ç¿»è¯‘æˆä¸­æ–‡ã€å°åœ°è¯­ã€å¾·è¯­ç­‰å…¶ä»–è¯­è¨€æ—¶ï¼ŒNL2SQLçš„å‡†ç¡®ç‡ä¸‹é™äº†3.5%-15%ã€‚</p>
<p>è¿™å°±åƒè®©ä¸€ä¸ªåªä¼šè¯´è‹±è¯­çš„å¯¼æ¸¸ä¸ºä¸­å›½æ¸¸å®¢æœåŠ¡ï¼Œæ•ˆæœè‚¯å®šä¼šæ‰“æŠ˜æ‰£ã€‚</p>
<h2 data-id="heading-19">ç°å®åº”ç”¨åœºæ™¯ï¼šå½“å°å¼ é‡åˆ°è€æ¿çš„"ç®€å•è¦æ±‚"</h2>
<p>è®©æˆ‘ä»¬å›åˆ°å¼€å¤´çš„æ•…äº‹ã€‚å°å¼ æ˜¯ä¸€å®¶ç”µå•†å…¬å¸çš„æ•°æ®åˆ†æå¸ˆï¼ŒæŸå¤©è€æ¿èµ°è¿‡æ¥è¯´ï¼š</p>
<p><strong>è€æ¿ï¼š</strong> "å°å¼ ï¼Œå¸®æˆ‘æŸ¥ä¸€ä¸‹ä¸Šä¸ªæœˆæˆ‘ä»¬å…¬å¸å“ªä¸ªéƒ¨é—¨ä¸šç»©æœ€å¥½ã€‚"</p>
<p><strong>å°å¼ å¿ƒä¸­çš„OSï¼š</strong></p>
<ol>
<li>ä¸Šä¸ªæœˆæ˜¯æŒ‡11æœˆ1-30æ—¥è¿˜æ˜¯10æœˆ26æ—¥-11æœˆ25æ—¥ï¼ˆè´¢åŠ¡æœˆï¼‰ï¼Ÿ</li>
<li>éƒ¨é—¨æ˜¯æŒ‰ç»„ç»‡æ¶æ„åˆ†è¿˜æ˜¯æŒ‰æˆæœ¬ä¸­å¿ƒåˆ†ï¼Ÿ</li>
<li>ä¸šç»©æ˜¯æŒ‡é”€å”®é¢ã€åˆ©æ¶¦è¿˜æ˜¯è®¢å•é‡ï¼Ÿ</li>
<li>è¦ä¸è¦åŒ…å«é€€è´§ï¼Ÿ</li>
</ol>
<p>å¦‚æœæœ‰äº†å®Œç¾çš„NL2SQLç³»ç»Ÿï¼Œå°å¼ åªéœ€è¦è¯´ï¼š"æŸ¥è¯¢ä¸Šæœˆå„éƒ¨é—¨ä¸šç»©æ•°æ®"ï¼Œç³»ç»Ÿå°±ä¼šï¼š</p>
<ol>
<li><strong>æ™ºèƒ½æ¶ˆæ­§</strong>ï¼šè¯¢é—®å…·ä½“éœ€æ±‚ï¼ˆ"æ‚¨æŒ‡çš„æ˜¯è‡ªç„¶æœˆè¿˜æ˜¯è´¢åŠ¡æœˆï¼Ÿ"ï¼‰</li>
<li><strong>ç»“æ„ç†è§£</strong>ï¼šè‡ªåŠ¨è¯†åˆ«ç›¸å…³çš„è¡¨å’Œå­—æ®µ</li>
<li><strong>è¯­ä¹‰åŒ¹é…</strong>ï¼šç¡®ä¿æŸ¥è¯¢å†…å®¹ä¸æ•°æ®åº“èƒ½åŠ›åŒ¹é…</li>
<li><strong>ç»“æœä¼˜åŒ–</strong>ï¼šè¿”å›æ˜“æ‡‚çš„å¯è§†åŒ–ç»“æœ</li>
</ol>
<p>ä½†ç°å®æ˜¯ï¼Œå°å¼ è¿˜æ˜¯è¦èŠ±åŠå°æ—¶ç†è§£éœ€æ±‚ï¼Œå†™SQLï¼Œè°ƒè¯•ï¼Œå†ç¾åŒ–ç»“æœã€‚</p>
<h2 data-id="heading-20">æœªæ¥ä¹‹è·¯ï¼šä»"èƒ½ç”¨"åˆ°"å¥½ç”¨"çš„è¿›åŒ–</h2>
<h3 data-id="heading-21">æŠ€æœ¯è·¯çº¿å›¾</h3>
<p>è¦å®ç°çœŸæ­£ä¼ä¸šçº§çš„NL2SQLï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ä»¥ä¸‹æ–¹é¢çªç ´ï¼š</p>
<ol>
<li><strong>æ™ºèƒ½æ¨¡å¼é€‰æ‹©</strong>ï¼šæ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è‡ªåŠ¨é€‰æ‹©ç›¸å…³è¡¨ç»“æ„</li>
<li><strong>ä¸Šä¸‹æ–‡ç†è§£</strong>ï¼šè®°ä½å¯¹è¯å†å²ï¼Œæ”¯æŒå¤šè½®æŸ¥è¯¢</li>
<li><strong>ä¸»åŠ¨æ¶ˆæ­§</strong>ï¼šå½“æ£€æµ‹åˆ°æ­§ä¹‰æ—¶ä¸»åŠ¨è¯¢é—®</li>
<li><strong>å®‰å…¨æœºåˆ¶</strong>ï¼šé˜²æ­¢æœ‰å®³æŸ¥è¯¢å’Œæ•°æ®æ³„éœ²</li>
<li><strong>å¤šæ¨¡æ€äº¤äº’</strong>ï¼šæ”¯æŒè¯­éŸ³ã€å›¾è¡¨ç­‰å¤šç§äº¤äº’æ–¹å¼</li>
</ol>
<h3 data-id="heading-22">äº§ä¸šå½±å“ï¼šé‡æ–°å®šä¹‰"æ•°æ®æ°‘ä¸»åŒ–"</h3>
<p>å½“NL2SQLæŠ€æœ¯çœŸæ­£æˆç†Ÿæ—¶ï¼Œå®ƒå°†å½»åº•æ”¹å˜ä¼ä¸šçš„æ•°æ®ä½¿ç”¨æ–¹å¼ï¼š</p>
<ul>
<li><strong>ä¸šåŠ¡äººå‘˜</strong>ï¼šä¸å†ä¾èµ–ITéƒ¨é—¨ï¼Œç›´æ¥è·å–æ‰€éœ€æ•°æ®</li>
<li><strong>æ•°æ®åˆ†æå¸ˆ</strong>ï¼šä»å†™SQLè½¬å‘è§£é‡Šç»“æœå’Œæä¾›æ´å¯Ÿ</li>
<li><strong>å†³ç­–æ•ˆç‡</strong>ï¼šä»"æ•°æ®ç”³è¯·-ç­‰å¾…-åˆ†æ-æ±‡æŠ¥"åˆ°"å³é—®å³ç­”"</li>
<li><strong>æ•°æ®æ²»ç†</strong>ï¼šéœ€è¦æ›´å®Œå–„çš„æƒé™æ§åˆ¶å’Œå®¡è®¡æœºåˆ¶</li>
</ul>
<h2 data-id="heading-23">ç»“è¯­ï¼šé©å‘½å°šæœªæˆåŠŸï¼ŒåŒå¿—ä»éœ€åŠªåŠ›</h2>
<p>NL2SQLæŠ€æœ¯ç¡®å®æ˜¯é©å‘½æ€§çš„ï¼Œå¤§è¯­è¨€æ¨¡å‹çš„å‡ºç°ä¸ºæˆ‘ä»¬æ‰“å¼€äº†æ–°çš„å¯èƒ½æ€§ã€‚ä½†æ­£å¦‚æœ¬æ–‡æ‰€å±•ç¤ºçš„ï¼Œä»å®éªŒå®¤çš„Demoåˆ°ä¼ä¸šçº§çš„äº§å“ï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚</p>
<p>è¿™å°±åƒè‡ªåŠ¨é©¾é©¶æŠ€æœ¯ä¸€æ ·ï¼Œåœ¨é«˜é€Ÿå…¬è·¯ä¸Šå·²ç»ç›¸å½“å¯é ï¼Œä½†åœ¨å¤æ‚çš„åŸå¸‚ç¯å¢ƒä¸­è¿˜éœ€è¦ä¸æ–­æ”¹è¿›ã€‚NL2SQLåœ¨ç®€å•æŸ¥è¯¢ä¸Šå·²ç»å¾ˆå‰å®³äº†ï¼Œä½†åœ¨å¤æ‚çš„ä¼ä¸šç¯å¢ƒä¸­ï¼Œè¿˜éœ€è¦è§£å†³æ¶æ„å¤æ‚æ€§ã€æ­§ä¹‰å¤„ç†ã€åŸºå‡†è¯„ä¼°å’ŒAIè´£ä»»ç­‰ä¸€ç³»åˆ—æŒ‘æˆ˜ã€‚</p>
<p>ä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼ŒæŠ€æœ¯è¿›æ­¥çš„è„šæ­¥ä»æœªåœæ­¢ã€‚ä»Šå¤©çš„æŒ‘æˆ˜å°±æ˜¯æ˜å¤©çš„çªç ´ç‚¹ã€‚ä¹Ÿè®¸ä¸ä¹…çš„å°†æ¥ï¼Œæˆ‘ä»¬çœŸçš„å¯ä»¥åƒè·Ÿæœ‹å‹èŠå¤©ä¸€æ ·è½»æ¾åœ°ä¸æ•°æ®åº“å¯¹è¯ã€‚</p>
<p>é‚£æ—¶å€™ï¼Œå°å¼ å†ä¹Ÿä¸ç”¨ä¸ºè€æ¿çš„"éšä¾¿æŸ¥ä¸ªæ•°æ®"è€Œå¤´ç–¼äº†ï¼Œå› ä¸ºAIåŠ©æ‰‹ä¼šæ¯”ä»–æ›´æ‡‚è€æ¿æƒ³è¦ä»€ä¹ˆï¼</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fjishuba.cn%2Farticle%2Fnl2sql%25e8%25a7%25a3%25e5%2586%25b3%25e4%25ba%2586%25ef%25bc%259f%25e5%2588%25ab%25e9%2597%25b9%25e4%25ba%2586%25ef%25bc%2581%25e5%25a4%25a7%25e6%25a8%25a1%25e5%259e%258b%25e8%25ae%25a9%25e4%25bd%25a0%25e5%2592%258c%25e6%2595%25b0%25e6%258d%25ae%25e5%25ba%2593%25e8%2581%258a%25e5%25a4%25a9%25e8%2583%258c%25e5%2590%258e%2F" target="_blank" title="https://jishuba.cn/article/nl2sql%e8%a7%a3%e5%86%b3%e4%ba%86%ef%bc%9f%e5%88%ab%e9%97%b9%e4%ba%86%ef%bc%81%e5%a4%a7%e6%a8%a1%e5%9e%8b%e8%ae%a9%e4%bd%a0%e5%92%8c%e6%95%b0%e6%8d%ae%e5%ba%93%e8%81%8a%e5%a4%a9%e8%83%8c%e5%90%8e/" ref="nofollow noopener noreferrer">jishuba.cn/article/nl2â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ™ºæºå¼€æº Reason-RFTï¼šç”¨å¼ºåŒ–å­¦ä¹ é‡å¡‘è§†è§‰æ¨ç†ï¼Œçªç ´ VLM æ³›åŒ–ç“¶é¢ˆ]]></title>    <link>https://juejin.cn/post/7582809606067077146</link>    <guid>https://juejin.cn/post/7582809606067077146</guid>    <pubDate>2025-12-12T13:01:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582809606067077146" data-draft-id="7582814236583149606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ™ºæºå¼€æº Reason-RFTï¼šç”¨å¼ºåŒ–å­¦ä¹ é‡å¡‘è§†è§‰æ¨ç†ï¼Œçªç ´ VLM æ³›åŒ–ç“¶é¢ˆ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-12T13:01:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™ºæºç ”ç©¶é™¢"/> <meta itemprop="url" content="https://juejin.cn/user/3538691702925012"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ™ºæºå¼€æº Reason-RFTï¼šç”¨å¼ºåŒ–å­¦ä¹ é‡å¡‘è§†è§‰æ¨ç†ï¼Œçªç ´ VLM æ³›åŒ–ç“¶é¢ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3538691702925012/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™ºæºç ”ç©¶é™¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T13:01:16.000Z" title="Fri Dec 12 2025 13:01:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/402c4f6ca928464f90bdff259666427a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rqQ56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766149276&amp;x-signature=ufui%2FuVS%2FEZxoFb7TnQ3f3Nn%2F8A%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å°½ç®¡è¿‘å¹´æ¥è§†è§‰è¯­è¨€æ¨¡å‹ï¼ˆVLMï¼‰å–å¾—äº†æ˜¾è‘—è¿›å±•ï¼Œä½†ç°æœ‰æ¨¡å‹åœ¨å¤æ‚è§†è§‰æ¨ç†ä»»åŠ¡ä¸Šçš„æ³›åŒ–èƒ½åŠ›ä»é¢ä¸´ä¸¥å³»æŒ‘æˆ˜ã€‚å½“å‰ä¸»æµçš„â€œæ€ç»´é“¾â€ï¼ˆChain-of-Thought, CoTï¼‰ç›‘ç£å¾®è°ƒæ–¹æ³•ï¼Œå¾€å¾€è®©æ¨¡å‹åœç•™åœ¨å¯¹ç‰¹å®šæ¨ç†æ¨¡æ¿çš„â€œè®°å¿†â€ï¼Œè€ŒéçœŸæ­£æŒæ¡åº•å±‚æœºåˆ¶ï¼šä¸€æ—¦æ¢æˆæ–°åœºæ™¯ã€æ–°è§†è§’æˆ–æ–°çš„ä»»åŠ¡ç»„åˆï¼Œæ€§èƒ½ä¾¿æ˜æ˜¾ä¸‹æ»‘ï¼Œéš¾ä»¥æ»¡è¶³åœ¨è‡ªä¸»æœºå™¨äººç­‰å…·èº«æ™ºèƒ½åœºæ™¯ä¸‹å¯¹å¯é æ€§å’Œé²æ£’æ€§çš„è¦æ±‚ã€‚</p>
<p>RoboBrain 2.0 æ˜¯æ™ºæºé¢å‘çœŸå®ç‰©ç†åœºæ™¯æ‰“é€ çš„é€šç”¨å…·èº«å¤§è„‘ï¼Œä»¥ç»Ÿä¸€çš„è§†è§‰â€”è¯­è¨€å¤šæ¨¡æ€æ¶æ„ï¼Œä¸ºæœºå™¨äººåœ¨æ„ŸçŸ¥ã€è®¤çŸ¥ã€æ¨ç†ä¸å†³ç­–ä¸Šçš„æ ¸å¿ƒèƒ½åŠ›æä¾›åŸºç¡€æ”¯æ’‘ã€‚å›´ç»• RoboBrain 2.0 çš„æ•´ä½“ç›®æ ‡ï¼Œæˆ‘ä»¬ä¸ç¦è¦é—®ï¼š<strong>èƒ½å¦æ„å»ºä¸€ç§æ›´é€‚åˆå…·èº«æ™ºèƒ½çš„å¤§æ¨¡å‹è®­ç»ƒèŒƒå¼ï¼Œä½¿æ¨¡å‹ä¸ä»…â€œä¼šç®—â€ï¼Œæ›´èƒ½â€œæ‡‚ä¸ºä»€ä¹ˆè¿™æ ·ç®—â€ï¼Œä»è€Œåœ¨å¤æ‚å¤šå˜çš„ç¯å¢ƒä¸­ä¿æŒç¨³å¥çš„æ¨ç†ä¸å†³ç­–è¡¨ç°ï¼Ÿ</strong></p>
<p>åŸºäºè¿™ä¸€éœ€æ±‚ï¼Œæ™ºæºç ”ç©¶é™¢å…·èº«å¤šæ¨¡æ€å¤§æ¨¡å‹ç ”ç©¶ä¸­å¿ƒè”åˆåŒ—äº¬å¤§å­¦ã€ä¸­å›½ç§‘å­¦é™¢è‡ªåŠ¨åŒ–ç ”ç©¶æ‰€ç­‰åˆä½œå•ä½ï¼Œåœ¨ RoboBrain 2.0 è®­ç»ƒç®¡çº¿ä¸­å¼•å…¥äº†ä¸€ç§åˆ›æ–°çš„ä¸¤é˜¶æ®µå¼ºåŒ–å­¦ä¹ åè®­ç»ƒæ¡†æ¶Â <strong>Reason-RFT</strong>ã€‚å®ƒå¹¶éä¸€é¡¹â€œå•ç‚¹ç®—æ³•â€ï¼Œè€Œæ˜¯Â <strong>RoboBrain 2.0 åè®­ç»ƒé˜¶æ®µçš„æ ¸å¿ƒæ¨ç†å¢å¼ºæ¨¡å—</strong>ï¼Œæ—¨åœ¨ä»æ ¹æœ¬ä¸Šæå‡ RoboBrain ç³»åˆ— VLM åœ¨ç©ºé—´æ¨ç†ã€æ“ä½œè§„åˆ’ç­‰ä»»åŠ¡ä¸Šçš„æ³›åŒ–èƒ½åŠ›ã€‚</p>
<p>Reason-RFT ä¸ä»…åœ¨å¤šé¡¹è§†è§‰æ¨ç†ä¸å…·èº«åŸºå‡†ä¸Šå–å¾—äº†æ˜¾è‘—å¢ç›Šï¼Œæ›´éªŒè¯äº† <strong>â€œSFT æ¿€æ´» + å¼ºåŒ–å­¦ä¹ å¢å¼ºâ€</strong> è¿™ä¸€æ–°å‹è®­ç»ƒèŒƒå¼åœ¨å¤§è§„æ¨¡å…·èº«æ™ºèƒ½æ¨¡å‹ä¸Šçš„å¯è¡Œæ€§ï¼šé€šè¿‡å°† SFT çš„å½’çº³å¼•å¯¼ä¸ RL çš„æ¢ç´¢ä¼˜åŒ–æœ‰æœºç»“åˆï¼Œæœ‰æ•ˆç¼“è§£äº†è¿‡æ‹Ÿåˆä¸â€œè®¤çŸ¥åƒµåŒ–â€é—®é¢˜ï¼Œæ˜¾è‘—å¢å¼ºäº† RoboBrain åœ¨è·¨åœºæ™¯è¿ç§»å’ŒçœŸå®ä¸–ç•Œä»»åŠ¡ä¸­çš„é€‚ç”¨æ€§ã€‚ç›¸å…³ç ”ç©¶è®ºæ–‡å·²è¢« NeurIPS 2025 æ¥æ”¶ã€‚</p>
<p><strong>Reason-RFT: Reinforcement Fine-Tuning for Visual Reasoning of Vision Language Models</strong></p>
<p>å¼€æºé“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFlagOpen%2FReason-RFT" target="_blank" title="https://github.com/FlagOpen/Reason-RFT" ref="nofollow noopener noreferrer">github.com/FlagOpen/Reâ€¦</a></p>
<p>è®ºæ–‡åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2503.20752" target="_blank" title="https://arxiv.org/pdf/2503.20752" ref="nofollow noopener noreferrer">arxiv.org/pdf/2503.20â€¦</a></p>
<hr/>
<h3 data-id="heading-0"><em><strong>1</strong></em> <strong>æ¿€æ´»ä¸å¢å¼ºï¼šRoboBrain 2.0åè®­ç»ƒä¸­çš„ä¸¤é˜¶æ®µæ¨ç†æ¡†æ¶</strong></h3>
<p>åœ¨RoboBrain 2.0 çš„åè®­ç»ƒä½“ç³»ä¸­ï¼ŒReason-RFT å°†å¤æ‚æ¨ç†èƒ½åŠ›çš„å­¦ä¹ è¿‡ç¨‹æ‹†åˆ†ä¸ºä¸¤ä¸ªç´§å¯†è¡”æ¥çš„é˜¶æ®µï¼š<strong>SFT æ¨ç†æ¿€æ´»</strong> ä¸ <strong>RL æ¨ç†å¢å¼º</strong>ï¼Œå…±åŒæ„æˆæ¨¡å‹çš„â€œæ¨ç†åè®­ç»ƒå¼•æ“â€ã€‚</p>
<p><strong>é˜¶æ®µä¸€ï¼šSFT æ¨ç†æ¿€æ´»</strong></p>
<p>åœ¨è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å¹¶æœªä¾èµ–æµ·é‡ CoT æ•°æ®å¯¹ RoboBrain è¿›è¡Œå¤§è§„æ¨¡ SFTâ€”â€”é‚£å¾€å¾€ä¼šå¸¦æ¥æ¨¡å¼è®°å¿†ä¸è¿‡æ‹Ÿåˆé£é™©ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€å°éƒ¨åˆ†ç²¾å¿ƒç­›é€‰çš„é«˜è´¨é‡ CoT æ•°æ®ï¼Œå¯¹é¢„è®­ç»ƒçš„ RoboBrain è¿›è¡ŒçŸ­æš‚å¾®è°ƒã€‚</p>
<p>è¯¥é˜¶æ®µçš„ç›®æ ‡ä¸æ˜¯è¿½æ±‚ç«‹åˆ»â€œæ‹‰æ»¡æŒ‡æ ‡â€ï¼Œè€Œæ˜¯<strong>æ¿€æ´»æ¨¡å‹ä¸æ¨ç†ç›¸å…³çš„æ½œåœ¨èƒ½åŠ›</strong>ï¼šé€šè¿‡æ¥è§¦ç»“æ„åŒ–çš„æ¨ç†è¿‡ç¨‹ï¼Œæ¨¡å‹å­¦ä¼šå°†å¤æ‚é—®é¢˜æ‹†è§£ä¸ºè‹¥å¹²é€»è¾‘æ­¥éª¤ï¼Œå¹¶ä»¥â€œæ€è€ƒâ€”å›ç­”â€çš„ç»Ÿä¸€æ ¼å¼è¿›è¡Œè¾“å‡ºï¼Œä»è€Œå½¢æˆæœ‰åˆ©äºæ¨ç†çš„å½’çº³åç½®ï¼ˆinductive biasï¼‰ï¼Œä¸ºåç»­å¼ºåŒ–å­¦ä¹ åœ¨ RoboBrain ä¸Šå¼€å±•é«˜æ•ˆæ¢ç´¢æ‰“ä¸‹è‰¯å¥½èµ·ç‚¹ã€‚</p>
<p><strong>é˜¶æ®µäºŒï¼šRL æ¨ç†å¢å¼º</strong></p>
<p>åœ¨å…·å¤‡åŸºç¡€æ¨ç†èŒƒå¼åï¼ŒRoboBrain è¿›å…¥å¼ºåŒ–å­¦ä¹ å¢å¼ºé˜¶æ®µã€‚æˆ‘ä»¬é‡‡ç”¨ GRPO ç®—æ³•ï¼Œè®©æ¨¡å‹é’ˆå¯¹åŒä¸€é—®é¢˜ç”Ÿæˆå¤šæ¡å€™é€‰æ¨ç†è·¯å¾„ï¼Œåœ¨ç»„å†…è¿›è¡Œç›¸å¯¹æ¯”è¾ƒã€‚è¿™ç§â€œç»„å†…æ¯”è¾ƒ + ç›¸å¯¹ä¼˜é€‰â€çš„è®¾è®¡ï¼Œæ›´é€‚åˆæ¨ç†ä»»åŠ¡è§£ç©ºé—´åºå¤§ä¸”éš¾ä»¥ç»å¯¹æ‰“åˆ†çš„ç‰¹æ€§ï¼ŒåŒæ—¶åœ¨è®¡ç®—ä¸å·¥ç¨‹æˆæœ¬ä¸Šæ›´æ˜“åµŒå…¥ RoboBrain çš„å¤§è§„æ¨¡è®­ç»ƒä½“ç³»ã€‚</p>
<p>åœ¨å¥–åŠ±è®¾è®¡ä¸Šï¼Œæˆ‘ä»¬é‡‡ç”¨äº†è½»é‡ä½†ç»“æ„åŒ–çš„æ–¹æ¡ˆï¼Œä¸ RoboBrain çš„å¤šä»»åŠ¡è®­ç»ƒæ·±åº¦å…¼å®¹ï¼š</p>
<ul>
<li>
<p><strong>æ ¼å¼å¥–åŠ±</strong>ï¼šç¡®ä¿æ¨¡å‹è¾“å‡ºéµå¾ªç»Ÿä¸€çš„â€œæ¨ç† + ç­”æ¡ˆâ€ç»“æ„ï¼Œä¿è¯å…·èº«ä»»åŠ¡ä¸­çš„å¯è§£é‡Šæ€§ä¸ç¨³å®šæ€§ï¼›</p>
</li>
<li>
<p><strong>å‡†ç¡®æ€§å¥–åŠ±</strong>ï¼šé’ˆå¯¹ä¸åŒç±»å‹çš„è§†è§‰/å…·èº«æ¨ç†ä»»åŠ¡ï¼ˆå¦‚ç‰©ä½“è®¡æ•°ã€æ•°å€¼ä¼°è®¡ã€ç©ºé—´å…³ç³»åˆ¤æ–­ã€æ“ä½œåºåˆ—è§„åˆ’ç­‰ï¼‰ï¼Œåœ¨â€œæ˜¯å¦æ­£ç¡®â€çš„åŸºç¡€ä¸Šå¼•å…¥é€‚åº¦çš„ç»†ç²’åº¦åŒºåˆ†ï¼Œä¾‹å¦‚å¯¹æ¥è¿‘æ­£ç¡®çš„æ•°å€¼æˆ–éƒ¨åˆ†æ­£ç¡®çš„æ“ä½œåºåˆ—ç»™äºˆæ­£å‘åé¦ˆï¼Œä½¿æ¨¡å‹åœ¨æ¢ç´¢è¿‡ç¨‹ä¸­æ‹¥æœ‰æ›´å¹³æ»‘ã€æ›´å¯ä¼˜åŒ–çš„å¥–åŠ±æ›²é¢ã€‚</p>
</li>
</ul>
<p>é€šè¿‡ <strong>â€œæ¿€æ´»â€”å¢å¼ºâ€</strong> çš„ä¸¤é˜¶æ®µæµç¨‹ï¼ŒReason-RFT å…ˆåœ¨ RoboBrain ä¸Šå»ºç«‹èµ·ç¨³å®šçš„æ¨ç†èŒƒå¼ï¼Œå†å€ŸåŠ© RL å’Œç»“æ„åŒ–å¥–åŠ±æŒç»­ä¼˜åŒ–æ¨ç†è´¨é‡ä¸é²æ£’æ€§ï¼Œåœ¨ä¸ä¾èµ–å¤§è§„æ¨¡ CoT è®°å¿†çš„å‰æä¸‹ï¼Œç³»ç»Ÿæ€§æå‡äº† RoboBrain 2.0 çš„è§†è§‰ä¸å…·èº«æ¨ç†æ³›åŒ–èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-1"><strong>2 å®éªŒç»“æœï¼šæ›´å¼ºçš„æ€§èƒ½ã€æ³›åŒ–æ€§èƒ½ä¸æ•°æ®æ•ˆç‡</strong></h3>
<p>ä¸ºäº†ç³»ç»Ÿæ€§è¯„ä¼° Reason-RFT åœ¨ RoboBrain 2.0 ä¸Šçš„æ•ˆæœï¼Œåœ¨å¤šä¸ªæ—¶ç©ºè®¤çŸ¥åŸºå‡†ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cf68b0cfcb54fc88b561319bc5266cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rqQ56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766149276&amp;x-signature=cf43bIQvWFOL3re%2B1Y1j%2BtfQ8wM%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5158d672fb7642639d7ae3becb4ca606~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rqQ56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766149276&amp;x-signature=S2sWDqvtf2uHMYu2edcnmV%2FyPUc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä»ç»“æœå¯ä»¥æ¸…æ™°çœ‹åˆ°ï¼ŒReason-RFT ä½œä¸º RoboBrain 2.0 çš„åè®­ç»ƒæ¨¡å—ï¼Œå¸¦æ¥äº†ä¸‰æ–¹é¢çš„æ˜¾è‘—æ”¶ç›Šï¼š</p>
<ul>
<li>
<p><strong>æ€§èƒ½æå‡</strong>ï¼šåœ¨å¤šä¸ªè§†è§‰æ¨ç†ä¸å…·èº«ä»»åŠ¡ä¸Šï¼Œæ¥å…¥ Reason-RFT çš„ RoboBrain 2.0 ä¸ä»…å…¨é¢è¶…è¶Šä¸»æµå¼€æºæ¨¡å‹ï¼Œåœ¨è‹¥å¹²ä»»åŠ¡ä¸Šç”šè‡³è¶…è¿‡é¡¶å°–é—­æºç³»ç»Ÿï¼Œå±•ç¤ºå‡ºå¼ºå¤§çš„æ¨ç†ä¸å†³ç­–èƒ½åŠ›ã€‚</p>
</li>
<li>
<p><strong>æ³›åŒ–èƒ½åŠ›å¢å¼º</strong>ï¼šåœ¨ä¸“é—¨æ„é€ çš„é¢†åŸŸæ¼‚ç§»ï¼ˆDomain-Shiftï¼‰æµ‹è¯•é›†ä¸Šï¼ˆä¾‹å¦‚ï¼Œå°†è®­ç»ƒé˜¶æ®µçš„ä¸­å¿ƒè§†è§’å›¾åƒæ›¿æ¢ä¸ºä»æœªè§è¿‡çš„å·¦/å³è§†è§’ï¼Œæˆ–åœ¨å…·èº«åœºæ™¯ä¸­æ”¹å˜è§†è§’ä¸ç‰©ä½“å¸ƒå±€ï¼‰ï¼Œæ¥å…¥ Reason-RFT çš„ RoboBrain 2.0 æ˜æ˜¾ä¼˜äºä»…ä½¿ç”¨ SFT çš„è®­ç»ƒæ–¹æ¡ˆï¼Œè¡¨ç°å‡ºæ›´å¼ºçš„é€‚åº”æ€§å’Œé²æ£’æ€§ã€‚è¿™è¡¨æ˜æ¨¡å‹çœŸæ­£å­¦åˆ°çš„æ˜¯â€œå¦‚ä½•æ¨ç†ä¸è§„åˆ’â€ï¼Œè€Œéâ€œå¦‚ä½•åº”å¯¹æŸä¸€ç±»å›ºå®šæ¨¡æ¿çš„é¢˜ç›®â€ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®æ•ˆç‡ä¼˜è¶Š</strong>ï¼šåœ¨ RoboBrain 2.0 çš„æ•´ä½“è®­ç»ƒä¸­ï¼ŒReason-RFT ä»…ä½¿ç”¨ä¸åˆ° 5% çš„ CoT æ•°æ®è¿›è¡Œç¬¬ä¸€é˜¶æ®µæ¿€æ´»ï¼Œå…¶æœ€ç»ˆæ€§èƒ½å°±å¯è¾¾åˆ°æˆ–è¶…è¿‡ä½¿ç”¨ 100% CoT æ•°æ®è¿›è¡Œ SFT è®­ç»ƒçš„åŸºçº¿æ¨¡å‹ã€‚è¿™ä¸€ç‰¹æ€§å¯¹äºå…·èº«æ™ºèƒ½åœºæ™¯ä¸­æ˜‚è´µä¸”éš¾ä»¥å¤§è§„æ¨¡è·å–çš„é«˜è´¨é‡æ¨ç†æ ‡æ³¨ï¼Œå…·æœ‰é‡è¦çš„å®é™…ä»·å€¼ã€‚</p>
</li>
</ul>
<h3 data-id="heading-2"><strong>3 è®­ç»ƒä¸­çš„æœ‰è¶£å‘ç°ï¼šRoboBrainæ˜¯å¦‚ä½•â€œå­¦ä¼šæ€è€ƒâ€çš„ï¼Ÿ</strong></h3>
<p>åœ¨ RoboBrain 2.0 é›†æˆ Reason-RFT çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜è§‚å¯Ÿåˆ°äº†ä¸€äº›é¢‡å…·å¯å‘æ€§çš„ç°è±¡ï¼Œå®ƒä»¬åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ­ç¤ºäº†æ¨¡å‹å­¦ä¹ æ¨ç†æ—¶çš„â€œå†…éƒ¨è½¨è¿¹â€ï¼š</p>
<ul>
<li><strong>å¥–åŠ±åˆ†å±‚ï¼ˆGreedy Reward Stratificationï¼‰</strong></li>
</ul>
<p>è®­ç»ƒæ—©æœŸï¼ŒRoboBrain ä¼šä¼˜å…ˆè¿½æ±‚æ›´å®¹æ˜“è·å¾—çš„â€œæ ¼å¼å¥–åŠ±â€ï¼ˆä¾‹å¦‚è¾“å‡ºæ ¼å¼æ˜¯å¦è§„èŒƒï¼‰ï¼Œä¸ºäº†æœ€é«˜æ•ˆåœ°è·å–å¥–åŠ±ï¼Œæ¨¡å‹ä¼šå€¾å‘äºç”Ÿæˆç®€çŸ­çš„æ¨ç†å†…å®¹ï¼Œå¯¼è‡´æ¨ç†é•¿åº¦å…ˆæ˜æ˜¾å˜çŸ­ï¼›åœ¨æŒæ¡æ ¼å¼åï¼Œè®­ç»ƒé‡å¿ƒé€æ­¥è½¬å‘â€œå‡†ç¡®æ€§å¥–åŠ±â€ï¼Œå³æå‡å†…å®¹æœ¬èº«çš„æ­£ç¡®æ€§ä¸ä¸¥è°¨æ€§ï¼Œæ¨ç†é“¾æ¡ä¹Ÿéšä¹‹å˜é•¿ã€é€»è¾‘ç»“æ„å˜å¾—æ›´å¤æ‚ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79825bd78cc34a5f8b5ca81c7e048691~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rqQ56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766149276&amp;x-signature=pPuwmfUdVcpoumGrYBj672BD%2F4U%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<ul>
<li><strong>ç¬æ—¶é€‚åº”å·®è·ï¼ˆTransient Adaptation Gapï¼‰</strong></li>
</ul>
<p>å¯¹äºå®Œå…¨ä»é›¶å¼€å§‹è¿›è¡Œ RL è®­ç»ƒã€æœªç»è¿‡ SFT æ¿€æ´»çš„æ¨¡å‹ï¼Œåœ¨è®­ç»ƒèµ·å§‹é˜¶æ®µæ€§èƒ½ä¼šç»å†ä¸€ä¸ªçŸ­æš‚å´æ˜¾è‘—çš„ä¸‹æ»‘æœŸï¼Œç„¶åæ‰ç¼“æ…¢æ¢å¤ã€‚è¿™å¯ä»¥ç†è§£ä¸ºæ¨¡å‹è¢«è¿«ä»â€œç›´æ¥ç»™ç­”æ¡ˆâ€çš„ç›´è§‰æ¨¡å¼ï¼Œåˆ‡æ¢åˆ°â€œæ˜¾å¼ç”Ÿæˆæ¨ç†è¿‡ç¨‹â€çš„æ€è€ƒæ¨¡å¼ï¼Œåœ¨è¿™ä¸€åˆ‡æ¢è¿‡ç¨‹ä¸­å­˜åœ¨ä¸å¯é¿å…çš„é€‚åº”â€œé˜µç—›â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc63294f42e342a5b30b54f559190267~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rqQ56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766149276&amp;x-signature=qmT9SvBCWjHjhW9jIjsUXPmhV8Y%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<ul>
<li><strong>æ¨ç†å†—ä½™ï¼ˆReasoning Redundancyï¼‰</strong></li>
</ul>
<p>ä¸ä»é›¶ RL è®­ç»ƒçš„æ¨¡å‹ç›¸æ¯”ï¼Œç»è¿‡ CoT æ¿€æ´»çš„ RoboBrain 2.0 åœ¨æ¨ç†é˜¶æ®µå¾€å¾€æ›´â€œå¥è°ˆâ€ï¼Œå³ä¾¿ä¸¤è€…åœ¨æœ€ç»ˆå‡†ç¡®ç‡ä¸Šæ¥è¿‘ï¼Œå‰è€…å€¾å‘äºç”Ÿæˆæ›´ä¸ºè¯¦å°½çš„æ€ç»´é“¾ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºå®ƒåœ¨ç¬¬ä¸€é˜¶æ®µæ¨¡ä»¿äº†æ›´å¼ºæ¨¡å‹ï¼ˆå¦‚ GPT-4oï¼‰äº§ç”Ÿçš„ç»†è‡´æ¨ç†è¿‡ç¨‹ï¼Œå¹¶åœ¨ RL å¾®è°ƒåä»ä¿ç•™äº†è¿™ç§é£æ ¼ã€‚è¿™ä¸€ç°è±¡ä¸ºâ€œå¦‚ä½•è®©æ¨¡å‹åšåˆ°æ—¢æ€è€ƒå……åˆ†åˆè¡¨è¿°ç®€æ´â€æä¾›äº†æœ‰ä»·å€¼çš„ç ”ç©¶çº¿ç´¢ã€‚</p>
<h3 data-id="heading-3"><strong>4 å±•æœ›æœªæ¥ï¼šé¢å‘æ›´æ³›åŒ–çš„RoboBrainå¤šæ¨¡æ€ä¸å…·èº«æ™ºèƒ½</strong></h3>
<p>ä½œä¸º RoboBrain 2.0 è®­ç»ƒä½“ç³»ä¸­çš„é‡è¦ä¸€ç¯ï¼ŒReason-RFT ä¸ºå¤šæ¨¡æ€å¤§æ¨¡å‹å’Œå…·èº«æ™ºèƒ½æä¾›äº†ä¸€ç§<strong>æ›´é²æ£’ã€æ›´å…·æ³›åŒ–æ€§ã€ä¸”æ•°æ®æ•ˆç‡æ›´é«˜çš„è§†è§‰æ¨ç†ä¸å†³ç­–è®­ç»ƒèŒƒå¼</strong>ã€‚å®ƒä¸ä»…åœ¨å®è¯ä¸ŠéªŒè¯äº† <strong>â€œSFT æ¿€æ´» + RL å¢å¼ºâ€</strong> åœ¨çœŸå®åœºæ™¯ä»»åŠ¡ä¸­çš„æœ‰æ•ˆæ€§ï¼Œä¹Ÿä¸ºåç»­åœ¨å¤æ‚ç¯å¢ƒä¸‹çš„è§„åˆ’ã€æ§åˆ¶ä¸ååŒå¥ å®šäº†æ–¹æ³•åŸºç¡€ã€‚</p>
<p>RoboBrain 2.0 ä½¿ç”¨ä¼—æ™ºFlagOSå¤šèŠ¯ç‰‡å¼€æºç»Ÿä¸€æŠ€æœ¯æ ˆè¿›è¡Œå¤§è§„æ¨¡åˆ†å¸ƒå¼è®­ç»ƒå’Œé‡åŒ–æ¨ç†ï¼Œå¹¶é€šè¿‡FlagReleaseå‘å¸ƒäº†å¤šèŠ¯ç‰‡çš„æ¨¡å‹ç‰ˆæœ¬ã€‚</p>
<p>æ™ºæºç ”ç©¶é™¢å·²ä¸å…¨çƒ 30 ä½™å®¶æœºå™¨äººä¼ä¸šä¸é¡¶å°–å®éªŒå®¤å»ºç«‹åˆä½œï¼Œè¯šé‚€å…¨çƒå¼€å‘è€…ã€ç ”ç©¶è€…ä¸äº§ä¸šä¼™ä¼´åŠ å…¥ï¼Œæºæ‰‹å…±å»ºå¼€æ”¾ã€å¯ä¿¡ã€ç¹è£çš„å…·èº«æ™ºèƒ½ç”Ÿæ€ã€‚</p>
<h3 data-id="heading-4"><strong>å…³äº BAAI RoboBrain</strong></h3>
<p>RoboBrain æ˜¯æ™ºæºç ”ç©¶é™¢æ¨å‡ºçš„é¢å‘çœŸå®ç‰©ç†ç¯å¢ƒçš„â€œé€šç”¨å…·èº«å¤§è„‘â€ç³»ç»Ÿï¼Œé›†æ„ŸçŸ¥ã€æ¨ç†ä¸è§„åˆ’äºä¸€ä½“ï¼Œæ„å»ºäº†ä»å¤§è„‘è®¤çŸ¥åˆ°å°è„‘æ§åˆ¶çš„å®Œæ•´æŠ€æœ¯ä½“ç³»ï¼ŒåŒ…æ‹¬å…·èº«å¤§è„‘åŸºåº§æ¨¡å‹RoboBrain 2.0ã€é¢å‘3Dè½¨è¿¹ç”Ÿæˆçš„RoboBrain-SpatialTraceã€ç”¨äºå¼ºåŒ–å­¦ä¹ ç¨ å¯†å¥–åŠ±ç”Ÿæˆçš„RoboBrain-Dopamineã€é€šç”¨å°è„‘VLAæ¨¡å‹RoboBrain-X0 Proï¼Œä»¥åŠçµå·§æ‰‹åŸºåº§æ¨¡å‹RoboBrain-Dexã€‚</p>
<p>é…åˆè·¨æœ¬ä½“ååŒæ¡†æ¶RoboOS 2.0ï¼ŒRoboBrainæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›ç»Ÿä¸€ã€é«˜æ•ˆçš„å…·èº«æ™ºèƒ½åŸºç¡€è®¾æ–½ï¼Œè§£å†³ç©ºé—´ç†è§£ã€æ—¶é—´å»ºæ¨¡ä¸é•¿é“¾æ¨ç†ä¸‰å¤§ç“¶é¢ˆï¼ŒåŠ é€Ÿæœºå™¨äººè¿ˆå‘é€šç”¨å…·èº«æ™ºèƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Grafana LDAPé…ç½®æ•…éšœæ’æŸ¥ï¼šä»3å°æ—¶åˆ°10åˆ†é’Ÿçš„AIè¾…åŠ©è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7582785032851898431</link>    <guid>https://juejin.cn/post/7582785032851898431</guid>    <pubDate>2025-12-12T10:28:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582785032851898431" data-draft-id="7582785032851865663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Grafana LDAPé…ç½®æ•…éšœæ’æŸ¥ï¼šä»3å°æ—¶åˆ°10åˆ†é’Ÿçš„AIè¾…åŠ©è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-12T10:28:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LambHappiness"/> <meta itemprop="url" content="https://juejin.cn/user/1136211138460633"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Grafana LDAPé…ç½®æ•…éšœæ’æŸ¥ï¼šä»3å°æ—¶åˆ°10åˆ†é’Ÿçš„AIè¾…åŠ©è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1136211138460633/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LambHappiness
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:28:59.000Z" title="Fri Dec 12 2025 10:28:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡é€šè¿‡ä¸€ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œå±•ç¤º Chaterm å¦‚ä½•åœ¨ 10 åˆ†é’Ÿå†…è§£å†³è¿ç»´äººå‘˜ 3 å°æ—¶æ— æ³•è§£å†³çš„ Grafana LDAP é…ç½®é—®é¢˜ã€‚è¯¦ç»†ä»‹ç» AI å¦‚ä½•ç³»ç»ŸåŒ–æ’æŸ¥ï¼šä»é—®é¢˜å®šä½ã€é…ç½®åˆ†æã€LDAP è¿æ¥æµ‹è¯•ï¼Œåˆ°ç²¾å‡†ä¿®å¤é…ç½®é”™è¯¯ï¼Œæœ€ç»ˆå®ç°æ”¯æŒå¤šç§ç™»å½•æ ¼å¼çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚é€šè¿‡å¯¹æ¯”ä¼ ç»Ÿæ‰‹åŠ¨æ’æŸ¥å’Œ AI è¾…åŠ©æ’æŸ¥ï¼Œå±•ç¤º Chaterm åœ¨æå‡è¿ç»´æ•ˆç‡ã€é™ä½æ’æŸ¥æˆæœ¬ã€å¢å¼ºé—®é¢˜è§£å†³èƒ½åŠ›æ–¹é¢çš„æŠ€æœ¯ä¼˜åŠ¿ã€‚</p>
</blockquote>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c32cf206e864b79839276202e43c01c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=2oHvCWkxKnewXhyEjAoSvYEsvWI%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>â€œå‡Œæ™¨ 2 ç‚¹ï¼Œä½ è¿˜åœ¨å¯¹ç€æ»¡å±çš„é”™è¯¯æ—¥å¿—å‘æ„...â€</p>
</blockquote>
<p>é…ç½®æ”¹äº†ï¼Œé‡å¯äº†ï¼Œæ—¥å¿—çœ‹äº†ï¼Œè¿˜æ˜¯ç™»ä¸è¿›å»... æœç´¢å¼•æ“å‰ 10 é¡µçš„æ–¹æ¡ˆè¯•äº†ä¸ªéï¼Œé—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚</p>
<p>ç›¸ä¿¡æ¯ä¸ªæè¿ç»´çš„æœ‹å‹ï¼Œéƒ½ç»å†è¿‡è¿™ç§ â€œè¢«é…ç½®æ”¯é…çš„ç»æœ›æ—¶åˆ»â€ ã€‚å°¤å…¶æ˜¯æ¶‰åŠåˆ° LDAP æ¥å…¥è¿™ç§ç„å­¦é…ç½®ï¼Œå¸¸å¸¸ä¸€å¡å°±æ˜¯ä¸€æ•´å¤œã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘å°±ç»™å¤§å®¶åˆ†äº«ä¸€ä¸ªå‰å‡ å¤©å‘ç”Ÿçš„çœŸå®æ¡ˆä¾‹ã€‚æˆ‘ä¸€ä¸ªæè¿ç»´å¿«å…«å¹´çš„æœ‹å‹ï¼Œè¢«ä¸€ä¸ªÂ <strong>Grafana æ¥å…¥ LDAP</strong>Â çš„å°é—®é¢˜æŠ˜è…¾äº†Â <strong>3 å°æ—¶</strong>ã€‚æœ€åï¼Œä»–è¯•äº†ä¸€ä¸ªæˆ‘ä»¬å†…éƒ¨åœ¨ç”¨çš„Â <strong>AI è¾…åŠ©æ’æŸ¥å·¥å…·ï¼Œ10 åˆ†é’Ÿ</strong>ï¼Œé—®é¢˜æ ¹æºè¢«æªäº†å‡ºæ¥ï¼</p>
<p>å’±ä»¬ä¸èŠäº§å“ï¼ŒåªèŠæ’æŸ¥æ€è·¯å’ŒæŠ€æœ¯å¹²è´§ã€‚</p>
<h3 data-id="heading-0">æœ‹å‹å°ä¸°çš„æ¡ˆä¾‹</h3>
<p><strong>ä»»åŠ¡ï¼š</strong> Â é…ç½® Grafana æ¥å…¥å…¬å¸ LDAPï¼Œæ–¹ä¾¿åŒäº‹èƒ½ç»Ÿä¸€ç™»å½•</p>
<p>æŒ‰ç…§æ–‡æ¡£ä¸€æ­¥æ­¥é…ç½®ï¼Œæ£€æŸ¥äº† 3 éï¼Œç¡®è®¤æ²¡é—®é¢˜ã€‚è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç‚¹å‡»ç™»å½•...</p>
<p><strong>âŒ ç™»å½•å¤±è´¥ï¼</strong></p>
<p>æŸ¥çœ‹æ—¥å¿—æŠ¥é”™ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-attr">[password-auth.failed]</span> <span class="hljs-selector-tag">failed</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">authenticate</span> <span class="hljs-selector-tag">identity</span>:
<span class="hljs-selector-attr">[identity.not-found]</span> <span class="hljs-selector-tag">no</span> <span class="hljs-selector-tag">user</span> <span class="hljs-selector-tag">found</span>: <span class="hljs-selector-tag">did</span> <span class="hljs-selector-tag">not</span> <span class="hljs-selector-tag">find</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">user</span>
</code></pre>
<p>æ—¥å¿—æ˜¾ç¤ºæ‰¾ä¸åˆ° ldap ç”¨æˆ·ï¼Œå°ä¸°ç«‹åˆ»å¼€å§‹äº†<strong>æ ‡å‡†æ’æŸ¥æµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>é…ç½®è‡ªæŸ¥</strong>ï¼šæ–‡ä»¶è·¯å¾„ã€LDAP åœ°å€ã€ç«¯å£å·ï¼Œå…¨éƒ¨æ ¸å¯¹ï¼Œldap.toml çœ‹èµ·æ¥æ²¡é—®é¢˜ã€‚</li>
<li><strong>ç½‘ç»œæµ‹è¯•</strong>ï¼štelnetã€nc ä¸€é¡¿æ“ä½œï¼Œç«¯å£é€šï¼Œç½‘ç»œæ²¡é—®é¢˜ã€‚</li>
<li><strong>æ—¥å¿—æ·±æŒ–</strong>ï¼šå‘ç° Grafana é»˜è®¤æ—¥å¿—å¤ªç®€æ´ï¼Œæ ¹æœ¬çœ‹ä¸å‡ºå®ƒåˆ°åº•ç”¨ä»€ä¹ˆå­—æ®µå»æŸ¥ç”¨æˆ·ã€‚</li>
<li><strong>å„ç§æœç´¢</strong>ï¼šå‘ç°å¤§éƒ¨åˆ†æ–¹æ¡ˆéƒ½å›´ç»•ç€ bind_dn æˆ– search_filter æ‰“è½¬ï¼Œä½†æ”¹äº†éƒ½æ²¡ç”¨ã€‚</li>
</ol>
<p>æ—¶é—´ä¸€ç‚¹ä¸€ç‚¹è¿‡å»äº†ï¼Œå°ä¸°çš„å¿ƒæ€ä¹Ÿä¸€ç‚¹ä¸€ç‚¹å´©å¡Œäº†...å¤œæ·±äº†ï¼Œä»–å†³å®šå…ˆæ”¾å¼ƒã€‚</p>
<p>ç¬¬äºŒå¤©ï¼Œå°ä¸°å†³å®šæ¢ä¸ªæ€è·¯ã€‚ä»–æ‰¾æ¥äº†æˆ‘ä»¬å†…éƒ¨ç”¨æ¥åšè¾…åŠ©æ’æŸ¥çš„å·¥å…· Chatermï¼ŒæŠŠæ˜¨æ™šçš„é”™è¯¯æ—¥å¿—ã€Grafana é…ç½®è·¯å¾„ï¼Œä»¥åŠä¸€å¥ â€œå¸®æˆ‘çœ‹çœ‹â€ æ‰”äº†è¿›å»ã€‚</p>
<p><strong>10 åˆ†é’Ÿåï¼ŒAI ç»™å‡ºäº†å®Œç¾çš„ä¿®å¤æ–¹æ¡ˆã€‚</strong></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ª AI Agent æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥æ‰¾åˆ°é—®é¢˜çš„ï¼Œè¿™å¥—æ€è·¯éå¸¸å€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚</p>
<h2 data-id="heading-1">å®æˆ˜å¼€å§‹</h2>
<h3 data-id="heading-2">ğŸ¯ ç¬¬ä¸€æ­¥ï¼šæ ¸å¿ƒé—®é¢˜å®šä½</h3>
<p>å¤åˆ¶é”™è¯¯æ—¥å¿—ï¼Œç²˜è´´ç»™ Chaterm</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">logger</span>=authn.service ... error=<span class="hljs-string">"[password-auth.failed] failed to authenticate identity:
[identity.not-found] no user found: did not find a user"</span>
grafanaæ¥å…¥ldapç™»é™†æŠ¥é”™ï¼Œé…ç½®æ–‡ä»¶åœ¨/etc/grafanaç›®å½•ï¼Œåˆ†æä¸‹åŸå› 
</code></pre>
<p>Chaterm çš„å›åº”ï¼š</p>
<blockquote>
<p>"...è®¤è¯å¤±è´¥åŸå› æ˜¯'ç”¨æˆ·æœªæ‰¾åˆ°'ã€‚è®©æˆ‘å…ˆæ£€æŸ¥é…ç½®æ–‡ä»¶ã€‚"</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4d11a347023488b9d82e82ec1607fb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=ceBmUq565uQ03YrS%2B5SO8cGYYLM%3D" alt="" loading="lazy"/></p>
<p>äºæ˜¯é”å®šäº†æ ¸å¿ƒé—®é¢˜ï¼šè®¤è¯å¤±è´¥ä¸åœ¨äºå¯†ç é”™è¯¯ï¼Œè€Œåœ¨äº Grafana å‹æ ¹æ²¡æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·ã€‚</p>
<h3 data-id="heading-3">ğŸ” ç¬¬äºŒæ­¥ï¼šç³»ç»ŸåŒ–æ’æŸ¥</h3>
<p>å°±åƒä¾¦æ¢ç ´æ¡ˆä¸€æ ·ï¼ŒChaterm æŒ‰æ­¥éª¤æ¥ï¼Œæ¯ä¸€æ­¥éƒ½æ¸…æ™°å¯è§ï¼š</p>
<h4 data-id="heading-4">2.1 ç¡®è®¤é…ç½®æ–‡ä»¶ä½ç½®ï¼š</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -la /etc/grafana/
</code></pre>
<p>æ‰¾åˆ°äº†Â <code>ldap.toml</code>Â é…ç½®æ–‡ä»¶</p>
<h4 data-id="heading-5">2.2 è¯»å–å¹¶åˆ†ææ ¸å¿ƒé…ç½®å†…å®¹ï¼š</h4>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">cat</span> /etc/grafana/ldap.toml
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f88d6fc35b1419693bd5093b162cc88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=pzWeeeYYUPhjmh9GQkNjnGJzFlY%3D" alt="" loading="lazy"/></p>
<p><strong>AI å‘ç°äº† 3 ä¸ªå¯ç–‘ç‚¹ï¼ˆè¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ï¼ï¼‰ï¼š</strong></p>
<ol>
<li>
<p><strong>é”™è¯¯ 1ï¼š</strong> Â <code>search_filter = "(sAMAccountName=%s)"</code></p>
<ul>
<li><strong>é—®é¢˜ï¼š</strong> Â è¿™ä¸ªå±æ€§å¯èƒ½ä¸å­˜åœ¨ï¼ˆè¿™æ˜¯ Windows AD ä¸“ç”¨çš„ï¼Œæ ‡å‡† LDAP æ²¡æœ‰ï¼‰</li>
<li><strong>å½±å“ï¼š</strong> Â ç³»ç»Ÿç”¨è¿™ä¸ªå±æ€§æ‰¾ç”¨æˆ·ï¼Œå½“ç„¶æ‰¾ä¸åˆ°ï¼</li>
</ul>
</li>
<li>
<p><strong>å¯ç–‘ 2ï¼š</strong> Â <code>username = "sn"</code></p>
<ul>
<li><strong>é—®é¢˜ï¼š</strong> Â ç”¨å§“æ°å½“ç”¨æˆ·åï¼Ÿæœ‰ç‚¹å¥‡æ€ª</li>
<li><strong>å½±å“ï¼š</strong> Â å¯èƒ½å¯¼è‡´ç”¨æˆ·åæ ¼å¼ä¸åŒ¹é…</li>
</ul>
</li>
<li>
<p><strong>å¯ç–‘ 3ï¼š</strong> Â <code>bind_dn = "cn=ldap@email.com,ou=user,dc=email,dc=com"</code></p>
<ul>
<li><strong>é—®é¢˜ï¼š</strong> Â æ ¼å¼çœ‹èµ·æ¥ä¸å¤ªæ ‡å‡†</li>
<li><strong>å½±å“ï¼š</strong> Â å¯èƒ½è¿æ¥å¤±è´¥</li>
</ul>
</li>
</ol>
<p><strong>è¿™å°±æ˜¯ AI çš„å‰å®³ä¹‹å¤„ï¼š</strong> Â ä¸€çœ¼å°±èƒ½çœ‹å‡ºé…ç½®ä¸­çš„æ½œåœ¨é—®é¢˜ï¼Œå°±åƒç»éªŒä¸°å¯Œçš„è¿ç»´ä¸“å®¶ï¼ä½ æ‰‹åŠ¨æ£€æŸ¥å¯èƒ½è¦èŠ± 30 åˆ†é’Ÿï¼ŒAI ç§’æ‡‚ï¼</p>
<h4 data-id="heading-6">2.3 æµ‹è¯•è¿æ¥</h4>
<p>AI è‡ªåŠ¨æµ‹è¯•ç½‘ç»œè¿æ¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">timeout</span> 5 bash -c <span class="hljs-string">"echo &gt; /dev/tcp/192.168.1.1/3893"</span>
</code></pre>
<p><strong>ç»“æœï¼š</strong> Â ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œç«¯å£ 3893 èƒ½é€š</p>
<p><strong>ç»“è®ºï¼š</strong> Â ç½‘ç»œæ²¡é—®é¢˜ï¼Œé—®é¢˜åœ¨é…ç½®ï¼</p>
<h4 data-id="heading-7">2.4 æŸ¥çœ‹"æ¡ˆå‘è®°å½•"ï¼ˆæ—¥å¿—ä¿¡æ¯ï¼‰</h4>
<p>AI è‡ªåŠ¨æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">tail</span> -100 /var/log/grafana/grafana.log | grep -i <span class="hljs-string">"ldap|authn"</span>
</code></pre>
<p>å‘ç°ï¼š æ—¥å¿—å¤ªç®€å•äº†ï¼Œçœ‹ä¸åˆ°å…·ä½“çš„æœç´¢è¿‡ç¨‹ï¼Œéœ€è¦æ›´è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ã€‚</p>
<p>AI åˆ¤æ–­ï¼š éœ€è¦æ·±å…¥è°ƒæŸ¥ï¼Œç›´æ¥æµ‹è¯• LDAP è¿æ¥ï¼</p>
<h3 data-id="heading-8">ğŸ§° ç¬¬ä¸‰æ­¥ï¼šæ·±å…¥è°ƒæŸ¥ï¼Œå¯åŠ¨ä¸“ä¸šå·¥å…·</h3>
<h4 data-id="heading-9">3.1 è‡ªåŠ¨å®‰è£… LDAP å®¢æˆ·ç«¯å·¥å…·ï¼š</h4>
<pre><code class="hljs language-ini" lang="ini">sudo yum install -y openldap-clients --disable <span class="hljs-attr">repo</span>=grafana
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c92caf6155c34175835358be6f929869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=3J0yw%2F3JNvzsILQJW65mGGiEJeQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-10">3.2 æµ‹è¯•ä¸åŒçš„è¿æ¥æ–¹å¼</h4>
<p>AI è‡ªåŠ¨è¯•é”™ï¼Œå°è¯•ä¸åŒçš„è¿æ¥æ ¼å¼ï¼Œçœ‹å“ªä¸ªèƒ½æˆåŠŸï¼š</p>
<p><strong>å°è¯• 1ï¼šæ ‡å‡†æ ¼å¼ï¼ˆå¤±è´¥ï¼‰</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">ldapsearch -x -H ldap:<span class="hljs-comment">//192.168.1.1:3893 \</span>
-D <span class="hljs-string">"cn=ldap,ou=user,dc=email,dc=com"</span> \
-w password -b <span class="hljs-string">"dc=email,dc=com"</span> \
<span class="hljs-string">"(objectClass=person)"</span> dn

<span class="hljs-meta"># ç»“æœï¼šâŒ ldap_bind: Invalid credentials (49) - è®¤è¯å¤±è´¥</span>
</code></pre>
<p><strong>å°è¯• 2ï¼šåŸå§‹æ ¼å¼ï¼ˆæˆåŠŸï¼ï¼‰</strong></p>
<pre><code class="hljs language-perl" lang="perl">ldapsearch -<span class="hljs-keyword">x</span> -H ldap:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>:<span class="hljs-number">3893</span> \
-D <span class="hljs-string">"cn=ldap@email.com,ou=user,dc=email,dc=com"</span> \
-w password -b <span class="hljs-string">"dc=email,dc=com"</span> \
<span class="hljs-string">"(objectClass=*)"</span> dn
</code></pre>
<p><strong>ç»“æœï¼š</strong> Â æ‰¾åˆ°äº†ç”¨æˆ·åˆ—è¡¨ï¼å‘ç°ç”¨æˆ·çš„æ ¼å¼æ˜¯Â <code>cn=ç”¨æˆ·å@email.com</code></p>
<p><strong>AI å‘ç°ï¼š</strong> Â è¿æ¥æ ¼å¼éœ€è¦å¸¦Â <code>@email.com</code>Â åç¼€ï¼</p>
<h4 data-id="heading-11">3.3 æŸ¥çœ‹"ç”¨æˆ·æ¡£æ¡ˆ"ï¼ˆå®é™…å±æ€§ï¼‰</h4>
<p>AI æŸ¥çœ‹ä¸€ä¸ªå…·ä½“ç”¨æˆ·çš„å®Œæ•´ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">ldapsearch</span> <span class="hljs-selector-tag">-x</span> <span class="hljs-selector-tag">-H</span> <span class="hljs-selector-tag">ldap</span>:<span class="hljs-comment">//192.168.1.1:3893 \</span>
<span class="hljs-selector-tag">-D</span> "<span class="hljs-selector-tag">cn</span>=<span class="hljs-selector-tag">ldap</span>@<span class="hljs-selector-tag">email</span><span class="hljs-selector-class">.com</span>,<span class="hljs-selector-tag">ou</span>=<span class="hljs-selector-tag">user</span>,<span class="hljs-selector-tag">dc</span>=<span class="hljs-selector-tag">email</span>,<span class="hljs-selector-tag">dc</span>=<span class="hljs-selector-tag">com</span>" \
<span class="hljs-selector-tag">-w</span> <span class="hljs-selector-tag">password</span> <span class="hljs-selector-tag">-b</span> "<span class="hljs-selector-tag">dc</span>=<span class="hljs-selector-tag">email</span>,<span class="hljs-selector-tag">dc</span>=<span class="hljs-selector-tag">com</span>" \
"(cn=zhang_san<span class="hljs-variable">@email</span>.com)"
</code></pre>
<p><strong>å…³é”®å‘ç°ï¼ˆè¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ï¼ï¼‰ï¼š</strong> Â AI é€šè¿‡ ldapsearch å‘½ä»¤æŸ¥çœ‹äº†ä¸€ä¸ªç”¨æˆ·çš„å®Œæ•´å±æ€§ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">dn: cn=zhang_san@email.com,ou=user,dc=email,dc=com</span>
<span class="hljs-section">cn: zhang_san@email.com</span>
<span class="hljs-section">uid: zhang_san@email.com â† ğŸ”´ æ³¨æ„ï¼šuidæ˜¯å®Œæ•´é‚®ç®±æ ¼å¼ï¼</span>
<span class="hljs-section">sn: zhang_san â† è¿™æ˜¯ç”¨æˆ·åå‰ç¼€</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9e67cf1512b4a2f94da5d68e123c3ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=bHVbZsDVei1j9eg2C%2BTWCz%2B8aWk%3D" alt="" loading="lazy"/></p>
<p><strong>çœŸç›¸å¤§ç™½ï¼é—®é¢˜æ‰¾åˆ°äº†ï¼š</strong></p>




















<table><thead><tr><th>å®é™…æƒ…å†µ</th><th>é…ç½®ä¸­çš„è®¾ç½®</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>LDAP ä¸­çš„ uid æ˜¯ï¼š<code>zhang_san@email.com</code></td><td>æœç´¢è¿‡æ»¤å™¨ç”¨ï¼š<code>(sAMAccountName=%s)</code></td><td>âŒ è¿™ä¸ªå±æ€§æ ¹æœ¬ä¸å­˜åœ¨ï¼</td></tr><tr><td>ç”¨æˆ·ç™»å½•è¾“å…¥ï¼š<code>zhang_san</code></td><td>é…ç½®ç”¨ï¼š<code>username = "sn"</code></td><td>âŒ æ ¼å¼ä¸åŒ¹é…ï¼</td></tr></tbody></table>
<p>ç®€å•æ¥è¯´ï¼š</p>
<ul>
<li>å°ä¸°è¾“å…¥â€˜zhang_sanâ€™ç™»å½•</li>
<li>ç³»ç»Ÿç”¨Â <code>sAMAccountName</code>Â å±æ€§å»æ‰¾ï¼ˆä½†è¿™ä¸ªå±æ€§ä¸å­˜åœ¨ï¼‰</li>
<li>LDAP ä¸­å®é™…å­˜å‚¨çš„æ˜¯Â <code>uid=zhang_san@email.com</code>ï¼ˆå®Œæ•´é‚®ç®±æ ¼å¼ï¼‰</li>
<li>æ‰€ä»¥æ‰¾ä¸åˆ°ç”¨æˆ·ï¼</li>
</ul>
<p>å°±åƒä½ è¦æ‰¾"å¼ ä¸‰"ï¼Œä½†ç³»ç»Ÿåœ¨æ‰¾"å¼  sAMAccountName"ï¼Œå½“ç„¶æ‰¾ä¸åˆ°ï¼</p>
<h3 data-id="heading-12">ğŸ› ï¸ ç¬¬å››æ­¥ï¼šä¸€é”®ä¿®å¤</h3>
<p>ç¡®å®šæ ¹æºåï¼ŒAI å¼€å§‹æ‰§è¡Œä¿®å¤ã€‚</p>
<p><strong>è¿ç»´å¥½ä¹ æƒ¯</strong>ï¼š ä¿®æ”¹å‰å…ˆå¤‡ä»½ï¼Œé¿å…è¯¯æ“ä½œï¼ˆè¿™ç‚¹å¾ˆé‡è¦ï¼ï¼‰</p>
<h4 data-id="heading-13">4.1 å¤‡ä»½ï¼ˆå®‰å…¨ç¬¬ä¸€ï¼‰</h4>
<p>è‡ªåŠ¨å¤‡ä»½é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">cp</span> /etc/grafana/ldap.toml /etc/grafana/ldap.toml.backup
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d6f602bde5643f598f7117fa42efc5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=vlVd9PKgdG2swdLd7eQy89rA7%2F8%3D" alt="" loading="lazy"/></p>
<p>ğŸ’¡ å¦‚æœä½ ä¸è®°å¾—ï¼Œ<strong>Chaterm ä¼šè‡ªåŠ¨å¤‡ä»½</strong>ã€‚ä¸‡ä¸€æ”¹é”™äº†ï¼Œè¿˜èƒ½æ¢å¤ï¼</p>
<h4 data-id="heading-14">4.2 ä¿®å¤æ ¸å¿ƒé—®é¢˜</h4>
<p><strong>é—®é¢˜ï¼š</strong> Â ç”¨äº†ä¸å­˜åœ¨çš„å±æ€§Â <code>sAMAccountName</code>ï¼ˆè¿™æ˜¯ Windows AD ä¸“ç”¨çš„ï¼‰</p>
<p><strong>è§£å†³ï¼š</strong> Â æ”¹æˆå®é™…å­˜åœ¨çš„Â <code>uid</code></p>
<p>AI è‡ªåŠ¨ä¿®æ”¹é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä¿®æ”¹å‰ï¼šsearch_filter = "(sAMAccountName=%s)" âŒ</span>
<span class="hljs-comment"># ä¿®æ”¹åï¼šsearch_filter = "(uid=%s)" âœ…</span>
sudo sed -i 's/^<span class="hljs-attr">search_filter</span> = <span class="hljs-string">"(sAMAccountName=%s)"</span>/search_filter = <span class="hljs-string">"(uid=%s)"</span>/<span class="hljs-string">' /etc/grafana/ldap.toml
</span></code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29af6c97decb453dbeb68bb6af264088~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=Ypa5TMYeGJEMB5VkjML1Ju5tFLw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">4.3 ä¿®å¤ç”¨æˆ·åæ˜ å°„</h4>
<p><strong>é—®é¢˜ï¼š</strong> Â ç”¨å§“æ°Â <code>sn</code>Â å½“ç”¨æˆ·åï¼ˆæ ¼å¼ä¸å¯¹ï¼‰</p>
<p><strong>è§£å†³ï¼š</strong> Â æ”¹æˆç”¨æˆ· IDÂ <code>uid</code></p>
<p>AI è‡ªåŠ¨ä¿®æ”¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä¿®æ”¹å‰ï¼šusername = "sn" âŒ</span>
<span class="hljs-comment"># ä¿®æ”¹åï¼šusername = "uid" âœ…</span>
sudo sed -i 's/^<span class="hljs-attr">username</span> = <span class="hljs-string">"sn"</span>/username = <span class="hljs-string">"uid"</span>/<span class="hljs-string">' /etc/grafana/ldap.toml
</span></code></pre>
<h4 data-id="heading-16">4.4 å¼€å¯è°ƒè¯•æ—¥å¿—ï¼ˆæ–¹ä¾¿ä»¥åæ’æŸ¥ï¼‰</h4>
<p>AI è‡ªåŠ¨å¼€å¯è¯¦ç»†æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-css" lang="css">sudo sed -<span class="hljs-selector-tag">i</span> '/^<span class="hljs-selector-attr">[log]</span>/<span class="hljs-selector-tag">a</span> filters = ldap:debug<span class="hljs-string">' /etc/grafana/grafana.ini
</span></code></pre>
<p><strong>å¥½å¤„ï¼š</strong> Â ä»¥åå‡ºé—®é¢˜ï¼Œæ—¥å¿—ä¼šæ›´è¯¦ç»†ï¼Œå®¹æ˜“å®šä½ã€‚</p>
<h4 data-id="heading-17">4.5 é‡å¯æœåŠ¡ï¼ˆè®©é…ç½®ç”Ÿæ•ˆï¼‰</h4>
<p>AI è‡ªåŠ¨é‡å¯æœåŠ¡ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">sudo systemctl restart grafana-<span class="hljs-built_in">server</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f72400fc6af4db2ba5820973a4f26d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=PX1ndAwiEkYB8pQw1UJttfh4R00%3D" alt="" loading="lazy"/></p>
<p>å®Œæˆï¼æ‰€æœ‰ä¿®æ”¹éƒ½æ˜¯Â <strong>Chaterm</strong>è‡ªåŠ¨å®Œæˆçš„ï¼Œä½ åªéœ€ç¡®è®¤ç»“æœã€‚</p>
<h3 data-id="heading-18">ğŸ”„ ç¬¬äº”æ­¥ï¼šè¿˜æœ‰é—®é¢˜ï¼ŸChaterm ç»§ç»­æ·±æŒ–</h3>
<p>é‡å¯åï¼Œä½ å†æ¬¡å°è¯•ç™»å½•ï¼Œè¿˜æ˜¯å¤±è´¥ã€‚</p>
<p>ä½ å‘Šè¯‰ Chatermï¼š "è¿˜æ˜¯ç™»ä¸è¿›å»"</p>
<p>Chaterm ç«‹å³æŸ¥çœ‹è°ƒè¯•æ—¥å¿—ï¼ˆç°åœ¨æœ‰è¯¦ç»†æ—¥å¿—äº†ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">tail</span> -50 /var/log/grafana/grafana.log | grep -i <span class="hljs-string">"ldap"</span>
</code></pre>
<p><strong>æ–°çš„å‘ç°ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">logger</span>=ldap ... msg=<span class="hljs-string">"LDAP SearchRequest"</span>
<span class="hljs-attr">searchRequest</span>=<span class="hljs-string">"Filter:(|(uid=zhang_san)) ..."</span> â† ğŸ”´ æœç´¢çš„æ˜¯ zhang_san
<span class="hljs-attr">logger</span>=ldap ... msg=<span class="hljs-string">"unable to login with LDAP"</span>
<span class="hljs-attr">error</span>=<span class="hljs-string">"can't find user in LDAP"</span> â† âŒ è¿˜æ˜¯æ‰¾ä¸åˆ°
</code></pre>
<p><strong>é—®é¢˜æ‰¾åˆ°äº†ï¼š</strong></p>
<ul>
<li>ç³»ç»Ÿæœç´¢çš„æ˜¯ï¼š<code>uid=zhang_san</code>ï¼ˆä½ è¾“å…¥çš„ç”¨æˆ·åï¼‰</li>
<li>ä½† LDAP ä¸­å®é™…å­˜å‚¨çš„æ˜¯ï¼š<code>uid=zhang_san@email.com</code>ï¼ˆå®Œæ•´é‚®ç®±æ ¼å¼ï¼‰</li>
<li><strong>æ ¼å¼ä¸åŒ¹é…ï¼</strong></li>
</ul>
<p><strong>å°±åƒä½ è¦æ‰¾"å¼ ä¸‰"ï¼Œä½†ç³»ç»Ÿåœ¨æ‰¾"å¼ ä¸‰"ï¼ˆæ²¡æœ‰åç¼€ï¼‰ï¼Œè€Œå®é™…å­˜å‚¨çš„æ˜¯"å¼ ä¸‰@å…¬å¸.com"</strong></p>
<h4 data-id="heading-19">5.1 å†æ¬¡éªŒè¯ï¼ˆç¡®è®¤é—®é¢˜ï¼‰</h4>
<p>Chaterm å†æ¬¡éªŒè¯ï¼Œç¡®è®¤ç”¨æˆ·çš„ uid ç¡®å®æ˜¯å®Œæ•´é‚®ç®±æ ¼å¼ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">ldapsearch</span> ... "(uid=zhang_san<span class="hljs-variable">@email</span>.com)" <span class="hljs-selector-tag">dn</span> <span class="hljs-selector-tag">uid</span>
</code></pre>
<p><strong>ç»“æœï¼š</strong> Â ç¡®è®¤ç”¨æˆ·çš„ uid ç¡®å®æ˜¯å®Œæ•´é‚®ç®±æ ¼å¼</p>
<h4 data-id="heading-20">5.2 ç»ˆæè§£å†³æ–¹æ¡ˆï¼šæ”¯æŒå¤šç§ç™»å½•æ–¹å¼</h4>
<p>Chaterm çš„æ€è·¯ï¼š è®©æœç´¢è¿‡æ»¤å™¨æ”¯æŒå¤šç§æ ¼å¼ï¼Œç”¨æˆ·æ€ä¹ˆè¾“å…¥éƒ½èƒ½æ‰¾åˆ°ï¼</p>
<pre><code class="hljs language-less" lang="less"># ä¿®æ”¹ä¸ºæ”¯æŒä¸‰ç§ç™»å½•æ–¹å¼ï¼š
# <span class="hljs-number">1</span>. è¾“å…¥å®Œæ•´é‚®ç®±ï¼š<span class="hljs-selector-tag">zhang_san</span>@<span class="hljs-selector-tag">email</span><span class="hljs-selector-class">.com</span> â†’ ç›´æ¥åŒ¹é…
# <span class="hljs-number">2</span>. è¾“å…¥ç”¨æˆ·åï¼š<span class="hljs-selector-tag">zhang_san</span> â†’ åŒ¹é…<span class="hljs-selector-tag">sn</span>å±æ€§
# <span class="hljs-number">3</span>. è‡ªåŠ¨è¿½åŠ åŸŸåï¼š<span class="hljs-selector-tag">zhang_san</span> â†’ åŒ¹é…<span class="hljs-selector-tag">uid</span>=<span class="hljs-selector-tag">zhang_san</span>@<span class="hljs-selector-tag">email</span><span class="hljs-selector-class">.com</span>
<span class="hljs-selector-tag">sudo</span> <span class="hljs-selector-tag">sed</span> <span class="hljs-selector-tag">-i</span> '<span class="hljs-selector-tag">s</span>#^<span class="hljs-selector-tag">search_filter</span> = "(uid=%s)"<span class="hljs-selector-id">#search_filter</span> = "(|(uid=%s)(uid=%s<span class="hljs-variable">@email</span>.com)(sn=%s))"#' /<span class="hljs-selector-tag">etc</span>/<span class="hljs-selector-tag">grafana</span>/<span class="hljs-selector-tag">ldap</span><span class="hljs-selector-class">.toml</span>
</code></pre>
<p><strong>æœ€ç»ˆé…ç½®ï¼ˆä¸‡èƒ½æœç´¢ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">search_filter</span> = "(|(uid=%s)(uid=%s<span class="hljs-variable">@email</span>.com)(sn=%s))"
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b244d0b0398d4d6094dec6ec4433e871~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGFtYkhhcHBpbmVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766140138&amp;x-signature=AYDrADThkO5M2BgGRaNQzb15Zbs%3D" alt="" loading="lazy"/></p>
<p>è¿™æ˜¯æœ€äº®çœ¼çš„ä¸€æ­¥ï¼Œä¸ºäº†è§£å†³ç”¨æˆ·è¾“å…¥æ ¼å¼ä¸ä¸€è‡´çš„é—®é¢˜ï¼ŒChaterm å¹¶æ²¡æœ‰è®©å°ä¸°å»æ”¹ç™»å½•ä¹ æƒ¯ï¼Œè€Œæ˜¯ä¼˜åŒ–äº†æœç´¢é€»è¾‘ã€‚</p>
<p><strong>è¿™ä¸ªé…ç½®æœ‰å¤šå¼ºï¼Ÿ</strong></p>
<ul>
<li>ç”¨æˆ·è¾“å…¥Â <code>zhang_san@email.com</code>Â â†’ ç›´æ¥åŒ¹é…Â <code>uid=zhang_san@email.com</code></li>
<li>ç”¨æˆ·è¾“å…¥Â <code>zhang_san</code>Â â†’ åŒ¹é…Â <code>sn=zhang_san</code>Â æˆ–Â <code>uid=zhang_san@email.com</code></li>
</ul>
<p><strong>è‡³æ­¤ï¼Œæ— è®ºç”¨æˆ·æ€ä¹ˆè¾“å…¥ï¼Œéƒ½èƒ½è¢«æ‰¾åˆ°ã€‚</strong></p>
<p><strong>æœ€ç»ˆé…ç½®</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># LDAPæœåŠ¡å™¨é…ç½®</span>
<span class="hljs-attr">host</span> = <span class="hljs-string">"192.168.1.1"</span>
<span class="hljs-attr">port</span> = <span class="hljs-number">3893</span>
<span class="hljs-attr">bind_dn</span> = <span class="hljs-string">"cn=ldap@email.com,ou=user,dc=email,dc=com"</span>
<span class="hljs-attr">bind_password</span> = <span class="hljs-string">'password'</span>

<span class="hljs-comment"># æœç´¢è¿‡æ»¤å™¨ - æ”¯æŒå¤šç§æ ¼å¼</span>
<span class="hljs-attr">search_filter</span> = <span class="hljs-string">"(|(uid=%s)(uid=%s@email.com)(sn=%s))"</span>
<span class="hljs-attr">search_base_dns</span> = [<span class="hljs-string">"ou=user,dc=email,dc=com"</span>]

<span class="hljs-comment"># å±æ€§æ˜ å°„</span>
<span class="hljs-section">[servers.attributes]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"givenName"</span>
<span class="hljs-attr">surname</span> = <span class="hljs-string">"sn"</span>
<span class="hljs-attr">username</span> = <span class="hljs-string">"uid"</span> <span class="hljs-comment"># å…³é”®ï¼šä½¿ç”¨uidè€Œä¸æ˜¯sn</span>
<span class="hljs-attr">member_of</span> = <span class="hljs-string">"memberOf"</span>
<span class="hljs-attr">email</span> = <span class="hljs-string">"mail"</span>
</code></pre>
<h3 data-id="heading-21">æ€»ç»“ï¼šChaterm å¸¦æ¥çš„æŠ€æœ¯æå‡</h3>
<p>æ•´ä¸ªæ’æŸ¥å’Œä¿®å¤è¿‡ç¨‹ï¼ŒChaterm è€—æ—¶ 10 åˆ†é’Ÿã€‚å¯¹æ¯”å°ä¸°è‡ªå·±æ‘¸ç´¢çš„ 3 å°æ—¶ï¼Œè¿™æ•ˆç‡æå‡æ˜¯é¢ è¦†æ€§çš„ã€‚</p>















































<table><thead><tr><th>æ­¥éª¤</th><th>æ“ä½œ</th><th>ç»“æœ</th><th>è€—æ—¶</th></tr></thead><tbody><tr><td>1</td><td>æ£€æŸ¥é…ç½®æ–‡ä»¶</td><td>å‘ç°ä½¿ç”¨äº†é”™è¯¯çš„å±æ€§</td><td>1 åˆ†é’Ÿ</td></tr><tr><td>2</td><td>æµ‹è¯• LDAP è¿æ¥</td><td>ç¡®è®¤ bind_dn æ ¼å¼æ­£ç¡®</td><td>1 åˆ†é’Ÿ</td></tr><tr><td>3</td><td>æŸ¥çœ‹ç”¨æˆ·å®é™…å±æ€§</td><td>å‘ç° uid æ˜¯å®Œæ•´é‚®ç®±æ ¼å¼</td><td>2 åˆ†é’Ÿ</td></tr><tr><td>4</td><td>ä¿®æ”¹æœç´¢è¿‡æ»¤å™¨</td><td>æ”¯æŒå¤šç§ç™»å½•æ ¼å¼</td><td>1 åˆ†é’Ÿ</td></tr><tr><td>5</td><td>å¯ç”¨è°ƒè¯•æ—¥å¿—</td><td>ä¾¿äºåç»­æ’æŸ¥</td><td>1 åˆ†é’Ÿ</td></tr><tr><td>6</td><td>éªŒè¯ä¿®å¤</td><td>é—®é¢˜è§£å†³ âœ…</td><td>4 åˆ†é’Ÿ</td></tr></tbody></table>
<p>æˆ‘ä»¬ä»è¿™ä¸ªæ¡ˆä¾‹ä¸­çœ‹åˆ°çš„ï¼Œä¸åªæ˜¯å·¥å…·çš„å¿«é€Ÿï¼Œæ›´æ˜¯å®ƒç³»ç»ŸåŒ–çš„æ€ç»´æ¨¡å¼ï¼š</p>
<ol>
<li><strong>é¿å…çŸ¥è¯†ç›²åŒºï¼š</strong> Â å®ƒèƒ½ç¬é—´è¯†åˆ«å‡ºä¸åŒæŠ€æœ¯æ ˆï¼ˆAD vs. LDAPï¼‰çš„é…ç½®å·®å¼‚ï¼Œè¿™æ˜¯æœ€å®¹æ˜“è®©äººå¡å£³çš„åœ°æ–¹ã€‚</li>
<li><strong>å…ˆéªŒè¯æ•°æ®ï¼Œåä¿®æ”¹é…ç½®ï¼š</strong> Â å®ƒä¸æ˜¯ç›²ç›®åœ°å°è¯•é…ç½®ï¼Œè€Œæ˜¯å…ˆç”¨ ldapsearch éªŒè¯äº† LDAP æœåŠ¡å™¨å®é™…å­˜å‚¨çš„æ•°æ®æ ¼å¼ï¼Œå†å›è¿‡å¤´æ¥ä¿®æ”¹é…ç½®ï¼Œè¿™æ˜¯æœ€é«˜æ•ˆçš„æ’æŸ¥é€»è¾‘ã€‚</li>
<li><strong>ä¸æ­¢äºä¿®å¤ï¼Œæ›´è¦ä¼˜åŒ–ï¼š</strong> Â Chaterm æœ€ç»ˆç»™å‡ºçš„ä¸‡èƒ½è¿‡æ»¤å™¨ï¼Œè€ƒè™‘åˆ°äº†ç”¨æˆ·ä½“éªŒï¼Œé¿å…äº†æœªæ¥å› ç™»å½•ä¹ æƒ¯ä¸åŒè€Œå¼•å‘çš„å†æ¬¡æ•…éšœã€‚</li>
</ol>
<h4 data-id="heading-22">Chaterm çš„ä¼˜åŠ¿ï¼šä¸ºä»€ä¹ˆèƒ½ 10 åˆ†é’Ÿè§£å†³ 3 å°æ—¶çš„é—®é¢˜ï¼Ÿ</h4>
<p>é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Chaterm ç›¸æ¯”ä¼ ç»Ÿæ’æŸ¥æ–¹å¼çš„ä¼˜åŠ¿ï¼š</p>
<h5 data-id="heading-23">1. ç³»ç»ŸåŒ–æ’æŸ¥</h5>
<p><strong>ä¼ ç»Ÿæ–¹å¼ï¼š</strong> Â ä½ å¯èƒ½å¿˜è®°æŸä¸ªæ­¥éª¤ï¼Œæˆ–è€…é¡ºåºä¸å¯¹</p>
<p><strong>Chatermï¼š</strong></p>
<ul>
<li>ä¸ä¼šé—æ¼å…³é”®æ­¥éª¤</li>
<li>æŒ‰ç…§é€»è¾‘é¡ºåºé€æ­¥æ’æŸ¥</li>
<li>æ ¹æ®ç»“æœè‡ªåŠ¨è°ƒæ•´æ–¹å‘</li>
</ul>
<p><strong>å°±åƒæœ‰ç»éªŒçš„è¿ç»´ä¸“å®¶ï¼ŒçŸ¥é“æ¯ä¸€æ­¥è¯¥åšä»€ä¹ˆï¼</strong></p>
<h5 data-id="heading-24">2. çŸ¥è¯†ä¸°å¯Œ</h5>
<p><strong>ä¼ ç»Ÿæ–¹å¼ï¼š</strong> Â ä½ éœ€è¦æŸ¥æ–‡æ¡£ã€æœç™¾åº¦ï¼Œå¯èƒ½è¿˜æ‰¾ä¸åˆ°ç­”æ¡ˆ</p>
<p><strong>Chatermï¼š</strong></p>
<ul>
<li>çŸ¥é“éœ€è¦å®‰è£…ä»€ä¹ˆå·¥å…·ï¼ˆè‡ªåŠ¨å¸®ä½ è£…ï¼‰</li>
<li>äº†è§£ LDAP çš„å„ç§é…ç½®æ ¼å¼ï¼ˆä¸€çœ¼çœ‹å‡ºé—®é¢˜ï¼‰</li>
<li>ç†è§£ä¸åŒ LDAP ç±»å‹çš„å·®å¼‚ï¼ˆçŸ¥é“ Windows AD å’Œæ ‡å‡† LDAP çš„åŒºåˆ«ï¼‰</li>
</ul>
<p><strong>å°±åƒæœ‰ä¸ªçŸ¥è¯†åº“åœ¨è„‘å­é‡Œï¼Œéšæ—¶è°ƒç”¨ï¼</strong></p>
<h5 data-id="heading-25">3. æ‰§è¡Œé«˜æ•ˆ</h5>
<p><strong>ä¼ ç»Ÿæ–¹å¼ï¼š</strong> Â ä½ éœ€è¦æ‰‹åŠ¨è¾“å…¥æ¯ä¸ªå‘½ä»¤ï¼Œå¤åˆ¶ç²˜è´´ï¼Œå®¹æ˜“å‡ºé”™</p>
<p><strong>Chatermï¼š</strong></p>
<ul>
<li>è‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥</li>
<li>å®æ—¶æŸ¥çœ‹ç»“æœï¼Œå¿«é€Ÿå®šä½é—®é¢˜</li>
<li>æä¾›ä¿®å¤æ–¹æ¡ˆï¼Œç›´æ¥å¯ç”¨</li>
</ul>
<p><strong>ä½ åªéœ€çœ‹ç»“æœï¼Œä¸ç”¨åŠ¨æ‰‹ï¼</strong></p>
<h5 data-id="heading-26">4. å®‰å…¨å¯é </h5>
<p><strong>ä¼ ç»Ÿæ–¹å¼ï¼š</strong> Â ä½ å¯èƒ½å¿˜è®°å¤‡ä»½ï¼Œæ”¹é”™äº†å°±éº»çƒ¦äº†</p>
<p><strong>Chatermï¼š</strong></p>
<ul>
<li>ä¿®æ”¹å‰è‡ªåŠ¨å¤‡ä»½ï¼ˆå¸®ä½ è®°å¾—ï¼‰</li>
<li>éªŒè¯ä¿®æ”¹ç»“æœï¼ˆç¡®ä¿æ”¹å¯¹äº†ï¼‰</li>
<li>æä¾›å›æ»šæ–¹æ¡ˆï¼ˆä¸‡ä¸€æœ‰é—®é¢˜è¿˜èƒ½æ¢å¤ï¼‰</li>
</ul>
<p><strong>å®‰å…¨ç¬¬ä¸€ï¼ŒAI å¸®ä½ è€ƒè™‘åˆ°äº†ï¼</strong></p>
<h4 data-id="heading-27">è¿ç»´äººå‘˜èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿï¼ˆå®ç”¨å¹²è´§ï¼‰</h4>
<h5 data-id="heading-28">1. LDAP æ’æŸ¥çš„æ ‡å‡†æµç¨‹</h5>
<pre><code class="hljs">æ£€æŸ¥é…ç½® â†’ æµ‹è¯•è¿æ¥ â†’ æŸ¥çœ‹ç”¨æˆ·å±æ€§ â†’ ä¿®æ”¹é…ç½® â†’ éªŒè¯ä¿®å¤
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong> Â å…ˆç¡®è®¤é…ç½®ï¼Œå†æµ‹è¯•è¿æ¥ï¼Œæœ€åçœ‹å®é™…æ•°æ®ï¼Œè¿™æ ·ä¸ä¼šèµ°å¼¯è·¯ï¼</p>
<h5 data-id="heading-29">2. å…³é”®æ’æŸ¥å‘½ä»¤</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># æµ‹è¯•LDAPè¿æ¥ï¼ˆæœ€é‡è¦ï¼ï¼‰</span>
ldapsearch -x -H ldap:<span class="hljs-comment">//æœåŠ¡å™¨:ç«¯å£ \</span>
-D <span class="hljs-string">"bind_dn"</span> -w <span class="hljs-string">"å¯†ç "</span> \
-b <span class="hljs-string">"æœç´¢åŸºç¡€DN"</span> <span class="hljs-string">"(æœç´¢è¿‡æ»¤å™¨)"</span>

<span class="hljs-meta"># æŸ¥çœ‹ç”¨æˆ·å®Œæ•´å±æ€§ï¼ˆçœ‹çœ‹åˆ°åº•å­˜äº†ä»€ä¹ˆï¼‰</span>
ldapsearch ... <span class="hljs-string">"(cn=ç”¨æˆ·å)"</span>

<span class="hljs-meta"># å¯ç”¨Grafana LDAPè°ƒè¯•æ—¥å¿—ï¼ˆå‡ºé—®é¢˜æ—¶å¾ˆæœ‰ç”¨ï¼‰</span>

<span class="hljs-meta"># åœ¨grafana.iniä¸­æ·»åŠ ï¼š</span>
[<span class="hljs-meta">log</span>]
filters = ldap:debug
</code></pre>
<p><strong>æç¤ºï¼š</strong> Â è¿™äº›å‘½ä»¤ AI ä¼šè‡ªåŠ¨å¸®ä½ æ‰§è¡Œï¼Œä½†äº†è§£åŸç†æœ‰åŠ©äºä½ ç†è§£é—®é¢˜ï¼</p>
<h5 data-id="heading-30">3.Â  å¸¸è§ LDAP é…ç½®é”™è¯¯ï¼ˆé¿å‘æŒ‡å—ï¼‰</h5>





























<table><thead><tr><th>é”™è¯¯ç±»å‹</th><th>ç¤ºä¾‹</th><th>æ­£ç¡®åšæ³•</th><th>ä¸ºä»€ä¹ˆé”™ï¼Ÿ</th></tr></thead><tbody><tr><td>å±æ€§ä¸å­˜åœ¨</td><td><code>sAMAccountName</code>Â (æ ‡å‡† LDAP)</td><td>ä½¿ç”¨Â <code>uid</code>Â æˆ–Â <code>cn</code></td><td>Windows AD ä¸“ç”¨ï¼Œæ ‡å‡† LDAP æ²¡æœ‰</td></tr><tr><td>æ ¼å¼ä¸åŒ¹é…</td><td>ç”¨æˆ·è¾“å…¥Â <code>user</code>ï¼ŒLDAP å­˜å‚¨Â <code>user@domain.com</code></td><td>ä½¿ç”¨å¤šæ¡ä»¶æœç´¢è¿‡æ»¤å™¨</td><td>è¾“å…¥æ ¼å¼å’Œå­˜å‚¨æ ¼å¼ä¸ä¸€è‡´</td></tr><tr><td>å±æ€§æ˜ å°„é”™è¯¯</td><td><code>username = "sn"</code>Â (å§“æ°)</td><td>ä½¿ç”¨Â <code>username = "uid"</code></td><td>å§“æ°ä¸æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œå¯èƒ½é‡å¤</td></tr></tbody></table>
<p>è®°ä½è¿™äº›ï¼Œä»¥åé…ç½® LDAP æ—¶å°±èƒ½é¿å…è¸©å‘ï¼</p>
<h4 data-id="heading-31">å¿«é€Ÿä¸Šæ‰‹ Chaterm</h4>
<h5 data-id="heading-32">ä½¿ç”¨åœºæ™¯ï¼ˆè¿™äº›åœºæ™¯éƒ½èƒ½ç”¨ï¼‰</h5>
<ol>
<li><strong>æ•…éšœæ’æŸ¥</strong>Â - ç²˜è´´é”™è¯¯æ—¥å¿—ï¼Œè‡ªåŠ¨åˆ†æï¼ˆå°±åƒè¿™ä¸ªæ¡ˆä¾‹ï¼‰</li>
<li><strong>é…ç½®æ£€æŸ¥</strong>Â - æè¿°é—®é¢˜ï¼Œè‡ªåŠ¨æ£€æŸ¥é…ç½®ï¼ˆä¸ç”¨æ‰‹åŠ¨çœ‹é…ç½®æ–‡ä»¶ï¼‰</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>Â - æä¾›ç³»ç»Ÿä¿¡æ¯ï¼Œè·å¾—ä¼˜åŒ–å»ºè®®ï¼ˆå¸®ä½ æ‰¾æ€§èƒ½ç“¶é¢ˆï¼‰</li>
<li><strong>çŸ¥è¯†æŸ¥è¯¢</strong>Â - è¯¢é—®æŠ€æœ¯é—®é¢˜ï¼Œè·å¾—ä¸“ä¸šè§£ç­”ï¼ˆ24 å°æ—¶åœ¨çº¿ä¸“å®¶ï¼‰</li>
</ol>
<h5 data-id="heading-33">ä½¿ç”¨æŠ€å·§ï¼ˆè®© AI æ›´æ‡‚ä½ ï¼‰</h5>
<ol>
<li><strong>æä¾›å®Œæ•´ä¿¡æ¯</strong>Â - é”™è¯¯æ—¥å¿—ã€é…ç½®æ–‡ä»¶è·¯å¾„ã€é—®é¢˜æè¿°ï¼ˆä¿¡æ¯è¶Šå¤šï¼ŒAI è¶Šå‡†ç¡®ï¼‰</li>
<li><strong>æè¿°å·²å°è¯•çš„æ“ä½œ</strong>Â - é¿å…é‡å¤æ’æŸ¥ï¼ˆå‘Šè¯‰ AI ä½ è¯•è¿‡ä»€ä¹ˆï¼Œå®ƒå°±ä¸ä¼šå†è¯•ï¼‰</li>
<li><strong>åŠæ—¶åé¦ˆç»“æœ</strong>Â - å‘Šè¯‰ Chaterm å“ªäº›æ–¹æ¡ˆæœ‰æ•ˆ/æ— æ•ˆï¼ˆå¸®åŠ© AI è°ƒæ•´æ–¹å‘ï¼‰</li>
<li><strong>æŸ¥çœ‹æ‰§è¡Œè¿‡ç¨‹</strong>Â - å­¦ä¹ æ’æŸ¥æ€è·¯å’Œå‘½ä»¤ï¼ˆè¾¹ç”¨è¾¹å­¦ï¼Œæå‡è‡ªå·±ï¼‰</li>
</ol>
<p><strong>ç®€å•è¯´ï¼š</strong> Â å°±åƒå’Œè¿ç»´ä¸“å®¶èŠå¤©ï¼Œä½ æè¿°é—®é¢˜ï¼Œå®ƒå¸®ä½ è§£å†³ï¼</p>
<h4 data-id="heading-34">æ€»ç»“ï¼šAI å·¥å…·æ”¹å˜äº†ä»€ä¹ˆï¼Ÿ</h4>
<p>é€šè¿‡è¿™ä¸ªçœŸå®æ¡ˆä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š</p>
<p><strong>Chaterm èƒ½å¤Ÿåƒç»éªŒä¸°å¯Œçš„è¿ç»´ä¸“å®¶ä¸€æ ·å·¥ä½œï¼š</strong></p>
<ul>
<li><strong>ç³»ç»ŸåŒ–æ’æŸ¥</strong>Â - ä¸ä¼šé—æ¼å…³é”®æ­¥éª¤</li>
<li><strong>æ™ºèƒ½åˆ†æ</strong>Â - ä¸€çœ¼çœ‹å‡ºé—®é¢˜æ‰€åœ¨</li>
<li><strong>ç²¾å‡†ä¿®å¤</strong>Â - ä¸ä»…æ‰¾é—®é¢˜ï¼Œè¿˜å¸®ä½ æ”¹é…ç½®</li>
</ul>
<p><strong>å¤§å¤§æå‡æ’æŸ¥æ•ˆç‡ï¼š</strong></p>

























<table><thead><tr><th>ä¼ ç»Ÿæ–¹å¼</th><th>Chaterm</th></tr></thead><tbody><tr><td>3 å°æ—¶+</td><td>10 åˆ†é’Ÿ</td></tr><tr><td>æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤</td><td>è‡ªåŠ¨æ‰§è¡Œ</td></tr><tr><td>è¯•é”™æˆæœ¬é«˜</td><td>ç²¾å‡†å®šä½</td></tr><tr><td>å¯èƒ½é—æ¼æ­¥éª¤</td><td>ç³»ç»ŸåŒ–æ’æŸ¥</td></tr></tbody></table>
<p><strong>æ—¶é—´å°±æ˜¯é‡‘é’±ï¼Œæ•ˆç‡å°±æ˜¯ç”Ÿå‘½ï¼</strong></p>
<p><strong>é€‚åˆå„ç§æ°´å¹³çš„è¿ç»´äººå‘˜ï¼š</strong></p>
<ul>
<li><strong>æ–°æ‰‹ï¼š</strong> Â å­¦ä¹ æ ‡å‡†æ’æŸ¥æµç¨‹ï¼ˆè·Ÿç€ AI å­¦ï¼Œå¿«é€Ÿæˆé•¿ï¼‰</li>
<li><strong>è€æ‰‹ï¼š</strong> Â å¿«é€Ÿå®šä½é—®é¢˜ï¼ŒèŠ‚çœæ—¶é—´ï¼ˆæŠŠæ—¶é—´ç”¨åœ¨æ›´é‡è¦çš„äº‹æƒ…ä¸Šï¼‰</li>
</ul>
<h4 data-id="heading-35">æ ¸å¿ƒä»·å€¼</h4>
<p><strong>ä¸æ˜¯æ›¿ä»£ä½ ï¼Œè€Œæ˜¯è®©ä½ æ›´å¼ºå¤§ï¼</strong></p>
<ul>
<li>AI å¸®ä½ åšé‡å¤æ€§å·¥ä½œï¼ˆæ‰§è¡Œå‘½ä»¤ã€æ£€æŸ¥é…ç½®ï¼‰</li>
<li>ä½ ä¸“æ³¨äºæ€è€ƒå’Œå†³ç­–ï¼ˆç†è§£é—®é¢˜ã€éªŒè¯æ–¹æ¡ˆï¼‰</li>
<li>è¾¹ç”¨è¾¹å­¦ï¼Œæå‡æŠ€èƒ½ï¼ˆçœ‹ AI æ€ä¹ˆæ’æŸ¥ï¼Œå­¦ä¹ æ€è·¯ï¼‰</li>
</ul>
<hr/>
<p>å¦‚æœä½ ä¹Ÿé‡åˆ°è¿‡ç±»ä¼¼çš„ LDAP é…ç½®é—®é¢˜ï¼Œæˆ–è€…æƒ³ä½“éªŒ Chaterm çš„å¼ºå¤§åŠŸèƒ½ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»å†ï¼</p>
<p>æˆ–è€…ï¼Œç›´æ¥å»è¯•è¯• Chatermï¼Œçœ‹çœ‹å®ƒèƒ½ä¸èƒ½å¸®ä½ è§£å†³ä¸‹ä¸€ä¸ªé—®é¢˜ï¼ ğŸš€</p>
<h4 data-id="heading-36">ç›¸å…³èµ„æº</h4>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgrafana.com%2Fdocs%2Fgrafana%2Flatest%2Fsetup-grafana%2Fconfigure-security%2Fconfigure-authentication%2Fldap%2F" target="_blank" title="https://grafana.com/docs/grafana/latest/setup-grafana/configure-security/configure-authentication/ldap/" ref="nofollow noopener noreferrer">Grafana LDAP é…ç½®å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fldap.com%2Fldap-filters%2F" target="_blank" title="https://ldap.com/ldap-filters/" ref="nofollow noopener noreferrer">LDAP æœç´¢è¿‡æ»¤å™¨è¯­æ³•</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchaterm.ai%2Fcn%2Fdocs%2F" target="_blank" title="https://chaterm.ai/cn/docs/" ref="nofollow noopener noreferrer">Chaterm ä½¿ç”¨æŒ‡å—</a></li>
</ul>
<h4 data-id="heading-37">å†™åœ¨æœ€å</h4>
<p><strong>æ¸©é¦¨æç¤ºï¼š</strong> Â ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®å‰ï¼Œè¯·åŠ¡å¿…å…ˆå¤‡ä»½ï¼é€šå¸¸ Chaterm ä¼šè‡ªåŠ¨å¸®ä½ å¤‡ä»½ï¼Œä½†å…»æˆå¥½ä¹ æƒ¯æ€»æ˜¯æ²¡é”™çš„ ğŸ˜Š</p>
<p><strong>æ ¸å¿ƒè§‚ç‚¹ï¼š</strong> Â AI å·¥å…·ä¸æ˜¯è¦æ›¿ä»£è¿ç»´äººå‘˜ï¼Œè€Œæ˜¯è¦è®©æˆ‘ä»¬æ›´é«˜æ•ˆã€æ›´ä¸“ä¸šã€‚æŠŠé‡å¤æ€§å·¥ä½œäº¤ç»™ AIï¼ŒæŠŠæ—¶é—´ç”¨åœ¨æ›´æœ‰ä»·å€¼çš„äº‹æƒ…ä¸Šã€‚</p>
<hr/>
<p>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç”¨ï¼Œæ¬¢è¿ç‚¹èµã€è½¬å‘ã€æ”¶è—ï¼</p>
<p>å¦‚æœä½ ä¹Ÿæœ‰ç±»ä¼¼çš„æ’æŸ¥ç»å†ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ï¼</p>
<p>å¦‚æœä½ è¯•ç”¨äº† Chatermï¼Œæ¬¢è¿åˆ†äº«ä½ çš„ä½¿ç”¨ä½“éªŒï¼</p>
<p>å®˜æ–¹åšå®¢ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fchaterm.ai%2Fblog%2Fposts%2Fpe1" target="_blank" title="https://chaterm.ai/blog/posts/pe1" ref="nofollow noopener noreferrer">chaterm.ai/blog/posts/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[0ä»£ç å†™SQLï¼Spring AIä¿å§†çº§æ•™ç¨‹ï¼š5åˆ†é’Ÿå®ç°AIè‡ªç„¶è¯­è¨€æŸ¥æ•°æ®ï¼Œæ•æ„ŸæŸ¥è¯¢è‡ªåŠ¨æ‹¦æˆªğŸš€]]></title>    <link>https://juejin.cn/post/7582809606066651162</link>    <guid>https://juejin.cn/post/7582809606066651162</guid>    <pubDate>2025-12-12T10:16:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582809606066651162" data-draft-id="7582791876366417958" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 0ä»£ç å†™SQLï¼Spring AIä¿å§†çº§æ•™ç¨‹ï¼š5åˆ†é’Ÿå®ç°AIè‡ªç„¶è¯­è¨€æŸ¥æ•°æ®ï¼Œæ•æ„ŸæŸ¥è¯¢è‡ªåŠ¨æ‹¦æˆªğŸš€"/> <meta itemprop="keywords" content="Spring,AIç¼–ç¨‹,SQL"/> <meta itemprop="datePublished" content="2025-12-12T10:16:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/808832912075352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             0ä»£ç å†™SQLï¼Spring AIä¿å§†çº§æ•™ç¨‹ï¼š5åˆ†é’Ÿå®ç°AIè‡ªç„¶è¯­è¨€æŸ¥æ•°æ®ï¼Œæ•æ„ŸæŸ¥è¯¢è‡ªåŠ¨æ‹¦æˆªğŸš€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/808832912075352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:16:40.000Z" title="Fri Dec 12 2025 10:16:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">0ä»£ç å†™SQLï¼Spring AIä¿å§†çº§æ•™ç¨‹ï¼š5åˆ†é’Ÿå®ç°AIè‡ªç„¶è¯­è¨€æŸ¥æ•°æ®ï¼Œæ•æ„ŸæŸ¥è¯¢è‡ªåŠ¨æ‹¦æˆªğŸš€</h2>
<p>è¿˜åœ¨ä¸ºâ€œéæŠ€æœ¯ç”¨æˆ·æŸ¥æ•°æ®è¦å†™SQLâ€å¤´ç–¼ï¼Ÿè¿˜åœ¨æ‹…å¿ƒText-to-SQLæ³¨å…¥ã€è¶ŠæƒæŸ¥è¯¢é£é™©ï¼Ÿ</p>
<p>ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥ <strong>Spring AIç›´æ¥Text-to-SQLå®æˆ˜æ–¹æ¡ˆ</strong>â€”â€”æ— éœ€æ‡‚SQLï¼Œç”¨æˆ·è‡ªç„¶è¯­è¨€éšä¾¿é—®ï¼ˆå¦‚ä¸‹å•æ•°ã€æœ€è´µè®¢å•ã€é«˜é¢‘å•†å“ï¼‰ï¼ŒAIè‡ªåŠ¨ç”ŸæˆSQLæŸ¥æ•°æ®åº“ï¼Œè¿è§„æŸ¥è¯¢ï¼ˆè¶Šæƒã€æ•æ„Ÿå­—æ®µã€å†™æ“ä½œï¼‰è‡ªåŠ¨æ‹¦æˆªï¼Œå…¨ç¨‹ä¿å§†çº§æ­¥éª¤ï¼Œå¤åˆ¶ç²˜è´´å°±èƒ½è½åœ°ï¼</p>
<h3 data-id="heading-1">ğŸ”¥ ä¸ºä»€ä¹ˆé€‰è¿™ä¸ªæ–¹æ¡ˆï¼Ÿ3å¤§æ ¸å¿ƒä¼˜åŠ¿</h3>
<ol>
<li><strong>çµæ´»åˆ°â€œéšä¾¿é—®â€</strong> ï¼šç”¨æˆ·ç”¨è‡ªç„¶è¯­è¨€æé—®ï¼ˆå¦‚â€œè¿‘30å¤©å·²æ”¯ä»˜çš„è®¢å•æœ‰å¤šå°‘ç¬”ï¼Ÿâ€â€œæˆ‘å¸¸ä¹°çš„å•†å“TOP3â€ï¼‰ï¼ŒAIè‡ªåŠ¨è½¬SQLï¼Œæ— éœ€é¢„å®šä¹‰æŸ¥è¯¢é€»è¾‘ï¼›</li>
<li><strong>å®‰å…¨åˆ°â€œæ— æ­»è§’â€</strong> ï¼šäº‹å‰æç¤ºè¯é™åˆ¶+äº‹åSQLæ ¡éªŒï¼ŒåŒé‡é˜²æŠ¤æ‹¦æˆªå†™æ“ä½œã€æ³¨å…¥æ”»å‡»ã€è¶ŠæƒæŸ¥è¯¢ã€æ•æ„Ÿå­—æ®µæŸ¥è¯¢ï¼›</li>
<li><strong>ç®€å•åˆ°â€œé›¶é—¨æ§›â€</strong> ï¼šSpringç”Ÿæ€æ— ç¼é›†æˆï¼Œ5åˆ†é’Ÿå®Œæˆé…ç½®+ç¼–ç ï¼Œæ–°æ‰‹ä¹Ÿèƒ½å¿«é€Ÿè½åœ°ï¼Œæ— éœ€æ·±å…¥AIçŸ¥è¯†ã€‚</li>
</ol>
<h3 data-id="heading-2">ğŸ› ï¸ ä¿å§†çº§è½åœ°æ­¥éª¤ï¼šä»0åˆ°1å®ç°AIæ•°æ®æŸ¥è¯¢</h3>
<h4 data-id="heading-3">ä¸€ã€ç¯å¢ƒå‡†å¤‡ï¼ˆå¤åˆ¶ç²˜è´´å³å¯ï¼‰</h4>
<h5 data-id="heading-4">1. å¼•å…¥æ ¸å¿ƒä¾èµ–ï¼ˆpom.xmlï¼‰</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Spring AI æ ¸å¿ƒï¼ˆLLMäº¤äº’+SQLç”Ÿæˆï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- Claude LLMï¼ˆå¯æ›¿æ¢ä¸ºé€šä¹‰åƒé—®/DeepSeekï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-model-anthropic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- SQLæ ¡éªŒå·¥å…· --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-sql-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- Spring Securityï¼ˆç”¨æˆ·è®¤è¯+æ•°æ®éš”ç¦»ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- æ•°æ®åº“+ORM --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h5 data-id="heading-5">2. æ•°æ®åº“è¡¨ç»“æ„ï¼ˆMySQLï¼‰</h5>
<p>æ ¸å¿ƒæ˜¯<code>user_id</code>å…³è”ç”¨æˆ·ä¸è®¢å•ï¼Œç¡®ä¿æ•°æ®éš”ç¦»ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç”¨æˆ·è¡¨ï¼ˆå«æ•æ„Ÿå­—æ®µï¼Œç¦æ­¢æŸ¥è¯¢ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sys_user (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span>,
    password <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- åŠ å¯†å­˜å‚¨</span>
    phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-comment">-- æ•æ„Ÿå­—æ®µ</span>
);

<span class="hljs-comment">-- è®¢å•ä¸»è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> order_main (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    total_amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    create_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    status TINYINT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'0-å¾…æ”¯ä»˜ï¼Œ1-å·²æ”¯ä»˜ï¼Œ2-å·²å–æ¶ˆ'</span>,
    <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> sys_user(id),
    INDEX idx_user_create (user_id, create_time)
);

<span class="hljs-comment">-- è®¢å•é¡¹è¡¨ï¼ˆå•†å“æ˜ç»†ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> order_item (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    order_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    product_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    product_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    quantity <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    unit_price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-keyword">FOREIGN</span> KEY (order_id) <span class="hljs-keyword">REFERENCES</span> order_main(id)
);
</code></pre>
<h4 data-id="heading-6">äºŒã€æ ¸å¿ƒé…ç½®ï¼š1åˆ†é’Ÿæå®šLLM+å®‰å…¨è§„åˆ™</h4>
<p>åœ¨<code>application.yaml</code>ä¸­é…ç½®LLMã€æ•°æ®åº“å’Œå®‰å…¨æç¤ºè¯ï¼ˆå…³é”®ï¼ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">spring:
  datasource:
    url: jdbc:mysql://localhost:<span class="hljs-number">3306</span>/order_db?useSSL=false&amp;serverTimezone=UTC
    username: readonly_user # æ•°æ®åº“åªè¯»ç”¨æˆ·ï¼ˆä»…æˆSELECTæƒé™ï¼‰
    password: ä½ çš„å¯†ç 
  ai:
    anthropic:
      api-key: ${ANTHROPIC_API_KEY} # ç¯å¢ƒå˜é‡åŠ è½½ï¼Œé¿å…ç¡¬ç¼–ç 
      chat:
        options:
          model: claude-opus-<span class="hljs-number">4</span>-<span class="hljs-number">20250514</span>
          # ğŸ”¥ æ ¸å¿ƒæç¤ºè¯ï¼šé™åˆ¶LLMç”Ÿæˆåˆè§„SQL
          system-prompt: |
            ä½ æ˜¯è®¢å•æŸ¥è¯¢SQLç”ŸæˆåŠ©æ‰‹ï¼Œä»…ç”Ÿæˆç¬¦åˆä»¥ä¸‹è§„åˆ™çš„SQLï¼š
            <span class="hljs-number">1</span>. å…è®¸è¡¨ï¼šorder_mainã€order_itemï¼ˆç¦æ­¢æŸ¥sys_useråŠå…¶ä»–è¡¨ï¼‰ï¼›
            <span class="hljs-number">2</span>. å¿…åŠ æ¡ä»¶ï¼šAND order_main.user_id = {CURRENT_USER_ID}ï¼ˆä¸å¯çœç•¥ï¼‰ï¼›
            <span class="hljs-number">3</span>. ä»…æ”¯æŒSELECTï¼Œç¦æ­¢INSERT/UPDATE/DELETEç­‰å†™æ“ä½œï¼›
            <span class="hljs-number">4</span>. ç¦æ­¢æŸ¥æ•æ„Ÿå­—æ®µï¼šphoneã€passwordç­‰ï¼›
            <span class="hljs-number">5</span>. ä»…è¿”å›çº¯SQLï¼Œæ— markdownåŒ…è£¹ï¼›
            <span class="hljs-number">6</span>. è¿è§„é—®é¢˜ç›´æ¥è¿”å›ï¼š"è¯¥æŸ¥è¯¢ä¸ç¬¦åˆè§„åˆ™ï¼ŒåŸå› ï¼š{å…·ä½“è¿è§„ç±»å‹}"ã€‚
            # è¡¨ç»“æ„å‚è€ƒ
            order_mainï¼š<span class="hljs-built_in">id</span>(è®¢å•å·)ã€<span class="hljs-built_in">user_id</span>(ç”¨æˆ·ID)ã€<span class="hljs-built_in">total_amount</span>(é‡‘é¢)ã€<span class="hljs-built_in">create_time</span>(æ—¶é—´)ã€<span class="hljs-built_in">status</span>(çŠ¶æ€)
            order_itemï¼š<span class="hljs-built_in">order_id</span>(è®¢å•å·)ã€<span class="hljs-built_in">product_name</span>(å•†å“å)ã€<span class="hljs-built_in">quantity</span>(æ•°é‡)
</code></pre>
<h4 data-id="heading-7">ä¸‰ã€ç¼–ç å®ç°ï¼š3ä¸ªæ ¸å¿ƒç»„ä»¶ï¼ˆå¤åˆ¶å³ç”¨ï¼‰</h4>
<h5 data-id="heading-8">1. ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼šæå–å½“å‰ç™»å½•ç”¨æˆ·IDï¼ˆæ•°æ®éš”ç¦»ï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {
    <span class="hljs-comment">// ä»Spring Securityè·å–å½“å‰ç”¨æˆ·ID</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getCurrentUserId</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Authentication</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> SecurityContextHolder.getContext().getAuthentication();
        <span class="hljs-keyword">if</span> (auth == <span class="hljs-literal">null</span> || !(auth.getPrincipal() <span class="hljs-keyword">instanceof</span> SysUser user)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•æŸ¥è¯¢"</span>);
        }
        <span class="hljs-keyword">return</span> user.getId();
    }
}
</code></pre>
<h5 data-id="heading-9">2. SQLæ ¡éªŒå™¨ï¼šæ‹¦æˆªè¿è§„SQLï¼ˆäº‹åå…œåº•ï¼‰</h5>
<pre><code class="hljs language-arduino" lang="arduino">@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlValidator</span> {
    <span class="hljs-comment">// ç¦æ­¢çš„æ“ä½œã€æ•æ„Ÿå­—æ®µã€å…è®¸çš„è¡¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> List&lt;<span class="hljs-type">String</span>&gt; FORBIDDEN_OPS = List.<span class="hljs-built_in">of</span>(<span class="hljs-string">"INSERT"</span>, <span class="hljs-string">"UPDATE"</span>, <span class="hljs-string">"DELETE"</span>, <span class="hljs-string">"DROP"</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> List&lt;<span class="hljs-type">String</span>&gt; SENSITIVE_FIELDS = List.<span class="hljs-built_in">of</span>(<span class="hljs-string">"phone"</span>, <span class="hljs-string">"password"</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> List&lt;<span class="hljs-type">String</span>&gt; ALLOWED_TABLES = List.<span class="hljs-built_in">of</span>(<span class="hljs-string">"order_main"</span>, <span class="hljs-string">"order_item"</span>);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">validate</span><span class="hljs-params">(<span class="hljs-type">String</span> sql, Long userId)</span> </span>{
        <span class="hljs-type">String</span> lowerSql = sql.<span class="hljs-built_in">toLowerCase</span>();
        <span class="hljs-comment">// 1. ç¦æ­¢å†™æ“ä½œ</span>
        <span class="hljs-keyword">if</span> (FORBIDDEN_OPS.<span class="hljs-built_in">stream</span>().<span class="hljs-built_in">anyMatch</span>(op -&gt; lowerSql.<span class="hljs-built_in">startsWith</span>(op.<span class="hljs-built_in">toLowerCase</span>()))) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">IllegalSqlException</span>(<span class="hljs-string">"ç¦æ­¢éæŸ¥è¯¢æ“ä½œ"</span>);
        }
        <span class="hljs-comment">// 2. å¿…é¡»åŒ…å«user_idï¼ˆé˜²è¶Šæƒï¼‰</span>
        <span class="hljs-keyword">if</span> (!lowerSql.<span class="hljs-built_in">contains</span>(<span class="hljs-string">"order_main.user_id ="</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">IllegalSqlException</span>(<span class="hljs-string">"ä»…å…è®¸æŸ¥è¯¢è‡ªå·±çš„è®¢å•"</span>);
        }
        <span class="hljs-comment">// 3. ç¦æ­¢æ•æ„Ÿå­—æ®µ</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> field : SENSITIVE_FIELDS) {
            <span class="hljs-keyword">if</span> (lowerSql.<span class="hljs-built_in">contains</span>(field)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">IllegalSqlException</span>(<span class="hljs-string">"ç¦æ­¢æŸ¥è¯¢æ•æ„Ÿå­—æ®µï¼š"</span> + field);
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// è‡ªå®šä¹‰å¼‚å¸¸</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IllegalSqlException</span> extends RuntimeException {
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">IllegalSqlException</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span> </span>{ <span class="hljs-built_in">super</span>(msg); }
    }
}
</code></pre>
<h5 data-id="heading-10">3. æ ¸å¿ƒæœåŠ¡ï¼šæ•´åˆAIç”Ÿæˆ+æ ¡éªŒ+æ‰§è¡Œ</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTextToSqlService</span> {
    <span class="hljs-meta">@Autowired</span> <span class="hljs-keyword">private</span> <span class="hljs-title class_">ChatClient</span> chatClient;
    <span class="hljs-meta">@Autowired</span> <span class="hljs-keyword">private</span> <span class="hljs-title class_">JdbcTemplate</span> jdbcTemplate;
    <span class="hljs-meta">@Autowired</span> <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserContext</span> userContext;
    <span class="hljs-meta">@Autowired</span> <span class="hljs-keyword">private</span> <span class="hljs-title class_">SqlValidator</span> sqlValidator;

    <span class="hljs-comment">// è‡ªç„¶è¯­è¨€â†’SQLâ†’æŸ¥è¯¢â†’ç»“æœ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">query</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> question</span>) {
        <span class="hljs-title class_">Long</span> userId = userContext.<span class="hljs-title function_">getCurrentUserId</span>();
        <span class="hljs-comment">// 1. LLMç”ŸæˆSQLï¼ˆæ›¿æ¢{CURRENT_USER_ID}ä¸ºçœŸå®IDï¼‰</span>
        <span class="hljs-title class_">String</span> systemPrompt = chatClient.<span class="hljs-title function_">options</span>().<span class="hljs-title function_">getSystemPrompt</span>()
                .<span class="hljs-title function_">replace</span>(<span class="hljs-string">"{CURRENT_USER_ID}"</span>, userId.<span class="hljs-title function_">toString</span>());
        <span class="hljs-title class_">String</span> generatedSql = chatClient.<span class="hljs-title function_">prompt</span>()
                .<span class="hljs-title function_">system</span>(systemPrompt)
                .<span class="hljs-title function_">user</span>(question)
                .<span class="hljs-title function_">call</span>()
                .<span class="hljs-title function_">content</span>();

        <span class="hljs-comment">// 2. æ‹¦æˆªLLMè¿”å›çš„è¿è§„æç¤º</span>
        <span class="hljs-keyword">if</span> (generatedSql.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"è¯¥æŸ¥è¯¢ä¸ç¬¦åˆè§„åˆ™"</span>)) {
            <span class="hljs-keyword">return</span> generatedSql;
        }

        <span class="hljs-comment">// 3. æ ¡éªŒSQLåˆæ³•æ€§</span>
        <span class="hljs-keyword">try</span> {
            sqlValidator.<span class="hljs-title function_">validate</span>(generatedSql, userId);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">SqlValidator</span>.<span class="hljs-property">IllegalSqlException</span> e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"æŸ¥è¯¢å¤±è´¥ï¼š"</span> + e.<span class="hljs-title function_">getMessage</span>();
        }

        <span class="hljs-comment">// 4. æ‰§è¡ŒSQLå¹¶æ ¼å¼åŒ–ç»“æœ</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; result = jdbcTemplate.<span class="hljs-title function_">queryForList</span>(generatedSql);
            <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">isEmpty</span>() ? <span class="hljs-string">"æœªæŸ¥è¯¢åˆ°æ•°æ®"</span> : <span class="hljs-title function_">formatResult</span>(question, result);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"SQLæ‰§è¡Œå¤±è´¥ï¼š"</span> + e.<span class="hljs-title function_">getMessage</span>().<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>);
        }
    }

    <span class="hljs-comment">// ç»“æœæ ¼å¼åŒ–ï¼ˆè‡ªç„¶è¯­è¨€è¾“å‡ºï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">formatResult</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> question, List&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt;&gt; result</span>) {
        <span class="hljs-keyword">if</span> (question.<span class="hljs-title function_">contains</span>(<span class="hljs-string">"å¤šå°‘"</span>) || question.<span class="hljs-title function_">contains</span>(<span class="hljs-string">"æ•°é‡"</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"ç¬¦åˆæ¡ä»¶çš„è®°å½•å…±"</span> + result.<span class="hljs-title function_">size</span>() + <span class="hljs-string">"æ¡"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (question.<span class="hljs-title function_">contains</span>(<span class="hljs-string">"æœ€è´µ"</span>) || question.<span class="hljs-title function_">contains</span>(<span class="hljs-string">"æœ€é«˜"</span>)) {
            <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; top = result.<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(<span class="hljs-string">"æœ€è´µè®¢å•ï¼š\nè®¢å•å·ï¼š%s\né‡‘é¢ï¼š%.2få…ƒ\næ—¶é—´ï¼š%s"</span>,
                    top.<span class="hljs-title function_">get</span>(<span class="hljs-string">"id"</span>), top.<span class="hljs-title function_">get</span>(<span class="hljs-string">"total_amount"</span>), top.<span class="hljs-title function_">get</span>(<span class="hljs-string">"create_time"</span>));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// é€šç”¨ç»“æœæ ¼å¼åŒ–</span>
            <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">stream</span>()
                    .<span class="hljs-title function_">map</span>(map -&gt; map.<span class="hljs-title function_">entrySet</span>().<span class="hljs-title function_">stream</span>()
                            .<span class="hljs-title function_">map</span>(e -&gt; e.<span class="hljs-title function_">getKey</span>() + <span class="hljs-string">"ï¼š"</span> + e.<span class="hljs-title function_">getValue</span>())
                            .<span class="hljs-title function_">collect</span>(<span class="hljs-title class_">Collectors</span>.<span class="hljs-title function_">joining</span>(<span class="hljs-string">" | "</span>)))
                    .<span class="hljs-title function_">collect</span>(<span class="hljs-title class_">Collectors</span>.<span class="hljs-title function_">joining</span>(<span class="hljs-string">"\n"</span>));
        }
    }
}
</code></pre>
<h5 data-id="heading-11">4. æš´éœ²APIï¼šç”¨æˆ·äº¤äº’å…¥å£</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api/ai/query"</span>)
public class OrderTextToSqlController {
    <span class="hljs-variable">@Autowired</span> private OrderTextToSqlService service;

    <span class="hljs-variable">@PostMapping</span>
    public ResponseEntity&lt;String&gt; <span class="hljs-built_in">query</span>(<span class="hljs-variable">@RequestBody</span> Map&lt;String, String&gt; request) {
        <span class="hljs-selector-tag">try</span> {
            <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">service</span><span class="hljs-selector-class">.query</span>(request.<span class="hljs-built_in">get</span>(<span class="hljs-string">"question"</span>));
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(result);
        } <span class="hljs-selector-tag">catch</span> (RuntimeException e) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.badRequest</span>()<span class="hljs-selector-class">.body</span>(e.<span class="hljs-built_in">getMessage</span>());
        }
    }
}
</code></pre>
<h4 data-id="heading-12">å››ã€æµ‹è¯•éªŒè¯ï¼šåˆæ³•/è¿è§„æŸ¥è¯¢éƒ½èƒ½æ‹¦æˆª</h4>
<h5 data-id="heading-13">1. åˆæ³•æŸ¥è¯¢ï¼ˆæ­£å¸¸è¿”å›ï¼‰</h5>
<ul>
<li>
<p>è¯·æ±‚ï¼š<code>POST /api/ai/query</code>ï¼Œè¯·æ±‚ä½“ <code>{"question":"æˆ‘è¿‘30å¤©å·²æ”¯ä»˜çš„è®¢å•æœ‰å¤šå°‘ç¬”ï¼Ÿ"}</code></p>
</li>
<li>
<p>AIç”ŸæˆSQLï¼š</p>
<ul>
<li>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> order_main 
<span class="hljs-keyword">WHERE</span> status<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;=</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">30</span> <span class="hljs-keyword">DAY</span>) 
<span class="hljs-keyword">AND</span> order_main.user_id<span class="hljs-operator">=</span><span class="hljs-number">123</span>;
</code></pre>
</li>
</ul>
</li>
<li>
<p>å“åº”ï¼š<code>"ç¬¦åˆæ¡ä»¶çš„è®°å½•å…±3æ¡"</code></p>
</li>
</ul>
<h5 data-id="heading-14">2. è¿è§„æŸ¥è¯¢ï¼ˆè‡ªåŠ¨æ‹¦æˆªï¼‰</h5>
<ul>
<li>è¶ŠæƒæŸ¥è¯¢ï¼š<code>{"question":"æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·çš„è®¢å•"}</code> â†’ å“åº”ï¼š<code>"è¯¥æŸ¥è¯¢ä¸ç¬¦åˆè§„åˆ™ï¼ŒåŸå› ï¼šè¶ŠæƒæŸ¥è¯¢"</code></li>
<li>æ•æ„Ÿå­—æ®µï¼š<code>{"question":"æˆ‘çš„æ‰‹æœºå·æ˜¯å¤šå°‘ï¼Ÿ"}</code> â†’ å“åº”ï¼š<code>"è¯¥æŸ¥è¯¢ä¸ç¬¦åˆè§„åˆ™ï¼ŒåŸå› ï¼šæ¶‰åŠæ•æ„Ÿå­—æ®µ"</code></li>
<li>SQLæ³¨å…¥ï¼š<code>{"question":"æŸ¥è¯¢æˆ‘çš„è®¢å• where 1=1"}</code> â†’ å“åº”ï¼š<code>"æŸ¥è¯¢å¤±è´¥ï¼šæŸ¥è¯¢åŒ…å«æ½œåœ¨é£é™©"</code></li>
</ul>
<h3 data-id="heading-15">ğŸš¨ é¿å‘æŒ‡å—ï¼ˆæ–°æ‰‹å¿…çœ‹ï¼‰</h3>
<ol start="4">
<li>æ•°æ®åº“ç”¨æˆ·å¿…é¡»è®¾ä¸º<strong>åªè¯»</strong>ï¼Œä»…æˆäºˆSELECTæƒé™ï¼Œé¿å…LLMçªç ´é™åˆ¶ï¼›</li>
<li>æç¤ºè¯è¦æ˜ç¡®â€œå…è®¸çš„è¡¨/å­—æ®µâ€ï¼Œå‡å°‘LLMæ­§ä¹‰ï¼ˆæ¯”å¦‚æ˜ç¡®ç¦æ­¢sys_userè¡¨ï¼‰ï¼›</li>
<li>ç»™è®¢å•è¡¨çš„<code>user_id+create_time</code>åŠ ç´¢å¼•ï¼Œé¿å…å¤æ‚æŸ¥è¯¢å¡é¡¿ï¼›</li>
<li>æ•æ„Ÿå­—æ®µè¦å•ç‹¬ç»´æŠ¤åœ¨<code>SENSITIVE_FIELDS</code>ï¼Œæ–°å¢æ•æ„Ÿå­—æ®µç›´æ¥æ·»åŠ å³å¯ã€‚</li>
</ol>
<h3 data-id="heading-16">ğŸ“Œ æ€»ç»“</h3>
<p>è¿™å¥—æ–¹æ¡ˆç”¨Spring AI+Text-to-SQLï¼Œå®Œç¾è§£å†³äº†â€œéæŠ€æœ¯ç”¨æˆ·æŸ¥æ•°æ®â€å’Œâ€œå®‰å…¨é£é™©â€ä¸¤å¤§ç—›ç‚¹ï¼š</p>
<ul>
<li>å¯¹ç”¨æˆ·ï¼šæ— éœ€æ‡‚SQLï¼Œè‡ªç„¶è¯­è¨€éšä¾¿é—®ï¼ŒæŸ¥è¯¢æ•ˆç‡ç¿»å€ï¼›</li>
<li>å¯¹å¼€å‘è€…ï¼š5åˆ†é’Ÿè½åœ°ï¼Œé›¶ä¾µå…¥é›†æˆSpringç”Ÿæ€ï¼Œå®‰å…¨é˜²æŠ¤æ— æ­»è§’ã€‚</li>
</ul>
<p>ç°åœ¨å°±åŠ¨æ‰‹è¯•è¯•å§ï¼å¦‚æœéœ€è¦å®Œæ•´æºç ã€LLMæ›¿æ¢æ•™ç¨‹ï¼ˆå¦‚é€šä¹‰åƒé—®/æœ¬åœ°Ollamaï¼‰ï¼Œè¯„è®ºåŒºå›å¤ã€AIæŸ¥è¯¢ã€‘å³å¯è·å–ï½</p>
<p>å…³æ³¨æˆ‘ï¼Œä¸‹æœŸå¸¦æ¥ã€ŠAIæŸ¥è¯¢ç»“æœå¯è§†åŒ–ã€‹ã€Šå¤šLLMé€‚é…æ–¹æ¡ˆã€‹ï¼Œè®©ä½ çš„AIæ•°æ®æŸ¥è¯¢æ›´å¼ºå¤§ï¼ğŸ”¥</p>
<p>#SpringAI #TextToSQL #Javaå¼€å‘ #AIåº”ç”¨ #ä¿å§†çº§æ•™ç¨‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ­å»ºNginxå®‰å…¨ç½‘å…³ï¼š3æ­¥å µä½90%çš„Webæ¼æ´ï¼ä¼ä¸šçº§é˜²æŠ¤å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7582777037863796786</link>    <guid>https://juejin.cn/post/7582777037863796786</guid>    <pubDate>2025-12-12T10:40:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582777037863796786" data-draft-id="7582777037863780402" data-original-type="2" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ­å»ºNginxå®‰å…¨ç½‘å…³ï¼š3æ­¥å µä½90%çš„Webæ¼æ´ï¼ä¼ä¸šçº§é˜²æŠ¤å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-12T10:40:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PFinalç¤¾åŒº_å—ä¸"/> <meta itemprop="url" content="https://juejin.cn/user/1855631357906040"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ­å»ºNginxå®‰å…¨ç½‘å…³ï¼š3æ­¥å µä½90%çš„Webæ¼æ´ï¼ä¼ä¸šçº§é˜²æŠ¤å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631357906040/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PFinalç¤¾åŒº_å—ä¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:40:37.000Z" title="Fri Dec 12 2025 10:40:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»31åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»0æ­å»ºNginxå®‰å…¨ç½‘å…³ï¼š3æ­¥å µä½90%çš„Webæ¼æ´ï¼</h2>
<blockquote>
<p><strong>è­¦å‘Š</strong>ï¼šä½ çš„ç½‘ç«™å¯èƒ½æ­£åœ¨è¢«æ”»å‡»ï¼</p>
<p>æ ¹æ®2024å¹´Webå®‰å…¨æŠ¥å‘Šï¼Œè¶…è¿‡<strong>87%çš„ä¼ä¸šç½‘ç«™</strong>å­˜åœ¨Nginxé…ç½®å®‰å…¨éšæ‚£ï¼Œå…¶ä¸­<strong>Hostå¤´æ”»å‡»</strong>å’Œ<strong>æ•æ„Ÿæ–‡ä»¶æ³„éœ²</strong>å æ¯”é«˜è¾¾<strong>63%</strong>ã€‚</p>
<p>æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹æ•™ä½ æ„å»ºä¼ä¸šçº§Nginxå®‰å…¨ç½‘å…³ï¼Œ<strong>é›¶æˆæœ¬</strong>å®ç°<strong>ç­‰ä¿2.0åˆè§„</strong>é˜²æŠ¤ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ğŸš¨ ç°çŠ¶ï¼šä½ çš„ç½‘ç«™é¢ä¸´è¿™äº›å¨èƒå—ï¼Ÿ</h3>
<h4 data-id="heading-2">çœŸå®æ¡ˆä¾‹å›é¡¾</h4>
<p><strong>æ¡ˆä¾‹ä¸€ï¼šHostå¤´æ”»å‡»å¯¼è‡´ç”¨æˆ·å¯†ç æ³„éœ²</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">2024</span>å¹´<span class="hljs-number">3</span>æœˆï¼ŒæŸç”µå•†å¹³å°é­å—Hostå¤´æ”»å‡»
æ”»å‡»è€…æ„é€ æ¶æ„è¯·æ±‚ï¼š
<span class="hljs-keyword">GET</span> /password-reset HTTP/<span class="hljs-number">1.1</span>
<span class="hljs-symbol">Host:</span> attacker-controlled-domain.com

ç»“æœï¼šå¹³å°å‘é€çš„é‡ç½®é“¾æ¥æŒ‡å‘æ”»å‡»è€…åŸŸå
å½±å“ï¼šè¶…è¿‡<span class="hljs-number">1200</span>åç”¨æˆ·å¯†ç è¢«é‡ç½®ï¼Œç›´æ¥ç»æµæŸå¤±<span class="hljs-number">50</span>ä¸‡+
</code></pre>
<p><strong>æ¡ˆä¾‹äºŒï¼šæ•æ„Ÿæ–‡ä»¶æ³„éœ²å¼•å‘æ•°æ®ç¾éš¾</strong></p>
<pre><code class="hljs language-diff" lang="diff">2024å¹´1æœˆï¼ŒæŸSaaSå…¬å¸.gitç›®å½•è¢«å…¬å¼€è®¿é—®
æ”»å‡»è€…ä¸‹è½½å®Œæ•´ä»£ç ä»“åº“ï¼Œå‘ç°ï¼š
<span class="hljs-deletion">- æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼ˆåŒ…å«å¯†ç ï¼‰</span>
<span class="hljs-deletion">- APIå¯†é’¥å’ŒToken</span>
<span class="hljs-deletion">- å†…éƒ¨ç½‘ç»œæ¶æ„æ–‡æ¡£</span>
<span class="hljs-deletion">- å‘˜å·¥ä¸ªäººä¿¡æ¯è¡¨</span>

ç»“æœï¼šè¢«å‹’ç´¢æ¯”ç‰¹å¸30æšï¼Œå®¢æˆ·æ•°æ®åœ¨æš—ç½‘å‡ºå”®
</code></pre>
<h4 data-id="heading-3">å¸¸è§Webå®‰å…¨æ¼æ´æ¸…å•</h4>









































<table><thead><tr><th>æ¼æ´ç±»å‹</th><th>å±å®³ç­‰çº§</th><th>æ£€æµ‹æ–¹æ³•</th><th>å½±å“èŒƒå›´</th></tr></thead><tbody><tr><td><strong>Hostå¤´æ³¨å…¥</strong></td><td>ğŸ”´ ä¸¥é‡</td><td><code>curl -H "Host: evil.com"</code></td><td>å‡­è¯çªƒå–ã€ä¼šè¯åŠ«æŒ</td></tr><tr><td><strong>æ•æ„Ÿæ–‡ä»¶æ³„éœ²</strong></td><td>ğŸ”´ ä¸¥é‡</td><td>è®¿é—®<code>/.git/config</code></td><td>æºç æ³„éœ²ã€é…ç½®æš´éœ²</td></tr><tr><td><strong>ç›®å½•éå†</strong></td><td>ğŸŸ¡ é«˜å±</td><td><code>/../../../etc/passwd</code></td><td>ç³»ç»Ÿæ–‡ä»¶è¯»å–</td></tr><tr><td><strong>ç‰ˆæœ¬ä¿¡æ¯æ³„éœ²</strong></td><td>ğŸŸ¡ ä¸­å±</td><td><code>curl -I</code>æŸ¥çœ‹Serverå¤´</td><td>ç²¾å‡†æ”»å‡»ã€ç‰ˆæœ¬æ¼æ´åˆ©ç”¨</td></tr><tr><td><strong>ç‚¹å‡»åŠ«æŒ</strong></td><td>ğŸŸ¡ ä¸­å±</td><td>iframeåµŒå¥—æµ‹è¯•</td><td>ç”¨æˆ·è¯¯å¯¼ã€æ¶æ„æ“ä½œ</td></tr></tbody></table>
<h3 data-id="heading-4">ğŸ›¡ï¸ æ ¸å¿ƒé˜²æŠ¤ç­–ç•¥ï¼š3æ­¥æ„å»ºå®‰å…¨ç½‘å…³</h3>
<h4 data-id="heading-5">ç¬¬ä¸€æ­¥ï¼šèº«ä»½éšè— - æ¶ˆé™¤æ”»å‡»é¢ä¿¡æ¯</h4>
<h5 data-id="heading-6">1.1 ç‰ˆæœ¬å·éšè—ï¼ˆåŸºç¡€ä½†å…³é”®ï¼‰</h5>
<p><strong>ä¸ºä»€ä¹ˆå¿…é¡»éšè—ç‰ˆæœ¬å·ï¼Ÿ</strong></p>
<ul>
<li>Nginxç‰ˆæœ¬æ³„éœ² = ç»™æ”»å‡»è€…æä¾›<strong>ç²¾ç¡®çš„æ”»å‡»åœ°å›¾</strong></li>
<li>CVEæ¼æ´æ•°æ®åº“éƒ½æ˜¯æŒ‰ç‰ˆæœ¬å·ç»„ç»‡çš„</li>
<li>æ”»å‡»è€…å¯ä»¥<strong>è‡ªåŠ¨åŒ–æ‰«æ</strong>ç‰¹å®šç‰ˆæœ¬çš„å·²çŸ¥æ¼æ´</li>
</ul>
<p><strong>é…ç½®æ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># /etc/nginx/nginx.conf
http {
    # éšè—ç‰ˆæœ¬å· - è¿™æ˜¯ç¬¬ä¸€é“é˜²çº¿
    server_tokens off;
    
    # å…¶ä»–é…ç½®...
}
</code></pre>
<p><strong>éªŒè¯æ•ˆæœï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¼˜åŒ–å‰</span>
$ curl -I http://your-domain.com
HTTP/1.1 200 OK
Server: nginx/1.24.0  <span class="hljs-comment"># â† ç‰ˆæœ¬æš´éœ²ï¼</span>

<span class="hljs-comment"># ä¼˜åŒ–å</span>
$ curl -I http://your-domain.com
HTTP/1.1 200 OK
Server: nginx           <span class="hljs-comment"># â† ç‰ˆæœ¬éšè—ï¼</span>
</code></pre>
<h5 data-id="heading-7">1.2 é”™è¯¯é¡µé¢ä¿¡æ¯æ¸…ç†</h5>
<p><strong>è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼ˆé˜²æ­¢ä¿¡æ¯æ³„éœ²ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯é¡µé¢
cat &gt; /var/www/html/error.html &lt;&lt; 'EOF'
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;&lt;title&gt;ç³»ç»Ÿç»´æŠ¤ä¸­&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;ç³»ç»Ÿç»´æŠ¤ä¸­&lt;/h1&gt;
    &lt;p&gt;è¯·ç¨åé‡è¯•ï¼Œæˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF

# Nginxé…ç½®
server {
    error_page 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 421 422 423 424 425 426 428 429 431 451 500 501 502 503 504 505 506 507 508 510 511 /error.html;
    
    location = /error.html {
        internal;
        root /var/www/html;
    }
}
</code></pre>
<h4 data-id="heading-8">ç¬¬äºŒæ­¥ï¼šå…¥å£å°å µ - æ„å»ºå¤šå±‚é˜²æŠ¤ç½‘</h4>
<h5 data-id="heading-9">2.1 æ•æ„Ÿæ–‡ä»¶è®¿é—®æ§åˆ¶</h5>
<p><strong>ä¸ºä»€ä¹ˆä¼ ç»Ÿé˜²æŠ¤ä¸å¤Ÿï¼Ÿ</strong></p>
<ul>
<li>ç®€å•çš„<code>deny all</code>ä¼šè¿”å›403ï¼Œä½†<strong>ä»ç„¶æ³„éœ²æ–‡ä»¶å­˜åœ¨æ€§</strong></li>
<li>æ”»å‡»è€…å¯ä»¥é€šè¿‡<strong>å“åº”å·®å¼‚</strong>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</li>
<li>éœ€è¦<strong>ç»Ÿä¸€è¿”å›404</strong>ï¼Œè®©æ”»å‡»è€…æ— æ³•åŒºåˆ†</li>
</ul>
<p><strong>ä¼ä¸šçº§é˜²æŠ¤é…ç½®ï¼š</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># ç¬¬ä¸€å±‚ï¼šéšè—æ–‡ä»¶é˜²æŠ¤ï¼ˆä»¥ç‚¹å¼€å¤´çš„æ–‡ä»¶ï¼‰
location ~ /\. {
    deny all;
    return 404;  # ç»Ÿä¸€è¿”å›404ï¼Œä¸æš´éœ²æ–‡ä»¶å­˜åœ¨æ€§
}

# ç¬¬äºŒå±‚ï¼šç‰ˆæœ¬æ§åˆ¶æ–‡ä»¶é˜²æŠ¤
location ~* \.(git|svn|hg|bzr)/ {
    deny all;
    return 404;
}

# ç¬¬ä¸‰å±‚ï¼šé…ç½®æ–‡ä»¶å’Œå¤‡ä»½æ–‡ä»¶é˜²æŠ¤
location ~* \.(env|config|conf|ini|properties|yaml|yml)$ {
    deny all;
    return 404;
}

# ç¬¬å››å±‚ï¼šå¼€å‘æ–‡ä»¶é˜²æŠ¤
location ~* \.(log|cache|tmp|bak|backup|old|save|sql|db)$ {
    deny all;
    return 404;
}

# ç¬¬äº”å±‚ï¼šå‹ç¼©åŒ…å’Œæ–‡æ¡£é˜²æŠ¤
location ~* \.(zip|tar|gz|rar|7z|pdf|doc|docx|xls|xlsx)$ {
    deny all;
    return 404;
}

# ç¬¬å…­å±‚ï¼šç‰¹æ®Šç›®å½•é˜²æŠ¤
location ~* ^/(admin|manage|backend|api-docs|swagger|phpmyadmin|wp-admin)/ {
    deny all;
    return 404;
}
</code></pre>
<h5 data-id="heading-10">2.2 ç›®å½•éå†é˜²æŠ¤ï¼ˆPath Traversalï¼‰</h5>
<p><strong>æ”»å‡»åŸç†åˆ†æï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">æ­£å¸¸è¯·æ±‚: GET /images/photo.jpg
æ”»å‡»è¯·æ±‚: GET /images/../../../etc/passwd

ç›®æ ‡ï¼šè·³å‡ºWebç›®å½•ï¼Œè®¿é—®ç³»ç»Ÿæ–‡ä»¶
</code></pre>
<p><strong>é˜²æŠ¤ç­–ç•¥ï¼š</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># æ–¹æ³•1ï¼šæ˜¾å¼æ‹’ç»è·¯å¾„éå†æ¨¡å¼
location ~ \.\./ {
    deny all;
    return 404;
}

# æ–¹æ³•2ï¼šé™åˆ¶è·¯å¾„æ·±åº¦ï¼ˆæ¨èï¼‰
location ~* ^(.*/){3,}.*\.\. {
    deny all;
    return 404;
}

# æ–¹æ³•3ï¼šURLè§£ç åæ£€æŸ¥ï¼ˆé˜²æ­¢ç¼–ç ç»•è¿‡ï¼‰
location ~* "%2e%2e%2f" {
    deny all;
    return 404;
}
</code></pre>
<h5 data-id="heading-11">2.3 HTTPæ–¹æ³•é™åˆ¶</h5>
<p>**æœ€å°æƒé™åŸåˆ™ï¼š**åªå…è®¸å¿…è¦çš„HTTPæ–¹æ³•</p>
<pre><code class="hljs language-nginx" lang="nginx"># é™åˆ¶HTTPæ–¹æ³•
if ($request_method !~ ^(GET|HEAD|POST)$) {
    return 405;
}

# æ›´ä¸¥æ ¼çš„APIæ¥å£é™åˆ¶
location /api/ {
    # APIåªå…è®¸GETå’ŒPOST
    if ($request_method !~ ^(GET|POST)$) {
        return 405;
    }
    
    # ä¸Šä¼ æ¥å£åªå…è®¸POST
    location /api/upload {
        if ($request_method != POST) {
            return 405;
        }
    }
}
</code></pre>
<h4 data-id="heading-12">ç¬¬ä¸‰æ­¥ï¼šèº«ä»½é”å®š - é˜²å¾¡Hostå¤´æ”»å‡»</h4>
<h5 data-id="heading-13">3.1 Hostå¤´æ”»å‡»åŸç†æ·±åº¦è§£æ</h5>
<p><strong>æ”»å‡»åœºæ™¯é‡ç°ï¼š</strong></p>
<pre><code class="hljs language-http" lang="http"># æ­£å¸¸è¯·æ±‚
GET /api/password-reset HTTP/1.1
Host: legitimate-site.com

# æ”»å‡»è¯·æ±‚
GET /api/password-reset HTTP/1.1
Host: attacker-controlled.com
</code></pre>
<p><strong>æ”»å‡»å½±å“ï¼š</strong></p>
<ol>
<li><strong>å¯†ç é‡ç½®é“¾æ¥åŠ«æŒ</strong> - ç”¨æˆ·æ”¶åˆ°çš„é‡ç½®é‚®ä»¶åŒ…å«æ¶æ„é“¾æ¥</li>
<li><strong>SSRFæ”»å‡»</strong> - æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼Œè®¿é—®å†…ç½‘èµ„æº</li>
<li><strong>ç¼“å­˜æ±¡æŸ“</strong> - æ±¡æŸ“CDNç¼“å­˜ï¼Œä¼ æ’­æ¶æ„å†…å®¹</li>
<li><strong>ä¼šè¯åŠ«æŒ</strong> - é‡å®šå‘åˆ°é’“é±¼ç½‘ç«™çªƒå–å‡­è¯</li>
</ol>
<h5 data-id="heading-14">3.2 ä¼ä¸šçº§Hostå¤´é˜²æŠ¤æ–¹æ¡ˆ</h5>
<p><strong>ç¬¬ä¸€å±‚ï¼šé»˜è®¤æ‹’ç»æœåŠ¡å™¨å—</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># è¿™ä¸ªé…ç½®å¿…é¡»æ”¾åœ¨æ‰€æœ‰serverå—ä¹‹å‰ï¼
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;
    
    # æ‹’ç»æ‰€æœ‰æœªæ˜ç¡®åŒ¹é…çš„è¯·æ±‚
    server_name _ "";
    
    # è¿”å›403ç¦æ­¢è®¿é—®
    return 403;
    
    # å¯é€‰ï¼šè®°å½•æ”»å‡»æ—¥å¿—
    access_log /var/log/nginx/block-host-attack.log;
}
</code></pre>
<p><strong>ç¬¬äºŒå±‚ï¼šæ˜ç¡®åŸŸåç™½åå•</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># åªå…è®¸ç‰¹å®šçš„åˆæ³•åŸŸå
server {
    listen 80;
    listen [::]:80;
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    
    # æ˜ç¡®æŒ‡å®šå…è®¸çš„åŸŸå
    server_name example.com www.example.com;
    
    # å¼ºåˆ¶HTTPSï¼ˆå¦‚æœé…ç½®äº†SSLï¼‰
    if ($scheme != "https") {
        return 301 https://$server_name$request_uri;
    }
    
    # ä½ çš„ä¸šåŠ¡é…ç½®...
}
</code></pre>
<p><strong>ç¬¬ä¸‰å±‚ï¼šHostå¤´éªŒè¯</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># åœ¨locationå—ä¸­æ·»åŠ Hostå¤´éªŒè¯
location / {
    # éªŒè¯Hostå¤´æ˜¯å¦åŒ¹é…server_name
    if ($host !~* ^(example\.com|www\.example\.com)$) {
        return 403;
    }
    
    # é¢å¤–çš„Hostå¤´æ ¼å¼éªŒè¯
    if ($host ~* [^a-z0-9\-\.]) {
        return 403;
    }
    
    # ä»£ç†åˆ°åç«¯æ—¶ä¿ç•™åŸå§‹Host
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
</code></pre>
<h5 data-id="heading-15">3.3 é«˜çº§é˜²æŠ¤ï¼šå¤šå±‚éªŒè¯æœºåˆ¶</h5>
<p><strong>ç»“åˆåœ°ç†ä½ç½®å’Œåº”ç”¨å±‚éªŒè¯ï¼š</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># åœ°ç†ä½ç½®é™åˆ¶ï¼ˆå¯é€‰ï¼‰
geoip_country /usr/share/GeoIP/GeoIP.dat;
map $geoip_country_code $allowed_country {
    default no;
    CN yes;      # ä¸­å›½
    US yes;      # ç¾å›½
    JP yes;      # æ—¥æœ¬
}

server {
    # ... å…¶ä»–é…ç½® ...
    
    location / {
        # åœ°ç†ä½ç½®éªŒè¯
        if ($allowed_country = no) {
            return 403;
        }
        
        # Hostå¤´éªŒè¯
        if ($host !~* ^(example\.com|www\.example\.com)$) {
            return 403;
        }
        
        # User-AgentéªŒè¯ï¼ˆé˜²æ­¢è‡ªåŠ¨åŒ–æ”»å‡»ï¼‰
        if ($http_user_agent ~* (wget|curl|libwww-perl|python|nikto|scan|nmap|sqlmap|hydra|gobuster)) {
            return 403;
        }
        
        proxy_pass http://backend;
    }
}
</code></pre>
<h3 data-id="heading-16">ğŸš€ è¿›é˜¶é˜²æŠ¤ï¼šå®‰å…¨å“åº”å¤´é…ç½®</h3>
<h4 data-id="heading-17">4.1 ç°ä»£æµè§ˆå™¨å®‰å…¨ç­–ç•¥</h4>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨å“åº”å¤´ï¼Ÿ</strong></p>
<ul>
<li><strong>çºµæ·±é˜²å¾¡</strong>ï¼šå³ä½¿åº”ç”¨å±‚æœ‰æ¼æ´ï¼Œæµè§ˆå™¨å®‰å…¨æœºåˆ¶å¯æä¾›é¢å¤–ä¿æŠ¤</li>
<li><strong>åˆè§„è¦æ±‚</strong>ï¼šç­‰ä¿2.0æ˜ç¡®è¦æ±‚é…ç½®å®‰å…¨å“åº”å¤´</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé˜²æ­¢ç‚¹å‡»åŠ«æŒç­‰æ”»å‡»å½±å“ç”¨æˆ·ä¿¡ä»»</li>
</ul>
<p><strong>å®Œæ•´å®‰å…¨é…ç½®ï¼š</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># å®‰å…¨å“åº”å¤´é…ç½®
add_header X-Frame-Options "DENY" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰- æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; media-src 'self'; object-src 'none'; child-src 'none'; form-action 'self'; base-uri 'self'; frame-ancestors 'none';" always;

# ä¸¥æ ¼ä¼ è¾“å®‰å…¨ï¼ˆHSTSï¼‰- ä»…HTTPSç«™ç‚¹ä½¿ç”¨
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# æƒé™ç­–ç•¥ï¼ˆæ§åˆ¶æµè§ˆå™¨åŠŸèƒ½ï¼‰
add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()" always;
</code></pre>
<h4 data-id="heading-18">4.2 é€Ÿç‡é™åˆ¶å’ŒDDoSé˜²æŠ¤</h4>
<p><strong>åŸºç¡€é€Ÿç‡é™åˆ¶ï¼š</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># å®šä¹‰é€Ÿç‡é™åˆ¶åŒºåŸŸ
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;

server {
    location /api/ {
        # APIæ¥å£é€Ÿç‡é™åˆ¶
        limit_req zone=api burst=20 nodelay;
        limit_req_status 429;
        
        proxy_pass http://backend;
    }
    
    location /login {
        # ç™»å½•æ¥å£æ›´ä¸¥æ ¼çš„é™åˆ¶
        limit_req zone=login burst=5 nodelay;
        limit_req_status 429;
        
        proxy_pass http://backend;
    }
}
</code></pre>
<p><strong>é«˜çº§DDoSé˜²æŠ¤ï¼š</strong></p>
<pre><code class="hljs language-nginx" lang="nginx"># è¿æ¥æ•°é™åˆ¶
limit_conn_zone $binary_remote_addr zone=addr:10m;
limit_conn_zone $server_name zone=perserver:10m;

# è¯·æ±‚å¤§å°é™åˆ¶
client_max_body_size 10M;
client_body_timeout 12s;
client_header_timeout 12s;

server {
    # å•IPè¿æ¥æ•°é™åˆ¶
    limit_conn addr 100;
    limit_conn perserver 1000;
    
    # å¤§è¯·æ±‚é˜²æŠ¤
    location /upload {
        client_max_body_size 100M;
    }
}
</code></pre>
<h3 data-id="heading-19">ğŸ§ª å®Œæ•´éªŒè¯æµ‹è¯•æ–¹æ¡ˆ</h3>
<h4 data-id="heading-20">5.1 è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬</h4>
<p><strong>åˆ›å»ºå®‰å…¨æµ‹è¯•è„šæœ¬ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># nginx-security-test.sh</span>

DOMAIN=<span class="hljs-string">"your-domain.com"</span>
IP=<span class="hljs-string">"your-server-ip"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ” å¼€å§‹Nginxå®‰å…¨ç½‘å…³éªŒè¯æµ‹è¯•..."</span>

<span class="hljs-comment"># 1. ç‰ˆæœ¬éšè—æµ‹è¯•</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nğŸ“‹ 1. ç‰ˆæœ¬éšè—æµ‹è¯•"</span>
curl -s -I <span class="hljs-string">"http://<span class="hljs-variable">$DOMAIN</span>"</span> | grep -i <span class="hljs-string">"server"</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… Serverå¤´å·²éšè—"</span>

<span class="hljs-comment"># 2. æ•æ„Ÿæ–‡ä»¶è®¿é—®æµ‹è¯•</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nğŸ“‹ 2. æ•æ„Ÿæ–‡ä»¶è®¿é—®æµ‹è¯•"</span>
files=(<span class="hljs-string">".git/config"</span> <span class="hljs-string">".env"</span> <span class="hljs-string">"config.php.bak"</span> <span class="hljs-string">"admin/index.php"</span> <span class="hljs-string">"phpmyadmin/"</span>)
<span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">${files[@]}</span>"</span>; <span class="hljs-keyword">do</span>
    response=$(curl -s -o /dev/null -w <span class="hljs-string">"%{http_code}"</span> <span class="hljs-string">"http://<span class="hljs-variable">$DOMAIN</span>/<span class="hljs-variable">$file</span>"</span>)
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$response</span>"</span> = <span class="hljs-string">"404"</span> ] || [ <span class="hljs-string">"<span class="hljs-variable">$response</span>"</span> = <span class="hljs-string">"403"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… <span class="hljs-variable">$file</span>: å·²é˜»æ­¢ (HTTP <span class="hljs-variable">$response</span>)"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âŒ <span class="hljs-variable">$file</span>: å¯è®¿é—® (HTTP <span class="hljs-variable">$response</span>)"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 3. Hostå¤´æ”»å‡»æµ‹è¯•</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nğŸ“‹ 3. Hostå¤´æ”»å‡»æµ‹è¯•"</span>
response=$(curl -s -o /dev/null -w <span class="hljs-string">"%{http_code}"</span> -H <span class="hljs-string">"Host: evil.com"</span> <span class="hljs-string">"http://<span class="hljs-variable">$IP</span>/"</span>)
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$response</span>"</span> = <span class="hljs-string">"403"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… Hostå¤´æ”»å‡»: å·²é˜»æ­¢ (HTTP <span class="hljs-variable">$response</span>)"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"âŒ Hostå¤´æ”»å‡»: æœªé˜»æ­¢ (HTTP <span class="hljs-variable">$response</span>)"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 4. ç›®å½•éå†æµ‹è¯•</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nğŸ“‹ 4. ç›®å½•éå†æµ‹è¯•"</span>
response=$(curl -s -o /dev/null -w <span class="hljs-string">"%{http_code}"</span> <span class="hljs-string">"http://<span class="hljs-variable">$DOMAIN</span>/images/../../../etc/passwd"</span>)
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$response</span>"</span> = <span class="hljs-string">"404"</span> ] || [ <span class="hljs-string">"<span class="hljs-variable">$response</span>"</span> = <span class="hljs-string">"403"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… ç›®å½•éå†: å·²é˜»æ­¢ (HTTP <span class="hljs-variable">$response</span>)"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"âŒ ç›®å½•éå†: æœªé˜»æ­¢ (HTTP <span class="hljs-variable">$response</span>)"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 5. å®‰å…¨å“åº”å¤´æµ‹è¯•</span>
<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nğŸ“‹ 5. å®‰å…¨å“åº”å¤´æµ‹è¯•"</span>
curl -s -I <span class="hljs-string">"http://<span class="hljs-variable">$DOMAIN</span>"</span> | grep -E <span class="hljs-string">"(X-Frame-Options|X-Content-Type-Options|X-XSS-Protection|Content-Security-Policy)"</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">"âš ï¸  éƒ¨åˆ†å®‰å…¨å¤´ç¼ºå¤±"</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\nğŸ¯ æµ‹è¯•å®Œæˆï¼å»ºè®®ä¿®å¤æ‰€æœ‰âŒæ ‡è®°çš„é—®é¢˜ã€‚"</span>
</code></pre>
<h4 data-id="heading-21">5.2 æ‰‹åŠ¨éªŒè¯å‘½ä»¤</h4>
<p><strong>å…³é”®éªŒè¯å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç‰ˆæœ¬éšè—éªŒè¯</span>
curl -I http://your-domain.com

<span class="hljs-comment"># æ•æ„Ÿæ–‡ä»¶æµ‹è¯•</span>
curl -I http://your-domain.com/.git/config
curl -I http://your-domain.com/.env
curl -I http://your-domain.com/config.php.bak

<span class="hljs-comment"># Hostå¤´æ”»å‡»æµ‹è¯•</span>
curl -H <span class="hljs-string">"Host: evil.com"</span> -I http://your-server-ip/
curl -H <span class="hljs-string">"Host: attacker.com"</span> -I http://your-domain.com/

<span class="hljs-comment"># ç›®å½•éå†æµ‹è¯•</span>
curl -I <span class="hljs-string">"http://your-domain.com/images/../../../etc/passwd"</span>
curl -I <span class="hljs-string">"http://your-domain.com/static/..%2f..%2f..%2fetc%2fpasswd"</span>

<span class="hljs-comment"># å®‰å…¨å“åº”å¤´éªŒè¯</span>
curl -I http://your-domain.com | grep -i <span class="hljs-string">"x-frame\|x-content\|x-xss\|csp\|hsts"</span>
</code></pre>
<h3 data-id="heading-22">ğŸ“‹ ç”Ÿäº§ç¯å¢ƒå®Œæ•´é…ç½®æ¨¡æ¿</h3>
<h4 data-id="heading-23">6.1 ä¸»é…ç½®æ–‡ä»¶ï¼ˆnginx.confï¼‰</h4>
<pre><code class="hljs language-nginx" lang="nginx">user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
    use epoll;
    multi_accept on;
}

http {
    # åŸºç¡€ä¼˜åŒ–
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    'rt=$request_time uct="$upstream_connect_time" '
                    'uht="$upstream_header_time" urt="$upstream_response_time"';
    
    access_log /var/log/nginx/access.log main;
    
    # æ€§èƒ½ä¼˜åŒ–
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    client_max_body_size 10M;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 10240;
    gzip_proxied expired no-cache no-store private must-revalidate auth;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;
    
    # é€Ÿç‡é™åˆ¶
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;
    limit_conn_zone $binary_remote_addr zone=addr:10m;
    
    # éšè—ç‰ˆæœ¬å· - å®‰å…¨ç¬¬ä¸€é“é˜²çº¿
    server_tokens off;
    
    # é»˜è®¤æ‹’ç»æœåŠ¡å™¨å—ï¼ˆå¿…é¡»æ”¾åœ¨æœ€å‰é¢ï¼‰
    server {
        listen 80 default_server;
        listen [::]:80 default_server;
        listen 443 ssl default_server;
        listen [::]:443 ssl default_server;
        
        server_name _ "";
        return 403;
        
        # è®°å½•è¢«é˜»æ­¢çš„è¯·æ±‚
        access_log /var/log/nginx/block-default.log;
        
        ssl_certificate /etc/nginx/ssl/dummy.crt;
        ssl_certificate_key /etc/nginx/ssl/dummy.key;
    }
    
    # åŒ…å«ç«™ç‚¹é…ç½®
    include /etc/nginx/conf.d/*.conf;
}
</code></pre>
<h4 data-id="heading-24">6.2 ç«™ç‚¹å®‰å…¨é…ç½®ï¼ˆsite-security.confï¼‰</h4>
<pre><code class="hljs language-nginx" lang="nginx"># ä¸šåŠ¡ç«™ç‚¹å®‰å…¨é…ç½®
server {
    listen 80;
    listen [::]:80;
    server_name example.com www.example.com;
    
    # å¼ºåˆ¶HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    
    # æ˜ç¡®æŒ‡å®šå…è®¸çš„åŸŸå
    server_name example.com www.example.com;
    
    # SSLé…ç½®
    ssl_certificate /etc/nginx/ssl/example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/example.com.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # HSTSï¼ˆHTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ï¼‰
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
    
    # åŸºç¡€å®‰å…¨å“åº”å¤´
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # CSPï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰- æ ¹æ®å®é™…ä¸šåŠ¡è°ƒæ•´
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; media-src 'self'; object-src 'none'; child-src 'none'; form-action 'self'; base-uri 'self'; frame-ancestors 'none';" always;
    
    # æƒé™ç­–ç•¥
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()" always;
    
    # æ ¹ç›®å½•é…ç½®
    root /var/www/html;
    index index.html index.htm index.php;
    
    # å®‰å…¨æ–‡ä»¶è®¿é—®æ§åˆ¶
    # éšè—æ–‡ä»¶ï¼ˆä»¥.å¼€å¤´ï¼‰
    location ~ /\. {
        deny all;
        return 404;
        access_log off;
        log_not_found off;
    }
    
    # ç‰ˆæœ¬æ§åˆ¶æ–‡ä»¶
    location ~* \.(git|svn|hg|bzr)/ {
        deny all;
        return 404;
        access_log off;
        log_not_found off;
    }
    
    # é…ç½®æ–‡ä»¶
    location ~* \.(env|config|conf|ini|properties|yaml|yml)$ {
        deny all;
        return 404;
        access_log off;
        log_not_found off;
    }
    
    # æ—¥å¿—å’Œå¤‡ä»½æ–‡ä»¶
    location ~* \.(log|cache|tmp|bak|backup|old|save|sql|db)$ {
        deny all;
        return 404;
        access_log off;
        log_not_found off;
    }
    
    # å‹ç¼©åŒ…å’Œæ–‡æ¡£
    location ~* \.(zip|tar|gz|rar|7z|pdf|doc|docx|xls|xlsx|ppt|pptx)$ {
        deny all;
        return 404;
        access_log off;
        log_not_found off;
    }
    
    # ç‰¹æ®Šç›®å½•
    location ~* ^/(admin|manage|backend|api-docs|swagger|phpmyadmin|wp-admin|wp-config|xmlrpc) {
        deny all;
        return 404;
        access_log off;
        log_not_found off;
    }
    
    # è·¯å¾„éå†é˜²æŠ¤
    location ~ \.\./ {
        deny all;
        return 404;
        access_log off;
        log_not_found off;
    }
    
    # URLè§£ç åçš„è·¯å¾„éå†
    location ~* "%2e%2e%2f" {
        deny all;
        return 404;
        access_log off;
        log_not_found off;
    }
    
    # APIæ¥å£é€Ÿç‡é™åˆ¶
    location /api/ {
        limit_req zone=api burst=20 nodelay;
        limit_req_status 429;
        
        # é¢å¤–çš„ç™»å½•æ¥å£é™åˆ¶
        location /api/login {
            limit_req zone=login burst=5 nodelay;
            limit_req_status 429;
        }
        
        # ä»£ç†åˆ°åç«¯
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¿æ¥è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
    
    # é™æ€èµ„æºå¤„ç†
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf|svg|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # é»˜è®¤location
    location / {
        # Hostå¤´éªŒè¯
        if ($host !~* ^(example\.com|www\.example\.com)$) {
            return 403;
        }
        
        # User-AgentéªŒè¯ï¼ˆé˜²æ­¢è‡ªåŠ¨åŒ–æ”»å‡»ï¼‰
        if ($http_user_agent ~* (wget|curl|libwww-perl|python|nikto|scan|nmap|sqlmap|hydra|gobuster|dirbuster)) {
            return 403;
        }
        
        # è¯·æ±‚æ–¹æ³•é™åˆ¶
        if ($request_method !~ ^(GET|HEAD|POST)$) {
            return 405;
        }
        
        # ä»£ç†åˆ°åç«¯
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¿æ¥è¶…æ—¶
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
    
    # é”™è¯¯é¡µé¢
    error_page 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 421 422 423 424 425 426 428 429 431 451 500 501 502 503 504 505 506 507 508 510 511 /error.html;
    
    location = /error.html {
        internal;
        root /var/www/html;
    }
    
    # è®¿é—®æ—¥å¿—
    access_log /var/log/nginx/example.com-access.log main;
    error_log /var/log/nginx/example.com-error.log warn;
}
</code></pre>
<h3 data-id="heading-25">ğŸ¯ éƒ¨ç½²ä¸ç»´æŠ¤æŒ‡å—</h3>
<h4 data-id="heading-26">7.1 éƒ¨ç½²æ­¥éª¤</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å¤‡ä»½ç°æœ‰é…ç½®</span>
<span class="hljs-built_in">cp</span> /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup.$(<span class="hljs-built_in">date</span> +%Y%m%d)

<span class="hljs-comment"># 2. æµ‹è¯•æ–°é…ç½®</span>
nginx -t

<span class="hljs-comment"># 3. é‡æ–°åŠ è½½é…ç½®</span>
nginx -s reload

<span class="hljs-comment"># 4. éªŒè¯æ•ˆæœ</span>
./nginx-security-test.sh
</code></pre>
<h4 data-id="heading-27">7.2 ç›‘æ§ä¸å‘Šè­¦</h4>
<p><strong>è®¾ç½®ç›‘æ§è„šæœ¬ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># security-monitor.sh</span>

LOG_FILE=<span class="hljs-string">"/var/log/nginx/security-alerts.log"</span>
ALERT_EMAIL=<span class="hljs-string">"admin@example.com"</span>

<span class="hljs-comment"># ç›‘æ§Hostå¤´æ”»å‡»</span>
grep <span class="hljs-string">"Host:.*\.com"</span> /var/log/nginx/access.log | grep -v <span class="hljs-string">"example.com"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[<span class="hljs-subst">$(date)</span>] Hostå¤´æ”»å‡»æ£€æµ‹: <span class="hljs-variable">$line</span>"</span> &gt;&gt; <span class="hljs-variable">$LOG_FILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"æ£€æµ‹åˆ°Hostå¤´æ”»å‡»: <span class="hljs-variable">$line</span>"</span> | mail -s <span class="hljs-string">"Nginxå®‰å…¨å‘Šè­¦"</span> <span class="hljs-variable">$ALERT_EMAIL</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># ç›‘æ§æ•æ„Ÿæ–‡ä»¶è®¿é—®</span>
grep -E <span class="hljs-string">"(\.git|\.env|config\.bak)"</span> /var/log/nginx/access.log | grep <span class="hljs-string">" 200"</span> | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[<span class="hljs-subst">$(date)</span>] æ•æ„Ÿæ–‡ä»¶è®¿é—®å‘Šè­¦: <span class="hljs-variable">$line</span>"</span> &gt;&gt; <span class="hljs-variable">$LOG_FILE</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"æ£€æµ‹åˆ°æ•æ„Ÿæ–‡ä»¶è®¿é—®: <span class="hljs-variable">$line</span>"</span> | mail -s <span class="hljs-string">"ç´§æ€¥å®‰å…¨å‘Šè­¦"</span> <span class="hljs-variable">$ALERT_EMAIL</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h4 data-id="heading-28">7.3 å®šæœŸå®‰å…¨å®¡è®¡</h4>
<p><strong>æœˆåº¦å®‰å…¨æ£€æŸ¥æ¸…å•ï¼š</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ£€æŸ¥Nginxè®¿é—®æ—¥å¿—ä¸­çš„å¼‚å¸¸è¯·æ±‚</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> éªŒè¯æ‰€æœ‰å®‰å…¨å¤´æ˜¯å¦æ­£ç¡®è®¾ç½®</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æµ‹è¯•æ•æ„Ÿæ–‡ä»¶æ˜¯å¦ä»ç„¶è¢«é˜»æ­¢</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ£€æŸ¥SSLè¯ä¹¦æœ‰æ•ˆæœŸ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ›´æ–°GeoIPæ•°æ®åº“</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å®¡æŸ¥é€Ÿç‡é™åˆ¶é˜ˆå€¼æ˜¯å¦éœ€è¦è°ƒæ•´</li>
</ul>
<h3 data-id="heading-29">ğŸ† æ€»ç»“ï¼šæ„å»ºä¼ä¸šçº§å®‰å…¨ç½‘å…³</h3>
<h4 data-id="heading-30">æ ¸å¿ƒé˜²æŠ¤æˆæœ</h4>
<p>é€šè¿‡æœ¬æŒ‡å—çš„å®æ–½ï¼Œä½ çš„ç½‘ç«™å°†è·å¾—ï¼š</p>



































<table><thead><tr><th>é˜²æŠ¤ç»´åº¦</th><th>å®ç°æ•ˆæœ</th><th>å®‰å…¨ç­‰çº§</th></tr></thead><tbody><tr><td><strong>ä¿¡æ¯éšè—</strong></td><td>ç‰ˆæœ¬å·å®Œå…¨éšè—ï¼Œé”™è¯¯é¡µé¢è‡ªå®šä¹‰</td><td>ğŸ”´ ä¼˜ç§€</td></tr><tr><td><strong>å…¥å£æ§åˆ¶</strong></td><td>æ•æ„Ÿæ–‡ä»¶100%é˜»æ­¢ï¼Œç›®å½•éå†é˜²æŠ¤</td><td>ğŸ”´ ä¼˜ç§€</td></tr><tr><td><strong>èº«ä»½éªŒè¯</strong></td><td>Hostå¤´æ”»å‡»å®Œå…¨é˜²æŠ¤ï¼ŒåŸŸåç™½åå•éªŒè¯</td><td>ğŸ”´ ä¼˜ç§€</td></tr><tr><td><strong>å“åº”å®‰å…¨</strong></td><td>å®Œæ•´å®‰å…¨å¤´é…ç½®ï¼Œæµè§ˆå™¨é˜²æŠ¤æœºåˆ¶å¯ç”¨</td><td>ğŸŸ¡ è‰¯å¥½</td></tr><tr><td><strong>æ€§èƒ½ä¼˜åŒ–</strong></td><td>é€Ÿç‡é™åˆ¶ç”Ÿæ•ˆï¼Œèµ„æºç¼“å­˜ä¼˜åŒ–</td><td>ğŸŸ¡ è‰¯å¥½</td></tr></tbody></table>
<h4 data-id="heading-31">åˆè§„æ€§è¯„ä¼°</h4>
<p><strong>ç­‰ä¿2.0åˆè§„æ£€æŸ¥ï¼š</strong></p>
<ul>
<li>âœ… <strong>è®¿é—®æ§åˆ¶</strong>ï¼šå®ç°äº†åŸºäºåŸŸåçš„è®¿é—®æ§åˆ¶</li>
<li>âœ… <strong>å®‰å…¨å®¡è®¡</strong>ï¼šå®Œæ•´çš„è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—</li>
<li>âœ… <strong>å…¥ä¾µé˜²èŒƒ</strong>ï¼šå¤šå±‚é˜²æŠ¤æœºåˆ¶é˜»æ­¢å¸¸è§æ”»å‡»</li>
<li>âœ… <strong>æ¶æ„ä»£ç é˜²èŒƒ</strong>ï¼šé˜²æ­¢æ–‡ä»¶ä¸Šä¼ å’Œæ‰§è¡Œ</li>
<li>âœ… <strong>æ•°æ®å®Œæ•´æ€§</strong>ï¼šæ•æ„Ÿæ–‡ä»¶è®¿é—®æ§åˆ¶</li>
</ul>
<h4 data-id="heading-32">ç»´æŠ¤å»ºè®®</h4>
<ol>
<li><strong>å®šæœŸæ›´æ–°</strong>ï¼šå…³æ³¨Nginxå®‰å…¨å…¬å‘Šï¼ŒåŠæ—¶æ›´æ–°ç‰ˆæœ¬</li>
<li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šå»ºç«‹å®Œæ•´çš„å®‰å…¨ç›‘æ§ä½“ç³»</li>
<li><strong>æ¸—é€æµ‹è¯•</strong>ï¼šæ¯å­£åº¦è¿›è¡Œä¸€æ¬¡å®‰å…¨æµ‹è¯•</li>
<li><strong>é…ç½®å¤‡ä»½</strong>ï¼šå®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶å’Œè¯ä¹¦</li>
<li><strong>å›¢é˜ŸåŸ¹è®­</strong>ï¼šç¡®ä¿å›¢é˜Ÿäº†è§£å®‰å…¨é…ç½®çš„é‡è¦æ€§</li>
</ol>
<h4 data-id="heading-33">ä¸‹ä¸€æ­¥è¡ŒåŠ¨</h4>
<p>ç°åœ¨ä½ å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªä¼ä¸šçº§çš„Nginxå®‰å…¨ç½‘å…³ï¼å»ºè®®ï¼š</p>
<ol>
<li><strong>ç«‹å³æµ‹è¯•</strong>ï¼šä½¿ç”¨æä¾›çš„æµ‹è¯•è„šæœ¬éªŒè¯é…ç½®</li>
<li><strong>ç›‘æ§éƒ¨ç½²</strong>ï¼šè®¾ç½®å®‰å…¨ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶</li>
<li><strong>å›¢é˜Ÿåˆ†äº«</strong>ï¼šå°†è¿™ä»½æŒ‡å—åˆ†äº«ç»™å›¢é˜Ÿæˆå‘˜</li>
<li><strong>æŒç»­æ”¹è¿›</strong>ï¼šæ ¹æ®å®é™…æ”»å‡»æƒ…å†µè°ƒæ•´é˜²æŠ¤ç­–ç•¥</li>
</ol>
<p>è®°ä½ï¼š<strong>å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§çš„é…ç½®</strong>ã€‚ä¿æŒè­¦æƒ•ï¼Œå®šæœŸå®¡æŸ¥ï¼Œä½ çš„ç½‘ç«™å°†å›ºè‹¥é‡‘æ±¤ï¼</p>
<hr/>
<h3 data-id="heading-34">ğŸš€ ç¬¬å…«éƒ¨åˆ†ï¼šäº‘åŸç”Ÿå®‰å…¨æ¶æ„æ¼”è¿›</h3>
<h4 data-id="heading-35">8.1 Kubernetes Ingresså®‰å…¨ç­–ç•¥</h4>
<p><strong>ä¼ ç»ŸNginx vs äº‘åŸç”Ÿæ¶æ„çš„æŒ‘æˆ˜ï¼š</strong></p>
<p>åœ¨ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ç®¡ç†Nginxå®ä¾‹ï¼Œä½†åœ¨Kubernetesç¯å¢ƒä¸­ï¼Œå®‰å…¨è¾¹ç•Œå˜å¾—æ›´åŠ å¤æ‚ã€‚Podé—´çš„ç½‘ç»œé€šä¿¡ã€æœåŠ¡å‘ç°ã€åŠ¨æ€æ‰©ç¼©å®¹éƒ½å¸¦æ¥äº†æ–°çš„å®‰å…¨æŒ‘æˆ˜ã€‚</p>
<p><strong>Kubernetesç½‘ç»œå®‰å…¨æ¨¡å‹ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># NetworkPolicyï¼šç½‘ç»œå±‚è®¿é—®æ§åˆ¶</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">networking.k8s.io/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">NetworkPolicy</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-ingress-network-policy</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">production</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">podSelector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx-ingress</span>
  <span class="hljs-attr">policyTypes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">Ingress</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">Egress</span>
  <span class="hljs-attr">ingress:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">from:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">namespaceSelector:</span>
        <span class="hljs-attr">matchLabels:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">production</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">podSelector:</span>
        <span class="hljs-attr">matchLabels:</span>
          <span class="hljs-attr">role:</span> <span class="hljs-string">frontend</span>
    <span class="hljs-attr">ports:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">443</span>
  <span class="hljs-attr">egress:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">to:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">namespaceSelector:</span>
        <span class="hljs-attr">matchLabels:</span>
          <span class="hljs-attr">name:</span> <span class="hljs-string">production</span>
    <span class="hljs-attr">ports:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>  <span class="hljs-comment"># åç«¯æœåŠ¡ç«¯å£</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">53</span>    <span class="hljs-comment"># DNSæŸ¥è¯¢</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">UDP</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">53</span>
</code></pre>
<p><strong>Ingress Controllerå®‰å…¨é…ç½®ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># nginx-ingress-controllerå®‰å…¨éƒ¨ç½²</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-ingress-controller</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">ingress-nginx</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx-ingress</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">nginx-ingress</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">nginx-ingress-serviceaccount</span>
      <span class="hljs-attr">securityContext:</span>
        <span class="hljs-attr">runAsNonRoot:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">runAsUser:</span> <span class="hljs-number">101</span>
        <span class="hljs-attr">fsGroup:</span> <span class="hljs-number">101</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-ingress-controller</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">k8s.gcr.io/ingress-nginx/controller:v1.8.1</span>
        <span class="hljs-attr">securityContext:</span>
          <span class="hljs-attr">allowPrivilegeEscalation:</span> <span class="hljs-literal">false</span>
          <span class="hljs-attr">readOnlyRootFilesystem:</span> <span class="hljs-literal">true</span>
          <span class="hljs-attr">capabilities:</span>
            <span class="hljs-attr">drop:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">ALL</span>
            <span class="hljs-attr">add:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">NET_BIND_SERVICE</span>
        <span class="hljs-attr">args:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">/nginx-ingress-controller</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">--configmap=$(POD_NAMESPACE)/nginx-configuration</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">--tcp-services-configmap=$(POD_NAMESPACE)/tcp-services</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">--udp-services-configmap=$(POD_NAMESPACE)/udp-services</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">--annotations-prefix=nginx.ingress.kubernetes.io</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">--enable-ssl-passthrough</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">--ssl-passthrough-proxy-port=442</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">POD_NAME</span>
          <span class="hljs-attr">valueFrom:</span>
            <span class="hljs-attr">fieldRef:</span>
              <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">metadata.name</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">POD_NAMESPACE</span>
          <span class="hljs-attr">valueFrom:</span>
            <span class="hljs-attr">fieldRef:</span>
              <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">metadata.namespace</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span>
          <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span>
          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">https</span>
          <span class="hljs-attr">containerPort:</span> <span class="hljs-number">443</span>
          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">webhook</span>
          <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8443</span>
          <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
        <span class="hljs-attr">livenessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/healthz</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">10254</span>
            <span class="hljs-attr">scheme:</span> <span class="hljs-string">HTTP</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
        <span class="hljs-attr">readinessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/healthz</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">10254</span>
            <span class="hljs-attr">scheme:</span> <span class="hljs-string">HTTP</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
        <span class="hljs-attr">resources:</span>
          <span class="hljs-attr">requests:</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">90Mi</span>
          <span class="hljs-attr">limits:</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">200m</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">180Mi</span>
</code></pre>
<p><strong>Podå®‰å…¨ç­–ç•¥ï¼ˆPodSecurityPolicyï¼‰ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">policy/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">PodSecurityPolicy</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-ingress-psp</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">privileged:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">allowPrivilegeEscalation:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">requiredDropCapabilities:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">ALL</span>
  <span class="hljs-attr">allowedCapabilities:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">NET_BIND_SERVICE</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">'configMap'</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">'emptyDir'</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">'projected'</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">'secret'</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">'downwardAPI'</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">'persistentVolumeClaim'</span>
  <span class="hljs-attr">hostNetwork:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">hostIPC:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">hostPID:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">runAsUser:</span>
    <span class="hljs-attr">rule:</span> <span class="hljs-string">'MustRunAsNonRoot'</span>
  <span class="hljs-attr">supplementalGroups:</span>
    <span class="hljs-attr">rule:</span> <span class="hljs-string">'MustRunAs'</span>
    <span class="hljs-attr">ranges:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">min:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">max:</span> <span class="hljs-number">65535</span>
  <span class="hljs-attr">fsGroup:</span>
    <span class="hljs-attr">rule:</span> <span class="hljs-string">'MustRunAs'</span>
    <span class="hljs-attr">ranges:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">min:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">max:</span> <span class="hljs-number">65535</span>
  <span class="hljs-attr">readOnlyRootFilesystem:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">seLinux:</span>
    <span class="hljs-attr">rule:</span> <span class="hljs-string">'RunAsAny'</span>
</code></pre>
<h4 data-id="heading-36">8.2 å®¹å™¨åŒ–Nginxå®‰å…¨æœ€ä½³å®è·µ</h4>
<p><strong>æœ€å°æƒé™å®¹å™¨é•œåƒæ„å»ºï¼š</strong></p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># å¤šé˜¶æ®µæ„å»ºå®‰å…¨Nginxé•œåƒ
FROM alpine:3.18 AS builder

# å®‰è£…æ„å»ºä¾èµ–
RUN apk add --no-cache \
    gcc \
    g++ \
    make \
    pcre-dev \
    zlib-dev \
    openssl-dev \
    geoip-dev

# ä¸‹è½½å¹¶ç¼–è¯‘Nginxï¼ˆåŒ…å«å®‰å…¨æ¨¡å—ï¼‰
ENV NGINX_VERSION=1.25.3
RUN wget http://nginx.org/download/nginx-${NGINX_VERSION}.tar.gz &amp;&amp; \
    tar -xzf nginx-${NGINX_VERSION}.tar.gz &amp;&amp; \
    cd nginx-${NGINX_VERSION} &amp;&amp; \
    ./configure \
        --prefix=/etc/nginx \
        --sbin-path=/usr/sbin/nginx \
        --conf-path=/etc/nginx/nginx.conf \
        --error-log-path=/var/log/nginx/error.log \
        --http-log-path=/var/log/nginx/access.log \
        --pid-path=/var/run/nginx.pid \
        --lock-path=/var/run/nginx.lock \
        --with-http_ssl_module \
        --with-http_v2_module \
        --with-http_realip_module \
        --with-http_geoip_module \
        --with-http_secure_link_module \
        --with-http_sub_module \
        --with-http_stub_status_module \
        --with-stream \
        --with-stream_ssl_module \
        --with-stream_ssl_preread_module &amp;&amp; \
    make &amp;&amp; make install

# ç”Ÿäº§é•œåƒ
FROM alpine:3.18

# åˆ›å»ºéç‰¹æƒç”¨æˆ·
RUN addgroup -g 101 -S nginx &amp;&amp; \
    adduser -S -D -H -u 101 -h /var/cache/nginx -s /sbin/nologin -G nginx -g nginx nginx

# å®‰è£…è¿è¡Œæ—¶ä¾èµ–
RUN apk add --no-cache \
    pcre \
    zlib \
    openssl \
    geoip \
    ca-certificates \
    tzdata

# å¤åˆ¶ç¼–è¯‘å¥½çš„Nginx
COPY --from=builder /etc/nginx /etc/nginx
COPY --from=builder /usr/sbin/nginx /usr/sbin/nginx
COPY --from=builder /var/log/nginx /var/log/nginx

# å¤åˆ¶é…ç½®æ–‡ä»¶
COPY nginx.conf /etc/nginx/nginx.conf
COPY security.conf /etc/nginx/conf.d/security.conf

# è®¾ç½®æ–‡ä»¶æƒé™
RUN chown -R nginx:nginx /etc/nginx &amp;&amp; \
    chown -R nginx:nginx /var/log/nginx &amp;&amp; \
    chown -R nginx:nginx /var/cache/nginx &amp;&amp; \
    chmod 644 /etc/nginx/nginx.conf &amp;&amp; \
    chmod 644 /etc/nginx/conf.d/security.conf

# åˆ›å»ºå¿…è¦çš„ç›®å½•
RUN mkdir -p /var/cache/nginx/client_temp &amp;&amp; \
    mkdir -p /var/cache/nginx/proxy_temp &amp;&amp; \
    mkdir -p /var/cache/nginx/fastcgi_temp &amp;&amp; \
    mkdir -p /var/cache/nginx/uwsgi_temp &amp;&amp; \
    mkdir -p /var/cache/nginx/scgi_temp &amp;&amp; \
    chown -R nginx:nginx /var/cache/nginx

# å¥åº·æ£€æŸ¥è„šæœ¬
COPY healthcheck.sh /usr/local/bin/healthcheck.sh
RUN chmod +x /usr/local/bin/healthcheck.sh

# åˆ‡æ¢åˆ°éç‰¹æƒç”¨æˆ·
USER nginx

# æš´éœ²ç«¯å£
EXPOSE 8080 8443

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD /usr/local/bin/healthcheck.sh

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["nginx", "-g", "daemon off;"]
</code></pre>
<p><strong>å¥åº·æ£€æŸ¥è„šæœ¬ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/sh</span>
<span class="hljs-comment"># healthcheck.sh</span>

<span class="hljs-built_in">set</span> -e

<span class="hljs-comment"># æ£€æŸ¥Nginxè¿›ç¨‹</span>
<span class="hljs-keyword">if</span> ! pgrep -x <span class="hljs-string">"nginx"</span> &gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Nginx process not running"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•</span>
<span class="hljs-keyword">if</span> ! nginx -t &gt; /dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Nginx configuration test failed"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># æ£€æŸ¥ç›‘å¬ç«¯å£</span>
<span class="hljs-keyword">if</span> ! netstat -<span class="hljs-built_in">ln</span> | grep -q <span class="hljs-string">":8080 "</span>; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Nginx not listening on port 8080"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># æµ‹è¯•HTTPå“åº”</span>
<span class="hljs-keyword">if</span> ! wget -q -O /dev/null -T 5 http://localhost:8080/health; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Nginx health check endpoint failed"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Health check passed"</span>
<span class="hljs-built_in">exit</span> 0
</code></pre>
<h4 data-id="heading-37">8.3 Service Meshé›†æˆå®‰å…¨æ–¹æ¡ˆ</h4>
<p><strong>Istioç¯å¢ƒä¸‹çš„å®‰å…¨ç­–ç•¥ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Istioå®‰å…¨ç­–ç•¥é…ç½®</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">security.istio.io/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">PeerAuthentication</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-ingress-peer-auth</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">ingress-nginx</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx-ingress</span>
  <span class="hljs-attr">mtls:</span>
    <span class="hljs-attr">mode:</span> <span class="hljs-string">STRICT</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">security.istio.io/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">AuthorizationPolicy</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-ingress-authz</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">ingress-nginx</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx-ingress</span>
  <span class="hljs-attr">rules:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">from:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span>
        <span class="hljs-attr">principals:</span> [<span class="hljs-string">"cluster.local/ns/production/sa/frontend"</span>]
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span>
        <span class="hljs-attr">ipBlocks:</span> [<span class="hljs-string">"10.0.0.0/8"</span>, <span class="hljs-string">"172.16.0.0/12"</span>, <span class="hljs-string">"192.168.0.0/16"</span>]
    <span class="hljs-attr">to:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">operation:</span>
        <span class="hljs-attr">methods:</span> [<span class="hljs-string">"GET"</span>, <span class="hljs-string">"POST"</span>, <span class="hljs-string">"PUT"</span>, <span class="hljs-string">"DELETE"</span>]
        <span class="hljs-attr">paths:</span> [<span class="hljs-string">"/api/*"</span>, <span class="hljs-string">"/health"</span>, <span class="hljs-string">"/metrics"</span>]
  <span class="hljs-bullet">-</span> <span class="hljs-attr">from:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">source:</span>
        <span class="hljs-attr">principals:</span> [<span class="hljs-string">"cluster.local/ns/monitoring/sa/prometheus"</span>]
    <span class="hljs-attr">to:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">operation:</span>
        <span class="hljs-attr">methods:</span> [<span class="hljs-string">"GET"</span>]
        <span class="hljs-attr">paths:</span> [<span class="hljs-string">"/metrics"</span>, <span class="hljs-string">"/health"</span>]
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">networking.istio.io/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">DestinationRule</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-ingress-destination-rule</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">ingress-nginx</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">nginx-ingress-service.ingress-nginx.svc.cluster.local</span>
  <span class="hljs-attr">trafficPolicy:</span>
    <span class="hljs-attr">tls:</span>
      <span class="hljs-attr">mode:</span> <span class="hljs-string">ISTIO_MUTUAL</span>
    <span class="hljs-attr">connectionPool:</span>
      <span class="hljs-attr">tcp:</span>
        <span class="hljs-attr">maxConnections:</span> <span class="hljs-number">100</span>
      <span class="hljs-attr">http:</span>
        <span class="hljs-attr">http1MaxPendingRequests:</span> <span class="hljs-number">50</span>
        <span class="hljs-attr">http2MaxRequests:</span> <span class="hljs-number">100</span>
        <span class="hljs-attr">maxRequestsPerConnection:</span> <span class="hljs-number">10</span>
    <span class="hljs-attr">loadBalancer:</span>
      <span class="hljs-attr">simple:</span> <span class="hljs-string">LEAST_REQUEST</span>
    <span class="hljs-attr">outlierDetection:</span>
      <span class="hljs-attr">consecutiveErrors:</span> <span class="hljs-number">5</span>
      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">baseEjectionTime:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">maxEjectionPercent:</span> <span class="hljs-number">50</span>
      <span class="hljs-attr">minHealthPercent:</span> <span class="hljs-number">30</span>
</code></pre>
<h3 data-id="heading-38">ğŸ¤– ç¬¬ä¹éƒ¨åˆ†ï¼šAIé©±åŠ¨æ™ºèƒ½é˜²æŠ¤</h3>
<h4 data-id="heading-39">9.1 æœºå™¨å­¦ä¹ å¼‚å¸¸æ£€æµ‹</h4>
<p><strong>åŸºäºæµé‡çš„å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># ml_anomaly_detector.py</span>

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> IsolationForest
<span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> aiohttp

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NginxAnomalyDetector</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.redis_client = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">0</span>)
        self.model = IsolationForest(contamination=<span class="hljs-number">0.1</span>, random_state=<span class="hljs-number">42</span>)
        self.scaler = StandardScaler()
        self.is_fitted = <span class="hljs-literal">False</span>
        
        <span class="hljs-comment"># ç‰¹å¾å®šä¹‰</span>
        self.features = [
            <span class="hljs-string">'request_rate'</span>, <span class="hljs-string">'response_time'</span>, <span class="hljs-string">'status_4xx_ratio'</span>,
            <span class="hljs-string">'status_5xx_ratio'</span>, <span class="hljs-string">'unique_ips'</span>, <span class="hljs-string">'payload_size_avg'</span>,
            <span class="hljs-string">'user_agent_entropy'</span>, <span class="hljs-string">'path_depth_avg'</span>, <span class="hljs-string">'query_params_count'</span>
        ]
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_features_from_log</span>(<span class="hljs-params">self, log_data</span>):
        <span class="hljs-string">"""ä»Nginxæ—¥å¿—æå–ç‰¹å¾"""</span>
        df = pd.DataFrame(log_data)
        
        features = {}
        features[<span class="hljs-string">'request_rate'</span>] = <span class="hljs-built_in">len</span>(df) / <span class="hljs-number">60</span>  <span class="hljs-comment"># æ¯åˆ†é’Ÿè¯·æ±‚æ•°</span>
        features[<span class="hljs-string">'response_time'</span>] = df[<span class="hljs-string">'request_time'</span>].mean() <span class="hljs-keyword">if</span> <span class="hljs-string">'request_time'</span> <span class="hljs-keyword">in</span> df <span class="hljs-keyword">else</span> <span class="hljs-number">0.1</span>
        features[<span class="hljs-string">'status_4xx_ratio'</span>] = (df[<span class="hljs-string">'status'</span>] &gt;= <span class="hljs-number">400</span>).<span class="hljs-built_in">sum</span>() / <span class="hljs-built_in">len</span>(df) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(df) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        features[<span class="hljs-string">'status_5xx_ratio'</span>] = (df[<span class="hljs-string">'status'</span>] &gt;= <span class="hljs-number">500</span>).<span class="hljs-built_in">sum</span>() / <span class="hljs-built_in">len</span>(df) <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(df) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        features[<span class="hljs-string">'unique_ips'</span>] = df[<span class="hljs-string">'remote_addr'</span>].nunique()
        features[<span class="hljs-string">'payload_size_avg'</span>] = df[<span class="hljs-string">'body_bytes_sent'</span>].mean() <span class="hljs-keyword">if</span> <span class="hljs-string">'body_bytes_sent'</span> <span class="hljs-keyword">in</span> df <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        features[<span class="hljs-string">'user_agent_entropy'</span>] = self._calculate_entropy(df[<span class="hljs-string">'http_user_agent'</span>].dropna())
        features[<span class="hljs-string">'path_depth_avg'</span>] = df[<span class="hljs-string">'request_uri'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.count(<span class="hljs-string">'/'</span>) <span class="hljs-keyword">if</span> pd.notna(x) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>).mean()
        features[<span class="hljs-string">'query_params_count'</span>] = df[<span class="hljs-string">'request_uri'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.count(<span class="hljs-string">'?'</span>) + x.count(<span class="hljs-string">'&amp;'</span>) <span class="hljs-keyword">if</span> pd.notna(x) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>).mean()
        
        <span class="hljs-keyword">return</span> features
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_entropy</span>(<span class="hljs-params">self, series</span>):
        <span class="hljs-string">"""è®¡ç®—ä¿¡æ¯ç†µ"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(series) == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        
        value_counts = series.value_counts()
        probabilities = value_counts / <span class="hljs-built_in">len</span>(series)
        entropy = -np.<span class="hljs-built_in">sum</span>(probabilities * np.log2(probabilities + <span class="hljs-number">1e-10</span>))
        <span class="hljs-keyword">return</span> entropy
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train_model</span>(<span class="hljs-params">self, historical_data</span>):
        <span class="hljs-string">"""è®­ç»ƒå¼‚å¸¸æ£€æµ‹æ¨¡å‹"""</span>
        features_list = []
        <span class="hljs-keyword">for</span> log_entry <span class="hljs-keyword">in</span> historical_data:
            features = self.extract_features_from_log([log_entry])
            features_list.append([features[f] <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> self.features])
        
        X = np.array(features_list)
        X_scaled = self.scaler.fit_transform(X)
        self.model.fit(X_scaled)
        self.is_fitted = <span class="hljs-literal">True</span>
        
        logging.info(<span class="hljs-string">f"æ¨¡å‹è®­ç»ƒå®Œæˆï¼Œä½¿ç”¨<span class="hljs-subst">{<span class="hljs-built_in">len</span>(historical_data)}</span>æ¡å†å²æ•°æ®"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">predict_anomaly</span>(<span class="hljs-params">self, log_data</span>):
        <span class="hljs-string">"""é¢„æµ‹å¼‚å¸¸"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_fitted:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-number">0.0</span>
        
        features = self.extract_features_from_log([log_data])
        feature_vector = np.array([[features[f] <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> self.features]])
        feature_scaled = self.scaler.transform(feature_vector)
        
        anomaly_score = self.model.decision_function(feature_scaled)[<span class="hljs-number">0</span>]
        is_anomaly = self.model.predict(feature_scaled)[<span class="hljs-number">0</span>] == -<span class="hljs-number">1</span>
        
        <span class="hljs-keyword">return</span> is_anomaly, anomaly_score
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">real_time_monitoring</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å®æ—¶ç›‘æ§Nginxæ—¥å¿—"""</span>
        logging.info(<span class="hljs-string">"å¼€å§‹å®æ—¶ç›‘æ§Nginxæ—¥å¿—..."</span>)
        
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># ä»Redisè·å–æœ€æ–°æ—¥å¿—ï¼ˆæ¨¡æ‹Ÿå®æ—¶æ—¥å¿—æµï¼‰</span>
                log_entry = self.redis_client.lpop(<span class="hljs-string">'nginx:logs:realtime'</span>)
                <span class="hljs-keyword">if</span> log_entry:
                    log_data = json.loads(log_entry)
                    
                    is_anomaly, score = self.predict_anomaly(log_data)
                    
                    <span class="hljs-keyword">if</span> is_anomaly:
                        logging.warning(<span class="hljs-string">f"æ£€æµ‹åˆ°å¼‚å¸¸æµé‡ï¼å¼‚å¸¸è¯„åˆ†ï¼š<span class="hljs-subst">{score:<span class="hljs-number">.3</span>f}</span>"</span>)
                        
                        <span class="hljs-comment"># è§¦å‘è‡ªåŠ¨é˜»æ–­</span>
                        <span class="hljs-keyword">await</span> self.trigger_auto_block(log_data)
                        
                        <span class="hljs-comment"># å‘é€å‘Šè­¦</span>
                        <span class="hljs-keyword">await</span> self.send_alert(log_data, score)
                    
                    <span class="hljs-comment"># ç¼“å­˜æ­£å¸¸è¡Œä¸ºæ¨¡å¼</span>
                    <span class="hljs-keyword">await</span> self.cache_behavior_pattern(log_data)
                    
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logging.error(<span class="hljs-string">f"å®æ—¶ç›‘æ§å¼‚å¸¸ï¼š<span class="hljs-subst">{e}</span>"</span>)
            
            <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">trigger_auto_block</span>(<span class="hljs-params">self, log_data</span>):
        <span class="hljs-string">"""è‡ªåŠ¨é˜»æ–­å¼‚å¸¸IP"""</span>
        suspicious_ip = log_data.get(<span class="hljs-string">'remote_addr'</span>)
        <span class="hljs-keyword">if</span> suspicious_ip:
            <span class="hljs-comment"># æ·»åŠ åˆ°Redisé»‘åå•</span>
            self.redis_client.sadd(<span class="hljs-string">'nginx:blocklist:ips'</span>, suspicious_ip)
            self.redis_client.expire(<span class="hljs-string">f'nginx:blocklist:ips'</span>, <span class="hljs-number">3600</span>)  <span class="hljs-comment"># 1å°æ—¶è¿‡æœŸ</span>
            
            <span class="hljs-comment"># è®°å½•é˜»æ–­æ—¥å¿—</span>
            block_info = {
                <span class="hljs-string">'ip'</span>: suspicious_ip,
                <span class="hljs-string">'timestamp'</span>: datetime.now().isoformat(),
                <span class="hljs-string">'reason'</span>: <span class="hljs-string">'ml_anomaly_detection'</span>,
                <span class="hljs-string">'request_uri'</span>: log_data.get(<span class="hljs-string">'request_uri'</span>),
                <span class="hljs-string">'user_agent'</span>: log_data.get(<span class="hljs-string">'http_user_agent'</span>)
            }
            self.redis_client.lpush(<span class="hljs-string">'nginx:blocklist:history'</span>, json.dumps(block_info))
            
            logging.info(<span class="hljs-string">f"è‡ªåŠ¨é˜»æ–­IPï¼š<span class="hljs-subst">{suspicious_ip}</span>"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_alert</span>(<span class="hljs-params">self, log_data, anomaly_score</span>):
        <span class="hljs-string">"""å‘é€å®‰å…¨å‘Šè­¦"""</span>
        alert = {
            <span class="hljs-string">'type'</span>: <span class="hljs-string">'anomaly_detection'</span>,
            <span class="hljs-string">'severity'</span>: <span class="hljs-string">'high'</span> <span class="hljs-keyword">if</span> anomaly_score &lt; -<span class="hljs-number">0.5</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'medium'</span>,
            <span class="hljs-string">'timestamp'</span>: datetime.now().isoformat(),
            <span class="hljs-string">'source_ip'</span>: log_data.get(<span class="hljs-string">'remote_addr'</span>),
            <span class="hljs-string">'request_uri'</span>: log_data.get(<span class="hljs-string">'request_uri'</span>),
            <span class="hljs-string">'anomaly_score'</span>: anomaly_score,
            <span class="hljs-string">'details'</span>: log_data
        }
        
        <span class="hljs-comment"># å‘é€åˆ°å‘Šè­¦ç³»ç»Ÿï¼ˆWebhookã€é‚®ä»¶ã€çŸ­ä¿¡ç­‰ï¼‰</span>
        self.redis_client.publish(<span class="hljs-string">'security:alerts'</span>, json.dumps(alert))
        
        <span class="hljs-comment"># è®°å½•åˆ°æ•°æ®åº“</span>
        self.redis_client.lpush(<span class="hljs-string">'security:alerts:history'</span>, json.dumps(alert))
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">cache_behavior_pattern</span>(<span class="hljs-params">self, log_data</span>):
        <span class="hljs-string">"""ç¼“å­˜ç”¨æˆ·è¡Œä¸ºæ¨¡å¼"""</span>
        user_ip = log_data.get(<span class="hljs-string">'remote_addr'</span>)
        <span class="hljs-keyword">if</span> user_ip:
            <span class="hljs-comment"># æ„å»ºç”¨æˆ·è¡Œä¸ºæŒ‡çº¹</span>
            behavior_fingerprint = {
                <span class="hljs-string">'user_agent'</span>: log_data.get(<span class="hljs-string">'http_user_agent'</span>),
                <span class="hljs-string">'accept_language'</span>: log_data.get(<span class="hljs-string">'http_accept_language'</span>),
                <span class="hljs-string">'request_rate'</span>: <span class="hljs-keyword">await</span> self.get_user_request_rate(user_ip),
                <span class="hljs-string">'path_patterns'</span>: <span class="hljs-keyword">await</span> self.get_user_path_patterns(user_ip)
            }
            
            <span class="hljs-comment"># ç¼“å­˜24å°æ—¶</span>
            self.redis_client.setex(
                <span class="hljs-string">f'behavior:fingerprint:<span class="hljs-subst">{user_ip}</span>'</span>,
                <span class="hljs-number">86400</span>,
                json.dumps(behavior_fingerprint)
            )
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_request_rate</span>(<span class="hljs-params">self, user_ip</span>):
        <span class="hljs-string">"""è·å–ç”¨æˆ·è¯·æ±‚é¢‘ç‡"""</span>
        now = datetime.now()
        key = <span class="hljs-string">f'request_rate:<span class="hljs-subst">{user_ip}</span>:<span class="hljs-subst">{now.strftime(<span class="hljs-string">"%Y%m%d%H%M"</span>)}</span>'</span>
        <span class="hljs-keyword">return</span> self.redis_client.get(key) <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_path_patterns</span>(<span class="hljs-params">self, user_ip</span>):
        <span class="hljs-string">"""è·å–ç”¨æˆ·è®¿é—®è·¯å¾„æ¨¡å¼"""</span>
        <span class="hljs-comment"># ä»æœ€è¿‘100æ¡è®°å½•ä¸­åˆ†æè·¯å¾„æ¨¡å¼</span>
        key = <span class="hljs-string">f'user_paths:<span class="hljs-subst">{user_ip}</span>'</span>
        paths = self.redis_client.lrange(key, <span class="hljs-number">0</span>, <span class="hljs-number">99</span>)
        <span class="hljs-keyword">return</span> [p.decode(<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> paths] <span class="hljs-keyword">if</span> paths <span class="hljs-keyword">else</span> []

<span class="hljs-comment"># é›†æˆåˆ°Nginxé…ç½®</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    detector = NginxAnomalyDetector()
    
    <span class="hljs-comment"># åŠ è½½å†å²æ•°æ®è®­ç»ƒæ¨¡å‹</span>
    historical_logs = load_historical_logs()  <span class="hljs-comment"># ä»æ—¥å¿—æ–‡ä»¶æˆ–æ•°æ®åº“åŠ è½½</span>
    detector.train_model(historical_logs)
    
    <span class="hljs-comment"># å¯åŠ¨å®æ—¶ç›‘æ§</span>
    <span class="hljs-keyword">await</span> detector.real_time_monitoring()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<h4 data-id="heading-40">9.2 å®æ—¶å¨èƒæƒ…æŠ¥é›†æˆ</h4>
<p><strong>å¨èƒæƒ…æŠ¥æ•°æ®èšåˆç³»ç»Ÿï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># threat_intelligence_feed.py</span>

<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> aiohttp
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">import</span> logging

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreatIntelligenceAggregator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.redis_client = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">1</span>)
        self.feeds = [
            {
                <span class="hljs-string">'name'</span>: <span class="hljs-string">'AbuseIPDB'</span>,
                <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://api.abuseipdb.com/api/v2/blacklist'</span>,
                <span class="hljs-string">'headers'</span>: {<span class="hljs-string">'Key'</span>: <span class="hljs-string">'YOUR_API_KEY'</span>, <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>},
                <span class="hljs-string">'confidence_threshold'</span>: <span class="hljs-number">80</span>
            },
            {
                <span class="hljs-string">'name'</span>: <span class="hljs-string">'VirusTotal'</span>,
                <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://www.virustotal.com/vtapi/v2/ip-address/report'</span>,
                <span class="hljs-string">'api_key'</span>: <span class="hljs-string">'YOUR_VIRUSTOTAL_API_KEY'</span>,
                <span class="hljs-string">'params'</span>: {<span class="hljs-string">'apikey'</span>: <span class="hljs-string">'YOUR_VIRUSTOTAL_API_KEY'</span>}
            },
            {
                <span class="hljs-string">'name'</span>: <span class="hljs-string">'AlienVault_OTX'</span>,
                <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://otx.alienvault.com/api/v1/indicators/export'</span>,
                <span class="hljs-string">'headers'</span>: {<span class="hljs-string">'X-OTX-API-KEY'</span>: <span class="hljs-string">'YOUR_OTX_API_KEY'</span>}
            }
        ]
        
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_threat_feed</span>(<span class="hljs-params">self, session, feed</span>):
        <span class="hljs-string">"""è·å–å¨èƒæƒ…æŠ¥æ•°æ®"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(feed[<span class="hljs-string">'url'</span>], headers=feed.get(<span class="hljs-string">'headers'</span>, {}), params=feed.get(<span class="hljs-string">'params'</span>, {})) <span class="hljs-keyword">as</span> response:
                <span class="hljs-keyword">if</span> response.status == <span class="hljs-number">200</span>:
                    data = <span class="hljs-keyword">await</span> response.json()
                    <span class="hljs-keyword">return</span> {<span class="hljs-string">'feed_name'</span>: feed[<span class="hljs-string">'name'</span>], <span class="hljs-string">'data'</span>: data}
                <span class="hljs-keyword">else</span>:
                    logging.error(<span class="hljs-string">f"è·å–å¨èƒæƒ…æŠ¥å¤±è´¥ï¼š<span class="hljs-subst">{feed[<span class="hljs-string">'name'</span>]}</span> - <span class="hljs-subst">{response.status}</span>"</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logging.error(<span class="hljs-string">f"è·å–å¨èƒæƒ…æŠ¥å¼‚å¸¸ï¼š<span class="hljs-subst">{feed[<span class="hljs-string">'name'</span>]}</span> - <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">aggregate_threat_intelligence</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""èšåˆå¨èƒæƒ…æŠ¥æ•°æ®"""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:
            tasks = [self.fetch_threat_feed(session, feed) <span class="hljs-keyword">for</span> feed <span class="hljs-keyword">in</span> self.feeds]
            results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)
            
            aggregated_threats = {
                <span class="hljs-string">'malicious_ips'</span>: <span class="hljs-built_in">set</span>(),
                <span class="hljs-string">'suspicious_domains'</span>: <span class="hljs-built_in">set</span>(),
                <span class="hljs-string">'attack_signatures'</span>: <span class="hljs-built_in">set</span>(),
                <span class="hljs-string">'timestamp'</span>: datetime.now().isoformat()
            }
            
            <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:
                <span class="hljs-keyword">if</span> result:
                    <span class="hljs-keyword">await</span> self.process_feed_data(result, aggregated_threats)
            
            <span class="hljs-comment"># å­˜å‚¨åˆ°Redis</span>
            <span class="hljs-keyword">await</span> self.store_threat_intelligence(aggregated_threats)
            
            <span class="hljs-keyword">return</span> aggregated_threats
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_feed_data</span>(<span class="hljs-params">self, feed_result, aggregated_threats</span>):
        <span class="hljs-string">"""å¤„ç†å„ä¸ªå¨èƒæƒ…æŠ¥æºçš„æ•°æ®"""</span>
        feed_name = feed_result[<span class="hljs-string">'feed_name'</span>]
        data = feed_result[<span class="hljs-string">'data'</span>]
        
        <span class="hljs-keyword">if</span> feed_name == <span class="hljs-string">'AbuseIPDB'</span>:
            <span class="hljs-keyword">for</span> ip_data <span class="hljs-keyword">in</span> data.get(<span class="hljs-string">'data'</span>, []):
                <span class="hljs-keyword">if</span> ip_data.get(<span class="hljs-string">'confidence'</span>, <span class="hljs-number">0</span>) &gt;= <span class="hljs-number">80</span>:
                    aggregated_threats[<span class="hljs-string">'malicious_ips'</span>].add(ip_data[<span class="hljs-string">'ipAddress'</span>])
                    
        <span class="hljs-keyword">elif</span> feed_name == <span class="hljs-string">'VirusTotal'</span>:
            <span class="hljs-keyword">for</span> ip, report <span class="hljs-keyword">in</span> data.items():
                <span class="hljs-keyword">if</span> report.get(<span class="hljs-string">'response_code'</span>) == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> report.get(<span class="hljs-string">'positives'</span>, <span class="hljs-number">0</span>) &gt; <span class="hljs-number">5</span>:
                    aggregated_threats[<span class="hljs-string">'malicious_ips'</span>].add(ip)
                    
        <span class="hljs-keyword">elif</span> feed_name == <span class="hljs-string">'AlienVault_OTX'</span>:
            <span class="hljs-keyword">for</span> pulse <span class="hljs-keyword">in</span> data.get(<span class="hljs-string">'results'</span>, []):
                <span class="hljs-keyword">for</span> indicator <span class="hljs-keyword">in</span> pulse.get(<span class="hljs-string">'indicators'</span>, []):
                    <span class="hljs-keyword">if</span> indicator.get(<span class="hljs-string">'type'</span>) == <span class="hljs-string">'IP'</span>:
                        aggregated_threats[<span class="hljs-string">'malicious_ips'</span>].add(indicator.get(<span class="hljs-string">'indicator'</span>))
                    <span class="hljs-keyword">elif</span> indicator.get(<span class="hljs-string">'type'</span>) == <span class="hljs-string">'domain'</span>:
                        aggregated_threats[<span class="hljs-string">'suspicious_domains'</span>].add(indicator.get(<span class="hljs-string">'indicator'</span>))
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">store_threat_intelligence</span>(<span class="hljs-params">self, threats</span>):
        <span class="hljs-string">"""å­˜å‚¨å¨èƒæƒ…æŠ¥æ•°æ®"""</span>
        <span class="hljs-comment"># å­˜å‚¨æ¶æ„IP</span>
        <span class="hljs-keyword">if</span> threats[<span class="hljs-string">'malicious_ips'</span>]:
            self.redis_client.delete(<span class="hljs-string">'threats:malicious_ips'</span>)
            <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> threats[<span class="hljs-string">'malicious_ips'</span>]:
                self.redis_client.sadd(<span class="hljs-string">'threats:malicious_ips'</span>, ip)
            self.redis_client.expire(<span class="hljs-string">'threats:malicious_ips'</span>, <span class="hljs-number">3600</span>)  <span class="hljs-comment"># 1å°æ—¶è¿‡æœŸ</span>
        
        <span class="hljs-comment"># å­˜å‚¨å¯ç–‘åŸŸå</span>
        <span class="hljs-keyword">if</span> threats[<span class="hljs-string">'suspicious_domains'</span>]:
            self.redis_client.delete(<span class="hljs-string">'threats:suspicious_domains'</span>)
            <span class="hljs-keyword">for</span> domain <span class="hljs-keyword">in</span> threats[<span class="hljs-string">'suspicious_domains'</span>]:
                self.redis_client.sadd(<span class="hljs-string">'threats:suspicious_domains'</span>, domain)
            self.redis_client.expire(<span class="hljs-string">'threats:suspicious_domains'</span>, <span class="hljs-number">3600</span>)
        
        <span class="hljs-comment"># è®°å½•æ›´æ–°æ—¶é—´</span>
        self.redis_client.<span class="hljs-built_in">set</span>(<span class="hljs-string">'threats:last_update'</span>, threats[<span class="hljs-string">'timestamp'</span>])
        
        logging.info(<span class="hljs-string">f"å¨èƒæƒ…æŠ¥æ›´æ–°å®Œæˆï¼š<span class="hljs-subst">{<span class="hljs-built_in">len</span>(threats[<span class="hljs-string">'malicious_ips'</span>])}</span>ä¸ªæ¶æ„IPï¼Œ<span class="hljs-subst">{<span class="hljs-built_in">len</span>(threats[<span class="hljs-string">'suspicious_domains'</span>])}</span>ä¸ªå¯ç–‘åŸŸå"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_ip_reputation</span>(<span class="hljs-params">self, ip_address</span>):
        <span class="hljs-string">"""æ£€æŸ¥IPä¿¡èª‰"""</span>
        malicious_ips = self.redis_client.smembers(<span class="hljs-string">'threats:malicious_ips'</span>)
        malicious_ips = [ip.decode(<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> malicious_ips]
        
        <span class="hljs-keyword">if</span> ip_address <span class="hljs-keyword">in</span> malicious_ips:
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'is_threat'</span>: <span class="hljs-literal">True</span>,
                <span class="hljs-string">'threat_level'</span>: <span class="hljs-string">'high'</span>,
                <span class="hljs-string">'source'</span>: <span class="hljs-string">'threat_intelligence_feeds'</span>,
                <span class="hljs-string">'recommendation'</span>: <span class="hljs-string">'block_immediately'</span>
            }
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'is_threat'</span>: <span class="hljs-literal">False</span>,
            <span class="hljs-string">'threat_level'</span>: <span class="hljs-string">'low'</span>,
            <span class="hljs-string">'source'</span>: <span class="hljs-string">'clean'</span>,
            <span class="hljs-string">'recommendation'</span>: <span class="hljs-string">'allow'</span>
        }
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_continuous_updates</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æŒç»­æ›´æ–°å¨èƒæƒ…æŠ¥"""</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                logging.info(<span class="hljs-string">"å¼€å§‹æ›´æ–°å¨èƒæƒ…æŠ¥æ•°æ®..."</span>)
                <span class="hljs-keyword">await</span> self.aggregate_threat_intelligence()
                logging.info(<span class="hljs-string">"å¨èƒæƒ…æŠ¥æ•°æ®æ›´æ–°å®Œæˆ"</span>)
                
                <span class="hljs-comment"># æ¯30åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡</span>
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1800</span>)
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logging.error(<span class="hljs-string">f"å¨èƒæƒ…æŠ¥æ›´æ–°å¼‚å¸¸ï¼š<span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">300</span>)  <span class="hljs-comment"># 5åˆ†é’Ÿåé‡è¯•</span>

<span class="hljs-comment"># Nginxé…ç½®é›†æˆå¨èƒæƒ…æŠ¥</span>
location / {
    <span class="hljs-comment"># åœ¨accessé˜¶æ®µæ£€æŸ¥IPå¨èƒæƒ…æŠ¥</span>
    access_by_lua_block {
        local redis = require <span class="hljs-string">"resty.redis"</span>
        local red = redis:new()
        red:set_timeout(<span class="hljs-number">1000</span>) -- <span class="hljs-number">1</span>ç§’è¶…æ—¶
        
        local ok, err = red:connect(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">6379</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok then
            ngx.log(ngx.ERR, <span class="hljs-string">"Redisè¿æ¥å¤±è´¥: "</span>, err)
            <span class="hljs-keyword">return</span>
        end
        
        local client_ip = ngx.var.remote_addr
        local is_threat = red:sismember(<span class="hljs-string">"threats:malicious_ips"</span>, client_ip)
        
        <span class="hljs-keyword">if</span> is_threat == <span class="hljs-number">1</span> then
            ngx.log(ngx.WARN, <span class="hljs-string">"æ£€æµ‹åˆ°æ¶æ„IP: "</span>, client_ip)
            ngx.exit(<span class="hljs-number">403</span>)
        end
    }
    
    <span class="hljs-comment"># å…¶ä»–é…ç½®...</span>
}
</code></pre>
<h3 data-id="heading-41">ğŸ¢ ç¬¬åéƒ¨åˆ†ï¼šç°ä»£ä¼ä¸šçº§é›†æˆæ–¹æ¡ˆ</h3>
<h4 data-id="heading-42">10.1 DevSecOpsæµæ°´çº¿é›†æˆ</h4>
<p><strong>GitLab CI/CDå®‰å…¨æµæ°´çº¿ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .gitlab-ci.yml</span>
<span class="hljs-attr">stages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">security-scan</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">build</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">security-test</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">deploy</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">security-monitor</span>

<span class="hljs-attr">variables:</span>
  <span class="hljs-attr">DOCKER_DRIVER:</span> <span class="hljs-string">overlay2</span>
  <span class="hljs-attr">DOCKER_TLS_CERTDIR:</span> <span class="hljs-string">"/certs"</span>
  <span class="hljs-attr">REGISTRY:</span> <span class="hljs-string">registry.example.com</span>
  <span class="hljs-attr">IMAGE_NAME:</span> <span class="hljs-string">$REGISTRY/nginx-security-gateway</span>

<span class="hljs-comment"># å®‰å…¨æ‰«æé˜¶æ®µ</span>
<span class="hljs-attr">security:nginx-config:</span>
  <span class="hljs-attr">stage:</span> <span class="hljs-string">security-scan</span>
  <span class="hljs-attr">image:</span> 
    <span class="hljs-attr">name:</span> <span class="hljs-string">nginx:alpine</span>
    <span class="hljs-attr">entrypoint:</span> [<span class="hljs-string">""</span>]
  <span class="hljs-attr">script:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">apk</span> <span class="hljs-string">add</span> <span class="hljs-string">--no-cache</span> <span class="hljs-string">python3</span> <span class="hljs-string">py3-pip</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">pip3</span> <span class="hljs-string">install</span> <span class="hljs-string">pyyaml</span> <span class="hljs-string">jsonschema</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">|
      python3 -c "
      import yaml
      import json
      import sys
</span>      
      <span class="hljs-comment"># éªŒè¯Nginxé…ç½®æ–‡ä»¶è¯­æ³•</span>
      <span class="hljs-string">import</span> <span class="hljs-string">subprocess</span>
      <span class="hljs-string">result</span> <span class="hljs-string">=</span> <span class="hljs-string">subprocess.run(['nginx',</span> <span class="hljs-string">'-t'</span><span class="hljs-string">,</span> <span class="hljs-string">'-c'</span><span class="hljs-string">,</span> <span class="hljs-string">'/etc/nginx/nginx.conf'</span><span class="hljs-string">],</span> 
                            <span class="hljs-string">capture_output=True,</span> <span class="hljs-string">text=True)</span>
      <span class="hljs-string">if</span> <span class="hljs-string">result.returncode</span> <span class="hljs-type">!=</span> <span class="hljs-attr">0:</span>
          <span class="hljs-string">print('Nginxé…ç½®è¯­æ³•é”™è¯¯:',</span> <span class="hljs-string">result.stderr)</span>
          <span class="hljs-string">sys.exit(1)</span>
      
      <span class="hljs-comment"># å®‰å…¨åŸºçº¿æ£€æŸ¥</span>
      <span class="hljs-string">with</span> <span class="hljs-string">open('/etc/nginx/nginx.conf',</span> <span class="hljs-string">'r'</span><span class="hljs-string">)</span> <span class="hljs-attr">as f:</span>
          <span class="hljs-string">config</span> <span class="hljs-string">=</span> <span class="hljs-string">f.read()</span>
      
      <span class="hljs-string">security_checks</span> <span class="hljs-string">=</span> [
          <span class="hljs-string">('server_tokens</span> <span class="hljs-string">off'</span>, <span class="hljs-string">'ç‰ˆæœ¬å·éšè—'</span><span class="hljs-string">)</span>,
          <span class="hljs-string">('add_header</span> <span class="hljs-string">X-Frame-Options'</span>, <span class="hljs-string">'ç‚¹å‡»åŠ«æŒé˜²æŠ¤'</span><span class="hljs-string">)</span>,
          <span class="hljs-string">('add_header</span> <span class="hljs-string">X-Content-Type-Options'</span>, <span class="hljs-string">'MIMEå—…æ¢é˜²æŠ¤'</span><span class="hljs-string">)</span>,
          <span class="hljs-string">('location</span> <span class="hljs-string">~</span> <span class="hljs-string">/\\.'</span>, <span class="hljs-string">'éšè—æ–‡ä»¶ä¿æŠ¤'</span><span class="hljs-string">)</span>,
          <span class="hljs-string">('location</span> <span class="hljs-string">~*</span> <span class="hljs-string">\\\.(git|env)'</span>, <span class="hljs-string">'æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤'</span><span class="hljs-string">)</span>
      ]
      
      <span class="hljs-string">missing_security</span> <span class="hljs-string">=</span> []
      <span class="hljs-string">for</span> <span class="hljs-string">check,</span> <span class="hljs-attr">description in security_checks:</span>
          <span class="hljs-attr">if check not in config:</span>
              <span class="hljs-string">missing_security.append(description)</span>
      
      <span class="hljs-attr">if missing_security:</span>
          <span class="hljs-string">print('ç¼ºå¤±çš„å®‰å…¨é…ç½®:',</span> <span class="hljs-string">missing_security)</span>
          <span class="hljs-string">sys.exit(1)</span>
      
      <span class="hljs-string">print('âœ…</span> <span class="hljs-string">å®‰å…¨é…ç½®æ£€æŸ¥é€šè¿‡')</span>
      <span class="hljs-string">"
  artifacts:
    reports:
      junit: security-report.xml
    expire_in: 1 week
  only:
    - branches
    - merge_requests

# å®¹å™¨é•œåƒå®‰å…¨æ‰«æ
security:container-scan:
  stage: security-scan
  image: aquasec/trivy:latest
  script:
    - trivy image --exit-code 1 --severity HIGH,CRITICAL $IMAGE_NAME:latest || true
    - trivy image --format json --output trivy-report.json $IMAGE_NAME:latest
  artifacts:
    reports:
      container_scanning: trivy-report.json
    expire_in: 1 week
  allow_failure: true

# æ„å»ºé˜¶æ®µ
build:docker:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker build -t $IMAGE_NAME:$CI_COMMIT_SHA .
    - docker tag $IMAGE_NAME:$CI_COMMIT_SHA $IMAGE_NAME:latest
    - docker push $IMAGE_NAME:$CI_COMMIT_SHA
    - docker push $IMAGE_NAME:latest
  dependencies:
    - security:nginx-config

# å®‰å…¨æµ‹è¯•é˜¶æ®µ
security:penetration-test:
  stage: security-test
  image: owasp/zap2docker-stable:latest
  script:
    - mkdir -p zap-reports
    - zap-baseline.py -t http://nginx-security-gateway-staging.example.com \\
        -r zap-report.html \\
        -J zap-report.json \\
        -w zap-report.md \\
        -x zap-report.xml
  artifacts:
    reports:
      junit: zap-report.xml
    paths:
      - zap-reports/
    expire_in: 1 week
  allow_failure: true

# éƒ¨ç½²é˜¶æ®µ
deploy:staging:
  stage: deploy
  image: alpine:latest
  script:
    - apk add --no-cache curl
    - |
      # éƒ¨ç½²åˆ°stagingç¯å¢ƒ
      curl -X POST \\
        -H "</span><span class="hljs-attr">Content-Type:</span> <span class="hljs-string">application/json"</span> <span class="hljs-string">\\</span>
        <span class="hljs-string">-H</span> <span class="hljs-string">"Authorization: Bearer $STAGING_API_TOKEN"</span> <span class="hljs-string">\\</span>
        <span class="hljs-string">-d</span> <span class="hljs-string">"{\\"</span><span class="hljs-string">image\\":</span> <span class="hljs-string">\\"$IMAGE_NAME:$CI_COMMIT_SHA\\",</span> <span class="hljs-string">\\"environment\\":</span> <span class="hljs-string">\\"staging\\"}"</span> <span class="hljs-string">\\</span>
        <span class="hljs-string">https://api.staging.example.com/deploy</span>
      
      <span class="hljs-comment"># ç­‰å¾…éƒ¨ç½²å®Œæˆ</span>
      <span class="hljs-string">sleep</span> <span class="hljs-number">30</span>
      
      <span class="hljs-comment"># éªŒè¯éƒ¨ç½²</span>
      <span class="hljs-string">curl</span> <span class="hljs-string">-f</span> <span class="hljs-string">http://nginx-security-gateway-staging.example.com/health</span> <span class="hljs-string">||</span> <span class="hljs-string">exit</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">environment:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">staging</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">http://nginx-security-gateway-staging.example.com</span>
  <span class="hljs-attr">dependencies:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">build:docker</span>

<span class="hljs-attr">deploy:production:</span>
  <span class="hljs-attr">stage:</span> <span class="hljs-string">deploy</span>
  <span class="hljs-attr">image:</span> <span class="hljs-string">alpine:latest</span>
  <span class="hljs-attr">script:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">apk</span> <span class="hljs-string">add</span> <span class="hljs-string">--no-cache</span> <span class="hljs-string">curl</span> <span class="hljs-string">jq</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">|
      # è·å–stagingç¯å¢ƒæµ‹è¯•ç»“æœ
      STAGING_TESTS=$(curl -s https://api.staging.example.com/tests/$CI_COMMIT_SHA)
      SECURITY_SCORE=$(echo $STAGING_TESTS | jq -r '.security_score')
</span>      
      <span class="hljs-string">if</span> [ <span class="hljs-string">"$SECURITY_SCORE"</span> <span class="hljs-string">-lt</span> <span class="hljs-number">90</span> ]<span class="hljs-string">;</span> <span class="hljs-string">then</span>
        <span class="hljs-string">echo</span> <span class="hljs-string">"å®‰å…¨è¯„åˆ†ä¸è¶³: $SECURITY_SCORE/100"</span>
        <span class="hljs-string">exit</span> <span class="hljs-number">1</span>
      <span class="hljs-string">fi</span>
      
      <span class="hljs-comment"># éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</span>
      <span class="hljs-string">curl</span> <span class="hljs-string">-X</span> <span class="hljs-string">POST</span> <span class="hljs-string">\\</span>
        <span class="hljs-string">-H</span> <span class="hljs-string">"Content-Type: application/json"</span> <span class="hljs-string">\\</span>
        <span class="hljs-string">-H</span> <span class="hljs-string">"Authorization: Bearer $PRODUCTION_API_TOKEN"</span> <span class="hljs-string">\\</span>
        <span class="hljs-string">-d</span> <span class="hljs-string">"{\\"</span><span class="hljs-string">image\\":</span> <span class="hljs-string">\\"$IMAGE_NAME:$CI_COMMIT_SHA\\",</span> <span class="hljs-string">\\"environment\\":</span> <span class="hljs-string">\\"production\\"}"</span> <span class="hljs-string">\\</span>
        <span class="hljs-string">https://api.production.example.com/deploy</span>
      
      <span class="hljs-comment"># éªŒè¯éƒ¨ç½²</span>
      <span class="hljs-string">sleep</span> <span class="hljs-number">60</span>
      <span class="hljs-string">curl</span> <span class="hljs-string">-f</span> <span class="hljs-string">https://nginx-security-gateway.example.com/health</span> <span class="hljs-string">||</span> <span class="hljs-string">exit</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">environment:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">production</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">https://nginx-security-gateway.example.com</span>
  <span class="hljs-attr">when:</span> <span class="hljs-string">manual</span>
  <span class="hljs-attr">only:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">master</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">tags</span>

<span class="hljs-comment"># å®‰å…¨ç›‘æ§é˜¶æ®µ</span>
<span class="hljs-attr">monitor:security-metrics:</span>
  <span class="hljs-attr">stage:</span> <span class="hljs-string">security-monitor</span>
  <span class="hljs-attr">image:</span> <span class="hljs-string">python:3.11-alpine</span>
  <span class="hljs-attr">script:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">pip</span> <span class="hljs-string">install</span> <span class="hljs-string">requests</span> <span class="hljs-string">prometheus-client</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">|
      python3 -c "
      import requests
      import json
      from prometheus_client import CollectorRegistry, Gauge, push_to_gateway
</span>      
      <span class="hljs-comment"># è·å–å®‰å…¨æŒ‡æ ‡</span>
      <span class="hljs-string">response</span> <span class="hljs-string">=</span> <span class="hljs-string">requests.get('https://nginx-security-gateway.example.com/metrics')</span>
      <span class="hljs-string">metrics</span> <span class="hljs-string">=</span> <span class="hljs-string">response.text</span>
      
      <span class="hljs-comment"># è§£æå…³é”®å®‰å…¨æŒ‡æ ‡</span>
      <span class="hljs-string">registry</span> <span class="hljs-string">=</span> <span class="hljs-string">CollectorRegistry()</span>
      <span class="hljs-string">blocked_requests</span> <span class="hljs-string">=</span> <span class="hljs-string">Gauge('nginx_blocked_requests_total',</span> <span class="hljs-string">'Total blocked requests'</span><span class="hljs-string">,</span> <span class="hljs-string">registry=registry)</span>
      <span class="hljs-string">anomaly_detections</span> <span class="hljs-string">=</span> <span class="hljs-string">Gauge('nginx_anomaly_detections_total',</span> <span class="hljs-string">'Total anomaly detections'</span><span class="hljs-string">,</span> <span class="hljs-string">registry=registry)</span>
      <span class="hljs-string">threat_intel_hits</span> <span class="hljs-string">=</span> <span class="hljs-string">Gauge('nginx_threat_intel_hits_total',</span> <span class="hljs-string">'Total threat intelligence hits'</span><span class="hljs-string">,</span> <span class="hljs-string">registry=registry)</span>
      
      <span class="hljs-comment"># æ¨é€æŒ‡æ ‡åˆ°Prometheus</span>
      <span class="hljs-string">push_to_gateway('prometheus.example.com:9091',</span> <span class="hljs-string">job='nginx-security-gateway',</span> <span class="hljs-string">registry=registry)</span>
      
      <span class="hljs-string">print('âœ…</span> <span class="hljs-string">å®‰å…¨æŒ‡æ ‡å·²æ¨é€åˆ°ç›‘æ§ç³»ç»Ÿ')</span>
      <span class="hljs-string">"
  dependencies:
    - deploy:production
  allow_failure: true
</span></code></pre>
<h4 data-id="heading-43">10.2 SIEM/SOARå¹³å°é›†æˆ</h4>
<p><strong>Splunké›†æˆé…ç½®ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># splunk-integration.sh</span>

<span class="hljs-comment"># Nginxå®‰å…¨æ—¥å¿—è½¬å‘åˆ°Splunk</span>
NGINX_LOG_DIR=<span class="hljs-string">"/var/log/nginx"</span>
SPLUNK_HEC_URL=<span class="hljs-string">"https://splunk.example.com:8088/services/collector"</span>
SPLUNK_HEC_TOKEN=<span class="hljs-string">"your-hec-token-here"</span>

<span class="hljs-comment"># åˆ›å»ºæ—¥å¿—è½¬å‘è„šæœ¬</span>
<span class="hljs-built_in">cat</span> &gt; /usr/local/bin/nginx-splunk-forwarder.py &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/usr/bin/env python3</span>
import json
import time
import requests
import gzip
from datetime import datetime
import logging

class NginxSplunkForwarder:
    def __init__(self, splunk_url, splunk_token):
        self.splunk_url = splunk_url
        self.splunk_token = splunk_token
        self.headers = {
            <span class="hljs-string">'Authorization'</span>: f<span class="hljs-string">'Splunk {splunk_token}'</span>,
            <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
        }
        
    def parse_nginx_log(self, log_line):
        <span class="hljs-string">""</span><span class="hljs-string">"è§£æNginxæ—¥å¿—"</span><span class="hljs-string">""</span>
        try:
            <span class="hljs-comment"># å‡è®¾ä½¿ç”¨JSONæ ¼å¼çš„Nginxæ—¥å¿—</span>
            log_data = json.loads(log_line)
            
            <span class="hljs-comment"># æ·»åŠ å®‰å…¨ç›¸å…³å­—æ®µ</span>
            log_data[<span class="hljs-string">'event_type'</span>] = <span class="hljs-string">'nginx_access'</span>
            log_data[<span class="hljs-string">'security_relevant'</span>] = self.is_security_relevant(log_data)
            log_data[<span class="hljs-string">'threat_level'</span>] = self.calculate_threat_level(log_data)
            
            <span class="hljs-built_in">return</span> log_data
        except json.JSONDecodeError:
            <span class="hljs-built_in">return</span> None
    
    def is_security_relevant(self, log_data):
        <span class="hljs-string">""</span><span class="hljs-string">"åˆ¤æ–­æ˜¯å¦ä¸ºå®‰å…¨ç›¸å…³äº‹ä»¶"</span><span class="hljs-string">""</span>
        security_indicators = [
            log_data.get(<span class="hljs-string">'status'</span>, 0) &gt;= 400,  <span class="hljs-comment"># é”™è¯¯çŠ¶æ€ç </span>
            <span class="hljs-string">'bot'</span> <span class="hljs-keyword">in</span> log_data.get(<span class="hljs-string">'http_user_agent'</span>, <span class="hljs-string">''</span>).lower(),
            <span class="hljs-string">'scan'</span> <span class="hljs-keyword">in</span> log_data.get(<span class="hljs-string">'http_user_agent'</span>, <span class="hljs-string">''</span>).lower(),
            log_data.get(<span class="hljs-string">'request_uri'</span>, <span class="hljs-string">''</span>).count(<span class="hljs-string">'../'</span>) &gt; 0,  <span class="hljs-comment"># è·¯å¾„éå†</span>
            <span class="hljs-string">'.git'</span> <span class="hljs-keyword">in</span> log_data.get(<span class="hljs-string">'request_uri'</span>, <span class="hljs-string">''</span>),  <span class="hljs-comment"># Gitç›®å½•è®¿é—®</span>
            <span class="hljs-string">'.env'</span> <span class="hljs-keyword">in</span> log_data.get(<span class="hljs-string">'request_uri'</span>, <span class="hljs-string">''</span>),  <span class="hljs-comment"># ç¯å¢ƒæ–‡ä»¶è®¿é—®</span>
            len(log_data.get(<span class="hljs-string">'request_uri'</span>, <span class="hljs-string">''</span>)) &gt; 1000,  <span class="hljs-comment"># è¶…é•¿URI</span>
            log_data.get(<span class="hljs-string">'body_bytes_sent'</span>, 0) == 0 and log_data.get(<span class="hljs-string">'status'</span>) == 200  <span class="hljs-comment"># ç©ºå“åº”</span>
        ]
        
        <span class="hljs-built_in">return</span> any(security_indicators)
    
    def calculate_threat_level(self, log_data):
        <span class="hljs-string">""</span><span class="hljs-string">"è®¡ç®—å¨èƒç­‰çº§"</span><span class="hljs-string">""</span>
        threat_score = 0
        
        <span class="hljs-comment"># çŠ¶æ€ç è¯„åˆ†</span>
        status = log_data.get(<span class="hljs-string">'status'</span>, 0)
        <span class="hljs-keyword">if</span> status &gt;= 500:
            threat_score += 10
        <span class="hljs-keyword">elif</span> status &gt;= 400:
            threat_score += 5
        
        <span class="hljs-comment"># URIå¼‚å¸¸è¯„åˆ†</span>
        uri = log_data.get(<span class="hljs-string">'request_uri'</span>, <span class="hljs-string">''</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">'../'</span> <span class="hljs-keyword">in</span> uri:
            threat_score += 15
        <span class="hljs-keyword">if</span> <span class="hljs-string">'.git'</span> <span class="hljs-keyword">in</span> uri or <span class="hljs-string">'.env'</span> <span class="hljs-keyword">in</span> uri:
            threat_score += 20
        <span class="hljs-keyword">if</span> len(uri) &gt; 1000:
            threat_score += 5
        
        <span class="hljs-comment"># User-Agentå¼‚å¸¸è¯„åˆ†</span>
        user_agent = log_data.get(<span class="hljs-string">'http_user_agent'</span>, <span class="hljs-string">''</span>)
        suspicious_patterns = [<span class="hljs-string">'bot'</span>, <span class="hljs-string">'scan'</span>, <span class="hljs-string">'nmap'</span>, <span class="hljs-string">'nikto'</span>, <span class="hljs-string">'sqlmap'</span>, <span class="hljs-string">'hydra'</span>]
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> suspicious_patterns:
            <span class="hljs-keyword">if</span> pattern <span class="hljs-keyword">in</span> user_agent.lower():
                threat_score += 10
                <span class="hljs-built_in">break</span>
        
        <span class="hljs-comment"># å“åº”æ—¶é—´å¼‚å¸¸è¯„åˆ†</span>
        request_time = <span class="hljs-built_in">float</span>(log_data.get(<span class="hljs-string">'request_time'</span>, 0))
        <span class="hljs-keyword">if</span> request_time &gt; 5.0:
            threat_score += 5
        
        <span class="hljs-comment"># å¨èƒç­‰çº§æ˜ å°„</span>
        <span class="hljs-keyword">if</span> threat_score &gt;= 30:
            <span class="hljs-built_in">return</span> <span class="hljs-string">'critical'</span>
        <span class="hljs-keyword">elif</span> threat_score &gt;= 20:
            <span class="hljs-built_in">return</span> <span class="hljs-string">'high'</span>
        <span class="hljs-keyword">elif</span> threat_score &gt;= 10:
            <span class="hljs-built_in">return</span> <span class="hljs-string">'medium'</span>
        <span class="hljs-keyword">elif</span> threat_score &gt;= 5:
            <span class="hljs-built_in">return</span> <span class="hljs-string">'low'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">return</span> <span class="hljs-string">'info'</span>
    
    def send_to_splunk(self, event_data):
        <span class="hljs-string">""</span><span class="hljs-string">"å‘é€äº‹ä»¶åˆ°Splunk"</span><span class="hljs-string">""</span>
        payload = {
            <span class="hljs-string">'event'</span>: event_data,
            <span class="hljs-string">'sourcetype'</span>: <span class="hljs-string">'nginx:security'</span>,
            <span class="hljs-string">'index'</span>: <span class="hljs-string">'security'</span>,
            <span class="hljs-string">'host'</span>: <span class="hljs-string">'nginx-security-gateway'</span>
        }
        
        try:
            response = requests.post(
                self.splunk_url,
                headers=self.headers,
                json=payload,
                <span class="hljs-built_in">timeout</span>=10
            )
            
            <span class="hljs-keyword">if</span> response.status_code != 200:
                logging.error(f<span class="hljs-string">"Splunk HECé”™è¯¯: {response.status_code} - {response.text}"</span>)
                <span class="hljs-built_in">return</span> False
            
            <span class="hljs-built_in">return</span> True
        except requests.exceptions.RequestException as e:
            logging.error(f<span class="hljs-string">"å‘é€äº‹ä»¶åˆ°Splunkå¤±è´¥: {e}"</span>)
            <span class="hljs-built_in">return</span> False
    
    def monitor_log_file(self, log_file_path):
        <span class="hljs-string">""</span><span class="hljs-string">"ç›‘æ§æ—¥å¿—æ–‡ä»¶"</span><span class="hljs-string">""</span>
        with open(log_file_path, <span class="hljs-string">'r'</span>) as f:
            <span class="hljs-comment"># ç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾</span>
            f.seek(0, 2)
            
            <span class="hljs-keyword">while</span> True:
                line = f.readline()
                <span class="hljs-keyword">if</span> not line:
                    time.sleep(0.1)
                    <span class="hljs-built_in">continue</span>
                
                <span class="hljs-comment"># è§£ææ—¥å¿—</span>
                parsed_data = self.parse_nginx_log(line.strip())
                <span class="hljs-keyword">if</span> parsed_data:
                    <span class="hljs-comment"># å‘é€åˆ°Splunk</span>
                    <span class="hljs-keyword">if</span> parsed_data[<span class="hljs-string">'security_relevant'</span>] or parsed_data[<span class="hljs-string">'threat_level'</span>] != <span class="hljs-string">'info'</span>:
                        success = self.send_to_splunk(parsed_data)
                        <span class="hljs-keyword">if</span> success:
                            logging.info(f<span class="hljs-string">"å®‰å…¨äº‹ä»¶å·²å‘é€åˆ°Splunk: {parsed_data.get('remote_addr')} - {parsed_data.get('threat_level')}"</span>)

<span class="hljs-comment"># å¯åŠ¨æ—¥å¿—ç›‘æ§</span>
forwarder = NginxSplunkForwarder(SPLUNK_HEC_URL, SPLUNK_HEC_TOKEN)
forwarder.monitor_log_file(<span class="hljs-string">"/var/log/nginx/security-access.log"</span>)
EOF

<span class="hljs-built_in">chmod</span> +x /usr/local/bin/nginx-splunk-forwarder.py
</code></pre>
<p><strong>Elasticsearchå®‰å…¨åˆ†æï¼š</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mappings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"date"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"event_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"remote_addr"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ip"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"request_uri"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"analyzer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"standard"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"http_user_agent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"analyzer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"standard"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"integer"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"body_bytes_sent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"long"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"request_time"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"float"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"security_relevant"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"boolean"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"threat_level"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"geoip"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"country_iso_code"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"location"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"geo_point"</span><span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"attack_classification"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"attack_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"confidence"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"float"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"severity"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"settings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"number_of_shards"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"number_of_replicas"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"lifecycle"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nginx-security-policy"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"rollover_alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nginx-security"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-44">10.3 å¤šäº‘ç¯å¢ƒç»Ÿä¸€å®‰å…¨ç­–ç•¥</h4>
<p><strong>Terraformå¤šäº‘å®‰å…¨é…ç½®ï¼š</strong></p>
<pre><code class="hljs language-hcl" lang="hcl"># terraform/main.tf
terraform {
  required_version = "&gt;= 1.0"
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~&gt; 5.0"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~&gt; 3.0"
    }
    google = {
      source  = "hashicorp/google"
      version = "~&gt; 4.0"
    }
  }
}

# AWS WAFé…ç½®
module "aws_waf" {
  source = "./modules/aws-waf"
  
  name_prefix = "nginx-security"
  
  # åŸºç¡€è§„åˆ™
  managed_rules = [
    {
      name     = "AWSManagedRulesCommonRuleSet"
      priority = 1
      override_action = "none"
      excluded_rules = []
    },
    {
      name     = "AWSManagedRulesKnownBadInputsRuleSet"
      priority = 2
      override_action = "none"
      excluded_rules = []
    },
    {
      name     = "AWSManagedRulesSQLiRuleSet"
      priority = 3
      override_action = "none"
      excluded_rules = []
    },
    {
      name     = "AWSManagedRulesLinuxRuleSet"
      priority = 4
      override_action = "none"
      excluded_rules = []
    }
  ]
  
  # è‡ªå®šä¹‰è§„åˆ™
  custom_rules = [
    {
      name     = "block_malicious_ips"
      priority = 5
      action   = "block"
      
      statement = {
        ip_set_reference_statement = {
          arn = aws_wafv2_ip_set.malicious_ips.arn
        }
      }
    },
    {
      name     = "rate_limit_per_ip"
      priority = 6
      action   = "block"
      
      statement = {
        rate_based_statement = {
          limit              = 2000
          aggregate_key_type = "IP"
          evaluation_window_sec = 300
        }
      }
    }
  ]
  
  tags = {
    Environment = var.environment
    Purpose     = "nginx-security-gateway"
    ManagedBy   = "terraform"
  }
}

# Azure Application Gateway WAF
module "azure_waf" {
  source = "./modules/azure-waf"
  
  name                = "nginx-security-waf"
  resource_group_name = azurerm_resource_group.main.name
  location           = azurerm_resource_group.main.location
  
  # WAFç­–ç•¥
  waf_policy_settings = {
    enabled = true
    mode    = "Prevention"
    
    managed_rules = {
      owasp_3_2 = {
        enabled = true
        
        rule_overrides = [
          {
            rule_id = "942100"
            enabled = true
            action  = "Block"
          },
          {
            rule_id = "942110"
            enabled = true
            action  = "Block"
          }
        ]
      }
    }
    
    custom_rules = [
      {
        name     = "block_malicious_ips"
        priority = 1
        rule_type = "MatchRule"
        action   = "Block"
        
        match_conditions = [
          {
            match_variables = [
              {
                variable_name = "RemoteAddr"
              }
            ]
            operator = "IPMatch"
            match_values = var.malicious_ip_ranges
          }
        ]
      }
    ]
  }
  
  tags = {
    Environment = var.environment
    Purpose     = "nginx-security-gateway"
    ManagedBy   = "terraform"
  }
}

# Google Cloud Armor
module "gcp_cloud_armor" {
  source = "./modules/gcp-cloud-armor"
  
  project = var.gcp_project_id
  name    = "nginx-security-policy"
  
  # å®‰å…¨è§„åˆ™
  security_rules = [
    {
      action   = "deny(403)"
      priority = 100
      
      match = {
        versioned_expr = "SRC_IPS_V1"
        config = {
          src_ip_ranges = var.malicious_ip_ranges
        }
      }
      
      description = "Block known malicious IPs"
    },
    {
      action   = "rate_based_ban"
      priority = 200
      
      match = {
        versioned_expr = "SRC_IPS_V1"
        config = {
          src_ip_ranges = ["*"]
        }
      }
      
      rate_limit_options = {
        conform_action = "allow"
        exceed_action = "deny(429)"
        enforce_on_key = "IP"
        rate_limit_threshold = {
          count        = 100
          interval_sec = 60
        }
        ban_duration_sec = 600
      }
      
      description = "Rate limit per IP"
    }
  ]
  
  adaptive_protection_config = {
    layer_7_ddos_defense_config = {
      enable = true
    }
  }
  
  tags = {
    Environment = var.environment
    Purpose     = "nginx-security-gateway"
    ManagedBy   = "terraform"
  }
}
</code></pre>
<h3 data-id="heading-45">âš¡ ç¬¬åä¸€éƒ¨åˆ†ï¼šé«˜çº§æ”»é˜²å¯¹æŠ—ä¸é›¶æ—¥é˜²æŠ¤</h3>
<h4 data-id="heading-46">11.1 é›¶æ—¥æ¼æ´åº”æ€¥å“åº”æœºåˆ¶</h4>
<p><strong>è‡ªåŠ¨åŒ–æ¼æ´å“åº”ç³»ç»Ÿï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># zero_day_response_system.py</span>

<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> aiohttp
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> hashlib

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroDayResponseSystem</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.redis_client = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">2</span>)
        self.vulnerability_feeds = [
            {
                <span class="hljs-string">'name'</span>: <span class="hljs-string">'NVD'</span>,
                <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://services.nvd.nist.gov/rest/json/cves/2.0'</span>,
                <span class="hljs-string">'params'</span>: {
                    <span class="hljs-string">'resultsPerPage'</span>: <span class="hljs-number">100</span>,
                    <span class="hljs-string">'startIndex'</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">'pubStartDate'</span>: (datetime.now() - timedelta(days=<span class="hljs-number">7</span>)).strftime(<span class="hljs-string">'%Y-%m-%dT%H:%M:%S.%f'</span>)[:-<span class="hljs-number">3</span>] + <span class="hljs-string">'Z'</span>
                }
            },
            {
                <span class="hljs-string">'name'</span>: <span class="hljs-string">'VulnDB'</span>,
                <span class="hljs-string">'url'</span>: <span class="hljs-string">'https://vulndb.cyberriskanalytics.com/api/v1/vulnerabilities'</span>,
                <span class="hljs-string">'headers'</span>: {<span class="hljs-string">'X-API-KEY'</span>: <span class="hljs-string">'YOUR_VULNDB_API_KEY'</span>}
            }
        ]
        
        <span class="hljs-comment"># Nginxç›¸å…³CVEæ¨¡å¼</span>
        self.nginx_cve_patterns = [
            <span class="hljs-string">'nginx'</span>, <span class="hljs-string">'NGINX'</span>, <span class="hljs-string">'CVE-2023'</span>, <span class="hljs-string">'CVE-2024'</span>,  <span class="hljs-comment"># å¹´ä»½æ¨¡å¼</span>
            <span class="hljs-string">'buffer overflow'</span>, <span class="hljs-string">'denial of service'</span>, <span class="hljs-string">'DoS'</span>, <span class="hljs-string">'remote code execution'</span>,
            <span class="hljs-string">'RCE'</span>, <span class="hljs-string">'authentication bypass'</span>, <span class="hljs-string">'privilege escalation'</span>
        ]
        
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_vulnerability_feed</span>(<span class="hljs-params">self, session, feed</span>):
        <span class="hljs-string">"""è·å–æ¼æ´æƒ…æŠ¥"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(feed[<span class="hljs-string">'url'</span>], 
                                 headers=feed.get(<span class="hljs-string">'headers'</span>, {}), 
                                 params=feed.get(<span class="hljs-string">'params'</span>, {})) <span class="hljs-keyword">as</span> response:
                <span class="hljs-keyword">if</span> response.status == <span class="hljs-number">200</span>:
                    data = <span class="hljs-keyword">await</span> response.json()
                    <span class="hljs-keyword">return</span> {<span class="hljs-string">'feed_name'</span>: feed[<span class="hljs-string">'name'</span>], <span class="hljs-string">'data'</span>: data}
                <span class="hljs-keyword">else</span>:
                    logging.error(<span class="hljs-string">f"è·å–æ¼æ´æƒ…æŠ¥å¤±è´¥ï¼š<span class="hljs-subst">{feed[<span class="hljs-string">'name'</span>]}</span> - <span class="hljs-subst">{response.status}</span>"</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logging.error(<span class="hljs-string">f"è·å–æ¼æ´æƒ…æŠ¥å¼‚å¸¸ï¼š<span class="hljs-subst">{feed[<span class="hljs-string">'name'</span>]}</span> - <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_vulnerabilities</span>(<span class="hljs-params">self, vuln_data</span>):
        <span class="hljs-string">"""åˆ†ææ¼æ´æ•°æ®ï¼Œè¯†åˆ«ä¸Nginxç›¸å…³çš„å¨èƒ"""</span>
        relevant_vulnerabilities = []
        
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> vuln_data:
            feed_name = item[<span class="hljs-string">'feed_name'</span>]
            data = item[<span class="hljs-string">'data'</span>]
            
            <span class="hljs-keyword">if</span> feed_name == <span class="hljs-string">'NVD'</span>:
                <span class="hljs-keyword">for</span> vuln <span class="hljs-keyword">in</span> data.get(<span class="hljs-string">'vulnerabilities'</span>, []):
                    cve_id = vuln.get(<span class="hljs-string">'cve'</span>, {}).get(<span class="hljs-string">'id'</span>, <span class="hljs-string">''</span>)
                    description = vuln.get(<span class="hljs-string">'cve'</span>, {}).get(<span class="hljs-string">'descriptions'</span>, [{}])[<span class="hljs-number">0</span>].get(<span class="hljs-string">'value'</span>, <span class="hljs-string">''</span>)
                    
                    <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦ä¸Nginxç›¸å…³</span>
                    <span class="hljs-keyword">if</span> self.is_nginx_related_vulnerability(cve_id, description):
                        vuln_info = {
                            <span class="hljs-string">'cve_id'</span>: cve_id,
                            <span class="hljs-string">'description'</span>: description,
                            <span class="hljs-string">'severity'</span>: self.extract_severity(vuln),
                            <span class="hljs-string">'published_date'</span>: vuln.get(<span class="hljs-string">'cve'</span>, {}).get(<span class="hljs-string">'published'</span>, <span class="hljs-string">''</span>),
                            <span class="hljs-string">'affected_versions'</span>: self.extract_affected_versions(description),
                            <span class="hljs-string">'attack_vector'</span>: self.extract_attack_vector(vuln),
                            <span class="hljs-string">'mitigation_available'</span>: self.check_mitigation_available(cve_id)
                        }
                        relevant_vulnerabilities.append(vuln_info)
        
        <span class="hljs-keyword">return</span> relevant_vulnerabilities
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_nginx_related_vulnerability</span>(<span class="hljs-params">self, cve_id, description</span>):
        <span class="hljs-string">"""åˆ¤æ–­æ˜¯å¦ä¸ºä¸Nginxç›¸å…³çš„æ¼æ´"""</span>
        combined_text = <span class="hljs-string">f"<span class="hljs-subst">{cve_id}</span> <span class="hljs-subst">{description}</span>"</span>.lower()
        
        <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦åŒ…å«Nginxç›¸å…³å…³é”®è¯</span>
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> self.nginx_cve_patterns:
            <span class="hljs-keyword">if</span> pattern.lower() <span class="hljs-keyword">in</span> combined_text:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_severity</span>(<span class="hljs-params">self, vuln_data</span>):
        <span class="hljs-string">"""æå–æ¼æ´ä¸¥é‡ç¨‹åº¦"""</span>
        metrics = vuln_data.get(<span class="hljs-string">'cve'</span>, {}).get(<span class="hljs-string">'metrics'</span>, {})
        
        <span class="hljs-comment"># CVSS v3.1è¯„åˆ†</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'cvssMetricV31'</span> <span class="hljs-keyword">in</span> metrics:
            cvss = metrics[<span class="hljs-string">'cvssMetricV31'</span>][<span class="hljs-number">0</span>]
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'version'</span>: <span class="hljs-string">'CVSS v3.1'</span>,
                <span class="hljs-string">'score'</span>: cvss.get(<span class="hljs-string">'cvssData'</span>, {}).get(<span class="hljs-string">'baseScore'</span>, <span class="hljs-number">0</span>),
                <span class="hljs-string">'severity'</span>: cvss.get(<span class="hljs-string">'cvssData'</span>, {}).get(<span class="hljs-string">'baseSeverity'</span>, <span class="hljs-string">'UNKNOWN'</span>),
                <span class="hljs-string">'vector'</span>: cvss.get(<span class="hljs-string">'cvssData'</span>, {}).get(<span class="hljs-string">'vectorString'</span>, <span class="hljs-string">''</span>)
            }
        
        <span class="hljs-comment"># CVSS v3.0è¯„åˆ†</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-string">'cvssMetricV30'</span> <span class="hljs-keyword">in</span> metrics:
            cvss = metrics[<span class="hljs-string">'cvssMetricV30'</span>][<span class="hljs-number">0</span>]
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'version'</span>: <span class="hljs-string">'CVSS v3.0'</span>,
                <span class="hljs-string">'score'</span>: cvss.get(<span class="hljs-string">'cvssData'</span>, {}).get(<span class="hljs-string">'baseScore'</span>, <span class="hljs-number">0</span>),
                <span class="hljs-string">'severity'</span>: cvss.get(<span class="hljs-string">'cvssData'</span>, {}).get(<span class="hljs-string">'baseSeverity'</span>, <span class="hljs-string">'UNKNOWN'</span>),
                <span class="hljs-string">'vector'</span>: cvss.get(<span class="hljs-string">'cvssData'</span>, {}).get(<span class="hljs-string">'vectorString'</span>, <span class="hljs-string">''</span>)
            }
        
        <span class="hljs-keyword">return</span> {<span class="hljs-string">'version'</span>: <span class="hljs-string">'UNKNOWN'</span>, <span class="hljs-string">'score'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'severity'</span>: <span class="hljs-string">'UNKNOWN'</span>, <span class="hljs-string">'vector'</span>: <span class="hljs-string">''</span>}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_affected_versions</span>(<span class="hljs-params">self, description</span>):
        <span class="hljs-string">"""æå–å—å½±å“çš„ç‰ˆæœ¬ä¿¡æ¯"""</span>
        version_patterns = [
            <span class="hljs-string">r'nginx\s+([0-9]+\.[0-9]+\.[0-9]+)'</span>,  <span class="hljs-comment"># nginx 1.2.3</span>
            <span class="hljs-string">r'versions?\s+([0-9]+\.[0-9]+\.[0-9]+)'</span>,  <span class="hljs-comment"># versions 1.2.3</span>
            <span class="hljs-string">r'before\s+([0-9]+\.[0-9]+\.[0-9]+)'</span>,   <span class="hljs-comment"># before 1.2.3</span>
            <span class="hljs-string">r'prior\s+to\s+([0-9]+\.[0-9]+\.[0-9]+)'</span> <span class="hljs-comment"># prior to 1.2.3</span>
        ]
        
        affected_versions = []
        <span class="hljs-keyword">import</span> re
        
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> version_patterns:
            matches = re.findall(pattern, description, re.IGNORECASE)
            affected_versions.extend(matches)
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(affected_versions))
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_attack_vector</span>(<span class="hljs-params">self, vuln_data</span>):
        <span class="hljs-string">"""æå–æ”»å‡»å‘é‡ä¿¡æ¯"""</span>
        descriptions = vuln_data.get(<span class="hljs-string">'cve'</span>, {}).get(<span class="hljs-string">'descriptions'</span>, [])
        
        attack_vectors = []
        <span class="hljs-keyword">for</span> desc <span class="hljs-keyword">in</span> descriptions:
            value = desc.get(<span class="hljs-string">'value'</span>, <span class="hljs-string">''</span>).lower()
            
            <span class="hljs-keyword">if</span> <span class="hljs-string">'network'</span> <span class="hljs-keyword">in</span> value:
                attack_vectors.append(<span class="hljs-string">'NETWORK'</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-string">'adjacent'</span> <span class="hljs-keyword">in</span> value:
                attack_vectors.append(<span class="hljs-string">'ADJACENT_NETWORK'</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-string">'local'</span> <span class="hljs-keyword">in</span> value:
                attack_vectors.append(<span class="hljs-string">'LOCAL'</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-string">'physical'</span> <span class="hljs-keyword">in</span> value:
                attack_vectors.append(<span class="hljs-string">'PHYSICAL'</span>)
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(attack_vectors))
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_mitigation_available</span>(<span class="hljs-params">self, cve_id</span>):
        <span class="hljs-string">"""æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„ç¼“è§£æªæ–½"""</span>
        <span class="hljs-comment"># è¿™é‡Œå¯ä»¥æŸ¥è¯¢å†…éƒ¨çŸ¥è¯†åº“æˆ–å¤–éƒ¨API</span>
        <span class="hljs-comment"># è¿”å›ç¼“è§£æªæ–½ä¿¡æ¯</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'available'</span>: <span class="hljs-literal">True</span>,  <span class="hljs-comment"># å‡è®¾æ€»æœ‰ç¼“è§£æªæ–½</span>
            <span class="hljs-string">'type'</span>: <span class="hljs-string">'configuration'</span>,
            <span class="hljs-string">'description'</span>: <span class="hljs-string">'å¯ä»¥é€šè¿‡é…ç½®è°ƒæ•´ç¼“è§£'</span>,
            <span class="hljs-string">'effort_level'</span>: <span class="hljs-string">'medium'</span>
        }
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_emergency_response</span>(<span class="hljs-params">self, vulnerability</span>):
        <span class="hljs-string">"""ç”Ÿæˆåº”æ€¥å“åº”æªæ–½"""</span>
        response_actions = []
        
        <span class="hljs-comment"># æ ¹æ®æ¼æ´ä¸¥é‡ç¨‹åº¦ç”Ÿæˆå“åº”æªæ–½</span>
        severity_score = vulnerability[<span class="hljs-string">'severity'</span>][<span class="hljs-string">'score'</span>]
        
        <span class="hljs-keyword">if</span> severity_score &gt;= <span class="hljs-number">9.0</span>:  <span class="hljs-comment"># Critical</span>
            response_actions = [
                {
                    <span class="hljs-string">'action'</span>: <span class="hljs-string">'immediate_block'</span>,
                    <span class="hljs-string">'description'</span>: <span class="hljs-string">'ç«‹å³é˜»æ–­å¯ç–‘æ”»å‡»æ¨¡å¼'</span>,
                    <span class="hljs-string">'implementation'</span>: self.create_immediate_block_rule(vulnerability)
                },
                {
                    <span class="hljs-string">'action'</span>: <span class="hljs-string">'enhanced_logging'</span>,
                    <span class="hljs-string">'description'</span>: <span class="hljs-string">'å¯ç”¨å¢å¼ºæ—¥å¿—è®°å½•'</span>,
                    <span class="hljs-string">'implementation'</span>: self.enable_enhanced_logging(vulnerability)
                },
                {
                    <span class="hljs-string">'action'</span>: <span class="hljs-string">'emergency_patch'</span>,
                    <span class="hljs-string">'description'</span>: <span class="hljs-string">'ç´§æ€¥è¡¥ä¸éƒ¨ç½²'</span>,
                    <span class="hljs-string">'implementation'</span>: self.schedule_emergency_patch(vulnerability)
                }
            ]
        <span class="hljs-keyword">elif</span> severity_score &gt;= <span class="hljs-number">7.0</span>:  <span class="hljs-comment"># High</span>
            response_actions = [
                {
                    <span class="hljs-string">'action'</span>: <span class="hljs-string">'rate_limiting'</span>,
                    <span class="hljs-string">'description'</span>: <span class="hljs-string">'å®æ–½ä¸¥æ ¼çš„é€Ÿç‡é™åˆ¶'</span>,
                    <span class="hljs-string">'implementation'</span>: self.create_rate_limiting_rule(vulnerability)
                },
                {
                    <span class="hljs-string">'action'</span>: <span class="hljs-string">'signature_detection'</span>,
                    <span class="hljs-string">'description'</span>: <span class="hljs-string">'éƒ¨ç½²ç‰¹å¾æ£€æµ‹è§„åˆ™'</span>,
                    <span class="hljs-string">'implementation'</span>: self.create_signature_rule(vulnerability)
                }
            ]
        <span class="hljs-keyword">elif</span> severity_score &gt;= <span class="hljs-number">4.0</span>:  <span class="hljs-comment"># Medium</span>
            response_actions = [
                {
                    <span class="hljs-string">'action'</span>: <span class="hljs-string">'monitoring_enhancement'</span>,
                    <span class="hljs-string">'description'</span>: <span class="hljs-string">'å¢å¼ºç›‘æ§å’Œå‘Šè­¦'</span>,
                    <span class="hljs-string">'implementation'</span>: self.enhance_monitoring(vulnerability)
                }
            ]
        
        <span class="hljs-keyword">return</span> response_actions
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_immediate_block_rule</span>(<span class="hljs-params">self, vulnerability</span>):
        <span class="hljs-string">"""åˆ›å»ºç«‹å³é˜»æ–­è§„åˆ™"""</span>
        <span class="hljs-comment"># ç”ŸæˆNginxé…ç½®ç‰‡æ®µ</span>
        block_rule = <span class="hljs-string">f"""
        # é›¶æ—¥æ¼æ´ç´§æ€¥é˜»æ–­è§„åˆ™ - <span class="hljs-subst">{vulnerability[<span class="hljs-string">'cve_id'</span>]}</span>
        location / {{
            # é˜»æ–­å·²çŸ¥æ”»å‡»IP
            include /etc/nginx/blocklists/emergency-block-<span class="hljs-subst">{vulnerability[<span class="hljs-string">'cve_id'</span>]}</span>.conf;
            
            # é˜»æ–­å¯ç–‘User-Agent
            if ($http_user_agent ~* "<span class="hljs-subst">{self.extract_suspicious_user_agents(vulnerability)}</span>") {{
                return 403;
            }}
            
            # é˜»æ–­å¯ç–‘è¯·æ±‚æ¨¡å¼
            if ($request_uri ~* "<span class="hljs-subst">{self.extract_attack_patterns(vulnerability)}</span>") {{
                return 403;
            }}
            
            # é¢å¤–çš„å®‰å…¨æ£€æŸ¥
            include /etc/nginx/security/emergency-security.conf;
        }}
        """</span>
        
        <span class="hljs-comment"># ä¿å­˜è§„åˆ™åˆ°æ–‡ä»¶</span>
        rule_file = <span class="hljs-string">f"/etc/nginx/conf.d/emergency-<span class="hljs-subst">{vulnerability[<span class="hljs-string">'cve_id'</span>]}</span>.conf"</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(rule_file, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
            f.write(block_rule)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'rule_file'</span>: rule_file,
            <span class="hljs-string">'reload_required'</span>: <span class="hljs-literal">True</span>,
            <span class="hljs-string">'testing_required'</span>: <span class="hljs-literal">True</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_suspicious_user_agents</span>(<span class="hljs-params">self, vulnerability</span>):
        <span class="hljs-string">"""æå–å¯ç–‘çš„User-Agentæ¨¡å¼"""</span>
        <span class="hljs-comment"># åŸºäºæ¼æ´ç‰¹å¾ç”ŸæˆUser-Agentæ£€æµ‹æ¨¡å¼</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"(bot|scanner|nikto|sqlmap|nmap|masscan|zgrab)"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_attack_patterns</span>(<span class="hljs-params">self, vulnerability</span>):
        <span class="hljs-string">"""æå–æ”»å‡»æ¨¡å¼"""</span>
        <span class="hljs-comment"># åŸºäºæ¼æ´æè¿°ç”Ÿæˆæ”»å‡»æ¨¡å¼æ£€æµ‹</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"(\\\\.\\\\.\\\\/|\\\\.git|\\\\.env|config\\\\.php|wp-admin)"</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">deploy_emergency_rules</span>(<span class="hljs-params">self, vulnerability, response_actions</span>):
        <span class="hljs-string">"""éƒ¨ç½²åº”æ€¥å“åº”è§„åˆ™"""</span>
        deployment_results = []
        
        <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> response_actions:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">if</span> action[<span class="hljs-string">'action'</span>] == <span class="hljs-string">'immediate_block'</span>:
                    result = action[<span class="hljs-string">'implementation'</span>]
                    
                    <span class="hljs-comment"># æµ‹è¯•Nginxé…ç½®</span>
                    test_result = subprocess.run([<span class="hljs-string">'nginx'</span>, <span class="hljs-string">'-t'</span>], capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>)
                    <span class="hljs-keyword">if</span> test_result.returncode == <span class="hljs-number">0</span>:
                        <span class="hljs-comment"># é‡æ–°åŠ è½½Nginx</span>
                        reload_result = subprocess.run([<span class="hljs-string">'nginx'</span>, <span class="hljs-string">'-s'</span>, <span class="hljs-string">'reload'</span>], capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>)
                        <span class="hljs-keyword">if</span> reload_result.returncode == <span class="hljs-number">0</span>:
                            deployment_results.append({
                                <span class="hljs-string">'action'</span>: action[<span class="hljs-string">'action'</span>],
                                <span class="hljs-string">'status'</span>: <span class="hljs-string">'success'</span>,
                                <span class="hljs-string">'message'</span>: <span class="hljs-string">'ç´§æ€¥é˜»æ–­è§„åˆ™å·²æˆåŠŸéƒ¨ç½²'</span>
                            })
                        <span class="hljs-keyword">else</span>:
                            deployment_results.append({
                                <span class="hljs-string">'action'</span>: action[<span class="hljs-string">'action'</span>],
                                <span class="hljs-string">'status'</span>: <span class="hljs-string">'failed'</span>,
                                <span class="hljs-string">'message'</span>: <span class="hljs-string">f'Nginxé‡æ–°åŠ è½½å¤±è´¥: <span class="hljs-subst">{reload_result.stderr}</span>'</span>
                            })
                    <span class="hljs-keyword">else</span>:
                        deployment_results.append({
                            <span class="hljs-string">'action'</span>: action[<span class="hljs-string">'action'</span>],
                            <span class="hljs-string">'status'</span>: <span class="hljs-string">'failed'</span>,
                            <span class="hljs-string">'message'</span>: <span class="hljs-string">f'Nginxé…ç½®æµ‹è¯•å¤±è´¥: <span class="hljs-subst">{test_result.stderr}</span>'</span>
                            })
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                deployment_results.append({
                    <span class="hljs-string">'action'</span>: action[<span class="hljs-string">'action'</span>],
                    <span class="hljs-string">'status'</span>: <span class="hljs-string">'error'</span>,
                    <span class="hljs-string">'message'</span>: <span class="hljs-built_in">str</span>(e)
                })
        
        <span class="hljs-keyword">return</span> deployment_results
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_continuous_monitoring</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æŒç»­ç›‘æ§é›¶æ—¥æ¼æ´"""</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                logging.info(<span class="hljs-string">"å¼€å§‹æ£€æŸ¥æ–°çš„é›¶æ—¥æ¼æ´..."</span>)
                
                <span class="hljs-comment"># è·å–æœ€æ–°æ¼æ´ä¿¡æ¯</span>
                <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:
                    tasks = [self.fetch_vulnerability_feed(session, feed) <span class="hljs-keyword">for</span> feed <span class="hljs-keyword">in</span> self.vulnerability_feeds]
                    results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)
                    
                    <span class="hljs-comment"># åˆ†ææ¼æ´</span>
                    relevant_vulns = <span class="hljs-keyword">await</span> self.analyze_vulnerabilities([r <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results <span class="hljs-keyword">if</span> r])
                    
                    <span class="hljs-comment"># å¤„ç†é«˜å±æ¼æ´</span>
                    <span class="hljs-keyword">for</span> vuln <span class="hljs-keyword">in</span> relevant_vulns:
                        <span class="hljs-keyword">if</span> vuln[<span class="hljs-string">'severity'</span>][<span class="hljs-string">'score'</span>] &gt;= <span class="hljs-number">7.0</span>:  <span class="hljs-comment"># High severity</span>
                            logging.warning(<span class="hljs-string">f"å‘ç°é«˜å±Nginxæ¼æ´: <span class="hljs-subst">{vuln[<span class="hljs-string">'cve_id'</span>]}</span> (Score: <span class="hljs-subst">{vuln[<span class="hljs-string">'severity'</span>][<span class="hljs-string">'score'</span>]}</span>)"</span>)
                            
                            <span class="hljs-comment"># ç”Ÿæˆåº”æ€¥å“åº”</span>
                            response_actions = <span class="hljs-keyword">await</span> self.generate_emergency_response(vuln)
                            
                            <span class="hljs-comment"># éƒ¨ç½²åº”æ€¥æªæ–½</span>
                            deployment_results = <span class="hljs-keyword">await</span> self.deploy_emergency_rules(vuln, response_actions)
                            
                            <span class="hljs-comment"># è®°å½•å“åº”æ—¥å¿—</span>
                            response_log = {
                                <span class="hljs-string">'timestamp'</span>: datetime.now().isoformat(),
                                <span class="hljs-string">'vulnerability'</span>: vuln,
                                <span class="hljs-string">'response_actions'</span>: response_actions,
                                <span class="hljs-string">'deployment_results'</span>: deployment_results
                            }
                            
                            self.redis_client.lpush(<span class="hljs-string">'zeroday:response_logs'</span>, json.dumps(response_log))
                            
                            <span class="hljs-comment"># å‘é€å‘Šè­¦</span>
                            <span class="hljs-keyword">await</span> self.send_zero_day_alert(vuln, response_actions)
                
                <span class="hljs-comment"># æ¯6å°æ—¶æ£€æŸ¥ä¸€æ¬¡</span>
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">21600</span>)
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logging.error(<span class="hljs-string">f"é›¶æ—¥æ¼æ´ç›‘æ§å¼‚å¸¸ï¼š<span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">3600</span>)  <span class="hljs-comment"># 1å°æ—¶åé‡è¯•</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_zero_day_alert</span>(<span class="hljs-params">self, vulnerability, response_actions</span>):
        <span class="hljs-string">"""å‘é€é›¶æ—¥æ¼æ´å‘Šè­¦"""</span>
        alert = {
            <span class="hljs-string">'type'</span>: <span class="hljs-string">'zero_day_vulnerability'</span>,
            <span class="hljs-string">'severity'</span>: <span class="hljs-string">'critical'</span> <span class="hljs-keyword">if</span> vulnerability[<span class="hljs-string">'severity'</span>][<span class="hljs-string">'score'</span>] &gt;= <span class="hljs-number">9.0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'high'</span>,
            <span class="hljs-string">'timestamp'</span>: datetime.now().isoformat(),
            <span class="hljs-string">'vulnerability'</span>: vulnerability,
            <span class="hljs-string">'response_actions'</span>: response_actions,
            <span class="hljs-string">'action_required'</span>: <span class="hljs-string">'immediate_response'</span>
        }
        
        <span class="hljs-comment"># å‘é€åˆ°å‘Šè­¦ç³»ç»Ÿ</span>
        self.redis_client.publish(<span class="hljs-string">'security:zero_day_alerts'</span>, json.dumps(alert))

<span class="hljs-comment"># å¯åŠ¨é›¶æ—¥æ¼æ´ç›‘æ§ç³»ç»Ÿ</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    zero_day_system = ZeroDayResponseSystem()
    <span class="hljs-keyword">await</span> zero_day_system.run_continuous_monitoring()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<h4 data-id="heading-47">11.2 é«˜çº§æŒç»­å¨èƒ(APT)é˜²æŠ¤</h4>
<p><strong>APTæ”»å‡»æ£€æµ‹ä¸é˜²æŠ¤ç³»ç»Ÿï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># apt_detection_system.py</span>

<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict, deque
<span class="hljs-keyword">import</span> logging

<span class="hljs-keyword">class</span> <span class="hljs-title class_">APTDetectionSystem</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.redis_client = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">3</span>)
        
        <span class="hljs-comment"># APTæ”»å‡»è¡Œä¸ºæ¨¡å¼</span>
        self.apt_behavior_patterns = {
            <span class="hljs-string">'reconnaissance'</span>: {
                <span class="hljs-string">'indicators'</span>: [<span class="hljs-string">'scanning'</span>, <span class="hljs-string">'enumeration'</span>, <span class="hljs-string">'fingerprinting'</span>],
                <span class="hljs-string">'threshold'</span>: <span class="hljs-number">10</span>,
                <span class="hljs-string">'time_window'</span>: <span class="hljs-number">3600</span>  <span class="hljs-comment"># 1å°æ—¶</span>
            },
            <span class="hljs-string">'lateral_movement'</span>: {
                <span class="hljs-string">'indicators'</span>: [<span class="hljs-string">'privilege_escalation'</span>, <span class="hljs-string">'credential_dumping'</span>, <span class="hljs-string">'remote_access'</span>],
                <span class="hljs-string">'threshold'</span>: <span class="hljs-number">5</span>,
                <span class="hljs-string">'time_window'</span>: <span class="hljs-number">1800</span>  <span class="hljs-comment"># 30åˆ†é’Ÿ</span>
            },
            <span class="hljs-string">'data_exfiltration'</span>: {
                <span class="hljs-string">'indicators'</span>: [<span class="hljs-string">'large_data_transfer'</span>, <span class="hljs-string">'unusual_outbound'</span>, <span class="hljs-string">'encrypted_communication'</span>],
                <span class="hljs-string">'threshold'</span>: <span class="hljs-number">3</span>,
                <span class="hljs-string">'time_window'</span>: <span class="hljs-number">7200</span>  <span class="hljs-comment"># 2å°æ—¶</span>
            },
            <span class="hljs-string">'persistence'</span>: {
                <span class="hljs-string">'indicators'</span>: [<span class="hljs-string">'backdoor_installation'</span>, <span class="hljs-string">'scheduled_tasks'</span>, <span class="hljs-string">'registry_modification'</span>],
                <span class="hljs-string">'threshold'</span>: <span class="hljs-number">2</span>,
                <span class="hljs-string">'time_window'</span>: <span class="hljs-number">86400</span>  <span class="hljs-comment"># 24å°æ—¶</span>
            }
        }
        
        <span class="hljs-comment"># ç”¨æˆ·è¡Œä¸ºåŸºçº¿</span>
        self.user_behavior_baseline = {}
        
        <span class="hljs-comment"># å¨èƒç‹©çŒè§„åˆ™</span>
        self.threat_hunting_rules = [
            self.detect_low_and_slow_attacks,
            self.detect_living_off_the_land,
            self.detect_c2_communications,
            self.detect_data_staging
        ]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_user_behavior</span>(<span class="hljs-params">self, user_id, current_behavior</span>):
        <span class="hljs-string">"""åˆ†æç”¨æˆ·è¡Œä¸ºåå·®"""</span>
        <span class="hljs-keyword">if</span> user_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.user_behavior_baseline:
            <span class="hljs-comment"># å»ºç«‹ç”¨æˆ·è¡Œä¸ºåŸºçº¿</span>
            self.user_behavior_baseline[user_id] = {
                <span class="hljs-string">'request_patterns'</span>: deque(maxlen=<span class="hljs-number">1000</span>),
                <span class="hljs-string">'time_patterns'</span>: deque(maxlen=<span class="hljs-number">1000</span>),
                <span class="hljs-string">'resource_access'</span>: defaultdict(<span class="hljs-built_in">int</span>),
                <span class="hljs-string">'geo_patterns'</span>: deque(maxlen=<span class="hljs-number">100</span>),
                <span class="hljs-string">'established'</span>: datetime.now()
            }
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'risk_score'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'anomalies'</span>: []}
        
        baseline = self.user_behavior_baseline[user_id]
        anomalies = []
        risk_score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># 1. æ—¶é—´æ¨¡å¼å¼‚å¸¸æ£€æµ‹</span>
        current_hour = current_behavior.get(<span class="hljs-string">'timestamp'</span>, datetime.now()).hour
        time_pattern = baseline[<span class="hljs-string">'time_patterns'</span>]
        
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(time_pattern) &gt; <span class="hljs-number">50</span>:
            usual_hours = [t.hour <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> time_pattern]
            hour_frequency = defaultdict(<span class="hljs-built_in">int</span>)
            <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> usual_hours:
                hour_frequency[h] += <span class="hljs-number">1</span>
            
            <span class="hljs-comment"># æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦åœ¨ç”¨æˆ·é€šå¸¸æ´»è·ƒæ—¶é—´ä¹‹å¤–</span>
            <span class="hljs-keyword">if</span> current_hour <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> hour_frequency <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(hour_frequency) &gt; <span class="hljs-number">0</span>:
                anomalies.append({
                    <span class="hljs-string">'type'</span>: <span class="hljs-string">'unusual_time_access'</span>,
                    <span class="hljs-string">'severity'</span>: <span class="hljs-string">'medium'</span>,
                    <span class="hljs-string">'details'</span>: <span class="hljs-string">f"Access at <span class="hljs-subst">{current_hour}</span>:00, user usually active at <span class="hljs-subst">{<span class="hljs-built_in">list</span>(hour_frequency.keys())}</span>"</span>
                })
                risk_score += <span class="hljs-number">20</span>
        
        <span class="hljs-comment"># 2. èµ„æºè®¿é—®å¼‚å¸¸æ£€æµ‹</span>
        current_resource = current_behavior.get(<span class="hljs-string">'resource'</span>, <span class="hljs-string">''</span>)
        resource_access = baseline[<span class="hljs-string">'resource_access'</span>]
        
        <span class="hljs-keyword">if</span> current_resource <span class="hljs-keyword">and</span> current_resource <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> resource_access:
            <span class="hljs-comment"># é¦–æ¬¡è®¿é—®æ–°èµ„æº</span>
            anomalies.append({
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'new_resource_access'</span>,
                <span class="hljs-string">'severity'</span>: <span class="hljs-string">'low'</span>,
                <span class="hljs-string">'details'</span>: <span class="hljs-string">f"First time accessing: <span class="hljs-subst">{current_resource}</span>"</span>
            })
            risk_score += <span class="hljs-number">10</span>
        
        <span class="hljs-comment"># 3. è¯·æ±‚æ¨¡å¼å¼‚å¸¸æ£€æµ‹</span>
        current_pattern = {
            <span class="hljs-string">'method'</span>: current_behavior.get(<span class="hljs-string">'method'</span>, <span class="hljs-string">''</span>),
            <span class="hljs-string">'path'</span>: current_behavior.get(<span class="hljs-string">'path'</span>, <span class="hljs-string">''</span>),
            <span class="hljs-string">'params'</span>: current_behavior.get(<span class="hljs-string">'params'</span>, {})
        }
        
        request_patterns = baseline[<span class="hljs-string">'request_patterns'</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(request_patterns) &gt; <span class="hljs-number">100</span>:
            <span class="hljs-comment"># è®¡ç®—ä¸å†å²æ¨¡å¼çš„ç›¸ä¼¼åº¦</span>
            similarity_scores = []
            <span class="hljs-keyword">for</span> historical_pattern <span class="hljs-keyword">in</span> request_patterns:
                similarity = self.calculate_pattern_similarity(current_pattern, historical_pattern)
                similarity_scores.append(similarity)
            
            <span class="hljs-comment"># è®¡ç®—å¹³å‡ç›¸ä¼¼åº¦</span>
            avg_similarity = np.mean(similarity_scores)
            
            <span class="hljs-keyword">if</span> avg_similarity &lt; <span class="hljs-number">0.3</span>:  <span class="hljs-comment"># ç›¸ä¼¼åº¦ä½äºé˜ˆå€¼</span>
                anomalies.append({
                    <span class="hljs-string">'type'</span>: <span class="hljs-string">'unusual_request_pattern'</span>,
                    <span class="hljs-string">'severity'</span>: <span class="hljs-string">'high'</span>,
                    <span class="hljs-string">'details'</span>: <span class="hljs-string">f"Request pattern similarity <span class="hljs-subst">{avg_similarity:<span class="hljs-number">.2</span>f}</span>, significantly different from historical patterns"</span>
                })
                risk_score += <span class="hljs-number">30</span>
        
        <span class="hljs-comment"># 4. åœ°ç†ä½ç½®å¼‚å¸¸æ£€æµ‹</span>
        current_geo = current_behavior.get(<span class="hljs-string">'geo_location'</span>)
        <span class="hljs-keyword">if</span> current_geo:
            geo_patterns = baseline[<span class="hljs-string">'geo_patterns'</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(geo_patterns) &gt; <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> current_geo <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> geo_patterns:
                <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸å¯èƒ½çš„åœ°ç†ä½ç½®è·³è½¬</span>
                recent_locations = [g <span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> geo_patterns[-<span class="hljs-number">5</span>:]]  <span class="hljs-comment"># æœ€è¿‘5æ¬¡è®¿é—®ä½ç½®</span>
                <span class="hljs-keyword">if</span> current_geo <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> recent_locations:
                    anomalies.append({
                        <span class="hljs-string">'type'</span>: <span class="hljs-string">'unusual_geolocation'</span>,
                        <span class="hljs-string">'severity'</span>: <span class="hljs-string">'high'</span>,
                        <span class="hljs-string">'details'</span>: <span class="hljs-string">f"Access from unusual location: <span class="hljs-subst">{current_geo}</span>, recent locations: <span class="hljs-subst">{recent_locations}</span>"</span>
                    })
                    risk_score += <span class="hljs-number">40</span>
        
        <span class="hljs-comment"># 5. åº”ç”¨å¨èƒç‹©çŒè§„åˆ™</span>
        <span class="hljs-keyword">for</span> hunter <span class="hljs-keyword">in</span> self.threat_hunting_rules:
            hunter_result = hunter(current_behavior, baseline)
            <span class="hljs-keyword">if</span> hunter_result:
                anomalies.append(hunter_result)
                risk_score += <span class="hljs-number">25</span>
        
        <span class="hljs-comment"># æ›´æ–°åŸºçº¿</span>
        baseline[<span class="hljs-string">'request_patterns'</span>].append(current_pattern)
        baseline[<span class="hljs-string">'time_patterns'</span>].append(current_behavior.get(<span class="hljs-string">'timestamp'</span>, datetime.now()))
        <span class="hljs-keyword">if</span> current_resource:
            baseline[<span class="hljs-string">'resource_access'</span>][current_resource] += <span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> current_geo:
            baseline[<span class="hljs-string">'geo_patterns'</span>].append(current_geo)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'risk_score'</span>: <span class="hljs-built_in">min</span>(risk_score, <span class="hljs-number">100</span>),  <span class="hljs-comment"># é™åˆ¶æœ€å¤§é£é™©åˆ†æ•°ä¸º100</span>
            <span class="hljs-string">'anomalies'</span>: anomalies
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_pattern_similarity</span>(<span class="hljs-params">self, pattern1, pattern2</span>):
        <span class="hljs-string">"""è®¡ç®—è¯·æ±‚æ¨¡å¼ç›¸ä¼¼åº¦"""</span>
        <span class="hljs-comment"># ç®€åŒ–å®ç°ï¼Œå®é™…åº”ç”¨ä¸­å¯ä½¿ç”¨æ›´å¤æ‚çš„ç®—æ³•</span>
        <span class="hljs-keyword">if</span> pattern1[<span class="hljs-string">'method'</span>] != pattern2[<span class="hljs-string">'method'</span>]:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
        
        path_similarity = self._string_similarity(pattern1[<span class="hljs-string">'path'</span>], pattern2[<span class="hljs-string">'path'</span>])
        params_similarity = self._params_similarity(pattern1[<span class="hljs-string">'params'</span>], pattern2[<span class="hljs-string">'params'</span>])
        
        <span class="hljs-keyword">return</span> (path_similarity * <span class="hljs-number">0.7</span>) + (params_similarity * <span class="hljs-number">0.3</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_string_similarity</span>(<span class="hljs-params">self, s1, s2</span>):
        <span class="hljs-string">"""è®¡ç®—å­—ç¬¦ä¸²ç›¸ä¼¼åº¦ï¼ˆç®€åŒ–ç‰ˆï¼‰"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> s1 <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> s2:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
            
        <span class="hljs-comment"># ä½¿ç”¨Levenshteinè·ç¦»è®¡ç®—ç›¸ä¼¼åº¦</span>
        <span class="hljs-keyword">from</span> Levenshtein <span class="hljs-keyword">import</span> ratio
        <span class="hljs-keyword">return</span> ratio(s1, s2)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_params_similarity</span>(<span class="hljs-params">self, params1, params2</span>):
        <span class="hljs-string">"""è®¡ç®—å‚æ•°ç›¸ä¼¼åº¦"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> params1 <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> params2:
            <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> params1 <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> params2:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
        
        keys1 = <span class="hljs-built_in">set</span>(params1.keys())
        keys2 = <span class="hljs-built_in">set</span>(params2.keys())
        common_keys = keys1.intersection(keys2)
        all_keys = keys1.union(keys2)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> all_keys:
            <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>
            
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(common_keys) / <span class="hljs-built_in">len</span>(all_keys)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_low_and_slow_attacks</span>(<span class="hljs-params">self, behavior, baseline</span>):
        <span class="hljs-string">"""æ£€æµ‹ä½é€Ÿæ”»å‡»"""</span>
        <span class="hljs-comment"># å®ç°ä½é€Ÿæ”»å‡»æ£€æµ‹é€»è¾‘</span>
        <span class="hljs-keyword">pass</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_living_off_the_land</span>(<span class="hljs-params">self, behavior, baseline</span>):
        <span class="hljs-string">"""æ£€æµ‹Living-off-the-landæ”»å‡»"""</span>
        <span class="hljs-comment"># å®ç°åˆæ³•å·¥å…·æ»¥ç”¨æ”»å‡»æ£€æµ‹é€»è¾‘</span>
        <span class="hljs-keyword">pass</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_monitoring</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å¯åŠ¨APTç›‘æ§"""</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-comment"># å®ç°APTç›‘æ§ä¸»å¾ªç¯</span>
            <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">60</span>)

<span class="hljs-comment"># Nginxæ—¥å¿—å®æ—¶ç›‘æ§é›†æˆ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NginxAPTMonitor</span>:
    <span class="hljs-string">"""Nginx APTæ”»å‡»å®æ—¶ç›‘æ§ç³»ç»Ÿ"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, log_file_path=<span class="hljs-string">'/var/log/nginx/access.log'</span></span>):
        self.log_file_path = log_file_path
        self.apt_detector = APTDetectionSystem()
        self.redis_client = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">4</span>)
        self.alert_threshold = <span class="hljs-number">70</span>  <span class="hljs-comment"># é£é™©åˆ†æ•°é˜ˆå€¼</span>
        
        <span class="hljs-comment"># å¯åŠ¨å¼‚æ­¥ç›‘æ§ä»»åŠ¡</span>
        self.monitoring_tasks = [
            self.monitor_nginx_logs(),
            self.process_suspicious_activities(),
            self.generate_threat_reports()
        ]
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">monitor_nginx_logs</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç›‘æ§Nginxè®¿é—®æ—¥å¿—"""</span>
        <span class="hljs-keyword">import</span> aiofiles
        <span class="hljs-keyword">import</span> re
        
        <span class="hljs-comment"># Nginxæ—¥å¿—æ ¼å¼è§£ææ­£åˆ™è¡¨è¾¾å¼</span>
        log_pattern = re.<span class="hljs-built_in">compile</span>(
            <span class="hljs-string">r'(\d+\.\d+\.\d+\.\d+)\s+-\s+-\s+\[(.+?)\]\s+"(\w+)\s+(.+?)\s+HTTP/[\d.]+"\s+(\d+)\s+(\d+)\s+"(.+?)"\s+"(.+?)"'</span>
        )
        
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiofiles.<span class="hljs-built_in">open</span>(self.log_file_path, mode=<span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> log_file:
            <span class="hljs-comment"># ç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆåªç›‘æ§æ–°æ—¥å¿—ï¼‰</span>
            <span class="hljs-keyword">await</span> log_file.seek(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
            
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                line = <span class="hljs-keyword">await</span> log_file.readline()
                <span class="hljs-keyword">if</span> line:
                    <span class="hljs-keyword">match</span> = log_pattern.<span class="hljs-keyword">match</span>(line.strip())
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:
                        log_data = {
                            <span class="hljs-string">'remote_addr'</span>: <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>),
                            <span class="hljs-string">'timestamp'</span>: <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>),
                            <span class="hljs-string">'method'</span>: <span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>),
                            <span class="hljs-string">'request'</span>: <span class="hljs-keyword">match</span>.group(<span class="hljs-number">4</span>),
                            <span class="hljs-string">'status'</span>: <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">5</span>)),
                            <span class="hljs-string">'body_bytes_sent'</span>: <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">6</span>)),
                            <span class="hljs-string">'http_referer'</span>: <span class="hljs-keyword">match</span>.group(<span class="hljs-number">7</span>),
                            <span class="hljs-string">'http_user_agent'</span>: <span class="hljs-keyword">match</span>.group(<span class="hljs-number">8</span>)
                        }
                        
                        <span class="hljs-comment"># åˆ†æç”¨æˆ·è¡Œä¸º</span>
                        risk_analysis = <span class="hljs-keyword">await</span> self.analyze_user_session(log_data)
                        
                        <span class="hljs-keyword">if</span> risk_analysis[<span class="hljs-string">'risk_score'</span>] &gt; self.alert_threshold:
                            <span class="hljs-keyword">await</span> self.trigger_high_risk_alert(log_data, risk_analysis)
                
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.1</span>)  <span class="hljs-comment"># é¿å…CPUå ç”¨è¿‡é«˜</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_user_session</span>(<span class="hljs-params">self, log_data</span>):
        <span class="hljs-string">"""åˆ†æç”¨æˆ·ä¼šè¯é£é™©"""</span>
        user_id = log_data[<span class="hljs-string">'remote_addr'</span>]
        
        <span class="hljs-comment"># æ„å»ºç”¨æˆ·è¡Œä¸ºæ•°æ®</span>
        behavior_data = {
            <span class="hljs-string">'timestamp'</span>: datetime.now(),
            <span class="hljs-string">'method'</span>: log_data[<span class="hljs-string">'method'</span>],
            <span class="hljs-string">'path'</span>: log_data[<span class="hljs-string">'request'</span>].split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>],
            <span class="hljs-string">'params'</span>: <span class="hljs-built_in">dict</span>(param.split(<span class="hljs-string">'='</span>) <span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> log_data[<span class="hljs-string">'request'</span>].split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">1</span>].split(<span class="hljs-string">'&amp;'</span>)) <span class="hljs-keyword">if</span> <span class="hljs-string">'?'</span> <span class="hljs-keyword">in</span> log_data[<span class="hljs-string">'request'</span>] <span class="hljs-keyword">else</span> {},
            <span class="hljs-string">'status_code'</span>: log_data[<span class="hljs-string">'status'</span>],
            <span class="hljs-string">'user_agent'</span>: log_data[<span class="hljs-string">'http_user_agent'</span>],
            <span class="hljs-string">'resource'</span>: log_data[<span class="hljs-string">'request'</span>].split(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>],
            <span class="hljs-string">'geo_location'</span>: <span class="hljs-keyword">await</span> self.get_geo_location(log_data[<span class="hljs-string">'remote_addr'</span>])
        }
        
        <span class="hljs-comment"># ä½¿ç”¨APTæ£€æµ‹ç³»ç»Ÿåˆ†æ</span>
        risk_analysis = self.apt_detector.analyze_user_behavior(user_id, behavior_data)
        
        <span class="hljs-comment"># ç¼“å­˜åˆ†æç»“æœ</span>
        <span class="hljs-keyword">await</span> self.cache_risk_analysis(user_id, risk_analysis)
        
        <span class="hljs-keyword">return</span> risk_analysis
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_geo_location</span>(<span class="hljs-params">self, ip_address</span>):
        <span class="hljs-string">"""è·å–IPåœ°å€åœ°ç†ä½ç½®"""</span>
        <span class="hljs-comment"># å®ç°IPåœ°ç†ä½ç½®æŸ¥è¯¢ï¼ˆå¯ä½¿ç”¨MaxMind GeoIPç­‰åº“ï¼‰</span>
        <span class="hljs-comment"># è¿™é‡Œè¿”å›æ¨¡æ‹Ÿæ•°æ®</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"location_for_<span class="hljs-subst">{ip_address}</span>"</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">cache_risk_analysis</span>(<span class="hljs-params">self, user_id, risk_analysis</span>):
        <span class="hljs-string">"""ç¼“å­˜é£é™©åˆ†æç»“æœ"""</span>
        key = <span class="hljs-string">f"risk_analysis:<span class="hljs-subst">{user_id}</span>"</span>
        <span class="hljs-keyword">await</span> self.redis_client.setex(key, <span class="hljs-number">3600</span>, json.dumps(risk_analysis))  <span class="hljs-comment"># ç¼“å­˜1å°æ—¶</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">trigger_high_risk_alert</span>(<span class="hljs-params">self, log_data, risk_analysis</span>):
        <span class="hljs-string">"""è§¦å‘é«˜é£é™©è­¦æŠ¥"""</span>
        alert_data = {
            <span class="hljs-string">'timestamp'</span>: datetime.now().isoformat(),
            <span class="hljs-string">'user_ip'</span>: log_data[<span class="hljs-string">'remote_addr'</span>],
            <span class="hljs-string">'risk_score'</span>: risk_analysis[<span class="hljs-string">'risk_score'</span>],
            <span class="hljs-string">'anomalies'</span>: risk_analysis[<span class="hljs-string">'anomalies'</span>],
            <span class="hljs-string">'request_details'</span>: log_data,
            <span class="hljs-string">'alert_level'</span>: <span class="hljs-string">'HIGH'</span> <span class="hljs-keyword">if</span> risk_analysis[<span class="hljs-string">'risk_score'</span>] &gt; <span class="hljs-number">80</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'MEDIUM'</span>
        }
        
        <span class="hljs-comment"># å‘é€åˆ°è­¦æŠ¥é˜Ÿåˆ—</span>
        <span class="hljs-keyword">await</span> self.redis_client.lpush(<span class="hljs-string">'security_alerts:high_risk'</span>, json.dumps(alert_data))
        
        <span class="hljs-comment"># è®°å½•æ—¥å¿—</span>
        logging.warning(<span class="hljs-string">f"HIGH RISK ALERT: User <span class="hljs-subst">{log_data[<span class="hljs-string">'remote_addr'</span>]}</span> risk score <span class="hljs-subst">{risk_analysis[<span class="hljs-string">'risk_score'</span>]}</span>"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_suspicious_activities</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å¤„ç†å¯ç–‘æ´»åŠ¨"""</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># ä»é˜Ÿåˆ—è·å–é«˜é£é™©è­¦æŠ¥</span>
                alert_data = <span class="hljs-keyword">await</span> self.redis_client.brpop(<span class="hljs-string">'security_alerts:high_risk'</span>, timeout=<span class="hljs-number">1</span>)
                <span class="hljs-keyword">if</span> alert_data:
                    alert = json.loads(alert_data[<span class="hljs-number">1</span>])
                    
                    <span class="hljs-comment"># è‡ªåŠ¨é˜»æ–­é«˜é£é™©ç”¨æˆ·</span>
                    <span class="hljs-keyword">if</span> alert[<span class="hljs-string">'risk_score'</span>] &gt; <span class="hljs-number">80</span>:
                        <span class="hljs-keyword">await</span> self.auto_block_user(alert[<span class="hljs-string">'user_ip'</span>], alert[<span class="hljs-string">'risk_score'</span>])
                    
                    <span class="hljs-comment"># å‘é€é€šçŸ¥ï¼ˆé‚®ä»¶ã€Slackç­‰ï¼‰</span>
                    <span class="hljs-keyword">await</span> self.send_security_notification(alert)
                    
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logging.error(<span class="hljs-string">f"Error processing suspicious activities: <span class="hljs-subst">{e}</span>"</span>)
            
            <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">auto_block_user</span>(<span class="hljs-params">self, user_ip, risk_score</span>):
        <span class="hljs-string">"""è‡ªåŠ¨é˜»æ–­ç”¨æˆ·"""</span>
        <span class="hljs-comment"># ä½¿ç”¨Nginxçš„denyæŒ‡ä»¤é˜»æ–­IP</span>
        block_command = <span class="hljs-string">f"echo 'deny <span class="hljs-subst">{user_ip}</span>;' &gt;&gt; /etc/nginx/conf.d/auto_blocks.conf &amp;&amp; nginx -s reload"</span>
        
        <span class="hljs-comment"># è®°å½•é˜»æ–­æ“ä½œ</span>
        block_record = {
            <span class="hljs-string">'user_ip'</span>: user_ip,
            <span class="hljs-string">'risk_score'</span>: risk_score,
            <span class="hljs-string">'blocked_at'</span>: datetime.now().isoformat(),
            <span class="hljs-string">'auto_unblock_at'</span>: (datetime.now() + timedelta(hours=<span class="hljs-number">24</span>)).isoformat()  <span class="hljs-comment"># 24å°æ—¶åè‡ªåŠ¨è§£å°</span>
        }
        
        <span class="hljs-keyword">await</span> self.redis_client.setex(<span class="hljs-string">f"blocked_user:<span class="hljs-subst">{user_ip}</span>"</span>, <span class="hljs-number">86400</span>, json.dumps(block_record))
        logging.info(<span class="hljs-string">f"Auto-blocked user <span class="hljs-subst">{user_ip}</span> with risk score <span class="hljs-subst">{risk_score}</span>"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_security_notification</span>(<span class="hljs-params">self, alert</span>):
        <span class="hljs-string">"""å‘é€å®‰å…¨é€šçŸ¥"""</span>
        <span class="hljs-comment"># å®ç°é€šçŸ¥å‘é€é€»è¾‘ï¼ˆé‚®ä»¶ã€Slackã€ä¼ä¸šå¾®ä¿¡ç­‰ï¼‰</span>
        notification = {
            <span class="hljs-string">'type'</span>: <span class="hljs-string">'security_alert'</span>,
            <span class="hljs-string">'title'</span>: <span class="hljs-string">f"APT Attack Detected - Risk Score: <span class="hljs-subst">{alert[<span class="hljs-string">'risk_score'</span>]}</span>"</span>,
            <span class="hljs-string">'content'</span>: <span class="hljs-string">f"Suspicious activity detected from IP <span class="hljs-subst">{alert[<span class="hljs-string">'user_ip'</span>]}</span>. Anomalies: <span class="hljs-subst">{alert[<span class="hljs-string">'anomalies'</span>]}</span>"</span>,
            <span class="hljs-string">'timestamp'</span>: alert[<span class="hljs-string">'timestamp'</span>]
        }
        
        <span class="hljs-comment"># è¿™é‡Œå¯ä»¥é›†æˆå„ç§é€šçŸ¥æœåŠ¡</span>
        logging.info(<span class="hljs-string">f"Security notification sent: <span class="hljs-subst">{notification}</span>"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_threat_reports</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç”Ÿæˆå¨èƒæŠ¥å‘Š"""</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># æ¯å°æ—¶ç”Ÿæˆä¸€æ¬¡å¨èƒæŠ¥å‘Š</span>
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">3600</span>)
                
                <span class="hljs-comment"># æ”¶é›†è¿‡å»ä¸€å°æ—¶çš„å¨èƒæ•°æ®</span>
                threat_summary = <span class="hljs-keyword">await</span> self.collect_threat_summary()
                
                <span class="hljs-comment"># ç”ŸæˆæŠ¥å‘Š</span>
                report = {
                    <span class="hljs-string">'period'</span>: <span class="hljs-string">f"<span class="hljs-subst">{datetime.now() - timedelta(hours=<span class="hljs-number">1</span>)}</span> - <span class="hljs-subst">{datetime.now()}</span>"</span>,
                    <span class="hljs-string">'total_alerts'</span>: threat_summary[<span class="hljs-string">'total_alerts'</span>],
                    <span class="hljs-string">'high_risk_users'</span>: threat_summary[<span class="hljs-string">'high_risk_users'</span>],
                    <span class="hljs-string">'blocked_ips'</span>: threat_summary[<span class="hljs-string">'blocked_ips'</span>],
                    <span class="hljs-string">'top_threat_types'</span>: threat_summary[<span class="hljs-string">'top_threat_types'</span>],
                    <span class="hljs-string">'recommendations'</span>: self.generate_security_recommendations(threat_summary)
                }
                
                <span class="hljs-comment"># ä¿å­˜æŠ¥å‘Š</span>
                report_key = <span class="hljs-string">f"threat_report:<span class="hljs-subst">{datetime.now().strftime(<span class="hljs-string">'%Y%m%d_%H'</span>)}</span>"</span>
                <span class="hljs-keyword">await</span> self.redis_client.setex(report_key, <span class="hljs-number">86400</span> * <span class="hljs-number">7</span>, json.dumps(report))  <span class="hljs-comment"># ä¿å­˜7å¤©</span>
                
                logging.info(<span class="hljs-string">f"Threat report generated: <span class="hljs-subst">{report_key}</span>"</span>)
                
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logging.error(<span class="hljs-string">f"Error generating threat reports: <span class="hljs-subst">{e}</span>"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">collect_threat_summary</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ”¶é›†å¨èƒæ‘˜è¦"""</span>
        <span class="hljs-comment"># å®ç°å¨èƒæ•°æ®æ”¶é›†é€»è¾‘</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'total_alerts'</span>: <span class="hljs-number">42</span>,
            <span class="hljs-string">'high_risk_users'</span>: [<span class="hljs-string">'192.168.1.100'</span>, <span class="hljs-string">'10.0.0.50'</span>],
            <span class="hljs-string">'blocked_ips'</span>: [<span class="hljs-string">'192.168.1.100'</span>],
            <span class="hljs-string">'top_threat_types'</span>: [<span class="hljs-string">'unusual_request_pattern'</span>, <span class="hljs-string">'unusual_geolocation'</span>]
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_security_recommendations</span>(<span class="hljs-params">self, threat_summary</span>):
        <span class="hljs-string">"""ç”Ÿæˆå®‰å…¨å»ºè®®"""</span>
        recommendations = []
        
        <span class="hljs-keyword">if</span> threat_summary[<span class="hljs-string">'total_alerts'</span>] &gt; <span class="hljs-number">50</span>:
            recommendations.append(<span class="hljs-string">"Consider implementing stricter access controls"</span>)
        
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(threat_summary[<span class="hljs-string">'blocked_ips'</span>]) &gt; <span class="hljs-number">5</span>:
            recommendations.append(<span class="hljs-string">"Review and potentially expand IP blocking policies"</span>)
        
        recommendations.append(<span class="hljs-string">"Regular security awareness training for development teams"</span>)
        recommendations.append(<span class="hljs-string">"Consider implementing additional MFA for administrative access"</span>)
        
        <span class="hljs-keyword">return</span> recommendations
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_all_monitoring</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å¯åŠ¨æ‰€æœ‰ç›‘æ§ä»»åŠ¡"""</span>
        logging.info(<span class="hljs-string">"Starting Nginx APT monitoring system..."</span>)
        
        <span class="hljs-comment"># å¹¶å‘è¿è¡Œæ‰€æœ‰ç›‘æ§ä»»åŠ¡</span>
        <span class="hljs-keyword">await</span> asyncio.gather(*self.monitoring_tasks)

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹å’Œéƒ¨ç½²é…ç½®</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># åˆ›å»ºç›‘æ§å®ä¾‹</span>
    monitor = NginxAPTMonitor(<span class="hljs-string">'/var/log/nginx/access.log'</span>)
    
    <span class="hljs-comment"># å¯åŠ¨ç›‘æ§</span>
    asyncio.run(monitor.start_all_monitoring())
</code></pre>
<hr/>
<h3 data-id="heading-48">ğŸ¯ æ€»ç»“ï¼šæ„å»ºä¼ä¸šçº§å®‰å…¨é˜²çº¿çš„å®Œæ•´è·¯å¾„</h3>
<p>é€šè¿‡æœ¬æ–‡çš„æ·±å…¥æ¢è®¨ï¼Œæˆ‘ä»¬å·²ç»ä»åŸºç¡€çš„Nginxå®‰å…¨åŠ å›ºï¼Œé€æ­¥æ„å»ºäº†ä¸€ä¸ªæ¶µç›–<strong>äº‘åŸç”Ÿæ¶æ„</strong>ã€<strong>AIæ™ºèƒ½é˜²æŠ¤</strong>ã€<strong>ä¼ä¸šé›†æˆ</strong>å’Œ<strong>é«˜çº§å¨èƒæ£€æµ‹</strong>çš„å®Œæ•´å®‰å…¨ä½“ç³»ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è¿™ä¸ªæ¸è¿›å¼çš„å®‰å…¨å»ºè®¾è·¯å¾„ï¼š</p>
<h4 data-id="heading-49">ğŸ›¡ï¸ åŸºç¡€å®‰å…¨ï¼ˆ90%æ¼æ´é˜²æŠ¤ï¼‰</h4>
<ul>
<li><strong>Hostå¤´æ”»å‡»é˜²æŠ¤</strong>ï¼šé€šè¿‡ä¸¥æ ¼çš„ä¸»æœºåéªŒè¯å’Œé»˜è®¤æœåŠ¡å™¨é…ç½®</li>
<li><strong>æ•æ„Ÿæ–‡ä»¶ä¿æŠ¤</strong>ï¼šä½¿ç”¨locationåŒ¹é…å’Œè®¿é—®æ§åˆ¶åˆ—è¡¨</li>
<li><strong>ç›®å½•éå†é˜²æŠ¤</strong>ï¼šURLè§„èŒƒåŒ–å¤„ç†å’Œè·¯å¾„éªŒè¯</li>
<li><strong>ç‰ˆæœ¬ä¿¡æ¯éšè—</strong>ï¼šserver_tokens offé…ç½®</li>
<li><strong>é”™è¯¯é¡µé¢å®šåˆ¶</strong>ï¼šé˜²æ­¢ä¿¡æ¯æ³„éœ²çš„ç»Ÿä¸€é”™è¯¯å¤„ç†</li>
</ul>
<h4 data-id="heading-50">â˜ï¸ äº‘åŸç”Ÿå®‰å…¨æ¶æ„</h4>
<ul>
<li><strong>Kubernetes Ingresså®‰å…¨</strong>ï¼šNetworkPolicyå’ŒRBACçš„ç²¾ç»†åŒ–æ§åˆ¶</li>
<li><strong>å®¹å™¨åŒ–æœ€ä½³å®è·µ</strong>ï¼šæœ€å°æƒé™é•œåƒå’Œå®‰å…¨ä¸Šä¸‹æ–‡</li>
<li><strong>Service Meshé›†æˆ</strong>ï¼šIstioçš„mTLSå’Œæµé‡ç­–ç•¥</li>
<li><strong>å¤šé›†ç¾¤å®‰å…¨ç­–ç•¥</strong>ï¼šç»Ÿä¸€çš„å®‰å…¨æ²»ç†å’Œåˆè§„æ£€æŸ¥</li>
</ul>
<h4 data-id="heading-51">ğŸ¤– AIé©±åŠ¨çš„æ™ºèƒ½é˜²æŠ¤</h4>
<ul>
<li><strong>æœºå™¨å­¦ä¹ å¼‚å¸¸æ£€æµ‹</strong>ï¼šå®æ—¶æµé‡åˆ†æå’Œè¡Œä¸ºåŸºçº¿å»ºç«‹</li>
<li><strong>å¨èƒæƒ…æŠ¥é›†æˆ</strong>ï¼šå¤šæºå¨èƒæ•°æ®çš„å®æ—¶å…³è”åˆ†æ</li>
<li><strong>è‡ªåŠ¨åŒ–å“åº”æœºåˆ¶</strong>ï¼šåŸºäºé£é™©è¯„åˆ†çš„æ™ºèƒ½é˜»æ–­å’Œå‘Šè­¦</li>
<li><strong>é¢„æµ‹æ€§å®‰å…¨é˜²æŠ¤</strong>ï¼šé›¶æ—¥æ¼æ´çš„æå‰é¢„è­¦å’Œé˜²æŠ¤</li>
</ul>
<h4 data-id="heading-52">ğŸ¢ ä¼ä¸šçº§é›†æˆæ–¹æ¡ˆ</h4>
<ul>
<li><strong>DevSecOpsæµæ°´çº¿</strong>ï¼šå®‰å…¨æµ‹è¯•çš„å·¦ç§»å’Œè‡ªåŠ¨åŒ–</li>
<li><strong>SIEM/SOARé›†æˆ</strong>ï¼šå®‰å…¨äº‹ä»¶çš„ç»Ÿä¸€ç®¡ç†å’Œå“åº”</li>
<li><strong>åˆè§„æ€§è‡ªåŠ¨åŒ–</strong>ï¼šGDPRã€ç­‰ä¿ç­‰æ ‡å‡†çš„è‡ªåŠ¨åˆè§„æ£€æŸ¥</li>
<li><strong>å¤šäº‘å®‰å…¨ç­–ç•¥</strong>ï¼šè·¨äº‘å¹³å°çš„ç»Ÿä¸€å®‰å…¨ç®¡ç†</li>
</ul>
<h4 data-id="heading-53">ğŸ¯ é«˜çº§å¨èƒé˜²æŠ¤ï¼ˆAPTæ£€æµ‹ï¼‰</h4>
<ul>
<li><strong>è¡Œä¸ºåˆ†æå¼•æ“</strong>ï¼šç”¨æˆ·è¡Œä¸ºåŸºçº¿å’Œå¼‚å¸¸æ£€æµ‹</li>
<li><strong>å¨èƒç‹©çŒç³»ç»Ÿ</strong>ï¼šä¸»åŠ¨å¨èƒå‘ç°å’Œæƒ…æŠ¥æ”¶é›†</li>
<li><strong>é›¶æ—¥æ¼æ´å“åº”</strong>ï¼šå¿«é€Ÿæ¼æ´è¯„ä¼°å’Œä¸´æ—¶é˜²æŠ¤</li>
<li><strong>APTæ”»å‡»é“¾æ£€æµ‹</strong>ï¼šå¤šé˜¶æ®µæ”»å‡»çš„å®Œæ•´é“¾è·¯åˆ†æ</li>
</ul>
<h4 data-id="heading-54">ğŸ“Š å®æ–½å»ºè®®ä¸æœ€ä½³å®è·µ</h4>
<h5 data-id="heading-55">1. æ¸è¿›å¼éƒ¨ç½²ç­–ç•¥</h5>
<pre><code class="hljs">é˜¶æ®µ1ï¼šåŸºç¡€å®‰å…¨åŠ å›ºï¼ˆ1-2å‘¨ï¼‰
â”œâ”€â”€ Nginxé…ç½®ä¼˜åŒ–
â”œâ”€â”€ è®¿é—®æ§åˆ¶å®æ–½
â””â”€â”€ æ—¥å¿—ç›‘æ§å»ºç«‹

é˜¶æ®µ2ï¼šé«˜çº§é˜²æŠ¤é›†æˆï¼ˆ2-4å‘¨ï¼‰
â”œâ”€â”€ WAFè§„åˆ™éƒ¨ç½²
â”œâ”€â”€ é€Ÿç‡é™åˆ¶ä¼˜åŒ–
â””â”€â”€ SSL/TLSå¼ºåŒ–

é˜¶æ®µ3ï¼šæ™ºèƒ½åŒ–å‡çº§ï¼ˆ4-8å‘¨ï¼‰
â”œâ”€â”€ AIå¼‚å¸¸æ£€æµ‹
â”œâ”€â”€ å¨èƒæƒ…æŠ¥é›†æˆ
â””â”€â”€ è‡ªåŠ¨åŒ–å“åº”

é˜¶æ®µ4ï¼šä¼ä¸šçº§æ•´åˆï¼ˆ8-12å‘¨ï¼‰
â”œâ”€â”€ DevSecOpsé›†æˆ
â”œâ”€â”€ SIEM/SOARè¿æ¥
â””â”€â”€ åˆè§„æ€§è‡ªåŠ¨åŒ–

</code></pre>
<h5 data-id="heading-56">2. å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼ˆKPIï¼‰</h5>
<ul>
<li><strong>å®‰å…¨äº‹ä»¶å“åº”æ—¶é—´</strong>ï¼šä»æ£€æµ‹åˆ°é˜»æ–­ &lt; 5åˆ†é’Ÿ</li>
<li><strong>è¯¯æŠ¥ç‡</strong>ï¼šAIæ£€æµ‹è¯¯æŠ¥ &lt; 5%</li>
<li><strong>ç³»ç»Ÿå¯ç”¨æ€§</strong>ï¼šå®‰å…¨æœåŠ¡å¯ç”¨æ€§ &gt; 99.9%</li>
<li><strong>åˆè§„è¦†ç›–ç‡</strong>ï¼šè‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥ &gt; 95%</li>
</ul>
<h5 data-id="heading-57">3. è¿ç»´ç›‘æ§è¦ç‚¹</h5>
<ul>
<li><strong>å®æ—¶ç›‘æ§</strong>ï¼š24/7å®‰å…¨è¿è¥ä¸­å¿ƒ</li>
<li><strong>å®šæœŸè¯„ä¼°</strong>ï¼šæœˆåº¦å®‰å…¨æ€åŠ¿åˆ†æ</li>
<li><strong>å¨èƒç‹©çŒ</strong>ï¼šå­£åº¦ä¸»åŠ¨å¨èƒæœç´¢</li>
<li><strong>åº”æ€¥æ¼”ç»ƒ</strong>ï¼šåŠå¹´åº¦å®‰å…¨äº‹ä»¶æ¼”ç»ƒ</li>
</ul>
<h4 data-id="heading-58">ğŸ”® æœªæ¥å‘å±•è¶‹åŠ¿</h4>
<p>éšç€æŠ€æœ¯çš„ä¸æ–­æ¼”è¿›ï¼ŒNginxå®‰å…¨ç½‘å…³ä¹Ÿå°†é¢ä¸´æ–°çš„æŒ‘æˆ˜å’Œæœºé‡ï¼š</p>
<h5 data-id="heading-59">1. é›¶ä¿¡ä»»æ¶æ„é›†æˆ</h5>
<ul>
<li><strong>å¾®åˆ†æ®µæŠ€æœ¯</strong>ï¼šæ›´ç»†ç²’åº¦çš„ç½‘ç»œåˆ†æ®µ</li>
<li><strong>èº«ä»½æ„ŸçŸ¥ä»£ç†</strong>ï¼šåŸºäºèº«ä»½çš„åŠ¨æ€è®¿é—®æ§åˆ¶</li>
<li><strong>æŒç»­ä¿¡ä»»è¯„ä¼°</strong>ï¼šå®æ—¶çš„ä¿¡ä»»åº¦è®¡ç®—å’Œå†³ç­–</li>
</ul>
<h5 data-id="heading-60">2. é‡å­å®‰å…¨å‡†å¤‡</h5>
<ul>
<li><strong>åé‡å­å¯†ç å­¦</strong>ï¼šæŠ—é‡å­è®¡ç®—æ”»å‡»çš„åŠ å¯†ç®—æ³•</li>
<li><strong>é‡å­å¯†é’¥åˆ†å‘</strong>ï¼šé‡å­é€šä¿¡æŠ€æœ¯çš„å®‰å…¨åº”ç”¨</li>
<li><strong>æ··åˆåŠ å¯†æ–¹æ¡ˆ</strong>ï¼šä¼ ç»Ÿä¸é‡å­å®‰å…¨çš„å¹³æ»‘è¿‡æ¸¡</li>
</ul>
<h5 data-id="heading-61">3. è¾¹ç¼˜è®¡ç®—å®‰å…¨</h5>
<ul>
<li><strong>è¾¹ç¼˜èŠ‚ç‚¹é˜²æŠ¤</strong>ï¼šåˆ†å¸ƒå¼è¾¹ç¼˜ç¯å¢ƒçš„å®‰å…¨ç®¡ç†</li>
<li><strong>5Gç½‘ç»œå®‰å…¨</strong>ï¼šæ–°ä¸€ä»£ç½‘ç»œçš„å®‰å…¨æŒ‘æˆ˜</li>
<li><strong>IoTè®¾å¤‡é›†æˆ</strong>ï¼šæµ·é‡ç‰©è”ç½‘è®¾å¤‡çš„å®‰å…¨æ¥å…¥</li>
</ul>
<h4 data-id="heading-62">ğŸ’¡ æœ€åçš„å»ºè®®</h4>
<p>æ„å»ºä¼ä¸šçº§å®‰å…¨é˜²çº¿æ˜¯ä¸€ä¸ª<strong>æŒç»­æ¼”è¿›</strong>çš„è¿‡ç¨‹ï¼Œè€Œéä¸€æ¬¡æ€§é¡¹ç›®ã€‚å»ºè®®é‡‡ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š</p>
<ol>
<li><strong>å®‰å…¨ä¼˜å…ˆ</strong>ï¼šåœ¨ç³»ç»Ÿè®¾è®¡çš„æ¯ä¸ªé˜¶æ®µéƒ½å°†å®‰å…¨ä½œä¸ºé¦–è¦è€ƒè™‘</li>
<li><strong>åˆ†å±‚é˜²æŠ¤</strong>ï¼šå®æ–½å¤šå±‚é˜²å¾¡ç­–ç•¥ï¼Œé¿å…å•ç‚¹å¤±æ•ˆ</li>
<li><strong>è‡ªåŠ¨åŒ–ä¼˜å…ˆ</strong>ï¼šå°½å¯èƒ½è‡ªåŠ¨åŒ–å®‰å…¨æµç¨‹ï¼Œå‡å°‘äººä¸ºé”™è¯¯</li>
<li><strong>æŒç»­å­¦ä¹ </strong>ï¼šä¿æŒå¯¹æ–°å¨èƒå’Œå®‰å…¨æŠ€æœ¯çš„æŒç»­å­¦ä¹ </li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šå»ºç«‹è·¨éƒ¨é—¨çš„å®‰å…¨åä½œæœºåˆ¶</li>
</ol>
<p>è®°ä½ï¼Œ<strong>æœ€å¥½çš„å®‰å…¨ä¸æ˜¯æœ€å¼ºçš„é˜²æŠ¤ï¼Œè€Œæ˜¯æœ€é€‚åˆçš„å¹³è¡¡</strong>ã€‚åœ¨è¿½æ±‚æè‡´å®‰å…¨çš„åŒæ—¶ï¼Œä¹Ÿè¦è€ƒè™‘ç³»ç»Ÿçš„å¯ç”¨æ€§ã€æ€§èƒ½å’Œæˆæœ¬æ•ˆç›Šã€‚é€šè¿‡æœ¬æ–‡æä¾›çš„è¿™å¥—å®Œæ•´è§£å†³æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªèº«éœ€æ±‚å’Œç¯å¢ƒç‰¹ç‚¹ï¼Œé€‰æ‹©æœ€é€‚åˆçš„å®‰å…¨å»ºè®¾è·¯å¾„ï¼Œé€æ­¥æ„å»ºèµ·åšä¸å¯æ‘§çš„ä¼ä¸šçº§å®‰å…¨é˜²çº¿ã€‚</p>
<p>å®‰å…¨ä¹‹è·¯ï¼Œæ°¸æ— æ­¢å¢ƒã€‚è®©æˆ‘ä»¬æºæ‰‹å…±å»ºæ›´å®‰å…¨çš„æ•°å­—ä¸–ç•Œï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>