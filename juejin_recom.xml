<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[用python从数据看世界，看看算法是如何分析你的]]></title>    <link>https://juejin.cn/post/7599924965950652454</link>    <guid>https://juejin.cn/post/7599924965950652454</guid>    <pubDate>2026-01-27T14:47:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599924965950652454" data-draft-id="7599920572840296457" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用python从数据看世界，看看算法是如何分析你的"/> <meta itemprop="keywords" content="Python,数据可视化"/> <meta itemprop="datePublished" content="2026-01-27T14:47:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码飞一会儿"/> <meta itemprop="url" content="https://juejin.cn/user/555695627842490"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用python从数据看世界，看看算法是如何分析你的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/555695627842490/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码飞一会儿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:47:51.000Z" title="Tue Jan 27 2026 14:47:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、数据分析与处理</h2>
<h3 data-id="heading-1">（一） 数据的导入导出</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 数据的导入</span>
import pandas as pd
<span class="hljs-attr">df</span>= pd.read_csv(<span class="hljs-string">'data/data.csv'</span>)
</code></pre>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#数据的导出</span>
<span class="hljs-built_in">df</span>= df.tail()
df.to_csv(<span class="hljs-string">'data/output.csv'</span>)
</code></pre>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 简单json</span>
<span class="hljs-attr">df</span>= pd.read_json(<span class="hljs-string">'data/data.json'</span>)
</code></pre>

<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 复杂json</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'data/data_complex.json'</span>) <span class="hljs-keyword">as</span> f:
    data = json.load(f)
</code></pre>
<h3 data-id="heading-2">（二） 问题数据处理</h3>
<h4 data-id="heading-3">1. 缺失值处理</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
s=pd.Series([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,np.nan,<span class="hljs-literal">None</span>,pd.NA])
df=pd.DataFrame([[<span class="hljs-number">1</span>,pd.NA],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>],[<span class="hljs-literal">None</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>]],columns=[<span class="hljs-string">'第一列'</span>,<span class="hljs-string">'第二列'</span>,<span class="hljs-string">'第三列'</span>])<span class="hljs-comment"># # # 查看是否是缺失值</span>
<span class="hljs-built_in">print</span>(s.isna())
<span class="hljs-built_in">print</span>(s.isnull())
<span class="hljs-built_in">print</span>(df.isna())
<span class="hljs-built_in">print</span>(df.isnull())
<span class="hljs-built_in">print</span>(df.isna().<span class="hljs-built_in">sum</span>(axis=<span class="hljs-number">1</span>))
<span class="hljs-built_in">print</span>(s.isna().<span class="hljs-built_in">sum</span>()) <span class="hljs-comment"># 查看缺失值的个数</span>
</code></pre>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 剔除缺失值</span>
print(s.dropna())
print(df.dropna())
print(df.dropna(<span class="hljs-attr">how</span>=<span class="hljs-string">'all'</span>)) <span class="hljs-comment"># 如果所有的值都是缺失值，删除这一行</span>
print(df.dropna(<span class="hljs-attr">thresh</span>=<span class="hljs-number">2</span>)) <span class="hljs-comment"># 如果至少有n个值不是缺失值，就保留</span>
print(df.dropna(<span class="hljs-attr">axis</span>=<span class="hljs-number">1</span>)) <span class="hljs-comment"># 剔除一整列的记录</span>
print(df.dropna(<span class="hljs-attr">subset</span>=[<span class="hljs-string">'第一列'</span>])) <span class="hljs-comment"># 如果某列有缺失值，则删除这一行</span>
</code></pre>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 填充缺失值</span>
<span class="hljs-built_in">df</span>=pd.read_csv(<span class="hljs-string">'data/data_withNA.csv'</span>)
df.isna().<span class="hljs-built_in">sum</span>(axis=0)
<span class="hljs-built_in">print</span>(df.fillna({<span class="hljs-string">'join_date'</span>:20})) <span class="hljs-comment"># 使用字典来填充</span>
<span class="hljs-built_in">print</span>(df.fillna(<span class="hljs-built_in">df</span>[[<span class="hljs-string">'age'</span>]].mean())) <span class="hljs-comment"># 使用统计值来填充</span>
<span class="hljs-built_in">print</span>(df.ffill()) <span class="hljs-comment"># 用前面的相邻值填充</span>
<span class="hljs-built_in">print</span>(df.bfill()) <span class="hljs-comment"># 用后面的相邻值填充</span>
</code></pre>
<h4 data-id="heading-4">2. 去重处理</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">data</span> = {
    <span class="hljs-string">"name"</span>:[<span class="hljs-string">'alice'</span> ,<span class="hljs-string">'alice'</span> ,<span class="hljs-string">'bob'</span> ,<span class="hljs-string">'alice'</span> ,<span class="hljs-string">'jack'</span> ,<span class="hljs-string">'bob'</span> ],
    <span class="hljs-string">"age"</span>: [<span class="hljs-number">26</span>,<span class="hljs-number">25</span>,<span class="hljs-number">30</span>,<span class="hljs-number">25</span>,<span class="hljs-number">35</span>,<span class="hljs-number">30</span>],
    <span class="hljs-string">"city"</span>:[<span class="hljs-string">'NY'</span> ,<span class="hljs-string">'NY'</span> ,<span class="hljs-string">'LA'</span> ,<span class="hljs-string">'NY'</span> , <span class="hljs-string">'SF'</span> , <span class="hljs-string">'LA'</span> ]
}
df=pd.DataFrame(<span class="hljs-keyword">data</span>)
</code></pre>

<pre><code class="hljs language-ini" lang="ini">df.duplicated() <span class="hljs-comment"># 一整条记录都是一样的，标记为重复，返回True</span>
df.drop_duplicates(<span class="hljs-attr">subset</span>=[<span class="hljs-string">'name'</span>])<span class="hljs-comment"># 根据指定列去重</span>
df.drop_duplicates(<span class="hljs-attr">subset</span>=[<span class="hljs-string">'name'</span>],keep=<span class="hljs-string">'last'</span>) <span class="hljs-comment"># 保留最后一次出现的行</span>
</code></pre>
<h4 data-id="heading-5">3. 数据类型的转换</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">df</span>[<span class="hljs-string">'age'</span>]=<span class="hljs-built_in">df</span>[<span class="hljs-string">'age'</span>].astype(<span class="hljs-string">'int16'</span>)
</code></pre>
<h4 data-id="heading-6">4. 数据变形</h4>
<pre><code class="hljs language-ini" lang="ini">import pandas as pd
<span class="hljs-attr">data</span> = {
    'ID': <span class="hljs-section">[1, 2]</span>,
    'name' : <span class="hljs-section">['alice', 'bob' ]</span>,
    'Math': <span class="hljs-section">[90, 85]</span>,
    'English': <span class="hljs-section">[88, 92]</span>,
    'Science': <span class="hljs-section">[95, 89]</span>
}
<span class="hljs-attr">df</span> = pd.DataFrame(data)
df.T <span class="hljs-comment"># 转置</span>
<span class="hljs-comment">#宽表转换为长表</span>
<span class="hljs-attr">df2</span>=pd.melt(df,id_vars=[<span class="hljs-string">'ID'</span>,<span class="hljs-string">'name'</span>],var_name=<span class="hljs-string">'科目'</span>,value_name=<span class="hljs-string">'分数'</span>)
df2.sort_values('name') <span class="hljs-comment">#排序</span>
<span class="hljs-comment">#长表转宽表</span>
pd.pivot(df2,<span class="hljs-attr">index</span>=[<span class="hljs-string">'ID'</span>,<span class="hljs-string">'name'</span>],columns=<span class="hljs-string">'科目'</span>,values=<span class="hljs-string">'分数'</span>)
</code></pre>

<pre><code class="hljs language-bash" lang="bash">data = {
<span class="hljs-string">'ID'</span>: [1, 2],
<span class="hljs-string">'name'</span> : [<span class="hljs-string">'alice smith'</span> , <span class="hljs-string">'bob smith'</span> ],
<span class="hljs-string">'Math'</span>: [90, 85],
<span class="hljs-string">'English'</span>: [88, 92],
<span class="hljs-string">'Science'</span>: [95, 89]
}
<span class="hljs-built_in">df</span> = pd.DataFrame(data)
<span class="hljs-comment"># 分列</span>
<span class="hljs-built_in">df</span>[[<span class="hljs-string">'first'</span>,<span class="hljs-string">'last'</span>]]= <span class="hljs-built_in">df</span>[<span class="hljs-string">'name'</span>].str.split(<span class="hljs-string">' '</span>,<span class="hljs-built_in">expand</span>=True)
</code></pre>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 数据分箱 pd.cat(x,bins,labels)</span>
<span class="hljs-attr">df1</span>=df.head(<span class="hljs-number">5</span>)[[<span class="hljs-string">'id'</span>,<span class="hljs-string">'age'</span>]]
pd.cut(df1<span class="hljs-section">['age']</span>,<span class="hljs-attr">bins</span>=<span class="hljs-number">2</span>) <span class="hljs-comment"># bins=n，分成n段区间，起始值、结束值是所有数据的最小值、最大值</span>
pd.cut(df1<span class="hljs-section">['age']</span>,<span class="hljs-attr">bins</span>=<span class="hljs-number">2</span>).value_counts()
pd.cut(df1<span class="hljs-section">['age']</span>,<span class="hljs-attr">bins</span>=[<span class="hljs-number">0</span>,<span class="hljs-number">25</span>,<span class="hljs-number">35</span>,<span class="hljs-number">45</span>]) <span class="hljs-comment"># bins=list,分成n段区间</span>
pd.cut(df1<span class="hljs-section">['age']</span>,<span class="hljs-attr">bins</span>=[<span class="hljs-number">0</span>,<span class="hljs-number">25</span>,<span class="hljs-number">35</span>,<span class="hljs-number">45</span>]).value_counts()
pd.cut(df1<span class="hljs-section">['age']</span>,<span class="hljs-attr">bins</span>=[<span class="hljs-number">0</span>,<span class="hljs-number">25</span>,<span class="hljs-number">35</span>,<span class="hljs-number">45</span>],labels=[<span class="hljs-string">'幼'</span>,<span class="hljs-string">'中'</span>,<span class="hljs-string">'老'</span>])
pd.qcut(df1<span class="hljs-section">['age']</span>,3)
</code></pre>

<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 重命名</span>
df = pd.DataFrame(
    {
        <span class="hljs-string">'name'</span> : [ <span class="hljs-string">'jack'</span> ,<span class="hljs-string">'alice'</span> , <span class="hljs-string">'tom'</span> , <span class="hljs-string">'bob'</span> ],
        <span class="hljs-string">'age'</span>:[<span class="hljs-number">20</span>,<span class="hljs-number">30</span>,<span class="hljs-number">40</span>,<span class="hljs-number">50</span>],
        <span class="hljs-string">'gender'</span> : [<span class="hljs-string">'female'</span> , <span class="hljs-string">'male'</span> , <span class="hljs-string">' female'</span> , <span class="hljs-string">'male'</span> ]
    }
)
df.set_index(<span class="hljs-string">'name'</span>,inplace=<span class="hljs-literal">True</span>)
df.reset_index(inplace=<span class="hljs-literal">True</span>)
df.rename(columns={<span class="hljs-string">'age'</span>:<span class="hljs-string">"年龄"</span>},index={<span class="hljs-number">0</span>:<span class="hljs-number">4</span>})
</code></pre>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">df.index</span>=[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]
<span class="hljs-attr">df.columns</span>=[<span class="hljs-string">'姓名'</span>,<span class="hljs-string">'年龄'</span>,<span class="hljs-string">'性别'</span>]
</code></pre>
<h4 data-id="heading-7">5. 时间数据处理</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
d = pd.Timestamp(<span class="hljs-string">'2015-05-02 10:22'</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'年：'</span>,d.year)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'季度：'</span>,d.quarter)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'是否是月底:'</span>,d.is_month_end)
<span class="hljs-comment"># 方法</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">'星期几：'</span>,d.day_name())
<span class="hljs-built_in">print</span>(<span class="hljs-string">'转换为天：'</span>,d.to_period(<span class="hljs-string">'D'</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">'转换为季度：'</span>,d.to_period(<span class="hljs-string">'Q'</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">'转换为年度：'</span>,d.to_period(<span class="hljs-string">'Y'</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">'转换为月度：'</span>,d.to_period(<span class="hljs-string">'M'</span>))
</code></pre>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 字符串转换为日期类型</span>
a = pd.to_datetime(<span class="hljs-string">'2015-01-04 10:22'</span>)
<span class="hljs-built_in">print</span>(a)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(a))

<span class="hljs-comment"># dataFrame 日期转换</span>
<span class="hljs-built_in">df</span>= pd.DataFrame(
    {
        <span class="hljs-string">'sales'</span>:[100,200,300],
        <span class="hljs-string">'date'</span>:[<span class="hljs-string">'20250601'</span>,<span class="hljs-string">'20250704'</span>,<span class="hljs-string">'20250506'</span>]
    }
)
<span class="hljs-built_in">df</span>[<span class="hljs-string">'datatime'</span>]=pd.to_datetime(<span class="hljs-built_in">df</span>[<span class="hljs-string">'date'</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-built_in">df</span>[<span class="hljs-string">'datatime'</span>]))
<span class="hljs-built_in">df</span>[<span class="hljs-string">'week'</span>] = <span class="hljs-built_in">df</span>[<span class="hljs-string">'datatime'</span>].dt.day_name()
</code></pre>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 日期数据作为索引</span>
df.set_index('date',<span class="hljs-attr">inplace</span>=<span class="hljs-literal">True</span>) <span class="hljs-comment"># 设置原来的df的索引</span>
<span class="hljs-comment">#print(df.loc['2025-05-06':'2025-07-04'])</span>
</code></pre>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 时间间隔</span>
<span class="hljs-attr">d1</span> = pd. Timestamp(<span class="hljs-string">'2013-01-15'</span>)
<span class="hljs-attr">d2</span> = pd.Timestamp(<span class="hljs-string">'2023-02-23'</span>)
<span class="hljs-attr">d3</span> = d2-d1
print(type(d3))
</code></pre>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 日期生成</span>
<span class="hljs-attr">days</span>= pd.date_range(<span class="hljs-string">'2025-07-03'</span>,<span class="hljs-string">'2026-01-04'</span>,freq=<span class="hljs-string">'W'</span>)
print(days)
<span class="hljs-attr">days</span>= pd.date_range(<span class="hljs-string">'2025-07-03'</span>,periods=<span class="hljs-number">10</span>,freq=<span class="hljs-string">'W'</span>)
print(days)
</code></pre>
<h4 data-id="heading-8">6. 分组聚合</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">df.groupby(<span class="hljs-string">'分组的字段'</span>)[<span class="hljs-string">'聚合的字段'</span>].聚合函数()</span>
<span class="hljs-meta prompt_"># </span><span class="bash">df.groupby(<span class="hljs-string">'分组的字段'</span>).<span class="hljs-built_in">groups</span> <span class="hljs-comment"># 查看分组</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">df.groupby(<span class="hljs-string">'分组的字段'</span>).get_group(n) <span class="hljs-comment"># 查看具体的某个分组数据</span></span>
</code></pre>
<h2 data-id="heading-9">二、数据可视化</h2>
<h3 data-id="heading-10">（一）matplotlib</h3>
<p><code>matplotlib</code> 是 Python 中最常用的数据可视化库之一，主要用于绘制 2D 图表（也支持简单的 3D 绘图）。它功能强大、灵活，广泛应用于科学计算、数据分析和机器学习等领域。</p>
<h4 data-id="heading-11">折线图</h4>
<pre><code class="hljs language-ini" lang="ini">import matplotlib.pyplot as plt
from matplotlib import rcParams
<span class="hljs-comment"># 设置中文字体（确保支持中文显示）</span>
rcParams<span class="hljs-section">['font.sans-serif']</span> = <span class="hljs-section">['STKAITI']</span>  <span class="hljs-comment"># 使用黑体或华文楷体</span>
<span class="hljs-comment"># 数据</span>
<span class="hljs-attr">months</span> = [<span class="hljs-string">'1月'</span>, <span class="hljs-string">'2月'</span>, <span class="hljs-string">'3月'</span>, <span class="hljs-string">'4月'</span>]
<span class="hljs-attr">sales</span> = [<span class="hljs-number">100</span>, <span class="hljs-number">150</span>, <span class="hljs-number">80</span>, <span class="hljs-number">130</span>]
<span class="hljs-comment"># 创建图形和轴</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))
<span class="hljs-comment"># 绘制折线图</span>
plt.plot(months, sales, <span class="hljs-attr">marker</span>=<span class="hljs-string">'o'</span>, color=<span class="hljs-string">'orange'</span>, linewidth=<span class="hljs-number">2</span>, markersize=<span class="hljs-number">6</span>)
<span class="hljs-comment"># 添加标题</span>
plt.title('2025年销售趋势', <span class="hljs-attr">fontsize</span>=<span class="hljs-number">18</span>, color=<span class="hljs-string">'red'</span>, pad=<span class="hljs-number">20</span>)
<span class="hljs-comment"># 设置坐标轴标签</span>
plt.xlabel('月份', <span class="hljs-attr">fontsize</span>=<span class="hljs-number">12</span>)
plt.ylabel('销售额（万元）', <span class="hljs-attr">fontsize</span>=<span class="hljs-number">12</span>)
<span class="hljs-comment"># 设置y轴范围</span>
plt.ylim(0, 160)
<span class="hljs-comment"># 添加网格线</span>
plt.grid(True, <span class="hljs-attr">alpha</span>=<span class="hljs-number">0.3</span>, linestyle=<span class="hljs-string">'--'</span>, linewidth=<span class="hljs-number">0.8</span>)
<span class="hljs-comment"># 添加图例</span>
plt.legend(<span class="hljs-section">['产品A']</span>, <span class="hljs-attr">loc</span>=<span class="hljs-string">'upper left'</span>, frameon=<span class="hljs-literal">True</span>, fancybox=<span class="hljs-literal">True</span>, shadow=<span class="hljs-literal">False</span>)
<span class="hljs-comment"># 在每个数据点上标注数值</span>
for i, (x, y) in enumerate(zip(months, sales)):
    plt.text(x, y + 2, str(y), <span class="hljs-attr">ha</span>=<span class="hljs-string">'center'</span>, va=<span class="hljs-string">'bottom'</span>, fontsize=<span class="hljs-number">10</span>, color=<span class="hljs-string">'black'</span>)
<span class="hljs-comment"># 调整布局，避免标签被裁剪</span>
plt.tight_layout()
<span class="hljs-comment"># 显示图表</span>
plt.show()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91e9ddeaca9042e4a6b60fe5ff5c8ea9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=AC6R9y9YbkgvvKWsr6V%2FyeTB0ss%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12">柱状图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 绘制柱状图</span>
import matplotlib.pyplot as plt
from matplotlib import rcParams <span class="hljs-comment"># 字体</span>
<span class="hljs-comment">#rcParams['font.family'] = 'STKAITI' #华文楷体</span>
rcParams<span class="hljs-section">['font.sans-serif']</span> ='STKAITI' <span class="hljs-comment">#华文楷体</span>
<span class="hljs-comment"># 创建图表，设置大小</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>,<span class="hljs-number">5</span>))
<span class="hljs-comment"># 要绘图的数据</span>
<span class="hljs-attr">subjects</span>=[<span class="hljs-string">'语文'</span>,<span class="hljs-string">'数学'</span>,<span class="hljs-string">'英语'</span>,<span class="hljs-string">'化学'</span>]
<span class="hljs-attr">scores</span>=[<span class="hljs-number">85</span>,<span class="hljs-number">92</span>,<span class="hljs-number">78</span>,<span class="hljs-number">88</span>]
<span class="hljs-comment"># 绘制柱状图</span>
plt.bar(subjects,scores,<span class="hljs-attr">label</span>=<span class="hljs-string">'小红'</span>,color=<span class="hljs-string">'orange'</span>,width=<span class="hljs-number">0.6</span>)
<span class="hljs-comment"># 添加标题</span>
plt.title('2025成绩分布',<span class="hljs-attr">color</span>=<span class="hljs-string">'red'</span>,fontsize=<span class="hljs-number">20</span>)
<span class="hljs-comment"># 添加坐标轴标签</span>
plt.xlabel('科目',<span class="hljs-attr">fontsize</span>=<span class="hljs-number">10</span>)
plt.ylabel('成绩（分）',<span class="hljs-attr">fontsize</span>=<span class="hljs-number">10</span>)
<span class="hljs-comment"># 添加图例</span>
plt.legend(<span class="hljs-attr">loc</span>=<span class="hljs-string">'upper right'</span>)
<span class="hljs-comment"># 添加网格线</span>
<span class="hljs-comment"># plt.grid(True,alpha=0.1,color='blue',linestyle='--') # '-':实线 ；'--'：虚线</span>
plt.grid(<span class="hljs-attr">axis</span>=<span class="hljs-string">'y'</span>,alpha=<span class="hljs-number">0.1</span>,color=<span class="hljs-string">'blue'</span>,linestyle=<span class="hljs-string">'--'</span>)
<span class="hljs-comment"># 设置刻度字体大小</span>
plt.xticks(<span class="hljs-attr">rotation</span>=<span class="hljs-number">20</span>,fontsize=<span class="hljs-number">12</span>)
plt.yticks(<span class="hljs-attr">rotation</span>=<span class="hljs-number">0</span>,fontsize=<span class="hljs-number">12</span>)
<span class="hljs-comment"># 设置y轴的范围</span>
plt.ylim(0,100)
<span class="hljs-comment"># 每个数据点上显示数值</span>
for x,y in zip(subjects,scores):
    <span class="hljs-comment"># print(x,y)</span>
    plt.text(x,y+1,str(y),<span class="hljs-attr">ha</span>=<span class="hljs-string">'center'</span>,va=<span class="hljs-string">'bottom'</span>,fontsize=<span class="hljs-number">10</span>)
<span class="hljs-comment"># 自动优化排版</span>
plt.tight_layout()
<span class="hljs-comment"># 显示图表</span>
plt.show()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/002c9a89ae124f35aba3ebeae7b77de3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=fZ2PMN80lKdXpiB%2FoWWrcVUMzrM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-13">条形图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 绘制条形图</span>
import matplotlib.pyplot as plt
from matplotlib import rcParams <span class="hljs-comment"># 字体</span>
<span class="hljs-comment">#rcParams['font.family'] = 'STKAITI' #华文楷体</span>
rcParams<span class="hljs-section">['font.sans-serif']</span> ='STKAITI' <span class="hljs-comment">#华文楷体</span>
<span class="hljs-comment"># 创建图表，设置大小</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>,<span class="hljs-number">5</span>))
<span class="hljs-comment"># 要绘图的数据</span>
<span class="hljs-attr">countries</span>=[<span class="hljs-string">'United States'</span> , <span class="hljs-string">'China'</span> , <span class="hljs-string">'Japan'</span> ,<span class="hljs-string">'Germany'</span> , <span class="hljs-string">'India'</span> ]
<span class="hljs-attr">gdp</span>=[<span class="hljs-number">85</span>,<span class="hljs-number">92</span>,<span class="hljs-number">78</span>,<span class="hljs-number">88</span>,<span class="hljs-number">23</span>]
<span class="hljs-comment"># 绘制条形图</span>
plt.barh(countries,gdp,<span class="hljs-attr">label</span>=<span class="hljs-string">'GDP'</span>,color=<span class="hljs-string">'orange'</span>)
<span class="hljs-comment"># 添加标题</span>
plt.title('2025GDP排名',<span class="hljs-attr">color</span>=<span class="hljs-string">'red'</span>,fontsize=<span class="hljs-number">20</span>)
<span class="hljs-comment"># 添加坐标轴标签</span>
plt.xlabel('国家',<span class="hljs-attr">fontsize</span>=<span class="hljs-number">10</span>)
plt.ylabel('GDP（万元）',<span class="hljs-attr">fontsize</span>=<span class="hljs-number">10</span>)
<span class="hljs-comment"># 添加图例</span>
plt.legend(<span class="hljs-attr">loc</span>=<span class="hljs-string">'upper right'</span>)
<span class="hljs-comment"># 添加网格线</span>
<span class="hljs-comment"># plt.grid(True,alpha=0.1,color='blue',linestyle='--') # '-':实线 ；'--'：虚线</span>
plt.grid(<span class="hljs-attr">axis</span>=<span class="hljs-string">'x'</span>,alpha=<span class="hljs-number">0.1</span>,color=<span class="hljs-string">'blue'</span>,linestyle=<span class="hljs-string">'--'</span>)
<span class="hljs-comment"># 设置刻度字体大小</span>
plt.xticks(<span class="hljs-attr">rotation</span>=<span class="hljs-number">20</span>,fontsize=<span class="hljs-number">12</span>)
plt.yticks(<span class="hljs-attr">rotation</span>=<span class="hljs-number">0</span>,fontsize=<span class="hljs-number">12</span>)
<span class="hljs-comment"># 自动优化排版</span>
plt.tight_layout()
<span class="hljs-comment"># 显示图表</span>
plt.show()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef2e9535cdbd4a53ac8b4b38de3a70d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=jZZaFs7N1YFT8x0To6HwdjEJXsY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-14">饼图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 绘制饼图</span>
import matplotlib.pyplot as plt
from matplotlib import rcParams <span class="hljs-comment"># 字体</span>
<span class="hljs-comment">#rcParams['font.family'] = 'STKAITI' #华文楷体</span>
rcParams<span class="hljs-section">['font.sans-serif']</span> ='STKAITI' <span class="hljs-comment">#华文楷体</span>
<span class="hljs-comment"># 创建图表，设置大小</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>,<span class="hljs-number">5</span>))
<span class="hljs-comment"># 要绘图的数据</span>
<span class="hljs-attr">things</span>=[<span class="hljs-string">'学习'</span>,<span class="hljs-string">'娱乐'</span>,<span class="hljs-string">'运动'</span>,<span class="hljs-string">'睡觉'</span>,<span class="hljs-string">'其他'</span>]
<span class="hljs-attr">times</span> = [<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>]
<span class="hljs-attr">colors</span> = [<span class="hljs-string">'#66b3ff'</span>,<span class="hljs-string">'#99ff99'</span>,<span class="hljs-string">'#ffcc99'</span>,<span class="hljs-string">'#ff9999'</span>,<span class="hljs-string">'#ff4499'</span>] <span class="hljs-comment">#配色</span>
<span class="hljs-comment"># 绘制饼图</span>
plt.pie(times,<span class="hljs-attr">labels</span>=things,autopct=<span class="hljs-string">'%1.1f %%'</span>,startangle=<span class="hljs-number">30</span>,colors=colors)<span class="hljs-comment"># startangle调整初始角度</span>
<span class="hljs-comment"># 添加标题</span>
plt.title('一天时间分布',<span class="hljs-attr">color</span>=<span class="hljs-string">'red'</span>,fontsize=<span class="hljs-number">20</span>)
<span class="hljs-comment"># 自动优化排版</span>
plt.tight_layout()
<span class="hljs-comment"># 显示图表</span>
plt.show()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be9e4793368a4cfe8c4d7e3cee9cdd08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=tlJfsDi1oUcB9%2BkeOVdrCV3FieE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">环形图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 绘制环形图</span>
import matplotlib.pyplot as plt
from matplotlib import rcParams <span class="hljs-comment"># 字体</span>
<span class="hljs-comment">#rcParams['font.family'] = 'STKAITI' #华文楷体</span>
rcParams<span class="hljs-section">['font.sans-serif']</span> ='STKAITI' <span class="hljs-comment">#华文楷体</span>
<span class="hljs-comment"># 创建图表，设置大小</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>,<span class="hljs-number">5</span>))
<span class="hljs-comment"># 要绘图的数据</span>
<span class="hljs-attr">things</span>=[<span class="hljs-string">'学习'</span>,<span class="hljs-string">'娱乐'</span>,<span class="hljs-string">'运动'</span>,<span class="hljs-string">'睡觉'</span>,<span class="hljs-string">'其他'</span>]
<span class="hljs-attr">times</span> = [<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>]
<span class="hljs-attr">colors</span> = [<span class="hljs-string">'#66b3ff'</span>,<span class="hljs-string">'#99ff99'</span>,<span class="hljs-string">'#ffcc99'</span>,<span class="hljs-string">'#ff9999'</span>,<span class="hljs-string">'#ff4499'</span>] <span class="hljs-comment">#配色</span>
<span class="hljs-comment"># 绘制环形图</span>
plt.pie(times,<span class="hljs-attr">labels</span>=things,autopct=<span class="hljs-string">'%1.1f %%'</span>,
        <span class="hljs-attr">startangle</span>=<span class="hljs-number">30</span>,colors=colors,<span class="hljs-comment"># startangle调整初始角度</span>
        <span class="hljs-attr">wedgeprops</span>={<span class="hljs-string">'width'</span>:<span class="hljs-number">0.6</span>},<span class="hljs-comment"># 圆环宽度</span>
        <span class="hljs-attr">pctdistance</span>=<span class="hljs-number">0.6</span>)
<span class="hljs-comment"># 添加标题</span>
plt.title('一天时间分布',<span class="hljs-attr">color</span>=<span class="hljs-string">'red'</span>,fontsize=<span class="hljs-number">20</span>)
plt.text(0,0,'总计：\n100%')
<span class="hljs-comment"># 自动优化排版</span>
plt.tight_layout()
<span class="hljs-comment"># 显示图表</span>
plt.show()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6135a2e018d944e0abbe8e3bda7519f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=mCM%2FVOrGe8m%2B6wf5LFPFmQwaHd4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">爆炸式饼图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 绘制爆炸式饼图</span>
import matplotlib.pyplot as plt
from matplotlib import rcParams <span class="hljs-comment"># 字体</span>
<span class="hljs-comment">#rcParams['font.family'] = 'STKAITI' #华文楷体</span>
rcParams<span class="hljs-section">['font.sans-serif']</span> ='STKAITI' <span class="hljs-comment">#华文楷体</span>
<span class="hljs-comment"># 创建图表，设置大小</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>,<span class="hljs-number">5</span>))
<span class="hljs-comment"># 要绘图的数据</span>
<span class="hljs-attr">things</span>=[<span class="hljs-string">'学习'</span>,<span class="hljs-string">'娱乐'</span>,<span class="hljs-string">'运动'</span>,<span class="hljs-string">'睡觉'</span>,<span class="hljs-string">'其他'</span>]
<span class="hljs-attr">times</span> = [<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">8</span>,<span class="hljs-number">5</span>]
<span class="hljs-attr">colors</span> = [<span class="hljs-string">'#66b3ff'</span>,<span class="hljs-string">'#99ff99'</span>,<span class="hljs-string">'#ffcc99'</span>,<span class="hljs-string">'#ff9999'</span>,<span class="hljs-string">'#ff4499'</span>] <span class="hljs-comment">#配色</span>
<span class="hljs-attr">explode</span> = [<span class="hljs-number">0.2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<span class="hljs-comment"># 设置突出块的位置</span>
<span class="hljs-comment"># 绘制爆炸式饼图</span>
plt.pie(times,<span class="hljs-attr">labels</span>=things,autopct=<span class="hljs-string">'%1.1f %%'</span>,startangle=<span class="hljs-number">30</span>,colors=colors,explode=explode,shadow=<span class="hljs-literal">True</span>)<span class="hljs-comment"># startangle调整初始角度</span>
<span class="hljs-comment"># 添加标题</span>
plt.title('一天时间分布',<span class="hljs-attr">color</span>=<span class="hljs-string">'red'</span>,fontsize=<span class="hljs-number">20</span>)
<span class="hljs-comment"># 自动优化排版</span>
plt.tight_layout()
<span class="hljs-comment"># 显示图表</span>
plt.show()
</code></pre>
<h4 data-id="heading-17"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b72deafb14a47e1986e91761c196eaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=lVehYO%2FS%2Fimn2mQtYIq%2BNKJE56Q%3D" alt="" loading="lazy"/></h4>
<h4 data-id="heading-18">散点图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 绘制散点图</span>
import random
import matplotlib.pyplot as plt
from matplotlib import rcParams <span class="hljs-comment"># 字体</span>
<span class="hljs-comment">#rcParams['font.family'] = 'STKAITI' #华文楷体</span>
rcParams<span class="hljs-section">['font.sans-serif']</span> ='STKAITI' <span class="hljs-comment">#华文楷体</span>
<span class="hljs-comment"># 创建图表，设置大小</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">10</span>,<span class="hljs-number">8</span>))
<span class="hljs-comment"># 要绘图的数据</span>
<span class="hljs-attr">x</span>=[]
<span class="hljs-attr">y</span>=[]
for i in range (1000):
    <span class="hljs-attr">tmp</span>=random.uniform(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>)
    x.append(tmp)
    y.append(2*tmp+random.gauss(0,2))
<span class="hljs-comment"># 绘制散点图</span>
plt.scatter(x,y,<span class="hljs-attr">color</span>=<span class="hljs-string">'blue'</span>,alpha=<span class="hljs-number">0.5</span>,s=<span class="hljs-number">20</span>,label=<span class="hljs-string">"数据"</span>)
<span class="hljs-comment"># 添加标题</span>
plt.title('x变量与y变量的关系',<span class="hljs-attr">color</span>=<span class="hljs-string">'red'</span>,fontsize=<span class="hljs-number">20</span>)
<span class="hljs-comment"># 添加坐标轴标签</span>
plt.xlabel('x自变量',<span class="hljs-attr">fontsize</span>=<span class="hljs-number">10</span>)
plt.ylabel('y因变量',<span class="hljs-attr">fontsize</span>=<span class="hljs-number">10</span>)
<span class="hljs-comment"># 添加图例</span>
plt.legend(<span class="hljs-attr">loc</span>=<span class="hljs-string">'upper left'</span>)
<span class="hljs-comment"># 添加网格线</span>
plt.grid(True,<span class="hljs-attr">alpha</span>=<span class="hljs-number">0.1</span>,color=<span class="hljs-string">'blue'</span>,linestyle=<span class="hljs-string">'--'</span>) <span class="hljs-comment"># '-':实线 ；'--'：虚线</span>
<span class="hljs-comment"># plt.grid(axis='x')</span>
<span class="hljs-comment"># 设置刻度字体大小</span>
plt.xticks(<span class="hljs-attr">rotation</span>=<span class="hljs-number">20</span>,fontsize=<span class="hljs-number">12</span>)
plt.yticks(<span class="hljs-attr">rotation</span>=<span class="hljs-number">0</span>,fontsize=<span class="hljs-number">12</span>)
<span class="hljs-comment"># 设置y轴的范围</span>
plt.ylim(0,30)
plt.plot(<span class="hljs-section">[0,10]</span>,<span class="hljs-section">[0,20]</span>,<span class="hljs-attr">color</span>=<span class="hljs-string">'orange'</span>,linewidth=<span class="hljs-number">3</span>,linestyle=<span class="hljs-string">'--'</span>)
<span class="hljs-comment"># 显示图表</span>
plt.show()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78de9218511548dfa886c1935c8d1aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=Z035P5k1RdtAyXAis4Zwk2wPhiU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">箱线图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 绘制箱线图</span>
import matplotlib.pyplot as plt
from matplotlib import rcParams <span class="hljs-comment"># 字体</span>
<span class="hljs-comment">#rcParams['font.family'] = 'STKAITI' #华文楷体</span>
rcParams<span class="hljs-section">['font.sans-serif']</span> ='STKAITI' <span class="hljs-comment">#华文楷体</span>
<span class="hljs-comment"># 创建图表，设置大小</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">8</span>,<span class="hljs-number">6</span>))
<span class="hljs-comment"># 要绘图的数据</span>
<span class="hljs-attr">data</span> ={
    '语文':<span class="hljs-section">[82,85,88,70,90,76,84, 83,95]</span>,
    '数学':<span class="hljs-section">[75,80,79,93,88,82,87,89,92]</span>,
    '英语':<span class="hljs-section">[70,72,68,65,78,80,85,90,95]</span>
}
<span class="hljs-comment"># 绘制散点图</span>
plt.boxplot(data.values(),<span class="hljs-attr">tick_labels</span>=data.keys())
<span class="hljs-comment"># 添加标题</span>
plt.title('各科成绩分布(箱线图)',<span class="hljs-attr">color</span>=<span class="hljs-string">'red'</span>,fontsize=<span class="hljs-number">20</span>)
<span class="hljs-comment"># 添加坐标轴标签</span>
plt.ylabel('分数',<span class="hljs-attr">fontsize</span>=<span class="hljs-number">10</span>)
<span class="hljs-comment"># 添加网格线</span>
plt.grid(True,<span class="hljs-attr">alpha</span>=<span class="hljs-number">0.1</span>,color=<span class="hljs-string">'blue'</span>,linestyle=<span class="hljs-string">'--'</span>) <span class="hljs-comment"># '-':实线 ；'--'：虚线</span>
<span class="hljs-comment"># plt.grid(axis='x')</span>
<span class="hljs-comment"># 显示图表</span>
plt.show()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4113bee7cc2f42409992483585616d62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=0wYGyz88Rvj1LYvN7jdNSibUR3M%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">多个图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 多个图的绘制方法</span>
import matplotlib.pyplot as plt
<span class="hljs-comment"># 要绘图的数据</span>
<span class="hljs-attr">month</span> = [<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span> , <span class="hljs-string">'3'</span> , <span class="hljs-string">'4'</span> ]
<span class="hljs-attr">sales</span> = [<span class="hljs-number">100</span>,<span class="hljs-number">150</span>, <span class="hljs-number">80</span>, <span class="hljs-number">130</span>]
<span class="hljs-attr">f1</span> = plt.subplot(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)<span class="hljs-comment"># 生成一个子图，行 列 索引（逗号可省略）</span>
f1.plot(month,sales)
<span class="hljs-attr">f2</span>= plt.subplot(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)
f2.bar(month,sales)
<span class="hljs-attr">f3</span>= plt.subplot(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)
f3.scatter(month,sales)
<span class="hljs-attr">f4</span>= plt.subplot(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>)
f4.barh(month,sales)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9bccc89c073425c88e8b423ab6e91af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB6aOe5LiA5Lya5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130071&amp;x-signature=eturYDPPCCnL5UKVM9amHDhL2pc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-21">（二） seaborn</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-comment"># 设置中文字体（可选，英文环境下可注释掉）</span>
plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"STKAITI"</span>]
<span class="hljs-comment"># 原始数据</span>
data = {
    <span class="hljs-string">'Physics'</span>:   [<span class="hljs-number">78</span>, <span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">68</span>, <span class="hljs-number">88</span>, <span class="hljs-number">80</span>, <span class="hljs-number">94</span>, <span class="hljs-number">73</span>, <span class="hljs-number">87</span>],
    <span class="hljs-string">'Chemistry'</span>: [<span class="hljs-number">82</span>, <span class="hljs-number">76</span>, <span class="hljs-number">89</span>, <span class="hljs-number">71</span>, <span class="hljs-number">93</span>, <span class="hljs-number">85</span>, <span class="hljs-number">79</span>, <span class="hljs-number">88</span>, <span class="hljs-number">91</span>],
    <span class="hljs-string">'Biology'</span>:   [<span class="hljs-number">85</span>, <span class="hljs-number">90</span>, <span class="hljs-number">77</span>, <span class="hljs-number">72</span>, <span class="hljs-number">84</span>, <span class="hljs-number">89</span>, <span class="hljs-number">93</span>, <span class="hljs-number">76</span>, <span class="hljs-number">82</span>]
}
<span class="hljs-comment"># 转为 DataFrame</span>
df = pd.DataFrame(data)
</code></pre>
<h4 data-id="heading-22">直方图</h4>
<pre><code class="hljs language-bash" lang="bash">sns.histplot(data=<span class="hljs-built_in">df</span>, x=<span class="hljs-string">'Physics'</span>)
plt.title(<span class="hljs-string">'Histogram of Physics Scores'</span>)
plt.show()
</code></pre>
<h4 data-id="heading-23">核密度估计图</h4>
<p>核密度估计图(KDE,Kernel Density Estimate PLot)是一种用于显示数据分布的统计图表,它通过平滑直方图的方法来估计数据的概率密度函数,使得分布图看起来更加连续和平滑。核密度估计是一种非参数方法,用于估计随机变量的概率密度函数。其基本思想是,将每个数据点视为一个“核”(通常是高斯分布),然后将这些核的贡献相加以形成平滑的密度曲线。 #绘制喙长度的核密度估计图</p>
<pre><code class="hljs language-ini" lang="ini">sns.kdeplot(<span class="hljs-attr">data</span>=data, x=<span class="hljs-string">"Physics"</span>)
</code></pre>

<pre><code class="hljs language-ini" lang="ini">sns.histplot(<span class="hljs-attr">data</span>=data, x=<span class="hljs-string">"Physics"</span>,kde=<span class="hljs-literal">True</span>)
</code></pre>
<h4 data-id="heading-24">计数图</h4>
<p>计数图用于绘制分类变量的计数分布图,显示每个类别在数据集中出现的次数,是分析分类数据非常直观的工具,可以快速了解类别的分布情况。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 将 Physics 分数进行分箱处理，转换为分类变量</span>
<span class="hljs-attr">bins</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>, <span class="hljs-number">80</span>, <span class="hljs-number">90</span>, <span class="hljs-number">100</span>] <span class="hljs-comment"># 自定义分区</span>
<span class="hljs-attr">labels</span> = [<span class="hljs-string">'0-60'</span>, <span class="hljs-string">'60-70'</span>, <span class="hljs-string">'70-80'</span>, <span class="hljs-string">'80-90'</span>, <span class="hljs-string">'90-100'</span>]
df<span class="hljs-section">['Physics_Bins']</span> = pd.cut(df<span class="hljs-section">['Physics']</span>, <span class="hljs-attr">bins</span>=bins, labels=labels, right=<span class="hljs-literal">False</span>)
<span class="hljs-comment">#绘制不同数量的计数图</span>
sns.countplot(<span class="hljs-attr">data</span>=df, x=<span class="hljs-string">"Physics_Bins"</span>)
</code></pre>
<h4 data-id="heading-25">散点图</h4>
<pre><code class="hljs language-bash" lang="bash">data_long = {
    <span class="hljs-string">'subject'</span>: [<span class="hljs-string">'Physics'</span>, <span class="hljs-string">'Chemistry'</span>, <span class="hljs-string">'Biology'</span>] * 9,
    <span class="hljs-string">'score'</span>: [
        78, 82, 85,
        85, 76, 90,
        92, 89, 77,
        68, 71, 72,
        88, 93, 84,
        80, 85, 89,
        94, 79, 93,
        73, 88, 76,
        87, 91, 82
    ],
    <span class="hljs-string">'student_group'</span>: [<span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>,
                      <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>,
                      <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>,
                      <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>,
                      <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>,
                      <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>,
                      <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>,
                      <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'B'</span>,
                      <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>, <span class="hljs-string">'A'</span>]
}

<span class="hljs-built_in">df</span> = pd.DataFrame(data_long)
<span class="hljs-comment">#绘制横轴为科目,纵轴为成绩的散点图。可通过hue参数设置不同组别进行对比。</span>
sns.scatterplot(data=<span class="hljs-built_in">df</span>, x=<span class="hljs-string">"subject"</span>, y=<span class="hljs-string">"score"</span>, hue=<span class="hljs-string">"student_group"</span>)
</code></pre>
<h4 data-id="heading-26">蜂窝图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#通过jointplot()函数,设置kind="hex"来绘制蜂窝图。</span>
sns.jointplot (<span class="hljs-attr">data</span>=data, x=<span class="hljs-string">"Physics"</span>, y=<span class="hljs-string">"Chemistry"</span>, kind=<span class="hljs-string">"hex"</span>)
</code></pre>
<h4 data-id="heading-27">二维核密度估计图</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#通过kdeplot()函数,同时设置x参数和y参数来绘制二维核密度估计图。</span>
sns.kdeplot(<span class="hljs-attr">data</span>=penguins, x=<span class="hljs-string">"body_mass_g"</span>, y=<span class="hljs-string">"flipper_length_mm"</span>)
<span class="hljs-comment">#通过fill=True设置为填充,通过cbar=True设置显示颜色示意条。</span>
sns.kdeplot(<span class="hljs-attr">data</span>=penguins, x=<span class="hljs-string">"body_mass_g"</span>, y=<span class="hljs-string">"flipper_length_mm"</span>,fill=<span class="hljs-literal">True</span>, cbar=<span class="hljs-literal">True</span>)
</code></pre>
<h4 data-id="heading-28">条形图</h4>
<pre><code class="hljs language-ini" lang="ini">sns.barplot(<span class="hljs-attr">data</span>=penguins, x=<span class="hljs-string">"species"</span>, y=<span class="hljs-string">"bill_length_mm"</span>,estimator=<span class="hljs-string">"mean"</span>, errorbar=None)
</code></pre>
<h4 data-id="heading-29">箱线图</h4>
<pre><code class="hljs language-ini" lang="ini">sns.boxplot(<span class="hljs-attr">data</span>=penguins, x=<span class="hljs-string">"species"</span>, y=<span class="hljs-string">"bill_length_mm"</span>)
</code></pre>
<h4 data-id="heading-30">小提琴图</h4>
<p>小提琴图(Violin Plot)是一种结合了箱线图和核密度估计图(KDE)的可视化图表,用于展示数据的分布情况、集中趋势、散布情况以及异常值。小提琴图不仅可以显示数据的基本统计量(如中位数和四分位数),还可以展示数据的概率密度,提供比箱线图更丰富的信息。</p>
<pre><code class="hljs language-ini" lang="ini">sns.violinplot(<span class="hljs-attr">data</span>=penguins, x=<span class="hljs-string">"species"</span>, y=<span class="hljs-string">"bill_length_mm"</span>)
</code></pre>
<h4 data-id="heading-31">成对关系图</h4>
<p>成对关系图是一种用于显示多个变量之间关系的可视化工具。它可以展示各个变量之间的成对关系,并且通过不同的图表形式帮助我们理解数据中各个变量之间的相互作用。对角线上的图通常显示每个变量的分布(如直方图或核密度估计图),帮助观察每个变量的单变量特性。其他位置展示所有变量的两两关系,用散点图表示。</p>
<pre><code class="hljs language-ini" lang="ini">sns.pairplot(<span class="hljs-attr">data</span>=penguins, hue=<span class="hljs-string">"species"</span>)
</code></pre>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Autowired 和 Resource 的区别]]></title>    <link>https://juejin.cn/post/7599868109085524010</link>    <guid>https://juejin.cn/post/7599868109085524010</guid>    <pubDate>2026-01-27T15:06:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599868109085524010" data-draft-id="7599868109085507626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Autowired 和 Resource 的区别"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T15:06:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="咪库咪库咪"/> <meta itemprop="url" content="https://juejin.cn/user/3725578141445959"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Autowired 和 Resource 的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3725578141445959/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    咪库咪库咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:06:27.000Z" title="Tue Jan 27 2026 15:06:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong><code>@Autowired</code>：来自Spring ，默认按“类型”注入</strong><br/>
<strong><code>@Resource</code>：Java 标准注解，默认按“名字”注入</strong></p>
<h2 data-id="heading-0">Autowired-&gt; 按类型</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> UserService userService;
</code></pre>
<p>Spring 会找：容器里 <strong>类型是 <code>UserService</code> 的 Bean</strong></p>
<p>如果有多个同类型的Bean就会报错，这时必须配合：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Qualifier("userServiceImpl1")</span>
<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> UserService userService;
</code></pre>
<h2 data-id="heading-1">@Resource -&gt; 按名称</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Resource</span>
<span class="hljs-keyword">private</span> UserService userService;
</code></pre>
<p>Spring 会：</p>
<ol>
<li>先按 <strong>变量名 <code>userService</code></strong> 找 Bean</li>
<li>找不到 → 再按 <strong>类型</strong> 找</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码灵异事件：为什么用 get() 能取到值，换成 getProperty() 就变成了 null？]]></title>    <link>https://juejin.cn/post/7599835610406928430</link>    <guid>https://juejin.cn/post/7599835610406928430</guid>    <pubDate>2026-01-27T15:34:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599835610406928430" data-draft-id="7599835610406912046" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码灵异事件：为什么用 get() 能取到值，换成 getProperty() 就变成了 null？"/> <meta itemprop="keywords" content="面试,Java"/> <meta itemprop="datePublished" content="2026-01-27T15:34:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Re_zero"/> <meta itemprop="url" content="https://juejin.cn/user/2965821818672144"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码灵异事件：为什么用 get() 能取到值，换成 getProperty() 就变成了 null？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965821818672144/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Re_zero
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:34:34.000Z" title="Tue Jan 27 2026 15:34:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>#Java #源码分析 #避坑指南 #面试题</p>
<blockquote>
<p><strong>摘要</strong>：</p>
<p>明明向 <code>Properties</code> 中存入了数值，用 <code>get()</code> 探寻时它尚在，换作 <code>getProperty()</code> 却凭空消失，只返还一个冷冰冰的 <code>null</code>。 这并非 JDK 的 Bug，也不是什么玄学。本文将以此为引，拨开 <code>java.util.Properties</code> 的源码迷雾，一探这段因“继承滥用”而尘封已久的设计公案。</p>
</blockquote>
<p>大家好，我是 <strong>Re-Zero</strong>。</p>
<p>今天在 Code Review，我见到了一段足以写入《Java 迷惑行为大赏》的代码：某位兄弟图省事，直接用 <code>put</code> 方法把数字往 <code>Properties</code> 对象里塞，取的时候却遭遇“左右手互搏”——一只手能拿到，另一只手却摸了个空。</p>
<p>咱们来还原一下这个让新手摸不着头脑的“灵异现场”。</p>
<hr/>
<h2 data-id="heading-0">一、 案发现场：一次投币，两种人生</h2>
<p>我们写一段最简单的测试代码：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();

<span class="hljs-comment">// 1. 注意：为了省事，这里直接存了个整数 88</span>
<span class="hljs-comment">// 这里的 88 是 Integer 类型，不是 String</span>
props.put(<span class="hljs-string">"timeout"</span>, <span class="hljs-number">88</span>); 

<span class="hljs-comment">// 2. 使用 Map 原生的 get() 方法</span>
System.out.println(<span class="hljs-string">"get: "</span> + props.get(<span class="hljs-string">"timeout"</span>)); 

<span class="hljs-comment">// 3. 使用 Properties 专属的 getProperty() 方法</span>
System.out.println(<span class="hljs-string">"getProperty: "</span> + props.getProperty(<span class="hljs-string">"timeout"</span>));
</code></pre>
<p>按照正常逻辑，这就好比你往钱包里塞了一张钱，用左手掏出来是钱，用右手掏出来应该是空气吗？显然不合理。</p>
<p>但 Java 偏偏就给你变了个魔术，运行结果如下：</p>
<pre><code class="hljs language-Plaintext" lang="Plaintext">get: 88
getProperty: null   &lt;-- 见鬼了?!
</code></pre>
<p>明明数据就在里面，用 <code>get</code> 都能拿到，凭什么 <code>getProperty</code> 就视而不见？难道它还歧视整数？</p>
<hr/>
<h2 data-id="heading-1">二、 源码解剖：寻找失落的真相</h2>
<p>为了搞清楚原因，我们直接点开 <code>java.util.Properties</code> 的源码，看看 <code>getProperty</code> 到底背着我们干了什么。</p>
<p>代码非常短，但每一行都藏着心眼：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProperty</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-comment">// 1. 先调用父类 (Hashtable) 的 get 方法，拿到 value</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">oval</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.get(key);
    
    <span class="hljs-comment">// 2. 关键判决！</span>
    <span class="hljs-comment">// 检查拿到的 value 是不是 String 类型</span>
    <span class="hljs-comment">// 如果是 String，强转；如果不是，sval 直接置为 null</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">sval</span> <span class="hljs-operator">=</span> (oval <span class="hljs-keyword">instanceof</span> String) ? (String)oval : <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// 3. 兜底逻辑：如果是 null，且存在默认配置集 (defaults)，则去默认集里找</span>
    <span class="hljs-keyword">return</span> ((sval == <span class="hljs-literal">null</span>) &amp;&amp; (defaults != <span class="hljs-literal">null</span>)) ? defaults.getProperty(key) : sval;
}
</code></pre>
<p><strong>破案了，凶手就是这行代码：</strong></p>
<p><code>String sval = (oval instanceof String) ? (String)oval : null;</code></p>
<p><code>getProperty</code> 方法是一个有着严重<strong>类型洁癖</strong>的方法：</p>
<ol>
<li>
<p>它强制要求：<strong>Key 和 Value 必须都是 <code>String</code> 类型</strong>。</p>
</li>
<li>
<p>在我们的案例中，存入的是 <code>Integer</code> 类型的 <code>88</code>。</p>
</li>
<li>
<p><code>oval instanceof String</code> 判定为假。</p>
</li>
<li>
<p>所以变量 <code>sval</code> 被无情地赋值为 <code>null</code>。</p>
</li>
</ol>
<p>那为什么普通的 <code>get()</code> 方法能拿到呢？</p>
<p>因为它是个“老好人”。<code>Properties</code> 继承自 <code>Hashtable</code>，<code>get()</code> 方法是父类的，签名是 <code>Object get(Object key)</code>。在它眼里，众生平等，不管你存的是字符串还是整数，它都原样给你吐出来。</p>
<hr/>
<h2 data-id="heading-2">三、 为什么会有这个坑？</h2>
<p>你可能会问：既然 <strong><code>Properties</code> 是专门用来处理字符串配置文件</strong>的，为什么 Java 还要允许我们往里面 <code>put</code> 整数呢？直接报错不好吗？</p>
<p>这就得聊聊 Java 早期的“黑历史”了。</p>
<p><code>Properties</code> 类出现得非常早（JDK 1.0）。在那个上古时代，Java 的设计者为了少写几行代码，强行让 <code>Properties</code> <strong>继承</strong> 了 <code>Hashtable</code>。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Properties</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Hashtable</span>&lt;Object,Object&gt; { ... }
</code></pre>
<p>这就好比让一个文弱书生（Properties），直接继承了屠夫（Hashtable）的技能树。虽然书生的本职工作是写字，但他确实从他爹那里继承了“杀猪”的本事——虽然能用，但怎么看怎么别扭。</p>
<p>这是一个典型的“<strong>组合优于继承</strong>”原则的反面教材。如果当时采用组合模式（Properties 内部持有一个 Map），就不会暴露 <code>put</code> 方法给用户，也就不会有今天这个坑了。</p>
<hr/>
<h2 data-id="heading-3">四、 最佳实践 —— Properties 指南</h2>
<p>既然知道坑在哪，怎么避坑就很简单了。请严格遵守以下开发规范：</p>
<h3 data-id="heading-4">1. 拉黑 put 和 get</h3>
<p>在操作 <code>Properties</code> 对象时，尽量不要使用这两个从父类继承来的方法。它们是给 Hashtable 用的，不是给你用的。</p>
<h3 data-id="heading-5">2. 锁死 setProperty 和 getProperty</h3>
<p>JDK 专门提供了类型安全的方法，请一定要用它们：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 正确姿势</span>
props.setProperty(<span class="hljs-string">"timeout"</span>, <span class="hljs-string">"88"</span>); <span class="hljs-comment">// 编译器会强制要求你传入 String</span>

<span class="hljs-comment">// 正确读取</span>
<span class="hljs-type">String</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> props.getProperty(<span class="hljs-string">"timeout"</span>); <span class="hljs-comment">// 此时能正确获取 "88"</span>
</code></pre>
<h3 data-id="heading-6">3. 巧用 defaults，让默认值成为你的神助攻</h3>
<p>源码最后一行其实还藏了个彩蛋：</p>
<p><code>((sval == null) &amp;&amp; (defaults != null)) ? defaults.getProperty(key) : sval;</code></p>
<p>这允许我们构建一个“<strong>配置层级链”</strong>。比如你可以有一个 <code>defaultProps</code> 存放默认配置，然后创建一个 <code>appProps</code> 覆盖它。当主配置里没值时，它会自动去默认配置里找，非常方便。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">Properties</span> <span class="hljs-variable">defaultProps</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
defaultProps.setProperty(<span class="hljs-string">"theme"</span>, <span class="hljs-string">"light"</span>); <span class="hljs-comment">// 默认浅色主题</span>

<span class="hljs-comment">// 将 defaultProps 设为 appProps 的“父级”</span>
<span class="hljs-type">Properties</span> <span class="hljs-variable">appProps</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>(defaultProps); 

<span class="hljs-comment">// appProps 里没配 theme，getProperty 会自动去 defaultProps 里找</span>
System.out.println(appProps.getProperty(<span class="hljs-string">"theme"</span>)); <span class="hljs-comment">// 输出 "light"</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">五、 总结</h2>
<p>下次再遇到 <code>getProperty</code> 返回 null，先别怀疑人生，检查一下：<strong>你是不是手滑用了 <code>put</code> 存了非 String 类型的数据？</strong></p>























<table><thead><tr><th><strong>方法</strong></th><th><strong>来源</strong></th><th><strong>特点</strong></th><th><strong>推荐指数</strong></th></tr></thead><tbody><tr><td><strong>get()</strong></td><td>Hashtable</td><td>返回 Object，来者不拒，容易埋雷</td><td>🚫 禁止使用</td></tr><tr><td><strong>getProperty()</strong></td><td>Properties</td><td>只返回 String，带默认值查找，类型安全</td><td>✅ 强烈推荐</td></tr></tbody></table>
<p>既然用了 <code>Properties</code>，就请尊重它的“洁癖”，只喂给它 <code>String</code>！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NFT 进阶开发！ERC6551 场景应用 + 理论代码全解析]]></title>    <link>https://juejin.cn/post/7599634796584140806</link>    <guid>https://juejin.cn/post/7599634796584140806</guid>    <pubDate>2026-01-27T10:38:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599634796584140806" data-draft-id="7599828354515583016" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NFT 进阶开发！ERC6551 场景应用 + 理论代码全解析"/> <meta itemprop="keywords" content="智能合约,Solidity,web3"/> <meta itemprop="datePublished" content="2026-01-27T10:38:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="木西"/> <meta itemprop="url" content="https://juejin.cn/user/2436173496845549"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NFT 进阶开发！ERC6551 场景应用 + 理论代码全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173496845549/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    木西
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T10:38:42.000Z" title="Tue Jan 27 2026 10:38:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>本文围绕 ERC6551 标准展开全面梳理与实践落地，理论层面系统剖析了该标准的核心定义、核心能力、解决的行业痛点、典型行业应用及优劣势；代码落地层面则基于 Hardhat V3 开发环境，结合 OpenZeppelin V5 与 Solidity 0.8.24，完整实现 ERC6551 标准从开发、测试到部署的全流程。</p>
</blockquote>
<h2 data-id="heading-1">ERC6551标准理论知识梳理</h2>
<h4 data-id="heading-2">概述</h4>
<p>ERC-6551 是以太坊上为 NFT 设计的 “代币绑定账户（TBA）” 标准，核心是给每个 ERC-721/ERC-1155 NFT 分配独立智能合约账户，让 NFT 能像用户地址一样持有资产、发起交易并留存链上记录，且无需修改现有合约与基础设施，完全向后兼容Ethereum Improvement Proposals</p>
<hr/>
<h4 data-id="heading-3">一、核心定义</h4>
<p>ERC-6551 由 Benny Giang 等人于 2023 年提出，通过<strong>单例注册表</strong>为每个 NFT 生成唯一、确定性的智能合约账户地址，账户永久绑定 NFT，控制权随 NFT 所有权转移而转移Ethereum Improvement Proposals。</p>
<ul>
<li>
<p><strong>核心组件</strong>：</p>
<ul>
<li>注册表（Registry）：负责部署 / 引用 TBA，确保地址确定性（由链 ID+NFT 合约地址 + Token ID 计算得出）Ethereum Improvement Proposals。</li>
<li>账户实现（Account Implementation）：TBA 的最小化智能合约，支持签名、交易执行等基础钱包功能。</li>
<li>绑定关系：TBA 与 NFT 一一对应，NFT 所有者即 TBA 的唯一控制人。</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-4">二、核心能力（能做什么）</h4>





























<table><thead><tr><th>能力</th><th>说明</th></tr></thead><tbody><tr><td>资产持有</td><td>TBA 可存储 ERC-20/ERC-721/ERC-1155 等，形成 “NFT 套娃”（如角色 NFT 持有装备 NFT）</td></tr><tr><td>链上交互</td><td>通过智能账户签名与 DeFi、DAO、游戏等 dApp 直接交互，执行借贷、投票、交易等操作</td></tr><tr><td>独立身份</td><td>拥有独立地址与交易历史，作为链上身份（如会员凭证、游戏角色），记录完整行为轨迹</td></tr><tr><td>所有权联动</td><td>NFT 转移时，TBA 控制权与资产随之一并转移，无需额外操作</td></tr><tr><td>跨链兼容</td><td>支持多链部署，同一 NFT 可在不同链拥有独立 TBA，资产与操作互不影响Ethereum Improvement Proposals</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-5">三、解决的行业痛点</h4>
<ol>
<li><strong>NFT 功能单一</strong>：传统 NFT 仅为静态资产，无法主动持有 / 管理其他资产，难以映射复杂实体（如汽车、投资组合）Ethereum Improvement Proposals。</li>
<li><strong>资产归属割裂</strong>：用户钱包混合个人与 NFT 相关资产，缺乏独立隔离与追溯能力。</li>
<li><strong>交互门槛高</strong>：NFT 需通过用户钱包间接操作，无法自主参与 dApp（如 DeFi 挖矿、游戏内交易）。</li>
<li><strong>跨链管理难</strong>：多链资产需多钱包管理，TBA 让 NFT 成为跨链资产的统一入口Ethereum Improvement Proposals。</li>
</ol>
<hr/>
<h4 data-id="heading-6">四、典型行业应用</h4>
<ol>
<li><strong>GameFi</strong>：角色 NFT 的 TBA 持有装备、道具、货币，资产随角色转移，支持 “装备锻造 - 交易 - 使用” 全流程链上闭环Ethereum Improvement Proposals。</li>
<li><strong>DeFi</strong>：NFT 作为 “资产包” 直接参与流动性挖矿、借贷抵押，如房产 NFT 的 TBA 持有租金收益代币，自动复投。</li>
<li><strong>数字身份</strong>：会员 NFT 的 TBA 记录消费 / 积分 / 权限，实现 “凭证 + 钱包 + 身份” 三合一，简化 Web3 登录与权益管理Ethereum Improvement Proposals。</li>
<li><strong>DAO 治理</strong>：NFT 作为投票权载体，TBA 自动执行提案投票、分红领取，降低 DAO 参与门槛。</li>
<li><strong>IP 资产</strong>：艺术 NFT 的 TBA 持有版税收入，自动分发给创作者 / 持有者，透明化版权收益流。</li>
</ol>
<hr/>
<h4 data-id="heading-7">五、优劣势分析</h4>



































<table><thead><tr><th>维度</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td>兼容性</td><td>完全兼容 ERC-721/ERC-1155，无需修改现有 NFT 合约</td><td>部分非主流 NFT（如 CryptoPunks）因未实现 ownerOf 方法，无法接入 TBA</td></tr><tr><td>安全性</td><td>资产隔离存储，减少用户钱包被黑风险；TBA 仅由 NFT 所有者控制</td><td>智能合约漏洞可能导致 TBA 资产损失；NFT 丢失 / 被盗则 TBA 资产一同受损</td></tr><tr><td>灵活性</td><td>支持自定义账户实现，可扩展权限管理（如多签、定时释放）Ethereum Improvement Proposals</td><td>需开发者适配 TBA 接口，部分 dApp 尚未支持合约账户交互</td></tr><tr><td>用户体验</td><td>资产随 NFT 一键转移，简化多链 / 多资产管理</td><td>操作需支付额外 Gas（TBA 部署、交易执行），成本高于普通 NFT 转移</td></tr><tr><td>创新性</td><td>推动 NFT 从 “静态 JPEG” 升级为 “动态经济体”，催生新型商业模式</td><td>市场认知不足，早期应用存在合规与监管不确定性</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-8">六、总结</h4>
<p>ERC-6551 通过 TBA 机制为 NFT 赋予 “智能钱包” 属性，是 NFT 从 “数字藏品” 到 “链上实体” 的关键升级。其核心价值在于<strong>资产隔离、自主交互、所有权联动</strong>，适配 GameFi、DeFi、身份管理等多场景，但需平衡安全、成本与生态适配性。建议开发者优先基于 ERC-721 标准接入 TBA，逐步探索复杂应用落地。</p>
<hr/>
<h2 data-id="heading-9">智能合约开发、测试、部署</h2>
<h4 data-id="heading-10">智能合约</h4>
<ul>
<li><strong>代币合约</strong></li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
<span class="hljs-comment">// Compatible with OpenZeppelin Contracts ^5.5.0</span>
pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.24</span>;

<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ERC20</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC20/ERC20.sol"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ERC20Burnable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC20/extensions/ERC20Burnable.sol"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ERC20Permit</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC20/extensions/ERC20Permit.sol"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Ownable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/access/Ownable.sol"</span>;

contract <span class="hljs-title class_">BoykaYuriToken</span> is <span class="hljs-title class_">ERC20</span>, <span class="hljs-title class_">ERC20Burnable</span>, <span class="hljs-title class_">Ownable</span>, <span class="hljs-title class_">ERC20Permit</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">address recipient, address initialOwner</span>)
        <span class="hljs-title class_">ERC20</span>(<span class="hljs-string">"MyToken"</span>, <span class="hljs-string">"MTK"</span>)
        <span class="hljs-title class_">Ownable</span>(initialOwner)
        <span class="hljs-title class_">ERC20Permit</span>(<span class="hljs-string">"MyToken"</span>)
    {
        <span class="hljs-title function_">_mint</span>(recipient, <span class="hljs-number">1000000</span> * <span class="hljs-number">10</span> ** <span class="hljs-title function_">decimals</span>());
    }
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">mint</span>(<span class="hljs-params">address to, uint256 amount</span>) public onlyOwner {
        <span class="hljs-title function_">_mint</span>(to, amount);
    }
}
</code></pre>
<ul>
<li><strong>NFT合约</strong></li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
<span class="hljs-comment">// Compatible with OpenZeppelin Contracts ^5.5.0</span>
pragma solidity ^<span class="hljs-number">0.8</span><span class="hljs-number">.27</span>;

<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ERC721</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC721/ERC721.sol"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ERC721Burnable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC721/extensions/ERC721Burnable.sol"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">ERC721URIStorage</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Ownable</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/access/Ownable.sol"</span>;

contract <span class="hljs-title class_">MyToken</span> is <span class="hljs-title class_">ERC721</span>, <span class="hljs-title class_">ERC721URIStorage</span>, <span class="hljs-title class_">ERC721Burnable</span>, <span class="hljs-title class_">Ownable</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">address initialOwner</span>)
        <span class="hljs-title class_">ERC721</span>(<span class="hljs-string">"MyToken"</span>, <span class="hljs-string">"MTK"</span>)
        <span class="hljs-title class_">Ownable</span>(initialOwner)
    {}

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">safeMint</span>(<span class="hljs-params">address to, uint256 tokenId, <span class="hljs-built_in">string</span> memory uri</span>)
        <span class="hljs-keyword">public</span>
        onlyOwner
    {
        <span class="hljs-title function_">_safeMint</span>(to, tokenId);
        <span class="hljs-title function_">_setTokenURI</span>(tokenId, uri);
    }

    <span class="hljs-comment">// The following functions are overrides required by Solidity.</span>

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">tokenURI</span>(<span class="hljs-params">uint256 tokenId</span>)
        <span class="hljs-keyword">public</span>
        view
        <span class="hljs-title function_">override</span>(<span class="hljs-title class_">ERC721</span>, <span class="hljs-title class_">ERC721URIStorage</span>)
        returns (<span class="hljs-built_in">string</span> memory)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">tokenURI</span>(tokenId);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">supportsInterface</span>(<span class="hljs-params">bytes4 interfaceId</span>)
        <span class="hljs-keyword">public</span>
        view
        <span class="hljs-title function_">override</span>(<span class="hljs-title class_">ERC721</span>, <span class="hljs-title class_">ERC721URIStorage</span>)
        returns (bool)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">supportsInterface</span>(interfaceId);
    }
}
</code></pre>
<ul>
<li><strong>账户实现智能合约</strong></li>
</ul>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// SPDX-License-Identifier: MIT</span>
pragma solidity ^<span class="hljs-number">0.8</span>.<span class="hljs-number">24</span>;

import {IERC165} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/utils/introspection/IERC165.sol"</span>;
import {IERC721} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/token/ERC721/IERC721.sol"</span>;
import {IERC1271} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/interfaces/IERC1271.sol"</span>;
import {SignatureChecker} <span class="hljs-keyword">from</span> <span class="hljs-string">"@openzeppelin/contracts/utils/cryptography/SignatureChecker.sol"</span>;

<span class="hljs-comment">// 简化版 ERC6551 账户实现</span>
contract SimpleERC6551Account is IERC165, IERC1271 {
    <span class="hljs-title function_ invoke__">receive</span>() external payable {}

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span>(<span class="hljs-params">address to, uint256 value, bytes calldata data, uint8 operation</span>) 
        <span class="hljs-title">external</span> <span class="hljs-title">payable</span> <span class="hljs-title">returns</span> (<span class="hljs-params">bytes memory result</span>) 
    </span>{
        <span class="hljs-keyword">require</span>(msg.sender == <span class="hljs-title function_ invoke__">owner</span>(), <span class="hljs-string">"Not token owner"</span>);
        <span class="hljs-keyword">require</span>(operation == <span class="hljs-number">0</span>, <span class="hljs-string">"Only call operation supported"</span>);

        <span class="hljs-keyword">bool</span> success;
        (success, result) = to.call{value: value}(data);
        <span class="hljs-keyword">require</span>(success, <span class="hljs-string">"Execution failed"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">owner</span>(<span class="hljs-params"/>) <span class="hljs-title">public</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> (<span class="hljs-params">address</span>) </span>{
        (uint256 chainId, address tokenContract, uint256 tokenId) = <span class="hljs-title function_ invoke__">token</span>();
        <span class="hljs-keyword">if</span> (chainId != block.chainid) <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">address</span>(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">IERC721</span>(tokenContract).<span class="hljs-title function_ invoke__">ownerOf</span>(tokenId);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">token</span>(<span class="hljs-params"/>) <span class="hljs-title">public</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> (<span class="hljs-params">uint256, address, uint256</span>) </span>{
        bytes memory footer = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">bytes</span>(<span class="hljs-number">0x60</span>);
        assembly {
            <span class="hljs-title function_ invoke__">extcodecopy</span>(<span class="hljs-title function_ invoke__">address</span>(), <span class="hljs-title function_ invoke__">add</span>(footer, <span class="hljs-number">0x20</span>), <span class="hljs-title function_ invoke__">sub</span>(<span class="hljs-title function_ invoke__">extcodesize</span>(<span class="hljs-title function_ invoke__">address</span>()), <span class="hljs-number">0x60</span>), <span class="hljs-number">0x60</span>)
        }
        <span class="hljs-keyword">return</span> abi.<span class="hljs-title function_ invoke__">decode</span>(footer, (uint256, address, uint256));
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidSignature</span>(<span class="hljs-params">bytes32 hash, bytes memory signature</span>) <span class="hljs-title">external</span> <span class="hljs-title">view</span> <span class="hljs-title">returns</span> (<span class="hljs-params">bytes4</span>) </span>{
        <span class="hljs-keyword">if</span> (SignatureChecker.<span class="hljs-title function_ invoke__">isValidSignatureNow</span>(<span class="hljs-title function_ invoke__">owner</span>(), hash, signature)) {
            <span class="hljs-keyword">return</span> IERC1271.isValidSignature.selector;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">bytes4</span>(<span class="hljs-number">0</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">supportsInterface</span>(<span class="hljs-params">bytes4 interfaceId</span>) <span class="hljs-title">external</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-keyword">bool</span></span>) </span>{
        <span class="hljs-keyword">return</span> interfaceId == <span class="hljs-number">0x6faff5f1</span> || interfaceId == <span class="hljs-number">0x01ffc9a7</span>; <span class="hljs-comment">// ERC6551 &amp; ERC165</span>
    }
}
</code></pre>
<ul>
<li><strong>注册表智能合约</strong></li>
</ul>
<pre><code class="hljs language-ini" lang="ini">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24<span class="hljs-comment">;</span>

import {Create2} from "@openzeppelin/contracts/utils/Create2.sol"<span class="hljs-comment">;</span>

contract ERC6551Registry {
    error AccountCreationFailed()<span class="hljs-comment">;</span>

    function createAccount(
        address implementation,
        uint256 chainId,
        address tokenContract,
        uint256 tokenId,
        uint256 salt,
        bytes calldata initData
    ) external returns (address) {
        bytes memory <span class="hljs-attr">code</span> = _creationCode(implementation, chainId, tokenContract, tokenId, salt)<span class="hljs-comment">;</span>
        address <span class="hljs-attr">_account</span> = Create2.computeAddress(bytes32(salt), keccak256(code))<span class="hljs-comment">;</span>

        if (_account.code.length != 0) return _account<span class="hljs-comment">;</span>

        <span class="hljs-attr">_account</span> = Create2.deploy(<span class="hljs-number">0</span>, bytes32(salt), code)<span class="hljs-comment">;</span>
        if (initData.length != 0) {
            (bool success, ) = _account.call(initData)<span class="hljs-comment">;</span>
            if (!success) revert AccountCreationFailed()<span class="hljs-comment">;</span>
        }
        return _account<span class="hljs-comment">;</span>
    }

    function account(
        address implementation,
        uint256 chainId,
        address tokenContract,
        uint256 tokenId,
        uint256 salt
    ) external view returns (address) {
        bytes memory <span class="hljs-attr">code</span> = _creationCode(implementation, chainId, tokenContract, tokenId, salt)<span class="hljs-comment">;</span>
        return Create2.computeAddress(bytes32(salt), keccak256(code))<span class="hljs-comment">;</span>
    }

    function _creationCode(address implementation, uint256 chainId, address tokenContract, uint256 tokenId, uint256 salt) internal pure returns (bytes memory) {
        return abi.encodePacked(
            hex"3d60ad80600a3d3981f3363d3d373d3d3d363d73",
            implementation,
            hex"5af43d82803e903d91602b57fd5bf3",
            abi.encode(salt, chainId, tokenContract, tokenId)
        )<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h4 data-id="heading-11">测试脚本</h4>
<ul>
<li><strong>测试场景：</strong></li>
</ul>
<ol>
<li><strong>应允许 NFT 账户接收和发送 ERC20 代币</strong></li>
<li><strong>权限测试：非 NFT 持有者无法执行交易</strong></li>
<li><strong>所有权转移测试：NFT 转让后控制权随之转移</strong></li>
<li><strong>ETH 接收与转出测试</strong> <strong>接口验证：应支持 ERC165 和 ERC6551 接口</strong></li>
<li><strong>元数据测试：TBA 应能正确返回其绑定的 Token 信息</strong></li>
</ol>
<pre><code class="hljs language-ini" lang="ini">import assert from "node:assert/strict"<span class="hljs-comment">;</span>
import { describe, it } from "node:test"<span class="hljs-comment">;</span>
import { parseEther, encodeFunctionData, zeroAddress } from "viem"<span class="hljs-comment">;</span>
import { network } from "hardhat"<span class="hljs-comment">;</span>

describe("ERC6551 Extended Integration Tests", function () {
  async function deployFixture() {
    const { viem } = await network.connect()<span class="hljs-comment">;</span>
    const <span class="hljs-section">[owner, otherAccount]</span> = await viem.getWalletClients()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">publicClient</span> = await viem.getPublicClient()<span class="hljs-comment">;</span>

    const <span class="hljs-attr">nft</span> = await viem.deployContract(<span class="hljs-string">"MyToken"</span>, [owner.account.address])<span class="hljs-comment">;</span>
    const <span class="hljs-attr">token</span> = await viem.deployContract(<span class="hljs-string">"BoykaYuriToken"</span>, [owner.account.address, owner.account.address])<span class="hljs-comment">;</span>
    const <span class="hljs-attr">registry</span> = await viem.deployContract(<span class="hljs-string">"ERC6551Registry"</span>)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">implementation</span> = await viem.deployContract(<span class="hljs-string">"SimpleERC6551Account"</span>)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">salt</span> = <span class="hljs-number">0</span>n<span class="hljs-comment">;</span>
    const <span class="hljs-attr">chainId</span> = BigInt(<span class="hljs-number">31337</span>)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">tokenId</span> = <span class="hljs-number">1</span>n<span class="hljs-comment">;</span>
    const <span class="hljs-attr">ipfsUri</span> = <span class="hljs-string">"https://zygomorphic-magenta-bobolink.myfilebase.com/ipfs/QmQT8VpmWQVhUhoDCEK1mdHXaFaJ3KawkRxHm96GUhrXLB"</span><span class="hljs-comment">;</span>

    await nft.write.safeMint(<span class="hljs-section">[owner.account.address, tokenId, ipfsUri]</span>)<span class="hljs-comment">;</span>
    await registry.write.createAccount(<span class="hljs-section">[implementation.address, chainId, nft.address, tokenId, salt, "0x"]</span>)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">tbaAddress</span> = await registry.read.account([implementation.address, chainId, nft.address, tokenId, salt])<span class="hljs-comment">;</span>
    const <span class="hljs-attr">tbaContract</span> = await viem.getContractAt(<span class="hljs-string">"SimpleERC6551Account"</span>, tbaAddress)<span class="hljs-comment">;</span>

    return { nft, token, registry, implementation, owner, otherAccount, publicClient, tbaAddress, tbaContract, tokenId, chainId, salt, viem }<span class="hljs-comment">;</span>
  }
it("应允许 NFT 账户接收和发送 ERC20 代币", async function () {
  const { nft, token, registry, implementation, owner, viem } = await deployFixture()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">ipfsUri</span> = <span class="hljs-string">"https://zygomorphic-magenta-bobolink.myfilebase.com/ipfs/QmQT8VpmWQVhUhoDCEK1mdHXaFaJ3KawkRxHm96GUhrXLB"</span><span class="hljs-comment">;</span>
  
  // 1. 显式获取地址字符串，防止 viem 传递空对象
  const <span class="hljs-attr">ownerAddress</span> = owner.account.address<span class="hljs-comment">;</span>
  const <span class="hljs-attr">tokenId</span> = <span class="hljs-number">1</span>n<span class="hljs-comment">;</span>

  // Mint NFT - 显式传递字符串地址和发送者账户
//   await nft.write.safeMint(<span class="hljs-section">[ownerAddress, tokenId, ipfsUri]</span>, {
//     account: owner.account 
//   })<span class="hljs-comment">;</span>

  // 2. 计算 TBA 地址
  const <span class="hljs-attr">salt</span> = <span class="hljs-number">0</span>n<span class="hljs-comment">;</span>
  const <span class="hljs-attr">chainId</span> = BigInt(<span class="hljs-number">31337</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">tbaAddress</span> = await registry.read.account([implementation.address, chainId, nft.address, tokenId, salt])<span class="hljs-comment">;</span>

  // 3. 部署 TBA
  await registry.write.createAccount(<span class="hljs-section">[implementation.address, chainId, nft.address, tokenId, salt, "0x"]</span>)<span class="hljs-comment">;</span>

  // 4. 给 TBA 转入 ERC20 (同样使用显式地址)
  const <span class="hljs-attr">amount</span> = parseEther(<span class="hljs-string">"100"</span>)<span class="hljs-comment">;</span>
  await token.write.transfer(<span class="hljs-section">[tbaAddress, amount]</span>, {
    account: owner.account 
  })<span class="hljs-comment">;</span>
  
  // 验证 TBA 余额
  const <span class="hljs-attr">balanceAfterTransfer</span> = await token.read.balanceOf([tbaAddress])<span class="hljs-comment">;</span>
  assert.strictEqual(balanceAfterTransfer, amount, "TBA 应该收到指定数量的代币")<span class="hljs-comment">;</span>

  // 5. 通过 TBA 调用 ERC20 的 transfer 方法转回给 Owner
  const <span class="hljs-attr">transferData</span> = encodeFunctionData({
    abi: token.abi,
    functionName: "transfer",
    args: <span class="hljs-section">[ownerAddress, amount]</span>, // 使用显式字符串地址
  })<span class="hljs-comment">;</span>

  const <span class="hljs-attr">accountContract</span> = await viem.getContractAt(<span class="hljs-string">"SimpleERC6551Account"</span>, tbaAddress)<span class="hljs-comment">;</span>
  // 执行 TBA 交易
  await accountContract.write.execute(<span class="hljs-section">[token.address, 0n, transferData, 0]</span>, {
    account: owner.account
  })<span class="hljs-comment">;</span>

  // 验证 TBA 余额清零
  const <span class="hljs-attr">finalBalance</span> = await token.read.balanceOf([tbaAddress])<span class="hljs-comment">;</span>
  assert.strictEqual(finalBalance, 0n, "TBA 的代币余额应该已转出并清零")<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>


  it("权限测试：非 NFT 持有者无法执行交易", async function () {
    const { tbaContract, otherAccount, token } = await deployFixture()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">data</span> = encodeFunctionData({
      abi: token.abi,
      functionName: "transfer",
      args: <span class="hljs-section">[otherAccount.account.address, 1n]</span>,
    })<span class="hljs-comment">;</span>

    // Node assert 验证异步抛出异常
    await assert.rejects(
      async () =&gt; {
        await tbaContract.write.execute(<span class="hljs-section">[token.address, 0n, data, 0]</span>, {
          account: otherAccount.account,
        })<span class="hljs-comment">;</span>
      },
      (err: any) =&gt; {
        return err.message.includes("Not token owner")<span class="hljs-comment">;</span>
      },
      "应该因为不是所有者而拒绝交易"
    )<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>

  it("所有权转移测试：NFT 转让后控制权随之转移", async function () {
    const { nft, tbaContract, owner, otherAccount, tokenId } = await deployFixture()<span class="hljs-comment">;</span>

    await nft.write.transferFrom(<span class="hljs-section">[owner.account.address, otherAccount.account.address, tokenId]</span>)<span class="hljs-comment">;</span>

    // 验证旧所有者失效
    await assert.rejects(
      async () =&gt; {
        await tbaContract.write.execute(<span class="hljs-section">[zeroAddress, 0n, "0x", 0]</span>, { account: owner.account })<span class="hljs-comment">;</span>
      },
      /Not token owner/
    )<span class="hljs-comment">;</span>

    // 验证新所有者成功
    const <span class="hljs-attr">tx</span> = await tbaContract.write.execute([otherAccount.account.address, <span class="hljs-number">0</span>n, <span class="hljs-string">"0x"</span>, <span class="hljs-number">0</span>], {
      account: otherAccount.account,
    })<span class="hljs-comment">;</span>
    assert.ok(typeof <span class="hljs-attr">tx</span> === <span class="hljs-string">"string"</span>, <span class="hljs-string">"交易哈希应为字符串"</span>)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
 
  it("ETH 接收与转出测试", async function () {
    const { tbaAddress, tbaContract, otherAccount, publicClient } = await deployFixture()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">depositAmount</span> = parseEther(<span class="hljs-string">"1"</span>)<span class="hljs-comment">;</span>

    await otherAccount.sendTransaction({ to: tbaAddress, value: depositAmount })<span class="hljs-comment">;</span>
    
    let <span class="hljs-attr">balance</span> = await publicClient.getBalance({ address: tbaAddress })<span class="hljs-comment">;</span>
    assert.equal(balance, depositAmount)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">beforeBalance</span> = await publicClient.getBalance({ address: otherAccount.account.address })<span class="hljs-comment">;</span>
    await tbaContract.write.execute(<span class="hljs-section">[otherAccount.account.address, depositAmount, "0x", 0]</span>)<span class="hljs-comment">;</span>

    <span class="hljs-attr">balance</span> = await publicClient.getBalance({ address: tbaAddress })<span class="hljs-comment">;</span>
    const <span class="hljs-attr">afterBalance</span> = await publicClient.getBalance({ address: otherAccount.account.address })<span class="hljs-comment">;</span>

    assert.equal(balance, 0n)<span class="hljs-comment">;</span>
    assert.ok(afterBalance &gt; beforeBalance, "接收者余额应增加")<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
  it("接口验证：应支持 ERC165 和 ERC6551 接口", async function () {
    const { tbaContract } = await deployFixture()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">supportsERC6551</span> = await tbaContract.read.supportsInterface([<span class="hljs-string">"0x6faff5f1"</span>])<span class="hljs-comment">;</span>
    assert.strictEqual(supportsERC6551, true)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>

  it("元数据测试：TBA 应能正确返回其绑定的 Token 信息", async function () {
    const { tbaContract, nft, tokenId, chainId } = await deployFixture()<span class="hljs-comment">;</span>
    const <span class="hljs-section">[resChainId, resAddr, resTokenId]</span> = await tbaContract.read.token()<span class="hljs-comment">;</span>
    
    assert.equal(resChainId, chainId)<span class="hljs-comment">;</span>
    assert.equal(resAddr.toLowerCase(), nft.address.toLowerCase())<span class="hljs-comment">;</span>
    assert.equal(resTokenId, tokenId)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-12">部署脚本</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { network, artifacts } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> { viem } = <span class="hljs-keyword">await</span> network.<span class="hljs-title function_">connect</span>({ <span class="hljs-attr">network</span>: network.<span class="hljs-property">name</span> });<span class="hljs-comment">//指定网络进行链接</span>
  <span class="hljs-keyword">const</span> publicClient = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getPublicClient</span>();
  <span class="hljs-keyword">const</span> [deployer] = <span class="hljs-keyword">await</span> viem.<span class="hljs-title function_">getWalletClients</span>();

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`正在使用账户部署: <span class="hljs-subst">${deployer.account.address}</span>`</span>);

  <span class="hljs-comment">// 1. 部署 Account Implementation (逻辑蓝本)</span>
  <span class="hljs-keyword">const</span> accountArt = <span class="hljs-keyword">await</span> artifacts.<span class="hljs-title function_">readArtifact</span>(<span class="hljs-string">"SimpleERC6551Account"</span>);
  <span class="hljs-keyword">const</span> accountHash = <span class="hljs-keyword">await</span> deployer.<span class="hljs-title function_">deployContract</span>({
    <span class="hljs-attr">abi</span>: accountArt.<span class="hljs-property">abi</span>,
    <span class="hljs-attr">bytecode</span>: accountArt.<span class="hljs-property">bytecode</span> <span class="hljs-keyword">as</span> <span class="hljs-string">`0x<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span>,
  });
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">contractAddress</span>: implementationAddr } = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ <span class="hljs-attr">hash</span>: accountHash });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Account Implementation 部署成功: <span class="hljs-subst">${implementationAddr}</span>`</span>);

  <span class="hljs-comment">// 2. 部署 Registry (注册表)</span>
  <span class="hljs-keyword">const</span> registryArt = <span class="hljs-keyword">await</span> artifacts.<span class="hljs-title function_">readArtifact</span>(<span class="hljs-string">"ERC6551Registry"</span>);
  <span class="hljs-keyword">const</span> registryHash = <span class="hljs-keyword">await</span> deployer.<span class="hljs-title function_">deployContract</span>({
    <span class="hljs-attr">abi</span>: registryArt.<span class="hljs-property">abi</span>,
    <span class="hljs-attr">bytecode</span>: registryArt.<span class="hljs-property">bytecode</span> <span class="hljs-keyword">as</span> <span class="hljs-string">`0x<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span>,
  });
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">contractAddress</span>: registryAddr } = <span class="hljs-keyword">await</span> publicClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ <span class="hljs-attr">hash</span>: registryHash });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ERC6551Registry 部署成功: <span class="hljs-subst">${registryAddr}</span>`</span>);

  <span class="hljs-keyword">return</span> { implementationAddr, registryAddr };
}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});
</code></pre>
<h2 data-id="heading-13">结语</h2>
<p>至此，ERC6551 标准从核心理论解析到代码实战落地的全内容已完整呈现。从标准的核心定义、核心能力，到解决的行业痛点、典型应用与优劣势分析，再到基于 Hardhat V3+OpenZeppelin V5+Solidity 0.8.24 实现的开发、测试、部署全流程，形成了理论与实践结合的完整体系，为该标准的实际开发与落地应用提供了清晰的参考路径。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始构建 Tauri 2.0 桌面应用：React + Rust 完整实战教程]]></title>    <link>https://juejin.cn/post/7599924965949866022</link>    <guid>https://juejin.cn/post/7599924965949866022</guid>    <pubDate>2026-01-27T11:27:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599924965949866022" data-draft-id="7599528186586923018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始构建 Tauri 2.0 桌面应用：React + Rust 完整实战教程"/> <meta itemprop="keywords" content="全栈,React.js"/> <meta itemprop="datePublished" content="2026-01-27T11:27:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="凉介Nova"/> <meta itemprop="url" content="https://juejin.cn/user/915262510735207"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始构建 Tauri 2.0 桌面应用：React + Rust 完整实战教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/915262510735207/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    凉介Nova
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T11:27:48.000Z" title="Tue Jan 27 2026 11:27:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Tauri 是一个使用 Web 技术构建桌面应用的框架，相比 Electron，它的优势在于：</p>
<ul>
<li><strong>体积小</strong>：打包后仅几 MB，而 Electron 动辄上百 MB</li>
<li><strong>性能高</strong>：使用 Rust 作为后端，内存占用低</li>
<li><strong>安全性强</strong>：默认禁用 Node.js，减少攻击面</li>
</ul>
<p>本文将带你从零构建一个完整的 Tauri 应用，包含前后端通信的实战案例。</p>
<h2 data-id="heading-1">一、环境准备</h2>
<h3 data-id="heading-2">1.1 安装 Rust</h3>
<p>Windows 用户下载并运行 rustup-init.exe，按提示完成安装。</p>
<p>安装完成后验证：</p>
<pre><code class="hljs language-bash" lang="bash">rustc --version
cargo --version
</code></pre>
<h3 data-id="heading-3">1.2 安装 Node.js</h3>
<p>推荐使用 Node.js 18 或更高版本。</p>
<pre><code class="hljs language-bash" lang="bash">node --version
npm --version
</code></pre>
<h3 data-id="heading-4">1.3 安装系统依赖</h3>
<p>Windows 需要安装：</p>
<ul>
<li>Microsoft Visual Studio C++ Build Tools</li>
<li>WebView2（Windows 10/11 通常已预装）</li>
</ul>
<h2 data-id="heading-5">二、创建项目</h2>
<h3 data-id="heading-6">2.1 初始化 Tauri 项目</h3>
<pre><code class="hljs language-bash" lang="bash">npm create tauri-app@latest
</code></pre>
<p>按提示选择：</p>
<pre><code class="hljs language-perl" lang="perl">✔ Project name · <span class="hljs-keyword">my</span>-tauri-app
✔ Identifier · com.example.app
✔ Choose which language to <span class="hljs-keyword">use</span> <span class="hljs-keyword">for</span> your frontend · TypeScript / JavaScript
✔ Choose your <span class="hljs-keyword">package</span> manager · npm
✔ Choose your UI template · React
✔ Choose your UI flavor · TypeScript
</code></pre>
<h3 data-id="heading-7">2.2 进入项目并安装依赖</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> my-tauri-app
npm install
</code></pre>
<h3 data-id="heading-8">2.3 项目结构</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">my</span>-tauri-app/
├── src/                    <span class="hljs-comment"># React 前端代码</span>
│   ├── App.tsx
│   ├── main.tsx
│   └── ...
├── src-tauri/              <span class="hljs-comment"># Rust 后端代码</span>
│   ├── src/
│   │   ├── lib.rs          <span class="hljs-comment"># 主要逻辑</span>
│   │   └── main.rs         <span class="hljs-comment"># 入口文件</span>
│   ├── Cargo.toml          <span class="hljs-comment"># Rust 依赖配置</span>
│   └── tauri.conf.json     <span class="hljs-comment"># Tauri 配置文件</span>
├── package.json
└── ...
</code></pre>
<h3 data-id="heading-9">2.4 启动开发服务器</h3>
<pre><code class="hljs language-bash" lang="bash">npm run tauri dev
</code></pre>
<p>首次运行会编译 Rust 代码，需要等待几分钟。之后会弹出应用窗口。</p>
<h2 data-id="heading-10">三、前后端通信：核心概念</h2>
<p>Tauri 的前后端通信主要通过 <strong>Commands（命令）</strong> 实现：</p>
<ul>
<li><strong>Rust 端</strong>：定义命令函数，处理业务逻辑</li>
<li><strong>React 端</strong>：调用命令，获取返回值</li>
</ul>
<p>这是 Tauri 最核心的功能，下面通过实战案例讲解。</p>
<h2 data-id="heading-11">四、实战案例：获取系统信息</h2>
<p>我们来实现一个获取系统磁盘信息的功能。</p>
<h3 data-id="heading-12">4.1 Rust 端：定义命令</h3>
<p>编辑 <code>src-tauri/src/lib.rs</code>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> serde::Serialize;

<span class="hljs-comment">// 定义返回数据结构</span>
<span class="hljs-meta">#[derive(Debug, Serialize)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">DiskInfo</span> {
    <span class="hljs-keyword">pub</span> drive_letter: <span class="hljs-type">String</span>,
    <span class="hljs-keyword">pub</span> total_space: <span class="hljs-type">u64</span>,
    <span class="hljs-keyword">pub</span> free_space: <span class="hljs-type">u64</span>,
    <span class="hljs-keyword">pub</span> used_space: <span class="hljs-type">u64</span>,
    <span class="hljs-keyword">pub</span> usage_percent: <span class="hljs-type">f64</span>,
}

<span class="hljs-comment">// 定义 Tauri 命令</span>
<span class="hljs-meta">#[tauri::command]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_disk_info</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;DiskInfo, <span class="hljs-type">String</span>&gt; {
    <span class="hljs-comment">// 这里简化处理，实际可以使用 sysinfo 库获取真实数据</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">total</span>: <span class="hljs-type">u64</span> = <span class="hljs-number">500</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 500GB</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">free</span>: <span class="hljs-type">u64</span> = <span class="hljs-number">100</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;  <span class="hljs-comment">// 100GB</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">used</span> = total - free;
    
    <span class="hljs-title function_ invoke__">Ok</span>(DiskInfo {
        drive_letter: <span class="hljs-string">"C"</span>.<span class="hljs-title function_ invoke__">to_string</span>(),
        total_space: total,
        free_space: free,
        used_space: used,
        usage_percent: (used <span class="hljs-keyword">as</span> <span class="hljs-type">f64</span> / total <span class="hljs-keyword">as</span> <span class="hljs-type">f64</span>) * <span class="hljs-number">100.0</span>,
    })
}

<span class="hljs-comment">// 注册命令</span>
<span class="hljs-meta">#[cfg_attr(mobile, tauri::mobile_entry_point)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">run</span>() {
    tauri::Builder::<span class="hljs-title function_ invoke__">default</span>()
        .<span class="hljs-title function_ invoke__">plugin</span>(tauri_plugin_opener::<span class="hljs-title function_ invoke__">init</span>())
        .<span class="hljs-title function_ invoke__">invoke_handler</span>(tauri::generate_handler![get_disk_info]) <span class="hljs-comment">// 注册命令</span>
        .<span class="hljs-title function_ invoke__">run</span>(tauri::generate_context!())
        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">"error while running tauri application"</span>);
}
</code></pre>
<p><strong>关键点：</strong></p>
<ol>
<li><code>#[tauri::command]</code> 宏将函数标记为可被前端调用的命令</li>
<li>返回值需要实现 <code>Serialize</code> trait</li>
<li>使用 <code>Result&lt;T, String&gt;</code> 可以向前端返回错误信息</li>
<li>必须在 <code>invoke_handler</code> 中注册命令</li>
</ol>
<h3 data-id="heading-13">4.2 添加 Rust 依赖</h3>
<p>编辑 <code>src-tauri/Cargo.toml</code>，确保有 serde 依赖：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">tauri</span> = { version = <span class="hljs-string">"2"</span>, features = [] }
<span class="hljs-attr">serde</span> = { version = <span class="hljs-string">"1"</span>, features = [<span class="hljs-string">"derive"</span>] }
<span class="hljs-attr">serde_json</span> = <span class="hljs-string">"1"</span>
</code></pre>
<h3 data-id="heading-14">4.3 React 端：调用命令</h3>
<p>编辑 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">src/App.tsx</a>：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { invoke } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tauri-apps/api/core'</span>;

<span class="hljs-comment">// 定义类型（与 Rust 端对应）</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DiskInfo</span> {
  <span class="hljs-attr">drive_letter</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">total_space</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">free_space</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">used_space</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">usage_percent</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [diskInfo, setDiskInfo] = useState&lt;<span class="hljs-title class_">DiskInfo</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 调用 Rust 命令</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchDiskInfo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// invoke 函数调用 Rust 命令，命令名使用蛇形命名法</span>
      <span class="hljs-keyword">const</span> info = <span class="hljs-keyword">await</span> invoke&lt;<span class="hljs-title class_">DiskInfo</span>&gt;(<span class="hljs-string">'get_disk_info'</span>);
      <span class="hljs-title function_">setDiskInfo</span>(info);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-title function_">setError</span>(<span class="hljs-title class_">String</span>(err));
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-comment">// 格式化文件大小</span>
  <span class="hljs-keyword">const</span> formatSize = (<span class="hljs-attr">bytes</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> gb = bytes / (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${gb.toFixed(<span class="hljs-number">2</span>)}</span> GB`</span>;
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Tauri 磁盘信息示例<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{fetchDiskInfo}</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span>&gt;</span>
        {loading ? '加载中...' : '获取磁盘信息'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

      {error &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>错误: {error}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      )}

      {diskInfo &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginTop:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>盘符:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {diskInfo.drive_letter}:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>总容量:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {formatSize(diskInfo.total_space)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>已用:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {formatSize(diskInfo.used_space)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>可用:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {formatSize(diskInfo.free_space)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>使用率:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {diskInfo.usage_percent.toFixed(1)}%<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<p><strong>关键点：</strong></p>
<ol>
<li>使用 <code>@tauri-apps/api/core</code> 中的 <code>invoke</code> 函数调用命令</li>
<li>命令名需要使用蛇形命名法（snake_case）</li>
<li>泛型参数指定返回值类型</li>
<li>使用 try-catch 处理可能的错误</li>
</ol>
<h3 data-id="heading-15">4.4 运行测试</h3>
<pre><code class="hljs language-bash" lang="bash">npm run tauri dev
</code></pre>
<p>点击按钮，即可看到从 Rust 端返回的磁盘信息。</p>
<h2 data-id="heading-16">五、进阶：带参数的命令</h2>
<h3 data-id="heading-17">5.1 Rust 端</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[tauri::command]</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">greet</span>(name: <span class="hljs-type">String</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> {
    <span class="hljs-built_in">format!</span>(<span class="hljs-string">"Hello, {}! Welcome to Tauri."</span>, name)
}

<span class="hljs-comment">// 记得注册</span>
.<span class="hljs-title function_ invoke__">invoke_handler</span>(tauri::generate_handler![get_disk_info, greet])
</code></pre>
<h3 data-id="heading-18">5.2 React 端</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> greeting = <span class="hljs-keyword">await</span> invoke&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'greet'</span>, { <span class="hljs-attr">name</span>: <span class="hljs-string">'Tauri'</span> });
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(greeting); <span class="hljs-comment">// "Hello, Tauri! Welcome to Tauri."</span>
</code></pre>
<p><strong>注意：</strong> 参数以对象形式传递，键名必须与 Rust 函数参数名一致。</p>
<h2 data-id="heading-19">六、进阶：异步命令</h2>
<p>对于耗时操作，使用异步命令避免阻塞：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[tauri::command]</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">scan_files</span>(path: <span class="hljs-type">String</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-type">Vec</span>&lt;<span class="hljs-type">String</span>&gt;, <span class="hljs-type">String</span>&gt; {
    <span class="hljs-comment">// 模拟耗时操作</span>
    tokio::time::<span class="hljs-title function_ invoke__">sleep</span>(tokio::time::Duration::<span class="hljs-title function_ invoke__">from_secs</span>(<span class="hljs-number">2</span>)).<span class="hljs-keyword">await</span>;
    
    <span class="hljs-title function_ invoke__">Ok</span>(<span class="hljs-built_in">vec!</span>[
        <span class="hljs-built_in">format!</span>(<span class="hljs-string">"{}/file1.txt"</span>, path),
        <span class="hljs-built_in">format!</span>(<span class="hljs-string">"{}/file2.txt"</span>, path),
    ])
}
</code></pre>
<p>需要在 <code>Cargo.toml</code> 添加 tokio 依赖：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">tokio</span> = { version = <span class="hljs-string">"1"</span>, features = [<span class="hljs-string">"time"</span>] }
</code></pre>
<h2 data-id="heading-20">七、配置应用信息</h2>
<p>编辑 <code>src-tauri/tauri.conf.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"productName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"我的应用"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"identifier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.myapp"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"frontendDist"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"../dist"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"app"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"windows"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"我的 Tauri 应用"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">900</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">600</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"resizable"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"center"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-21">八、打包发布</h2>
<h3 data-id="heading-22">8.1 执行打包命令</h3>
<pre><code class="hljs language-bash" lang="bash">npm run tauri build
</code></pre>
<h3 data-id="heading-23">8.2 打包产物</h3>
<p>打包完成后，安装包位于：</p>
<pre><code class="hljs language-bash" lang="bash">src-tauri/target/release/bundle/
├── msi/          <span class="hljs-comment"># MSI 安装包</span>
│   └── 应用名_版本_x64_en-US.msi
└── nsis/         <span class="hljs-comment"># NSIS 安装包</span>
    └── 应用名_版本_x64-setup.exe
</code></pre>
<h3 data-id="heading-24">8.3 常见问题：网络超时</h3>
<p>如果遇到 <code>timeout: global</code> 错误，是因为下载 NSIS 工具超时。</p>
<p>解决方案：手动下载 NSIS 并放到缓存目录。</p>
<pre><code class="hljs language-powershell" lang="powershell"># 创建目录
New-Item -ItemType Directory -Path "$env:LOCALAPPDATA\tauri\NSIS" -Force

# 手动下载 nsis-3.zip 并解压到上述目录
</code></pre>
<h2 data-id="heading-25">九、总结</h2>
<p>本文介绍了 Tauri 2.0 的核心开发流程：</p>
<ol>
<li><strong>环境搭建</strong>：安装 Rust 和 Node.js</li>
<li><strong>项目创建</strong>：使用脚手架快速初始化</li>
<li><strong>前后端通信</strong>：通过 Commands 实现 React 与 Rust 的数据交互</li>
<li><strong>打包发布</strong>：生成 Windows 安装包</li>
</ol>
<p>Tauri 的优势在于小体积、高性能、强安全性，非常适合开发轻量级桌面工具。希望这篇教程能帮助你快速上手 Tauri 开发！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[elpis全栈框架的理解]]></title>    <link>https://juejin.cn/post/7599920572840017929</link>    <guid>https://juejin.cn/post/7599920572840017929</guid>    <pubDate>2026-01-27T12:47:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599920572840017929" data-draft-id="7599565587154173978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="elpis全栈框架的理解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T12:47:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hashan"/> <meta itemprop="url" content="https://juejin.cn/user/3523276916662526"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            elpis全栈框架的理解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3523276916662526/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hashan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T12:47:17.000Z" title="Tue Jan 27 2026 12:47:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<h3 data-id="heading-1">背景</h3>
<p>在前端开发场景中，我们常需搭建各类中后台系统，功能看似多样，核心却多为 CRUD 页面。这类重复性开发不仅效率低下，对个人技术能力的提升也毫无帮助。<br/>更关键的是，多数中后台系统仅存在细微差异 —— 以电商系统为例，首次开发可能包含商品管理、订单管理、会员管理与优惠管理模块，而后续需要开发新的电商系统，它的需求或许仅新增一个分销管理模块，基础功能并无本质变化。<br/>
我们这时候，往往重新开发或对旧项目进行 “魔改”，既浪费大量时间，又缺乏技术突破的价值。尤其在 AI 技术飞速发展的当下，若长期局限于这类低技术含量的业务开发，个人竞争力必然会持续下降。</p>
<br/>
<h3 data-id="heading-2">如何解决此问题呢？</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcb65614dbdf4350946bb91d8c76b24b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaGFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770122836&amp;x-signature=uIVfPK23r3dd5E4hqI7Hztm%2Fqac%3D" alt="image.png" loading="lazy"/></p>
<p>elpis 全栈框架里 —— 领域模型 + BFF Serve+Dashboard 模板页 为核心，构建一套可复用、高灵活的解决方案，让中后台开发从 “重复CRUD” 转向 “配置化搭建”。</p>
<p>领域模型是整个方案的 “蓝图引擎”：基于 JSON Schema 定义系统核心结构，不仅能描述基础功能模块（如订单管理、商品管理），还支持通过 “基类 + 子类” 的层级设计拓展个性化需求。比如电商场景中，“订单管理 + 商品管理” 可作为通用基类，电商 A 需新增的 “优惠券管理”、电商 B 需补充的 “分销管理”，则可作为子类灵活挂载。</p>
<p>BFF Serve 扮演 “桥梁与驱动” 的角色：提供 SSR 服务，实例化项目，API接口服务</p>
<p>Dashboard 模板页是 “可视化呈现终端”：无需单独开发页面，只需接收 BFF 层传递的领域模型配置，就能自动渲染出符合业务需求的系统界面。</p>
<p>举个实际例子：搭建电商 A 系统时，我们只需在领域模型中配置 “基类（订单管理 + 商品管理）+ 子类（优惠券管理）”；启动系统后，BFF Serve 会读取这份配置并同步给 Dashboard 模板页，最终呈现的电商 A 系统，就自带 “订单管理 + 商品管理 + 优惠券管理” 全套功能。搭建电商 B 系统同理，仅需调整领域模型为 “基类 + 子类（分销管理）”，即可快速生成包含分销功能的电商系统 —— 全程无需重写代码，仅靠配置领域模型，就能实现中后台系统的快速搭建。</p>
<h2 data-id="heading-3">里程碑一 基于 nodejs 实现服务端内核引擎</h2>
<p>elpis 全栈框架的第一步，便是以 Node.js 构建 BFF Serve 层 —— 对我们而言，Node.js 具备天然的技术适配性，上手门槛更低。</p>
<p>但传统 Node 开发中，团队常陷入 “目录结构不统一”“编码规范难落地”“中间件使用无规则” 的困境：路由该放在哪个目录？服务逻辑与配置管理如何拆分？这些问题往往消耗大量沟通成本。因此，elpis 框架基于 Koa 封装了 <strong>elpis-core 引擎</strong>，通过预设规范与自动化能力，把开发者从基础搭建中解放出来，只需专注业务开发。</p>
<h4 data-id="heading-4">一、规范目录与自动化加载</h4>
<p>elpis-core 引擎以 “约定优于配置” 为原则，定义了清晰的项目目录结构，所有模块按功能归类，无需团队反复协商存放位置：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">elpis
  |-- app/                # 核心业务目录（按约定存放业务模块）
  |   |-- controller/     # 控制器层：处理请求、调用服务、返回响应
  |   |-- extend/         # 扩展层：全局能力扩展（如工具函数、API 增强）
  |   |-- middleware/     # 中间件层：局部中间件（如接口权限校验）
  |   |-- public/         # 静态资源层：存放静态文件
  |   |-- router/         # 路由层：定义“请求路径→控制器”映射关系
  |   |-- router-schema/  # 路由校验层：用 JSON-Schema 定义接口参数规则
  |   |-- service/        # 服务层：封装数据处理、第三方接口调用（供控制器复用）
  |   |-- middlewares.js  # 全局中间件配置：注册全链路生效的中间件
  |-- config/             # 配置目录：区分本地/测试/生产环境的差异化配置
  |-- elpis-core/         # 引擎内核：提供自动加载、环境适配等核心能力
  |   |-- loader/         # 加载器集合：对应各模块的自动化加载逻辑
  |   |   |-- config.js   # 配置加载器：自动加载 config 目录下的环境配置
  |   |   |-- controller.js # 控制器加载器：自动加载 controller 模块并挂载
  |   |   |-- extend.js   # 扩展加载器：自动加载 extend 层的全局能力
  |   |   |-- middleware.js # 中间件加载器：自动加载 middleware 模块
  |   |   |-- router-schema.js # 路由校验加载器：自动加载接口参数校验规则
  |   |   |-- router.js   # 路由加载器：自动加载路由映射关系
  |   |   |-- service.js  # 服务加载器：自动加载 service 层的业务逻辑
  |   |-- env.js          # 环境判断工具：快速区分本地/测试/生产环境
  |   |-- index.js        # 引擎入口：整合所有加载器、初始化 Koa 实例
  |-- index.js            # 项目入口：一键启动 elpis 引擎
</code></pre>
<p>其中，<strong>加载器（loader）</strong>  是自动化的核心：每个模块（如 controller、service、router）都对应专属加载器，加载器会主动遍历目标目录、解析文件内容，并将模块自动挂载到 Koa 实例上。以控制器加载为例，整个流程完全无需手动干预：</p>
<ol>
<li>读取 <code>elpis/app/controller/**/*.js</code> 下所有文件；</li>
<li>提取文件名称与路径，如 <code>app/controller/custom-module/custom-controller.js</code>；</li>
<li>截取路径核心部分，得到 <code>custom-module/custom-controller</code>；</li>
<li>将路径中的 “-” 转为驼峰式命名，即 <code>customModule.customController</code>；</li>
<li>自动挂载到内存 <code>app</code> 对象中</li>
</ol>
<h4 data-id="heading-5">从启动到请求的全链路优化</h4>
<p>固定启动顺序，避免模块依赖混乱</p>
<p>elpis-core 引擎定义了严格的模块启动顺序，确保各模块按依赖关系加载，避免 “未定义” 错误：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">配置环境 → 加载配置 → 扩展加载 → 中间件加载 → 服务加载 → 控制器加载 → 全局中间件注册 → 路由模式加载 → 路由注册
</code></pre>
<p>从环境判断到路由生效，每一步都由引擎自动执行，开发者无需手动管理加载顺序。</p>
<h4 data-id="heading-6">环境与路由的精细化管理</h4>
<ul>
<li><strong>环境配置</strong>：通过 <code>elpis-core/env.js</code> 实现环境变量统一管理，可快速区分本地开发、测试、生产环境，配置文件按环境拆分后，加载器会自动匹配当前环境并加载对应配置；</li>
<li><strong>路由管理</strong>：结合 JSON-Schema 定义路由参数规则，不仅能自动校验请求参数合法性，还能让接口文档与代码逻辑保持一致，减少 “文档与实际接口不匹配” 的问题；</li>
<li><strong>请求响应链路</strong>：通过 “路由→控制器→服务→中间件” 的链路设计，实现请求处理的解耦：路由负责映射路径，控制器负责请求分发，服务负责业务逻辑，中间件负责通用能力（如权限校验、日志记录）。</li>
</ul>
<h4 data-id="heading-7">可扩展的生态能力</h4>
<p>elpis-core 引擎支持自定义插件与功能扩展：</p>
<ul>
<li><strong>插件机制</strong>：可接入多个自定义插件，满足个性化业务需求（如日志插件、监控插件）；</li>
<li><strong>功能扩展</strong>：通过 <code>extend</code> 层可扩展全局能力，如新增工具函数、增强 API 响应格式等，扩展内容由加载器自动生效，无需修改引擎核心代码。</li>
</ul>
<h2 data-id="heading-8">里程碑二 基于 webpack5 完成工程化建设</h2>
<p>作为 elpis 全栈框架的第二步，本阶段核心是为前端 Dashboard 模板页搭建工程化基础，通过拆分 webpack 配置实现 “环境差异化构建”，同时适配服务端渲染与 Vue3 技术栈需求。</p>
<h4 data-id="heading-9">一、配置拆分：按环境解耦，兼顾开发与生产</h4>
<p>将 webpack 配置拆分为三类，通过 <code>dev.js</code> 和 <code>prod.js</code> 分别调用，实现不同环境的自动化构建：</p>
<ul>
<li><strong><code>webpack.base.js</code></strong>：基础配置（基类），定义入口、loader、插件、分包策略等通用逻辑，避免重复编码；</li>
<li><strong><code>webpack.dev.js</code></strong>：开发环境配置，侧重热更新（HMR）、SourceMap 等提升开发效率的能力；</li>
<li><strong><code>webpack.prod.js</code></strong>：生产环境配置，聚焦打包优化（多线程、资源压缩、缓存清理），保障线上性能。</li>
</ul>
<h4 data-id="heading-10">二、核心配置实现：从入口到优化的全链路适配</h4>
<h5 data-id="heading-11">1. 基础配置（webpack.base.js）：适配服务端渲染的核心逻辑</h5>
<p>（1）入口处理：动态识别多页面入口</p>
<p>区别于普通前端项目的固定入口，框架通过 glob 匹配 <code>app/pages/**/entry.*.js</code>（如 <code>entry.dashboard.js</code>），自动生成入口配置与 HTML 模板，适配服务端渲染场景（用户访问 <code>http://ip:port/view/xxxx</code> 时，服务端返回主页面，其他页面由 Vue Router 渲染）：</p>
<p>js</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 1. 匹配所有 entry.xx.js 入口文件</span>
<span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">elpisEntryList</span> = <span class="hljs-selector-tag">path</span><span class="hljs-selector-class">.resolve</span>(__dirname, <span class="hljs-string">"../../pages/**/entry.*.js"</span>);
<span class="hljs-comment">// 2. 构造入口与 HTML 模板</span>
<span class="hljs-selector-tag">glob</span><span class="hljs-selector-class">.sync</span>(elpisEntryList)<span class="hljs-selector-class">.forEach</span>(file =&gt; {
  <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">entryName</span> = <span class="hljs-selector-tag">path</span><span class="hljs-selector-class">.basename</span>(file, <span class="hljs-string">".js"</span>);
  <span class="hljs-comment">// 入口配置：key 为入口名，value 为文件路径</span>
  <span class="hljs-selector-tag">elpisPageEntries</span><span class="hljs-selector-attr">[entryName]</span> = <span class="hljs-selector-tag">file</span>;
  <span class="hljs-comment">// HTML 模板：指定输出路径、模板文件与注入的代码块</span>
  <span class="hljs-selector-tag">elpisHtmlWebpackPluginList</span><span class="hljs-selector-class">.push</span>(new <span class="hljs-built_in">HtmlWebpackPlugin</span>({
    <span class="hljs-attribute">filename</span>: path.<span class="hljs-built_in">resolve</span>(process.<span class="hljs-built_in">cwd</span>(), <span class="hljs-string">"./app/public/dist/"</span>, <span class="hljs-built_in">`.tpl`</span>),
    <span class="hljs-attribute">template</span>: path.<span class="hljs-built_in">resolve</span>(__dirname, <span class="hljs-string">"../../view/entry.tpl"</span>),
    <span class="hljs-attribute">chunks</span>: [entryName]
  }));
});
<span class="hljs-comment">// 最终入口配置</span>
<span class="hljs-selector-tag">entry</span>: <span class="hljs-selector-tag">elpisPageEntries</span>,
</code></pre>
<p>（2）loader 配置：适配 Vue3 + Less 技术栈</p>
<p>针对 Vue 单文件组件、ES6 语法、样式与静态资源，配置专属 loader，确保代码正常解析：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">rules</span>: [
  { <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.vue$/</span>, <span class="hljs-attr">use</span>: <span class="hljs-string">"vue-loader"</span> }, <span class="hljs-comment">// 解析 Vue 文件</span>
  { <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.js$/</span>, <span class="hljs-attr">include</span>: [pages目录], <span class="hljs-attr">use</span>: <span class="hljs-string">"babel-loader"</span> }, <span class="hljs-comment">// 转译 ES6</span>
  { <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.(png|jpg|gif)$/</span>, <span class="hljs-attr">use</span>: { <span class="hljs-attr">loader</span>: <span class="hljs-string">"url-loader"</span>, <span class="hljs-attr">options</span>: { <span class="hljs-attr">limit</span>: <span class="hljs-number">300</span> } } }, <span class="hljs-comment">// 小图转 base64</span>
  { <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.css$/</span>, <span class="hljs-attr">use</span>: [<span class="hljs-string">"style-loader"</span>, <span class="hljs-string">"css-loader"</span>] }, <span class="hljs-comment">// 解析 CSS</span>
  { <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.less$/</span>, <span class="hljs-attr">use</span>: [<span class="hljs-string">"style-loader"</span>, <span class="hljs-string">"css-loader"</span>, <span class="hljs-string">"less-loader"</span>] }, <span class="hljs-comment">// 解析 Less</span>
  { <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.(eot|woff|woff2|svg|ttf)$/</span>, <span class="hljs-attr">use</span>: <span class="hljs-string">"file-loader"</span> } <span class="hljs-comment">// 解析字体</span>
]
</code></pre>
<p>（3）插件与优化：保障基础功能与性能</p>
<ul>
<li>
<p><strong>插件</strong>：配置 <code>VueLoaderPlugin</code>（解析 Vue 组件）、<code>DefinePlugin</code>（定义 Vue 全局常量，如禁用生产环境调试工具），并注入动态生成的 HTML 模板；</p>
</li>
<li>
<p><strong>分包策略</strong>：通过 <code>splitChunks</code> 将代码分为三类，利用浏览器缓存减少重复加载：</p>
<ul>
<li><code>vendor</code>：第三方依赖（如 Vue、Vue Router），改动频率低；</li>
<li><code>common</code>：业务公共组件（如 <code>common</code>/<code>widgets</code> 目录），被引用 ≥2 次即抽取；</li>
<li><code>entry.{page}</code>：页面私有业务代码，改动频率高。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-12">2. 开发环境配置（webpack.dev.js）：聚焦开发效率</h5>
<p>核心实现三项能力：</p>
<ul>
<li><strong>HMR 热更新</strong>：在入口中注入 HMR 客户端，结合 <code>HotModuleReplacementPlugin</code>，实现代码改动后局部更新，无需刷新页面；</li>
<li><strong>SourceMap</strong>：配置 <code>eval-cheap-module-source-map</code>，快速定位错误且保障构建速度；</li>
<li><strong>输出规范</strong>：指定开发环境输出目录（<code>./app/public/dist/dev/</code>），统一资源路径格式。</li>
</ul>
<h5 data-id="heading-13">3. 生产环境配置（webpack.prod.js）：聚焦线上性能</h5>
<p>通过多插件组合实现优化：</p>
<ul>
<li><strong>多线程打包</strong>：使用 <code>HappyPack</code> 开启多线程（线程数 = CPU 核心数），并行处理 JS 与 CSS，提升打包速度；</li>
<li><strong>资源压缩</strong>：<code>TerserWebpackPlugin</code> 压缩 JS（删除 <code>console.log</code>）、<code>CSSMinimizerPlugin</code> 压缩 CSS，减少资源体积；</li>
<li><strong>缓存清理</strong>：<code>CleanWebpackPlugin</code> 打包前清空 <code>public/dist</code> 目录，避免旧资源残留；</li>
<li><strong>CSS 提取</strong>：<code>MiniCssExtractPlugin</code> 将 CSS 从 JS 中提取为单独文件，支持缓存复用。</li>
</ul>
<h4 data-id="heading-14">三、页面入口逻辑：衔接 Vue 应用初始化</h4>
<p>框架约定 <code>app/pages</code> 目录下的核心文件，实现 Vue 应用的自动化挂载：</p>
<ul>
<li><strong><code>boot.js</code></strong>：类比普通 Vue 项目的 <code>main.js</code>，负责初始化 Vue 实例；</li>
<li><strong><code>entry.dashboard.js</code></strong>（如 <code>app/pages/dashboard/</code> 下）：聚合路由配置与待挂载组件，调用 <code>boot(dashboard, { routes })</code> 完成应用启动。</li>
</ul>
<h2 data-id="heading-15">里程碑三  基于 vue3 完成领域模型架构建设</h2>
<p>作为 elpis 全栈框架解决前端 CRUD 重复开发的核心环节，本阶段聚焦 “<strong>用配置驱动页面</strong>”—— 基于领域模型 DSL 与 JSON Schema 定义页面结构，让中后台系统从 “手动编码开发” 转向 “配置化渲染”，彻底摆脱重复编写 CRUD 页面的低效模式。</p>
<h2 data-id="heading-16">一、核心选择：为何用 JSON Schema 承载领域模型？</h2>
<p>选择 JSON Schema 作为领域模型的配置格式，核心源于其三大优势：</p>
<ol>
<li><strong>领域适配性强</strong>：作为特定领域的标准 JSON 格式，可精准描述中后台页面的 “字段属性、交互逻辑、组件关联”，比如一个 “商品价格” 字段，能同时定义其数据类型（number）、校验规则（30≤价格≤1000）、表格展示格式（保留 2 位小数）、表单组件类型（数字输入框）；</li>
<li><strong>校验能力完善</strong>：可结合 AJV（Another JSON Schema Validator）工具，自动校验前端输入数据与后端返回数据的合法性，减少手动编写校验逻辑的工作量；</li>
<li><strong>扩展性灵活</strong>：支持嵌套配置、条件渲染等复杂场景，既能覆盖基础 CRUD 页面，也能适配带个性化交互的定制页面，无需修改框架核心逻辑。</li>
</ol>
<h2 data-id="heading-17">二、领域模型架构：页面的 “配置化蓝图”</h2>
<p>elpis 框架通过 JSON Schema 将中后台系统拆解为 “导航菜单 + 动态页面” 两大核心板块，每个板块的功能与交互均由配置定义，无需编写重复代码：</p>
<h3 data-id="heading-18">1. 整体架构拆解</h3>
<ul>
<li>
<p><strong>导航菜单</strong>：定义系统的模块结构，支持多级菜单（如 “商品管理”“订单管理”），并关联对应的页面类型（Schema 渲染页 /iframe 嵌入页 / 自定义页）；</p>
</li>
<li>
<p><strong>动态页面</strong>：分为三类核心页面，覆盖中后台 90% 以上的场景：</p>
<ul>
<li><strong>schema-view</strong>：核心 CRUD 页面，由 “搜索栏（search-bar）+ 表格（table）” 组成，表格关联 “新增 / 编辑 / 详情 / 删除” 等弹窗交互；</li>
<li><strong>iframe</strong>：嵌入外部页面（如第三方数据报表、旧系统页面），仅需配置嵌入路径；</li>
<li><strong>custom</strong>：用户自定义页面，支持关联自定义 Vue 组件路径，满足特殊交互需求。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-19">2. 核心配置示例（以电商系统 “商品管理” 为例）</h3>
<p>通过一份 JSON 配置，可完整定义 “商品管理” 模块的菜单、表格字段、搜索组件、表单交互，示例如下：</p>
<p>js</p>
<pre><code class="hljs language-css" lang="css">module<span class="hljs-selector-class">.exports</span> = {
  model: <span class="hljs-string">'dashboard'</span>,       // 模型标识，关联系统整体配置
  name: <span class="hljs-string">'电商系统'</span>,         // 系统名称，用于页面标题展示
  menu: [                   // 导航菜单配置
    {
      key: <span class="hljs-string">'product'</span>,       // 菜单唯一标识
      name: <span class="hljs-string">'商品管理'</span>,     // 菜单显示名称
      menuType: <span class="hljs-string">'module'</span>,   // 菜单类型（模块级）
      moduleType: <span class="hljs-string">'schema'</span>, // 页面类型（Schema 渲染页）
      schemaConfig: {       // Schema 页面核心配置
        api: <span class="hljs-string">'/api/proj/product'</span>, // CRUD 接口地址（增删改查统一关联）
        schema: {           // 字段属性定义（覆盖表格、表单、搜索栏）
          type: <span class="hljs-string">'object'</span>,
          properties: {
            // 商品ID：表格展示、编辑时禁用输入
            product_id: {
              type: <span class="hljs-string">'string'</span>,
              label: <span class="hljs-string">'商品ID'</span>,
              tableOption: { <span class="hljs-attribute">width</span>: <span class="hljs-number">300</span>, <span class="hljs-string">'show-overflow-tooltip'</span>: true },
              editFormOption: { comType: <span class="hljs-string">'input'</span>, disabled: true }
            },
            // 商品名称：支持动态下拉搜索、表单输入校验（<span class="hljs-number">3</span>-<span class="hljs-number">20</span>字）
            product_name: {
              type: <span class="hljs-string">'string'</span>,
              label: <span class="hljs-string">'商品名称'</span>,
              maxLength: <span class="hljs-number">20</span>,
              minLength: <span class="hljs-number">3</span>,
              searchOption: { comType: <span class="hljs-string">'dynamicSelect'</span>, api: <span class="hljs-string">'/api/proj/product_enum/list'</span> },
              createFormOption: { comType: <span class="hljs-string">'input'</span>, default: <span class="hljs-string">'哲玄新课程'</span> }
            },
            // 价格：数值范围校验（<span class="hljs-number">30</span>-<span class="hljs-number">1000</span>）、表格保留<span class="hljs-number">2</span>位小数、下拉搜索
            price: {
              type: <span class="hljs-string">'number'</span>,
              label: <span class="hljs-string">'价格'</span>,
              maximum: <span class="hljs-number">1000</span>,
              minimum: <span class="hljs-number">30</span>,
              tableOption: { <span class="hljs-attribute">width</span>: <span class="hljs-number">200</span>, toFixed: <span class="hljs-number">2</span> },
              searchOption: { comType: <span class="hljs-string">'select'</span>, enumList: [{ <span class="hljs-selector-tag">label</span>: <span class="hljs-string">'￥39.0'</span>, value: <span class="hljs-number">39.0</span> }, ...] },
              createFormOption: { comType: <span class="hljs-string">'inputNumber'</span> }
            },
            // 其他字段（库存、创建时间）：略...
          },
          required: [<span class="hljs-string">'product_name'</span>] // 表单必填字段
        },
        tableConfig: {       // 表格交互配置（按钮、操作逻辑）
          headerButtons: [{  // 表格顶部按钮（新增商品）
            <span class="hljs-selector-tag">label</span>: <span class="hljs-string">'添加商品'</span>,
            eventKey: <span class="hljs-string">'showComponent'</span>, // 触发事件（显示弹窗）
            eventOption: { comName: <span class="hljs-string">'createForm'</span> } // 弹窗类型（新增表单）
          }],
          rowButtons: [      // 表格行操作按钮（详情、修改、删除）
            { <span class="hljs-selector-tag">label</span>: <span class="hljs-string">'详情'</span>, eventKey: <span class="hljs-string">'showComponent'</span>, eventOption: { comName: <span class="hljs-string">'detailPanel'</span> } },
            { <span class="hljs-selector-tag">label</span>: <span class="hljs-string">'修改'</span>, eventKey: <span class="hljs-string">'showComponent'</span>, eventOption: { comName: <span class="hljs-string">'editForm'</span> } },
            { <span class="hljs-selector-tag">label</span>: <span class="hljs-string">'删除'</span>, eventKey: <span class="hljs-string">'remove'</span>, eventOption: { params: { product_id: <span class="hljs-string">'schema::product_id'</span> } } }
          ]
        },
        componentConfig: {   // 弹窗组件配置（标题、按钮文本）
          createForm: { title: <span class="hljs-string">'添加商品'</span>, saveBtnText: <span class="hljs-string">'保存'</span> },
          editForm: { mainKey: <span class="hljs-string">'product_id'</span>, title: <span class="hljs-string">'编辑商品'</span> },
          detailPanel: { mainKey: <span class="hljs-string">'product_id'</span>, title: <span class="hljs-string">'商品详情'</span> }
        }
      }
    },
    // 其他菜单（订单管理-自定义页、客户管理-自定义页）：略...
  ]
}
</code></pre>
<h2 data-id="heading-20">三、配置渲染流程：从 “配置” 到 “页面” 的全链路实现</h2>
<p>前端基于 Vue3 实现配置的自动化渲染，核心分为 “配置获取” 与 “页面渲染” 两步，全程无需手动编写页面代码：</p>
<p><strong>1. 第一步：配置获取（衔接 BFF Serve 层）</strong></p>
<p>领域模型配置由 BFF Serve 层统一管理，前端通过接口获取配置并缓存，确保多页面共享数据：</p>
<ol>
<li><strong>接口请求</strong>：在系统入口（如 <code>dashboard.vue</code>）调用 BFF 层的 <code>/api/project</code> 接口，传入项目标识（<code>proj_key</code>），获取包含 “菜单、页面、字段” 的完整配置；</li>
<li><strong>状态缓存</strong>：将配置存入 Vuex/Pinia 状态管理（如 <code>menuStore</code> 存储菜单配置、<code>projectStore</code> 存储项目信息），避免重复请求；</li>
<li><strong>配置分发</strong>：路由切换时，从状态管理中读取当前菜单对应的配置，传递给动态渲染组件。</li>
</ol>
<p><strong>2. 第二步：页面渲染（分场景适配）</strong></p>
<p>根据配置中的 <code>moduleType</code>（页面类型），前端自动匹配渲染逻辑，实现 “一套代码适配多场景”：</p>
<p>（1）schema-view 渲染（核心 CRUD 页面）</p>
<p>通过自定义 Hook <code>useSchema</code> 解析配置，将 JSON Schema 拆分为 “表格配置、搜索配置、组件配置”，再结合 Vue 动态组件渲染页面：</p>
<ul>
<li>
<p><strong>配置解析</strong>：<code>useSchema</code> 钩子接收 <code>schemaConfig</code>，提取 <code>api</code>（接口地址）、<code>tableSchema</code>（表格字段）、<code>searchSchema</code>（搜索字段）、<code>components</code>（弹窗组件）；</p>
</li>
<li>
<p><strong>组件渲染</strong>：</p>
<ul>
<li>搜索栏：根据 <code>searchSchema</code> 动态生成组件（输入框、下拉框、日期范围选择器），并绑定校验规则；</li>
<li>表格：基于 <code>tableSchema</code> 渲染列，结合 <code>tableConfig</code> 渲染顶部 / 行操作按钮，点击按钮时触发 <code>eventKey</code> 对应的逻辑（如显示弹窗、调用删除接口）；</li>
<li>弹窗：根据 <code>componentConfig</code> 渲染 “新增 / 编辑 / 详情” 弹窗，自动关联表单字段与校验规则。</li>
</ul>
</li>
</ul>
<p>（2）iframe 渲染（嵌入外部页面）</p>
<ol>
<li>从菜单配置中读取 <code>iframe</code> 类型对应的嵌入路径（如 <code>customConfig.path</code>）；</li>
<li>在 Vue 模板中使用 <code>&lt;iframe&gt;</code> 标签，动态绑定 <code>src</code> 属性为嵌入路径，实现外部页面的无缝嵌入。</li>
</ol>
<p>（3）custom 渲染（自定义页面）</p>
<ol>
<li>配置中指定自定义页面的 Vue 组件路径（如 <code>customConfig.path</code>）；</li>
<li>通过 Vue3 的异步加载组件，在路由对应的页面中渲染，满足个性化交互需求（如复杂表单、数据可视化）。</li>
</ol>
<p><strong>3. 核心渲染代码示例（<code>dashboard.vue</code> 入口）</strong></p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-config-provider</span> <span class="hljs-attr">:locale</span>=<span class="hljs-string">"zhCn"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 头部导航（渲染菜单） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header-view</span> <span class="hljs-attr">:proj-name</span>=<span class="hljs-string">"projName"</span> @<span class="hljs-attr">menu-select</span>=<span class="hljs-string">"onMenuSelect"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 动态路由出口（渲染对应页面） --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">main-content</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header-view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-config-provider</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { useRouter, useRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-router"</span>;
<span class="hljs-keyword">import</span> { useMenuStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"$elpisStore/menu"</span>; <span class="hljs-comment">// 菜单状态管理</span>
<span class="hljs-keyword">import</span> { useProjectStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"$elpisStore/project"</span>; <span class="hljs-comment">// 项目状态管理</span>
<span class="hljs-keyword">import</span> $curl <span class="hljs-keyword">from</span> <span class="hljs-string">"$elpisCommon/curl.js"</span>; <span class="hljs-comment">// 接口请求工具</span>

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>();
<span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>();
<span class="hljs-keyword">const</span> menuStore = <span class="hljs-title function_">useMenuStore</span>();
<span class="hljs-keyword">const</span> projectStore = <span class="hljs-title function_">useProjectStore</span>();
<span class="hljs-keyword">const</span> projName = <span class="hljs-title function_">ref</span>(<span class="hljs-string">""</span>);

<span class="hljs-comment">// 初始化：获取配置并缓存</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">getProjectConfig</span>();
});

<span class="hljs-comment">// 调用 BFF 接口获取领域模型配置</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getProjectConfig</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> $curl({
    <span class="hljs-attr">method</span>: <span class="hljs-string">"get"</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-string">"/api/project"</span>,
    <span class="hljs-attr">query</span>: { <span class="hljs-attr">proj_key</span>: route.<span class="hljs-property">query</span>.<span class="hljs-property">proj_key</span> } <span class="hljs-comment">// 项目标识</span>
  });
  <span class="hljs-keyword">if</span> (res?.<span class="hljs-property">success</span> &amp;&amp; res.<span class="hljs-property">data</span>) {
    <span class="hljs-keyword">const</span> { name, menu } = res.<span class="hljs-property">data</span>;
    projName.<span class="hljs-property">value</span> = name;
    menuStore.<span class="hljs-title function_">setMenuList</span>(menu); <span class="hljs-comment">// 缓存菜单配置</span>
  }
}

<span class="hljs-comment">// 菜单点击：切换路由，匹配对应页面</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">onMenuSelect</span> = (<span class="hljs-params">menuItem</span>) =&gt; {
  <span class="hljs-keyword">const</span> { key, moduleType, customConfig } = menuItem;
  <span class="hljs-comment">// 路由路径映射（根据页面类型匹配）</span>
  <span class="hljs-keyword">const</span> pathMap = {
    <span class="hljs-attr">schema</span>: <span class="hljs-string">"/schema"</span>,    <span class="hljs-comment">// Schema 渲染页路径</span>
    <span class="hljs-attr">iframe</span>: <span class="hljs-string">"/iframe"</span>,    <span class="hljs-comment">// iframe 嵌入页路径</span>
    <span class="hljs-attr">custom</span>: customConfig?.<span class="hljs-property">path</span> <span class="hljs-comment">// 自定义页路径</span>
  };
  <span class="hljs-comment">// 跳转路由（携带项目标识、菜单标识）</span>
  router.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">path</span>: <span class="hljs-string">`/view/dashboard`</span>,
    <span class="hljs-attr">query</span>: { key, <span class="hljs-attr">proj_key</span>: route.<span class="hljs-property">query</span>.<span class="hljs-property">proj_key</span> }
  });
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-21">里程碑四 基于 vue3 完成动态组件库建设</h2>
<p>上一阶段通过 DSL 配置实现了 schema-view 页面自动化渲染，本阶段核心是构建<strong>配置驱动的动态组件库</strong>，用 JsonSchema 统一描述组件结构与逻辑</p>
<p><strong>一、解决三大关键问题</strong></p>
<ol>
<li><strong>配置体系</strong>：用一份 jsonSchema 覆盖 “组件是什么、何时触发、包含什么、如何交互”；</li>
<li><strong>渲染通信</strong>：实现三层组件（容器→中间件→控件）解耦与跨层级联动。</li>
</ol>
<p><strong>二、配置体系：四层结构定义组件全生命周期</strong></p>
<p>基于 “单一数据源” 思想，在领域模型基础上扩展配置，确保框架可自动识别逻辑：</p>
<ol>
<li>组件元信息（componentConfig）：定义 “是什么”</li>
</ol>
<p>描述组件基础属性，如标题、按钮文本、主键（用于数据回显）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">schemaConfig</span>: {
  <span class="hljs-attr">componentConfig</span>: {
    <span class="hljs-attr">createForm</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'添加商品'</span>, <span class="hljs-attr">saveBtnText</span>: <span class="hljs-string">'保存'</span> },
    <span class="hljs-attr">editForm</span>: { <span class="hljs-attr">mainKey</span>: <span class="hljs-string">'product_id'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'编辑商品'</span> },
    <span class="hljs-attr">detailPanel</span>: { <span class="hljs-attr">mainKey</span>: <span class="hljs-string">'product_id'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'商品详情'</span> }
  }
}
</code></pre>
<ol start="2">
<li>触发规则（tableConfig）：定义触发</li>
</ol>
<p>在表格按钮中配置事件，通过 <code>eventKey</code> 关联组件，统一交互逻辑：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">schemaConfig</span>: {
  <span class="hljs-attr">tableConfig</span>: {
    <span class="hljs-attr">headerButtons</span>: [{ <span class="hljs-comment">// 表头按钮→新增组件</span>
      <span class="hljs-attr">label</span>: <span class="hljs-string">'添加商品'</span>,
      <span class="hljs-attr">eventKey</span>: <span class="hljs-string">'showComponent'</span>, 
      <span class="hljs-attr">eventOption</span>: { <span class="hljs-attr">comName</span>: <span class="hljs-string">'createForm'</span> }
    }],
    <span class="hljs-attr">rowButtons</span>: [ <span class="hljs-comment">// 行按钮→详情/编辑/删除</span>
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'详情'</span>, <span class="hljs-attr">eventKey</span>: <span class="hljs-string">'showComponent'</span>, <span class="hljs-attr">eventOption</span>: { <span class="hljs-attr">comName</span>: <span class="hljs-string">'detailPanel'</span> } },
      { <span class="hljs-attr">label</span>: <span class="hljs-string">'删除'</span>, <span class="hljs-attr">eventKey</span>: <span class="hljs-string">'remove'</span>, <span class="hljs-attr">eventOption</span>: { <span class="hljs-attr">params</span>: { <span class="hljs-attr">product_id</span>: <span class="hljs-string">'schema::product_id'</span> } } }
    ]
  }
}
</code></pre>
<ol start="3">
<li>字段属性（properties）：定义 “包含什么”</li>
</ol>
<p>为字段配置不同组件中的表现（控件类型、校验规则），通过 <code>xxxOption</code> 区分场景：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">schemaConfig</span>: {
  <span class="hljs-attr">properties</span>: {
    <span class="hljs-attr">product_name</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
      <span class="hljs-attr">label</span>: <span class="hljs-string">'商品名称'</span>,
      <span class="hljs-attr">maxLength</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 全局校验</span>
      <span class="hljs-attr">searchOption</span>: { <span class="hljs-attr">comType</span>: <span class="hljs-string">'dynamicSelect'</span>, <span class="hljs-attr">api</span>: <span class="hljs-string">'/api/proj/enum'</span> }, <span class="hljs-comment">// 搜索框</span>
      <span class="hljs-attr">createFormOption</span>: { <span class="hljs-attr">comType</span>: <span class="hljs-string">'input'</span>, <span class="hljs-attr">default</span>: <span class="hljs-string">'哲玄新课程'</span> } <span class="hljs-comment">// 新增表单</span>
    },
    <span class="hljs-attr">price</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>,
      <span class="hljs-attr">minimum</span>: <span class="hljs-number">30</span>,
      <span class="hljs-attr">tableOption</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">toFixed</span>: <span class="hljs-number">2</span> }, <span class="hljs-comment">// 表格显示</span>
      <span class="hljs-attr">createFormOption</span>: { <span class="hljs-attr">comType</span>: <span class="hljs-string">'inputNumber'</span> } <span class="hljs-comment">// 表单控件</span>
    }
  }
}
</code></pre>
<ol start="4">
<li>API 交互：定义 “如何通信”
遵循 REST 规范，基础 API 统一配置，框架自动映射 HTTP 方法（新增→POST、删除→DELETE），动态参数用 <code>schema::xxx</code> 取表格行数据。</li>
</ol>
<p><strong>三、分层渲染：三层结构解耦加载</strong>
按职责拆分组件，用 Vue 动态组件实现自动化渲染，便于扩展：</p>
<h3 data-id="heading-22">1. 目录结构</h3>
<p>plaintext</p>
<pre><code class="hljs language-bash" lang="bash">src/
├── pages/schema-view/       <span class="hljs-comment"># 顶层容器：管理状态与事件</span>
│   ├── schema-view.vue
│   └── components/          <span class="hljs-comment"># 中间层：预设组件（新增/编辑/详情）</span>
│       ├── create-form/
│       └── component-config.js <span class="hljs-comment"># 组件映射（comName→组件路径）</span>
└── widgets/schema-form/     <span class="hljs-comment"># 底层：字段控件（输入框/下拉框）</span>
    ├── schema-form.vue      <span class="hljs-comment"># 控件容器</span>
    └── components/          <span class="hljs-comment"># 具体控件</span>
</code></pre>
<p>2.  核心渲染逻辑（schema-view.vue）</p>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 表格+搜索栏（复用前序实现） --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-table</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 动态渲染中间层组件 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">component</span>
    <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(com, comName) in components"</span>
    <span class="hljs-attr">:key</span>=<span class="hljs-string">"comName"</span>
    <span class="hljs-attr">:is</span>=<span class="hljs-string">"ComponentMap[comName]"</span>
    <span class="hljs-attr">:schema</span>=<span class="hljs-string">"com.schema"</span>
    <span class="hljs-attr">:api</span>=<span class="hljs-string">"api"</span>
    @<span class="hljs-attr">command</span>=<span class="hljs-string">"handleComCommand"</span> &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">监听组件事件</span>（<span class="hljs-attr">如保存成功</span>） <span class="hljs-attr">--</span>&gt;</span>
  /&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/hooks/schema.js"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ComponentMap</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./components/component-config.js"</span>;

<span class="hljs-keyword">const</span> { api, components } = <span class="hljs-title function_">useSchema</span>();
<span class="hljs-comment">// 处理组件事件（如保存后刷新表格）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleComCommand</span> = (<span class="hljs-params">{ event }</span>) =&gt; {
  <span class="hljs-keyword">if</span> (event === <span class="hljs-string">"saveSuccess"</span>) <span class="hljs-title function_">emit</span>(<span class="hljs-string">"refreshTable"</span>);
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>四、通信机制：高效跨层级联动</strong></p>
<ol>
<li><strong>数据向下</strong>：顶层用 <code>provide</code> 提供 API、配置，中间层 / 底层用 <code>inject</code> 直接获取，避免 props 层层传递；</li>
<li><strong>事件向上</strong>：中间层通过 <code>emit</code> 触发事件（如 <code>saveSuccess</code>），顶层监听后执行逻辑（如刷新表格）；</li>
<li><strong>组件调用</strong>：顶层用 <code>ref</code> 获取中间层组件实例，主动调用方法（如编辑时回显数据）。</li>
</ol>
<h2 data-id="heading-23">里程碑五 完成 elpis-npm 包分离并发布</h2>
<p>本阶段核心目标是<strong>实现 “核心 - 业务” 彻底解耦</strong>：将框架核心能力（elpis-core、webpack 工程化、基础组件）封装为<code>elpis</code> npm 包，业务侧仅需安装该包，按约定目录开发即可，无需关注底层配置，真正实现 “聚焦业务、核心托管”。</p>
<p><strong>elpis-core：自动扫描业务代码，实现 “业务模块零配置挂载”</strong></p>
<p>为各加载器（controller、service 等）新增<strong>业务层扫描逻辑</strong>，自动识别业务目录下的模块并挂载到框架实例，无需手动注册。<br/>
以<strong>控制器加载器</strong>为例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// elpis-core/loader/controllerLoader.js</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> glob = <span class="hljs-built_in">require</span>(<span class="hljs-string">'glob'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadController</span>(<span class="hljs-params">app</span>) {
  <span class="hljs-comment">// 1. 加载框架核心控制器（原有逻辑）</span>
  <span class="hljs-keyword">const</span> coreControllerPath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'../app/controller'</span>);
  glob.<span class="hljs-title function_">sync</span>(<span class="hljs-string">`<span class="hljs-subst">${coreControllerPath}</span>/**/*.js`</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> <span class="hljs-title function_">handlerFile</span>(file, app));

  <span class="hljs-comment">// 2. 新增：扫描业务层控制器（约定业务路径 app/controller）</span>
  <span class="hljs-keyword">const</span> businessControllerPath = path.<span class="hljs-title function_">resolve</span>(app.<span class="hljs-property">businessPath</span>, <span class="hljs-string">'./controller'</span>);
  <span class="hljs-keyword">const</span> businessFileList = glob.<span class="hljs-title function_">sync</span>(<span class="hljs-string">`<span class="hljs-subst">${businessControllerPath}</span>/**/*.js`</span>);
  businessFileList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> <span class="hljs-title function_">handlerFile</span>(file, app));
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`-- [elpis] loaded <span class="hljs-subst">${businessFileList.length}</span> business controllers --`</span>);
}

<span class="hljs-comment">// 统一挂载逻辑：核心与业务模块共用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handlerFile</span>(<span class="hljs-params">file, app</span>) {
  <span class="hljs-keyword">const</span> controller = <span class="hljs-built_in">require</span>(file);
  <span class="hljs-keyword">const</span> moduleName = path.<span class="hljs-title function_">dirname</span>(file).<span class="hljs-title function_">split</span>(path.<span class="hljs-property">sep</span>).<span class="hljs-title function_">pop</span>();
  <span class="hljs-keyword">if</span> (!app.<span class="hljs-property">controller</span>[moduleName]) app.<span class="hljs-property">controller</span>[moduleName] = {};
  app.<span class="hljs-property">controller</span>[moduleName][path.<span class="hljs-title function_">basename</span>(file, <span class="hljs-string">'.js'</span>)] = controller;
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = loadController;
</code></pre>
<p>同时改造<code>elpis-core/index.js</code>，新增<strong>业务全局中间件注册</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// elpis-core/index.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">options = {}</span>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
  app.<span class="hljs-property">businessPath</span> = options.<span class="hljs-property">businessPath</span> || process.<span class="hljs-title function_">cwd</span>() + <span class="hljs-string">'/app'</span>; <span class="hljs-comment">// 约定业务路径</span>

  <span class="hljs-comment">// 注册业务全局中间件（约定业务路径 middleware.js）</span>
  <span class="hljs-keyword">try</span> {
    <span class="hljs-built_in">require</span>(<span class="hljs-string">`<span class="hljs-subst">${app.businessPath}</span>/middleware.js`</span>)(app);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`-- [elpis] loaded business global middleware --`</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[elpis] no business middleware, skip`</span>);
  }

  <span class="hljs-comment">// 加载核心+业务模块（controller、service等）</span>
  <span class="hljs-title function_">loadController</span>(app);
  <span class="hljs-title function_">loadService</span>(app);
  app.<span class="hljs-title function_">listen</span>(options.<span class="hljs-property">port</span> || <span class="hljs-number">3000</span>);
  <span class="hljs-keyword">return</span> app;
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = { start };
</code></pre>
<p><strong>2. webpack 配置：自动扫描业务页面，实现 “业务入口零配置打包”</strong></p>
<p>对<code>webpack.base.js</code>/<code>dev.js</code>/<code>prod.js</code>改造，新增<strong>业务层入口扫描</strong>，自动将业务页面纳入打包流程：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// webpack/base.js</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> glob = <span class="hljs-built_in">require</span>(<span class="hljs-string">'glob'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>);

<span class="hljs-comment">// 1. 初始化业务入口与HTML插件容器</span>
<span class="hljs-keyword">const</span> businessEntries = {};
<span class="hljs-keyword">const</span> businessHtmlPlugins = [];

<span class="hljs-comment">// 2. 扫描业务层入口（约定 app/pages/**/entry.*.js）</span>
<span class="hljs-keyword">const</span> businessEntryList = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'./app/pages/**/entry.*.js'</span>);
glob.<span class="hljs-title function_">sync</span>(businessEntryList).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> entryName = path.<span class="hljs-title function_">basename</span>(file, <span class="hljs-string">'.js'</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-string">'entry.'</span>, <span class="hljs-string">''</span>);
  <span class="hljs-comment">// 配置入口</span>
  businessEntries[entryName] = file;
  <span class="hljs-comment">// 配置HTML模板</span>
  businessHtmlPlugins.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
    <span class="hljs-attr">filename</span>: <span class="hljs-string">`<span class="hljs-subst">${entryName}</span>.html`</span>,
    <span class="hljs-attr">template</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'../template/entry.tpl'</span>),
    <span class="hljs-attr">chunks</span>: [entryName]
  }));
});

<span class="hljs-comment">// 3. 合并核心与业务配置（最终导出）</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: { ...coreEntries, ...businessEntries }, <span class="hljs-comment">// 合并入口</span>
  <span class="hljs-attr">plugins</span>: [...corePlugins, ...businessHtmlPlugins], <span class="hljs-comment">// 合并插件</span>
  <span class="hljs-comment">// 其他基础配置（loader、resolve等不变）</span>
};
</code></pre>
<p><strong>3. 框架入口 index.js：封装核心 API，对外暴露标准化能力</strong></p>
<p>将框架核心能力（服务启动、前端构建）封装为函数，对外暴露清晰 API，业务侧直接调用：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// index.js（elpis包入口）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ElpisCore</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./elpis-core"</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">FEBuildDev</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./webpack/dev.js'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">FEBuildProd</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./webpack/prod.js'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// 1. 暴露基础类（供业务继承，减少重复编码）</span>
  <span class="hljs-title class_">Controller</span>: { <span class="hljs-title class_">Base</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/controller/base.js'</span>) },
  <span class="hljs-title class_">Service</span>: { <span class="hljs-title class_">Base</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'./app/service/base.js'</span>) },

  <span class="hljs-comment">// 2. 前端构建：支持开发/生产环境</span>
  <span class="hljs-title function_">frontendBuild</span>(<span class="hljs-params">paramsEnv</span>) {
    <span class="hljs-keyword">const</span> env = paramsEnv.<span class="hljs-title function_">trim</span>();
    env === <span class="hljs-string">'local'</span> ? <span class="hljs-title class_">FEBuildDev</span>() : <span class="hljs-title class_">FEBuildProd</span>();
  },

  <span class="hljs-comment">// 3. BFF服务启动：接收业务配置，返回实例</span>
  <span class="hljs-title function_">serverStart</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-keyword">const</span> app = <span class="hljs-title class_">ElpisCore</span>.<span class="hljs-title function_">start</span>(options);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`-- [elpis] server started at port <span class="hljs-subst">${options.port || <span class="hljs-number">3000</span>}</span> --`</span>);
    <span class="hljs-keyword">return</span> app;
  }
};
</code></pre>
<h3 data-id="heading-24">4. entry.dashboard.js：支持业务路由拓展，零配置注入</h3>
<p>新增<strong>业务路由拓展机制</strong>，业务侧按约定暴露配置函数即可自动注入路由：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// app/pages/dashboard/entry.dashboard.js</span>
<span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;

<span class="hljs-comment">// 1. 框架核心路由（原有逻辑）</span>
<span class="hljs-keyword">const</span> routes = [<span class="hljs-comment">/* 核心页面路由 */</span>];
<span class="hljs-keyword">const</span> siderRoutes = [<span class="hljs-comment">/* 核心菜单路由 */</span>];

<span class="hljs-comment">// 2. 新增：业务路由拓展（约定业务暴露 businessDashboardRouterConfig）</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> businessDashboardRouterConfig === <span class="hljs-string">'function'</span>) {
  <span class="hljs-title function_">businessDashboardRouterConfig</span>({ routes, siderRoutes });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`-- [elpis] extended business routes --`</span>);
}

<span class="hljs-comment">// 3. 创建路由实例并导出</span>
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({ <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(), routes });
<span class="hljs-keyword">export</span> { router, siderRoutes };
</code></pre>
<p><strong>5. 组件配置文件：支持业务组件拓展，合并导出</strong></p>
<p>改造<code>schema-view/components/component-config.js</code>与<code>widgets/**/xx-item-config.js</code>，新增<strong>业务组件导入</strong>，合并核心与业务组件：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// schema-view/components/component-config.js</span>
<span class="hljs-comment">// 1. 框架核心组件（原有逻辑）</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CreateForm</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./create-form'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ComponentConfig</span> = { createForm };

<span class="hljs-comment">// 2. 新增：导入业务组件（约定业务路径 $businessComponentConfig）</span>
<span class="hljs-keyword">import</span> businessComponentConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'$businessComponentConfig'</span>;

<span class="hljs-comment">// 3. 合并导出（业务组件覆盖核心组件，支持定制）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> { ...<span class="hljs-title class_">ComponentConfig</span>, ...businessComponentConfig };
</code></pre>
<p><strong>二、业务侧使用：elpis-demo 项目零配置开发</strong></p>
<p>业务侧只需创建<code>elpis-demo</code>项目，按以下步骤即可快速开发：</p>
<ol>
<li>
<p><strong>安装 elpis 包</strong>：<code>npm install elpis --save</code>（或<code>npm link</code>本地调试）；</p>
</li>
<li>
<p><strong>按约定目录开发</strong>：业务代码放在<code>app</code>目录下（如<code>app/controller</code>、<code>app/pages</code>），无需配置 webpack/elpis-core；</p>
</li>
</ol>
<p><strong>三、包发布：npm 流程</strong></p>
<ol>
<li><strong>本地调试</strong>：通过<code>npm link</code>将<code>elpis</code>包链接到<code>elpis-demo</code>，验证功能；</li>
<li><strong>登录 npm</strong>：<code>npm login</code>（输入账号密码）；</li>
<li><strong>发布包</strong>：<code>npm publish</code>（确保<code>package.json</code>中<code>name</code>唯一，版本号正确）。</li>
</ol>
<h2 data-id="heading-25">迭代发展方向</h2>
<p>深度融合 AI</p>
<p><strong>AI 需求转配置</strong>：基于框架开发指南构建专属 AI 提示词（Prompt），开发者只需输入自然语言需求（如 “新增电商分销管理模块，包含分销员列表、佣金统计、订单关联功能”），AI 即可自动生成符合 elpis 规范的领域模型配置（字段定义、组件交互、API 映射），无需手动编写 jsonSchema 配置；</p>
<p><strong>AI Agent：打造 “开发助手”:</strong>
开发 elpis 专属 AI Agent，集成框架所有核心能力与规范，支持多维度交互：</p>
<ul>
<li><strong>配置生成</strong>：根据开发者需求描述，生成 schema-view 页面配置、业务路由配置、组件拓展配置等，直接适配 elpis 框架的动态渲染逻辑；</li>
<li><strong>问题解答</strong>：开发者遇到配置疑问（如 “如何自定义表格行操作按钮”“业务组件如何挂载到框架”）时，AI Agent 可基于框架文档精准回复，并提供代码示例；</li>
<li><strong>能力拓展</strong>：支持开发者提出组件拓展需求（如 “开发一个带时间范围选择的搜索控件”），AI Agent 自动生成符合 elpis 组件规范的代码，并说明挂载方式，确保不偏离框架生态。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[里程碑4：schema-form 动态组件开发]]></title>    <link>https://juejin.cn/post/7599910677578498048</link>    <guid>https://juejin.cn/post/7599910677578498048</guid>    <pubDate>2026-01-27T13:35:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599910677578498048" data-draft-id="7589509638339297306" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="里程碑4：schema-form 动态组件开发"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-27T13:35:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小怪点点"/> <meta itemprop="url" content="https://juejin.cn/user/1171413526123865"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            里程碑4：schema-form 动态组件开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1171413526123865/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小怪点点
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T13:35:45.000Z" title="Tue Jan 27 2026 13:35:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">动态组件基于领域模型来设计，以数据驱动开发。</h3>
<p>在模型中增加componentConfig来配置用到的组件的属性，每个字段增加componentOption来配置在每个动态组件中该字段的展现形式，及默认值等。</p>
<p>抽象出schema-form组件：使用动态组件<code>&lt;component&gt;</code>来按需加载input、select等，form-item-config.js中列出组件的键值对。
schema-form下边的input，select等组件中需要引入ajv，根据领域模型中配置的标准schema，来校验相关表单项是否有效。提供出validate及getValue方法。</p>
<pre><code class="hljs language-import" lang="import">import inputNumber from './complex-view/input-number/input-number.vue';
import select from './complex-view/select/select.vue';
const formItemConfig = {
  input: {
    component: input,
  },
  inputNumber: {
    component: inputNumber,
  },
  select: {
    component: select,
  },
};
export default formItemConfig;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df948ab6b96d4ebfb060b3e44fbfb9ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5oCq54K554K5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770125744&amp;x-signature=oH4Fo8RNpkD2TVzY02D%2FocW5qag%3D" alt="image.png" loading="lazy"/></p>
<p>从配置中拿到配置的组件，在schema-view中将动态组件引入。
使用抽屉形式弹出createForm、editForm、detailForm。</p>
<p>在schema中字段配置里配置createFormOption，editFormOption等，来设定该字段在这个组件中是否显示，以输入框还是select形式显示等。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS-从基础到进阶，原生 JS 手写无缝轮播图]]></title>    <link>https://juejin.cn/post/7599924965950521382</link>    <guid>https://juejin.cn/post/7599924965950521382</guid>    <pubDate>2026-01-27T14:21:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599924965950521382" data-draft-id="7599852042530111498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS-从基础到进阶，原生 JS 手写无缝轮播图"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2026-01-27T14:21:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS-从基础到进阶，原生 JS 手写无缝轮播图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:21:38.000Z" title="Tue Jan 27 2026 14:21:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>轮播图（Carousel）是前端开发中最基础也最经典的组件之一。看似简单，但要实现丝滑、无缝的循环切换效果，其实隐藏着许多关于 DOM 操作和 CSS 动画的细节。本文将带你从基础版过渡到进阶无缝版。</p>
<h2 data-id="heading-1">一、 基础版：基于 Transform 的位移实现</h2>
<h3 data-id="heading-2">1. 核心原理</h3>
<ol>
<li><strong>外层容器</strong>：设置 <code>overflow: hidden</code>，宽度固定。</li>
<li><strong>内层轨道</strong>：使用 <code>display: flex</code> 让图片横向排列。</li>
<li><strong>位移逻辑</strong>：通过修改轨道的 <code>transform: translateX()</code> 值来实现切换。</li>
</ol>
<h3 data-id="heading-3">2. 存在的问题</h3>
<p>当你从最后一张点击“下一张”时，为了回到第一张，轨道会向相反方向快速滑过中间所有图片。这种“视觉回退”体验很差，无法达到真正的“循环”感。</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>简单轮播图 - 方法1<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
      * {
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
        <span class="hljs-attribute">box-sizing</span>: border-box;
      }

      <span class="hljs-selector-tag">body</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
        <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
      }

      <span class="hljs-selector-class">.container</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">800px</span>;
        <span class="hljs-attribute">background</span>: white;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      }

      <span class="hljs-selector-tag">h1</span> {
        <span class="hljs-attribute">text-align</span>: center;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
        <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
      }

      <span class="hljs-comment">/* 轮播图容器 */</span>
      <span class="hljs-selector-class">.carousel-container</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
        <span class="hljs-attribute">position</span>: relative;
        <span class="hljs-attribute">overflow</span>: hidden;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      }

      <span class="hljs-comment">/* 轮播图列表 */</span>
      <span class="hljs-selector-class">.carousel-list</span> {
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.5s</span> ease-in-out;
      }

      <span class="hljs-comment">/* 轮播图项 */</span>
      <span class="hljs-selector-class">.carousel-slide</span> {
        <span class="hljs-attribute">min-width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">display</span>: flex;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>;
        <span class="hljs-attribute">color</span>: white;
      }

      <span class="hljs-comment">/* 左右导航按钮 */</span>
      <span class="hljs-selector-class">.carousel-button</span> {
        <span class="hljs-attribute">position</span>: absolute;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">50%</span>);
        <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
        <span class="hljs-attribute">color</span>: white;
        <span class="hljs-attribute">border</span>: none;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
        <span class="hljs-attribute">cursor</span>: pointer;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
        <span class="hljs-attribute">transition</span>: background <span class="hljs-number">0.3s</span>;
      }

      <span class="hljs-selector-class">.carousel-button</span><span class="hljs-selector-pseudo">:hover</span> {
        <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.8</span>);
      }

      <span class="hljs-selector-class">.button-prev</span> {
        <span class="hljs-attribute">left</span>: <span class="hljs-number">10px</span>;
      }

      <span class="hljs-selector-class">.button-next</span> {
        <span class="hljs-attribute">right</span>: <span class="hljs-number">10px</span>;
      }

    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>简单轮播图 - 方法1: transform实现<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"carousel-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-list"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"carousel-list"</span>&gt;</span>
          <span class="hljs-comment">&lt;!-- 图片项，用不同颜色表示不同图片 --&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #ff6b6b"</span>&gt;</span>图片 1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #4ecdc4"</span>&gt;</span>图片 2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #45b7d1"</span>&gt;</span>图片 3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #96ceb4"</span>&gt;</span>图片 4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #ffeaa7"</span>&gt;</span>图片 5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 导航按钮 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button-prev"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-button button-prev"</span>&gt;</span>‹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button-next"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-button button-next"</span>&gt;</span>›<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-keyword">const</span> carouselContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'carousel-container'</span>) <span class="hljs-comment">//轮播图容器</span>
      <span class="hljs-keyword">const</span> carouselList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"carousel-list"</span>); <span class="hljs-comment">// 轮播列表</span>
      <span class="hljs-keyword">const</span> slides = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(carouselList.<span class="hljs-property">children</span>); <span class="hljs-comment">// 被轮播的图片</span>
      <span class="hljs-keyword">const</span> prevButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"button-prev"</span>); <span class="hljs-comment">//上一张按钮</span>
      <span class="hljs-keyword">const</span> nextButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"button-next"</span>); <span class="hljs-comment">//下一张按钮</span>

      <span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>; <span class="hljs-comment">// 当前轮播的图片索引</span>
      <span class="hljs-keyword">const</span> slideWidth = slides[<span class="hljs-number">0</span>].<span class="hljs-title function_">getBoundingClientRect</span>().<span class="hljs-property">width</span>; <span class="hljs-comment">// 显示的图片宽度</span>


      <span class="hljs-comment">// 移动到指定索引</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">moveToSlide</span>(<span class="hljs-params">index</span>) {
        <span class="hljs-comment">// 处理边界</span>
        <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>) index = slides.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (index &gt;= slides.<span class="hljs-property">length</span>) index = <span class="hljs-number">0</span>;

        <span class="hljs-comment">// 移动轨道</span>
        carouselList.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">"translateX(-"</span> + slideWidth * index + <span class="hljs-string">"px)"</span>;

        <span class="hljs-comment">// 更新当前索引</span>
        currentIndex = index;

      }


      <span class="hljs-comment">// 下一张</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">nextSlide</span>(<span class="hljs-params"/>) {
        <span class="hljs-title function_">moveToSlide</span>(currentIndex + <span class="hljs-number">1</span>);
      }

      <span class="hljs-comment">// 上一张</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">prevSlide</span>(<span class="hljs-params"/>) {
        <span class="hljs-title function_">moveToSlide</span>(currentIndex - <span class="hljs-number">1</span>);
      }

      <span class="hljs-comment">// 事件监听</span>
      prevButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, prevSlide);
      nextButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, nextSlide);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<hr/>
<h2 data-id="heading-4">二、 进阶版：无缝循环轮播（Seamless Loop）</h2>
<h3 data-id="heading-5">1. 核心改进思路：克隆节点</h3>
<p>为了实现无限向后滚动的假象，我们需要在轨道的头部和尾部做“手脚”：</p>
<ul>
<li><strong>克隆第一张图片</strong>放到列表最后。</li>
<li><strong>克隆最后一张图片</strong>放到列表最前。</li>
</ul>
<h3 data-id="heading-6">2. 实现流程</h3>
<ol>
<li>
<p><strong>初始偏移</strong>：由于开头插入了克隆节点，初始 <code>currentIndex</code> 设为 <code>1</code>。</p>
</li>
<li>
<p><strong>正常滑动</strong>：点击时正常开启动画滑动。</p>
</li>
<li>
<p><strong>瞬间瞬移（核心）</strong> ：</p>
<ul>
<li>监听轨道的 <code>transitionend</code> 事件。</li>
<li>当动画结束，发现当前在“最后一张克隆图”时，立即<strong>关闭动画（transition: none）</strong> ，并瞬间跳回“真正的第一张”。</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>无缝轮播图 - 改进版<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
      * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">box-sizing</span>: border-box; }
      <span class="hljs-selector-tag">body</span> {
        <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>; <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
      }
      <span class="hljs-selector-class">.container</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">800px</span>; <span class="hljs-attribute">background</span>: white; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
      <span class="hljs-selector-tag">h1</span> { <span class="hljs-attribute">text-align</span>: center; <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>; }

      <span class="hljs-selector-class">.carousel-container</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>; <span class="hljs-attribute">position</span>: relative;
        <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      }

      <span class="hljs-selector-class">.carousel-list</span> {
        <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-comment">/* 初始不加 transition，由 JS 控制开关 */</span>
      }

      <span class="hljs-selector-class">.carousel-slide</span> {
        <span class="hljs-attribute">min-width</span>: <span class="hljs-number">100%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>; <span class="hljs-attribute">color</span>: white;
      }

      <span class="hljs-selector-class">.carousel-button</span> {
        <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">50%</span>);
        <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>); <span class="hljs-attribute">color</span>: white; <span class="hljs-attribute">border</span>: none;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>; <span class="hljs-attribute">cursor</span>: pointer;
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>; <span class="hljs-attribute">transition</span>: background <span class="hljs-number">0.3s</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
      }
      <span class="hljs-selector-class">.button-prev</span> { <span class="hljs-attribute">left</span>: <span class="hljs-number">10px</span>; }
      <span class="hljs-selector-class">.button-next</span> { <span class="hljs-attribute">right</span>: <span class="hljs-number">10px</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>无缝轮播图 - 改进版<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-list"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"carousel-list"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #ff6b6b"</span>&gt;</span>图片 1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #4ecdc4"</span>&gt;</span>图片 2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #45b7d1"</span>&gt;</span>图片 3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #96ceb4"</span>&gt;</span>图片 4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-slide"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #ffeaa7"</span>&gt;</span>图片 5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button-prev"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-button button-prev"</span>&gt;</span>‹<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button-next"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel-button button-next"</span>&gt;</span>›<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
      <span class="hljs-keyword">const</span> carouselList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"carousel-list"</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(carouselList)
      <span class="hljs-keyword">const</span> slides = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(carouselList.<span class="hljs-property">children</span>);
      <span class="hljs-keyword">const</span> prevButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"button-prev"</span>);
      <span class="hljs-keyword">const</span> nextButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"button-next"</span>);

      <span class="hljs-comment">// 1. 克隆第一张和最后一张</span>
      <span class="hljs-keyword">const</span> firstClone = slides[<span class="hljs-number">0</span>].<span class="hljs-title function_">cloneNode</span>(<span class="hljs-literal">true</span>);
      <span class="hljs-keyword">const</span> lastClone = slides[slides.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-title function_">cloneNode</span>(<span class="hljs-literal">true</span>);

      <span class="hljs-comment">// 2. 将克隆节点添加到列表</span>
      carouselList.<span class="hljs-title function_">appendChild</span>(firstClone);
      carouselList.<span class="hljs-title function_">insertBefore</span>(lastClone, slides[<span class="hljs-number">0</span>]);

      <span class="hljs-comment">// 3. 重新计算状态</span>
      <span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">1</span>; <span class="hljs-comment">// 因为前面插入了一个，所以初始索引为 1</span>
      <span class="hljs-keyword">const</span> slideWidth = slides[<span class="hljs-number">0</span>].<span class="hljs-title function_">getBoundingClientRect</span>().<span class="hljs-property">width</span>; <span class="hljs-comment">// 使用百分比计算更稳健</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(slides[<span class="hljs-number">0</span>].<span class="hljs-title function_">getBoundingClientRect</span>().<span class="hljs-property">width</span>)
      <span class="hljs-comment">// 初始化显示第一张（不是克隆的第0张）</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`translateX(-<span class="hljs-subst">${currentIndex * slideWidth}</span>)`</span>)
      carouselList.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateX(-<span class="hljs-subst">${currentIndex * slideWidth}</span>px)`</span>;

      <span class="hljs-keyword">function</span> <span class="hljs-title function_">moveToSlide</span>(<span class="hljs-params">index, hasAnimation = <span class="hljs-literal">true</span></span>) {
        currentIndex = index;
        <span class="hljs-comment">// 开启动画</span>
        carouselList.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = hasAnimation ? <span class="hljs-string">"transform 0.5s ease-in-out"</span> : <span class="hljs-string">"none"</span>;
        carouselList.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateX(-<span class="hljs-subst">${currentIndex * slideWidth}</span>px)`</span>;
      }

      <span class="hljs-comment">// 核心：监听过渡结束</span>
      carouselList.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'transitionend'</span>, <span class="hljs-function">() =&gt;</span> {
        
        <span class="hljs-comment">// 如果到了最后的克隆图，瞬间跳回真正的第一张</span>
        <span class="hljs-keyword">if</span> (currentIndex === carouselList.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
          carouselList.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">"none"</span>;
          currentIndex = <span class="hljs-number">1</span>;
          carouselList.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateX(-<span class="hljs-subst">${currentIndex * slideWidth}</span>px)`</span>;
        }
        
        <span class="hljs-comment">// 如果到了最前的克隆图，瞬间跳回真正的最后一张</span>
        <span class="hljs-keyword">if</span> (currentIndex === <span class="hljs-number">0</span>) {
          carouselList.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">"none"</span>;
          currentIndex = carouselList.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>;
          carouselList.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateX(-<span class="hljs-subst">${currentIndex * slideWidth}</span>px)`</span>;
        }
      });

      nextButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">moveToSlide</span>(currentIndex + <span class="hljs-number">1</span>));
      prevButton.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">moveToSlide</span>(currentIndex - <span class="hljs-number">1</span>));
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Three.js 打造炫酷烟花绽放效果]]></title>    <link>https://juejin.cn/post/7599893063863418895</link>    <guid>https://juejin.cn/post/7599893063863418895</guid>    <pubDate>2026-01-27T14:22:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599893063863418895" data-draft-id="7599893063863402511" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Three.js 打造炫酷烟花绽放效果"/> <meta itemprop="keywords" content="前端,three.js"/> <meta itemprop="datePublished" content="2026-01-27T14:22:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Three.js 打造炫酷烟花绽放效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:22:41.000Z" title="Tue Jan 27 2026 14:22:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>本文将详细介绍如何使用 Three.js 和自定义着色器来创建一个炫酷的烟花绽放效果。我们将通过编写顶点着色器和片元着色器来实现烟花从发射到爆炸的完整动画过程，这能帮助你深入理解粒子系统和着色器的高级应用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5101e5eff09472ebff78884b4bd9c10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5qCh6ZW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770128561&amp;x-signature=mzTF3rl4TM8%2FrXKEQFEMwdEAGHY%3D" alt="screenshot_2026-01-27_22-19-51.gif" loading="lazy"/></p>
<h2 data-id="heading-1">准备工作</h2>
<p>首先，我们需要引入必要的 Three.js 库和相关工具：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"three"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/controls/OrbitControls"</span>;
<span class="hljs-keyword">import</span> gsap <span class="hljs-keyword">from</span> <span class="hljs-string">"gsap"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">"dat.gui"</span>;
<span class="hljs-keyword">import</span> vertexShader <span class="hljs-keyword">from</span> <span class="hljs-string">"../shaders/flylight/vertex.glsl"</span>;
<span class="hljs-keyword">import</span> fragmentShader <span class="hljs-keyword">from</span> <span class="hljs-string">"../shaders/flylight/fragment.glsl"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RGBELoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/loaders/RGBELoader"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/loaders/GLTFLoader"</span>;

<span class="hljs-keyword">import</span> <span class="hljs-title class_">Fireworks</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./firework"</span>;

<span class="hljs-comment">// 导入水模块</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Water</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/objects/Water2"</span>;
</code></pre>
<h2 data-id="heading-2">场景初始化</h2>
<p>首先，我们需要创建一个基本的 Three.js 场景：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始化场景</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();

<span class="hljs-comment">// 创建透视相机</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
  <span class="hljs-number">90</span>,
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>,
  <span class="hljs-number">0.1</span>,
  <span class="hljs-number">1000</span>
);

<span class="hljs-comment">// 设置相机位置</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>);
camera.<span class="hljs-property">aspect</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
camera.<span class="hljs-title function_">updateProjectionMatrix</span>();
scene.<span class="hljs-title function_">add</span>(camera);

<span class="hljs-comment">// 加入辅助轴，帮助我们查看3维坐标轴</span>
<span class="hljs-comment">// const axesHelper = new THREE.AxesHelper(5);</span>
<span class="hljs-comment">// scene.add(axesHelper);</span>
</code></pre>
<h2 data-id="heading-3">环境设置</h2>
<p>为了营造更真实的夜空效果，我们需要加载 HDR 环境贴图：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 加载纹理</span>
<span class="hljs-comment">// 创建纹理加载器对象</span>
<span class="hljs-keyword">const</span> rgbeLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RGBELoader</span>();
rgbeLoader.<span class="hljs-title function_">loadAsync</span>(<span class="hljs-string">"./assets/2k.hdr"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">texture</span>) =&gt;</span> {
  texture.<span class="hljs-property">mapping</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">EquirectangularReflectionMapping</span>;
  scene.<span class="hljs-property">background</span> = texture;
  scene.<span class="hljs-property">environment</span> = texture;
});
</code></pre>
<h2 data-id="heading-4">飞行动画着色器材质</h2>
<p>我们先创建一个用于天空中飞行物体的着色器材质：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建着色器材质</span>
<span class="hljs-keyword">const</span> shaderMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>({
  <span class="hljs-attr">vertexShader</span>: vertexShader,
  <span class="hljs-attr">fragmentShader</span>: fragmentShader,
  <span class="hljs-attr">uniforms</span>: {},
  <span class="hljs-attr">side</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">DoubleSide</span>,
  <span class="hljs-comment">// transparent: true,</span>
});
</code></pre>
<h2 data-id="heading-5">模型加载与场景布置</h2>
<p>加载烟花模型和场景中的其他元素：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> gltfLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
<span class="hljs-keyword">let</span> <span class="hljs-title class_">LightBox</span> = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// 加载新年场景模型</span>
gltfLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">"./assets/model/newyears_min.glb"</span>, <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gltf);
  scene.<span class="hljs-title function_">add</span>(gltf.<span class="hljs-property">scene</span>);

  <span class="hljs-comment">// 创建水面</span>
  <span class="hljs-keyword">const</span> waterGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneBufferGeometry</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
  <span class="hljs-keyword">let</span> water = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Water</span>(waterGeometry, {
    <span class="hljs-attr">scale</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">textureHeight</span>: <span class="hljs-number">1024</span>,
    <span class="hljs-attr">textureWidth</span>: <span class="hljs-number">1024</span>,
  });
  water.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-number">1</span>;
  water.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = -<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>;
  scene.<span class="hljs-title function_">add</span>(water);
});

<span class="hljs-comment">// 加载飞行光点模型</span>
gltfLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">"./assets/model/flyLight.glb"</span>, <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gltf);

  <span class="hljs-title class_">LightBox</span> = gltf.<span class="hljs-property">scene</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];
  <span class="hljs-title class_">LightBox</span>.<span class="hljs-property">material</span> = shaderMaterial;

  <span class="hljs-comment">// 创建150个随机分布的飞行光点</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">150</span>; i++) {
    <span class="hljs-keyword">let</span> flyLight = gltf.<span class="hljs-property">scene</span>.<span class="hljs-title function_">clone</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">let</span> x = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">300</span>;
    <span class="hljs-keyword">let</span> z = (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">300</span>;
    <span class="hljs-keyword">let</span> y = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">60</span> + <span class="hljs-number">5</span>;
    flyLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(x, y, z);
    
    <span class="hljs-comment">// 使用 GSAP 添加旋转动画</span>
    gsap.<span class="hljs-title function_">to</span>(flyLight.<span class="hljs-property">rotation</span>, {
      <span class="hljs-attr">y</span>: <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-number">10</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">30</span>,
      <span class="hljs-attr">repeat</span>: -<span class="hljs-number">1</span>,
    });
    
    <span class="hljs-comment">// 使用 GSAP 添加位置动画</span>
    gsap.<span class="hljs-title function_">to</span>(flyLight.<span class="hljs-property">position</span>, {
      <span class="hljs-attr">x</span>: <span class="hljs-string">"+="</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">5</span>,
      <span class="hljs-attr">y</span>: <span class="hljs-string">"+="</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span>,
      <span class="hljs-attr">yoyo</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-number">5</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span>,
      <span class="hljs-attr">repeat</span>: -<span class="hljs-number">1</span>,
    });
    scene.<span class="hljs-title function_">add</span>(flyLight);
  }
});
</code></pre>
<h2 data-id="heading-6">烟花管理</h2>
<p>创建烟花管理数组，用于管理所有的烟花实例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 管理烟花</span>
<span class="hljs-keyword">let</span> fireworks = [];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params">t</span>) {
  controls.<span class="hljs-title function_">update</span>();
  <span class="hljs-keyword">const</span> elapsedTime = clock.<span class="hljs-title function_">getElapsedTime</span>();
  
  <span class="hljs-comment">// 更新每个烟花的状态</span>
  fireworks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, i</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> type = item.<span class="hljs-title function_">update</span>();
    <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"remove"</span>) {
      fireworks.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);
    }
  });

  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  <span class="hljs-comment">// 使用渲染器渲染相机看这个场景的内容渲染出来</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}

<span class="hljs-title function_">animate</span>();
</code></pre>
<h2 data-id="heading-7">点击创建烟花</h2>
<p>添加点击事件监听器，允许用户在任意位置创建烟花：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 设置创建烟花函数</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">createFireworks</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">let</span> color = <span class="hljs-string">`hsl(<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">360</span>)}</span>,100%,80%)`</span>;
  <span class="hljs-keyword">let</span> position = {
    <span class="hljs-attr">x</span>: (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">40</span>,
    <span class="hljs-attr">z</span>: -(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() - <span class="hljs-number">0.5</span>) * <span class="hljs-number">40</span>,
    <span class="hljs-attr">y</span>: <span class="hljs-number">3</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">15</span>,
  };

  <span class="hljs-comment">// 随机生成颜色和烟花放的位置</span>
  <span class="hljs-keyword">let</span> firework = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fireworks</span>(color, position);
  firework.<span class="hljs-title function_">addScene</span>(scene, camera);
  fireworks.<span class="hljs-title function_">push</span>(firework);
};

<span class="hljs-comment">// 监听点击事件</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, createFireworks);
</code></pre>
<h2 data-id="heading-8">烟花类详解</h2>
<p>烟花类是整个效果的核心，它包含三个阶段：发射、爆炸和消散。</p>
<h3 data-id="heading-9">构造函数</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fireworks</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">color, to, <span class="hljs-keyword">from</span> = { x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>, z: <span class="hljs-number">0</span> }</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(color);

    <span class="hljs-comment">// 创建烟花发射的球点</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startGeometry</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferGeometry</span>();
    <span class="hljs-keyword">const</span> startPositionArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">3</span>);
    startPositionArray[<span class="hljs-number">0</span>] = <span class="hljs-keyword">from</span>.<span class="hljs-property">x</span>;
    startPositionArray[<span class="hljs-number">1</span>] = <span class="hljs-keyword">from</span>.<span class="hljs-property">y</span>;
    startPositionArray[<span class="hljs-number">2</span>] = <span class="hljs-keyword">from</span>.<span class="hljs-property">z</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startGeometry</span>.<span class="hljs-title function_">setAttribute</span>(
      <span class="hljs-string">"position"</span>,
      <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(startPositionArray, <span class="hljs-number">3</span>)
    );

    <span class="hljs-keyword">const</span> astepArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">3</span>);
    astepArray[<span class="hljs-number">0</span>] = to.<span class="hljs-property">x</span> - <span class="hljs-keyword">from</span>.<span class="hljs-property">x</span>;
    astepArray[<span class="hljs-number">1</span>] = to.<span class="hljs-property">y</span> - <span class="hljs-keyword">from</span>.<span class="hljs-property">y</span>;
    astepArray[<span class="hljs-number">2</span>] = to.<span class="hljs-property">z</span> - <span class="hljs-keyword">from</span>.<span class="hljs-property">x</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startGeometry</span>.<span class="hljs-title function_">setAttribute</span>(
      <span class="hljs-string">"aStep"</span>,
      <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(astepArray, <span class="hljs-number">3</span>)
    );

    <span class="hljs-comment">// 设置着色器材质</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startMaterial</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>({
      <span class="hljs-attr">vertexShader</span>: startPointVertex,
      <span class="hljs-attr">fragmentShader</span>: startPointFragment,
      <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">blending</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">AdditiveBlending</span>,
      <span class="hljs-attr">depthWrite</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">uniforms</span>: {
        <span class="hljs-attr">uTime</span>: {
          <span class="hljs-attr">value</span>: <span class="hljs-number">0</span>,
        },
        <span class="hljs-attr">uSize</span>: {
          <span class="hljs-attr">value</span>: <span class="hljs-number">20</span>,
        },
        <span class="hljs-attr">uColor</span>: { <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> },
      },
    });

    <span class="hljs-comment">// 创建烟花点球</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">startPoint</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Points</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">startGeometry</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">startMaterial</span>);

    <span class="hljs-comment">// 开始计时</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">clock</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>();

    <span class="hljs-comment">// 创建爆炸的烟花</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworkGeometry</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferGeometry</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">FireworksCount</span> = <span class="hljs-number">180</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">180</span>);
    <span class="hljs-keyword">const</span> positionFireworksArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">FireworksCount</span> * <span class="hljs-number">3</span>);
    <span class="hljs-keyword">const</span> scaleFireArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">FireworksCount</span>);
    <span class="hljs-keyword">const</span> directionArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">FireworksCount</span> * <span class="hljs-number">3</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">FireworksCount</span>; i++) {
      <span class="hljs-comment">// 一开始烟花位置</span>
      positionFireworksArray[i * <span class="hljs-number">3</span> + <span class="hljs-number">0</span>] = to.<span class="hljs-property">x</span>;
      positionFireworksArray[i * <span class="hljs-number">3</span> + <span class="hljs-number">1</span>] = to.<span class="hljs-property">y</span>;
      positionFireworksArray[i * <span class="hljs-number">3</span> + <span class="hljs-number">2</span>] = to.<span class="hljs-property">z</span>;
      
      <span class="hljs-comment">// 设置烟花所有粒子初始化大小</span>
      scaleFireArray[i] = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>();
      
      <span class="hljs-comment">// 设置四周发射的角度</span>
      <span class="hljs-keyword">let</span> theta = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>;
      <span class="hljs-keyword">let</span> beta = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>;
      <span class="hljs-keyword">let</span> r = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>();

      directionArray[i * <span class="hljs-number">3</span> + <span class="hljs-number">0</span>] = r * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(theta) + r * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(beta);
      directionArray[i * <span class="hljs-number">3</span> + <span class="hljs-number">1</span>] = r * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(theta) + r * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(beta);
      directionArray[i * <span class="hljs-number">3</span> + <span class="hljs-number">2</span>] = r * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(theta) + r * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(beta);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworkGeometry</span>.<span class="hljs-title function_">setAttribute</span>(
      <span class="hljs-string">"position"</span>,
      <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(positionFireworksArray, <span class="hljs-number">3</span>)
    );
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworkGeometry</span>.<span class="hljs-title function_">setAttribute</span>(
      <span class="hljs-string">"aScale"</span>,
      <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(scaleFireArray, <span class="hljs-number">1</span>)
    );
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworkGeometry</span>.<span class="hljs-title function_">setAttribute</span>(
      <span class="hljs-string">"aRandom"</span>,
      <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(directionArray, <span class="hljs-number">3</span>)
    );

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworksMaterial</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ShaderMaterial</span>({
      <span class="hljs-attr">uniforms</span>: {
        <span class="hljs-attr">uTime</span>: {
          <span class="hljs-attr">value</span>: <span class="hljs-number">0</span>,
        },
        <span class="hljs-attr">uSize</span>: {
          <span class="hljs-attr">value</span>: <span class="hljs-number">0</span>,
        },
        <span class="hljs-attr">uColor</span>: { <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> },
      },
      <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">blending</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">AdditiveBlending</span>,
      <span class="hljs-attr">depthWrite</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">vertexShader</span>: fireworksVertex,
      <span class="hljs-attr">fragmentShader</span>: fireworksFragment,
    });

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworks</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Points</span>(
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworkGeometry</span>,
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworksMaterial</span>
    );

    <span class="hljs-comment">// 创建音频</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">linstener</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AudioListener</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">linstener1</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AudioListener</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sound</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Audio</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">linstener</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sendSound</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Audio</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">linstener1</span>);

    <span class="hljs-comment">// 创建音频加载器</span>
    <span class="hljs-keyword">const</span> audioLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AudioLoader</span>();
    audioLoader.<span class="hljs-title function_">load</span>(
      <span class="hljs-string">`./assets/audio/pow<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">4</span>) + <span class="hljs-number">1</span>}</span>.ogg`</span>,
      <span class="hljs-function">(<span class="hljs-params">buffer</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sound</span>.<span class="hljs-title function_">setBuffer</span>(buffer);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sound</span>.<span class="hljs-title function_">setLoop</span>(<span class="hljs-literal">false</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sound</span>.<span class="hljs-title function_">setVolume</span>(<span class="hljs-number">1</span>);
      }
    );

    audioLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">`./assets/audio/send.mp3`</span>, <span class="hljs-function">(<span class="hljs-params">buffer</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">sendSound</span>.<span class="hljs-title function_">setBuffer</span>(buffer);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">sendSound</span>.<span class="hljs-title function_">setLoop</span>(<span class="hljs-literal">false</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">sendSound</span>.<span class="hljs-title function_">setVolume</span>(<span class="hljs-number">1</span>);
    });
  }
  
  <span class="hljs-comment">// 添加到场景</span>
  <span class="hljs-title function_">addScene</span>(<span class="hljs-params">scene, camera</span>) {
    scene.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">startPoint</span>);
    scene.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworks</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span> = scene;
  }
  
  <span class="hljs-comment">// 更新变量</span>
  <span class="hljs-title function_">update</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> elapsedTime = <span class="hljs-variable language_">this</span>.<span class="hljs-property">clock</span>.<span class="hljs-title function_">getElapsedTime</span>();
    
    <span class="hljs-keyword">if</span> (elapsedTime &gt; <span class="hljs-number">0.2</span> &amp;&amp; elapsedTime &lt; <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">sendSound</span>.<span class="hljs-property">isPlaying</span> &amp;&amp; !<span class="hljs-variable language_">this</span>.<span class="hljs-property">sendSoundplay</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sendSound</span>.<span class="hljs-title function_">play</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sendSoundplay</span> = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">startMaterial</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uTime</span>.<span class="hljs-property">value</span> = elapsedTime;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">startMaterial</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uSize</span>.<span class="hljs-property">value</span> = <span class="hljs-number">20</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (elapsedTime &gt; <span class="hljs-number">0.2</span>) {
      <span class="hljs-keyword">const</span> time = elapsedTime - <span class="hljs-number">1</span>;
      <span class="hljs-comment">// 让点元素消失</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">startMaterial</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uSize</span>.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">startPoint</span>.<span class="hljs-title function_">clear</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">startGeometry</span>.<span class="hljs-title function_">dispose</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">startMaterial</span>.<span class="hljs-title function_">dispose</span>();
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">sound</span>.<span class="hljs-property">isPlaying</span> &amp;&amp; !<span class="hljs-variable language_">this</span>.<span class="hljs-property">play</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sound</span>.<span class="hljs-title function_">play</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">play</span> = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-comment">//设置烟花显示</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworksMaterial</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uSize</span>.<span class="hljs-property">value</span> = <span class="hljs-number">20</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworksMaterial</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uTime</span>.<span class="hljs-property">value</span> = time;

      <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">5</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworksMaterial</span>.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uSize</span>.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworks</span>.<span class="hljs-title function_">clear</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworkGeometry</span>.<span class="hljs-title function_">dispose</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworksMaterial</span>.<span class="hljs-title function_">dispose</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fireworks</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">startPoint</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"remove"</span>;
      }
    }
  }
}
</code></pre>
<h2 data-id="heading-10">着色器详解</h2>
<h3 data-id="heading-11">发射阶段着色器</h3>
<h4 data-id="heading-12">发射顶点着色器 (startpoint/vertex.glsl):</h4>
<pre><code class="hljs language-glsl" lang="glsl">attribute vec3 aStep;

uniform float uTime;
uniform float uSize;

void main(){
    vec4 modelPosition = modelMatrix * vec4( position, 1.0 );

    modelPosition.xyz += (aStep*uTime);

    vec4 viewPosition = viewMatrix * modelPosition;

    gl_Position =  projectionMatrix * viewPosition;

    // 设置顶点大小
    gl_PointSize =uSize;
}
</code></pre>
<h4 data-id="heading-13">发射片元着色器 (startpoint/fragment.glsl):</h4>
<pre><code class="hljs language-glsl" lang="glsl">uniform vec3 uColor;

void main(){
    float distanceToCenter = distance(gl_PointCoord,vec2(0.5));
    float strength = distanceToCenter*2.0;
    strength = 1.0-strength;
    strength = pow(strength,1.5);
    gl_FragColor = vec4(uColor,strength);
}
</code></pre>
<h3 data-id="heading-14">爆炸阶段着色器</h3>
<h4 data-id="heading-15">爆炸顶点着色器 (fireworks/vertex.glsl):</h4>
<pre><code class="hljs language-glsl" lang="glsl">attribute float aScale;
attribute vec3 aRandom;

uniform float uTime;
uniform float uSize;

void main(){
    vec4 modelPosition = modelMatrix * vec4( position, 1.0 );

    modelPosition.xyz+=aRandom*uTime*10.0;

    vec4 viewPosition = viewMatrix * modelPosition;

    gl_Position =  projectionMatrix * viewPosition;

    // 设置顶点大小
    gl_PointSize =uSize*aScale-(uTime*20.0);
}
</code></pre>
<h4 data-id="heading-16">爆炸片元着色器 (fireworks/fragment.glsl):</h4>
<pre><code class="hljs language-glsl" lang="glsl">uniform vec3 uColor;

void main(){
    float distanceToCenter = distance(gl_PointCoord,vec2(0.5));
    float strength = distanceToCenter*2.0;
    strength = 1.0-strength;
    strength = pow(strength,1.5);
    gl_FragColor = vec4(uColor,strength);
}
</code></pre>
<h2 data-id="heading-17">渲染器和控制器设置</h2>
<p>最后，我们需要设置渲染器和控制器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始化渲染器</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ <span class="hljs-attr">alpha</span>: <span class="hljs-literal">true</span> });
<span class="hljs-comment">// renderer.shadowMap.enabled = true;</span>
<span class="hljs-comment">// renderer.shadowMap.type = THREE.BasicShadowMap;</span>
<span class="hljs-comment">// renderer.shadowMap.type = THREE.VSMShadowMap;</span>
renderer.<span class="hljs-property">outputEncoding</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">sRGBEncoding</span>;
renderer.<span class="hljs-property">toneMapping</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">ACESFilmicToneMapping</span>;
<span class="hljs-comment">// renderer.toneMapping = THREE.LinearToneMapping;</span>
<span class="hljs-comment">// renderer.toneMapping = THREE.ReinhardToneMapping;</span>
<span class="hljs-comment">// renderer.toneMapping = THREE.CineonToneMapping;</span>
renderer.<span class="hljs-property">toneMappingExposure</span> = <span class="hljs-number">0.1</span>;

<span class="hljs-comment">// 设置渲染尺寸大小</span>
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);

<span class="hljs-comment">// 监听屏幕大小改变的变化，设置渲染的尺寸</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"resize"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 更新摄像头</span>
  camera.<span class="hljs-property">aspect</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
  <span class="hljs-comment">// 更新摄像机的投影矩阵</span>
  camera.<span class="hljs-title function_">updateProjectionMatrix</span>();

  <span class="hljs-comment">// 更新渲染器</span>
  renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
  <span class="hljs-comment">// 设置渲染器的像素比例</span>
  renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>);
});

<span class="hljs-comment">// 将渲染器添加到body</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

<span class="hljs-comment">// 初始化控制器</span>
<span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);
<span class="hljs-comment">// 设置控制器阻尼</span>
controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span>;
<span class="hljs-comment">// 设置自动旋转</span>
controls.<span class="hljs-property">autoRotate</span> = <span class="hljs-literal">true</span>;
controls.<span class="hljs-property">autoRotateSpeed</span> = <span class="hljs-number">0.1</span>;
</code></pre>
<h2 data-id="heading-18">总结</h2>
<p>通过这个项目，我们学习了如何使用 Three.js 创建一个完整的烟花效果系统。关键在于：</p>
<ol>
<li>利用粒子系统模拟烟花的发射和爆炸效果</li>
<li>使用自定义着色器实现动态的视觉效果</li>
<li>通过时间控制实现烟花的三个阶段：发射、爆炸和消散</li>
<li>添加音效增强用户体验</li>
<li>使用缓冲几何体高效地处理大量粒子</li>
</ol>
<p>这种技术可以应用于各种特效制作，如爆炸、流星雨、粒子系统等。掌握了这套技术，你就能创建出更加丰富和生动的三维场景，为用户带来震撼的视觉体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Three.js 着色器加工材质详解]]></title>    <link>https://juejin.cn/post/7599911091086475264</link>    <guid>https://juejin.cn/post/7599911091086475264</guid>    <pubDate>2026-01-27T14:32:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599911091086475264" data-draft-id="7599899147417911348" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Three.js 着色器加工材质详解"/> <meta itemprop="keywords" content="前端,three.js"/> <meta itemprop="datePublished" content="2026-01-27T14:32:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Three.js 着色器加工材质详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:32:02.000Z" title="Tue Jan 27 2026 14:32:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>本文将详细介绍如何使用 Three.js 中的着色器来加工和定制材质效果。我们将学习如何通过修改材质的着色器代码，实现动态变形、纹理处理和复杂视觉效果，从而创建出独特且富有表现力的三维场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3686a03a6f8f48efa9e739360b344a75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5qCh6ZW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770129121&amp;x-signature=fiVSmKblHUuRI3Z2ZCbzcLVrAFQ%3D" alt="screenshot_2026-01-27_22-29-59.gif" loading="lazy"/></p>
<h2 data-id="heading-1">准备工作</h2>
<p>首先，我们需要引入必要的 Three.js 库和相关工具：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"three"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/controls/OrbitControls"</span>;
<span class="hljs-keyword">import</span> gsap <span class="hljs-keyword">from</span> <span class="hljs-string">"gsap"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dat <span class="hljs-keyword">from</span> <span class="hljs-string">"dat.gui"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RGBELoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/loaders/RGBELoader.js"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/loaders/GLTFLoader"</span>;
</code></pre>
<h2 data-id="heading-2">场景初始化</h2>
<p>首先，我们需要创建一个基本的 Three.js 场景：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始化场景</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();

<span class="hljs-comment">// 创建透视相机</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
  <span class="hljs-number">75</span>,
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>,
  <span class="hljs-number">1</span>,
  <span class="hljs-number">50</span>
);

<span class="hljs-comment">// 设置相机位置</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>);
scene.<span class="hljs-title function_">add</span>(camera);

<span class="hljs-comment">// 加入辅助轴，帮助我们查看3维坐标轴</span>
<span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>);
scene.<span class="hljs-title function_">add</span>(axesHelper);
</code></pre>
<h2 data-id="heading-3">环境纹理设置</h2>
<p>为了创建更真实的光照效果，我们添加环境纹理：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 加载纹理</span>
<span class="hljs-keyword">const</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>();

<span class="hljs-comment">// 添加环境纹理</span>
<span class="hljs-keyword">const</span> cubeTextureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CubeTextureLoader</span>();
<span class="hljs-keyword">const</span> envMapTexture = cubeTextureLoader.<span class="hljs-title function_">load</span>([
  <span class="hljs-string">"textures/environmentMaps/0/px.jpg"</span>,
  <span class="hljs-string">"textures/environmentMaps/0/nx.jpg"</span>,
  <span class="hljs-string">"textures/environmentMaps/0/py.jpg"</span>,
  <span class="hljs-string">"textures/environmentMaps/0/ny.jpg"</span>,
  <span class="hljs-string">"textures/environmentMaps/0/pz.jpg"</span>,
  <span class="hljs-string">"textures/environmentMaps/0/nz.jpg"</span>,
]);

<span class="hljs-comment">// 设置方向光</span>
<span class="hljs-keyword">const</span> directionLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-string">"#ffffff"</span>, <span class="hljs-number">1</span>);
directionLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;
directionLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>);
scene.<span class="hljs-title function_">add</span>(directionLight);

<span class="hljs-comment">// 应用环境纹理</span>
scene.<span class="hljs-property">environment</span> = envMapTexture;
scene.<span class="hljs-property">background</span> = envMapTexture;
</code></pre>
<h2 data-id="heading-4">模型加载与材质处理</h2>
<p>加载模型并应用基本材质：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 加载模型纹理</span>
<span class="hljs-keyword">const</span> modelTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">"./models/LeePerrySmith/color.jpg"</span>);
<span class="hljs-comment">// 加载模型的法向纹理</span>
<span class="hljs-keyword">const</span> normalTexture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">"./models/LeePerrySmith/normal.jpg"</span>);

<span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>({
  <span class="hljs-attr">map</span>: modelTexture,
  <span class="hljs-attr">normalMap</span>: normalTexture,
});
</code></pre>
<h2 data-id="heading-5">着色器修改的关键技术</h2>
<h3 data-id="heading-6">方法一：使用 onBeforeCompile 修改现有材质</h3>
<p>这是最常用的方法，可以在 Three.js 自动生成的着色器代码基础上进行修改：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> customUniforms = {
  <span class="hljs-attr">uTime</span>: {
    <span class="hljs-attr">value</span>: <span class="hljs-number">0</span>,
  },
};

material.<span class="hljs-property">onBeforeCompile</span> = <span class="hljs-function">(<span class="hljs-params">shader</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(shader.<span class="hljs-property">vertexShader</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(shader.<span class="hljs-property">fragmentShader</span>);
  
  <span class="hljs-comment">// 传递时间变量到着色器</span>
  shader.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uTime</span> = customUniforms.<span class="hljs-property">uTime</span>;
  
  <span class="hljs-comment">// 在顶点着色器的 common 部分插入自定义函数和变量</span>
  shader.<span class="hljs-property">vertexShader</span> = shader.<span class="hljs-property">vertexShader</span>.<span class="hljs-title function_">replace</span>(
    <span class="hljs-string">"#include &lt;common&gt;"</span>,
    <span class="hljs-string">`
    #include &lt;common&gt;
    mat2 rotate2d(float _angle){
      return mat2(cos(_angle),-sin(_angle),
                  sin(_angle),cos(_angle));
    }
    uniform float uTime;
    `</span>
  );

  <span class="hljs-comment">// 在顶点变换前修改法线</span>
  shader.<span class="hljs-property">vertexShader</span> = shader.<span class="hljs-property">vertexShader</span>.<span class="hljs-title function_">replace</span>(
    <span class="hljs-string">"#include &lt;beginnormal_vertex&gt;"</span>,
    <span class="hljs-string">`
    #include &lt;beginnormal_vertex&gt;
    float angle = sin(position.y+uTime) *0.5;
    mat2 rotateMatrix = rotate2d(angle);
    
    objectNormal.xz = rotateMatrix * objectNormal.xz;
    `</span>
  );
  
  <span class="hljs-comment">// 在顶点变换前修改顶点位置</span>
  shader.<span class="hljs-property">vertexShader</span> = shader.<span class="hljs-property">vertexShader</span>.<span class="hljs-title function_">replace</span>(
    <span class="hljs-string">"#include &lt;begin_vertex&gt;"</span>,
    <span class="hljs-string">`
    #include &lt;begin_vertex&gt;
    // float angle = transformed.y*0.5;
    // mat2 rotateMatrix = rotate2d(angle);
    
    transformed.xz = rotateMatrix * transformed.xz;
    `</span>
  );
};
</code></pre>
<h3 data-id="heading-7">方法二：为深度材质添加相同效果</h3>
<p>对于阴影等特殊情况，我们还需要为深度材质添加相同的效果：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> depthMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshDepthMaterial</span>({
  <span class="hljs-attr">depthPacking</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RGBADepthPacking</span>,
});

depthMaterial.<span class="hljs-property">onBeforeCompile</span> = <span class="hljs-function">(<span class="hljs-params">shader</span>) =&gt;</span> {
  shader.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uTime</span> = customUniforms.<span class="hljs-property">uTime</span>;
  shader.<span class="hljs-property">vertexShader</span> = shader.<span class="hljs-property">vertexShader</span>.<span class="hljs-title function_">replace</span>(
    <span class="hljs-string">"#include &lt;common&gt;"</span>,
    <span class="hljs-string">`
    #include &lt;common&gt;
    mat2 rotate2d(float _angle){
      return mat2(cos(_angle),-sin(_angle),
                  sin(_angle),cos(_angle));
    }
    uniform float uTime;
    `</span>
  );
  shader.<span class="hljs-property">vertexShader</span> = shader.<span class="hljs-property">vertexShader</span>.<span class="hljs-title function_">replace</span>(
    <span class="hljs-string">"#include &lt;begin_vertex&gt;"</span>,
    <span class="hljs-string">`
    #include &lt;begin_vertex&gt;
    float angle = sin(position.y+uTime) *0.5;
    mat2 rotateMatrix = rotate2d(angle);
    
    transformed.xz = rotateMatrix * transformed.xz;
    `</span>
  );

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"depthMaterial"</span>, shader.<span class="hljs-property">vertexShader</span>);
};
</code></pre>
<h2 data-id="heading-8">模型加载与材质应用</h2>
<p>加载 3D 模型并应用自定义材质：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模型加载</span>
<span class="hljs-keyword">const</span> gltfLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
gltfLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">"./models/LeePerrySmith/LeePerrySmith.glb"</span>, <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> mesh = gltf.<span class="hljs-property">scene</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>];
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mesh);
  mesh.<span class="hljs-property">material</span> = material;
  mesh.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// 设定自定义的深度材质</span>
  mesh.<span class="hljs-property">customDepthMaterial</span> = depthMaterial;
  scene.<span class="hljs-title function_">add</span>(mesh);
});

<span class="hljs-comment">// 添加地面</span>
<span class="hljs-keyword">const</span> plane = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(
  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneBufferGeometry</span>(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>),
  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshStandardMaterial</span>()
);
plane.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">6</span>);
plane.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">true</span>;
scene.<span class="hljs-title function_">add</span>(plane);
</code></pre>
<h2 data-id="heading-9">渲染器和控制器设置</h2>
<p>设置渲染器和控制器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始化渲染器</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
<span class="hljs-comment">// 设置渲染尺寸大小</span>
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>;

<span class="hljs-comment">// 监听屏幕大小改变的变化，设置渲染的尺寸</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"resize"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 更新摄像头</span>
  camera.<span class="hljs-property">aspect</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
  <span class="hljs-comment">// 更新摄像机的投影矩阵</span>
  camera.<span class="hljs-title function_">updateProjectionMatrix</span>();

  <span class="hljs-comment">// 更新渲染器</span>
  renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
  <span class="hljs-comment">// 设置渲染器的像素比例</span>
  renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>);
});

<span class="hljs-comment">// 将渲染器添加到body</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

<span class="hljs-comment">// 初始化控制器</span>
<span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);
<span class="hljs-comment">// 设置控制器阻尼</span>
controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span>;
</code></pre>
<h2 data-id="heading-10">动画循环</h2>
<p>在动画循环中更新时间变量，以驱动着色器中的动画效果：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params">t</span>) {
  controls.<span class="hljs-title function_">update</span>();
  <span class="hljs-keyword">const</span> time = clock.<span class="hljs-title function_">getElapsedTime</span>();
  customUniforms.<span class="hljs-property">uTime</span>.<span class="hljs-property">value</span> = time;
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  <span class="hljs-comment">// 使用渲染器渲染相机看这个场景的内容渲染出来</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}

<span class="hljs-title function_">animate</span>();
</code></pre>
<h2 data-id="heading-11">自定义着色器材质示例</h2>
<p>除了修改现有材质，我们也可以创建完全自定义的着色器材质：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> basicMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({
  <span class="hljs-attr">color</span>: <span class="hljs-string">"#00ff00"</span>,
  <span class="hljs-attr">side</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">DoubleSide</span>,
});

<span class="hljs-keyword">const</span> basicUniforms = {
  <span class="hljs-attr">uTime</span>: {
    <span class="hljs-attr">value</span>: <span class="hljs-number">0</span>
  }
};

basicMaterial.<span class="hljs-property">onBeforeCompile</span> = <span class="hljs-function">(<span class="hljs-params">shader, renderer</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(shader);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(shader.<span class="hljs-property">vertexShader</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(shader.<span class="hljs-property">fragmentShader</span>);
  
  <span class="hljs-comment">// 添加时间变量到着色器</span>
  shader.<span class="hljs-property">uniforms</span>.<span class="hljs-property">uTime</span> = basicUniforms.<span class="hljs-property">uTime</span>;
  
  <span class="hljs-comment">// 在顶点着色器的 common 部分添加时间变量</span>
  shader.<span class="hljs-property">vertexShader</span> = shader.<span class="hljs-property">vertexShader</span>.<span class="hljs-title function_">replace</span>(
    <span class="hljs-string">'#include &lt;common&gt;'</span>,
    <span class="hljs-string">`
    #include &lt;common&gt;
    uniform float uTime;
    `</span>
  );
  
  <span class="hljs-comment">// 在顶点变换部分添加动态位移</span>
  shader.<span class="hljs-property">vertexShader</span> = shader.<span class="hljs-property">vertexShader</span>.<span class="hljs-title function_">replace</span>(
    <span class="hljs-string">'#include &lt;begin_vertex&gt;'</span>,
    <span class="hljs-string">`
    #include &lt;begin_vertex&gt;
    transformed.x += sin(uTime)* 2.0;
    transformed.z += cos(uTime)* 2.0;
    `</span>
  );
};
</code></pre>
<h2 data-id="heading-12">GLSL 着色器代码详解</h2>
<h3 data-id="heading-13">基本着色器 (basic/vertex.glsl)</h3>
<pre><code class="hljs language-glsl" lang="glsl">uniform vec3 uColor;
uniform float uFrequency;
uniform float uScale;
uniform float uTime;

varying float vElevation;
varying vec2 vUv;

precision highp float;

void main(){
    vec4 modelPosition = modelMatrix * vec4( position, 1.0 );

    modelPosition.z += sin((modelPosition.x+uTime) * uFrequency)*uScale ;
    modelPosition.z += cos((modelPosition.y+uTime) * uFrequency)*uScale ;

    vElevation = modelPosition.z;
    gl_Position =  projectionMatrix * viewMatrix * modelPosition;
    vUv = uv;
}
</code></pre>
<h3 data-id="heading-14">基础片元着色器 (basic/fragment.glsl)</h3>
<pre><code class="hljs language-glsl" lang="glsl">uniform vec3 uColor;
varying float vElevation;
precision highp float;
varying vec2 vUv;

uniform sampler2D uTexture;

void main(){
    float alpha = (vElevation+0.1)+0.8;
    
    vec4 textureColor = texture2D(uTexture,vUv);
    textureColor.rgb*=alpha;
    gl_FragColor = textureColor;
}
</code></pre>
<h2 data-id="heading-15">深度着色器技术</h2>
<p>深度着色器通常用于阴影计算和特殊视觉效果，其中包含了丰富的 GLSL 技术：</p>
<ul>
<li>随机函数：用于生成程序化噪声</li>
<li>旋转函数：用于变换 UV 坐标</li>
<li>噪声函数：用于创建自然效果</li>
<li>Perlin 噪声：用于高质量的程序化纹理</li>
</ul>
<h2 data-id="heading-16">总结</h2>
<p>通过这个项目，我们学习了如何使用 Three.js 的着色器加工材质技术：</p>
<ol>
<li>使用 <code>onBeforeCompile</code> 回调修改现有材质的着色器代码</li>
<li>向着色器传递自定义 uniform 变量</li>
<li>在着色器的关键位置插入自定义代码</li>
<li>为深度材质应用相同的修改以保证一致性</li>
<li>利用 GLSL 编写高效的顶点和片元着色器</li>
</ol>
<p>这种方法让我们能够在不完全重写材质的情况下，对 Three.js 的内置材质进行深度定制，创造出独特的视觉效果。掌握这项技术是实现高级视觉效果的关键技能，可以用于创建动态地形、流体效果、变形动画等各种复杂场景。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[♾️ AI 全栈项目实战第十天：用无限滚动和KeepAlive优化你的文章列表]]></title>    <link>https://juejin.cn/post/7599826983887863851</link>    <guid>https://juejin.cn/post/7599826983887863851</guid>    <pubDate>2026-01-27T14:38:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599826983887863851" data-draft-id="7599843186203033642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="♾️ AI 全栈项目实战第十天：用无限滚动和KeepAlive优化你的文章列表"/> <meta itemprop="keywords" content="性能优化,React.js"/> <meta itemprop="datePublished" content="2026-01-27T14:38:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神秘的猪头"/> <meta itemprop="url" content="https://juejin.cn/user/793223472877051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ♾️ AI 全栈项目实战第十天：用无限滚动和KeepAlive优化你的文章列表
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/793223472877051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神秘的猪头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:38:30.000Z" title="Tue Jan 27 2026 14:38:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>哈喽，掘金的各位全栈练习生们！👋 欢迎回到 <strong>AI 全栈项目实战</strong> 的第十天！</p>
<p>昨天，我们用 <strong>观察者模式</strong> 给图片加上了懒加载，让文章列表的图片“按需分配”，大大提升了首屏性能。
今天，我们要继续深挖这个列表，让它不仅能懒加载图片，还能<strong>自动加载更多内容</strong>（Infinite Scroll），彻底告别传统的“下一页”按钮。
更重要的是，我们要解决一个困扰无数前端开发者的痛点：<strong>当你点进文章详情再退回列表时，页面竟然重置回顶部了？</strong> 😱
别慌，今天我们就用 <code>KeepAlive</code> 来搞定这个“路由状态保持”的优化！</p>
<hr/>
<h2 data-id="heading-0">📜 一、 无限滚动：告别“下一页”</h2>
<p>在移动端，用户习惯了“刷”的感觉。抖音、小红书、今日头条，没有哪个 App 是让你点“下一页”的。
我们要实现的效果是：<strong>当用户滑到底部时，自动请求下一页数据并拼接到列表中</strong>，让用户感觉内容是无穷无尽的。</p>
<h3 data-id="heading-1">1.1 状态管理：Zustand 仓库设计</h3>
<p>首先，我们需要一个强大的“管家”来管理列表的状态。打开 <code>src/store/home.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// frontend/notes/src/store/home.ts</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HomeState</span> {
    <span class="hljs-attr">posts</span>: <span class="hljs-title class_">Post</span>[];      <span class="hljs-comment">// 存文章列表数据</span>
    <span class="hljs-attr">page</span>: <span class="hljs-built_in">number</span>;       <span class="hljs-comment">// 当前加载到第几页</span>
    <span class="hljs-attr">loading</span>: <span class="hljs-built_in">boolean</span>;   <span class="hljs-comment">// 是否正在请求中（防止重复触发）</span>
    <span class="hljs-attr">hasMore</span>: <span class="hljs-built_in">boolean</span>;   <span class="hljs-comment">// 后端还有没有数据了？</span>
    <span class="hljs-attr">loadMore</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;; <span class="hljs-comment">// 加载动作</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useHomeStore = create&lt;<span class="hljs-title class_">HomeState</span>&gt;(<span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> ({
    <span class="hljs-attr">posts</span>: [],
    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">hasMore</span>: <span class="hljs-literal">true</span>,

    <span class="hljs-attr">loadMore</span>: <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-comment">// 🛑 防抖：如果正在加载，或者没数据了，直接返回</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-title function_">get</span>().<span class="hljs-property">loading</span> || !<span class="hljs-title function_">get</span>().<span class="hljs-property">hasMore</span>) <span class="hljs-keyword">return</span>; 
        
        <span class="hljs-title function_">set</span>({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// 🔒 上锁</span>

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 请求当前页数据</span>
            <span class="hljs-keyword">const</span> { items } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPosts</span>(<span class="hljs-title function_">get</span>().<span class="hljs-property">page</span>);
            
            <span class="hljs-keyword">if</span>(items.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) { 
                <span class="hljs-comment">// 🚫 没数据了，标记 hasMore 为 false</span>
                <span class="hljs-title function_">set</span>({ <span class="hljs-attr">hasMore</span>: <span class="hljs-literal">false</span> });
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// ✅ 有数据：</span>
                <span class="hljs-comment">// 1. 把新数据拼接到旧数据后面</span>
                <span class="hljs-comment">// 2. 页码 + 1</span>
                <span class="hljs-title function_">set</span>({
                    <span class="hljs-attr">posts</span>: [...<span class="hljs-title function_">get</span>().<span class="hljs-property">posts</span>, ...items],
                    <span class="hljs-attr">page</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">page</span> + <span class="hljs-number">1</span>,
                })
            }
        } <span class="hljs-keyword">catch</span>(err) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'加载失败'</span>, err);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">set</span>({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> }); <span class="hljs-comment">// 🔓 解锁</span>
        }
    }
}))
</code></pre>
<p><strong>🧠 核心逻辑：</strong></p>
<ul>
<li><code>posts: [...get().posts, ...items]</code>：这是实现无限滚动的关键。我们不是替换数据，而是<strong>追加</strong>数据。</li>
<li><code>loading</code> 锁：网络请求是异步的，用户滑动过快可能导致短时间内触发多次请求，导致数据重复。必须加锁！</li>
</ul>
<h3 data-id="heading-2">1.2 组件实现：InfiniteScroll</h3>
<p>有了仓库，我们还需要一个通用的 UI 组件来触发 <code>loadMore</code>。
打开 <code>src/components/infiniteScroll.tsx</code>。</p>
<p>这里我们再次请出了老朋友 —— <strong>IntersectionObserver</strong>。
思路很简单：<strong>在列表的最底部放一个看不见的“哨兵”元素（Sentinel），一旦哨兵进入视窗，就说明用户滑到底了。</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// frontend/notes/src/components/infiniteScroll.tsx</span>
<span class="hljs-keyword">import</span> { useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">InfiniteScrollProps</span> {
    <span class="hljs-attr">hasMore</span>: <span class="hljs-built_in">boolean</span>;
    isLoading?: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">onLoadMore</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
    <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>; <span class="hljs-comment">// 列表内容作为 children 传入</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">InfiniteScroll</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">InfiniteScrollProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
    hasMore,
    isLoading = <span class="hljs-literal">false</span>,
    onLoadMore,
    children,
}</span>) =&gt;</span> {
    <span class="hljs-comment">// 🕵️‍♀️ 哨兵元素的引用</span>
    <span class="hljs-keyword">const</span> sentinelRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);

    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// 如果没数据了或者正在加载，就不需要观察了</span>
        <span class="hljs-keyword">if</span>(!hasMore || isLoading) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
            <span class="hljs-comment">// entries[0] 就是我们的哨兵</span>
            <span class="hljs-keyword">if</span>(entries[<span class="hljs-number">0</span>].<span class="hljs-property">isIntersecting</span>) { 
                <span class="hljs-comment">// 🚨 哨兵出现！触发加载！</span>
                <span class="hljs-title function_">onLoadMore</span>();
            }
        },{
            <span class="hljs-attr">threshold</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 只要露个头就触发</span>
            <span class="hljs-comment">// rootMargin: '100px' // 其实可以设置提前 100px 触发，体验更好</span>
        });

        <span class="hljs-keyword">if</span>(sentinelRef.<span class="hljs-property">current</span>) {
            observer.<span class="hljs-title function_">observe</span>(sentinelRef.<span class="hljs-property">current</span>);
        }

        <span class="hljs-comment">// 🧹 清理函数：组件卸载时取消观察</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">if</span>(sentinelRef.<span class="hljs-property">current</span>) {
                observer.<span class="hljs-title function_">unobserve</span>(sentinelRef.<span class="hljs-property">current</span>);
            }
        }
    }, [onLoadMore, hasMore, isLoading]);

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
            {children}
            
            {/* 🕵️‍♀️ 这是一个看不见的哨兵 div */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{sentinelRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-4"</span>/&gt;</span>
            
            {/* 加载状态提示 */}
            {
                isLoading &amp;&amp; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-center text-sm py-4 text-muted-foreground"</span>&gt;</span>
                        加载中...
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                )
            }
             {/* 底线提示 */}
            {
                !hasMore &amp;&amp; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-center text-sm py-4 text-muted-foreground"</span>&gt;</span>
                        没有更多内容了 ~
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                )
            }
        <span class="hljs-tag">&lt;/&gt;</span></span>
    )
}
</code></pre>
<h3 data-id="heading-3">1.3 组装：Home 页面</h3>
<p>最后，在 <code>src/pages/Home.tsx</code> 里把它们组合起来：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// frontend/notes/src/pages/Home.tsx</span>
&lt;<span class="hljs-title class_">InfiniteScroll</span>
    hasMore={hasMore}
    isLoading={loading}
    onLoadMore={loadMore}
&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    {
        posts.map(post =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">PostItem</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{post.id}</span> <span class="hljs-attr">post</span>=<span class="hljs-string">{post}</span> /&gt;</span>
        ))
    }
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">InfiniteScroll</span>&gt;
</code></pre>
<p>现在，当你滑动页面，到底部时就会自动加载下一页，丝滑流畅！</p>
<hr/>
<h2 data-id="heading-4">🚀 二、 路由跳转与嵌套</h2>
<p>文章列表不仅要能看，还要能点。
我们在 <code>PostItem</code> 里已经写了跳转逻辑：<code>onClick={() =&gt; navigate(/post/${post.id})}</code>。
现在我们需要配置一下路由。</p>
<p>打开 <code>src/router/index.tsx</code>：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// frontend/notes/src/router/index.tsx</span>

<span class="hljs-comment">// 懒加载详情页组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">PostLayout</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/layouts/PostLayout'</span>))
<span class="hljs-keyword">const</span> <span class="hljs-title class_">PostDetail</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/pages/post'</span>))

&lt;<span class="hljs-title class_">Routes</span>&gt;
    {<span class="hljs-comment">/* ...其他路由 */</span>}
    
    {<span class="hljs-comment">/* 📝 文章详情路由嵌套 */</span>}
    &lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/post"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PostLayout</span>/&gt;</span></span>}&gt;
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">":id"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">PostDetail</span> /&gt;</span>}/&gt;</span>
    &lt;/<span class="hljs-title class_">Route</span>&gt;
&lt;/<span class="hljs-title class_">Routes</span>&gt;
</code></pre>
<p>这里用到了 <strong>嵌套路由</strong>。<code>PostLayout</code> 是一个布局容器（虽然目前很简单，只返回了 <code>&lt;Outlet /&gt;</code>），<code>PostDetail</code> 是具体的详情页。这种结构方便以后给所有文章详情页统一添加头部、底部或者侧边栏。</p>
<hr/>
<h2 data-id="heading-5">💾 三、 极致体验：KeepAlive 页面缓存</h2>
<p>好的，功能都做完了，但体验上还有一个大坑。
<strong>场景复现</strong>：</p>
<ol>
<li>用户在首页刷了 5 页文章，滑到了第 50 条。</li>
<li>用户点击第 50 条文章，进入详情页看了一会儿。</li>
<li>用户点击“返回”，回到首页。</li>
<li><strong>灾难发生</strong>：首页重新渲染了！数据重新从第 1 页加载，滚动条回到了顶部！用户想看第 51 条，得重新滑半天。🤬</li>
</ol>
<p>这在 SPA（单页应用）中是默认行为，因为组件被卸载了。
为了解决这个问题，我们需要 <strong>KeepAlive（页面缓存）</strong>。React 官方暂时没有完美的方案，我们使用社区优秀的库 <code>react-activation</code>。</p>
<h3 data-id="heading-6">3.1 引入 AliveScope</h3>
<p>首先，在路由的根部包裹 <code>AliveScope</code>。它就像一个“休眠仓”，负责管理那些被缓存的组件节点。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// frontend/notes/src/router/index.tsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AliveScope</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-activation'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RouterConfig</span>(<span class="hljs-params">{children}</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
      {/* ⚡️ 赋予应用 KeepAlive 能力 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">AliveScope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Loading</span>/&gt;</span>}&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
             {/* ... */}
          <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">AliveScope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
  )
}
</code></pre>
<h3 data-id="heading-7">3.2 封装 KeepAliveHome</h3>
<p>我们需要把 Home 组件“包”起来，告诉它：“你不要卸载，你只是睡着了”。
新建 <code>src/components/KeepAliveHome.tsx</code>：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// frontend/notes/src/components/KeepAliveHome.tsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">KeepAlive</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-activation'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/pages/Home'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">KeepAliveHome</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">return</span> (
        <span class="hljs-comment">// 🔒 name: 缓存的唯一标识</span>
        <span class="hljs-comment">// 💾 saveScrollPosition="screen": 自动保存滚动位置！神器！</span>
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">KeepAlive</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"home"</span> <span class="hljs-attr">saveScrollPosition</span>=<span class="hljs-string">"screen"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">KeepAliveHome</span>;
</code></pre>
<h3 data-id="heading-8">3.3 替换路由组件</h3>
<p>最后，修改路由配置，让 <code>/</code> 路径指向这个被包裹的 <code>KeepAliveHome</code>，而不是原始的 <code>Home</code>。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// frontend/notes/src/router/index.tsx</span>

<span class="hljs-comment">// 🔄 替换引入</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/components/KeepAliveHome'</span>));

<span class="hljs-comment">// ...</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">MainLayout</span>/&gt;</span>}&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">""</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt; {/* 这里渲染的是 KeepAliveHome */}
    {/* ... */}
<span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-9">3.4 见证奇迹</h3>
<p>现在，你再去首页滑到第 50 条，点进去，再退回来。
你会发现：<strong>页面没有刷新，滚动条纹丝不动，数据还在那里！</strong> 🎉</p>
<p><strong>原理揭秘</strong>：
<code>KeepAlive</code> 并不会真的卸载组件，而是把组件的 DOM 节点从文档流中移走（比如放到一个看不见的 <code>div</code> 里），或者设为 <code>display: none</code>。当路由切回来时，再把这些 DOM 节点移回来。这样，组件的状态（State）和 DOM 状态（滚动位置、输入框内容）都能完美保留。</p>
<hr/>
<h2 data-id="heading-10">🎬 总结</h2>
<p>今天我们完成了一次用户体验的巨大飞跃：</p>
<ol>
<li><strong>无限滚动 (InfiniteScroll)</strong>：利用 <code>IntersectionObserver</code> 和 <code>Zustand</code> 实现了自动加载更多，让内容流更加顺滑。</li>
<li><strong>路由嵌套</strong>：规范了文章详情页的路由结构。</li>
<li><strong>页面缓存 (KeepAlive)</strong>：解决了 SPA 应用“返回重置”的顽疾，让我们的 Web App 拥有了原生 App 般的丝滑体验。</li>
</ol>
<p>到这里，文章列表的核心功能已经非常完善了。明天，我们将进入 <strong>文章详情页</strong> 的开发，不仅要展示 Markdown 内容，还要实现点赞、评论等互动功能！</p>
<p>保持好奇，保持热爱，我们明天见！👋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 装饰器入门核心用法]]></title>    <link>https://juejin.cn/post/7599910677578612736</link>    <guid>https://juejin.cn/post/7599910677578612736</guid>    <pubDate>2026-01-27T14:41:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599910677578612736" data-draft-id="7599911091086491648" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 装饰器入门核心用法"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-27T14:41:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="如果你好"/> <meta itemprop="url" content="https://juejin.cn/user/2272012281328215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 装饰器入门核心用法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2272012281328215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    如果你好
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:41:49.000Z" title="Tue Jan 27 2026 14:41:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、什么是装饰器？</h2>
<p>装饰器就是<strong>普通函数</strong>，用 <code>@装饰器名</code> 贴在类、方法、属性上，作用就是<strong>给被装饰的东西加额外功能</strong>，仅此而已。</p>
<h2 data-id="heading-1">二、最基础用法：类装饰器</h2>
<p>直接贴在类上，函数唯一参数是<strong>被装饰类的构造函数</strong>，最简单的例子：给类加静态属性。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义装饰器函数：给类加版本号</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addVersion</span>(<span class="hljs-params">target</span>) {
  target.<span class="hljs-property">version</span> = <span class="hljs-string">'1.0.0'</span>; <span class="hljs-comment">// 给类挂载静态属性</span>
}

<span class="hljs-comment">// 用@贴在类上，完成装饰</span>
<span class="hljs-meta">@addVersion</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {}

<span class="hljs-comment">// 直接使用装饰器加的属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MyClass</span>.<span class="hljs-property">version</span>); <span class="hljs-comment">// 输出：1.0.0</span>
</code></pre>
<p>核心逻辑：<code>@addVersion</code> 等价于 <code>addVersion(MyClass)</code>，把类传给装饰器函数就行。</p>
<h2 data-id="heading-2">三、最常用用法：方法装饰器</h2>
<p>贴在类的方法上，日常用得最多，函数有 3 个固定参数：不用死记含义，跟着案例用就会。</p>
<h3 data-id="heading-3">简单案例1：给方法加日志</h3>
<p>执行方法时，自动打印“方法被调用了”，不用在方法里写重复代码。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 方法装饰器：打印方法调用日志</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showLog</span>(<span class="hljs-params">target, name, descriptor</span>) {
  <span class="hljs-comment">// 保存原方法</span>
  <span class="hljs-keyword">const</span> oldFn = descriptor.<span class="hljs-property">value</span>;
  <span class="hljs-comment">// 重写方法，加日志逻辑</span>
  descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`【日志】<span class="hljs-subst">${name}</span>方法被调用了`</span>);
    oldFn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// 执行原来的方法</span>
  };
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
  <span class="hljs-comment">// 装饰器贴在方法上</span>
  <span class="hljs-meta">@showLog</span>
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'hello TS'</span>);
  }
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>().<span class="hljs-title function_">sayHi</span>();
<span class="hljs-comment">// 输出：【日志】sayHi方法被调用了 → hello TS</span>
</code></pre>
<h3 data-id="heading-4">简单案例2：禁止方法被修改</h3>
<p>让方法只读，不能被重新赋值，避免误改方法逻辑。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 方法装饰器：禁止方法修改</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">noChange</span>(<span class="hljs-params">target, name, descriptor</span>) {
  descriptor.<span class="hljs-property">writable</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 设为不可写</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
  <span class="hljs-meta">@noChange</span>
  <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'不能改我'</span>);
  }
}

<span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();
obj.<span class="hljs-property">fn</span> = <span class="hljs-function">() =&gt;</span> {}; <span class="hljs-comment">// 报错：无法分配到 "fn"，因为它是只读属性</span>
</code></pre>
<h2 data-id="heading-5">四、属性装饰器：给属性加默认值</h2>
<p>贴在类的属性上，函数有 2 个参数，最简单的用法：给属性设置默认值，不用在构造函数里初始化。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 属性装饰器：设置默认值</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">setDefault</span>(<span class="hljs-params">val</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">target, name</span>) {
    target[name] = val;
  };
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
  <span class="hljs-comment">// 贴在属性上，传默认值</span>
  <span class="hljs-meta">@setDefault</span>(<span class="hljs-string">'张三'</span>)
  name;

  <span class="hljs-meta">@setDefault</span>(<span class="hljs-number">20</span>)
  age;
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>().<span class="hljs-property">name</span>); <span class="hljs-comment">// 输出：张三</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>().<span class="hljs-property">age</span>); <span class="hljs-comment">// 输出：20</span>
</code></pre>
<h2 data-id="heading-6">五、装饰器工厂：给装饰器传参</h2>
<p>想给装饰器传自定义参数（比如日志加前缀、默认值自定义），就写<strong>装饰器工厂</strong>——本质是「返回装饰器的函数」，写法超简单，看案例就会。</p>
<h3 data-id="heading-7">案例：带前缀的日志装饰器</h3>
<p>让日志有自定义前缀，不用写多个装饰器函数。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 装饰器工厂：接收自定义前缀</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">prefix</span>) {
  <span class="hljs-comment">// 返回真正的装饰器函数</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">target, name, descriptor</span>) {
    <span class="hljs-keyword">const</span> oldFn = descriptor.<span class="hljs-property">value</span>;
    descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`【<span class="hljs-subst">${prefix}</span>】<span class="hljs-subst">${name}</span>方法执行了`</span>);
      oldFn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>);
    };
  };
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
  <span class="hljs-comment">// 传参使用：自定义前缀“接口请求”</span>
  <span class="hljs-meta">@log</span>(<span class="hljs-string">'接口请求'</span>)
  <span class="hljs-title function_">getData</span>(<span class="hljs-params"/>) {}

  <span class="hljs-comment">// 传参使用：自定义前缀“操作”</span>
  <span class="hljs-meta">@log</span>(<span class="hljs-string">'操作'</span>)
  <span class="hljs-title function_">saveData</span>(<span class="hljs-params"/>) {}
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>().<span class="hljs-title function_">getData</span>(); <span class="hljs-comment">// 输出：【接口请求】getData方法执行了</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>().<span class="hljs-title function_">saveData</span>(); <span class="hljs-comment">// 输出：【操作】saveData方法执行了</span>
</code></pre>
<h2 data-id="heading-8">六、必记规则：多个装饰器的执行顺序</h2>
<p>一个类/方法上贴多个装饰器时，<strong>从下往上执行</strong>——谁离被装饰的东西近，谁先执行。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义两个简单装饰器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">A</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'执行装饰器A'</span>);
  <span class="hljs-keyword">return</span> target;
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">B</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'执行装饰器B'</span>);
  <span class="hljs-keyword">return</span> target;
}

<span class="hljs-comment">// B离类更近，先执行；A后执行</span>
<span class="hljs-meta">@A</span>
<span class="hljs-meta">@B</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {}

<span class="hljs-comment">// 运行结果：先打印「执行装饰器B」，再打印「执行装饰器A」</span>
</code></pre>
<p>等价理解：<code>MyClass = A(B(MyClass))</code>，先执行内层的 B，再执行外层的 A。</p>
<h2 data-id="heading-9">七、使用前提：开启TS配置</h2>
<p>装饰器是 TS 实验性特性，必须在 <code>tsconfig.json</code> 里加一行配置，否则报错，就加这一个核心项就行：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"experimentalDecorators"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 必须开启，启用装饰器</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES5"</span> <span class="hljs-comment">// 项目基本配置，一般都有</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Stylus 与现代 CSS 构建响应式图片面板：高效、优雅的前端开发实践]]></title>    <link>https://juejin.cn/post/7599924965950636070</link>    <guid>https://juejin.cn/post/7599924965950636070</guid>    <pubDate>2026-01-27T14:46:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599924965950636070" data-draft-id="7599920572840345609" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Stylus 与现代 CSS 构建响应式图片面板：高效、优雅的前端开发实践"/> <meta itemprop="keywords" content="前端,Stylus"/> <meta itemprop="datePublished" content="2026-01-27T14:46:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户575730334624"/> <meta itemprop="url" content="https://juejin.cn/user/2860271309712009"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Stylus 与现代 CSS 构建响应式图片面板：高效、优雅的前端开发实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2860271309712009/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户575730334624
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:46:32.000Z" title="Tue Jan 27 2026 14:46:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用 Stylus 与现代 CSS 构建响应式图片面板：高效、优雅的前端开发实践</h2>
<blockquote>
<p><strong>摘要</strong>：本文通过一个交互式图片面板项目，深入讲解如何结合 <strong>Stylus 预处理器</strong> 与 <strong>现代 CSS 特性</strong>（如 Flexbox、Transition、媒体查询）实现高性能、可维护的响应式布局。我们将展示从语义化 HTML 到模块化 Stylus 代码的完整开发流程，并探讨预处理器如何提升前端工程效率。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">一、为什么选择 Stylus？—— CSS 的“超能力”扩展</h3>
<p>原生 CSS 虽然功能强大，但在大型项目中常面临<strong>重复代码多、嵌套混乱、变量缺失</strong>等问题。Stylus 作为一门富有表现力的 CSS 预处理器，通过简洁的语法（甚至可省略大括号和分号），支持<strong>变量、函数、混合（mixins）、嵌套</strong>等编程特性，极大提升了样式表的可读性与可维护性。</p>
<p>更重要的是：<strong>浏览器无法直接解析 Stylus</strong>，需通过编译生成标准 CSS。这看似增加一步，实则带来巨大收益：</p>
<ul>
<li>开发时写简洁、逻辑清晰的 <code>.styl</code> 文件；</li>
<li>编译后输出高度优化、带自动前缀的 <code>.css</code> 文件；</li>
<li>支持模块化与复用，避免“复制粘贴式”编码。</li>
</ul>
<p>安装与编译命令极简：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g stylus
stylus style.styl -o style.css       <span class="hljs-comment"># 单次编译</span>
stylus style.styl -o style.css -w    <span class="hljs-comment"># 监听文件变化，自动编译</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">二、项目结构：语义化 HTML + 模块化交互</h3>
<p>我们构建一个<strong>点击展开式图片面板</strong>，包含5张风景图，点击任一面板可将其放大并显示标题。</p>
<h4 data-id="heading-3">HTML 结构（语义清晰）</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel active"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background-image: url('...')"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Explore The World<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 其他4个 .panel --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./common.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<ul>
<li>使用 <code>class="panel"</code> 统一标识；</li>
<li>初始状态通过 <code>active</code> 类控制首个面板展开；</li>
<li>内联背景图便于演示，实际项目建议用 CSS 变量或 JS 动态注入。</li>
</ul>
<h4 data-id="heading-4">JavaScript 交互逻辑（简洁可靠）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> panels = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.panel'</span>);
panels.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">panel</span> =&gt;</span> {
  panel.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.active'</span>)?.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'active'</span>);
    panel.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'active'</span>);
  });
});
</code></pre>
<blockquote>
<p>✅ 使用可选链（<code>?.</code>）避免空值错误，确保健壮性。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">三、Stylus 实战：编写高效、嵌套的样式代码</h3>
<p>我们将原生 CSS 重构为 Stylus，展示其核心优势。</p>
<h4 data-id="heading-6">1. 全局重置与容器布局（利用嵌套）</h4>
<pre><code class="hljs language-stylus" lang="stylus">// style.styl
*
  margin: 0
  padding: 0

body
  display: flex
  flex-direction: row
  justify-content: center
  align-items: center
  height: 100vh
  overflow: hidden
</code></pre>
<blockquote>
<p>💡 <strong>无大括号、无分号</strong>，靠缩进表达层级，代码更清爽。</p>
</blockquote>
<h4 data-id="heading-7">2. 面板样式：嵌套 + 状态管理</h4>
<pre><code class="hljs language-stylus" lang="stylus">.container
  display: flex
  width: 90vw

  .panel
    height: 80vh
    border-radius: 50px
    color: #fff
    cursor: pointer
    flex: 0.5
    margin: 10px
    position: relative
    background-size: cover
    background-position: center
    background-repeat: no-repeat
    transition: all 700ms ease-in

    h3
      font-size: 24px
      position: absolute
      left: 20px
      bottom: 20px
      margin: 0
      opacity: 0
      transition: opacity 300ms ease-in 400ms

    &amp;.active
      flex: 5
      h3
        opacity: 1
</code></pre>
<h5 data-id="heading-8">关键技巧解析：</h5>
<ul>
<li><strong>嵌套选择器</strong>：<code>.container .panel h3</code> 被写成三层缩进，逻辑一目了然；</li>
<li><strong>状态嵌套</strong>：<code>&amp;.active</code> 表示“当前元素同时拥有 <code>active</code> 类”，编译后为 <code>.container .panel.active</code>；</li>
<li><strong>过渡动画</strong>：
<ul>
<li><code>transition: all 700ms ease-in</code>：面板尺寸变化平滑过渡；</li>
<li><code>transition: opacity ... 400ms</code>：标题延迟 400ms 淡入，增强动效层次。</li>
</ul>
</li>
</ul>
<blockquote>
<p>✅ 这种写法比原生 CSS 减少 40% 代码量，且修改 <code>.panel</code> 样式时无需全局搜索。</p>
</blockquote>
<h4 data-id="heading-9">3. 响应式设计：媒体查询嵌套</h4>
<pre><code class="hljs language-stylus" lang="stylus">@media (max-width: 480px)
  .container
    width: 100vw
    .panel
      &amp;:nth-of-type(4),
      &amp;:nth-of-type(5)
        display: none
</code></pre>
<ul>
<li>在小屏设备（如 iPhone）上隐藏最后两张图，保证体验；</li>
<li>嵌套在 <code>.container</code> 内部，作用域清晰，避免样式污染。</li>
</ul>
<hr/>
<h3 data-id="heading-10">四、Flexbox：实现弹性布局的核心</h3>
<p>本项目依赖 Flexbox 完成关键布局：</p>

























<table><thead><tr><th>属性</th><th>作用</th></tr></thead><tbody><tr><td><code>display: flex</code></td><td>启用弹性上下文</td></tr><tr><td><code>justify-content: center</code></td><td>主轴（水平）居中</td></tr><tr><td><code>align-items: center</code></td><td>侧轴（垂直）居中</td></tr><tr><td><code>flex: 0.5</code> / <code>flex: 5</code></td><td>控制面板伸缩比例，点击后放大</td></tr></tbody></table>
<blockquote>
<p>📱 <strong>移动端友好</strong>：Flexbox 天然适配不同屏幕尺寸，是现代布局首选。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">五、编译与优化：从 Stylus 到生产级 CSS</h3>
<p>运行编译命令：</p>
<pre><code class="hljs language-bash" lang="bash">stylus style.styl -o style.css --autoprefixer
</code></pre>
<blockquote>
<p>⚠️ 注意：Stylus 本身不带自动加前缀功能，需配合 <code>autoprefixer</code> 插件或使用构建工具（如 Webpack + postcss-loader）。</p>
</blockquote>
<p>编译后生成的标准 CSS（节选）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.panel</span><span class="hljs-selector-class">.active</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">5</span>;
}
<span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.panel</span><span class="hljs-selector-class">.active</span> <span class="hljs-selector-tag">h3</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
  <span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.panel</span><span class="hljs-selector-pseudo">:nth-of-type</span>(<span class="hljs-number">4</span>),
  <span class="hljs-selector-class">.container</span> <span class="hljs-selector-class">.panel</span><span class="hljs-selector-pseudo">:nth-of-type</span>(<span class="hljs-number">5</span>) {
    <span class="hljs-attribute">display</span>: none;
  }
}
</code></pre>
<p>所有属性均自动添加 <code>-webkit-</code> 等前缀，确保兼容性。</p>
<hr/>
<h3 data-id="heading-12">六、总结：Stylus 如何赋能现代前端开发</h3>
<p>通过本项目，我们验证了 Stylus 在以下方面的价值：</p>
<ol>
<li><strong>提升开发效率</strong><br/>
嵌套、变量、混合减少重复代码，逻辑更清晰。</li>
<li><strong>增强可维护性</strong><br/>
修改一个类的样式只需定位到其嵌套块，无需担心全局影响。</li>
<li><strong>无缝集成现代 CSS</strong><br/>
Flexbox、Transition、媒体查询等特性原生支持，编译后完全兼容。</li>
<li><strong>促进工程化思维</strong><br/>
预编译流程天然引导开发者采用模块化、组件化思想。</li>
</ol>
<blockquote>
<p>🌟 <strong>未来展望</strong>：虽然 Sass/SCSS 因社区庞大更流行，但 Stylus 以<strong>极致简洁的语法</strong>仍有一席之地。在追求开发体验与代码优雅的项目中，它依然是值得考虑的利器。</p>
</blockquote>
<hr/>
<p><strong>结语</strong>：前端不仅是“写页面”，更是“构建体验”。借助 Stylus 这样的工具，我们能将更多精力聚焦于交互逻辑与视觉表现，而非繁琐的样式拼接。正如本项目所示——<strong>一行 <code>&amp;.active</code>，胜过十行重复选择器</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 单页应用优化实战：从路由缓存到用户认证的完整解决方案]]></title>    <link>https://juejin.cn/post/7599873006258307106</link>    <guid>https://juejin.cn/post/7599873006258307106</guid>    <pubDate>2026-01-27T15:21:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599873006258307106" data-draft-id="7599899147417993268" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 单页应用优化实战：从路由缓存到用户认证的完整解决方案"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-01-27T15:21:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无敌的拖拉斯旋风"/> <meta itemprop="url" content="https://juejin.cn/user/951508170179208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 单页应用优化实战：从路由缓存到用户认证的完整解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/951508170179208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无敌的拖拉斯旋风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:21:58.000Z" title="Tue Jan 27 2026 15:21:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在现代 Web 开发中，单页应用（SPA）已成为主流架构。然而，频繁的页面切换导致的重复加载问题严重影响用户体验。本文将详细介绍如何通过 React、React-Router 和缓存机制构建高性能的 SPA，并实现完整的用户认证系统。</p>
<h2 data-id="heading-1">一、SPA 路由优化的必要性</h2>
<h3 data-id="heading-2">1.1 传统多页应用的问题</h3>
<p>传统的多页应用（MPA）每次页面跳转都需要向服务器发起完整 HTTP 请求，获取新的 HTML 文档。这种方式存在以下问题：</p>
<ul>
<li><strong>白屏等待</strong>：页面切换时出现空白，用户体验差</li>
<li><strong>资源重复加载</strong>：相同的基础资源需要重复下载</li>
<li><strong>网络延迟</strong>：每次请求都有网络往返时间</li>
</ul>
<h3 data-id="heading-3">1.2 单页应用的优势</h3>
<p>SPA 通过前端路由管理页面切换，具有以下优势：</p>
<p>javascript</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 传统后端路由 vs 前端路由</span>
<span class="hljs-comment">// 后端路由：/ → 完整HTML，/detail/123 → 完整HTML</span>
<span class="hljs-comment">// 前端路由：通过 JS 动态渲染组件，无需刷新页面</span>
</code></pre>
<ul>
<li><strong>无缝切换</strong>：页面间切换无白屏现象</li>
<li><strong>性能提升</strong>：基础资源只需加载一次</li>
<li><strong>用户体验</strong>：类似原生应用的流畅体验</li>
</ul>
<h2 data-id="heading-4">二、首页缓存优化策略</h2>
<h3 data-id="heading-5">2.1 问题场景分析</h3>
<p>在实际应用中，首页往往是用户访问频率最高的页面。频繁的首页与其他页面间切换会导致：</p>
<ul>
<li>首页组件重复渲染</li>
<li>数据重新加载</li>
<li>用户交互状态丢失</li>
</ul>
<h3 data-id="heading-6">2.2 Keep-Alive 机制</h3>
<p>为了保持首页组件的状态，我们需要实现组件缓存机制：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统方式 - 每次切换都会重新渲染</span>
&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">HomePage</span> /&gt;</span></span>} /&gt;

<span class="hljs-comment">// 缓存方式 - 保持组件状态</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
    &lt;<span class="hljs-attr">KeepAlive</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"home-page"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">HomePage</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
} /&gt;</span>
</code></pre>
<h3 data-id="heading-7">2.3 react-activation 实现缓存</h3>
<p><code>react-activation</code> 是 React 生态中最受欢迎的组件缓存解决方案，类似 Vue 的 <code>&lt;keep-alive&gt;</code>：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AliveScope</span>, <span class="hljs-title class_">KeepAlive</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-activation'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AliveScope</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
                    &lt;<span class="hljs-attr">KeepAlive</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"home-page"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">HomePage</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
                } /&gt;
                
                <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/detail/:id"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">DetailPage</span> /&gt;</span>} /&gt;
            <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">AliveScope</span>&gt;</span></span>
    );
}
</code></pre>
<p><strong>缓存机制原理：</strong></p>
<ul>
<li>组件卸载时保存在内存中</li>
<li>再次访问时从缓存恢复</li>
<li>保持组件的所有状态和数据</li>
</ul>
<h2 data-id="heading-8">三、Keep-Alive 详细实现</h2>
<h3 data-id="heading-9">3.1 核心概念</h3>
<p>Keep-Alive 机制的核心是将组件实例保存在内存中，而非真正的卸载：</p>
<p>jsx</p>
<pre><code class="hljs language-ini" lang="ini">// KeepAlive 组件的基本实现思路
const <span class="hljs-attr">KeepAlive</span> = ({ name, children }) =&gt; {
    const <span class="hljs-section">[cache, setCache]</span> = useState({})<span class="hljs-comment">;</span>
    
    // 缓存组件
    useEffect(() =&gt; {
        if (!cache<span class="hljs-section">[name]</span>) {
            setCache(<span class="hljs-attr">prev</span> =&gt; ({
                ...prev,
                <span class="hljs-section">[name]</span>: children
            }))<span class="hljs-comment">;</span>
        }
    }, <span class="hljs-section">[name, children]</span>)<span class="hljs-comment">;</span>
    
    // 返回缓存的组件或当前组件
    return cache<span class="hljs-section">[name]</span> || children<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-10">3.2 生命周期管理</h3>
<p>缓存组件需要特殊的生命周期管理：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useActivate, useDeactivate } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-activation'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">HomePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">useActivate</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'首页激活（进入页面）'</span>);
        <span class="hljs-comment">// 页面重新可见时的处理逻辑</span>
    });
    
    <span class="hljs-title function_">useDeactivate</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'首页失活（离开页面）'</span>);
        <span class="hljs-comment">// 页面即将隐藏时的处理逻辑</span>
    });
    
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>首页内容保持不变<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h3 data-id="heading-11">3.3 缓存策略</h3>
<p>可以根据不同需求实现不同的缓存策略：</p>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 条件缓存</span>
&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/search"</span> element={
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">KeepAlive</span> <span class="hljs-attr">when</span>=<span class="hljs-string">{()</span> =&gt;</span> shouldCacheSearch()}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">SearchPage</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span></span>
} /&gt;

<span class="hljs-comment">// 多级缓存</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/category/:id"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
    &lt;<span class="hljs-attr">KeepAlive</span> <span class="hljs-attr">name</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">category-</span> $ {<span class="hljs-attr">params.id</span>}`}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CategoryPage</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
} /&gt;</span>
</code></pre>
<h2 data-id="heading-12">四、用户认证系统设计</h2>
<h3 data-id="heading-13">4.1 DTO 验证层</h3>
<p>使用 <code>class-validator</code> 和 <code>class-transformer</code> 进行数据验证：</p>
<p>typescript</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// dto/create-user.dto.ts</span>
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">IsEmail</span>, <span class="hljs-selector-tag">IsNotEmpty</span>, <span class="hljs-selector-tag">IsString</span>, <span class="hljs-selector-tag">MinLength</span> } <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">class-validator</span>';
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">Type</span> } <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">class-transformer</span>';

<span class="hljs-selector-tag">export</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">CreateUserDto</span> {
    <span class="hljs-variable">@IsNotEmpty</span>({ <span class="hljs-attribute">message</span>: <span class="hljs-string">'用户名不能为空'</span> })
    <span class="hljs-variable">@IsString</span>({ <span class="hljs-attribute">message</span>: <span class="hljs-string">'用户名必须是字符串'</span> })
    name?: string;

    <span class="hljs-variable">@IsNotEmpty</span>({ <span class="hljs-attribute">message</span>: <span class="hljs-string">'密码不能为空'</span> })
    <span class="hljs-variable">@IsString</span>({ <span class="hljs-attribute">message</span>: <span class="hljs-string">'密码必须是字符串'</span> })
    <span class="hljs-variable">@MinLength</span>(<span class="hljs-number">6</span>, { <span class="hljs-attribute">message</span>: <span class="hljs-string">'密码长度至少为6位'</span> })
    password?: string;

    <span class="hljs-variable">@IsEmail</span>({}, { <span class="hljs-attribute">message</span>: <span class="hljs-string">'请输入有效的邮箱地址'</span> })
    <span class="hljs-variable">@IsNotEmpty</span>({ <span class="hljs-attribute">message</span>: <span class="hljs-string">'邮箱不能为空'</span> })
    email?: string;
}
</code></pre>
<h3 data-id="heading-14">4.2 控制器层实现</h3>
<p>控制器负责处理 HTTP 请求和响应：</p>
<p>typescript</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// users.controller.ts</span>
<span class="hljs-selector-tag">import</span> {
    <span class="hljs-selector-tag">Controller</span>,
    <span class="hljs-selector-tag">Post</span>,
    <span class="hljs-selector-tag">Body</span>,
    <span class="hljs-selector-tag">HttpCode</span>,
    <span class="hljs-selector-tag">HttpStatus</span>
} <span class="hljs-selector-tag">from</span> '@<span class="hljs-selector-tag">nestjs</span>/<span class="hljs-selector-tag">common</span>';
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">UsersService</span> } <span class="hljs-selector-tag">from</span> './<span class="hljs-selector-tag">users</span><span class="hljs-selector-class">.service</span>';
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">CreateUserDto</span> } <span class="hljs-selector-tag">from</span> './<span class="hljs-selector-tag">dto</span>/<span class="hljs-selector-tag">create-user</span><span class="hljs-selector-class">.dto</span>';

@<span class="hljs-selector-tag">Controller</span>(<span class="hljs-string">'users'</span>)
<span class="hljs-selector-tag">export</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">UsersController</span> {
    <span class="hljs-selector-tag">constructor</span>(
        private readonly <span class="hljs-attribute">usersService</span>: UsersService
    ) {}

    <span class="hljs-variable">@Post</span>(<span class="hljs-string">'/register'</span>)
    <span class="hljs-variable">@HttpCode</span>(HttpStatus.CREATED)
    async <span class="hljs-built_in">register</span>(<span class="hljs-variable">@Body</span>() <span class="hljs-attribute">createUserDto</span>: CreateUserDto) {
        <span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(<span class="hljs-string">'接收到注册请求:'</span>, createUserDto);
        <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.usersService</span><span class="hljs-selector-class">.register</span>(createUserDto);
        <span class="hljs-selector-tag">return</span> {
            success: true,
            data: result,
            message: '注册成功'
        };
    }

    <span class="hljs-variable">@Post</span>(<span class="hljs-string">'/login'</span>)
    <span class="hljs-variable">@HttpCode</span>(HttpStatus.OK)
    async <span class="hljs-built_in">login</span>(<span class="hljs-variable">@Body</span>() <span class="hljs-attribute">loginDto</span>: LoginUserDto) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.usersService</span><span class="hljs-selector-class">.login</span>(loginDto);
    }
}
</code></pre>
<h3 data-id="heading-15">4.3 服务层业务逻辑</h3>
<p>服务层处理核心业务逻辑：</p>
<p>typescript</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// users.service.ts</span>
<span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">Injectable</span>,
    <span class="hljs-title class_">BadRequestException</span>,
    <span class="hljs-title class_">ConflictException</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../prisma/prisma.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CreateUserDto</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./dto/create-user.dto'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> bcrypt <span class="hljs-keyword">from</span> <span class="hljs-string">'bcrypt'</span>;

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsersService</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> prisma: PrismaService</span>) {}

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">createUserDto: CreateUserDto</span>) {
        <span class="hljs-keyword">const</span> { name, password, email } = createUserDto;

        <span class="hljs-comment">// 检查用户名是否已存在</span>
        <span class="hljs-keyword">const</span> existingUser = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>({
            <span class="hljs-attr">where</span>: { name }
        });

        <span class="hljs-keyword">if</span> (existingUser) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConflictException</span>(<span class="hljs-string">'用户名已存在'</span>);
        }

        <span class="hljs-comment">// 检查邮箱是否已存在</span>
        <span class="hljs-keyword">const</span> existingEmail = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>({
            <span class="hljs-attr">where</span>: { email }
        });

        <span class="hljs-keyword">if</span> (existingEmail) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConflictException</span>(<span class="hljs-string">'邮箱已被注册'</span>);
        }

        <span class="hljs-comment">// 密码加密</span>
        <span class="hljs-keyword">const</span> hashedPassword = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">hash</span>(password, <span class="hljs-number">10</span>);

        <span class="hljs-comment">// 创建用户</span>
        <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">create</span>({
            <span class="hljs-attr">data</span>: {
                name,
                email,
                <span class="hljs-attr">password</span>: hashedPassword,
                <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
                <span class="hljs-attr">updatedAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
            },
            <span class="hljs-attr">select</span>: {
                <span class="hljs-attr">id</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">email</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">createdAt</span>: <span class="hljs-literal">true</span>
            }
        });

        <span class="hljs-keyword">return</span> user;
    }

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">loginDto: LoginUserDto</span>) {
        <span class="hljs-keyword">const</span> { name, password } = loginDto;

        <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>({
            <span class="hljs-attr">where</span>: { name }
        });

        <span class="hljs-keyword">if</span> (!user) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadRequestException</span>(<span class="hljs-string">'用户名不存在'</span>);
        }

        <span class="hljs-keyword">const</span> isPasswordValid = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">compare</span>(password, user.<span class="hljs-property">password</span>);
        <span class="hljs-keyword">if</span> (!isPasswordValid) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadRequestException</span>(<span class="hljs-string">'密码错误'</span>);
        }

        <span class="hljs-comment">// 生成 JWT token</span>
        <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateToken</span>(user.<span class="hljs-property">id</span>);
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">user</span>: {
                <span class="hljs-attr">id</span>: user.<span class="hljs-property">id</span>,
                <span class="hljs-attr">name</span>: user.<span class="hljs-property">name</span>,
                <span class="hljs-attr">email</span>: user.<span class="hljs-property">email</span>
            },
            token
        };
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">generateToken</span>(<span class="hljs-params">userId: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-comment">// JWT token 生成逻辑</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">'generated_token'</span>;
    }
}
</code></pre>
<h3 data-id="heading-16">4.4 模块配置</h3>
<p>NestJS 模块化配置：</p>
<p>typescript</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// users.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../prisma/prisma.module'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UsersController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./users.controller'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UsersService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./users.service'</span>;

<span class="hljs-meta">@Module</span>({
    <span class="hljs-attr">imports</span>: [
        <span class="hljs-title class_">PrismaModule</span>,
        <span class="hljs-comment">// 可以添加 JWT 模块、邮件模块等</span>
    ],
    <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">UsersController</span>],
    <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">UsersService</span>],
    <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">UsersService</span>] <span class="hljs-comment">// 如果其他模块需要使用 UsersService</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsersModule</span> {}
</code></pre>
<h2 data-id="heading-17">五、性能优化最佳实践</h2>
<h3 data-id="heading-18">5.1 缓存策略优化</h3>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 根据页面特性选择缓存策略</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">RouteConfig</span> = (<span class="hljs-params"/>) =&gt; (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
        {/* 首页：长期缓存 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
            &lt;<span class="hljs-attr">KeepAlive</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"home-page"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">{1}</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">HomePage</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
        } /&gt;
        
        {/* 列表页：按参数缓存 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/products/:category"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
            &lt;<span class="hljs-attr">KeepAlive</span> <span class="hljs-attr">name</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">products-</span> $ {<span class="hljs-attr">params.category</span>}`}&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ProductList</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
        } /&gt;
        
        {/* 详情页：不缓存 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/product/:id"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">ProductDetail</span> /&gt;</span>} /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span>
);
</code></pre>
<h3 data-id="heading-19">5.2 内存管理</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 防止内存泄漏的缓存清理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">cleanupCache</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 定期清理不活跃的缓存</span>
    <span class="hljs-comment">// 限制缓存数量</span>
    <span class="hljs-comment">// 监控内存使用情况</span>
};
</code></pre>
<h3 data-id="heading-20">5.3 错误处理</h3>
<p>typescript</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 统一错误处理</span>
@<span class="hljs-title function_ invoke__">Catch</span>(BadRequestException)
export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ValidationExceptionFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ExceptionFilter</span> </span>{
    <span class="hljs-keyword">catch</span>(exception: BadRequestException, host: ArgumentsHost) {
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ctx</span> = host.<span class="hljs-title function_ invoke__">switchToHttp</span>();
        <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">response</span> = ctx.<span class="hljs-title function_ invoke__">getResponse</span>();
        
        response.<span class="hljs-title function_ invoke__">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_ invoke__">json</span>({
            <span class="hljs-attr">statusCode</span>: <span class="hljs-number">400</span>,
            <span class="hljs-attr">error</span>: <span class="hljs-string">'Validation Failed'</span>,
            <span class="hljs-attr">message</span>: exception.message
        });
    }
}
</code></pre>
<h3 data-id="heading-21">apifox发送数据测试</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bb177863ae64179a6184093453676c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg5pWM55qE5ouW5ouJ5pav5peL6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132192&amp;x-signature=BqTpoP%2FZ2%2FhZKzN24td%2B93vikJo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-22">六、总结</h2>
<p>本文详细介绍了单页应用的性能优化策略，包括：</p>
<ol>
<li><strong>路由缓存机制</strong>：通过 Keep-Alive 保持组件状态</li>
<li><strong>用户认证系统</strong>：完整的注册登录功能实现</li>
<li><strong>数据验证</strong>：DTO 层的数据校验机制</li>
<li><strong>错误处理</strong>：统一的异常处理策略</li>
</ol>
<p>这些技术的结合使用，能够显著提升单页应用的用户体验，减少页面加载时间，提高应用响应速度。在实际项目中，需要根据具体业务需求调整缓存策略，平衡性能和内存使用。</p>
<p>通过合理的架构设计和优化策略，我们可以构建出既高效又用户友好的现代化 Web 应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧙‍♂️ 拒绝页面“失忆”！手写 React KeepAlive 组件，彻底搞懂缓存原理]]></title>    <link>https://juejin.cn/post/7599868109085671466</link>    <guid>https://juejin.cn/post/7599868109085671466</guid>    <pubDate>2026-01-27T15:33:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599868109085671466" data-draft-id="7599843186203082794" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🧙‍♂️ 拒绝页面“失忆”！手写 React KeepAlive 组件，彻底搞懂缓存原理"/> <meta itemprop="keywords" content="性能优化,React.js"/> <meta itemprop="datePublished" content="2026-01-27T15:33:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神秘的猪头"/> <meta itemprop="url" content="https://juejin.cn/user/793223472877051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🧙‍♂️ 拒绝页面“失忆”！手写 React KeepAlive 组件，彻底搞懂缓存原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/793223472877051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神秘的猪头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:33:26.000Z" title="Tue Jan 27 2026 15:33:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>哈喽，掘金的小伙伴们！👋 欢迎来到 <strong>React 进阶实战</strong>！</p>
<p>在 Vue 中，我们有一个非常好用的内置组件 <code>&lt;keep-alive&gt;</code>，它可以让组件在切换时“不被销毁”，而是“休眠”，当再次回来时，数据和状态依然完好如初。这对于<strong>表单填写中途切换</strong>、<strong>长列表浏览后返回</strong>等场景简直是神器！</p>
<p>然而，在 React 的世界里，官方并没有直接提供这样一个组件（React Router 曾经有，后来也没了）。当我们切换路由或条件渲染时，组件会被无情地<strong>卸载（Unmount）</strong>，所有的状态（State）都会随风而去。🍃</p>
<p>今天，我们就来挑战一下：<strong>不依赖第三方库，从零开始，手写一个 React 版的 KeepAlive 组件！</strong></p>
<p>通过这篇文章，你将学到：</p>
<ul>
<li>🔍 <strong>React 组件的生命周期与销毁机制</strong></li>
<li>🧠 <strong>如何利用闭包和 State 进行“状态大挪移”</strong></li>
<li>🎨 <strong>CSS <code>display: none</code> 在组件缓存中的妙用</strong></li>
<li>🛠 <strong><code>Object.entries</code> 的实战技巧</strong></li>
</ul>
<p>准备好了吗？让我们开始这场“拯救失忆组件”的行动吧！🚀</p>
<hr/>
<h2 data-id="heading-0">😱 一、 案发现场：组件的“失忆”症</h2>
<p>首先，我们先搭建一个简单的场景，看看没有 KeepAlive 时会发生什么。</p>
<h3 data-id="heading-1">1.1 编写一个会“数数”的组件</h3>
<p>我们需要一个带有状态的组件，比如一个计数器。当我们在两个计数器之间切换时，观察它们的数据会不会丢失。</p>
<p>打开 <code>src/App.jsx</code>，我们定义两个简单的组件 <code>Counter</code> 和 <code>OtherCounter</code>（其实逻辑一样，为了演示区分）。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/App.jsx</span>
<span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">KeepAlive</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/KeepAlive.jsx'</span>

<span class="hljs-comment">// 📦 这是一个普通的计数器组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Counter</span> = (<span class="hljs-params">{ name }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-comment">// 🔍 监听生命周期</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ <span class="hljs-subst">${name}</span> 组件挂载了！`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`❌ <span class="hljs-subst">${name}</span> 组件被卸载了...`</span>);
    }
  }, []);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{padding:</span> '<span class="hljs-attr">20px</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ccc</span>', <span class="hljs-attr">margin:</span> '<span class="hljs-attr">10px</span>'}}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{name} 视图<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前计数: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;加 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-comment">// 📦 另一个组件（逻辑相同）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">OtherCounter</span> = (<span class="hljs-params">{ name }</span>) =&gt; {
  <span class="hljs-comment">// ... 代码同上</span>
}
</code></pre>
<h3 data-id="heading-2">1.2 残酷的现实：切换即销毁</h3>
<p>接下来，我们在 <code>App</code> 中通过状态 <code>activeTab</code> 来控制显示哪一个组件。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/App.jsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [activeTab, setActiveTab] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'A'</span>); <span class="hljs-comment">// 控制当前显示 A 还是 B</span>
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{marginBottom:</span> '<span class="hljs-attr">20px</span>'}}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setActiveTab('A')}&gt;显示 A 组件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setActiveTab('B')}&gt;显示 B 组件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      {/* ⚠️ 传统写法：三元运算符条件渲染 */}
      {/* 当 activeTab 变了，之前的组件就会被彻底销毁！ */}
      { activeTab === 'A' ? <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"A"</span> /&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">OtherCounter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"B"</span> /&gt;</span> }
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>实验结果：</strong></p>
<ol>
<li>点击“显示 A 组件”，点击“加 1”把数字加到 5。</li>
<li>点击“显示 B 组件”。此时控制台打印 <code>❌ A 组件被卸载了...</code>，<code>✅ B 组件挂载了！</code>。</li>
<li><strong>关键时刻</strong>：再次点击“显示 A 组件”。控制台打印 <code>✅ A 组件挂载了！</code>，<strong>但是数字变回了 0！</strong> 😭</li>
</ol>
<p>这就是 React 的默认行为：<strong>条件渲染（Conditional Rendering）会导致组件树的卸载和重绘</strong>。</p>
<hr/>
<h2 data-id="heading-3">🧠 二、 拯救计划：KeepAlive 的核心原理</h2>
<p>既然 React 默认会卸载组件，那我们能不能**“骗”**过 React？</p>
<h3 data-id="heading-4">2.1 核心思路</h3>
<p>KeepAlive 的核心思想其实就两句话：</p>
<ol>
<li><strong>把所有组件都渲染出来</strong>：不要真的从 DOM 树上移除它们。</li>
<li><strong>用 CSS 控制显示隐藏</strong>：需要显示谁，就把谁设为 <code>display: block</code>；不需要显示的，设为 <code>display: none</code>。</li>
</ol>
<p>只要组件还在 DOM 树上（哪怕看不见），它的 State 就不会丢失，Effect 也不会触发卸载清理函数。这就叫**“视觉上的卸载，内存里的永生”**。</p>
<h3 data-id="heading-5">2.2 数据结构设计</h3>
<p>我们需要一个容器（缓存池）来存放所有曾经渲染过的组件。
可以使用一个对象（Object）作为缓存：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cache = {
  <span class="hljs-string">'A'</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"A"</span> /&gt;</span></span>, <span class="hljs-comment">// 缓存 A 组件的虚拟 DOM</span>
  <span class="hljs-string">'B'</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">OtherCounter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"B"</span> /&gt;</span></span> <span class="hljs-comment">// 缓存 B 组件的虚拟 DOM</span>
}
</code></pre>
<ul>
<li><strong>Key</strong>: 用一个唯一的 ID（比如 <code>activeId</code>）来标识组件。</li>
<li><strong>Value</strong>: 存储组件的 <code>children</code>（即 React 元素）。</li>
</ul>
<hr/>
<h2 data-id="heading-6">🛠 三、 手写实战：KeepAlive 组件</h2>
<p>接下来，我们创建 <code>src/components/KeepAlive.jsx</code>，来实现这个魔法容器。</p>
<h3 data-id="heading-7">3.1 定义 Props 和 State</h3>
<p>我们的 <code>KeepAlive</code> 组件需要接收两个 Props：</p>
<ul>
<li><code>activeId</code>: 当前应该显示哪个组件的 ID。</li>
<li><code>children</code>: 当前应该渲染的组件内容。</li>
</ul>
<p>同时，内部需要一个 <code>cache</code> 状态来保存所有“见过”的组件。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/components/KeepAlive.jsx</span>
<span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">KeepAlive</span> = (<span class="hljs-params">{ activeId, children }</span>) =&gt; {
    <span class="hljs-comment">// 🗄 缓存池：用来存所有渲染过的组件节点</span>
    <span class="hljs-comment">// 结构示例：{ 'A': &lt;Counter /&gt;, 'B': &lt;OtherCounter /&gt; }</span>
    <span class="hljs-keyword">const</span> [cache, setCache] = <span class="hljs-title function_">useState</span>({}); 

    <span class="hljs-comment">// ... 逻辑待补充</span>
}
</code></pre>
<h3 data-id="heading-8">3.2 缓存逻辑：只增不减</h3>
<p>我们需要监听 <code>activeId</code> 和 <code>children</code> 的变化。一旦有新的 <code>activeId</code> 进来，且缓存池里没有它，我们就把它存起来。</p>
<pre><code class="hljs language-jsx" lang="jsx">    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=&gt;</span> {
        <span class="hljs-comment">// 当 activeId 变化，说明用户切换了 Tab</span>
        <span class="hljs-comment">// 当 children 变化，说明组件内容更新了</span>
        
        <span class="hljs-comment">// 🔍 检查缓存池里是否已经有这个 ID 的组件了？</span>
        <span class="hljs-keyword">if</span>(!cache[activeId]) { 
            <span class="hljs-comment">// 💡 如果没有，说明是第一次遇到这个组件，赶紧存起来！</span>
            <span class="hljs-title function_">setCache</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> ({
                ...prev, <span class="hljs-comment">// 保留之前的缓存</span>
                [activeId]: children <span class="hljs-comment">// 把当前的 children 存入对应的 key</span>
            }))
        }
    }, [activeId, children, cache])
</code></pre>
<p><strong>⚠️ 注意：</strong> 这里我们利用了 React 的 <code>children</code> 属性。在 React 中，<code>children</code> 其实就是一个对象（虚拟 DOM），把它存进 State 里是完全合法的。</p>
<h3 data-id="heading-9">3.3 渲染逻辑：CSS 魔法</h3>
<p>最关键的一步来了！我们不能像 App 里那样写 <code>activeId === 'A' ? ... : ...</code>，因为那样会销毁组件。
我们要<strong>遍历整个缓存池</strong>，把所有缓存的组件都渲染出来，但只让当前激活的那个<strong>可见</strong>。</p>
<pre><code class="hljs language-jsx" lang="jsx">    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
          {
            // 🛠 Object.entries：把对象转成数组
            // cache = { A: <span class="hljs-tag">&lt;<span class="hljs-name">ComA</span>/&gt;</span>, B: <span class="hljs-tag">&lt;<span class="hljs-name">ComB</span>/&gt;</span> }
            // 转换后 = [ ['A', <span class="hljs-tag">&lt;<span class="hljs-name">ComA</span>/&gt;</span>], ['B', <span class="hljs-tag">&lt;<span class="hljs-name">ComB</span>/&gt;</span>] ]
            Object.entries(cache).map(([id, component]) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                  <span class="hljs-attr">key</span>=<span class="hljs-string">{id}</span> // 🔑 <span class="hljs-attr">别忘了加</span> <span class="hljs-attr">key</span>，<span class="hljs-attr">这是列表渲染的规矩</span>
                  // 🎨 <span class="hljs-attr">魔法时刻</span>：
                  // <span class="hljs-attr">如果</span> <span class="hljs-attr">id</span> <span class="hljs-attr">等于当前激活的</span> <span class="hljs-attr">id</span>，<span class="hljs-attr">就显示</span> (<span class="hljs-attr">block</span>)
                  // <span class="hljs-attr">否则</span>，<span class="hljs-attr">就隐藏</span> (<span class="hljs-attr">none</span>)，<span class="hljs-attr">但它依然在</span> <span class="hljs-attr">DOM</span> <span class="hljs-attr">树上</span>！
                  <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> <span class="hljs-attr">id</span> === <span class="hljs-string">activeId</span> ? '<span class="hljs-attr">block</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>' }}
                &gt;</span>
                    {component}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ))
          }
        <span class="hljs-tag">&lt;/&gt;</span></span>
    )
</code></pre>
<h3 data-id="heading-10">3.4 完整代码</h3>
<p>让我们把代码拼在一起，欣赏一下这个不到 40 行的精巧组件：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/components/KeepAlive.jsx</span>
<span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">KeepAlive</span> = (<span class="hljs-params">{ activeId, children }</span>) =&gt; {
    <span class="hljs-keyword">const</span> [cache, setCache] = <span class="hljs-title function_">useState</span>({});

    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span>(!cache[activeId]) {
            <span class="hljs-title function_">setCache</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> ({
                ...prev,
                [activeId]: children
            }))
        }
    }, [activeId, children, cache])

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
          {
            Object.entries(cache).map(([id, component]) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                  <span class="hljs-attr">key</span>=<span class="hljs-string">{id}</span>
                  <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> <span class="hljs-attr">id</span> === <span class="hljs-string">activeId</span> ? '<span class="hljs-attr">block</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>' }}
                &gt;</span>
                    {component}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ))
          }
        <span class="hljs-tag">&lt;/&gt;</span></span>
    )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">KeepAlive</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">🎉 四、 见证奇迹：接入 KeepAlive</h2>
<p>现在回到 <code>src/App.jsx</code>，用我们刚写好的 <code>KeepAlive</code> 替换掉原来的条件渲染。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/App.jsx</span>

<span class="hljs-comment">// ... 引入 KeepAlive</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [activeTab, setActiveTab] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'A'</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* 按钮部分省略... */}

      {/* ✨ 使用 KeepAlive 包裹 */}
      {/* activeId 告诉组件现在该显示谁 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">KeepAlive</span> <span class="hljs-attr">activeId</span>=<span class="hljs-string">{activeTab}</span>&gt;</span>
        {/* children 依然根据条件传入当前需要的组件 */}
        { activeTab === 'A' ? <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"A"</span> /&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">OtherCounter</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"B"</span> /&gt;</span> }
      <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
      
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p><strong>再次实验：</strong></p>
<ol>
<li>点击“显示 A 组件”，计数加到 5。</li>
<li>点击“显示 B 组件”。<strong>注意控制台！</strong>
<ul>
<li>❌ <strong>没有打印</strong> <code>A 组件被卸载了</code>！</li>
<li>✅ 打印了 <code>B 组件挂载了</code>。</li>
</ul>
</li>
<li>再次点击“显示 A 组件”。
<ul>
<li>❌ <strong>没有打印</strong> <code>A 组件挂载了</code>（因为它一直都在）。</li>
<li>✅ <strong>屏幕上的数字依然是 5！</strong></li>
</ul>
</li>
</ol>
<p>成功了！🎊 我们成功实现了组件的状态保持！</p>
<hr/>
<h2 data-id="heading-12">🧐 五、 总结与思考</h2>
<p>通过今天的手写实战，我们深入理解了 React 组件缓存的核心奥义：</p>
<ol>
<li><strong>React 的“无情”</strong>：默认的条件渲染会彻底销毁组件，导致状态丢失。</li>
<li><strong>CSS 的“温柔”</strong>：利用 <code>display: none</code> 可以让组件在视觉上消失，但在 DOM 树和 React 虚拟 DOM 树中依然存活，从而保留状态。</li>
<li><strong>数据的“分身”</strong>：我们用一个 <code>cache</code> 对象，把组件的虚拟 DOM 节点（children）存了起来，并通过 <code>Object.entries</code> 遍历渲染。</li>
</ol>
<p>当然，这个简易版的 <code>KeepAlive</code> 还有很多可以优化的地方：</p>
<ul>
<li>比如现在会缓存所有组件，如果组件太多，内存占用会变大，是不是可以加一个 LRU 算法来限制缓存数量？</li>
<li>比如怎么处理组件真的需要卸载的情况？</li>
</ul>
<p>但作为一个原理验证，它已经完美展示了 <strong>KeepAlive</strong> 的核心魔法。以后面试官再问你“React 怎么实现 KeepAlive”，你就可以自信地甩出这段代码了！😎</p>
<p>快去你的项目里试试吧！别忘了点赞收藏哦！💖</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[美团在 GitHub 上悄悄开源 AI 大模型？8 个大脑并行]]></title>    <link>https://juejin.cn/post/7599924721005953087</link>    <guid>https://juejin.cn/post/7599924721005953087</guid>    <pubDate>2026-01-28T01:49:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599924721005953087" data-draft-id="7599929684021231635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="美团在 GitHub 上悄悄开源 AI 大模型？8 个大脑并行"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-28T01:49:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            美团在 GitHub 上悄悄开源 AI 大模型？8 个大脑并行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T01:49:42.000Z" title="Wed Jan 28 2026 01:49:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026 年，可能是<strong>会自己深思熟虑的智能体模型正式登场</strong>的一年。</p>
<p>美团 LongCat 团队刚刚开源的 <strong>LongCat-Flash-Thinking-2601</strong>，就是这一波浪潮中的标志性模型。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d4f60e9503449169b2acfcb8d699088~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=U%2BmKkSLm63qEHJ2YCg2SqlY04Dw%3D" alt="图片" loading="lazy"/></p>
<p>它不仅是一个大模型，更是一个为智能体 Agent 时代量身打造的<strong>大型推理模型（Large Reasoning Model, LRM）</strong> ，号称全球首个完整开源、可在线体验的「重思考」模型。</p>
<p>在工具调用、智能搜索、交互式推理等一系列评测中都冲上了开源 SOTA。</p>
<p>01</p>
<p><strong>开源模型简介</strong></p>
<p>2026 年 1 月 15 日，美团正式发布了 LongCat-Flash-Thinking-2601，开源可用，可在线体验：</p>
<ul>
<li>参数规模：5600 亿，采用 MoE 混合专家架构</li>
<li>定位：高性能、高效率的大型推理模型</li>
<li>核心方向：Agent 能力 + 深度思考能力</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adb7d289777f48888c71cf27802454e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=1X9xMEKuRqQhTpOu5u1MS0sBp%2BU%3D" alt="图片" loading="lazy"/></p>
<p>它不是单纯为了更会聊天，而是为了在以下这种任务里表现更好：</p>
<ul>
<li>多工具协同的复杂任务</li>
<li>需要多步推理、反复权衡的高难问题</li>
<li>在信息不完美、环境有噪声的真实场景下，依然保持稳定决策</li>
</ul>
<p>可以理解为：以前的大模型更像聪明学生，LongCat-Flash-Thinking-2601 则在努力变成靠谱专家。</p>
<p>看下面这个图，不仅在智能体工具调用、智能体搜索、工具集成推理等核心任务的基准测试中斩获顶尖成绩，还在任意分布外的真实智能体场景中，实现了泛化能力的显著提升。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d74e9a0c13f9414fb39c66b06a86f4f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=NRAtSoksGdLI5FsCSiWeKi4uHyA%3D" alt="图片" loading="lazy"/></p>
<p>从训练开始就把它当 Agent 的大脑来打造：</p>
<p>美团构建了包含每个环境 60+ 工具的高质量环境集合，工具之间形成复杂依赖图，用来训练模型在真实工具网络里操作世界。</p>
<p>任务不是简单问答，而是从环境图中抽取连通子图，要求模型合理规划调用多种工具，解决复杂任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54976edf1e724914a3f4edbacfe4fcf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=U9sYkp%2B%2FvmmZFMhk6zS78NObw1U%3D" alt="图片" loading="lazy"/></p>
<p>通过大规模、多环境的强化学习，结合异步 rollouts 与 DORA 训练框架，模型在不同环境之间迁移和泛化的能力显著提升。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee9f674bd7e345d0a175736b7a7a27a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=9EzwtbnR2EQfjeOFii24qhSJ6dA%3D" alt="图片" loading="lazy"/></p>
<p>这背后的目标很直接：</p>
<p>让模型在新工具、新场景面前依然能快速上手，降低企业在真实业务中适配新工具的成本。</p>
<p>02</p>
<p><strong>重思考模式</strong></p>
<p>LongCat-Flash-Thinking-2601 最大的卖点就是重思考模式（Heavy Thinking Mode）。</p>
<p>你可以把它理解成 AI 版多轮头脑风暴 + 复盘总结。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4f0c8606aec445199e113062d20a882~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=mnvxgbtBwzF7ZRxVk2ujugLTUZk%3D" alt="图片" loading="lazy"/></p>
<p>① 并行思考阶段：</p>
<p>模型同时启动多条推理路径，8 个大脑并行思考，就像 8 个不同风格的高手在同一时间各想各的方案。</p>
<p>这些路径刻意保持思路多样性，避免所有推理都走一条思维惯性路线。</p>
<p>② 总结归纳阶段：</p>
<p>模型会对这些路径进行梳理、对比、筛选与合成，提炼出更优的解法；</p>
<p>优化过的结果再被重新输入模型进行迭代推理，形成一个封闭的深度思考循环。</p>
<p>③ 额外强化学习训练：</p>
<p>LongCat 团队专门为这一模式设计了额外的强化学习环节，重点训练模型的总结与归纳能力。</p>
<p>简单说：普通模式是想一遍、给答案，重思考模式是多路并行想、来回复盘想清楚再回答。</p>
<p>03</p>
<p><strong>试一下</strong></p>
<p>比如我输入：</p>
<p>某基金在 2024–2026 连续三年收益率分别为 +20%、-10%、+15%。</p>
<p>请计算这三年的总收益率（不是简单相加），并解释为什么不能直接把百分比相加。最后，用生活中一个直观的类比帮助非理工科读者理解这个结论。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3848d54f40b847ed8c75223f27685d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=AOgb7WhS6yx8HlkaD1IdjAk4LlQ%3D" alt="image.png" loading="lazy"/></p>
<p>下方链接视频可查看案例，可以看到，LongCat-Flash-Thinking-2601 会分析 8 个 Thinker 对同一个Query的回答，然后给出一个最终的、最佳的回复。</p>
<p>再比如：</p>
<p>组织一个商务局，有上级领导、上上级领导、上上上级领导、有客户、有内向的技术大牛，你是产品经理，老板让你排座位 &amp; 主持一下，你要怎么排座位？支持怎么聊？</p>
<p>看下 LongCat 的回答，还挺有意思的。尤其是怎么坐：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25422e8ffa4049b1875b50c6cf9dde14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=GNnTw7vIVHxLUFkE8n%2FMKFPZqjU%3D" alt="image.png" loading="lazy"/></p>
<p>还有一个：</p>
<p>我是一名体制内/国企的新人。我的直属科长让我把一份文件重点突出A数据，但分管副局长（科长的上级）私下暗示我他对A数据不感兴趣，想重点看B数据。明天就要汇报，我该怎么写这份报告？请给出具体的处理思路，并模拟一段我向科长汇报时的高情商话术。先来看看这个 8 个 Thinker 每个给出的要点：有的说不要擅自作主、自作聪明，有的说要用学习态度和执行意识保护自己，还有的说要把对抗性选择转化为建设性补充。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddf11b82ca4e4d2ca7d9efb3736f6a43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=sl1gBKVX%2FR2TyTohRGOF%2FFz4Ty0%3D" alt="图片" loading="lazy"/></p>
<p>下面是 LongCat 最终生成的一个内容，集众家之所长：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cd2df6a38b840fcbc8322b7a503e4a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=6SdntSaWLwxqWcdOTv%2FAXXqX9wo%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bce287bd913430f9a4addedc0bda47c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=VUCfUq3Ogd%2FwggH7JwdBGwugKp4%3D" alt="图片" loading="lazy"/></p>
<p>可能在这种人情世故的场景上，多想想总有靠谱的解法。。。</p>
<p>比如 LongCat 的回复就是在不越级的前提下，平衡两方需求。</p>
<p>再来看下一个例子：</p>
<p>请估算一下，如果要把太平洋的水全部换成珍珠奶茶，需要多少只奶牛产奶？请列出所有的假设数据（如太平洋体积、奶茶配比、奶牛产量等）并一步步计算。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a3e22a68381459fa80661ac44314b7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=WGHmrq61wQyBXlCYsqObqVEGlW0%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到 LongCat 自己算完一遍，还得看看自己算的和 8 个 Thinker 的为啥不一样。比如它认为有 4 个 Thinker 回答的是合理的，但是有几个回答不合理，具体误差可能出在哪里，他也会分析一下。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b92866aaec93443b8517461f61d580c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169785&amp;x-signature=2kCUep%2FR%2FkeMHzHgQgmBAL6zxr0%3D" alt="图片" loading="lazy"/></p>
<p>03</p>
<p><strong>快来体验</strong></p>
<p>目前 LongCat-Flash-Thinking-2601 模型已经在 HuggingFace 和 GitHub 上开源。你也可以直接访问 longcat.chat 使用：</p>
<pre><code class="hljs language-bash" lang="bash">GitHub：https://github.com/meituan-longcat/LongCat-Flash-Thinking-2601HuggingFace：https://huggingface.co/meituan-longcat/LongCat-Flash-Thinking-2601体验链接：https://longcat.chat/技术报告：https://github.com/meituan-longcat/LongCat-Flash-Thinking-2601/blob/main/LongCat_Flash_Thinking_2601_Technical_Report.pdf
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[字节码Javassist如何给反射加速]]></title>    <link>https://juejin.cn/post/7599922362998407214</link>    <guid>https://juejin.cn/post/7599922362998407214</guid>    <pubDate>2026-01-28T01:52:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599922362998407214" data-draft-id="7599917711793569802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="字节码Javassist如何给反射加速"/> <meta itemprop="keywords" content="后端,Java,程序员"/> <meta itemprop="datePublished" content="2026-01-28T01:52:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SimonKing"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056904584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            字节码Javassist如何给反射加速
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056904584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SimonKing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T01:52:58.000Z" title="Wed Jan 28 2026 01:52:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>关注我的公众号：【编程朝花夕拾】，可获取首发内容。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/299a48306e4748398e6510a8f45da9f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169978&amp;x-signature=n1lGbJmKHPt3r0CLl6B7aic%2FOfs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">01 引言</h2>
<p>在业务项目中经常会看到<code>Javassist</code>的依赖，框架升级<code>Javassist</code>也得跟着升，否则启动不起来。</p>
<p>很多微服务框架底层必然使用了反射技术，而为了提高性能，就是使用<code>Javassist</code>提速的。但是这个<code>Javassist</code>到时是什么呢？既然比反射的性能好，为什么不直接弃用反射，直接使用<code>Javassist</code>呢？带着这些疑问，特意学习了相关技术，如有问题还请包涵。</p>
<h2 data-id="heading-1">02 场景</h2>
<p>比如使用<code>JDBC</code>查出<code>ResultSet</code>这样的结果集，我们需要将结果封装到一个<code>JavaBean</code>中，而这个<code>JavaBean</code>只有类名，我们将如何处理呢。因为只有类名，我们无法直接实例化，第一印象想到的就是反射。</p>
<h3 data-id="heading-2">2.1 JavaBean</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> {

    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>{
		 System.out.println(<span class="hljs-string">"test方法执行....name="</span> + name);
    }
}
</code></pre>
<p>我们假设从数据库取出<code>name</code>值，最后调用<code>test()</code>方法，将<code>name</code>打印出来。</p>
<h3 data-id="heading-3">2.2 反射案例</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">test01</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-type">StopWatch</span> <span class="hljs-variable">stopWatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>();
    stopWatch.start();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
        invokeTest(i, UserInfo.class);
    }

    stopWatch.stop();
    System.out.println(<span class="hljs-string">"耗时："</span> + stopWatch.getTotalTimeMillis() + <span class="hljs-string">"ms"</span>);
}
</code></pre>
<p>为了对比反射和提速的效果，我们将数据量设为<code>1000000</code>。</p>
<p>反射的方法比较简单：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invokeTest</span><span class="hljs-params">(Integer index, Class&lt;?&gt; clazz)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> clazz.getDeclaredConstructor().newInstance();

    <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> clazz.getDeclaredField(<span class="hljs-string">"name"</span>);
    field.setAccessible(<span class="hljs-literal">true</span>);
    field.set(o, <span class="hljs-string">"test"</span> + index);

    <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">"test"</span>);
    method.invoke(o);
}
</code></pre>
<p>直接实例化后，赋值打印即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4832038f7384a6db13536ba63ee5030~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169978&amp;x-signature=aL%2FjaiGHIjjzj6nhIMB93JS%2BrRA%3D" alt="" loading="lazy"/></p>
<p>100W的数据耗时：14s</p>
<h2 data-id="heading-4">03 Javassist加速</h2>
<p><code>javassist</code>依赖有很多，注意甄别。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab132b7639546bc9ddeec145d942a90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169978&amp;x-signature=DdyQgHZefmcVougYpNIKZbuVEpI%3D" alt="" loading="lazy"/></p>
<p>我们项目使用的是第一个：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.javassist<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javassist<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.30.2-GA<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>反射的性能不好，所以通过反射调用方法就会比较耗时。那我们就利用<code>javassist</code>的特性，直接通过<code>new</code>的方法实例化后调用方法就会变快了。</p>
<h3 data-id="heading-5">3.1 构建代理类</h3>
<p>构建代理类之前，我们需要创建代理类的父类，用来接收代理类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeanProxy</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(Integer index)</span>;
}
</code></pre>
<p>创建实际的代理类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> BeanProxy <span class="hljs-title function_">getBeanProxy</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> <span class="hljs-keyword">throws</span> Exception {

    <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();
    
    <span class="hljs-comment">// 创建代理类</span>
    <span class="hljs-type">CtClass</span> <span class="hljs-variable">ccProxy</span> <span class="hljs-operator">=</span> pool.makeClass(clazz.getName() + <span class="hljs-string">"Proxy"</span>, pool.makeClass(BeanProxy.class.getName()));

    <span class="hljs-comment">// 创建默认构造器</span>
    <span class="hljs-type">CtConstructor</span> <span class="hljs-variable">ctConstructor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtConstructor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CtClass</span>[<span class="hljs-number">0</span>], ccProxy);
    ctConstructor.setBody(<span class="hljs-string">"{}"</span>);
    ccProxy.addConstructor(ctConstructor);

    <span class="hljs-comment">// 调用目标类的方法</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">methodStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
            public void invoke(Integer index){
                %s userInfo = new %s();
                userInfo.setName(\"%s\" + index);
                userInfo.test();
            }
            """</span>;
    methodStr = String.format(methodStr, clazz.getName(), clazz.getName(), <span class="hljs-string">"test"</span>);
    <span class="hljs-type">CtMethod</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> CtNewMethod.make(methodStr, ccProxy);
    <span class="hljs-comment">// 添加代理方法</span>
    ccProxy.addMethod(method);

    <span class="hljs-comment">// 返回代理对象                            </span>
    <span class="hljs-keyword">return</span> (BeanProxy)ccProxy.toClass().getDeclaredConstructor().newInstance();
}
</code></pre>
<h3 data-id="heading-6">3.2 重点说明</h3>
<p>实际的代理类动态状态分别包含了两部分：</p>
<ul>
<li>构造器：必须要有，没有就会报错</li>
<li>方法：目标方法</li>
</ul>
<p>在目标方法中，使用了<code>new</code>的方式，来构建<code>JavaBean</code>，较少了反射带来的损耗。最后通过反射返回代理类，后续的调用就是正常的<code>Java</code>调用了。简单来说，就是反射只用了一次。</p>
<h3 data-id="heading-7">3.3 效果</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1e8fc23840e4bef8830a65e4bbfefc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169978&amp;x-signature=TBeZEvuaM5lAHjyIUoe2nx3ucRc%3D" alt="" loading="lazy"/></p>
<p><code>100W</code>的数据，实例化只用了<code>5s</code>左右。提速只是<code>Javassist</code>的冰山一角，还可以对原有的类增强。</p>
<h2 data-id="heading-8">04 Javassist</h2>
<h3 data-id="heading-9">4.1 简介</h3>
<p><code>Javassist</code>是一个可以在运行时动态修改Java字节码的库。它允许程序在运行时生成、修改或分析Java类，而不需要直接操作复杂的字节码指令。</p>
<p>Javassist的核心类：</p>
<ul>
<li><code>ClassPool</code>：一个CtClass对象的容器，用于管理类。可以从ClassPool中获取CtClass对象。</li>
<li><code>CtClass</code>：表示一个类，可以通过它来修改类。</li>
<li><code>CtMethod</code>：表示类中的方法，可以修改方法体。</li>
<li><code>CtField</code>：表示类中的字段。</li>
<li><code>CtConstructor</code>：表示构造函数。</li>
</ul>
<h3 data-id="heading-10">4.2 字节码增强</h3>
<p>案例中的<code>UserInfo</code>有一个<code>test</code>方法，我们需要在方法执行券后，分别增强。</p>
<pre><code class="hljs language-java" lang="java"> <span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">test04</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();
    <span class="hljs-type">CtClass</span> <span class="hljs-variable">cc</span> <span class="hljs-operator">=</span> pool.get(<span class="hljs-string">"com.simonking.boot.tx.pojo.UserInfo"</span>);
    <span class="hljs-type">CtMethod</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> cc.getDeclaredMethod(<span class="hljs-string">"test"</span>);

    m.insertBefore(<span class="hljs-string">"""
             { 
                System.out.println(\"Before test\");
             }
            """</span>);
    m.insertAfter(<span class="hljs-string">"""
             { 
                System.out.println(\"after test\");
             }
            """</span>);
    <span class="hljs-type">UserInfo</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> (UserInfo)cc.toClass().getDeclaredConstructor().newInstance();
    u.test();
}
}
</code></pre>
<p>执行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d233b6d3b4784ecd92e8d275d090ea92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169978&amp;x-signature=EH3rJqbPtZ3aGnJTbLLJkUxL97Y%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">4.3 热修复</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">test05</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();
    <span class="hljs-type">CtClass</span> <span class="hljs-variable">cc</span> <span class="hljs-operator">=</span> pool.get(<span class="hljs-string">"com.simonking.boot.tx.pojo.UserInfo"</span>);
    <span class="hljs-type">CtMethod</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> cc.getDeclaredMethod(<span class="hljs-string">"test"</span>);
    m.setBody(<span class="hljs-string">"""
            {
                System.out.println(\"test方法异常被修复了....\");
            }
            """</span>);

    <span class="hljs-type">UserInfo</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> (UserInfo)cc.toClass().getDeclaredConstructor().newInstance();
    u.test();
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28dd39136c5a498da4053174ad3ca3f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169978&amp;x-signature=CSss6%2BjXQLL%2B43P1Y%2BXImIBPVz0%3D" alt="" loading="lazy"/></p>
<p>我们可以看到这里直接修改原来的方法。</p>
<h2 data-id="heading-12">05 小结</h2>
<p><code>Javassist</code>的适用场景远不止这些，后面发现有趣的场景，再继续分享。在测试过程中发现有两个问题记录一下。</p>
<h3 data-id="heading-13">5.1 问题1</h3>
<p><code>Javassist</code>针对已经存在的属性赋值时，如果是包装类可能存在异常：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dad6713b8e14997854cada8e59126ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169978&amp;x-signature=bWnQZR2Wj3RcxnBETM21sUG4OWA%3D" alt="" loading="lazy"/></p>
<p>因为类的属性是<code>Integer</code>类型，导致无法赋值。改为基础数据类型后正常了。</p>
<h3 data-id="heading-14">5.2 问题2</h3>
<p><code>Java17</code>编译的时候，会出现问题：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d9e5a71e244432ca2de6db540eabb6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2ltb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770169978&amp;x-signature=yzjZh1Tlo3UuNrVtORAIL3vcMUo%3D" alt="" loading="lazy"/></p>
<p>启动参数增加配置可以解决：</p>
<pre><code class="hljs language-sh" lang="sh">--add-opens java.base/java.lang=ALL-UNNAMED
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今日，DeepSeek再次“拆掉重做”，开源架构炸场：OCR 2只是起点，这次要重构AI的“眼睛”和“大脑”？]]></title>    <link>https://juejin.cn/post/7599899147418566708</link>    <guid>https://juejin.cn/post/7599899147418566708</guid>    <pubDate>2026-01-28T01:54:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599899147418566708" data-draft-id="7599910677579120640" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今日，DeepSeek再次“拆掉重做”，开源架构炸场：OCR 2只是起点，这次要重构AI的“眼睛”和“大脑”？"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2026-01-28T01:54:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今日，DeepSeek再次“拆掉重做”，开源架构炸场：OCR 2只是起点，这次要重构AI的“眼睛”和“大脑”？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T01:54:39.000Z" title="Wed Jan 28 2026 01:54:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>就在今年十月，DeepSeek 放出其全新的 DeepSeek-OCR 模型时，业内还在消化它在文档解析上带来的震动。没想到，短短时间，他们又抛出了一篇重磅论文——<strong>DeepSeek-OCR 2</strong>。而这次，团队直接对视觉编码的“心脏”动了手术。</p>
<h2 data-id="heading-0"><strong>视觉编码，困在“固定扫描”里太久了</strong></h2>
<p>不知道你有没有想过，AI 看一张图，和我们的“看”究竟差在哪？现有的视觉语言模型，大多遵循一种近乎刻板的流程：把图像切割成小块，然后强制按“从左到右、从上到下”的网格顺序排列，打上固定的位置编码，再塞给语言模型去理解。</p>
<p>这像不像在要求一个人读书时，眼睛必须机械地逐行扫描，不准跳标题、不准瞥图表、不准回头看注释？可我们真实的阅读，视线明明是跟着语义走的——先被醒目的标题吸引，再顺着图表趋势找到关键数据，最后才可能扫一眼边角的注释说明。这种灵活、有逻辑的 <strong>“视觉因果流”</strong> ，恰恰是过去模型缺失的。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e93a437780134ede8df71a4776367de8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770170079&amp;x-signature=1w8BNsAidfROLfK1R9csrXpyHmo%3D" alt="screenshot_2026-01-27_16-10-45.png" loading="lazy"/></p>
<p>DeepSeek-OCR 2 的破局点，在图1里显得颇为直观：他们干脆<strong>扔掉了传统的 CLIP 视觉编码器</strong>，转而采用了一种<strong>类似大语言模型（LLM）的架构</strong>。关键在于那个<strong>定制的注意力掩码</strong>，它让视觉编码过程突然“活”了过来，有了动态推理的可能。</p>
<h2 data-id="heading-1"><strong>让编码器学会“有逻辑地看”</strong></h2>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dc8955ded64422094f4fd49a1a05d04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770170079&amp;x-signature=Wc0YNo00P%2BTMcTn8y8haq06nl4I%3D" alt="screenshot_2026-01-27_16-12-51.png" loading="lazy"/></p>
<p>团队将这个新核心称为 DeepEncoder V2。它的设计目标很明确：<strong>把视觉编码从“固定扫描”变成“语义推理”。</strong> 怎么做到的？靠的是几个环环相扣的巧思。</p>
<p>首先，<strong>用紧凑的 LLM 风格架构替换 CLIP</strong>，等于是为视觉模块注入了语言模型擅长的因果推理能力。接着，他们设计了一套<strong>混合注意力机制</strong>：视觉标记本身保留双向注意力，以维持对图像全局的感知；同时，引入一组全新的 <strong>“因果流查询标记”</strong> ，这些标记之间采用<strong>严格的因果注意力</strong>。这就好比一边感知整幅画面的存在，一边让一条独立的“思维线”按照逻辑顺序梳理重点。</p>
<p>更巧妙的是，视觉标记与因果查询标记一一对应，这为模拟人类的 <strong>“视觉回视”</strong> ——即回头看某个重点区域——留足了空间。最终，<strong>只有那些经过语义重排序的“因果查询标记”会被传递给后面的 LLM 解码器</strong>。换言之，模型后续理解的，已经是一个按意义重新排列过的视觉故事了。</p>
<p>这一设计灵感并非凭空而来。图2展示了相关工作中的两种“并行化查询”范式，它们启发了DeepSeek团队。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e036498f2e5240c188996460c08ebaf3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770170079&amp;x-signature=52ahcdS24kzvmTokN9Z1xEfOZ9c%3D" alt="screenshot_2026-01-27_16-37-54.png" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>两级推理，拆解二维理解的难题</strong></h2>
<p>如果你细看，会发现 DeepSeek-OCR 2 实际上构建了一个<strong>两级因果推理的管道</strong>。第一级在编码器内部，通过可学习的查询标记对视觉信息进行初次重排序；第二级则在 LLM 解码器中，对这个排好序的序列进行自回归的深度推理。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/157ea9b2ae2548cf876f07df1db29461~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770170079&amp;x-signature=8ewW12ipcQX5Cy7FgNeh14YVGps%3D" alt="screenshot_2026-01-27_16-19-57.png" loading="lazy"/></p>
<p>这招其实很聪明。直接将二维空间关系建模透彻非常困难，但他们把问题分解了：<strong>先通过一级推理将二维布局转化为一个合乎语义的一维序列，再交给语言模型做它最擅长的序列推理。</strong> 这或许算不上终极答案，但无疑是通向真正二维视觉理解的一条切实、新颖的路径。</p>
<h2 data-id="heading-3"><strong>效果如何？数据自己会说话</strong></h2>
<p>在权威的文档解析基准 OmniDocBench v1.5 上，DeepSeek-OCR 2 交出的成绩单相当亮眼：<strong>整体性能 91.09%，比前代提升了 3.73 个百分点。</strong> 更值得玩味的是，它达成这个效果所用的<strong>视觉标记上限仅有 1120 个</strong>，是同类模型里最“节俭”的。</p>
<p>衡量语义排序能力的 <strong>“阅读顺序编辑距离”指标，从 0.085 显著降到了 0.057</strong>。这说明，模型输出的文本顺序，确实更贴近人类理解的逻辑了。在实际应用中，这种进步直接体现为重复率的下降——<strong>处理在线用户日志图像时，重复率从 6.25% 降到了 4.17%；处理 PDF 数据时，也从 3.69% 降至 2.88%</strong> 。看来，逻辑理解能力强了，那种机械重复的废话自然就少了。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26ef66e385324e2fbc6439e0b0bbc6e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770170079&amp;x-signature=vECQaoBICOPKy%2Beq81SEy3zs5fw%3D" alt="screenshot_2026-01-27_16-13-19.png" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>不止于文档：一个统一编码器的野望</strong></h2>
<p>在我看来，DeepEncoder V2 的潜力恐怕不止于解读文档。论文里已经隐约指出了更大的图景：<strong>它有望演变成一个统一的全模态编码器。</strong></p>
<p>想象一下，同一个编码器骨干，通过共享的注意力机制和前馈网络，配合上针对不同模态（文本、语音、图像、视频）训练的可学习查询嵌入，就能处理各式各样的信息。这为构建 <strong>“一个模型，通吃所有模态”的基础模型</strong>，提供了一种新鲜的架构思路。多模态融合或许不必再那么“拼凑”，而是在底层就能实现更统一的语义理解。</p>
<h2 data-id="heading-5"><strong>这会为机器人装上“会思考的眼睛”吗？</strong></h2>
<p>DeepSeek-OCR 2 所强调的 <strong>“视觉因果流”</strong> ，本质上是在模仿人类视觉感知中的因果机制。这个方向一旦走通，或许会悄然改变另一个领域——具身智能，也就是机器人。</p>
<p>现在的机器人视觉，多数还是“扫描-识别”的被动模式，缺少对场景的因果推断和基于语义的注意力分配。如果能把 DeepEncoder V2 这种因果推理能力嵌入机器人的视觉系统，会发生什么？</p>
<p>环境理解可能从静态的“是什么”转向动态的“为什么和接下来怎样”；机器人的“视线”能够像人一样，根据任务逻辑主动聚焦关键区域，而不是平均用力地扫描全场；视觉信息与语言指令、动作规划，也有望在同一个因果推理框架下无缝协调。到那时，<strong>机器人的“眼睛”或许就不再只是传感器，而是一个初具推理能力的“感知器官”了。</strong></p>
<p><strong>一些耐人寻味的细节</strong></p>
<p>技术论文里总藏着一些体现工程智慧的细节。比如，DeepSeek-OCR 2 采用了<strong>多裁剪策略</strong>：用 1024×1024 的分辨率处理全局视图，对应 256 个查询嵌入；用 768×768 的分辨率分析局部细节，共享 144 个查询嵌入。这显然是在计算效率和细粒度感知之间做的精明权衡。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a27247236c384609822dfa4626a033ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770170079&amp;x-signature=VKgKjBZFGbBvHZxQTnNqC7B14ik%3D" alt="screenshot_2026-01-27_16-13-38.png" loading="lazy"/></p>
<p>作者们也坦诚，若要完全实现人类那种多次复查、多跳式的重排序能力，可能需要比原始视觉标记长得多的因果流标记序列。这无疑意味着，目前的架构依然<strong>留白了巨大的优化与探索空间。</strong></p>
<h2 data-id="heading-6"><strong>结语</strong></h2>
<p>从机械的固定扫描，到灵活的语义推理，DeepSeek-OCR 2 带来的不仅仅是几个百分点的性能提升。它更像是一次视觉编码范式上的“松动”。当 AI 开始尝试“有逻辑地看”世界时，我们距离那种真正理解眼前一切的视觉智能，似乎又近了一小步——而这一小步，往往也是最难的那一步。</p>
<blockquote>
<p><strong>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-OCR-2" target="_blank" title="https://github.com/deepseek-ai/DeepSeek-OCR-2" ref="nofollow noopener noreferrer">github.com/deepseek-ai…</a></strong></p>
<p><strong>论文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-OCR-2%2Fblob%2Fmain%2FDeepSeek_OCR2_paper.pdf" target="_blank" title="https://github.com/deepseek-ai/DeepSeek-OCR-2/blob/main/DeepSeek_OCR2_paper.pdf" ref="nofollow noopener noreferrer">github.com/deepseek-ai…</a></strong></p>
<p><strong>模型地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdeepseek-ai%2FDeepSeek-OCR-2" target="_blank" title="https://huggingface.co/deepseek-ai/DeepSeek-OCR-2" ref="nofollow noopener noreferrer">huggingface.co/deepseek-ai…</a></strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Unity3D中提升AssetBundle加载速度的详细指南]]></title>    <link>https://juejin.cn/post/7599917711793618954</link>    <guid>https://juejin.cn/post/7599917711793618954</guid>    <pubDate>2026-01-28T01:57:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599917711793618954" data-draft-id="7599920572841181193" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Unity3D中提升AssetBundle加载速度的详细指南"/> <meta itemprop="keywords" content="前端,后端,面试"/> <meta itemprop="datePublished" content="2026-01-28T01:57:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Thomas游戏开发"/> <meta itemprop="url" content="https://juejin.cn/user/3758599706256028"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Unity3D中提升AssetBundle加载速度的详细指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3758599706256028/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Thomas游戏开发
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T01:57:58.000Z" title="Wed Jan 28 2026 01:57:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<h2 data-id="heading-1">一、<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269581835%26content_type%3DArticle%26match_order%3D1%26q%3DAssetBundle%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269581835&amp;content_type=Article&amp;match_order=1&amp;q=AssetBundle&amp;zhida_source=entity" ref="nofollow noopener noreferrer">AssetBundle</a>优化策略概览</h2>
<h3 data-id="heading-2">1. <strong>打包阶段优化</strong></h3>
<pre><code class="hljs language-ini" lang="ini">// 1. 使用合适的压缩方式
// LZ4压缩 - 加载速度快，支持随机访问
BuildAssetBundleOptions <span class="hljs-attr">options</span> = BuildAssetBundleOptions.ChunkBasedCompression<span class="hljs-comment">;</span>

// LZMA - 压缩率高，但加载时需要完整解压
BuildAssetBundleOptions <span class="hljs-attr">options</span> = BuildAssetBundleOptions.None<span class="hljs-comment">;</span>

// 不压缩 - 加载最快，但包体积最大
BuildAssetBundleOptions <span class="hljs-attr">options</span> = BuildAssetBundleOptions.UncompressedAssetBundle<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-3">2. <strong>资源分类打包策略</strong></h3>
<ul>
<li><strong>按场景打包</strong>：每个场景独立打包</li>
<li><strong>按功能模块打包</strong>：UI、角色、特效等分开</li>
<li><strong>按使用频率打包</strong>：常用资源单独打包</li>
<li><strong>按更新频率打包</strong>：经常更新的资源独立打包</li>
</ul>
<h2 data-id="heading-4">二、加载流程优化</h2>
<h3 data-id="heading-5">1. <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269581835%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25BC%2582%25E6%25AD%25A5%25E5%258A%25A0%25E8%25BD%25BD%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269581835&amp;content_type=Article&amp;match_order=1&amp;q=%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD&amp;zhida_source=entity" ref="nofollow noopener noreferrer">异步加载</a>代替同步加载</strong></h3>
<pre><code class="hljs language-ini" lang="ini">// 异步加载AssetBundle
IEnumerator LoadAssetBundleAsync(string path)
{
    var <span class="hljs-attr">bundleLoadRequest</span> = AssetBundle.LoadFromFileAsync(path)<span class="hljs-comment">;</span>
    yield return bundleLoadRequest<span class="hljs-comment">;</span>
    
    AssetBundle <span class="hljs-attr">bundle</span> = bundleLoadRequest.assetBundle<span class="hljs-comment">;</span>
    
    // 异步加载资源
    var <span class="hljs-attr">assetLoadRequest</span> = bundle.LoadAssetAsync&lt;GameObject&gt;(<span class="hljs-string">"PrefabName"</span>)<span class="hljs-comment">;</span>
    yield return assetLoadRequest<span class="hljs-comment">;</span>
    
    GameObject <span class="hljs-attr">prefab</span> = assetLoadRequest.asset as GameObject<span class="hljs-comment">;</span>
    Instantiate(prefab)<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>2. 预加载策略</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AssetBundlePreloader</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">private</span> Dictionary&lt;<span class="hljs-built_in">string</span>, AssetBundle&gt; loadedBundles = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, AssetBundle&gt;();
    
    <span class="hljs-comment">// 预加载常用AssetBundle</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerator <span class="hljs-title">PreloadBundles</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">string</span>&gt; bundlePaths</span>)</span>
    {
        <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> path <span class="hljs-keyword">in</span> bundlePaths)
        {
            <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">LoadAndCacheBundle</span>(<span class="hljs-params">path</span>)</span>;
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerator <span class="hljs-title">LoadAndCacheBundle</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path</span>)</span>
    {
        <span class="hljs-keyword">if</span>(loadedBundles.ContainsKey(path)) <span class="hljs-keyword">yield</span> <span class="hljs-keyword">break</span>;
        
        <span class="hljs-keyword">var</span> request = AssetBundle.LoadFromFileAsync(path);
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> request;
        
        loadedBundles[path] = request.assetBundle;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> AssetBundle <span class="hljs-title">GetCachedBundle</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path</span>)</span>
    {
        <span class="hljs-keyword">return</span> loadedBundles.ContainsKey(path) ? loadedBundles[path] : <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h2 data-id="heading-6">三、内存与缓存优化</h2>
<h3 data-id="heading-7">1. <strong>使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269581835%26content_type%3DArticle%26match_order%3D1%26q%3DUnityWebRequest%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269581835&amp;content_type=Article&amp;match_order=1&amp;q=UnityWebRequest&amp;zhida_source=entity" ref="nofollow noopener noreferrer">UnityWebRequest</a> AssetBundle缓存</strong></h3>
<pre><code class="hljs language-ini" lang="ini">IEnumerator LoadWithCache(string url)
{
    using (UnityWebRequest <span class="hljs-attr">request</span> = UnityWebRequestAssetBundle.GetAssetBundle(url))
    {
        // 启用缓存版本控制
        <span class="hljs-attr">request.downloadHandler</span> = new DownloadHandlerAssetBundle(url, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
        
        yield return request.SendWebRequest()<span class="hljs-comment">;</span>
        
        if (<span class="hljs-attr">request.result</span> == UnityWebRequest.Result.Success)
        {
            AssetBundle <span class="hljs-attr">bundle</span> = DownloadHandlerAssetBundle.GetContent(request)<span class="hljs-comment">;</span>
            // 使用bundle...
        }
    }
}
</code></pre>
<p><strong>2. 智能缓存管理</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmartAssetBundleCache</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CacheEntry</span>
    {
        <span class="hljs-keyword">public</span> AssetBundle bundle;
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> lastUsedTime;
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> referenceCount;
    }
    
    <span class="hljs-keyword">private</span> Dictionary&lt;<span class="hljs-built_in">string</span>, CacheEntry&gt; cache = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, CacheEntry&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">float</span> maxCacheTime = <span class="hljs-number">300f</span>; <span class="hljs-comment">// 5分钟</span>
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> AssetBundle <span class="hljs-title">GetOrLoad</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path</span>)</span>
    {
        <span class="hljs-comment">// 清理过期缓存</span>
        CleanupExpiredCache();
        
        <span class="hljs-keyword">if</span> (cache.TryGetValue(path, <span class="hljs-keyword">out</span> CacheEntry entry))
        {
            entry.lastUsedTime = Time.time;
            entry.referenceCount++;
            <span class="hljs-keyword">return</span> entry.bundle;
        }
        
        <span class="hljs-comment">// 加载新Bundle</span>
        AssetBundle bundle = AssetBundle.LoadFromFile(path);
        cache[path] = <span class="hljs-keyword">new</span> CacheEntry
        {
            bundle = bundle,
            lastUsedTime = Time.time,
            referenceCount = <span class="hljs-number">1</span>
        };
        
        <span class="hljs-keyword">return</span> bundle;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CleanupExpiredCache</span>()</span>
    {
        List&lt;<span class="hljs-built_in">string</span>&gt; toRemove = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();
        
        <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> kvp <span class="hljs-keyword">in</span> cache)
        {
            <span class="hljs-keyword">if</span> (kvp.Value.referenceCount == <span class="hljs-number">0</span> &amp;&amp; 
                Time.time - kvp.Value.lastUsedTime &gt; maxCacheTime)
            {
                kvp.Value.bundle.Unload(<span class="hljs-literal">false</span>);
                toRemove.Add(kvp.Key);
            }
        }
        
        <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> toRemove) cache.Remove(key);
    }
}
</code></pre>
<h2 data-id="heading-8">四、依赖关系优化</h2>
<h3 data-id="heading-9">1. <strong>共享依赖包管理</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DependencyManager</span>
{
    <span class="hljs-keyword">private</span> AssetBundleManifest manifest;
    <span class="hljs-keyword">private</span> Dictionary&lt;<span class="hljs-built_in">string</span>, AssetBundle&gt; loadedDependencies = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, AssetBundle&gt;();
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerator <span class="hljs-title">LoadWithDependencies</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> bundleName</span>)</span>
    {
        <span class="hljs-comment">// 1. 加载主AssetBundle的依赖</span>
        <span class="hljs-built_in">string</span>[] dependencies = manifest.GetAllDependencies(bundleName);
        
        <span class="hljs-keyword">foreach</span>(<span class="hljs-built_in">string</span> dep <span class="hljs-keyword">in</span> dependencies)
        {
            <span class="hljs-keyword">if</span>(!loadedDependencies.ContainsKey(dep))
            {
                <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">LoadDependencyAsync</span>(<span class="hljs-params">dep</span>)</span>;
            }
        }
        
        <span class="hljs-comment">// 2. 加载主AssetBundle</span>
        <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">LoadMainBundleAsync</span>(<span class="hljs-params">bundleName</span>)</span>;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerator <span class="hljs-title">LoadDependencyAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> depName</span>)</span>
    {
        <span class="hljs-keyword">var</span> request = AssetBundle.LoadFromFileAsync(GetBundlePath(depName));
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> request;
        loadedDependencies[depName] = request.assetBundle;
    }
}
</code></pre>
<h2 data-id="heading-10">五、多线程与分帧加载</h2>
<h3 data-id="heading-11">1. <strong>分帧加载大资源</strong></h3>
<pre><code class="hljs language-ini" lang="ini">public class FrameDistributedLoader : MonoBehaviour
{
    private Queue&lt;LoadTask&gt; <span class="hljs-attr">loadQueue</span> = new Queue&lt;LoadTask&gt;()<span class="hljs-comment">;</span>
    private bool <span class="hljs-attr">isLoading</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    
    public void EnqueueLoadTask(string bundlePath, string assetName, Action&lt;GameObject&gt; callback)
    {
        loadQueue.Enqueue(new LoadTask
        {
            <span class="hljs-attr">bundlePath</span> = bundlePath,
            <span class="hljs-attr">assetName</span> = assetName,
            <span class="hljs-attr">callback</span> = callback
        })<span class="hljs-comment">;</span>
        
        if(!isLoading) StartCoroutine(ProcessLoadQueue())<span class="hljs-comment">;</span>
    }
    
    IEnumerator ProcessLoadQueue()
    {
        <span class="hljs-attr">isLoading</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
        
        while(loadQueue.Count &gt; 0)
        {
            LoadTask <span class="hljs-attr">task</span> = loadQueue.Dequeue()<span class="hljs-comment">;</span>
            
            // 每帧只加载一个资源，避免卡顿
            yield return LoadSingleAsset(task)<span class="hljs-comment">;</span>
            
            // 如果队列还很长，可以每帧处理多个
            if(loadQueue.Count &gt; 10)
            {
                // 可根据帧率动态调整加载数量
                int <span class="hljs-attr">itemsThisFrame</span> = Mathf.Min(loadQueue.Count, <span class="hljs-number">3</span>)<span class="hljs-comment">;</span>
                for(int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; itemsThisFrame; i++)</span>
                {
                    <span class="hljs-attr">task</span> = loadQueue.Dequeue()<span class="hljs-comment">;</span>
                    yield return LoadSingleAsset(task)<span class="hljs-comment">;</span>
                }
            }
        }
        
        <span class="hljs-attr">isLoading</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    }
}
</code></pre>
<h2 data-id="heading-12">六、压缩与解压优化</h2>
<h3 data-id="heading-13">1. <strong>后台解压技术</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System.Threading.Tasks;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BackgroundDecompressor</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;AssetBundle&gt; <span class="hljs-title">LoadBundleAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> path, <span class="hljs-built_in">bool</span> decompressInBackground = <span class="hljs-literal">true</span></span>)</span>
    {
        <span class="hljs-keyword">if</span> (decompressInBackground)
        {
            <span class="hljs-comment">// 在后台线程加载和解压</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> Task.Run(() =&gt; 
            {
                <span class="hljs-keyword">return</span> AssetBundle.LoadFromFile(path);
            });
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-comment">// 在主线程同步加载</span>
            <span class="hljs-keyword">return</span> AssetBundle.LoadFromFile(path);
        }
    }
}
</code></pre>
<h2 data-id="heading-14">七、性能监控工具</h2>
<h3 data-id="heading-15">1. <strong>自定义<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269581835%26content_type%3DArticle%26match_order%3D1%26q%3D%25E6%2580%25A7%25E8%2583%25BD%25E5%2588%2586%25E6%259E%2590%25E5%2599%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269581835&amp;content_type=Article&amp;match_order=1&amp;q=%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%99%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">性能分析器</a></strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AssetBundleProfiler</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">private</span> Dictionary&lt;<span class="hljs-built_in">string</span>, LoadRecord&gt; loadRecords = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, LoadRecord&gt;();
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RecordLoadStart</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> bundleName</span>)</span>
    {
        loadRecords[bundleName] = <span class="hljs-keyword">new</span> LoadRecord
        {
            startTime = Time.realtimeSinceStartup,
            bundleName = bundleName
        };
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RecordLoadEnd</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> bundleName</span>)</span>
    {
        <span class="hljs-keyword">if</span>(loadRecords.TryGetValue(bundleName, <span class="hljs-keyword">out</span> LoadRecord <span class="hljs-keyword">record</span>))
        {
            <span class="hljs-keyword">record</span>.endTime = Time.realtimeSinceStartup;
            <span class="hljs-keyword">record</span>.duration = <span class="hljs-keyword">record</span>.endTime - <span class="hljs-keyword">record</span>.startTime;
            
            Debug.Log(<span class="hljs-string">$"AssetBundle <span class="hljs-subst">{bundleName}</span> loaded in <span class="hljs-subst">{<span class="hljs-keyword">record</span>.duration:F3}</span>s"</span>);
            
            <span class="hljs-comment">// 可以记录到文件或发送到分析服务器</span>
            LogToAnalytics(<span class="hljs-keyword">record</span>);
        }
    }
    
    <span class="hljs-keyword">class</span> <span class="hljs-title">LoadRecord</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> bundleName;
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> startTime;
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> endTime;
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">float</span> duration;
    }
}
</code></pre>
<h2 data-id="heading-16">八、实战建议</h2>
<h3 data-id="heading-17">1. <strong>综合优化方案</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OptimizedAssetBundleLoader</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-comment">// 1. 使用对象池减少实例化开销</span>
    <span class="hljs-keyword">private</span> ObjectPool objectPool;
    
    <span class="hljs-comment">// 2. 使用引用计数管理资源生命周期</span>
    <span class="hljs-keyword">private</span> ReferenceCounter refCounter;
    
    <span class="hljs-comment">// 3. 实现优先级加载队列</span>
    <span class="hljs-keyword">private</span> PriorityLoadQueue priorityQueue;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerator <span class="hljs-title">LoadWithOptimizations</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> bundlePath, <span class="hljs-built_in">string</span> assetName, <span class="hljs-built_in">int</span> priority = <span class="hljs-number">0</span></span>)</span>
    {
        <span class="hljs-comment">// 根据优先级安排加载</span>
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> priorityQueue.Enqueue(priority, () =&gt; 
        {
            <span class="hljs-keyword">return</span> LoadAssetBundleWithDependencies(bundlePath, assetName);
        });
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> IEnumerator <span class="hljs-title">LoadAssetBundleWithDependencies</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> bundlePath, <span class="hljs-built_in">string</span> assetName</span>)</span>
    {
        <span class="hljs-comment">// 检查缓存</span>
        <span class="hljs-keyword">if</span>(TryGetFromCache(bundlePath, <span class="hljs-keyword">out</span> AssetBundle bundle))
        {
            <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">LoadAssetFromBundle</span>(<span class="hljs-params">bundle, assetName</span>)</span>;
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-comment">// 异步加载</span>
        <span class="hljs-keyword">var</span> loadRequest = AssetBundle.LoadFromFileAsync(bundlePath);
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> loadRequest;
        
        <span class="hljs-comment">// 记录性能</span>
        AssetBundleProfiler.Instance.RecordLoad(bundlePath, loadRequest);
        
        <span class="hljs-comment">// 缓存结果</span>
        CacheBundle(bundlePath, loadRequest.assetBundle);
        
        <span class="hljs-comment">// 异步加载资源</span>
        <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">LoadAssetFromBundle</span>(<span class="hljs-params">loadRequest.assetBundle, assetName</span>)</span>;
    }
}
</code></pre>
<h2 data-id="heading-18">九、平台特定优化</h2>
<h3 data-id="heading-19">1. <strong>不同<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269581835%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25B9%25B3%25E5%258F%25B0%25E7%25AD%2596%25E7%2595%25A5%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269581835&amp;content_type=Article&amp;match_order=1&amp;q=%E5%B9%B3%E5%8F%B0%E7%AD%96%E7%95%A5&amp;zhida_source=entity" ref="nofollow noopener noreferrer">平台策略</a></strong></h3>
<ul>
<li><strong>iOS/Android</strong>：优先使用LZ4压缩</li>
<li><strong>PC/主机</strong>：可考虑不压缩或LZMA</li>
<li><strong>WebGL</strong>：注意包大小限制，使用合适的压缩</li>
</ul>
<h3 data-id="heading-20">2. <strong>增量更新策略</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 使用Hash验证，只下载变化的部分</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">IncrementalUpdater</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerator <span class="hljs-title">CheckAndUpdate</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> remoteUrl, <span class="hljs-built_in">string</span> localPath</span>)</span>
    {
        <span class="hljs-comment">// 1. 获取远程版本信息</span>
        <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">GetRemoteVersion</span>(<span class="hljs-params">remoteUrl</span>)</span>;
        
        <span class="hljs-comment">// 2. 比较本地版本</span>
        <span class="hljs-keyword">if</span>(NeedUpdate(localVersion, remoteVersion))
        {
            <span class="hljs-comment">// 3. 只下载差异文件</span>
            <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-title">DownloadDeltaFiles</span>(<span class="hljs-params">deltaList</span>)</span>;
        }
    }
}
</code></pre>
<p>总结要点</p>
<ol>
<li><strong>打包策略</strong>：合理分割AssetBundle，使用LZ4压缩</li>
<li><strong>加载方式</strong>：始终使用异步加载，避免阻塞主线程</li>
<li><strong>缓存管理</strong>：实现智能缓存，及时清理无用资源</li>
<li><strong>依赖处理</strong>：预加载共享依赖，减少重复加载</li>
<li><strong>性能监控</strong>：持续监控加载性能，优化瓶颈</li>
<li><strong>平台适配</strong>：针对不同平台采用不同策略</li>
<li><strong>内存管理</strong>：合理使用Unload，避免<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269581835%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2586%2585%25E5%25AD%2598%25E6%25B3%2584%25E6%25BC%258F%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269581835&amp;content_type=Article&amp;match_order=1&amp;q=%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F&amp;zhida_source=entity" ref="nofollow noopener noreferrer">内存泄漏</a></li>
</ol>
<p>通过以上优化策略，可以显著提升AssetBundle的加载速度，改善游戏体验。建议根据项目实际情况选择适用的优化方案，并在开发过程中持续进行性能测试和优化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Function Call 和 MCP 的区别（举例子，一文说明白）]]></title>    <link>https://juejin.cn/post/7599917711793635338</link>    <guid>https://juejin.cn/post/7599917711793635338</guid>    <pubDate>2026-01-28T01:59:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599917711793635338" data-draft-id="7599459943918305318" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Function Call 和 MCP 的区别（举例子，一文说明白）"/> <meta itemprop="keywords" content="前端,Agent,LangChain"/> <meta itemprop="datePublished" content="2026-01-28T01:59:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lsx_"/> <meta itemprop="url" content="https://juejin.cn/user/1442981392682829"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Function Call 和 MCP 的区别（举例子，一文说明白）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442981392682829/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lsx_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T01:59:20.000Z" title="Wed Jan 28 2026 01:59:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>过去一年里，Function Call 成为最常用的“让 AI 调用代码”的方式。<br/>
但是当你的业务变复杂，比如：</p>
<ul>
<li>访问数据库</li>
<li>操作本地文件系统</li>
<li>管理多个工具</li>
<li>调用公司内部 API</li>
<li>多个模型复用同一套工具</li>
</ul>
<p>Function Call 就开始吃力了。</p>
<p>于是，<strong>MCP</strong>出现了，它解决了 Function Call 的所有局限，成为下一代 AI 工具调用标准。</p>
<p>本文将通过 <strong>Node.js 实例</strong>，让你直观理解两者区别。</p>
<h2 data-id="heading-1">二、概念总结：一句话说清两者区别</h2>
<p><strong>Function Call</strong>：<br/>
模型提示你：“我要调用这个函数”，然后你负责执行。</p>
<p><strong>MCP</strong>：<br/>
模型自动发现和调用已注册的“工具”，开发者只负责定义工具，不负责执行。</p>
<p>一句话：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">Function</span> <span class="hljs-keyword">Call</span>：模型说“我需要工具”，你来执行。
MCP：模型自己执行工具，你只负责提供工具。
</code></pre>
<h2 data-id="heading-2">三、用例对比：查询某个城市的天气</h2>
<p>我们以“查询北京天气”为例进行对比。</p>
<p>目标：<br/>
让用户问：“北京天气怎么样？”<br/>
模型自动获取天气数据，并返回结果。</p>
<h3 data-id="heading-3">3.1 Function Call 示例（Node.js）</h3>
<h4 data-id="heading-4">代码结构</h4>
<pre><code class="hljs language-ts" lang="ts">function_call/
  ├── app.<span class="hljs-property">js</span>
  └── weather.<span class="hljs-property">js</span>
</code></pre>
<h4 data-id="heading-5">步骤1：你需要手写工具函数（核心）</h4>
<p>weather.js：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getWeather</span>(<span class="hljs-params">city</span>) {
  <span class="hljs-keyword">const</span> apiKey = <span class="hljs-string">"your_api_key_here"</span>;
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">`https://api.open-meteo.com/v1/forecast?latitude=39.9&amp;longitude=116.4&amp;hourly=temperature_2m`</span>;

  <span class="hljs-keyword">const</span> resp = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(url);
  <span class="hljs-keyword">return</span> <span class="hljs-string">`当前温度：<span class="hljs-subst">${resp.data.hourly.temperature_2m[<span class="hljs-number">0</span>]}</span>°C`</span>;
}
</code></pre>
<h4 data-id="heading-6">步骤2：把工具绑定给模型（你要写）</h4>
<p>app.js：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> { getWeather } <span class="hljs-keyword">from</span> <span class="hljs-string">"./weather.js"</span>;

<span class="hljs-keyword">const</span> tools = [
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">"function"</span>,
    <span class="hljs-attr">function</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"get_weather"</span>,
      <span class="hljs-attr">description</span>: <span class="hljs-string">"获取指定城市的天气信息"</span>,
      <span class="hljs-attr">parameters</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
        <span class="hljs-attr">properties</span>: {
          <span class="hljs-attr">city</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span> }
        },
        <span class="hljs-attr">required</span>: [<span class="hljs-string">"city"</span>]
      }
    }
  }
];

<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-4o-mini"</span>
}).<span class="hljs-title function_">bind</span>({ tools });

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"北京天气怎么样"</span>);

  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">tool_calls</span>?.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> { city } = res.<span class="hljs-property">tool_calls</span>[<span class="hljs-number">0</span>].<span class="hljs-property">args</span>;

    <span class="hljs-comment">// 你负责执行工具</span>
    <span class="hljs-keyword">const</span> weather = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getWeather</span>(city);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"返回天气："</span>, weather);
  }
}

<span class="hljs-title function_">run</span>();
</code></pre>
<h4 data-id="heading-7">Function Call 的特点</h4>
<p>你必须：</p>
<ul>
<li>❗手写 getWeather</li>
<li>❗手动执行工具</li>
<li>❗手动把结果反馈给模型</li>
<li>❗每个模型都需要绑一遍 tools</li>
</ul>
<p>当你的工具越来越多时，维护成本越来越高。</p>
<h3 data-id="heading-8">3.2 MCP 示例（Node.js）</h3>
<p>在 MCP 中，你只需要定义工具，模型会：</p>
<p>✔ 自动发现工具<br/>
✔ 自动决定什么时候调用<br/>
✔ MCPClient 自动执行<br/>
✔ 你不需要任何其它代码</p>
<h4 data-id="heading-9">步骤1：定义一个 MCP 天气服务</h4>
<p>新建：<code>mcp-weather-server.js</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server"</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;

<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">"weather-service"</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-string">"1.0"</span>,
});

<span class="hljs-comment">// 注册自定义工具</span>
server.<span class="hljs-title function_">tool</span>(
  <span class="hljs-string">"get_weather"</span>,
  <span class="hljs-string">"获取天气"</span>,
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">city</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span> }
    },
    <span class="hljs-attr">required</span>: [<span class="hljs-string">"city"</span>]
  },
  <span class="hljs-keyword">async</span> ({ city }) =&gt; {
    <span class="hljs-comment">// 你可以接数据库/公司内网 API 都行</span>
    <span class="hljs-keyword">const</span> url = <span class="hljs-string">`https://api.open-meteo.com/v1/forecast?latitude=39.9&amp;longitude=116.4&amp;hourly=temperature_2m`</span>;
    <span class="hljs-keyword">const</span> resp = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(url);
    <span class="hljs-keyword">const</span> temp = resp.<span class="hljs-property">data</span>.<span class="hljs-property">hourly</span>.<span class="hljs-property">temperature_2m</span>[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">weather</span>: <span class="hljs-string">`<span class="hljs-subst">${city}</span>当前温度：<span class="hljs-subst">${temp}</span>°C`</span> };
  }
);

server.<span class="hljs-title function_">start</span>();
</code></pre>
<h4 data-id="heading-10">步骤2：模型自动调用 MCP 工具</h4>
<p>app.js：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MCPClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph/mcp"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatPromptTemplate</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/prompts"</span>;

<span class="hljs-comment">// 连接 MCP server</span>
<span class="hljs-keyword">const</span> mcp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MCPClient</span>(<span class="hljs-string">"stdio"</span>, {
  <span class="hljs-attr">command</span>: <span class="hljs-string">"node"</span>,
  <span class="hljs-attr">args</span>: [<span class="hljs-string">"./mcp-weather-server.js"</span>]
});

<span class="hljs-comment">// 绑定到模型（让模型自动调用 MCP 工具）</span>
<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-4o-mini"</span>,
}).<span class="hljs-title function_">bind</span>({ mcp });

<span class="hljs-keyword">const</span> prompt = <span class="hljs-title class_">ChatPromptTemplate</span>.<span class="hljs-title function_">fromMessages</span>([
  [<span class="hljs-string">"system"</span>, <span class="hljs-string">"你可以使用 MCP 工具获取天气信息。"</span>],
  [<span class="hljs-string">"human"</span>, <span class="hljs-string">"{q}"</span>]
]);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ask</span>(<span class="hljs-params">q</span>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> prompt.<span class="hljs-title function_">pipe</span>(llm).<span class="hljs-title function_">invoke</span>({ q });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"模型回答：\n"</span>, res.<span class="hljs-property">content</span>);
}

<span class="hljs-title function_">ask</span>(<span class="hljs-string">"北京天气怎么样"</span>);
</code></pre>
<p>运行后输出类似：</p>
<pre><code class="hljs">模型回答：
北京当前温度：1°C
</code></pre>
<h4 data-id="heading-11">MCP 的特点</h4>
<ul>
<li>模型自动识别并调取 get_weather</li>
<li>MCPClient 负责执行工具并返回结果</li>
<li>开发者不用写其它code（如 res.tool_calls）</li>
<li>所有 MCP 支持的模型都能直接复用这个工具</li>
</ul>
<h2 data-id="heading-12">四、核心区别（通过例子直接看出来）</h2>








































<table><thead><tr><th>能力</th><th>Function Call</th><th>MCP</th></tr></thead><tbody><tr><td>工具在哪里定义？</td><td>代码里</td><td>MCP Server 里</td></tr><tr><td>工具由谁调用？</td><td><strong>开发者手动调用</strong></td><td><strong>模型自动调用</strong></td></tr><tr><td>工具能否自动发现？</td><td>❌ 不行</td><td>✔️ 自动发现</td></tr><tr><td>是否支持文件系统 / DB / 本地脚本？</td><td>你得自己写</td><td>MCP 工具库直接支持</td></tr><tr><td>能否被多个模型共享？</td><td>❌ 每个模型都要重新写</td><td>✔️ MCP 工具可复用</td></tr><tr><td>安全性和权限？</td><td>手动处理</td><td>MCP 内置权限管理</td></tr></tbody></table>
<p>一句话：</p>
<pre><code class="hljs language-ini" lang="ini">Function <span class="hljs-attr">Call</span> = 模型请求你，你再帮它调工具  
<span class="hljs-attr">MCP</span> = 模型自己调工具，你只提供工具
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript开发者必备的5个高效调试技巧，90%的人都不知道！]]></title>    <link>https://juejin.cn/post/7599873006258618402</link>    <guid>https://juejin.cn/post/7599873006258618402</guid>    <pubDate>2026-01-28T00:19:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599873006258618402" data-draft-id="7599893063863910415" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript开发者必备的5个高效调试技巧，90%的人都不知道！"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-28T00:19:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript开发者必备的5个高效调试技巧，90%的人都不知道！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T00:19:28.000Z" title="Wed Jan 28 2026 00:19:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScript开发者必备的5个高效调试技巧，90%的人都不知道！</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>作为JavaScript开发者，调试是日常工作中不可避免的一部分。无论是排查运行时错误、优化性能，还是理解复杂的代码逻辑，高效的调试技巧能显著提升开发效率。然而，许多开发者仍然停留在<code>console.log</code>的初级阶段，或者对浏览器开发者工具的使用仅限于查看错误信息。事实上，JavaScript生态系统提供了大量强大的调试工具和技术，但大多数开发者并未充分利用它们。</p>
<p>本文将分享5个高效且鲜为人知的JavaScript调试技巧，帮助你更快地定位问题、理解代码行为并提升开发体验。这些技巧涵盖了浏览器开发者工具的高级功能、Node.js调试以及一些实用的第三方工具。无论你是初学者还是经验丰富的开发者，这些技巧都能让你在调试时事半功倍。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. 使用<code>console</code>的进阶方法</h3>
<p>大多数开发者都知道<code>console.log</code>，但很少有人充分利用<code>console</code>对象的其他强大方法。以下是一些鲜为人知但极其有用的<code>console</code>方法：</p>
<h4 data-id="heading-4"><code>console.table()</code></h4>
<p>当你需要打印数组或对象时，<code>console.table()</code>能以表格形式展示数据，使复杂结构一目了然。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">table</span>(users);
</code></pre>
<p>这会生成一个清晰的表格视图，非常适合调试数据结构。</p>
<h4 data-id="heading-5"><code>console.time()</code>和<code>console.timeEnd()</code></h4>
<p>这对方法用于测量代码块的执行时间：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'fetchData'</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>(); <span class="hljs-comment">// 假设这是一个异步函数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'fetchData'</span>);
</code></pre>
<p>输出将显示<code>fetchData</code>的执行时间，非常适用于性能分析。</p>
<h4 data-id="heading-6"><code>console.trace()</code></h4>
<p>如果你想追踪函数的调用栈（比如某个函数是如何被调用的），可以使用<code>console.trace()</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">trace</span>(<span class="hljs-string">'Trace foo'</span>);
}
<span class="hljs-title function_">foo</span>();
</code></pre>
<p>这将打印出从调用到当前函数的完整调用链。</p>
<h3 data-id="heading-7">2. Chrome DevTools中的条件断点</h3>
<p>断点是调试的核心工具之一，但普通断点在每次执行时都会暂停代码运行。如果你只想在特定条件下暂停（例如当循环变量等于某个值或属性满足某些条件时），可以使用条件断点（Conditional Breakpoint）。</p>
<p>设置方法：</p>
<ol>
<li>在Chrome DevTools中打开Sources面板。</li>
<li>找到目标代码行并右键点击行号左侧的区域。</li>
<li>选择“Add conditional breakpoint”并输入条件表达式（例如：<code>i === 5</code>）。</li>
</ol>
<p>这样只有当条件满足时才会暂停执行，避免手动跳过无关迭代的麻烦。</p>
<h3 data-id="heading-8">3. Node.js的Inspector和Chrome DevTools集成</h3>
<p>Node.js提供了强大的内置调试支持，可以通过Chrome DevTools进行可视化调试：</p>
<ol>
<li>启动Node.js应用时加上<code>--inspect</code>标志：
<pre><code class="hljs language-bash" lang="bash">node --inspect app.js
</code></pre>
</li>
<li>Chrome浏览器中输入：<code>chrome://inspect/</code>,然后点击“Open dedicated DevTools for Node”。</li>
</ol>
<p>现在你可以像调试前端代码一样设置断点、检查变量和执行步骤化操作（Step Over, Step Into等）。此外还可以使用CPU和内存分析器来优化性能问题！</p>
<p>###4 .使用VS Code的内置JavaScript Debugger</p>
<p>VS Code不仅是编辑器还自带强大JS debugger功能无需离开编辑器即可完成所有debug任务：</p>
<ul>
<li><strong>Launch Configuration</strong>:通过<code>.vscode/launch.json</code>,配置不同类型(如启动文件/附加到进程)</li>
<li><strong>Logpoints</strong>:类似log但不会暂停程序执行适合生产环境排错</li>
<li><strong>Inline Variable Values</strong>:直接显示变量值无需悬停鼠标</li>
</ul>
<p>示例配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
 <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0"</span><span class="hljs-punctuation">,</span>
 <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
       <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Debug Current File"</span><span class="hljs-punctuation">,</span>
       <span class="hljs-attr">"program"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"${file}"</span> 
    <span class="hljs-punctuation">}</span>
 <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>###5 .利用Error Stack Traces和Source Maps</p>
<p>当错误发生时堆栈跟踪(stack trace)至关重要但如果代码经过转译(如Babel/TypeScript),则原始位置可能丢失此时source map就派上用场确保构建流程生成正确source map文件并在部署时保留它们.</p>
<p>同时可利用Error对象自定义信息:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">try</span> {
 <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Custom error message'</span>); 
} <span class="hljs-keyword">catch</span> (error) {
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">stack</span>); 
 <span class="hljs-comment">// Custom handling here...  </span>
} 
</code></pre>
<p>对于Promise rejection建议监听全局事件:</p>
<pre><code class="hljs language-js" lang="js">process.<span class="hljs-title function_">on</span>(<span class="hljs-string">'unhandledRejection'</span>,<span class="hljs-function">(<span class="hljs-params">reason,promise</span>)=&gt;</span>{
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Unhandled Rejection at:'</span>,promise,<span class="hljs-string">'reason:'</span>,reason);    
}); 

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>,<span class="hljs-function"><span class="hljs-params">event</span>=&gt;</span>{
   event.<span class="hljs-title function_">preventDefault</span>();     
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`UNHANDLED PROMISE REJECTION: <span class="hljs-subst">${event.reason}</span>`</span>);    
});   
</code></pre>
<hr/>
<p>##总结</p>
<p>本文介绍了五个高效却常被忽视JS debug技巧包括Console高级方法Conditional BreakpointsNode与Chrome集成VS Code Debugger以及Source Maps应用掌握这些技术后你能够更快速准确定位问题减少无谓时间消耗从而专注于构建更好应用记住优秀开发者不仅擅长编写代码更要精通如何修复它希望本指南能成为你工具箱中宝贵资源!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[剑指offer-69、数字序列中某⼀位的数字]]></title>    <link>https://juejin.cn/post/7599920572840673289</link>    <guid>https://juejin.cn/post/7599920572840673289</guid>    <pubDate>2026-01-28T00:26:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599920572840673289" data-draft-id="7598459769238519842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="剑指offer-69、数字序列中某⼀位的数字"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-28T00:26:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            剑指offer-69、数字序列中某⼀位的数字
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T00:26:44.000Z" title="Wed Jan 28 2026 00:26:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">题⽬描述</h2>
<p>数字以 0123456789101112131415... 的格式作为⼀个字符序列，在这个序列中第 2 位（从下标 0 开始计算）是 2 ，第 10 位是 1 ，第 13 位是 1 ，以此类题，请你输出第 n 位对应的数字。</p>
<p>示例1</p>
<p>输⼊：0
返回值：0</p>
<p>示例2
输⼊：2
返回值：2</p>
<p>示例3
输⼊：13
返回值：1</p>
<h2 data-id="heading-1">思路及解答</h2>
<h3 data-id="heading-2">暴力法</h3>
<p>通过逐步构造数字序列来找到第n位数字</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">findNthDigit</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 示例1特殊情况处理[2](@ref)</span>
        
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sequence</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-comment">// 逐步构建序列，直到长度超过n</span>
        <span class="hljs-keyword">while</span> (sequence.length() &lt;= n) {
            sequence.append(num);
            num++;
        }
        
        <span class="hljs-comment">// 返回第n位字符对应的数字值</span>
        <span class="hljs-keyword">return</span> sequence.charAt(n) - <span class="hljs-string">'0'</span>;
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n)，需要构造长度至少为n的字符串</li>
<li><strong>空间复杂度</strong>：O(n)，需要存储构造的字符串序列</li>
</ul>
<h3 data-id="heading-3">数学规律</h3>
<p>利用数字位数分布的数学规律，直接定位第n位所在的数字和具体位置</p>
<p><strong>数字位数分布规律：</strong></p>
<ul>
<li><strong>1位数</strong>：0-9 → 10个数字 × 1位 = 10位</li>
<li><strong>2位数</strong>：10-99 → 90个数字 × 2位 = 180位</li>
<li><strong>3位数</strong>：100-999 → 900个数字 × 3位 = 2700位</li>
<li><strong>k位数</strong>：9×10ᵏ⁻¹个数字 × k位</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">findNthDigit</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-type">int</span> <span class="hljs-variable">digit</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;              <span class="hljs-comment">// 数字位数（1位、2位、3位...）</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;             <span class="hljs-comment">// 当前位数范围的起始数字</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;             <span class="hljs-comment">// 当前位数范围内的数字总位数</span>
        
        <span class="hljs-comment">// 步骤1：确定n所在的数字位数</span>
        <span class="hljs-keyword">while</span> (n &gt; count) {
            n -= count;             <span class="hljs-comment">// 减去前一个位数范围的数字总位数</span>
            digit++;                <span class="hljs-comment">// 位数增加</span>
            start *= <span class="hljs-number">10</span>;            <span class="hljs-comment">// 起始数字扩大10倍</span>
            count = <span class="hljs-number">9L</span> * digit * start; <span class="hljs-comment">// 计算新的位数范围内的总位数</span>
        }
        
        <span class="hljs-comment">// 步骤2：确定n所在的具体数字</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> start + (n - <span class="hljs-number">1</span>) / digit; <span class="hljs-comment">// 计算目标数字</span>
        
        <span class="hljs-comment">// 步骤3：确定n在数字中的具体位置并返回</span>
        <span class="hljs-keyword">return</span> Long.toString(num).charAt((n - <span class="hljs-number">1</span>) % digit) - <span class="hljs-string">'0'</span>;
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(log₁₀n)，循环次数与n的位数成正比</li>
<li><strong>空间复杂度</strong>：O(1)，只使用常数级别变量</li>
</ul>
<h3 data-id="heading-4">添0补齐</h3>
<p>假设所有数字都是i位数，通过给较短数字前面添0，使所有数字位数相同，简化定位逻辑</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">findNthDigit</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">// 数字位数</span>
        
        <span class="hljs-comment">// 通过添0补齐，使所有数字都视为i位数</span>
        <span class="hljs-keyword">while</span> (i * Math.pow(<span class="hljs-number">10</span>, i) &lt; n) {
            n += Math.pow(<span class="hljs-number">10</span>, i); <span class="hljs-comment">// 添0增加的位数</span>
            i++;
        }
        
        <span class="hljs-comment">// 定位目标数字和具体位置</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> String.valueOf(n / i);
        <span class="hljs-keyword">return</span> num.charAt(n % i) - <span class="hljs-string">'0'</span>;
    }
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(log₁₀n)，与数学规律法相同</li>
<li><strong>空间复杂度</strong>：O(1)，常数空间复杂度</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[type-challenges（ts类型体操）: 4 - 实现 Pick]]></title>    <link>https://juejin.cn/post/7599852042530570250</link>    <guid>https://juejin.cn/post/7599852042530570250</guid>    <pubDate>2026-01-28T00:28:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852042530570250" data-draft-id="7599922362997932078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="type-challenges（ts类型体操）: 4 - 实现 Pick"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-28T00:28:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fxss"/> <meta itemprop="url" content="https://juejin.cn/user/3702810892856808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            type-challenges（ts类型体操）: 4 - 实现 Pick
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810892856808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fxss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T00:28:05.000Z" title="Wed Jan 28 2026 00:28:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">4 - 实现 Pick</h2>
<p>by Anthony Fu (@antfu) #简单 #union #built-in</p>
<h3 data-id="heading-1">题目</h3>
<p>不使用 <code>Pick&lt;T, K&gt;</code> ，实现 TS 内置的 <code>Pick&lt;T, K&gt;</code> 的功能。</p>
<p><strong>从类型 <code>T</code> 中选出符合 <code>K</code> 的属性，构造一个新的类型</strong>。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = <span class="hljs-title class_">MyPick</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'title'</span> | <span class="hljs-string">'completed'</span>&gt;

<span class="hljs-keyword">const</span> <span class="hljs-attr">todo</span>: <span class="hljs-title class_">TodoPreview</span> = {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'Clean room'</span>,
    <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
}
</code></pre>
<blockquote>
<p>在 Github 上查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F4%2Fzh-CN" target="_blank" title="https://tsch.js.org/4/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/4/zh-CN</a></p>
</blockquote>
<h3 data-id="heading-2">代码</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 你的代码 _____________ */</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">MyPick</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt; = {
  [P <span class="hljs-keyword">in</span> K]: T[P]
}

</code></pre>
<p>关键解释：</p>
<ul>
<li><code>T</code>：泛型参数，代表任意对象类型；</li>
<li><code>K extends keyof T</code>：约束 <code>K</code> 必须是 <code>T</code> 的属性名之一；</li>
<li><code>[P in K]: T[P]</code>：映射类型，遍历 <code>K</code> 中的每个属性名 <code>P</code>，并将 <code>T[P]</code> 作为 <code>P</code> 的类型。
<ul>
<li><code>P in K</code>：遍历 <code>K</code> 中的每个属性名 <code>P</code>；</li>
<li><code>T[P]</code>：获取 <code>T</code> 中属性 <code>P</code> 的类型。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">相关知识点</h3>
<h4 data-id="heading-4"><code>keyof</code></h4>
<p><code>keyof</code> 操作符用于获取对象类型的所有属性名（包括索引签名），并将其转换为联合类型。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = keyof <span class="hljs-title class_">Todo</span> <span class="hljs-comment">// "title" | "description" | "completed"</span>
</code></pre>
<h4 data-id="heading-5"><code>extends</code></h4>
<p><code>extends</code> 操作符用于约束泛型参数的类型范围。</p>
<h4 data-id="heading-6"><code>in</code></h4>
<p><code>in</code> 操作符用于遍历联合类型中的每个成员。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span> | <span class="hljs-string">'completed'</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = {
  [P <span class="hljs-keyword">in</span> <span class="hljs-title class_">TodoKeys</span>]: <span class="hljs-title class_">Todo</span>[P]
}
<span class="hljs-comment">// TodoPreview 类型为：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   title: string</span>
<span class="hljs-comment">//   description: string</span>
<span class="hljs-comment">//   completed: boolean</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h3 data-id="heading-7">测试用例</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 测试用例 _____________ */</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Equal</span>, <span class="hljs-title class_">Expect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@type-challenges/utils'</span>

<span class="hljs-keyword">type</span> cases = [
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Expected1</span>, <span class="hljs-title class_">MyPick</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'title'</span>&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Expected2</span>, <span class="hljs-title class_">MyPick</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'title'</span> | <span class="hljs-string">'completed'</span>&gt;&gt;&gt;,
  <span class="hljs-comment">// @ts-expect-error</span>
  <span class="hljs-title class_">MyPick</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'title'</span> | <span class="hljs-string">'completed'</span> | <span class="hljs-string">'invalid'</span>&gt;,
]

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Expected1</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Expected2</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

</code></pre>
<h3 data-id="heading-8">相关链接</h3>
<blockquote>
<p>分享你的解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F4%2Fanswer%2Fzh-CN" target="_blank" title="https://tsch.js.org/4/answer/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/4/answer/zh…</a>
查看解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F4%2Fsolutions" target="_blank" title="https://tsch.js.org/4/solutions" ref="nofollow noopener noreferrer">tsch.js.org/4/solutions</a>
更多题目：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2Fzh-CN" target="_blank" title="https://tsch.js.org/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/zh-CN</a></p>
</blockquote>
<p>下面是我的公众号，欢迎关注。关注后有新的功能点会及时收到推送。</p>
<blockquote>
<p>实战为王！专注于汇总各种功能点，致力于打造一系列能够帮助工程师实现各种功能的想法思路的优质文章。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdeec99a0154e7aa73c1c6765f3dcf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnhzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770164884&amp;x-signature=70Iyq95gOTR5H2mpi%2FZVvT8B%2Fic%3D" alt="前端功能点" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第8章、指针与内存管理——理解Go的底层机制]]></title>    <link>https://juejin.cn/post/7599868109085851690</link>    <guid>https://juejin.cn/post/7599868109085851690</guid>    <pubDate>2026-01-28T00:35:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599868109085851690" data-draft-id="7599929684020887571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第8章、指针与内存管理——理解Go的底层机制"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-28T00:35:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第8章、指针与内存管理——理解Go的底层机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T00:35:04.000Z" title="Wed Jan 28 2026 00:35:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好～ 前面我们学习了Go的基础类型、函数和复合类型，今天终于要深入Go的“底层核心”——指针与内存管理。指针是连接代码与内存的桥梁，理解指针就能看懂数据在内存中的存储与传递逻辑；而内存管理（尤其是逃逸分析和垃圾回收）是Go实现“高效并发”和“自动内存管理”的关键，直接决定了代码的性能。</p>
<p>很多新手会觉得指针和内存管理“高深难懂”，其实只要抓住“内存地址”和“数据存储”两个核心，就能轻松入门。本文会从“指针基础语法”开始，逐步拆解内存分配、逃逸分析、垃圾回收等底层机制，全程搭配代码示例，帮你彻底搞懂Go的内存逻辑，避开实际开发中的性能陷阱。</p>
<h2 data-id="heading-0">1. 指针的基本语法与使用场景</h2>
<p>指针的核心作用是“指向变量的内存地址”，通过指针可以间接操作变量的值。简单来说，<strong>变量存储的是“数据本身”，指针存储的是“数据的内存地址”</strong>。Go的指针设计比C/C++简单（不支持指针运算），安全性更高，同时保留了指针的核心价值。</p>
<h3 data-id="heading-1">1.1 指针的基本语法</h3>
<p>Go中指针的核心语法有三个：定义指针、取地址、解引用：</p>
<ul>
<li>
<p><strong>定义指针</strong>：<code>*T</code> 表示“指向T类型变量的指针类型”（如<code>*int</code>是指向int变量的指针）；</p>
</li>
<li>
<p><strong>取地址</strong>：<code>&amp;变量名</code> 表示“获取变量的内存地址”，返回值是指针类型；</p>
</li>
<li>
<p><strong>解引用</strong>：<code>*指针变量</code> 表示“通过指针地址访问对应的变量”，可以读取或修改变量的值。</p>
</li>
</ul>
<p>代码示例：指针的基本操作</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 定义普通变量</span>
    a := <span class="hljs-number">10</span>
    fmt.Printf(<span class="hljs-string">"变量a的值：%d\n"</span>, a)          <span class="hljs-comment">// 输出：变量a的值：10</span>
    fmt.Printf(<span class="hljs-string">"变量a的内存地址：%p\n"</span>, &amp;a)   <span class="hljs-comment">// 输出：变量a的内存地址：0xc00001a0a8（地址值因环境而异）</span>

    <span class="hljs-comment">// 2. 定义指针变量，指向a的地址</span>
    <span class="hljs-keyword">var</span> p *<span class="hljs-type">int</span> = &amp;a
    fmt.Printf(<span class="hljs-string">"指针p的值（即a的地址）：%p\n"</span>, p) <span class="hljs-comment">// 输出：指针p的值（即a的地址）：0xc00001a0a8</span>
    fmt.Printf(<span class="hljs-string">"指针p的类型：%T\n"</span>, p)          <span class="hljs-comment">// 输出：指针p的类型：*int</span>

    <span class="hljs-comment">// 3. 解引用：通过指针访问变量a的值</span>
    fmt.Printf(<span class="hljs-string">"通过指针p访问a的值：%d\n"</span>, *p)  <span class="hljs-comment">// 输出：通过指针p访问a的值：10</span>

    <span class="hljs-comment">// 4. 解引用：通过指针修改变量a的值</span>
    *p = <span class="hljs-number">20</span>
    fmt.Printf(<span class="hljs-string">"修改后a的值：%d\n"</span>, a)          <span class="hljs-comment">// 输出：修改后a的值：20</span>
    fmt.Printf(<span class="hljs-string">"通过指针p访问修改后a的值：%d\n"</span>, *p) <span class="hljs-comment">// 输出：通过指针p访问修改后a的值：20</span>
}

</code></pre>
<h3 data-id="heading-2">1.2 指针的核心使用场景</h3>
<p>指针的核心价值是“间接操作变量”和“减少数据拷贝”，主要应用在以下场景：</p>
<h4 data-id="heading-3">1.2.1 场景1：修改函数外部变量的值</h4>
<p>Go的函数参数是“值传递”，如果直接传递变量，函数内部修改的是副本，无法影响外部变量。通过传递指针，可以让函数间接修改外部变量：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 传递指针：可以修改外部变量</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifyByPointer</span><span class="hljs-params">(x *<span class="hljs-type">int</span>)</span></span> {
    *x = <span class="hljs-number">100</span> <span class="hljs-comment">// 解引用，修改指针指向的外部变量</span>
}

<span class="hljs-comment">// 传递值：无法修改外部变量（修改的是副本）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">modifyByValue</span><span class="hljs-params">(x <span class="hljs-type">int</span>)</span></span> {
    x = <span class="hljs-number">200</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    a := <span class="hljs-number">10</span>
    modifyByPointer(&amp;a) <span class="hljs-comment">// 传递a的地址</span>
    fmt.Println(<span class="hljs-string">"a（指针修改后）："</span>, a) <span class="hljs-comment">// 输出：a（指针修改后）： 100</span>

    modifyByValue(a) <span class="hljs-comment">// 传递a的值（副本）</span>
    fmt.Println(<span class="hljs-string">"a（值修改后）："</span>, a) <span class="hljs-comment">// 输出：a（值修改后）： 100（无变化）</span>
}

</code></pre>
<h4 data-id="heading-4">1.2.2 场景2：传递大结构体，减少拷贝开销</h4>
<p>结构体是值类型，传递大结构体时，会拷贝整个结构体数据，效率极低。传递结构体指针，只需拷贝8字节（64位系统）的地址，大幅提升性能：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span>
)

<span class="hljs-comment">// 定义一个大结构体（100个int字段）</span>
<span class="hljs-keyword">type</span> BigStruct <span class="hljs-keyword">struct</span> {
    data [<span class="hljs-number">100</span>]<span class="hljs-type">int</span>
}

<span class="hljs-comment">// 传递结构体指针</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processByPointer</span><span class="hljs-params">(bs *BigStruct)</span></span> {
    bs.data[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span> <span class="hljs-comment">// 操作指针指向的结构体</span>
}

<span class="hljs-comment">// 传递结构体值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processByValue</span><span class="hljs-params">(bs BigStruct)</span></span> {
    bs.data[<span class="hljs-number">0</span>] = <span class="hljs-number">200</span> <span class="hljs-comment">// 操作副本</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    bs := BigStruct{}

    <span class="hljs-comment">// 测试传递指针的耗时</span>
    start1 := time.Now()
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ {
        processByPointer(&amp;bs)
    }
    fmt.Printf(<span class="hljs-string">"传递指针耗时：%v\n"</span>, time.Since(start1)) <span class="hljs-comment">// 约0.5ms（因环境而异）</span>

    <span class="hljs-comment">// 测试传递值的耗时</span>
    start2 := time.Now()
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ {
        processByValue(bs)
    }
    fmt.Printf(<span class="hljs-string">"传递值耗时：%v\n"</span>, time.Since(start2)) <span class="hljs-comment">// 约50ms（因环境而异）</span>
}

</code></pre>
<p>结论：传递大结构体时，指针比值传递效率高100倍以上（具体比例因结构体大小而异）。</p>
<h4 data-id="heading-5">1.2.3 场景3：实现多返回值的“修改型”逻辑</h4>
<p>虽然Go支持多返回值，但对于“需要修改多个外部变量”的场景，用指针传递更简洁（避免返回多个值后重新赋值）：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 通过指针同时修改两个外部变量</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">updateValues</span><span class="hljs-params">(x, y *<span class="hljs-type">int</span>)</span></span> {
    *x += <span class="hljs-number">10</span>
    *y *= <span class="hljs-number">2</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    a, b := <span class="hljs-number">5</span>, <span class="hljs-number">3</span>
    updateValues(&amp;a, &amp;b)
    fmt.Println(<span class="hljs-string">"a:"</span>, a, <span class="hljs-string">"b:"</span>, b) <span class="hljs-comment">// 输出：a: 15 b: 6</span>
}

</code></pre>
<h2 data-id="heading-6">2. 指针的零值与空指针风险</h2>
<p>Go中所有变量都有零值（默认值），指针的零值是<code>nil</code>（空指针），表示“指针未指向任何内存地址”。空指针的核心风险是“解引用空指针会触发运行时错误”，这是Go中最常见的运行时错误之一。</p>
<h3 data-id="heading-7">2.1 指针的零值示例</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> p *<span class="hljs-type">int</span> <span class="hljs-comment">// 未初始化的指针，零值为nil</span>
    fmt.Printf(<span class="hljs-string">"指针p的值：%p\n"</span>, p) <span class="hljs-comment">// 输出：指针p的值：0x0（nil指针的地址是0）</span>
    fmt.Printf(<span class="hljs-string">"p == nil：%t\n"</span>, p == <span class="hljs-literal">nil</span>) <span class="hljs-comment">// 输出：p == nil：true</span>

    <span class="hljs-comment">// 错误：解引用空指针（运行时错误）</span>
    <span class="hljs-comment">// *p = 10 // fatal error: nil pointer dereference</span>
}

</code></pre>
<h3 data-id="heading-8">2.2 空指针风险的规避方案</h3>
<p>规避空指针错误的核心原则是：<strong>解引用指针前，必须先判断指针是否为nil</strong>。</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 安全的指针操作函数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">safeModify</span><span class="hljs-params">(p *<span class="hljs-type">int</span>, value <span class="hljs-type">int</span>)</span></span> {
    <span class="hljs-comment">// 先判断指针是否为nil</span>
    <span class="hljs-keyword">if</span> p == <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">"错误：指针为nil，无法修改"</span>)
        <span class="hljs-keyword">return</span>
    }
    *p = value <span class="hljs-comment">// 安全解引用</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> p *<span class="hljs-type">int</span>
    safeModify(p, <span class="hljs-number">10</span>) <span class="hljs-comment">// 输出：错误：指针为nil，无法修改</span>

    a := <span class="hljs-number">5</span>
    safeModify(&amp;a, <span class="hljs-number">10</span>)
    fmt.Println(<span class="hljs-string">"a:"</span>, a) <span class="hljs-comment">// 输出：a: 10</span>
}

</code></pre>
<h3 data-id="heading-9">2.3 常见空指针场景与预防</h3>
<p>实际开发中，空指针错误多出现以下场景，需重点预防：</p>
<h4 data-id="heading-10">2.3.1 场景1：函数返回nil指针，外部直接解引用</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 可能返回nil指针的函数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getPointer</span><span class="hljs-params">(flag <span class="hljs-type">bool</span>)</span></span> *<span class="hljs-type">int</span> {
    <span class="hljs-keyword">if</span> flag {
        a := <span class="hljs-number">10</span>
        <span class="hljs-keyword">return</span> &amp;a
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span> <span class="hljs-comment">// 条件不满足时返回nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    p := getPointer(<span class="hljs-literal">false</span>)
    <span class="hljs-comment">// 错误：未判断nil直接解引用</span>
    <span class="hljs-comment">// fmt.Println(*p) // fatal error: nil pointer dereference</span>

    <span class="hljs-comment">// 正确：先判断nil</span>
    <span class="hljs-keyword">if</span> p != <span class="hljs-literal">nil</span> {
        fmt.Println(*p)
    } <span class="hljs-keyword">else</span> {
        fmt.Println(<span class="hljs-string">"指针为nil"</span>)
    }
}

</code></pre>
<h4 data-id="heading-11">2.3.2 场景2：结构体指针字段未初始化</h4>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name *<span class="hljs-type">string</span> <span class="hljs-comment">// 指针字段</span>
    Age  <span class="hljs-type">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> u User <span class="hljs-comment">// 结构体零值初始化，Name字段为nil</span>
    <span class="hljs-comment">// 错误：解引用nil的Name字段</span>
    <span class="hljs-comment">// fmt.Println(*u.Name) // fatal error: nil pointer dereference</span>

    <span class="hljs-comment">// 正确：先初始化指针字段</span>
    name := <span class="hljs-string">"Alice"</span>
    u.Name = &amp;name
    fmt.Println(*u.Name) <span class="hljs-comment">// 输出：Alice</span>
}

</code></pre>
<h2 data-id="heading-12">3. new函数与内存分配</h2>
<p>Go提供<code>new(T)</code>函数用于“分配内存”：它会为T类型的变量分配一块零值初始化的内存，然后返回指向这块内存的指针（类型为<code>*T</code>）。new函数是Go中最基础的内存分配方式之一，核心作用是“快速创建一个零值的指针变量”。</p>
<h3 data-id="heading-13">3.1 new函数的基本用法</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 用new创建int指针（分配内存，零值初始化）</span>
    p1 := <span class="hljs-built_in">new</span>(<span class="hljs-type">int</span>)
    fmt.Printf(<span class="hljs-string">"p1的类型：%T\n"</span>, p1) <span class="hljs-comment">// 输出：p1的类型：*int</span>
    fmt.Printf(<span class="hljs-string">"p1的值（内存地址）：%p\n"</span>, p1) <span class="hljs-comment">// 输出：p1的值（内存地址）：0xc00001a0a8</span>
    fmt.Printf(<span class="hljs-string">"p1指向的值（零值）：%d\n"</span>, *p1) <span class="hljs-comment">// 输出：p1指向的值（零值）：0</span>

    <span class="hljs-comment">// 2. 修改new创建的变量的值</span>
    *p1 = <span class="hljs-number">100</span>
    fmt.Printf(<span class="hljs-string">"修改后p1指向的值：%d\n"</span>, *p1) <span class="hljs-comment">// 输出：修改后p1指向的值：100</span>

    <span class="hljs-comment">// 3. 用new创建结构体指针</span>
    <span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
        Name <span class="hljs-type">string</span>
        Age  <span class="hljs-type">int</span>
    }
    p2 := <span class="hljs-built_in">new</span>(User)
    fmt.Printf(<span class="hljs-string">"p2的类型：%T\n"</span>, p2) <span class="hljs-comment">// 输出：p2的类型：*main.User</span>
    fmt.Printf(<span class="hljs-string">"p2指向的结构体（零值）：%+v\n"</span>, *p2) <span class="hljs-comment">// 输出：p2指向的结构体（零值）：{Name: Age:0}</span>

    <span class="hljs-comment">// 修改结构体字段</span>
    p2.Name = <span class="hljs-string">"Bob"</span>
    p2.Age = <span class="hljs-number">25</span>
    fmt.Printf(<span class="hljs-string">"修改后p2指向的结构体：%+v\n"</span>, *p2) <span class="hljs-comment">// 输出：修改后p2指向的结构体：{Name:Bob Age:25}</span>
}

</code></pre>
<h3 data-id="heading-14">3.2 new函数的核心特性</h3>
<ul>
<li>
<p>返回值是指针：new(T)返回的是<code>*T</code>类型，直接指向分配的内存；</p>
</li>
<li>
<p>内存零值初始化：分配的内存会被初始化为T类型的零值（如int零值0，string零值""）；</p>
</li>
<li>
<p>适用于所有类型：可以为基本类型、结构体、数组等任意类型分配内存；</p>
</li>
<li>
<p>简洁高效：比“先定义变量再取地址”更简洁（如<code>p := new(int)</code> 等价于 <code>var a int; p := </code>&amp;a）。</p>
</li>
</ul>
<h3 data-id="heading-15">3.3 new函数的使用场景</h3>
<p>new函数适合“快速创建一个零值的指针变量”，尤其是以下场景：</p>
<ul>
<li>
<p>创建基本类型的指针（如<code>*int</code>、<code>*string</code>），避免手动定义变量再取地址；</p>
</li>
<li>
<p>创建结构体指针，快速初始化一个零值结构体（后续再修改字段）；</p>
</li>
<li>
<p>在函数内部创建临时变量的指针，返回给外部使用（确保变量分配在堆上，避免栈逃逸问题，后续章节讲解）。</p>
</li>
</ul>
<h2 data-id="heading-16">4. make与new的区别对比</h2>
<p>Go中的<code>make</code>和<code>new</code>都是内存分配相关的函数，但它们的作用、适用类型和返回值完全不同，新手很容易混淆。本节将从多个维度对比两者的区别，并给出使用场景建议。</p>
<h3 data-id="heading-17">4.1 核心区别对比表</h3>



































<table><thead><tr><th>对比维度</th><th>new函数</th><th>make函数</th></tr></thead><tbody><tr><td>核心作用</td><td>为任意类型分配零值内存，返回指针</td><td>为切片、map、chan分配内存并初始化（非零值），返回原类型</td></tr><tr><td>适用类型</td><td>所有类型（基本类型、结构体、数组等）</td><td>仅切片（slice）、映射（map）、通道（chan）</td></tr><tr><td>返回值类型</td><td>指针类型（*T）</td><td>原类型（T，如[]int、map[string]int）</td></tr><tr><td>内存初始化</td><td>零值初始化（如int为0，string为""）</td><td>非零值初始化（如切片初始化len和cap，map初始化哈希表）</td></tr><tr><td>使用场景</td><td>快速创建基本类型/结构体的指针</td><td>创建可直接使用的切片、map、chan（避免nil状态）</td></tr></tbody></table>
<h3 data-id="heading-18">4.2 代码示例：make与new的实际区别</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. new函数的使用：返回指针，零值初始化</span>
    p1 := <span class="hljs-built_in">new</span>([]<span class="hljs-type">int</span>) <span class="hljs-comment">// 返回*[]int类型（切片指针）</span>
    fmt.Printf(<span class="hljs-string">"new([]int)返回类型：%T\n"</span>, p1) <span class="hljs-comment">// 输出：new([]int)返回类型：*[]int</span>
    fmt.Printf(<span class="hljs-string">"p1指向的切片（零值）：%+v\n"</span>, *p1) <span class="hljs-comment">// 输出：p1指向的切片（零值）：[]（nil切片）</span>
    <span class="hljs-comment">// *p1 = append(*p1, 10) // 可以使用，但需要解引用，麻烦</span>

    <span class="hljs-comment">// 2. make函数的使用：返回切片类型，非零值初始化</span>
    s1 := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>) <span class="hljs-comment">// 返回[]int类型，len=0，cap=5</span>
    fmt.Printf(<span class="hljs-string">"make([]int,0,5)返回类型：%T\n"</span>, s1) <span class="hljs-comment">// 输出：make([]int,0,5)返回类型：[]int</span>
    fmt.Printf(<span class="hljs-string">"s1的len和cap：%d, %d\n"</span>, <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">cap</span>(s1)) <span class="hljs-comment">// 输出：s1的len和cap：0, 5</span>
    s1 = <span class="hljs-built_in">append</span>(s1, <span class="hljs-number">10</span>) <span class="hljs-comment">// 可直接使用，无需解引用</span>
    fmt.Println(<span class="hljs-string">"s1:"</span>, s1) <span class="hljs-comment">// 输出：s1: [10]</span>

    <span class="hljs-comment">// 3. new创建map（返回指针，零值为nil）</span>
    p2 := <span class="hljs-built_in">new</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>)
    fmt.Printf(<span class="hljs-string">"new(map[string]int)返回类型：%T\n"</span>, p2) <span class="hljs-comment">// 输出：new(map[string]int)返回类型：*map[string]int</span>
    <span class="hljs-comment">// (*p2)["a"] = 1 // 运行时错误：assignment to entry in nil map（指针指向的map是nil）</span>

    <span class="hljs-comment">// 4. make创建map（返回map类型，已初始化）</span>
    m1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">5</span>)
    fmt.Printf(<span class="hljs-string">"make(map[string]int,5)返回类型：%T\n"</span>, m1) <span class="hljs-comment">// 输出：make(map[string]int,5)返回类型：map[string]int</span>
    m1[<span class="hljs-string">"a"</span>] = <span class="hljs-number">1</span> <span class="hljs-comment">// 可直接使用</span>
    fmt.Println(<span class="hljs-string">"m1:"</span>, m1) <span class="hljs-comment">// 输出：m1: map[a:1]</span>
}

</code></pre>
<h3 data-id="heading-19">4.3 使用场景建议</h3>
<ul>
<li>
<p>创建切片、map、chan：<strong>优先用make</strong>，直接返回可使用的类型，避免nil状态；</p>
</li>
<li>
<p>创建基本类型（int、string等）或结构体的指针：<strong>用new</strong>，简洁高效；</p>
</li>
<li>
<p>避免用new创建切片、map、chan：返回的指针指向nil的切片/map/chan，使用前还需手动初始化，繁琐且易出错。</p>
</li>
</ul>
<h2 data-id="heading-20">5. 栈内存与堆内存的分配机制</h2>
<p>Go的内存分为“栈内存”和“堆内存”，两者的分配机制、访问效率和生命周期完全不同。理解栈和堆的区别，是理解Go内存管理和性能优化的基础。</p>
<h3 data-id="heading-21">5.1 栈内存的核心特性</h3>
<p>栈内存是“线程私有的”，遵循“先进后出”（LIFO）的分配规则，主要用于存储函数的局部变量和参数。</p>
<ul>
<li>
<p><strong>分配与释放</strong>：由编译器自动管理，无需开发者干预。函数调用时，局部变量和参数被压入栈；函数返回时，栈空间自动释放（弹出），效率极高（O(1)时间复杂度）；</p>
</li>
<li>
<p><strong>访问效率</strong>：栈内存是连续的，CPU缓存命中率高，访问速度快；</p>
</li>
<li>
<p><strong>内存大小</strong>：栈内存大小固定（默认几MB），超出会触发“栈溢出”（stack overflow）错误；</p>
</li>
<li>
<p><strong>存储内容</strong>：函数局部变量、参数、返回值等短期存在的变量。</p>
</li>
</ul>
<h3 data-id="heading-22">5.2 堆内存的核心特性</h3>
<p>堆内存是“进程共享的”，没有固定的分配规则，主要用于存储需要长期存在（跨函数调用）的变量。</p>
<ul>
<li>
<p><strong>分配与释放</strong>：由Go的垃圾回收（GC）机制管理。开发者只需申请内存，GC会自动识别并回收“不再被引用”的堆内存，效率低于栈；</p>
</li>
<li>
<p><strong>访问效率</strong>：堆内存是不连续的，CPU缓存命中率低，访问速度比栈慢；</p>
</li>
<li>
<p><strong>内存大小</strong>：堆内存大小不固定（可动态扩展，受限于物理内存），适合存储大数据；</p>
</li>
<li>
<p><strong>存储内容</strong>：跨函数调用的变量、大结构体、切片/map的底层数组等。</p>
</li>
</ul>
<h3 data-id="heading-23">5.3 变量分配在栈还是堆？核心规则</h3>
<p>Go的编译器会通过“逃逸分析”（后续章节讲解）自动决定变量分配在栈还是堆上，核心规则如下：</p>
<ol>
<li>
<p><strong>默认分配在栈上</strong>：函数的局部变量和参数，默认分配在栈上；</p>
</li>
<li>
<p><strong>逃逸到堆上的情况</strong>：</p>
<ul>
<li>
<p>变量被函数返回（跨函数调用，栈空间释放后仍需使用）；</p>
</li>
<li>
<p>变量被指针引用并传递到函数外部（外部可能修改或访问）；</p>
</li>
<li>
<p>变量大小超过栈的限制（如大结构体、大数组）；</p>
</li>
<li>
<p>切片、map、chan的底层数组（因动态扩容，需要灵活的内存空间）。</p>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-24">5.4 代码示例：栈与堆的分配演示</h3>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 变量被返回，逃逸到堆上</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createInt</span><span class="hljs-params">()</span></span> *<span class="hljs-type">int</span> {
    a := <span class="hljs-number">10</span> <span class="hljs-comment">// 因被返回，分配在堆上</span>
    <span class="hljs-keyword">return</span> &amp;a
}

<span class="hljs-comment">// 变量未被返回，分配在栈上</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">useInt</span><span class="hljs-params">()</span></span> {
    b := <span class="hljs-number">20</span> <span class="hljs-comment">// 分配在栈上，函数返回后释放</span>
    fmt.Println(b)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    p := createInt() <span class="hljs-comment">// p指向堆上的变量</span>
    fmt.Println(*p)  <span class="hljs-comment">// 函数返回后仍可访问</span>

    useInt() <span class="hljs-comment">// 函数返回后，b的栈空间释放</span>
}

</code></pre>
<p>验证方法：通过Go编译器的<code>-gcflags="-m"</code>参数查看逃逸分析结果（后续章节详细讲解）：</p>
<pre><code class="hljs language-Plain" lang="Plain">
go run -gcflags="-m" main.go
# command-line-arguments
./main.go:6:2: moved to heap: a // 提示：a变量被移动到堆上
./main.go:12:2: b does not escape // 提示：b变量未逃逸（分配在栈上）
10
20

</code></pre>
<h2 data-id="heading-25">6. 逃逸分析：变量何时分配在堆上</h2>
<p>逃逸分析（Escape Analysis）是Go编译器的核心优化技术，它的作用是“分析变量的生命周期和引用范围”，从而决定变量分配在栈上还是堆上。逃逸分析的目标是“尽可能将变量分配在栈上”（提升效率，减少GC压力），只有在必要时才分配在堆上。</p>
<h3 data-id="heading-26">6.1 逃逸分析的核心原理</h3>
<p>Go编译器在编译阶段进行逃逸分析，主要通过以下规则判断变量是否逃逸：</p>
<ol>
<li>
<p><strong>规则1：变量被返回给外部</strong>：如果变量的指针被函数返回，且外部会使用该指针，变量会逃逸到堆上（栈空间释放后变量仍需存在）；</p>
</li>
<li>
<p><strong>规则2：变量被外部指针引用</strong>：如果变量被存储到外部的指针变量（如全局指针、结构体指针字段）中，变量会逃逸到堆上；</p>
</li>
<li>
<p><strong>规则3：变量大小超过栈限制</strong>：如果变量是大结构体、大数组（大小超过栈的默认限制，通常是几KB），会逃逸到堆上；</p>
</li>
<li>
<p><strong>规则4：动态类型变量</strong>：如interface{}类型的变量（需要动态判断类型），可能逃逸到堆上；</p>
</li>
<li>
<p><strong>规则5：切片、map、chan的底层数据</strong>：切片、map、chan的底层数组/哈希表，因可能动态扩容，默认逃逸到堆上。</p>
</li>
</ol>
<h3 data-id="heading-27">6.2 如何查看逃逸分析结果</h3>
<p>Go提供<code>-gcflags="-m"</code>参数，在编译时输出逃逸分析结果。<code>-m</code>可以重复多次（如<code>-m -m</code>），输出更详细的分析过程。</p>
<p>示例：查看逃逸分析结果</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-comment">// main.go</span>
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
    Age  <span class="hljs-type">int</span>
}

<span class="hljs-comment">// 规则1：返回变量指针，逃逸到堆</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">returnPointer</span><span class="hljs-params">()</span></span> *User {
    u := User{Name: <span class="hljs-string">"Alice"</span>, Age: <span class="hljs-number">25</span>}
    <span class="hljs-keyword">return</span> &amp;u
}

<span class="hljs-comment">// 规则2：变量存储到外部指针，逃逸到堆</span>
<span class="hljs-keyword">var</span> globalPtr *<span class="hljs-type">int</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">storeToGlobal</span><span class="hljs-params">()</span></span> {
    a := <span class="hljs-number">10</span>
    globalPtr = &amp;a
}

<span class="hljs-comment">// 规则3：大数组，逃逸到堆</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">bigArray</span><span class="hljs-params">()</span></span> {
    arr := [<span class="hljs-number">10000</span>]<span class="hljs-type">int</span>{} <span class="hljs-comment">// 大数组，超过栈限制</span>
    arr[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>
}

<span class="hljs-comment">// 规则4：interface{}类型变量，逃逸到堆</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">interfaceVar</span><span class="hljs-params">()</span></span> {
    a := <span class="hljs-number">20</span>
    <span class="hljs-keyword">var</span> i <span class="hljs-keyword">interface</span>{} = a <span class="hljs-comment">// 动态类型，逃逸</span>
    fmt.Println(i)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    p := returnPointer()
    fmt.Println(p)

    storeToGlobal()
    fmt.Println(*globalPtr)

    bigArray()

    interfaceVar()
}

</code></pre>
<p>运行命令查看结果：</p>
<pre><code class="hljs language-Plain" lang="Plain">
go run -gcflags="-m" main.go
# command-line-arguments
./main.go:11:2: moved to heap: u // 规则1：u逃逸到堆
./main.go:18:2: moved to heap: a // 规则2：a逃逸到堆
./main.go:24:2: moved to heap: arr // 规则3：arr逃逸到堆
./main.go:30:2: a escapes to heap // 规则4：a逃逸到堆
./main.go:31:13: i escapes to heap
./main.go:37:13: p escapes to heap
./main.go:40:13: *globalPtr escapes to heap
./main.go:31:14: fmt.Println(i) escapes to heap
./main.go:37:14: fmt.Println(p) escapes to heap
./main.go:40:14: fmt.Println(*globalPtr) escapes to heap
&amp;{Alice 25}
10
20

</code></pre>
<h3 data-id="heading-28">6.3 逃逸分析的实际意义</h3>
<p>逃逸分析对代码性能至关重要，理解它能帮助我们写出更高效的代码：</p>
<ul>
<li>
<p><strong>减少GC压力</strong>：变量分配在栈上，函数返回后自动释放，无需GC回收；若逃逸到堆上，会增加GC的扫描和回收开销；</p>
</li>
<li>
<p><strong>提升访问效率</strong>：栈内存的访问速度比堆快，减少逃逸能提升代码运行速度；</p>
</li>
<li>
<p><strong>避免栈溢出</strong>：大变量逃逸到堆上，避免因栈空间不足导致的栈溢出错误。</p>
</li>
</ul>
<h3 data-id="heading-29">6.4 减少逃逸的优化技巧</h3>
<ul>
<li>
<p><strong>避免返回局部变量的指针</strong>：如果变量无需跨函数使用，尽量返回值而非指针；</p>
</li>
<li>
<p><strong>用值传递代替指针传递（小结构体）</strong>：小结构体（如小于64字节）的值传递开销很小，比指针传递更高效（避免逃逸）；</p>
</li>
<li>
<p><strong>预分配切片/map的容量</strong>：虽然底层数据仍会逃逸，但预分配容量能减少扩容次数，降低GC压力；</p>
</li>
<li>
<p><strong>避免大变量在栈上分配</strong>：大数组、大结构体尽量用切片或指针，让其逃逸到堆上，避免栈溢出。</p>
</li>
</ul>
<h2 data-id="heading-30">7. 指针作为方法接收者的意义</h2>
<p>在Go中，方法的接收者可以是“值类型”或“指针类型”。指针作为方法接收者的核心意义是“修改接收者的值”和“避免值拷贝的开销”，这是Go中面向对象编程的核心特性之一。</p>
<h3 data-id="heading-31">7.1 指针接收者vs值接收者</h3>
<p>两者的核心区别在于“是否能修改接收者的值”和“调用时是否拷贝接收者”：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
    Age  <span class="hljs-type">int</span>
}

<span class="hljs-comment">// 值接收者：方法内部操作的是接收者的副本</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u User)</span></span> UpdateAgeByValue(newAge <span class="hljs-type">int</span>) {
    u.Age = newAge <span class="hljs-comment">// 修改的是副本，不影响原对象</span>
}

<span class="hljs-comment">// 指针接收者：方法内部操作的是接收者的指针（指向原对象）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span></span> UpdateAgeByPointer(newAge <span class="hljs-type">int</span>) {
    u.Age = newAge <span class="hljs-comment">// 修改的是原对象</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    u := User{Name: <span class="hljs-string">"Alice"</span>, Age: <span class="hljs-number">25</span>}

    <span class="hljs-comment">// 调用值接收者方法</span>
    u.UpdateAgeByValue(<span class="hljs-number">30</span>)
    fmt.Println(<span class="hljs-string">"值接收者修改后："</span>, u.Age) <span class="hljs-comment">// 输出：值接收者修改后： 25（无变化）</span>

    <span class="hljs-comment">// 调用指针接收者方法</span>
    u.UpdateAgeByPointer(<span class="hljs-number">30</span>)
    fmt.Println(<span class="hljs-string">"指针接收者修改后："</span>, u.Age) <span class="hljs-comment">// 输出：指针接收者修改后： 30（已修改）</span>

    <span class="hljs-comment">// 注意：Go会自动转换接收者类型</span>
    pu := &amp;u <span class="hljs-comment">// 指针类型</span>
    pu.UpdateAgeByValue(<span class="hljs-number">35</span>) <span class="hljs-comment">// 自动将指针转换为值（拷贝）</span>
    fmt.Println(<span class="hljs-string">"指针调用值接收者："</span>, u.Age) <span class="hljs-comment">// 输出：指针调用值接收者： 30（无变化）</span>

    pu.UpdateAgeByPointer(<span class="hljs-number">35</span>) <span class="hljs-comment">// 直接调用指针接收者</span>
    fmt.Println(<span class="hljs-string">"指针调用指针接收者："</span>, u.Age) <span class="hljs-comment">// 输出：指针调用指针接收者： 35（已修改）</span>
}

</code></pre>
<h3 data-id="heading-32">7.2 指针接收者的使用场景</h3>
<p>指针接收者适合以下场景：</p>
<h4 data-id="heading-33">7.2.1 场景1：需要修改接收者的字段值</h4>
<p>如果方法的核心逻辑是“修改对象的状态”（如更新字段值），必须使用指针接收者：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-keyword">type</span> Counter <span class="hljs-keyword">struct</span> {
    Count <span class="hljs-type">int</span>
}

<span class="hljs-comment">// 指针接收者：修改Count的值</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Counter)</span></span> Increment() {
    c.Count++
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    c := Counter{Count: <span class="hljs-number">0</span>}
    c.Increment()
    c.Increment()
    fmt.Println(<span class="hljs-string">"Count:"</span>, c.Count) <span class="hljs-comment">// 输出：Count: 2</span>
}

</code></pre>
<h4 data-id="heading-34">7.2.2 场景2：接收者是大结构体，避免拷贝开销</h4>
<p>大结构体的值接收者会导致方法调用时拷贝整个结构体，效率极低。指针接收者只需拷贝8字节的地址，大幅提升性能：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"time"</span>
)

<span class="hljs-keyword">type</span> BigStruct <span class="hljs-keyword">struct</span> {
    data [<span class="hljs-number">10000</span>]<span class="hljs-type">int</span>
}

<span class="hljs-comment">// 指针接收者：无拷贝开销</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(bs *BigStruct)</span></span> Process() {
    bs.data[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>
}

<span class="hljs-comment">// 值接收者：每次调用拷贝整个结构体</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(bs BigStruct)</span></span> ProcessByValue() {
    bs.data[<span class="hljs-number">0</span>] = <span class="hljs-number">200</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    bs := BigStruct{}

    <span class="hljs-comment">// 测试指针接收者耗时</span>
    start1 := time.Now()
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ {
        bs.Process()
    }
    fmt.Printf(<span class="hljs-string">"指针接收者耗时：%v\n"</span>, time.Since(start1)) <span class="hljs-comment">// 约0.6ms</span>

    <span class="hljs-comment">// 测试值接收者耗时</span>
    start2 := time.Now()
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++ {
        bs.ProcessByValue()
    }
    fmt.Printf(<span class="hljs-string">"值接收者耗时：%v\n"</span>, time.Since(start2)) <span class="hljs-comment">// 约60ms</span>
}

</code></pre>
<h4 data-id="heading-35">7.2.3 场景3：接收者是接口类型，确保多态一致性</h4>
<p>如果结构体需要实现某个接口，且接口方法的接收者是指针类型，那么只有结构体指针能实现该接口（值类型无法实现）。为了保证多态的一致性，建议统一使用指针接收者：</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// 定义接口</span>
<span class="hljs-keyword">type</span> Updater <span class="hljs-keyword">interface</span> {
    Update()
}

<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
}

<span class="hljs-comment">// 指针接收者实现接口</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u *User)</span></span> Update() {
    u.Name = <span class="hljs-string">"Updated"</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> updater Updater

    <span class="hljs-comment">// 结构体指针实现接口</span>
    u := &amp;User{Name: <span class="hljs-string">"Alice"</span>}
    updater = u
    updater.Update()
    fmt.Println(u.Name) <span class="hljs-comment">// 输出：Updated</span>

    <span class="hljs-comment">// 结构体值无法实现接口（编译错误）</span>
    <span class="hljs-comment">// u2 := User{Name: "Bob"}</span>
    <span class="hljs-comment">// updater = u2 // cannot use u2 (type User) as type Updater in assignment: User does not implement Updater (Update method has pointer receiver)</span>
}

</code></pre>
<h2 data-id="heading-36">8. 内存管理与垃圾回收机制简介</h2>
<p>Go的内存管理核心是“自动内存分配”和“自动垃圾回收（GC）”，开发者无需手动分配和释放内存（不像C/C++需要调用malloc和free），大幅降低了内存泄漏的风险。本节简要介绍Go的内存管理和GC机制，帮助理解底层工作原理。</p>
<h3 data-id="heading-37">8.1 Go的内存分配机制</h3>
<p>Go的内存分配采用“内存池”机制，由运行时（runtime）管理，核心组件包括：</p>
<ul>
<li>
<p><strong>mspan</strong>：内存分配的基本单元，将内存划分为不同大小的块（如8字节、16字节、32字节等），用于存储不同大小的变量；</p>
</li>
<li>
<p><strong>mcache</strong>：每个goroutine私有的缓存，存储小对象（≤32KB）的mspan，减少并发竞争，提升分配效率；</p>
</li>
<li>
<p><strong>mcentral</strong>：全局共享的缓存，管理多个mspan，当mcache没有可用mspan时，从mcentral获取；</p>
</li>
<li>
<p><strong>mheap</strong>：最顶层的内存管理器，管理大对象（&gt;32KB）的分配，同时负责向操作系统申请内存和释放内存。</p>
</li>
</ul>
<p>分配流程简要：</p>
<ol>
<li>
<p>小对象（≤32KB）：优先从当前goroutine的mcache分配；</p>
</li>
<li>
<p>中对象（32KB &lt; 大小 ≤ 1MB）：从mcentral分配；</p>
</li>
<li>
<p>大对象（&gt;1MB）：从mheap分配，直接向操作系统申请连续内存。</p>
</li>
</ol>
<h3 data-id="heading-38">8.2 垃圾回收（GC）的核心原理</h3>
<p>Go的GC核心目标是“回收堆上不再被引用的内存”，当前（Go 1.19+）采用的是“并发标记清除（Concurrent Mark and Sweep, CMS）”算法，核心流程分为三个阶段：</p>
<h4 data-id="heading-39">8.2.1 阶段1：标记准备（STW）</h4>
<p>STW（Stop The World）表示“暂停所有goroutine”，确保内存状态稳定。此阶段会：</p>
<ul>
<li>
<p>暂停所有用户goroutine；</p>
</li>
<li>
<p>初始化标记相关的数据结构；</p>
</li>
<li>
<p>扫描根对象（如全局变量、goroutine的栈变量、寄存器中的指针等），标记为“可达”。</p>
</li>
</ul>
<p>此阶段耗时极短（微秒级），对程序影响很小。</p>
<h4 data-id="heading-40">8.2.2 阶段2：并发标记</h4>
<p>恢复用户goroutine，同时后台GC线程并发扫描堆内存：</p>
<ul>
<li>
<p>从根对象出发，递归扫描所有可达的对象，标记为“可达”；</p>
</li>
<li>
<p>用户goroutine运行时，若修改指针引用（如删除指针、修改指针指向），会通过“写屏障”机制记录变化，确保标记准确性；</p>
</li>
<li>
<p>此阶段用户goroutine和GC线程并发执行，几乎不影响程序运行。</p>
</li>
</ul>
<h4 data-id="heading-41">8.2.3 阶段3：标记终止（STW）+ 并发清除</h4>
<p>再次暂停所有用户goroutine，完成标记收尾工作：</p>
<ul>
<li>
<p>处理写屏障记录的指针变化，确保所有可达对象都被标记；</p>
</li>
<li>
<p>恢复用户goroutine，同时后台GC线程并发清除“未被标记”的对象（释放内存）；</p>
</li>
<li>
<p>清除后的内存会被放回内存池，供后续分配使用。</p>
</li>
</ul>
<h3 data-id="heading-42">8.3 GC的优化方向</h3>
<p>虽然Go的GC已经很高效，但不合理的代码仍可能导致GC压力过大（如频繁创建大对象、内存泄漏）。实际开发中，可通过以下方式优化GC：</p>
<ul>
<li>
<p><strong>减少堆内存分配</strong>：尽量让变量分配在栈上（避免逃逸），减少堆内存的使用；</p>
</li>
<li>
<p><strong>复用对象</strong>：通过对象池（如sync.Pool）复用频繁创建和销毁的对象，减少GC次数；</p>
</li>
<li>
<p><strong>避免内存泄漏</strong>：及时释放不再使用的指针引用（如将切片设为nil、删除map中的无用键值对）；</p>
</li>
<li>
<p><strong>控制大对象的创建</strong>：频繁创建大对象会导致GC扫描和清除开销增大，尽量合并或复用大对象。</p>
</li>
</ul>
<h2 data-id="heading-43">总结</h2>
<p>本章我们深入讲解了Go的指针与内存管理底层机制，核心要点总结如下：</p>
<ol>
<li>
<p>指针：存储变量的内存地址，支持取地址（&amp;）和解引用（*）操作，核心作用是修改外部变量和减少数据拷贝；</p>
</li>
<li>
<p>空指针风险：指针零值为nil，解引用nil会触发运行时错误，需提前判断指针是否为nil；</p>
</li>
<li>
<p>new与make：new为任意类型分配零值内存，返回指针；make仅用于切片、map、chan，返回原类型并初始化；</p>
</li>
<li>
<p>栈与堆：栈内存自动分配释放，效率高；堆内存由GC管理，适合跨函数变量；</p>
</li>
<li>
<p>逃逸分析：编译器自动判断变量分配在栈还是堆，减少逃逸能提升性能、降低GC压力；</p>
</li>
<li>
<p>指针接收者：用于修改结构体字段或减少大结构体拷贝开销，是Go面向对象的核心特性；</p>
</li>
<li>
<p>内存管理与GC：Go通过内存池分配内存，GC采用并发标记清除算法，自动回收堆上无用内存。</p>
</li>
</ol>
<p>指针与内存管理是Go的核心难点，也是写出高效代码的基础。建议多通过<code>-gcflags="-m"</code>查看逃逸分析结果，结合实际代码理解内存分配逻辑。同时，注意避免常见的内存问题（如空指针、内存泄漏），让代码既安全又高效。如果有任何问题，欢迎在评论区交流～</p>
<p>参考链接：</p>
<ul>
<li>
<p>Go官方文档 - 指针：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Pointer_types" target="_blank" title="https://go.dev/ref/spec#Pointer_types" ref="nofollow noopener noreferrer">go.dev/ref/spec#Po…</a></p>
</li>
<li>
<p>Go官方文档 - new与make：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fdoc%2Feffective_go%23allocation_make" target="_blank" title="https://go.dev/doc/effective_go#allocation_make" ref="nofollow noopener noreferrer">go.dev/doc/effecti…</a></p>
</li>
<li>
<p>Go官方博客 - 逃逸分析：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fblog%2Fescape-analysis" target="_blank" title="https://go.dev/blog/escape-analysis" ref="nofollow noopener noreferrer">go.dev/blog/escape…</a></p>
</li>
<li>
<p>Go官方博客 - 垃圾回收：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fblog%2Fismmkeynote" target="_blank" title="https://go.dev/blog/ismmkeynote" ref="nofollow noopener noreferrer">go.dev/blog/ismmke…</a></p>
</li>
<li>
<p>Go运行时源码 - 内存管理：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Ftree%2Fmaster%2Fsrc%2Fruntime" target="_blank" title="https://github.com/golang/go/tree/master/src/runtime" ref="nofollow noopener noreferrer">github.com/golang/go/t…</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 语音开发，Vue 的新选择]]></title>    <link>https://juejin.cn/post/7599843186203459626</link>    <guid>https://juejin.cn/post/7599843186203459626</guid>    <pubDate>2026-01-28T00:43:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599843186203459626" data-draft-id="7599532624194650164" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 语音开发，Vue 的新选择 "/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-28T00:43:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="学什么前端"/> <meta itemprop="url" content="https://juejin.cn/user/3825956194889880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 语音开发，Vue 的新选择 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956194889880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    学什么前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T00:43:37.000Z" title="Wed Jan 28 2026 00:43:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上周，尤雨溪随手转发了一篇推文，但推文的内容却是内有乾坤。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a6c5289fabd4b9ab26cd72170e8d973~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=RXSJndkNPCDpbgjYXAImFZpZ%2BHM%3D" alt="image.png" width="70%" loading="lazy"/></p>
<p><strong>ElevenLabs</strong> 是大名鼎鼎的 AI 音频核心平台，专注于超逼真 AI 语音合成（TTS）的技术公司。</p>
<p>ElevenLabs：核心能力与价值</p>
<ul>
<li><code>语音合成</code>：支持 70 + 语言，v3 模型主打高情感与表现力，Multilingual 系列侧重多语言一致性。</li>
<li><code>声音克隆</code>：可将音频生成专属音色，适用于品牌定制、角色配音等场景。</li>
<li><code>语音代理</code>：通过 SDK 构建可处理客服、预约等任务的语音交互系统，支持多渠道集成。</li>
<li><code>开发者生态</code>：提供 <code>REST API</code> 与 <code>SDK</code>，支持<code>前端</code> / <code>后端</code>灵活调用，快速集成到应用中。</li>
</ul>
<p>其生成的语音，自然度高，情感表现力强，用于<code>有声书</code>、<code>播客</code>、<code>客服语音</code>、<code>内容配音</code>等方面，优势非常明显。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6be7a6599d34c9f80708f073cf6ac3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=pouulvZc%2BKI0oPJD636nX2QlG8w%3D" alt="ElevenLabs" loading="lazy"/></p>
<p>ElevenLabs</p>
<h2 data-id="heading-0">ElevenLabs UI</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2e89ab1af3340fa8e1663f054ca9a19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=pW7WFyfqQoqZ%2BhTEmhbqaoMOrXg%3D" alt="" loading="lazy"/></p>
<p>ElevenLabs 2025 年推出的开源前端组件库，面向 AI 音频和语音代理的开源组件。</p>
<ul>
<li><code>技术背景</code>： 基于 <code>shadcn/ui</code> 构建，支持 <code>React</code>。</li>
<li><code>核心功能</code>： <code>20+</code> 现成的 UI 组件（如：播放器、聊天界面等），让开发者快速构建自己的音频网站和相关功能。</li>
<li><code>开源性质</code>： <code>MIT</code> 许可，可自由使用。</li>
</ul>
<h2 data-id="heading-1">ElevenLabs UI Vue</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b54ac81000c94d4f9ce877e5a53d39b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=i1y4NBTGeFQAlhmjYr0kjFU33OY%3D" alt="" loading="lazy"/></p>
<p>而 <code>ElevenLabs UI Vue</code>，则是 1月22日隆重推出面向 <code>Vue/Nuxt</code> 开发者的 ElevenLabs UI 组件的 Vue 版本🔥</p>
<ul>
<li>基于 <code>shadcn/ui</code>，高度定制化，可以自由修改。</li>
<li>完全支持 <code>Vue3</code> 和 <code>Nuxtjs</code>。</li>
<li>超过 <code>20</code> 个组件和示例，涵盖聊天界面、转录、音乐等领域。</li>
<li>与 ElevenLabs API 无缝集成</li>
<li>兼容 <code>Vite/Webpack</code> 构建工具，支持 <code>TypeScript</code> 类型提示</li>
</ul>
<p><code>ElevenLabs UI Vue</code> 的推出，弥补了 Vue 生态这这一块的缺失。</p>
<h2 data-id="heading-2">如何使用？</h2>
<ol>
<li>将组件源码下载到项目</li>
</ol>

<pre><code class="hljs language-sql" lang="sql">pnpm dlx elevenlabs<span class="hljs-operator">-</span>ui<span class="hljs-operator">-</span>vue<span class="hljs-variable">@latest</span> <span class="hljs-keyword">add</span> orb
</code></pre>
<p>使用 Nuxt 的话，则需要配置 <code>Shadcn-Nuxt</code> 模块</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">export default defineNuxtConfig</span>({
  // ...
<span class="hljs-attr">  modules</span>: [<span class="hljs-string">'shadcn-nuxt'</span>],
<span class="hljs-attr">  shadcn</span>: {
<span class="hljs-attr">    prefix</span>: <span class="hljs-string">''</span>,
<span class="hljs-attr">    componentDir</span>: [
      <span class="hljs-string">'@/components/ui'</span>,
      // Elevenlabs UI
      {
<span class="hljs-attr">        path</span>: <span class="hljs-string">'@/components/elevenlabs-ui'</span>,
<span class="hljs-attr">        prefix</span>: <span class="hljs-string">''</span>,
      },
    ],
  }
})
</code></pre>
<p>2.  使用</p>
<p>现在可以像使用其他 Vue 组件一样将其导入到你的应用中。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Card</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/card"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Orb</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/elevenlabs-ui/orb"</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex items-center justify-center p-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Orb</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>ElevenLabs UI Vue 的组件风格非常简约，有点苹果UI的风格，来看几个具有<code>代表性</code>的组件。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e470416d64014114a39eb176e274334f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=qsyPGfN2rpfkWoYuiurDnGCgv5Q%3D" alt="音频播放器" loading="lazy"/></p>
<p><code>音频播放器</code>：可自定义的音频播放器，带有进度控制和播放管理功能，适用于音乐、播客和语音内容。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59a749c752b046869ae3aaf5b8ae4afe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=5Mo7T4a0KiHmQKm%2FWV4c84gHVTg%3D" alt="音频文本同步" loading="lazy"/></p>
<p><code>音频文本同步组件</code>：用于显示音频转录文本的组件，可与音频播放同步进行逐字高亮显示</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/612e83014622497686b6cbc6bb9e6271~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=VOxkLun9Xqcu5ZTR3rG5AFZvgi0%3D" alt="闪烁文字" loading="lazy"/></p>
<p><code>闪烁文字</code>：使用 Motion 实现带有渐变闪烁效果和视口触发动画的动画文本。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97aceec3861347c38aed75a6a0624c24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=1G2b3qeswZTJfkoBOFjlZ2C3R0o%3D" alt="回复" loading="lazy"/></p>
<p><code>回复</code>：使用 Streamdown 实现<code>流式 Markdown</code> 渲染器，为 AI 响应提供流畅的逐字符动画。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab003776758f47298572d3d03aa90d41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=kIFwF1vAOsENADFtZChHDMqqKfw%3D" alt="音频可视化工具" loading="lazy"/></p>
<p><code>音频可视化工具</code>：适用于语音代理和音频界面的实时音频频率可视化工具，带有基于状态的动画效果。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c3c3b9a2c6a45d2acaec83bd5fde2ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=9BtulEcI2lpYd00kYQUooTAch3I%3D" alt="实时波形" loading="lazy"/></p>
<p><code>实时波形</code>：基于画布的实时音频波形可视化工具，带有麦克风输入和可自定义的渲染模式。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfb6155a4d674cd7a8e522238f790c11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5LuA5LmI5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770165817&amp;x-signature=g%2BoG17xnYfjonTLAwcuZwLI7IYU%3D" alt="音频球体" loading="lazy"/></p>
<p><code>音频球体</code>：使用 <code>Three.js</code> 构建的具有音频响应、自定义颜色和代理状态可视化的 3D 动画球体。</p>
<p>如果你一直想用 Vue/Nuxt 构建音频或语音相关的产品，却没找到合适的组件库，这是一个非常好的选择。</p>
<p>附上地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Felevenlabs-ui-vue.com%2F" target="_blank" title="https://elevenlabs-ui-vue.com/" ref="nofollow noopener noreferrer">elevenlabs-ui-vue.com/</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[推荐两个前端开发 AI Chatbot 的开源代码库]]></title>    <link>https://juejin.cn/post/7600068631327162409</link>    <guid>https://juejin.cn/post/7600068631327162409</guid>    <pubDate>2026-01-28T00:47:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600068631327162409" data-draft-id="7582232291620618278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="推荐两个前端开发 AI Chatbot 的开源代码库"/> <meta itemprop="keywords" content="Node.js,全栈,人工智能"/> <meta itemprop="datePublished" content="2026-01-28T00:47:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端双越老师"/> <meta itemprop="url" content="https://juejin.cn/user/1714893868765373"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            推荐两个前端开发 AI Chatbot 的开源代码库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893868765373/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端双越老师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T00:47:09.000Z" title="Wed Jan 28 2026 00:47:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是双越。前百度 滴滴 资深前端工程师，慕课网金牌讲师，PMP。我的代表作有：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wangeditor.com%2F" target="_blank" title="https://www.wangeditor.com/" ref="nofollow noopener noreferrer">wangEditor</a> 开源 web 富文本编辑器，GitHub 18k star，npm 周下载量 20k</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.huashuiai.com%2F" target="_blank" title="https://www.huashuiai.com/" ref="nofollow noopener noreferrer">划水AI</a> Node 全栈 AIGC 知识库，包括 AI 写作、多人协同编辑。复杂业务，真实上线。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mianshipai.com%2F" target="_blank" title="https://www.mianshipai.com/" ref="nofollow noopener noreferrer">前端面试派</a> 系统专业的面试导航，刷题，写简历，看面试技巧，内推工作。开源免费。</li>
</ul>
<blockquote>
<p>我在正在开发一个 AI Agent 智能体项目【<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhitalk.chat%2F" target="_blank" title="https://zhitalk.chat/" ref="nofollow noopener noreferrer">智语</a>】一个智能面试官，可以优化简历、模拟面试、解答题目等。有兴趣的同学可以围观、学习。</p>
</blockquote>
<h2 data-id="heading-0">开始</h2>
<p>AI 编程的兴起正在大量冲击着编程行业，同时也产生了很多 AI 开发的岗位，需求越来越多。</p>
<p>前端人员可以使用 Nodejs 做全栈开发，也就可以用 Nodejs 做 AI 开发。看所有 AI 大模型接口的文档，python 是第一语言，nodejs 是第二语言。</p>
<p>作 AI 开发，最基础的功能就是 chatbot 聊天机器人。基于 chatbot 我们可以扩展更多模块（如 memory RAG tools MCP system-prompt 等）让它成为一个 agent ，或者做其他定制开发。</p>
<p>Chatbot 既然是一个基础，那就没必要从 0 开发，否则光这一部分你就会浪费掉大量的精力。尤其是前端部分，自己从 0 开发不知道会越到多少 bug ？不知道测试多久才能稳定？</p>
<p>本文就介绍两个常用的 chabot 开源代码库，对应两个最热门的 AI 开发框架。你可以基础这个 chatbot 来二次开发出你自己的 AI 产品。</p>
<h2 data-id="heading-1">langGraph-cli 项目</h2>
<p>如果你使用 langChain 技术栈，可以考虑这个项目。</p>
<p>使用 langChain 自研的脚手架 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcreate-agent-chat-app" target="_blank" title="https://www.npmjs.com/package/create-agent-chat-app" ref="nofollow noopener noreferrer">www.npmjs.com/package/cre…</a></p>
<p>执行如下命令即可创建一个服务端</p>
<pre><code class="hljs language-sql" lang="sql">npx <span class="hljs-keyword">create</span><span class="hljs-operator">-</span>agent<span class="hljs-operator">-</span>chat<span class="hljs-operator">-</span>app<span class="hljs-variable">@latest</span>
</code></pre>
<p>安装完成以后会发现它有 4 个 agent 分别展示不同的使用场景，最基础的就是当前这个 react-agent</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0836ca246c748f18dcd82fa332a6e66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166032&amp;x-signature=H5Rf1n3FV6IKziP5DBS9sHOciLo%3D" alt="image.png" loading="lazy"/></p>
<p>但是现在还不能直接用，它默认的大模型在国内访问不了，我们需要修改为其他大模型，如 deepseek</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fa2c5e4c35f47d28bcf12cd0a2458c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166032&amp;x-signature=1HPNgfD77WebvzqeCWEXY1qgOxs%3D" alt="image.png" loading="lazy"/></p>
<p>在控制台执行 <code>npm run dev</code> 即可启动项目</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4cb05c8e43d4dc08ed283b95eee2299~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166032&amp;x-signature=J8O1pLwWVLOdrpORzQQhYvZlAqc%3D" alt="image.png" loading="lazy"/></p>
<p>然后跟它聊天，点击左上角按钮会展示聊天记录</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d517a22a20ad49e9a95a4bbc4d63a98f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166032&amp;x-signature=yCJb2zzVxoM%2FLNyHqPXJFi2taJU%3D" alt="image.png" loading="lazy"/></p>
<p>其实这个前端部分也是一个独立的项目，是 langChain 官方开发的 chat UI <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Fagent-chat-ui" target="_blank" title="https://github.com/langchain-ai/agent-chat-ui" ref="nofollow noopener noreferrer">github.com/langchain-a…</a></p>
<p>此时，你可以在服务端代码中，使用任何 langChain 和 langGraph 的技术来自定义开发</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de4b9fa1a3ab4da28f20d98139423804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166032&amp;x-signature=mWmZBkHSuiYz91cX1Op9r%2Bkp99Y%3D" alt="image.png" loading="lazy"/></p>
<p>【注意】langChain 版本早就发布到了 v1 ，但这个脚手架创建出来的代码，在写本文时依然是 v0.3 版本，更新太滞后了...</p>
<h2 data-id="heading-2">Vercel AI Chatbot</h2>
<p>除了 langChain 以外，Vercel AI-SDK 也是使用 Nodejs 开发 AI 应用的热门框架，功能已经很完善。</p>
<p>Vercel 为此开发了一个 chatbot template <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fai-chatbot" target="_blank" title="https://github.com/vercel/ai-chatbot" ref="nofollow noopener noreferrer">github.com/vercel/ai-c…</a></p>
<p>并且已经把它部署到这个网址 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.chat-sdk.dev%2F" target="_blank" title="https://demo.chat-sdk.dev/" ref="nofollow noopener noreferrer">demo.chat-sdk.dev/</a> （可能需要科学上网）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d58aabd83434eb291fec7c1b90ef420~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166032&amp;x-signature=q7d7%2FNp3GUVw1od8eO9aZ6wmsOA%3D" alt="image.png" loading="lazy"/></p>
<p>你可以把这个代码库下载到本地，在本地运行。但你还是需要把 AI 大模型改为国内能访问的</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2703e7069834476b4c6aea77f67cbca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166032&amp;x-signature=3ZjQtIWJY3n1VP7vB5oUfiYOJng%3D" alt="image.png" loading="lazy"/></p>
<p>接下来你就可以在进行二次开发，基于 AI-SDK 的语法做任何先做的功能，例如我这了做的 AI 请求 rate limit 限制。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a9d83238640464ba252259d410af2fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Y-M6LaK6ICB5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166032&amp;x-signature=QfniZe7JI4%2BrRRJxw%2BfOr4TX4fQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">最后</h2>
<p>搞 AI 开发重点就应该放在 AI 的流程和业务上，而不是前端 UI 部分，所以尽量使用现成的、稳定的 chatbot 功能，在此基础之上再二次开发。</p>
<p>这两个 chatbot 虽然使用了不同的 AI 框架，但他们都是基于 Nodejs 语言和 Nextjs 框架，所以前端想做 AI 开发，一定要先具备 Nodejs 全栈能力。</p>
<p>如果你有兴趣，不妨先选择一个，在本地运行试一下。有问题可在评论区交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3d拼图我不会，老板：用Cocos做个会动的拼图总可以了吧！]]></title>    <link>https://juejin.cn/post/7599910677578973184</link>    <guid>https://juejin.cn/post/7599910677578973184</guid>    <pubDate>2026-01-28T00:50:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599910677578973184" data-draft-id="7599873006258831394" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3d拼图我不会，老板：用Cocos做个会动的拼图总可以了吧！"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-28T00:50:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3d拼图我不会，老板：用Cocos做个会动的拼图总可以了吧！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T00:50:27.000Z" title="Wed Jan 28 2026 00:50:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cace3d14b8194b2bb9d818a6c2315b68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=tg%2Fk8SnxYY%2FgEJ4PdU2GWsSoxM4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，我是亿元程序员，上次老板让做<code>3d</code>拼图的那个小伙伴又双叒叕来了：</p>
<blockquote>
<p><strong>亿哥</strong>，我又双叒叕来了，<code>3d</code>拼图太难了，我这没有经验实在做不出来（捂脸）。</p>
<p><strong>幸好</strong>老板没有一意孤行，但是无论如何都让我做个变种的拼图出来：做个会动的<code>spine</code>拼图总可以了吧！</p>
<p><strong>大佬</strong>给我支支招，<code>spine</code>可以动态分割吗？</p>
</blockquote>
<p><strong>spine骨骼动画？</strong>，果然人的思维能力是无穷无尽的，一个拼图游戏都玩出花了。</p>
<p><strong>spine</strong>动态分割的方法应该有很多，笔者想到了通过<code>RTT</code>的方法。</p>
<p><strong>言归正传</strong>，本期带大家一起来看看，在<code>Cocos</code>游戏开发中，<strong>如何通过RTT动态分割spine骨骼动画</strong>。</p>
<p><strong>本文源工程可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">什么是RTT？</h2>
<blockquote>
<p><strong>RenderToTexture</strong>是将场景 / 节点的渲染结果输出到一张纹理（Texture） 而非直接显示在屏幕上。</p>
<p><strong>你可以</strong>把它理解成“给指定的游戏内容拍一张‘数字照片’，并把这张照片保存成可复用的纹理资源”。</p>
</blockquote>
<p><strong>我们</strong>可以通过<code>RTT</code>动态将<code>spine动画</code>渲染到纹理上，然后通过<code>Sprite</code>显示出来。</p>
<p><strong>那么问题来了，我们如何在游戏开发中使用RTT？</strong></p>
<h2 data-id="heading-2">RTT的使用</h2>
<p><strong>1.资源准备</strong></p>
<p><strong>既然是</strong>动态分割<code>spine</code>动画，我们需要准备一个<code>spine</code>动画，大家熟悉的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6721399d1ae45a4ae8755a9807ffb88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=1fVL%2F%2FAW0qYtoHpoH%2BNqHXgpTMk%3D" alt="" loading="lazy"/></p>
<p><strong>直接运行</strong>就能看到效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce26c11173184e94b397cb1d666a423c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=6uFRT745MwTTZKoE2x8Inlz7Fow%3D" alt="" loading="lazy"/></p>
<p><strong>2.创建渲染纹理</strong></p>
<p><strong>我们</strong>可以通过资源管理器<code>assets</code>目录右键创建一个渲染纹理(<code>RenderTexture</code>)：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ea3d153014d43baad593962b40c3e08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=lIBFe9I6UFSuEI4S8XVXzZLMpiw%3D" alt="" loading="lazy"/></p>
<p><strong>调整</strong>合适的大小。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cee1053818b549148a04316ee5e9eef0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=C2aFjr6Koq9hZsGV4ngZ6y1UsZw%3D" alt="" loading="lazy"/></p>
<p><strong>3.创建相机</strong></p>
<p><strong>我们</strong>需要借助相机，把相机的画面渲染到渲染纹理，于是我们在<code>spine</code>节点下创建一个：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9519e516785b441f93253d11fec6d625~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=mHw8zF1AbD5unOIiAkI8e1wxwRU%3D" alt="" loading="lazy"/></p>
<p><strong>修改</strong>相机的<code>Visibility</code>属性去掉<code>DEFAULT</code>，否者会有警告。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/210722ff9ee84c3495be3eb6c03fd214~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=qN6LX1L03H6WJXZvADCX%2BIcHLlw%3D" alt="" loading="lazy"/></p>
<p><strong>然后</strong>在属性面板调整位置、正交大小等参数，让相机完全拍到<code>spine</code>动画，把背景颜色设置成白色便于观看区分。</p>
<p><strong>设置</strong><code>Target Texture</code>为我们刚创建的<code>RenderTexture</code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8e2fe59c2c84513aa4823336d681ff9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=5JFwK3%2BrnsibB%2FgJOx14%2FhmyEag%3D" alt="" loading="lazy"/></p>
<p><strong>为了</strong>避免<code>spine</code>动画被原相机拍到，我们可以调整位置，将它移出到画面外：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b49815b14ef24d34bca62688469d9b31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=56pL4Pzts7QhkEK3H%2BBvcIfCy1k%3D" alt="" loading="lazy"/></p>
<p><strong>4.创建Sprite</strong></p>
<p><strong>我们</strong>可以直接把<code>RenderTexture</code>拖到场景中，会自动创建一个<code>Sprite</code>组件，并且自动将<code>RenderTexture</code>作为图片资源。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b22a28832efc4827bb169e63c3399fa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=lradT3TzRVPFDntaw0y9OB%2FhFm8%3D" alt="" loading="lazy"/></p>
<p><strong>属性</strong>如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48ba13a42c274b09a1bd31d38469d410~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=JeM58aozWuVUOWupE8XXBtVOcDQ%3D" alt="" loading="lazy"/></p>
<p><strong>5.查看效果</strong></p>
<p><strong>直接运行</strong>就能看到效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7b0c49c5ccc468baaa29aa5e9177df0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=HeXQob%2B8E5FrdNewfR3RSSea8lk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">动态分割</h2>
<p><strong>有了</strong><code>SpriteFrame</code>之后，我们就可以按照之前动态分割图片的逻辑进行分割了。</p>
<p><strong>首先</strong>创建一个脚本，拿到<code>Sprite</code>引用，定义行列数和间隙：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f856e95a54d14692a059e756d7447c7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=WL79%2BW3Az1Dm8B4m74yxRCID9pU%3D" alt="" loading="lazy"/></p>
<p><strong>然后</strong>按照之前动态分割拼图的原理分割即可：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5a87a8eae0f4f2092aeb66a0dd8db91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=g2JvVa%2BEEodMcBXfdV4JE7oRobk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">效果演示</h2>
<p><strong>最终效果</strong>如下，可以看到<code>spine</code>已经被成功分割，剩下游戏逻辑因为和之前一样，我们就不重复了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c02508c92c894562a2e7f7cc30a0bc9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166227&amp;x-signature=lElBjnENmddCSsbF63rAwRk1JOA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">结语</h2>
<p><strong>这样的动态拼图</strong>市面上好像还没有，会成为下一个变种的模仿对象吗？</p>
<p><strong>小伙伴们</strong>，你们都学会了吗？</p>
<p><strong>本文完整源码</strong>可以点赞后通过私信<code>puzzlespine</code>获取。</p>
<p><strong>更多实用源码</strong>可以通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a>获取，感谢支持。</p>
<hr/>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXLCknL3fJDubec2GW6KLFA" target="_blank" title="https://mp.weixin.qq.com/s/XLCknL3fJDubec2GW6KLFA" ref="nofollow noopener noreferrer">Cocos游戏如何接入安卓穿山甲广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3_VrSld4KnDKY_7hxjSoKg" target="_blank" title="https://mp.weixin.qq.com/s/3_VrSld4KnDKY_7hxjSoKg" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Lj24VHJ-pL8z82hHqQLiA" target="_blank" title="https://mp.weixin.qq.com/s/0Lj24VHJ-pL8z82hHqQLiA" ref="nofollow noopener noreferrer">Cocos游戏如何快速接入抖音小游戏广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ7DusUJA2v1IFZDFtBsueg" target="_blank" title="https://mp.weixin.qq.com/s/Z7DusUJA2v1IFZDFtBsueg" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现割绳子游戏效果</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现动态切割模型？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZIph332u_r24OTY4r6_jow" target="_blank" title="https://mp.weixin.qq.com/s/ZIph332u_r24OTY4r6_jow" ref="nofollow noopener noreferrer">Cocos游戏开发中的贴花效果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 写的页面巨丑？试试禁用 Tailwind]]></title>    <link>https://juejin.cn/post/7599868109085949994</link>    <guid>https://juejin.cn/post/7599868109085949994</guid>    <pubDate>2026-01-28T00:59:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599868109085949994" data-draft-id="7600068631327227945" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 写的页面巨丑？试试禁用 Tailwind"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-28T00:59:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 写的页面巨丑？试试禁用 Tailwind
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T00:59:46.000Z" title="Wed Jan 28 2026 00:59:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前几天我在实现一个前端页面时，碰到 <code>AI</code> 生成页面巨丑，并且花费半天、对话n轮，却怎么都优化不过来的情况。</p>
<p>今天就分享给大家，希望可以给你一些灵感。</p>
<p>下面是优化n轮，不理想的界面效果，下面以签到展示为例。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d910e8f800434d7f8eab371e2a8ae0f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166789&amp;x-signature=OvYzbZSZmUpakPjhLWjNGXtjYVo%3D" alt="抽奖（旧）" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6125b0820d4d437da7435d28288a7f68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166789&amp;x-signature=BGpoYPGnGVX5z2XYWLNf70kGJTA%3D" alt="Demo投票（旧）" loading="lazy"/></p>
<p>新建对话，切换IDE/SOLO模式，更换模型都尝试了，但都是一些边角的优化，整体布局一直如此。</p>
<p>我甚至已经怀疑当时的大模型是不是抽风了。</p>
<p>但作为一个天天给小伙伴分享“<strong>如果 AI 效果不佳，请仔细考虑是否正确使用</strong>”的人，我能怪 <code>AI</code> 吗？</p>
<p>那必然不行，于是，我人肉看代码去了。</p>
<p>还真让我发现了一个之前没有注意的点。</p>
<p>由于这个项目界面风格比较自由，因此初版提示词并<strong>未限定技术栈</strong>，而 <code>AI</code> 也不出意外地选择了自己最喜欢的 <code>Tailwind</code>，我平时没有用过 <code>Tailwind</code>。</p>
<p>为什么注意到它呢，因为做这个界面的前两天，刚看了 <code>Tailwind</code> 裁员 <code>75%</code> 的事情，印象很深。</p>
<p>基于多年的编程直觉，我感觉它是个变数，就试了试。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7aa01a34d81b4c2795aeb640b0cb5c83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166789&amp;x-signature=3t%2FTSZjg9nfzt%2BENOO0I4rvpwEU%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs">CheckInDisplay.vue 最近几次优化都是基于
tailwind优化的，效果很差。
请忘记tailwind直接发挥你的全力，通过自定
义css效果进行美化，但需要与
HomePage.vue 风格一致。
</code></pre>
<p>结果，竟然真的摆脱了前面一直绕不出去的丑陋风格。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcc39100763d405697751f820f976988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166789&amp;x-signature=GE%2FTvIA2QoyikSmDhWAI3HoxSBI%3D" alt="抽奖（新）" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c559b281e1494c16af9b67d0c6d85b24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166789&amp;x-signature=cjGW3DhfXdPZy5r%2FkEwE5O72Xl4%3D" alt="Demo投票（新）" loading="lazy"/></p>
<p>后来我想了想，好像也说的通。</p>
<p><code>Tailwind</code> 的原子化设计哲学擅长快速搭建<strong>一致性</strong>的系统 <code>UI</code>，但在需要打破网格、自定义动效或微妙留白的<strong>高设计感场景</strong>中，这些反而成了 <code>AI</code> 的<strong>束缚</strong>。</p>
<p>因此，如果你想要<strong>界面更具设计感，更加漂亮，可以考虑让 <code>AI</code> 采用原生 <code>CSS</code> 去发挥</strong>，也许会有意外效果呢~</p>
<p>当时没有截图，为了更好的阅读效果，我重新拉取了好多版代码才找回错误的界面，支持一下不过分吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI产品中关于【思考】能力的发展和应用方式]]></title>    <link>https://juejin.cn/post/7599843186203410474</link>    <guid>https://juejin.cn/post/7599843186203410474</guid>    <pubDate>2026-01-27T23:49:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599843186203410474" data-draft-id="7599826983887880235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI产品中关于【思考】能力的发展和应用方式"/> <meta itemprop="keywords" content="产品,产品经理,面试"/> <meta itemprop="datePublished" content="2026-01-27T23:49:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="华洛"/> <meta itemprop="url" content="https://juejin.cn/user/4230576474430190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI产品中关于【思考】能力的发展和应用方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576474430190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    华洛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T23:49:23.000Z" title="Tue Jan 27 2026 23:49:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>当”思考“不是一个能力，而是一个工具时，我们的Agent会产生什么变化？</strong></p>
<p>最近在产品设计中引入了AI的【思考】工具， 这里“思考”不是作为一个能力被使用，而是作为一个工具被使用。【一个思考工具】不可思议吧？</p>
<p>这是今年 3 月，Anthropic提出的概念，能够将思考从“预设思考”转向“动态思考”， 并且实现复杂度极低。</p>
<p>本文我希望把大模型的“思考”发展史从宏观上讲述一下模型从<code>无思考的对话模型</code>到<code>Cot思维链的应用</code>再到<code>深度思考模型的诞生</code>最后到<code>思考工具的应用</code>。</p>
<p>我们重点讲一下对【思考】工具的使用，当“思考”不再是一个能力，而变成一个工具时，会给我们的Agent带来什么变化？</p>
<p>让我们回到一开始，chatGPT才刚刚开始爆火。</p>
<h2 data-id="heading-0">对话模型</h2>
<p>此时，AI是没有我们现在所定义的“思考”能力的，在 AI 发展的早期阶段，大语言模型主要依赖预训练时学到的模式进行直接输出。这些模型虽然能够生成流畅的文本，但在面对需要逻辑推理、多步骤分析或复杂决策的问题时，往往显得力不从心，我们也遇到了一些令人头疼的问题：</p>
<ul>
<li>
<p>逻辑漏洞频发：在需要多步骤推理的数学问题或逻辑题中，容易出现前后矛盾的回答</p>
</li>
<li>
<p>直接跳跃到答案：面对复杂问题时，模型倾向于直接给出结论，缺少中间的推理步骤</p>
</li>
<li>
<p>透明度不足：我无法了解模型的思考过程，只能看到最终结果。</p>
</li>
</ul>
<p>这些问题，直观的展示就是：<strong>在复杂问题上的提示词调优非常困难。</strong></p>
<p>我们不知道AI是如何想的，他为什么不按照我的要求执行，又为什么会得到当前的这个答案。</p>
<p>一个经典问题就是数学题的计算，所有模型都无法正确的计算稍微复杂一些的计算题。</p>
<p>思维链（Chain of Thought, CoT）就诞生在这样的一个场景下。</p>
<h2 data-id="heading-1">COT</h2>
<p>2022 年，Google Brain 团队提出了革命性的思维链提示技术（Chain of Thought Prompting, CoT）。这项技术的核心思想是：<strong>鼓励 AI 模型像人类一样，将复杂的推理过程分解为多个中间步骤，而不是直接跳到最终答案。</strong></p>
<p>思维链（CoT）提示词是一种引导大型语言模型在处理困难问题时遵循推理过程的技术。</p>
<p>通常是<strong>通过向模型展示几个清晰的步骤推理示例来实现</strong>。我们期望模型能够遵循这种“思路链”推理，最终得出正确答案。</p>
<p>尤其是当任务涉及复杂的推理，需要算术、常识和符号推理时，<code>CoT</code> 是理想的选择;</p>
<p>简单说：当模型需要理解并遵循中间步骤以得出正确答案。我们就要使用 <code>CoT</code>。</p>
<p>使用CoT时，需要主要 <code>CoT</code> 和 <code>few-shot</code> 的区别：</p>
<ol>
<li>few-shot在提示词中向模型展示的是答案。</li>
<li>COT在提示词中向模型展示的是过程。</li>
</ol>
<p>这意味着，我们在编写 <code>CoT</code> 提示词时，更重要是<strong>清晰的表述任务过程</strong>。</p>
<p>需要注意的是，<code>CoT</code> 不一定会100%成功的，我们大致会遇到这三种场景：</p>
<ol>
<li><code>CoT</code> 完美的执行了，并且得到了预期的答案</li>
<li><code>CoT</code> 完美的执行了，但是得到的答案是非预期的</li>
<li><code>CoT</code> 执行路径错误，（结果无所谓，模型已经不遵守我们的指令了）。</li>
</ol>
<p>而我们的解决方案是：其实没有什么特别完美的解决方案😂，现行的解决方案核心原则是：<strong>从单纯的Cot向结构化的、针对性的策略转移</strong>，例如：</p>
<ul>
<li>ToT（Tree of Thought 思维树）</li>
<li>分层Cot（拆分任务）</li>
<li>一致性检查（额外分析是否按照要求进行任务执行）</li>
</ul>
<p>但无一例外，这都增加了tokens成本与时间成本。</p>
<h2 data-id="heading-2">深度思考</h2>
<p>深度思考的出现，对于我们来说更重要的是带来的：<strong>理念升级</strong>。</p>
<p>在 <code>CoT</code> 技术基础上，AI 思考能力进入了“深度思考”阶段。这一阶段的标志是 AI 不仅能够展示推理过程，还能够进行更深入、更长时间的内部思考，类似于人类的深度思考过程。</p>
<p>简单说就是：<strong>CoT像是"用户教模型如何思考"的说明书，而深度思考模型是"模型自己学会如何思考"的能力。前者依赖提示工程，后者是模型内在能力的体现。</strong></p>
<p>深度思考阶段，有两个很重要的里程碑：</p>
<p>一、OpenAI-o1首次将推理能力大规模应用到通用任务，在工程上验证了深度思考的可行性：</p>
<p>o1（2024年9月发布）：OpenAI首个公开的推理优化模型，首次大规模验证了强化学习在复杂推理任务中的有效性，在数学、编程等基准测试中显著超越前代模型，确立了"推理模型"这一新范式。</p>
<p>二、deepseek-R1采用纯RL路径的开创性探索，以及完整的开源生态建设：</p>
<p>R1（2025年1月发布）：DeepSeek的开源推理模型，其突破在于证明了纯强化学习路径（无需监督微调）也能达到强大推理能力，并首次完整开源了技术细节和训练方法，推动了推理模型的可复现研究</p>
<p>到今天（26/1），深度思考模型已经不再是单独的模型，而是可以通过参数来控制同一个模型是否启用深度思考。</p>
<blockquote>
<p>ps: deepseek-R1，也早就被官方放弃，目前deepseek的深度思考模式，使用的是deepseek-v3.2的深度思考能力。</p>
</blockquote>
<p>此时的深度思考能力，依然有着让我们很头疼的地方：耗时太长、tokens消耗太多。</p>
<h2 data-id="heading-3">思考工具</h2>
<p>2025 年 3 月，Anthropic 公司推出了革命性的<code>思考工具（Think Tool）</code>，这是 AI 思考能力发展的最新阶段。</p>
<p>这一工具的推出标志着 AI 思考从<code>预设思考</code>转向<code>动态思考</code>，尤其是在复杂领域的任务取会有更好的效果。</p>
<p>思考工具的实现复杂度极低，就是<code>function call</code>技术的应用。但是与之前的<code>深度思考</code>不同，思考工具具有以下独特特征：</p>
<ul>
<li>过程中的停顿：AI 可以在生成答案的过程中随时停下来思考</li>
<li>专用思考空间：为结构化思考创造独立的思考环境</li>
<li>实时策略调整：根据新信息动态调整思考方向</li>
<li>相比于深度思考，没有超级长的时间损耗。</li>
</ul>
<p><strong>思考工具提示词如下：</strong></p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"think"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"使用此工具进行思考。它不会获取新信息或对代码库进行任何更改，仅会记录想法。当需要进行复杂推理或头脑风暴时使用它。例如，如果您探索代码库并发现了某个错误的根源，可调用此工具来头脑风暴几种独特的修复方法，并评估哪些更改可能最简单且最有效。或者，如果您收到一些测试结果，可调用此工具来头脑风暴修复失败测试的方法。"</span>,
  
  <span class="hljs-string">"input_schema"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"thought"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
        <span class="hljs-string">"description"</span>: <span class="hljs-string">"您的想法内容"</span>
      }
    },
    <span class="hljs-string">"required"</span>: [<span class="hljs-string">"thought"</span>]
  }
}
</code></pre>
<p>这里和我们常见的工具有个非常不一样的点，我们常见的工具中<code>properties</code>字段下面是需要让AI给我们提取出来的工具的参数，例如：</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"add"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"一个计算两数相加的加法工具"</span>,
  <span class="hljs-string">"input_schema"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"a"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
        <span class="hljs-string">"description"</span>: <span class="hljs-string">"第一个数字"</span>
      }
      <span class="hljs-string">"b"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
        <span class="hljs-string">"description"</span>: <span class="hljs-string">"第二个数字"</span>
      }
    },
    <span class="hljs-string">"required"</span>: [<span class="hljs-string">"thought"</span>]
  }
}
</code></pre>
<p>在这个加法工具中，<code>a</code>和<code>b</code>是两个数字，这俩数字是AI从用户的query或者上下文中提取出来的，一个明确的信息。</p>
<p>而在我们的思考工具中，<code>thought</code>这个字段，是AI通过工具描述，结合阅读上下文，思考出来的内容，如图：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11b234294723457fad1362164e5d24eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2O5rSb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770162562&amp;x-signature=EnY%2FhoZvMQ%2BRmm09XTnFRk6p%2FtA%3D" alt="fc.png" width="100%" loading="lazy"/>
<p>此时<code>thought</code>的内容，就是深度思考的结果。</p>
<p>而思考作为一个工具来使用时，我们可以随时随地的在我们想要使用的Agent节点中使用。</p>
<p>此外，我们还可以再系统提示词中添加对应的CoT提示词，来增加思考工具的执行效果。</p>
<p>当我们的任务较长和/或复杂时，将“思考”工具与优化提示词结合，在系统提示中包含关于“思考”工具的说明，比直接放在工具描述中更有效。</p>
<p>这种方法提供了更广泛的背景，帮助模型更好地将思维过程融入整体行为中。提示词示例：</p>
<pre><code class="hljs language-md" lang="md">使用思考工具
在采取任何行动或根据工具结果回复用户之前，请将思考工具作为草稿纸来：

列出适用于当前请求的具体规则

检查是否已收集所有必需信息

验证计划中的行动是否符合所有政策

对工具结果进行反复推敲以确保其正确性

以下是在思考工具内需要反复推敲的一些示例：

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">think_tool_example_1</span>&gt;</span></span>
用户希望取消航班ABC123

需要核实：用户ID、预订ID、原因

检查取消规则：

是否在预订后24小时内？

如果不是，则检查机票舱位和保险

确认无航段已使用或属于过去时段

计划：收集缺失信息，核实规则，获取确认
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">think_tool_example_1</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">think_tool_example_2</span>&gt;</span></span>
用户想预订3张前往纽约的机票，每人2件托运行李

需要用户ID来检查：

会员等级对应的行李额度

个人资料中存在的付款方式

行李计算：

经济舱 × 3名乘客

如果是普通会员：每人1件免费行李 → 额外3件行李 = $150

如果是银卡会员：每人2件免费行李 → 无额外行李 = $0

如果是金卡会员：每人3件免费行李 → 无额外行李 = $0

需要验证的支付规则：

最多1张旅行券、1张信用卡、3张礼品卡

所有支付方式必须存在于个人资料中

旅行券的余额将作废

计划：

获取用户ID

根据会员等级核实行李费用

检查个人资料中有哪些支付方式及其组合是否被允许

计算总价：机票价格 + 任何行李费用

获取明确的预订确认
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">think_tool_example_2</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-4">结语</h2>
<p>本文是可以拆成四篇文章分开写的，但是拆开之后不利于读者在宏观视角上的认知提升，最终还是决定放到一篇文章中。</p>
<p>最后总结一下四个方案在我们的AI产品中的选择，要根据我们的需求，动态的调整应用方案：</p>
<p><strong>对话模型</strong>：直接模式匹配和输出、成本最低，响应最快, 当我们对响应时间有要求时，首选对话模型</p>
<p><strong>CoT</strong>：引导的逐步推理、中等成本，需要编写Cot提示词，整体效果不如深度思考，当我们需要一些简单的思考输出，又不想承担太多的时间成本和推理成本时，可以选择CoT</p>
<p><strong>深度思考</strong>：内置的复杂推理能力、高成本、长时间推理，当我们要做一些任务类型的Agent设计时，我们对响应时间要求不是特别高，但是对结果要求很高时，可以选择深度思考</p>
<p><strong>思考工具</strong>：实时的策略调整和反思、成本可控，需要使用者对Agent流程有把控能力，在正确的节点使用思考工具，可以提高效果，并更少的承担深度思考所带来的缺陷。</p>
<p>我是华洛，关注我，学习更多AI落地的实战经验与技巧。</p>
<p>加油，共勉。</p>
<blockquote>
<p>☺️你好，我是<strong>华洛</strong>，All in AI多年，专注于AI在产品侧的应用以及企业AI员工的设计。</p>
</blockquote>
<h2 data-id="heading-5">专栏文章</h2>
<p><a href="https://juejin.cn/post/7583507286317465600" target="_blank" title="https://juejin.cn/post/7583507286317465600"># 为啥你学AI学来学去学不明白！</a></p>
<p><a href="https://juejin.cn/post/7547051639740743721" target="_blank" title="https://juejin.cn/post/7547051639740743721"># SEO还没死，GEO之战已经开始</a></p>
<p><a href="https://juejin.cn/post/7497890801348821055" title="https://juejin.cn/post/7497890801348821055" target="_blank"># 从0到1打造企业级AI售前机器人——实战指南二：RAG工程落地之数据处理篇🧐</a></p>
<p><a href="https://juejin.cn/post/7496397558358900790" title="https://juejin.cn/post/7496397558358900790" target="_blank"># 从0到1打造企业级AI售前机器人——实战指南一：根据产品需求和定位进行agent流程设计🧐</a></p>
<p><a href="https://juejin.cn/post/7492271537010671635" title="https://juejin.cn/post/7492271537010671635" target="_blank"># 聊一下MCP，希望能让各位清醒一点吧🧐</a></p>
<p><a href="https://juejin.cn/post/7485727472999579659" title="https://juejin.cn/post/7485727472999579659" target="_blank"># 实战派！百万PV的AI产品如何搭建RAG系统？</a></p>
<p><a href="https://juejin.cn/post/7482695183477047315" title="https://juejin.cn/post/7482695183477047315" target="_blank"># 团队落地AI产品的全流程</a></p>
<p><a href="https://juejin.cn/post/7474925725662969883" title="https://juejin.cn/post/7474925725662969883" target="_blank"># 5000字长文，AI时代下程序员的巨大优势！</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL索引优化：从入门到实战]]></title>    <link>https://juejin.cn/post/7599852042530668554</link>    <guid>https://juejin.cn/post/7599852042530668554</guid>    <pubDate>2026-01-28T01:01:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852042530668554" data-draft-id="7599852636530016291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL索引优化：从入门到实战"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2026-01-28T01:01:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL索引优化：从入门到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T01:01:40.000Z" title="Wed Jan 28 2026 01:01:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MySQL索引优化：从入门到实战</h2>
<h3 data-id="heading-1">一、为什么需要索引优化？</h3>
<p>在实际开发中，我们经常遇到这样的场景：一条SQL查询语句在数据量小时执行飞快，但随着数据增长，查询速度越来越慢，甚至成为系统性能瓶颈。这时候，索引优化就成为了提升数据库性能的关键手段。</p>
<h4 data-id="heading-2">真实案例对比</h4>
<p>假设我们有一张用户表user，包含1000万条记录：</p>
<p><strong>没有索引的查询：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> mobile <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span>;
</code></pre>
<p>执行时间：<strong>8.5秒</strong></p>
<p><strong>添加索引后的查询：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_mobile <span class="hljs-keyword">ON</span> <span class="hljs-keyword">user</span>(mobile);

<span class="hljs-comment">-- 再次执行同样的查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> mobile <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span>;
</code></pre>
<p>执行时间：<strong>0.003秒</strong></p>
<p><strong>性能提升：2800倍！</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65ccb55767eb40d5b2825b3c261ca75b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166900&amp;x-signature=KXO5xkulJte73gWax3Yj0kCzkiI%3D" alt="" loading="lazy"/></p>
<p>这就是索引的威力。</p>
<h3 data-id="heading-3">二、MySQL索引类型全解析</h3>
<h4 data-id="heading-4">2.1 主键索引（PRIMARY KEY）</h4>
<p>主键索引是唯一索引的一种特殊形式，每个表只能有一个主键，主键列的值不能为NULL。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)
);
</code></pre>
<p><strong>特点：</strong></p>
<ul>
<li>唯一性约束</li>
<li>非空约束</li>
<li>自动聚簇索引（InnoDB引擎）</li>
</ul>
<h4 data-id="heading-5">2.2 唯一索引（UNIQUE INDEX）</h4>
<p>唯一索引要求索引列的值必须唯一，但允许有空值（空值不参与唯一性比较）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">UNIQUE</span>,
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
    <span class="hljs-keyword">UNIQUE</span> KEY idx_email (email)
);

<span class="hljs-comment">-- 或使用ALTER TABLE添加</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_username (username);
</code></pre>
<p><strong>使用场景：</strong></p>
<ul>
<li>用户名</li>
<li>邮箱地址</li>
<li>身份证号</li>
<li>手机号</li>
</ul>
<h4 data-id="heading-6">2.3 普通索引（INDEX）</h4>
<p>普通索引是最基本的索引类型，没有任何约束，主要用于加速查询。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    user_id <span class="hljs-type">BIGINT</span>,
    order_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
    create_time DATETIME,
    INDEX idx_user_id (user_id),
    INDEX idx_create_time (create_time)
);

<span class="hljs-comment">-- 或使用ALTER TABLE添加</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_order_no (order_no);
</code></pre>
<h4 data-id="heading-7">2.4 组合索引（COMPOSITE INDEX）</h4>
<p>组合索引是在多个列上创建的索引，遵循"最左前缀原则"。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建组合索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_status_time <span class="hljs-keyword">ON</span> orders(user_id, status, create_time);

<span class="hljs-comment">-- 这些查询可以使用索引</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>;

<span class="hljs-comment">-- 这个查询无法使用索引（跳过了user_id）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>;
</code></pre>
<p><strong>最左前缀原则详解：</strong></p>
<p>组合索引 (a, b, c) 相当于创建了三个索引：</p>
<ul>
<li>(a)</li>
<li>(a, b)</li>
<li>(a, b, c)</li>
</ul>
<p>查询条件必须包含最左侧的列a，索引才能生效。</p>
<h4 data-id="heading-8">2.5 全文索引（FULLTEXT INDEX）</h4>
<p>全文索引用于对文本内容进行搜索，仅支持CHAR、VARCHAR和TEXT类型。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> articles (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),
    content TEXT,
    FULLTEXT INDEX idx_title_content (title, content)
) ENGINE<span class="hljs-operator">=</span>InnoDB;

<span class="hljs-comment">-- 使用全文索引</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> articles
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(title, content) AGAINST(<span class="hljs-string">'MySQL 索引优化'</span> <span class="hljs-keyword">IN</span> <span class="hljs-keyword">NATURAL</span> <span class="hljs-keyword">LANGUAGE</span> MODE);
</code></pre>
<p><strong>使用场景：</strong></p>
<ul>
<li>文章搜索</li>
<li>商品描述搜索</li>
<li>评论内容搜索</li>
</ul>
<h4 data-id="heading-9">2.6 空间索引（SPATIAL INDEX）</h4>
<p>空间索引用于地理空间数据的存储和查询。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> locations (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
    coordinates POINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    SPATIAL INDEX idx_coordinates (coordinates)
) ENGINE<span class="hljs-operator">=</span>MyISAM;

<span class="hljs-comment">-- 查找附近的位置</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> locations
<span class="hljs-keyword">WHERE</span> ST_Distance_Sphere(coordinates, ST_GeomFromText(<span class="hljs-string">'POINT(116.404 39.915)'</span>)) <span class="hljs-operator">&lt;</span> <span class="hljs-number">1000</span>;
</code></pre>
<h3 data-id="heading-10">三、索引存储结构</h3>
<h4 data-id="heading-11">3.1 B+树索引（InnoDB默认）</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c61e69d37864e6cbe234e35709b7df9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166900&amp;x-signature=Qde8Jf9rKlu4GkPYJU%2FcJKVtuWI%3D" alt="" loading="lazy"/></p>
<p>B+树是MySQL InnoDB引擎的默认索引结构，具有以下特点：</p>
<p><strong>优势：</strong></p>
<ul>
<li>查询效率稳定（O(log n)）</li>
<li>范围查询性能好</li>
<li>支持高并发</li>
<li>树的高度低（通常3-4层）</li>
</ul>
<p><strong>B+树查找过程：</strong></p>
<ol>
<li>从根节点开始</li>
<li>比较查找值与节点值</li>
<li>选择合适的子节点继续查找</li>
<li>到达叶子节点</li>
<li>在叶子节点中定位数据</li>
</ol>
<h4 data-id="heading-12">3.2 Hash索引（Memory引擎）</h4>
<p>Hash索引基于哈希表实现，只支持精确查找。</p>
<p><strong>特点：</strong></p>
<ul>
<li>查询速度极快（O(1)）</li>
<li>只支持等值比较（=、IN、&lt;=&gt;）</li>
<li>不支持范围查询</li>
<li>不支持排序</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users_hash (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
    HASH INDEX idx_username (username)
) ENGINE<span class="hljs-operator">=</span>Memory;
</code></pre>
<h4 data-id="heading-13">3.3 聚簇索引 vs 非聚簇索引</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc7dda5650a04448bfbc91428e0463f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166900&amp;x-signature=cXxwiVZjpnq0pfZRitEkQJcfSyo%3D" alt="" loading="lazy"/></p>
<p><strong>聚簇索引：</strong></p>
<ul>
<li>主键索引自动创建为聚簇索引</li>
<li>数据行和索引存储在一起</li>
<li>每个表只能有一个聚簇索引</li>
<li>InnoDB引擎使用聚簇索引</li>
</ul>
<p><strong>非聚簇索引（二级索引）：</strong></p>
<ul>
<li>索引和数据分开存储</li>
<li>需要回表查询完整数据</li>
<li>一个表可以有多个非聚簇索引</li>
</ul>
<h3 data-id="heading-14">四、索引优化实战策略</h3>
<h4 data-id="heading-15">4.1 选择合适的索引列</h4>
<p><strong>适合创建索引的列：</strong></p>
<ul>
<li>经常作为WHERE条件的列</li>
<li>经常用于JOIN连接的列</li>
<li>经常用于ORDER BY排序的列</li>
<li>经常用于GROUP BY分组的列</li>
<li>选择性高的列（ distinct值多 / 总值）</li>
</ul>
<p><strong>不适合创建索引的列：</strong></p>
<ul>
<li>频繁更新的列</li>
<li>区分度低的列（如性别：只有男/女）</li>
<li>数据类型大的列（如TEXT、BLOB）</li>
<li>很少被查询的列</li>
</ul>
<h4 data-id="heading-16">4.2 索引选择度计算</h4>
<p>索引选择度 = 不重复的值数量 / 总行数</p>
<p>选择度越接近1，索引效果越好。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 计算索引选择度</span>
<span class="hljs-keyword">SELECT</span>
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> column_name) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> selectivity
<span class="hljs-keyword">FROM</span> table_name;

<span class="hljs-comment">-- 示例</span>
<span class="hljs-keyword">SELECT</span>
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> user_selectivity,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> status) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> status_selectivity
<span class="hljs-keyword">FROM</span> orders;
</code></pre>
<p><strong>判断标准：</strong></p>
<ul>
<li>选择度 &gt; 0.1：适合创建索引</li>
<li>选择度 &lt; 0.01：不建议创建索引</li>
<li>选择度 &lt; 0.001：完全不适合创建索引</li>
</ul>
<h4 data-id="heading-17">4.3 覆盖索引优化</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/950cba1c6d0344f990c5dc9dbc5f4d9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166900&amp;x-signature=qq%2FbsyiaF%2Bl3RWjfywoKJjBG4qk%3D" alt="" loading="lazy"/></p>
<p>覆盖索引是指查询的所有字段都包含在索引中，无需回表查询。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建组合索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_status_amount <span class="hljs-keyword">ON</span> orders(user_id, status, amount);

<span class="hljs-comment">-- 这个查询可以使用覆盖索引，不需要回表</span>
<span class="hljs-keyword">SELECT</span> user_id, status, amount
<span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 这个查询需要回表（包含了非索引字段remark）</span>
<span class="hljs-keyword">SELECT</span> user_id, status, amount, remark
<span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h4 data-id="heading-18">4.4 避免索引失效</h4>
<p><strong>索引失效的常见情况：</strong></p>
<ol>
<li><strong>使用函数或表达式</strong></li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 索引失效</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-number">2024</span>;

<span class="hljs-comment">-- 索引生效</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-01-01'</span>;
</code></pre>
<ol start="2">
<li><strong>隐式类型转换</strong></li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- phone是varchar类型，索引失效</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-number">13800138000</span>;

<span class="hljs-comment">-- 索引生效</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span>;
</code></pre>
<ol start="3">
<li><strong>LIKE查询以通配符开头</strong></li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 索引失效</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%admin%'</span>;

<span class="hljs-comment">-- 索引生效</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'admin%'</span>;
</code></pre>
<ol start="4">
<li><strong>OR连接的条件</strong></li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 索引失效（user_id有索引，status没有索引）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">OR</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 索引生效（两个字段都有索引）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">OR</span> order_no <span class="hljs-operator">=</span> <span class="hljs-string">'ORDER001'</span>;
</code></pre>
<ol start="5">
<li><strong>不等于操作</strong></li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 索引可能失效</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">!=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 索引生效</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre>
<h3 data-id="heading-19">五、生产环境优化案例</h3>
<h4 data-id="heading-20">5.1 慢查询优化案例</h4>
<p><strong>问题SQL：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
  <span class="hljs-keyword">AND</span> status <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<p><strong>执行计划分析：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6272b475bba44539a1a40d8153acd0b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166900&amp;x-signature=w7wkVJbxhcOcvL3ecQDTF0SecoA%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> ...;

<span class="hljs-comment">-- 结果显示：type: ALL，rows: 5000000，Extra: Using filesort</span>
<span class="hljs-comment">-- 全表扫描500万行，且使用文件排序</span>
</code></pre>
<p><strong>优化方案：</strong></p>
<ol>
<li>创建组合索引</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_user_status_time <span class="hljs-keyword">ON</span> orders(user_id, status, create_time);
</code></pre>
<ol start="2">
<li>优化后的执行计划</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- type: ref，rows: 50，Extra: Using where; Using index</span>
<span class="hljs-comment">-- 使用索引，只扫描50行，无需排序</span>
</code></pre>
<p><strong>性能提升：从15秒优化到0.05秒</strong></p>
<h4 data-id="heading-21">5.2 JOIN优化案例</h4>
<p><strong>问题场景：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> o.<span class="hljs-operator">*</span>, u.username, u.email
<span class="hljs-keyword">FROM</span> orders o
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.user_id <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> o.status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
  <span class="hljs-keyword">AND</span> o.create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>
LIMIT <span class="hljs-number">1000</span>;
</code></pre>
<p><strong>优化方案：</strong></p>
<ol>
<li>确保JOIN字段有索引</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- orders表的user_id</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_id <span class="hljs-keyword">ON</span> orders(user_id);

<span class="hljs-comment">-- users表的id（主键已有索引）</span>
<span class="hljs-comment">-- id是主键，自动有聚簇索引</span>
</code></pre>
<ol start="2">
<li>添加过滤条件索引</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_status_time <span class="hljs-keyword">ON</span> orders(status, create_time);
</code></pre>
<ol start="3">
<li>使用小表驱动大表</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 如果users表较小，可以改为</span>
<span class="hljs-keyword">SELECT</span> o.<span class="hljs-operator">*</span>, u.username, u.email
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) u
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> orders o <span class="hljs-keyword">ON</span> o.user_id <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> o.status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
  <span class="hljs-keyword">AND</span> o.create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>
LIMIT <span class="hljs-number">1000</span>;
</code></pre>
<h4 data-id="heading-22">5.3 分页查询优化</h4>
<p><strong>传统分页问题：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 深分页性能差</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">100000</span>, <span class="hljs-number">20</span>;
</code></pre>
<p><strong>优化方案1：使用延迟关联</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> o.<span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> orders o
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (
    <span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> orders
    <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">DESC</span>
    LIMIT <span class="hljs-number">100000</span>, <span class="hljs-number">20</span>
) <span class="hljs-keyword">AS</span> tmp <span class="hljs-keyword">ON</span> o.id <span class="hljs-operator">=</span> tmp.id;
</code></pre>
<p><strong>优化方案2：记录上次查询位置</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 第一次查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;

<span class="hljs-comment">-- 记录最小ID，下次查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;</span> last_max_id
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<h3 data-id="heading-23">六、索引维护与管理</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42fa0f956994470d8c76e430671fc5e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770166900&amp;x-signature=Eip6pMWt5XqxoZTviE%2Bxd3CuAF4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-24">6.1 查看索引使用情况</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看表的索引</span>
<span class="hljs-keyword">SHOW</span> INDEX <span class="hljs-keyword">FROM</span> orders;

<span class="hljs-comment">-- 查看索引统计信息</span>
<span class="hljs-keyword">SELECT</span>
    TABLE_NAME,
    INDEX_NAME,
    SEQ_IN_INDEX,
    COLUMN_NAME,
    <span class="hljs-keyword">CARDINALITY</span>
<span class="hljs-keyword">FROM</span> information_schema.STATISTICS
<span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> <span class="hljs-string">'your_database'</span>
  <span class="hljs-keyword">AND</span> TABLE_NAME <span class="hljs-operator">=</span> <span class="hljs-string">'orders'</span>;

<span class="hljs-comment">-- 查看索引使用效率（MySQL 8.0+）</span>
<span class="hljs-keyword">SELECT</span>
    TABLE_NAME,
    INDEX_NAME,
    COUNT_STAR <span class="hljs-keyword">as</span> 执行次数,
    SUM_TIMER_WAIT<span class="hljs-operator">/</span><span class="hljs-number">1000000000</span> <span class="hljs-keyword">as</span> 总耗时秒,
    COUNT_READ <span class="hljs-keyword">as</span> 读取次数,
    COUNT_FETCH <span class="hljs-keyword">as</span> 获取次数
<span class="hljs-keyword">FROM</span> performance_schema.table_io_waits_summary_by_index_usage
<span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> <span class="hljs-string">'your_database'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> COUNT_STAR <span class="hljs-keyword">DESC</span>;
</code></pre>
<h4 data-id="heading-25">6.2 删除冗余索引</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查找重复索引</span>
<span class="hljs-keyword">SELECT</span>
    a.TABLE_SCHEMA,
    a.TABLE_NAME,
    a.INDEX_NAME <span class="hljs-keyword">as</span> index1,
    b.INDEX_NAME <span class="hljs-keyword">as</span> index2,
    a.COLUMN_NAME
<span class="hljs-keyword">FROM</span> information_schema.STATISTICS a
<span class="hljs-keyword">JOIN</span> information_schema.STATISTICS b
  <span class="hljs-keyword">ON</span> a.TABLE_SCHEMA <span class="hljs-operator">=</span> b.TABLE_SCHEMA
  <span class="hljs-keyword">AND</span> a.TABLE_NAME <span class="hljs-operator">=</span> b.TABLE_NAME
  <span class="hljs-keyword">AND</span> a.COLUMN_NAME <span class="hljs-operator">=</span> b.COLUMN_NAME
  <span class="hljs-keyword">AND</span> a.INDEX_NAME <span class="hljs-operator">!=</span> b.INDEX_NAME
  <span class="hljs-keyword">AND</span> a.SEQ_IN_INDEX <span class="hljs-operator">=</span> b.SEQ_IN_INDEX
<span class="hljs-keyword">WHERE</span> a.TABLE_SCHEMA <span class="hljs-operator">=</span> <span class="hljs-string">'your_database'</span>;
</code></pre>
<h4 data-id="heading-26">6.3 索引重建</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 重建主键</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PRIMARY</span> KEY, <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">PRIMARY</span> KEY(id);

<span class="hljs-comment">-- 重建普通索引</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">DROP</span> INDEX idx_user_id, <span class="hljs-keyword">ADD</span> INDEX idx_user_id(user_id);

<span class="hljs-comment">-- 优化表（重建表和索引）</span>
OPTIMIZE <span class="hljs-keyword">TABLE</span> orders;
</code></pre>
<h4 data-id="heading-27">6.4 分析表</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 分析表，更新索引统计信息</span>
ANALYZE <span class="hljs-keyword">TABLE</span> orders;

<span class="hljs-comment">-- 检查表的键值分布</span>
<span class="hljs-keyword">SELECT</span>
    COLUMN_NAME,
    COLUMN_TYPE,
    IS_NULLABLE,
    COLUMN_KEY,
    EXTRA
<span class="hljs-keyword">FROM</span> information_schema.COLUMNS
<span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> <span class="hljs-string">'your_database'</span>
  <span class="hljs-keyword">AND</span> TABLE_NAME <span class="hljs-operator">=</span> <span class="hljs-string">'orders'</span>;
</code></pre>
<h3 data-id="heading-28">七、最佳实践总结</h3>
<h4 data-id="heading-29">7.1 索引设计原则</h4>
<ol>
<li><strong>选择性原则</strong>：为区分度高的列创建索引</li>
<li><strong>最左前缀</strong>：组合索引遵循最左前缀原则</li>
<li><strong>覆盖索引</strong>：将常用查询字段包含在组合索引中</li>
<li><strong>避免冗余</strong>：不要创建重复的索引</li>
<li><strong>控制数量</strong>：单表索引数量不宜过多（建议≤5个）</li>
</ol>
<h4 data-id="heading-30">7.2 查询优化技巧</h4>
<ol>
<li><strong>避免SELECT *</strong>：只查询需要的列</li>
<li><strong>利用覆盖索引</strong>：减少回表操作</li>
<li><strong>合理使用LIMIT</strong>：减少数据扫描量</li>
<li><strong>避免子查询</strong>：改用JOIN</li>
<li><strong>使用EXPLAIN</strong>：分析执行计划</li>
</ol>
<h4 data-id="heading-31">7.3 监控与诊断</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 开启慢查询日志</span>
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> slow_query_log <span class="hljs-operator">=</span> <span class="hljs-string">'ON'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> long_query_time <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; <span class="hljs-comment">-- 超过2秒的查询记录</span>

<span class="hljs-comment">-- 查看慢查询日志</span>
<span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'slow_query%'</span>;

<span class="hljs-comment">-- 使用EXPLAIN分析查询</span>
EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;
EXPLAIN EXTENDED <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;

<span class="hljs-comment">-- 查看表结构</span>
<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders;
</code></pre>
<h3 data-id="heading-32">八、常见问题与解决方案</h3>
<h4 data-id="heading-33">Q1：为什么加了索引还是慢？</h4>
<p><strong>可能原因：</strong></p>
<ol>
<li>索引失效（检查是否遵守索引规则）</li>
<li>回表次数过多（考虑使用覆盖索引）</li>
<li>数据量太大（考虑分区或分表）</li>
<li>索引选择度低（考虑更换索引列）</li>
</ol>
<h4 data-id="heading-34">Q2：多列索引如何设计？</h4>
<p><strong>原则：</strong></p>
<ol>
<li>将区分度高的列放在前面</li>
<li>将常用查询条件的列放在前面</li>
<li>考虑查询的组合方式</li>
<li>不超过5个列（维护成本高）</li>
</ol>
<h4 data-id="heading-35">Q3：什么时候需要分区？</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li>单表数据量超过1000万</li>
<li>历史数据很少访问</li>
<li>查询总是包含分区键</li>
</ul>
<h3 data-id="heading-36">九、总结</h3>
<p>MySQL索引优化是提升数据库性能的核心手段，掌握正确的索引优化方法可以让你的应用性能提升数倍甚至数百倍。</p>
<h3 data-id="heading-37">记住：索引不是越多越好，而是要恰到好处。</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[那个C级员工]]></title>    <link>https://juejin.cn/post/7599920572840542217</link>    <guid>https://juejin.cn/post/7599920572840542217</guid>    <pubDate>2026-01-27T16:28:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599920572840542217" data-draft-id="7599917711792996362" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="那个C级员工"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T16:28:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uzong"/> <meta itemprop="url" content="https://juejin.cn/user/372082495985181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            那个C级员工
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/372082495985181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uzong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T16:28:30.000Z" title="Tue Jan 27 2026 16:28:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 绩效难题</h2>
<p>作为团队负责人，公司强制要求评定差绩效，且必须分配一个名额，无论团队整体付出多少，这个名额都无法取消。这让基层管理者无比头疼：很多时候自己的下属个个表现亮眼，大家都全力以赴、成果可观。即便个别同事在部分工作上存在小问题，整体表现也绝不算差，却硬要评出一个差绩效。具体该如何评定、怎么和员工沟通、后续工作又该如何推进，每一件事都让人一筹莫展。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ae72dd76ec643f5b0b718e88516a804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=81XJH2yIR%2FTqSucyKxM7%2Bqv4LaM%3D" alt="" loading="lazy"/></p>
<p>回想多年前，我自己也拿过不少C级绩效，那种低落、憋屈的心情，直到现在依旧记忆犹新。</p>
<h2 data-id="heading-1">2. 为什么团队必须设置C级绩效</h2>
<ol>
<li>避免大锅饭，激活团队活力。如果组织没有差异化的绩效评定，很容易滋生平均主义、大锅饭的不良风气。绩效是管理者管理团队的关键工具，推行绩效管理的核心目的，是激励团队奋勇向前，而非纵容员工躺平。通过绩效强制分布这类激励相容机制，制造适度的竞争压力，既能遏制躺平文化，也能充分激发高绩效员工的工作动力。同时，组织的奖金、晋升、发展机会等资源始终有限，只有向高贡献者倾斜，才能维护团队的公平感。</li>
<li>这是管理者无法回避的管理课题。做好C级绩效的评定与沟通，绝非单纯完成公司下达的指标，而是要以建设性的方式完成绩效反馈，让员工感受到公平、尊重，同时看到自身的成长空间。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a5fc9f240da4cc1b71a796d8a947257~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=cjx7B4bG8GxvS7AFslSfFtm0d8s%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li>对于表现优秀、凭借努力拿到成果的员工，他们自然希望通过考核获得与之匹配的好绩效，为自己一整年的付出与成果，争取应有的认可。反之，也有部分员工对绩效缺乏信心，或是业绩表现平平，却也不愿成为团队垫底的人。</li>
<li>绩效评定的本质就是奖优罚劣，杜绝大锅饭。对优秀者给予正向激励，对表现滞后者给予负向激励，这也是在捍卫团队的整体利益。</li>
</ol>
<h2 data-id="heading-2">3. 管理者首先要搞清楚的核心问题</h2>
<p>一定要明确，被评定为C级绩效的下属，是工作表现确实不合格，还是相较于其他同事，存在改进的空间。这一点管理者必须心中有数：如果判定一名员工的表现极差，本质上是做出了淘汰的决策；如果还愿意和员工深入沟通，就说明他并非能力、态度全面不合格，只是综合对比下来，对团队的贡献相对逊色一些。</p>
<p>拿到差绩效，不代表员工个人能力差、品行不好。这是结合团队内部排名、员工职级等多方面因素，综合评定后的结果，只是说明其贡献分值相对偏低，未来还有更大的提升空间。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/468eb1038fd64fbf9b7af9ffa3eb30cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=FE6mWf0yjUhIguAHZqD%2Fw3dpmLY%3D" alt="" loading="lazy"/></p>
<p>针对271绩效分布规则，管理者要向团队传递清晰的信号：这不是单纯的打分游戏，而是明确团队的工作标准，告诉大家什么是值得倡导的行为，什么是需要规避的问题。正向绩效标杆，为团队指明努力的方向；滞后的绩效评定，则是提醒大家避免出现类似的问题。作为团队管理者，更要借此机会，为团队树立正确的标杆、立下清晰的规矩。如果想让团队持续发展、不断突破，就必须坚定地完成差异化绩效评定，明确告知团队成员，怎样的表现是达不到要求的。</p>
<p>想要管理更大的团队、承接更具挑战性的任务，就必须依靠这种管理方式驱动团队进步。团队发展如逆水行舟，不进则退。如果始终安于现状、不做差异化区分，团队就无法不断攀升、斩获更亮眼的成果，这本质上是管理者对团队的要求没有与时俱进。</p>
<p>如果管理者拒绝评出差绩效，即便自我感觉团队管理完美、无懈可击，站在公司更高层级的视角来看，无法完成绩效区分的管理者，本身就是管理能力不合格的体现。这意味着管理者自我满足、固步自封，没有尽到激励团队持续进步的责任，本年度你的管理绩效，也理应被评定为差。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9bce157cbec45699a54fa22d179daa7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=5fU7vjxG%2FAiQMatUamsrkvtfiMQ%3D" alt="" loading="lazy"/></p>
<p>一旦没有梳理好团队的绩效标准，大锅饭的现象便会愈演愈烈。那些一直努力拼搏的员工，在下一年度很可能会失去奋斗的动力，选择躺平——毕竟付出与否，最终的结果都相差无几。</p>
<p>为了实现团队利益的最大化，管理者有时必须要兼顾整体，做出局部的取舍。而一个健康的团队，也必须建立清晰、统一的评判标准。</p>
<p>管理者必须坚守正直的底线，这是打造健康团队的根基。如果管理者心存偏袒、评判不公，或是考虑不周，仅仅为了应付差绩效名额，就导致本该获得优秀绩效的员工只拿到普通评价，不仅会寒了这位员工的心，更会让整个团队失去对管理者的信任。如此一来，绩效标杆的引导作用、管理的约束作用，都会彻底失效。对管理者而言，正直公平，是不可或缺的核心素养。</p>
<h2 data-id="heading-3">4. 如何与被评定为C级绩效的下属沟通</h2>
<ol>
<li><strong>从组织贡献度切入沟通</strong>。可以坦诚告知员工：“你个人的工作表现可圈可点，但放在整个团队中，综合对比大家的组织贡献度，你的表现相对靠后，还有很大的提升空间。”沟通时一定要结合具体的工作案例，杜绝空泛的评价。核心是聚焦<strong>贡献度</strong>而非否定员工个人，明确传达“在当前团队的目标下，你的综合贡献暂时处于落后位置”，而非否定员工的个人价值。</li>
<li><strong>从职级与产出的匹配度沟通</strong>。向员工说明：“因为你的职级更高，组织对你的工作要求，自然也会比其他同事更严格。今年的工作产出，对比你晋升之前的表现，确实有进步，但以你当前的职级标准来看，理应拿出更亮眼的成果。”<br/>
沟通时始终坚守两个原则：一是聚焦贡献度而非人身评判，二是坦诚且共情。坦然告知员工，评定C级绩效是经过艰难考量后的决定，先肯定员工过往的努力与付出，再详细说明公司的绩效规则和团队的发展需求。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03ce63113ea640a9b1dadc93887b83da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=bjoXvdMtnKzkx%2FS9tXHUUOhChv0%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li><strong>引导员工自我审视，给出具体改进方向</strong>。引导员工站在更高的标准上复盘自身工作，梳理自身的不足、找到与优秀同事的差距，思考后续如何加倍努力。针对员工存在的具体问题，给出可落地的改进建议。常见的问题包括：工作目标模糊、任务优先级划分不清、设定的目标不切实际；工作与个人职业价值观脱节、缺乏清晰的成长路径，导致工作动力不足；跨部门协作存在阻碍，或是受家庭、健康等个人外部因素影响等。</li>
<li><strong>倾听员工视角，主动提供协助</strong>。给员工充分表达的机会，主动探询员工在工作中遇到的障碍，比如可以询问：“你是否觉得日常任务量超出了自身负荷？”“工作中使用的工具是否顺手，有没有需要优化的地方？”同时主动表达：“如果有我之前没有观察到的问题，也可以坦诚告知我，我会尽力为你提供支持和协助。”</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e289719958c4b2692cdfe6fe845eb17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=8brDp2rCSfU5TGRUxqojwl%2BHaaE%3D" alt="" loading="lazy"/></p>
<p>如果这名被评定为C级的员工，全年工作态度端正、十分努力，而你也秉持公平公正的原则完成了绩效评定，为团队树立了正向的标杆。那么从私人情感和团队留人角度出发，可以在合理范围内，为员工争取一些相应的激励。</p>
<p>评定C级绩效的核心原则，从来不是为了贬低员工，也不是搜集各种证据去否定员工的工作。而是从正向、积极的角度出发，以绩效评定为契机，推动员工和团队朝着更好的目标发展。</p>
<h2 data-id="heading-4">5. 如何为被评定为C级绩效的下属争取激励</h2>
<p>这里的“补偿”，并非单纯的物质弥补，而是<strong>心理支持、发展机会、制度弹性</strong>三者结合的综合支持。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a667f59404c42e08ebf3344289592b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=fa0lqMdQXQq0GRtPwr7p1QnkUYc%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>争取部分绩效奖金</strong>。向员工说明：“尽管本次绩效评定你处于团队末尾，但结合你全年的工作表现和付出，我尽力为你争取到了部分绩效奖金，这是公司和我对你工作中亮点部分的认可。”即便员工拿到C级绩效，只要全年工作有突出亮点、有进步，就可以向上级申请，为其保留一定的激励，绝对不能一分奖金都不予发放。如果这名员工具备成为团队骨干的潜力，想要激发他的斗志，还可以在合理范围内，适当调整奖金系数。沟通时要明确告知员工：“按照公司的常规标准，本次的激励会更少。但你今年在XX方面表现出色，也取得了明显的进步，即便存在一些不足，优秀的部分依然值得肯定，所以我为你争取到了这部分奖金。”让员工清晰地感受到，自己的付出与亮点，依然被团队看见和认可，从而激发他后续努力的动力。</li>
<li><strong>给予发展展示机会</strong>。在后续的工作中，为员工争取优质的项目锻炼机会，提供能展现个人能力的平台。做好工作分配与功劳归属，和员工沟通时可以说：“明年你有没有特别想参与的工作或项目，在我权限范围内，我会尽量向你倾斜。”管理者也要提前梳理优质项目、能提升个人影响力的机会，在绩效沟通的同时，明确告知员工后续的发展支持，做到奖惩分明、激励到位。</li>
<li><strong>加强过程辅导，保护员工自尊心</strong>。增加对员工的一对一辅导，给予更多针对性的工作指导。绝对不要在团队公开场合点名批评该员工，避免给员工贴上“落后者”的标签，保护员工的工作积极性和自尊心。</li>
</ol>
<h2 data-id="heading-5">6. 把差绩效变成成长的契机</h2>
<ol>
<li><strong>将绩效评定转化为深度复盘的机会</strong>。引导员工依据SMART原则，梳理自身问题，制定详细、可落地的改进计划。</li>
<li><strong>正视压力，实现自我突破</strong>。适度的挫折与压力，往往是彻底改变的契机。只有经历一次深刻的反思，才能打破温水煮青蛙的舒适区，实现能力的突破与成长。</li>
</ol>
<p>管理者要为员工明确下一步的行动建议，比如参与特定的重点项目、接受专属的工作辅导、制定3个月的短期改进计划等。要向员工传递清晰的信号：C级绩效不是淘汰的信号，而是提醒你查漏补缺、加速成长的警钟。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/313f55a91d724257b68114c4bfa1c8d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=nCgQE1EEKNd%2B2mMsXUAy%2FdjQeUE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">7. 对管理者的核心要求</h2>
<p>管理者评定C级绩效，从来不是为了完成公司的考核KPI，而是承担起对组织、对员工的双重责任。真正成熟的绩效管理，是在<strong>绩效差异化区分</strong>与<strong>尊重人性</strong>之间找到完美的平衡点。</p>
<p>管理者必须认清绩效评估的本质：这是明确员工工作贡献、指明改进方向的机会，而非对过往工作的指责与挑错，更是为员工未来的职业发展明确路径。通过绩效评定，梳理团队的工作标准，也让员工清晰知晓后续的改进方向与提升路径。</p>
<p>唯有坚守正直、秉持公平公正，才能真正带领团队行稳致远。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3389eb9ea18b44888a406199e18a40b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdXpvbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136114&amp;x-signature=K7ZRVfEZrRbnrKqaHP9uc%2Bmrf5o%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7">8. 补充说明</h2>
<p>需要特别注意的是，强制绩效分配的模式，更适合人员规模较大、工作成果易量化、业务模式成熟的团队。对于初创团队、创新探索型团队、小体量协作型团队，过度推行强制绩效区分，极易打击团队的创新积极性和协作氛围。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Suno 歌曲生成 API 对接说明]]></title>    <link>https://juejin.cn/post/7599852042530439178</link>    <guid>https://juejin.cn/post/7599852042530439178</guid>    <pubDate>2026-01-27T16:44:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852042530439178" data-draft-id="7599912857392037934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Suno 歌曲生成 API 对接说明"/> <meta itemprop="keywords" content="API,AIGC"/> <meta itemprop="datePublished" content="2026-01-27T16:44:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Suno 歌曲生成 API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T16:44:51.000Z" title="Tue Jan 27 2026 16:44:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读46分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着 AI 的应用变广，各类 AI 程序已逐渐普及。AI 已逐渐深入到人们的工作生活方方面面。而 AI 涉及的行业也越来越多，从最初的写作，到医疗教育，再到现在的音乐。</p>
<p>Suno 是一个专业高质量的 AI 歌曲和音乐创作平台，用户只需输入简单的文本提示词，即可根据流派风格和歌词生成带有人声的歌曲。该 AI 音乐生成器由来自 Meta、TikTok、Kensho 等知名科技公司的团队成员开发，目标是不需要任何乐器工具，让所有人都可以创造美妙的音乐。</p>
<p>以下是模型更新的进度：</p>





















































<table><thead><tr><th align="left">版本</th><th align="left">model</th><th align="left">上线时间</th><th align="left">prompt 限制</th><th align="left">style 限制</th><th align="left">歌曲最长时长</th></tr></thead><tbody><tr><td align="left">v5</td><td align="left">chirp-v5</td><td align="left">2025.09.23</td><td align="left">5000</td><td align="left">1000</td><td align="left">8 分钟</td></tr><tr><td align="left">v4.5+</td><td align="left">chirp-v4-5-plus</td><td align="left">2025.07.17</td><td align="left">5000</td><td align="left">1000</td><td align="left">8 分钟</td></tr><tr><td align="left">v4.5</td><td align="left">chirp-v4-5</td><td align="left">2025.05.03</td><td align="left">5000</td><td align="left">1000</td><td align="left">4 分钟</td></tr><tr><td align="left">v4</td><td align="left">chirp-v4</td><td align="left">2024.12.17</td><td align="left">3000</td><td align="left">200</td><td align="left">150 秒</td></tr><tr><td align="left">v3.5</td><td align="left">chirp-v3-5</td><td align="left">---</td><td align="left">3000</td><td align="left">200</td><td align="left">120 秒</td></tr></tbody></table>
<p>Suno 最新已将音乐生成模型升级到 V5 版本，调用最新的 V5 只需要把 model 参数修改为<code>chirp-v5</code>，可生成 9 分钟的歌曲。</p>
<p>然而 Suno 官方是并没有提供 API 的，AceDataCloud 提供了一套 Suno 的 API，模拟对接了 Suno 官方，可以方便快捷地生成想要的音乐。</p>
<h2 data-id="heading-0">申请和使用</h2>
<p>要使用 Suno Audios API，首先可以到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F4da95d9d-7722-4a72-857d-bf6be86036e9" target="_blank" title="https://platform.acedata.cloud/documents/4da95d9d-7722-4a72-857d-bf6be86036e9" ref="nofollow noopener noreferrer">Suno Audios Generation API</a> 页面点击「Acquire」按钮，获取请求所需要的凭证：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63fb9cd60df6430f888355e58bdc1411~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=GoaKFqanM6evRLZPil%2FqWLWu61Y%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>想些什么歌曲，可以任意输入一段文字，比如我想生成一个关于圣诞的歌曲，就可以输入 <code>a song for Christmas</code>，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e95cc77fdddf40099899f724ebf49db1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=oooYO7mEE1TzwwRrS3nWUCcHU9w%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>action</code>：此次音乐生成任务的行为，默认是 <code>generate</code>，主要包含：<code>extend</code>、<code>upload_extend</code>、<code>cover</code>、<code>upload_cover</code>、<code>replace_section</code>、<code>replace_section</code>、<code>concat</code>、<code>stems</code>、<code>all_stems</code>、<code>remaster</code>。</li>
<li><code>prompt</code>：Suno 官方的灵感模式的提示词。</li>
<li><code>model</code>：此次音乐生成任务的模型，默认是 <code>chirp-v3-5</code>，主要包含：<code>chirp-v3</code>、<code>chirp-v4</code>、<code>chirp-v3-5</code>、<code>chirp-v4-5</code>、<code>chirp-v4-5-plus</code>、 <code>chirp-v5</code>。</li>
<li><code>lyric</code>：Suno 官方的自定义模式的歌词内容。</li>
<li><code>custom</code>：是否采用自定义模式，默认是: <code>false</code>。</li>
<li><code>instrumental</code>：Suno 官方的灵感模式的纯音乐选项。</li>
<li><code>title</code>：Suno 官方的自定义模式的音乐标题。</li>
<li><code>style</code>：Suno 官方的自定义模式的音乐风格。</li>
<li><code>style_negative</code>：Suno 官方的自定义模式的排除风格。</li>
<li><code>audio_weight</code>：上传的参考音频占比，范围 0-1，越大越依赖参考音频。</li>
<li><code>audio_id</code>：参考音乐的 ID。</li>
<li><code>overpainting_start</code>/<code>overpainting_end</code>：为已有纯音乐补充人声的起止时间，单位秒。</li>
<li><code>underpainting_start</code>/<code>underpainting_end</code>：为清唱加伴奏的起止时间，单位秒。</li>
<li><code>persona_id</code>：艺术家的歌曲 ID。</li>
<li><code>continue_at</code>：以秒为单位继续现有音频的时间。例如，213.5 表示继续到 3 分 33.5 秒。</li>
<li><code>style_influence</code>：<code>style_influence</code> 高级参数。</li>
<li><code>replace_section_end</code>：替换片段的最终时间。</li>
<li><code>replace_section_start</code>：替换片段的起始时间。</li>
<li><code>vocal_gender</code>：控制男女声，女声 <code>f</code>，男声 <code>m</code>，4.5 及以上模型有效。</li>
<li><code>weirdness</code>：<code>weirdness</code> 高级参数。</li>
<li><code>lyric_prompt</code>：生成歌词的 prompt，当且仅当 <code>custom</code> 为 <code>true</code> 并且 <code>lyric</code> 没有传的时候生效。</li>
<li><code>callback_url</code>：需要回调结果的 URL。</li>
</ul>
<p>生成的代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce685003c69d47ae9c016a2b5a9f3039~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=q03cReVou5vSyhUQVpMYd4%2FieKY%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以点击「Try」按钮直接测试 API，稍等 1-2 分钟，结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e72fb249-bd5b-4e2a-b20c-8a06fea5ac14"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7dbc5b6a-b2c0-4d85-9d39-fa8a8a785ccf"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b481b17a-bf50-4e10-8adc-4d5635050893"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Under the Mistletoe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b481b17a-bf50-4e10-8adc-4d5635050893.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes falling on the ground\nTwinkling lights all around\nThe scent of pine fills the air\nChristmas magic everywhere\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right\n[Verse 2]\nStockings hung by the fire’s glow\nWarmth inside while the cold winds blow\nCookies baking\nSweet delight\nA season of joy shining bright\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right\n[Bridge]\nCarols sung by candlelight\nStars above make the world feel tight\nPeace and love\nA season’s creed\nFilling hearts with all we need\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b481b17a-bf50-4e10-8adc-4d5635050893.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T15:59:32.468Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, cheerful, male vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fbf22dab-5e2b-4e02-84c0-6d7605f14c3d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Under the Mistletoe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_fbf22dab-5e2b-4e02-84c0-6d7605f14c3d.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes falling on the ground\nTwinkling lights all around\nThe scent of pine fills the air\nChristmas magic everywhere\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right\n[Verse 2]\nStockings hung by the fire’s glow\nWarmth inside while the cold winds blow\nCookies baking\nSweet delight\nA season of joy shining bright\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right\n[Bridge]\nCarols sung by candlelight\nStars above make the world feel tight\nPeace and love\nA season’s creed\nFilling hearts with all we need\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/fbf22dab-5e2b-4e02-84c0-6d7605f14c3d.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T15:59:32.468Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, cheerful, male vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">158.48</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到这时候我们就得到了两首歌的内容，包括标题、预览图、歌词、音频、视频等内容。</p>
<p>字段说明如下：</p>
<ul>
<li>success：生成是否成功，如果成功则为 <code>true</code>，否则为 <code>false</code></li>
<li>data：是一个列表，包含了生成的歌曲的详细信息。
<ul>
<li>state： 歌曲生成状态，主要包含四种，具体的如下：
<ul>
<li>succeeded：生成成功</li>
<li>pending：队列中</li>
<li>running：执行中</li>
<li>error：失败</li>
</ul>
</li>
<li>id：歌曲 ID</li>
<li>title：歌曲的标题</li>
<li>image_url：歌曲的封面图片</li>
<li>lyric：歌曲的歌词</li>
<li>audio_url：歌曲的音频文件，打开就是一个 mp3 音频。</li>
<li>video_url：歌曲的视频文件，打开就是一个 mp4 视频。</li>
<li>created_at：创建的时间</li>
<li>model：使用的模型，一般是最新的 v3 模型</li>
<li>style：风格</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">自定义生成</h2>
<p>如果想自定义生成歌词，可以输入歌词：</p>
<p>这时候 <code>lyric</code> 字段可以传入类似如下内容：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Verse]</span>\nSnowflakes falling <span class="hljs-attribute">all</span> around\nGlistening white\nCovering the ground\nChildren laughing\nFull of delight\nIn this winter wonderland tonight\nSanta's sleigh\nUp in the sky\nRudolph's nose shining bright\nOh my\nHear the jingle bells\nRinging so <span class="hljs-attribute">clear</span>\nBringing joy and holiday cheer\n<span class="hljs-selector-attr">[Verse 2]</span>\nRoasting chestnuts by the fire's glow\nChristmas lights\nThey twinkle and show\nFamilies gathering with love and cheer\nSpreading warmth <span class="hljs-selector-tag">to</span> everyone near
</code></pre>
<blockquote>
<p>注意，这里的歌词中 <code>\n</code> 是换行符，如果你不知道如何生成歌词，可以使用 AceDataCloud 提供的歌词生成 API 来通过 prompt 生成歌词，API 是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F514d82dc-f7ab-4638-9f21-8b9275916b08" target="_blank" title="https://platform.acedata.cloud/documents/514d82dc-f7ab-4638-9f21-8b9275916b08" ref="nofollow noopener noreferrer">Suno Lyrics Generation API</a>。</p>
</blockquote>
<p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>lyric：歌词文本</li>
<li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
<li>title：歌曲的标题。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f430ecc07f4e40ab946b8e8968c463be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=5ugIjX6d7y04J3fEvx%2BKQCj%2BwHc%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbeb66c6211342478e1aab9cec277dd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=EheydzO1tO1F29XYYkVOXRki6jQ%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/suno/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "generate",
  "prompt": "A song for Christmas",
  "model": "chirp-v4-5",
  "lyric": "[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<h2 data-id="heading-3">自定义歌手风格生成功能</h2>
<p>如果想使用歌手风格来生成歌曲的话，首先通过上文的基本使用生成一首歌曲，
最后得到了需要设置这个歌曲为歌手风格，然后需要进入<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F78bb6c62-6ce0-490f-a7df-e89d80ec0583" target="_blank" title="https://platform.acedata.cloud/documents/78bb6c62-6ce0-490f-a7df-e89d80ec0583" ref="nofollow noopener noreferrer">Suno Persona API</a>根据官方生成的音乐 ID <code>audio_id</code> 来生成一个歌手风格的 id 参数 <code>persona_id</code>，具体的参数如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58362062ee4c465e972c88b79503c17a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=SGPHSnISVADHM7JUkpuAsIinB8g%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba99f3ff839b44599bcce9987fc01f38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=a7vS2vcXwJcEDD7JJ7e8uJVgeHg%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/persona"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"test"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7628b754-4fe7-4e79-bda4-806d0dd8bf6e"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"persona_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e0d7319e-aa2a-44cb-b00a-916218d7cb0b"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>我们以上面的 <code>audio_id</code> 和 <code>persona_id</code> 分别为 <code>97efc9f4-0e8d-4b3e-88df-14568fa1b11f</code>、<code>e0d7319e-aa2a-44cb-b00a-916218d7cb0b</code> 为此次的示例数据。 然后可以将参数 <code>action</code> 设置为 <code>artist_consistency</code> (如果是新版的歌手风格Persona-v2-vox，<code>action</code> 必须设置为 <code>artist_consistency_vox</code>)，并且输入需要继续生成歌曲的 ID 、 歌手风格 ID，填写样例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5feb2a4eca240f3b4562bc7a6e0c3ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=Qo2Y0dLyDkQ8jWcUEcxdizIYWOE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/214303cc2c514e898f4e3a1b9936c444~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=UiQKkIfr3CLrZMBSQL5f1IdR4SU%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"artist_consistency"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"A song for Christmas"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"persona_id"</span>: <span class="hljs-string">"e0d7319e-aa2a-44cb-b00a-916218d7cb0b"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9b732b1a-bd67-48bc-95e4-90140e06836f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"30fcd88e-7687-4137-92d7-913b58115204"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"727a36e2-8dce-4df7-99e5-14e44635c80f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_727a36e2-8dce-4df7-99e5-14e44635c80f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/727a36e2-8dce-4df7-99e5-14e44635c80f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:27:33.979Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">244.4</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3b33301a-b17e-4b25-8842-09b46dab1a36"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_3b33301a-b17e-4b25-8842-09b46dab1a36.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/3b33301a-b17e-4b25-8842-09b46dab1a36.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:27:33.979Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">229.88</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看出，结果内容与上文的是一致的，这也就实现使用歌手风格来生成歌曲的功能。</p>
<h2 data-id="heading-4">继续生成功能</h2>
<p>如果想对已经生成的 Suno 歌曲进行继续生成的话，可以将参数 <code>action</code> 设置为 <code>extend</code> ，并且输入需要继续生成歌曲的 ID，歌曲 ID 的获取是根据基本使用来获取，通过上文可知，这时候可以看到歌曲的 ID 为：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>
</code></pre>
<blockquote>
<p>注意，这里的歌词中 <code>id</code> 是生成后歌曲的 ID，如果你不知道如何生成歌曲，可以参考上文的基本使用来生成歌曲。</p>
</blockquote>
<p>如果想对自己上传的歌曲进行继续生成的话，可以将参数 <code>action</code> 设置为 <code>upload_extend</code> ，并且输入需要继续生成自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload Generation API</a>来获取，如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af174b1562764c8f99e02862b12b1d59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=sUbGWBfnU%2F%2BCAR7QF9u8qh3NjpI%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>接下来我们要必须填歌词、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>lyric：歌词文本</li>
<li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
<li>style：歌曲的风格，选填。</li>
<li>continue_at：以秒为单位继续现有音频的时间。例如，213.5 表示继续到 3 分 33.5 秒。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1940630e0675405abd6cce62a934590b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=a5PhDMDRWCLwcznTUc1hEqbJyLk%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69919b8c07b54c0fbc757e8229b8b9f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=sTpV2D8RK7o8W3Pb6KOn5B8WZZM%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"extend"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"A song for Christmas"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>,
    <span class="hljs-string">"continue_at"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"instrumental"</span>: <span class="hljs-literal">False</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"75b835d9-30d1-4641-8524-0aeedbdc9e1a"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44c41045-a2e1-4d19-aafc-7abd239d0d5c"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:38:35.509Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">165.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:38:35.509Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">158.84</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看出，结果内容与上文的是一致的，这也就实现歌曲的继续生成功能。</p>
<h2 data-id="heading-5">获取完整歌曲</h2>
<p>当基于原有的歌曲继续生成歌曲之后，返回的歌曲并不包含原来的歌曲内容。如果要获得完整的歌曲内容，需要使用拼接功能，就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>concat</code>。</li>
<li>audio_id：最后一个片段的 ID。</li>
</ul>
<p>比如扩展后的歌曲 ID 是：0a1e1b10-c36a-41c9-9bfb-b26d9d25db98，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"concat"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其他参数不变，返回的就是一首完整的歌曲，就是所有歌曲片段的拼接结果，但结果只有一首歌，样例如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0f794915-8418-4124-93f5-b7eb3a417167"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"62afcce0-e7e5-44b8-8c2e-4bba12a4f414"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0efec7e0-11bf-4313-9981-2c0e7218d7dd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near\n[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/0efec7e0-11bf-4313-9981-2c0e7218d7dd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:43:06.718Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">167.91997916666668</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"concat_history"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"continue_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"web"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gen"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-6">音乐翻版</h2>
<p>当基于原有的歌曲继续生成歌曲之后，返回的歌曲的风格可能不太合适。如果要对原先生成的歌曲(若是自定义上传的音乐也支持)进行翻版，需要使用音乐翻版方法，就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>cover</code>，当是对自定义上传的音乐进行翻版操作的时候必须指定内容为：<code>upload_cover</code>。</li>
<li>audio_id：之前生成歌曲的 ID。</li>
</ul>
<p>比如原先生成后的歌曲 ID 是：0a1e1b10-c36a-41c9-9bfb-b26d9d25db98，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cover"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4-5"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其他参数不变，返回的就是一首翻版后的歌曲，就是对原先生成的歌曲进行翻版后的结果，样例如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b9d43d06-2e0a-4b5e-9e0d-7dfab32e00ab"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6c5e567d-0fdc-4c44-9b36-4090d9a75ff5"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6988fa57-f810-41cf-afab-7838db2c77dc"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_6988fa57-f810-41cf-afab-7838db2c77dc.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/6988fa57-f810-41cf-afab-7838db2c77dc.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:44:13.007Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">182.4</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ce98b991-0258-4f05-8245-e43d4efa8fb8"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_ce98b991-0258-4f05-8245-e43d4efa8fb8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ce98b991-0258-4f05-8245-e43d4efa8fb8.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:44:13.007Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">179.72</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的结果与上文类似，这就完成了对原先生成的歌曲进行翻版生成的过程。</p>
<h2 data-id="heading-7">替换片段</h2>
<p>当生成歌曲之后需要进行替换歌曲片段单独操作的二次创作时，可以对歌曲的某个片段进行替换操作。就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>replace_section</code>。</li>
<li>audio_id：之前生成歌曲的 ID。</li>
<li>model: 歌曲生成模型，</li>
<li>lyric: 替换后的完整歌词（只需要与 prompt 有重复就行，不需要完全的歌词），</li>
<li>prompt：需要替换的歌词部分。</li>
<li>style：歌曲的风格，选填。</li>
<li>replace_section_start：<code>lyric</code>对应的歌词时间轴的起始时间。</li>
<li>replace_section_end：<code>lyric</code>对应的歌词时间轴的终点时间。</li>
</ul>
<p>比如原先生成后的歌曲 ID 是：ade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"replace_section"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Chorus]\n新年快乐 人人欢快歌\n祝福洒满每一片角落\n新年快乐 心中花火多\n愿望成真生活似金色波\n[Verse 2]\n梅花绽放春意洋溢满地\n梅花绽放春意洋溢满地"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"梅花绽放春意洋溢满地\n梅花绽放春意洋溢满地"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"replace_section_start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28.94100580270793</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"replace_section_end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85.39410058027079</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"custom"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"instrumental"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其他参数不变，返回的就是一首替换后的歌曲，就是对原先生成的歌曲进行替换片段后的结果，样例如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7a37c35d-7081-413d-908d-ab2d3f8139bf"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1ed92d6e-9a19-48f7-ab34-68c82c792303"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2a1467dc-51a4-4872-9ccc-ccd96e4fbbb6"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"新年快乐"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_dc1b5edc-fbae-44a3-8962-d596dbd2b0d7.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Chorus]\n新年快乐 人人欢快歌\n祝福洒满每一片角落\n新年快乐 心中花火多\n愿望成真生活似金色波\n[Verse 2]\n梅花绽放春意洋溢满地\n梅花绽放春意洋溢满地"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2a1467dc-51a4-4872-9ccc-ccd96e4fbbb6.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-04-18T01:55:02.930Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"traditional influences, female vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">202.52</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"concat_history"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gen"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ios"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_start_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28.94100580270793</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_end_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85.39410058027079</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_dur_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">56.45309477756285</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_context_start_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_context_end_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">115.39410058027079</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"include_future_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"include_history_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_lyrics"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"梅花绽放春意洋溢满地\n梅花绽放春意洋溢满地"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dc1b5edc-fbae-44a3-8962-d596dbd2b0d7"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的结果与上文类似，这就完成了对原先生成的歌曲进行替换片段的过程。</p>
<h2 data-id="heading-8">声曲分离</h2>
<p>当生成歌曲之后需要进行伴奏和人声单独操作的二次创作时，可以分离纯音乐伴奏和清唱人声。就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>stems</code>。</li>
<li>audio_id：之前生成歌曲的 ID。</li>
</ul>
<p>比如原先生成后的歌曲 ID 是：ec13e502-d043-4eb2-92ee-e900c6da69d1，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stems"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ec13e502-d043-4eb2-92ee-e900c6da69d1"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>通过以上参数即可得到声曲分离的结果，结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4050affc-f8a6-4cba-a86c-bf201eed053d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5107ee58-687d-422f-9195-fa0e82e1fcc8"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e3de0928-085a-42c4-b982-3b24738d1989"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Deck the Sky - Vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_e3de0928-085a-42c4-b982-3b24738d1989.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes dance on rooftops high\nChildren's laughter fills the sky\nCarols ring from church bells loud\nHolidays a joyful crowd\n[Verse 2]\nCandy canes and cocoa warm\nWrapped up tight in our own storm\nStockings hung with dreams and cheer\nMagic growing every year\n[Chorus]\nDeck the sky with twinkling stars\nHoliday joy feels ours and ours\nSing the songs of love and light\nChristmas glows so pure and bright\n[Verse 3]\nFireside tales of long ago\nReindeer prance in icy glow\nEvergreen and tinsel’s gleam\nChristmas time a lovely dream\n[Bridge]\nHearts are full with friends and kin\nMistletoe for love to win\nGifts of love and hope we share\nChristmas spirit everywhere\n[Chorus]\nDeck the sky with twinkling stars\nHoliday joy feels ours and ours\nSing the songs of love and light\nChristmas glows so pure and bright"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e3de0928-085a-42c4-b982-3b24738d1989.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e3de0928-085a-42c4-b982-3b24738d1989.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-01-05T07:49:16.881Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, jolly"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">174.16</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Deck the Sky - Instrumental"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-01-05T07:49:16.892Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, jolly"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">174.16</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的结果与上文类似，这就完成了对原先生成的歌曲进行声曲分离的过程。</p>
<h2 data-id="heading-9">全轨道声曲分离</h2>
<p>当生成歌曲之后需要进行全轨道声曲分离操作时，就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>all_stems</code>。</li>
<li>audio_id：之前生成歌曲的 ID。</li>
</ul>
<p>比如原先生成后的歌曲 ID 是：bdf23a5a-59f5-4103-b452-054a824a7f9f，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"all_stems"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bdf23a5a-59f5-4103-b452-054a824a7f9f"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>通过以上参数即可得到全轨道声曲分离的结果，结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f4b16fb9-8478-4857-88c7-b9a1f0bb9518"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9c560ebd-4fc6-4bdb-988a-8890160a92fb"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f86ca64a-9519-4ea7-a592-52438e001412"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f86ca64a-9519-4ea7-a592-52438e001412.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f86ca64a-9519-4ea7-a592-52438e001412.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"99e649a7-a394-47b9-a915-d7f847285a36"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Backing Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_99e649a7-a394-47b9-a915-d7f847285a36.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/99e649a7-a394-47b9-a915-d7f847285a36.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6d710bf7-809f-4fdc-bb63-b8cb3a456d42"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Drums)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_6d710bf7-809f-4fdc-bb63-b8cb3a456d42.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/6d710bf7-809f-4fdc-bb63-b8cb3a456d42.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e05f07e3-7d80-4713-8e51-7f176c733543"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Bass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_e05f07e3-7d80-4713-8e51-7f176c733543.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e05f07e3-7d80-4713-8e51-7f176c733543.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"93fe7cd8-62fd-4739-b78e-142c7e0b8562"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Guitar)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_93fe7cd8-62fd-4739-b78e-142c7e0b8562.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/93fe7cd8-62fd-4739-b78e-142c7e0b8562.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8367d71c-fdd3-441c-8ebe-70c33cca821b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Keyboard)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_8367d71c-fdd3-441c-8ebe-70c33cca821b.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/8367d71c-fdd3-441c-8ebe-70c33cca821b.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"28c03590-731c-416e-8fd3-95cdb3d75043"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Percussion)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_28c03590-731c-416e-8fd3-95cdb3d75043.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/28c03590-731c-416e-8fd3-95cdb3d75043.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3d4c1a28-4e1c-485a-8201-d21bb93aca2f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Strings)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_3d4c1a28-4e1c-485a-8201-d21bb93aca2f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/3d4c1a28-4e1c-485a-8201-d21bb93aca2f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b9db8ded-01ec-4e37-b8a5-64aab3a814c2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Synth)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b9db8ded-01ec-4e37-b8a5-64aab3a814c2.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b9db8ded-01ec-4e37-b8a5-64aab3a814c2.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"10a5248e-32e6-42b9-8da1-678a8a392aef"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (FX)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_10a5248e-32e6-42b9-8da1-678a8a392aef.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/10a5248e-32e6-42b9-8da1-678a8a392aef.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2d272128-111f-4901-8f62-5ae1eb43095a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Brass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2d272128-111f-4901-8f62-5ae1eb43095a.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2d272128-111f-4901-8f62-5ae1eb43095a.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Woodwinds)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1ca774f9-3e75-48a6-941b-808875eadcd2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_1ca774f9-3e75-48a6-941b-808875eadcd2.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/1ca774f9-3e75-48a6-941b-808875eadcd2.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"14c5ffc7-addf-4fee-afd2-4b8b3e7ee470"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Backing Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_14c5ffc7-addf-4fee-afd2-4b8b3e7ee470.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/14c5ffc7-addf-4fee-afd2-4b8b3e7ee470.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9d044557-450d-48ab-90dc-8eaf6f1cdb6c"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Drums)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_9d044557-450d-48ab-90dc-8eaf6f1cdb6c.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/9d044557-450d-48ab-90dc-8eaf6f1cdb6c.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"efd052d0-c12f-47b3-8282-1f3ef7610e1f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Bass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_efd052d0-c12f-47b3-8282-1f3ef7610e1f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/efd052d0-c12f-47b3-8282-1f3ef7610e1f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5775372b-292e-4420-96ef-60e57a60cc1f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Guitar)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_5775372b-292e-4420-96ef-60e57a60cc1f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/5775372b-292e-4420-96ef-60e57a60cc1f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dab3f220-19cd-408e-9b96-30ec18f5b049"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Keyboard)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_dab3f220-19cd-408e-9b96-30ec18f5b049.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/dab3f220-19cd-408e-9b96-30ec18f5b049.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2d0cd6d4-af82-4bb5-86fe-d92bdb367157"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Percussion)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2d0cd6d4-af82-4bb5-86fe-d92bdb367157.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2d0cd6d4-af82-4bb5-86fe-d92bdb367157.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f3191a1a-5e8d-4afe-b638-3add222d52cd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Strings)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f3191a1a-5e8d-4afe-b638-3add222d52cd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f3191a1a-5e8d-4afe-b638-3add222d52cd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a8834ea5-200b-4206-a812-9780ef336660"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Synth)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a8834ea5-200b-4206-a812-9780ef336660.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a8834ea5-200b-4206-a812-9780ef336660.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f50d1a31-ef72-400a-b8ae-0367849d007d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (FX)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f50d1a31-ef72-400a-b8ae-0367849d007d.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f50d1a31-ef72-400a-b8ae-0367849d007d.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cb581673-23cc-40d6-9f9b-0f76720f0d18"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Brass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_cb581673-23cc-40d6-9f9b-0f76720f0d18.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/cb581673-23cc-40d6-9f9b-0f76720f0d18.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d91cfb52-f0a3-4546-bf8a-2ad14c3775a5"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Woodwinds)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_d91cfb52-f0a3-4546-bf8a-2ad14c3775a5.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/d91cfb52-f0a3-4546-bf8a-2ad14c3775a5.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的结果与上文类似，这就完成了对原先生成的歌曲进行声曲分离的过程。</p>
<h2 data-id="heading-10">自定义生成的高级参数</h2>
<p>官方允许在自定义模式下使用高级参数 <code>weirdness</code>==&gt;<code>Weirdness</code>、<code>style_influence</code>==&gt;<code>Style Influence</code>、<code>audio_weight</code>==&gt;<code>Audio Influence</code>来进行生成，对应如下如的官方示例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caca6b98b31040d880a79c47594b9cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=T2HL7m331PUJvGQ%2F7KRlvmfI7Us%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>其中高级参数的范围都在 0-1 之间，具体的参数如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b3c3d9c65a247b1aff66ef0ce462a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=SwQuspqo%2BsY5h3SIogRbqnOETg4%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c02baa0f0564d7db10a944821ad36ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=T2VkO1NJRYBaX%2FEc207mSuzHKSY%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"generate"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"Hello Hello Hello "</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"weirdness"</span>: <span class="hljs-number">0.4</span>,
    <span class="hljs-string">"style_influence"</span>: <span class="hljs-number">0.4</span>,
    <span class="hljs-string">"audio_weight"</span>: <span class="hljs-number">0.4</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2f3aa682-e1a7-43a9-9fbb-ed0ce8668a4b"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"07408194-7deb-4a52-a36d-9a9a13143b5f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c66e2077-7580-43f2-9937-c67a8afcd8bd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_c66e2077-7580-43f2-9937-c67a8afcd8bd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hello Hello Hello "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/c66e2077-7580-43f2-9937-c67a8afcd8bd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-07-10T12:54:35.199Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">187.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a922f97b-307c-4c4d-aae3-a47ba8202a10"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a922f97b-307c-4c4d-aae3-a47ba8202a10.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hello Hello Hello "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a922f97b-307c-4c4d-aae3-a47ba8202a10.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-07-10T12:54:35.199Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">229.64</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样就使用了高级参数进行生成自定义歌曲，结果与上文类似。</p>
<h2 data-id="heading-11">Add Insterumental 功能</h2>
<p>2025 年 8 月份 suno 新出 Add Insterumental 功能，首先需要上传一首清唱无配音的歌曲, 让 suno 帮你配乐，首先可以先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload API</a>上传一首清唱无配乐的歌曲，对应如下如的操作如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9eaa10e3647a4d759c0ddd45db0de3c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=Se2FOExZ5xMQ9BiuVKTOR3KuKSE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>然后需要记录上传后的<code>audio_id</code>，具体的结果如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a00c48f8c48d41e2946d25a174fc99c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=58AQ5cZ2cnxbRqL0W6mp3xAb388%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>最后得到了一个<code>audio_id</code>：92254cab-3372-4d9e-bce9-cdcfdbc39070，然后我们还需要填写如下参数：</p>
<ul>
<li>action：内容为 <code>underpainting</code>。</li>
<li>underpainting_start：对上传的歌曲进行添加伴奏的起始时间，默认值是 0。</li>
<li>underpainting_end：对上传的歌曲进行添加伴奏的终点时间，必须小于歌曲的总时长。</li>
<li>audio_id：上传的清唱无配音的歌曲 ID。</li>
<li>style：伴奏的风格，最好是不用歌词 毕竟是配音。</li>
</ul>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57a2ff1c768f478cbba9f5ed5282aa11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=%2BrFwFUq0wkhfG%2FozA1gX%2BOgiONA%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"underpainting"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"style"</span>: <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"92254cab-3372-4d9e-bce9-cdcfdbc39070"</span>,
    <span class="hljs-string">"underpainting_end"</span>: <span class="hljs-number">120</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"822d2e14-c535-4d48-a4e5-1b6ab00b04a7"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"257eac2c-8e4f-44d0-8454-5e215111eefa"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2788cd21-bd84-422d-beb5-859c60fbf5b6"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2788cd21-bd84-422d-beb5-859c60fbf5b6.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2788cd21-bd84-422d-beb5-859c60fbf5b6.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:25:42.548Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10.16</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a4bb7220-e971-4cbf-a626-b86c648bcf55"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a4bb7220-e971-4cbf-a626-b86c648bcf55.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a4bb7220-e971-4cbf-a626-b86c648bcf55.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:25:42.548Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.52</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样就完成了对上传的清唱无配音歌曲进行配乐的操作，结果与上文类似。</p>
<h2 data-id="heading-12">Add Vocals 功能</h2>
<p>2025 年 8 月份 suno 新出 Add Vocals 功能，首先需要上传一首纯音乐，让 suno 填词、出人声歌唱，首先可以先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload API</a>上传一首清唱无配乐的歌曲，对应如下如的操作如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f582eb6d89fe4ebda1ebcb44eb0420be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=yD9z%2F5UFFdhoxcHlColpCFq1ROA%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>然后需要记录上传后的<code>audio_id</code>，具体的结果如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a795ab0719674b2196d866ca954e15e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=WcmObr7pCc7xpAOrbjHesj5zvo8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>最后得到了一个<code>audio_id</code>：92254cab-3372-4d9e-bce9-cdcfdbc39070，然后我们还需要填写如下参数：</p>
<ul>
<li>action：内容为 <code>overpainting</code>。</li>
<li>overpainting_start：对上传的歌曲进行添加人声的起始时间，默认值是 0。</li>
<li>overpainting_end：对上传的歌曲进行添加人声的终点时间，必须小于歌曲的总时长。</li>
<li>audio_id：上传的清唱无配音的歌曲 ID。</li>
<li>custom：该模式下必须使用自定义模式填入歌词。</li>
<li>lyric：自定义模式下填写的歌词。</li>
<li>style：伴奏的风格。</li>
</ul>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/676bbfbf0c874a419ddb1f60906293ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=qahHztMuB4HTUB8bT4pQSC6do%2F0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"overpainting"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldn’t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndon’t care for what niggas say"</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"92254cab-3372-4d9e-bce9-cdcfdbc39070"</span>,
    <span class="hljs-string">"overpainting_end"</span>: <span class="hljs-number">120</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"31bb250e-6614-49ec-ac85-631f224daeba"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"efe8e7f3-9a65-4f13-a9f8-51e8478899df"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a597f945-64df-4722-a631-d436450832bd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a597f945-64df-4722-a631-d436450832bd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldn’t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndon’t care for what niggas say"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a597f945-64df-4722-a631-d436450832bd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:33:51.550Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">105.32</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b41a8b91-3d88-4ebd-a6cf-732764b24954"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b41a8b91-3d88-4ebd-a6cf-732764b24954.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldn’t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndon’t care for what niggas say"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b41a8b91-3d88-4ebd-a6cf-732764b24954.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:33:51.550Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">148.16</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样就完成了对上传的清唱无配音歌曲进行配人声的操作，结果与上文类似。</p>
<h2 data-id="heading-13">Remaster 功能</h2>
<p>2025 年 12 月份 suno 新出 Remaster 功能，该功能可以重新生成歌曲，不可跨账号，然后我们还需要填写如下参数：</p>
<ul>
<li>action：内容为 <code>remaster</code>。</li>
<li>audio_id：需要重新生成的歌曲 ID。</li>
<li>model：仅支持 v4.5+、v5。</li>
<li>variation_category：仅在 v5 以上版本支持，而且只有 3 个值 high normal subtle。</li>
</ul>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b47c58a6dc284e0fb2200dfea45cdb8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=ipYzQevYUDF%2BjCBSb6HiGqz7o4g%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"remaster"</span>,
    <span class="hljs-string">"variation_category"</span>: <span class="hljs-string">"high"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"21fd46d4-45c3-4826-bec9-3f3df667902e"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"791ee74c-9363-4352-afe7-babb19b89899"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"77acda57-c3d4-4e11-a506-4f50e0609916"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b0515cdf-9cb5-46cd-b0fe-10a239dc9274"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Navidad en costura  (Remastered)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b0515cdf-9cb5-46cd-b0fe-10a239dc9274.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_large_b0515cdf-9cb5-46cd-b0fe-10a239dc9274.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"En Teror las clases siguen,\nni en Navidad hay parón;\ncose el grupo entre villancicos\ny un buen trocito de turrón.\nLa Popular abre sus puertas,\ny el taller suena mejor;\nhilo, aguja y canto alegre\nlo pasaremos mejor\nSeguimos en las costuras,\ncon música y diversión;\nlos alumnos comeremos\nGolosinas un montón "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b0515cdf-9cb5-46cd-b0fe-10a239dc9274.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-04T13:09:59.936Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Villancico"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">32.2</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"06edab94-a4f9-4c0c-abac-a2e8a97c76a8"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Navidad en costura  (Remastered)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_06edab94-a4f9-4c0c-abac-a2e8a97c76a8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_large_06edab94-a4f9-4c0c-abac-a2e8a97c76a8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"En Teror las clases siguen,\nni en Navidad hay parón;\ncose el grupo entre villancicos\ny un buen trocito de turrón.\nLa Popular abre sus puertas,\ny el taller suena mejor;\nhilo, aguja y canto alegre\nlo pasaremos mejor\nSeguimos en las costuras,\ncon música y diversión;\nlos alumnos comeremos\nGolosinas un montón "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/06edab94-a4f9-4c0c-abac-a2e8a97c76a8.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-04T13:09:59.936Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Villancico"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">32.2</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样就完成了对已生成歌曲重新生成的操作，结果与上文类似。</p>
<h2 data-id="heading-14">异步回调</h2>
<p>由于 Suno 生成音乐的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成音乐的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%25EF%25BC%258C%25E6%2589%2593%25E5%25BC%2580%25E8%25AF%25A5%25E7%25BD%2591%25E7%25AB%2599%25E5%258D%25B3%25E5%258F%25AF%25E5%25BE%2597%25E5%2588%25B0%25E4%25B8%2580%25E4%25B8%25AA" target="_blank" title="https://webhook.site/%EF%BC%8C%E6%89%93%E5%BC%80%E8%AF%A5%E7%BD%91%E7%AB%99%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%AA" ref="nofollow noopener noreferrer">webhook.site/，打开该网站即可得到一…</a> Webhook URL，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d875933cb3a74c2a8dd2957c824d4a2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=7c36Pt0i%2BtQ6fUZyjVdvf0pM6Z8%3D" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F03e60575-3d96-4132-b681-b713d78116e2%25E3%2580%2582" target="_blank" title="https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2%E3%80%82" ref="nofollow noopener noreferrer">webhook.site/03e60575-3d…</a></p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入 <code>prompt</code>，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63db7892cebc4fd09a3d3dbd3479f4f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=5tWPmrKH3stsCk4VKLjoNYcOnAA%3D" alt="" loading="lazy"/></p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44472ab8-783b-4054-b861-5bf14e462f60"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>稍等片刻，我们可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F03e60575-3d96-4132-b681-b713d78116e2" target="_blank" title="https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2" ref="nofollow noopener noreferrer">webhook.site/03e60575-3d…</a> 上观察到生成歌曲的结果，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7891eb576b64176bd405b57c7169f4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=oH4D9Ps4GDPSyLiSyxzfrtbetSE%3D" alt="" loading="lazy"/></p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44472ab8-783b-4054-b861-5bf14e462f60"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"da4324e5-84b2-484b-b0e9-dd261381c594"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Winter Whispers"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/image_da4324e5-84b2-484b-b0e9-dd261381c594.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnow falling gently from the sky\nChildren giggling as they pass by\nFire crackling\nCozy and warm\nChristmas spirit begins to swarm\n[Verse 2]\nTwinkling lights\nA sight to behold\nStockings hung\nWaiting to be filled with gold\nGifts wrapped with love\nPiled high\nExcitement in the air\nYou can't deny\n[Chorus]\nWinter whispers in the wind\nJoy and love it brings\nLet's celebrate this season\nWith the ones we're missing"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/da4324e5-84b2-484b-b0e9-dd261381c594.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/da4324e5-84b2-484b-b0e9-dd261381c594.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-05-11T07:33:05.430Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pop"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b878a87b-a0db-4046-8ccd-ecd2fb3d4372"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Winter Whispers"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/image_b878a87b-a0db-4046-8ccd-ecd2fb3d4372.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnow falling gently from the sky\nChildren giggling as they pass by\nFire crackling\nCozy and warm\nChristmas spirit begins to swarm\n[Verse 2]\nTwinkling lights\nA sight to behold\nStockings hung\nWaiting to be filled with gold\nGifts wrapped with love\nPiled high\nExcitement in the air\nYou can't deny\n[Chorus]\nWinter whispers in the wind\nJoy and love it brings\nLet's celebrate this season\nWith the ones we're missing"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b878a87b-a0db-4046-8ccd-ecd2fb3d4372.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b878a87b-a0db-4046-8ccd-ecd2fb3d4372.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-05-11T07:33:05.430Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pop"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<p>当然我们也可以通过流式调用来获取结果，我们只需要将请求头里面的<code>accept</code>的值设置为<code>application/x-ndjson</code>即可，下面用一个示例输入作为示范：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41b1a25ceabd4a75aa986f757f431d40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770137091&amp;x-signature=PMALqx0liUdgDgQAI4yluCfAv4c%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>等待过程中我们可以得到以下输出：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"pending"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"pending"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp4"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"4440342a-41c4-4140-8bb1-3537a598ca2e"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/d1a3109d-799b-401e-b032-4b501bcf26f3.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">127.16</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>得到的结果跟基本调用类似，上面多个结果就实现了流式调用。</p>
<h2 data-id="heading-15">错误处理</h2>
<p>如果发生错误，您将得到类似如下的错误信息：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"forbidden"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Song Description contained artist name: eminem"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9bb7c2f4-3b7b-4965-b50a-f663874b1b6f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9bb3a2a6-c438-436d-a9f3-fa466abc077c"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>下面是 HTTP Status Code, <code>error.code</code>, <code>error.message</code> 的列表：</p>
































































































































































<table><thead><tr><th>Status Code</th><th><code>error.code</code></th><th><code>error.message</code></th></tr></thead><tbody><tr><td>400</td><td><code>bad_request</code></td><td><code>The song id does not exist or has been taken offline.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Prompt too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Tags too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Uploaded audio matches existing work of art.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>instrumental must be a boolean</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Title too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Topic too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>style must be less than or equal 120</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>custom must be a boolean</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>audio_id is required when extend audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>continue_at is required when extend audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>continue_at must be a number greater than 0</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>lyric is required when extend audio and instrumental is false</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>prompt is required when generate audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>lyric is required when generate custom audio</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt likely malformed</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt likely copyrighted</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt contained inappropriate material</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description flagged for moderation</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description contained artist name</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Tags contained artist name</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Lyrics contained copyrighted material</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description contained producer tag</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Generic openAI error</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt flagged for moderation</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>Unable to generate lyrics from song description</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>job failed with unknown error</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>no available worker in system</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>service under maintenance, generation paused</code></td></tr><tr><td>504</td><td><code>timeout</code></td><td><code>timeout while waiting for audio generation</code></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot一夜爆火，我用云服务器搭了个24小时在线的AI助理]]></title>    <link>https://juejin.cn/post/7599899147418124340</link>    <guid>https://juejin.cn/post/7599899147418124340</guid>    <pubDate>2026-01-27T18:51:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599899147418124340" data-draft-id="7599899147418107956" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot一夜爆火，我用云服务器搭了个24小时在线的AI助理"/> <meta itemprop="keywords" content="程序员,人工智能,开源"/> <meta itemprop="datePublished" content="2026-01-27T18:51:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卷福同学"/> <meta itemprop="url" content="https://juejin.cn/user/3456520291098686"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot一夜爆火，我用云服务器搭了个24小时在线的AI助理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3456520291098686/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卷福同学
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T18:51:58.000Z" title="Tue Jan 27 2026 18:51:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.Clawdbot爆火</h2>
<p>近日，一款名为ClawdBot的产品在全球技术圈掀起热潮，从X、Reddit到中文技术社区，处处可见它的身影。究竟是什么让这个AI智能体如此引人注目？（已经改名为Moltbot）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82b93689944b482facf550e46403e3fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=v17HvAfypx9kX%2FlBusGVhVrwZyc%3D" alt="" loading="lazy"/></p>
<p>ClawdBot的创作者Peter在介绍中强调，这原本只是一个“生活助理”项目——通过WhatsApp发送消息，转到Claude Code处理，再将结果返回。</p>
<p>但真正让技术圈沸腾的是它<strong>革命性的人机协作模式</strong>：</p>
<ul>
<li><strong>运行在用户自己的环境中</strong>（本地电脑或个人服务器）</li>
<li><strong>交互方式回归熟悉的聊天软件</strong>，如同与同事交谈般自然</li>
<li><strong>拥有完整操作权限与超长记忆</strong>，成为真正意义上的个人专属AI</li>
<li><strong>数据完全由用户掌控</strong>，无需担心隐私泄露</li>
</ul>
<p>随着ClawdBot走红，Mac Mini甚至成了“理财产品”，很多先行者大量购入专门运行ClawdBot。</p>
<p>但本着安全第一的原则：<strong>切勿在主力电脑上部署ClawdBot</strong>！</p>
<p>所以今天教大家在云服务器上部署Clawdbot，这样你就能得到一个7 x 24工作的AI助理了</p>
<h2 data-id="heading-1">2.效果</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/214d345aa3104c75a9d8fba1930095c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=3UOFSyvs%2ByCZ8rJ30cq1L7zln34%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">3.准备工作</h2>
<p>我们需要准备一台非国内的服务器，不得不说腾讯的速度真是快，直接就上线了Clawdbot的云服务器，一个月38元吧，想体验Clawdbot又不想用自己的Mac部署的友友，可以直接冲了</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbuy.cloud.tencent.com%2Flighthouse" target="_blank" title="https://buy.cloud.tencent.com/lighthouse" ref="nofollow noopener noreferrer">buy.cloud.tencent.com/lighthouse</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f81ca2b306e94f2fb145be30335daba5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=Ub22i9YPCdiyQsCB4Qy7OVYkpoQ%3D" alt="" loading="lazy"/></p>
<p>购买完成后，我们接着登录服务器进行配置</p>
<h2 data-id="heading-3">4.登录配置</h2>
<ol>
<li>
<p>登录Lighthouse控制台，进入实例页面，找到刚买的服务器，点登录</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/090d65babd7c48f089d50720721abfc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=fSk2PoFOxpgMZtja4hgXr0r4C04%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>选择免密登录，免密连接就能登录上服务器</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/110d22cf987346cf9d67fb1710612c88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=WzrP7sePhp%2FbRuBg1xquqIqKxJA%3D" alt="" loading="lazy"/></p>
</li>
</ol>
<p>登录成功后，只需运行一条命令：</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot onboard
</code></pre>
<p>按提示完成后续配置，你的专属AI助理就能开始工作了！各个步骤的说明如下</p>
<h2 data-id="heading-4">5.配置细节</h2>
<p><strong>1.同意免责声明</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beb99271015e46f8b6f8ee8651266489~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=C5weRAK7PoQVoH1JhB4wbVo7yU8%3D" alt="" loading="lazy"/></p>
<p><strong>2.配置模式选QuickStart</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a51d6f11b92b4eb9a45e369ab74602d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=zFkWLNtheFj2gu37HbD58ZC2AC8%3D" alt="" loading="lazy"/></p>
<p><strong>3.模型配置</strong></p>
<p>根据提示信息选择你要用的模型，这里小卷使用的Qwen，然后将下面提示的地址拷贝出来，在浏览器打开，登录千问就行了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbba03806f3f47d99d28884a842ddcce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=2swK%2B5VEcD8uM1kWJ%2FEol62lgs8%3D" alt="" loading="lazy"/></p>
<p><strong>4.聊天软件配置</strong></p>
<p>这里官方支持的聊天软件都是国外的，我们基本是不会用到的，所以小卷用telegram作为演示</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7cbbaf7e2804fcbb51ced5467947a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=BIfeFOi1YGSlscdVahx07BxxnkQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">6.接入Telegram</h2>
<p>1.打开 Telegram（需要自己安装或者使用网页版），搜索 @BotFather</p>
<p>2.发送 /newbot，按提示起名（用户名必须以 bot 结尾）</p>
<p>3.复制生成的 token（类似 123456789:ABCdef...)</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/313e6525774f488897eaadc45483aebd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=%2Bc9BfsZ%2FuAf%2BjaTzFvOAfXOZrLA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/703fcc82106d428bb9ce2d92e1bc2542~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=Zwj%2BhiV8a65VXqNqkMcYWzPkxqE%3D" alt="" loading="lazy"/></p>
<p>把 token 告诉 AI，它会自动写入配置</p>
<p>然后在 Telegram 里获取配对码，发给 AI：</p>
<p>AI 会帮你执行配对命令：</p>
<pre><code class="hljs language-xml" lang="xml"> clawdbot pairing approve telegram <span class="hljs-tag">&lt;<span class="hljs-name">配对码</span>&gt;</span> 
</code></pre>
<p>完成！现在可以在 Telegram 里正常聊天了：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aef8e054364f42d3958acf5556124f85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2356aP5ZCM5a2m:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770144717&amp;x-signature=YJF69AmqtAxO4izOFFjjosGeH3o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">7.可能的问题</h2>
<p>接入telegram这一步可能出现Clawdbot没有运行起来，报错：Systemd user services are unavailable. Skipping lingering checks and service install</p>
<p>解决方法：</p>
<ul>
<li>SSH登录上服务器</li>
<li>执行命令<code>clawdbot gateway run</code>解决，之后正常执行上面的步骤就行</li>
</ul>
<p>检查Clawdbot有没有运行起来的命令：</p>
<ul>
<li>执行<code>ss -lntp | grep 18789</code>查看有没有输出，有就说明已经运行了</li>
</ul>
<p>Clawdbox的玩法远不止这些。你可以让它:</p>
<ul>
<li>定时提醒你喝水、运动</li>
<li>帮你整理待办事项</li>
<li>查快递、查天气</li>
<li>甚至写代码、调试程序</li>
</ul>
<p>这些高级玩法,我会在后面的文章里慢慢分享。</p>
<p>先把这个基础版搭起来,体验一下拥有AI助理的感觉吧。相信我,用上就回不去了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[grep一下]]></title>    <link>https://juejin.cn/post/7599826983888109611</link>    <guid>https://juejin.cn/post/7599826983888109611</guid>    <pubDate>2026-01-27T16:22:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599826983888109611" data-draft-id="7599843186203328554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="grep一下"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T16:22:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="J船长"/> <meta itemprop="url" content="https://juejin.cn/user/1820446987136903"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            grep一下
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1820446987136903/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    J船长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T16:22:32.000Z" title="Tue Jan 27 2026 16:22:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">grep 实战指南：把日志过滤一下</h2>
<p><em>grep</em> （<em>缩写</em>来自Globally search a Regular Expression and Print）是一种强大的文本搜索工具，它能使用特定模式匹配（包括正则表达式）搜索文本，并默认输出匹配行。</p>
<hr/>
<h3 data-id="heading-1">0. 准备：创建示例日志文件</h3>
<p>在终端执行：</p>
<pre><code class="hljs language-c" lang="c">nano test.<span class="hljs-built_in">log</span>
</code></pre>
<p>粘贴下面内容：</p>
<pre><code class="hljs language-ini" lang="ini">2026-01-27 10:01:12 INFO  App started
2026-01-27 10:01:15 INFO  User login success <span class="hljs-attr">userId</span>=<span class="hljs-number">123</span>
2026-01-27 10:02:01 WARN  VIDEO_BLUR enabled for low bandwidth
2026-01-27 10:02:05 ERROR Network REJECT_TIMEOUT while calling API
2026-01-27 10:02:07 DEBUG psi-p packet received <span class="hljs-attr">size</span>=<span class="hljs-number">512</span>
2026-01-27 10:02:10 INFO  Request finished <span class="hljs-attr">traceId</span>=abc
2026-01-27 10:03:00 ERROR Payment failed <span class="hljs-attr">orderId</span>=<span class="hljs-number">998</span>
2026-01-27 10:03:10 INFO  App closed
</code></pre>
<p>保存退出：<code>Ctrl + O</code> → 回车 → <code>Ctrl + X</code></p>
<p>查看文件：</p>
<pre><code class="hljs language-matlab" lang="matlab"><span class="hljs-built_in">cat</span> test.<span class="hljs-built_in">log</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">1. 单关键词过滤（忽略大小写）</h3>
<h4 data-id="heading-3">命令</h4>
<pre><code class="hljs language-lua" lang="lua">grep -i <span class="hljs-built_in">error</span> test.<span class="hljs-built_in">log</span>
</code></pre>
<h4 data-id="heading-4">实际输出</h4>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">27</span> <span class="hljs-number">10</span>:<span class="hljs-number">02</span>:<span class="hljs-number">05</span> <span class="hljs-keyword">ERROR</span> Network REJECT_TIMEOUT <span class="hljs-keyword">while</span> calling API
<span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">27</span> <span class="hljs-number">10</span>:<span class="hljs-number">03</span>:<span class="hljs-number">00</span> <span class="hljs-keyword">ERROR</span> Payment failed orderId=<span class="hljs-number">998</span>
</code></pre>
<h4 data-id="heading-5">解释</h4>
<ul>
<li><code>grep</code>：搜索工具</li>
<li><code>error</code>：关键词</li>
<li><code>-i</code>：忽略大小写（error / ERROR 都匹配）</li>
</ul>
<hr/>
<h3 data-id="heading-6">2. 多关键词 OR（error 或 timeout 或 fail）</h3>
<h4 data-id="heading-7">命令</h4>
<pre><code class="hljs language-c" lang="c">grep -E -i <span class="hljs-string">"error|timeout|fail"</span> test.<span class="hljs-built_in">log</span>
</code></pre>
<h4 data-id="heading-8">实际输出</h4>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">27</span> <span class="hljs-number">10</span>:<span class="hljs-number">02</span>:<span class="hljs-number">05</span> <span class="hljs-keyword">ERROR</span> Network REJECT_TIMEOUT <span class="hljs-keyword">while</span> calling API
<span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">27</span> <span class="hljs-number">10</span>:<span class="hljs-number">03</span>:<span class="hljs-number">00</span> <span class="hljs-keyword">ERROR</span> Payment failed orderId=<span class="hljs-number">998</span>
</code></pre>
<p>（第一行包含 timeout，第二行包含 fail）</p>
<h4 data-id="heading-9">解释</h4>
<ul>
<li><code>-E</code>：启用扩展正则，支持 <code>A|B|C</code></li>
<li><code>|</code>：或（OR）</li>
<li><code>-i</code>：忽略大小写</li>
</ul>
<hr/>
<h3 data-id="heading-10">3. 指定你原始的 3 个关键词</h3>
<h4 data-id="heading-11">命令</h4>
<pre><code class="hljs language-c" lang="c">grep -E -i <span class="hljs-string">"REJECT_TIMEOUT|VIDEO_BLUR|psi-p"</span> test.<span class="hljs-built_in">log</span>
</code></pre>
<h4 data-id="heading-12">实际输出</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2026-01-27 10:02:01 </span><span class="hljs-string">WARN</span>  <span class="hljs-string">VIDEO_BLUR</span> <span class="hljs-string">enabled</span> <span class="hljs-string">for</span> <span class="hljs-string">low</span> <span class="hljs-string">bandwidth</span>
<span class="hljs-number">2026-01-27 10:02:05 </span><span class="hljs-string">ERROR</span> <span class="hljs-string">Network</span> <span class="hljs-string">REJECT_TIMEOUT</span> <span class="hljs-string">while</span> <span class="hljs-string">calling</span> <span class="hljs-string">API</span>
<span class="hljs-number">2026-01-27 10:02:07 </span><span class="hljs-string">DEBUG</span> <span class="hljs-string">psi-p</span> <span class="hljs-string">packet</span> <span class="hljs-string">received</span> <span class="hljs-string">size=512</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">4. 多条件 AND（同时包含 error 和 timeout）</h3>
<h4 data-id="heading-14">命令</h4>
<pre><code class="hljs language-css" lang="css">grep -<span class="hljs-selector-tag">i</span> error test<span class="hljs-selector-class">.log</span> | grep -<span class="hljs-selector-tag">i</span> timeout
</code></pre>
<h4 data-id="heading-15">实际输出</h4>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">27</span> <span class="hljs-number">10</span>:<span class="hljs-number">02</span>:<span class="hljs-number">05</span> <span class="hljs-keyword">ERROR</span> Network REJECT_TIMEOUT <span class="hljs-keyword">while</span> calling API
</code></pre>
<h4 data-id="heading-16">解释</h4>
<p>两次过滤：</p>
<ol>
<li>先找 error</li>
<li>再从结果里找 timeout</li>
</ol>
<hr/>
<h3 data-id="heading-17">5. 显示行号</h3>
<h4 data-id="heading-18">命令</h4>
<pre><code class="hljs language-lua" lang="lua">grep -n -i <span class="hljs-built_in">error</span> test.<span class="hljs-built_in">log</span>
</code></pre>
<h4 data-id="heading-19">实际输出</h4>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">4</span>:<span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">27</span> <span class="hljs-number">10</span>:<span class="hljs-number">02</span>:<span class="hljs-number">05</span> <span class="hljs-keyword">ERROR</span> Network REJECT_TIMEOUT <span class="hljs-keyword">while</span> calling API
<span class="hljs-number">7</span>:<span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">27</span> <span class="hljs-number">10</span>:<span class="hljs-number">03</span>:<span class="hljs-number">00</span> <span class="hljs-keyword">ERROR</span> Payment failed orderId=<span class="hljs-number">998</span>
</code></pre>
<hr/>
<h3 data-id="heading-20">6. 查看上下文（前后各 2 行）</h3>
<h4 data-id="heading-21">命令</h4>
<pre><code class="hljs language-c" lang="c">grep -n -C <span class="hljs-number">2</span> -i <span class="hljs-string">"REJECT_TIMEOUT"</span> test.<span class="hljs-built_in">log</span>
</code></pre>
<h4 data-id="heading-22">实际输出</h4>
<pre><code class="hljs language-ini" lang="ini">2-2026-01-27 10:01:15 INFO  User login success <span class="hljs-attr">userId</span>=<span class="hljs-number">123</span>
3-2026-01-27 10:02:01 WARN  VIDEO_BLUR enabled for low bandwidth
4:2026-01-27 10:02:05 ERROR Network REJECT_TIMEOUT while calling API
5-2026-01-27 10:02:07 DEBUG psi-p packet received <span class="hljs-attr">size</span>=<span class="hljs-number">512</span>
6-2026-01-27 10:02:10 INFO  Request finished <span class="hljs-attr">traceId</span>=abc
</code></pre>
<hr/>
<h3 data-id="heading-23">7. 排除某类日志（去掉 DEBUG）</h3>
<h4 data-id="heading-24">命令</h4>
<pre><code class="hljs language-c" lang="c">grep -v <span class="hljs-string">"DEBUG"</span> test.<span class="hljs-built_in">log</span>
</code></pre>
<h4 data-id="heading-25">实际输出</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2026-01-27 10:01:12 </span><span class="hljs-string">INFO</span>  <span class="hljs-string">App</span> <span class="hljs-string">started</span>
<span class="hljs-number">2026-01-27 10:01:15 </span><span class="hljs-string">INFO</span>  <span class="hljs-string">User</span> <span class="hljs-string">login</span> <span class="hljs-string">success</span> <span class="hljs-string">userId=123</span>
<span class="hljs-number">2026-01-27 10:02:01 </span><span class="hljs-string">WARN</span>  <span class="hljs-string">VIDEO_BLUR</span> <span class="hljs-string">enabled</span> <span class="hljs-string">for</span> <span class="hljs-string">low</span> <span class="hljs-string">bandwidth</span>
<span class="hljs-number">2026-01-27 10:02:05 </span><span class="hljs-string">ERROR</span> <span class="hljs-string">Network</span> <span class="hljs-string">REJECT_TIMEOUT</span> <span class="hljs-string">while</span> <span class="hljs-string">calling</span> <span class="hljs-string">API</span>
<span class="hljs-number">2026-01-27 10:02:10 </span><span class="hljs-string">INFO</span>  <span class="hljs-string">Request</span> <span class="hljs-string">finished</span> <span class="hljs-string">traceId=abc</span>
<span class="hljs-number">2026-01-27 10:03:00 </span><span class="hljs-string">ERROR</span> <span class="hljs-string">Payment</span> <span class="hljs-string">failed</span> <span class="hljs-string">orderId=998</span>
<span class="hljs-number">2026-01-27 10:03:10 </span><span class="hljs-string">INFO</span>  <span class="hljs-string">App</span> <span class="hljs-string">closed</span>
</code></pre>
<hr/>
<h3 data-id="heading-26">8. 只看最后 N 行再过滤</h3>
<h4 data-id="heading-27">命令</h4>
<pre><code class="hljs language-lua" lang="lua">tail -n <span class="hljs-number">4</span> test.<span class="hljs-built_in">log</span> | grep -i <span class="hljs-built_in">error</span>
</code></pre>
<h4 data-id="heading-28">实际输出</h4>
<pre><code class="hljs language-ini" lang="ini">2026-01-27 10:03:00 ERROR Payment failed <span class="hljs-attr">orderId</span>=<span class="hljs-number">998</span>
</code></pre>
<hr/>
<h3 data-id="heading-29">9. 实时监控日志</h3>
<h4 data-id="heading-30">命令</h4>
<pre><code class="hljs language-lua" lang="lua">tail -f test.<span class="hljs-built_in">log</span> | grep -i <span class="hljs-built_in">error</span>
</code></pre>
<h4 data-id="heading-31">模拟追加日志</h4>
<p>另一个终端执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"2026-01-27 10:04:00 ERROR New crash happened"</span> &gt;&gt; test.log
</code></pre>
<h4 data-id="heading-32">实时窗口看到</h4>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">27</span> <span class="hljs-number">10</span>:<span class="hljs-number">04</span>:<span class="hljs-number">00</span> <span class="hljs-keyword">ERROR</span> <span class="hljs-built_in">New</span> crash happened
</code></pre>
<hr/>
<h3 data-id="heading-33">10. 你那条命令的完整含义</h3>
<pre><code class="hljs language-c" lang="c">grep -E -i <span class="hljs-string">"REJECT_TIMEOUT|VIDEO_BLUR|psi-p"</span> tico_app2.<span class="hljs-built_in">log</span>
</code></pre>
<p>等价于：</p>
<blockquote>
<p>在 tico_app2.log 中查找包含以下任意关键词的行：</p>
<ul>
<li>REJECT_TIMEOUT</li>
<li>VIDEO_BLUR</li>
<li>psi-p</li>
</ul>
<p>并忽略大小写。</p>
</blockquote>
<hr/>
<h3 data-id="heading-34">11. 必记 5 条黄金命令</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 单关键词</span>
<span class="hljs-keyword">grep</span> -i error app.log

<span class="hljs-comment"># 多关键词 OR</span>
<span class="hljs-keyword">grep</span> -E -i <span class="hljs-string">"error|timeout|fail"</span> app.log

<span class="hljs-comment"># 多条件 AND</span>
<span class="hljs-keyword">grep</span> -i error app.log | <span class="hljs-keyword">grep</span> -i timeout

<span class="hljs-comment"># 行号 + 上下文</span>
<span class="hljs-keyword">grep</span> -n -C <span class="hljs-number">3</span> -i error app.log

<span class="hljs-comment"># 实时监控</span>
tail -f app.log | <span class="hljs-keyword">grep</span> -i error
</code></pre>
<hr/>
<h3 data-id="heading-35">12. 更快的替代：ripgrep（rg）</h3>
<pre><code class="hljs language-c" lang="c">brew install ripgrep
rg -i <span class="hljs-string">"error|timeout|fail"</span> app.<span class="hljs-built_in">log</span>
</code></pre>
<p>速度通常比 grep 快 3~10 倍。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[爷爷你关注的前端博主复活了！！ 他学python去了？？]]></title>    <link>https://juejin.cn/post/7599899147418075188</link>    <guid>https://juejin.cn/post/7599899147418075188</guid>    <pubDate>2026-01-27T16:36:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599899147418075188" data-draft-id="7599910677578694656" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="爷爷你关注的前端博主复活了！！ 他学python去了？？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T16:36:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jinzunqinjiu"/> <meta itemprop="url" content="https://juejin.cn/user/240120725766732"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            爷爷你关注的前端博主复活了！！ 他学python去了？？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/240120725766732/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jinzunqinjiu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T16:36:20.000Z" title="Tue Jan 27 2026 16:36:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">如何配置python环境。</h2>
<p>hello，兄弟们马上过年了，想死你们了。转眼间就已经毕业半年。也工作了快一年了。从实习生一路跌跌撞撞，从刚开始连react的状态依赖都老是写死循环到现在已经经历过很多项目了。说来这一年也有很多成长，参与了公司很多的项目，看过各种代码。最终在ai的加持下已经能够独挡一面。但是最近公司开始掀起了一股ai风，以及网上ai全栈的兴起，我想我是坐不住了。深耕前端 or 技术转型。 小孩子才做选择，前端为主ai为辅，所以我要开始学习python逐渐开始学习ai应用了。正好我也没有安装python，那我们一起安装一下python环境吧。</p>
<h4 data-id="heading-1">安装python</h4>
<p>首先我们来到pthton官网<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%25E3%2580%2582" target="_blank" title="https://www.python.org%E3%80%82" ref="nofollow noopener noreferrer">www.python.org。</a>
选择对应的系统。这里我选择macOS。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76327adc21dc47bebaa415ceb7406524~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=K50kwJ%2BxZ9tmNNCOqHw%2BAX1TAbg%3D" alt="image.png" loading="lazy"/></p>
<p>这里我选择最新的release版本-python 3.14.2（学新不学旧嘛）。 点击这个Latest Python 3 Release3.14.2.
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e74565ebd01144a19201779c1f5a963d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=8tg%2BiEtJkJg3wQ%2BYMZQeI2y6peg%3D" alt="image.png" loading="lazy"/></p>
<p>点开后滑到最后选择macOS installer。然后就会在浏览器中下载python的安装程序。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/900bb691a6bd4a8283e47701649ea2b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=XzQarJMWBX1uG0fdnhpEO97%2F6g8%3D" alt="image.png" loading="lazy"/></p>
<p>下载完成后点开python 安装程序一路继续到完成。这样我们就下载完成了。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/761c7a300ab446e9b57486e5f5a25232~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=rSUwpX62o21tgdXS3dVNtQE6GtE%3D" alt="image.png" loading="lazy"/></p>
<p>我们可以看到我们电脑上已经拥有了python文件。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ed2078c5ca14976b9c1c471a125790a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=qyXd3jdvk1SyB1Qec4qiQtAc4dk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">验证python是否安装成功</h3>
<p>用pyhton安装器安装完python后如何验证是否安装成功了。我们打开我们电脑的终端。输入python --version看看是否存在版本号。很神奇的是，并没有找到python的版本号？？ 难道我们安装失败啦？？no no no，我要验牌。问了一下deepseek，我们安装的是python3，要用pyhton3的命令查找。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ea96ed473c84bda8b266e47557af956~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=EhKJ6D3wR9U0813Q%2Bs9zQbrl2lE%3D" alt="image.png" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44359a525e2c4e708a7925ac5e5698d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=G%2Ftba3bHcyaSgDNErc0Gyl44f8I%3D" alt="image.png" loading="lazy"/></p>
<p>那我们用python3的命令吧。pyhton3 --version pip3 --version(这里我想做一个类比。pip就像是node里面的npm包管理器)</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/215012698ca645dba29aedec787759f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=pix6%2FX1Zn2SMsgzCr%2FCPgtyqdBk%3D" alt="image.png" loading="lazy"/>
当两个都有版本的时候，我们的python3就安装完成了。蒸蚌！ 让我们用python在终端写下第一行代码吧。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18baa4fd16844809b37178187a8e5e48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=Eib6s0O5vfktIJqU96aIFwtyCd8%3D" alt="image.png" loading="lazy"/>
首先我们输入python3打开python交互环境。输入print("Hello World").</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85a77f0f4e794c3fa14150b436696be7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamluenVucWluaml1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770136585&amp;x-signature=Tv%2B2MrVqFwlgGTM0bfcNttZwJl0%3D" alt="image.png" loading="lazy"/>嘿嘿嘿，道爷我成了，怎么样是不是特简单。</p>
<h4 data-id="heading-3">结语</h4>
<p>我觉得，开始的意义就在于开始。虽然是前端，但是我是程序员。只要肯学，没有学不了的东西。不能给自己设限，特别是在ai时代。个人能力的边界在无限的延伸，要勇于尝试新鲜的事物。这才是生命的意义。由于懒的原因。运行pyhton的IDE的安装我们下集再说。我们可以在VScode，Jupyter Notebook，PyCharm中运行我们的代码。不同的编译器有不同的使用场景。特别是在训练ai模型的时候Jupyter Notebook可是一个很好的工具。大家晚安。多写一个字都得累嘎了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[type-challenges（ts类型体操）: 3 - 实现 Omit]]></title>    <link>https://juejin.cn/post/7599835610406879278</link>    <guid>https://juejin.cn/post/7599835610406879278</guid>    <pubDate>2026-01-27T15:07:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599835610406879278" data-draft-id="7599924965950685222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="type-challenges（ts类型体操）: 3 - 实现 Omit"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-27T15:07:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fxss"/> <meta itemprop="url" content="https://juejin.cn/user/3702810892856808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            type-challenges（ts类型体操）: 3 - 实现 Omit
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810892856808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fxss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:07:07.000Z" title="Tue Jan 27 2026 15:07:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">3 - 实现 Omit</h2>
<p>by Anthony Fu (@antfu) #中等 #union #built-in</p>
<h3 data-id="heading-1">题目</h3>
<p>不使用 <code>Omit</code> 实现 TypeScript 的 <code>Omit&lt;T, K&gt;</code> 泛型。</p>
<p><code>Omit</code> 会创建一个省略 <code>K</code> 中字段的 <code>T</code> 对象。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = <span class="hljs-title class_">MyOmit</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'description'</span> | <span class="hljs-string">'title'</span>&gt;

<span class="hljs-keyword">const</span> <span class="hljs-attr">todo</span>: <span class="hljs-title class_">TodoPreview</span> = {
  <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
}
</code></pre>
<blockquote>
<p>在 Github 上查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F3%2Fzh-CN" target="_blank" title="https://tsch.js.org/3/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/3/zh-CN</a></p>
</blockquote>
<h3 data-id="heading-2">代码</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 你的代码 _____________ */</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">MyOmit</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt; = {
  [P <span class="hljs-keyword">in</span> keyof T <span class="hljs-keyword">as</span> P <span class="hljs-keyword">extends</span> K ? <span class="hljs-built_in">never</span> : P]: T[P]
}

</code></pre>
<p>关键解释：</p>
<ul>
<li><code>T</code>：泛型参数，代表任意对象类型；</li>
<li><code>K extends keyof T</code>：约束 <code>K</code> 必须是 <code>T</code> 的属性名之一；</li>
<li><code>[P in keyof T as P extends K ? never : P]</code>：映射类型，遍历 <code>T</code> 的所有属性名 <code>P</code>，如果 <code>P</code> 不在 <code>K</code> 中，则保留 <code>P</code>，否则移除 <code>P</code>。</li>
<li><code>T[P]</code>：索引访问类型，代表 <code>T</code> 类型中 <code>P</code> 属性对应的类型。</li>
</ul>
<h3 data-id="heading-3">相关知识点</h3>
<h4 data-id="heading-4"><code>keyof</code></h4>
<p><code>keyof</code> 操作符用于获取一个类型（接口、类型别名、对象类型等）的所有公共属性名，并返回这些属性名组成的联合类型。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = keyof <span class="hljs-title class_">Todo</span> <span class="hljs-comment">// "title" | "description" | "completed"</span>
</code></pre>
<h4 data-id="heading-5"><code>in</code></h4>
<p><code>in</code> 操作符用于遍历联合类型中的每个成员，将其转换为映射类型的属性名。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = {
  [P <span class="hljs-keyword">in</span> <span class="hljs-title class_">TodoKeys</span>]: <span class="hljs-title class_">Todo</span>[P]
}
<span class="hljs-comment">// TodoPreview 类型为：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   title: string</span>
<span class="hljs-comment">//   completed: boolean</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-6"><code>as</code></h4>
<p><code>as</code> 操作符用于在映射类型中自定义属性名。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoKeys</span> = <span class="hljs-string">'title'</span> | <span class="hljs-string">'description'</span> | <span class="hljs-string">'completed'</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoPreview</span> = {
  [P <span class="hljs-keyword">in</span> <span class="hljs-title class_">TodoKeys</span> <span class="hljs-keyword">as</span> P <span class="hljs-keyword">extends</span> <span class="hljs-string">'description'</span> ? <span class="hljs-built_in">never</span> : P]: <span class="hljs-title class_">Todo</span>[P]
}
<span class="hljs-comment">// TodoPreview 类型为：</span>
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   title: string</span>
<span class="hljs-comment">//   completed: boolean</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h3 data-id="heading-7">测试用例</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 测试用例 _____________ */</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Equal</span>, <span class="hljs-title class_">Expect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@type-challenges/utils'</span>

<span class="hljs-keyword">type</span> cases = [
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Expected1</span>, <span class="hljs-title class_">MyOmit</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'description'</span>&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Expected2</span>, <span class="hljs-title class_">MyOmit</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'description'</span> | <span class="hljs-string">'completed'</span>&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Expected3</span>, <span class="hljs-title class_">MyOmit</span>&lt;<span class="hljs-title class_">Todo1</span>, <span class="hljs-string">'description'</span> | <span class="hljs-string">'completed'</span>&gt;&gt;&gt;,
]

<span class="hljs-comment">// @ts-expect-error</span>
<span class="hljs-keyword">type</span> error = <span class="hljs-title class_">MyOmit</span>&lt;<span class="hljs-title class_">Todo</span>, <span class="hljs-string">'description'</span> | <span class="hljs-string">'invalid'</span>&gt;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo1</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Expected1</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Expected2</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Expected3</span> {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
}

</code></pre>
<h3 data-id="heading-8">相关链接</h3>
<blockquote>
<p>分享你的解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F3%2Fanswer%2Fzh-CN" target="_blank" title="https://tsch.js.org/3/answer/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/3/answer/zh…</a>
查看解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F3%2Fsolutions" target="_blank" title="https://tsch.js.org/3/solutions" ref="nofollow noopener noreferrer">tsch.js.org/3/solutions</a>
更多题目：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2Fzh-CN" target="_blank" title="https://tsch.js.org/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/zh-CN</a></p>
</blockquote>
<p>下面是我的公众号，欢迎关注。关注后有新的功能点会及时收到推送。</p>
<blockquote>
<p>实战为王！专注于汇总各种功能点，致力于打造一系列能够帮助工程师实现各种功能的想法思路的优质文章。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdeec99a0154e7aa73c1c6765f3dcf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnhzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770131411&amp;x-signature=iS9RiW8%2BzyTqmUq5tQDMljct9fM%3D" alt="前端功能点" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[免费图床不求人：用 Cloudflare R2 + PicGo 打造稳定图床方案]]></title>    <link>https://juejin.cn/post/7599868109085605930</link>    <guid>https://juejin.cn/post/7599868109085605930</guid>    <pubDate>2026-01-27T15:12:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599868109085605930" data-draft-id="7599843186203050026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="免费图床不求人：用 Cloudflare R2 + PicGo 打造稳定图床方案"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T15:12:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术更好说"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            免费图床不求人：用 Cloudflare R2 + PicGo 打造稳定图床方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术更好说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:12:48.000Z" title="Tue Jan 27 2026 15:12:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f1c49f85e9f403c81975d4a2175cfce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5pu05aW96K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770131573&amp;x-signature=7cy8ffO5bAOrt0HIFIC0FvoC4eY%3D" alt="2.jpg" loading="lazy"/>
说实话，这两年图床真是让我折腾够呛。
还记得2023年那会儿，我把博客图片都托管在 GitHub，配合 jsDelivr CDN 用得还挺香。结果有一天突然发现，博客里的图片全变成了裂图——jsDelivr 在国内被封了。看着几十篇文章里一片片空白，我心都凉了。
后来试过好几个免费图床，要么莫名其妙删图，要么直接停服跑路。七牛云、阿里云OSS 虽然稳定，但国内的要备案，还有超额收费的风险。老实讲，我真的不想再经历一次迁移图床的痛苦了。
直到我发现了 Cloudflare R2。
这个对象存储服务有 10GB 免费空间、每月 100 万次上传、1000 万次读取，关键是<strong>出口流量完全免费</strong>。用了半年下来，一分钱没花，访问速度也还不错。配合 PicGo 实现一键上传后，体验真的很丝滑。
不过说真的，第一次配置 R2 的时候我也踩了不少坑。特别是公开访问设置和 PicGo 的 S3 插件配置，网上的教程参差不齐，参数名称也不统一，试了好几次才成功。
所以这篇文章，我把整个搭建过程完整梳理一遍，手把手教你：</p>
<ul>
<li>为什么 R2 是目前最值得选择的免费图床方案</li>
<li>如何正确配置 R2 的公开访问（避开常见陷阱）</li>
<li>PicGo 怎么连接 R2（傻瓜式配置，一次成功）
如果你也在为图床问题头疼，跟着这篇文章走，30 分钟就能搞定。</li>
</ul>
<h2 data-id="heading-0">为什么选择 R2 做图床？</h2>
<p>在决定用 R2 之前，我其实对比过挺多方案。这里先聊聊各种免费图床的现状，你就明白为啥我最后选了 R2。</p>
<h3 data-id="heading-1">其他免费图床方案的问题</h3>
<p><strong>GitHub + jsDelivr</strong>：这曾经是最香的方案，但现在已经不行了。jsDelivr 在国内遭到 DNS 污染被封锁，博客图片完全加载不出来。而且说实话，用 GitHub 存图片本来就是一种滥用，每次上传图片都会产生一个 commit，污染提交记录不说，万一哪天账号被封，所有图片就全没了。
<strong>免费公共图床</strong>（如 SM.MS、路过图床等）：这类服务的问题在于不稳定。有些会莫名删除用户图片，有些直接停服跑路。我见过太多博主辛辛苦苦写的文章，因为图床停服全都变成了裂图。免费服务确实香，但你敢把博客的图片资源全押在上面吗？
<strong>国内云服务商</strong>（七牛云、阿里云 OSS、腾讯云 COS）：这些服务确实稳定，七牛云也有 10GB 免费额度。但关键问题是：国内的云服务都<strong>要求域名备案</strong>。对个人博客来说，备案流程繁琐不说，还有超额收费的风险。虽然成本不算高（超出10GB后大概每月几块钱），但心里总感觉不踏实。</p>
<h3 data-id="heading-2">R2 的核心优势</h3>
<p>对比下来，Cloudflare R2 真的是目前个人图床的最优解。我用了半年，总结出这几个核心优势：
<strong>1. 免费额度超级够用</strong>
R2 的免费额度包括：</p>
<ul>
<li>存储空间：10 GB</li>
<li>每月上传次数：100 万次（A 类操作）</li>
<li>每月读取次数：1000 万次（B 类操作）
对个人博客来说，这个额度绰绰有余。我自己的博客有 100 多篇文章、大概 500 张图片，总共占用不到 2GB 空间。按这个速度，10GB 能用好几年。而且即使真超出了，收费也很便宜：存储 $0.015/GB/月，换算下来 1GB 每月才 1 毛钱人民币。
<strong>2. 出口流量完全免费</strong>
这是 R2 相比 AWS S3 最大的优势。传统云存储（像 S3、阿里云 OSS）都会对出口流量收费，每 GB 几毛到几块钱不等。如果你的博客访问量大，这个费用可能比存储费还高。
而 R2 的出口流量完全免费。不管你的图片被访问多少次、下载多少次，都不会产生额外费用。这是因为 Cloudflare 利用自己的全球 CDN 网络（100+ 国家、275 个城市）来分发内容，流量都走内部网络，不需要额外收费。
<strong>3. 大厂背书，稳定可靠</strong>
Cloudflare 是全球最大的 CDN 服务商之一，市值几百亿美元。用它的服务，至少不用担心突然跑路或删图。而且 Cloudflare 一直有"赛博菩萨"的美誉，很多服务对个人用户都特别友好。
<strong>4. 兼容 S3 API，未来可迁移</strong>
R2 完全兼容 AWS S3 的 API 标准。这意味着如果将来你想迁移到其他支持 S3 协议的服务（比如 MinIO、阿里云 OSS），只需要改改配置，不用重写代码或工具。这种灵活性让你不用担心被厂商锁定。
<strong>5. 无需备案，开箱即用</strong>
R2 是国际服务，绑定自己的域名不需要备案。注册 Cloudflare 账号、开通 R2、配置完成，全程 30 分钟搞定。这对个人博客主来说真的太友好了。</li>
</ul>
<h3 data-id="heading-3">一个小提醒</h3>
<p>R2 唯一需要注意的是：开通服务需要绑定信用卡或 PayPal。这只是为了验证身份，不会自动扣费。我当时也犹豫了一下，但绑定后发现确实只是验证，用了半年没产生过一分钱费用。如果你实在担心，可以用虚拟信用卡，或者绑定国内的 PayPal（也是支持的）。
好了，说了这么多优势，接下来咱们正式开始搭建。</p>
<h2 data-id="heading-4">R2 图床搭建详细步骤</h2>
<p>好，现在进入实战环节。我会把每一步都讲清楚，跟着操作就行。</p>
<h3 data-id="heading-5">第一步：注册并开通 R2 服务</h3>
<p>首先你得有一个 Cloudflare 账号。如果还没有，去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdash.cloudflare.com%2Fsign-up" target="_blank" title="https://dash.cloudflare.com/sign-up" ref="nofollow noopener noreferrer">Cloudflare 官网</a> 免费注册一个，填个邮箱和密码就行，很简单。
注册登录后，在左侧边栏找到「R2 对象存储」，点进去。如果是第一次使用，会提示你开通服务。
<strong>重点来了</strong>：开通 R2 需要绑定支付方式（信用卡或 PayPal）。
这里要特别说明一下，很多人看到这步就退缩了，我当时也犹豫。但其实这只是为了验证身份，<strong>不会自动扣费</strong>。Cloudflare 的免费额度是真免费，只有你主动超出额度并确认付费才会扣钱。
你可以绑定：</p>
<ul>
<li>支持外币的信用卡（Visa、MasterCard 都行）</li>
<li>PayPal（国内的 PayPal 也支持）</li>
<li>虚拟信用卡（担心安全的话可以用这个）
绑定完成后，点击「开通 R2 服务」，几秒钟就好了。</li>
</ul>
<h3 data-id="heading-6">第二步：创建存储桶（Bucket）</h3>
<p>开通 R2 后，点击右上角的「创建存储桶」按钮。
<strong>存储桶名称</strong>：起一个有辨识度的名字，比如 <code>blog-images</code>、<code>my-pics</code> 之类的。注意这个名字是全局唯一的，如果重名了需要换一个。
<strong>位置选择</strong>：这里有个小技巧。
很多教程会无脑推荐选「亚太地区（APAC）」，理由是离国内近、速度快。但其实不一定。我试过两个位置，发现：</p>
<ul>
<li><strong>亚太地区</strong>：国内访问确实快一些，但国际访问速度受限</li>
<li><strong>北美西部（WNAM）</strong>：配合 Cloudflare 的 CDN，全球访问速度都比较均衡，国内速度也能接受
我个人选的是北美西部，因为博客可能有国外读者，综合体验更好。你可以根据自己的受众情况选择。
<strong>存储类</strong>：选择「标准（Standard）」就行。
然后点击「创建」，几秒钟后存储桶就建好了。</li>
</ul>
<h3 data-id="heading-7">第三步：配置公开访问（关键步骤）</h3>
<p>创建好存储桶后，进入存储桶的设置页面。接下来这一步很关键，也是很多人容易卡住的地方。
R2 默认是私有的，要让图片能被公开访问，有两种方式：
<strong>方式一：启用 r2.dev 子域名（适合测试）</strong>
这是最简单的方式，适合刚开始测试用。</p>
<ol>
<li>在存储桶设置页面，向下滚动找到「R2.dev 子域」</li>
<li>点击「允许访问（Allow Access）」</li>
<li>在弹出的确认框中输入 <code>allow</code>，然后点击确认
完成后，Cloudflare 会给你生成一个公开访问 URL，类似：</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//pub-xxxxx.r2.dev</span>
</code></pre>
<p><strong>但是！这里有个重要的坑</strong>：r2.dev 子域名有<strong>访问速率限制</strong>，只适合开发测试用。如果你的博客访问量大，很容易触发限制导致图片加载不出来。Cloudflare 官方也明确说了，生产环境必须用自定义域名。
我第一次配置的时候没注意这点，结果博客访问量稍微大一点，图片就加载失败。后来才改成自定义域名，血泪教训啊。
<strong>方式二：绑定自定义域名（生产推荐）</strong>
如果你有自己的域名，强烈建议用这种方式。不仅没有速率限制，还能配置缓存、防盗链等高级功能。
<strong>前提条件</strong>：你的域名已经托管到 Cloudflare（也就是把域名的 DNS 服务器改成 Cloudflare 的）。如果还没托管，去 Cloudflare 控制台添加域名，按提示修改 DNS 服务器就行，免费的。
配置步骤：</p>
<ol>
<li>在存储桶设置页面，找到「自定义域（Custom Domains）」</li>
<li>点击「添加（Add）」</li>
<li>输入你想用的子域名，比如 <code>img.yourdomain.com</code></li>
<li>点击「继续（Continue）」</li>
<li>Cloudflare 会自动在你的 DNS 记录里添加一条 CNAME 记录</li>
<li>点击「连接域名（Connect Domain）」
等待几分钟 DNS 生效，你的自定义域名就可以用了。以后访问图片的 URL 就是：</li>
</ol>

<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/img.yourdomain.com/path</span><span class="hljs-regexp">/to/image</span>.png
</code></pre>
<p>我自己用的就是自定义域名，配合后面讲的缓存策略，既稳定又快速。</p>
<h3 data-id="heading-8">第四步：创建 API 令牌</h3>
<p>配置好公开访问后，还需要生成 API 密钥，这样 PicGo 才能连接到 R2 上传图片。</p>
<ol>
<li>回到 R2 的「概述（Overview）」页面</li>
<li>点击右上角的「管理 R2 API 令牌（Manage R2 API Tokens）」</li>
<li>点击「创建 API 令牌（Create API Token）」</li>
<li>给令牌起个名字，比如 <code>PicGo-Upload</code></li>
<li>权限这里选择「对象读和写（Object Read &amp; Write）」</li>
<li>点击「创建 API 令牌」
<strong>超级重要！</strong> 创建完成后，Cloudflare 会显示三个信息：</li>
</ol>
<ul>
<li><strong>访问密钥 ID</strong>（Access Key ID）</li>
<li><strong>访问密钥</strong>（Secret Access Key）</li>
<li><strong>S3 API 端点</strong>（类似 <code>https://xxxxx.r2.cloudflarestorage.com</code>）
这三个信息<strong>只会显示一次</strong>！关闭页面后就再也看不到了。一定要立即复制保存到安全的地方，比如密码管理器或者本地加密文件。
如果不小心关掉了，只能删除令牌重新创建。我第一次就是手快关掉了，又重新创建了一遍，别学我。
<strong>小贴士</strong>：S3 API 端点也可以在「概述」→「通过 S3 API 使用 R2」里找到，就是那个 HTTPS 开头的网址。
好了，R2 这边的配置就完成了。接下来配置 PicGo。</li>
</ul>
<h2 data-id="heading-9">PicGo 配置实战</h2>
<p>PicGo 是一个开源的图片上传工具，支持各种图床服务。配置好之后，你就可以直接拖拽图片上传，自动生成 Markdown 格式的图片链接，超级方便。</p>
<h3 data-id="heading-10">第一步：安装 PicGo 和 S3 插件</h3>
<p><strong>下载 PicGo</strong>
去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmolunerfinn.com%2FPicGo%2F" target="_blank" title="https://molunerfinn.com/PicGo/" ref="nofollow noopener noreferrer">PicGo 官网</a> 或 GitHub Release 页面下载对应系统的安装包：</p>
<ul>
<li>Windows：下载 <code>.exe</code> 文件</li>
<li>macOS：下载 <code>.dmg</code> 文件</li>
<li>Linux：下载 <code>.AppImage</code> 文件
安装很简单，按提示一路下一步就行。
<strong>进阶推荐：PicList</strong>
如果你想要更多功能，推荐用 PicGo 的二开项目 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKuingsmile%2FPicList" target="_blank" title="https://github.com/Kuingsmile/PicList" ref="nofollow noopener noreferrer">PicList</a>。它在 PicGo 基础上增加了：</li>
<li>图片管理功能（可以查看、删除已上传的图片）</li>
<li>图片压缩（有损/无损）</li>
<li>格式转换（转 WebP 等）</li>
<li>添加水印
我自己现在用的就是 PicList，功能更全面。安装方法和 PicGo 一样。
<strong>安装 S3 插件</strong>
PicGo 默认不支持 S3 协议，需要安装插件。</li>
</ul>
<ol>
<li>打开 PicGo，点击左侧的「插件设置」</li>
<li>在搜索框输入 <code>s3</code></li>
<li>会看到几个插件，推荐安装 <code>picgo-plugin-s3</code> 或 <code>s3-lls</code>（两个都行，功能差不多）</li>
<li>点击「安装」，等待安装完成
<strong>注意</strong>：插件安装需要 Node.js 环境。如果安装失败，可能是因为：</li>
</ol>
<ul>
<li>网络问题（插件从 GitHub 下载，国内可能慢）</li>
<li>没有 Node.js 环境（去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2F" target="_blank" title="https://nodejs.org/" ref="nofollow noopener noreferrer">Node.js 官网</a> 下载安装）</li>
<li>权限问题（Windows 用户可能需要管理员权限）
如果实在装不上，可以试试离线安装，或者换个网络环境（比如开个梯子）。</li>
</ul>
<h3 data-id="heading-11">第二步：配置 S3 图床参数</h3>
<p>插件安装好后，点击左侧的「图床设置」，找到「Amazon S3」（或者叫「AWS S3」），点击进去配置。
接下来这部分很关键，每个参数都要填对，我一个个讲清楚。
<strong>应用密钥 ID（Access Key ID）</strong>
填入之前在 R2 创建 API 令牌时保存的「访问密钥 ID」。
<strong>应用密钥（Secret Access Key）</strong>
填入「访问密钥」。
注意这两个密钥别填反了，ID 是一串比较短的字符，密钥是一串更长的字符。
<strong>桶（Bucket Name）</strong>
填入你在 R2 创建的存储桶名称，比如 <code>blog-images</code>。
注意是桶的名称，不是 ARN，也不是 URL，就是你创建时起的那个名字。
<strong>文件路径（Upload Path）</strong>
这个决定上传的图片在存储桶里怎么组织。推荐几种格式：</p>
<ul>
<li><code>{year}/{month}/{md5}.{extName}</code> - 按年月分类，文件名用 MD5 避免重复</li>
<li><code>PicGo/{fullName}</code> - 全部放在 PicGo 文件夹下，保持原文件名</li>
<li><code>{year}/{month}/{fullName}</code> - 按年月分类，保持原文件名
我个人用的是第一种，既避免了文件名重复，又方便按时间管理。
<strong>重要提醒</strong>：路径开头<strong>不要加 <code>/</code></strong>！直接写 <code>{year}/{month}/...</code> 就行。如果加了 <code>/</code>，可能会导致上传失败或路径错误。
<strong>自定义节点（Endpoint）</strong>
填入之前保存的「S3 API 端点」，就是那个 <code>https://xxxxx.r2.cloudflarestorage.com</code> 格式的网址。
注意要带 <code>https://</code>，不要漏掉。
<strong>自定义域名（Custom Domain）</strong>
这里填你配置的公开访问域名。根据之前选择的方式：</li>
<li>如果用自定义域名：填 <code>https://img.yourdomain.com</code></li>
<li>如果用 r2.dev：填你的 Public Bucket URL（在 R2 存储桶设置里能看到，类似 <code>https://pub-xxxxx.r2.dev</code>）
这个域名决定了最终生成的图片链接，所以一定要填对。
<strong>其他参数</strong></li>
<li><strong>区域（Region）</strong>：随便填，比如 <code>auto</code> 或 <code>us-east-1</code>，R2 不看这个参数</li>
<li><strong>上传方式</strong>：选择「路径式」（Path Style）</li>
</ul>
<h3 data-id="heading-12">第三步：测试上传</h3>
<p>配置完成后，别急着用。先测试一下是否正常。</p>
<ol>
<li>点击「确定」保存配置</li>
<li>勾选「设为默认图床」（这样以后上传会自动用 R2）</li>
<li>点击左侧的「上传区」</li>
<li>拖入一张测试图片，或者点击「选择图片」上传
如果配置正确，几秒钟后会看到上传成功的提示，并自动复制图片链接到剪贴板。
<strong>检查链接</strong>：把链接粘贴到浏览器打开，看看图片能否正常显示。如果能看到图片，恭喜你，配置成功了！
<strong>常见错误及解决方法</strong>
如果上传失败，检查以下几点：</li>
<li><strong>Access Denied 或 403 错误</strong>
<ul>
<li>检查 API 密钥是否填对（别填反了）</li>
<li>检查 API 令牌权限是否包含「对象读和写」</li>
<li>检查存储桶名称是否正确</li>
</ul>
</li>
<li><strong>图片上传成功但无法访问</strong>
<ul>
<li>检查是否开启了公开访问（r2.dev 或自定义域名）</li>
<li>检查自定义域名是否填对（要带 <code>https://</code>）</li>
<li>等待几分钟，DNS 可能还没生效</li>
</ul>
</li>
<li><strong>上传速度很慢或超时</strong>
<ul>
<li>网络问题，R2 在国外，上传可能稍慢</li>
<li>图片太大，可以先压缩一下（PicList 自带压缩功能）</li>
</ul>
</li>
<li><strong>文件路径错误或出现奇怪目录</strong>
<ul>
<li>检查文件路径开头是否加了 <code>/</code>，去掉它</li>
<li>检查路径格式是否正确
我第一次配置的时候就是把密钥 ID 和密钥填反了，折腾了半天才发现。如果遇到问题，先仔细检查每个参数，大多数问题都是配置填错了。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-13">优化与进阶技巧</h2>
<p>到这里，基本的图床功能已经可以用了。但如果想让图床更稳定、更快速、更省心，还有几个优化技巧值得了解。</p>
<h3 data-id="heading-14">设置缓存策略（强烈推荐）</h3>
<p>如果你用的是自定义域名，一定要设置缓存规则。这样做有三个好处：</p>
<ul>
<li>减少对 R2 的请求次数，避免超出免费额度</li>
<li>加快图片加载速度（从 CDN 缓存直接返回）</li>
<li>防止被人恶意刷流量
<strong>怎么设置</strong>：</li>
</ul>
<ol>
<li>进入 Cloudflare 控制台，选择你的域名</li>
<li>点击左侧「规则」→「页面规则」或「缓存规则」</li>
<li>创建新规则，匹配 URL：<code>img.yourdomain.com/*</code>（替换成你的域名）</li>
<li>设置：
<ul>
<li>缓存级别：缓存所有内容</li>
<li>边缘缓存 TTL：1 个月到 1 年（推荐 6 个月）</li>
<li>浏览器缓存 TTL：1 个月
设置好后，图片第一次访问会从 R2 读取，之后都会从 Cloudflare 的 CDN 缓存返回，基本不会再消耗 R2 的读取次数。
我自己设置的是 6 个月缓存，用了这么久，实际产生的 R2 请求次数只有几千次，完全在免费额度内。</li>
</ul>
</li>
</ol>
<p/>
<h3 data-id="heading-15">国内访问加速（可选）</h3>
<p>Cloudflare 的 CDN 在国内速度有点看运气。有些地区还行，有些地区可能比较慢。如果你的博客主要面向国内用户，可以考虑这几种加速方案：
<strong>方案一：腾讯云 EdgeOne</strong>
腾讯云推出的海外版 CDN，免费、免备案，可以用来加速 R2。</p>
<ul>
<li>优点：国内访问速度快，免费额度够用</li>
<li>缺点：需要另外注册腾讯云账号，配置稍微复杂点
<strong>方案二：WebP Cloud</strong>
一个专门做图片代理和优化的服务，可以自动把图片转成 WebP 格式并缓存。</li>
<li>优点：自动压缩图片，节省流量</li>
<li>缺点：有请求次数限制，超出需要付费
<strong>方案三：国内外分流</strong>
用 rclone 工具把 R2 的图片同步到国内云（比如腾讯云 COS），国内用户访问国内图床，国外用户访问 R2。</li>
<li>优点：国内外都很快</li>
<li>缺点：需要一定的技术能力，维护成本高
说实话，我自己用的是最简单的方法：自定义域名 + 缓存规则。虽然不是最快，但国内加载速度也能接受（1-3秒），对个人博客来说够用了。如果你对速度要求特别高，再考虑加速方案。</li>
</ul>
<h3 data-id="heading-16">安全与防护</h3>
<p>图床搭好后，还要注意防止被人滥用。
<strong>禁用 r2.dev 访问</strong>
如果你已经配置了自定义域名，记得关闭 r2.dev 的公开访问。不然别人可以通过 r2.dev 域名绕过你设置的防盗链等规则。
操作方法：进入存储桶设置 → R2.dev 子域 → 禁止访问（Disallow Access），输入 <code>disallow</code> 确认。
<strong>防盗链设置</strong>
用 Cloudflare 的 WAF（Web Application Firewall）可以限制只有你的网站能引用图片。
简单设置：</p>
<ol>
<li>Cloudflare 控制台 → 安全 → WAF</li>
<li>创建自定义规则</li>
<li>条件：Referer 不包含 <code>yourblog.com</code></li>
<li>动作：阻止或质询
这样别人就无法在自己网站上盗用你的图片链接了。
<strong>监控使用量</strong>
定期查看 R2 的使用情况，防止超额。
在 R2 控制台可以看到：</li>
</ol>
<ul>
<li>存储空间使用量</li>
<li>每月请求次数（A 类、B 类）
如果发现用量异常增长，及时检查是不是被人刷流量了。</li>
</ul>
<h2 data-id="heading-17">结论</h2>
<p>好了，到这里整个 R2 图床的搭建就完成了。
回顾一下我们做了什么：</p>
<ol>
<li>注册并开通 Cloudflare R2，获得 10GB 免费存储空间</li>
<li>创建存储桶，配置公开访问（自定义域名或 r2.dev）</li>
<li>生成 API 令牌，用于 PicGo 连接</li>
<li>安装配置 PicGo，实现一键上传图片</li>
<li>设置缓存和安全策略，让图床更稳定
从此以后，你再也不用担心图床删图、跑路或收费了。每次写博客，只要把图片拖进 PicGo，自动上传并生成链接，复制到 Markdown 里就行，整个流程行云流水。
说实话，搭建 R2 图床是我这两年做的最正确的决定之一。虽然第一次配置花了点时间（主要是踩坑），但用上之后真的很省心。现在已经稳定运行半年多，存储了 500 多张图片，一分钱没花，也没遇到任何故障。
如果你也在为图床问题头疼，真的建议试试 R2。按这篇文章的步骤来，30 分钟就能搞定。遇到问题也别慌，大多数都是配置参数填错了，仔细检查一遍就好。
最后提醒一点：配置好之后记得把 API 密钥保存好，万一哪天要重新配置或者换电脑，直接用之前的密钥就行，不用重新生成。
好了，赶紧去搭建你自己的免费图床吧！有问题欢迎评论区交流，我看到会回复的。</li>
</ol>
<blockquote>
<p>原文首发<a href="https://link.juejin.cn?target=https%3A%2F%2Feastondev.com%2Fblog%2Fzh%2Fposts%2Fdev%2F20251130-r2-picgo-setup%2F" target="_blank" title="https://eastondev.com/blog/zh/posts/dev/20251130-r2-picgo-setup/" ref="nofollow noopener noreferrer">自个人博客</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[http面试题详解]]></title>    <link>https://juejin.cn/post/7599873006258323490</link>    <guid>https://juejin.cn/post/7599873006258323490</guid>    <pubDate>2026-01-27T15:23:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599873006258323490" data-draft-id="7599911091086573568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="http面试题详解"/> <meta itemprop="keywords" content="HTTP"/> <meta itemprop="datePublished" content="2026-01-27T15:23:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            http面试题详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:23:10.000Z" title="Tue Jan 27 2026 15:23:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>HTTP（HyperText Transfer Protocol，超文本传输协议）是构建 Web 的基石，也是面试中<strong>最高频、最基础但也最容易深入</strong>的知识点。从浏览器输入 URL 到页面展示，从 RESTful API 设计到微服务通信，HTTP 贯穿整个 Web 开发生命周期。</p>
<p>以下是对 HTTP 的全面技术解析，涵盖基础概念、协议演进、核心机制及高频面试题详解：</p>
<hr/>
<h2 data-id="heading-0">一、HTTP 到底是什么？</h2>
<h3 data-id="heading-1">1.1 协议定位</h3>
<p>HTTP 是<strong>应用层协议</strong>（OSI 第 7 层），基于 <strong>TCP/IP</strong>（HTTP/1.1、HTTP/2）或 <strong>QUIC/UDP</strong>（HTTP/3）传输，采用<strong>客户端-服务器（C/S）架构</strong>和<strong>请求-响应（Request-Response）模型</strong>。</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────┐
│              应用层 (HTTP)               │  ← 定义数据格式和交互语义
├─────────────────────────────────────────┤
│              传输层 (TCP/UDP)            │  ← 定义端到端连接（端口）
├─────────────────────────────────────────┤
│              网络层 (IP)                 │  ← 定义寻址和路由（IP地址）
└─────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-2">1.2 设计特点</h3>
<ul>
<li><strong>无状态（Stateless）</strong>：服务器不保存客户端上下文，每次请求独立（需 Cookie/Session 解决）</li>
<li><strong>无连接（Non-persistent）</strong>：HTTP/1.0 默认短连接，HTTP/1.1 起默认长连接（Keep-Alive）</li>
<li><strong>灵活可扩展</strong>：Header 机制允许任意扩展，支持多种数据类型（MIME）</li>
<li><strong>简单快速</strong>：报文文本化，易于调试和Mock</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、HTTP 进化史（面试常考时间线）</h2>









































<table><thead><tr><th>版本</th><th>发布时间</th><th>核心特性</th><th>痛点</th></tr></thead><tbody><tr><td><strong>HTTP/0.9</strong></td><td>1991</td><td>只有 GET，纯文本传输</td><td>无状态码、无 Header</td></tr><tr><td><strong>HTTP/1.0</strong></td><td>1996</td><td>引入 POST/HEAD、状态码、Header、短连接</td><td>每次请求新建 TCP 连接（三次握手开销）</td></tr><tr><td><strong>HTTP/1.1</strong></td><td>1997</td><td><strong>持久连接（Keep-Alive）</strong>、管线化（Pipelining）、Host 头、缓存控制</td><td><strong>队头阻塞（Head-of-Line Blocking）</strong></td></tr><tr><td><strong>HTTP/2</strong></td><td>2015</td><td><strong>二进制分帧</strong>、多路复用（Multiplexing）、头部压缩（HPACK）、服务器推送</td><td>TCP 层队头阻塞</td></tr><tr><td><strong>HTTP/3</strong></td><td>2022</td><td><strong>基于 QUIC（UDP）</strong>、0-RTT 握手、连接迁移、彻底解决队头阻塞</td><td>中间设备兼容性问题</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">三、HTTP 报文解构（必须手写水平）</h2>
<h3 data-id="heading-5">3.1 请求报文结构</h3>
<pre><code class="hljs language-bash" lang="bash">POST /api/user HTTP/1.1          ← 请求行（方法 + URL + 版本）
Host: api.example.com            ← 请求头（Header）
Content-Type: application/json   ← 请求头
Content-Length: 39               ← 请求头
                                 ← 空行（CRLF）
{<span class="hljs-string">"name"</span>:<span class="hljs-string">"张三"</span>,<span class="hljs-string">"age"</span>:25}         ← 实体主体（Body，可选）
</code></pre>
<p><strong>请求行解析：</strong></p>
<ul>
<li><strong>方法（Method）</strong>：GET、POST、PUT、DELETE、PATCH、HEAD、OPTIONS、TRACE、CONNECT</li>
<li><strong>URL</strong>：协议名://主机名:端口/路径?查询参数#片段标识符</li>
<li><strong>版本</strong>：HTTP/1.1 或 HTTP/2</li>
</ul>
<h3 data-id="heading-6">3.2 响应报文结构</h3>
<pre><code class="hljs language-css" lang="css">HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK                  ← 状态行（版本 + 状态码 + 原因短语）
Date: Mon, <span class="hljs-number">27</span> Jan <span class="hljs-number">2026</span> <span class="hljs-number">08</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT
Content-Type: application/json; charset=utf-<span class="hljs-number">8</span>
<span class="hljs-attribute">Content</span>-Encoding: gzip
                                 ← 空行
{"id":<span class="hljs-number">1</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"张三"</span>}           ← 响应体
</code></pre>
<hr/>
<h2 data-id="heading-7">四、HTTP 方法（Method）深度对比</h2>
<h3 data-id="heading-8">4.1 安全（Safe）与幂等（Idempotent）</h3>
<ul>
<li><strong>安全方法</strong>：不修改服务器状态（GET、HEAD、OPTIONS）</li>
<li><strong>幂等方法</strong>：多次执行结果相同（GET、PUT、DELETE），POST 和 PATCH <strong>不幂等</strong></li>
</ul>
<h3 data-id="heading-9">4.2 GET vs POST（面试必问）</h3>


















































<table><thead><tr><th>特性</th><th>GET</th><th>POST</th></tr></thead><tbody><tr><td><strong>语义</strong></td><td>获取资源</td><td>创建/提交资源</td></tr><tr><td><strong>幂等性</strong></td><td>幂等</td><td>非幂等（多次提交创建多条记录）</td></tr><tr><td><strong>缓存</strong></td><td>可被缓存</td><td>默认不缓存</td></tr><tr><td><strong>书签</strong></td><td>可收藏</td><td>不可收藏</td></tr><tr><td><strong>长度限制</strong></td><td>URL 长度受限（浏览器通常 2KB-8KB）</td><td>无限制（受服务器配置限制）</td></tr><tr><td><strong>数据位置</strong></td><td>URL 参数（<code>?key=value</code>）</td><td>Body 中</td></tr><tr><td><strong>编码</strong></td><td>只能 ASCII</td><td>任意编码（通常 UTF-8）</td></tr><tr><td><strong>安全性</strong></td><td>参数暴露（勿传密码）</td><td>相对安全（但 HTTP 下仍明文）</td></tr></tbody></table>
<p><strong>重要误区：</strong></p>
<ol>
<li><strong>POST 比 GET 安全？</strong> → 错误的。HTTP 明文传输，两者都不安全，必须上 HTTPS。</li>
<li><strong>GET 不能带 Body？</strong> → 协议允许，但多数服务器/框架会忽略或拒绝（如 Nginx、Django）。</li>
<li><strong>RESTful 必须用 GET/POST/PUT/DELETE？</strong> → 实际中很多公司统一用 POST + Body 标识动作（规避公司防火墙对 PUT/DELETE 的拦截）。</li>
</ol>
<hr/>
<h2 data-id="heading-10">五、HTTP 状态码（Status Code）详解</h2>
<h3 data-id="heading-11">5.1 分类记忆法</h3>
<ul>
<li><strong>1xx</strong>：Informational（信息性），如 100 Continue</li>
<li><strong>2xx</strong>：Success（成功），200 OK，201 Created，204 No Content</li>
<li><strong>3xx</strong>：Redirection（重定向），301 Moved Permanently，302 Found，304 Not Modified</li>
<li><strong>4xx</strong>：Client Error（客户端错误），400 Bad Request，401 Unauthorized，403 Forbidden，404 Not Found，405 Method Not Allowed，409 Conflict</li>
<li><strong>5xx</strong>：Server Error（服务器错误），500 Internal Server Error，502 Bad Gateway，503 Service Unavailable，504 Gateway Timeout</li>
</ul>
<h3 data-id="heading-12">5.2 高频状态码场景题</h3>
<p><strong>301 vs 302 vs 307</strong></p>
<ul>
<li><strong>301（永久重定向）</strong>：搜索引擎会更新 URL 索引，书签会自动更新。用于 HTTPS 强制跳转、域名更换。</li>
<li><strong>302（临时重定向）</strong>：搜索引擎保留原 URL，用于未登录跳转登录页（但现代浏览器 302 也会把 POST 改为 GET）。</li>
<li><strong>307（临时重定向，严格遵循）</strong>：要求重定向后的请求方法<strong>必须与原请求一致</strong>（如 POST 重定向后仍是 POST），解决 302 的历史遗留问题。</li>
</ul>
<p><strong>401 vs 403</strong></p>
<ul>
<li><strong>401 Unauthorized</strong>：<strong>未认证</strong>（没登录），需携带 <code>WWW-Authenticate</code> 头。</li>
<li><strong>403 Forbidden</strong>：<strong>已认证但无权限</strong>（登录了但不是管理员），或服务器直接拒绝服务（IP 黑名单）。</li>
</ul>
<p><strong>502 vs 504</strong></p>
<ul>
<li><strong>502 Bad Gateway</strong>：网关/代理（如 Nginx）从上游服务器（如 Django/gunicorn）收到<strong>无效响应</strong>（如连接被重置、PHP 语法错误）。</li>
<li><strong>504 Gateway Timeout</strong>：网关<strong>超时未收到</strong>上游响应（上游处理太慢，超过 proxy_read_timeout）。</li>
</ul>
<hr/>
<h2 data-id="heading-13">六、HTTP 连接管理演进</h2>
<h3 data-id="heading-14">6.1 短连接（HTTP/1.0）</h3>
<pre><code class="hljs language-http" lang="http">Connection: close
</code></pre>
<p>每次 HTTP 请求都要经历 <strong>TCP 三次握手 -&gt; 传输 -&gt; 四次挥手</strong>，开销巨大。</p>
<h3 data-id="heading-15">6.2 长连接 / 持久连接（HTTP/1.1 Keep-Alive）</h3>
<pre><code class="hljs language-http" lang="http">Connection: keep-alive
Keep-Alive: timeout=5, max=1000
</code></pre>
<p><strong>优势：</strong> TCP 连接复用，避免重复握手。
<strong>缺陷：</strong> <strong>队头阻塞（Head-of-Line Blocking）</strong>——同一条连接上的请求必须串行响应，前一个响应慢，后面的请求即使处理好了也必须等着。</p>
<h3 data-id="heading-16">6.3 HTTP/2 多路复用（Multiplexing）</h3>
<p>将请求/响应分割为二进制<strong>帧（Frame）</strong>，不同 Stream ID 的帧可以<strong>交错发送</strong>，彻底解决 HTTP 层的队头阻塞。</p>
<pre><code class="hljs language-http" lang="http">:method GET
:scheme https
:authority api.example.com
:path /data          ← Stream ID: 1

:method POST
:scheme https
:authority api.example.com
:path /upload        ← Stream ID: 3（与 Stream 1 并发传输）
</code></pre>
<p><strong>注意：</strong> HTTP/2 只是解决了 HTTP 层的队头阻塞，<strong>TCP 层的队头阻塞</strong>依然存在（一个 TCP 包丢失，所有流都要等待重传）。这就是 HTTP/3 改用 QUIC/UDP 的根本原因。</p>
<hr/>
<h2 data-id="heading-17">七、HTTP 缓存机制（高频考点）</h2>
<p>缓存是 HTTP 性能优化的核心，分为<strong>强缓存</strong>和<strong>协商缓存</strong>。</p>
<h3 data-id="heading-18">7.1 强缓存（不会发请求到服务器）</h3>
<p>由 <code>Expires</code>（HTTP/1.0）或 <code>Cache-Control</code>（HTTP/1.1，优先级更高）控制：</p>
<pre><code class="hljs language-http" lang="http">HTTP/1.1 200 OK
Cache-Control: max-age=3600  # 缓存 1 小时（相对时间，单位秒）
Expires: Wed, 21 Oct 2026 07:28:00 GMT  # 绝对时间（受客户端时钟影响）

# 其他指令
Cache-Control: no-store       # 禁止缓存（敏感数据）
Cache-Control: no-cache       # 可以缓存，但必须重新验证（走协商缓存）
Cache-Control: private        # 仅客户端缓存（CDN 不缓存）
Cache-Control: public         # 代理服务器也可缓存
</code></pre>
<p>浏览器行为：首次请求后，在 <code>max-age</code> 时间内再次访问，直接从本地磁盘/内存读取，状态码显示 <code>200 (from disk cache)</code> 或 <code>200 (from memory cache)</code>。</p>
<h3 data-id="heading-19">7.2 协商缓存（发请求询问服务器是否可用）</h3>
<p>当强缓存过期后，浏览器携带缓存标识询问服务器：</p>
<pre><code class="hljs language-http" lang="http"># 浏览器发送
GET /data HTTP/1.1
If-None-Match: "33a64df5"          # 上次响应的 ETag
If-Modified-Since: Wed, 21 Oct 2026 07:28:00 GMT  # 上次响应的 Last-Modified

# 服务器响应（内容未变）
HTTP/1.1 304 Not Modified          # 无 Body，节省带宽
ETag: "33a64df5"                   # 更新 ETag（可能不变）
Last-Modified: Wed, 21 Oct 2026 07:28:00 GMT
</code></pre>
<p><strong>ETag vs Last-Modified：</strong></p>
<ul>
<li><strong>Last-Modified</strong>：秒级精度，可能误判（1 秒内修改多次），且无法识别内容实质未变（仅 touch 文件）。</li>
<li><strong>ETag</strong>：实体标签，通常是文件内容的哈希值（如 MD5），优先级高于 Last-Modified，精确但计算有开销。</li>
</ul>
<p><strong>面试陷阱：</strong> <code>304 Not Modified</code> 是客户端缓存生效，<strong>不是不请求</strong>，而是请求后服务器告诉客户端"用你本地的"。</p>
<hr/>
<h2 data-id="heading-20">八、Cookie 与 Session（状态管理）</h2>
<p>HTTP 无状态，通过 Cookie/Session 维持登录态。</p>
<h3 data-id="heading-21">8.1 Set-Cookie 属性</h3>
<pre><code class="hljs language-http" lang="http">Set-Cookie: sessionid=abc123; Expires=Wed, 09 Jun 2027 10:18:14 GMT; 
            Max-Age=3600; Domain=.example.com; Path=/; Secure; HttpOnly; SameSite=Lax
</code></pre>
<ul>
<li><strong>Expires/Max-Age</strong>：过期时间（Max-Age 优先级更高，单位为秒）</li>
<li><strong>Domain</strong>：<code>.example.com</code> 表示所有子域（<code>www.example.com</code>、<code>api.example.com</code>）共享</li>
<li><strong>Path</strong>：<code>/admin</code> 仅 admin 路径下携带</li>
<li><strong>Secure</strong>：仅 HTTPS 传输（防中间人）</li>
<li><strong>HttpOnly</strong>：禁止 JavaScript 访问（<code>document.cookie</code> 读不到，防 XSS）</li>
<li><strong>SameSite</strong>：防止 CSRF
<ul>
<li><code>Strict</code>：仅同站请求携带（外部链接跳转会丢失登录态）</li>
<li><code>Lax</code>：允许顶级导航 GET 请求携带（如点击链接跳转）</li>
<li><code>None</code>：允许第三方请求携带（必须同时设置 <code>Secure</code>）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-22">8.2 Session  vs JWT</h3>























<table><thead><tr><th>方案</th><th>存储位置</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>Session</strong></td><td>服务器内存/Redis</td><td>可控（可随时强制下线）、安全性高</td><td>服务器有状态、分布式需共享 Session</td></tr><tr><td><strong>JWT</strong></td><td>客户端（LocalStorage/Cookie）</td><td>无状态、易水平扩展</td><td>Token 无法提前吊销（需等过期）、体积较大</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">九、HTTPS 与 HTTP 本质区别（面试重点）</h2>
<h3 data-id="heading-24">9.1 不仅仅是 "HTTP + SSL/TLS"</h3>
<p>HTTPS = HTTP + <strong>TLS/SSL</strong>（传输层安全协议），默认端口 443。</p>
<p><strong>TLS 握手（简版）：</strong></p>
<ol>
<li>客户端发送支持的加密算法列表 + 随机数</li>
<li>服务器返回证书（含公钥）+ 选中的算法 + 随机数</li>
<li>客户端验证证书 -&gt; 生成 Pre-master 随机数，用公钥加密发送</li>
<li>双方用三个随机数生成<strong>对称密钥</strong>（Session Key），后续通信全用此密钥加密</li>
</ol>
<p><strong>为什么用对称加密通信？</strong> 非对称加密（RSA）计算量太大，仅用于握手阶段的密钥交换。</p>
<h3 data-id="heading-25">9.2 中间人攻击与证书链</h3>
<ul>
<li><strong>CA（Certificate Authority）</strong>：浏览器内置根证书，用于验证服务器证书真实性。</li>
<li><strong>中间人攻击</strong>：如果没有证书验证，黑客可伪造公钥截获通信（如公共 WiFi 钓鱼）。</li>
<li><strong>自签名证书</strong>：测试环境可用，生产环境浏览器会警告（NET::ERR_CERT_AUTHORITY_INVALID）。</li>
</ul>
<hr/>
<h2 data-id="heading-26">十、CORS 跨域（Cross-Origin Resource Sharing）</h2>
<p>浏览器<strong>同源策略</strong>（Same-Origin Policy）限制：协议、主机、端口三者必须完全一致。</p>
<h3 data-id="heading-27">10.1 简单请求 vs 预检请求（Preflight）</h3>
<p><strong>简单请求</strong>：满足以下全部条件：</p>
<ul>
<li>方法：GET、HEAD、POST</li>
<li>Header：仅 <code>Accept</code>、<code>Accept-Language</code>、<code>Content-Language</code>、<code>Content-Type</code>（且值仅为 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code>）</li>
<li>无自定义 Header</li>
</ul>
<p><strong>非简单请求</strong>（如 Content-Type: application/json，或方法为 PUT/DELETE）：
浏览器自动发送 <strong>OPTIONS 预检请求</strong>：</p>
<pre><code class="hljs language-http" lang="http">OPTIONS /api/data HTTP/1.1
Host: api.example.com
Origin: https://www.example.com
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: X-Custom-Header

# 服务器响应
Access-Control-Allow-Origin: https://www.example.com
Access-Control-Allow-Methods: GET, POST, PUT
Access-Control-Allow-Headers: X-Custom-Header
Access-Control-Max-Age: 86400  # 预检结果缓存 1 天
</code></pre>
<h3 data-id="heading-28">10.2 携带 Cookie 的跨域</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>, {
  <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>  <span class="hljs-comment">// 或 axios withCredentials: true</span>
});
</code></pre>
<p>服务器必须返回：</p>
<pre><code class="hljs language-http" lang="http">Access-Control-Allow-Origin: https://www.example.com  # 不能为 *
Access-Control-Allow-Credentials: true
</code></pre>
<hr/>
<h2 data-id="heading-29">十一、高频面试题详解（含参考答案）</h2>
<h3 data-id="heading-30">Q1：在浏览器地址栏输入 URL 后回车，发生了什么？（经典）</h3>
<p><strong>参考答案（分层阐述）：</strong></p>
<ol>
<li><strong>URL 解析</strong>：检查格式合法性，如果是域名进入 DNS 查询。</li>
<li><strong>DNS 解析</strong>：浏览器缓存 -&gt; OS 缓存 -&gt; 本地 DNS 服务器 -&gt; 根域 -&gt; 顶级域 -&gt; 权威域，获取 IP 地址。</li>
<li><strong>建立连接</strong>：
<ul>
<li>HTTP/1.1：TCP 三次握手（SYN -&gt; SYN+ACK -&gt; ACK）</li>
<li>HTTPS：额外 TLS 握手（证书验证 + 密钥交换）</li>
<li>HTTP/3：QUIC 握手（0-RTT 或 1-RTT）</li>
</ul>
</li>
<li><strong>发送 HTTP 请求</strong>：构造请求行和 Header，如果是 POST 还要序列化 Body。</li>
<li><strong>服务器处理</strong>：Nginx 反向代理 -&gt; 应用服务器（Django/Node.js）-&gt; 数据库查询 -&gt; 业务逻辑 -&gt; 组装响应。</li>
<li><strong>浏览器渲染</strong>：解析 HTML -&gt; 构建 DOM 树 -&gt; 解析 CSS -&gt; 构建 CSSOM -&gt; 合并 Render Tree -&gt; Layout -&gt; Painting -&gt; Composite。</li>
<li><strong>连接关闭或复用</strong>：HTTP/1.1 Keep-Alive 复用连接，或 HTTP/2 多路复用。</li>
</ol>
<h3 data-id="heading-31">Q2：GET 和 POST 的区别？（避免八股文答案）</h3>
<p>除了表格对比，需强调：</p>
<ul>
<li><strong>语义差异</strong>：GET 是安全幂等的"获取"，POST 是"提交处理"。</li>
<li><strong>TCP 层面</strong>：GET 和 POST 都是 TCP 连接，没有本质区别。但部分浏览器/服务器对 GET URL 长度有限制（因为 URL 通常存在接收缓冲区首部）。</li>
<li><strong>RESTful 实践</strong>：POST 用于创建（201 Created），GET 用于查询（200 OK），幂等性保证重试安全。</li>
</ul>
<h3 data-id="heading-32">Q3：HTTP/1.1 的 Keep-Alive 和 HTTP/2 的多路复用有什么区别？</h3>
<ul>
<li><strong>Keep-Alive</strong>：<strong>串行</strong>，一个时刻只能处理一个请求/响应对，必须等前一个完全回传才能发下一个（队头阻塞）。</li>
<li><strong>Multiplexing</strong>：<strong>并行</strong>，多个请求分割成帧，在一个 TCP 连接上乱序发送，服务器按 Stream ID 组装，互相不阻塞。</li>
</ul>
<h3 data-id="heading-33">Q4：什么是队头阻塞（Head-of-Line Blocking）？如何解决？</h3>
<ul>
<li><strong>HTTP/1.1 层</strong>：一个连接上请求串行，前面的响应慢阻塞后面的。<strong>解决方案</strong>：开多个 TCP 连接（浏览器通常限制 6-8 个同域并发）。</li>
<li><strong>TCP 层（HTTP/2）</strong>：即使 HTTP 层多路复用，TCP 依然是可靠有序流。如果一个 TCP 包丢失，后续所有 HTTP 流的帧都必须等它重传。<strong>解决方案</strong>：HTTP/3 基于 QUIC（UDP），UDP 无连接状态，丢包只影响单个 Stream。</li>
</ul>
<h3 data-id="heading-34">Q5：HTTP 是无状态的，为什么需要无状态？如何保持状态？</h3>
<ul>
<li><strong>无状态优点</strong>：服务器设计简单，容易横向扩展（任何服务器实例都能处理请求，无需共享上下文）。</li>
<li><strong>状态保持</strong>：通过 Cookie（客户端存 Session ID）或 Token（JWT）让客户端每次请求携带身份信息，服务器通过 ID 查数据库/Redis 获取状态。</li>
</ul>
<h3 data-id="heading-35">Q6：HTTP 和 RPC（如 gRPC）有什么区别？</h3>



































<table><thead><tr><th>维度</th><th>HTTP/REST</th><th>RPC（gRPC）</th></tr></thead><tbody><tr><td><strong>协议层</strong></td><td>应用层（文本协议）</td><td>通常基于 HTTP/2，但语义封装</td></tr><tr><td><strong>序列化</strong></td><td>JSON/XML（文本，可读）</td><td>Protobuf（二进制，高效）</td></tr><tr><td><strong>约束</strong></td><td>统一接口（GET/POST/URL）</td><td>自由（直接调用远程函数）</td></tr><tr><td><strong>性能</strong></td><td>较低（文本解析 + Header 冗余）</td><td>高（二进制 + 长连接复用）</td></tr><tr><td><strong>调试</strong></td><td>简单（curl 即可）</td><td>需专用工具</td></tr></tbody></table>
<p><strong>选择</strong>：对外暴露用 HTTP/REST（通用性），内部微服务通信用 gRPC（性能）。</p>
<h3 data-id="heading-36">Q7：什么是 304？它和 200 (from cache) 有什么区别？</h3>
<ul>
<li><strong>304 Not Modified</strong>：客户端发现本地缓存过期（超过 max-age），携带 ETag/Last-Modified 询问服务器，服务器返回 304（无 Body，省流量），浏览器用本地缓存展示。</li>
<li><strong>200 (from cache)</strong>：强缓存生效，<strong>没有发请求到服务器</strong>，直接从本地磁盘/内存读取。</li>
</ul>
<h3 data-id="heading-37">Q8：HTTPS 一定安全吗？什么情况下仍不安全？</h3>
<ul>
<li><strong>证书劫持</strong>：如果设备被植入根证书（如某些企业防火墙、恶意软件），可以伪造证书进行中间人攻击。</li>
<li><strong>混合内容（Mixed Content）</strong>：HTTPS 页面中加载 HTTP 资源（图片、JS），这些资源可能被篡改。</li>
<li><strong>XSS/CSRF</strong>：HTTPS 只保证传输加密，不防注入攻击。</li>
<li><strong>本地泄露</strong>：HTTPS 无法防止浏览器插件、恶意软件窃取内存中的 Cookie/Token。</li>
</ul>
<hr/>
<h2 data-id="heading-38">十二、总结与学习建议</h2>
<p>HTTP 看似简单，实则涉及<strong>网络协议、性能优化、安全防护</strong>等多个维度。面试准备时：</p>
<ol>
<li><strong>抓包实践</strong>：用 Chrome DevTools Network 面板观察真实站点的 Header、缓存策略、HTTP/2 帧。</li>
<li><strong>搭建环境</strong>：本地用 Nginx 配置 HTTPS、Gzip、缓存头，观察不同配置下的请求行为。</li>
<li><strong>深入 RFC</strong>：阅读 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc7230" target="_blank" title="https://tools.ietf.org/html/rfc7230" ref="nofollow noopener noreferrer">RFC 7230-7235</a>（HTTP/1.1 语义和内容）和 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc7540" target="_blank" title="https://tools.ietf.org/html/rfc7540" ref="nofollow noopener noreferrer">RFC 7540</a>（HTTP/2）。</li>
<li><strong>区分概念</strong>：明确区分 <strong>TCP 连接、HTTP 请求、HTTP 响应、TLS 握手</strong> 的生命周期。</li>
</ol>
<p>掌握 HTTP 不仅是应对面试，更是构建<strong>高性能、高可用、高安全</strong> Web 系统的基石。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Leantime：开源项目管理神器]]></title>    <link>https://juejin.cn/post/7599893063863615503</link>    <guid>https://juejin.cn/post/7599893063863615503</guid>    <pubDate>2026-01-27T15:32:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599893063863615503" data-draft-id="7599893063863599119" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Leantime：开源项目管理神器"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-27T15:32:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Leantime：开源项目管理神器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:32:36.000Z" title="Tue Jan 27 2026 15:32:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>文章简介：Leantime是一款专为非专业项目经理设计的开源项目管理工具，在Jira的臃肿和Trello的简化之间找到了完美平衡。它集成了战略规划、敏捷看板、甘特图、知识管理、工时跟踪等全面功能，支持Docker一键部署。无论是创业团队还是企业部门，Leantime都能以极低的学习成本，让每位成员轻松参与项目协作。告别过度复杂的工具，用这款轻量而强大的神器，为你的2026年项目计划保驾护航。</p>
</blockquote>
<p>岁末已至，农历新年过后，2025年就将正式告别。回顾这一年，仿佛仍是一事无成；转眼迈入2026，我决心启动一个开源项目的计划。正所谓“工欲善其事，必先利其器”，为此我调研了一些轻量级的开源项目管理工具，最终在GitHub上发现了这个项目——实在忍不住想推荐给大家！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de4bbc3fe6e44485a80aadb019d28888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132759&amp;x-signature=lopmi8xhDuGLXkBkZgH%2FY4Zlw6E%3D" alt="" loading="lazy"/></p>
<p>你是否也曾受困于复杂的项目管理工具？是否觉得Jira虽然功能强大却过于沉重，Trello简洁易用却又稍显功能不足？今天，我想为大家推荐一款优秀的开源解决方案——Leantime。它在丰富功能与流畅体验之间取得了很好的平衡，尤其适合非专业项目经理使用。</p>
<h2 data-id="heading-0">❓什么是Leantime？</h2>
<p>Leantime是一个专为<strong>非专业项目经理</strong>设计的开源项目管理系统。它独特地结合了战略规划、项目管理和执行跟踪，让团队中的每个人都能轻松上手使用。</p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLeantime%2Fleantime" target="_blank" title="https://github.com/Leantime/leantime" ref="nofollow noopener noreferrer">github.com/Leantime/le…</a></p>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fleantime.io%2F" target="_blank" title="https://leantime.io/" ref="nofollow noopener noreferrer">leantime.io/</a></p>
<p>文档地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.leantime.io%2F" target="_blank" title="https://docs.leantime.io/" ref="nofollow noopener noreferrer"> https://docs.leantime.io/</a></p>
<p>该项目在github上已有9k ⭐️star</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bccda101d3de4fa1a7bb81e5245100b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132759&amp;x-signature=13Ga51WPvhVyGtX0D3s9TTuAQTE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">🔍核心功能一览</h2>
<h3 data-id="heading-2">🗂️任务管理</h3>
<ul>
<li>多种视图：看板、甘特图、表格、列表和日历视图</li>
<li>无限子任务和依赖关系管理</li>
<li>里程碑管理</li>
<li>敏捷冲刺管理</li>
<li>时间跟踪和工时表</li>
</ul>
<h3 data-id="heading-3">📋项目规划</h3>
<ul>
<li>项目仪表板和状态报告</li>
<li>目标和指标跟踪</li>
<li>精益画布和商业模式画布</li>
<li>SWOT分析画布</li>
<li>风险分析工具</li>
</ul>
<h3 data-id="heading-4">🧠信息知识管理</h3>
<ul>
<li>Wiki文档系统</li>
<li>创意看板</li>
<li>项目回顾工具</li>
<li>文件存储（支持S3或本地文件系统）</li>
<li>屏幕和网络摄像头录制功能</li>
<li>全面的评论讨论系统</li>
</ul>
<h3 data-id="heading-5">⚙️管理功能</h3>
<ul>
<li>简易安装部署</li>
<li>多用户角色和项目权限管理</li>
<li>双因素认证</li>
<li>LDAP和OIDC集成</li>
<li>可扩展的插件系统和API</li>
<li>Slack、Mattermost、Discord集成</li>
<li>支持20多种语言</li>
</ul>
<h2 data-id="heading-6">🚀安装部署</h2>
<p>此项目可从release 发布页面下载安装包到本地安装，我们此处使用的是docker部署</p>
<h3 data-id="heading-7">🐳Docker部署（推荐）</h3>
<ul>
<li>需要先创建mysql 数据库 leantime</li>
<li>创建docker-compose.yml文件，内容如下：</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">services:
  leantime:
    image: leantime/leantime:latest
    container_name: leantime
    restart: unless-stopped
    ports:
      - "2080:8080"
    environment:
      - <span class="hljs-attr">LEAN_DB_HOST</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">31.195</span>:<span class="hljs-number">3306</span>
      - <span class="hljs-attr">LEAN_DB_USER</span>=root
      - <span class="hljs-attr">LEAN_DB_PASSWORD</span>=xj123456
      - <span class="hljs-attr">LEAN_DB_DATABASE</span>=leantime
      - <span class="hljs-attr">LEAN_EMAIL_RETURN</span>=xiuji008@qq.com
</code></pre>
<ul>
<li>在docker-compose.yml 同级目录下使用以下命令启动项目</li>
</ul>

<pre><code class="hljs">docker-compose up -d
</code></pre>
<p>到此，基础部署就已经完成了</p>
<h2 data-id="heading-8">✨上手体验</h2>
<p>在浏览器中打开我们部署的地址来访问项目，首次需要先设置管理员</p>
<ul>
<li>设置管理员</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a467c40b7ba4b22bc7f9a6d73acc470~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132759&amp;x-signature=05uqH74FDNCedjfUZ5EqLzsuKiU%3D" alt="" loading="lazy"/></p>
<ul>
<li>设置密码、主题等等</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38cdcb4c00fd47d49ee8ca8874d99c4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132759&amp;x-signature=NNQsi5SYX2dU1zh67W%2FKEnIBlxQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>主页</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a275e824307d4b3eac15cdf4a7162b6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132759&amp;x-signature=QsEviurDpsrVLdYOBmEGsGtm%2FEI%3D" alt="" loading="lazy"/></p>
<ul>
<li>设置中文、日期、时区等</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c60ee4e27b9a4fb1ae64b9db8ac5c1cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132759&amp;x-signature=qrInH5cLRQU%2Bl7lRhax8kJiMiaI%3D" alt="" loading="lazy"/></p>
<ul>
<li>其它项目、里程碑、蓝图、代办、看板等等功能我们就不一一列举了，家人们可以先自己部署完试验下</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9268f032ba874374bff84d43d2189ac9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132759&amp;x-signature=mDst8HZa0lyZeeCHboQU59IeSCI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">📝总结</h2>
<p>Leantime是一个真正为用户考虑的项目管理工具。它不仅在功能上能够满足企业级需求，更重要的是，它在易用性和包容性方面做得非常出色。无论你是小型创业团队还是大型企业，无论你的团队成员技术背景如何，Leantime都能提供出色的项目管理体验。</p>
<h2 data-id="heading-10">💬今日闲谈</h2>
<p>刷短视频时看到一句话，颇有意思：</p>
<p><strong>把“责任”二字看得太重，就是对自我最大的暴力——过度负责，是病，得治。</strong></p>
<p>确实如此。如今我们做事，似乎总在两个极端间摇摆——不是“过度负责”，就是“不负责任”。而真正要做的，恰恰是在两者之间找到平衡：认真负责却不越界，勇于承担却不盲从。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/403956aaef2c4b0ba0d651dd394a994b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770132759&amp;x-signature=V873ztCbRy0c0WOo0CFINdat6Hw%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Antd Vue 组件提示功能二次封装]]></title>    <link>https://juejin.cn/post/7599924965950750758</link>    <guid>https://juejin.cn/post/7599924965950750758</guid>    <pubDate>2026-01-27T15:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599924965950750758" data-draft-id="7599917711792898058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Antd Vue 组件提示功能二次封装"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T15:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yyt_"/> <meta itemprop="url" content="https://juejin.cn/user/1162607282632969"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Antd Vue 组件提示功能二次封装
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1162607282632969/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yyt_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:43:11.000Z" title="Tue Jan 27 2026 15:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本次封装组件有用到「Message 全局提示」与「Notification 通知提醒框」</p>
<ul>
<li>若只使用 <code>Message</code>：无法满足「重要通知需要持久化、需要用户手动关闭」的场景，重要信息可能被用户忽略（3 秒自动消失）。</li>
<li>若只使用 <code>Notification</code>：对于简单的快捷反馈，会显得过于笨重，高频次弹出会占用过多页面空间，影响用户操作，降低体验。</li>
</ul>
<h2 data-id="heading-0">一、 前期准备：查阅 Antd 官方 API</h2>
<ol>
<li>进入 Ant Design Vue 官方文档，找到「Message 全局提示」与「Notification 通知提醒框」的 API 章节</li>
<li>两种组件均支持通过 <code>xxx.config({})</code> 格式进行全局默认配置，文档中会列出所有可配置参数（如显示位置、停留时长等）</li>
<li>核心需用到 <code>message</code>（轻量顶部提示）和 <code>notification</code>（右下角通知框）两个组件，用于后续功能封装优化</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28b7066f40614569b952b1bc39581b34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeXl0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770133395&amp;x-signature=fOHc6%2Bzjxzt%2BuHkRs9PeCnRPgz0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、 核心封装：实现统一提示工具（antd-message.js）</h2>
<h3 data-id="heading-2">1.  导入依赖与全局默认配置</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { notification, message } <span class="hljs-keyword">from</span> <span class="hljs-string">'ant-design-vue'</span>;
<span class="hljs-keyword">import</span> { messageContent } <span class="hljs-keyword">from</span> <span class="hljs-string">'./messageContent'</span>;

<span class="hljs-comment">// 全局配置 notification（通知框）的默认行为</span>
notification.<span class="hljs-title function_">config</span>({
  <span class="hljs-attr">placement</span>: <span class="hljs-string">'bottomRight'</span>, <span class="hljs-comment">// 通知框显示位置：右下角</span>
  <span class="hljs-attr">bottom</span>: <span class="hljs-string">'50px'</span>, <span class="hljs-comment">// 距离底部 50px</span>
  <span class="hljs-attr">duration</span>: <span class="hljs-number">3</span> <span class="hljs-comment">// 默认停留 3 秒（自动关闭）</span>
});

<span class="hljs-comment">// 复制 message 实例到 messageCopy</span>
<span class="hljs-comment">// 目的是隔离原始实例，避免后续操作意外修改 message 原生属性，属于严谨编码习惯，也可直接使用 message</span>
<span class="hljs-keyword">const</span> messageCopy = message;

<span class="hljs-comment">// 全局配置 messageCopy（即 message）的默认行为</span>
messageCopy.<span class="hljs-title function_">config</span>({
  <span class="hljs-attr">top</span>: <span class="hljs-string">'150px'</span>, <span class="hljs-comment">// 提示框距离顶部 150px（默认是顶部 8px）</span>
  <span class="hljs-attr">duration</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// 默认停留 3 秒</span>
  <span class="hljs-attr">maxCount</span>: <span class="hljs-number">5</span> <span class="hljs-comment">// 最多同时显示 5 个提示框（避免多次点击弹出过多）</span>
});
</code></pre>
<h3 data-id="heading-3">2.  封装统一提示方法（以 error 为例）</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> messageConfig = {
  <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">msg, type, config = {}</span>) =&gt;</span> {
    <span class="hljs-comment">// 1. 生成唯一 key，用于标识当前的 notification 实例，方便后续手动关闭</span>
    <span class="hljs-keyword">const</span> key = <span class="hljs-string">`open<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>;
    
    <span class="hljs-comment">// 2. 判断展示形式：根据传入的 type 是否为 'center'，切换两种提示组件</span>
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'center'</span>) {
      <span class="hljs-comment">// 情况 1：type === 'center' → 使用 messageCopy 的 error 方法（顶部轻量提示）</span>
      messageCopy.<span class="hljs-title function_">error</span>(msg, config.<span class="hljs-property">duration</span>, config.<span class="hljs-property">onClose</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 情况 2：其他 type → 使用 notification 的 error 方法（右下角通知框）</span>
      notification.<span class="hljs-title function_">error</span>({
        <span class="hljs-attr">class</span>: <span class="hljs-string">'notification-content'</span>, <span class="hljs-comment">// 给通知框添加自定义 class，方便后续自定义样式</span>
        <span class="hljs-attr">message</span>: <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// 3. 统一渲染通知框内容：调用 messageContent 生成自定义模板</span>
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">messageContent</span>({
            msg, <span class="hljs-comment">// 提示文本</span>
            <span class="hljs-attr">isHtml</span>: config.<span class="hljs-property">isHtml</span>, <span class="hljs-comment">// 是否支持 HTML 渲染（外部传入配置）</span>
            <span class="hljs-attr">close</span>: <span class="hljs-function">() =&gt;</span> notification.<span class="hljs-title function_">close</span>(key) <span class="hljs-comment">// 手动关闭回调：关闭当前实例</span>
          });
        },
        key, <span class="hljs-comment">// 传入唯一 key，关联当前 notification 实例</span>
        ...config <span class="hljs-comment">// 合并外部传入的 config，允许覆盖默认配置</span>
      });
    }
  }
  <span class="hljs-comment">// 可继续封装 success、warn、info 等方法，逻辑与 error 一致</span>
};
</code></pre>
<h3 data-id="heading-4">3.  封装关键细节说明</h3>
<ol>
<li>接收外部传入的 <code>config</code> 参数，默认值为 <code>{}</code>，支持覆盖 <code>duration</code>（停留时长）、<code>onClose</code>（关闭回调）、<code>isHtml</code>（是否支持 HTML）等配置</li>
<li>使用 <code>...config</code> 合并外部配置，可传入 Antd <code>notification</code> 支持的所有配置，优先级高于全局默认配置</li>
<li>手动关闭实现：通过 <code>Date.now()</code> 生成唯一 <code>key</code>，关联当前 <code>notification</code> 实例，配合 <code>messageContent</code> 传入的 <code>close</code> 回调，实现精准关闭当前通知框</li>
</ol>
<h2 data-id="heading-5">三、 自定义内容渲染：messageContent 函数（JSX 语法）</h2>
<h3 data-id="heading-6">1.  实现代码</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> xssHtml <span class="hljs-keyword">from</span> <span class="hljs-string">'../filter/xssHtml.js'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">messageContent</span> ({
  msg,
  close,
  isHtml = <span class="hljs-literal">true</span>
}) {
  <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    {isHtml ? <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">{xssHtml(msg)}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> : msg}
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">'notification-notice-close-btn icon-card_close'</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> close()}&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;/&gt;</span></span>);
}
</code></pre>
<h3 data-id="heading-7">2.  核心说明</h3>
<ol>
<li>使用 <code>&lt;&gt;</code> 空片段包裹内容，避免生成额外 DOM 节点，同时满足 JSX 单根节点要求</li>
<li>条件渲染：<code>isHtml</code> 为 <code>true</code> 时，使用 <code>v-html</code> 渲染 HTML 内容；为 <code>false</code> 时，直接渲染纯文本</li>
<li>安全保障：<code>v-html={xssHtml(msg)}</code> 对 HTML 内容进行 XSS 过滤，防止恶意脚本攻击</li>
<li>自定义关闭按钮：绑定 <code>onClick</code> 事件，调用传入的 <code>close</code> 回调，实现手动关闭通知框</li>
</ol>
<h2 data-id="heading-8">四、 全局注册：Antd 组件与自定义提示工具</h2>
<h3 data-id="heading-9">1.  导入所需组件与资源</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 第一部分：批量导入 antdv 常用基础组件（从核心包导入）</span>
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">Collapse</span>, <span class="hljs-title class_">Tooltip</span>, <span class="hljs-title class_">Pagination</span>, <span class="hljs-title class_">Layout</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'ant-design-vue'</span>;

<span class="hljs-comment">// 第二部分：单独导入需要依赖 moment.js 的时间相关组件（特殊处理）</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DatePicker</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'ant-design-vue/es/date-picker/moment'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TimePicker</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'ant-design-vue/es/time-picker/moment'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Calendar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'ant-design-vue/es/calendar/moment'</span>;

<span class="hljs-comment">// 第三部分：导入 antdv 全局样式重置文件（必选）</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'ant-design-vue/dist/reset.css'</span>;

<span class="hljs-comment">// 第四部分：导入封装好的自定义 message 工具</span>
<span class="hljs-keyword">import</span> message <span class="hljs-keyword">from</span> <span class="hljs-string">'./antd-message'</span>;
</code></pre>
<h3 data-id="heading-10">2.  导入细节说明</h3>
<ol>
<li>批量导入 vs 单独导入：基础组件（Button、Table 等）从核心包批量导入，时间相关组件从 <code>es/xxx/moment</code> 单独导入，确保 <code>moment.js</code> 依赖正常加载，减少冗余打包</li>
<li><code>reset.css</code>：Antd 4.x 及以上版本的全局样式文件，用于重置浏览器默认样式、统一组件样式，缺失会导致组件样式错乱</li>
<li>自定义 <code>message</code>：导入之前封装的 <code>messageConfig</code>，后续全局挂载供全项目使用</li>
</ol>
<h3 data-id="heading-11">3.  定义全局注册核心函数</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 定义接收 Vue 应用实例（app）的函数，用于注册组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">useAntdComponent</span> = (<span class="hljs-params">app</span>) =&gt; {
  <span class="hljs-comment">// 第一步：通过 app.use() 逐个注册 antdv 组件（全局注册）</span>
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Collapse</span>);
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Tooltip</span>);
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Pagination</span>);
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Layout</span>);
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">DatePicker</span>);
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">TimePicker</span>);
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Calendar</span>);

  <span class="hljs-comment">// 第二步：全局挂载自定义 message 到 Vue 实例的 globalProperties 上</span>
  app.<span class="hljs-property">config</span>.<span class="hljs-property">globalProperties</span>.<span class="hljs-property">$message</span> = message;
};
</code></pre>
<h3 data-id="heading-12">4.  全局注册细节说明</h3>
<ol>
<li><code>app.use(组件)</code>：Antd 组件均暴露 <code>install</code> 方法，调用该方法将组件注册为全局组件，后续无需手动导入即可在模板中使用</li>
<li><code>app.config.globalProperties.$message = message</code>：Vue 3 中挂载全局属性的方式，挂载后可在组件中通过 <code>this.$message</code>（普通 script）或 <code>proxy.$message</code>（script setup）访问</li>
</ol>
<h3 data-id="heading-13">5.  导出注册函数与 message 工具</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  useAntdComponent,
  message
};
</code></pre>
<h3 data-id="heading-14">6.  入口文件调用（main.js / main.ts）</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-comment">// 导入封装的 antdv 全局注册工具</span>
<span class="hljs-keyword">import</span> antdTools <span class="hljs-keyword">from</span> <span class="hljs-string">'./path/to/antd-component-register.js'</span>

<span class="hljs-comment">// 创建 Vue 应用实例</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// 调用注册函数，完成组件全局注册和 message 全局挂载</span>
antdTools.<span class="hljs-title function_">useAntdComponent</span>(app)

<span class="hljs-comment">// 挂载 App 到 DOM</span>
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h3 data-id="heading-15">7.  调用后生效效果</h3>
<ol>
<li>所有注册的 Antd 组件可直接在模板中使用，无需手动导入</li>
<li>自定义 <code>message</code> 工具可在全项目组件中访问，无需重复导入</li>
</ol>
<h2 data-id="heading-16">五、 优化打包体积：配置 babel-plugin-import 插件</h2>
<ol>
<li>未配置该插件时，即使按需导入组件，打包也会包含整个 Antd 库，导致体积过大</li>
<li>配置后，只会打包使用到的组件代码，有效减小打包体积</li>
<li>配置示例（babel.config.js）</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [
    [
      <span class="hljs-string">'import'</span>,
      { <span class="hljs-attr">libraryName</span>: <span class="hljs-string">'ant-design-vue'</span>, <span class="hljs-attr">libraryDirectory</span>: <span class="hljs-string">'es'</span>, <span class="hljs-attr">style</span>: <span class="hljs-string">'css'</span> }
    ],
    [
      <span class="hljs-string">'import'</span>,
      { <span class="hljs-attr">libraryName</span>: <span class="hljs-string">'vxe-table'</span>, <span class="hljs-attr">style</span>: <span class="hljs-literal">true</span> }, <span class="hljs-string">'vxe-table'</span>
    ],
    <span class="hljs-string">'@vue/babel-plugin-jsx'</span>
  ],
  <span class="hljs-attr">presets</span>: [
    <span class="hljs-string">'@vue/cli-plugin-babel/preset'</span>,
    [<span class="hljs-string">'@babel/preset-react'</span>, { <span class="hljs-attr">runtime</span>: <span class="hljs-string">'classic'</span> }]
  ]
};
</code></pre>
<h2 data-id="heading-17">六、 验证使用：全局组件与提示工具实战</h2>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- 无需导入 Button，直接使用 &lt;a-button&gt; --&gt;
  &lt;a-button type="primary" @click="showError"&gt;点击显示错误提示&lt;/a-button&gt;
  &lt;!-- 无需导入 Table，直接使用 &lt;a-table&gt; --&gt;
  &lt;a-table :columns="columns" :data-source="data" bordered /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { getCurrentInstance } from 'vue'

// 获取 proxy，访问全局挂载的 $message
const { proxy } = getCurrentInstance()

// 调用全局挂载的 message 工具
const showError = () =&gt; {
  proxy.$message.error('这是全局挂载后的错误提示', 'center')
}

// 表格测试数据
const columns = [
  { title: '姓名', dataIndex: 'name', key: 'name' },
  { title: '年龄', dataIndex: 'age', key: 'age' }
]
const data = [{ key: 1, name: '张三', age: 20 }]
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-18">总结</h3>
<ol>
<li>核心流程：查阅官方 API → 封装统一提示工具 → 自定义内容渲染（防 XSS）→ 全局注册组件与工具 → 配置打包优化插件 → 验证使用</li>
<li>关键亮点：实现两种提示组件的统一调用、支持配置覆盖、保障 HTML 渲染安全、减少重复导入工作、优化打包体积</li>
<li>最终效果：全项目可直接使用 Antd 常用组件和 <code>$message</code> 提示工具，提升开发效率，保证代码统一性</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[画图，配图？我只用 Nano Banana（附 Prompt）]]></title>    <link>https://juejin.cn/post/7599912857391988782</link>    <guid>https://juejin.cn/post/7599912857391988782</guid>    <pubDate>2026-01-27T15:59:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599912857391988782" data-draft-id="7599835610406944814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="画图，配图？我只用 Nano Banana（附 Prompt）"/> <meta itemprop="keywords" content="Google,AIGC"/> <meta itemprop="datePublished" content="2026-01-27T15:59:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            画图，配图？我只用 Nano Banana（附 Prompt）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:59:57.000Z" title="Tue Jan 27 2026 15:59:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>活动</strong>：前几天，我写了一篇文章，可以免费获取 Ace Data Cloud 平台积分，感兴趣的可以阅读文章
[Ace Data Cloud 浏览器插件配置与内容发布 SOP（标准作业程序，参加活动送积分）](<a href="https://juejin.cn/post/7597266141912727598" target="_blank" title="https://juejin.cn/post/7597266141912727598">Ace Data Cloud 浏览器插件配置与内容发布 SOP（标准作业程序，参加活动送积分）本 SOP 用于指导团队完 - 掘金</a>)。</p>
<p>工程架构图复杂，不好布局？一画好几天仍不满意？<br/>
PPT 配图没有合适的，是否让你焦头烂额？<br/>
下面分享一个使用 Nano Banana 画流程图/架构图的完整案例，附带可执行的 Prompt：让你几分钟搞定作图，把精力留给设计与决策。</p>
<p>话不多说，看看 Nano Banana 是怎么从需求，变成复杂而清晰的架构图的。</p>
<h2 data-id="heading-0">生成案例预览（由下方 Prompt 生成）</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b13ba391f8849e0bd0164f905337ed6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770134397&amp;x-signature=a9w4LluXVakanwicwTTN6Lu%2FPss%3D" alt="使用 Nano Banana 生成的架构图示例" loading="lazy"/></p>
<blockquote>
<p>上图为示意图：来自文末“架构图生成 Prompt（中文标签版）”的输出效果。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">一、为什么用 Nano Banana 画流程图/架构图</h2>
<p>流程图要清晰，架构图要专业，更要可复用。Nano Banana 通过结构化提示词与多轮可控编辑，让“节点—连线—布局—风格”一步步锁定，既能快速产出成品，也能在反复迭代中保持布局与样式的一致性。</p>
<ul>
<li>更懂指令：支持将“节点清单、连接关系、布局约束、风格规范”分段描述，减少歧义，画出真正能落地的工程级图面。</li>
<li>多轮编辑可控：先定骨架，再填细节；从网格对齐、线宽字号，到色板主题，都能稳定复现。</li>
<li>一致性强：跨版本保持节点位置与视觉规范一致，方便对比与版本管理。</li>
<li>高辨识度：平面矢量风、标准线宽与色盲友好配色，确保会审、投屏、A3 打印都清晰。</li>
<li>ACE 平台加速：国内直连、失败不计费、单张约 0.1 元，高分辨率导出无压力，批量迭代更经济。</li>
</ul>
<p>把画图当成一次小型工程：结构化输入、可控式输出、可复现流程。现在就用 Nano Banana 在 ACE 平台开启你的“从思路到图面”的最快路径。</p>
<hr/>
<h2 data-id="heading-2">二、软件架构图设计方案</h2>
<p>主题：事件驱动的中大型电商平台（微服务 + 服务网格 + CDC 分析链路）</p>
<h3 data-id="heading-3">视觉组织</h3>
<ul>
<li>自上而下泳道布局：Client/Edge → Gateway/BFF → Service Mesh &amp; Services → Messaging &amp; Data Store → Observability &amp; Security → Analytics &amp; CI/CD</li>
<li>图形规范：1.5–2px 线宽、圆角 8px、网格对齐、色盲友好配色（主蓝、辅黄、灰黑）</li>
<li>连线规则：主业务流用实线箭头，异步事件流用虚线箭头并标注 Topic；跨域或跨层用淡色连线；关键路径加粗</li>
</ul>
<h3 data-id="heading-4">组件分层</h3>
<ul>
<li>客户端与边缘层
<ul>
<li>Web 客户端、移动客户端</li>
<li>DNS/CDN、WAF</li>
</ul>
</li>
<li>入口与编排
<ul>
<li>API Gateway（REST/GraphQL）</li>
<li>BFF（Web / Mobile）</li>
<li>Service Mesh（如 Istio/Linkerd）</li>
<li>Saga Orchestrator（支持补偿事务）</li>
</ul>
</li>
<li>核心微服务
<ul>
<li>Auth（认证与令牌）、User、Product、Inventory、Cart、Order、Payment、Shipping</li>
<li>Search（全文检索）、Recommendation（个性化推荐）、Notification（邮件/短信/推送）</li>
</ul>
</li>
<li>消息与数据
<ul>
<li>Kafka（或等价消息流平台），Topics：order_events、payment_events、inventory_events、notification_events</li>
<li>Data Stores：关系型数据库集群（分库分表/读写分离）、Redis Cache、Search Index、对象存储</li>
</ul>
</li>
<li>可观测与安全
<ul>
<li>Prometheus、Grafana、Loki、Jaeger/Tempo</li>
<li>IAM/Secrets Manager、KMS、审计日志</li>
</ul>
</li>
<li>数据分析与增长
<ul>
<li>CDC/变更日志（如 Debezium）→ 流入 Data Lake → DWH（数据仓库）→ BI/报表</li>
</ul>
</li>
<li>基础设施与交付
<ul>
<li>Kubernetes（多命名空间：prod/staging）、VPC/子网/NAT、Bastion</li>
<li>CI/CD：Git、CI Runner、Artifact Registry、Canary/Feature Flags</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">关键业务流（示例）</h3>
<ul>
<li>下单主路径（同步 + 异步补偿）
<ol>
<li>Client → CDN/WAF → API Gateway → BFF → Auth 校验 → Order 服务预占订单</li>
<li>Order 发送 order_events（创建/支付中）</li>
<li>Inventory 订阅并“预扣”库存；Payment 接入支付渠道，回调 → 支付确认事件</li>
<li>Saga Orchestrator 根据回调驱动补偿：支付失败 → 释放库存、关闭订单；成功 → 发货流程</li>
</ol>
</li>
<li>搜索与推荐
<ul>
<li>商品上新 → CDC → 搜索索引增量更新；用户行为事件 → 推荐服务特征更新</li>
</ul>
</li>
<li>可观测与告警
<ul>
<li>Metrics/Logs/Traces 全链路采集；SLO 超阈值触发告警与自动化扩容</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">扩展与可靠性</h3>
<ul>
<li>支持金丝雀发布与特性开关；跨可用区容错；对象存储作媒体与导出报表归档；读流量缓存化；写流量事件化</li>
</ul>
<hr/>
<h2 data-id="heading-7">三、清晰 Prompt（可直接用于 Nano Banana 生成架构图）</h2>
<p>提示：图中文字渲染在部分模型中可能不稳定。若出现问题，建议先用节点 ID（如 S1、G1）生成干净布局，再在二次编辑或设计工具中批量叠加中文标签。</p>
<h3 data-id="heading-8">架构图生成 Prompt（中文标签版）</h3>
<pre><code class="hljs language-text" lang="text">请以“工程级平面矢量风”绘制一张中大型电商平台软件架构图，要求：
- 画布：4096×3072，白底，四周留白 64px；自上而下泳道布局，六个分区：Clients/Edge、Gateway/BFF、Service Mesh &amp; Orchestrator、Microservices、Messaging &amp; Data、Observability &amp; Security、Analytics &amp; CI/CD。
- 风格：无透视、无渐变、无阴影、无 3D；线宽 1.8px、圆角 8px、箭头统一；网格对齐，节点间距一致；色盲友好配色（主蓝 #2F6FFF、辅黄 #FFD84D、深灰 #0F1115、浅灰 #E9ECEF）。
- 节点（请按组画出、居中对齐，并在节点内使用清晰简体中文标签与节点 ID，示例：“S1 订单服务”）：
  Clients/Edge：C1 Web 客户端，C2 移动客户端，E1 DNS/CDN，E2 WAF
  Gateway/BFF：G1 API Gateway，G2 BFF Web，G3 BFF Mobile
  Mesh/Orchestrator：M1 Service Mesh，M2 Saga Orchestrator
  Microservices：S1 订单服务，S2 支付服务，S3 库存服务，S4 商品服务，S5 购物车服务，S6 认证服务，S7 用户服务，S8 发货服务，S9 搜索服务，S10 推荐服务，S11 通知服务
  Messaging &amp; Data：K1 Kafka 集群，T1 order_events，T2 payment_events，T3 inventory_events，T4 notification_events，D1 关系型数据库集群，D2 Redis 缓存，D3 搜索索引，D4 对象存储
  Observability &amp; Security：O1 Prometheus，O2 Grafana，O3 Jaeger，O4 Loki，SEC1 IAM/Secrets，SEC2 KMS，SEC3 审计日志
  Analytics &amp; CI/CD：A1 CDC/变更捕获，A2 数据湖，A3 数仓/BI，CI1 Git，CI2 CI Runner，CI3 Artifact Registry，CI4 Canary/Feature Flags
- 连接（请用直线或折线箭头、避免交叉，关键流加粗，异步事件流用虚线并标注 Topic）：
  C1→E1→E2→G1→G2→M1；C2→E1→E2→G1→G3→M1
  G2/G3→S6（认证）→返回→G2/G3
  G2/G3→S4（商品）→S9（搜索）→返回→G2/G3
  G2/G3→S5（购物车）→S1（订单）
  S1→K1→T1（order_events）
  S1→S3（库存：预扣）↔ D1；S3→K1→T3
  S1→S2（支付）→K1→T2（支付事件）→M2（编排补偿）
  T2→S1（确认或关闭）→S8（发货）→S11（通知）→K1→T4
  S9 读取 D3；S10 读取行为事件（来自 K1）与 D1/D2
  所有服务→D2（缓存）与 D1（各自数据）；媒体/发票→D4
  观测：所有服务→O1/O3/O4；O1→O2（看板）
  安全：服务与数据访问经 SEC1/SEC2 控制；审计流向 SEC3
  分析链路：D1 变更→A1（CDC）→A2（数据湖）→A3（数仓/BI）
  交付：CI1→CI2→CI3→Kubernetes（通过 Canary/Feature Flags 渐进发布）
- 图例与标注：右下角放置简洁图例（实线=同步调用，虚线=事件流；加粗=关键路径；色块=分组泳道）。节点标签要求字号清晰、对齐整齐。
- 若中文文字渲染不稳定：请保留节点 ID（如 S1、G1），并在右侧生成“ID→中文标签”对照表。
- 负面约束：避免不规则形状、避免倾斜排版、避免复杂纹理、水印、随机 Logo、乱码文字。
</code></pre>
<h3 data-id="heading-9">多轮编辑（可选的稳健流程）</h3>
<ul>
<li>第 1 轮（定骨架）：仅生成泳道、节点位置与 ID（不填中文标签），确保线条与布局整洁。</li>
<li>第 2 轮（补标签与风格）：在保持布局不动的前提下，填入中文标签、加粗关键路径、统一配色与线宽。</li>
<li>第 3 轮（导出与变体）：输出 4096×3072 主版；再生成深色主题与 A3 打印友好版（更高对比、加大字号）。</li>
</ul>
<h3 data-id="heading-10">实用小贴士</h3>
<ul>
<li>需要最清晰的文本时，用“ID 占位 + 后期矢量叠字”流程：先生成干净图面，再在设计工具（Figma/Illustrator）导出 SVG/PDF 叠加正文。</li>
<li>若要流程图版本（而非全架构），只保留 Clients/Edge、Gateway、2–4 个关键服务与 1–2 条事件流，强调决策节点与步骤编号即可。</li>
<li>保持版本可复现：将节点清单与连线列表独立保存，增删节点只在该清单处修改，确保跨版本布局稳定。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端域名（Frontend Domain）与后端域名（Backend Domain）的分离手册]]></title>    <link>https://juejin.cn/post/7599899147417927732</link>    <guid>https://juejin.cn/post/7599899147417927732</guid>    <pubDate>2026-01-27T14:35:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599899147417927732" data-draft-id="7599893063863435279" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端域名（Frontend Domain）与后端域名（Backend Domain）的分离手册"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-01-27T14:35:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端域名（Frontend Domain）与后端域名（Backend Domain）的分离手册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:35:42.000Z" title="Tue Jan 27 2026 14:35:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前端域名（Frontend Domain）与后端域名（Backend Domain）的分离是现代 Web 应用架构的核心设计之一。以下是详细解析：</p>
<h2 data-id="heading-0">一、基础概念</h2>
<h3 data-id="heading-1">前端域名（Client-side）</h3>
<ul>
<li><strong>用途</strong>：承载静态资源（HTML、CSS、JavaScript、图片、字体等）</li>
<li><strong>示例</strong>：<code>www.example.com</code>、<code>app.example.com</code></li>
<li><strong>技术栈</strong>：React、Vue、Angular 构建的 SPA，或传统模板引擎渲染的页面</li>
<li><strong>CDN 常见</strong>：通常部署在 CDN（如阿里云 CDN、Cloudflare）上，实现全球加速</li>
</ul>
<h3 data-id="heading-2">后端域名（API Domain）</h3>
<ul>
<li><strong>用途</strong>：提供数据接口（REST API、GraphQL、gRPC 网关等）</li>
<li><strong>示例</strong>：<code>api.example.com</code>、<code>backend.example.com</code>、<code>service.example.com</code></li>
<li><strong>技术栈</strong>：Django、Spring Boot、Node.js、Go 等服务端框架</li>
<li><strong>部署位置</strong>：部署在应用服务器、容器集群（K8s）或 Serverless 平台</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、为什么要分离？</h2>

































<table><thead><tr><th>维度</th><th>分离架构优势</th></tr></thead><tbody><tr><td><strong>性能优化</strong></td><td>前端走 CDN 缓存，后端专注计算；实现动静分离</td></tr><tr><td><strong>扩展性</strong></td><td>前后端独立扩容，前端加 CDN 节点，后端加服务器实例</td></tr><tr><td><strong>安全性</strong></td><td>API 域名可限制 CORS、添加 WAF、隐藏真实 IP；静态域名不暴露数据库等敏感信息</td></tr><tr><td><strong>部署独立</strong></td><td>前端修改无需重启后端，后端升级不影响前端展示（只要接口兼容）</td></tr><tr><td><strong>缓存策略</strong></td><td>静态资源长期缓存（ immutable ），API 禁用缓存或短时间缓存</td></tr><tr><td><strong>多端支持</strong></td><td>同一套后端 API 支持 Web、App、小程序等多前端</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">三、常见域名配置模式</h2>
<h3 data-id="heading-5">模式 1：子域名分离（最常见）</h3>
<pre><code class="hljs language-bash" lang="bash">前端: https://www.myapp.com 或 https://app.myapp.com
后端: https://api.myapp.com

优点：清晰、便于配置不同的 DNS 策略和 SSL 证书
</code></pre>
<h3 data-id="heading-6">模式 2：路径分离（简单项目）</h3>
<pre><code class="hljs language-arduino" lang="arduino">前端: https:<span class="hljs-comment">//www.myapp.com/</span>
后端: https:<span class="hljs-comment">//www.myapp.com/api/</span>

优点：无需处理跨域（同源）
缺点：灵活性差，不利于独立扩展和 CDN 配置
</code></pre>
<h3 data-id="heading-7">模式 3：完全独立域名（微服务/多品牌）</h3>
<pre><code class="hljs language-arduino" lang="arduino">前端: https:<span class="hljs-comment">//customer-portal.com</span>
后端: https:<span class="hljs-comment">//internal-api.company.com</span>

优点：彻底解耦，适用于不同团队维护
注意：需要严格处理 CORS 和鉴权
</code></pre>
<h3 data-id="heading-8">模式 4：环境子域名（开发规范）</h3>
<pre><code class="hljs language-arduino" lang="arduino">生产:
  前端: https:<span class="hljs-comment">//app.example.com</span>
  后端: https:<span class="hljs-comment">//api.example.com</span>

测试:
  前端: https:<span class="hljs-comment">//staging-app.example.com</span>
  后端: https:<span class="hljs-comment">//staging-api.example.com</span>

开发:
  前端: https:<span class="hljs-comment">//dev-app.example.com</span>
  后端: https:<span class="hljs-comment">//dev-api.example.com</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">四、跨域问题（CORS）详解</h2>
<p>当前端与后端域名不同时，浏览器会触发**同源策略（Same-Origin Policy）**限制，必须通过 CORS 解决。</p>
<h3 data-id="heading-10">CORS 预检请求流程</h3>
<pre><code class="hljs language-http" lang="http">OPTIONS /api/user HTTP/1.1
Host: api.example.com
Origin: https://app.example.com
Access-Control-Request-Method: POST

HTTP/1.1 204 No Content
Access-Control-Allow-Origin: https://app.example.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Credentials: true
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Max-Age: 86400
</code></pre>
<h3 data-id="heading-11">Django 配置示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># settings.py</span>
CORS_ALLOWED_ORIGINS = [
    <span class="hljs-string">"https://app.example.com"</span>,
    <span class="hljs-string">"https://admin.example.com"</span>,
]

CORS_ALLOW_CREDENTIALS = <span class="hljs-literal">True</span>  <span class="hljs-comment"># 允许携带 Cookies</span>
CORS_ALLOW_HEADERS = [
    <span class="hljs-string">'content-type'</span>,
    <span class="hljs-string">'authorization'</span>,
    <span class="hljs-string">'x-csrftoken'</span>,
]
</code></pre>
<h3 data-id="heading-12">替代方案：反向代理（Nginx）</h3>
<p>如果不方便配置 CORS，可以通过 Nginx 代理转发，让浏览器认为前后端同源：</p>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name app.example.com;
    
    location / {
        # 前端资源
        root /var/www/html;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        # 反向代理到后端，浏览器无感知跨域
        proxy_pass http://backend-server:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-13">五、安全最佳实践</h2>
<h3 data-id="heading-14">1. HTTPS 强制</h3>
<ul>
<li>前后端都必须使用 HTTPS，<strong>禁止</strong> HTTP 混用（Mixed Content 会被浏览器拦截）</li>
</ul>
<h3 data-id="heading-15">2. CORS 白名单限制</h3>
<ul>
<li>生产环境<strong>绝对不要</strong>使用 <code>Access-Control-Allow-Origin: *</code>（特别是涉及 Cookie 时）</li>
<li>严格限制允许的来源域名</li>
</ul>
<h3 data-id="heading-16">3. Cookie 安全属性</h3>
<pre><code class="hljs language-http" lang="http">Set-Cookie: sessionid=xxx; Secure; HttpOnly; SameSite=None; Domain=.example.com
</code></pre>
<ul>
<li><code>Secure</code>: 仅 HTTPS 传输</li>
<li><code>HttpOnly</code>: 禁止 JavaScript 读取（防 XSS）</li>
<li><code>SameSite=None</code>: 跨域场景必需（搭配 Secure）</li>
<li><code>Domain=.example.com</code>: 允许子域名共享 Cookie</li>
</ul>
<h3 data-id="heading-17">4. 鉴权方案选择</h3>

























<table><thead><tr><th>方案</th><th>适用场景</th><th>特点</th></tr></thead><tbody><tr><td><strong>Session + Cookie</strong></td><td>传统 Web、同主域</td><td>需要处理 CSRF，兼容性好</td></tr><tr><td><strong>JWT（ LocalStorage）</strong></td><td>SPA、跨主域</td><td>无状态，需防 XSS，服务端无法强制失效</td></tr><tr><td><strong>JWT（HttpOnly Cookie）</strong></td><td>推荐方案</td><td>结合两者优点，防 XSS，跨域配置复杂</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-18">六、实际部署示例</h2>
<h3 data-id="heading-19">完整架构图</h3>
<pre><code class="hljs language-bash" lang="bash">用户浏览器
   │
   ├─ https://app.example.com (CDN: Cloudflare/阿里云)
   │     ├─ HTML/CSS/JS (缓存1年)
   │     └─ index.html (不缓存，总是获取最新版)
   │
   └─ https://api.example.com (SLB -&gt; K8s/Docker)
         ├─ /api/users/ (Django REST Framework)
         ├─ /api/orders/ (微服务 A)
         └─ /graphql (GraphQL 网关)
</code></pre>
<h3 data-id="heading-20">前端 Axios 配置</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> apiClient = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.example.com'</span>,
  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 允许跨域携带 Cookie</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
  }
});

<span class="hljs-comment">// 请求拦截器添加 Token（如果用 JWT Header 方案）</span>
apiClient.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-variable language_">localStorage</span>.getItem(<span class="hljs-string">'token'</span>)}</span>`</span>;
  <span class="hljs-keyword">return</span> config;
});
</code></pre>
<hr/>
<h2 data-id="heading-21">七、总结建议</h2>
<ol>
<li><strong>新项目</strong>：直接使用子域名分离（<code>app.x.com</code> + <code>api.x.com</code>），架构清晰</li>
<li><strong>鉴权</strong>：推荐使用 HttpOnly Cookie + SameSite=None 模式，比 LocalStorage 更安全</li>
<li><strong>部署</strong>：前端务必上 CDN，后端使用负载均衡 + 多实例部署</li>
<li><strong>开发环境</strong>：配置 Vite/Webpack DevServer 的 <code>proxy</code> 功能，避免开发时处理 CORS 烦恼</li>
<li><strong>监控</strong>：前端用 Sentry 捕获错误，后端用 APM 工具（SkyWalking、NewRelic）监控 API 性能</li>
</ol>
<p>如果你正在使用 Django，建议配合 Django CORS Headers 库，并在生产环境严格审查 <code>ALLOWED_HOSTS</code> 和 <code>CORS_ALLOWED_ORIGINS</code> 配置。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mysql深度分页问题解决-结合django分析]]></title>    <link>https://juejin.cn/post/7599873006258290722</link>    <guid>https://juejin.cn/post/7599873006258290722</guid>    <pubDate>2026-01-27T14:45:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599873006258290722" data-draft-id="7599893063863468047" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mysql深度分页问题解决-结合django分析"/> <meta itemprop="keywords" content="Django,MySQL"/> <meta itemprop="datePublished" content="2026-01-27T14:45:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mysql深度分页问题解决-结合django分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:45:24.000Z" title="Tue Jan 27 2026 14:45:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MySQL 深度分页（Deep Pagination）指在数据量巨大时（如百万、千万级），使用 <code>LIMIT offset, count</code> 查询靠后的页码（如第 10000 页），性能会急剧下降甚至出现查询超时。</p>
<h2 data-id="heading-0">一、问题本质：为什么深度分页慢？</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">1000000</span>, <span class="hljs-number">20</span>;
</code></pre>
<p>MySQL 执行流程：</p>
<ol>
<li><strong>全表扫描/索引扫描</strong>：按 <code>created_at</code> 排序，扫描 <strong>1,000,020</strong> 行</li>
<li><strong>回表操作</strong>：通过主键回表取完整数据（如果是二级索引）</li>
<li><strong>丢弃数据</strong>：丢弃前 1,000,000 行，只保留最后 20 行</li>
</ol>
<p>随着 <code>offset</code> 增大，扫描的数据量线性增长，IO 和 CPU 开销飙升。</p>
<hr/>
<h2 data-id="heading-1">二、解决方案对比</h2>



































<table><thead><tr><th>方案</th><th>时间复杂度</th><th>适用场景</th><th>缺点</th></tr></thead><tbody><tr><td><strong>游标分页</strong></td><td>O(limit)</td><td>无限滚动、下一页/上一页</td><td>无法跳页、无法显示总页数</td></tr><tr><td><strong>延迟关联</strong></td><td>O(offset+limit)</td><td>必须跳页但 offset &lt; 10万</td><td>仍有性能开销、实现稍复杂</td></tr><tr><td><strong>覆盖索引</strong></td><td>O(offset+limit)</td><td>仅需索引字段</td><td>数据不全，需二次查询</td></tr><tr><td><strong>业务限制</strong></td><td>-</td><td>所有列表页</td><td>牺牲用户体验</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">三、具体实现方案</h2>
<h3 data-id="heading-3">方案 1：游标分页（Cursor / Keyset Pagination）⭐ 推荐</h3>
<p>利用上一页的最后一条记录作为下一页的查询条件，避免扫描 offset 行。</p>
<p><strong>SQL 实现：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 第一页</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">20</span>;

<span class="hljs-comment">-- 获取最后一条 id 为 9980，查询下一页</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">9980</span>  <span class="hljs-comment">-- 利用索引直接定位</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<p><strong>Django ORM 实现：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># views.py</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">order_list</span>(<span class="hljs-params">request</span>):
    cursor = request.GET.get(<span class="hljs-string">'cursor'</span>)  <span class="hljs-comment"># 上一页最后一条的 ID</span>
    
    queryset = Order.objects.<span class="hljs-built_in">all</span>().order_by(<span class="hljs-string">'-id'</span>)
    
    <span class="hljs-keyword">if</span> cursor:
        queryset = queryset.<span class="hljs-built_in">filter</span>(id__lt=cursor)
    
    <span class="hljs-comment"># 多字段游标（如按时间+ID）</span>
    <span class="hljs-comment"># if cursor:</span>
    <span class="hljs-comment">#     last_time, last_id = cursor.split(',')</span>
    <span class="hljs-comment">#     queryset = queryset.filter(</span>
    <span class="hljs-comment">#         Q(created_at__lt=last_time) | </span>
    <span class="hljs-comment">#         Q(created_at=last_time, id__lt=last_id)</span>
    <span class="hljs-comment">#     )</span>
    
    orders = queryset[:<span class="hljs-number">21</span>]  <span class="hljs-comment"># 多查1条用于判断是否还有下一页</span>
    has_next = <span class="hljs-built_in">len</span>(orders) &gt; <span class="hljs-number">20</span>
    orders = <span class="hljs-built_in">list</span>(orders[:<span class="hljs-number">20</span>])
    
    next_cursor = orders[-<span class="hljs-number">1</span>].<span class="hljs-built_in">id</span> <span class="hljs-keyword">if</span> orders <span class="hljs-keyword">and</span> has_next <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">return</span> JsonResponse({
        <span class="hljs-string">'data'</span>: [{<span class="hljs-string">'id'</span>: o.<span class="hljs-built_in">id</span>, ...} <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> orders],
        <span class="hljs-string">'next_cursor'</span>: next_cursor,
        <span class="hljs-string">'has_next'</span>: has_next
    })
</code></pre>
<p><strong>优点：</strong> 性能恒定，无论查第 1 页还是第 100 万页，都只需扫描 20 行。
<strong>缺点：</strong> 不支持跳转到指定页码（如直接跳到第 50 页）。</p>
<hr/>
<h3 data-id="heading-4">方案 2：延迟关联（Deferred Join）</h3>
<p>先通过<strong>覆盖索引</strong>查询主键 ID，再通过 ID 关联取完整数据，减少回表次数。</p>
<p><strong>SQL 实现：</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 传统方式（慢）：需要回表 1000020 次</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">1000000</span>, <span class="hljs-number">20</span>;

<span class="hljs-comment">-- 优化方式：先查 ID（覆盖索引，不回表），再 JOIN</span>
<span class="hljs-keyword">SELECT</span> o.<span class="hljs-operator">*</span> 
<span class="hljs-keyword">FROM</span> orders o
<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> (
    <span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> orders 
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span> 
    LIMIT <span class="hljs-number">1000000</span>, <span class="hljs-number">20</span>
) tmp <span class="hljs-keyword">ON</span> o.id <span class="hljs-operator">=</span> tmp.id;
</code></pre>
<p><strong>执行计划对比：</strong></p>
<ul>
<li>传统：扫描 1000020 行，回表 1000020 次</li>
<li>优化：子查询扫描 1000020 行（仅用索引），回表 <strong>仅 20 次</strong></li>
</ul>
<p><strong>Django ORM 实现：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 方式 1：使用子查询（Django 1.11+）</span>
<span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> Subquery

ids = Order.objects.order_by(<span class="hljs-string">'-created_at'</span>).values(<span class="hljs-string">'id'</span>)[<span class="hljs-number">1000000</span>:<span class="hljs-number">1000020</span>]
orders = Order.objects.<span class="hljs-built_in">filter</span>(id__in=Subquery(ids))  <span class="hljs-comment"># 注意：这里无序，需再排序</span>

<span class="hljs-comment"># 方式 2：两次查询（更推荐，避免 IN 性能问题）</span>
ids = <span class="hljs-built_in">list</span>(Order.objects.order_by(<span class="hljs-string">'-created_at'</span>).values_list(<span class="hljs-string">'id'</span>, flat=<span class="hljs-literal">True</span>)[<span class="hljs-number">1000000</span>:<span class="hljs-number">1000020</span>])
orders = Order.objects.<span class="hljs-built_in">filter</span>(id__in=ids).order_by(<span class="hljs-string">'-created_at'</span>)
</code></pre>
<hr/>
<h3 data-id="heading-5">方案 3：覆盖索引优化</h3>
<p>如果列表页只需要展示索引中的字段（如只显示订单号和金额），根本不需要回表。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 假设索引为 idx_created_at_id(created_at, id, order_no, amount)</span>
<span class="hljs-keyword">SELECT</span> id, order_no, amount <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span> 
LIMIT <span class="hljs-number">1000000</span>, <span class="hljs-number">20</span>;
</code></pre>
<p><strong>性能：</strong> 扫描 1000020 行，但全部在内存中完成，无需回表，速度提升 10-100 倍。</p>
<hr/>
<h3 data-id="heading-6">方案 4：业务层限制（最实用）</h3>
<p>绝大多数业务场景中，用户极少翻到 100 页以后。</p>
<p><strong>策略：</strong></p>
<ol>
<li><strong>限制最大页码</strong>：只允许查看前 100 页（Google 搜索也是如此）
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> page &gt; <span class="hljs-number">100</span>:
    <span class="hljs-keyword">raise</span> ValidationError(<span class="hljs-string">"只能查看前 100 页，请使用筛选条件缩小范围"</span>)
</code></pre>
</li>
<li><strong>提供筛选条件</strong>：让用户通过时间范围、状态等条件过滤，而非翻页</li>
</ol>
<hr/>
<h3 data-id="heading-7">方案 5：数据归档（终极方案）</h3>
<p>对于超大数据量（如日志、历史订单）：</p>
<ul>
<li><strong>冷热分离</strong>：热数据（近 3 个月）在 MySQL，冷数据归档到 <strong>ClickHouse</strong> 或 <strong>Elasticsearch</strong></li>
<li><strong>分表</strong>：按时间分表，查询时路由到对应表</li>
</ul>
<hr/>
<h2 data-id="heading-8">四、性能测试数据对比</h2>
<p>假设表 <code>orders</code> 有 1000 万条数据：</p>



































<table><thead><tr><th>页码</th><th>传统 LIMIT</th><th>延迟关联</th><th>游标分页</th></tr></thead><tbody><tr><td>第 1 页</td><td>10ms</td><td>10ms</td><td>1ms</td></tr><tr><td>第 1000 页</td><td>50ms</td><td>30ms</td><td>1ms</td></tr><tr><td>第 10000 页</td><td>500ms</td><td>200ms</td><td>1ms</td></tr><tr><td>第 100000 页</td><td>5s+</td><td>2s</td><td>1ms</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">五、Django 完整示例：游标分页封装</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> JsonResponse
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CursorPaginator</span>:
    <span class="hljs-string">"""游标分页装饰器"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, ordering=<span class="hljs-string">'-id'</span>, page_size=<span class="hljs-number">20</span></span>):
        self.ordering = ordering
        self.page_size = page_size
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, view_func</span>):
<span class="hljs-meta">        @wraps(<span class="hljs-params">view_func</span>)</span>
        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">request, *args, **kwargs</span>):
            <span class="hljs-comment"># 获取游标（上一页最后一条记录的排序字段值）</span>
            cursor = request.GET.get(<span class="hljs-string">'cursor'</span>)
            
            <span class="hljs-comment"># 获取基础 QuerySet（由 view_func 提供）</span>
            queryset = view_func(request, *args, **kwargs)
            
            <span class="hljs-comment"># 应用排序</span>
            <span class="hljs-keyword">if</span> self.ordering.startswith(<span class="hljs-string">'-'</span>):
                field = self.ordering[<span class="hljs-number">1</span>:]
                order_by = <span class="hljs-string">'-'</span> + field
                filter_cond = {<span class="hljs-string">f'<span class="hljs-subst">{field}</span>__lt'</span>: cursor} <span class="hljs-keyword">if</span> cursor <span class="hljs-keyword">else</span> {}
            <span class="hljs-keyword">else</span>:
                order_by = self.ordering
                filter_cond = {<span class="hljs-string">f'<span class="hljs-subst">{self.ordering}</span>__gt'</span>: cursor} <span class="hljs-keyword">if</span> cursor <span class="hljs-keyword">else</span> {}
            
            queryset = queryset.order_by(order_by)
            <span class="hljs-keyword">if</span> cursor:
                queryset = queryset.<span class="hljs-built_in">filter</span>(**filter_cond)
            
            <span class="hljs-comment"># 多查一条判断是否有下一页</span>
            items = <span class="hljs-built_in">list</span>(queryset[:self.page_size + <span class="hljs-number">1</span>])
            has_next = <span class="hljs-built_in">len</span>(items) &gt; self.page_size
            items = items[:self.page_size]
            
            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'items'</span>: items,
                <span class="hljs-string">'next_cursor'</span>: <span class="hljs-built_in">getattr</span>(items[-<span class="hljs-number">1</span>], field <span class="hljs-keyword">if</span> self.ordering.startswith(<span class="hljs-string">'-'</span>) <span class="hljs-keyword">else</span> self.ordering) <span class="hljs-keyword">if</span> items <span class="hljs-keyword">and</span> has_next <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
                <span class="hljs-string">'has_next'</span>: has_next,
                <span class="hljs-string">'has_prev'</span>: <span class="hljs-built_in">bool</span>(cursor)
            }
        <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-meta">@CursorPaginator(<span class="hljs-params">ordering=<span class="hljs-string">'-created_at'</span>, page_size=<span class="hljs-number">20</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_orders</span>(<span class="hljs-params">request</span>):
    <span class="hljs-keyword">return</span> Order.objects.<span class="hljs-built_in">filter</span>(status=request.GET.get(<span class="hljs-string">'status'</span>, <span class="hljs-string">'paid'</span>))
</code></pre>
<hr/>
<h2 data-id="heading-10">六、总结建议</h2>
<ol>
<li><strong>首选项</strong>：<strong>游标分页</strong>（无限滚动场景），性能最优，实现简单</li>
<li><strong>次选项</strong>：如果必须支持跳页，使用<strong>延迟关联</strong> + <strong>限制最大页码</strong>（如最多 100 页）</li>
<li><strong>架构层面</strong>：大数据量列表考虑引入 <strong>Elasticsearch</strong> 或 <strong>ClickHouse</strong>，MySQL 专注事务处理</li>
<li><strong>索引检查</strong>：确保 <code>ORDER BY</code> 字段有索引，最好是覆盖索引</li>
</ol>
<p>对于 Django 项目，推荐使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fphotocrowd%2Fdjango-cursor-pagination" target="_blank" title="https://github.com/photocrowd/django-cursor-pagination" ref="nofollow noopener noreferrer"><code>django-cursor-pagination</code></a> 库，它封装了游标分页的复杂逻辑（处理多字段排序、边界情况等）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀实测Clawdbot彻底改变我的工作方式！一条命令部署，WhatsApp远程控制电脑，自动编程开发，2026年最强个人AI员工来了！自我进化+无限记忆+浏览]]></title>    <link>https://juejin.cn/post/7599835610406830126</link>    <guid>https://juejin.cn/post/7599835610406830126</guid>    <pubDate>2026-01-27T14:54:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599835610406830126" data-draft-id="7599852042530177034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀实测Clawdbot彻底改变我的工作方式！一条命令部署，WhatsApp远程控制电脑，自动编程开发，2026年最强个人AI员工来了！自我进化+无限记忆+浏览"/> <meta itemprop="keywords" content="AIGC,OpenAI,Claude"/> <meta itemprop="datePublished" content="2026-01-27T14:54:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="win4r"/> <meta itemprop="url" content="https://juejin.cn/user/1739869037541555"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀实测Clawdbot彻底改变我的工作方式！一条命令部署，WhatsApp远程控制电脑，自动编程开发，2026年最强个人AI员工来了！自我进化+无限记忆+浏览
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1739869037541555/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    win4r
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:54:38.000Z" title="Tue Jan 27 2026 14:54:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Clawdbot 最初是为 <strong>Clawd</strong> 而构建的——一个虚构的太空龙虾 AI 助手角色。项目名称中的 "Clawd" 融合了 "Claude"（Anthropic 的 AI）和 "Claw"（龙虾的钳子），体现了其独特的品牌风格。</p>
<p>🔥🔥🔥本篇笔记所对应的视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV14z6GB1EAr%2F" target="_blank" title="https://www.bilibili.com/video/BV14z6GB1EAr/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV14z…</a></p>
<h4 data-id="heading-0">🔥使用命令</h4>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 安装</span>
curl -fsSL &lt;https://clawd.bot/install.sh&gt; | bash 

<span class="hljs-comment"># 启动</span>
clawdbot gateway

<span class="hljs-comment"># 停止</span>
clawdbot gateway stop 

<span class="hljs-comment"># 使用whatsapp登陆</span>
clawdbot channels login --channel whatsapp

<span class="hljs-comment"># 检查WhatsApp是否连通</span>
curl -I &lt;https://web.whatsapp.com/&gt;

<span class="hljs-comment"># 选择模型</span>
clawdbot configure --section model  

<span class="hljs-comment"># 1) 设置 MiniMax Anthropic-compatible Base URL（官方推荐）</span>
clawdbot config <span class="hljs-built_in">set</span> models.providers.minimax.baseUrl <span class="hljs-string">"&lt;https://api.minimaxi.com/anthropic&gt;"</span>

clawdbot config <span class="hljs-built_in">set</span> models.providers.minimax.baseUrl <span class="hljs-string">"&lt;https://api.minimax.io/anthropic&gt;"</span>

<span class="hljs-comment"># 2) 设置 MiniMax API Key（对应 MINIMAX_API_KEY）</span>
clawdbot config <span class="hljs-built_in">set</span> models.providers.minimax.apiKey <span class="hljs-string">"你的MINIMAX_API_KEY"</span>

<span class="hljs-comment"># 3)（建议）明确走 Anthropic Messages 兼容协议</span>
clawdbot config <span class="hljs-built_in">set</span> models.providers.minimax.api <span class="hljs-string">"anthropic-messages"</span>
</code></pre>
<hr/>
<h4 data-id="heading-1">🔥用命令创建“每天 9 点”的 Cron Job</h4>
<pre><code class="hljs language-sql" lang="sql">clawdbot cron <span class="hljs-keyword">add</span> \
  <span class="hljs-comment">--name "Daily 9am AI Briefing" \</span>
  <span class="hljs-comment">--cron "0 9 * * *" \</span>
  <span class="hljs-comment">--tz "America/Denver" \</span>
  <span class="hljs-comment">--session isolated \</span>
  <span class="hljs-comment">--message "Create a Chinese AI briefing for the last 24 hours (AI/LLM/Agents/Coding tools). Steps: (1) Browse and collect 8–12 notable updates from English sources; (2) For each item include: what happened, why it matters, and the original source link; (3) Rank by \"heat\" (signals: multiple sources, official announcements, GitHub stars/issues, wide discussion); (4) Output: Top 5 (detailed) + Next 5 (one-liners) + 3 follow-up angles for a YouTube video. Keep it concise and skimmable, with bullet points and links." \</span>
  <span class="hljs-comment">--deliver \</span>
  <span class="hljs-comment">--channel last</span>
  
  # 立刻手动跑一次验证
 clawdbot cron run <span class="hljs-number">375e68</span>be<span class="hljs-number">-006</span>d<span class="hljs-number">-46</span>a9<span class="hljs-number">-8129</span><span class="hljs-number">-275</span>defa1b4ba <span class="hljs-comment">--force</span>
</code></pre>
<h4 data-id="heading-2">🔥blogwatcher使用方式</h4>
<pre><code class="hljs language-sql" lang="sql"># 添加订阅源（只需执行一次）
blogwatcher <span class="hljs-keyword">add</span> "GH: Claude Code releases" <span class="hljs-operator">&lt;</span>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>github.com<span class="hljs-operator">/</span>anthropics<span class="hljs-operator">/</span>claude<span class="hljs-operator">-</span>code<span class="hljs-operator">/</span>releases.atom<span class="hljs-operator">&gt;</span>
blogwatcher <span class="hljs-keyword">add</span> "GH: Clawdbot releases" <span class="hljs-operator">&lt;</span>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>github.com<span class="hljs-operator">/</span>clawdbot<span class="hljs-operator">/</span>clawdbot<span class="hljs-operator">/</span>releases.atom<span class="hljs-operator">&gt;</span>
blogwatcher <span class="hljs-keyword">add</span> "AI: aivi.fyi" <span class="hljs-operator">&lt;</span>https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>www.aivi.fyi<span class="hljs-operator">/</span>feed<span class="hljs-operator">&gt;</span>

# 扫描并查看新增
blogwatcher scan
blogwatcher articles

# 创建每天 <span class="hljs-number">9</span> 点推送到 WhatsApp 的 Cron
clawdbot cron <span class="hljs-keyword">add</span> \
  <span class="hljs-comment">--name "Daily 9am AI Briefing (blogwatcher -&gt; WhatsApp)" \</span>
  <span class="hljs-comment">--cron "0 9 * * *" \</span>
  <span class="hljs-comment">--tz "America/Denver" \</span>
  <span class="hljs-comment">--session isolated \</span>
  <span class="hljs-comment">--message "Use the blogwatcher tool to: (1) scan feeds; (2) list unread/new articles; (3) keep only AI/LLM/Agents/Coding tools related; (4) for each item output ONE Chinese sentence + the original link; (5) rank by heat (official announcements, GitHub momentum, wide discussion). Output: Top 5 (detailed) + Next 5 (one-liners) + 3 YouTube angles. Then mark summarized items as read using blogwatcher read-all. Keep total under 1200 Chinese characters; bullet points only; no preamble." \</span>
  <span class="hljs-comment">--deliver \</span>
  <span class="hljs-comment">--channel whatsapp \</span>
  <span class="hljs-comment">--to "+18186751473"</span>

# 运行后会输出一个 JSON，其中有 "id": "..."（记下这个 id）
# 立刻强制跑一次测试（把 <span class="hljs-operator">&lt;</span>ID<span class="hljs-operator">&gt;</span> 替换成上一步输出的 id）
clawdbot cron run <span class="hljs-operator">&lt;</span>ID<span class="hljs-operator">&gt;</span> <span class="hljs-comment">--force</span>

# 查看最近运行记录
clawdbot cron runs <span class="hljs-comment">--id &lt;ID&gt; --limit 10</span>
</code></pre>
<h3 data-id="heading-3">一、项目概览</h3>
<h4 data-id="heading-4">基本信息</h4>
<pre><code class="hljs language-less" lang="less">项目属性详情名称<span class="hljs-selector-tag">Clawdbot</span>（龙虾机器人 🦞）定位本地优先的个人 <span class="hljs-selector-tag">AI</span> 助手创建者<span class="hljs-selector-tag">Peter</span> <span class="hljs-selector-tag">Steinberger</span> (<span class="hljs-variable">@steipete</span>)开源协议<span class="hljs-selector-tag">MIT</span> <span class="hljs-selector-tag">LicenseGitHub</span> <span class="hljs-selector-tag">Stars38</span>,<span class="hljs-number">900</span>+ ⭐<span class="hljs-selector-tag">Forks4</span>,<span class="hljs-number">500</span>+贡献者<span class="hljs-number">290</span>+最新版本<span class="hljs-number">2026.1</span><span class="hljs-selector-class">.24</span>技术栈<span class="hljs-selector-tag">TypeScript</span> (<span class="hljs-number">79.8%</span>) + <span class="hljs-selector-tag">Node</span><span class="hljs-selector-class">.js</span> ≥<span class="hljs-number">22</span>官网<span class="hljs-selector-tag">clawd</span><span class="hljs-selector-class">.bot</span>文档<span class="hljs-selector-tag">docs</span><span class="hljs-selector-class">.clawd</span><span class="hljs-selector-class">.bot</span>
</code></pre>
<h4 data-id="heading-5">项目起源</h4>
<p>Clawdbot 最初是为 <strong>Clawd</strong> 而构建的——一个虚构的太空龙虾 AI 助手角色。项目名称中的 "Clawd" 融合了 "Claude"（Anthropic 的 AI）和 "Claw"（龙虾的钳子），体现了其独特的品牌风格。</p>
<h4 data-id="heading-6">核心理念</h4>
<p>在当前的 AI 生态中，大多数用户习惯于使用 OpenAI 或 Anthropic 提供的 SaaS 平台。这种模式虽然便捷，但存在三个核心痛点：</p>
<ol>
<li><strong>隐私数据泄露风险</strong>：对话数据存储在第三方服务器</li>
<li><strong>功能被动性</strong>：AI 无法主动联系用户</li>
<li><strong>沙箱限制</strong>：AI 无法直接操作本地文件系统或执行复杂的系统任务</li>
</ol>
<p>Clawdbot 的出现正是为了解决这些痛点。它将 AI 从一个"咨询工具"转变为一个真正的"数字雇员"或"远程实习生"，能够 24/7 全天候监控邮件、管理日历并在特定事件发生时主动发起沟通。</p>
<hr/>
<h3 data-id="heading-7">二、系统架构</h3>
<h4 data-id="heading-8">四层架构设计</h4>
<h4 data-id="heading-9">核心组件详解</h4>
<h4 data-id="heading-10">1. Gateway（网关）：系统的神经中枢</h4>
<p>Gateway 是 Clawdbot 的控制核心，通常作为一个后台服务运行，默认通过 WebSocket 协议在 <code>ws://127.0.0.1:18789</code> 上暴露控制平面。</p>
<p><strong>主要职责</strong>：</p>
<ul>
<li>消息路由：接收来自各渠道的消息并分发</li>
<li>会话管理：维护用户会话状态和上下文</li>
<li>工具调用：协调 AI 与各种工具的交互</li>
<li>调度任务：cron 定时任务和 webhook 处理</li>
</ul>
<p><strong>技术规格</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">组件类型关键技术规格功能描述运行时环境Node<span class="hljs-selector-class">.js</span> ≥<span class="hljs-number">22</span>提供原生 ESM 支持与高效的异步 <span class="hljs-selector-tag">I</span>/O 处理开发语言TypeScript (<span class="hljs-number">79.8%</span>)确保核心逻辑的类型安全与代码稳健性通信协议WebSocket (WS) / HTTP实现网关、客户端与工具之间的实时双向数据流内存需求<span class="hljs-number">2</span>GB - <span class="hljs-number">4</span>GB基础对话需 <span class="hljs-number">2</span>GB；浏览器自动化等复杂任务建议 <span class="hljs-number">4</span>GB 以上网络安全Tailscale / SSH通过加密隧道实现安全的远程访问，无需公网 IP
</code></pre>
<h4 data-id="heading-11">2. Nodes（节点）：跨硬件的资源接口</h4>
<p>节点系统是 Clawdbot 实现"物理存在感"的关键。节点是运行在特定硬件上的进程，为网关提供对本地资源的访问权限。</p>
<p><strong>支持的节点类型</strong>：</p>
<ul>
<li><strong>macOS 节点</strong>：系统命令执行 (<code>system.run</code>)、通知 (<code>system.notify</code>)、Canvas 展示</li>
<li><strong>iOS 节点</strong>：Canvas、Voice Wake、Talk Mode、摄像头、屏幕录制</li>
<li><strong>Android 节点</strong>：Canvas、Chat、摄像头、屏幕录制、可选 SMS</li>
</ul>
<p><strong>分布式灵活性</strong>： 用户可以在高性能的 Linux VPS 上运行主网关以保证 24/7 在线，同时将一台本地 Mac Mini 或 iOS 设备作为"边缘节点"连接到网关。当网关需要执行与硬件相关的任务（如"截取屏幕并分析内容"）时，它会通过节点调用相关 API，而计算工作（LLM 推理）则交由云端或专用服务器处理。</p>
<h4 data-id="heading-12">3. Channels（渠道）：通讯协议的桥接器</h4>
<p>Clawdbot 并不强迫用户使用特定的客户端，而是通过"渠道后端"将 AI 注入到用户已有的通讯工具中。</p>
<p><strong>支持的渠道</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">渠道分类支持平台技术实现说明主流通讯WhatsApp, Telegram, Discord, Slack通过 Baileys (WA), grammY (TG) 等库实现集成隐私通讯Signal, Matrix强调加密安全，通常需要信号命令行工具 (signal-cli)系统原生iMessage, BlueBubbles利用 macOS 节点的本地访问权限实现消息转发企业办公Microsoft Teams, Mattermost支持文件上传、自适应卡片等复杂交互网页/终端WebChat, TUI (Terminal UI)提供本地调试与可视化的仪表盘界面
</code></pre>
<h4 data-id="heading-13">4. Skills（技能）：可扩展的能力模块</h4>
<p>Clawdbot 的能力不是固定的，而是通过一个开放的插件系统——"技能（Skills）"进行扩展。</p>
<p><strong><a href="https://link.juejin.cn?target=http%3A%2F%2FSKILL.md" target="_blank" title="http://SKILL.md" ref="nofollow noopener noreferrer">SKILL.md</a> 规范</strong>： 每个技能都是一个包含元数据的 Markdown 文件，定义了技能的加载门槛、二进制工具依赖和环境变量要求。</p>
<p><strong>技能优先级</strong>：</p>
<ol>
<li><strong>工作区技能 (Workspace Skills)</strong> ：位于 <code>&lt;workspace&gt;/skills/</code>，拥有最高优先级</li>
<li><strong>本地技能 (Local Skills)</strong> ：位于 <code>~/.clawdbot/skills/</code>，供个人在多项目间共享</li>
<li><strong>内置技能 (Bundled Skills)</strong> ：随安装包附带的基础能力</li>
</ol>
<p><strong>ClawdHub 技能市场</strong>： <a href="https://link.juejin.cn?target=https%3A%2F%2Fclawdhub.com%2F" target="_blank" title="https://clawdhub.com/" ref="nofollow noopener noreferrer">clawdhub.com</a> 是官方建立的公共技能注册表，用户可以使用命令行工具 <code>clawdhub install</code> 快速扩充 AI 的功能库。ClawdHub 还集成了向量搜索，让 AI 能够根据用户的自然语言需求自动查找并推荐合适的技能。</p>
<hr/>
<h3 data-id="heading-14">三、Lobster 工作流运行时</h3>
<p>在处理复杂的、多步骤的自动化任务时，传统的"单次 prompt"模式往往因幻觉或指令丢失而失败。为了解决这一问题，Clawdbot 引入了名为 <strong>"Lobster"</strong> 的类型化工作流运行时。</p>
<h4 data-id="heading-15">核心思想</h4>
<p>Lobster 的核心思想是将原本不可预测的 AI 行为转化为可审计、确定性的管道（Pipelines）。这些管道使用 JSON 或 YAML 定义，每个步骤都交换结构化数据而非自由文本。</p>
<h4 data-id="heading-16">高级特性</h4>
<ol>
<li><strong>审批门控 (Approval Gates)</strong> ：对于涉及文件删除或资金支出的高风险步骤，工作流会自动暂停并向用户发送确认请求</li>
<li><strong>状态持久化 (State Persistence)</strong> ：工作流可以保存中间状态，并在遇到超时或重启后通过恢复令牌（Resume Token）继续运行</li>
<li><strong>异常隔离</strong>：运行在沙箱化环境中的工作流受到严格的资源限制，防止脚本错误导致主机崩溃</li>
</ol>
<hr/>
<h3 data-id="heading-17">四、安全与隐私架构</h3>
<p>将拥有 Shell 权限的 AI 代理暴露在公网通讯工具中，其安全性是用户必须面对的首要课题。Clawdbot 采用了一套四层防御策略，试图在功能与安全之间达成平衡。</p>
<h4 data-id="heading-18">第一层：DM 配对与准入控制</h4>
<p>Clawdbot 默认开启 <code>dmPolicy="pairing"</code>（配对模式）。任何未经授权的联系人向机器人发送消息时，机器人不会执行任何指令，而是生成一个唯一的配对码。只有管理员在 CLI 端输入 <code>clawdbot pairing approve</code> 后，该用户才会被加入本地白名单。</p>
<h4 data-id="heading-19">第二层：沙箱化执行与资源受限</h4>
<p>对于不受信任的输入源（如公开群组或外部 Webhook），Clawdbot 提供了 Docker 沙箱模式。在这种模式下，AI 的所有命令（如 <code>system.run</code>）都在独立的容器内运行，无法触及主机的敏感文件或私钥。</p>
<h4 data-id="heading-20">第三层：认知防御与输入净化</h4>
<p>针对"提示词注入（Prompt Injection）"攻击，Clawdbot 建议使用推理能力更强的模型（如 Anthropic Opus 4.5），并正在集成高级认知防御逻辑。这包括"先决定再开口"的两步评估法，在模型执行任何工具之前，先独立评估该指令是否偏离了设定的安全边界。</p>
<h4 data-id="heading-21">第四层：网络隔离与防火墙</h4>
<p>Clawdbot 的安全架构推荐仅开放 SSH 端口。Web 界面和 WebSocket 网关通常绑定在 <code>localhost</code>，用户需通过 Tailscale 隧道或 SSH 端口转发进行访问。这种网络层面的隐身保护了系统免受大规模扫描器和暴力破解的攻击。</p>
<hr/>
<h3 data-id="heading-22">五、安装与配置</h3>
<h4 data-id="heading-23">系统要求</h4>
<pre><code class="hljs language-scss" lang="scss">项目要求Node<span class="hljs-selector-class">.js</span>≥ <span class="hljs-number">22</span>操作系统macOS / Linux / Windows (WSL2)内存建议 <span class="hljs-number">2</span>GB+，浏览器自动化建议 <span class="hljs-number">4</span>GB+
</code></pre>
<h4 data-id="heading-24">快速安装</h4>
<p>bash</p>
<p>`# 一键安装脚本（推荐） curl -fsSL <a href="https://link.juejin.cn?target=https%3A%2F%2Fclawd.bot%2Finstall.sh" target="_blank" title="https://clawd.bot/install.sh" ref="nofollow noopener noreferrer">clawd.bot/install.sh</a> | bash</p>
<h2 data-id="heading-25">或通过包管理器</h2>
<p>npm install -g clawdbot@latest pnpm add -g clawdbot@latest`</p>
<h4 data-id="heading-26">配置向导</h4>
<p>bash</p>
<p><code>clawdbot onboard --install-daemon</code></p>
<p>向导将引导完成：</p>
<ol>
<li>Gateway 模式选择（本地/远程）</li>
<li>AI 模型认证（OAuth 或 API Key）</li>
<li>渠道连接（WhatsApp QR 扫码、Telegram Bot Token 等）</li>
<li>技能安装</li>
<li>后台服务配置</li>
</ol>
<h4 data-id="heading-27">关键配置文件</h4>
<pre><code class="hljs language-javascript" lang="javascript">文件路径用途~<span class="hljs-regexp">/.clawdbot/</span>clawdbot.<span class="hljs-property">json</span>主配置文件~<span class="hljs-regexp">/.clawdbot/</span>credentials/<span class="hljs-title class_">OAuth</span> 凭证存储~<span class="hljs-regexp">/clawd/</span>默认工作空间~<span class="hljs-regexp">/clawd/</span>skills/工作区技能目录/tmp/clawdbot/日志文件目录
</code></pre>
<h4 data-id="heading-28">模型配置注意事项</h4>
<p>⚠️ <strong>重要</strong>：如果使用 <strong>OpenAI OAuth 登录</strong>（而非 API Key），模型名称必须使用 <code>openai-codex/</code> 前缀：</p>
<p>json</p>
<p><code>{ "agents": { "defaults": { "model": { "primary": "openai-codex/gpt-5.2", // 注意前缀 "fallbacks": [] } } } }</code></p>
<hr/>
<h3 data-id="heading-29">六、核心功能详解</h3>
<h4 data-id="heading-30">1. 多渠道统一收件箱</h4>
<p>在任何你习惯使用的聊天应用中与 AI 助手交流，支持：</p>
<ul>
<li>私聊（DM）</li>
<li>群聊（需 @提及或配置 always 激活模式）</li>
<li>跨渠道消息同步</li>
</ul>
<h4 data-id="heading-31">2. 浏览器自动化</h4>
<p>Clawdbot 可以控制专用的 Chrome/Chromium 浏览器（clawd-browser），实现：</p>
<ul>
<li>网页导航与表单填写</li>
<li>数据提取与截图</li>
<li>登录验证与 Cookie 管理</li>
<li>无需 API 的网站自动化</li>
</ul>
<h4 data-id="heading-32">3. 系统级访问</h4>
<ul>
<li><strong>文件操作</strong>：读取、写入、编辑文件</li>
<li><strong>命令执行</strong>：运行 shell 命令和脚本</li>
<li><strong>进程管理</strong>：启动、监控、终止进程</li>
<li><strong>沙箱模式</strong>：可选的 Docker 隔离环境</li>
</ul>
<h4 data-id="heading-33">4. 语音交互</h4>
<ul>
<li><strong>Voice Wake</strong>：语音唤醒（macOS/iOS/Android）</li>
<li><strong>Talk Mode</strong>：持续对话模式</li>
<li><strong>TTS</strong>：ElevenLabs 语音合成集成</li>
<li><strong>语音转录</strong>：Whisper 等模型支持</li>
</ul>
<h4 data-id="heading-34">5. Canvas 可视化</h4>
<p>A2UI（Agent-to-UI）系统允许 AI 动态生成和更新可视化界面，用于：</p>
<ul>
<li>数据展示</li>
<li>交互式图表</li>
<li>实时状态监控</li>
</ul>
<h4 data-id="heading-35">6. 定时任务与自动化</h4>
<ul>
<li><strong>Cron 任务</strong>：定时执行预设任务</li>
<li><strong>Webhook</strong>：响应外部事件触发</li>
<li><strong>Gmail Pub/Sub</strong>：邮件触发自动化</li>
</ul>
<h4 data-id="heading-36">7. 多 Agent 协作</h4>
<ul>
<li><strong>会话隔离</strong>：不同渠道/用户可路由到独立 Agent</li>
<li><strong>Agent 间通信</strong>：<code>sessions_send</code> 工具实现跨 Agent 协作</li>
<li><strong>工作空间隔离</strong>：每个 Agent 可有独立的工作目录和配置</li>
</ul>
<hr/>
<h3 data-id="heading-37">七、实际使用场景</h3>
<h4 data-id="heading-38">场景一：主动式日程与信息聚合</h4>
<p>通过配置 <code>cron</code> 任务，用户可以将 Clawdbot 变成专属的信息汇总员：</p>
<ul>
<li><strong>晨间简报</strong>：每天早上 8 点，AI 自动检查 Google Calendar、查询今日天气及关键股票动态，通过 WhatsApp 发送一份整理好的语音或文字简报</li>
<li><strong>健康监控</strong>：AI 持续读取可穿戴设备的导出数据，并在发现异常模式（如连续三日睡眠不足）时主动询问用户状况</li>
</ul>
<h4 data-id="heading-39">场景二：深度研究与采购决策</h4>
<p>得益于强大的浏览器自动化技能，Clawdbot 能够执行耗时较长的研究任务：</p>
<ul>
<li><strong>汽车交易谈判</strong>：AI 通过浏览器搜索特定车型，自动与多个经销商通过邮件和在线表单联系，对比报价、进行初步议价，并最终为用户节省了约 4,200 美元</li>
<li><strong>学术综述</strong>：利用学术搜索 API 和长文本模型，AI 可以跨平台搜集文献，整理成结构化的对比表格，并存储在本地知识库中</li>
</ul>
<h4 data-id="heading-40">场景三：开发运维与代码自治</h4>
<p>Clawdbot 是开发者的得力助手，它填补了 IDE 和生产环境之间的空白：</p>
<ul>
<li><strong>漏洞自动修复</strong>：AI 可以配置为监控服务器日志，当检测到特定的崩溃或错误时，自动克隆相关代码仓库、复现问题、生成修复代码、运行测试套件，最后提交合并请求</li>
<li><strong>基础设施管理</strong>：通过集成 Hetzner 或 AWS 的 API，用户可以直接通过 Telegram 发送"为当前项目增加一台 2GB RAM 的服务器"等指令，AI 会自动处理资源预备工作</li>
</ul>
<h4 data-id="heading-41">场景四：家庭生活管理</h4>
<p>在家庭环境中，Clawdbot 充当了数字化纽带的角色：</p>
<ul>
<li><strong>共享购物清单</strong>：家庭成员可以随时向 WhatsApp 机器人发送"添加牛奶到清单"，AI 会维护一个跨平台的、持久化的 Markdown 列表，并在有人进入超市区域时（利用位置节点）发出提醒</li>
<li><strong>餐食规划</strong>：结合天气预报（决定是否户外烧烤）和家庭食谱库，AI 每周自动生成购物清单并按超市走道进行分类排序</li>
</ul>
<hr/>
<h3 data-id="heading-42">八、进阶技巧</h3>
<h4 data-id="heading-43">持久化记忆管理</h4>
<p>Clawdbot 所有的会话历史和长期记忆都以简单的 Markdown 文件形式存储在磁盘上。用户可以将这个工作区（Workspace）变成一个私有的 Git 仓库。通过这种方式，AI 的所有"学习"过程都是透明且可回溯的：如果 AI 产生了错误的偏好或错误地记录了信息，用户只需执行 <code>git revert</code> 即可将其记忆恢复到先前的状态。</p>
<h4 data-id="heading-44">权限细粒度分配</h4>
<p>在"家庭模式"或多用户环境下，网关支持为不同的联系人分配不同的权限等级。例如，管理员可以拥有全系统的 <code>sudo</code> 权限，而普通家庭成员可能仅被授权使用 <code>shopping-list</code> 或 <code>weather</code> 技能。这种基于角色的访问控制（RBAC）是企业级部署的基础。</p>
<h4 data-id="heading-45">语音唤醒与 Talk 模式</h4>
<p>配合 macOS 应用，Clawdbot 支持"语音唤醒（Voice Wake）"和"持续对话模式（Talk Mode）"。这意味着用户可以在家中直接对空喊话，触发 AI 进行系统操作，实现类似于《钢铁侠》中 J.A.R.V.I.S. 的交互体验。</p>
<hr/>
<h3 data-id="heading-46">九、与其他 AI 助手的对比</h3>
<pre><code class="hljs">特性ClawdbotChatGPT/Claude WebApple Intelligence数据存储位置本地云端本地+云端系统级权限✅ 完整❌ 沙箱⚠️ 有限主动通知能力✅❌⚠️ 有限自定义技能✅ 开放生态❌❌多渠道支持✅ 10+ 渠道❌ 仅官方 App❌ 仅系统内浏览器自动化✅❌❌开源✅ MIT❌❌价格免费（需自付 API）订阅制设备内置
</code></pre>
<hr/>
<h3 data-id="heading-47">十、总结：迈向工业 6.0 与去中心化智能</h3>
<p>Clawdbot 不仅仅是一个开源项目，它预示着一种被称为"工业 6.0"的愿景——即 AI 模型能够自主链接工具、创造新想法并解决复杂问题，而人类的角色则从"执行者"转变为"监督者"。</p>
<p>通过将控制权交还给用户，Clawdbot 挑战了大型科技公司对 AI 基础设施的垄断。随着硬件性能的提升（如 M4 芯片或 AI PC 的普及）和模型效率的优化，本地运行强大 AI 助理的门槛正在迅速降低。</p>
<p>Clawdbot 以其本地优先、隐私至上、主动交互的特质，正在成为个人自动化领域的新标准。对于追求极致效率、重视数据所有权的开发者和极客而言，Clawdbot 不仅是一个工具，更是构建个人未来数字生活的核心基石。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[type-challenges（ts类型体操）: 2 - 获取函数返回类型]]></title>    <link>https://juejin.cn/post/7599920572840378377</link>    <guid>https://juejin.cn/post/7599920572840378377</guid>    <pubDate>2026-01-27T14:58:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599920572840378377" data-draft-id="7599708108622446643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="type-challenges（ts类型体操）: 2 - 获取函数返回类型"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-27T14:58:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fxss"/> <meta itemprop="url" content="https://juejin.cn/user/3702810892856808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            type-challenges（ts类型体操）: 2 - 获取函数返回类型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810892856808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fxss
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T14:58:54.000Z" title="Tue Jan 27 2026 14:58:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2 - 获取函数返回类型</h2>
<p>by Anthony Fu (@antfu) #中等 #infer #built-in</p>
<h2 data-id="heading-1">题目</h2>
<p>不使用 <code>ReturnType</code> 实现 TypeScript 的 <code>ReturnType&lt;T&gt;</code> 泛型。</p>
<p>例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span> = (<span class="hljs-params">v: <span class="hljs-built_in">boolean</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (v)
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>
}

<span class="hljs-keyword">type</span> a = <span class="hljs-title class_">MyReturnType</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt; <span class="hljs-comment">// 应推导出 "1 | 2"</span>
</code></pre>
<blockquote>
<p>在 Github 上查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F2%2Fzh-CN" target="_blank" title="https://tsch.js.org/2/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/2/zh-CN</a></p>
</blockquote>
<h2 data-id="heading-2">代码</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 你的代码 _____________ */</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">MyReturnType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">never</span>

</code></pre>
<p>关键解释：</p>
<ul>
<li><code>T</code>：泛型参数，代表任意函数类型；</li>
<li><code>(...args: any[]) =&gt; infer R</code>：函数类型的模式匹配，用于提取函数的返回类型 <code>R</code>；</li>
<li><code>infer R</code>：类型推断，用于在条件类型中提取符合条件的类型；</li>
<li><code>never</code>：表示永远不会出现的类型，用于处理不满足条件的情况。</li>
</ul>
<h2 data-id="heading-3">相关知识点</h2>
<h3 data-id="heading-4"><code>extends</code></h3>




















<table><thead><tr><th>使用维度</th><th>核心作用</th><th>示例场景</th></tr></thead><tbody><tr><td>类型维度</td><td>做类型约束或条件判断（类型编程核心）</td><td>限定泛型范围、判断类型是否兼容、提取类型片段</td></tr><tr><td>语法维度</td><td>做继承（复用已有结构）</td><td>接口继承、类继承</td></tr></tbody></table>
<h4 data-id="heading-5"><code>extends</code> 做类型约束或条件判断</h4>
<ol>
<li>泛型约束：限定泛型的取值范围</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 约束 T 必须是「拥有 length 属性」的类型（比如 string/数组）</span>
<span class="hljs-keyword">function</span> getLength&lt;T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-attr">arg</span>: T): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> arg.<span class="hljs-property">length</span>;
}

<span class="hljs-comment">// 合法调用（符合约束）</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// ✅ string 有 length，返回 5</span>
<span class="hljs-title function_">getLength</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// ✅ 数组有 length，返回 3</span>

<span class="hljs-comment">// 非法调用（超出约束）</span>
<span class="hljs-title function_">getLength</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// ❌ 报错：number 没有 length 属性</span>
</code></pre>
<ol start="2">
<li>条件类型：类型版 <strong>三元运算符</strong></li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础示例：判断类型是否为字符串</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-string">"test"</span>&gt;; <span class="hljs-comment">// true（符合）</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-number">123</span>&gt;; <span class="hljs-comment">// false（不符合）</span>
</code></pre>
<p>分布式条件类型（联合类型专用）: 当 <code>T</code> 是联合类型时，<code>extends</code> 会自动拆分联合类型的每个成员，逐个判断后再合并结果。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Union</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>;

<span class="hljs-comment">// 拆分逻辑：string→string，number→never，boolean→never → 合并为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OnlyString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">OnlyString</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// Result = string</span>
</code></pre>
<p>注意：只有泛型参数是 裸类型（没有被 []/{} 包裹）时，才会触发分布式判断：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 包裹后不触发分布式，整体判断 [string|number] 是否兼容 [string]</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NoDist</span>&lt;T&gt; = [T] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">string</span>] ? T : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result2</span> = <span class="hljs-title class_">NoDist</span>&lt;<span class="hljs-title class_">Union</span>&gt;; <span class="hljs-comment">// never（整体不兼容）</span>
</code></pre>
<ol start="3">
<li>配合 <code>infer</code>：提取类型片段（黄金组合）</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 提取 Promise 的返回值类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer V&gt; ? V : T;

<span class="hljs-keyword">type</span> C = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// string（提取成功）</span>
<span class="hljs-keyword">type</span> D = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// number（不满足条件，返回原类型）</span>
</code></pre>
<h4 data-id="heading-6"><code>extends</code> 做继承（复用已有结构）</h4>
<ol>
<li>接口继承：复用 + 扩展属性</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// 继承 User，并扩展新属性</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span> | <span class="hljs-string">"super_admin"</span>; <span class="hljs-comment">// 新增权限属性</span>
}

<span class="hljs-comment">// 必须包含继承的 + 扩展的所有属性</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">admin</span>: <span class="hljs-title class_">Admin</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>,
  <span class="hljs-attr">role</span>: <span class="hljs-string">"admin"</span>
};

<span class="hljs-comment">// 多接口继承</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">HasAge</span> { <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>; }
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">User</span>, <span class="hljs-title class_">HasAge</span> {
  <span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 同时继承 User + HasAge</span>
}
</code></pre>
<ol start="2">
<li>类继承：复用父类的属性 / 方法</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
  }
}

<span class="hljs-comment">// 继承 Parent 类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">super</span>(name); <span class="hljs-comment">// 必须调用父类构造函数（初始化父类属性）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
  }
  <span class="hljs-comment">// 重写父类方法</span>
  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 调用父类原方法</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old`</span>);
  }
}

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-string">"李四"</span>, <span class="hljs-number">10</span>);
child.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 输出：Hi, 李四 → I'm 10 years old</span>
</code></pre>
<p>补充：类实现接口用 <code>implements</code>（不是 <code>extends</code>）</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义接口（契约：规定必须有 id、name 属性，以及 greet 方法）</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">greet</span>(): <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 仅定义方法签名，无实现</span>
}

<span class="hljs-comment">// 类实现接口（必须严格遵守契约）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-comment">// 必须实现接口的所有属性</span>
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// 构造函数初始化属性</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// 必须实现接口的 greet 方法（具体实现由类自己定义）</span>
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.id}</span>`</span>);
  }
}

<span class="hljs-comment">// 实例化使用</span>
<span class="hljs-keyword">const</span> emp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>);
emp.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// 输出：Hi, I'm 张三, ID: 1</span>


<span class="hljs-comment">// 接口1：基础信息</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Identifiable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 接口2：可打印</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Printable</span> {
  <span class="hljs-title function_">printInfo</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 类同时实现两个接口（必须实现所有接口的成员）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Identifiable</span>, <span class="hljs-title class_">Printable</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 类可扩展接口外的属性</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-comment">// 实现 Identifiable 的方法</span>
  <span class="hljs-title function_">getId</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>;
  }

  <span class="hljs-comment">// 实现 Printable 的方法</span>
  <span class="hljs-title function_">printInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Product: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, ID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.getId()}</span>`</span>);
  }
}

<span class="hljs-keyword">const</span> product = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-number">100</span>, <span class="hljs-string">"手机"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(product.<span class="hljs-title function_">getId</span>()); <span class="hljs-comment">// 100</span>
product.<span class="hljs-title function_">printInfo</span>(); <span class="hljs-comment">// Product: 手机, ID: 100</span>
</code></pre>
<h3 data-id="heading-7"><code>infer</code></h3>
<p><code>infer</code> 是 TypeScript 在条件类型中提供的关键字，用于声明一个 <strong>待推导的类型变量</strong>（类似给类型起一个临时名字），只能在 <code>extends</code> 子句中使用。它的核心作用是：从已有类型中提取 / 推导我们需要的部分，而无需手动硬编码类型。</p>
<p><code>infer</code> 必须配合条件类型使用，语法结构如下：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 基础结构：推导 T 的类型为 U，若能推导则返回 U，否则返回 never</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">InferType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> infer U ? U : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example</span> = <span class="hljs-title class_">InferType</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// Example 类型为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Example2</span> = <span class="hljs-title class_">InferType</span>&lt;<span class="hljs-built_in">number</span>[]&gt;; <span class="hljs-comment">// Example2 类型为 number[]</span>
</code></pre>
<p>高频使用场景:</p>
<h4 data-id="heading-8">1. 提取函数的返回值类型</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义类型工具：提取函数的返回值类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-title class_">Fn</span>&gt; = <span class="hljs-title class_">Fn</span> <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试用函数</span>
<span class="hljs-keyword">const</span> add = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> a + b;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getUser</span> = (<span class="hljs-params"/>) =&gt; ({ <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> });

<span class="hljs-comment">// 使用类型工具</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AddReturn</span> = <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-keyword">typeof</span> add&gt;; <span class="hljs-comment">// AddReturn 类型为 number</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserReturn</span> = <span class="hljs-title class_">GetReturnType</span>&lt;<span class="hljs-keyword">typeof</span> getUser&gt;; <span class="hljs-comment">// UserReturn 类型为 { name: string; age: number }</span>
</code></pre>
<h4 data-id="heading-9">2. 提取数组的元素类型</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义类型工具：提取数组元素类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetArrayItem</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (infer <span class="hljs-title class_">Item</span>)[] ? <span class="hljs-title class_">Item</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NumberArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;<span class="hljs-built_in">number</span>[]&gt;; <span class="hljs-comment">// NumberArray 类型为 number</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;<span class="hljs-built_in">string</span>[]&gt;; <span class="hljs-comment">// StringArray 类型为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MixedArray</span> = <span class="hljs-title class_">GetArrayItem</span>&lt;[<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>]&gt;; <span class="hljs-comment">// MixedArray 类型为 string | number</span>
</code></pre>
<h4 data-id="heading-10">3. 提取 Promise 的泛型参数类型</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义类型工具：提取 Promise 的泛型类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetPromiseValue</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer <span class="hljs-title class_">Value</span>&gt; ? <span class="hljs-title class_">Value</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PromiseString</span> = <span class="hljs-title class_">GetPromiseValue</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// PromiseString 类型为 string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PromiseUser</span> = <span class="hljs-title class_">GetPromiseValue</span>&lt;<span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> }&gt;&gt;; <span class="hljs-comment">// PromiseUser 类型为 { id: number }</span>
</code></pre>
<h4 data-id="heading-11">4. 提取函数的参数类型</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义类型工具：提取函数参数类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-title class_">Fn</span>&gt; = <span class="hljs-title class_">Fn</span> <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: infer <span class="hljs-title class_">Params</span>) =&gt; <span class="hljs-built_in">any</span> ? <span class="hljs-title class_">Params</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> fn = (<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {};
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FnParams</span> = <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;; <span class="hljs-comment">// FnParams 类型为 [string, number]</span>

<span class="hljs-comment">// 进一步：提取第一个参数的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FirstParam</span> = <span class="hljs-title class_">GetFunctionParams</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;[<span class="hljs-number">0</span>]; <span class="hljs-comment">// FirstParam 类型为 string</span>
</code></pre>
<h2 data-id="heading-12">测试用例</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/* _____________ 测试用例 _____________ */</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Equal</span>, <span class="hljs-title class_">Expect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@type-challenges/utils'</span>

<span class="hljs-keyword">type</span> cases = [
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">MyReturnType</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span>&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-number">123</span>, <span class="hljs-title class_">MyReturnType</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-number">123</span>&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">ComplexObject</span>, <span class="hljs-title class_">MyReturnType</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">ComplexObject</span>&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt;, <span class="hljs-title class_">MyReturnType</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt;&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-string">'foo'</span>, <span class="hljs-title class_">MyReturnType</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-string">'foo'</span>&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-number">1</span> | <span class="hljs-number">2</span>, <span class="hljs-title class_">MyReturnType</span>&lt;<span class="hljs-keyword">typeof</span> fn&gt;&gt;&gt;,
  <span class="hljs-title class_">Expect</span>&lt;<span class="hljs-title class_">Equal</span>&lt;<span class="hljs-number">1</span> | <span class="hljs-number">2</span>, <span class="hljs-title class_">MyReturnType</span>&lt;<span class="hljs-keyword">typeof</span> fn1&gt;&gt;&gt;,
]

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ComplexObject</span> = {
  <span class="hljs-attr">a</span>: [<span class="hljs-number">12</span>, <span class="hljs-string">'foo'</span>]
  <span class="hljs-attr">bar</span>: <span class="hljs-string">'hello'</span>
  <span class="hljs-title function_">prev</span>(): <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span> = (<span class="hljs-params">v: <span class="hljs-built_in">boolean</span></span>) =&gt; v ? <span class="hljs-number">1</span> : <span class="hljs-number">2</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fn1</span> = (<span class="hljs-params">v: <span class="hljs-built_in">boolean</span>, w: <span class="hljs-built_in">any</span></span>) =&gt; v ? <span class="hljs-number">1</span> : <span class="hljs-number">2</span>
</code></pre>
<h2 data-id="heading-13">相关链接</h2>
<blockquote>
<p>分享你的解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F2%2Fanswer%2Fzh-CN" target="_blank" title="https://tsch.js.org/2/answer/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/2/answer/zh…</a>
查看解答：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2F2%2Fsolutions" target="_blank" title="https://tsch.js.org/2/solutions" ref="nofollow noopener noreferrer">tsch.js.org/2/solutions</a>
更多题目：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsch.js.org%2Fzh-CN" target="_blank" title="https://tsch.js.org/zh-CN" ref="nofollow noopener noreferrer">tsch.js.org/zh-CN</a></p>
</blockquote>
<p>下面是我的公众号，欢迎关注。关注后有新的功能点会及时收到推送。</p>
<blockquote>
<p>实战为王！专注于汇总各种功能点，致力于打造一系列能够帮助工程师实现各种功能的想法思路的优质文章。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdeec99a0154e7aa73c1c6765f3dcf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZnhzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770130734&amp;x-signature=QVVsua%2F5M5h8r5eoE%2FFDmZgJ0Pk%3D" alt="前端功能点" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[http header详解]]></title>    <link>https://juejin.cn/post/7599899147417960500</link>    <guid>https://juejin.cn/post/7599899147417960500</guid>    <pubDate>2026-01-27T15:01:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599899147417960500" data-draft-id="7599910677578629120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="http header详解"/> <meta itemprop="keywords" content="HTTP"/> <meta itemprop="datePublished" content="2026-01-27T15:01:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈里谢顿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            http header详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈里谢顿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T15:01:58.000Z" title="Tue Jan 27 2026 15:01:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>HTTP Header（请求头/响应头）是 HTTP 通信中最容易被忽视但最重要的部分。如果说 HTTP Body 是信件的内容，那么 Header 就是信封上的地址、邮票、紧急程度和保密等级——它决定了这封信能不能送达、怎么送达、以及收信人该如何处理。</p>
<p>以下是对 HTTP Header 的完整技术解析：</p>
<hr/>
<h2 data-id="heading-0">一、Header 的本质：元数据载体</h2>
<p>HTTP 协议采用<strong>分层设计</strong>：</p>
<ul>
<li><strong>请求行/状态行</strong>：我要做什么 / 我做的结果（What）</li>
<li><strong>Header</strong>：我该如何做 / 附加信息（How &amp; Context）</li>
<li><strong>Body</strong>：实际传输的数据（Data）</li>
</ul>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">GET</span> /api/user HTTP/<span class="hljs-number">1.1</span>          ← 请求行
<span class="hljs-symbol">Host:</span> api.example.com           ← Header 开始
<span class="hljs-symbol">Accept:</span> application/json        ← Header
<span class="hljs-symbol">Authorization:</span> Bearer xxx       ← Header
                                ← 空行（分隔）
{<span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>}                       ← Body（可选）
</code></pre>
<h3 data-id="heading-1">为什么必须在 Header 中传递元数据？</h3>
<ol>
<li>
<p><strong>前置协商</strong>：客户端和服务器需要在传输 Body 前就达成"共识"</p>
<ul>
<li>客户端说："我能接受 JSON 和 Gzip 压缩"（<code>Accept</code>, <code>Accept-Encoding</code>）</li>
<li>服务器说："我返回的是 JSON，用 UTF-8 编码"（<code>Content-Type</code>, <code>Content-Encoding</code>）</li>
</ul>
</li>
<li>
<p><strong>协议层与业务层解耦</strong>：Header 处理连接控制、缓存、安全等<strong>横向能力</strong>，Body 处理业务数据。这使得 Nginx、CDN 等中间件可以<strong>不解析 Body</strong> 就能进行逻辑处理。</p>
</li>
<li>
<p><strong>端到端追溯</strong>：<code>Trace-Id</code>、<code>X-Request-ID</code> 等头部使得微服务架构中的请求链路追踪成为可能。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">二、Header 的格式规范</h2>
<h3 data-id="heading-3">标准格式（RFC 7230）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">Header</span>-Name: value
</code></pre>
<p><strong>规则：</strong></p>
<ul>
<li><strong>大小写不敏感</strong>：<code>content-type</code> 等同于 <code>Content-Type</code>（但约定使用首字母大写）</li>
<li><strong>冒号后必须有空格</strong>：<code>Name:Value</code> 是合法的，但标准写法是 <code>Name: Value</code></li>
<li><strong>多值合并</strong>：同一个 Header 多次出现可以合并，用逗号分隔
<pre><code class="hljs language-http" lang="http">Accept: text/html, application/xhtml+xml
# 等同于
Accept: text/html
Accept: application/xhtml+xml
</code></pre>
</li>
</ul>
<h3 data-id="heading-4">常见值类型</h3>



































<table><thead><tr><th>类型</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td><strong>字符串</strong></td><td><code>User-Agent: Mozilla/5.0</code></td><td>纯文本，通常含版本号</td></tr><tr><td><strong>日期</strong></td><td><code>Date: Mon, 27 Jan 2026 08:00:00 GMT</code></td><td>必须为 GMT，遵循 RFC 7231</td></tr><tr><td><strong>整型</strong></td><td><code>Content-Length: 1024</code></td><td>字节长度</td></tr><tr><td><strong>枚举</strong></td><td><code>Connection: keep-alive</code></td><td>固定选项</td></tr><tr><td><strong>质量因子</strong></td><td><code>Accept-Language: zh-CN;q=0.8, en;q=0.2</code></td><td>q 表示权重（0-1）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">三、Header 分类详解</h2>
<h3 data-id="heading-6">1. 通用首部（General Headers）</h3>
<p>同时适用于请求和响应，描述<strong>消息本身</strong>的属性：</p>






























<table><thead><tr><th>Header</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td><code>Date</code></td><td>消息创建时间</td><td><code>Date: Mon, 27 Jan 2026 08:00:00 GMT</code></td></tr><tr><td><code>Connection</code></td><td>连接管理</td><td><code>Connection: keep-alive</code> / <code>close</code></td></tr><tr><td><code>Cache-Control</code></td><td>缓存指令</td><td><code>Cache-Control: no-cache, max-age=3600</code></td></tr><tr><td><code>Via</code></td><td>经过的代理</td><td><code>Via: 1.1 varnish, 1.1 nginx</code></td></tr></tbody></table>
<p><strong>示例：保持连接复用</strong></p>
<pre><code class="hljs language-http" lang="http">Connection: keep-alive
Keep-Alive: timeout=5, max=1000
</code></pre>
<h3 data-id="heading-7">2. 请求首部（Request Headers）</h3>
<p>客户端向服务器传递的<strong>能力声明和上下文</strong>：</p>
<h4 data-id="heading-8">内容协商类</h4>
<pre><code class="hljs language-http" lang="http">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Accept-Encoding: gzip, deflate, br  # brotli 压缩
Accept-Charset: utf-8
</code></pre>
<h4 data-id="heading-9">客户端信息类</h4>
<pre><code class="hljs language-http" lang="http">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
Referer: https://www.google.com/  # 来源页面（拼写错误但历史遗留）
Origin: https://example.com        # 跨域安全相关，不含路径
Host: api.example.com:8080         # 目标主机（HTTP/1.1 强制要求）
</code></pre>
<h4 data-id="heading-10">条件请求类（缓存验证）</h4>
<pre><code class="hljs language-http" lang="http">If-None-Match: "33a64df5"          # 配合 ETag
If-Modified-Since: Wed, 21 Oct 2025 07:28:00 GMT
</code></pre>
<h3 data-id="heading-11">3. 响应首部（Response Headers）</h3>
<p>服务器返回的<strong>控制指令和资源信息</strong>：</p>
<h4 data-id="heading-12">状态与控制</h4>
<pre><code class="hljs language-http" lang="http">Server: nginx/1.24.0                 # 服务器软件（可被隐藏）
X-Powered-By: Express                # 后端框架（建议隐藏，防扫描）
X-Frame-Options: DENY                # 点击劫持防护
X-Content-Type-Options: nosniff      # 禁止 MIME 嗅探
</code></pre>
<h4 data-id="heading-13">重定向</h4>
<pre><code class="hljs language-http" lang="http">Location: https://new-site.com/login  # 配合 301/302 状态码
Retry-After: 120                      # 服务不可用后多久重试（秒）
</code></pre>
<h3 data-id="heading-14">4. 实体首部（Entity Headers）</h3>
<p>描述 Body 的<strong>物理属性</strong>：</p>








































<table><thead><tr><th>Header</th><th>关键性</th><th>说明</th></tr></thead><tbody><tr><td><code>Content-Type</code></td><td>⭐⭐⭐</td><td>MIME 类型 + 编码，如 <code>application/json; charset=utf-8</code></td></tr><tr><td><code>Content-Length</code></td><td>⭐⭐</td><td>Body 字节长度（分块传输时可省略）</td></tr><tr><td><code>Content-Encoding</code></td><td>⭐⭐</td><td>压缩格式：<code>gzip</code>, <code>deflate</code>, <code>br</code></td></tr><tr><td><code>Content-Disposition</code></td><td>⭐</td><td>文件下载控制：<code>attachment; filename="report.pdf"</code></td></tr><tr><td><code>ETag</code></td><td>⭐⭐</td><td>资源唯一标识，用于缓存验证</td></tr><tr><td><code>Last-Modified</code></td><td>⭐</td><td>资源最后修改时间</td></tr></tbody></table>
<p><strong>关键示例：文件下载</strong></p>
<pre><code class="hljs language-http" lang="http">Content-Type: application/octet-stream
Content-Disposition: attachment; filename="data.csv"
Content-Length: 10240
</code></pre>
<h3 data-id="heading-15">5. 安全相关首部（CORS &amp; 安全策略）</h3>
<p>现代 Web 安全的核心配置：</p>
<pre><code class="hljs language-http" lang="http"># CORS 跨域头部
Access-Control-Allow-Origin: https://example.com
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Allow-Credentials: true
Access-Control-Max-Age: 86400

# 内容安全策略（CSP）
Content-Security-Policy: default-src 'self'; script-src 'nonce-abc123'

# 传输安全（HSTS）
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
</code></pre>
<h3 data-id="heading-16">6. 自定义首部（X-Custom-*）</h3>
<p>业务自定义字段，通常以 <code>X-</code> 开头（虽然 RFC 6648 已废弃 <code>X-</code> 前缀习惯，但仍广泛使用）：</p>
<pre><code class="hljs language-http" lang="http">X-Request-ID: 550e8400-e29b-41d4-a716-446655440000  # 链路追踪 ID
X-User-ID: 9527                                    # 用户身份透传
X-Version: v2                                      # API 版本
X-Real-IP: 203.0.113.195                           # 经过代理后的真实 IP
X-Forwarded-For: 192.168.1.1, 172.16.0.1           # 代理链路
X-Forwarded-Proto: https                          # 原始协议
</code></pre>
<hr/>
<h2 data-id="heading-17">四、实际场景中的 Header 交互</h2>
<h3 data-id="heading-18">场景 1：浏览器请求网页（完整 Headers）</h3>
<p><strong>Request:</strong></p>
<pre><code class="hljs language-http" lang="http">GET /blog/http-headers HTTP/2
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: https://www.google.com/
Connection: keep-alive
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: cross-site
Cache-Control: max-age=0
</code></pre>
<p><strong>Response:</strong></p>
<pre><code class="hljs language-http" lang="http">HTTP/2 200 OK
Server: nginx
Date: Mon, 27 Jan 2026 08:30:00 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 5248
Content-Encoding: br  # Brotli 压缩
Cache-Control: public, max-age=3600
ETag: "686897696a7c876b7e"
Last-Modified: Mon, 27 Jan 2026 08:00:00 GMT
Vary: Accept-Encoding
Strict-Transport-Security: max-age=63072000
X-Frame-Options: SAMEORIGIN
</code></pre>
<h3 data-id="heading-19">场景 2：API 鉴权请求（Python）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

headers = {
    <span class="hljs-comment"># 身份认证</span>
    <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."</span>,
    
    <span class="hljs-comment"># 数据格式协商</span>
    <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"Accept"</span>: <span class="hljs-string">"application/json"</span>,
    
    <span class="hljs-comment"># 压缩支持</span>
    <span class="hljs-string">"Accept-Encoding"</span>: <span class="hljs-string">"gzip, deflate"</span>,
    
    <span class="hljs-comment"># 业务自定义（链路追踪）</span>
    <span class="hljs-string">"X-Request-ID"</span>: <span class="hljs-string">"req_123456789"</span>,
    <span class="hljs-string">"X-Idempotency-Key"</span>: <span class="hljs-string">"uuid-for-retry-safety"</span>
}

response = requests.post(
    <span class="hljs-string">"https://api.example.com/orders"</span>,
    headers=headers,
    json={<span class="hljs-string">"product"</span>: <span class="hljs-string">"book"</span>, <span class="hljs-string">"qty"</span>: <span class="hljs-number">2</span>}
)
</code></pre>
<h3 data-id="heading-20">场景 3：cURL 调试（查看请求头）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看发送的请求头（-v 或 --trace-ascii）</span>
curl -v https://api.example.com/data \
  -H <span class="hljs-string">"Authorization: Bearer token123"</span> \
  -H <span class="hljs-string">"Accept: application/json"</span>

<span class="hljs-comment"># 输出中的 &gt; 表示发送的请求头</span>
&gt; GET /data HTTP/1.1
&gt; Host: api.example.com
&gt; User-Agent: curl/7.68.0
&gt; Accept: application/json
&gt; Authorization: Bearer token123
</code></pre>
<hr/>
<h2 data-id="heading-21">五、常见陷阱与最佳实践</h2>
<h3 data-id="heading-22">❌ 错误做法</h3>
<ol>
<li><strong>在 Header 中放敏感业务数据</strong>：Header 通常会被服务器日志记录，不宜放置密码、Token 之外的敏感信息（尽管有 Authorization）。</li>
<li><strong>大小写混用混乱</strong>：虽然不敏感，但建议统一使用 <code>X-Custom-Header</code> 或 <code>x-custom-header</code> 风格。</li>
<li><strong>Content-Type 缺失</strong>：POST 请求必须指定 <code>Content-Type</code>，否则服务器可能无法解析 Body（Django 会返回 415 Unsupported Media Type）。</li>
</ol>
<h3 data-id="heading-23">✅ 最佳实践</h3>
<ol>
<li><strong>强制 HTTPS</strong>：所有含鉴权头的请求必须通过 TLS（HTTPS），防止中间人截获 <code>Authorization</code>。</li>
<li><strong>敏感的 Server 信息隐藏</strong>：
<pre><code class="hljs language-nginx" lang="nginx"># nginx.conf 隐藏版本
server_tokens off;
more_clear_headers Server X-Powered-By;
</code></pre>
</li>
<li><strong>合理设置缓存头</strong>：静态资源用 <code>Cache-Control: max-age=31536000, immutable</code>，API 用 <code>Cache-Control: no-store</code>。</li>
<li><strong>请求 ID 透传</strong>：微服务架构中，网关生成 <code>X-Request-ID</code>，后续所有服务必须原样传递，便于日志串联。</li>
</ol>
<hr/>
<h2 data-id="heading-24">六、HTTP/2 与 HTTP/3 中的 Header 变化</h2>
<p>在 HTTP/2 中，Header 被<strong>二进制编码</strong>（HPACK 算法），不再是明文文本，但语义层面保持一致。HTTP/3 使用 QPACK 算法进一步优化头部压缩。</p>
<p><strong>关键变化：</strong></p>
<ul>
<li><strong>伪头部</strong>：<code>:method</code>, <code>:scheme</code>, <code>:authority</code>, <code>:path</code>（冒号开头，HTTP/2 特有）</li>
<li><strong>Header 压缩</strong>：重复的 Header 字段（如 <code>User-Agent</code>）在后续请求中只需传输索引号，大幅减少流量</li>
</ul>
<hr/>
<h2 data-id="heading-25">总结</h2>
<p>HTTP Header 是 Web 通信的<strong>控制平面</strong>，它解决了以下核心问题：</p>
<ol>
<li><strong>能力协商</strong>：客户端和服务器通过 <code>Accept-*</code> 和 <code>Content-*</code> 达成一致</li>
<li><strong>上下文传递</strong>：<code>Cookie</code>, <code>Authorization</code> 维持状态，<code>X-Request-ID</code> 维持链路</li>
<li><strong>安全策略</strong>：CORS、CSP、HSTS 等头部构建现代 Web 安全基础</li>
<li><strong>性能优化</strong>：<code>Cache-Control</code>, <code>ETag</code>, <code>Content-Encoding</code> 实现缓存和压缩</li>
</ol>
<p>掌握 Header 的编写与调试，是后端开发、DevOps 和全栈工程师的<strong>基本功</strong>。建议安装浏览器插件（如 <strong>ModHeader</strong>）或使用 Postman 进行实际操作，观察不同 Header 对服务器行为的影响。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent 框架探秘：拆解 OpenHands（3）--- 启动]]></title>    <link>https://juejin.cn/post/7599852042529865738</link>    <guid>https://juejin.cn/post/7599852042529865738</guid>    <pubDate>2026-01-27T13:05:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852042529865738" data-draft-id="7598818096754114611" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent 框架探秘：拆解 OpenHands（3）--- 启动"/> <meta itemprop="keywords" content="算法,机器学习,人工智能"/> <meta itemprop="datePublished" content="2026-01-27T13:05:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent 框架探秘：拆解 OpenHands（3）--- 启动
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T13:05:53.000Z" title="Tue Jan 27 2026 13:05:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI Agent 框架探秘：拆解 OpenHands（3）--- 启动</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 概要</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 背景</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 总体架构</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 切入点</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 初始化 @ run_controller</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 总体流程</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 创建注册中心</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.3 创建Agent</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.4 构建Runtime</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.5 构建Memory &amp; Microagent</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.6 创建MCP</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.7 创建Controller</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.8 发送启动事件</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.9 订阅事件流：注册用户输入回调函数</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.10 运行代理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.11 run_controller全部代码</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF 参考</a></p>
</li>
</ul>
<h3 data-id="heading-1">0x00 概要</h3>
<p>当分析一个系统时，启动部分和用户典型使用场景是比较理想的切入点，因为这两个部分可以覆盖系统大部分功能模块，可以借此深入架构。</p>
<p>因为本系列借鉴的文章过多，可能在参考文献中有遗漏的文章，如果有，还请大家指出。</p>
<h3 data-id="heading-2">0x01 背景</h3>
<h4 data-id="heading-3">1.1 总体架构</h4>
<p>以下是 OpenHands 的架构图，这是一个复杂的系统。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41a92ca5a086452c9a19e80556cc8988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770123953&amp;x-signature=Mn2EcZQmtdAhXqdioUUqnLTbeV0%3D" alt="Openhands-arch" loading="lazy"/></p>
<p>Openhands-arch</p>
<p>抛开复杂的技术细节，OpenHands Agent 的交互逻辑可提炼为 “初始化 - 事件注入 - 协同处理 - 等待” 的极简流程，核心围绕 EventStream 实现模块联动：</p>
<ul>
<li>
<p>初始化就绪：用户创建会话时，系统自动完成 Agent、AgentController、Runtime、Memory 有核心模块的初始化，且每个模块都会自动订阅 EventStream，确保能捕获相关事件；</p>
</li>
<li>
<p>任务发起：用户发送消息本质是向 EventStream 中注入一条事件，这条事件会触发所有订阅相关回调函数的模块，启动协同处理；</p>
</li>
<li>
<p>多模块协同响应：</p>
<ul>
<li>Session 模块持续上报事件流中的各类状态事件，保障全局可观测；</li>
<li>若用户开启 Security Analyzer，该模块会通过安全分析，自动确认低风险任务，减少用户手动干预；</li>
<li>AgentController 向事件流注入 RecallAction，Memory 模块判断是否为首次接收的用户信息，据此补充相关记忆并返回 RecallObservation 事件；</li>
</ul>
</li>
<li>
<p>状态同步：AgentController 更新任务当前状态，并将相关信息传递给 Agent。即AgentController 调用 <code>Agent.step</code> 方法处理当前事件，生成 Action 并注入事件流。</p>
</li>
<li>
<p>行动决策：Agent 基于接收的状态信息，向 LLM 发起请求，生成下一步具体行动方案；</p>
</li>
<li>
<p>行动输出：Agent 明确输出行动指令，可能是运行系统命令、读取文件、调用工具等具体操作；</p>
</li>
<li>
<p>行动分发：该行动指令通过 EventStream 传递至 Runtime 组件，等待执行；</p>
</li>
<li>
<p>执行与反馈：Runtime 执行行动指令，生成包含执行结果、错误信息等内容的观察结果；</p>
</li>
<li>
<p>结果回传：观察结果通过 EventStream 回传给 AgentController，完成一次执行闭环；</p>
</li>
<li>
<p>循环或终止：AgentController 根据观察结果判断任务是否完成，若未完成则重复上述流程；若需协同，则委派给其他 Agent，直至任务结束。</p>
</li>
</ul>
<h4 data-id="heading-4">1.2 切入点</h4>
<p>以下是一个例子。我们由此进入，看看OpenHands如何启动，也可以从此处看看OpenHands的基本逻辑。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">config</span> = load_openhands_config()
<span class="hljs-attr">action</span> = MessageAction(content=<span class="hljs-string">"Write a hello world program"</span>)
<span class="hljs-attr">state</span> = await run_controller(config=config, initial_user_action=action)
</code></pre>
<p>上述代码是直接命令行调用 run_controller，因此我们从run_controller入手。</p>
<h3 data-id="heading-5">0x02 初始化 @ run_controller</h3>
<p>run_controller 作为 OpenHands 后端单个会话的核心入口协程，核心职责是依据预设配置启动运行时环境、智能体及对应控制器，搭建起从接收用户指令到多步骤执行任务，再到最终将会话状态持久化存储的完整处理链路。其核心设计亮点体现在三方面：</p>
<ul>
<li>实现会话全生命周期的一体化管理，集中完成会话标识（SID）生成、运行时连接建立、代码仓库克隆、MCP 工具嵌入及任务执行轨迹重放等关键操作；</li>
<li>构建双重安全管控机制，通过设置最大迭代次数（max_iterations）与单任务最高预算（max_budget_per_task）的硬性限制，有效规避无限循环执行与资源费用超额的风险；</li>
<li>强化全流程可观测性，借助 EventStream 实现事件实时分发，支持命令行界面（CLI）、前端界面、日志系统等多端同步订阅，同时生成可回放、可审计的 JSON 格式执行轨迹，便于后续追溯与核查。</li>
</ul>
<h4 data-id="heading-6">2.1 总体流程</h4>
<p>openhands\core\main.py 的 run_controller 的总体流程如下。</p>
<ul>
<li>
<p>初始化系统组件</p>
<ul>
<li>创建Agent。</li>
<li>创建runtime和内存系统</li>
<li>创建controller。</li>
</ul>
</li>
<li>
<p>运行Agent，具体会:</p>
<ul>
<li>
<p>管理任务执行流程。</p>
<ul>
<li>接收初始用户操作</li>
<li>处理事件流中的各种事件。</li>
<li>监听agent状态变化，特别是等待用户输入的状态。</li>
</ul>
</li>
<li>
<p>处理用户交互。</p>
<ul>
<li>当agent需要用户输入时，依据配置进行自动响应或者等待真实用户输入。</li>
<li>支持mock用户响应函数fake_user_response_fn，这样可以自动化测试。</li>
</ul>
</li>
<li>
<p>状态管理和持久化。</p>
<ul>
<li>保存会话状态到文件。</li>
<li>记录执行轨迹，这样可以分析调试。</li>
<li>支持轨迹重放。</li>
</ul>
</li>
<li>
<p>资源管理。</p>
<ul>
<li>管理MCP集成。</li>
<li>控制执行预算（迭代次数和费用限制）</li>
<li>正确关闭资源。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>具体流程图如下。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b24feb09e57845c2b48b4995821500bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770123953&amp;x-signature=pC%2FQDJCoiIz04ABoJbhLW3%2BziGQ%3D" alt="OpenHands-3-1" loading="lazy"/></p>
<p>OpenHands-3-1</p>
<p>我们接下来看看具体流程细节。</p>
<h4 data-id="heading-7">2.2 创建注册中心</h4>
<p>下面语句会创建 LLM 注册中心 &amp; 对话统计实例。</p>
<pre><code class="hljs language-ini" lang="ini">    <span class="hljs-attr">sid</span> = sid or generate_sid(config)

    llm_registry, conversation_stats, <span class="hljs-attr">config</span> = create_registry_and_conversation_stats(
        config,
        sid,
        None,
    )
</code></pre>
<p>具体代码如下，其功能是:</p>
<ol>
<li>根据用户设置调整基础配置</li>
<li>初始化LLM注册表（管理所有LLM实例）</li>
<li>初始化文件存储和对话统计器（跟踪对话数据）</li>
<li>建立注册表与统计器的订阅关系</li>
</ol>

<pre><code class="hljs language-ini" lang="ini">def create_registry_and_conversation_stats(
    config: OpenHandsConfig,
    sid: str,
    user_id: Optional<span class="hljs-section">[str]</span>,
    user_settings: Optional<span class="hljs-section">[Settings]</span> = None,
) -&gt; tuple<span class="hljs-section">[LLMRegistry, ConversationStats, OpenHandsConfig]</span>:
    """
    创建LLM注册表、对话统计实例和用户配置的组合函数。
    
    参数：
        config: 基础配置对象
        sid: 会话ID（用于标识当前对话）
        user_id: 用户ID（可选，用于用户级数据跟踪）
        user_settings: 用户自定义设置（可选，用于覆盖默认配置）
    
    返回：
        三元组 (LLM注册表, 对话统计实例, 最终用户配置)
    """
    <span class="hljs-comment"># 初始化用户配置（优先使用用户设置覆盖默认配置）</span>
    <span class="hljs-attr">user_config</span> = config
    if user_settings:
        <span class="hljs-attr">user_config</span> = setup_llm_config(config, user_settings)

    <span class="hljs-comment"># 确定代理类型（从用户设置或默认配置中获取）</span>
    <span class="hljs-attr">agent_cls</span> = user_settings.agent if user_settings else None
    <span class="hljs-comment"># 创建LLM注册表，关联配置和代理类型</span>
    <span class="hljs-attr">llm_registry</span> = LLMRegistry(user_config, agent_cls)
    
    <span class="hljs-comment"># 初始化文件存储（用于持久化对话数据）</span>
    <span class="hljs-attr">file_store</span> = get_file_store(
        <span class="hljs-attr">file_store_type</span>=config.file_store,
        <span class="hljs-attr">file_store_path</span>=config.file_store_path,
        <span class="hljs-attr">file_store_web_hook_url</span>=config.file_store_web_hook_url,
        <span class="hljs-attr">file_store_web_hook_headers</span>=config.file_store_web_hook_headers,
        <span class="hljs-attr">file_store_web_hook_batch</span>=config.file_store_web_hook_batch,
    )
    
    <span class="hljs-comment"># 创建对话统计实例（绑定文件存储、会话ID和用户ID）</span>
    <span class="hljs-attr">conversation_stats</span> = ConversationStats(file_store, sid, user_id)
    <span class="hljs-comment"># 订阅注册表事件：当新LLM注册时，自动记录到对话统计中</span>
    llm_registry.subscribe(conversation_stats.register_llm)
    
    return llm_registry, conversation_stats, user_config
</code></pre>
<h4 data-id="heading-8">2.3 创建Agent</h4>
<p>此处会根据config信息来创建agent。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">agent</span> = create_agent(config, llm_registry)
</code></pre>
<p>create_agent代码如下，从缺省配置可以看到，默认生成CodeActAgent。</p>
<pre><code class="hljs language-lua" lang="lua">#default_agent = <span class="hljs-string">"CodeActAgent"</span>

def create_agent(<span class="hljs-built_in">config</span>: OpenHandsConfig, llm_registry: LLMRegistry) -&gt; Agent:
    agent_cls: <span class="hljs-built_in">type</span>[Agent] = Agent.get_cls(<span class="hljs-built_in">config</span>.default_agent)
    agent_config = <span class="hljs-built_in">config</span>.get_agent_config(<span class="hljs-built_in">config</span>.default_agent)
    # Pass the runtime information from the main <span class="hljs-built_in">config</span> to the agent <span class="hljs-built_in">config</span>
    agent_config.runtime = <span class="hljs-built_in">config</span>.runtime
    <span class="hljs-built_in">config</span>.get_llm_config_from_agent(<span class="hljs-built_in">config</span>.default_agent)
    agent = agent_cls(<span class="hljs-built_in">config</span>=agent_config, llm_registry=llm_registry)
    <span class="hljs-keyword">return</span> agent
</code></pre>
<p>CodeActAgent 定义如下。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeActAgent</span>(<span class="hljs-title class_ inherited__">Agent</span>):
    <span class="hljs-string">"""
    CodeActAgent：极简主义的智能代理，基于 CodeAct 理念实现。
    核心逻辑：将模型的行动统一到“代码执行”这一单一行动空间，通过传递“行动-观察”对列表，
    引导模型决策下一步操作，兼顾简洁性与执行性能。

    核心理念（源自论文：https://arxiv.org/abs/2402.01030）：
    打破传统代理多行动类型的复杂设计，用代码执行统一所有行动，既简化架构又提升效率。

    每一轮交互中，代理可执行两种操作：
    1. **对话（Converse）**：用自然语言与人类沟通，例如请求澄清需求、确认操作等。
    2. **代码行动（CodeAct）**：通过执行代码完成任务，支持两种形式：
       - 执行任意有效的 Linux bash 命令
       - 执行任意有效的 Python 代码（通过交互式 IPython 解释器模拟，
         实际通过 bash 命令实现，详见插件系统说明）
    """</span>
    VERSION = <span class="hljs-string">'2.2'</span>  <span class="hljs-comment"># 代理版本号</span>

    <span class="hljs-comment"># 沙盒环境所需插件依赖（按初始化顺序排列）</span>
    sandbox_plugins: <span class="hljs-built_in">list</span>[PluginRequirement] = [
        <span class="hljs-comment"># 注意：AgentSkillsRequirement 需在 JupyterRequirement 之前初始化</span>
        <span class="hljs-comment"># 原因：AgentSkillsRequirement 提供大量 Python 工具函数，</span>
        <span class="hljs-comment"># Jupyter 环境需要依赖这些函数才能正常工作</span>
        AgentSkillsRequirement(),  <span class="hljs-comment"># 提供代理核心技能函数的插件</span>
        JupyterRequirement(),      <span class="hljs-comment"># 提供交互式 Python 执行环境的插件</span>
    ]

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: AgentConfig, llm_registry: LLMRegistry</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""
        初始化 CodeActAgent 实例。

        参数：
            config (AgentConfig)：当前代理的配置对象（包含模型路由、记忆策略等）
            llm_registry (LLMRegistry)：LLM 注册表实例，用于获取所需 LLM 或路由 LLM
        """</span>
        <span class="hljs-comment"># 调用父类 Agent 的初始化方法，完成基础配置（如 LLM 注册、提示词管理器初始化）</span>
        <span class="hljs-built_in">super</span>().__init__(config, llm_registry)
        
        self.pending_actions: deque[<span class="hljs-string">'Action'</span>] = deque()  <span class="hljs-comment"># 待执行的行动队列（双端队列，支持高效进出）</span>
        self.reset()  <span class="hljs-comment"># 重置代理状态（初始化行动历史、观察记录等）</span>
        self.tools = self._get_tools()  <span class="hljs-comment"># 获取代理可使用的工具集（从插件或配置中提取）</span>

        <span class="hljs-comment"># 初始化对话记忆实例：存储“行动-观察”对，支持记忆压缩、上下文管理</span>
        self.conversation_memory = ConversationMemory(self.config, self.prompt_manager)

        <span class="hljs-comment"># 初始化上下文压缩器：根据配置创建 Condenser 实例，用于压缩长对话历史</span>
        self.condenser = Condenser.from_config(self.config.condenser, llm_registry)

        <span class="hljs-comment"># 覆盖父类的 LLM 实例：如需模型路由，优先使用路由 LLM（根据代理配置动态选择模型）</span>
        self.llm = self.llm_registry.get_router(self.config)
</code></pre>
<p>具体参见下图。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72997c85c0a8469c97d545a56438dc89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770123953&amp;x-signature=WjXvHUKakyclZW3PtThoH%2FaPnFA%3D" alt="image-20251019171311325" loading="lazy"/></p>
<p>image-20251019171311325</p>
<p>CodeActAgent的初始化流程图如下。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f8293c757e443efa90c6733c8bd8007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770123953&amp;x-signature=oDKH1AR2eVX9W3SCHamKCg4swBQ%3D" alt="Openhands-3-2" loading="lazy"/></p>
<p>Openhands-3-2</p>
<h4 data-id="heading-9">2.4 构建Runtime</h4>
<p>create_runtime()构建了AI 代理的 “专属工作间”Runtime。在OpenHands系统中，Runtime扮演着至关重要的角色，它为人工智能代理提供了一个稳定且可控的操作平台。</p>
<pre><code class="hljs language-ini" lang="ini">    <span class="hljs-comment"># 运行时创建后会自动连接并克隆选定的代码仓库</span>
    <span class="hljs-attr">repo_directory</span> = None
    if runtime is None:
        <span class="hljs-comment"># 初始化代码仓库（如需）</span>
        <span class="hljs-attr">repo_tokens</span> = get_provider_tokens()
        <span class="hljs-comment"># 创建运行时实例</span>
        <span class="hljs-attr">runtime</span> = create_runtime(
            config,
            llm_registry,
            <span class="hljs-attr">sid</span>=sid,
            <span class="hljs-attr">headless_mode</span>=headless_mode,
            <span class="hljs-attr">agent</span>=agent,
            <span class="hljs-attr">git_provider_tokens</span>=repo_tokens,
        )
        <span class="hljs-comment"># 同步调用异步的运行时连接方法</span>
        call_async_from_sync(runtime.connect)

        <span class="hljs-comment"># 初始化代码仓库（如需）</span>
        if config.sandbox.selected_repo:
            <span class="hljs-attr">repo_directory</span> = initialize_repository_for_runtime(
                runtime,
                <span class="hljs-attr">immutable_provider_tokens</span>=repo_tokens,
                <span class="hljs-attr">selected_repository</span>=config.sandbox.selected_repo,
            )
            
    <span class="hljs-comment"># event_stream 是  event_stream = EventStream(session_id, file_store)        </span>
    <span class="hljs-attr">event_stream</span> = runtime.event_stream        
</code></pre>
<p>Runtime 的<code>__init__</code>会注册EventStreamSubscriber.RUNTIME。</p>
<pre><code class="hljs language-lua" lang="lua">        <span class="hljs-built_in">self</span>.event_stream = event_stream
        <span class="hljs-keyword">if</span> event_stream:
            event_stream.subscribe(
                EventStreamSubscriber.RUNTIME, <span class="hljs-built_in">self</span>.on_event, <span class="hljs-built_in">self</span>.sid
            )
</code></pre>
<p><code>Runtime</code>只处理可运行的<code>Action</code>事件，执行动作拿到输出<code>Observation</code>发送回事件流中</p>
<ul>
<li><code>isinstance(event, MCPAction)</code>执行MCP获取结果</li>
</ul>

<ul>
<li>其他runtime支持的action则执行获取结果</li>
</ul>
<h4 data-id="heading-10">2.5 构建Memory &amp; Microagent</h4>
<p>接下来初始化memory，</p>
<pre><code class="hljs language-ini" lang="ini">    <span class="hljs-comment"># when memory is created, it will load the microagents from the selected repository</span>
    if memory is None:
        <span class="hljs-attr">memory</span> = create_memory(
            <span class="hljs-attr">runtime</span>=runtime,
            <span class="hljs-attr">event_stream</span>=event_stream,
            <span class="hljs-attr">sid</span>=sid,
            <span class="hljs-attr">selected_repository</span>=config.sandbox.selected_repo,
            <span class="hljs-attr">repo_directory</span>=repo_directory,
            <span class="hljs-attr">conversation_instructions</span>=conversation_instructions,
            <span class="hljs-attr">working_dir</span>=str(runtime.workspace_root),
        )
</code></pre>
<h5 data-id="heading-11">2.5.1 创建 Memory</h5>
<p>create_memory 函数会创建memory。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_memory</span>(<span class="hljs-params">
    runtime: Runtime,
    event_stream: EventStream,
    sid: <span class="hljs-built_in">str</span>,
    selected_repository: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    repo_directory: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    status_callback: <span class="hljs-type">Callable</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    conversation_instructions: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    working_dir: <span class="hljs-built_in">str</span> = DEFAULT_WORKSPACE_MOUNT_PATH_IN_SANDBOX,
</span>) -&gt; Memory:
    <span class="hljs-string">"""Create a memory for the agent to use.

    Args:
        runtime: The runtime to use.
        event_stream: The event stream it will subscribe to.
        sid: The session id.
        selected_repository: The repository to clone and start with, if any.
        repo_directory: The repository directory, if any.
        status_callback: Optional callback function to handle status updates.
        conversation_instructions: Optional instructions that are passed to the agent
    """</span>
    memory = Memory(
        event_stream=event_stream,
        sid=sid,
        status_callback=status_callback,
    )

    memory.set_conversation_instructions(conversation_instructions)

    <span class="hljs-keyword">if</span> runtime:
        <span class="hljs-comment"># sets available hosts</span>
        memory.set_runtime_info(runtime, {}, working_dir)

        <span class="hljs-comment"># loads microagents from repo/.openhands/microagents</span>
        microagents: <span class="hljs-built_in">list</span>[BaseMicroagent] = runtime.get_microagents_from_selected_repo(
            selected_repository
        )
        memory.load_user_workspace_microagents(microagents)

        <span class="hljs-keyword">if</span> selected_repository <span class="hljs-keyword">and</span> repo_directory:
            memory.set_repository_info(selected_repository, repo_directory)

    <span class="hljs-keyword">return</span> memory
</code></pre>
<p>memory初始化的时候有一个event_stream的订阅，会注册 EventStreamSubscriber.MEMORY，当有event的时候Memory 的<code>on_event</code>方法会被调用。</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-built_in">self</span>.event_stream.subscribe(
            EventStreamSubscriber.MEMORY,
            <span class="hljs-built_in">self</span>.on_event,
            <span class="hljs-built_in">self</span>.sid,
        )
</code></pre>
<p><code>Memory</code>只处理<code>RecallAction</code>，对于用户首次输入信息则将一些额外的工作空间上下文信息添加到<code>RecallObservation</code>发送回事件流中，对于其他非用户首次的输入信息则加入<code>microagent knowledge(领域强化提示词)</code>到<code>RecallObservation</code>发送回事件流中。</p>
<h5 data-id="heading-12">2.5.2 创建Microagent</h5>
<p>create_memory函数中会加载Microagent。</p>
<pre><code class="hljs language-css" lang="css">        # loads microagents <span class="hljs-selector-tag">from</span> repo/<span class="hljs-selector-class">.openhands</span>/microagents
        microagents: list[BaseMicroagent] = runtime.<span class="hljs-built_in">get_microagents_from_selected_repo</span>(
            selected_repository
        )
        memory.<span class="hljs-built_in">load_user_workspace_microagents</span>(microagents)
</code></pre>
<p>Microagent是主代理的“专业合作伙伴”。</p>
<p>为了高效完成复杂任务，通常需要专业的分工协作，Microagent正是为了这一目的而设计的“专业执行者”。当主代理在执行任务时遇到特定领域的细分工作，它不必亲自处理，而是可以将这部分任务“委托”给相应的Microagent，从而利用其专业能力提高效率和准确性。</p>
<p>从本质上讲，Microagent同样基于大型语言模型构建，比如，其独特之处可以是其内置的专业提示词（Prompt）。这些提示词中融入了特定领域的知识准则与操作规范，例如，与Git相关的Microagent，其提示词会包含Git操作的核心技巧与最佳实践，能够引导模型更精确地处理与Git相关的任务，成为主代理应对细分场景的“得力助手”。</p>
<p>BaseMicroagent 定义如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseMicroagent</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""Base class for all microagents."""</span>

    name: <span class="hljs-built_in">str</span>
    content: <span class="hljs-built_in">str</span>
    metadata: MicroagentMetadata
    source: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># path to the file</span>
    <span class="hljs-built_in">type</span>: MicroagentType

    PATH_TO_THIRD_PARTY_MICROAGENT_NAME: ClassVar[<span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]] = {
        <span class="hljs-string">'.cursorrules'</span>: <span class="hljs-string">'cursorrules'</span>,
        <span class="hljs-string">'agents.md'</span>: <span class="hljs-string">'agents'</span>,
        <span class="hljs-string">'agent.md'</span>: <span class="hljs-string">'agents'</span>,
    }
</code></pre>
<h4 data-id="heading-13">2.6 创建MCP</h4>
<p>接下来会创建MCP相关部分。</p>
<pre><code class="hljs language-arduino" lang="arduino">    # Add MCP tools to the agent
    <span class="hljs-keyword">if</span> agent.config.enable_mcp:
        # Add OpenHands<span class="hljs-number">'</span> MCP server by <span class="hljs-keyword">default</span>
        _, openhands_mcp_stdio_servers = (
            OpenHandsMCPConfigImpl.<span class="hljs-built_in">create_default_mcp_server_config</span>(
                config.mcp_host, config, None
            )
        )
        runtime.config.mcp.stdio_servers.<span class="hljs-built_in">extend</span>(openhands_mcp_stdio_servers)

        await <span class="hljs-built_in">add_mcp_tools_to_agent</span>(agent, runtime, memory)
</code></pre>
<h4 data-id="heading-14">2.7 创建Controller</h4>
<p>接下来会创建AgentController。</p>
<p>AgentController 是 OpenHands 系统中的核心控制器组件，负责管理代理（Agent）的整个生命周期和行为。是代理与系统其他组件之间的桥梁，确保代理可以安全有效地执行任务，同时管理系统资源。</p>
<p><code>AgentController</code>作为主要状态管理模块，</p>
<ul>
<li>
<p>根据<code>Observation</code>事件进行状态变换</p>
</li>
<li>
<p>根据<code>Action</code>进行状态变换和以下处理：</p>
<ul>
<li>对于<code>MessageAction</code>发送<code>RecallAction</code>到事件流中</li>
<li>对于<code>AgentDelegateAction</code>做Agent路由（后续机制解读中再详细介绍）</li>
</ul>
</li>
<li>
<p>根据当前的<code>event</code>判断进行调用<code>agent.step</code></p>
</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">    controller, <span class="hljs-attr">initial_state</span> = create_controller(
        agent, runtime, config, conversation_stats, <span class="hljs-attr">replay_events</span>=replay_events
    )
</code></pre>
<p>create_controller代码如下。</p>
<pre><code class="hljs language-ini" lang="ini">def create_controller(
    agent: Agent,
    runtime: Runtime,
    config: OpenHandsConfig,
    conversation_stats: ConversationStats,
    headless_mode: <span class="hljs-attr">bool</span> = <span class="hljs-literal">True</span>,
    replay_events: list<span class="hljs-section">[Event]</span> | <span class="hljs-attr">None</span> = None,
) -&gt; tuple<span class="hljs-section">[AgentController, State | None]</span>:
    <span class="hljs-attr">event_stream</span> = runtime.event_stream
    <span class="hljs-attr">initial_state</span> = None
    <span class="hljs-attr">initial_state</span> = State.restore_from_session(
            event_stream.sid, event_stream.file_store)
    <span class="hljs-attr">controller</span> = AgentController(
        <span class="hljs-attr">agent</span>=agent,
        <span class="hljs-attr">conversation_stats</span>=conversation_stats,
        <span class="hljs-attr">iteration_delta</span>=config.max_iterations,
        <span class="hljs-attr">budget_per_task_delta</span>=config.max_budget_per_task,
        <span class="hljs-attr">agent_to_llm_config</span>=config.get_agent_to_llm_config_map(),
        <span class="hljs-attr">event_stream</span>=event_stream,
        <span class="hljs-attr">initial_state</span>=initial_state,
        <span class="hljs-attr">headless_mode</span>=headless_mode,
        <span class="hljs-attr">confirmation_mode</span>=config.security.confirmation_mode,
        <span class="hljs-attr">replay_events</span>=replay_events,
        <span class="hljs-attr">security_analyzer</span>=runtime.security_analyzer,
    )
    return (controller, initial_state)
</code></pre>
<p>在 AgentController 的<code>__init__</code>中，会注册EventStreamSubscriber.AGENT_CONTROLLER。</p>
<pre><code class="hljs language-python" lang="python">        <span class="hljs-comment"># subscribe to the event stream if this is not a delegate</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_delegate:
            self.event_stream.subscribe(
                EventStreamSubscriber.AGENT_CONTROLLER, self.on_event, self.<span class="hljs-built_in">id</span>
            )
</code></pre>
<h4 data-id="heading-15">2.8 发送启动事件</h4>
<p>发送一个启动事件MessageAction。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">    # start <span class="hljs-keyword">event</span> <span class="hljs-built_in">is</span> a MessageAction <span class="hljs-keyword">with</span> the task, either resumed <span class="hljs-built_in">or</span> <span class="hljs-built_in">new</span>
    <span class="hljs-keyword">if</span> initial_state <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> None <span class="hljs-built_in">and</span> initial_state.last_error:
        # we<span class="hljs-comment">'re resuming the previous session</span>
        event_stream.add_event(
            MessageAction(
                content=(
                    <span class="hljs-string">"Let's get back on track. If you experienced errors before, do "</span>
                    <span class="hljs-comment">'NOT resume your task. Ask me about it.'</span>
                ),
            ),
            EventSource.USER,
        )
    <span class="hljs-keyword">else</span>:
        # init <span class="hljs-keyword">with</span> the provided actions
        event_stream.add_event(initial_user_action, EventSource.USER)
</code></pre>
<h4 data-id="heading-16">2.9 订阅事件流：注册用户输入回调函数</h4>
<p>把自己注册为 EventStreamSubscriber.MAIN。</p>
<pre><code class="hljs language-ini" lang="ini">    def on_event(event: Event) -&gt; None:
        if isinstance(event, AgentStateChangedObservation):
            if <span class="hljs-attr">event.agent_state</span> == AgentState.AWAITING_USER_INPUT:
                if exit_on_message:
                    <span class="hljs-attr">message</span> = <span class="hljs-string">'/exit'</span>
                elif fake_user_response_fn is None:
                    <span class="hljs-attr">message</span> = read_input(config.cli_multiline_input)
                else:
                    <span class="hljs-attr">message</span> = fake_user_response_fn(controller.get_state())
                <span class="hljs-attr">action</span> = MessageAction(content=message)
                event_stream.add_event(action, EventSource.USER)

    event_stream.subscribe(EventStreamSubscriber.MAIN, on_event, sid)

    <span class="hljs-attr">end_states</span> = [
        AgentState.FINISHED,
        AgentState.REJECTED,
        AgentState.ERROR,
        AgentState.PAUSED,
        AgentState.STOPPED,
    ]
</code></pre>
<p>几个模块的初始化范式基本一致，在<code>__init__</code>函数中完成模块的初始化准备工作，并且向事件流中订阅消息并注册各自模块的消息处理函数。事件回调函数会根据当前的事件进行状态机的状态转移。</p>
<ul>
<li>Runtime 在事件流中订阅 EventStreamSubscriber.RUNTIME，事件回调函数会处理需要runtine处理的action，比如mcp/tool等等。</li>
<li>Memory 在事件流中订阅 EventStreamSubscriber.MEMORY。事件回调函数根据当前的<code>event</code>生成一个带<code>microagent_knowledge</code>的<code>Observation</code>并以<code>ENVIRONMENT</code>作为源添加回事件流中，这里的<code>microagent_knowledge</code>是一种特定提示词增强的方法。</li>
<li>AgentController 在事件流中订阅 EventStreamSubscriber.AGENT_CONTROLLER。</li>
<li>run_controller 在事件流中订阅 EventStreamSubscriber.MAIN。</li>
</ul>
<h4 data-id="heading-17">2.10 运行代理</h4>
<p>运行代理直到进入结束状态。</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">await</span> run_agent_until_done(controller, runtime, memory, end_states)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f'Exception in main loop: <span class="hljs-subst">{e}</span>'</span>)

    <span class="hljs-comment"># save session when we're about to close</span>
    <span class="hljs-keyword">if</span> config.file_store <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> config.file_store != <span class="hljs-string">'memory'</span>:
        end_state = controller.get_state()
        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> the saved state does not include delegates events</span>
        end_state.save_to_session(
            event_stream.sid, event_stream.file_store, event_stream.user_id
        )

    <span class="hljs-keyword">await</span> controller.close(set_stop_state=<span class="hljs-literal">False</span>)
</code></pre>
<h4 data-id="heading-18">2.11 run_controller全部代码</h4>
<p>run_controller全部代码如下：</p>
<pre><code class="hljs language-ini" lang="ini">async def run_controller(
    config: OpenHandsConfig,
    initial_user_action: Action,
    sid: str | <span class="hljs-attr">None</span> = None,
    runtime: Runtime | <span class="hljs-attr">None</span> = None,
    exit_on_message: <span class="hljs-attr">bool</span> = <span class="hljs-literal">False</span>,
    fake_user_response_fn: FakeUserResponseFunc | <span class="hljs-attr">None</span> = None,
    headless_mode: <span class="hljs-attr">bool</span> = <span class="hljs-literal">True</span>,
    memory: Memory | <span class="hljs-attr">None</span> = None,
    conversation_instructions: str | <span class="hljs-attr">None</span> = None,
) -&gt; State | None:
    """主协程，用于运行代理控制器，支持灵活的任务输入。
    仅在通过命令行直接启动 OpenHands 后端时使用。

    参数:
        config: 应用配置实例
        initial_user_action: 包含初始用户输入的 Action 对象
        sid: (可选) 会话 ID。重要提示：非必要请勿手动设置，
             错误设置可能导致 RemoteRuntime 出现异常行为
        runtime: (可选) 代理运行的运行时环境实例
        exit_on_message: 当代理请求用户消息时退出（可选）
        fake_user_response_fn: (可选) 接收当前状态并返回模拟用户响应的函数
        headless_mode: 代理是否以无头模式运行

    返回:
        代理的最终状态；若发生错误则返回 None

    异常:
        AssertionError: 若 initial_user_action 不是 Action 实例
        Exception: 执行过程中可能抛出各类异常，均会被记录日志

    注意:
        - 状态持久化：若配置了 config.file_store，代理状态将在会话间保存
        - 执行轨迹：若配置了 config.trajectories_path，执行历史将以 JSON 格式保存用于分析
        - 预算控制：执行受 config.max_iterations 和 config.max_budget_per_task 限制

    示例:
        &gt;&gt;&gt; <span class="hljs-attr">config</span> = load_openhands_config()
        &gt;&gt;&gt; <span class="hljs-attr">action</span> = MessageAction(content=<span class="hljs-string">"Write a hello world program"</span>)
        &gt;&gt;&gt; <span class="hljs-attr">state</span> = await run_controller(config=config, initial_user_action=action)
    """
    <span class="hljs-comment"># 若未提供会话ID，则生成一个</span>
    <span class="hljs-attr">sid</span> = sid or generate_sid(config)

    <span class="hljs-comment"># 创建 LLM 注册中心、对话统计实例，并处理配置</span>
    llm_registry, conversation_stats, <span class="hljs-attr">config</span> = create_registry_and_conversation_stats(
        config,
        sid,
        None,
    )

    <span class="hljs-comment"># 基于配置和 LLM 注册中心创建代理实例</span>
    <span class="hljs-attr">agent</span> = create_agent(config, llm_registry)

    <span class="hljs-comment"># 运行时创建后会自动连接并克隆选定的代码仓库</span>
    <span class="hljs-attr">repo_directory</span> = None
    if runtime is None:
        <span class="hljs-comment"># 初始化代码仓库（如需）</span>
        <span class="hljs-attr">repo_tokens</span> = get_provider_tokens()
        <span class="hljs-comment"># 创建运行时实例</span>
        <span class="hljs-attr">runtime</span> = create_runtime(
            config,
            llm_registry,
            <span class="hljs-attr">sid</span>=sid,
            <span class="hljs-attr">headless_mode</span>=headless_mode,
            <span class="hljs-attr">agent</span>=agent,
            <span class="hljs-attr">git_provider_tokens</span>=repo_tokens,
        )
        <span class="hljs-comment"># 同步调用异步的运行时连接方法</span>
        call_async_from_sync(runtime.connect)

        <span class="hljs-comment"># 初始化代码仓库（如需）</span>
        if config.sandbox.selected_repo:
            <span class="hljs-attr">repo_directory</span> = initialize_repository_for_runtime(
                runtime,
                <span class="hljs-attr">immutable_provider_tokens</span>=repo_tokens,
                <span class="hljs-attr">selected_repository</span>=config.sandbox.selected_repo,
            )

    <span class="hljs-comment"># 从运行时获取事件流实例（组件间通信核心）</span>
    <span class="hljs-attr">event_stream</span> = runtime.event_stream

    <span class="hljs-comment"># 记忆系统创建后会从选定仓库加载微代理</span>
    if memory is None:
        <span class="hljs-comment"># 创建记忆系统实例</span>
        <span class="hljs-attr">memory</span> = create_memory(
            <span class="hljs-attr">runtime</span>=runtime,
            <span class="hljs-attr">event_stream</span>=event_stream,
            <span class="hljs-attr">sid</span>=sid,
            <span class="hljs-attr">selected_repository</span>=config.sandbox.selected_repo,
            <span class="hljs-attr">repo_directory</span>=repo_directory,
            <span class="hljs-attr">conversation_instructions</span>=conversation_instructions,
            <span class="hljs-attr">working_dir</span>=str(runtime.workspace_root),
        )

    <span class="hljs-comment"># 为代理添加 MCP 工具（若启用）</span>
    if agent.config.enable_mcp:
        <span class="hljs-comment"># 默认添加 OpenHands 的 MCP 服务器配置</span>
        _, <span class="hljs-attr">openhands_mcp_stdio_servers</span> = (
            OpenHandsMCPConfigImpl.create_default_mcp_server_config(
                config.mcp_host, config, None
            )
        )
        runtime.config.mcp.stdio_servers.extend(openhands_mcp_stdio_servers)

        <span class="hljs-comment"># 异步将 MCP 工具添加到代理</span>
        await add_mcp_tools_to_agent(agent, runtime, memory)

    <span class="hljs-comment"># 加载回放事件（若启用轨迹回放）</span>
    replay_events: list<span class="hljs-section">[Event]</span> | <span class="hljs-attr">None</span> = None
    if config.replay_trajectory_path:
        logger.info('Trajectory replay is enabled')
        <span class="hljs-comment"># 断言初始用户动作必须是空动作（回放场景）</span>
        assert isinstance(initial_user_action, NullAction)
        <span class="hljs-comment"># 从指定路径加载回放日志和初始用户动作</span>
        replay_events, <span class="hljs-attr">initial_user_action</span> = load_replay_log(
            config.replay_trajectory_path
        )

    <span class="hljs-comment"># 创建控制器和初始状态</span>
    controller, <span class="hljs-attr">initial_state</span> = create_controller(
        agent, runtime, config, conversation_stats, <span class="hljs-attr">replay_events</span>=replay_events
    )

    <span class="hljs-comment"># 断言初始用户动作必须是 Action 实例，否则抛出异常</span>
    assert isinstance(initial_user_action, Action), (
        f'initial user actions must be an Action, got {type(initial_user_action)}'
    )
    <span class="hljs-comment"># 记录调试日志：控制器初始化信息</span>
    logger.debug(
        f'Agent Controller Initialized: Running agent {agent.name}, model '
        f'{agent.llm.config.model}, with actions: {initial_user_action}'
    )

    <span class="hljs-comment"># 发送启动事件（恢复会话或新会话）</span>
    if initial_state is not None and initial_state.last_error:
        <span class="hljs-comment"># 恢复之前的会话（存在历史错误）</span>
        event_stream.add_event(
            MessageAction(
                <span class="hljs-attr">content</span>=(
                    "Let's get back on track. If you experienced errors before, do "
                    'NOT resume your task. Ask me about it.'
                ),
            ),
            EventSource.USER,
        )
    else:
        <span class="hljs-comment"># 新会话：添加初始用户动作到事件流</span>
        event_stream.add_event(initial_user_action, EventSource.USER)

    <span class="hljs-comment"># 定义事件回调函数：处理代理等待用户输入的场景</span>
    def on_event(event: Event) -&gt; None:
        <span class="hljs-comment"># 监听代理状态变更事件</span>
        if isinstance(event, AgentStateChangedObservation):
            <span class="hljs-comment"># 当代理进入等待用户输入状态时</span>
            if <span class="hljs-attr">event.agent_state</span> == AgentState.AWAITING_USER_INPUT:
                if exit_on_message:
                    <span class="hljs-comment"># 需退出时发送 /exit 指令</span>
                    <span class="hljs-attr">message</span> = <span class="hljs-string">'/exit'</span>
                elif fake_user_response_fn is None:
                    <span class="hljs-comment"># 读取真实用户输入</span>
                    <span class="hljs-attr">message</span> = read_input(config.cli_multiline_input)
                else:
                    <span class="hljs-comment"># 调用模拟用户响应函数</span>
                    <span class="hljs-attr">message</span> = fake_user_response_fn(controller.get_state())
                <span class="hljs-comment"># 创建消息动作并添加到事件流</span>
                <span class="hljs-attr">action</span> = MessageAction(content=message)
                event_stream.add_event(action, EventSource.USER)

    <span class="hljs-comment"># 订阅事件流：注册 MAIN 订阅者和回调函数</span>
    event_stream.subscribe(EventStreamSubscriber.MAIN, on_event, sid)

    <span class="hljs-comment"># 定义代理结束状态列表</span>
    <span class="hljs-attr">end_states</span> = [
        AgentState.FINISHED,
        AgentState.REJECTED,
        AgentState.ERROR,
        AgentState.PAUSED,
        AgentState.STOPPED,
    ]

    try:
        <span class="hljs-comment"># 运行代理直到进入结束状态</span>
        await run_agent_until_done(controller, runtime, memory, end_states)
    except Exception as e:
        <span class="hljs-comment"># 记录主循环异常日志</span>
        logger.error(f'Exception in main loop: {e}')

    <span class="hljs-comment"># 关闭前保存会话（若配置文件存储）</span>
    if config.file_store is not None and config.file_store != 'memory':
        <span class="hljs-attr">end_state</span> = controller.get_state()
        <span class="hljs-comment"># 注意：保存的状态不包含委托事件</span>
        end_state.save_to_session(
            event_stream.sid, event_stream.file_store, event_stream.user_id
        )

    <span class="hljs-comment"># 关闭控制器（不设置停止状态）</span>
    await controller.close(<span class="hljs-attr">set_stop_state</span>=<span class="hljs-literal">False</span>)

    <span class="hljs-comment"># 获取控制器最终状态</span>
    <span class="hljs-attr">state</span> = controller.get_state()

    <span class="hljs-comment"># 保存执行轨迹（若配置）</span>
    if config.save_trajectory_path is not None:
        <span class="hljs-comment"># 若路径是文件夹，则以会话ID为文件名</span>
        if os.path.isdir(config.save_trajectory_path):
            <span class="hljs-attr">file_path</span> = os.path.join(config.save_trajectory_path, sid + <span class="hljs-string">'.json'</span>)
        else:
            <span class="hljs-attr">file_path</span> = config.save_trajectory_path
        <span class="hljs-comment"># 创建目录（如需）</span>
        os.makedirs(os.path.dirname(file_path), <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)
        <span class="hljs-comment"># 获取执行轨迹历史</span>
        <span class="hljs-attr">histories</span> = controller.get_trajectory(config.save_screenshots_in_trajectory)
        <span class="hljs-comment"># 写入 JSON 文件</span>
        with open(file_path, 'w') as f:  <span class="hljs-comment"># noqa: ASYNC101</span>
            json.dump(histories, f, <span class="hljs-attr">indent</span>=<span class="hljs-number">4</span>)

    <span class="hljs-comment"># 返回最终状态</span>
    return state
</code></pre>
<h3 data-id="heading-19">0xFF 参考</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.all-hands.dev%2Fopenhands%2Fusage%2Farchitecture%2Fbackend" target="_blank" title="https://docs.all-hands.dev/openhands/usage/architecture/backend" ref="nofollow noopener noreferrer">docs.all-hands.dev/openhands/u…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1936485868761257658" target="_blank" title="https://zhuanlan.zhihu.com/p/1936485868761257658" ref="nofollow noopener noreferrer">当AI Agent从“玩具”走向“工具”，我们该关注什么？Openhands架构解析【第二篇：Agent 相关核心概念】</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2Fdreamrenderx" target="_blank" title="https://www.zhihu.com/people/dreamrenderx" ref="nofollow noopener noreferrer">克里</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1936175201323825087" target="_blank" title="https://zhuanlan.zhihu.com/p/1936175201323825087" ref="nofollow noopener noreferrer">当AI Agent从“玩具”走向“工具”，我们该关注什么？Openhands架构解析【第一篇：系列导读】</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2Fdreamrenderx" target="_blank" title="https://www.zhihu.com/people/dreamrenderx" ref="nofollow noopener noreferrer">克里</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1940436682949244630" target="_blank" title="https://zhuanlan.zhihu.com/p/1940436682949244630" ref="nofollow noopener noreferrer">Coding Agent之Openhands解析(含代码)</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2Fwu-long-ming-cha-56" target="_blank" title="https://www.zhihu.com/people/wu-long-ming-cha-56" ref="nofollow noopener noreferrer">Arrow</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1940824548485347192" target="_blank" title="https://zhuanlan.zhihu.com/p/1940824548485347192" ref="nofollow noopener noreferrer">OpenHands 源码解读</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2Fxiao-hui-66-72" target="_blank" title="https://www.zhihu.com/people/xiao-hui-66-72" ref="nofollow noopener noreferrer">一力辉</a></p>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OoderAgent P2P 网络核心技术揭秘：多 Agent 协作入网架构与全链路安全防护]]></title>    <link>https://juejin.cn/post/7599679977344974889</link>    <guid>https://juejin.cn/post/7599679977344974889</guid>    <pubDate>2026-01-27T13:19:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599679977344974889" data-draft-id="7599843186202886186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OoderAgent P2P 网络核心技术揭秘：多 Agent 协作入网架构与全链路安全防护"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-27T13:19:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OoderAgent P2P 网络核心技术揭秘：多 Agent 协作入网架构与全链路安全防护
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T13:19:39.000Z" title="Tue Jan 27 2026 13:19:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h2 data-id="heading-0">一、引言</h2>
<p>本文档是ooderAgent的一种参考实现，详细介绍其P2P网络架构设计、多Agent协作入网机制和安全实现。ooderAgent是一套基于MIT协议的开源AI能力分发与自动化协作框架，通过P2P网络实现分布式存储和协作能力。OoderAgent P2P 网络的两大核心命题：<strong>如何让异构终端节点高效、安全地完成入网协作</strong>，以及<strong>如何在无中心架构下构建可信的通信环境</strong>。我们将从 P2P 网络拓扑设计、多 Agent 协作入网机制、全链路安全防护体系三个维度，拆解技术实现细节；结合家庭、企业、教育三大典型场景，分析架构落地的实践路径；同时直面分布式网络固有的负载均衡、恶意节点防御等痛点，提出针对性优化方案。尽管文章篇幅较长，但始终围绕「<strong>去中心化协作的高效性</strong>」与「<strong>分布式通信的安全性</strong>」两大核心展开，为开发者提供从架构设计到落地实践的完整技术参</p>
<h2 data-id="heading-1">二、P2P网络架构设计</h2>
<h3 data-id="heading-2">2.1 核心组件</h3>
<p>SuperAgent的P2P网络由三种核心Agent组成：</p>

























<table><thead><tr><th align="left">Agent类型</th><th align="left">主要职责</th><th align="left">部署位置</th></tr></thead><tbody><tr><td align="left">MCP Agent</td><td align="left">资源管理和调度，密钥下发</td><td align="left">中央服务器</td></tr><tr><td align="left">Route Agent</td><td align="left">消息路由和转发，临时Group管理</td><td align="left">边缘节点</td></tr><tr><td align="left">End Agent</td><td align="left">设备交互和数据采集，CAP管理</td><td align="left">终端设备</td></tr></tbody></table>
<h3 data-id="heading-3">2.2 网络拓扑</h3>
<p>网络采用自组织的无中心拓扑结构，具有以下特性：</p>
<ul>
<li><strong>动态拓扑</strong>：节点可以随时加入或离开网络，网络会自动调整</li>
<li><strong>分层架构</strong>：MCP Agent → Route Agent → End Agent 的层次结构</li>
<li><strong>对等网络</strong>：Route Agent之间形成对等网络，实现负载均衡和容错</li>
<li><strong>逻辑隔离</strong>：通过Group/Scene实现网络通信的逻辑隔离</li>
</ul>
<h4 data-id="heading-4">网络拓扑图</h4>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d8131ec7334436096039ab29acc4b07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770124779&amp;x-signature=QlMhsdIFaMX4CfBv%2BFbXnz3TL2Y%3D" alt="终端层 路由层 中央管理层 End Agent 1 End Agent 2 End Agent 3 End Agent 4 Route Agent 1 Route Agent 2 Route Agent 3 MCP Agent 1 MCP Agent 2" loading="lazy"/></p>
<p>​</p>
<h3 data-id="heading-5">2.3 设计原则</h3>
<ul>
<li><strong>去中心化</strong>：避免单点故障，提高系统可靠性</li>
<li><strong>安全性</strong>：多层次安全机制，确保网络通信安全</li>
<li><strong>可扩展性</strong>：支持动态节点加入和离开，适应网络规模变化</li>
<li><strong>灵活性</strong>：通过Group/Scene实现通信逻辑隔离，适应不同应用场景</li>
</ul>
<h2 data-id="heading-6">三、多Agent协作入网机制</h2>
<h3 data-id="heading-7">3.1 Route Agent对等网络形成</h3>
<p>Route Agent对等网络的形成是多Agent协作的关键环节：</p>
<ol>
<li><strong>初始化阶段</strong>：
<ul>
<li>MCP Agent生成自身的安全密钥对</li>
<li>配置网络安全策略</li>
<li>准备Route Agent密钥下发机制</li>
</ul>
</li>
<li><strong>Route Agent加入MCP Agent</strong>：
<ul>
<li>Route Agent向MCP Agent发送加入请求</li>
<li>MCP Agent验证Route Agent身份</li>
<li>MCP Agent下发安全密钥给Route Agent</li>
<li>Route Agent存储MCP Agent下发的密钥</li>
<li>Route Agent不允许连接多个MCP Agent，避免安全域混淆</li>
</ul>
</li>
<li><strong>Route Agent创建临时Group</strong>：
<ul>
<li>Route Agent生成临时Group ID和安全密钥</li>
<li>创建Group元数据，包括名称、描述、安全策略等</li>
<li>广播安全密钥到网络中的End Agent成员</li>
</ul>
</li>
<li><strong>Route Agent对等发现</strong>：
<ul>
<li>Route Agent发送对等网络发现请求</li>
<li>接收其他Route Agent的响应</li>
<li>交换安全密钥，形成对等网络</li>
<li>各自广播安全密钥到End Agent成员</li>
<li>多个拥有相同Scene声明的Route Agent可以共存于网络中</li>
</ul>
</li>
</ol>
<h4 data-id="heading-8">Route Agent对等网络形成流程图</h4>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82888b0b316047dda0beef7af53fe7fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770124779&amp;x-signature=LWAYh3DB6uDM6QhY49mUdiewdMI%3D" alt="MCP Agent Route Agent 1 Route Agent 2 End Agent 生成安全密钥对 发送加入请求 验证身份并下发密钥 存储密钥 创建临时Group 广播安全密钥 发送对等发现请求 响应并交换密钥 广播安全密钥 广播安全密钥 MCP Agent Route Agent 1 Route Agent 2 End Agent" loading="lazy"/></p>
<p>​</p>
<h3 data-id="heading-9">3.2 End Agent入网流程</h3>
<p>End Agent的入网流程设计充分考虑了安全性和便捷性：</p>
<ol>
<li><strong>首次入网</strong>：
<ul>
<li>End Agent接收Route Agent广播的安全密钥</li>
<li>创建相应的CAP (Connection Access Point)</li>
<li>存储链路信息和密钥到CAP</li>
<li>完成安全认证，加入网络</li>
</ul>
</li>
<li><strong>启动/离线再入网</strong>：
<ul>
<li>End Agent读取存储的CAP信息</li>
<li>发送入网请求，携带CAP信息</li>
<li>Route Agent验证CAP信息有效性</li>
<li>使用CAP中的密钥完成认证挑战</li>
<li>快速加入对等网络</li>
</ul>
</li>
</ol>
<h4 data-id="heading-10">End Agent入网流程图</h4>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66ecd02fb3e64939a9d8c03d49c02e3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770124779&amp;x-signature=ZIfr1UhEqZJRTZFkr0tAqUsPuF8%3D" alt="End Agent Route Agent MCP Agent 接收Route Agent广播的安全密钥 创建CAP并存储链路信息和密钥 发送入网请求 验证CAP信息 发送认证挑战 使用CAP中的密钥生成响应 发送认证响应 验证响应 确认入网成功 通知节点入网成功 End Agent Route Agent MCP Agent" loading="lazy"/></p>
<p>​</p>
<h3 data-id="heading-11">3.3 网络发现机制</h3>
<ul>
<li><strong>本地发现</strong>：节点启动时发送UDP广播，包含节点ID、能力、搜索的Group ID</li>
<li><strong>引导节点发现</strong>：查询配置的引导节点列表，获取网络信息</li>
<li><strong>Group发现</strong>：发送Group发现请求，接收Group管理节点的响应</li>
</ul>
<h4 data-id="heading-12">网络发现流程图</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ac273d6c94b4365990e3c29506f8ad5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770124779&amp;x-signature=HsfsL9z4zN4CuQ8HJpGk1NPxR80%3D" alt="节点启动 发送UDP广播 收到响应? 解析网络信息 查询引导节点 引导节点响应? 发送Group发现请求 Group管理节点响应? 网络发现失败 加入网络" loading="lazy"/></p>
<p>​</p>
<h2 data-id="heading-13">四、安全机制设计</h2>
<h3 data-id="heading-14">4.1 多层安全架构</h3>
<p>ooderAgent的P2P网络采用多层安全架构，确保网络通信的安全性：</p>
<ol>
<li><strong>身份认证</strong>：
<ul>
<li>节点身份：每个节点拥有唯一的身份标识和密钥对</li>
<li>数字签名：所有消息和技能都需要数字签名验证</li>
<li>密钥交换：使用ECDH算法进行密钥交换，建立安全通信通道</li>
</ul>
</li>
<li><strong>数据加密</strong>：
<ul>
<li>传输加密：节点间通信使用TLS 1.3加密</li>
<li>技能加密：共享的技能代码使用AES-256加密</li>
<li>数据加密：传输的敏感数据使用端到端加密</li>
</ul>
</li>
<li><strong>访问控制</strong>：
<ul>
<li>技能访问控制：技能提供者可以设置技能的访问权限</li>
<li>数据访问控制：用户可以控制数据的共享范围</li>
<li>节点白名单：支持设置信任节点白名单</li>
</ul>
</li>
</ol>
<h4 data-id="heading-15">多层安全架构图</h4>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15c90e45e2c64e2789da6f21d34fa6e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770124779&amp;x-signature=699WLcxL7IAVfTCZPZQeT1Sbrcc%3D" alt="网络层 传输层 应用层 网络层安全 节点认证 对等加密 TLS 1.3加密 数字签名 端到端加密 应用层安全 访问控制 任务保护" loading="lazy"/></p>
<p>​</p>
<h3 data-id="heading-16">4.2 Route Agent安全机制</h3>
<p>Route Agent作为网络的核心转发节点，其安全机制尤为重要：</p>
<ul>
<li><strong>单一MCP Agent连接</strong>：Route Agent不允许连接多个MCP Agent，避免安全域混淆</li>
<li><strong>安全密钥管理</strong>：创建临时Group时生成安全密钥，定期更新</li>
<li><strong>密钥广播</strong>：广播安全密钥到所有End Agent成员，确保网络安全</li>
<li><strong>对等网络安全</strong>：Route Agent之间交换安全密钥，形成安全的对等网络</li>
<li><strong>MCP Agent P2P限制</strong>：MCP Agent P2P只能在同一个MCP Agent下发起安全P2P</li>
</ul>
<h3 data-id="heading-17">4.3 End Agent安全机制</h3>
<p>End Agent作为终端设备的接口，其安全机制设计注重实用性：</p>
<ul>
<li><strong>CAP管理</strong>：创建和管理Connection Access Point，存储链路信息和密钥</li>
<li><strong>快速重连</strong>：使用CAP信息实现快速安全重连，提高用户体验</li>
<li><strong>安全存储</strong>：安全存储CAP信息，防止密钥泄露</li>
<li><strong>认证挑战</strong>：入网时使用CAP中的密钥响应认证挑战，确保身份验证</li>
</ul>
<h3 data-id="heading-18">4.4 信任管理机制</h3>
<ul>
<li><strong>分布式信任</strong>：没有中央信任机构，信任关系分布在网络节点中</li>
<li><strong>信任链</strong>：通过信任链传递信任关系</li>
<li><strong>信任度量</strong>：基于节点行为的信任度评估</li>
<li><strong>信任传播</strong>：在Group内传播信任信息</li>
</ul>
<h4 data-id="heading-19">信任管理流程图</h4>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/349f74758ebe4c5fa8c810b6ae9733e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770124779&amp;x-signature=KJ%2FHsjSy9m0WMPOyJ4eAuMs3MbE%3D" alt="节点行为 信任度评估 信任更新 信任传播 信任网络 访问控制" loading="lazy"/></p>
<p>​</p>
<h2 data-id="heading-20">五、技术实现细节</h2>
<h3 data-id="heading-21">5.1 核心组件实现</h3>


















































<table><thead><tr><th align="left">组件</th><th align="left">职责</th><th align="left">关键功能</th></tr></thead><tbody><tr><td align="left">RouteAgentManager</td><td align="left">管理Route Agent对等网络</td><td align="left">对等发现、安全密钥交换、临时Group管理</td></tr><tr><td align="left">MCPClientService</td><td align="left">处理与MCP Agent的连接</td><td align="left">密钥下发、连接管理、权限验证</td></tr><tr><td align="left">CAPManager</td><td align="left">管理End Agent的连接访问点</td><td align="left">CAP创建、存储、验证、快速重连</td></tr><tr><td align="left">SecurityService</td><td align="left">加密、签名和安全策略管理</td><td align="left">密钥生成、数据加密、签名验证</td></tr><tr><td align="left">DiscoveryService</td><td align="left">节点和网络的自动发现</td><td align="left">UDP广播、节点列表交换、网络拓扑构建</td></tr><tr><td align="left">GroupManager</td><td align="left">Group管理</td><td align="left">Group创建、成员管理、安全策略配置</td></tr><tr><td align="left">SceneManager</td><td align="left">Scene管理</td><td align="left">Scene创建、规则配置、通信隔离</td></tr><tr><td align="left">TrustManager</td><td align="left">信任管理</td><td align="left">信任度评估、信任传播、异常检测</td></tr></tbody></table>
<h3 data-id="heading-22">5.2 关键消息格式</h3>
<h4 data-id="heading-23">Route Agent对等网络发现消息</h4>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"ROUTE_AGENT_DISCOVERY"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>,
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"2026-01-27T12:00:00Z"</span>,
  <span class="hljs-string">"sender"</span>: <span class="hljs-string">"route_agent_id"</span>,
  <span class="hljs-string">"payload"</span>: {
    <span class="hljs-string">"scene_ids"</span>: [<span class="hljs-string">"scene1"</span>, <span class="hljs-string">"scene2"</span>],
    <span class="hljs-string">"capabilities"</span>: [<span class="hljs-string">"routing"</span>, <span class="hljs-string">"security"</span>],
    <span class="hljs-string">"mcp_agent_id"</span>: <span class="hljs-string">"mcp_agent_id"</span>
  },
  <span class="hljs-string">"signature"</span>: <span class="hljs-string">"digital_signature"</span>
}
</code></pre>
<h4 data-id="heading-24">安全密钥广播消息</h4>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"SECURITY_KEY_BROADCAST"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>,
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"2026-01-27T12:00:00Z"</span>,
  <span class="hljs-string">"sender"</span>: <span class="hljs-string">"route_agent_id"</span>,
  <span class="hljs-string">"payload"</span>: {
    <span class="hljs-string">"group_id"</span>: <span class="hljs-string">"group_uuid"</span>,
    <span class="hljs-string">"security_key"</span>: <span class="hljs-string">"encrypted_security_key"</span>,
    <span class="hljs-string">"key_expiry"</span>: <span class="hljs-string">"2026-01-28T12:00:00Z"</span>
  },
  <span class="hljs-string">"signature"</span>: <span class="hljs-string">"digital_signature"</span>
}
</code></pre>
<h4 data-id="heading-25">End Agent CAP创建消息</h4>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"CAP_CREATE"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>,
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"2026-01-27T12:00:00Z"</span>,
  <span class="hljs-string">"sender"</span>: <span class="hljs-string">"end_agent_id"</span>,
  <span class="hljs-string">"payload"</span>: {
    <span class="hljs-string">"group_id"</span>: <span class="hljs-string">"group_uuid"</span>,
    <span class="hljs-string">"link_info"</span>: {
      <span class="hljs-string">"route_agent_id"</span>: <span class="hljs-string">"route_agent_id"</span>,
      <span class="hljs-string">"ip_address"</span>: <span class="hljs-string">"192.168.1.100"</span>,
      <span class="hljs-string">"port"</span>: <span class="hljs-number">7777</span>,
      <span class="hljs-string">"protocol"</span>: <span class="hljs-string">"tcp"</span>
    },
    <span class="hljs-string">"security_key"</span>: <span class="hljs-string">"encrypted_security_key"</span>
  },
  <span class="hljs-string">"signature"</span>: <span class="hljs-string">"digital_signature"</span>
}
</code></pre>
<h4 data-id="heading-26">MCP Agent加入消息</h4>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"MCP_AGENT_JOIN"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>,
  <span class="hljs-string">"timestamp"</span>: <span class="hljs-string">"2026-01-27T12:00:00Z"</span>,
  <span class="hljs-string">"sender"</span>: <span class="hljs-string">"route_agent_id"</span>,
  <span class="hljs-string">"receiver"</span>: <span class="hljs-string">"mcp_agent_id"</span>,
  <span class="hljs-string">"payload"</span>: {
    <span class="hljs-string">"route_agent_id"</span>: <span class="hljs-string">"route_agent_id"</span>,
    <span class="hljs-string">"capabilities"</span>: [<span class="hljs-string">"routing"</span>, <span class="hljs-string">"security"</span>],
    <span class="hljs-string">"auth_info"</span>: <span class="hljs-string">"encrypted_auth_info"</span>
  },
  <span class="hljs-string">"signature"</span>: <span class="hljs-string">"digital_signature"</span>
}
</code></pre>
<h3 data-id="heading-27">5.3 关键接口设计</h3>



















































































<table><thead><tr><th align="left">接口</th><th align="left">功能</th><th align="left">参数</th><th align="left">返回值</th></tr></thead><tbody><tr><td align="left">joinMCPAgent()</td><td align="left">Route Agent加入MCP Agent</td><td align="left">MCP Agent地址, 认证信息</td><td align="left">加入结果</td></tr><tr><td align="left">createRouteAgentPeerNetwork()</td><td align="left">创建Route Agent对等网络</td><td align="left">Route Agent列表</td><td align="left">网络ID</td></tr><tr><td align="left">broadcastSecurityKey()</td><td align="left">广播安全密钥</td><td align="left">Group ID, 安全密钥</td><td align="left">广播结果</td></tr><tr><td align="left">createCAP()</td><td align="left">创建End Agent CAP</td><td align="left">Group ID, 安全密钥, 链路信息</td><td align="left">CAP ID</td></tr><tr><td align="left">joinNetworkWithCAP()</td><td align="left">使用CAP加入网络</td><td align="left">CAP ID, CAP信息</td><td align="left">加入结果</td></tr><tr><td align="left">getMCPClientStatus()</td><td align="left">获取MCP Agent客户端状态</td><td align="left">无</td><td align="left">状态信息</td></tr><tr><td align="left">createGroup()</td><td align="left">创建新的Group</td><td align="left">Group元数据</td><td align="left">Group ID</td></tr><tr><td align="left">joinGroup()</td><td align="left">加入指定Group</td><td align="left">Group ID, 邀请码</td><td align="left">加入结果</td></tr><tr><td align="left">createScene()</td><td align="left">在Group内创建Scene</td><td align="left">Group ID, Scene元数据</td><td align="left">Scene ID</td></tr><tr><td align="left">joinScene()</td><td align="left">加入指定Scene</td><td align="left">Group ID, Scene ID</td><td align="left">加入结果</td></tr><tr><td align="left">getTrustLevel()</td><td align="left">获取节点信任度</td><td align="left">节点ID</td><td align="left">信任度值</td></tr><tr><td align="left">updateTrustLevel()</td><td align="left">更新节点信任度</td><td align="left">节点ID, 信任度变化</td><td align="left">更新结果</td></tr></tbody></table>
<h3 data-id="heading-28">5.4 代码实现示例</h3>
<h4 data-id="heading-29">EndAgent实现示例</h4>
<pre><code class="hljs language-javascript" lang="javascript">package net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">agent</span>.<span class="hljs-property">impl</span>;

<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">agent</span>.<span class="hljs-property">EndAgent</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">packet</span>.<span class="hljs-property">TaskPacket</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">packet</span>.<span class="hljs-property">ResponsePacket</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">packet</span>.<span class="hljs-property">ResponsePacketBuilder</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">network</span>.<span class="hljs-property">udp</span>.<span class="hljs-property">UDPSDK</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">enums</span>.<span class="hljs-property">EndAgentStatus</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">enums</span>.<span class="hljs-property">ResponseStatus</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">security</span>.<span class="hljs-property">EncryptionUtil</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">Logger</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">LoggerFactory</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">CompletableFuture</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">ExecutorService</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">Executors</span>;

public <span class="hljs-keyword">class</span> <span class="hljs-title class_">EndAgentImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AbstractEndAgent</span> {
    private <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Logger</span> log = <span class="hljs-title class_">LoggerFactory</span>.<span class="hljs-title function_">getLogger</span>(<span class="hljs-title class_">EndAgentImpl</span>.<span class="hljs-property">class</span>);
    private final <span class="hljs-title class_">Map</span> taskCache;
    
    public <span class="hljs-title class_">EndAgentImpl</span>(<span class="hljs-variable constant_">UDPSDK</span> udpSDK, <span class="hljs-title class_">String</span> agentId, <span class="hljs-title class_">String</span> agentName, <span class="hljs-title class_">Map</span> capabilities) {
        <span class="hljs-variable language_">super</span>(udpSDK, agentId, agentName, <span class="hljs-string">"EndAgent"</span>, capabilities);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">taskCache</span> = <span class="hljs-keyword">new</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">ConcurrentHashMap</span>&lt;&gt;();
    }
    
    @<span class="hljs-title class_">Override</span>
    protected <span class="hljs-title class_">ResponsePacket</span> <span class="hljs-title function_">createResponse</span>(<span class="hljs-params">TaskPacket taskPacket, boolean success, <span class="hljs-built_in">String</span> message</span>) {
        <span class="hljs-comment">// 缓存任务</span>
        taskCache.<span class="hljs-title function_">put</span>(taskPacket.<span class="hljs-title function_">getTaskId</span>(), taskPacket);
        
        <span class="hljs-comment">// 创建响应</span>
        <span class="hljs-title class_">ResponseStatus</span> status = success ? <span class="hljs-title class_">ResponseStatus</span>.<span class="hljs-property">SUCCESS</span> : <span class="hljs-title class_">ResponseStatus</span>.<span class="hljs-property">FAILURE</span>;
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponsePacketBuilder</span>.<span class="hljs-title function_">builder</span>()
            .<span class="hljs-title function_">taskId</span>(taskPacket.<span class="hljs-title function_">getTaskId</span>())
            .<span class="hljs-title function_">status</span>(status)
            .<span class="hljs-title function_">message</span>(message)
            .<span class="hljs-title function_">data</span>(<span class="hljs-title function_">processTaskData</span>(taskPacket))
            .<span class="hljs-title function_">timestamp</span>(<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>())
            .<span class="hljs-title function_">build</span>();
    }
    
    private <span class="hljs-title class_">String</span> <span class="hljs-title function_">processTaskData</span>(<span class="hljs-params">TaskPacket taskPacket</span>) {
        <span class="hljs-comment">// 根据任务类型处理数据</span>
        <span class="hljs-title class_">String</span> taskType = taskPacket.<span class="hljs-title function_">getTaskType</span>();
        <span class="hljs-title class_">Map</span> params = taskPacket.<span class="hljs-title function_">getParams</span>();
        
        <span class="hljs-keyword">switch</span> (taskType) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"skill_invoke"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">processSkillInvoke</span>(params);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"data_collection"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">processDataCollection</span>(params);
            <span class="hljs-keyword">case</span> <span class="hljs-string">"device_control"</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">processDeviceControl</span>(params);
            <span class="hljs-attr">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Unknown task type: "</span> + taskType;
        }
    }
    
    private <span class="hljs-title class_">String</span> <span class="hljs-title function_">processSkillInvoke</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span> params</span>) {
        <span class="hljs-title class_">String</span> skillName = (<span class="hljs-title class_">String</span>) params.<span class="hljs-title function_">get</span>(<span class="hljs-string">"skill"</span>);
        <span class="hljs-title class_">Map</span> skillParams = (<span class="hljs-title class_">Map</span>) params.<span class="hljs-title function_">get</span>(<span class="hljs-string">"params"</span>);
        
        <span class="hljs-comment">// 调用技能逻辑</span>
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Invoking skill: {} with params: {}"</span>, skillName, skillParams);
        
        <span class="hljs-comment">// 模拟技能执行</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Skill "</span> + skillName + <span class="hljs-string">" invoked successfully"</span>;
    }
    
    private <span class="hljs-title class_">String</span> <span class="hljs-title function_">processDataCollection</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span> params</span>) {
        <span class="hljs-title class_">String</span> dataType = (<span class="hljs-title class_">String</span>) params.<span class="hljs-title function_">get</span>(<span class="hljs-string">"dataType"</span>);
        
        <span class="hljs-comment">// 数据采集逻辑</span>
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Collecting data of type: {}"</span>, dataType);
        
        <span class="hljs-comment">// 模拟数据采集</span>
        <span class="hljs-title class_">Map</span> collectedData = <span class="hljs-keyword">new</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">HashMap</span>&lt;&gt;();
        collectedData.<span class="hljs-title function_">put</span>(<span class="hljs-string">"type"</span>, dataType);
        collectedData.<span class="hljs-title function_">put</span>(<span class="hljs-string">"timestamp"</span>, <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>());
        collectedData.<span class="hljs-title function_">put</span>(<span class="hljs-string">"value"</span>, <span class="hljs-string">"Sample data"</span>);
        
        <span class="hljs-keyword">return</span> collectedData.<span class="hljs-title function_">toString</span>();
    }
    
    private <span class="hljs-title class_">String</span> <span class="hljs-title function_">processDeviceControl</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span> params</span>) {
        <span class="hljs-title class_">String</span> deviceId = (<span class="hljs-title class_">String</span>) params.<span class="hljs-title function_">get</span>(<span class="hljs-string">"deviceId"</span>);
        <span class="hljs-title class_">String</span> command = (<span class="hljs-title class_">String</span>) params.<span class="hljs-title function_">get</span>(<span class="hljs-string">"command"</span>);
        
        <span class="hljs-comment">// 设备控制逻辑</span>
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Controlling device {} with command: {}"</span>, deviceId, command);
        
        <span class="hljs-comment">// 模拟设备控制</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Device "</span> + deviceId + <span class="hljs-string">" controlled with command: "</span> + command;
    }
}
</code></pre>
<h4 data-id="heading-30">RouteAgent实现示例</h4>
<pre><code class="hljs language-javascript" lang="javascript">package net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">agent</span>.<span class="hljs-property">impl</span>;

<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">agent</span>.<span class="hljs-property">RouteAgent</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">packet</span>.<span class="hljs-property">AuthPacket</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">packet</span>.<span class="hljs-property">TaskPacket</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">packet</span>.<span class="hljs-property">RoutePacket</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">network</span>.<span class="hljs-property">udp</span>.<span class="hljs-property">SendResult</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">network</span>.<span class="hljs-property">udp</span>.<span class="hljs-property">UDPSDK</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">scene</span>.<span class="hljs-property">SceneDefinition</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">scene</span>.<span class="hljs-property">SceneMember</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">security</span>.<span class="hljs-property">EncryptionUtil</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">Logger</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">LoggerFactory</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">List</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">CompletableFuture</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">atomic</span>.<span class="hljs-property">AtomicBoolean</span>;

public <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouteAgentImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AbstractRouteAgent</span> {
    private <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Logger</span> log = <span class="hljs-title class_">LoggerFactory</span>.<span class="hljs-title function_">getLogger</span>(<span class="hljs-title class_">RouteAgentImpl</span>.<span class="hljs-property">class</span>);
    private final <span class="hljs-title class_">Map</span> forwardedTasks;
    
    public <span class="hljs-title class_">RouteAgentImpl</span>(<span class="hljs-variable constant_">UDPSDK</span> udpSDK, <span class="hljs-title class_">String</span> agentId, <span class="hljs-title class_">String</span> agentName, <span class="hljs-title class_">Map</span> capabilities) {
        <span class="hljs-variable language_">super</span>(udpSDK, agentId, agentName, capabilities);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">forwardedTasks</span> = <span class="hljs-keyword">new</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">ConcurrentHashMap</span>&lt;&gt;();
    }
    
    @<span class="hljs-title class_">Override</span>
    public <span class="hljs-title class_">CompletableFuture</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> targetMcpId</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">supplyAsync</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Registering RouteAgent {} to MCP Agent {}"</span>, <span class="hljs-title function_">getAgentId</span>(), targetMcpId);
                
                <span class="hljs-comment">// 生成认证数据包</span>
                <span class="hljs-title class_">AuthPacket</span> authPacket = <span class="hljs-title class_">AuthPacket</span>.<span class="hljs-title function_">builder</span>()
                    .<span class="hljs-title function_">agentId</span>(<span class="hljs-title function_">getAgentId</span>())
                    .<span class="hljs-title function_">agentName</span>(<span class="hljs-title function_">getAgentName</span>())
                    .<span class="hljs-title function_">agentType</span>(<span class="hljs-title function_">getAgentType</span>())
                    .<span class="hljs-title function_">capabilities</span>(<span class="hljs-title function_">getCapabilities</span>())
                    .<span class="hljs-title function_">timestamp</span>(<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>())
                    .<span class="hljs-title function_">build</span>();
                
                <span class="hljs-comment">// 加密认证数据</span>
                <span class="hljs-title class_">String</span> encryptedData = <span class="hljs-title class_">EncryptionUtil</span>.<span class="hljs-title function_">encrypt</span>(authPacket.<span class="hljs-title function_">toString</span>(), <span class="hljs-title function_">getEncryptionKey</span>());
                authPacket.<span class="hljs-title function_">setEncryptedData</span>(encryptedData);
                
                <span class="hljs-comment">// 发送注册请求</span>
                <span class="hljs-title class_">SendResult</span> result = <span class="hljs-title function_">getUdpSDK</span>().<span class="hljs-title function_">sendAuthRequest</span>(targetMcpId, authPacket);
                
                <span class="hljs-keyword">if</span> (result.<span class="hljs-title function_">isSuccess</span>()) {
                    <span class="hljs-title function_">setMcpAgentId</span>(targetMcpId);
                    <span class="hljs-title function_">setRegistered</span>(<span class="hljs-literal">true</span>);
                    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"RouteAgent {} registered successfully to MCP Agent {}"</span>, <span class="hljs-title function_">getAgentId</span>(), targetMcpId);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">else</span> {
                    log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Failed to register RouteAgent {}: {}"</span>, <span class="hljs-title function_">getAgentId</span>(), result.<span class="hljs-title function_">getMessage</span>());
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error registering RouteAgent: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }, <span class="hljs-title function_">getExecutorService</span>());
    }
    
    @<span class="hljs-title class_">Override</span>
    public <span class="hljs-title class_">CompletableFuture</span> <span class="hljs-title function_">forwardTask</span>(<span class="hljs-params">TaskPacket taskPacket, <span class="hljs-built_in">String</span> endAgentId</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">supplyAsync</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Forwarding task {} from EndAgent {} via RouteAgent {}"</span>, 
                    taskPacket.<span class="hljs-title function_">getTaskId</span>(), endAgentId, <span class="hljs-title function_">getAgentId</span>());
                
                <span class="hljs-comment">// 缓存转发的任务</span>
                forwardedTasks.<span class="hljs-title function_">put</span>(taskPacket.<span class="hljs-title function_">getTaskId</span>(), taskPacket);
                
                <span class="hljs-comment">// 检查EndAgent是否在线</span>
                <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">getEndAgentRoutes</span>().<span class="hljs-title function_">containsKey</span>(endAgentId)) {
                    log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"EndAgent {} not found in route table"</span>, endAgentId);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendResult</span>(<span class="hljs-literal">false</span>, <span class="hljs-string">"EndAgent not found"</span>);
                }
                
                <span class="hljs-comment">// 转发任务</span>
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">getUdpSDK</span>().<span class="hljs-title function_">forwardTask</span>(taskPacket, endAgentId);
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error forwarding task: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendResult</span>(<span class="hljs-literal">false</span>, e.<span class="hljs-title function_">getMessage</span>());
            }
        }, <span class="hljs-title function_">getExecutorService</span>());
    }
}
</code></pre>
<h4 data-id="heading-31">P2P网络发现实现示例</h4>
<pre><code class="hljs language-javascript" lang="javascript">package net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">network</span>.<span class="hljs-property">discovery</span>;

<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">network</span>.<span class="hljs-property">udp</span>.<span class="hljs-property">UDPSDK</span>;
<span class="hljs-keyword">import</span> net.<span class="hljs-property">ooder</span>.<span class="hljs-property">sdk</span>.<span class="hljs-property">packet</span>.<span class="hljs-property">DiscoveryPacket</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">Logger</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">LoggerFactory</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">net</span>.<span class="hljs-property">DatagramPacket</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">net</span>.<span class="hljs-property">DatagramSocket</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">net</span>.<span class="hljs-property">InetAddress</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">CompletableFuture</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">ExecutorService</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">Executors</span>;

public <span class="hljs-keyword">class</span> <span class="hljs-title class_">P2PDiscoveryService</span> {
    private <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Logger</span> log = <span class="hljs-title class_">LoggerFactory</span>.<span class="hljs-title function_">getLogger</span>(P2PDiscoveryService.<span class="hljs-property">class</span>);
    private <span class="hljs-keyword">static</span> final int <span class="hljs-variable constant_">DISCOVERY_PORT</span> = <span class="hljs-number">7777</span>;
    private <span class="hljs-keyword">static</span> final int <span class="hljs-variable constant_">DISCOVERY_INTERVAL</span> = <span class="hljs-number">5000</span>; <span class="hljs-comment">// 5秒</span>
    private final <span class="hljs-variable constant_">UDPSDK</span> udpSDK;
    private final <span class="hljs-title class_">ExecutorService</span> executorService;
    private volatile boolean running;
    
    public <span class="hljs-title function_">P2PDiscoveryService</span>(<span class="hljs-params">UDPSDK udpSDK</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">udpSDK</span> = udpSDK;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">executorService</span> = <span class="hljs-title class_">Executors</span>.<span class="hljs-title function_">newSingleThreadExecutor</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">running</span> = <span class="hljs-literal">false</span>;
    }
    
    public <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
        running = <span class="hljs-literal">true</span>;
        executorService.<span class="hljs-title function_">submit</span>(<span class="hljs-attr">this</span>::discoveryLoop);
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"P2P discovery service started"</span>);
    }
    
    public <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
        running = <span class="hljs-literal">false</span>;
        executorService.<span class="hljs-title function_">shutdown</span>();
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"P2P discovery service stopped"</span>);
    }
    
    private <span class="hljs-keyword">void</span> <span class="hljs-title function_">discoveryLoop</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> (<span class="hljs-title class_">DatagramSocket</span> socket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatagramSocket</span>()) {
            socket.<span class="hljs-title function_">setBroadcast</span>(<span class="hljs-literal">true</span>);
            
            <span class="hljs-keyword">while</span> (running) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 发送发现广播</span>
                    <span class="hljs-title function_">sendDiscoveryBroadcast</span>(socket);
                    
                    <span class="hljs-comment">// 接收响应</span>
                    <span class="hljs-title function_">receiveDiscoveryResponses</span>(socket);
                    
                    <span class="hljs-comment">// 等待下一次发现</span>
                    <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-variable constant_">DISCOVERY_INTERVAL</span>);
                } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
                    <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
                    <span class="hljs-keyword">break</span>;
                } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                    log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error in discovery loop: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
                }
            }
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error starting discovery service: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
        }
    }
    
    private <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDiscoveryBroadcast</span>(<span class="hljs-title class_">DatagramSocket</span> socket) throws <span class="hljs-title class_">Exception</span> {
        <span class="hljs-title class_">DiscoveryPacket</span> packet = <span class="hljs-title class_">DiscoveryPacket</span>.<span class="hljs-title function_">builder</span>()
            .<span class="hljs-title function_">type</span>(<span class="hljs-string">"DISCOVERY_REQUEST"</span>)
            .<span class="hljs-title function_">senderId</span>(udpSDK.<span class="hljs-title function_">getAgentId</span>())
            .<span class="hljs-title function_">senderType</span>(udpSDK.<span class="hljs-title function_">getAgentType</span>())
            .<span class="hljs-title function_">timestamp</span>(<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>())
            .<span class="hljs-title function_">build</span>();
        
        byte[] data = packet.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">getBytes</span>();
        <span class="hljs-title class_">DatagramPacket</span> datagramPacket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatagramPacket</span>(
            data, data.<span class="hljs-property">length</span>,
            <span class="hljs-title class_">InetAddress</span>.<span class="hljs-title function_">getByName</span>(<span class="hljs-string">"255.255.255.255"</span>),
            <span class="hljs-variable constant_">DISCOVERY_PORT</span>
        );
        
        socket.<span class="hljs-title function_">send</span>(datagramPacket);
        log.<span class="hljs-title function_">debug</span>(<span class="hljs-string">"Sent discovery broadcast"</span>);
    }
    
    private <span class="hljs-keyword">void</span> <span class="hljs-title function_">receiveDiscoveryResponses</span>(<span class="hljs-title class_">DatagramSocket</span> socket) throws <span class="hljs-title class_">Exception</span> {
        byte[] buffer = <span class="hljs-keyword">new</span> byte[<span class="hljs-number">4096</span>];
        <span class="hljs-title class_">DatagramPacket</span> packet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatagramPacket</span>(buffer, buffer.<span class="hljs-property">length</span>);
        
        socket.<span class="hljs-title function_">setSoTimeout</span>(<span class="hljs-number">1000</span>);
        <span class="hljs-keyword">try</span> {
            socket.<span class="hljs-title function_">receive</span>(packet);
            <span class="hljs-title class_">String</span> response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(packet.<span class="hljs-title function_">getData</span>(), <span class="hljs-number">0</span>, packet.<span class="hljs-title function_">getLength</span>());
            log.<span class="hljs-title function_">debug</span>(<span class="hljs-string">"Received discovery response: {}"</span>, response);
            
            <span class="hljs-comment">// 处理响应</span>
            <span class="hljs-title function_">processDiscoveryResponse</span>(response, packet.<span class="hljs-title function_">getAddress</span>());
        } <span class="hljs-keyword">catch</span> (java.<span class="hljs-property">net</span>.<span class="hljs-property">SocketTimeoutException</span> e) {
            <span class="hljs-comment">// 正常超时，继续</span>
        }
    }
    
    private <span class="hljs-keyword">void</span> <span class="hljs-title function_">processDiscoveryResponse</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> response, InetAddress address</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">DiscoveryPacket</span> packet = <span class="hljs-title class_">DiscoveryPacket</span>.<span class="hljs-title function_">fromString</span>(response);
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"DISCOVERY_RESPONSE"</span>.<span class="hljs-title function_">equals</span>(packet.<span class="hljs-title function_">getType</span>())) {
                log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Discovered peer: {} ({}) at {}"</span>, 
                    packet.<span class="hljs-title function_">getSenderId</span>(), packet.<span class="hljs-title function_">getSenderType</span>(), address.<span class="hljs-title function_">getHostAddress</span>());
                
                <span class="hljs-comment">// 添加到对等节点列表</span>
                udpSDK.<span class="hljs-title function_">addPeer</span>(packet.<span class="hljs-title function_">getSenderId</span>(), address.<span class="hljs-title function_">getHostAddress</span>());
            }
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error processing discovery response: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
        }
    }
}
</code></pre>
<h2 data-id="heading-32">六、安全认证流程</h2>
<h3 data-id="heading-33">6.1 首次入网安全认证</h3>
<ol>
<li><strong>邀请码验证</strong>：
<ul>
<li>邀请码包含Group ID、过期时间、数字签名</li>
<li>使用HMAC-SHA256验证邀请码完整性</li>
<li>检查邀请码是否在有效期内</li>
</ul>
</li>
<li><strong>节点身份认证</strong>：
<ul>
<li>节点生成ECDSA密钥对</li>
<li>使用临时认证令牌加密节点公钥</li>
<li>Group管理节点验证节点签名</li>
</ul>
</li>
<li><strong>安全通道建立</strong>：
<ul>
<li>使用ECDH协议交换会话密钥</li>
<li>建立TLS 1.3加密通道</li>
<li>验证Group证书链</li>
</ul>
</li>
<li><strong>网络配置分发</strong>：
<ul>
<li>分发Group元数据和安全策略</li>
<li>提供网络拓扑信息</li>
<li>配置节点的Group/Scene权限</li>
</ul>
</li>
</ol>
<h3 data-id="heading-34">6.2 信任网络内自动入网</h3>
<ol>
<li><strong>网络发现</strong>：
<ul>
<li>节点启动时发送UDP广播</li>
<li>接收其他节点的响应</li>
<li>发现可用的Group和Scene</li>
</ul>
</li>
<li><strong>CAP验证</strong>：
<ul>
<li>End Agent读取存储的CAP信息</li>
<li>发送入网请求，携带CAP信息</li>
<li>Route Agent验证CAP信息有效性</li>
</ul>
</li>
<li><strong>认证挑战</strong>：
<ul>
<li>Route Agent发送认证挑战</li>
<li>End Agent使用CAP中的密钥生成响应</li>
<li>Route Agent验证响应有效性</li>
</ul>
</li>
<li><strong>入网确认</strong>：
<ul>
<li>Route Agent发送入网确认</li>
<li>End Agent注册节点状态</li>
<li>Route Agent更新节点状态</li>
</ul>
</li>
</ol>
<h2 data-id="heading-35">七、性能优化策略</h2>
<h3 data-id="heading-36">7.1 网络优化</h3>
<ul>
<li><strong>连接池</strong>：维护节点连接池，减少连接建立开销</li>
<li><strong>消息压缩</strong>：对大型消息进行压缩，减少网络传输量</li>
<li><strong>批量处理</strong>：合并多个小消息，减少网络往返</li>
<li><strong>流量控制</strong>：实现自适应流量控制，避免网络拥塞</li>
</ul>
<h3 data-id="heading-37">7.2 安全优化</h3>
<ul>
<li><strong>密钥管理</strong>：定期更新安全密钥，减少密钥泄露风险</li>
<li><strong>认证优化</strong>：使用CAP机制，减少认证时间，提高入网速度</li>
<li><strong>信任管理</strong>：基于节点行为的信任度评估，优化网络安全</li>
<li><strong>资源限制</strong>：设置合理的资源限制，防止DoS攻击</li>
</ul>
<h3 data-id="heading-38">7.3 可靠性优化</h3>
<ul>
<li><strong>冗余路由</strong>：Route Agent对等网络提供冗余路由，提高可靠性</li>
<li><strong>故障转移</strong>：当节点故障时，自动切换到备用节点</li>
<li><strong>网络分区</strong>：检测网络分区，在分区恢复后自动重连</li>
<li><strong>状态同步</strong>：定期同步节点状态，确保网络一致性</li>
</ul>
<h2 data-id="heading-39">八、部署与实践</h2>
<h3 data-id="heading-40">8.1 网络规划</h3>
<p>ooderAgent的网络规划围绕着自组网完成，Route Agent以场景为中心，一个Route Agent可以声明支持多个场景，但这会增加系统复杂度。</p>
<ol>
<li><strong>家庭网络</strong>：
<ul>
<li>适合个人用户或小型家庭网络</li>
<li>默认启用无MCP 0信任模式，网络本身安全</li>
<li>建议部署1-2个Route Agent，形成对等网络</li>
<li>节点数不超过20个，适合家庭设备自动发现和入网</li>
</ul>
</li>
<li><strong>企业网络</strong>：
<ul>
<li>适合小型企业或部门网络</li>
<li>只有在明确需要建立安全机制时才会开启MCP的安全认证</li>
<li>不需要独立的服务器，可在现有网络设备上部署MCP功能</li>
<li>主要用于入网管理和配置安全策略</li>
<li>建议部署2-3个Route Agent，按功能或区域划分场景</li>
</ul>
</li>
<li><strong>教育机构网络</strong>：
<ul>
<li>适合校园或教育机构网络</li>
<li>可根据需要部署MCP Agent进行集中管理</li>
<li>多个Route Agent按教学楼、图书馆、实验室等场景划分</li>
<li>支持大规模设备的自动管理和智能教学应用</li>
</ul>
</li>
</ol>
<h3 data-id="heading-41">8.2 安全配置</h3>
<ul>
<li><strong>启用TLS加密</strong>：保护节点间通信</li>
<li><strong>设置强密码策略</strong>：使用强密码和多因素认证</li>
<li><strong>配置防火墙</strong>：开放必要的端口，限制访问</li>
<li><strong>定期安全审计</strong>：检查网络安全状态，发现潜在风险</li>
</ul>
<h3 data-id="heading-42">8.3 监控与维护</h3>
<ul>
<li><strong>网络监控</strong>：监控节点状态、网络拓扑和流量</li>
<li><strong>安全监控</strong>：监控安全事件、异常行为和攻击尝试</li>
<li><strong>性能监控</strong>：监控网络性能、响应时间和资源使用</li>
<li><strong>日志管理</strong>：集中管理日志，便于故障排查和安全审计</li>
</ul>
<h2 data-id="heading-43">九、场景案例分析</h2>
<h3 data-id="heading-44">9.1 家庭网络场景</h3>
<h4 data-id="heading-45">部署方案</h4>
<ul>
<li>1个MCP Agent（家庭服务器）</li>
<li>1-2个Route Agent（家庭网关、智能路由器）</li>
<li>多个End Agent（智能手机、平板电脑、智能电视、智能家居设备等）</li>
</ul>
<h4 data-id="heading-46">安全策略</h4>
<ul>
<li>使用强密码保护MCP Agent</li>
<li>定期更新安全密钥</li>
<li>启用TLS加密保护通信</li>
<li>限制外部访问，只允许家庭网络内的设备入网</li>
</ul>
<h4 data-id="heading-47">应用场景</h4>
<ul>
<li><strong>智能家庭控制</strong>：通过End Agent控制智能家居设备，如灯光、空调、安防系统等</li>
<li><strong>家庭成员协作</strong>：共享AI技能和任务，如家庭日程管理、购物清单同步等</li>
<li><strong>媒体共享</strong>：安全共享家庭媒体内容，如照片、视频等</li>
</ul>
<h4 data-id="heading-48">优势</h4>
<ul>
<li>设备自动发现和入网，无需手动配置</li>
<li>安全的技能共享和调用</li>
<li>离线时使用CAP信息快速重连</li>
<li>适应家庭网络的动态变化</li>
</ul>
<h4 data-id="heading-49">家庭网络场景拓扑图</h4>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a2de23a4fd34b29a00588a58d027518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770124779&amp;x-signature=LWfYx2Lnj6um56KUnwGjTkA8yCY%3D" alt="家庭服务器 MCP Agent 家庭网关 Route Agent 智能路由器 Route Agent 智能手机 End Agent 平板电脑 End Agent 智能电视 End Agent 智能家居设备 End Agent" loading="lazy"/></p>
<p>​</p>
<p>​</p>
<h3 data-id="heading-50">9.2 企业部门场景</h3>
<h4 data-id="heading-51">部署方案</h4>
<ul>
<li>1个MCP Agent（部门服务器）</li>
<li>2-3个Route Agent（部门网络节点）</li>
<li>多个End Agent（员工电脑、部门设备、会议系统等）</li>
</ul>
<h4 data-id="heading-52">安全策略</h4>
<ul>
<li>严格的身份认证和授权</li>
<li>基于角色的访问控制</li>
<li>定期安全审计和密钥更新</li>
<li>与企业现有安全系统集成</li>
</ul>
<h4 data-id="heading-53">应用场景</h4>
<ul>
<li><strong>部门协作</strong>：团队成员共享AI技能和工作任务，如文档处理、数据分析等</li>
<li><strong>会议管理</strong>：智能会议系统通过End Agent与其他设备协作，实现自动化会议管理</li>
<li><strong>设备监控</strong>：通过End Agent监控部门设备状态，及时发现和处理问题</li>
</ul>
<h4 data-id="heading-54">优势</h4>
<ul>
<li>部门内部的安全通信</li>
<li>技能的安全共享和调用</li>
<li>高可靠性和容错能力</li>
<li>适应企业网络的复杂环境</li>
</ul>
<h4 data-id="heading-55">企业部门场景拓扑图</h4>
<p>​</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a8927335739487493318d3c099b7f83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770124779&amp;x-signature=xAzcRqyg%2BukLBPvBfGqYRl0M09E%3D" alt="部门服务器 MCP Agent 部门网络节点1 Route Agent 部门网络节点2 Route Agent 部门网络节点3 Route Agent 员工电脑1 End Agent 员工电脑2 End Agent 会议系统 End Agent 部门设备 End Agent" loading="lazy"/></p>
<p>​</p>
<p>​</p>
<h3 data-id="heading-56">9.3 教育机构场景</h3>
<h4 data-id="heading-57">部署方案</h4>
<ul>
<li>1个MCP Agent（校园服务器）</li>
<li>多个Route Agent（教学楼、图书馆、实验室等）</li>
<li>多个End Agent（学生电脑、教师设备、教学终端等）</li>
</ul>
<h4 data-id="heading-58">安全策略</h4>
<ul>
<li>基于角色的访问控制</li>
<li>内容过滤和安全审计</li>
<li>定期安全更新和漏洞扫描</li>
<li>与校园认证系统集成</li>
</ul>
<h4 data-id="heading-59">应用场景</h4>
<ul>
<li><strong>智能教学</strong>：教师通过End Agent发布教学内容，学生通过End Agent访问和提交作业</li>
<li><strong>资源共享</strong>：安全共享教学资源和AI模型</li>
<li><strong>校园服务</strong>：提供智能校园服务，如考勤、图书借阅等</li>
</ul>
<h4 data-id="heading-60">优势</h4>
<ul>
<li>大规模设备的自动管理</li>
<li>安全的教育资源共享</li>
<li>灵活的网络拓扑适应不同教学场景</li>
<li>高效的AI能力分发</li>
</ul>
<h2 data-id="heading-61">十、结论</h2>
<p>ooderAgent的P2P网络设计，通过多Agent协作机制和多层次安全架构，为分布式AI系统提供了高效、安全、可靠的通信基础。其设计充分考虑了实际应用场景的需求，支持从个人用户到大型企业的各种使用场景。</p>
<p>通过Route Agent对等网络、MCP Agent集中管理、End Agent CAP机制等设计，ooderAgent实现了P2P网络下的安全协作，为构建下一代分布式AI系统奠定了技术基础。</p>
<p>同时，我们也认识到P2P网络架构存在的一些潜在问题，如网络负载不均、安全风险、版权问题、合规挑战和技术复杂性等。通过本文提出的解决方案，我们可以进一步优化和完善ooderAgent的P2P网络设计，提高系统的可靠性、安全性和效率。</p>
<p>ooderAgent作为开源项目，欢迎社区贡献和改进，共同推动分布式AI技术的发展和应用。</p>
<h2 data-id="heading-62">十一、参考文献</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2Fprotocol-release%2Fv0.6.5%2Fp2p%2Fp2p-protocol.md" target="_blank" title="https://cloud.tencent.com/developer/article/protocol-release/v0.6.5/p2p/p2p-protocol.md" ref="nofollow noopener noreferrer">ooderAgent P2P网络协议文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2Fprotocol-release%2Fv0.6.5%2Fagent%2Fagent-protocol.md" target="_blank" title="https://cloud.tencent.com/developer/article/protocol-release/v0.6.5/agent/agent-protocol.md" ref="nofollow noopener noreferrer">Agent协议文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2Fp2p-group-scene-design.md" target="_blank" title="https://cloud.tencent.com/developer/article/p2p-group-scene-design.md" ref="nofollow noopener noreferrer">P2P网络下的Group/Scene设计修改文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc8446" target="_blank" title="https://tools.ietf.org/html/rfc8446" ref="nofollow noopener noreferrer">RFC 8446 - TLS 1.3</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc6090" target="_blank" title="https://tools.ietf.org/html/rfc6090" ref="nofollow noopener noreferrer">RFC 6090 - ECDH密钥交换</a></li>
</ul>
<p>© 2026 ooderAgent 开源项目</p>
<p>本文档基于 MIT 协议开源</p>
<p>最后更新时间：2026年1月27日</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零学习Kafka：集群架构和基本概念]]></title>    <link>https://juejin.cn/post/7599798118462111753</link>    <guid>https://juejin.cn/post/7599798118462111753</guid>    <pubDate>2026-01-27T13:48:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599798118462111753" data-draft-id="7599708108622348339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零学习Kafka：集群架构和基本概念"/> <meta itemprop="keywords" content="后端,Kafka"/> <meta itemprop="datePublished" content="2026-01-27T13:48:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零学习Kafka：集群架构和基本概念
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T13:48:16.000Z" title="Tue Jan 27 2026 13:48:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前文中，我们从源码层面介绍了 Flink 的 Kafka Connector 的实现。从本文开始，我们的目标也正式从 Flink 过渡到 Kafka。</p>
<h3 data-id="heading-0">什么是 Kafka</h3>
<p>Kafka 官方文档给出的定义是：Apache Kafka 是一个事件流平台。它的关键能力如下：</p>
<ol>
<li>发布（写入）和订阅（读取）事件流，包括从其他系统持续导入和导出数据。</li>
<li>将事件流持久可靠的存储，可以自定义时长。</li>
<li>实时处理事件流或历史回溯。</li>
</ol>
<p>我们通过一个最基础的场景来理解一下这些定义：系统 A 将数据发送给 Kafka，Kafka 会将数据进行持久化存储，系统 B 从 Kafka 中读取系统 A 发送的数据。那么这里有两个关键问题：一是如何设计事件的编码格式，二是使用什么样的传输协议。</p>
<p>关于编码格式，目前有很多成熟的方案，比如 Protocol Buffer、Thrift、JSON 等。而 Kafka 使用的是纯二进制的字节序列。</p>
<p>确定好了编码格式之后，我们再来看传输协议。常见的传输协议有两种：</p>
<ol>
<li>点对点模型：点对点模型也叫消息队列模型，即上游发送的数据只能由一个下游接收。对上面的场景来说，就是系统 A 发送的消息，只能由系统 B 接收。</li>
<li>发布/订阅模型：在这个模型中有 topic 的概念，会存在多个发布者向同一个 topic 发送消息，多个订阅者从 topic 读取消息的情况。</li>
</ol>
<p>Kafka 同时支持这两种模型，这点我们在后面会具体阐述。</p>
<p>现在知道了什么是 Kafka 之后，我们再来考虑另一个问题：为什么要使用 Kafka？</p>
<p>这个问题每个人可能会有不同的答案，对我而言，使用 Kafka 最主要的原因是做流量缓冲和数据同步。</p>
<p>流量缓冲是 Kafka 的应用场景之一，在上面的例子中，当系统 A 有很大的突增流量时，如果直接对接系统 B，那么瞬时流量很有可能直接把系统 B 打挂。而 Kafka 就可以在中间起到一个缓冲的作用。给系统 B 留出充足的处理时间，同时也避免了因为系统 B 崩溃可能导致的整个链路的雪崩问题。</p>
<p>数据同步在实际应用场景中更多与 Flink 结合，完成离线数据链路流转或者离线到在线的数据传输。</p>
<p>有了这些基本的背景信息之后，我们再来看一些 Kafka 的核心概念。</p>
<h3 data-id="heading-1">核心概念</h3>
<p>我们从一张图开始，对图中的概念逐个进行解释。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7badf0f59cd94109acf631fa3faefdbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770126495&amp;x-signature=mhr%2FlpnDO75dTTg5mK1DW0DmLxo%3D" alt="KafkaCluster" loading="lazy"/></p>
<p>首先是 Topic，在 Kafka 中发布和订阅的对象就是 Topic。通常我们按照业务来拆分，把不同业务的数据放在不同的 Topic 中。</p>
<p>Topic 的数据是由 Producer 生产的。Producer 即生产者程序，它和 Consumer 都可以被称为 Kafka 集群的客户端。Producer 负责把消息写入对应的 Topic 中，在写入时会选择对应的 Partition。</p>
<p>Partition 类似于 HBase 中的 region，它是用来支撑横向扩展的。当我们的消息量太大时，一个 Partition 存不下或者处理不过来，我们可以选择扩 Partition 的数量。利用多分区分散存储和处理请求的压力。你可能还注意到，Partition 还有 Leader 和 Follower 之分，这其实是 Kafka 的副本机制（Replica），它是 Kafka 高可用手段之一。每个分区都会有 1 个 Leader 副本和 n 个 Follower 副本，写入消息和消费消息都是由 Leader 副本执行，Follower 只负责向 Leader 副本发送请求，将最新的消息发送给它，这样与 Leader 副本保持同步。</p>
<p>在 Kafka 集群的服务端，由 Broker 进程对客户端的请求进行处理。将多个 Broker 集群分别部署在不同的机器上是 Kafka 的高可用手段之一。</p>
<p>前面我们提到了 Kafka 除了发布/订阅模型之外，还支持点对点模型，对于点对点模型的支持，Kafka 是引入了 Consumer Group 的概念。Consumer Group 是由多个 Consumer 组成，负责消费一组主题，这组主题中的每一个 Partition 只能由其中的一个 Consumer 消费。如果有新增的 Consumer 加入或者现有的 Consumer 崩溃，那么就会进行 Rebalance。</p>
<p>在消息写入和消费流程中，分别有 Offset 和 Consumer Offset 两个概念。Offset 是在分区中递增的。Consumer Offset 是消费者用来记录自己消费到了哪个 Offset。</p>
<p>最后再多提一点，Kafka Broker 是使用 Log 保存数据，Log 底层又分成了多个 Log Segment，消息在 Log Segment 上只能追加写入，当一个 Log Segment 写满后，就会创建新的 Log Segment 继续写入。Kafka 还会定期清理旧的 Log Segment，以此来节省磁盘空间。</p>
<h3 data-id="heading-2">总结</h3>
<p>本文我们先是简单介绍了什么是 Kafka，接着又介绍了几个核心概念。包括 Topic、Producer、Consumer、Consumer Group、Partition、Replica、Broker、Rebalance等。接下来让我们一起开始学习 Kafka 相关的知识吧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>