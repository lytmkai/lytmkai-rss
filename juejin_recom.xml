<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[告别 Vue 多分辨率适配烦恼：vfit 让元素定位 “丝滑” 跨设备]]></title>    <link>https://juejin.cn/post/7574992086715219983</link>    <guid>https://juejin.cn/post/7574992086715219983</guid>    <pubDate>2025-11-21T10:26:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086715219983" data-draft-id="7574803558878920719" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别 Vue 多分辨率适配烦恼：vfit 让元素定位 “丝滑” 跨设备 "/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-21T10:26:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一颗烂土豆"/> <meta itemprop="url" content="https://juejin.cn/user/764915822371912"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别 Vue 多分辨率适配烦恼：vfit 让元素定位 “丝滑” 跨设备 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915822371912/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一颗烂土豆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:26:54.000Z" title="Fri Nov 21 2025 10:26:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5648e0388884f619ad605cedbb0b2c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325614&amp;x-signature=vMD0rHwEAGQO%2BQMfMoK04HyJmAQ%3D" alt="pre-sales-poster.jpg" width="100%" loading="lazy"/>
在前端开发中，“多分辨率适配”一直是个绕不开的坎。尤其是Vue项目，面对从手机到大屏的各种设备，既要保证元素比例不变，又要让位置精准，往往需要手写大量缩放计算或媒体查询，代码冗余且难维护。
<p>今天推荐一个专为Vue 3设计的轻量方案——<strong>vfit</strong>，通过“全局缩放管理+组件化定位”的思路，让适配工作变得简单可控。</p>
<h4 data-id="heading-0">为什么需要vfit？</h4>
<p>传统适配方案（如rem、vw/vh）的痛点在于：</p>
<ul>
<li>• 仅能处理“大小”适配，难以保证“位置”在不同分辨率下的一致性；</li>
<li>• 需手动维护基准值，缩放逻辑与业务代码耦合；</li>
<li>• 对固定像素布局（如设计稿上精确到px的定位）支持不友好。</li>
</ul>
<p>vfit的解决思路更直接：</p>
<ol>
<li>以设计稿宽高（如1920×1080）为基准，实时计算容器的缩放比例（<code>scale = 容器尺寸 / 设计稿尺寸</code>）；</li>
<li>通过<code>FitContainer</code>组件，根据缩放比例自动调整元素的位置和大小，同时支持两种定位模式（px/%）。</li>
</ol>
<h4 data-id="heading-1">核心能力解析</h4>
<ol>
<li>
<p> <strong>灵活的缩放模式</strong><br/>
vfit提供3种缩放策略，覆盖绝大多数场景：</p>
</li>
<li>
<ul>
<li>• <code>width</code>：按容器宽度缩放（<code>scale = 容器宽 / 设计稿宽</code>）；</li>
<li>• <code>height</code>：按容器高度缩放（<code>scale = 容器高 / 设计稿高</code>）；</li>
<li>• <code>auto</code>：自动对比容器宽高比与设计稿宽高比，选择更合适的维度缩放（避免元素被截断）。</li>
</ul>
</li>
<li>
<p> <strong>组件化定位</strong><br/>
内置的<code>FitContainer</code>组件是核心，通过<code>top/bottom/left/right</code>属性定义位置，配合<code>unit</code>参数控制定位逻辑：</p>
<p>示例代码（像素定位）：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>  
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: relative; width: 100%; height: 100vh;"</span>&gt;</span>  
    <span class="hljs-tag">&lt;<span class="hljs-name">FitContainer</span> <span class="hljs-attr">:top</span>=<span class="hljs-string">"90"</span> <span class="hljs-attr">:left</span>=<span class="hljs-string">"90"</span> <span class="hljs-attr">unit</span>=<span class="hljs-string">"px"</span>&gt;</span>  
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>固定像素布局<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  
    <span class="hljs-tag">&lt;/<span class="hljs-name">FitContainer</span>&gt;</span>  
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>  
</code></pre>
</li>
<li>
<ul>
<li>• <code>unit="%"</code>：位置基于容器百分比，不受缩放影响（适合居中、相对布局）；</li>
<li>• <code>unit="px"</code>：位置会自动乘以当前缩放值（适合固定像素定位，如设计稿上left:90px，缩放后实际位置为90×scale）。</li>
</ul>
</li>
<li>
<p> <strong>全局缩放值访问</strong><br/>
通过<code>useFitScale()</code>钩子可在组件内获取当前缩放值（<code>Ref&lt;number&gt;</code>），方便自定义缩放逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useFitScale } <span class="hljs-keyword">from</span> <span class="hljs-string">'vfit'</span>  

<span class="hljs-keyword">const</span> scale = <span class="hljs-title function_">useFitScale</span>()  
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'当前缩放比例：'</span>, scale.<span class="hljs-property">value</span>)  
</code></pre>
</li>
</ol>
<h4 data-id="heading-2">上手成本极低</h4>
<p>安装初始化仅需两步：</p>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> vfit  
</code></pre>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.ts  </span>
<span class="hljs-keyword">import</span> { createFitScale } <span class="hljs-keyword">from</span> <span class="hljs-string">'vfit'</span>  
<span class="hljs-keyword">import</span> <span class="hljs-string">'vfit/style.css'</span>  

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createFitScale</span>({  
  <span class="hljs-attr">target</span>: <span class="hljs-string">'#app'</span>, <span class="hljs-comment">// 默认为#app，可指定其他容器  </span>
  <span class="hljs-attr">designWidth</span>: <span class="hljs-number">1920</span>, <span class="hljs-comment">// 设计稿宽度（默认1920）  </span>
  <span class="hljs-attr">designHeight</span>: <span class="hljs-number">1080</span>, <span class="hljs-comment">// 设计稿高度（默认1080）  </span>
  <span class="hljs-attr">scaleMode</span>: <span class="hljs-string">'auto'</span> <span class="hljs-comment">// 默认auto  </span>
}))  
</code></pre>
<h4 data-id="heading-3">适用场景与优势</h4>
<ul>
<li> <strong>优势</strong>：轻量（无冗余依赖）、Vue 3原生支持、定位与缩放逻辑解耦、API简洁；</li>
<li><strong>场景</strong>：数据大屏、管理系统、多设备兼容的活动页等需要精确布局的场景。</li>
</ul>
<p>如果你正在为Vue项目的多分辨率适配头疼，不妨试试vfit——它不追求大而全，只专注于把“缩放与定位”这件事做好。现在就去npm安装体验，让适配工作少走弯路～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[牛刀小试：Vue 3的响应式系统和Proxy?]]></title>    <link>https://juejin.cn/post/7574967214128381978</link>    <guid>https://juejin.cn/post/7574967214128381978</guid>    <pubDate>2025-11-21T10:29:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214128381978" data-draft-id="7574967214128349210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="牛刀小试：Vue 3的响应式系统和Proxy?"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T10:29:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ArkPppp"/> <meta itemprop="url" content="https://juejin.cn/user/4484239094198752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            牛刀小试：Vue 3的响应式系统和Proxy?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4484239094198752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ArkPppp
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:29:24.000Z" title="Fri Nov 21 2025 10:29:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">牛刀小试：Vue 3的响应式系统和Proxy?</h2>
<h2 data-id="heading-1">引言</h2>
<p>众所周知，Vue3 的响应式系统主要依赖于 ES6 的 <em>Proxy</em> 对象来实现。相比于 Vue2 使用的 <code>Object.defineProperty</code>，<code>Proxy</code>提供了更强大的功能和更好的性能。但我们在日常使用框架时却很少注意到背后的底层原理，本文就旨在通过重温Vue3的响应式系统，学习和回顾ES6的相关特性。</p>
<h2 data-id="heading-2">Proxy概述</h2>
<p><strong>ES6 Proxy</strong> 是一种新的 JavaScript 功能，它允许你创建一个对象的代理，从而可以拦截和自定义基本操作，例如属性查找、赋值、枚举和函数调用等。Proxy 可以被视为在目标对象之前设置的一层拦截，所有对该对象的访问都必须首先通过这层拦截，这提供了一种机制，可以对外界的访问进行过滤和改写。</p>
<h3 data-id="heading-3">语法</h3>
<p><code>const p = new Proxy(target, handler)</code></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%23target_2" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy#target_2" ref="nofollow noopener noreferrer"><code>target</code></a>:要使用 <code>Proxy</code> 包装的目标对象（可以是任何类型的对象，包括原生数组，函数，甚至另一个代理）。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%23handler" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy#handler" ref="nofollow noopener noreferrer"><code>handler</code></a>:一个通常以函数作为属性的对象，各属性中的函数分别定义了在执行各种操作时代理 <code>p</code> 的行为。</p>
<h3 data-id="heading-4">例子</h3>
<h4 data-id="heading-5">拦截器</h4>
<p>这里我们创建了一个<em>get handler</em>，当程序试图访问对象时，如果属性存在于对象，则返回其对象的值，否则返回37。</p>
<p>以下是传递给 get 方法的参数，this 上下文绑定在handler 对象上。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%2FProxy%2Fget%23target" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/get#target" ref="nofollow noopener noreferrer"><code>target</code></a>目标对象。<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%2FProxy%2Fget%23property" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/get#property" ref="nofollow noopener noreferrer"><code>property</code></a>被获取的属性名。<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%2FProxy%2Fget%23receiver" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/get#receiver" ref="nofollow noopener noreferrer"><code>receiver</code></a>是Proxy 或者继承 Proxy 的对象</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> handler = {
  <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">obj, prop</span>) {
    <span class="hljs-keyword">return</span> prop <span class="hljs-keyword">in</span> obj ? obj[prop] : <span class="hljs-number">37</span>;
  },
};

<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({}, handler);
p.<span class="hljs-property">a</span> = <span class="hljs-number">1</span>;
p.<span class="hljs-property">b</span> = <span class="hljs-literal">undefined</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">a</span>, p.<span class="hljs-property">b</span>); <span class="hljs-comment">// 1, undefined</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"c"</span> <span class="hljs-keyword">in</span> p, p.<span class="hljs-property">c</span>); <span class="hljs-comment">// false, 37</span>
</code></pre>
<h4 data-id="heading-6">无操作转发</h4>
<p>在以下例子中，我们使用了一个原生 JavaScript 对象，代理会将所有应用到它的操作转发到这个对象上。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">let</span> target = {};
<span class="hljs-keyword">let</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {});

p.<span class="hljs-property">a</span> = <span class="hljs-number">37</span>; <span class="hljs-comment">// 操作转发到目标</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(target.<span class="hljs-property">a</span>); <span class="hljs-comment">// 37 操作已经被正确地转发</span>
</code></pre>
<h4 data-id="heading-7">验证功能</h4>
<p>通过代理，你可以轻松地验证向一个对象的传值。向Proxy的handler设置相关的setter方法，可以拦截对对象的赋值操作，并确保预期之内的结果。</p>
<p>以下是传递给 <code>set()</code> 方法的参数。<code>this</code> 绑定在 handler 对象上。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%2FProxy%2Fset%23target" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set#target" ref="nofollow noopener noreferrer"><code>target</code></a>目标对象。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%2FProxy%2Fset%23property" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set#property" ref="nofollow noopener noreferrer"><code>property</code></a>将被设置的属性名或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FSymbol" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol" ref="nofollow noopener noreferrer"><code>Symbol</code></a>。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%2FProxy%2Fset%23value" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set#value" ref="nofollow noopener noreferrer"><code>value</code></a>新属性值。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy%2FProxy%2Fset%23receiver" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy/set#receiver" ref="nofollow noopener noreferrer"><code>receiver</code></a>最初接收赋值的对象。通常是 proxy 本身，但 handler 的 set 方法也有可能在原型链上，或以其他方式被间接地调用（因此不一定是 proxy 本身）。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// Proxy &amp; setter拦截器</span>

<span class="hljs-keyword">let</span> validator = {
    <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">obj, prop, value</span>) {
    <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">"age"</span>) {
      <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(value)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"The age is not an integer"</span>);
      }
      <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-number">200</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RangeError</span>(<span class="hljs-string">"The age seems invalid"</span>);
      }
    }

    <span class="hljs-comment">// 保存属性值的默认行为!</span>
    obj[prop] = value;

    <span class="hljs-comment">// 表示成功</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}

<span class="hljs-keyword">let</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>({},validator)

person.<span class="hljs-property">age</span> = <span class="hljs-number">50</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">age</span>)

<span class="hljs-comment">// TypeError: The age is not an integer</span>
person.<span class="hljs-property">age</span> = <span class="hljs-number">11.4</span>

<span class="hljs-comment">// RangeError: The age seems invalid</span>
person.<span class="hljs-property">age</span> = <span class="hljs-number">3000</span>
</code></pre>
<h2 data-id="heading-8">Reflect概述</h2>
<p><strong>ES6 Reflect</strong> 是一个内置的对象，它提供了一系列静态方法，用于执行可拦截的 JavaScript 操作。<code>Reflect</code> 并不是一个函数对象，因此它是不可构造的。</p>
<p><code>Reflect</code> 的设计目的之一是与 <code>Proxy</code> 配合使用。<code>Proxy</code> handler 中的方法（如 <code>get</code>, <code>set</code>）与 <code>Reflect</code> 对象上的方法具有相同的名称和参数。这使得在 <code>Proxy</code> handler 中调用 <code>Reflect</code> 对应的方法来执行默认行为变得非常方便和规范。</p>
<h3 data-id="heading-9">主要方法</h3>
<p><code>Reflect</code> 上的所有方法都是静态的，与 <code>Proxy</code> 的 handler 方法一一对应。</p>
<ul>
<li><code>Reflect.get(target, propertyKey[, receiver])</code>: 获取对象属性的值，类似于 <code>target[propertyKey]</code>。</li>
<li><code>Reflect.set(target, propertyKey, value[, receiver])</code>: 设置对象属性的值，类似于 <code>target[propertyKey] = value</code>。它会返回一个布尔值表示是否设置成功。</li>
<li><code>Reflect.has(target, propertyKey)</code>: 判断一个对象是否存在某个属性，类似于 <code>propertyKey in target</code>。</li>
<li><code>Reflect.deleteProperty(target, propertyKey)</code>: 删除对象的属性，类似于 <code>delete target[propertyKey]</code>。</li>
</ul>
<h3 data-id="heading-10">为什么与Proxy是最佳搭档？</h3>
<p>在 <code>Proxy</code> 的拦截器中，我们通常需要执行原始操作。直接使用 <code>obj[prop] = value</code> 这样的语法虽然可行，但存在一些问题，尤其是在处理继承和 <code>getter/setter</code> 时。</p>
<p><code>Reflect</code> 方法提供了执行这些默认操作的标准方式，并能正确处理 <code>this</code> 指向（通过 <code>receiver</code> 参数）。</p>
<h4 data-id="heading-11">例子</h4>
<p>在这个例子中，我们使用 <code>Reflect.set</code> 来完成属性的赋值。这确保了即使对象有 <code>setter</code>，<code>this</code> 也会正确地指向代理对象 <code>p</code>。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> target = {
    <span class="hljs-attr">_name</span>: <span class="hljs-string">'Guest'</span>,
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">name</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span>;
    },
    <span class="hljs-keyword">set</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">val</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Setter called!'</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_name</span> = val;
    }
};

<span class="hljs-keyword">const</span> handler = {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">obj, prop, value, receiver</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Setting <span class="hljs-subst">${prop}</span> to <span class="hljs-subst">${value}</span>`</span>);
        <span class="hljs-comment">// 使用 Reflect.set 来调用原始的 setter，并确保 this 指向 receiver (代理对象 p)</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(obj, prop, value, receiver);
    }
};

<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler);

p.<span class="hljs-property">name</span> = <span class="hljs-string">'Admin'</span>;
<span class="hljs-comment">// 输出:</span>
<span class="hljs-comment">// Setting name to Admin</span>
<span class="hljs-comment">// Setter called!</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p.<span class="hljs-property">name</span>); <span class="hljs-comment">// Admin</span>

</code></pre>
<p>使用 <code>Reflect</code> 不仅代码更简洁，而且更健壮，能够正确处理 JavaScript 复杂的内部机制。</p>
<h3 data-id="heading-12">手动挡响应式</h3>
<p>了解完基本的原理后，我们将”手动挡”开始一步步实现Vue的响应式。</p>
<h3 data-id="heading-13">实现单个值的响应式</h3>
<p>下面代码通过 3 个步骤，实现对 <code>total</code> 数据进行响应式变化：</p>
<p>① 初始化一个 <code>Set</code> 类型的 <code>dep</code> (Dependency 依赖)变量，用来存放需要执行的副作用（ <code>effect</code> 函数），即修改 <code>total</code> 值的方法；</p>
<p>② 创建 <code>track()</code> 函数，用来将需要执行的副作用(Effect)保存到 <code>dep</code> 变量中（也称收集副作用）；</p>
<p>③ 创建 <code>trigger()</code> 函数，用来执行 <code>dep</code> 变量中的所有副作用；</p>
<p>在每次修改 <code>price</code> 或 <code>quantity</code> 后，调用 <code>trigger()</code> 函数(扳机,触发器)执行所有副作用后， <code>total</code> 值将自动更新为最新值。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">let</span> price = <span class="hljs-number">10</span>, quantity = <span class="hljs-number">2</span>, total = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(); <span class="hljs-comment">// ① </span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">effect</span> = (<span class="hljs-params"/>) =&gt; { total = price * quantity };
<span class="hljs-keyword">const</span> <span class="hljs-title function_">track</span> = (<span class="hljs-params"/>) =&gt; { dep.<span class="hljs-title function_">add</span>(effect) };  <span class="hljs-comment">// ②</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">trigger</span> = (<span class="hljs-params"/>) =&gt; { dep.<span class="hljs-title function_">forEach</span>( <span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-title function_">effect</span>() )};  <span class="hljs-comment">// ③</span>

<span class="hljs-title function_">track</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 0</span>
<span class="hljs-title function_">trigger</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 20</span>
price = <span class="hljs-number">20</span>;
<span class="hljs-title function_">trigger</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 40</span>

</code></pre>
<h3 data-id="heading-14">实现单个对象的响应式</h3>
<p>我们的对象具有多个属性，并且每个属性都需要自己的 <code>dep</code>(Dependency)。</p>
<p>我们将所有副作用保存在一个 <code>Set</code> 集合中，而该集合不会有重复项，这里我们引入一个 <code>Map</code> 类型集合（即 <code>depsMap</code> ），其 <code>key</code> 为对象的属性（如： <code>price</code> 属性）， <code>value</code> 为前面保存副作用的 <code>Set</code> 集合（如： <code>dep</code> 对象）</p>
<p>下面的代码通过 3 个步骤，实现对 <code>total</code> 数据进行响应式变化：</p>
<p>① 初始化一个 <code>Map</code> 类型的 <code>depsMap</code> 变量，用来保存每个需要响应式变化的对象属性（<code>key</code> 为对象的属性， <code>value</code> 为前面 <code>Set</code> 集合）；</p>
<p>② 创建 <code>track()</code> 函数，用来将需要执行的副作用保存到 <code>depsMap</code> 变量中对应的对象属性下（也称收集副作用）；</p>
<p>③ 创建 <code>trigger()</code> 函数，用来执行 <code>dep</code> 变量中指定对象属性的所有副作用；</p>
<p>这样就实现监听对象的响应式变化，在 <code>product</code> 对象中的属性值发生变化， <code>total</code> 值也会跟着更新。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">let</span> product = { <span class="hljs-attr">price</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">2</span> }, total = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// 1 创建依赖映射表</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">effect</span> = (<span class="hljs-params"/>) =&gt; { total = product.<span class="hljs-property">price</span> * product.<span class="hljs-property">quantity</span> };
<span class="hljs-keyword">const</span> <span class="hljs-title function_">track</span> = key =&gt; {     <span class="hljs-comment">// 2 查找该属性已有的依赖,若没有则自行创建一个</span>
  <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span>(!dep) {
    depsMap.<span class="hljs-title function_">set</span>(key, (dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()));
  }
  dep.<span class="hljs-title function_">add</span>(effect);
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">trigger</span> = key =&gt; {  <span class="hljs-comment">// 3 找到该属性对应的所有依赖,并执行相关的副作用函数</span>
  <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span>(dep) {
    dep.<span class="hljs-title function_">forEach</span>( <span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-title function_">effect</span>() );
  }
};

<span class="hljs-title function_">track</span>(<span class="hljs-string">'price'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 0</span>
<span class="hljs-title function_">effect</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 20</span>
product.<span class="hljs-property">price</span> = <span class="hljs-number">20</span>;
<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'price'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 40</span>

</code></pre>
<h4 data-id="heading-15"><strong>为什么是Map充当依赖映射?</strong></h4>
<p>Map与Set的区别:</p>
<ul>
<li>Set只储存唯一的值,只有值没有键,<strong>重复值不会被添加。</strong></li>
<li>Map存储键值对,存在键值对的映射关系。</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// Set 存储唯一值的集合</span>
<span class="hljs-keyword">const</span> effects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(); <span class="hljs-comment">// 只存储值，不存储键</span>
effects.<span class="hljs-title function_">add</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'effect1'</span>));
effects.<span class="hljs-title function_">add</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'effect2'</span>));
effects.<span class="hljs-title function_">add</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'effect1'</span>)); <span class="hljs-comment">// 重复值不会被添加</span>

<span class="hljs-comment">// Set 的内部结构</span>
[effect1函数, effect2函数]
<span class="hljs-comment">// 只有值，没有键</span>

<span class="hljs-comment">// Map 存储键值对</span>
<span class="hljs-keyword">const</span> depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// key -&gt; value 的映射关系</span>
depsMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'price'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([effect1, effect2]));
depsMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'quantity'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([effect3]));

<span class="hljs-comment">// Map 的内部结构</span>
{
  <span class="hljs-string">'price'</span> -&gt; <span class="hljs-title class_">Set</span>([effect1, effect2]),
  <span class="hljs-string">'quantity'</span> -&gt; <span class="hljs-title class_">Set</span>([effect3])
}
<span class="hljs-comment">// 有明确的键值对应关系</span>
</code></pre>
<p>故<code>Set</code>用于储存副作用函数运算，<code>Map</code>用于保存依赖的键值对。</p>
<h3 data-id="heading-16">实现多个对象的响应式</h3>
<p>下面代码通过 3 个步骤，实现对 <code>total</code> 数据进行响应式变化：</p>
<p>① 初始化一个 <code>WeakMap</code> 类型的 <code>targetMap</code> 变量，用来要观察每个响应式对象；</p>
<p>② 创建 <code>track()</code> 函数，用来将需要执行的副作用保存到指定对象（ <code>target</code> ）的依赖中（也称收集副作用）；</p>
<p>③ 创建 <code>trigger()</code> 函数，用来执行指定对象（ <code>target</code> ）中指定属性（ <code>key</code> ）的所有副作用；</p>
<p>这样就实现监听对象的响应式变化，在 <code>product</code> 对象中的属性值发生变化， <code>total</code> 值也会跟着更新。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">let</span> product = { <span class="hljs-attr">price</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">2</span> }, total = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> targetMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();     <span class="hljs-comment">// 1 初始化 targetMap，保存观察对象</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">effect</span> = (<span class="hljs-params"/>) =&gt; { total = product.<span class="hljs-property">price</span> * product.<span class="hljs-property">quantity</span> };
<span class="hljs-keyword">const</span> <span class="hljs-title function_">track</span> = (<span class="hljs-params">target, key</span>) =&gt; {     <span class="hljs-comment">// 2 收集依赖</span>
  <span class="hljs-keyword">let</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
  <span class="hljs-keyword">if</span>(!depsMap){
    targetMap.<span class="hljs-title function_">set</span>(target, (depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()));
  }
  <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span>(!dep) {
    depsMap.<span class="hljs-title function_">set</span>(key, (dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()));
  }
  dep.<span class="hljs-title function_">add</span>(effect);
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">trigger</span> = (<span class="hljs-params">target, key</span>) =&gt; {  <span class="hljs-comment">// 3 执行指定对象的指定属性的所有副作用</span>
  <span class="hljs-keyword">const</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
  <span class="hljs-keyword">if</span>(!depsMap) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span>(dep) {
    dep.<span class="hljs-title function_">forEach</span>( <span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-title function_">effect</span>() );
  }
};

<span class="hljs-title function_">track</span>(product, <span class="hljs-string">'price'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 0</span>
<span class="hljs-title function_">effect</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 20</span>
product.<span class="hljs-property">price</span> = <span class="hljs-number">20</span>;
<span class="hljs-title function_">trigger</span>(product, <span class="hljs-string">'price'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 40</span>

</code></pre>
<h2 data-id="heading-17">"自动挡"的响应式系统：Proxy与Reflect的结合</h2>
<p>到目前为止，我们已经建立了一个依赖追踪系统，但它还是“手动挡”的：</p>
<ol>
<li>我们需要在代码中手动调用 <code>track()</code> 来收集依赖。</li>
<li>我们需要在数据更新后手动调用 <code>trigger()</code> 来触发更新。</li>
</ol>
<p>这显然不够智能。现在，让我们利用 <code>Proxy</code> 和 <code>Reflect</code> 将它升级为“自动挡”。我们的目标是：当访问一个对象的属性时，自动执行 <code>track()</code>；当修改一个对象的属性时，自动执行 <code>trigger()</code>。</p>
<h4 data-id="heading-18">第一步：创建 <code>reactive</code> 函数</h4>
<p>我们先创建一个 <code>reactive</code> 函数，它接收一个普通对象，并返回一个该对象的代理。所有的操作都将发生在这个代理的 <code>handler</code> 中。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> targetMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>(); <span class="hljs-comment">// 依赖存储保持不变</span>

<span class="hljs-comment">// 副作用函数也保持不变</span>
<span class="hljs-keyword">let</span> activeEffect = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 我们需要一个变量来存储当前正在运行的副作用函数</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">const</span> handler = {
    <span class="hljs-comment">// get 拦截器：当读取属性时触发</span>
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`GET: 访问属性 <span class="hljs-subst">${key}</span>`</span>);
      <span class="hljs-comment">// ... 在这里自动收集依赖</span>
    },
    <span class="hljs-comment">// set 拦截器：当设置属性时触发</span>
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`SET: 设置属性 <span class="hljs-subst">${key}</span> 为 <span class="hljs-subst">${value}</span>`</span>);
      <span class="hljs-comment">// ... 在这里自动触发更新</span>
    }
  };
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler);
}

</code></pre>
<h4 data-id="heading-19">第二步：在 <code>get</code> 拦截器中自动收集依赖</h4>
<p>当代码访问代理对象的属性时（例如 <code>product.price</code>），<code>get</code> 拦截器会被触发。这正是我们调用 <code>track()</code> 的时机。</p>
<p>同时，为了让 <code>track</code> 函数知道要收集哪个副作用，我们引入一个全局变量 <code>activeEffect</code>，用于存储当前正在执行的副作用函数。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// track 函数现在需要知道当前激活的副作用是哪个</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-keyword">if</span> (activeEffect) { <span class="hljs-comment">// 只有在 activeEffect 存在时才进行追踪</span>
    <span class="hljs-keyword">let</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
    <span class="hljs-keyword">if</span> (!depsMap) {
      targetMap.<span class="hljs-title function_">set</span>(target, (depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()));
    }
    <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (!dep) {
      depsMap.<span class="hljs-title function_">set</span>(key, (dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()));
    }
    dep.<span class="hljs-title function_">add</span>(activeEffect); <span class="hljs-comment">// 收集当前激活的副作用</span>
  }
}

<span class="hljs-comment">// reactive 函数的 get handler</span>
<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
    <span class="hljs-title function_">track</span>(target, key); <span class="hljs-comment">// 自动收集依赖</span>
    <span class="hljs-comment">// 使用 Reflect.get 返回属性的原始值，确保 this 指向正确</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
  },
  <span class="hljs-comment">// ... set handler</span>
};

</code></pre>
<h4 data-id="heading-20">第三步：在 <code>set</code> 拦截器中自动触发更新</h4>
<p>当代码修改代理对象的属性时（例如 <code>product.price = 20</code>），<code>set</code> 拦截器会被触发。这时则调用 <code>trigger()</code> 。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// trigger 函数保持不变</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">trigger</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-keyword">const</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
  <span class="hljs-keyword">if</span> (!depsMap) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span> (dep) {
    dep.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-title function_">effect</span>());
  }
}

<span class="hljs-comment">// reactive 函数的 set handler</span>
<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-comment">// ... get handler</span>
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
    <span class="hljs-comment">// 使用 Reflect.set 设置新值</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
    <span class="hljs-title function_">trigger</span>(target, key); <span class="hljs-comment">// 自动触发更新</span>
    <span class="hljs-keyword">return</span> result; <span class="hljs-comment">// 返回设置操作是否成功</span>
  }
};

</code></pre>
<h4 data-id="heading-21">第四步：整合与测试</h4>
<p>现在，我们把所有部分整合起来，并创建一个 <code>watchEffect</code> 函数来管理 <code>activeEffect</code>。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> targetMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();
<span class="hljs-keyword">let</span> activeEffect = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">track</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-keyword">if</span> (activeEffect) {
    <span class="hljs-keyword">let</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
    <span class="hljs-keyword">if</span> (!depsMap) {
      targetMap.<span class="hljs-title function_">set</span>(target, (depsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()));
    }
    <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
    <span class="hljs-keyword">if</span> (!dep) {
      depsMap.<span class="hljs-title function_">set</span>(key, (dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()));
    }
    dep.<span class="hljs-title function_">add</span>(activeEffect);
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">trigger</span>(<span class="hljs-params">target, key</span>) {
  <span class="hljs-keyword">const</span> depsMap = targetMap.<span class="hljs-title function_">get</span>(target);
  <span class="hljs-keyword">if</span> (!depsMap) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">let</span> dep = depsMap.<span class="hljs-title function_">get</span>(key);
  <span class="hljs-keyword">if</span> (dep) {
    dep.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">effect</span> =&gt;</span> <span class="hljs-title function_">effect</span>());
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reactive</span>(<span class="hljs-params">target</span>) {
  <span class="hljs-keyword">const</span> handler = {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
      <span class="hljs-title function_">track</span>(target, key);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value, receiver</span>) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
      <span class="hljs-title function_">trigger</span>(target, key);
      <span class="hljs-keyword">return</span> result;
    }
  };
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler);
}

<span class="hljs-comment">// watchEffect 用于注册副作用函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">watchEffect</span>(<span class="hljs-params">effect</span>) {
  activeEffect = effect;
  <span class="hljs-title function_">effect</span>(); <span class="hljs-comment">// 立即执行一次，以触发 get 从而收集依赖</span>
  activeEffect = <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// --- 测试 ---</span>
<span class="hljs-keyword">let</span> product = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">price</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">2</span> });
<span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 这个函数现在是我们的副作用</span>
  total = product.<span class="hljs-property">price</span> * product.<span class="hljs-property">quantity</span>;
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 20</span>

<span class="hljs-comment">// 当我们修改 price 时，不再需要手动调用 trigger</span>
product.<span class="hljs-property">price</span> = <span class="hljs-number">20</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 40 (自动更新!)</span>

<span class="hljs-comment">// 当我们修改 quantity 时，也同样会自动更新</span>
product.<span class="hljs-property">quantity</span> = <span class="hljs-number">3</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`total: <span class="hljs-subst">${total}</span>`</span>); <span class="hljs-comment">// total: 60 (自动更新!)</span>

</code></pre>
<p>现在，我们拥有了一个真正的“自动挡”响应式系统。我们只需要用 <code>reactive()</code> 包裹我们的数据，并用 <code>watchEffect()</code> 注册依赖于这些数据的操作，剩下的依赖收集和触发更新都由 <code>Proxy</code> 自动完成了。</p>
<h2 data-id="heading-22">总结</h2>
<p>在本文中，我们通过一个循序渐进的过程，亲手实现了一个迷你版的Vue 3响应式系统。让我们回顾一下这个旅程：</p>
<ol>
<li><strong>从基础开始</strong>：我们首先理解了响应式的核心概念——当数据变化时，依赖该数据的代码应该自动重新执行。我们用一个简单的 <code>Set</code> 来存储单个依赖（副作用函数），并手动调用 <code>track</code> 和 <code>trigger</code>。</li>
<li><strong>支持对象属性</strong>：为了处理对象，我们引入了 <code>Map</code>，建立了从“属性名”到“依赖集合”的映射关系，使得每个属性都能独立追踪自己的依赖。</li>
<li><strong>支持多个对象</strong>：为了管理多个响应式对象，我们引入了 <code>WeakMap</code>，构建了 <code>targetMap -&gt; depsMap -&gt; dep</code> 的三层依赖存储结构。至此，我们的“手动挡”响应式系统已经成型。</li>
<li><strong>迈向自动化</strong>：我们认识到手动调用 <code>track</code> 和 <code>trigger</code> 的繁琐和不可靠。于是，我们引入了 ES6 的 <code>Proxy</code> 和 <code>Reflect</code>。
<ul>
<li><strong>Proxy</strong> 允许我们拦截对象的 <code>get</code> 和 <code>set</code> 操作。我们在 <code>get</code> 拦截器中自动调用 <code>track</code>，在 <code>set</code> 拦截器中自动调用 <code>trigger</code>。</li>
<li><strong>Reflect</strong> 则作为 <code>Proxy</code> 的最佳搭档，提供了执行对象默认操作的标准方法，确保了操作的健壮性和 <code>this</code> 指向的正确性。</li>
</ul>
</li>
</ol>
<p>通过这个过程，我们不仅深入理解了Vue 3响应式系统的核心原理，还掌握了 <code>Proxy</code> 和 <code>Reflect</code> 这两个强大的JavaScript特性。</p>
<h2 data-id="heading-23">参考</h2>
<ul>
<li><a href="https://juejin.cn/post/6977513378256257031" target="_blank" title="https://juejin.cn/post/6977513378256257031">稀土掘金-探索 Vue3 响应式原理</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FProxy" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" ref="nofollow noopener noreferrer">MDN-Proxy</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FReflect" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect" ref="nofollow noopener noreferrer">MDN-Reflect</a></li>
<li>Google-Gemini2.5Pro参与校验和部分编纂工作</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js SSR 实战：从零到一，构建服务端渲染应用]]></title>    <link>https://juejin.cn/post/7574978545144463395</link>    <guid>https://juejin.cn/post/7574978545144463395</guid>    <pubDate>2025-11-21T10:55:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545144463395" data-draft-id="7574404398066614272" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js SSR 实战：从零到一，构建服务端渲染应用"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T10:55:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="venton"/> <meta itemprop="url" content="https://juejin.cn/user/66443682264973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js SSR 实战：从零到一，构建服务端渲染应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/66443682264973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    venton
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:55:08.000Z" title="Fri Nov 21 2025 10:55:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">引言</h3>
<p>今天我们来通过一篇文章掌握服务端渲染框架-nextjs的基本使用，通过本文一步一步实现来完成一个企业级SSR框架的搭建。</p>
<p>能点开这篇文章，相信你对SSR服务端渲染已经有了大概的了解，当然也可以看我前面的一篇文章让你搞清楚服务端渲染的核心原理是什么：<a href="https://juejin.cn/post/7571655312798285850" target="_blank" title="https://juejin.cn/post/7571655312798285850"> 搞懂SSR的灵魂-Hydration</a></p>
<p>咱们学习之前还是需要有一些的react预备知识，比如react16+、hooks、redux、react-redux、redux toolkit，如果是的，那咱们就发车了！</p>
<h3 data-id="heading-1">项目创建</h3>
<pre><code class="hljs language-java" lang="java">npx create-next-app<span class="hljs-meta">@latest</span>   <span class="hljs-comment">//当然你也可以根据需求指定脚手架版本</span>

</code></pre>
<p>项目的基本结构如下</p>
<pre><code class="hljs language-python" lang="python">├── assets/             <span class="hljs-comment"># 文件资源</span>
├── components/         <span class="hljs-comment"># 可复用组件</span>
├── pages/              <span class="hljs-comment"># 页面路由</span>
   ├── _app.tsx         <span class="hljs-comment"># 入口文件</span>
   ├── _document.js     <span class="hljs-comment"># 文档配置（可在这里定义TDK--sso优化）</span>
   ├── index.tsx        <span class="hljs-comment"># 首页</span>
   ├── xxxx             <span class="hljs-comment"># 其他页面</span>
├── store/              <span class="hljs-comment"># Redux状态管理</span>
├── service/            <span class="hljs-comment"># API服务层</span>
├── styles/             <span class="hljs-comment"># 全局样式</span>
└── middleware.ts       <span class="hljs-comment"># 中间件配置（路由拦截、请求重定向-反向代理...）</span>
└── <span class="hljs-built_in">next</span>.config.js      <span class="hljs-comment"># 项目配置（网络图片优化配置...）</span>
└── tsconfig.json       <span class="hljs-comment"># typescript配置(路径别名...)</span>
</code></pre>
<p>接下来在编辑器终端执行 npm run dev ,如果打开浏览器看到类似这样的页面就代表第一步已经成功了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09bdfce6175646a4bebd89b03fcff0f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmVudG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764327307&amp;x-signature=2v%2BbpP5UH%2FY%2BH23MOkroFnZCKuQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">路由系统</h3>
<p>项目运行起来了我们可能下一步考虑的是怎么创建路由，关联页面？
nextjs具备的一个特点就是：<strong>零配置路由</strong></p>
<p>Next.js最大的路由优势就是：不需要手动配置路由，文件系统就是路由系统！</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 文件结构自动映射为路由</span>
pages/
├── index.tsx          → 自动映射为 /
├── about.tsx         → 自动映射为 /about
├── profile/
│   ├── index.tsx     → 自动映射为 /profile
│   └── [<span class="hljs-built_in">id</span>].tsx      → 自动映射为 /profile/:<span class="hljs-built_in">id</span>  注意：这里是动态路由，文件命名和参数接收时统一
└── api/
    └── user.ts       → 自动映射为 /api/user
</code></pre>
<p>路由跳转可通过下面两种方式</p>
<p>link组件跳转</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Link</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"next/link"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">AppProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/app"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">{ Component, ...rest }: AppProps</span>) {
  <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/profile?code=123"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>Profile<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/profile/123444"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>Profile动态<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{getInfo}</span>&gt;</span>api重写<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
        {<span class="hljs-comment">/* Component页面占位 ===相当于vue中的 router-view */</span>}
        &lt;<span class="hljs-title class_">Component</span> {...props.<span class="hljs-property">pageProps</span>} /&gt;
  );
}
</code></pre>
<p>编程式导航跳转hook（类似vue3）</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/router'</span>
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">AppProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/app"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">{ Component, ...rest }: AppProps</span>) {

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
  
  <span class="hljs-comment">// 基本跳转</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleNavigate</span> = (<span class="hljs-params"/>) =&gt; {
    router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/profile'</span>) <span class="hljs-comment">// 跳转到个人资料页</span>
  }
  
  <span class="hljs-comment">// 带查询参数跳转</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleNavigateWithQuery</span> = (<span class="hljs-params"/>) =&gt; {
    router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/profile?code=123&amp;name=john'</span>)
  }
  
  <span class="hljs-comment">// 动态路由跳转</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDynamicRoute</span> = (<span class="hljs-params"/>) =&gt; {
    router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/profile/123'</span>) <span class="hljs-comment">// 跳转到 /profile/123</span>
  }
  
  <span class="hljs-comment">// 对象形式跳转（更灵活）</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleObjectNavigation</span> = (<span class="hljs-params"/>) =&gt; {
    router.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">pathname</span>: <span class="hljs-string">'/profile'</span>,
      <span class="hljs-attr">query</span>: { 
        <span class="hljs-attr">id</span>: <span class="hljs-string">'123'</span>, 
        <span class="hljs-attr">tab</span>: <span class="hljs-string">'settings'</span> 
      }
    })
  }
}

</code></pre>
<p>路由传递参数的接收</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/router'</span>
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">AppProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/app"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">{ Component, ...rest }: AppProps</span>) {

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
<span class="hljs-comment">// 拿到 url中查询字符串 注意：如果是动态路由这里解构的属性名就与文件名必须保持一致</span>
<span class="hljs-comment">// 动态路由参数都是通过query获取，同名的话路由参数优先级高于查询字符串 </span>
<span class="hljs-keyword">const</span> { id } = router.<span class="hljs-property">query</span>; <span class="hljs-comment">// 拿到 url中查询字符串 注意：如果是动态路由这里结构的属性名就与文件名</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.detail}</span>&gt;</span>{id}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

</code></pre>
<p>如果要执行路由守卫在中间件配置文件操作</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">//middleware.ts</span>

  <span class="hljs-comment">// 路由守卫（示例）</span>
  <span class="hljs-keyword">const</span> token = req.cookies.<span class="hljs-keyword">get</span>(<span class="hljs-string">"token"</span>)?.<span class="hljs-keyword">value</span>;
  <span class="hljs-keyword">if</span> (!token &amp;&amp; req.nextUrl.pathname.startsWith(<span class="hljs-string">"/profile"</span>)) {
    <span class="hljs-keyword">return</span> NextResponse.redirect(<span class="hljs-keyword">new</span> URL(<span class="hljs-string">"/login"</span>, req.nextUrl.origin));
  }

</code></pre>
<p>上面涵盖了nextjs路由系统的基本使用，接下来我们就来实践下服务端渲染的核心：</p>
<h3 data-id="heading-3">SSR数据获取（重点！！！）</h3>
<p>我们先来看看页面中如何展示数据</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useSelector, useDispatch } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-redux"</span>;
<span class="hljs-keyword">import</span> { fetchUserAction } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store/modules/home"</span>;
<span class="hljs-keyword">import</span> wrapper <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store/index"</span>;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">GetServerSideProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-variable constant_">FC</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  <span class="hljs-title class_">IUser</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@/service/home"</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IProps</span> {
  <span class="hljs-attr">users</span>: <span class="hljs-title class_">IUser</span>[];
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">IProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> {
    product = [], <span class="hljs-comment">//通过getServerSideProps映射到props中了</span>
  } = props;

  <span class="hljs-comment">// 从 redux 读取数据</span>
  <span class="hljs-keyword">const</span> { users } = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function">(<span class="hljs-params">rootState: IAppRootState</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">users</span>: rootState.<span class="hljs-property">home</span>.<span class="hljs-property">users</span>,
    };
  });
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.home}</span>&gt;</span>
        {product}
        {users}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Home</span>;
<span class="hljs-title class_">Home</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">"Home"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getServerSideProps</span>: <span class="hljs-title class_">GetServerSideProps</span> =
  wrapper.<span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">store</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (context) =&gt; {
      <span class="hljs-comment">// 1.触发一个异步的action来发起网络请求, 拿到接口数据并存到redex中</span>
      <span class="hljs-keyword">await</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">fetchUserAction</span>());
      <span class="hljs-comment">// 2.实际项目中不一定非要在redux进行网络请求获取数据（考虑是否要作为公共数据存储）</span>
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchProduct</span>();
  
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">props</span>: {
          <span class="hljs-attr">product</span>: res.<span class="hljs-property">data</span>.<span class="hljs-property">product</span> || [],
        },
      };
    };
  });

</code></pre>
<p>看到这里可能会有几个个疑问：getServerSideProps有什么作用？ fetchUserAction这个action做了什么？wrapper又是干嘛的？跟着我的节奏，接下来我们围绕这三个问题展开讲解。</p>
<p>首先我们要知道SSR通常是服务端和客户端分工协作的结果：</p>
<p><strong>SSR数据预取（getServerSideProps）</strong> ：</p>
<ul>
<li>在服务器端执行，页面首次加载时完成</li>
<li>数据在页面渲染前就已准备好</li>
<li>属于服务端渲染范畴</li>
<li>适用于SEO重要、首次加载必需的数据</li>
</ul>
<p><strong>客户端数据获取</strong>：</p>
<ul>
<li>在浏览器端执行，页面渲染后触发</li>
<li>通过用户交互（点击、滚动等）触发</li>
<li>属于客户端渲染范畴</li>
<li>适用于动态、用户交互相关的数据</li>
</ul>
<p>在实际项目中，通常<code>混合使用</code>上面两种方式。
SEO关键数据通过 <code>getServerSideProps</code> 预取，用户交互相关的私密数据则在客户端通过 <code>useEffect</code> 或事件处理函数获取。</p>
<p>接下来我们看看fetchUserAction 在redux中具体实现：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//store\modules\home.ts</span>

<span class="hljs-keyword">import</span> { createSlice, createAsyncThunk } <span class="hljs-keyword">from</span> <span class="hljs-string">"@reduxjs/toolkit"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">HYDRATE</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next-redux-wrapper"</span>;
<span class="hljs-keyword">import</span> { fetchUser } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../service/home"</span>;

<span class="hljs-keyword">const</span> homeSlice = <span class="hljs-title function_">createSlice</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">"home"</span>,
  <span class="hljs-attr">initialState</span>: {
    <span class="hljs-attr">users</span>: {},
  },
  <span class="hljs-attr">extraReducers</span>: <span class="hljs-function">(<span class="hljs-params">builder</span>) =&gt;</span> {
    <span class="hljs-comment">// Hydrate 是 Next.js 提供的一个特殊的 action，用于在服务端渲染时将服务器端的状态合并到客户端的状态中。</span>
    builder
      .<span class="hljs-title function_">addCase</span>(<span class="hljs-variable constant_">HYDRATE</span>, <span class="hljs-function">(<span class="hljs-params">state, action: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> {
          ...state,
          ...action.<span class="hljs-property">payload</span>.<span class="hljs-property">home</span>,
        };
      })
      .<span class="hljs-title function_">addCase</span>(fetchUserAction.<span class="hljs-property">fulfilled</span>, <span class="hljs-function">(<span class="hljs-params">state, { payload }</span>) =&gt;</span> {
        state.<span class="hljs-property">users</span> = payload;
      });
  },
});

<span class="hljs-comment">// 异步的action</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fetchUserAction = <span class="hljs-title function_">createAsyncThunk</span>(
  <span class="hljs-string">"fetchUserAction"</span>,
  <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// 发起网络请求,拿到搜索建议的数据</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>();
    <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>
  }
);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> homeSlice.<span class="hljs-property">reducer</span>;
</code></pre>
<p>每个reducer通过redux toolkit是作为一个切片模块，最终需要整合在一起</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//store\index.ts</span>

<span class="hljs-keyword">import</span> { configureStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@reduxjs/toolkit"</span>;
<span class="hljs-keyword">import</span> { createWrapper } <span class="hljs-keyword">from</span> <span class="hljs-string">"next-redux-wrapper"</span>;
<span class="hljs-keyword">import</span> homeReducer <span class="hljs-keyword">from</span> <span class="hljs-string">"./modules/home"</span>;

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">configureStore</span>({
  <span class="hljs-attr">reducer</span>: {
    <span class="hljs-attr">home</span>: homeReducer,
  },
});

<span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">createWrapper</span>(<span class="hljs-function">() =&gt;</span> store);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> wrapper;

</code></pre>
<p>这里我们可以看到createWrapper生成了一个wraper导出，它的主要作用就是使服务端与客户端状态同步，为什么需要同步？</p>
<p>我们再回顾下SSR的核心原理：</p>
<ul>
<li><strong>服务端状态序列化</strong>：在服务器端渲染时，将 Redux store 的状态序列化并注入到 HTML 中</li>
<li><strong>客户端状态水合</strong>：在客户端首次加载时，将服务端注入的状态重新水合到客户端的 Redux store</li>
<li><strong>避免状态不一致</strong>：防止服务端和客户端渲染结果不一致的问题</li>
</ul>
<p>最终，我们在入口文件_app.tsx中挂载store要做一点调整</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//pages\_app.tsx</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Provider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-redux"</span>;
<span class="hljs-keyword">import</span> wrapper <span class="hljs-keyword">from</span> <span class="hljs-string">"../store"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">AppProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/app"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">{ Component, ...rest }: AppProps</span>) {
  <span class="hljs-comment">//实现服务端和客户端状态的自动同步</span>
  <span class="hljs-keyword">const</span> { store, props } = wrapper.<span class="hljs-title function_">useWrappedStore</span>(rest);
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{store}</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...props.pageProps</span>} /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span>
  );
}

</code></pre>
<p>自此，服务端渲染结合redux的核心应用就完成了！通过一张图梳理下个Next.js SSR数据预取与Redux状态同步的完整流程</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1a95b97deac470c86741c4de2aff620~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdmVudG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764327307&amp;x-signature=yR7r3bKrSghsWwHJCMSVGCqSAds%3D" alt="deepseek_mermaid_20251121_d68c43.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[钉钉小程序直传文件到 阿里云OSS]]></title>    <link>https://juejin.cn/post/7574978545144512547</link>    <guid>https://juejin.cn/post/7574978545144512547</guid>    <pubDate>2025-11-21T12:25:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545144512547" data-draft-id="7574997924929880104" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="钉钉小程序直传文件到 阿里云OSS"/> <meta itemprop="keywords" content="前端,uni-app,Vue.js"/> <meta itemprop="datePublished" content="2025-11-21T12:25:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="广白"/> <meta itemprop="url" content="https://juejin.cn/user/231309974726702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            钉钉小程序直传文件到 阿里云OSS
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/231309974726702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    广白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T12:25:18.000Z" title="Fri Nov 21 2025 12:25:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="tomorrow">.hljs-comment,.hljs-quote{color:#8e908c}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c82829}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5871f}.hljs-attribute{color:#eab700}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#718c00}.hljs-section,.hljs-title{color:#4271ae}.hljs-keyword,.hljs-selector-tag{color:#8959a8}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#4d4d4c}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>举个🌰，用钉钉小程序将一段视频在 前端 直接传到阿里云上。</p>
<p>由于 <code>js-base64</code> 这个npm包在钉钉小程序使用不了，而目前钉钉小程序又没有<code>base64ToArrayBuffe</code>r这类方法，故只能曲线救国，使用 <code>dd.writeFile</code>和 <code>dd.readFile</code>来做<code>base64</code>的转换。</p>
<p>首先，我们得先处理OSS配置，具体如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> crypto <span class="hljs-keyword">from</span> <span class="hljs-string">"crypto-js"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">OSSConfig</span> = {
  <span class="hljs-title class_">AccessKeyId</span>: <span class="hljs-string">"xxxx"</span>,
  <span class="hljs-title class_">AccessKeySecret</span>: <span class="hljs-string">"xxxxxx"</span>,
  <span class="hljs-title class_">Host</span>: <span class="hljs-string">"xxxxx"</span>, <span class="hljs-comment">// 具体某个账号下,</span>
  <span class="hljs-title class_">SecurityToken</span>: <span class="hljs-string">"xx"</span>, <span class="hljs-comment">// 可选，使用STS签名时必传。</span>
}

<span class="hljs-comment">// 计算签名。</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">computeSignature</span> = (<span class="hljs-params">accessKeySecret, canonicalString</span>) =&gt; {
  <span class="hljs-keyword">return</span> crypto.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>.<span class="hljs-title function_">stringify</span>(
    crypto.<span class="hljs-title class_">HmacSHA1</span>(canonicalString, accessKeySecret)
  )
}

<span class="hljs-keyword">let</span> ossData = <span class="hljs-literal">null</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getOssConfig</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  date.<span class="hljs-title function_">setHours</span>(date.<span class="hljs-title function_">getHours</span>() + <span class="hljs-number">24</span>) <span class="hljs-comment">//加 1个小时</span>
  <span class="hljs-keyword">const</span> policyText = {
    <span class="hljs-attr">expiration</span>: date.<span class="hljs-title function_">toISOString</span>(), <span class="hljs-comment">// 设置policy过期时间。</span>
    <span class="hljs-attr">conditions</span>: [
      <span class="hljs-comment">// 限制上传大小。</span>
      [<span class="hljs-string">"content-length-range"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>],
    ],
  }
  <span class="hljs-keyword">let</span> fileManager = dd.<span class="hljs-title function_">getFileSystemManager</span>()
  fileManager.<span class="hljs-title function_">writeFile</span>({
    <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${dd.env.USER_DATA_PATH}</span>/test.txt`</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(policyText),
    <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> {
      fileManager.<span class="hljs-title function_">readFile</span>({
        <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${dd.env.USER_DATA_PATH}</span>/test.txt`</span>,
        <span class="hljs-attr">encoding</span>: <span class="hljs-string">"base64"</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">data</span>, <span class="hljs-string">"readFile"</span>)
          <span class="hljs-keyword">const</span> signature = <span class="hljs-title function_">computeSignature</span>(
            <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">AccessKeySecret</span>,
            res.<span class="hljs-property">data</span>
          )
          ossData = {
            <span class="hljs-title class_">OSSAccessKeyId</span>: <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">AccessKeyId</span>,
            signature,
            <span class="hljs-attr">policy</span>: res.<span class="hljs-property">data</span>,
            <span class="hljs-comment">// "x-oss-security-token": OSSConfig.SecurityToken,</span>
          }
        },
        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
        },
      })
    },
    <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
    },
  })
}
</code></pre>
<p>这个ossData就是我们处理好后的配置项，接下来将其填充到 <code>dd.uploadFile</code> 里就大功告成了！</p>
<pre><code class="hljs language-js" lang="js">dd.<span class="hljs-title function_">chooseVideo</span>({
        <span class="hljs-attr">sourceType</span>: [<span class="hljs-string">"album"</span>, <span class="hljs-string">"camera"</span>],
        <span class="hljs-attr">maxDuration</span>: <span class="hljs-number">60</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-keyword">let</span> uniqueId = <span class="hljs-string">`<span class="hljs-subst">${dirPath}</span>xcx-<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()}</span>.mp4`</span> <span class="hljs-comment">// dirPath为存储的文件夹路径， 比如"dev/front-end/video/"</span>
          uni.<span class="hljs-title function_">showLoading</span>({
            <span class="hljs-attr">title</span>: <span class="hljs-string">"视频上传中..."</span>,
          })
          dd.<span class="hljs-title function_">uploadFile</span>({
            <span class="hljs-attr">url</span>: <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">Host</span>,
            <span class="hljs-attr">fileType</span>: <span class="hljs-string">"video"</span>,
            <span class="hljs-attr">fileName</span>: <span class="hljs-string">"file"</span>,
            <span class="hljs-attr">formData</span>: {
              ...ossData, <span class="hljs-comment">// 上述getOssConfig方法得到的结果</span>
              <span class="hljs-attr">key</span>: uniqueId, <span class="hljs-comment">// 该值为你存在在oss上的位置  后面上传成功之后拼接得到链接需要使用</span>
              <span class="hljs-attr">success_action_status</span>: <span class="hljs-string">"200"</span>, <span class="hljs-comment">// 默认上传成功状态码为204，此处被success_action_status设置为200。</span>
            },
            <span class="hljs-attr">filePath</span>: res.<span class="hljs-property">tempFilePath</span>,
            <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
              uni.<span class="hljs-title function_">hideLoading</span>()
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"视频上传成功,地址为："</span>,<span class="hljs-string">`<span class="hljs-subst">${OSSConfig.Host}</span>/<span class="hljs-subst">${uniqueId}</span>`</span>)
            },
            <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
              uni.<span class="hljs-title function_">hideLoading</span>()
            },
          })
        },
        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
        },
      })
</code></pre>
<p><br/><br/>
<strong>欢迎小伙伴留言讨论，互相学习！</strong></p>
<p><strong>❤❤❤ 如果对你有帮助，记得点赞收藏哦！❤❤❤</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter每日库: local_auth本地设备验证插件]]></title>    <link>https://juejin.cn/post/7574992086715482127</link>    <guid>https://juejin.cn/post/7574992086715482127</guid>    <pubDate>2025-11-21T12:38:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086715482127" data-draft-id="7574997924929912872" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter每日库: local_auth本地设备验证插件"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-21T12:38:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天天开发"/> <meta itemprop="url" content="https://juejin.cn/user/4420475793718670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter每日库: local_auth本地设备验证插件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4420475793718670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天天开发
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T12:38:15.000Z" title="Fri Nov 21 2025 12:38:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在移动应用开发中，用户隐私和安全至关重要。你是否想过为APP添加类似手机解锁的本地身份验证功能？今天介绍的<strong>local_auth插件</strong>，正是Flutter开发者实现指纹、人脸识别的终极武器！无需复杂代码，轻松打造安全又炫酷的认证体验</p>
<h2 data-id="heading-0">功能亮点</h2>
<ul>
<li><strong>多平台支持</strong>：兼容iOS（Face ID/Touch ID）和Android（指纹/人脸）</li>
<li><strong>一键验证</strong>：调用系统原生界面，用户体验无缝衔接</li>
<li><strong>灵活配置</strong>：支持生物识别+密码双验证模式</li>
<li><strong>异常处理</strong>：智能识别硬件锁死、权限异常等场景</li>
</ul>
<h2 data-id="heading-1">安装方式</h2>
<pre><code class="hljs language-csharp" lang="csharp">flutter pub <span class="hljs-keyword">add</span> local_auth
</code></pre>
<h2 data-id="heading-2">详细配置和示例</h2>
<h3 data-id="heading-3">iOS和安卓平台的配置</h3>
<p>iOS需要再info.plist中配置face ID的权限</p>
<pre><code class="hljs language-vbnet" lang="vbnet">&lt;<span class="hljs-keyword">key</span>&gt;NSFaceIDUsageDescription&lt;/<span class="hljs-keyword">key</span>&gt;
&lt;<span class="hljs-type">string</span>&gt;Why <span class="hljs-built_in">is</span> my app authenticating <span class="hljs-keyword">using</span> face id?&lt;/<span class="hljs-type">string</span>&gt;
</code></pre>
<h3 data-id="heading-4">安卓配置如下</h3>
<p>1、修改安卓的原生MainActivity的父类</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> io.flutter.embedding.android.FlutterActivity
​
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">FlutterActivity</span>()
​
<span class="hljs-comment">// 修改为：</span>
<span class="hljs-keyword">import</span> io.flutter.embedding.android.FlutterFragmentActivity
​
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">FlutterFragmentActivity</span> ()
</code></pre>
<p>2、在AndroidManifest.xml添加权限</p>
<pre><code class="hljs language-ini" lang="ini">&lt;manifest xmlns:<span class="hljs-attr">android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
          <span class="hljs-attr">package</span>=<span class="hljs-string">"com.example.app"</span>&gt;
  &lt;uses-permission android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.permission.USE_BIOMETRIC"</span>/&gt;
&lt;manifest&gt;
</code></pre>
<h3 data-id="heading-5">硬件能力检测</h3>
<pre><code class="hljs language-ini" lang="ini">final <span class="hljs-attr">auth</span> = LocalAuthentication()<span class="hljs-comment">;</span>
​
// 检测设备是否支持
bool <span class="hljs-attr">isSupported</span> = await auth.isDeviceSupported()<span class="hljs-comment">;</span>
​
// 查看已注册的生物识别类型
List&lt;BiometricType&gt; <span class="hljs-attr">types</span> = await auth.getAvailableBiometrics()<span class="hljs-comment">;</span>
// 可能返回：fingerprint（指纹）、face（人脸）、strong（高安全级别）
</code></pre>
<h3 data-id="heading-6">完整代码示例</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/services.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:local_auth/local_auth.dart'</span>;
​
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> TestPage({<span class="hljs-keyword">super</span>.key});
​
  <span class="hljs-meta">@override</span>
  State&lt;TestPage&gt; createState() =&gt; _TestPageState();
}
​
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_TestPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">TestPage</span>&gt; </span>{
  <span class="hljs-keyword">final</span> LocalAuthentication auth = LocalAuthentication();
​
  Future&lt;<span class="hljs-keyword">void</span>&gt; _checkBiometrics() <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// canCheckBiometrics 仅指示硬件是否支持，并不表示设备是否已注册任何生物识别信息，有可能未录入指纹或者人脸</span>
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> canAuthenticateWithBiometrics = <span class="hljs-keyword">await</span> auth.canCheckBiometrics;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isDeviceSupported = <span class="hljs-keyword">await</span> auth.isDeviceSupported();
    debugPrint(
      <span class="hljs-string">"canAuthenticateWithBiometrics = <span class="hljs-subst">$canAuthenticateWithBiometrics</span> isDeviceSupported = <span class="hljs-subst">$isDeviceSupported</span>"</span>,
    );
  }
​
  Future&lt;<span class="hljs-keyword">void</span>&gt; _getAvailableBiometricsData() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;BiometricType&gt; availableBiometrics = <span class="hljs-keyword">await</span> auth
        .getAvailableBiometrics();
​
    <span class="hljs-keyword">if</span> (availableBiometrics.isEmpty) {
      debugPrint(<span class="hljs-string">"设备未注册任何生物识别信息"</span>);
      <span class="hljs-keyword">return</span>;
    }
​
    <span class="hljs-keyword">for</span> (BiometricType item <span class="hljs-keyword">in</span> availableBiometrics) {
      debugPrint(<span class="hljs-string">"type = <span class="hljs-subst">${item.name}</span>"</span>);
    }
​
    <span class="hljs-comment">// if (availableBiometrics.contains(BiometricType.strong) ||</span>
    <span class="hljs-comment">//     availableBiometrics.contains(BiometricType.face)) {</span>
    <span class="hljs-comment">// }</span>
  }
​
  Future&lt;<span class="hljs-keyword">void</span>&gt; authenticateTest() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> didAuthenticate = <span class="hljs-keyword">await</span> auth.authenticate(
        localizedReason: <span class="hljs-string">'Please authenticate to show account balance'</span>,
        biometricOnly: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// 强制使用生物识别认证</span>
        persistAcrossBackgrounding: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// 应用未验证就退到后台，再次在前台运行时，重试身份验证</span>
      );
​
      <span class="hljs-keyword">if</span> (didAuthenticate) {
        debugPrint(<span class="hljs-string">"success"</span>);
      } <span class="hljs-keyword">else</span> {
        debugPrint(<span class="hljs-string">"fail"</span>);
      }
    } <span class="hljs-keyword">on</span> LocalAuthException <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-comment">// 异常处理  temporaryLockout  biometricLockout  指纹或face ID被锁定</span>
      debugPrint(<span class="hljs-string">"LocalAuthException <span class="hljs-subst">${e.toString()}</span>"</span>);
    } <span class="hljs-keyword">on</span> PlatformException <span class="hljs-keyword">catch</span> (e) {
      debugPrint(<span class="hljs-string">"PlatformException <span class="hljs-subst">${e.message}</span>"</span>);
    }
  }
​
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> MaterialApp(
      home: Scaffold(
        appBar: AppBar(title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'local_auth'</span>)),
        body: Column(
          children: [
            ElevatedButton(
              onPressed: () {
                _checkBiometrics();
              },
              child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'检查此设备是否支持本地身份验证'</span>),
            ),
​
            ElevatedButton(
              onPressed: () {
                _getAvailableBiometricsData();
              },
              child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'获取注册生物识别信息的列表'</span>),
            ),
​
            ElevatedButton(
              onPressed: () {
                authenticateTest();
              },
              child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Check biometrics'</span>),
            ),
          ],
        ),
      ),
    );
  }
}
​
</code></pre>
<p>以上就是该库在移动端的使用情况了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[windows中flutter开发鸿蒙实操]]></title>    <link>https://juejin.cn/post/7574840547808182282</link>    <guid>https://juejin.cn/post/7574840547808182282</guid>    <pubDate>2025-11-21T12:52:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574840547808182282" data-draft-id="7575017581036224550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="windows中flutter开发鸿蒙实操"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-21T12:52:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大雷神"/> <meta itemprop="url" content="https://juejin.cn/user/1688498113884839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            windows中flutter开发鸿蒙实操
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1688498113884839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大雷神
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T12:52:07.000Z" title="Fri Nov 21 2025 12:52:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h3 data-id="heading-0">环境搭建完成 开始构建项目</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83de3916c2f34b4da65e1e6e8c216e2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=PZJHXKzBIsEVL5aZUZhYsXyEAk0%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<h3 data-id="heading-1">项目目录</h3>
<p>打开项目以后 可以看到结构如下 里面的ohos就是鸿蒙代码</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b093bacf9a4849c8b30ea2059595c5c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=XUyCkUhksB64N64Vj0rBpd2BJiA%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<p>展开看看 熟悉吧</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37d683688a04416ab842c8f00a354274~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=JCHzqD4XhqbiLhenlFukJP%2FLWH8%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<p>不要直接去操作这些代码，肯定跑不起来的</p>
<h3 data-id="heading-2">启动模拟器</h3>
<p>这个时候打开DevEco工具 启动模拟器 随便用哪个项目打开都行 只启动模拟器就可以了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49bbc5745f2e492e9e87ca7f3da75495~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=HCIW%2BB6Wi7JR3LbukSrR81ehuQM%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<p>启动以后</p>
<h3 data-id="heading-3">打包</h3>
<p>打开项目目录 运行</p>
<p>flutter build hap --debug</p>
<p>构建鸿蒙项目包</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fafb23b8256a41d480b87b8e72210b50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=pYCxFYus1cTJ3w8CZ7lJs1DDgIw%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<p>打包完成后开始运行flutter项目<br/>
在终端继续输入命令：</p>
<p>flutter run<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b36cc8a27e84ec5aab757b1e671dd52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=DJqZNYgIelJkREvBQMuYXgYhEYs%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑然后选择1 用模拟器启动</p>
<h3 data-id="heading-4">模拟器效果</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/687db6f9aaf94759a3fda2f285311776~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=azXeWo7hrIV35rx78wY695Kmo6c%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<h3 data-id="heading-5">实操</h3>
<p>用vsCode打开项目 找到lib目录 里面的main.dart 就是程序的主入口</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df1bbc21eee44d4e91bc35b0339713c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=ncACY5U3jrJ%2FQY426%2BEghYV1XeY%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑在lib中分别新建pages，在新建四个文件夹 Home Cinema Film Mine ,然后分别新建各自的默认页面 index.dart</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9564b73c027b42a4ba40b74378bef6a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=inytvsjBiQbcFHEjzDKKE4rD9q8%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<p>分别定义好自己的页面内容</p>
<p>Cinema/index</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:flutter/material.dart';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CinemaPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>{
  const <span class="hljs-type">CinemaPage</span>({<span class="hljs-keyword">super</span>.key});
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
   <span class="hljs-keyword">return</span> const <span class="hljs-type">Center</span>(
    child: <span class="hljs-type">Text</span>('影院',style: <span class="hljs-type">TextStyle</span>(fontSize: <span class="hljs-number">24</span>),),
   );
  }
}

</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p>Film/index</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:flutter/material.dart';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FilmPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  const <span class="hljs-type">FilmPage</span>({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> const <span class="hljs-type">Center</span>(
      child: <span class="hljs-type">Text</span>('电影', style: <span class="hljs-type">TextStyle</span>(fontSize: <span class="hljs-number">24</span>)),
    );
  }
}
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p>Home/index</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:flutter/material.dart';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>{
  const <span class="hljs-type">HomePage</span>({<span class="hljs-keyword">super</span>.key});
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {

    <span class="hljs-keyword">return</span> const <span class="hljs-type">Center</span>(
      child: <span class="hljs-type">Column</span>(
        mainAxisAlignment: <span class="hljs-type">MainAxisAlignment</span>.center,
        children: &lt;<span class="hljs-type">Widget</span>&gt;[
          <span class="hljs-type">Text</span>('首页',style: <span class="hljs-type">TextStyle</span>(fontSize:<span class="hljs-number">24</span>))
        ],
      )
    );




  }
}
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p>Mine/index</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:flutter/material.dart';

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MinePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  const <span class="hljs-type">MinePage</span>({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> const <span class="hljs-type">Center</span>(
      child: <span class="hljs-type">Text</span>('我的', style: <span class="hljs-type">TextStyle</span>(fontSize: <span class="hljs-number">24</span>)),
    );
  }
}
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p>最后修改main.dart文件</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:flutter/material.dart';
<span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:my_app01/pages/<span class="hljs-type">Cinema</span>/index.dart';
<span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:my_app01/pages/<span class="hljs-type">Home</span>/index.dart';
<span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:my_app01/pages/<span class="hljs-type">Film</span>/index.dart';
<span class="hljs-keyword">import</span> '<span class="hljs-keyword">package</span>:my_app01/pages/<span class="hljs-type">Mine</span>/index.dart';


void main() {
  runApp(const <span class="hljs-type">MyApp</span>());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  const <span class="hljs-type">MyApp</span>({<span class="hljs-keyword">super</span>.key});
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">MaterialApp</span>(
      title: '<span class="hljs-type">Flutter</span> <span class="hljs-type">Demo</span>',
      theme: <span class="hljs-type">ThemeData</span>(
        colorScheme: <span class="hljs-type">ColorScheme</span>.fromSeed(seedColor: <span class="hljs-type">Colors</span>.deepPurple),
        useMaterial3: <span class="hljs-literal">true</span>,
      ),
      home: const <span class="hljs-type">MainScreen</span>(),
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  const <span class="hljs-type">MainScreen</span>({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">State</span>&lt;<span class="hljs-type">MainScreen</span>&gt;createState()=&gt;_MainScreenState();
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MainScreenState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State&lt;MainScreen&gt;</span></span>{
  int _currentIndex = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">final</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">Widget</span>&gt; _page = const[
    <span class="hljs-type">HomePage</span>(),
    <span class="hljs-type">CinemaPage</span>(),
    <span class="hljs-type">FilmPage</span>(),
    <span class="hljs-type">MinePage</span>(),
  ];
  <span class="hljs-keyword">final</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">BottomNavigationBarItem</span>&gt; _navBarItems = [
    const <span class="hljs-type">BottomNavigationBarItem</span>(
      icon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.home_outlined),
      activeIcon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.home,color: <span class="hljs-type">Colors</span>.blue),
      label: '首页'
    ),
    const <span class="hljs-type">BottomNavigationBarItem</span>(
      icon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.contacts_outlined),
      activeIcon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.contacts, color: <span class="hljs-type">Colors</span>.blue),
      label: '影院',
    ),
    const <span class="hljs-type">BottomNavigationBarItem</span>(
      icon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.people_outline),
      activeIcon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.people, color: <span class="hljs-type">Colors</span>.blue),
      label: '个人',
    ),
    const <span class="hljs-type">BottomNavigationBarItem</span>(
      icon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.person_outline),
      activeIcon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.person, color: <span class="hljs-type">Colors</span>.blue),
      label: '我的',
    ),
  ];
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context){
    <span class="hljs-keyword">return</span> <span class="hljs-type">Scaffold</span>(
      appBar: <span class="hljs-type">AppBar</span>(
        title: <span class="hljs-type">Text</span>(_getAppBarTitle()),
      ),
      body: _page[_currentIndex],
      bottomNavigationBar: <span class="hljs-type">BottomNavigationBar</span>(
       items: _navBarItems,
        currentIndex: _currentIndex,
        onTap: (index) {
          setState(() {
            _currentIndex = index; <span class="hljs-comment">// 更新当前索引</span>
          });
        },
        <span class="hljs-class"><span class="hljs-keyword">type</span></span>: <span class="hljs-type">BottomNavigationBarType</span>.fixed, <span class="hljs-comment">// 固定样式（支持4个以上）</span>
        selectedItemColor: <span class="hljs-type">Colors</span>.blue, <span class="hljs-comment">// 选中项颜色</span>
        unselectedItemColor: <span class="hljs-type">Colors</span>.grey, <span class="hljs-comment">// 未选中项颜色</span>
      ),
    );
  }
  <span class="hljs-comment">// 根据当前索引返回AppBar标题</span>
  <span class="hljs-type">String</span> _getAppBarTitle() {
    switch (_currentIndex) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-keyword">return</span> '首页';
      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-keyword">return</span> '影院';
      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> '电影';
      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-keyword">return</span> '个人';
      <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> '我的应用';
    }
  }
}
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<h3 data-id="heading-6">先启动鸿蒙虚拟机 或者真机</h3>
<h3 data-id="heading-7">编译成鸿蒙</h3>
<p>先运行 flutter build hap</p>
<p>在运行 flutter run</p>
<p>最后的效果如下</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcab8fc1cbf54fa6b32f483261417b60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn6Zu356We:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334327&amp;x-signature=UQFtEcrt0P9peK2C92HxDBHR1wE%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<p>你学废了吗？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Ffd34ff9286174e848d34cde7f512ce22%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" title="https://developer.huawei.com/consumer/cn/training/classDetail/fd34ff9286174e848d34cde7f512ce22?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" target="_blank" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cn…</a></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++进阶小技巧：让代码从"能用"变"优雅"]]></title>    <link>https://juejin.cn/post/7574840547808313354</link>    <guid>https://juejin.cn/post/7574840547808313354</guid>    <pubDate>2025-11-21T13:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574840547808313354" data-draft-id="7575006095388753929" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++进阶小技巧：让代码从&quot;能用&quot;变&quot;优雅&quot;"/> <meta itemprop="keywords" content="前端,C++"/> <meta itemprop="datePublished" content="2025-11-21T13:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AAA简单玩转程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/4294056357689099"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++进阶小技巧：让代码从"能用"变"优雅"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4294056357689099/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AAA简单玩转程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T13:26:16.000Z" title="Fri Nov 21 2025 13:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在掘金逛C++帖子时，总能看到新手问"为什么我的代码能跑但总被review打回"？其实很多时候不是逻辑错了，而是没掌握这些"进阶偏基础"的实用技巧——既能少踩坑，又能让代码更简洁高效，配上极简例子一看就会～</p>
<h2 data-id="heading-0">1. 前向声明：头文件依赖的"减负神器"</h2>
<p>还在头文件里疯狂#include？前向声明能直接减少编译依赖，还能解决循环依赖问题 ！</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// forward.h （集中存放前向声明）</span>
<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Document</span>; <span class="hljs-comment">// 无需包含完整定义，声明即可</span>

<span class="hljs-comment">// my_class.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"forward.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    std::unique_ptr&lt;Document&gt; doc; <span class="hljs-comment">// 指针/引用类型只需前向声明</span>
};
</code></pre>
<p> </p>
<p>核心优势：编译速度翻倍，避免"改一个头文件全工程重编"的痛苦。</p>
<h2 data-id="heading-1">2. emplace_back：容器插入的"性能王者"</h2>
<p>别再用push_back了！<code>emplace_back</code>直接在容器内构造对象，省去临时对象拷贝的开销 。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

std::vector&lt;std::string&gt; vec;
vec.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">string</span>(<span class="hljs-string">"hello"</span>)); <span class="hljs-comment">// 先构造临时对象，再拷贝</span>
vec.<span class="hljs-built_in">emplace_back</span>(<span class="hljs-string">"world"</span>); <span class="hljs-comment">// 直接在vector里构造，零拷贝</span>
</code></pre>
<p> </p>
<p>适用场景：所有支持的STL容器（vector、list、map等），插入复杂对象时效果超明显。</p>
<h2 data-id="heading-2">3. 静态工厂方法：对象创建的"安全卫士"</h2>
<p>构造函数没法返回错误？静态工厂方法能优雅处理对象创建失败，避免部分初始化的坑 。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;optional&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FileProcessor</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 静态工厂方法，创建失败返回nullopt</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::optional&lt;FileProcessor&gt; <span class="hljs-title">create</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; filename)</span> </span>{
        <span class="hljs-function">std::ifstream <span class="hljs-title">file</span><span class="hljs-params">(filename)</span></span>;
        <span class="hljs-keyword">if</span> (!file.<span class="hljs-built_in">is_open</span>()) <span class="hljs-keyword">return</span> std::<span class="hljs-literal">nullopt</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">FileProcessor</span>(std::<span class="hljs-built_in">move</span>(file)); <span class="hljs-comment">// 私有构造确保初始化成功</span>
    }
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">FileProcessor</span><span class="hljs-params">(std::ifstream file)</span> : file_(std::move(file)) {</span>}
    std::ifstream file_;
};

<span class="hljs-comment">// 使用：创建成功才执行逻辑</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> processor = FileProcessor::<span class="hljs-built_in">create</span>(<span class="hljs-string">"data.txt"</span>)) {
    processor-&gt;<span class="hljs-built_in">process</span>();
}
</code></pre>
<p> </p>
<h2 data-id="heading-3">4. 结构化绑定：解包的"懒人福音"</h2>
<p>不用再写<code>get&lt;0&gt;、get&lt;1&gt;</code>了！结构化绑定能直接<code>解包tuple/pair</code>，代码清爽到飞起。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;tuple&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-comment">// 返回多个值的函数</span>
<span class="hljs-function">std::tuple&lt;<span class="hljs-type">int</span>, std::string, <span class="hljs-type">float</span>&gt; <span class="hljs-title">getUser</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> {<span class="hljs-number">101</span>, <span class="hljs-string">"张三"</span>, <span class="hljs-number">95.5</span>};
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> [id, name, score] = <span class="hljs-built_in">getUser</span>(); <span class="hljs-comment">// 直接绑定三个变量</span>
    <span class="hljs-comment">// id=101, name="张三", score=95.5</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p> </p>
<h2 data-id="heading-4">5. 作用域守卫：资源清理的"自动管家"</h2>
<p>怕函数中途<code>return</code>导致资源泄漏？作用域守卫能确保离开作用域时自动执行清理逻辑 。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ScopeGuard</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">ScopeGuard</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; cleanup)</span> 
        : cleanup_(std::move(cleanup)), active_(true) {</span>}
    ~<span class="hljs-built_in">ScopeGuard</span>() { <span class="hljs-keyword">if</span> (active_) <span class="hljs-built_in">cleanup_</span>(); }
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dismiss</span><span class="hljs-params">()</span> </span>{ active_ = <span class="hljs-literal">false</span>; } <span class="hljs-comment">// 可取消清理</span>
<span class="hljs-keyword">private</span>:
    std::function&lt;<span class="hljs-type">void</span>()&gt; cleanup_;
    <span class="hljs-type">bool</span> active_;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">writeFile</span><span class="hljs-params">()</span> </span>{
    FILE* file = <span class="hljs-built_in">fopen</span>(<span class="hljs-string">"temp.txt"</span>, <span class="hljs-string">"w"</span>);
    <span class="hljs-function">ScopeGuard <span class="hljs-title">guard</span><span class="hljs-params">([&amp;]() { <span class="hljs-keyword">if</span> (file) fclose(file); })</span></span>; <span class="hljs-comment">// 自动关文件</span>
    
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">someError</span>()) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 即使提前返回，文件也会关闭</span>
}
</code></pre>
<p> </p>
<h2 data-id="heading-5">6. constexpr：编译期计算的"性能加速器"</h2>
<p>把能在编译期算的逻辑交给编译器，运行时零开销，还能用作常量表达式 。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 编译期计算阶乘</span>
<span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">factorial</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> </span>{
    <span class="hljs-keyword">return</span> n &lt;= <span class="hljs-number">1</span> ? <span class="hljs-number">1</span> : n * <span class="hljs-built_in">factorial</span>(n - <span class="hljs-number">1</span>);
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> size = <span class="hljs-built_in">factorial</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// 编译时就算出120</span>
    <span class="hljs-type">int</span> arr[size]; <span class="hljs-comment">// 可直接用作数组大小</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p> </p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多语言的爱意告白]]></title>    <link>https://juejin.cn/post/7575021014032564243</link>    <guid>https://juejin.cn/post/7575021014032564243</guid>    <pubDate>2025-11-21T14:35:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575021014032564243" data-draft-id="7575050949958434852" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多语言的爱意告白"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-21T14:35:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="花开花富贵"/> <meta itemprop="url" content="https://juejin.cn/user/3220933005549171"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多语言的爱意告白
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3220933005549171/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    花开花富贵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T14:35:39.000Z" title="Fri Nov 21 2025 14:35:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这张图片以黑色为背景，中央突出显示白色的 “小鱼” 字样，周围环绕着多语言的 “我喜欢你”“我爱你”“和我交往吧”“在一起” 等表达爱慕与交往意愿的文字，文字颜色多样，营造出一种充满爱意的视觉氛围。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/775fa0cfa4d44cde9ee8ed313f08d7d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Iqx5byA6Iqx5a-M6LS1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764340539&amp;x-signature=VBCcq0jZRoznZKaPUh5CUdpeiMo%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pygame
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> math
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 初始化pygame</span>
pygame.init()
<span class="hljs-comment"># 窗口设置</span>
width, height = <span class="hljs-number">1000</span>, <span class="hljs-number">800</span>
screen = pygame.display.set_mode((width, height))

<span class="hljs-comment"># 改进的字体设置函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_font</span>(<span class="hljs-params">size</span>):
    font_paths = [
        <span class="hljs-string">"C:/Windows/Fonts/simhei.ttf"</span>, <span class="hljs-string">"C:/Windows/Fonts/msyh.ttc"</span>, <span class="hljs-string">"C:/Windows/Fonts/simsun.ttc"</span>,
        <span class="hljs-string">"/System/Library/Fonts/PingFang.ttc"</span>, <span class="hljs-string">"/System/Library/Fonts/Arial.ttf"</span>,
        <span class="hljs-string">"/usr/share/fonts/truetype/droid/DroidSansFallbackFull.ttf"</span>, <span class="hljs-string">"/usr/share/fonts/truetype/wqy/wqy-microhei.ttc"</span>,
    ]
    <span class="hljs-keyword">for</span> font_path <span class="hljs-keyword">in</span> font_paths:
        <span class="hljs-keyword">if</span> os.path.exists(font_path):
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">return</span> pygame.font.Font(font_path, size)
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">return</span> pygame.font.SysFont(<span class="hljs-string">"Arial"</span>, size)
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> pygame.font.Font(<span class="hljs-literal">None</span>, size)

<span class="hljs-comment"># 创建字体对象（弹幕字体稍大，保证清晰）</span>
font = get_font(<span class="hljs-number">20</span>)
title_font = get_font(<span class="hljs-number">36</span>)
danmu_font = get_font(<span class="hljs-number">20</span>)  <span class="hljs-comment"># 弹幕字体大小适中</span>
<span class="hljs-comment"># 新增名字专用字体（更大更醒目）</span>
name_font = get_font(<span class="hljs-number">60</span>)  <span class="hljs-comment"># 字体大小60，突出显示</span>

<span class="hljs-comment"># 多语言“我爱你”文本库（原内容完全保留）</span>
love_texts = [
    <span class="hljs-string">"Mola le offi la tee"</span>, <span class="hljs-string">"mihai amestiah sind"</span>, <span class="hljs-string">"milvini un ne seibesc"</span>, <span class="hljs-string">"Le sakam"</span>, <span class="hljs-string">"Mlohuujam"</span>,
    <span class="hljs-string">"Te sakam"</span>, <span class="hljs-string">"chami dài e n ki n M"</span>, <span class="hljs-string">"Te dua"</span>, <span class="hljs-string">"Té okabescu"</span>, <span class="hljs-string">"Tá grá agam duit"</span>, <span class="hljs-string">"Kocham Ci"</span>,
    <span class="hljs-string">"Saya cintakan kamu"</span>, <span class="hljs-string">"我爱你"</span>, <span class="hljs-string">"Te ambesc"</span>, <span class="hljs-string">"Mahal kita"</span>, <span class="hljs-string">"Jeg elsker deg"</span>, <span class="hljs-string">"Mihaji té"</span>, <span class="hljs-string">"Meng sona"</span>,
    <span class="hljs-string">"Szerethékda"</span>, <span class="hljs-string">"Jag Tjukin"</span>, <span class="hljs-string">"Teja amerhi"</span>, <span class="hljs-string">"L kertesi skarji"</span>, <span class="hljs-string">"joga nem lesen"</span>, <span class="hljs-string">"nyolyomni"</span>,
    <span class="hljs-string">"I love you"</span>, <span class="hljs-string">"Je t'aime"</span>, <span class="hljs-string">"Ich liebe dich"</span>, <span class="hljs-string">"Ti amo"</span>, <span class="hljs-string">"Te amo"</span>, <span class="hljs-string">"あいしてる"</span>,
    <span class="hljs-string">"我爱你"</span>, <span class="hljs-string">"我中意你"</span>, <span class="hljs-string">"我爱侬"</span>, <span class="hljs-string">"我欢喜你"</span>, <span class="hljs-string">"我爱你"</span>, <span class="hljs-string">"我愛你"</span>, <span class="hljs-string">"勾买蒙"</span>, <span class="hljs-string">"额爱你"</span>,<span class="hljs-string">"我待见你"</span>
    <span class="hljs-string">"恩欢喜你"</span>, <span class="hljs-string">"我爱列"</span>, <span class="hljs-string">"Ik hou van je"</span>, <span class="hljs-string">"Saya cintakan mu"</span>, <span class="hljs-string">"Ti amo"</span>, <span class="hljs-string">"Jeg elsker dig"</span>,
    <span class="hljs-string">"Aku cinta padamu"</span>, <span class="hljs-string">"Saya cinta kamu"</span>, <span class="hljs-string">"Ljubim te"</span>, <span class="hljs-string">"俺喜欢"</span>, <span class="hljs-string">"我稀罕你"</span>, <span class="hljs-string">"俺稀罕你"</span>,<span class="hljs-string">"阿秋拉嘎"</span>
]

<span class="hljs-comment"># 爱心坐标生成（原逻辑完全保留，未做任何修改）</span>
love_points = []
<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):
    theta = t / <span class="hljs-number">1000</span> * <span class="hljs-number">2</span> * math.pi
    x = <span class="hljs-number">15</span> * (<span class="hljs-built_in">pow</span>(math.sin(theta), <span class="hljs-number">3</span>))
    y = <span class="hljs-number">10</span> * math.cos(theta) - <span class="hljs-number">5</span> * math.cos(<span class="hljs-number">2</span> * theta) - <span class="hljs-number">2</span> * math.cos(<span class="hljs-number">3</span> * theta) - math.cos(<span class="hljs-number">4</span> * theta)
    x = x * <span class="hljs-number">18</span> + width // <span class="hljs-number">2</span>
    y = -y * <span class="hljs-number">18</span> + height // <span class="hljs-number">2</span>
    love_points.append((<span class="hljs-built_in">int</span>(x), <span class="hljs-built_in">int</span>(y)))

<span class="hljs-comment"># 文字对象列表（原逻辑完全保留，未做任何修改）</span>
text_objects = []
colors = [(<span class="hljs-number">255</span>, <span class="hljs-number">182</span>, <span class="hljs-number">193</span>), (<span class="hljs-number">255</span>, <span class="hljs-number">105</span>, <span class="hljs-number">180</span>), (<span class="hljs-number">255</span>, <span class="hljs-number">20</span>, <span class="hljs-number">147</span>),(<span class="hljs-number">218</span>,<span class="hljs-number">112</span>,<span class="hljs-number">214</span>)]
<span class="hljs-keyword">for</span> i, text <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(love_texts):
    color = colors[i % <span class="hljs-built_in">len</span>(colors)]
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(text, <span class="hljs-built_in">str</span>):
            text = <span class="hljs-built_in">str</span>(text)
        text_surface = font.render(text, <span class="hljs-literal">True</span>, color)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"渲染失败 '<span class="hljs-subst">{text}</span>': <span class="hljs-subst">{e}</span>"</span>)
        text_surface = font.render(<span class="hljs-string">"Love"</span>, <span class="hljs-literal">True</span>, color)
    idx = random.randint(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(love_points) - <span class="hljs-number">1</span>)
    x, y = love_points[idx]
    speed_x = random.uniform(-<span class="hljs-number">0.15</span>, <span class="hljs-number">0.15</span>)
    speed_y = random.uniform(-<span class="hljs-number">0.15</span>, <span class="hljs-number">0.15</span>)
    text_objects.append({
        <span class="hljs-string">"surface"</span>: text_surface, <span class="hljs-string">"text"</span>: text, <span class="hljs-string">"x"</span>: x, <span class="hljs-string">"y"</span>: y,
        <span class="hljs-string">"speed_x"</span>: speed_x, <span class="hljs-string">"speed_y"</span>: speed_y, <span class="hljs-string">"target_idx"</span>: idx, <span class="hljs-string">"color"</span>: color
    })

<span class="hljs-comment"># ===================== 弹幕功能（按要求优化）=====================</span>
<span class="hljs-comment"># 弹幕仅保留3条中文文案</span>
danmu_texts = [<span class="hljs-string">"我爱你"</span>, <span class="hljs-string">"在一起"</span>, <span class="hljs-string">"我喜欢你"</span>,<span class="hljs-string">"和我交往吧"</span>,<span class="hljs-string">"阿秋拉嘎"</span>]
<span class="hljs-comment"># 弹幕仅一种粉色（鲜艳且协调）</span>
danmu_color = (<span class="hljs-number">255</span>,<span class="hljs-number">239</span>,<span class="hljs-number">213</span>)  <span class="hljs-comment"># 热粉色</span>

<span class="hljs-comment"># 弹幕对象类（速度加快，淡入淡出节奏紧凑）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Danmu</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.text = random.choice(danmu_texts)
        self.font_size = random.randint(<span class="hljs-number">18</span>, <span class="hljs-number">24</span>)  <span class="hljs-comment"># 字体大小随机</span>
        self.font = get_font(self.font_size)
        self.color = danmu_color
        <span class="hljs-comment"># 随机位置（全屏分布，支持左右/上下双向运动）</span>
        <span class="hljs-keyword">if</span> random.random() &gt; <span class="hljs-number">0.5</span>:
            <span class="hljs-comment"># 从左向右运动</span>
            self.x = random.randint(-<span class="hljs-number">100</span>, -<span class="hljs-number">20</span>)
            self.y = random.randint(<span class="hljs-number">50</span>, height - <span class="hljs-number">50</span>)
            self.speed_x = random.uniform(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)  <span class="hljs-comment"># 加快水平速度</span>
            self.speed_y = random.uniform(-<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>)  <span class="hljs-comment"># 轻微垂直偏移</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 从右向左运动</span>
            self.x = random.randint(width + <span class="hljs-number">20</span>, width + <span class="hljs-number">100</span>)
            self.y = random.randint(<span class="hljs-number">50</span>, height - <span class="hljs-number">50</span>)
            self.speed_x = random.uniform(-<span class="hljs-number">5</span>, -<span class="hljs-number">3</span>)  <span class="hljs-comment"># 加快水平速度</span>
            self.speed_y = random.uniform(-<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>)  <span class="hljs-comment"># 轻微垂直偏移</span>
        self.alpha = <span class="hljs-number">0</span>  <span class="hljs-comment"># 初始透明度为0</span>
        self.life = random.randint(<span class="hljs-number">80</span>, <span class="hljs-number">150</span>)  <span class="hljs-comment"># 生命周期缩短（速度快对应短生命周期）</span>
        self.life_count = <span class="hljs-number">0</span>
        self.surface = self._render_text()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_render_text</span>(<span class="hljs-params">self</span>):
        surf = self.font.render(self.text, <span class="hljs-literal">True</span>, self.color)
        surf.set_alpha(self.alpha)
        <span class="hljs-keyword">return</span> surf

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self</span>):
        self.life_count += <span class="hljs-number">1</span>
        <span class="hljs-comment"># 快速淡入（前20%生命周期完成淡入）</span>
        <span class="hljs-keyword">if</span> self.life_count &lt; self.life * <span class="hljs-number">0.2</span>:
            self.alpha = <span class="hljs-built_in">min</span>(<span class="hljs-number">255</span>, self.alpha + <span class="hljs-number">15</span>)  <span class="hljs-comment"># 加快淡入速度</span>
        <span class="hljs-comment"># 快速淡出（后30%生命周期完成淡出）</span>
        <span class="hljs-keyword">elif</span> self.life_count &gt; self.life * <span class="hljs-number">0.7</span>:
            self.alpha = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, self.alpha - <span class="hljs-number">10</span>)  <span class="hljs-comment"># 加快淡出速度</span>
        <span class="hljs-comment"># 更新透明度和位置（速度加快）</span>
        self.surface.set_alpha(self.alpha)
        self.x += self.speed_x
        self.y += self.speed_y
        <span class="hljs-comment"># 生命周期结束或超出屏幕则重置</span>
        <span class="hljs-keyword">if</span> self.life_count &gt;= self.life <span class="hljs-keyword">or</span> self.x &lt; -<span class="hljs-number">200</span> <span class="hljs-keyword">or</span> self.x &gt; width + <span class="hljs-number">200</span>:
            self.__init__()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params">self, screen</span>):
        rect = self.surface.get_rect(center=(self.x, self.y))
        screen.blit(self.surface, rect)

<span class="hljs-comment"># 初始化弹幕（初始30条，数量适中不遮挡爱心）</span>
danmu_list = [Danmu() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>)]
<span class="hljs-comment"># 弹幕生成计时器（生成频率加快）</span>
danmu_spawn_timer = <span class="hljs-number">0</span>
danmu_spawn_interval = <span class="hljs-number">20</span>  <span class="hljs-comment"># 每20帧（约0.3秒）新增1条弹幕</span>

<span class="hljs-comment"># 原标题与说明文字（保留）</span>
<span class="hljs-keyword">try</span>:
    title_text = title_font.render(<span class="hljs-string">""</span>, <span class="hljs-literal">True</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))
<span class="hljs-keyword">except</span>:
    title_text = title_font.render(<span class="hljs-string">"I Love You + Pink Danmu"</span>, <span class="hljs-literal">True</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))
instruction_font = get_font(<span class="hljs-number">16</span>)
instruction_text = instruction_font.render(<span class="hljs-string">"按ESC键退出"</span>, <span class="hljs-literal">True</span>, (<span class="hljs-number">150</span>, <span class="hljs-number">150</span>, <span class="hljs-number">150</span>))

<span class="hljs-comment"># 生成居中显示的名字（白色，屏幕正中间）</span>
name_text = name_font.render(<span class="hljs-string">"小鱼"</span>, <span class="hljs-literal">True</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))  <span class="hljs-comment"># 白色文字</span>
<span class="hljs-comment"># 计算名字居中坐标（屏幕正中心）</span>
name_x = width // <span class="hljs-number">2</span> - name_text.get_width() // <span class="hljs-number">2</span>
name_y = height // <span class="hljs-number">2</span> - name_text.get_height() // <span class="hljs-number">2</span>

<span class="hljs-comment"># 主循环（仅添加名字绘制，不改动原有内容）</span>
clock = pygame.time.Clock()
running = <span class="hljs-literal">True</span>
<span class="hljs-keyword">while</span> running:
    <span class="hljs-comment"># 事件处理（原逻辑保留）</span>
    <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> pygame.event.get():
        <span class="hljs-keyword">if</span> event.<span class="hljs-built_in">type</span> == pygame.QUIT:
            running = <span class="hljs-literal">False</span>
        <span class="hljs-keyword">elif</span> event.<span class="hljs-built_in">type</span> == pygame.KEYDOWN:
            <span class="hljs-keyword">if</span> event.key == pygame.K_ESCAPE:
                running = <span class="hljs-literal">False</span>

    <span class="hljs-comment"># 黑色背景（原逻辑保留）</span>
    screen.fill((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))

    <span class="hljs-comment"># 绘制标题、说明文字（原逻辑保留）</span>
    screen.blit(title_text, (width // <span class="hljs-number">2</span> - title_text.get_width() // <span class="hljs-number">2</span>, <span class="hljs-number">20</span>))
    screen.blit(instruction_text, (width - instruction_text.get_width() - <span class="hljs-number">10</span>, height - <span class="hljs-number">30</span>))

    <span class="hljs-comment"># 绘制爱心轨迹文字（原逻辑完全保留，未做任何修改）</span>
    <span class="hljs-keyword">for</span> obj <span class="hljs-keyword">in</span> text_objects:
        text_rect = obj[<span class="hljs-string">"surface"</span>].get_rect(center=(obj[<span class="hljs-string">"x"</span>], obj[<span class="hljs-string">"y"</span>]))
        screen.blit(obj[<span class="hljs-string">"surface"</span>], text_rect)
        target_x, target_y = love_points[obj[<span class="hljs-string">"target_idx"</span>]]
        obj[<span class="hljs-string">"x"</span>] += (target_x - obj[<span class="hljs-string">"x"</span>]) * <span class="hljs-number">0.02</span> + obj[<span class="hljs-string">"speed_x"</span>]
        obj[<span class="hljs-string">"y"</span>] += (target_y - obj[<span class="hljs-string">"y"</span>]) * <span class="hljs-number">0.02</span> + obj[<span class="hljs-string">"speed_y"</span>]
        obj[<span class="hljs-string">"target_idx"</span>] = (obj[<span class="hljs-string">"target_idx"</span>] + <span class="hljs-number">1</span>) % <span class="hljs-built_in">len</span>(love_points)
        <span class="hljs-keyword">if</span> obj[<span class="hljs-string">"x"</span>] &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> obj[<span class="hljs-string">"x"</span>] &gt; width:
            obj[<span class="hljs-string">"speed_x"</span>] *= -<span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> obj[<span class="hljs-string">"y"</span>] &lt; <span class="hljs-number">50</span> <span class="hljs-keyword">or</span> obj[<span class="hljs-string">"y"</span>] &gt; height - <span class="hljs-number">50</span>:
            obj[<span class="hljs-string">"speed_y"</span>] *= -<span class="hljs-number">1</span>

    <span class="hljs-comment"># ===================== 绘制居中名字（新增代码）=====================</span>
    screen.blit(name_text, (name_x, name_y))  <span class="hljs-comment"># 在屏幕正中间绘制白色名字</span>

    <span class="hljs-comment"># ===================== 弹幕更新与绘制（按要求优化）=====================</span>
    <span class="hljs-comment"># 加快弹幕生成频率</span>
    danmu_spawn_timer += <span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> danmu_spawn_timer &gt;= danmu_spawn_interval:
        danmu_list.append(Danmu())
        danmu_spawn_timer = <span class="hljs-number">0</span>
        <span class="hljs-comment"># 限制弹幕总数（最多50条，避免过度拥挤）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(danmu_list) &gt; <span class="hljs-number">50</span>:
            danmu_list.pop(<span class="hljs-number">0</span>)

    <span class="hljs-comment"># 更新并绘制所有弹幕（速度加快，粉色系，仅中文文案）</span>
    <span class="hljs-keyword">for</span> danmu <span class="hljs-keyword">in</span> danmu_list:
        danmu.update()
        danmu.draw(screen)

    <span class="hljs-comment"># 显示帧率（原逻辑保留）</span>
    fps_text = font.render(<span class="hljs-string">f"FPS: <span class="hljs-subst">{<span class="hljs-built_in">int</span>(clock.get_fps())}</span>"</span>, <span class="hljs-literal">True</span>, (<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>))
    screen.blit(fps_text, (<span class="hljs-number">10</span>, height - <span class="hljs-number">30</span>))

    pygame.display.flip()
    clock.tick(<span class="hljs-number">60</span>)

pygame.quit()
sys.exit()
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Suite v6：面向现代化的稳健升级]]></title>    <link>https://juejin.cn/post/7574978545145135139</link>    <guid>https://juejin.cn/post/7574978545145135139</guid>    <pubDate>2025-11-22T02:25:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545145135139" data-draft-id="7574978545145085987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Suite v6：面向现代化的稳健升级"/> <meta itemprop="keywords" content="GitHub,前端框架,React.js"/> <meta itemprop="datePublished" content="2025-11-22T02:25:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="漆工"/> <meta itemprop="url" content="https://juejin.cn/user/1345457961570638"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Suite v6：面向现代化的稳健升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457961570638/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    漆工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T02:25:17.000Z" title="Sat Nov 22 2025 02:25:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>React Suite (rsuite) v6 正式发布了。这一版本聚焦于现代化改造：重构底层样式系统、提供新的布局能力，并整体提升响应式体验和开发流程。v6 代表 React Suite 在稳定性的前提下，持续向更具适应性的 UI 方案演进。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96a8f14ddedb4943a062fc53974cb997~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ryG5bel:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764383117&amp;x-signature=%2FmhdiOE%2Fof0ThPdJUoAFX3pqy34%3D" alt="React Suite v6 Banner" loading="lazy"/></p>
<h2 data-id="heading-0">1. 样式系统的全面重构：拥抱 CSS 变量</h2>
<p>v6 最重大的底层变革是将样式系统从 Less 彻底迁移到了 <strong>SCSS</strong>，并<strong>全面采用 CSS 变量 (CSS Variables)</strong> 作为主题定制的核心方案。开发者只需覆盖变量值，就能在运行时动态切换品牌色、间距或圆角，无需重新编译或配置额外的构建流程。</p>
<p>完整的变量清单与使用方式，可参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fguide%2Fcss-variables%2F" target="_blank" title="https://rsuitejs.com/guide/css-variables/" ref="nofollow noopener noreferrer">CSS Variables 文档</a>，也可以借助 <a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fresources%2Fpalette%2F" target="_blank" title="https://rsuitejs.com/resources/palette/" ref="nofollow noopener noreferrer">Palette 工具</a> 可视化调整品牌配色。</p>
<h3 data-id="heading-1">其他样式系统改进</h3>
<ul>
<li><strong>逻辑属性 (Logical Properties)</strong>：全面采用 CSS 逻辑属性（如 <code>margin-inline-start</code> 代替 <code>margin-left</code>），原生支持 RTL（从右到左）排版。</li>
<li><strong>rem 单位</strong>：字体大小、间距等尺寸从 <code>px</code> 转换为 <code>rem</code>，更好地支持响应式排版和无障碍缩放。</li>
</ul>
<h2 data-id="heading-2">2. 拥抱 AI 辅助编程</h2>
<p>React Suite v6 不仅关注组件本身，更致力于提升 AI 时代的开发效率。我们引入了对 AI 编程助手的原生支持，让 Cursor、Windsurf 等工具能更懂 RSuite。</p>
<h3 data-id="heading-3">LLMs.txt 支持</h3>
<p>我们遵循 <a href="https://link.juejin.cn?target=https%3A%2F%2Fllmstxt.org%2F" target="_blank" title="https://llmstxt.org/" ref="nofollow noopener noreferrer">llms.txt</a> 标准，为文档站添加了 <code>/llms.txt</code> 文件。这是一个专为大语言模型 (LLM) 优化的文档索引。</p>
<p>当你在 Cursor 或其他 AI 工具中引用 RSuite 文档时，AI 可以通过这个文件快速获取组件的 API 定义、最佳实践和代码示例，从而生成更准确、符合 v6 规范的代码。</p>
<h3 data-id="heading-4">MCP Server 集成</h3>
<p>我们推出了官方的 <a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fguide%2Fmcp-server%2F" target="_blank" title="https://rsuitejs.com/guide/mcp-server/" ref="nofollow noopener noreferrer">Model Context Protocol (MCP)</a> Server。</p>
<p>通过 MCP，你的 AI 助手可以直接连接到 RSuite 的知识库。这意味着：</p>
<ul>
<li><strong>实时检索</strong>：AI 可以直接读取最新的组件文档和 API，无需手动复制粘贴。</li>
<li><strong>上下文感知</strong>：在编写代码时，AI 能自动推荐适合当前场景的组件和属性。</li>
<li><strong>减少幻觉</strong>：基于官方文档的上下文投喂，大幅降低 AI 生成过时或错误代码的概率。</li>
</ul>
<h2 data-id="heading-5">3. 布局能力的原子化：引入 Box 与 Center</h2>
<p>为了让布局更加灵活高效，v6 引入了基础的布局原子组件，让开发者能够像搭积木一样构建复杂的 UI。</p>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fbox%2F" target="_blank" title="https://rsuitejs.com/components/box/" ref="nofollow noopener noreferrer">Box 组件</a></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fbox%2F" target="_blank" title="https://rsuitejs.com/components/box/" ref="nofollow noopener noreferrer"><code>Box</code></a> 是构建布局的基石，它允许你直接在组件上通过 props 控制样式，无需编写额外的 CSS 类。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Box</span>, <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'rsuite'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Box</span> <span class="hljs-attr">p</span>=<span class="hljs-string">{20}</span> <span class="hljs-attr">m</span>=<span class="hljs-string">{10}</span> <span class="hljs-attr">bg</span>=<span class="hljs-string">"gray-100"</span> <span class="hljs-attr">borderRadius</span>=<span class="hljs-string">{8}</span> <span class="hljs-attr">display</span>=<span class="hljs-string">"flex"</span> <span class="hljs-attr">justifyContent</span>=<span class="hljs-string">"space-between"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Welcome to v6<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">appearance</span>=<span class="hljs-string">"primary"</span>&gt;</span>Get Started<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Box</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fcenter%2F" target="_blank" title="https://rsuitejs.com/components/center/" ref="nofollow noopener noreferrer">Center 组件</a></h3>
<p>垂直水平居中一直是 CSS 中的高频需求，现在你可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fcenter%2F" target="_blank" title="https://rsuitejs.com/components/center/" ref="nofollow noopener noreferrer"><code>Center</code></a> 组件轻松实现：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Center</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'rsuite'</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Center</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{200}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-blue-50"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Perfectly Centered Content<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Center</span>&gt;</span></span>;
</code></pre>
<h2 data-id="heading-8">4. 响应式设计的全面增强</h2>
<p>在移动互联网时代，跨端适配至关重要。v6 对核心组件进行了响应式能力的增强。</p>
<ul>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fgrid%2F" target="_blank" title="https://rsuitejs.com/components/grid/" ref="nofollow noopener noreferrer">Grid</a> 系统升级</strong>：重构了 <code>Row</code> 和 <code>Col</code>，提供更灵活的断点控制对象语法。</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Row</span> align=<span class="hljs-string">"center"</span> justify=<span class="hljs-string">"space-between"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">span</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">xs:</span> <span class="hljs-attr">24</span>, <span class="hljs-attr">md:</span> <span class="hljs-attr">12</span>, <span class="hljs-attr">lg:</span> <span class="hljs-attr">8</span> }}&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Col</span> <span class="hljs-attr">span</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">xs:</span> <span class="hljs-attr">24</span>, <span class="hljs-attr">md:</span> <span class="hljs-attr">12</span>, <span class="hljs-attr">lg:</span> <span class="hljs-attr">8</span> }}&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Row</span>&gt;
</code></pre>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fnavbar%2F" target="_blank" title="https://rsuitejs.com/components/navbar/" ref="nofollow noopener noreferrer">Navbar</a> &amp; <a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fsidenav%2F" target="_blank" title="https://rsuitejs.com/components/sidenav/" ref="nofollow noopener noreferrer">Sidenav</a></strong>：新增了对移动端的自适应支持，使用 <code>Navbar.Content</code> 替代了废弃的 <code>pullRight</code>，布局更清晰。</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Navbar</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navbar.Brand</span>&gt;</span>BRAND<span class="hljs-tag">&lt;/<span class="hljs-name">Navbar.Brand</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navbar.Content</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Nav</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">Nav</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Navbar.Content</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navbar.Content</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Navbar.Content</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Navbar</span>&gt;
</code></pre>
</li>
<li>
<p><strong>Picker 组件</strong>：所有的 Picker 组件现在都拥有了更好的移动端适配体验，在小屏幕设备上会自动切换为更友好的交互模式。</p>
</li>
</ul>
<h2 data-id="heading-9">5. 全新的组件与 Hooks</h2>
<p>除了布局组件，v6 还带来了一系列实用的新组件和 Hooks，进一步丰富了组件库的能力。</p>
<h3 data-id="heading-10">新增组件</h3>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fsegmented-control%2F" target="_blank" title="https://rsuitejs.com/components/segmented-control/" ref="nofollow noopener noreferrer"><strong>SegmentedControl</strong></a>：分段控制器，提供更现代的选项卡切换体验，适用于筛选、视图切换等场景。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fpassword-input%2F" target="_blank" title="https://rsuitejs.com/components/password-input/" ref="nofollow noopener noreferrer"><strong>PasswordInput</strong></a>：专用的密码输入框，内置显示/隐藏密码切换功能，提升用户体验。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fpin-input%2F" target="_blank" title="https://rsuitejs.com/components/pin-input/" ref="nofollow noopener noreferrer"><strong>PinInput</strong></a>：PIN 码/验证码输入组件，支持自动聚焦和粘贴分割，适用于验证场景。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Ftextarea%2F" target="_blank" title="https://rsuitejs.com/components/textarea/" ref="nofollow noopener noreferrer"><strong>Textarea</strong></a>：独立的多行文本输入组件，提供更好的样式控制和一致性。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fkbd%2F" target="_blank" title="https://rsuitejs.com/components/kbd/" ref="nofollow noopener noreferrer"><strong>Kbd</strong></a>：用于展示键盘按键，文档站和快捷键提示的福音。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Flink%2F" target="_blank" title="https://rsuitejs.com/components/link/" ref="nofollow noopener noreferrer"><strong>Link</strong></a>：提供统一样式的链接组件，支持自定义颜色和无障碍访问。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fmenu%2F" target="_blank" title="https://rsuitejs.com/components/menu/" ref="nofollow noopener noreferrer"><strong>Menu</strong></a> &amp; <a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fnavbar%2F%23mega-menu" target="_blank" title="https://rsuitejs.com/components/navbar/#mega-menu" ref="nofollow noopener noreferrer"><strong>MegaMenu</strong></a>：全新的菜单系统，支持更复杂的导航结构，轻松构建大型应用导航。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fform%2F" target="_blank" title="https://rsuitejs.com/components/form/" ref="nofollow noopener noreferrer"><strong>Form.Stack</strong></a>：让表单布局排列更加整洁有序，替代了 Form 组件上的布局属性。</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Form</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Form.Stack</span> <span class="hljs-attr">layout</span>=<span class="hljs-string">"horizontal"</span> <span class="hljs-attr">spacing</span>=<span class="hljs-string">{20}</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Form.Group</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Form.Label</span>&gt;</span>Username<span class="hljs-tag">&lt;/<span class="hljs-name">Form.Label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Form.Control</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Group</span>&gt;</span>
    {/* ... */}
  <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Stack</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Form</span>&gt;
</code></pre>
</li>
</ul>
<h3 data-id="heading-11">强大的 Hooks</h3>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fuse-dialog%2F" target="_blank" title="https://rsuitejs.com/components/use-dialog/" ref="nofollow noopener noreferrer"><strong>useDialog</strong></a>：通过函数调用方式管理对话框，告别繁琐的 visible state 管理。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> dialog = <span class="hljs-title function_">useDialog</span>();

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> dialog.<span class="hljs-title function_">confirm</span>({
    <span class="hljs-attr">title</span>: <span class="hljs-string">'确认操作'</span>,
    <span class="hljs-attr">children</span>: <span class="hljs-string">'您确定要执行此操作吗？'</span>
  });
  <span class="hljs-keyword">if</span> (result) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Confirmed'</span>);
  }
};
</code></pre>
</li>
<li>
<p><strong>useFormControl</strong>：轻松创建自定义的表单控件，自动处理验证状态和错误信息。</p>
</li>
</ul>
<h2 data-id="heading-12">6. 开发者体验 (DX) 的极致追求</h2>
<p>我们深知开发者的快乐不仅仅来自于好用的组件，更来自于流畅的开发流程。</p>
<ul>
<li><strong>全面拥抱 Vitest</strong>：我们将测试框架从 Karma/Mocha 迁移到了 Vitest，测试速度大幅提升，开发反馈更加即时。</li>
<li><strong>TypeScript 类型增强</strong>：优化了所有组件的类型导出，新增 Schema 类型命名导出，智能提示更加精准。</li>
<li><strong>Bundle Size 优化</strong>：
<ul>
<li>引入 size-limit，严格把控包体积。</li>
</ul>
</li>
<li><strong>生态支持</strong>：新增 Bun 安装指南，紧跟前端工具链发展潮流。</li>
<li><strong>开发调试</strong>：<code>useToaster</code> 增加了环境检查，当在 <code>CustomProvider</code> 上下文之外使用时会发出友好警告，帮助快速定位问题。</li>
</ul>
<h2 data-id="heading-13">7. 更多细节改进</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fbadge%2F" target="_blank" title="https://rsuitejs.com/components/badge/" ref="nofollow noopener noreferrer"><strong>Badge</strong></a>：新增 <code>size</code>、<code>outline</code>、<code>placement</code> 等属性，支持更丰富的展示形态。</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Badge</span> content=<span class="hljs-string">"New"</span> size=<span class="hljs-string">"lg"</span> outline /&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Badge</span> <span class="hljs-attr">content</span>=<span class="hljs-string">{99}</span> <span class="hljs-attr">shape</span>=<span class="hljs-string">"square"</span> <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottomEnd"</span> /&gt;</span></span>
</code></pre>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fbreadcrumb%2F" target="_blank" title="https://rsuitejs.com/components/breadcrumb/" ref="nofollow noopener noreferrer"><strong>Breadcrumb</strong></a>：默认样式调整，更符合现代设计规范。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fdate-picker%2F" target="_blank" title="https://rsuitejs.com/components/date-picker/" ref="nofollow noopener noreferrer"><strong>DatePicker</strong></a>：优化了 Toolbar 布局，交互更符合直觉。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fprogress%2F" target="_blank" title="https://rsuitejs.com/components/progress/" ref="nofollow noopener noreferrer"><strong>Progress</strong></a>：新增 <code>indeterminate</code> 加载动画状态，以及支持分段进度条 (<code>sections</code>)，展示更丰富的信息。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Ftree-picker%2F" target="_blank" title="https://rsuitejs.com/components/tree-picker/" ref="nofollow noopener noreferrer"><strong>TreePicker</strong></a>：新增 <code>onlyLeafSelectable</code> 属性，满足仅允许选择叶子节点的业务场景。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Fbutton%2F" target="_blank" title="https://rsuitejs.com/components/button/" ref="nofollow noopener noreferrer"><strong>Button</strong></a>：新增 toggle 状态支持。</p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fcomponents%2Finput%2F" target="_blank" title="https://rsuitejs.com/components/input/" ref="nofollow noopener noreferrer"><strong>InputGroup</strong></a>：优化了 inside 模式下的按钮样式，视觉更加协调。</p>
</li>
<li>
<p><strong>依赖升级</strong>：Date-fns 4.x, Prettier 3.x 等核心依赖全面升级。</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-14">立即开始</h2>
<p>React Suite v6 现已通过 npm 发布。</p>
<pre><code class="hljs language-bash" lang="bash">npm install rsuite@latest
</code></pre>
<p>我们准备了详细的<a href="https://link.juejin.cn?target=https%3A%2F%2Frsuitejs.com%2Fguide%2Fmigration-v6" target="_blank" title="https://rsuitejs.com/guide/migration-v6" ref="nofollow noopener noreferrer">迁移指南</a>，帮助您从 v5 平滑升级。</p>
<p>欢迎在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frsuite%2Frsuite" target="_blank" title="https://github.com/rsuite/rsuite" ref="nofollow noopener noreferrer">GitHub</a> 上给我们 Star，或者在 Discussion 中分享您的使用体验！</p>
<p><strong>React Suite Team</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🌌 AIGC模型的冷启动问题：Web应用的初期技术支撑策略]]></title>    <link>https://juejin.cn/post/7575022279568588841</link>    <guid>https://juejin.cn/post/7575022279568588841</guid>    <pubDate>2025-11-22T02:26:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575022279568588841" data-draft-id="7575050949959581732" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🌌 AIGC模型的冷启动问题：Web应用的初期技术支撑策略"/> <meta itemprop="keywords" content="人工智能,Trae"/> <meta itemprop="datePublished" content="2025-11-22T02:26:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🌌 AIGC模型的冷启动问题：Web应用的初期技术支撑策略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T02:26:48.000Z" title="Sat Nov 22 2025 02:26:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧊 一、引言：当AI还没“醒来”</h2>
<p>在AIGC（AI Generated Content）浪潮中，我们常常遇到这样一个尴尬时刻：</p>
<blockquote>
<p>产品上线第一天，用户点开页面，AI模型沉默如山。<br/>
团队眨眼互望，一句“稍等加载”成为高频台词。</p>
</blockquote>
<p>这就是我们常说的——<strong>AIGC模型的冷启动问题</strong>。<br/>
别被这个词吓到，它不是什么玄学，而是计算机系统在面对<strong>初始资源匮乏、模型未热身、数据不足、请求未定型</strong>时的那种<em>灵魂冰点</em>。<br/>
想象一下，AI 模型还在喝它的第一杯咖啡，而用户已经在敲键盘催命。</p>
<hr/>
<h2 data-id="heading-1">🧬 二、冷启动的本质：一场从零到「上线」的进化</h2>
<p>从底层原理来看，AIGC 模型的冷启动过程包含三个阶段：</p>
<ol>
<li><strong>计算冷</strong>：<br/>
模型参数巨大（动辄十亿个参数），首次加载模型时需要把这些参数从磁盘搬进显存。<br/>
就像一个懒惰的巨人——每一层神经都得先伸个懒腰。</li>
<li><strong>网络冷</strong>：<br/>
如果模型部署在云端，那就有「延迟初恋」这一说。第一次请求往往要花费额外的握手时间、容器唤醒、负载平衡。</li>
<li><strong>语义冷</strong>：<br/>
刚上线的模型还不知道你的业务习惯，比如“APP内提示语风格”。<br/>
它的第一句话，可能像刚出厂的R2-D2一样——充满机械的纯真。</li>
</ol>
<hr/>
<h2 data-id="heading-2">⚙️ 三、从底层出发：技术支撑策略</h2>
<p>冷启动并不是宿命，而是可以用技术“焐热”的。以下是常用的支撑策略，背后各自有着深厚的系统哲学。</p>
<hr/>
<h3 data-id="heading-3">🚀 1. 模型预热（Warm-Up）</h3>
<p>思路很简单：</p>
<blockquote>
<p>不要等到用户来了，才去唤醒模型。</p>
</blockquote>
<p>在Web应用启动后，我们可以模拟一组虚假的 API 调用请求，让模型提前加载。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 🧊 AIGC 冷启动预热脚本</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">warmUpModel</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> fakePrompts = [
    <span class="hljs-string">"你好，请简单介绍一下你自己。"</span>,
    <span class="hljs-string">"生成一句充满科技感的口号。"</span>,
    <span class="hljs-string">"写一句让程序员春风得意的俏皮话。"</span>
  ];

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"🚀 模型预热开始 ..."</span>);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> prompt <span class="hljs-keyword">of</span> fakePrompts) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/api/generate"</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ prompt }),
      <span class="hljs-attr">headers</span>: { <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span> }
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🔥 已预热：<span class="hljs-subst">${prompt}</span>`</span>);
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"✅ 模型已成功热身！"</span>);
}

<span class="hljs-title function_">warmUpModel</span>();
</code></pre>
<blockquote>
<p>💡 <em>小贴士：这段代码相当于提前帮AI打了三瓶咖啡。</em></p>
</blockquote>
<hr/>
<h3 data-id="heading-4">☁️ 2. 按需加载 + 模型分层缓存</h3>
<p>底层策略在这里显得优雅又“狡猾”：</p>
<ul>
<li>把模型权重分层存储，比如只加载用于启动的核心层。</li>
<li>其余部分按需加载，动态补齐。</li>
<li>对于常见Token结果建立<strong>向量缓存</strong>，让模型“记忆”高频回答。</li>
</ul>
<p>这类似于<strong>懒加载+缓存继承</strong>的策略组合。<br/>
如果程序是舞台，那缓存层就是那个“技术黑幕”，在后台默默挡住冷风。</p>
<hr/>
<h3 data-id="heading-5">🧞 3. 灰度 + 蒙特卡洛采样（经验数据啤酒算法）</h3>
<p>早期阶段，不妨给模型“喂”一些业务数据采样。<br/>
这里通常通过经验分布采样策略实现，使模型在推理阶段有更好的初始收敛。</p>
<p>通俗点说：</p>
<blockquote>
<p>我们让模型在上岗前，提前实习几天。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">🕸️ 4. 边缘节点缓存与轻量推理引擎</h3>
<p>很多人忽略了网络拓扑在冷启动中的作用。<br/>
若用户在日本，而你的模型服务器在硅谷，那延迟就像打越洋电话。</p>
<p>解决方案是 <strong>部署边缘节点推理代理</strong>：</p>
<ul>
<li>前端就近调用轻量引擎（Mini-Inference），处理通用请求。</li>
<li>再由主模型处理复杂请求。</li>
<li>用户感受到的不是“冷启动”，而是“热响应”。</li>
</ul>
<hr/>
<h2 data-id="heading-7">🧠 四、技术之外：冷启动的哲学与幽默</h2>
<p>冷启动，归根结底是人与系统之间的一场信任测试。<br/>
有时候，AI不是不想快，而是太害羞。它还没准备好展示它的全部魅力。</p>
<p>从操作系统到语言运行时，从HTTP握手到显存调度，每一次延迟都像是计算机世界深处那种——</p>
<blockquote>
<p>“我正在努力加载灵魂，请稍等片刻。”</p>
</blockquote>
<p>从这个角度看，每一个冷启动，<br/>
其实就是人工智能世界的<strong>黎明微光</strong>。🌄</p>
<hr/>
<h2 data-id="heading-8">🧩 五、最后的小结与温柔暴论</h2>






























<table><thead><tr><th>阶段</th><th>问题</th><th>对策</th></tr></thead><tbody><tr><td>模型加载</td><td>初始化慢</td><td>预热请求、延迟缓存</td></tr><tr><td>网络延迟</td><td>通信慢</td><td>边缘推理、Cloudflare Worker代理</td></tr><tr><td>业务不适配</td><td>输出生硬</td><td>向量缓存、蒸馏训练</td></tr><tr><td>用户体验差</td><td>页面卡顿</td><td>Skeleton UI、渐进渲染</td></tr></tbody></table>
<blockquote>
<p>🗣️ <strong>暴论总结</strong>：<br/>
真正的冷启动不是模型冷，是我们没教会它怎么热。</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🎬 尾声：当AI开始呼吸</h2>
<p>当第一位用户顺滑地扫描二维码、浏览页面，AI回应流畅如诗时，<br/>
你听到的不只是HTTP返回200，而是一句轻声的问候：</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀谷歌凌晨炸场！Nano Banana Pro 首发深度评测：20轮地狱级测试，它不仅会画画，还读懂了物理世界]]></title>    <link>https://juejin.cn/post/7575006095389294601</link>    <guid>https://juejin.cn/post/7575006095389294601</guid>    <pubDate>2025-11-22T02:26:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575006095389294601" data-draft-id="7575230119091716139" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀谷歌凌晨炸场！Nano Banana Pro 首发深度评测：20轮地狱级测试，它不仅会画画，还读懂了物理世界"/> <meta itemprop="keywords" content="OpenAI,AIGC,Google IO"/> <meta itemprop="datePublished" content="2025-11-22T02:26:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="win4r"/> <meta itemprop="url" content="https://juejin.cn/user/1739869037541555"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀谷歌凌晨炸场！Nano Banana Pro 首发深度评测：20轮地狱级测试，它不仅会画画，还读懂了物理世界
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1739869037541555/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    win4r
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T02:26:29.000Z" title="Sat Nov 22 2025 02:26:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>摘要：</strong> 经过一上午的极限测试，我们发现这款号称具备“工作室级创意控制”的新模型，正在悄然跨越AI绘图与现实世界的恐怖谷。</p>
<p>🔥🔥🔥本篇笔记所对应的视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1HHULBPEVr%2F" target="_blank" title="https://www.bilibili.com/video/BV1HHULBPEVr/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1HH…</a></p>
<hr/>
<p><strong>正文：</strong></p>
<p>今天凌晨，谷歌在毫无预兆的情况下，突然发布了全新的图像生成旗舰模型——<strong>Nano Banana Pro</strong>。</p>
<p>在官方博客的技术白皮书中，谷歌赋予了这款模型极其强悍的纸面参数：它引入了“工作室级创意控制（Studio-grade creative control）”架构，支持混合多达14张参考图像，并能同时保持画面中多达5个人物的高度一致性。此外，它打破了常规生成的限制，原生支持从16:9到21:9、乃至4K分辨率的超清输出，并赋予用户对局部编辑、相机角度、色彩分级（Color Grading）和场景照明的精细控制权。</p>
<p>参数再豪华，终究要落地到实际应用。为了验证 Nano Banana Pro 是否真的如宣传般强大，我们耗时一上午，设计了覆盖图像生成、电商应用、逻辑推理、医学影像、创意设计等领域的<strong>20组地狱级测试案例</strong>。</p>
<p>实测结果表明，这不仅仅是一个画图工具的升级，更像是AI对物理世界理解能力的一次跃迁。以下是我们的详细万字评测报告。</p>
<h3 data-id="heading-0">一、 突破“恐怖谷”：极致的微观细节与文本渲染</h3>
<p>长期以来，AI绘图模型在处理文字（Text Rendering）和微观物理细节时，往往会暴露出“由于计算生成”而产生的违和感。但 Nano Banana Pro 在这方面的表现，让我们重新审视了“逼真”的定义。</p>
<ol>
<li>指纹级的真实感：马斯克推文实拍</li>
</ol>
<p>在第一组测试中，我们要求模型生成一张“马斯克在手机上发推文夸赞特斯拉自动驾驶，并获得OpenAI及Google官方回复”的照片。</p>
<p>结果令人咋舌。模型生成的不仅是一张截图，而是一张**“对着手机屏幕拍摄的照片”。当我们把图片放大到像素级时，震惊地发现了屏幕玻璃上残留的指纹印记**。此外，手机顶部状态栏的电池电量、信号格强弱，以及屏幕光线在不同角度下的漫反射效果，都完全符合物理规律。如果不是因为推文内容是我们编造的，这张图在社交网络上足以以假乱真。</p>
<ol start="2">
<li>中文书法的笔触还原</li>
</ol>
<p>汉字生成一直是西方大模型的弱项。我们测试了生成一幅《念奴娇·赤壁怀古》的行楷书法作品。</p>
<p>生成的画面中，宣纸的纤维质感、墨汁的浓淡晕染（Dry and Wet ink effects）、毛笔搁置在砚台上的光影投射，都达到了摄影级别。尽管在长文本的逻辑上，模型没有完全一字不差地复写上阙内容（这是目前大语言模型的通病），但在“字形结构”上，每一个汉字都笔法严谨，完全没有出现“鬼画符”般的伪造字，对于国风设计素材的生成而言，这已是极高可用的生产力。</p>
<ol start="3">
<li>零错误的巧克力艺术字</li>
</ol>
<p>在生日蛋糕的测试中，模型面临着材质与文字的双重挑战。我们需要它用巧克力酱在奶油蛋糕上写出“AI超元域频道3岁啦”。生成的图像中，巧克力字迹呈现出流体凝固后的自然光泽，且每一个字符都清晰可辨，没有任何错别字。这意味着模型已经理解了“液体书写”的物理特性。</p>
<h3 data-id="heading-1">二、 电商与摄影的革命：一致性与局部重绘</h3>
<p>对于电商行业而言，AI最大的痛点在于“不可控”。而 Nano Banana Pro 此次主打的“局部编辑”与“一致性保持”，似乎正是为了解决这一商业痛点而来。</p>
<ol>
<li>完美的模特“云换装”</li>
</ol>
<p>这是本次评测中商业价值最高的一组测试。我们上传了一张模特图和一套衣服图，要求模型“给图二的模特穿上图一的衣服”。</p>
<p>Nano Banana Pro 的表现堪称完美。它不仅完成了换装，更重要的是，它锁死了模特的面部特征、身材比例和站姿。在随后的多轮对话中，我们像对待真人模特一样不断提出修改要求：</p>
<ul>
<li>
<p>“把低领内搭换成高领”——完成，且颈部光影自然过渡。</p>
</li>
<li>
<p>“把短裙换成长裤”——完成，裤子的褶皱符合重力垂坠感。</p>
</li>
<li>
<p>“给她戴上一顶帽子”——完成，帽子的阴影精准投射在脸部。</p>
</li>
<li>
<p>“加上一条腰带”——完成，腰带束紧了衣物，产生了真实的挤压褶皱。</p>
<p>甚至原图中没有拍到模特的脚，模型也自动根据身体姿态补全了鞋子。对于电商卖家来说，这意味着只需拍摄一次模特，即可无限生成不同款式的上身图，成本将呈指数级下降。</p>
</li>
</ul>
<ol start="2">
<li>智能修图与发型设计</li>
</ol>
<p>除了换装，我们还测试了“去路人”和“换发型”。</p>
<p>在旅游照中，一句“去掉路人”的提示词，模型瞬间清除了背景杂乱的游客，并自动脑补了被遮挡的风景，毫无修图痕迹。</p>
<p>在人物写真中，我们将一位男性的发型替换为“更时尚的款式”，整个人气质瞬间提升，且发丝与头皮的连接处处理得极其自然。这预示着它完全可以替代Photoshop的大部分繁琐功能。</p>
<h3 data-id="heading-2">三、 视觉推理：AI 开始“看懂”这个世界</h3>
<p>Nano Banana Pro 不仅仅在“画”，它似乎在“思考”。多组测试证明，它具备了极强的多模态视觉推理能力。</p>
<ol>
<li>逆向工程：一张图反推食谱</li>
</ol>
<p>我们投喂了一张“土豆烧牛肉”的成品菜照片，要求模型“生成这道菜的所有食材”。</p>
<p>模型生成的图像不仅是一堆食材的堆砌，更像是一张精美的备菜图：牛肉切块的纹理、土豆的氧化色泽、葱花、姜片、甚至生抽、老抽、冰糖、八角等看不见的调味品，都被它逻辑严密地具象化了出来。这说明模型识别出了菜品，检索了知识库，并将其反向视觉化。</p>
<ol start="2">
<li>医学影像的精准判读</li>
</ol>
<p>为了测试专业性，我们上传了一张包含微小骨折点的X光片，提示词仅为“标注骨折位置”。</p>
<p>模型精准地识别出了病灶，并用红框进行了高亮标注。值得注意的是，生成后的图像依然保持了X光胶片特有的灰度噪点和透视质感，没有因为AI的介入而变成“卡通画”。这展示了其在辅助医疗诊断领域的潜力。</p>
<ol start="3">
<li>逻辑思维的可视化：数学与试卷</li>
</ol>
<p>这可能是最让我们感到“细思极恐”的测试。</p>
<ul>
<li><strong>数学解题：</strong> 我们要求模型解答一道圆面积计算题，并展现“草稿纸上的手写过程”。模型不仅步骤正确、答案无误，更可怕的是它模拟了真实的“运算场景”——字迹是手写的圆珠笔质感，纸张上有上一页笔记透过来的印痕，甚至还有手腕摩擦留下的污渍。</li>
<li><strong>试卷填空：</strong> 给定一张空白英语试卷，模型自动识别题目，在括号内填入了正确的选项字母，并在下方用中文手写体翻译了句子。这不仅是OCR（文字识别），而是“识别+理解+生成”的全流程闭环。</li>
<li><strong>手绘RAG流程图：</strong> 它还能根据抽象的技术概念（检索增强生成），绘制出逻辑清晰、带有中文注释的手绘风格流程图。</li>
</ul>
<h3 data-id="heading-3">四、 创意的边界：从复刻到脑洞</h3>
<p>最后，我们测试了模型的艺术创造力与跨风格融合能力。</p>
<ol>
<li>时空错乱的艺术融合</li>
</ol>
<p>当我们将现代工业产物强行植入古代艺术时，Nano Banana Pro 展现了极高的审美融合度。</p>
<ul>
<li><strong>清明上河图+游艇：</strong> 我们要求在仿古画的河面上放一艘现代钓鱼艇。模型不仅放入了游艇，还精细地绘制了游艇马达激起的白色浪花，这种浪花的画法模仿了古画的笔触，使得违和感降到了最低。</li>
<li><strong>古画改图：</strong> 将古画中垂钓的人改为“中鱼拉杆”的状态。模型重绘了弯曲的鱼竿和水下的鱼，动态张力十足。</li>
</ul>
<p><strong>2. 风格迁移与设计赋能</strong></p>
<ul>
<li><strong>室内设计：</strong> 一张简陋的毛坯房照片，在提示词“现代简约风”的驱动下，瞬间变成了精装修效果图。光影方向与原图窗户完全一致，地砖的镜面反射更是点睛之笔。</li>
<li><strong>素描转油画：</strong> 将人物素描一键转为油画，衣服上的格子纹理细节毫发无损。</li>
<li><strong>手办生成：</strong> 将真人模特图转化为带包装盒、亚克力底座的精美手办图，材质反光逼真。</li>
<li><strong>杂志封面：</strong> 根据我们的频道介绍，自动生成了一张极具设计感的时尚杂志封面，桌上的咖啡杯倒影清晰可见。</li>
<li><strong>脑洞流程图：</strong> 在“如何烤面包”的趣味测试中，模型画出了喷火龙烤面包、投石机送面包的夸张场景，证明了它在幽默感和想象力上的可塑性。</li>
</ul>
<h3 data-id="heading-4">五、 总结与展望</h3>
<p>洋洋洒洒20组测试，涵盖了从微观细节到宏观场景，From “What is” to “What if” 的各个维度。</p>
<p><strong>Nano Banana Pro 给我们最大的感受是：它变“聪明”了。</strong></p>
<p>以前的AI绘图模型，像是一个画技高超但不懂物理规律的“画师”，经常画出反重力的衣服或错误的光影。而 Nano Banana Pro 给人的感觉，是它在生成图像之前，先在潜空间里构建了一个符合逻辑的“虚拟世界”。它知道手写字会有压痕，知道屏幕会有指纹，知道衣服会有重力褶皱，知道X光片背后的病理结构。</p>
<p>对于用户而言，这意味着：</p>
<ol>
<li><strong>设计门槛的进一步降低：</strong> 你不需要再用复杂的ControlNet去控制光影，简单的自然语言即可实现精准修改。</li>
<li><strong>商业应用的爆发：</strong> 电商换装、室内设计、辅助教育、医疗标注，这些领域的生产力将迎来质的飞跃。</li>
<li><strong>创意的无限延伸：</strong> 无论是搞怪的烤面包流程图，还是严肃的数学推导，它都能成为你大脑的外挂。</li>
</ol>
<p>谷歌 Nano Banana Pro 的发布，标志着图像生成模型正式进入了**“通感”**时代。它不再仅仅是像素的堆砌，而是逻辑与物理的投射。</p>
<p>关于这款模型的更多玩法和提示词技巧，我们将在后续的推文中继续更新。<strong>AI进化的速度比我们想象的更快，你准备好了吗？</strong></p>
<hr/>
<p><em>本文测试内容均基于真实视频演示素材，技术参数参考官方发布信息。保持客观，拒绝捧杀。</em></p>
<p><strong>记得点赞、在看、转发，关注我们，不错过每一次AI技术的变革！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[群晖 DSM 更新后 Cloudflare DDNS 失效的排查记录]]></title>    <link>https://juejin.cn/post/7574978847152357416</link>    <guid>https://juejin.cn/post/7574978847152357416</guid>    <pubDate>2025-11-22T02:29:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978847152357416" data-draft-id="7575015480198807604" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="群晖 DSM 更新后 Cloudflare DDNS 失效的排查记录"/> <meta itemprop="keywords" content="前端,后端,DNS"/> <meta itemprop="datePublished" content="2025-11-22T02:29:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="子洋"/> <meta itemprop="url" content="https://juejin.cn/user/1099167359835015"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            群晖 DSM 更新后 Cloudflare DDNS 失效的排查记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167359835015/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    子洋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T02:29:38.000Z" title="Sat Nov 22 2025 02:29:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="tomorrow-night">.hljs-comment,.hljs-quote{color:#969896}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c66}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#de935f}.hljs-attribute{color:#f0c674}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#b5bd68}.hljs-section,.hljs-title{color:#81a2be}.hljs-keyword,.hljs-selector-tag{color:#b294bb}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1d1f21;color:#c5c8c6}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前两天我的群晖 NAS 提示 DSM 有新版本更新。由于已经好久没更新，一瞄发行说明发现新 feature 和 bugfix 还挺多，想着时间也不短了，那就顺手更一下吧。</p>
<p>系统更新得倒是很顺利，更新后啥异常也没发现，内网/外网访问都正常，我也就没再管。</p>
<p>直到昨晚事情才开始不对：我突然发现通过 DDNS 完全无法访问 NAS 上的任何应用。不过当时家里网络卡得要命，我也没太当回事，只以为是网络抽风。</p>
<p>但今天一早起来网络速度恢复，可域名依然不通，这时候我才知道绝对不是网络速度的问题了，这才开始正式排查。</p>
<h2 data-id="heading-1">排查链路复盘</h2>
<p>下面是我这次遇到问题后的完整排查过程。一方面是给可能遇到同样坑的朋友提供一个参考思路，另一方面也是给自己做个记录，方便以后再遇到类似情况时能更快定位问题。</p>
<h3 data-id="heading-2">1. 先确认 NAS 服务本身是否正常</h3>
<p>第一步很简单：  <strong>通过内网 IP 访问 NAS</strong>，一切正常，系统服务都在。</p>
<h3 data-id="heading-3">2. 再确认公网访问是否正常</h3>
<p>用家里的 <strong>公网 IP 直连</strong> NAS 暴露出去的端口，能通。说明 ISP 没问题，端口也没被封。</p>
<h3 data-id="heading-4">3. 检查群晖 DSM 自带的 DDNS 状态</h3>
<p>打开 <strong>控制面板 → 外部访问 → DDNS</strong>。</p>
<p>果然看到 DDNS 状态一直卡在 <strong>“正在连接...”</strong>，  点“测试连接”，转半天圈，最后报 <strong>连接超时</strong>。</p>
<p>至此基本确认问题出在 DDNS。</p>
<h3 data-id="heading-5">4. 怀疑是否是 NAS 上的代理导致的问题</h3>
<p>我之前遇到过：  <strong>只要开了系统代理 → 重启 NAS → 自定义 DDNS 会无法连接</strong>，</p>
<p><strong>必须是：</strong></p>
<ol>
<li>先连上 DDNS</li>
<li>再手动开启系统代理</li>
</ol>
<p>这很奇怪，但确实存在这个问题，我也一直没有去解决，所以这次我也先排查了一遍代理设置，结果发现代理是关闭的，这条可能性排除了。</p>
<h3 data-id="heading-6">5. 怀疑 Cloudflare 又宕机？</h3>
<p>突然想起前两天 Cloudflare 宕机，难不成又宕机了？</p>
<p>我登录 CF 控制台看了眼，没有任何告警。为了确认，我还顺手访问了几个托管在 Vercel、经过 Cloudflare 的服务，一切正常，说明 Cloudflare 没锅。</p>
<h3 data-id="heading-7">6. 终于把怀疑对象指向 DSM 更新</h3>
<p>这时我不禁想起了福尔摩斯法则：</p>
<blockquote>
<p>“当你排除了所有不可能的，剩下的即使再离谱，也必然是真相。”</p>
</blockquote>
<p>我先是在 Nas 上添加 DDNS 的地方看了一下服务提供商，果然，没有之前自定义的 Cloudflare 了。</p>
<p>我回忆了一下，群晖默认不支持 Cloudflare DDNS，需要自己手动部署第三方脚本，比如很多玩家都用的 <strong>SynologyCloudflareDDNS</strong>。</p>
<p>但我这是两三年前配置的了，早忘得干干净净，只记得当时是用 SSH 登进去扔了些脚本、改了 ddns_provider 配置，我只好去网上重新查教程。</p>
<h3 data-id="heading-8">7. 转折：ddns_provider 配置“消失了”</h3>
<p>网上的做法都差不多，我也照着检查了一下 NAS 的 <code>/etc/ddns_provider.conf</code>。</p>
<p>结果一打开就发现：<strong>我之前手动添加的 Cloudflare provider 配置彻底没了。</strong></p>
<p>八成是这次 DSM 更新覆盖了系统文件，把自定义的 DDNS provider 给清干净了。</p>
<p>于是我把缺失的配置重新补上、保存，然后再回到 DSM 的 DDNS 界面一看，果然有变化：
列表里多出了一个“<strong>访问 DDNS 供应商的网站</strong>”的按钮。</p>
<p>这说明新增的 provider 已成功加载（因为在 <code>ddns_provider.conf</code> 里设置 <code>website</code> 字段后，DSM 会自动在面板中显示这个入口）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81af4510c66847a7b2b9cb600b8764ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q5rSL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764383378&amp;x-signature=nAYT55Vc8ZY6BXRgc6kdjhkA8Gs%3D" alt="Pasted image 20251122094435.png" loading="lazy"/></p>
<p>再测试连接，结果：还是失败。</p>
<h3 data-id="heading-9">8. 再一查：原先放在 /sbin 的脚本也没了</h3>
<p>我继续顺着配置里引用的脚本路径查下去（就是 SynologyCloudflareDDNS 的核心脚本）。</p>
<p>结果：指定路径下根本没有脚本！ 我甚至怀疑是不是我之前放在其他地方了，于是全盘搜索了一遍。</p>
<p>找不到，根本找不到，基本可以确认<strong>整个 /sbin 目录都被更新重置了。</strong></p>
<p>至此终于搞清楚问题根因：</p>
<blockquote>
<p>DSM 更新时覆盖了系统目录，导致自定义 DDNS Provider 配置 + 脚本全部消失。</p>
</blockquote>
<h3 data-id="heading-10">9. 修复：重新上传脚本 + 重新配置 provider</h3>
<p>我重新下载脚本，上传到 <code>/sbin</code>，给可执行权限，再更新 ddns_provider 配置。</p>
<p>测试连接，这次成功了，DDNS 恢复正常！</p>
<h3 data-id="heading-11">10. 为什么前两天还能用？</h3>
<p>现在回头一想，为什么更新当天没问题？</p>
<p>很简单：<strong>因为我的公网 IP 那几天没变。</strong> DDNS 虽然挂了，但只要 Cloudflare 上的 DNS A 记录还指向老 IP，访问就不会出问题。</p>
<p>直到昨天公网 IP 有一点点变动（可能只差一两位），我登陆 CF 又没仔细看 A 记录，这才导致域名完全失效。</p>
<h2 data-id="heading-12">总结</h2>
<p>这次问题的根因其实非常隐蔽：</p>
<ul>
<li>DSM 更新 → 覆盖系统目录</li>
<li>自定义 DDNS Provider 配置被删</li>
<li><code>/sbin</code> 下的 Cloudflare 更新脚本也清空</li>
<li>但因为公网 IP 没变，所以问题延后了两天才暴露</li>
<li>最后一度误以为是 Cloudflare、代理或网络的问题</li>
</ul>
<p><strong>最终的解决办法就是：重新放回脚本 + 重写 ddns_provider.conf。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🌳 Claude `code/worktree` 命令最佳实践指南]]></title>    <link>https://juejin.cn/post/7575050949959614500</link>    <guid>https://juejin.cn/post/7575050949959614500</guid>    <pubDate>2025-11-22T02:30:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575050949959614500" data-draft-id="7575067409416077355" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🌳 Claude `code/worktree` 命令最佳实践指南"/> <meta itemprop="keywords" content="人工智能,Claude,Trae"/> <meta itemprop="datePublished" content="2025-11-22T02:30:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🌳 Claude `code/worktree` 命令最佳实践指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T02:30:09.000Z" title="Sat Nov 22 2025 02:30:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧭 一、前言：当AI开始「搬砖」</h2>
<p>在与 <strong>Claude</strong>（Anthropic 开发的AI助手）协作开发代码时，<code>code/worktree</code> 命令是一个极其有趣的工具。<br/>
这一命令的意图，是让 AI 和开发者在一个<strong>隔离但同步的工作区</strong>中协同修改、组织项目，就像是给 Claude 自己准备了一个“虚拟分支工位”。</p>
<p>简言之：</p>
<blockquote>
<p><code>code/worktree</code> ≈ “让 Claude 不破坏主代码库就能实验新功能的魔法空间”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">🧩 二、命令的逻辑本质与底层哲学</h2>
<p>从底层原理讲，它与 Git 的 <strong>worktree</strong> 思想一致：<br/>
创建一个共享 <code>.git</code> 元数据但独立工作目录的副本。<br/>
这种设计既保留了版本控制的完整性，又让多场景开发成为可能。</p>
<p>在 Claude 体系中，<code>code/worktree</code> 的哲学是这样的：</p>
<ol>
<li><strong>Claude 不直接改主干（main branch）</strong> 。</li>
<li><strong>每次生成代码，都在临时工作区中修改。</strong></li>
<li><strong>开发者可以选择合入、重构或丢弃。</strong></li>
</ol>
<p>换句话说：Claude 是文明的，不会直接在你的主分支上乱动。</p>
<hr/>
<h2 data-id="heading-2">⚙️ 三、基础语法与结构</h2>
<p>假设你已经将项目以 Claude 的 workspace 方式加载。<br/>
此时使用命令：</p>
<pre><code class="hljs language-bash" lang="bash">/worktree create feature/refactor-api
</code></pre>
<p>Claude 将：</p>
<ol>
<li>创建一个 <code>feature/refactor-api</code> 的工作区。</li>
<li>将当前 HEAD 的代码复制到新目录（但共享 <code>.git</code> 数据）。</li>
<li>在该工作区下生成、修改、运行代码。</li>
</ol>
<p>完成后，你可以通过：</p>
<pre><code class="hljs language-bash" lang="bash">/worktree merge feature/refactor-api
</code></pre>
<p>将改动安全地合并回主工作区。</p>
<hr/>
<h2 data-id="heading-3">🧰 四、实践案例：让 Claude 改造你的 Web 应用</h2>
<h3 data-id="heading-4">🧪 场景示例</h3>
<p>你有一个 Node.js + React 的项目：</p>
<pre><code class="hljs language-css" lang="css">my-app/
  ├── <span class="hljs-attribute">src</span>/
  ├── package<span class="hljs-selector-class">.json</span>
  └── server<span class="hljs-selector-class">.js</span>
</code></pre>
<p>你希望 Claude 帮你：</p>
<blockquote>
<p>将 Express server 改为支持 WebSocket 通信。</p>
</blockquote>
<h3 data-id="heading-5">🦾 操作流程</h3>
<ol>
<li>
<p><strong>创建 Claude 工作区</strong></p>
<pre><code class="hljs language-bash" lang="bash">/worktree create feature/add-websocket
</code></pre>
</li>
<li>
<p><strong>Claude 进入专属工位</strong></p>
<p>Claude 会自动克隆代码结构到一个新工作区。<br/>
它的修改操作不会影响主分支。</p>
</li>
<li>
<p><strong>让 Claude 修改代码</strong></p>
<pre><code class="hljs language-bash" lang="bash">/edit In feature/add-websocket:
Add WebSocket support to server.js
</code></pre>
</li>
<li>
<p><strong>Claude 编辑并展示差异</strong></p>
<p>Claude 会用 diff 形式展示修改区域，开发者确认后才会落地。</p>
</li>
<li>
<p><strong>测试和评审</strong></p>
<p>你可以让 Claude 执行单元测试命令：</p>
<pre><code class="hljs language-bash" lang="bash">/run npm <span class="hljs-built_in">test</span>
</code></pre>
<p>或让它自动运行 ESLint 检查。</p>
</li>
<li>
<p><strong>合并成果</strong></p>
<p>一旦满意，可以：</p>
<pre><code class="hljs language-bash" lang="bash">/worktree merge feature/add-websocket
</code></pre>
<p>完成集成后可使用：</p>
<pre><code class="hljs language-bash" lang="bash">/worktree delete feature/add-websocket
</code></pre>
<p>清理隔离区，保持工作区整洁。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-6">🧠 五、底层实现建议（结合Git机制）</h2>
<blockquote>
<p>Claude <code>code/worktree</code> 的实现可被理解为：通过<strong>AI控制的Git临时分支</strong>执行抽象的工作流。</p>
</blockquote>
<p>在底层实现上，可复用以下类 Git 逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟 Claude 的 code/worktree 流程</span>
<span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createWorktree</span>(<span class="hljs-params">branch</span>) {
  <span class="hljs-title function_">execSync</span>(<span class="hljs-string">`git worktree add ../<span class="hljs-subst">${branch}</span> <span class="hljs-subst">${branch}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🌿 Created worktree: <span class="hljs-subst">${branch}</span>`</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">mergeWorktree</span>(<span class="hljs-params">branch</span>) {
  <span class="hljs-title function_">execSync</span>(<span class="hljs-string">`git checkout main`</span>);
  <span class="hljs-title function_">execSync</span>(<span class="hljs-string">`git merge <span class="hljs-subst">${branch}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ Merged <span class="hljs-subst">${branch}</span> into main`</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteWorktree</span>(<span class="hljs-params">branch</span>) {
  <span class="hljs-title function_">execSync</span>(<span class="hljs-string">`git worktree remove ../<span class="hljs-subst">${branch}</span> --force`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🧹 Deleted worktree: <span class="hljs-subst">${branch}</span>`</span>);
}
</code></pre>
<p>Claude 在其内部系统中执行了类似逻辑，但将其关联到 AI 文件缓存和编辑上下文管理中，使其能够：</p>
<ul>
<li>高速加载关联文件；</li>
<li>在隔离环境中编译；</li>
<li>支持多版本回溯。</li>
</ul>
<hr/>
<h2 data-id="heading-7">⚖️ 六、最佳实践建议（重磅精华）</h2>



































<table><thead><tr><th>目标</th><th>建议实践</th><th>Claude命令示例</th></tr></thead><tbody><tr><td>快速试验</td><td>为重大重构代码预留独立worktree</td><td><code>/worktree create feature/new-ui</code></td></tr><tr><td>审查代码</td><td>使用 Claude 生成diff并由人工确认</td><td><code>/diff feature/new-ui</code></td></tr><tr><td>自动化测试</td><td>将测试脚本注册为 Hook</td><td><code>/test run feature/new-ui</code></td></tr><tr><td>并行开发</td><td>为每个模块分配 Claude 实例与独立 worktree</td><td><code>/worktree create feature/auth-refactor</code></td></tr><tr><td>安全管理</td><td>定期让 Claude 清理过期工作区</td><td><code>/worktree prune</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">🧩 七、冷知识与幽默插曲</h2>
<ul>
<li>
<p>有人问：为什么 Claude 不直接改主分支？<br/>
🧑‍💻 回答：<strong>因为他懂版本管理的礼仪。</strong></p>
</li>
<li>
<p>一个典型的错误用法是：</p>
<pre><code class="hljs language-bash" lang="bash">/worktree create main-feature
</code></pre>
<p>Claude 会温柔地提醒：<br/>
<em>“您刚试图改写历史，请冷静。”</em></p>
</li>
<li>
<p>在大型项目中，Claude 的 <code>code/worktree</code> 策略就像多线程调度：</p>
<blockquote>
<p>每个工作区就是一个线程，每个线程都在为未来的主干静静努力。</p>
</blockquote>
</li>
</ul>
<hr/>
<h2 data-id="heading-9">🛠 八、结语：让Claude成为你的「安全编辑器」</h2>
<p>合理使用 <code>code/worktree</code>，本质上是让 Claude 从一个“AI助手”升级为<strong>协同式副开发者（Co-Developer）</strong> 。<br/>
它不只是写代码，而是遵守开发流程，与人类团队共生。</p>
<p>当 Claude 生成代码的同时，还能保证主分支的整洁与安全时，<br/>
你会发现开发变得轻盈、策略变得优雅。</p>
<hr/>
<blockquote>
<p>✨ <strong>最终箴言：</strong></p>
<p>“聪明的开发者自己写代码，更聪明的开发者教 Claude 在另一个 world 里写。”</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[上架元服务-味寻纪 技术分享]]></title>    <link>https://juejin.cn/post/7575006095389376521</link>    <guid>https://juejin.cn/post/7575006095389376521</guid>    <pubDate>2025-11-22T03:02:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575006095389376521" data-draft-id="7575017581037158438" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="上架元服务-味寻纪 技术分享"/> <meta itemprop="keywords" content="前端,HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-22T03:02:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="万少"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708283191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            上架元服务-味寻纪 技术分享
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708283191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    万少
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T03:02:04.000Z" title="Sat Nov 22 2025 03:02:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"/>
<h3 data-id="heading-1">项目概述</h3>
<p><strong>味寻纪-元服务</strong>是一款基于鸿蒙HarmonyOS Next的美食应用，集成了鸿蒙官方推荐的zrouter路由管理方案，并实现了完整的用户认证体系包括静默登录功能。项目采用现代的组件化架构，提供流畅的用户体验。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dda080f49b8447f94975b77407ffeb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764385323&amp;x-signature=DYsv%2Bw%2BerF7%2BliJ0irrC2kOpTgQ%3D" alt="image-20251121103048327" loading="lazy"/></p>
<h3 data-id="heading-2">zrouter核心特性与功能</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e759f12275474461a1bfe94ecb5e1f6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764385323&amp;x-signature=BFo5ckRm3dU1ttR6IYEWnccSm8c%3D" alt="image-20251121103359970" loading="lazy"/></p>
<h4 data-id="heading-3">1. 统一路由管理</h4>
<p>zrouter作为鸿蒙官方推荐的路由管理方案，为应用提供了强大的页面导航能力。在味寻纪项目中，zrouter承担了以下核心功能：</p>
<h5 data-id="heading-4">1.1 自动路由生成</h5>
<p>通过<code>router-register-plugin</code>插件自动扫描生成路由构建器，项目中已自动生成了11个页面的路由文件：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// _generated目录下的自动生成的路由文件</span>
<span class="hljs-selector-tag">entry</span>\<span class="hljs-selector-tag">src</span>\<span class="hljs-selector-tag">main</span>\<span class="hljs-selector-tag">ets_generated</span>\
├── <span class="hljs-selector-tag">ZRBrowseHistoryPage</span><span class="hljs-selector-class">.ets</span>      <span class="hljs-comment">// 浏览历史页面</span>
├── <span class="hljs-selector-tag">ZRCookingTechniqueDetailPage</span><span class="hljs-selector-class">.ets</span>  <span class="hljs-comment">// 烹饪技法详情</span>
├── <span class="hljs-selector-tag">ZRCookingToolDetailPage</span><span class="hljs-selector-class">.ets</span>       <span class="hljs-comment">// 烹饪工具详情</span>
├── <span class="hljs-selector-tag">ZREditProfilePage</span><span class="hljs-selector-class">.ets</span>             <span class="hljs-comment">// 编辑资料页面</span>
├── <span class="hljs-selector-tag">ZRFamilyMemberEditPage</span><span class="hljs-selector-class">.ets</span>        <span class="hljs-comment">// 家庭成员编辑</span>
├── <span class="hljs-selector-tag">ZRFamilyMemberListPage</span><span class="hljs-selector-class">.ets</span>        <span class="hljs-comment">// 家庭成员列表</span>
├── <span class="hljs-selector-tag">ZRFamilyMemberRecipesPage</span><span class="hljs-selector-class">.ets</span>     <span class="hljs-comment">// 家庭成员菜谱</span>
├── <span class="hljs-selector-tag">ZRFavoriteListPage</span><span class="hljs-selector-class">.ets</span>            <span class="hljs-comment">// 收藏列表</span>
├── <span class="hljs-selector-tag">ZRIngredientDetailPage</span><span class="hljs-selector-class">.ets</span>        <span class="hljs-comment">// 食材详情</span>
├── <span class="hljs-selector-tag">ZRRecipeDetailPage</span><span class="hljs-selector-class">.ets</span>            <span class="hljs-comment">// 菜谱详情</span>
├── <span class="hljs-selector-tag">ZRRecipeFilterPage</span><span class="hljs-selector-class">.ets</span>            <span class="hljs-comment">// 菜谱筛选</span>
├── <span class="hljs-selector-tag">ZRRecipeListPage</span><span class="hljs-selector-class">.ets</span>              <span class="hljs-comment">// 菜谱列表</span>
└── <span class="hljs-selector-tag">ZRTestPage</span><span class="hljs-selector-class">.ets</span>                    <span class="hljs-comment">// 测试页面</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03af903cbfcf4bf9911dce03cd064813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764385323&amp;x-signature=65E1eFNoDqOMJrhAHWcprrozQdE%3D" alt="image-20251121103117978" loading="lazy"/></p>
<h5 data-id="heading-5">1.2 生命周期管理</h5>
<p>zrouter内置了完整的页面生命周期管理，支持页面创建、销毁、返回等状态控制：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 生命周期管理示例</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Lifecycle</span>, <span class="hljs-title class_">LifecycleEvent</span>, <span class="hljs-title class_">LifecycleRegistry</span>, <span class="hljs-title class_">ZRouter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@hzw/zrouter"</span>;

<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ZRTestPageBuilder</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">ZRTestPage</span>()
}

<span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">ZRTestPage</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">navDestinationId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@Lifecycle</span>
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want, navStack: NavPathStack</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">navDestinationId</span> = want.<span class="hljs-property">parameters</span>?.[<span class="hljs-string">'navDestinationId'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span> || <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span> = navStack;
    <span class="hljs-comment">// 注册模板管理器</span>
    <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">templateMgr</span>().<span class="hljs-title function_">register</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">navDestinationId</span>)
  }

  <span class="hljs-meta">@Lifecycle</span>
  <span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 页面显示时的逻辑</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {
      <span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LifecycleRegistry</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">navDestinationId</span>);
      <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">templateMgr</span>().<span class="hljs-title function_">dispatch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">navDestinationId</span>, <span class="hljs-title class_">LifecycleEvent</span>.<span class="hljs-property">ON_SHOW</span>, router)
    }
  }

  <span class="hljs-meta">@Lifecycle</span>
  <span class="hljs-title function_">onBackPress</span>(): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-comment">// 处理返回键逻辑</span>
    <span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LifecycleRegistry</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">navDestinationId</span>);
    <span class="hljs-keyword">const</span> r = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">templateMgr</span>().<span class="hljs-title function_">dispatch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">navDestinationId</span>, <span class="hljs-title class_">LifecycleEvent</span>.<span class="hljs-property">ON_BACK_PRESS</span>, router)
    <span class="hljs-keyword">return</span> r || <span class="hljs-literal">false</span>;
  }
}
</code></pre>
<h4 data-id="heading-6">2. 强大的参数传递机制</h4>
<p>zrouter提供了类型安全的参数传递功能，支持复杂的参数类型和结构。</p>
<h5 data-id="heading-7">2.1 基本参数传递</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 从首页跳转到菜谱详情页，并传递参数</span>
ZRouter<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.setParam</span>({ recipeId: recipe.id })<span class="hljs-selector-class">.push</span>('RecipeDetailPage');

<span class="hljs-comment">// 从筛选页面跳转到列表页面，传递筛选条件</span>
ZRouter<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.setParam</span>(params)<span class="hljs-selector-class">.push</span>('RecipeListPage');
</code></pre>
<h5 data-id="heading-8">2.2 复杂参数传递</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 传递多个筛选参数</span>
const filterParams = {
  category: <span class="hljs-string">'川菜'</span>,
  difficulty: <span class="hljs-string">'简单'</span>,
  flavor: <span class="hljs-string">'香辣'</span>,
  includeIngredients: <span class="hljs-string">'牛肉,青椒'</span>,
  excludeIngredients: <span class="hljs-string">'洋葱'</span>,
  minTime: <span class="hljs-number">10</span>,
  maxTime: <span class="hljs-number">60</span>,
  keyword: <span class="hljs-string">'麻婆豆腐'</span>
};

ZRouter<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.setParam</span>(filterParams)<span class="hljs-selector-class">.push</span>('RecipeListPage');
</code></pre>
<h5 data-id="heading-9">2.3 参数获取与类型转换</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在目标页面中获取参数</span>
<span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">RecipeListPage</span> {
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">selectMode</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-meta">@Local</span> <span class="hljs-attr">memberId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;

  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 获取路由参数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectMode</span> = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'selectMode'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memberId</span> = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'memberId'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;
    
    <span class="hljs-comment">// 获取筛选参数</span>
    <span class="hljs-keyword">const</span> category = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'category'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">const</span> difficulty = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'difficulty'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">const</span> flavor = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'flavor'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">const</span> includeIngredients = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'includeIngredients'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">const</span> excludeIngredients = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'excludeIngredients'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">const</span> minTime = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'minTime'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;
    <span class="hljs-keyword">const</span> maxTime = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'maxTime'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;
    <span class="hljs-keyword">const</span> keyword = <span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getParamByKey</span>(<span class="hljs-string">'keyword'</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
  }
}
</code></pre>
<h4 data-id="heading-10">3. 声明式路由配置</h4>
<p>zrouter支持简洁的装饰器语法，让路由配置更加优雅：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hzw/zrouter'</span>;

<span class="hljs-meta">@Route</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'TestPage'</span>, <span class="hljs-attr">useTemplate</span>: <span class="hljs-literal">true</span> })
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">TestPage</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'This is Test Page'</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">NavDestination</span>() {
      <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {
        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'ZRouter 引入成功！'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#4CAF50'</span>)
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
    }
    .<span class="hljs-title function_">title</span>(<span class="hljs-string">'测试页面'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<h3 data-id="heading-11">项目集成实践</h3>
<h4 data-id="heading-12">1. 依赖配置</h4>
<p>在项目的<code>oh-package.json5</code>中添加zrouter依赖：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@hzw/zrouter"</span>: <span class="hljs-string">"^1.8.2"</span>
  }
}
</code></pre>
<p>![依赖配置示意图]<em>图3：oh-package.json5中的zrouter依赖配置</em></p>
<h4 data-id="heading-13">2. 初始化配置</h4>
<p>在<code>EntryAbility</code>的<code>onCreate</code>方法中初始化zrouter：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> { ZRouter } from <span class="hljs-string">'@hzw/zrouter'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> extends UIAbility {
  <span class="hljs-built_in">onCreate</span>(want: Want, launchParam: AbilityConstant.LaunchParam): <span class="hljs-type">void</span> {
    <span class="hljs-comment">// 初始化 ZRouter</span>
    ZRouter.<span class="hljs-built_in">initialize</span>((config) =&gt; {
      config.context = <span class="hljs-keyword">this</span>.context;
      config.isLoggingEnabled = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 开发环境开启日志</span>
      config.isHSPModuleDependent = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 如果有HSP模块设置为true</span>
    });
  }
}
</code></pre>
<h4 data-id="heading-14">3. 导航容器配置</h4>
<p>在主页面中使用zrouter的导航栈：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ZRouter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hzw/zrouter'</span>;

<span class="hljs-meta">@ComponentV2</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Navigation</span>(<span class="hljs-title class_">ZRouter</span>.<span class="hljs-title function_">getNavStack</span>()) {
      <span class="hljs-title class_">HomePage</span>()
    }
    .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)
  }
}
</code></pre>
<h4 data-id="heading-15">4. 代码混淆适配</h4>
<p>在混淆规则文件<code>obfuscation-rules.txt</code>中配置zrouter相关的保护规则：</p>
<pre><code class="hljs language-erlang" lang="erlang"># ZRouter 混淆配置
-keep<span class="hljs-keyword">-file</span>-name
Index
_generated
ZR*
</code></pre>
<p>这确保了zrouter生成的页面名称和路由配置在混淆后仍能正常工作。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ebdd71a3f814a9fa99fc866c4ab3cb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764385323&amp;x-signature=JTTQI4lMj%2BClPozmRBnLeDL2GGE%3D" alt="image-20251121103208018" loading="lazy"/></p>
<h3 data-id="heading-16">静默登录功能实现</h3>
<p>除了zrouter路由管理，项目还实现了完整的用户认证体系，其中静默登录是一大亮点功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ee0b462325a4111be0553691a22c0fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764385323&amp;x-signature=SEgIGNCYicIWLFAov%2Fw9tYkFreI%3D" alt="image-20251121103220738" loading="lazy"/></p>
<h4 data-id="heading-17">1. 静默登录核心逻辑</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 静默登录 - 不显示登录界面
 * <span class="hljs-doctag">@param</span> enableSilentLogin 是否启用静默登录
 * <span class="hljs-doctag">@returns</span> 登录是否成功
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">performSilentLogin</span>(<span class="hljs-attr">enableSilentLogin</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {
  <span class="hljs-comment">// 如果未启用静默登录，直接返回</span>
  <span class="hljs-keyword">if</span> (!enableSilentLogin) {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'静默登录已关闭'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">try</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'开始静默登录'</span>);

    <span class="hljs-comment">// 创建静默登录请求</span>
    <span class="hljs-keyword">const</span> loginRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createLoginWithHuaweiIDRequest</span>();
    loginRequest.<span class="hljs-property">forceLogin</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 静默登录</span>
    loginRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>();

    <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>();
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> controller.<span class="hljs-title function_">executeRequest</span>(loginRequest);

    <span class="hljs-keyword">const</span> loginWithHuaweiIDResponse = response <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">LoginWithHuaweiIDResponse</span>;
    <span class="hljs-keyword">const</span> state = loginWithHuaweiIDResponse.<span class="hljs-property">state</span>;

    <span class="hljs-comment">// 验证 state</span>
    <span class="hljs-keyword">if</span> (state &amp;&amp; loginRequest.<span class="hljs-property">state</span> !== state) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'状态验证失败'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">const</span> credential = loginWithHuaweiIDResponse.<span class="hljs-property">data</span>;
    <span class="hljs-keyword">if</span> (!credential) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'未获取到凭证'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 调用后端API完成登录</span>
    <span class="hljs-keyword">const</span> loginResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">huaweiLogin</span>({
      <span class="hljs-attr">authorizationCode</span>: credential.<span class="hljs-property">authorizationCode</span> || <span class="hljs-string">''</span>,
      <span class="hljs-attr">openID</span>: credential.<span class="hljs-property">openID</span> || <span class="hljs-string">''</span>,
      <span class="hljs-attr">unionID</span>: credential.<span class="hljs-property">unionID</span> || <span class="hljs-string">''</span>,
      <span class="hljs-attr">idToken</span>: credential.<span class="hljs-property">idToken</span>
    });

    <span class="hljs-comment">// 保存登录状态</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveLoginState</span>(loginResponse);

    <span class="hljs-comment">// 更新全局用户状态</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userStore</span>.<span class="hljs-title function_">setUser</span>(loginResponse.<span class="hljs-property">user</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userStore</span>.<span class="hljs-title function_">setLoggedIn</span>(<span class="hljs-literal">true</span>);

    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'静默登录成功: %{public}s'</span>, 
      loginResponse.<span class="hljs-property">user</span>.<span class="hljs-property">nickname</span> || loginResponse.<span class="hljs-property">user</span>.<span class="hljs-property">username</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">const</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;
    <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span> === <span class="hljs-number">1001502001</span>) {
      <span class="hljs-comment">// 用户未登录华为账号，这是正常情况</span>
      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'用户未登录华为账号'</span>);
    } <span class="hljs-keyword">else</span> {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'静默登录失败: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
}
</code></pre>
<h4 data-id="heading-18">2. 启动登录流程</h4>
<p>在应用启动时，系统会自动执行以下登录逻辑：</p>
<ol>
<li><strong>本地状态恢复</strong>：优先从本地存储恢复登录状态</li>
<li><strong>静默登录</strong>：如果本地恢复失败且开启静默登录，则执行静默登录</li>
<li><strong>用户状态更新</strong>：更新全局用户状态管理</li>
</ol>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * 应用启动时的登录逻辑
 * 1. 先尝试从本地恢复登录状态
 * 2. 如果本地恢复成功，不再执行静默登录
 * 3. 如果本地恢复失败且开启了静默登录，则执行静默登录
 */</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title">performStartupLogin</span>(): Promise&lt;<span class="hljs-keyword">void</span>&gt;</span> {
  <span class="hljs-keyword">try</span> {
    hilog.info(DOMAIN, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'开始执行启动登录逻辑'</span>);

    <span class="hljs-comment">// 1. 先尝试从本地恢复登录状态</span>
    <span class="hljs-keyword">const</span> restored = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.authManager.restoreLoginState();
    <span class="hljs-keyword">if</span> (restored) {
      hilog.info(DOMAIN, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'从本地恢复登录状态成功'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 2. 检查是否启用静默登录</span>
    <span class="hljs-keyword">const</span> enableSilentLogin = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.storageManager.getBoolean(
      StorageKeys.ENABLE_SILENT_LOGIN, 
      <span class="hljs-literal">true</span> <span class="hljs-comment">// 默认开启</span>
    );

    <span class="hljs-keyword">if</span> (!enableSilentLogin) {
      hilog.info(DOMAIN, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'静默登录已关闭，跳过'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 3. 执行静默登录</span>
    <span class="hljs-keyword">const</span> success = <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.authManager.performSilentLogin(enableSilentLogin);
    <span class="hljs-keyword">if</span> (success) {
      hilog.info(DOMAIN, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'静默登录成功'</span>);
    } <span class="hljs-keyword">else</span> {
      hilog.info(DOMAIN, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'静默登录失败或用户未登录'</span>);
    }

  } <span class="hljs-keyword">catch</span> (error) {
    hilog.error(DOMAIN, <span class="hljs-string">'EntryAbility'</span>, <span class="hljs-string">'启动登录逻辑执行失败: %{public}s'</span>, JSON.stringify(error));
  }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4b91e0c788f43a0a737488c17282238~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764385323&amp;x-signature=DilTI5VV55VR98QoieFLk3Ljwyk%3D" alt="image-20251121103306865" loading="lazy"/></p>
<p>image-20251121103306865</p>
<h4 data-id="heading-19">3. 手动登录支持</h4>
<p>除了静默登录，项目还支持手动登录，用户可以主动触发登录流程：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * 手动登录 - 显示登录界面
 * @returns 登录响应数据
 */</span>
<span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-title">performManualLogin</span>(): Promise&lt;LoginResponse | <span class="hljs-literal">null</span>&gt;</span> {
  <span class="hljs-keyword">try</span> {
    hilog.info(DOMAIN, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'开始手动登录'</span>);

    <span class="hljs-comment">// 创建登录请求</span>
    <span class="hljs-keyword">const</span> loginRequest = <span class="hljs-keyword">new</span> authentication.HuaweiIDProvider().createLoginWithHuaweiIDRequest();
    loginRequest.forceLogin = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 强制显示登录页面</span>
    loginRequest.state = util.generateRandomUUID();

    <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.AuthenticationController();
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> controller.executeRequest(loginRequest);

    <span class="hljs-keyword">const</span> loginWithHuaweiIDResponse = response <span class="hljs-keyword">as</span> authentication.LoginWithHuaweiIDResponse;
    <span class="hljs-keyword">const</span> state = loginWithHuaweiIDResponse.state;

    <span class="hljs-keyword">if</span> (state &amp;&amp; loginRequest.state !== state) {
      hilog.error(DOMAIN, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'状态验证失败'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">const</span> credential = loginWithHuaweiIDResponse.data;
    <span class="hljs-keyword">if</span> (!credential) {
      hilog.error(DOMAIN, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'未获取到凭证'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// 调用后端API完成登录</span>
    <span class="hljs-keyword">const</span> loginResponse = <span class="hljs-keyword">await</span> huaweiLogin({
      authorizationCode: credential.authorizationCode || <span class="hljs-string">''</span>,
      openID: credential.openID || <span class="hljs-string">''</span>,
      unionID: credential.unionID || <span class="hljs-string">''</span>,
      idToken: credential.idToken
    });

    <span class="hljs-comment">// 保存登录状态</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">this</span>.saveLoginState(loginResponse);

    <span class="hljs-comment">// 更新全局用户状态</span>
    <span class="hljs-keyword">this</span>.userStore.setUser(loginResponse.user);
    <span class="hljs-keyword">this</span>.userStore.setLoggedIn(<span class="hljs-literal">true</span>);

    hilog.info(DOMAIN, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'手动登录成功: %{public}s'</span>,
      loginResponse.user.nickname || loginResponse.user.username);

    <span class="hljs-keyword">return</span> loginResponse;

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">const</span> err = error <span class="hljs-keyword">as</span> BusinessError;
    hilog.error(DOMAIN, <span class="hljs-string">'AuthManager'</span>, <span class="hljs-string">'手动登录失败: %{public}s'</span>, JSON.stringify(error));
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<h3 data-id="heading-20">核心亮点与优势</h3>
<h4 data-id="heading-21">1. 零配置路由管理</h4>
<ul>
<li><strong>自动生成路由</strong>：通过插件自动扫描生成路由配置，无需手动维护路由表</li>
<li><strong>类型安全</strong>：参数传递和获取过程中提供完整的类型支持</li>
<li><strong>声明式配置</strong>：使用装饰器语法，让路由配置更加简洁直观</li>
</ul>
<h4 data-id="heading-22">2. 强大的页面生命周期管理</h4>
<ul>
<li><strong>完整的生命周期钩子</strong>：支持页面创建、显示、隐藏、销毁等完整生命周期</li>
<li><strong>灵活的事件处理</strong>：内置多种事件类型，便于处理复杂的页面交互逻辑</li>
<li><strong>返回键管理</strong>：提供统一的返回键处理机制</li>
</ul>
<h4 data-id="heading-23">3. 智能参数传递机制</h4>
<ul>
<li><strong>类型转换支持</strong>：自动处理基本类型和复杂对象的序列化/反序列化</li>
<li><strong>参数验证</strong>：内置参数验证机制，提高应用稳定性</li>
<li><strong>状态管理集成</strong>：与鸿蒙的AppStorageV2等状态管理方案完美集成</li>
</ul>
<h4 data-id="heading-24">4. 生产级混淆适配</h4>
<ul>
<li><strong>混淆保护规则</strong>：提供完整的混淆配置建议</li>
<li><strong>文件名称保护</strong>：确保混淆后路由名称的正确映射</li>
<li><strong>编译时优化</strong>：支持编译时的路由优化和压缩</li>
</ul>
<h4 data-id="heading-25">5. 无缝认证集成</h4>
<ul>
<li><strong>静默登录体验</strong>：应用启动时自动完成身份验证，用户无感知</li>
<li><strong>本地状态恢复</strong>：优先使用本地存储的用户信息，提升启动速度</li>
<li><strong>灵活认证策略</strong>：支持静默登录和手动登录的灵活切换</li>
</ul>
<h3 data-id="heading-26">性能与优化</h3>
<h4 data-id="heading-27">1. 路由性能优化</h4>
<ul>
<li><strong>懒加载支持</strong>：zrouter支持页面懒加载，减少应用启动时间</li>
<li><strong>路由缓存</strong>：内置路由状态缓存，提升页面切换性能</li>
<li><strong>内存管理</strong>：智能的内存管理机制，避免内存泄漏</li>
</ul>
<h4 data-id="heading-28">2. 开发体验优化</h4>
<ul>
<li><strong>开发日志</strong>：开发模式下提供详细的路由操作日志</li>
<li><strong>热更新支持</strong>：支持开发时的路由热更新</li>
<li><strong>调试工具</strong>：提供丰富的调试工具和状态监控</li>
</ul>
<h4 data-id="heading-29">3. 兼容性保障</h4>
<ul>
<li><strong>版本兼容</strong>：支持不同版本的HarmonyOS系统</li>
<li><strong>API适配</strong>：自动适配不同API版本的功能差异</li>
<li><strong>向后兼容</strong>：确保老版本代码的兼容性问题</li>
</ul>
<h3 data-id="heading-30">最佳实践建议</h3>
<h4 data-id="heading-31">1. 路由命名规范</h4>
<ul>
<li>使用语义化的页面名称</li>
<li>统一命名风格（如驼峰命名法）</li>
<li>避免使用特殊字符</li>
</ul>
<h4 data-id="heading-32">2. 参数设计原则</h4>
<ul>
<li>传递最小必要信息</li>
<li>避免传递过大的对象</li>
<li>合理设计参数结构</li>
</ul>
<h4 data-id="heading-33">3. 页面生命周期管理</h4>
<ul>
<li>合理使用生命周期钩子</li>
<li>避免在生命周期中执行耗时操作</li>
<li>及时清理资源，避免内存泄漏</li>
</ul>
<h4 data-id="heading-34">4. 安全考虑</h4>
<ul>
<li>对敏感参数进行加密处理</li>
<li>验证参数的合法性</li>
<li>避免在URL中暴露敏感信息</li>
</ul>
<h3 data-id="heading-35">总结</h3>
<p>味寻纪-元服务项目成功集成了zrouter路由管理方案，并实现了完善的静默登录功能。通过zrouter的强大功能，项目获得了：</p>
<ul>
<li><strong>统一且强大的路由管理</strong>：简化了页面导航逻辑，提升了开发效率</li>
<li><strong>类型安全的参数传递</strong>：减少了运行时错误，提升了代码质量</li>
<li><strong>完整的生活周期管理</strong>：提供了更好的用户体验</li>
<li><strong>生产级的混淆支持</strong>：确保了应用的安全性</li>
<li><strong>无缝的认证体验</strong>：静默登录提升了用户使用体验</li>
</ul>
<p>zrouter作为鸿蒙官方推荐的路由解决方案，为HarmonyOS Next应用开发提供了强大而稳定的路由管理能力，是构建高质量鸿蒙应用的重要工具。通过味寻纪项目的实践，我们可以看到zrouter在实际项目中的强大功能和良好体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[模型驱动架构的数学内核：统一生成与演化的 Y = F(X) ⊕ Delta 不变式]]></title>    <link>https://juejin.cn/post/7575017581036847142</link>    <guid>https://juejin.cn/post/7575017581036847142</guid>    <pubDate>2025-11-22T01:20:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575017581036847142" data-draft-id="7575006095389179913" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="模型驱动架构的数学内核：统一生成与演化的 Y = F(X) ⊕ Delta 不变式"/> <meta itemprop="keywords" content="架构,设计模式,数学"/> <meta itemprop="datePublished" content="2025-11-22T01:20:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            模型驱动架构的数学内核：统一生成与演化的 Y = F(X) ⊕ Delta 不变式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T01:20:51.000Z" title="Sat Nov 22 2025 01:20:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>摘要：</strong> 模型驱动架构（MDA）通过提升抽象层次与自动化来应对软件复杂性。然而，传统MDA在实践中面临“往返工程”与“胖模型”等挑战，这些问题的解决一般依赖于工程经验，缺少完备的数学理论的指导。本文探讨一种基于（广义）可逆计算理论的架构思想，它引入“差量（Delta）”作为具备代数属性的基本构造单元，并提出<code>Y = F(X) ⊕ Delta</code>这一构造不变式。该框架旨在统一软件的生成与演化过程，为解决传统MDA的固有问题提供一种新的范式，并揭示软件构造过程背后潜在的数学结构。</p>
<h4 data-id="heading-0"><strong>1. 模型驱动架构（MDA）的贡献与局限</strong></h4>
<p>模型驱动架构的核心是将模型作为软件开发过程的首要产物。其经典的流程——从计算无关模型（CIM）到平台无关模型（PIM），再到平台相关模型（PSM），最后生成代码。</p>
<p>模型驱动的核心思想可以看作是根据模型生成代码，形式化表达为 <code>Model =&gt; Code</code>, 更进一步可以写成</p>
<pre><code class="hljs language-ini" lang="ini"> <span class="hljs-attr">Code</span> = Generator(Model)
</code></pre>
<p>现实中，手动调整几乎不可避免，导致最终的应用形态变为：</p>
<p><code>App = Generator(Model) + ManualAdjustment</code></p>
<p>但是这里的 <code>+ManualAdjustment</code>一般是一种人工介入的操作过程，比如手工对生成代码修改，难以通过规则自动化完成。这种行为破坏了模型作为“唯一真相来源”的原则，导致模型与代码的状态不一致。</p>
<h4 data-id="heading-1"><strong>2. 构造单元的重定义：以“差量（Delta）”为核心</strong></h4>
<p><strong>（广义）可逆计算理论</strong>提供了一种新的理论视角，它建议对软件的基本构造单元进行重新定义。</p>
<ul>
<li><strong>传统视角</strong>：程序由数据和函数构成。在面向对象范式中，它们被组织为类与对象，即“一切皆对象”。</li>
<li><strong>新视角</strong>：软件的基本构造单元是**“差量（Delta）”<strong>。一个<code>Delta</code>是包含精确增、删、改语义的变更切片（Slice）的集合，例如类的切片、函数的切片或数据的切片。考虑到A=0+A，在此框架下，一个完整的程序或模型（全量）可被视为一个“从无到有”的特殊<code>Delta</code>。因此，其核心主张是</strong>“一切皆差量”**。</li>
</ul>
<p>这一视角的转变，意在将软件的“初始构造”和“后续演化”两个过程统一在同一个概念之下。这与版本控制系统（如Git的Commit）或事件溯源（Event Sourcing）的思想存在关联，但其应用目标是程序的<strong>结构本身</strong>，而非文本或运行时状态。</p>
<h4 data-id="heading-2"><strong>3. Delta导向架构：基于差量代数的不变式</strong></h4>
<p>基于“一切皆差量”的公理，传统MDA的构造公式可被一个更通用的公式所取代：</p>
<p><code>Y = F(X) ⊕ Delta</code></p>
<p>该公式可被视为Delta导向架构的<strong>基本不变式</strong>，其中：</p>
<ul>
<li><code>X</code> 和 <code>Y</code> 是不同抽象层次或不同领域的模型，它们通常以领域特定语言（DSL）的形式存在。</li>
<li><code>F</code> 是一个转换函数（Generator），定义了从<code>X</code>到<code>Y</code>主要部分的推导规则。</li>
<li><code>Delta</code> 是一个形式化的差量对象，封装了所有<code>F(X)</code>未能覆盖的、在<code>Y</code>空间中必须补充或修正的细节。</li>
<li><code>⊕</code> 是一个有明确定义的<strong>差量合并运算</strong>。它取代了原先模糊的 <code>+</code>，使得“手动调整”过程本身成为可追踪、可组合、甚至具备可逆性的操作。</li>
</ul>
<p>为实现此框架，需要在不同的程序结构空间中定义相应的<code>⊕</code>运算规则。例如，对于树状结构的XML或JSON，可定义一种<code>x-extends</code>的差量合并算法，满足结合律但不满足交换律；对于具有复杂依赖图的Java语言结构，则可以通过引用id将循环关联断开，将图投影为树结构。</p>
<h4 data-id="heading-3"><strong>4. 递归分解：应对复杂性与“胖模型”问题</strong></h4>
<p><code>Y = F(X) ⊕ Delta</code>这一不变式的一个关键特性在于其<strong>递归应用</strong>的能力，这为处理复杂系统和MDA的“胖模型”问题提供了一种结构化的解决方案。</p>
<p><strong>4.1 纵向分解</strong></p>
<p>传统MDA要求上游模型（PIM）包含生成下游所有产物所需的信息，可能导致PIM过度复杂。Delta导向架构允许信息在转换链中逐步注入：</p>
<p><code>Y = F1(X) ⊕ Delta1</code>
<code>X = F2(Z) ⊕ Delta2</code></p>
<p>代入后得到：<code>Y = F1(F2(Z) ⊕ Delta2) ⊕ Delta1</code></p>
<p>此公式表明，在从<code>Z</code>生成<code>X</code>时，<code>Z</code>模型本身无需承载所有的最终细节。<code>X</code>层面的信息可以通过<code>Delta2</code>补充，而最终<code>Y</code>层面的信息则可通过<code>Delta1</code>再次补充。每一层的<code>Delta</code>仅包含其对应抽象层次所关心的信息，有助于降低单一模型的复杂性。</p>
<p><strong>4.2 横向分解</strong></p>
<p>现代应用通常是多个关注点的组合。该框架同样支持横向分解：</p>
<p><code>App = F1(DSL1) ⊕ F2(DSL2) ⊕ ... ⊕ Delta_extra</code></p>
<p>这描述了应用的最终形态可由多个不同领域模型（如API模型、数据模型、UI模型）的生成结果，与一个用于粘合和定制的额外差量<code>Delta_extra</code>组合而成。</p>
<p><strong>4.3 元编程空间的分解</strong></p>
<p>该理论的普适性体现在它同样适用于构造过程本身。不仅模型和差量可以被分解，生成器自身也可以被视为差量组合的结果：</p>
<p><code>Generator2 = Generator1 ⊕ Delta_Generator</code></p>
<p>这意味着一个通用的代码生成器可以通过与一个特定的“特性差量包”进行合并，演化为一个专用的生成器。这为元编程工具的复用和演进提供了理论上的可能性。</p>
<h3 data-id="heading-4"><strong>5. 元模型、差量与生成式构造</strong></h3>
<p>本文提出的数学框架，在元模型（Metamodel）层面同样适用，并能与现代AI技术无缝结合。</p>
<p><strong>5.1 元模型即类型</strong></p>
<p>首先，我们将元模型与模型的关系形式化。一个元模型（MM）可以被看作一个<strong>类型系统</strong>，而模型（M）则是该类型系统的一个<strong>实例（值）</strong>。这种关系用类型论中的断言（Typing Judgment）表示：</p>
<p><code>M : MM</code></p>
<p>该公式读作：“模型<code>M</code>是元模型<code>MM</code>的一个有效实例”。这与编程语言中的<code>5 : Integer</code>完全等价。在MDA中，这意味着一个<code>UserClass</code>模型必须遵循<code>UML_Class</code>元模型定义的规则。</p>
<p><strong>5.2 AI驱动的生成式构造</strong></p>
<p>传统上，<code>M : MM</code>主要用于<strong>验证</strong>。但在AI（特别是LLM）时代，元模型的角色从“事后验证者”转变为“事前指导者”。我们可以将模型的生成过程形式化为：</p>
<p><code>Model = AIGenerator(Metamodel, Requirements)</code></p>
<ul>
<li><code>Metamodel</code>在此作为<strong>结构化约束</strong>输入，为AI的自由创造划定了语法边界和结构骨架，确保输出的<code>Model</code>必然满足<code>Model : Metamodel</code>。</li>
<li><code>Requirements</code>则是以自然语言等形式提供的<strong>语义意图</strong>，指导AI在合法的结构空间内生成具体内容。</li>
</ul>
<p><strong>5.3 元模型的差量演化</strong></p>
<p>本文理论最关键的自相似性体现在，差量分解同样适用于元模型本身：</p>
<p><code>Metamodel' = Metamodel ⊕ Delta_Metamodel</code></p>
<p>这个公式意味着<strong>语言本身也可以通过差量进行演化</strong>。例如，我们可以通过一个<code>Delta_Metamodel</code>为一门DSL（由<code>Metamodel</code>定义）非侵入式地增加原语言设计者设想之外的新特性。这为领域语言的受控演化和能力升级提供了强大的形式化工具，体现了该理论在不同抽象层次上的一致性和普适性。</p>
<h2 data-id="heading-5">结论</h2>
<p>Delta导向架构的数学结构类似于数学中的<strong>小波分析</strong>。在小波分析中，一个信号被分解为一个低频的**近似（Approximation）<strong>部分和一个高频的</strong>细节（Detail）**部分，且此分解过程可递归进行。</p>
<p>与之对应，<code>Y = F(X) ⊕ Delta</code>中的<code>F(X)</code>可被看作是由上游模型生成的、框架性的“近似”部分，而<code>Delta</code>则是补充的、具体的“细节”部分。其递归分解的特性，也与小波分析的多分辨率分析能力相似。</p>
<p>将“差量（Delta）”及其代数运算<code>⊕</code>置于软件构造的核心，为模型驱动架构的发展提供了一个基于形式化方法的演进方向。它试图将软件开发从一种依赖人工协调的活动，转变为一种基于形式化推导和结构化差量合成的系统工程。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 实战：基于 JWT 优化 Spring Security 无状态登录]]></title>    <link>https://juejin.cn/post/7574997924929978408</link>    <guid>https://juejin.cn/post/7574997924929978408</guid>    <pubDate>2025-11-21T13:01:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574997924929978408" data-draft-id="7574978545144610851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 实战：基于 JWT 优化 Spring Security 无状态登录"/> <meta itemprop="keywords" content="后端,Spring Boot"/> <meta itemprop="datePublished" content="2025-11-21T13:01:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Web天梯之路"/> <meta itemprop="url" content="https://juejin.cn/user/2825061103052843"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 实战：基于 JWT 优化 Spring Security 无状态登录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2825061103052843/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Web天梯之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T13:01:49.000Z" title="Fri Nov 21 2025 13:01:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Boot 实战：基于 JWT 优化 Spring Security 无状态登录</h2>
<p>在上一篇文章中，我们通过 Spring Security 实现了基础的接口权限控制，但采用的 HTTP Basic 登录存在明显缺陷：<strong>安全性</strong>，用户名和密码只是简单的通过 Base64 编码之后就开始传送了，很容易被破解，进而暴露用户信息。</p>
<p>本文将引入 <strong>JWT（JSON Web Token）</strong> 技术，重构登录流程，让接口即安全又贴合企业级项目需求。</p>
<h3 data-id="heading-1">一、先搞懂：为什么需要 JWT？</h3>
<p>Jwt的核心优势是 <strong>无状态</strong>：</p>
<ol>
<li>登录成功后，服务器生成一个包含用户信息和权限的加密 Token，直接返回给客户端；</li>
<li>客户端后续请求时，只需在请求头携带 Token，服务器无需存储任何状态，直接通过 Token 验证身份和权限；</li>
<li>多台服务器共用一套 Token 验证逻辑，无需同步状态，完美适配分布式部署。</li>
</ol>
<h3 data-id="heading-2">二、准备工作：添加 JWT 依赖</h3>
<p>在 <code>pom.xml</code> 的 <code>&lt;dependencies&gt;</code> 标签中，新增 JWT 相关依赖（基于 JJWT 框架，Spring 官方推荐）：</p>
<pre><code class="hljs language-xml" lang="xml">        <span class="hljs-comment">&lt;!-- JWT 核心依赖（JJWT） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.11.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- JWT 实现依赖 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt-impl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.11.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- JWT 加密算法依赖 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.jsonwebtoken<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jjwt-jackson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.11.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>添加后点击 IDEA 右上角的 “Load Maven Changes” 刷新依赖，确保无红色报错。</p>
<h3 data-id="heading-3">三、第一步：实现 JWT 工具类（核心）</h3>
<p>JWT 的核心操作包括 <strong>生成 Token</strong>、<strong>验证 Token</strong>、<strong>解析 Token 中的用户信息</strong>，我们创建一个工具类封装这些逻辑，方便后续调用。</p>
<p>在 <code>com.example.firstspringbootproject.utils</code> 包下创建 <code>JwtUtil</code> 类：</p>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">firstspringbootproject</span>.<span class="hljs-property">utils</span>;

<span class="hljs-keyword">import</span> io.<span class="hljs-property">jsonwebtoken</span>.*;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Value</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">security</span>.<span class="hljs-property">core</span>.<span class="hljs-property">userdetails</span>.<span class="hljs-property">UserDetails</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Date</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">HashMap</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">List</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">function</span>.<span class="hljs-property">Function</span>;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtUtil</span> {

    <span class="hljs-comment">// 1. 从配置文件读取 JWT 关键参数（避免硬编码）</span>
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${jwt.secret}"</span>) <span class="hljs-comment">// 密钥（必须保密，建议在生产环境用环境变量配置）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> secret;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${jwt.expiration}"</span>) <span class="hljs-comment">// Token 过期时间（单位：毫秒，这里配置 2 小时）</span>
    <span class="hljs-keyword">private</span> long expiration;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${jwt.header}"</span>) <span class="hljs-comment">// 请求头中携带 Token 的字段名（如 Authorization）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> tokenHeader;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${jwt.prefix}"</span>) <span class="hljs-comment">// Token 前缀（如 Bearer，规范要求加空格）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> tokenPrefix;

    <span class="hljs-comment">// 2. 生成 Token：基于用户信息（用户名、角色）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">generateToken</span>(<span class="hljs-params">UserDetails userDetails</span>) {

        <span class="hljs-comment">// 存储 Token 中的自定义信息（Payload）</span>
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; claims = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

        <span class="hljs-comment">// 将用户角色存入 Token（后续验证权限用）</span>
        claims.<span class="hljs-title function_">put</span>(<span class="hljs-string">"roles"</span>, userDetails.<span class="hljs-title function_">getAuthorities</span>().<span class="hljs-title function_">stream</span>()
                .<span class="hljs-title function_">map</span>(authority -&gt; authority.<span class="hljs-title function_">getAuthority</span>())
                .<span class="hljs-title function_">toList</span>());

        <span class="hljs-comment">// 构建 Token 并返回</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Jwts</span>.<span class="hljs-title function_">builder</span>()
                .<span class="hljs-title function_">setClaims</span>(claims) <span class="hljs-comment">// 自定义信息</span>
                .<span class="hljs-title function_">setSubject</span>(userDetails.<span class="hljs-title function_">getUsername</span>()) <span class="hljs-comment">// 用户名（唯一标识）</span>
                .<span class="hljs-title function_">setIssuedAt</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) <span class="hljs-comment">// 签发时间</span>
                .<span class="hljs-title function_">setExpiration</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>() + expiration)) <span class="hljs-comment">// 过期时间</span>
                .<span class="hljs-title function_">signWith</span>(<span class="hljs-title class_">SignatureAlgorithm</span>.<span class="hljs-property">HS512</span>, secret) <span class="hljs-comment">// 加密算法（HS512）+ 密钥</span>
                .<span class="hljs-title function_">compact</span>();
    }

    <span class="hljs-comment">// 3. 从 Token 中获取用户名</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUsernameFromToken</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getClaimFromToken</span>(token, <span class="hljs-title class_">Claims</span>::getSubject);
    }

    <span class="hljs-comment">// 4. 验证 Token 是否有效（未过期 + 用户名匹配）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">validateToken</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token, UserDetails userDetails</span>) {
        <span class="hljs-title class_">String</span> username = <span class="hljs-title function_">getUsernameFromToken</span>(token);

        <span class="hljs-comment">// 验证逻辑：用户名一致 + Token 未过期 + Token 未被篡改</span>
        <span class="hljs-keyword">return</span> username.<span class="hljs-title function_">equals</span>(userDetails.<span class="hljs-title function_">getUsername</span>())
                &amp;&amp; !<span class="hljs-title function_">isTokenExpired</span>(token);

    }

    <span class="hljs-comment">// 5. 从 Token 中获取自定义角色信息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getRoleFromToken</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token</span>) {

        <span class="hljs-title class_">Claims</span> claims = <span class="hljs-title function_">getAllClaimsFromToken</span>(token);
        <span class="hljs-comment">// 从自定义信息中获取角色列表（这里简化为单个角色，多角色可返回 List）</span>
        <span class="hljs-keyword">return</span> ((<span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt;) claims.<span class="hljs-title function_">get</span>(<span class="hljs-string">"roles"</span>)).<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>);

    }

    <span class="hljs-comment">// ------------------------------</span>

    <span class="hljs-comment">// 以下是内部工具方法（无需外部调用）</span>

    <span class="hljs-comment">// ------------------------------</span>

    <span class="hljs-comment">// 解析 Token，获取所有自定义信息（Payload）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Claims</span> <span class="hljs-title function_">getAllClaimsFromToken</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token</span>) {

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Jwts</span>.<span class="hljs-title function_">parser</span>()
                    .<span class="hljs-title function_">setSigningKey</span>(secret) <span class="hljs-comment">// 用密钥解密</span>
                    .<span class="hljs-title function_">parseClaimsJws</span>(token)
                    .<span class="hljs-title function_">getBody</span>();
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">ExpiredJwtException</span> | <span class="hljs-title class_">MalformedJwtException</span> | <span class="hljs-title class_">SignatureException</span>
                 | <span class="hljs-title class_">IllegalArgumentException</span> | <span class="hljs-title class_">UnsupportedJwtException</span> e) {
            <span class="hljs-comment">// 捕获 Token 异常（过期、格式错误、签名错误等）</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"无效的 Token："</span> + e.<span class="hljs-title function_">getMessage</span>());
        }

    }

    <span class="hljs-comment">// 从 Token 中获取指定信息（通用方法）</span>
    <span class="hljs-keyword">private</span> &lt;T&gt; T <span class="hljs-title function_">getClaimFromToken</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token, <span class="hljs-built_in">Function</span>&lt;Claims, T&gt; claimsResolver</span>) {
        final <span class="hljs-title class_">Claims</span> claims = <span class="hljs-title function_">getAllClaimsFromToken</span>(token);
        <span class="hljs-keyword">return</span> claimsResolver.<span class="hljs-title function_">apply</span>(claims);

    }

    <span class="hljs-comment">// 判断 Token 是否过期</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isTokenExpired</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token</span>) {

        final <span class="hljs-title class_">Date</span> expirationDate = <span class="hljs-title function_">getClaimFromToken</span>(token, <span class="hljs-title class_">Claims</span>::getExpiration);
        <span class="hljs-keyword">return</span> expirationDate.<span class="hljs-title function_">before</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());

    }

    <span class="hljs-comment">// 6. 辅助方法：从请求头中提取 Token（去除前缀）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">extractTokenFromHeader</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> header</span>) {

        <span class="hljs-keyword">if</span> (header != <span class="hljs-literal">null</span> &amp;&amp; header.<span class="hljs-title function_">startsWith</span>(tokenPrefix)) {
            <span class="hljs-comment">// 例如：header = "Bearer eyJhbGciOiJIUzI1NiJ9..."，返回后面的 Token 部分</span>
            <span class="hljs-keyword">return</span> header.<span class="hljs-title function_">substring</span>(tokenPrefix.<span class="hljs-title function_">length</span>()).<span class="hljs-title function_">trim</span>();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    }

    <span class="hljs-comment">// Getter 方法（供外部获取配置参数）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTokenHeader</span>(<span class="hljs-params"/>) {

        <span class="hljs-keyword">return</span> tokenHeader;

    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTokenPrefix</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> tokenPrefix;
    }

}
</code></pre>
<h3 data-id="heading-4">四、第二步：配置 JWT 参数（避免硬编码）</h3>
<p>在 <code>src/main/resources/application.yml</code>（或 <code>application.properties</code>）中，添加 JWT 相关配置（替换硬编码，方便后续修改）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># JWT 配置</span>
<span class="hljs-attr">jwt:</span>
  <span class="hljs-attr">secret:</span> <span class="hljs-string">firstspringbootproject2025secretkeyfirstspringbootproject2025secretkeyfirstspringbootproject2025secretkey</span> <span class="hljs-comment"># 密钥（生产环境建议用 64 位以上随机字符串）</span>
<span class="hljs-comment">#  expiration: 7200000 # Token 过期时间（7200000 毫秒 = 2 小时）</span>
  <span class="hljs-attr">expiration:</span> <span class="hljs-number">1000</span> <span class="hljs-comment"># Token 过期时间（1000 毫秒 = 1 秒）</span>
  <span class="hljs-attr">header:</span> <span class="hljs-string">Authorization</span> <span class="hljs-comment"># 请求头字段名</span>
  <span class="hljs-attr">prefix:</span> <span class="hljs-string">Bearer</span>  <span class="hljs-comment"># Token 前缀（注意末尾有空格）</span>
</code></pre>
<h3 data-id="heading-5">五、第三步：实现 JWT 登录接口（替换 HTTP Basic）</h3>
<p>HTTP Basic 登录是通过浏览器弹窗输入账号密码，体验较差；我们需要自定义一个 <strong>登录接口</strong>（如 <code>/api/login</code>），客户端通过 JSON 提交账号密码，服务器验证通过后返回 JWT Token。</p>
<h4 data-id="heading-6">1. 创建登录请求参数实体类</h4>
<p>在 <code>com.example.firstspringbootproject.dto</code> 包下创建 <code>LoginRequestDTO</code>（接收客户端提交的账号密码）：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.firstspringbootproject</span><span class="hljs-selector-class">.dto</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.media</span><span class="hljs-selector-class">.Schema</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">jakarta</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.constraints</span><span class="hljs-selector-class">.NotBlank</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Data</span>;

@<span class="hljs-selector-tag">Data</span>
@<span class="hljs-selector-tag">Schema</span>(name = <span class="hljs-string">"LoginRequestDTO"</span>, description = <span class="hljs-string">"登录请求参数"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">LoginRequestDTO</span> {

    <span class="hljs-variable">@NotBlank</span>(message = <span class="hljs-string">"用户名不能为空"</span>)
    <span class="hljs-variable">@Schema</span>(description = <span class="hljs-string">"用户名"</span>, example = <span class="hljs-string">"admin"</span>)
    private String username;

    <span class="hljs-variable">@NotBlank</span>(message = <span class="hljs-string">"密码不能为空"</span>)
    <span class="hljs-variable">@Schema</span>(description = <span class="hljs-string">"密码"</span>, example = <span class="hljs-string">"123456"</span>)
    private String password;

}
</code></pre>
<h4 data-id="heading-7">2. 创建登录控制器</h4>
<p>在 <code>com.example.firstspringbootproject.controller</code> 包下创建 <code>AuthController</code>，实现登录接口：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.firstspringbootproject</span><span class="hljs-selector-class">.controller</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.firstspringbootproject</span><span class="hljs-selector-class">.dto</span><span class="hljs-selector-class">.LoginRequestDTO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.firstspringbootproject</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.Result</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.firstspringbootproject</span><span class="hljs-selector-class">.utils</span><span class="hljs-selector-class">.JwtUtil</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Operation</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.tags</span><span class="hljs-selector-class">.Tag</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">jakarta</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.Valid</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.authentication</span><span class="hljs-selector-class">.AuthenticationManager</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.authentication</span><span class="hljs-selector-class">.UsernamePasswordAuthenticationToken</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.Authentication</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.userdetails</span><span class="hljs-selector-class">.UserDetails</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.PostMapping</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.RequestBody</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.RequestMapping</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.RestController</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.HashMap</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.Map</span>;

@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api"</span>)
@<span class="hljs-selector-tag">Tag</span>(name = <span class="hljs-string">"认证接口"</span>, description = <span class="hljs-string">"登录、Token 相关接口"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">AuthController</span> {

    <span class="hljs-variable">@Autowired</span>
    private AuthenticationManager authenticationManager; <span class="hljs-comment">// Spring Security 认证管理器</span>

    <span class="hljs-variable">@Autowired</span>
    private JwtUtil jwtUtil; <span class="hljs-comment">// 自定义 JWT 工具类</span>

    <span class="hljs-comment">/**
     * 登录接口：接收账号密码，验证通过后返回 JWT Token
     */</span>

    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/login"</span>)
    <span class="hljs-variable">@Operation</span>(summary = <span class="hljs-string">"用户登录"</span>, description = <span class="hljs-string">"提交用户名和密码，获取 JWT Token"</span>)
    public Result&lt;Map&lt;String, String&gt;&gt; <span class="hljs-built_in">login</span>(<span class="hljs-variable">@Valid</span> <span class="hljs-variable">@RequestBody</span> LoginRequestDTO loginRequest) {

        <span class="hljs-comment">// 1. 调用 Spring Security 认证管理器，验证账号密码</span>
        <span class="hljs-selector-tag">Authentication</span> <span class="hljs-selector-tag">authentication</span> = <span class="hljs-selector-tag">authenticationManager</span><span class="hljs-selector-class">.authenticate</span>(
                new <span class="hljs-built_in">UsernamePasswordAuthenticationToken</span>(
                        loginRequest.<span class="hljs-built_in">getUsername</span>(),
                        loginRequest.<span class="hljs-built_in">getPassword</span>()
                )
        );

        <span class="hljs-comment">// 2. 认证通过：从认证结果中获取用户信息</span>
        <span class="hljs-selector-tag">UserDetails</span> <span class="hljs-selector-tag">userDetails</span> = (UserDetails) <span class="hljs-selector-tag">authentication</span><span class="hljs-selector-class">.getPrincipal</span>();

        <span class="hljs-comment">// 3. 生成 JWT Token</span>
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">token</span> = <span class="hljs-selector-tag">jwtUtil</span><span class="hljs-selector-class">.generateToken</span>(userDetails);

        <span class="hljs-comment">// 4. 构建返回结果（包含 Token 和过期提示）</span>
        <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">String</span>&gt; <span class="hljs-selector-tag">resultMap</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">HashMap</span>&lt;&gt;();
        <span class="hljs-selector-tag">resultMap</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"token"</span>, token);
        <span class="hljs-selector-tag">resultMap</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"expiration"</span>, <span class="hljs-string">"Token 有效期 2 小时，请及时刷新"</span>);
        <span class="hljs-selector-tag">resultMap</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"role"</span>, jwtUtil.<span class="hljs-built_in">getRoleFromToken</span>(token)); <span class="hljs-comment">// 返回用户角色，方便前端处理</span>

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(resultMap);
    }

}
</code></pre>
<h3 data-id="heading-8">六、第四步：实现 JWT 认证过滤器（核心拦截逻辑）</h3>
<p>客户端登录成功后，后续请求会在 <code>Authorization</code> 头中携带 Token（格式：<code>Bearer eyJhbGciOiJIUzI1NiJ9...</code>）。我们需要自定义一个 <strong>过滤器</strong>，在请求到达接口前拦截 Token，完成以下操作：</p>
<ol>
<li>从请求头中提取 Token；</li>
<li>验证 Token 有效性；</li>
<li>从 Token 中解析用户信息和角色；</li>
<li>将用户信息存入 Spring Security 上下文，让后续权限校验生效。</li>
</ol>
<p>在 <code>com.example.firstspringbootproject.filter</code> 包下创建 <code>JwtAuthenticationFilter</code> 类：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.firstspringbootproject.filter;

<span class="hljs-keyword">import</span> com.example.firstspringbootproject.utils.<span class="hljs-type">JwtUtil</span>;
<span class="hljs-keyword">import</span> jakarta.servlet.<span class="hljs-type">FilterChain</span>;
<span class="hljs-keyword">import</span> jakarta.servlet.<span class="hljs-type">ServletException</span>;
<span class="hljs-keyword">import</span> jakarta.servlet.http.<span class="hljs-type">HttpServletRequest</span>;
<span class="hljs-keyword">import</span> jakarta.servlet.http.<span class="hljs-type">HttpServletResponse</span>;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.<span class="hljs-type">Autowired</span>;
<span class="hljs-keyword">import</span> org.springframework.security.authentication.<span class="hljs-type">UsernamePasswordAuthenticationToken</span>;
<span class="hljs-keyword">import</span> org.springframework.security.core.context.<span class="hljs-type">SecurityContextHolder</span>;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.<span class="hljs-type">UserDetails</span>;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.<span class="hljs-type">UserDetailsService</span>;
<span class="hljs-keyword">import</span> org.springframework.security.web.authentication.<span class="hljs-type">WebAuthenticationDetailsSource</span>;
<span class="hljs-keyword">import</span> org.springframework.stereotype.<span class="hljs-type">Component</span>;
<span class="hljs-keyword">import</span> org.springframework.web.filter.<span class="hljs-type">OncePerRequestFilter</span>;

<span class="hljs-keyword">import</span> java.io.<span class="hljs-type">IOException</span>;

<span class="hljs-comment">// 自定义 JWT 认证过滤器：每次请求都会执行（OncePerRequestFilter 确保一次请求只执行一次）</span>
<span class="hljs-meta">@Component</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtAuthenticationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OncePerRequestFilter</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">JwtUtil</span> jwtUtil;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">UserDetailsService</span> userDetailsService; <span class="hljs-comment">// 之前实现的用户查询服务</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void doFilterInternal(<span class="hljs-type">HttpServletRequest</span> request,
                                    <span class="hljs-type">HttpServletResponse</span> response,
                                    <span class="hljs-type">FilterChain</span> filterChain
    ) <span class="hljs-keyword">throws</span> <span class="hljs-type">ServletException</span>, <span class="hljs-type">IOException</span> {

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 从请求头中提取 Token</span>
            <span class="hljs-type">String</span> token = jwtUtil.extractTokenFromHeader(
                    request.getHeader(jwtUtil.getTokenHeader())
            );

            <span class="hljs-comment">// 2. 验证 Token：非空 + 有效</span>
            <span class="hljs-keyword">if</span> (token != <span class="hljs-literal">null</span>) {

                <span class="hljs-comment">// 2.1 从 Token 中获取用户名</span>
                <span class="hljs-type">String</span> username = jwtUtil.getUsernameFromToken(token);

                <span class="hljs-comment">// 2.2 若用户名存在，且 Spring Security 上下文未存储用户信息（未登录）</span>
                <span class="hljs-keyword">if</span> (username != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-type">SecurityContextHolder</span>.getContext().getAuthentication() == <span class="hljs-literal">null</span>) {

                    <span class="hljs-comment">// 2.3 从数据库查询用户完整信息（UserDetails）</span>
                    <span class="hljs-type">UserDetails</span> userDetails = userDetailsService.loadUserByUsername(username);

                    <span class="hljs-comment">// 2.4 验证 Token 有效性（未过期 + 用户名匹配）</span>
                    <span class="hljs-keyword">if</span> (jwtUtil.validateToken(token, userDetails)) {

                        <span class="hljs-comment">// 3. 构建认证对象，存入 Spring Security 上下文</span>
                        <span class="hljs-type">UsernamePasswordAuthenticationToken</span> authentication =
                                <span class="hljs-keyword">new</span> <span class="hljs-type">UsernamePasswordAuthenticationToken</span>(
                                        userDetails, <span class="hljs-comment">// 用户信息</span>
                                        <span class="hljs-literal">null</span>, <span class="hljs-comment">// 密码（已验证，无需存储）</span>
                                        userDetails.getAuthorities() <span class="hljs-comment">// 用户权限（角色）</span>
                                );

                        <span class="hljs-comment">// 设置请求详情（如 IP、会话 ID）</span>
                        authentication.setDetails(
                                <span class="hljs-keyword">new</span> <span class="hljs-type">WebAuthenticationDetailsSource</span>().buildDetails(request)
                        );

                        <span class="hljs-comment">// 将认证对象存入上下文：后续接口权限校验会从这里获取用户信息</span>
                        <span class="hljs-type">SecurityContextHolder</span>.getContext().setAuthentication(authentication);
                    }
                }
            }
        } <span class="hljs-keyword">catch</span> (<span class="hljs-type">Exception</span> e) {

            <span class="hljs-comment">// Token 验证失败（如过期、篡改），打印日志但不阻断请求（后续会返回 401）</span>
            logger.error(<span class="hljs-string">"JWT Token 验证失败："</span> + e.getMessage());

        }

        <span class="hljs-comment">// 4. 继续执行过滤器链（让请求到达后续接口或过滤器）</span>
        filterChain.doFilter(request, response);
    }

}
</code></pre>
<h3 data-id="heading-9">七、第五步：重构 SecurityConfig（适配 JWT）</h3>
<p>之前的 <code>SecurityConfig</code> 基于 HTTP Basic 登录，现在需要修改为 <strong>JWT 无状态登录</strong>，核心调整点：</p>
<ol>
<li>关闭 Session（无状态登录不需要 Session）；</li>
<li>放行登录接口（<code>/api/login</code>）；</li>
<li>将 JWT 过滤器加入过滤器链；</li>
<li>移除 HTTP Basic 配置，保留统一异常处理。</li>
</ol>
<p>修改 <code>com.example.firstspringbootproject.config.SecurityConfig</code> 类：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.firstspringbootproject.config;

<span class="hljs-keyword">import</span> com.example.firstspringbootproject.common.Result;
<span class="hljs-keyword">import</span> com.example.firstspringbootproject.entity.SysUser;
<span class="hljs-keyword">import</span> com.example.firstspringbootproject.filter.JwtAuthenticationFilter;
<span class="hljs-keyword">import</span> com.example.firstspringbootproject.mapper.SysUserMapper;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.security.authentication.AuthenticationManager;
<span class="hljs-keyword">import</span> org.springframework.security.authentication.dao.DaoAuthenticationProvider;
<span class="hljs-keyword">import</span> org.springframework.security.config.<span class="hljs-keyword">annotation</span>.authentication.configuration.AuthenticationConfiguration;
<span class="hljs-keyword">import</span> org.springframework.security.config.<span class="hljs-keyword">annotation</span>.method.configuration.EnableMethodSecurity;
<span class="hljs-keyword">import</span> org.springframework.security.config.<span class="hljs-keyword">annotation</span>.web.builders.HttpSecurity;
<span class="hljs-keyword">import</span> org.springframework.security.config.<span class="hljs-keyword">annotation</span>.web.configuration.EnableWebSecurity;
<span class="hljs-keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;
<span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
<span class="hljs-keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;
<span class="hljs-keyword">import</span> org.springframework.security.web.SecurityFilterChain;
<span class="hljs-keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-meta">@EnableMethodSecurity</span> <span class="hljs-comment">// 启用方法级权限控制（如 @PreAuthorize("hasRole('ADMIN')")）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConfig</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SysUserMapper sysUserMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ObjectMapper objectMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JwtAuthenticationFilter jwtAuthenticationFilter; <span class="hljs-comment">// 自定义 JWT 过滤器</span>

    <span class="hljs-comment">// 1. 密码编码器（不变）</span>

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PasswordEncoder passwordEncoder() {
        <span class="hljs-keyword">return</span> new BCryptPasswordEncoder();

    }

    <span class="hljs-comment">// 2. 用户详情服务（不变）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserDetailsService userDetailsService() {
        <span class="hljs-keyword">return</span> username -&gt; {

            SysUser sysUser = sysUserMapper.findByUsername(username);

            <span class="hljs-keyword">if</span> (sysUser == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> new UsernameNotFoundException(<span class="hljs-string">"用户不存在: "</span> + username);
            }
            <span class="hljs-keyword">return</span> sysUser;

        };

    }

    <span class="hljs-comment">// 3. 认证提供者（不变）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DaoAuthenticationProvider authenticationProvider() {

        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();
        provider.setUserDetailsService(userDetailsService());
        provider.setPasswordEncoder(passwordEncoder());
        <span class="hljs-keyword">return</span> provider;
    }

    <span class="hljs-comment">// 4. 认证管理器（不变）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> AuthenticationManager authenticationManager(AuthenticationConfiguration config) throws Exception {
        <span class="hljs-keyword">return</span> config.getAuthenticationManager();
    }

    <span class="hljs-comment">// 5. 核心规则配置（重点修改：适配 JWT）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        http
                <span class="hljs-comment">// 1. 关闭 CSRF（前后端分离必须关）</span>
                .csrf(csrf -&gt; csrf.disable())
                <span class="hljs-comment">// 2. 关闭 Session（无状态登录核心：不创建和使用 Session）</span>
                .sessionManagement(session -&gt; session
                        .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                )
                <span class="hljs-comment">// 3. 配置接口访问规则（调整放行接口）</span>
                .authorizeHttpRequests(auth -&gt; auth
                        <span class="hljs-comment">// ① 放行：接口文档（Knife4j）、登录接口</span>
                        .requestMatchers(<span class="hljs-string">"/doc.html"</span>, <span class="hljs-string">"/webjars/**"</span>, <span class="hljs-string">"/v3/api-docs/**"</span>, <span class="hljs-string">"/api/login"</span>).permitAll()
                        <span class="hljs-comment">// ② 管理员接口：仅 ADMIN 可访问</span>
                        .requestMatchers(<span class="hljs-string">"/api/user/all"</span>).hasRole(<span class="hljs-string">"ADMIN"</span>)
                        <span class="hljs-comment">// ③ 普通用户接口：USER/ADMIN 可访问</span>
                        .requestMatchers(<span class="hljs-string">"/api/user/**"</span>, <span class="hljs-string">"/api/product/**"</span>).hasAnyRole(<span class="hljs-string">"USER"</span>, <span class="hljs-string">"ADMIN"</span>)
                        <span class="hljs-comment">// ④ 其他接口：必须登录（Token 有效）</span>
                        .anyRequest().authenticated()
                )

                <span class="hljs-comment">// 4. 加入 JWT 过滤器：在 UsernamePasswordAuthenticationFilter 之前执行</span>
                <span class="hljs-comment">// （先验证 Token，再执行后续认证逻辑）</span>
                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.<span class="hljs-keyword">class</span>)
                <span class="hljs-comment">// 5. 统一异常处理（不变：未登录返回 401，权限不足返回 403）</span>
                .exceptionHandling(ex -&gt; ex
                        .authenticationEntryPoint((request, response, authException) -&gt; {
                            response.setContentType(<span class="hljs-string">"application/json;charset=UTF-8"</span>);
                            Result&lt;<span class="hljs-built_in">Void</span>&gt; result = Result.error(<span class="hljs-number">401</span>, <span class="hljs-string">"未登录或 Token 已过期，请重新登录"</span>);
                            response.getWriter().write(objectMapper.writeValueAsString(result));
                        })
                        .accessDeniedHandler((request, response, accessDeniedException) -&gt; {
                            response.setContentType(<span class="hljs-string">"application/json;charset=UTF-8"</span>);
                            Result&lt;<span class="hljs-built_in">Void</span>&gt; result = Result.error(<span class="hljs-number">403</span>, <span class="hljs-string">"权限不足，无法访问"</span>);
                            response.getWriter().write(objectMapper.writeValueAsString(result));
                        })
                );

        <span class="hljs-comment">// 关联认证提供者</span>
        http.authenticationProvider(authenticationProvider());
        <span class="hljs-keyword">return</span> http.build();

    }

}
</code></pre>
<h3 data-id="heading-10">八、第六步：测试 JWT 无状态登录流程</h3>
<p>启动项目，用 Apifox 测试完整流程，验证无状态登录和权限控制是否生效：</p>
<h4 data-id="heading-11">1. 测试 1：调用登录接口，获取 Token</h4>
<ul>
<li><strong>请求地址</strong>：<code>http://localhost:8080/api/login</code></li>
<li><strong>请求方法</strong>：POST</li>
<li><strong>请求体（JSON）</strong> ：</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"admin"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"password"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123456"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><strong>响应结果（成功）</strong> ：</li>
</ul>
<pre><code class="hljs language-css" lang="css">{
    "<span class="hljs-selector-tag">code</span>": <span class="hljs-number">200</span>,
    <span class="hljs-string">"msg"</span>: <span class="hljs-string">"success"</span>,
    <span class="hljs-string">"data"</span>: {
        "role": <span class="hljs-string">"ROLE_ADMIN"</span>,
        <span class="hljs-string">"expiration"</span>: <span class="hljs-string">"Token 有效期 2 小时，请及时刷新"</span>,
        <span class="hljs-string">"token"</span>: <span class="hljs-string">"eyJhbGciOiJIUzUxMiJ9.eyJyb2xlcyI6WyJST0xFX0FETUlOIl0sInN1YiI6ImFkbWluIiwiaWF0IjoxNzYzNDgxMDk0LCJleHAiOjE3NjM0ODgyOTR9.hSxBCTlQo5tUai-knfM2Sh4nVmehizOslcHkvG86jdC-U7-EztskPkF0r4G0DcaTMV3eFcJUu4pCewDdnniq2A"</span>
    }
}
</code></pre>
<p>复制返回的 <code>token</code>，后续请求会用到。</p>
<h4 data-id="heading-12">2. 测试 2：携带 Token 访问管理员接口</h4>
<ul>
<li><strong>请求地址</strong>：<code>http://localhost:8080/api/user/all</code>（需 ADMIN 角色）</li>
<li><strong>请求方法</strong>：GET</li>
<li><strong>请求头</strong>：添加 <code>Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJyb2xlcyI6WyJST0xFX0FETUlOIl0sInN1YiI6ImFkbWluIiwiaWF0IjoxNzYzNDgxMDk0LCJleHAiOjE3NjM0ODgyOTR9.hSxBCTlQo5tUai-knfM2Sh4nVmehizOslcHkvG86jdC-U7-EztskPkF0r4G0DcaTMV3eFcJUu4pCewDdnniq2A</code>（注意 <code>Bearer</code> 后有空格）</li>
<li><strong>响应结果（成功）</strong> ：</li>
</ul>
<pre><code class="hljs language-css" lang="css">{
    "<span class="hljs-selector-tag">code</span>": <span class="hljs-number">200</span>,
    <span class="hljs-string">"msg"</span>: <span class="hljs-string">"success"</span>,
    <span class="hljs-string">"data"</span>: [
        {
            "id": <span class="hljs-number">1</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"小明"</span>,
            <span class="hljs-string">"age"</span>: <span class="hljs-number">20</span>,
            <span class="hljs-string">"phone"</span>: <span class="hljs-string">"13800138000"</span>
        },
        {
            "id": <span class="hljs-number">2</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"小红"</span>,
            <span class="hljs-string">"age"</span>: <span class="hljs-number">19</span>,
            <span class="hljs-string">"phone"</span>: <span class="hljs-string">"13900139000"</span>
        },
        {
            "id": <span class="hljs-number">3</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"小李"</span>,
            <span class="hljs-string">"age"</span>: <span class="hljs-number">22</span>,
            <span class="hljs-string">"phone"</span>: <span class="hljs-string">"13700137000"</span>
        }
    ]
}
</code></pre>
<h4 data-id="heading-13">3. 测试 3：普通用户 Token 访问管理员接口（权限不足）</h4>
<ul>
<li>先用 <code>zhangsan</code>（密码 123456）调用登录接口，获取普通用户 Token；</li>
<li>携带普通用户 Token 访问 <code>http://localhost:8080/api/user/all</code>；</li>
<li><strong>响应结果（失败）</strong> ：</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">403</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"msg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"权限不足，无法访问"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-14">4. 测试 4：Token 过期（模拟）</h4>
<ul>
<li>修改 <code>application.yml</code> 中 <code>jwt.expiration</code> 为 <code>1000</code>（1 秒过期）；</li>
<li>重新登录获取 Token，1 秒后携带 Token 访问接口；</li>
<li><strong>响应结果（失败）</strong> ：</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">401</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"msg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"未登录或 Token 已过期，请重新登录"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-15">九、常见问题与优化建议</h3>
<h4 data-id="heading-16">1. 问题：Token 被盗用怎么办？</h4>
<ul>
<li><strong>原因</strong>：JWT Token 一旦生成，在过期前无法主动作废；</li>
<li><strong>解决方案</strong>：</li>
</ul>
<ol>
<li>缩短 Token 过期时间（如 30 分钟），同时实现 <strong>Token 刷新接口</strong>（用旧 Token 换取新 Token，避免频繁登录）；</li>
<li>维护一个 <strong>黑名单</strong>（如 Redis），用户登出或 Token 被盗时，将 Token 加入黑名单，验证时先检查是否在黑名单中。</li>
</ol>
<h4 data-id="heading-17">2. 问题：密钥（secret）泄露怎么办？</h4>
<ul>
<li><strong>原因</strong>：密钥是 JWT 安全的核心，泄露后攻击者可伪造 Token；</li>
<li><strong>解决方案</strong>：</li>
</ul>
<ol>
<li>生产环境中，密钥通过 <strong>环境变量</strong> 或 <strong>配置中心</strong> 注入，不写入代码或配置文件；</li>
<li>使用 <strong>非对称加密算法</strong>（如 RS256），用私钥生成 Token，公钥验证 Token，私钥严格保密。</li>
</ol>
<h4 data-id="heading-18">## 十、总结：JWT 无状态登录的核心价值</h4>
<p>通过本文的改造，我们实现了 Spring Boot + Spring Security + JWT 的无状态登录，核心优势总结如下：</p>
<ol>
<li><strong>分布式友好</strong>：服务器无需存储 Session，多台服务器可直接共用 Token 验证逻辑；</li>
<li><strong>前后端分离适配</strong>：通过请求头携带 Token，无需依赖 Cookie，适配移动端、小程序等多端场景；</li>
<li><strong>安全性提升</strong>：Token 包含过期时间和加密签名，避免身份信息被篡改；</li>
<li><strong>扩展性强</strong>：Token 可自定义存储用户角色、权限等信息，减少数据库查询次数。</li>
</ol>
<p>至此，恭喜你已具备初级程序员开发水平，可以试着投简历找工作啦。</p>
<blockquote>
<p>👉 关注 + 私信 “Web基础源码”，获取本文完整工程！有问题评论区见～</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[光图片就300多M，微信小游戏给再大的分包也难啊！]]></title>    <link>https://juejin.cn/post/7574991051436097546</link>    <guid>https://juejin.cn/post/7574991051436097546</guid>    <pubDate>2025-11-22T00:06:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574991051436097546" data-draft-id="7574269207363076105" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="光图片就300多M，微信小游戏给再大的分包也难啊！"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-22T00:06:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            光图片就300多M，微信小游戏给再大的分包也难啊！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T00:06:53.000Z" title="Sat Nov 22 2025 00:06:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>点击上方亿元程序员+关注和★星标</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbc09c62192e409f94baf3b9690e2e91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=hsvHgWUS2WhB4gFbxgLkekcSRJU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，有小伙伴说他们公司的游戏项目，光图片资源就高达<code>300M</code>，最近正在考虑上架微信小游戏。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2066feb13c464154af9e7fef249691d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=w1Q0r2k0X8puFWZJo7li%2F3zdlSw%3D" alt="" loading="lazy"/></p>
<p><strong>但是</strong>，如此庞大的游戏资源，想通过分包的形式肯定是不行的，只能放到服务器上，通过<code>CDN</code>让玩家下载。</p>
<p><strong>笔者还是很好奇</strong>，什么样的资源如此巨大，通过对小伙伴的<strong>深入了解</strong>。</p>
<p><strong>惊讶发现</strong>，他们的图片资源居然没有压缩！且不说图片是否过于精致、美术手笔是否过于奔放，不压缩实在是太难受了！</p>
<p><strong>言归正传</strong>，本期将带小伙伴们一起来看下，在<code>Cocos</code>游戏开发中，如何省心省力地压缩图片，<code>330M</code>能压缩到多少。</p>
<p><strong>本文源工程可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">图片压缩</h2>
<blockquote>
<p><strong>图片压缩</strong>是一种在尽可能保持图片质量的前提下，减小PNG文件大小的技术。</p>
</blockquote>
<p><strong>游戏开发</strong>中常用的图片压缩工具有<code>TinyPNG</code>、<code>pngquant</code>、<code>Compressor.io</code>等等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5a6b7ca35354e23afc6f21f57db86d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=ELwP%2FxRh6xKWwOPUmaGFyvP3O4Y%3D" alt="" loading="lazy"/></p>
<p><code>pngquant</code>是一款用于PNG图像有损压缩的命令行工具和函数库。</p>
<p><strong>该转换工具</strong>能显著减小文件大小（通常高达<code>70%</code>），同时保持完整的<code>Alpha</code>通道透明度。生成的图像兼容所有主流网页浏览器和操作系统。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c21cf91c016b4c7e9a7c9cb42261c7c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=ABlz4ICbe0zXj3OUW0kIr7zt2aQ%3D" alt="" loading="lazy"/></p>
<p><strong>常用</strong>的参数包括：</p>
<ul>
<li><strong>quality min-max</strong>：质量，使用满足或超过“最大质量”所需的最少颜色数量。若转换后的质量低于“最低质量”要求，图像将不会被保存。</li>
<li><strong>speed N</strong>：速度，从<code>1</code>（暴力）到<code>10</code>（最快）。默认为<code>3</code>。速度<code>10</code>的质量降低<code>5%</code>，但比默认速度快<code>8</code>倍。</li>
</ul>
<h2 data-id="heading-2">图片压缩实例</h2>
<p><strong>下面</strong>一起来看下，在<code>Cocos</code>游戏开发中，如何通过插件集成到项目，使其构建后自动压缩图片。</p>
<h3 data-id="heading-3">1.资源准备</h3>
<p><strong>先准备</strong>一张<code>PNG</code>图片，原图大小<code>0.97M</code>，用来确认压缩是否成功，压缩质量如何。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e53e053964b4012aca555b60a3c960d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=%2FWNMI68F89Ro%2FLMxePQzpqDEiwk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2.创建扩展</h3>
<p><strong>新建</strong>一个项目，通过菜单<code>扩展-&gt;创建扩展</code>打开扩展创建面板。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/981246b0cffe4757a85b779b56633feb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=jFbkGayKUQQqvpuIazBfOv1yees%3D" alt="" loading="lazy"/></p>
<p><strong>我们选择</strong>构建插件，这是官方自定义构建插件的一个简单示例，点击创建扩展，我们直接在上面扩展我们的自动压缩。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05a3c4c89607467686ba1f2f3d48d24b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=rodimWz7EF92karm679PyenHPBE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3.启用扩展</h3>
<p><strong>通过</strong>菜单<code>扩展-&gt;扩展管理器</code>打开扩展管理器，在已安装扩展中找到我们新建的插件，将其改成开启状态。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/465a0f954acc419fb5c198282b834872~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=4JvqFHoiW06xlvOIGG17t9QRWdU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">4.扩展界面</h3>
<p><strong>首先</strong>我们删掉我们不需要的<code>asset-handlers.ts</code>和<code>panel.ts</code>·，在<code>builder.ts</code>中只保留<code>hooks</code>配置。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b1efbecbc664d18a9f5164a8c173820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=eFokhipz4Omu7nkopZZH63zs1jU%3D" alt="" loading="lazy"/></p>
<p><strong>接下来</strong>我们给构建面板加上一组配置，用来控制压缩是否开启、压缩的质量以及压缩的速度：</p>
<p><strong>代码</strong>整理如下：</p>
<ul>
<li><strong>启用复选框</strong>（ui-checkbox）：默认不开启。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3662259cd77a4ba58b25da9e2fdf0278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=0KsWYOcifuW682blzoeFOZwtVFg%3D" alt="" loading="lazy"/></li>
<li><strong>最小质量滑块</strong>（ui-slider）：<code>0-100</code>，默认<code>65</code>，步进<code>1</code>。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86eb29babec341c2a83deafd98433c77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=SUWSw5wM2CTpiqAZtDBLWVSeO30%3D" alt="" loading="lazy"/></li>
<li><strong>最大质量滑块</strong>（ui-slider）：<code>0-100</code>，默认<code>80</code>，步进<code>1</code>。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6f567a3570344e1ae908383059b5f80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=EvCPx6zeWOL2UMEeLQXsINIaTXg%3D" alt="" loading="lazy"/></li>
<li><strong>速度滑块</strong>（ui-slider）：<code>1-10</code>，默认<code>3</code>，步进<code>1</code>。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40b1baddc0ef4c2d84847e13fb0dd4da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=KZ6F53fujTsWRzmHY9S4xJwc3GY%3D" alt="" loading="lazy"/></li>
<li><strong>校验最大质量&gt;=最小质量</strong>:
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb723730b83e4cd7a84873b890ea7320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=f1BieoHQpgvtIFLLqjiYgWdtnm4%3D" alt="" loading="lazy"/></li>
</ul>
<p><strong>最后</strong>通过<code>npm install</code>和<code>npm run build</code>编译即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dc8fd1db82c4707a9a8b876b80fe03c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=wuKxh92xl8wloQ%2F99R2LcW%2F4W5s%3D" alt="" loading="lazy"/></p>
<p><strong>打开</strong>构建面板就可以看到我们添加的内容：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f09648112a8645af92dd1a05205a7887~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=zZxAFXheaVUKmeT1wUWZCYhOwJ4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">5.构建后压缩</h3>
<p><strong>界面</strong>控制添加完之后，我们需要把<code>pngquant压缩</code>植入到构建完成的钩子（<code>onAfterBuild</code>）里，使其构建完成后自动按照配置的参数进行压缩。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/855ca681e05c4463b4aca0a6bfbfedc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=WUtzrK7WPNmOZwztSSElM1LnIG8%3D" alt="" loading="lazy"/></p>
<p><strong>代码</strong>整理如下：</p>
<ul>
<li><strong>检查</strong>是否启用了质量控制：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5e4b32642014e198f3d611eaa356677~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=QWiXh13B10V07Jzxk2HR1xVhlqs%3D" alt="" loading="lazy"/></li>
<li><strong>提前</strong>准备好压缩的工具，这里包括<strong>win</strong>和<strong>mac</strong>的，并且根据系统选择：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/633f808ba8bb4cb182c47ff7ed00b4cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=800zDDbc2V3eFjci%2F1pTqrSdbZ4%3D" alt="" loading="lazy"/></li>
<li><strong>在构建后目录</strong>递归查找所有图片文件：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa08c16bba334bccb449d17ab1f93c80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=8H4rKaQPmA8f8KepGErzJT3LseE%3D" alt="" loading="lazy"/></li>
<li><strong>组装命令开始逐个压缩</strong>：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a00e01a3b1a74589b8745a25a68aa468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=LRuT%2FeTlN9gYqKhyG4wpyopDl%2Fs%3D" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-8">6.测试</h3>
<p><strong>编译</strong>代码后，打开我们的构建面板，开始进行构建，构建完成后可以点开日志查看：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c67114a52ec4d2b8e70d9163662edf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=uCiXLPfM7cDHDq8KA4hwIDS7fx0%3D" alt="" loading="lazy"/></p>
<p><strong>从日志</strong>可以看出<code>原文件大小: 1002.9KB, 压缩后大小: 179.6KB, 压缩了82.1%</code>，提示压缩成功。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78200b21b2de40eebb779eff70784e01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=ZJ0S1bI%2BwKWT4JzwkUo66EdmEVI%3D" alt="" loading="lazy"/></p>
<p><strong>打开</strong>构建好的目录，找到我们的资源，可以看到已经压缩完成：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bb767a138464086a3dcb4f29bdfb039~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=hzeu0zYvUXwFz8kwvcvdO3ewGlI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">图片压缩进阶</h2>
<h3 data-id="heading-10">1.过滤</h3>
<p><strong>通常</strong>游戏中会有一些图片为了避免模糊，例如主界面，会通过配置的或者特殊文件名开头的形式进行过滤，不进行压缩，小伙伴们在面板或者文件配置，然后压缩前过滤即可。</p>
<h3 data-id="heading-11">2.记录</h3>
<p><strong>图片比较多</strong>，每次构建耗时比较长的话，可以把压缩提前到构建之前，并通过<code>MD5</code>记录表示图片已经压缩，直接跳过该文件，避免重复压缩。</p>
<h2 data-id="heading-12">结语</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2641cebd78ea4a40b54ad8cc2ec0f8c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764374812&amp;x-signature=cSNnv8pSVPiBJ8VO3SG48X7m4tA%3D" alt="" loading="lazy"/></p>
<p><strong>通过</strong>压缩，小伙伴的图片资源从<code>330M</code>降到了<code>273M</code>，压缩了<code>18%</code>。感觉剩余资源还是比较大，建议从其他方式进行检查和处理，例如<strong>查找没依赖的资源删除</strong>、<strong>找美术重造</strong>等等。</p>
<p><strong>不知道小伙伴们有没有其他更好的办法呢？</strong></p>
<p>本文<strong>源工程</strong>可通过<strong>私信</strong>发送 <strong>PngExtension</strong> 获取。</p>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐专栏：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3175880857546129410%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3175880857546129410#wechat_redirect" ref="nofollow noopener noreferrer">知识付费专栏</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26mid%3D2247487282%26idx%3D1%26sn%3De3cb8ab6f5c0d5f804d5c29e2e90b9ad%26chksm%3Dc00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54%26token%3D336413522%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NTY2MjIzMg==&amp;mid=2247487282&amp;idx=1&amp;sn=e3cb8ab6f5c0d5f804d5c29e2e90b9ad&amp;chksm=c00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54&amp;token=336413522&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3207702867494305797%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3207702867494305797#wechat_redirect" ref="nofollow noopener noreferrer">100个Cocos实例</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3073771187570999299%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3073771187570999299#wechat_redirect" ref="nofollow noopener noreferrer">8年主程手把手打造Cocos独立游戏开发框架</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3121583619634626562%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3121583619634626562#wechat_redirect" ref="nofollow noopener noreferrer">和8年游戏主程一起学习设计模式</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3Faction%3Dgetalbum%26__biz%3DMzg5NTY2MjIzMg%3D%3D%26scene%3D1%26album_id%3D3038883468588089350%26count%3D3%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;__biz=Mzg5NTY2MjIzMg==&amp;scene=1&amp;album_id=3038883468588089350&amp;count=3#wechat_redirect" ref="nofollow noopener noreferrer">从零开始开发贪吃蛇小游戏到上线系列</a></p>
<p>点击下方灰色按钮+关注。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React性能翻倍！90%开发者忽略的5个Hooks最佳实践]]></title>    <link>https://juejin.cn/post/7575015480198610996</link>    <guid>https://juejin.cn/post/7575015480198610996</guid>    <pubDate>2025-11-22T00:17:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575015480198610996" data-draft-id="7574992086715809807" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React性能翻倍！90%开发者忽略的5个Hooks最佳实践"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-22T00:17:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React性能翻倍！90%开发者忽略的5个Hooks最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-22T00:17:36.000Z" title="Sat Nov 22 2025 00:17:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-22
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>React性能翻倍！90%开发者忽略的5个Hooks最佳实践</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>React Hooks自2019年推出以来，彻底改变了开发者编写React组件的方式。它们提供了更简洁的代码组织和更好的逻辑复用能力。然而，随着Hooks的普及，许多开发者在使用过程中忽略了其性能优化的潜力。事实上，通过遵循一些最佳实践，你可以显著提升React应用的性能，甚至在某些场景下实现性能翻倍的效果。</p>
<p>本文将深入探讨5个被90%开发者忽略的Hooks最佳实践，这些实践不仅能优化渲染性能，还能减少不必要的副作用和内存消耗。无论你是React新手还是资深开发者，这些技巧都将帮助你写出更高效的代码。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. 合理使用<code>useMemo</code>和<code>useCallback</code>：避免不必要的计算和重渲染</h3>
<h4 data-id="heading-4">问题背景</h4>
<p>许多开发者过度依赖<code>useMemo</code>和<code>useCallback</code>，认为它们能“自动”优化性能。然而，滥用这两个Hook反而会增加内存开销（因为需要存储额外的依赖项和缓存值）。关键在于<strong>只在必要时使用它们</strong>。</p>
<h4 data-id="heading-5">最佳实践</h4>
<ul>
<li><strong>何时用<code>useMemo</code></strong>：当计算成本高昂（如大型数组排序、复杂对象推导）且依赖项变化不频繁时。</li>
<li><strong>何时用<code>useCallback</code></strong>：当函数作为子组件的props传递且子组件依赖引用相等性（如<code>React.memo</code>优化的组件）。</li>
<li><strong>反例</strong>：对简单计算或高频更新的值使用这些Hook可能得不偿失。</li>
</ul>
<h4 data-id="heading-6">示例代码</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> expensiveValue = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">computeExpensiveValue</span>(a, b), [a, b]);
<span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">doSomething</span>(a, b), [a, b]);
</code></pre>
<h4 data-id="heading-7">数据支持</h4>
<p>根据React官方文档，<code>useMemo</code>和<code>useCallback</code>的开销约为每次渲染额外0.1ms~0.5ms（取决于环境）。因此，只有当计算成本高于此阈值时才值得使用。</p>
<hr/>
<h3 data-id="heading-8">2. <code>useEffect</code>的依赖数组陷阱：正确处理副作用</h3>
<h4 data-id="heading-9">问题背景</h4>
<p>许多开发者会在依赖数组中遗漏关键变量或盲目包含所有变量，导致无限循环或不必要的副作用执行。</p>
<h4 data-id="heading-10">最佳实践</h4>
<ul>
<li><strong>最小化依赖项</strong>：只包含真正影响副作用的变量。如果某些变量是稳定的（如dispatch函数），可以安全省略。</li>
<li><strong>使用函数式更新</strong>：对于基于前值的状态更新（如计数器），使用回调形式避免依赖当前状态值：
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>); <span class="hljs-comment">// ✅ No dependency on `count`</span>
  }, <span class="hljs-number">1000</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(interval);
}, []);
</code></pre>
</li>
<li><strong>拆分无关逻辑</strong>：将不相关的副作用拆分到多个<code>useEffect</code>中。</li>
</ul>
<hr/>
<h3 data-id="heading-11">3. <code>useReducer</code>:  复杂状态管理的秘密武器</h3>
<h4 data-id="heading-12">问题背景</h4>
<p>当状态逻辑变得复杂时（多个相互关联的状态、嵌套更新），单纯用多个<code>useState</code>会导致代码臃肿且难以维护。</p>
<h4 data-id="heading-13">最佳实践</h4>
<ul>
<li><strong>适用场景</strong>：
<ol>
<li>state之间存在复杂关系（如表单验证）。</li>
<li>state更新逻辑涉及多步操作。</li>
<li>state结构较深（需深层更新）。</li>
</ol>
</li>
<li><strong>优势</strong>：
<ol>
<li><strong>集中化逻辑</strong>：将所有状态变更集中在reducer中。</li>
<li><strong>性能优化</strong>：减少触发多次渲染的风险。</li>
<li><strong>可测试性</strong>：纯函数reducer易于单元测试。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-14">示例代码</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, initialState);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reducer</span>(<span class="hljs-params">state, action</span>) {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'increment'</span>:
      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + action.<span class="hljs-property">payload</span> };
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>();
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-15">4. <code>useRef</code>:  不只是DOM引用的工具</h3>
<h4 data-id="heading-16">Problem Background</h4>
<p>大多数开发者仅用ref来访问DOM元素，却忽略了它在存储可变值时的价值——尤其是在不需要触发重新渲染的场景中。</p>
<h4 data-id="heading-17">Best Practices</h4>
<ol>
<li><strong>跨渲染持久化数据</strong>:</li>
</ol>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> renderCount = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// Won't trigger re-render when changed</span>
</code></pre>
<ol start="2">
<li><strong>存储定时器/订阅ID</strong>:</li>
</ol>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
 timerRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(...);
 <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timerRef.<span class="hljs-property">current</span>);
}, []);
</code></pre>
<ol start="3">
<li><strong>避免闭包陷阱</strong>:</li>
</ol>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> latestValue = <span class="hljs-title function_">useRef</span>(value);
latestValue.<span class="hljs-property">current</span> = value; <span class="hljs-comment">// Always up-to-date in callbacks</span>
</code></pre>
<hr/>
<p>###5．自定义Hook的组合艺术</p>
<p>####Why It Matters<br/>
自定义Hook是React逻辑复用的终极方案──但设计不当会导致性能黑洞或违反Hook规则.</p>
<p>####Golden Rules<br/>
✅以"use"前缀命名(强制ESLint检查)<br/>
✅隔离无关联逻辑到独立Hooks<br/>
✅返回稳定引用:利用memoization保证返回值一致性</p>
<p>Example: Optimized Data Fetching Hook</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useUserData</span>(<span class="hljs-params">userId</span>) {      
 <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);      
 <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);      

 <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {        
    <span class="hljs-keyword">let</span> didCancel = <span class="hljs-literal">false</span>;        

    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/users/<span class="hljs-subst">${userId}</span>`</span>)          
     .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> !didCancel &amp;&amp; <span class="hljs-title function_">setData</span>(res))          
     .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> !didCancel &amp;&amp; <span class="hljs-title function_">setError</span>(err));        

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> { didCancel = <span class="hljs-literal">true</span> };      
 }, [userId]);      

 <span class="hljs-keyword">return</span> { data, error };    
}    
</code></pre>
<hr/>
<h2 data-id="heading-18">Conclusion</h2>
<p>Mastering React Hooks isn't just about knowing their API surface—it's about deeply understanding their performance characteristics and composing them effectively．The five practices we've covered today:</p>
<p>1️⃣ Strategic memoization with <code>useMemo/useCallback</code>
2️⃣ Precise dependency management in <code>useEffect</code>
3️⃣ Leveraging <code>useReducer</code>s for complex state flows
4️⃣ Unlocking the full potential of <code>useRef</code>
5️⃣ Designing high-performance custom Hooks</p>
<p>Adopting these patterns can lead to dramatic performance improvements—sometimes even doubling rendering speeds in heavy component trees．The key is thoughtful application rather than blind adherence．</p>
<p>Remember: Premature optimization is still the root of all evil．Profile first with React DevTools before applying these techniques!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（138） Redis的模块如何开发？]]></title>    <link>https://juejin.cn/post/7575004291833102387</link>    <guid>https://juejin.cn/post/7575004291833102387</guid>    <pubDate>2025-11-21T23:05:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575004291833102387" data-draft-id="7575017581036781606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（138） Redis的模块如何开发？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T23:05:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（138） Redis的模块如何开发？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T23:05:43.000Z" title="Fri Nov 21 2025 23:05:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis 模块开发是一种扩展 Redis 功能的强大方式。通过模块，开发者可以向 Redis 添加新的命令、数据类型、事件处理器等。以下是开发 Redis 模块的详细步骤，包括必要的代码示例。</p>
<h3 data-id="heading-0">1. 包含必要的头文件</h3>
<p>首先，需要包含 Redis 模块 API 的头文件 <code>redismodule.h</code>。该头文件定义了开发模块所需的所有函数和宏。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"redismodule.h"</span></span>
</code></pre>
<h3 data-id="heading-1">2. 实现模块命令</h3>
<p>每个模块命令对应一个处理函数。这些函数需要遵循特定的签名，即返回 <code>int</code> 类型，并接受 <code>RedisModuleCtx *ctx, RedisModuleString **argv, int argc</code> 作为参数。</p>
<p>下面是一个简单的命令处理函数示例，该命令返回 "Hello, World!" 字符串。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">HelloWorldCommand</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> RedisModule_WrongArity(ctx);
    }
    RedisModule_ReplyWithSimpleString(ctx, <span class="hljs-string">"Hello, World!"</span>);
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}
</code></pre>
<h3 data-id="heading-2">3. 模块初始化函数</h3>
<p>模块初始化函数用于注册模块和命令。通过调用 <code>RedisModule_Init</code> 函数初始化模块，并使用 <code>RedisModule_CreateCommand</code> 函数注册命令。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">RedisModule_OnLoad</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (RedisModule_Init(ctx, <span class="hljs-string">"hello"</span>, <span class="hljs-number">1</span>, REDISMODULE_APIVER_1) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">if</span> (RedisModule_CreateCommand(ctx, <span class="hljs-string">"hello.world"</span>, HelloWorldCommand, <span class="hljs-string">"readonly"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}
</code></pre>
<h3 data-id="heading-3">4. 编译模块</h3>
<p>将上述代码保存为 <code>hello.c</code> 文件，并通过以下命令编译为动态库：</p>
<pre><code class="hljs language-sh" lang="sh">gcc -fPIC -shared -o hello.so hello.c -I/path/to/redis/src
</code></pre>
<p>注意：<code>-fPIC</code> 选项用于生成位置无关代码，<code>-shared</code> 选项用于生成共享库，<code>-I</code> 选项指定 Redis 源代码的路径。</p>
<h3 data-id="heading-4">5. 加载和使用模块</h3>
<p>通过 Redis 客户端加载模块：</p>
<pre><code class="hljs language-sh" lang="sh">redis-cli MODULE LOAD ./hello.so
</code></pre>
<p>加载成功后，可以使用新命令 <code>hello.world</code>：</p>
<pre><code class="hljs language-sh" lang="sh">redis&gt; hello.world
<span class="hljs-string">"Hello, World!"</span>
</code></pre>
<h3 data-id="heading-5">复杂模块示例：计数器模块</h3>
<p>接下来，我们实现一个简单的计数器模块，该模块支持两个命令 <code>counter.incr</code> 和 <code>counter.get</code>，分别用于增加计数器和获取当前计数。</p>
<h4 data-id="heading-6">1. 包含头文件</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"redismodule.h"</span></span>
</code></pre>
<h4 data-id="heading-7">2. 定义全局变量</h4>
<p>定义一个全局变量表示计数器的值。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> counter = <span class="hljs-number">0</span>;
</code></pre>
<h4 data-id="heading-8">3. 实现命令处理函数</h4>
<p>实现 <code>counter.incr</code> 和 <code>counter.get</code> 命令的处理函数。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">CounterIncrCommand</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> RedisModule_WrongArity(ctx);
    }
    counter++;
    RedisModule_ReplyWithLongLong(ctx, counter);
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}

<span class="hljs-type">int</span> <span class="hljs-title function_">CounterGetCommand</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> RedisModule_WrongArity(ctx);
    }
    RedisModule_ReplyWithLongLong(ctx, counter);
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}
</code></pre>
<h4 data-id="heading-9">4. 模块初始化函数</h4>
<p>在模块初始化函数中注册 <code>counter.incr</code> 和 <code>counter.get</code> 命令。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">RedisModule_OnLoad</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (RedisModule_Init(ctx, <span class="hljs-string">"counter"</span>, <span class="hljs-number">1</span>, REDISMODULE_APIVER_1) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">if</span> (RedisModule_CreateCommand(ctx, <span class="hljs-string">"counter.incr"</span>, CounterIncrCommand, <span class="hljs-string">"write"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">if</span> (RedisModule_CreateCommand(ctx, <span class="hljs-string">"counter.get"</span>, CounterGetCommand, <span class="hljs-string">"readonly"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}
</code></pre>
<h4 data-id="heading-10">5. 编译和加载模块</h4>
<p>将代码保存为 <code>counter.c</code> 文件，并通过以下命令编译为动态库：</p>
<pre><code class="hljs language-sh" lang="sh">gcc -fPIC -shared -o counter.so counter.c -I/path/to/redis/src
</code></pre>
<p>然后，通过 Redis 客户端加载模块：</p>
<pre><code class="hljs language-sh" lang="sh">redis-cli MODULE LOAD ./counter.so
</code></pre>
<p>加载成功后，可以使用新命令 <code>counter.incr</code> 和 <code>counter.get</code>：</p>
<pre><code class="hljs language-sh" lang="sh">redis&gt; counter.incr
(<span class="hljs-built_in">integer</span>) 1
redis&gt; counter.incr
(<span class="hljs-built_in">integer</span>) 2
redis&gt; counter.get
(<span class="hljs-built_in">integer</span>) 2
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>Redis 模块开发允许开发者通过编写 C 代码动态扩展 Redis 的功能。开发步骤包括包含模块 API 头文件、定义模块上下文、实现命令处理函数、注册命令以及编译和加载模块。通过上述简单示例和复杂示例，展示了如何实现自定义命令，并在 Redis 中加载和使用这些命令。通过这些步骤，开发者可以根据需要扩展 Redis 的功能，为特定应用场景提供更强大的支持。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（139）Redis的Cluster是如何实现的？]]></title>    <link>https://juejin.cn/post/7575004291833118771</link>    <guid>https://juejin.cn/post/7575004291833118771</guid>    <pubDate>2025-11-21T23:06:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575004291833118771" data-draft-id="7574967214129070106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（139）Redis的Cluster是如何实现的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T23:06:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（139）Redis的Cluster是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T23:06:30.000Z" title="Fri Nov 21 2025 23:06:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis Cluster 是 Redis 的一种分布式架构，允许将数据分布到多个节点上以实现数据的自动分片、负载均衡和高可用性。Redis Cluster 通过分片、复制、故障检测和自动故障转移等机制实现这些功能。以下是 Redis Cluster 的详细实现及其关键组件和代码示例。</p>
<h3 data-id="heading-0">核心概念</h3>
<h4 data-id="heading-1">1. 数据分片</h4>
<p>Redis Cluster 将数据键空间分为 16384 个哈希槽（hash slots）。每个键根据其 CRC16 校验和被映射到其中一个哈希槽。</p>
<h4 data-id="heading-2">2. 节点角色</h4>
<p>Redis Cluster 中的节点分为主节点（master）和从节点（slave）。主节点负责处理写请求和数据分片，从节点负责备份主节点的数据并在主节点失效时进行故障转移。</p>
<h4 data-id="heading-3">3. 集群总线</h4>
<p>Redis Cluster 节点之间通过集群总线（Cluster Bus）进行通信，该总线实现了节点间的故障检测、配置更新等功能。</p>
<h4 data-id="heading-4">4. 故障检测和转移</h4>
<p>Redis Cluster 通过投票机制检测节点故障，并在主节点失效时触发自动故障转移。</p>
<h3 data-id="heading-5">数据分片实现</h3>
<p>Redis Cluster 的数据分片通过哈希槽实现。以下是相关的代码示例：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* Redis Cluster hash function */</span>
<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">keyHashSlot</span><span class="hljs-params">(<span class="hljs-type">char</span> *key, <span class="hljs-type">int</span> keylen)</span> {
    <span class="hljs-keyword">return</span> crc16(key, keylen) &amp; <span class="hljs-number">16383</span>;
}
</code></pre>
<h3 data-id="heading-6">节点间通信</h3>
<p>Redis Cluster 节点通过集群总线进行通信。集群总线使用特殊的二进制协议进行消息传递。以下是节点通信的实现：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* Cluster message types */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTERMSG_TYPE_PING 0</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTERMSG_TYPE_PONG 1</span>

<span class="hljs-comment">/* Cluster message structure */</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
    <span class="hljs-type">uint16_t</span> type;     <span class="hljs-comment">/* Message type */</span>
    <span class="hljs-type">uint16_t</span> totlen;   <span class="hljs-comment">/* Total length of the message */</span>
    <span class="hljs-type">char</span> sender[<span class="hljs-number">40</span>];   <span class="hljs-comment">/* Node ID of the sender */</span>
    <span class="hljs-type">char</span> myip[<span class="hljs-number">16</span>];     <span class="hljs-comment">/* Sender IP address */</span>
    <span class="hljs-type">uint16_t</span> port;     <span class="hljs-comment">/* Sender port */</span>
    <span class="hljs-comment">// other fields...</span>
} clusterMsg;

<span class="hljs-comment">/* Function to send a message to a node */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">clusterSendMessage</span><span class="hljs-params">(clusterNode *node, clusterMsg *msg)</span> {
    <span class="hljs-comment">// Serialize the message and send it over the network</span>
}

</code></pre>
<h3 data-id="heading-7">故障检测和转移</h3>
<p>Redis Cluster 通过投票机制实现故障检测和转移。当一个主节点被检测为失效后，集群中的其他主节点会进行投票决定是否进行故障转移。</p>
<h4 data-id="heading-8">故障检测</h4>
<p>每个节点都会定期向其他节点发送 PING 消息，并期待收到 PONG 回复。如果在一定时间内未收到回复，该节点将认为目标节点失效。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* Cluster node structure */</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">int</span> flags;          <span class="hljs-comment">/* Node flags: master, slave, fail, etc. */</span>
    <span class="hljs-type">int</span> ping_sent;      <span class="hljs-comment">/* Last time a ping was sent */</span>
    <span class="hljs-type">int</span> pong_received;  <span class="hljs-comment">/* Last time a pong was received */</span>
    <span class="hljs-comment">// other fields...</span>
} clusterNode;

<span class="hljs-comment">/* Function to check for node failures */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">clusterCron</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-type">mstime_t</span> now = mstime();
    dictIterator *di;
    dictEntry *de;

    di = dictGetSafeIterator(server.cluster-&gt;nodes);
    <span class="hljs-keyword">while</span>((de = dictNext(di)) != <span class="hljs-literal">NULL</span>) {
        clusterNode *node = dictGetVal(de);

        <span class="hljs-keyword">if</span> (node-&gt;flags &amp; CLUSTER_NODE_MYSELF) <span class="hljs-keyword">continue</span>;

        <span class="hljs-keyword">if</span> (now - node-&gt;pong_received &gt; server.cluster_node_timeout) {
            <span class="hljs-comment">// Mark the node as failing</span>
            node-&gt;flags |= CLUSTER_NODE_PFAIL;
        }
    }
    dictReleaseIterator(di);
}
</code></pre>
<h4 data-id="heading-9">故障转移</h4>
<p>当一个主节点失效后，由从节点中的一个进行接管。故障转移的过程包括选择一个新的主节点和更新集群状态。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* Function to trigger failover */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">clusterHandleSlaveFailover</span><span class="hljs-params">(clusterNode *slave)</span> {
    <span class="hljs-comment">// Promote the slave to master</span>
    slave-&gt;flags &amp;= ~CLUSTER_NODE_SLAVE;
    slave-&gt;flags |= CLUSTER_NODE_MASTER;

    <span class="hljs-comment">// Update the cluster state</span>
    clusterUpdateState();
}

<span class="hljs-comment">/* Function to update cluster state */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">clusterUpdateState</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-comment">// Iterate over all nodes and update the state</span>
    dictIterator *di;
    dictEntry *de;

    di = dictGetSafeIterator(server.cluster-&gt;nodes);
    <span class="hljs-keyword">while</span>((de = dictNext(di)) != <span class="hljs-literal">NULL</span>) {
        clusterNode *node = dictGetVal(de);

        <span class="hljs-keyword">if</span> (node-&gt;flags &amp; CLUSTER_NODE_MASTER) {
            <span class="hljs-comment">// Update the master's state</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node-&gt;flags &amp; CLUSTER_NODE_SLAVE) {
            <span class="hljs-comment">// Update the slave's state</span>
        }
    }
    dictReleaseIterator(di);
}
</code></pre>
<h3 data-id="heading-10">整合示例</h3>
<p>以下是一个包含数据分片、通信和故障检测的完整示例：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"crc16.h"</span>  <span class="hljs-comment">// Assume crc16.h provides crc16 function</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"dict.h"</span>   <span class="hljs-comment">// Assume dict.h provides a dictionary implementation</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"mstime.h"</span> <span class="hljs-comment">// Assume mstime.h provides mstime function</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">define</span> CLUSTER_NODE_TIMEOUT 15000  <span class="hljs-comment">// 15 seconds</span></span>

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterNode</span> {</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">40</span>];      <span class="hljs-comment">/* Node ID */</span>
    <span class="hljs-type">int</span> flags;          <span class="hljs-comment">/* Node flags: master, slave, fail, etc. */</span>
    <span class="hljs-type">int</span> ping_sent;      <span class="hljs-comment">/* Last time a ping was sent */</span>
    <span class="hljs-type">int</span> pong_received;  <span class="hljs-comment">/* Last time a pong was received */</span>
    <span class="hljs-type">int</span> port;           <span class="hljs-comment">/* Node port */</span>
} clusterNode;

<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">clusterState</span> {</span>
    dict *nodes;        <span class="hljs-comment">/* All known nodes in the cluster */</span>
} clusterState;

clusterState *server.cluster;

<span class="hljs-comment">/* Function to hash a key to a slot */</span>
<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">keyHashSlot</span><span class="hljs-params">(<span class="hljs-type">char</span> *key, <span class="hljs-type">int</span> keylen)</span> {
    <span class="hljs-keyword">return</span> crc16(key, keylen) &amp; <span class="hljs-number">16383</span>;
}

<span class="hljs-comment">/* Function to send a message to a node */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">clusterSendMessage</span><span class="hljs-params">(clusterNode *node, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg)</span> {
    <span class="hljs-comment">// In a real implementation, this would send the message over a network</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Sending message to node %s: %s\n"</span>, node-&gt;name, msg);
}

<span class="hljs-comment">/* Function to check for node failures */</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">clusterCron</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-type">mstime_t</span> now = mstime();
    dictIterator *di;
    dictEntry *de;

    di = dictGetSafeIterator(server.cluster-&gt;nodes);
    <span class="hljs-keyword">while</span>((de = dictNext(di)) != <span class="hljs-literal">NULL</span>) {
        clusterNode *node = dictGetVal(de);

        <span class="hljs-keyword">if</span> (now - node-&gt;pong_received &gt; CLUSTER_NODE_TIMEOUT) {
            <span class="hljs-comment">// Mark the node as failing</span>
            node-&gt;flags |= <span class="hljs-number">0x01</span>;  <span class="hljs-comment">// Assume 0x01 represents the fail flag</span>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Node %s marked as failing\n"</span>, node-&gt;name);
        }
    }
    dictReleaseIterator(di);
}

<span class="hljs-comment">/* Entry point */</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
    <span class="hljs-comment">// Initialize the cluster state</span>
    server.cluster = <span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(clusterState));
    server.cluster-&gt;nodes = dictCreate();

    <span class="hljs-comment">// Create and add nodes to the cluster</span>
    clusterNode node1 = {<span class="hljs-string">"node1"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, mstime(), <span class="hljs-number">6379</span>};
    clusterNode node2 = {<span class="hljs-string">"node2"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, mstime(), <span class="hljs-number">6379</span>};
    dictAdd(server.cluster-&gt;nodes, node1.name, &amp;node1);
    dictAdd(server.cluster-&gt;nodes, node2.name, &amp;node2);

    <span class="hljs-comment">// Simulate cron job</span>
    clusterCron();

    <span class="hljs-comment">// Simulate sending a message</span>
    clusterSendMessage(&amp;node1, <span class="hljs-string">"PING"</span>);

    <span class="hljs-comment">// Cleanup</span>
    dictRelease(server.cluster-&gt;nodes);
    <span class="hljs-built_in">free</span>(server.cluster);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>Redis Cluster 通过数据分片、节点通信、故障检测和故障转移等机制实现了分布式架构。数据分片基于哈希槽进行，节点间通信通过集群总线实现，故障检测通过定期的 PING/PONG 消息完成，而故障转移则通过投票机制选择新的主节点并更新集群状态。上述代码示例展示了 Redis Cluster 的基本实现原理和关键组件。通过理解这些机制，可以更深入地了解 Redis Cluster 的工作原理，并根据需要进行扩展和优化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain v1 重大更新讲解⚠⚠⚠]]></title>    <link>https://juejin.cn/post/7575050949958746148</link>    <guid>https://juejin.cn/post/7575050949958746148</guid>    <pubDate>2025-11-21T17:44:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575050949958746148" data-draft-id="7575021014032678931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain v1 重大更新讲解⚠⚠⚠"/> <meta itemprop="keywords" content="LangChain,Python,Agent"/> <meta itemprop="datePublished" content="2025-11-21T17:44:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吴佳浩"/> <meta itemprop="url" content="https://juejin.cn/user/2696441245481975"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain v1 重大更新讲解⚠⚠⚠
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2696441245481975/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吴佳浩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T17:44:36.000Z" title="Fri Nov 21 2025 17:44:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">LangChain v1 重大更新讲解</h2>
<blockquote>
<p>为什么没有先发布demo教学而是先发布一个什么重大更新</p>
<p>因为langchain更新了，更新还挺多的所以建议大家还是从新版本开始学习</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2a3016eef8c4ab0933e83e98f1dd875~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC05L2z5rWp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764351876&amp;x-signature=Ni9%2BXYxzHe7feYf8ZfLFx6ldvXM%3D" alt="人工智能的无限可能.png" loading="lazy"/></p>
<p><strong>作者</strong>：吴佳浩</p>
<p><strong>最后更新</strong>：2025-11-22</p>
<p><strong>适用版本</strong>：LangChain v1.0+</p>
<h3 data-id="heading-1">目录</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25B8%2580langchain-v1-%25E4%25B8%25BA%25E4%25BB%2580%25E4%25B9%2588%25E6%2598%25AF%25E4%25B8%2580%25E6%25AC%25A1%25E5%25A4%25A7%25E7%2589%2588%25E6%259C%25AC%25E9%259D%25A9%25E5%2591%25BD" target="_blank" title="https://www.google.com/search?q=%23-%E4%B8%80langchain-v1-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E6%AC%A1%E5%A4%A7%E7%89%88%E6%9C%AC%E9%9D%A9%E5%91%BD" ref="nofollow noopener noreferrer">📌 一、LangChain v1 为什么是一次“大版本革命”？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25BA%258Cv01--v10%25E5%25B7%25AE%25E5%25BC%2582%25E5%25AF%25B9%25E7%2585%25A7%25E8%25A1%25A8%25E6%25A0%25B8%25E5%25BF%2583%25E5%25BF%2585%25E8%25AF%25BB" target="_blank" title="https://www.google.com/search?q=%23-%E4%BA%8Cv01--v10%E5%B7%AE%E5%BC%82%E5%AF%B9%E7%85%A7%E8%A1%A8%E6%A0%B8%E5%BF%83%E5%BF%85%E8%AF%BB" ref="nofollow noopener noreferrer">🚀 二、v0.1 → v1.0：差异对照表（核心必读）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25B8%2589langchain-v1-%25E6%259E%25B6%25E6%259E%2584%25E6%2580%25BB%25E8%25A7%2588" target="_blank" title="https://www.google.com/search?q=%23-%E4%B8%89langchain-v1-%E6%9E%B6%E6%9E%84%E6%80%BB%E8%A7%88" ref="nofollow noopener noreferrer">🧱 三、LangChain v1 架构总览</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%259B%259Bcreate_agent%25E5%2585%25A8%25E6%2596%25B0%25E7%259A%2584-agent-%25E5%2588%259B%25E5%25BB%25BA%25E6%2596%25B9%25E5%25BC%258F" target="_blank" title="https://www.google.com/search?q=%23-%E5%9B%9Bcreate_agent%E5%85%A8%E6%96%B0%E7%9A%84-agent-%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F" ref="nofollow noopener noreferrer">🧰 四、create_agent：全新的 Agent 创建方式</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25BA%2594middleware%25E6%25A0%25B8%25E5%25BF%2583%25E6%2589%25A9%25E5%25B1%2595%25E6%259C%25BA%25E5%2588%25B6%25E6%25B4%258B%25E8%2591%25B1%25E6%25A8%25A1%25E5%259E%258B" target="_blank" title="https://www.google.com/search?q=%23-%E4%BA%94middleware%E6%A0%B8%E5%BF%83%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6%E6%B4%8B%E8%91%B1%E6%A8%A1%E5%9E%8B" ref="nofollow noopener noreferrer">🔧 五、Middleware：核心扩展机制（洋葱模型）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%2585%25ADcontent_blocks%25E8%25B7%25A8%25E6%25A8%25A1%25E5%259E%258B%25E7%25BB%259F%25E4%25B8%2580%25E8%25BE%2593%25E5%2587%25BA" target="_blank" title="https://www.google.com/search?q=%23-%E5%85%ADcontent_blocks%E8%B7%A8%E6%A8%A1%E5%9E%8B%E7%BB%9F%E4%B8%80%E8%BE%93%E5%87%BA" ref="nofollow noopener noreferrer">📦 六、content_blocks：跨模型统一输出</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25B8%2583%25E7%25BB%2593%25E6%259E%2584%25E5%258C%2596%25E8%25BE%2593%25E5%2587%25BAstructured-output" target="_blank" title="https://www.google.com/search?q=%23-%E4%B8%83%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BAstructured-output" ref="nofollow noopener noreferrer">📐 七、结构化输出（Structured Output）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%2585%25AB%25E5%2591%25BD%25E5%2590%258D%25E7%25A9%25BA%25E9%2597%25B4%25E9%2587%258D%25E6%259E%2584--langchain-classic" target="_blank" title="https://www.google.com/search?q=%23-%E5%85%AB%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E9%87%8D%E6%9E%84--langchain-classic" ref="nofollow noopener noreferrer">📚 八、命名空间重构 + langchain-classic</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E4%25B9%259Dv0--v1-%25E8%25BF%2581%25E7%25A7%25BB%25E6%258C%2587%25E5%258D%2597%25E5%25AE%259E%25E6%2588%2598%25E7%2589%2588" target="_blank" title="https://www.google.com/search?q=%23-%E4%B9%9Dv0--v1-%E8%BF%81%E7%A7%BB%E6%8C%87%E5%8D%97%E5%AE%9E%E6%88%98%E7%89%88" ref="nofollow noopener noreferrer">🛠 九、v0 → v1 迁移指南（实战版）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%258D%2581%25E6%258E%25A8%25E8%258D%2590%25E7%259A%2584%25E7%2594%259F%25E4%25BA%25A7%25E7%25BA%25A7%25E9%25A1%25B9%25E7%259B%25AE%25E7%25BB%2593%25E6%259E%2584%25E5%259B%25BE" target="_blank" title="https://www.google.com/search?q=%23-%E5%8D%81%E6%8E%A8%E8%8D%90%E7%9A%84%E7%94%9F%E4%BA%A7%E7%BA%A7%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%9B%BE" ref="nofollow noopener noreferrer">🏗 十、推荐的生产级项目结构图</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%258D%2581%25E4%25B8%2580%25E7%259C%259F%25E5%25AE%259E%25E4%25BC%2581%25E4%25B8%259A%25E7%25BA%25A7%25E6%25A1%2588%25E4%25BE%258B%25E5%25A4%259A%25E6%25AD%25A5%25E9%25AA%25A4%25E4%25BB%25BB%25E5%258A%25A1-agent" target="_blank" title="https://www.google.com/search?q=%23-%E5%8D%81%E4%B8%80%E7%9C%9F%E5%AE%9E%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%A1%88%E4%BE%8B%E5%A4%9A%E6%AD%A5%E9%AA%A4%E4%BB%BB%E5%8A%A1-agent" ref="nofollow noopener noreferrer">🧪 十一、真实企业级案例：多步骤任务 Agent</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%258D%2581%25E4%25BA%258C%25E5%258F%25AF%25E8%25BF%2590%25E8%25A1%258C%25E7%25BB%25BC%25E5%2590%2588%25E7%25A4%25BA%25E4%25BE%258B%25E4%25BB%25A3%25E7%25A0%2581" target="_blank" title="https://www.google.com/search?q=%23-%E5%8D%81%E4%BA%8C%E5%8F%AF%E8%BF%90%E8%A1%8C%E7%BB%BC%E5%90%88%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" ref="nofollow noopener noreferrer">📄 十二、可运行综合示例代码</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3D%2523-%25E5%258D%2581%25E4%25B8%2589%25E6%2580%25BB%25E7%25BB%2593" target="_blank" title="https://www.google.com/search?q=%23-%E5%8D%81%E4%B8%89%E6%80%BB%E7%BB%93" ref="nofollow noopener noreferrer">📍 十三、总结</a></li>
</ul>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3c0946c7f754c509c415ec7c41395e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC05L2z5rWp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764351876&amp;x-signature=%2BwOZ4LEjJgMGSln38CEuIWgLku4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">0. 环境准备</h3>
<p>在开始之前，请确保 Python 版本 <strong>≥ 3.9</strong>，并安装以下核心包：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 v1 核心包、经典兼容包和图运行时</span>
pip install -U langchain langchain-classic langgraph

<span class="hljs-comment"># 安装适配的模型提供商包 (以 OpenAI 为例)</span>
pip install -U langchain-openai
</code></pre>
<hr/>
<h3 data-id="heading-3">一、LangChain v1 为什么是一次“大版本革命”？</h3>
<p>LangChain v1 不再仅仅是一个“LLM 调用工具箱”，而是正式转向<strong>构建生产级 Agent 系统的工程框架</strong>。</p>
<p><strong>核心变化包括：</strong></p>
<ol>
<li><strong><code>create_agent</code></strong>：正式成为 Agent 的标准构建方式（底层基于 LangGraph）。</li>
<li><strong>Middleware (中间件)</strong>：允许在任意阶段（模型调用前、工具执行时、输出后）拦截并修改逻辑。</li>
<li><strong><code>content_blocks</code></strong>：所有模型输出（推理/文本/工具调用）统一为标准格式，不再依赖正则解析。</li>
<li><strong>结构化输出</strong>：Pydantic Schema 成为一等公民，极大提升稳定性。</li>
<li><strong>命名空间拆分</strong>：旧 API（如 Chains）全部迁入 <code>langchain-classic</code>，主包只保留 Agent 核心。</li>
</ol>
<hr/>
<h3 data-id="heading-4">二、v0.1 → v1.0：差异对照表（核心必读）</h3>
<p>这是理解 v1 最重要的一张表，展示了从“脚本思维”到“工程思维”的转变。</p>

































































<table><thead><tr><th><strong>项目</strong></th><th><strong>LangChain v0.x (旧版)</strong></th><th><strong>LangChain v1.0 (新版)</strong></th><th><strong>核心差异</strong></th></tr></thead><tbody><tr><td><strong>中心思想</strong></td><td>Chains (链式调用)</td><td><strong>Agents (智能体)</strong></td><td>从线性执行转向循环图执行 (Graph)</td></tr><tr><td><strong>构建入口</strong></td><td><code>initialize_agent</code></td><td><strong><code>create_agent</code></strong></td><td>统一的新标准接口</td></tr><tr><td><strong>底层引擎</strong></td><td><code>AgentExecutor</code> (硬编码循环)</td><td><strong>LangGraph</strong></td><td>支持持久化、流式、分支、循环的图运行时</td></tr><tr><td><strong>流式能力</strong></td><td>部分支持 (Token级)</td><td><strong>全链路流式</strong></td><td>支持 Token、中间步骤、推理过程的实时流</td></tr><tr><td><strong>扩展机制</strong></td><td>无 (需修改源码或Prompt)</td><td><strong>Middleware</strong></td><td>完整的生命周期钩子 (Hooks)</td></tr><tr><td><strong>工具定义</strong></td><td><code>Tool</code> + <code>func</code></td><td><code>Tool</code> + <strong>Pydantic Schema</strong></td><td>类型更安全，参数定义更清晰</td></tr><tr><td><strong>结构化输出</strong></td><td>JSON Parser + Regex</td><td><strong>Structured Output</strong></td><td>直接绑定 Pydantic 类，由模型底层保证格式</td></tr><tr><td><strong>输出解析</strong></td><td>纯文本 + 正则匹配</td><td><strong><code>content_blocks</code></strong></td><td>标准化对象 (推理块、文本块、工具块)</td></tr><tr><td><strong>包管理</strong></td><td><code>langchain.*</code></td><td><strong><code>langchain-classic</code></strong></td><td>旧功能移至 classic 包，保持主包轻量</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">三、LangChain v1 架构总览</h3>
<blockquote>
<p><strong>💡 核心提示</strong>：LangChain v1 的底层引擎实际上是 <strong>LangGraph</strong>。<code>create_agent</code> 本质上是为你预构建了一个标准的 LangGraph 图。</p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph AgentRuntime ["LangGraph 运行时"]
        direction TB
        A["用户输入 (Messages)"] --&gt; B[" 模型推理 (LLM)"]
        B --&gt; C{"决策节点"}
        C --&gt;|需要工具| D[" 工具执行 (Tool Execution)"]
        D --&gt; E[" 工具结果反馈"]
        E --&gt; B
        C --&gt;|无需工具/结束| F[" 生成最终回答"]
    end
    
    style A fill:#e1f5fe,stroke:#01579b
    style B fill:#fff9c4,stroke:#fbc02d
    style D fill:#e8f5e9,stroke:#2e7d32
</code></pre>
<hr/>
<h3 data-id="heading-6">四、create_agent：全新的 Agent 创建方式</h3>
<p>为什么废弃 initialize_agent？</p>
<p>因为 v1 统一使用图架构（Graph Architecture）。所有的 Agent 本质上都是：推理 → 工具 → 再推理 的循环。create_agent 是这个标准循环的工厂函数。</p>
<p><strong>基本用法：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

<span class="hljs-comment"># 1. 定义模型</span>
model = ChatOpenAI(model=<span class="hljs-string">"gpt-4o"</span>)

<span class="hljs-comment"># 2. 创建 Agent</span>
agent = create_agent(
    model=model,
    tools=[search_tool, calculator_tool],
    system_prompt=<span class="hljs-string">"你是一个乐于助人的金融分析师。"</span>
)

<span class="hljs-comment"># 3. 运行 (Invoke)</span>
result = agent.invoke({<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"分析 AAPL 股价"</span>}]})
</code></pre>
<hr/>
<h3 data-id="heading-7">五、Middleware：核心扩展机制（洋葱模型）</h3>
<p>中间件是 v1 最强大的功能，允许你在 Agent 生命周期的任意节点插入逻辑（如鉴权、日志、路由）。</p>
<p><strong>生命周期时序图：</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User
    participant MW as Middleware (中间件层)
    participant Agent as Agent Runtime
    participant Model as LLM

    User-&gt;&gt;Agent: invoke(input)
    Agent-&gt;&gt;MW: 1. before_agent_start
    MW--&gt;&gt;Agent: (清洗后的输入)

    loop 思考与执行循环
        Agent-&gt;&gt;MW: 2. before_model
        Note right of MW: 动态修改 Prompt / 路由模型
        
        rect rgb(240,240,240)
            MW-&gt;&gt;Model: 3. wrap_model_call
            Model--&gt;&gt;MW: 返回原始结果
        end
        
        MW--&gt;&gt;Agent: 4. after_model (校验输出)

        opt 工具调用
            Agent-&gt;&gt;MW: 5. wrap_tool_call
            Note right of MW: 敏感操作审批 / 审计
            MW--&gt;&gt;Agent: 工具结果
        end
    end

    Agent-&gt;&gt;MW: 6. after_agent
    MW--&gt;&gt;User: 最终响应
</code></pre>
<hr/>
<h3 data-id="heading-8">六、content_blocks：跨模型统一输出</h3>
<p>解决“不同模型返回格式不同”的痛点。</p>
<p>模型输出现在包含统一的 .content_blocks 属性：</p>
<ul>
<li><code>reasoning</code>: 模型的思考过程（如 Chain of Thought）。</li>
<li><code>tool_call</code>: 结构化的工具调用请求。</li>
<li><code>text</code>: 最终回复文本。</li>
</ul>
<hr/>
<h3 data-id="heading-9">七、结构化输出（Structured Output）</h3>
<p>v1 推荐使用 <strong>Pydantic Schema</strong> 来强制模型输出特定格式，而不是在 Prompt 里写“请返回 JSON”。</p>
<p><strong>三种策略：</strong></p>
<ol>
<li><strong>SchemaBasedStructurer</strong> (推荐)：直接传入 Pydantic 类。</li>
<li><strong>ToolStrategy</strong>：利用 Tool Calling 机制输出结构。</li>
<li><strong>ProviderStrategy</strong>：利用模型原生 JSON Mode（如 OpenAI JSON Object）。</li>
</ol>
<hr/>
<h3 data-id="heading-10">八、命名空间重构 + langchain-classic</h3>
<p>为了给 Agent 让路，旧的“链式”组件被移入 <code>classic</code> 包。</p>
<p><strong>迁移对照：</strong></p>

























<table><thead><tr><th><strong>组件</strong></th><th><strong>旧引入方式</strong></th><th><strong>v1 新引入方式</strong></th></tr></thead><tbody><tr><td><strong>Memory</strong></td><td><code>from langchain.memory import ...</code></td><td><code>from langchain_classic.memory import ...</code></td></tr><tr><td><strong>Chains</strong></td><td><code>from langchain.chains import ...</code></td><td><code>from langchain_classic.chains import ...</code></td></tr><tr><td><strong>Retrievers</strong></td><td><code>from langchain.retrievers import ...</code></td><td><code>from langchain_classic.retrievers import ...</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">🛠 九、v0 → v1 迁移指南（实战版）</h3>
<h4 data-id="heading-12">1. ConversationChain → create_agent</h4>
<ul>
<li>
<p>❌ <strong>旧 (v0)</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> ConversationChain
chain = ConversationChain(llm=llm)
chain.run(<span class="hljs-string">"Hi"</span>)
</code></pre>
</li>
<li>
<p>✔ <strong>新 (v1)</strong>：</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-comment"># create_agent 自带记忆管理 (通过 LangGraph checkpoint)</span>
agent = create_agent(model=llm, tools=[])
agent.invoke({<span class="hljs-string">"messages"</span>: [...]})
</code></pre>
</li>
</ul>
<h4 data-id="heading-13">2. LLMChain → model.invoke</h4>
<ul>
<li>
<p>❌ <strong>旧 (v0)</strong>：</p>
<pre><code class="hljs language-python" lang="python">chain = LLMChain(prompt=prompt, llm=llm)
chain.run(variable=<span class="hljs-string">"value"</span>)
</code></pre>
</li>
<li>
<p>✔ <strong>新 (v1)</strong>：</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># 直接使用 LCEL (LangChain Expression Language)</span>
chain = prompt | llm
chain.invoke({<span class="hljs-string">"variable"</span>: <span class="hljs-string">"value"</span>})
</code></pre>
</li>
</ul>
<h4 data-id="heading-14">3. Tool 定义方式</h4>
<ul>
<li>❌ <strong>旧 (v0)</strong>：依赖 <code>func</code> 和文档字符串解析。</li>
<li>✔ <strong>新 (v1)</strong>：强烈建议使用 <code>@tool</code> 装饰器并配合 Pydantic 类型的参数注解，或者使用 <code>create_tool(schema=MySchema)</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-15">十、推荐的生产级项目结构图</h3>
<p>在 v1 时代，推荐采用分层架构来管理 Agent 项目：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
  Root[" my_agent_project/"] --&gt; A[" app/"]
  
  A --&gt; B[" agent.py &lt;br/&gt; (create_agent 组装入口)"]
  
  A --&gt; C["middleware/ &lt;br/&gt; (中间件层)"]
  C --&gt; C1[" auth_middleware.py"]
  C --&gt; C2[" risk_control.py"]
  
  A --&gt; D[" schemas/ &lt;br/&gt; (数据结构)"]
  D --&gt; D1[" user_context.py"]
  D --&gt; D2[" output_schema.py"]
  
  A --&gt; E[" tools/ &lt;br/&gt; (工具集)"]
  E --&gt; E1[" search_tool.py"]
  E --&gt; E2[" db_tool.py"]
  
  A --&gt; F[" main.py &lt;br/&gt; (FastAPI/Streamlit 入口)"]
</code></pre>
<hr/>
<h3 data-id="heading-16">十一、真实企业级案例：多步骤任务 Agent</h3>
<p>场景：自动代码修复 Agent。</p>
<p>流程：写代码 → 运行测试 → 失败则分析日志 → 修复代码 → 循环直至成功。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start(("开始")) --&gt; Gen["生成初版代码"]
    Gen --&gt; Run["🔧 工具: 运行代码/测试"]
    Run --&gt; Check{"测试通过?"}
    
    Check --&gt;|失败| Debug[" LLM: 分析错误日志"]
    Debug --&gt; Gen
    
    Check --&gt;|成功| Output["输出最终代码"]
    Output --&gt; End(("结束"))
</code></pre>
<p><em>这在 v1 中通过 <code>create_agent</code> 天然支持，因为底层 Graph 支持循环，且可以通过中间件记录每次尝试的详细日志。</em></p>
<hr/>
<h3 data-id="heading-17">十二、可运行综合示例代码</h3>
<p>这是一个包含了 <strong>中间件 (Middleware)</strong> 和 <strong>结构化输出</strong> 的完整 v1 示例。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>, <span class="hljs-type">Dict</span>
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field

<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain.agents.middleware <span class="hljs-keyword">import</span> AgentMiddleware, ModelRequest, ModelResponse

<span class="hljs-comment"># 1. 定义工具</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""获取指定城市的天气信息"""</span>
    <span class="hljs-comment"># 模拟 API 返回</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{city}</span> 天气晴朗, 25°C"</span>

<span class="hljs-comment"># 2. 定义结构化输出 Schema</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherReport</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    city: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"城市名称"</span>)
    temperature: <span class="hljs-built_in">float</span> = Field(description=<span class="hljs-string">"温度数值"</span>)
    summary: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"一句话天气总结"</span>)

<span class="hljs-comment"># 3. 定义自定义中间件 (示例：自动添加礼貌用语)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PolitenessMiddleware</span>(<span class="hljs-title class_ inherited__">AgentMiddleware</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrap_model_call</span>(<span class="hljs-params">self, request: ModelRequest, handler</span>) -&gt; ModelResponse:
        <span class="hljs-comment"># 在发送给模型前，修改 System Prompt</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"🕵️ Middleware: 正在注入礼貌指令..."</span>)
        <span class="hljs-keyword">if</span> request.messages:
            last_msg = request.messages[-<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> last_msg.role == <span class="hljs-string">"user"</span>:
                last_msg.content += <span class="hljs-string">" (请用非常礼貌的语气回答)"</span>
        <span class="hljs-keyword">return</span> handler(request)

<span class="hljs-comment"># 4. 构建 Agent</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    agent = create_agent(
        model=ChatOpenAI(model=<span class="hljs-string">"gpt-4o-mini"</span>),
        tools=[get_weather],
        middleware=[PolitenessMiddleware()],
        <span class="hljs-comment"># 强制结构化输出 (v1 特性)</span>
        <span class="hljs-comment"># response_format=ToolStrategy(WeatherReport) # 若需强制结构化可开启此行</span>
    )

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🚀 Agent 启动..."</span>)
    result = <span class="hljs-keyword">await</span> agent.ainvoke({
        <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"帮我查一下北京的天气"</span>}]
    })

    <span class="hljs-comment"># v1 的 result 包含完整的执行状态</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n💬 最终回复:"</span>)
    <span class="hljs-built_in">print</span>(result[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>].content)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<hr/>
<h3 data-id="heading-18">十三、总结</h3>
<p>LangChain v1 标志着我们从 <strong>“玩票性质的 Chain”</strong> 走向了 <strong>“工程化的 Agent”</strong>。</p>
<ul>
<li>如果你需要构建简单的问答机器人，LangChain v1 提供了更统一的接口。</li>
<li>如果你需要构建复杂的、多步推理的、具有自我纠错能力的企业级智能体，LangChain v1 (配合 LangGraph) 是目前 Python 生态中最佳的选择。</li>
</ul>
<p><strong>下一步建议：</strong> 安装 <code>langchain-classic</code> 确保旧代码运行，同时在新模块中开始尝试使用 <code>create_agent</code>。
慎重更新老项目。。。。。。崩了。。。别赖我。。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python与C#：从哲学到细节的全面对比]]></title>    <link>https://juejin.cn/post/7574992086715645967</link>    <guid>https://juejin.cn/post/7574992086715645967</guid>    <pubDate>2025-11-21T15:09:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086715645967" data-draft-id="7574997924930158632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python与C#：从哲学到细节的全面对比"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T15:09:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python与C#：从哲学到细节的全面对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T15:09:54.000Z" title="Fri Nov 21 2025 15:09:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Python和C#都是现代、高级、面向对象的编程语言，拥有庞大的社区和广泛的应用。然而，它们源于不同的生态系统，秉承不同的设计哲学，因此在语法、执行模型和典型应用上存在显著差异。Python以其极简主义和灵活性著称，而C#则以其在强大类型系统和结构化框架下的优雅与一致性闻名。</p>
<p>下面，我们将从整体到细节，系统地剖析这两种语言的差异。</p>
<h4 data-id="heading-0"><strong>一、整体与哲学</strong></h4>
<ol>
<li>
<p><strong>设计哲学与起源</strong></p>
<ul>
<li><strong>Python</strong>： 由Guido van Rossum创建，其核心哲学是**“优美胜于丑陋，明了胜于晦涩，简洁胜于复杂”<strong>。它是一种</strong>解释型、动态类型**的通用语言，强调代码的可读性和开发者的生产力。其“内置电池”的理念通过庞大而全面的标准库得以体现。</li>
<li><strong>C#</strong>： 由微软的Anders Hejlsberg团队开发，作为**.NET框架<strong>的一部分。它是一种</strong>编译型、静态类型<strong>的语言，设计目标是提供一种</strong>类型安全、组件导向**的现代语言，融合了C++的强大和Java的简洁。其哲学强调在强大的框架内提供一致性和优雅的语法。</li>
</ul>
</li>
<li>
<p><strong>执行模型</strong></p>
<ul>
<li><strong>Python</strong>： 代码通常由<strong>解释器</strong>（如CPython）直接执行。源代码被编译成一种中间字节码，然后在Python虚拟机（PVM）中运行。这带来了跨平台性和动态灵活性。</li>
<li><strong>C#</strong>： 代码通过编译器（如Roslyn）编译成一种称为<strong>中间语言</strong>的字节码。IL代码在运行时由**.NET通用语言运行时<strong>进行</strong>即时编译**成本地机器码执行。这种模型平衡了跨平台性能（通过.NET CLR）和执行效率。</li>
</ul>
</li>
<li>
<p><strong>主要应用领域</strong></p>
<ul>
<li><strong>Python</strong>： <strong>数据科学与机器学习、Web后端、自动化脚本、DevOps、科学计算、人工智能、教育</strong>。它在快速原型开发和非性能临界区的领域表现出色。</li>
<li><strong>C#</strong>： <strong>Windows桌面应用、企业级Web后端、游戏开发、移动应用</strong>。它是构建Windows窗体、WPF、ASP.NET MVC应用的首选，同时通过<strong>Unity游戏引擎</strong>在游戏开发领域占据统治地位。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-1"><strong>二、语法与语言特性</strong></h4>
<ol>
<li>
<p><strong>代码块与语法</strong></p>
<ul>
<li><strong>Python</strong>： 使用<strong>强制性缩进</strong>来定义代码块。这强制了代码风格的统一，使其看起来像可执行的伪代码。
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">0</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Positive"</span>)
    do_something()
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Non-positive"</span>)
</code></pre>
</li>
<li><strong>C#</strong>： 使用**花括号<code>{}</code>**来定义代码块，语句以分号<code>;</code>结尾。缩进是为了可读性，对编译器而言不是必须的。
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">0</span>)
{
    Console.WriteLine(<span class="hljs-string">"Positive"</span>);
    DoSomething();
}
<span class="hljs-keyword">else</span>
{
    Console.WriteLine(<span class="hljs-string">"Non-positive"</span>);
}
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>变量与类型系统</strong></p>
<ul>
<li><strong>Python</strong>： <strong>动态类型</strong>。变量是对象的引用，其类型在运行时决定，并且可以改变。
<pre><code class="hljs language-python" lang="python">x = <span class="hljs-number">10</span>        <span class="hljs-comment"># x 是整数</span>
x = <span class="hljs-string">"hello"</span>   <span class="hljs-comment"># 现在 x 是字符串</span>
x = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] <span class="hljs-comment"># 现在 x 是列表</span>
</code></pre>
</li>
<li><strong>C#</strong>： <strong>静态类型</strong>。每个变量必须声明其类型，且类型在编译时检查，不可更改。从C# 3.0开始引入了<code>var</code>关键字，但它仍然是静态类型的（编译器根据初始值推断类型）。
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> x = <span class="hljs-number">10</span>;           <span class="hljs-comment">// x 是整数</span>
<span class="hljs-comment">// x = "hello";       // 编译错误！</span>
<span class="hljs-built_in">string</span> s = <span class="hljs-string">"hello"</span>;   <span class="hljs-comment">// s 是字符串</span>
<span class="hljs-keyword">var</span> list = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">int</span>&gt; { <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> }; <span class="hljs-comment">// 编译器推断list为List&lt;int&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>内存管理</strong></p>
<ul>
<li><strong>Python</strong>： 拥有<strong>自动垃圾回收</strong>和<strong>引用计数</strong>机制。开发者完全不用关心内存的分配与释放，极大地简化了编程。</li>
<li><strong>C#</strong>： 同样拥有<strong>自动垃圾回收</strong>，由CLR的GC管理。然而，C#提供了更丰富的类型来帮助管理资源：
<ul>
<li><strong>值类型</strong>： 如<code>int</code>, <code>struct</code>，通常分配在栈上，效率高。</li>
<li><strong>引用类型</strong>： 如<code>class</code>，分配在托管堆上，由GC回收。</li>
<li>对于非托管资源（如文件句柄、数据库连接），C#提供了<code>IDisposable</code>接口和<code>using</code>语句来确保资源的确定性释放。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>面向对象编程</strong></p>
<ul>
<li><strong>Python</strong>： 支持<strong>多重继承</strong>。所有成员默认都是“公开”的，通过命名约定（单下划线<code>_protected</code>，双下划线<code>__private</code>）来实现封装，但这更多是一种约定，并非语言级别的强制限制。
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):
        self.name = name        <span class="hljs-comment"># 公有</span>
        self._protected_var = <span class="hljs-number">1</span> <span class="hljs-comment"># 保护（约定）</span>
        self.__private_var = <span class="hljs-number">2</span>  <span class="hljs-comment"># 私有（名称修饰）</span>
</code></pre>
</li>
<li><strong>C#</strong>： <strong>不支持类的多重继承</strong>，但支持通过<strong>接口</strong>实现多重继承。拥有严格的语言级访问修饰符：<code>public</code>, <code>private</code>, <code>protected</code>, <code>internal</code>等。
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name;          <span class="hljs-comment">// 公有</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _privateVar;     <span class="hljs-comment">// 私有</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-built_in">int</span> ProtectedVar;  <span class="hljs-comment">// 保护</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyClass</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span>
    {
        Name = name;
    }
}
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>属性 vs 字段</strong></p>
<ul>
<li><strong>Python</strong>： 通常使用普通实例变量（字段）。如果需要封装，可以使用<code>@property</code>装饰器将方法作为属性访问。
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, radius</span>):
        self._radius = radius

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">radius</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self._radius

<span class="hljs-meta">    @radius.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">radius</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-keyword">if</span> value &lt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"Radius cannot be negative"</span>)
        self._radius = value
</code></pre>
</li>
<li><strong>C#</strong>： 明确区分<strong>字段</strong>和<strong>属性</strong>。属性是首选的封装方式，提供了get和set访问器。
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Circle</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">double</span> _radius;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Radius
    {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _radius; }
        <span class="hljs-keyword">set</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> &lt; <span class="hljs-number">0</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"Radius cannot be negative"</span>);
            _radius = <span class="hljs-keyword">value</span>;
        }
    }
}
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 data-id="heading-2"><strong>三、生态系统与工具链</strong></h4>
<ol>
<li>
<p><strong>性能</strong></p>
<ul>
<li><strong>C#</strong>： 性能通常<strong>高于Python</strong>。作为编译型语言，经过JIT编译后生成的本地代码执行效率很高。.NET的GC也经过高度优化。</li>
<li><strong>Python</strong>： 作为解释型语言，性能是其短板。但在科学计算和数据处理领域，其高性能通常通过调用底层由C/Fortran实现的第三方库来弥补。</li>
</ul>
</li>
<li>
<p><strong>标准库与包管理</strong></p>
<ul>
<li><strong>Python</strong>： 标准库非常庞大，覆盖了网络、文件系统、压缩、电子邮件等方方面面。包管理主要通过<strong>pip</strong>和<strong>PyPI</strong>进行。</li>
<li><strong>C#</strong>： 标准库是**.NET Base Class Library**，同样非常强大和一致。包管理主要通过<strong>NuGet</strong>进行。</li>
</ul>
</li>
<li>
<p><strong>开发环境</strong></p>
<ul>
<li><strong>Python</strong>： 开发环境非常灵活，从简单的文本编辑器到强大的IDE都可以。<strong>PyCharm</strong>和<strong>VS Code</strong>是最流行的选择。</li>
<li><strong>C#</strong>： 与开发环境紧密集成。<strong>Visual Studio</strong>是其旗舰级IDE，提供了无与伦比的调试、分析和开发体验。<strong>Visual Studio Code</strong>配合C#扩展也是一个轻量级且强大的选择。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-3"><strong>总结</strong></h4>























































<table><thead><tr><th align="left">特性</th><th align="left">Python</th><th align="left">C#</th></tr></thead><tbody><tr><td align="left"><strong>类型系统</strong></td><td align="left">动态类型</td><td align="left">静态类型</td></tr><tr><td align="left"><strong>执行模型</strong></td><td align="left">解释执行</td><td align="left">编译为IL，由CLR JIT执行</td></tr><tr><td align="left"><strong>语法</strong></td><td align="left">缩进定义块</td><td align="left">花括号<code>{}</code>和分号<code>;</code></td></tr><tr><td align="left"><strong>内存管理</strong></td><td align="left">自动GC+引用计数</td><td align="left">自动GC，支持值类型/引用类型</td></tr><tr><td align="left"><strong>继承</strong></td><td align="left">支持多重继承</td><td align="left">仅支持单继承，可通过接口实现多重</td></tr><tr><td align="left"><strong>封装</strong></td><td align="left">命名约定</td><td align="left">严格的访问修饰符</td></tr><tr><td align="left"><strong>属性</strong></td><td align="left">使用<code>@property</code>装饰器</td><td align="left">语言内置的get/set访问器</td></tr><tr><td align="left"><strong>性能</strong></td><td align="left">较低</td><td align="left">较高</td></tr><tr><td align="left"><strong>主要领域</strong></td><td align="left">数据科学、AI、Web后端、脚本</td><td align="left">企业应用、游戏、Windows桌面应用</td></tr></tbody></table>
<p><strong>结论：</strong></p>
<p>选择Python还是C#，取决于你的项目目标和个人偏好。</p>
<ul>
<li>如果你追求<strong>极致的开发速度、脚本化、以及在数据科学和AI领域的丰富生态</strong>，或者你是一个初学者，<strong>Python</strong>是更合适的选择。</li>
<li>如果你在构建<strong>大型、高性能、结构严谨的企业级应用、Windows桌面程序，或者使用Unity进行游戏开发</strong>，那么<strong>C#</strong> 及其强大的.NET生态系统将是你的利器。</li>
</ul>
<p>两者都是优秀的通用语言，但它们在类型系统、执行模型和核心生态上的根本差异，决定了它们各自最适合的战场。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI编程规模化实践：从1到100的工程化之道]]></title>    <link>https://juejin.cn/post/7574992086715662351</link>    <guid>https://juejin.cn/post/7574992086715662351</guid>    <pubDate>2025-11-21T15:11:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086715662351" data-draft-id="7575015480198447156" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI编程规模化实践：从1到100的工程化之道"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T15:11:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI编程规模化实践：从1到100的工程化之道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T15:11:17.000Z" title="Fri Nov 21 2025 15:11:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">规模化阶段的挑战</h2>
<p>在AI编程工具日益普及的今天，从0到1快速构建原型已不再是难题。然而，当项目进入从1到100的规模化阶段，开发者面临着全新的挑战：如何确保AI生成代码的质量、可维护性和系统架构的连贯性？本文将深入探讨AI在规模化开发阶段的最佳实践，为团队提供切实可行的解决方案。</p>
<h2 data-id="heading-1">核心原则：建立AI辅助开发的基础</h2>
<h3 data-id="heading-2">人类专家的核心地位</h3>
<p>在规模化开发中，AI应明确定位为增强人类专家的工具，而非替代品。正如某国际消费品公司技术负责人所言："我们坚信AI应用于增强人类，其输出总是由人类来做最终的使用决策。"这一原则确保了关键节点的判断力和系统的可靠性。</p>
<h3 data-id="heading-3">清晰的职责边界</h3>
<p>将AI视为高效的初级开发伙伴是更合理的定位。在此模式下，人类工程师负责把控方向、制定架构和关键决策；AI则专注于执行已明确规划好的编码任务。这种分工协作能够显著提升开发效率，同时保证系统设计的合理性。</p>
<h3 data-id="heading-4">治理与合规先行</h3>
<p>规模化开发中，安全护栏和合规性不容妥协。某大型企业采用了包括使用不同的大语言模型进行交叉验证、建立负责任的AI框架等多重措施来减少模型幻觉风险。另一家科技公司的"AI工厂"框架中包含专门监控所有AI应用的组件，内置了确保安全与合规的机制。</p>
<h2 data-id="heading-5">工程实践：规模化开发的具体策略</h2>
<h3 data-id="heading-6">模块化设计与规范制定</h3>
<p>成功的AI规模化开发始于良好的模块化设计。开发者需要将复杂系统拆解为小型、聚焦的模块，并保持清晰的接口定义。这要求在为每个模块编写AI指令时，采用系统化的规范描述方法。</p>
<p>实践证明，RBTRO框架（角色-Role、背景-Background、任务-Task、要求-Requirements、输出-Output）能够有效指导AI生成更符合预期的代码。例如，在设计生产级线程池时，不应简单地说"帮我写个线程池"，而应提供完整的上下文：指定角色为"JDK并发包核心开发者"，背景是"电商系统，峰值QPS 5000"，任务是"设计动态线程池"，具体要求包括"支持动态调参、有监控指标输出"，并明确输出格式为"完整Java类+注释"。</p>
<h3 data-id="heading-7">严格的代码审查机制</h3>
<p>当AI生成的代码大规模融入核心系统时，建立严格的审查流程至关重要。开发者必须牢记，自己始终是代码质量的最终责任人。经验表明，高级开发者之所以能更好地利用AI工具，正是因为他们不会全盘接受AI的输出，而是会持续进行重构、补充边缘案例检查，并强化类型定义和接口设计。</p>
<p>将AI用于辅助审查是另一个有效策略。可以让AI扮演特定角色，如"阿里巴巴Java开发手册编写者"，按照既定规范对其他AI生成的代码进行审查。但这只能作为第一道过滤器，最终的专业判断必须由人类工程师完成。</p>
<h3 data-id="heading-8">平台化工具的统一整合</h3>
<p>当团队规模扩大时，依赖开发者个人使用的AI工具会导致协作效率低下和标准不一。某拉丁美洲电商巨头为其数千名开发者构建了统一的开发平台，该平台整合了语言模型和API，将以自然语言为核心交互方式，并内置了安全防护和路由逻辑。这种平台化 approach 使开发者能更快、更一致地构建高质量AI应用。</p>
<h3 data-id="heading-9">持续迭代与反馈优化</h3>
<p>AI辅助开发不是一次性的设置，而是需要持续优化的过程。对已部署的AI生成代码和组件进行持续监控至关重要。同时，建立定期的反馈机制，如季度调查，了解AI工具在实际使用中为团队节省的时间以及带来的效果变化。在推进AI应用时，重心应从技术炫酷的"概念验证"转向能带来切实效率和业务提升的"价值验证"。</p>
<h2 data-id="heading-10">组织级实施策略</h2>
<h3 data-id="heading-11">人才培养与技能转型</h3>
<p>规模化应用AI编程要求开发团队具备新的技能组合。除了传统的编程能力，还需要培养提示工程、AI输出评估和结果优化等新技能。某知名互联网企业的实践显示，成功的AI开发现场工程师需要具备系统思维、产品思维和快速学习能力，这些素质帮助他们更好地引导AI工具完成复杂任务。</p>
<h3 data-id="heading-12">流程与治理框架</h3>
<p>建立明确的AI使用流程和治理框架是保证规模化成功的制度保障。这包括：代码质量标准、审查流程、安全规范、以及AI使用边界的明确定义。某金融科技公司实施了分层治理模型，根据不同应用场景的风险等级制定相应的AI使用规范，在促进创新的同时有效控制风险。</p>
<h3 data-id="heading-13">度量与持续改进</h3>
<p>建立有效的度量体系是持续改进的基础。团队应该追踪关键指标，如AI生成代码的采用率、缺陷密度、开发效率提升等，并基于这些数据进行定期复盘和流程优化。某软件公司的经验表明，通过系统化地收集和分析AI工具使用数据，他们能够不断优化提示词库和开发流程，实现持续的效率提升。</p>
<h2 data-id="heading-14">结论</h2>
<p>将AI编程成功应用于从1到100的规模化开发，需要从个人技巧上升为团队纪律和组织能力。开发者角色的核心转变是从纯粹的解码者演进为系统的构建师、AI的引导者与质量的守门员。</p>
<p>通过模块化设计、精确的规范、严格的审查、平台化工具和持续的价值验证，团队能够将AI这个"超级助手"的潜力在复杂工程中充分释放。最终，成功的AI规模化实践不仅在于技术的精妙运用，更在于建立人与AI协同工作的新型工程文化，从而稳健地推动项目走向卓越。</p>
<p>在AI技术快速演进的时代，保持学习的心态、批判性的思维和系统化的工程方法，将是应对规模化开发挑战的不二法门。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI编程革命：React + shadcn/ui 将终结前端框架之战]]></title>    <link>https://juejin.cn/post/7574992086715564047</link>    <guid>https://juejin.cn/post/7574992086715564047</guid>    <pubDate>2025-11-21T14:21:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086715564047" data-draft-id="7574992086715547663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI编程革命：React + shadcn/ui 将终结前端框架之战"/> <meta itemprop="keywords" content="前端,人工智能,AI编程"/> <meta itemprop="datePublished" content="2025-11-21T14:21:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强青铜三"/> <meta itemprop="url" content="https://juejin.cn/user/2942757076730455"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI编程革命：React + shadcn/ui 将终结前端框架之战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2942757076730455/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强青铜三
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T14:21:01.000Z" title="Fri Nov 21 2025 14:21:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>大家好，我是<strong>倔强青铜三</strong>。欢迎关注我，<strong>微信公众号：倔强青铜三</strong>。欢迎点赞、收藏、关注，一键三连！！！</p>
<p>在AI编程浪潮席卷开发世界的今天，大语言模型（LLMs）正重塑代码创作的规则。</p>
<p>当开发者们还在争论Vue、Angular或Svelte的优劣时，一个清晰的趋势正浮出水面：React与shadcn/ui的组合，凭借其与LLMs的天然契合，正悄然接管前端战场。</p>
<p>这不是空谈——而是由代码本质和AI行为模式驱动的必然。让我们撕开争论的表象，直面为什么这对组合将在AI时代称霸。</p>
<h2 data-id="heading-1">React：LLMs眼中的“理想框架”</h2>
<p>在AI驱动的编码时代，框架的胜出不再仅靠性能或API设计，而取决于它如何“对话”大模型。</p>
<p>React的架构为此而生。其核心是声明式组件模型：函数组件和JSX语法将UI拆解为纯JavaScript逻辑，结构清晰、无隐藏状态。</p>
<p>这与LLMs的训练方式完美匹配——模型在海量开源代码上训练，而GitHub上React的普及率使其成为LLMs最熟悉的“语言”。</p>
<p>相比之下，Vue的模板语法引入额外抽象层，Angular的依赖注入和装饰器常导致复杂上下文，Svelte的编译时魔法则超出LLMs的实时推理能力。</p>
<p>LLMs生成React代码时，错误率更低、可读性更高，因为函数式组件如同乐高积木，模型能轻松组合、修改，而无需理解深层框架魔法。这不是框架信仰之争，而是AI效率的必然选择。</p>
<h2 data-id="heading-2">shadcn/ui：组件库的“AI-native”革命</h2>
<p>当谈到组件库，传统方案如Material UI或Ant Design在AI时代暴露了致命弱点：它们是“黑盒”。封装过度的组件隐藏实现细节，定制时需破解CSS-in-JS或私有API，让LLMs生成的代码常失效。</p>
<p>shadcn/ui彻底颠覆此模式——它不是运行时库，而是一套可复制粘贴的Tailwind CSS组件，基于Radix UI构建。开发者直接拥有代码，LLMs能像编辑文本一样修改它：调整一个按钮颜色？只需替换Tailwind类名；重构表单布局？模型能精准插入新逻辑。</p>
<p>这种“零抽象”设计，让LLMs避免猜测内部状态，输出更可靠的代码。其他库依赖主题引擎或样式隔离，LLMs却常因不熟悉这些隐式规则而崩溃。</p>
<p>shadcn/ui的透明性，使它成为AI生成界面的终极画布——没有惊喜，只有可控创新。</p>
<h2 data-id="heading-3">为何LLMs是React的“天然盟友”</h2>
<p>大语言模型偏爱React，源于其训练数据的DNA。互联网上，React项目占据主导：无数教程、Stack Overflow讨论和开源仓库，让模型内化了其模式。</p>
<p>JSX混合HTML与JavaScript的语法，结构接近自然语言，LLMs能轻松解析并生成类似片段。函数组件的纯函数特性——输入props，输出UI——符合LLMs对确定性逻辑的偏好。</p>
<p>反观Angular的TypeScript装饰器或Vue黑魔法般的响应式实现，引入更多隐式依赖，模型需额外推理解析，错误风险倍增。</p>
<p>更关键的是，React的生态系统（如React Query或Zustand）鼓励解耦模式，LLMs能独立生成状态管理或数据获取逻辑，而无需全局上下文。</p>
<p>这不是React“更好”，而是LLMs在现有数据分布下，更高效地产出高质量React代码。</p>
<h2 data-id="heading-4">shadcn/ui：LLMs界面生成的“完美接口”</h2>
<p>shadcn/ui的设计哲学，正是为AI协作而生。</p>
<p>其组件由原子Tailwind类驱动——例如<code>bg-blue-500 hover:bg-blue-600</code>——这些类名语义清晰、组合灵活，LLMs能直接映射到设计需求（“一个悬停时变深的按钮”）。模型无需学习库特定的prop命名规则（如Material UI的<code>variant="contained"</code>），而是操作人类可读的CSS原语。</p>
<p>此外，shadcn/ui的按需复制机制，让LLMs生成的代码无外部依赖，避免版本冲突或tree-shaking问题。当开发者要求“添加一个模态框”，LLMs能输出完整、可运行的组件文件，而非调用未知库函数。其他组件库的封装层，在AI眼中如同迷雾；shadcn/ui的透明性，则让模型成为精准的“代码装配工”。</p>
<p>在AI编程的新纪元，技术栈的胜者不是由基准测试决定，而是由人与模型的协作效率定义。</p>
<p>React的组件化哲学与shadcn/ui的无摩擦定制，共同构建了一个LLMs能无缝赋能的开发流。</p>
<p><strong>AI不会取代开发者，但会放大那些选择正确工具的人。</strong></p>
<p>拥抱React与shadcn/ui，不是跟随潮流，而是为未来编写代码——在那里，框架战争已由AI的偏好悄然终结。</p>
<p><strong>你，准备好站在胜利的一方了吗？</strong></p>
<blockquote>
<p>最后感谢阅读！欢迎关注我，微信公众号： <strong>倔强青铜三</strong>。<br/>
<strong>点赞、收藏、关注</strong>，一键三连！！<br/></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 Go-Kratos 与 MCP 的推荐服务实战指南]]></title>    <link>https://juejin.cn/post/7575050949958418468</link>    <guid>https://juejin.cn/post/7575050949958418468</guid>    <pubDate>2025-11-21T14:27:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575050949958418468" data-draft-id="7575021235135430675" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 Go-Kratos 与 MCP 的推荐服务实战指南"/> <meta itemprop="keywords" content="后端,微服务,深度学习"/> <meta itemprop="datePublished" content="2025-11-21T14:27:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 Go-Kratos 与 MCP 的推荐服务实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T14:27:01.000Z" title="Fri Nov 21 2025 14:27:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于 Go-Kratos 与 MCP 的推荐服务实战指南</h2>
<p>在微服务与多模块协同场景下，实现服务间的标准化通信与流程调度是核心挑战。本文聚焦 <code>go-kratos-mcp-demo</code> 项目，讲解如何基于
<code>Go-Kratos</code> 框架与 <code>MCP</code>（模块化协同协议）构建可扩展的推荐服务，涵盖服务契约设计（proto）、模块化流程编排、召回/过滤/排序等关键模块的实现与测试，并展示实战部署与可观测性方案。</p>
<h3 data-id="heading-1">技术基石：Go-Kratos 与 MCP 的协同架构</h3>
<p>项目技术选型围绕 “模块化协同” 核心需求展开，<code>Go-Kratos</code> 与 <code>MCP</code> 构成架构的两大支柱，形成 “框架赋能 + 协议规范” 的协同模式：</p>
<ul>
<li><strong>Go-Kratos：</strong> 作为B站开源的微服务框架，提供了从 API 定义、配置管理到服务治理的全链路支持。项目通过其 <code>transport</code> 层扩展 <code>kratos-transport</code> 实现了 MCP 协议的集成，同时借助 wire 依赖注入工具简化了服务间依赖管理，让模块解耦更彻底。</li>
<li><strong>MCP 协议：</strong> 通过 <code>mcp-go</code> 库实现多模块协同，定义了标准化的工具注册、请求参数与响应格式。在推荐流程中，召回、排序、过滤模块通过 MCP 上下文传递数据，避免了硬编码耦合，使各模块可独立升级与复用。</li>
</ul>
<p>从依赖管理可见，项目通过 <code>github.com/tx7do/kratos-transport/transport/mcp</code> 实现了 Kratos 与 MCP 的无缝对接，同时引入 <code>mcp-go</code> 提供协议核心能力，形成了 "框架 + 协议" 的协同开发模式。</p>
<h3 data-id="heading-2">MCP 服务设计：基于 Kratos 的模块化调度实现</h3>
<h4 data-id="heading-3">1. MCP 服务初始化与工具注册</h4>
<p>在 <code>internal/server/mcp.go</code> 中，项目基于 <code>Kratos</code> 扩展的 <code>mcpServer</code> 构建 <code>MCP</code> 服务，核心是注册 "推荐工具" 并绑定处理逻辑：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMcpServer</span><span class="hljs-params">(_ log.Logger, recommendService *service.RecommendService)</span></span> *mcpServer.Server {
    srv := mcpServer.NewServer(
        mcpServer.WithServerName(<span class="hljs-string">"Recommend MCP Server"</span>),
        mcpServer.WithMCPServeAddress(<span class="hljs-string">":8080"</span>), <span class="hljs-comment">// MCP 服务端口</span>
        <span class="hljs-comment">// 更多配置...</span>
    )
    
    <span class="hljs-comment">// 注册推荐工具，定义输入参数schema</span>
    <span class="hljs-keyword">if</span> err = srv.RegisterHandler(
        mcp.Tool{
            Name:        <span class="hljs-string">"recommend"</span>,
            Description: <span class="hljs-string">"获取个性化推荐结果"</span>,
            InputSchema: mcp.ToolInputSchema{ <span class="hljs-comment">// MCP 标准化输入定义</span>
                Type: <span class="hljs-string">"object"</span>,
                Properties: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
                    <span class="hljs-string">"userFeature"</span>: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{ <span class="hljs-comment">// 用户特征</span>
                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
                        <span class="hljs-string">"properties"</span>: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
                            <span class="hljs-string">"userId"</span>: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>},
                        },
                    },
                    <span class="hljs-string">"triggerItemId"</span>: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{<span class="hljs-string">"type"</span>: <span class="hljs-string">"integer"</span>}, <span class="hljs-comment">// 触发商品ID</span>
                    <span class="hljs-string">"scene"</span>:         <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>},  <span class="hljs-comment">// 推荐场景</span>
                },
                Required: []<span class="hljs-type">string</span>{<span class="hljs-string">"userFeature"</span>},
            },
        },
        recommendService.HandleRecommend, <span class="hljs-comment">// 绑定处理函数</span>
    ); err != <span class="hljs-literal">nil</span> {
        log.Errorf(<span class="hljs-string">"failed to register recommend tool: %v"</span>, err)
    }
    
    <span class="hljs-keyword">return</span> srv
}
</code></pre>
<p>这段代码体现了 MCP 协议的核心思想：通过标准化的工具定义（名称、输入 schema、描述），使调用方无需关心具体实现，只需按协议格式请求即可。而 Kratos 的服务管理能力则确保了 MCP 服务的高可用启动与配置加载。</p>
<h4 data-id="heading-4">2. 多模块协同流程：MCP 上下文驱动的推荐链路</h4>
<p>推荐服务的核心逻辑在 <code>internal/service/recommend.go</code> 中实现，通过 <code>MCP</code> 上下文串联 <strong>召回</strong>、<strong>排序</strong>、<strong>过滤</strong> 三大模块：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// HandleRecommend MCP协议推荐处理入口</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *RecommendService)</span></span> HandleRecommend(ctx context.Context, request mcp.CallToolRequest) (*mcp.CallToolResult, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 解析MCP请求参数为内部上下文</span>
    <span class="hljs-keyword">var</span> actionCtx recommendV1.UserActionContext
    <span class="hljs-keyword">if</span> err := codec.Unmarshal(argsData, &amp;actionCtx); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    <span class="hljs-comment">// 2. 生成请求ID，用于全链路追踪</span>
    requestId := uuid.New().String()
    
    <span class="hljs-comment">// 3. 召回模块：基于用户历史与场景召回候选物品</span>
    recallInput := &amp;recommendV1.RecallInputContext{
        Stage:          recommendV1.ContextStage_CONTEXT_STAGE_RECALL,
        RequestId:      requestId,
        UserFeature:    actionCtx.GetUserFeature(),
        HistoryItemIds: history, <span class="hljs-comment">// 用户历史行为</span>
    }
    recallOutput, err := s.recallService.Recall(ctx, recallInput)
    
    <span class="hljs-comment">// 4. 排序模块：对召回结果打分排序</span>
    rankInput := &amp;recommendV1.RankInputContext{
        Stage:     recommendV1.ContextStage_CONTEXT_STAGE_RANK,
        RequestId: requestId,
        RecallCtx: recallOutput, <span class="hljs-comment">// 传递召回结果</span>
    }
    rankOutput, err := s.rankService.Rank(ctx, rankInput)
    
    <span class="hljs-comment">// 5. 过滤模块：过滤黑名单与已购物品</span>
    filterInput := &amp;recommendV1.FilterInputContext{
        Stage:            recommendV1.ContextStage_CONTEXT_STAGE_FILTER,
        RequestId:        requestId,
        RankCtx:          rankOutput, <span class="hljs-comment">// 传递排序结果</span>
        BlacklistItemIds: s.filterService.rc.GetService().GetFilter().GetBlacklist(),
    }
    finalOutput, err := s.filterService.Filter(ctx, filterInput)
    
    <span class="hljs-comment">// 6. 封装为MCP响应格式</span>
    <span class="hljs-keyword">return</span> &amp;mcp.CallToolResult{
        Content: []mcp.Content{
            mcp.TextContent{Type: <span class="hljs-string">"text"</span>, Text: <span class="hljs-type">string</span>(finalOutputJson)},
        },
    }, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>整个流程中，MCP 协议承担了 "标准化胶水" 的角色：输入参数通过 <code>MCP</code> 定义的 <code>CallToolRequest</code> 传递，各模块通过上下文（<code>RecallInputContext</code>、<code>RankInputContext</code> 等）共享数据，最终结果以 <code>CallToolResult</code> 标准化返回。而 Kratos 的依赖注入（通过 <code>wire</code>）则确保了 <code>recallService</code>、<code>rankService</code> 等模块的灵活注入，实现了解耦。</p>
<h3 data-id="heading-5">服务部署与测试：Kratos 生态工具链的实践</h3>
<p>项目借助 Kratos 生态的工具链实现了标准化的构建与测试流程：</p>
<h4 data-id="heading-6">1. 服务启动</h4>
<p>在 <code>cmd/server/main.go</code> 中，通过 <code>Kratos</code> 的 <code>kratos.New</code> 整合 <code>MCP服务</code> 与 <code>HTTP服务</code>，实现多协议共存：</p>
<pre><code class="hljs language-go" lang="go">app := kratos.New(
    kratos.Name(<span class="hljs-string">"recommend-mcp-server"</span>),
    kratos.Server(
        ms, <span class="hljs-comment">// MCP服务</span>
        hs, <span class="hljs-comment">// HTTP服务</span>
    ),
)
</code></pre>
<h4 data-id="heading-7">2. 测试支持</h4>
<p><code>internal/service/recommend_test.go</code> 中，通过 MCP 客户端模拟请求，验证整个推荐链路：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 初始化MCP客户端</span>
httpTransport, _ := transport.NewStreamableHTTP(<span class="hljs-string">"http://localhost:8080/mcp"</span>)
mcpClient := client.NewClient(httpTransport)

<span class="hljs-comment">// 调用推荐工具</span>
result, _ := mcpClient.CallTool(ctx, mcp.CallToolRequest{
    Params: mcp.CallToolParams{
        Name: <span class="hljs-string">"recommend"</span>,
        Arguments: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{
            <span class="hljs-string">"userFeature"</span>: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}{<span class="hljs-string">"userId"</span>: <span class="hljs-string">"user123"</span>},
            <span class="hljs-string">"triggerItemId"</span>: <span class="hljs-type">int64</span>(<span class="hljs-number">1001</span>),
            <span class="hljs-string">"scene"</span>:         <span class="hljs-string">"homepage"</span>,
        },
    },
})
</code></pre>
<h4 data-id="heading-8">3. 构建脚本</h4>
<p><code>Makefile</code> 整合了 <code>Kratos</code> 推荐的开发流程，支持一键生成 API 代码、启动服务：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成API与OpenAPI文档</span>
make api openapi

<span class="hljs-comment"># 生成依赖注入代码</span>
make wire

<span class="hljs-comment"># 启动服务（同时启动MCP与HTTP服务）</span>
make run
</code></pre>
<h3 data-id="heading-9">总结：Go-Kratos 与 MCP 协同的价值</h3>
<p><code>go-kratos-mcp-demo</code> 项目展示了 <code>Go-Kratos</code> 与 <code>MCP协议</code> 在模块化服务开发中的协同优势，为微服务架构设计提供三大启示：</p>
<ol>
<li><strong>标准化协同：</strong> MCP 协议定义了模块间通信的统一规范，使召回、排序等模块可独立开发、复用与升级。</li>
<li><strong>框架赋能：</strong> Kratos 提供的服务管理、配置加载、依赖注入等能力，降低了 MCP 服务的开发与运维成本。</li>
<li><strong>多协议支持：</strong> 通过 Kratos 的 <code>transport</code> 扩展，项目同时支持 <code>MCP</code> 与 <code>HTTP</code> 协议，满足不同场景的调用需求。</li>
</ol>
<p>对于需要构建模块化、可扩展微服务的场景，这种 "框架 + 协议" 的模式具有重要参考价值，既保证了架构的灵活性，又通过标准化降低系统复杂度，具有较强的实践参考价值。</p>
<h3 data-id="heading-10">项目代码</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-kratos-mcp-demo" target="_blank" title="https://github.com/tx7do/go-kratos-mcp-demo" ref="nofollow noopener noreferrer">go-kratos-mcp-demo Gitee</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-kratos-mcp-demo" target="_blank" title="https://gitee.com/tx7do/go-kratos-mcp-demo" ref="nofollow noopener noreferrer">go-kratos-mcp-demo Github</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谷歌Nano Banana Pro：AI画图迈向专业]]></title>    <link>https://juejin.cn/post/7575004291832873011</link>    <guid>https://juejin.cn/post/7575004291832873011</guid>    <pubDate>2025-11-21T14:33:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575004291832873011" data-draft-id="7575006095389016073" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谷歌Nano Banana Pro：AI画图迈向专业"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-21T14:33:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谷歌Nano Banana Pro：AI画图迈向专业
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T14:33:42.000Z" title="Fri Nov 21 2025 14:33:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年11月21日，谷歌震撼发布新一代图像生成与编辑模型 <strong>Nano Banana Pro</strong>（官方名称：Gemini 3 Pro Image）。这款模型深度融合了刚刚推出的Gemini 3 Pro的强大推理能力，标志着AI图像技术从“能画”到“能用”的质的飞跃，旨在将创意工具推向专业级生产力新高度。</p>
<p>Nano Banana Pro并非简单地提升了画质，其核心优势在于它能真正“理解”用户的创作意图，并结合谷歌搜索的实时知识库，生成基于事实、逻辑准确的视觉内容。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fdawddf-1024x598.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/dawddf-1024x598.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/151dddb7f88847fd9e8d9302d8877d40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764340421&amp;x-signature=s8XUh8HCjdycxg06OyWlkELgbdA%3D" alt="dawddf" loading="lazy"/></a></p>
<p><strong>🚀 核心突破：从“生成”到“理解”的跨越</strong></p>
<ol>
<li>
<p><strong>攻克文本难题：AI图像中的精准文字</strong> 长期以来，AI图像中的文本生成是公认的难点。Nano Banana Pro在此领域实现了里程碑式突破，被誉为在图像中生成<strong>正确且清晰可读文字</strong>的最佳模型，支持多种字体、书法及复杂的排版。更令人惊叹的是，它依托Gemini 3 Pro，能轻松处理多语言文本，甚至能将图像中的文字（如产品包装说明）无缝翻译并替换成其他语言，同时保持原有风格，极大提升了全球化内容制作效率。</p>
</li>
<li>
<p><strong>智能信息可视化：不止图像，更是知识</strong> 这不仅仅是一个画图工具，它具备<strong>实时联网搜索</strong>能力，可抓取网络信息（如食谱、新闻、股价、生物学图谱）并自动生成对应的<strong>信息图、图表或教程</strong>。这意味着Nano Banana Pro能生成基于真实世界的逻辑和信息的视觉内容，使其可直接用于教育、演示和商业分析，从“生成”跃升至“理解”和“实用”。例如，生成一份带有精准数据的“豆蔻茶制作教程”或复杂的“胰岛素-葡萄糖反馈回路”示意图，内容准确到可直接用于教学或演示。</p>
</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-21_22.23.18-1024x603.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-21_22.23.18-1024x603.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca64dc63864e4a0fbb93d75026514bbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764340421&amp;x-signature=foqze6KjcOBLh36A4HmIStClx74%3D" alt="iShot_2025-11-21_22.23.18" loading="lazy"/></a></p>
<p><strong>🎨 极致画质与精准控制</strong></p>
<p>新模型提供了前所未有的“导演级”创意控制。</p>
<ul>
<li><strong>超高分辨率：</strong> 支持最高 <strong>4K</strong> 超高画质输出，细节纤毫毕现，满足专业级需求。</li>
<li><strong>专业级控制：</strong> 用户可获得“导演级”控制权，自由调整相机角度、景深、焦点、光线效果（如昼夜转换）及色彩分级，实现电影工业级调色。</li>
<li><strong>多图像融合与角色一致性：</strong> 它能将最多 <strong>14张图片</strong> 巧妙融合进一个画面，并能保持最多 <strong>5个人物角色</strong> 的身份特征一致性，实现无缝叙事，为系列创作和复杂场景提供了强大支撑。</li>
<li><strong>局部编辑：</strong> 强大的局部编辑功能允许用户对图像特定部分进行精确选择、优化和变换。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Ffdsf-1024x576.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/fdsf-1024x576.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/374d3419de5f4098b0a63269dee14e4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764340421&amp;x-signature=RTQx6cbBMkUSlBsdBDTvzjpMwzo%3D" alt="fdsf" loading="lazy"/></a></p>
<p><strong>💎 背后的强大引擎：Gemini 3 Pro</strong></p>
<p>Nano Banana Pro的卓越能力，核心源于其底层模型 <strong>Gemini 3 Pro</strong> 的强大支撑。Gemini 3 Pro的<strong>推理能力</strong>和<strong>世界知识</strong>，让Nano Banana Pro不仅能生成图片，更能“理解”用户的复杂指令，并基于真实世界的逻辑与信息进行创作，实现从视觉到智能的深度融合。</p>
<p><strong>💼 如何体验Nano Banana Pro？</strong></p>
<ul>
<li><strong>主要平台：</strong> 目前，用户可通过 <strong>Gemini 应用</strong> 的“创建图像”功能率先体验（需选择“思考”模型，即Gemini 3 Pro）。</li>
<li><strong>使用配额：</strong> 免费用户可享有<strong>有限的试用额度</strong>，而订阅 Google AI <strong>Plus、Pro 或 Ultra</strong> 服务的用户将获得更高的使用额度。</li>
<li><strong>产品集成：</strong> Nano Banana Pro 也将逐步集成到 Google Workspace (如Slides和Vids)、NotebookLM、Flow，以及面向开发者的AI Studio和Gemini API等产品中，赋能更广泛的应用场景。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fwegfrg-1024x777.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/wegfrg-1024x777.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b130f7ebdbb496aaef5911cc9223ffd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764340421&amp;x-signature=b8ZPkCnfdPmt39aTqvmjZLrh2Ig%3D" alt="wegfrg" loading="lazy"/></a></p>
<p><strong>🛡️ 安全与透明度</strong></p>
<p>谷歌强调了新模型的安全和透明度措施。所有由Nano Banana Pro生成的图像都将嵌入不可见的 <strong>SynthID 数字水印和 C2PA 元数据</strong>。用户可以在Gemini应用中上传任何图片，直接询问“这是由Google AI生成的吗？”进行验证，确保AI生成内容的可追溯性与识别便利。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fhghfgj-1024x576.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/hghfgj-1024x576.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/445b3e83688044aab68df0a7f5808811~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764340421&amp;x-signature=Q%2FDhuSCrLip0w0AqvTBjPXzGdkI%3D" alt="hghfgj" loading="lazy"/></a></p>
<p>Nano Banana Pro的发布，标志着AI文生图技术从“追求视觉逼真”迈向了“追求事实准确与生产实用”的新阶段。它不再只是一个好玩的工具，而是能够理解意图、结合知识、产出专业级内容的生产力伙伴。这无疑是谷歌在AI图像生成领域的一次重大突破，值得我们深入探索和体验！</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI编程：更适合0到1的创意爆发，还是1到100的精雕细琢？]]></title>    <link>https://juejin.cn/post/7574997924930142248</link>    <guid>https://juejin.cn/post/7574997924930142248</guid>    <pubDate>2025-11-21T15:01:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574997924930142248" data-draft-id="7574997924930125864" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI编程：更适合0到1的创意爆发，还是1到100的精雕细琢？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T15:01:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI编程：更适合0到1的创意爆发，还是1到100的精雕细琢？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T15:01:49.000Z" title="Fri Nov 21 2025 15:01:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>看着YC创业公司里那些由AI生成95%代码的项目，我意识到编程正从精确的工程技术向充满可能性的创意手艺转变。</p>
</blockquote>
<p>一位硅谷工程师仅用三天时间，就通过AI编程工具将Figma设计转化为可运行的Web应用原型。<br/>
而在另一面，某创业团队同样依赖AI工具快速搭建的电商系统，却在处理高并发订单时突然崩溃，修复时间远超手动编码的两倍。</p>
<p>在2025年冬季YC孵化团队中，四分之一的创始人表示其代码库中<strong>超过95%的代码由AI生成</strong>。<br/>
与此同时，企业环境中的开发者们却开始强调建立AI治理框架、黄金路径和严格审查流程。</p>
<hr/>
<h2 data-id="heading-0">01 AI编程的革命：从代码补全到“氛围编程”</h2>
<p>当前AI编程工具已从早期的代码补全，演进到了半自动编程阶段。开发者通过自然语言与AI交互，描述他们想要的功能，AI则负责生成相应的代码实现。</p>
<p>这种被称为“<strong>氛围编程</strong>”（Vibe Coding）的新方法，完全改变了开发者与计算机的互动方式。</p>
<p>用一位开发者的说法：“我不怎么写代码了，我只是思考和审查”。这种模式将开发者从逐行编写代码的负担中解放出来，更像是一个创意总监或乐队指挥，通过自然语言向AI传达更高层次的意图。</p>
<p>AI编程工具市场呈现爆发式增长。Cursor在短短15个月内做到年收入5亿美元，而Google不惜砸下24亿美元抢下Windsurf。</p>
<p>这些工具正在彻底改变我们启动新项目的方式，使想法到可运行原型的转换从几周缩短到几小时或几天。</p>
<h2 data-id="heading-1">02 为什么AI编程在0-1阶段表现卓越？</h2>
<p><strong>AI编程工具显著降低了从想法到原型的转换门槛</strong>。从设计或粗略概念开始，利用AI生成完整的初始代码库，开发者可以在极短时间内做出工作原型，用于快速验证和迭代。</p>
<p>对于资源有限的创业者和独立开发者，这种能力具有革命性意义。个人开发者Pieter Levels独自创建和运营多个盈利颇丰的网站，包括Nomad List和Photo AI，其个人年收入早已超过百万美元。</p>
<p>他广泛使用AI工具来辅助编程、生成内容和处理客户服务，将个人的生产力杠杆化到了极致。</p>
<p>在0-1阶段，<strong>快速试错比完美代码更重要</strong>。一位YC创始人道出了这种转变的本质：“我不再是一名工程师，我成了一个产品人”。</p>
<p>当构建成本持续降低，速度与想象力成为新的门槛。开发者可以同时打开多个AI编程窗口，针对不同的功能进行并行开发，大大加快了创意验证的循环速度。</p>
<p>AI编程还使非技术背景的领域专家能够直接将他们的洞察转化为产品。一位经验丰富的零售业采购经理，可以在一个周末将她对供应链的独特洞察，转化为一个比现有ERP系统更智能的库存管理应用。</p>
<p>这种<strong>民主化开发</strong>正在释放前所未有的创新潜力。</p>
<h2 data-id="heading-2">03 AI编程在1-100阶段面临的挑战</h2>
<p>尽管AI在0-1阶段表现抢眼，但当项目进入1-100的扩展阶段，情况变得复杂起来。这就是所谓的“<strong>70%问题</strong>”——AI可以出奇地快速地完成前70%的工作，但最后的30%却是收益递减的过程。</p>
<p><strong>代码质量与系统稳定性</strong>成为首要问题。初级开发者更容易全盘接受AI的输出，导致出现“纸牌屋代码”——看似完整，但现实压力一推即倒。</p>
<p>在复杂业务场景中，AI生成的代码常存在隐藏的隐患。某创业团队用AI工具三天搭建出电商系统原型，却在处理高并发订单时崩溃——修复这些深层逻辑漏洞耗费的时间，远超手动编码的两倍。</p>
<p><strong>系统架构的连贯性</strong>是另一大挑战。现有的AI编码工具源自代码生成领域，代码隐匿于潜在空间，它们擅长从头开始重写，却难以在已有基础上进行构建。</p>
<p>这种特性使得渐进式改进变得困难，往往导致“进一步退两步”的调试循环。</p>
<p>在任务关键型和受监管的环境中，<strong>治理与合规</strong>成为不可逾越的障碍。REI Systems的实践经验表明，在联邦系统等高度规范的环境中，AI生成代码必须经过与手动编写代码相同的严格审查流程。</p>
<p>没有适当的监督，AI可能会忽视行业监管细则中的关键指标，导致合规风险。</p>
<h2 data-id="heading-3">04 知识悖论：为什么经验丰富的开发者更能从AI中受益？</h2>
<p>观察AI辅助开发几年后，我注意到一个有趣现象：<strong>AI工具对经验丰富的开发者的帮助要大于对初学者的帮助</strong>。这听起来有违直觉——AI难道不是应该让编码大众化吗？</p>
<p>现实是，AI就像团队中有一位很热心的初级开发者。他们能快速编写代码，但需要不断的监督和纠正。<strong>你懂得越多，就越能指导他们</strong>。</p>
<p>高级工程师利用AI来加速他们已经知道怎么去做的事情，而初级员工则尝试用AI来学习该干什么，结果大相径庭。</p>
<p>在REI Systems的实践中，经验丰富的开发者能够通过AI工具生成上下文相关的自定义代码，自动化测试案例生成，并以最少的开发者干预重构遗留代码。</p>
<p>他们不会简单接受AI的建议，而是不断地将生成的代码重构为更小、更聚焦的模块，查缺补漏，添加边缘案例，并强化类型定义和接口。</p>
<p>这种<strong>批判性使用AI的能力</strong>，恰恰是经验带来的宝贵优势。正如一位专家所指出的：“工具再好也是辅助，真想学好编程，基础概念还是得掌握”。</p>
<h2 data-id="heading-4">05 实践指南：如何在两个阶段合理运用AI编程？</h2>
<p>对于0-1阶段的项目，推荐采用“<strong>AI初稿</strong>”模式：让AI生成基本的实现，然后人工审查并模块化重构，添加全面的错误处理，编写彻底的测试，并记录关键决策。</p>
<p>保持紧密的反馈循环，经常提交变更，确保代码库始终处于可用状态。</p>
<p>当项目进入1-100阶段，则需要转向“<strong>信任但要核实</strong>”模式：用AI生成初始代码，但人工审查所有的关键路径，自动测试边缘案例，并定期进行安全审计。</p>
<p>在REI Systems，他们建立了强大的治理框架，确保所有AI生成的代码都经过与手动编写代码相同的严格质量检查、安全漏洞扫描和合规性验证。</p>
<p><strong>模块化设计</strong>是平衡两个阶段需求的关键策略。将所有内容分解为小的、集中的文件，组件之间保持接口清晰，并记录模块边界。</p>
<p>这种做法使得AI可以专注于特定模块的实现，同时降低系统整体复杂度。</p>
<p>最重要的是，保持<strong>持续的技能发展</strong>。最成功的非工程师会用混合模式使用AI编码工具：用AI进行快速原型设计，但花时间了解生成代码的工作原理，除了学习AI的使用方法外，还学习基本的编程概念。</p>
<h2 data-id="heading-5">06 未来展望：AI编程的演进方向</h2>
<p>随着技术演进，我们可能会看到更擅长在现有基础上构建而不仅仅是重写的AI工具。当前的研究重点正在从单纯的代码生成转向理解复杂系统和维护架构连贯性。</p>
<p><strong>多模态能力</strong>将成为下一代AI编程工具的标配。这些工具不仅处理代码，还能集成视觉理解能力（UI截图、模型、图表）、口头语言对话和与环境（浏览器、终端、API）交互。</p>
<p>这种进步将使AI能够像人类一样全面地理解和使用软件。</p>
<p>在企业层面，<strong>AI治理</strong>将变得更加关键。随着AI从自由实验转向企业核心流程，组织需要建立明确的AI治理策略，在创新和风险之间取得平衡。</p>
<p>REI Systems已经走在前列，他们确保所有AI生成的代码都经过严格的审查流程，并维护详细的审计日志，记录系统所做的每一个更改。</p>
<p>最后，我们可能会看到AI编程工具在不同阶段出现更专门化的分工。一些工具可能专注于极速原型设计，而另一些则专注于系统维护和渐进式改进。</p>
<p>这种专业化将使团队能够根据项目阶段选择最合适的工具。</p>
<hr/>
<p>在REI Systems的政府项目实践中，他们发现AI生成的代码必须通过<strong>与手动编写代码相同的严格审查</strong>。这种严谨态度使得他们能在关键任务系统中安全地利用AI的优势。</p>
<p>而那位用AI在三天内搭建电商系统的创业者，在系统崩溃后才发现：<strong>AI能给你速度，但给不了深度</strong>。修复那些深层逻辑漏洞的时间，远超手动编码的两倍。</p>
<p>未来的赢家，将是那些把AI当作“思维杠杆”的人：用工具突破认知边界，在机器效率与人类创造力之间找到平衡点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python与C++：从哲学到细节的全面对比]]></title>    <link>https://juejin.cn/post/7574978847152013352</link>    <guid>https://juejin.cn/post/7574978847152013352</guid>    <pubDate>2025-11-21T15:03:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978847152013352" data-draft-id="7574978847151996968" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python与C++：从哲学到细节的全面对比"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T15:03:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python与C++：从哲学到细节的全面对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T15:03:46.000Z" title="Fri Nov 21 2025 15:03:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Python和C++是两种在当今软件开发领域占据主导地位的语言，但它们的定位、设计哲学和应用场景有着天壤之别。Python以其简洁、直观的语法和“内置电池”的理念，致力于让开发者用更少的代码做更多的事，强调开发效率和可读性。而C++则是由C语言发展而来，以其对硬件底层的控制能力、极高的运行效率和灵活性著称，信奉“零开销抽象”原则，即你不用的东西不需要付出代价，你用的东西则能被最优地实现。</p>
<p>下面，我们将从整体到细节，系统地剖析这两种语言的差异。</p>
<h4 data-id="heading-0"><strong>一、整体与哲学</strong></h4>
<ol>
<li>
<p><strong>设计哲学</strong></p>
<ul>
<li><strong>Python</strong>： 遵循“优美胜于丑陋，明了胜于晦涩，简洁胜于复杂”。它是一种<strong>解释型、高级、动态类型</strong>语言，代码像伪代码一样易于阅读和理解。</li>
<li><strong>C++</strong>： 遵循“信任程序员，不增加额外开销”，并支持多种编程范式（面向过程、面向对象、泛型、函数式）。它是一种<strong>编译型、中级、静态类型</strong>语言，赋予程序员极大的权力，同时也要求承担更多的责任（如内存管理）。</li>
</ul>
</li>
<li>
<p><strong>执行模型</strong></p>
<ul>
<li><strong>Python</strong>： 代码由Python解释器逐行读取、解释并执行。这带来了跨平台的一致性和动态性，但牺牲了原生运行速度。</li>
<li><strong>C++</strong>： 代码必须通过编译器（如GCC, Clang, MSVC）预先编译成与特定平台相关的机器码（二进制可执行文件）。这个过程虽然复杂，但产生了高效的、可直接由CPU执行的程序。</li>
</ul>
</li>
<li>
<p><strong>应用领域</strong></p>
<ul>
<li><strong>Python</strong>： <strong>数据科学、机器学习、Web后端（Django/Flask）、自动化脚本、DevOps、科学计算、教育</strong>。适合快速原型开发和对执行速度要求不高的场景。</li>
<li><strong>C++</strong>： <strong>游戏开发、操作系统、浏览器、数据库、高频交易系统、嵌入式系统、图形图像处理、性能密集型桌面应用</strong>。适合开发底层系统和对性能有极致要求的应用。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-1"><strong>二、语法与语言特性</strong></h4>
<ol>
<li>
<p><strong>代码块与语法</strong></p>
<ul>
<li><strong>Python</strong>： 使用<strong>缩进</strong>来定义代码块（如<code>if</code>, <code>for</code>, 函数和类）。强制性的缩进规则使得代码风格高度统一，极具可读性。
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">0</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Positive"</span>)
    do_something()
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Non-positive"</span>)
</code></pre>
</li>
<li><strong>C++</strong>： 使用**花括号<code>{}</code>**来定义代码块。缩进是出于可读性考虑，对编译器而言是可选的。
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">0</span>) {
    std::cout &lt;&lt; <span class="hljs-string">"Positive"</span> &lt;&lt; std::endl;
    <span class="hljs-built_in">doSomething</span>();
} <span class="hljs-keyword">else</span> {
    std::cout &lt;&lt; <span class="hljs-string">"Non-positive"</span> &lt;&lt; std::endl;
}
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>变量与类型系统</strong></p>
<ul>
<li><strong>Python</strong>： <strong>动态类型</strong>。变量在声明时无需指定类型，其类型在运行时由赋予它的值决定，并且可以改变。
<pre><code class="hljs language-python" lang="python">x = <span class="hljs-number">10</span>        <span class="hljs-comment"># x 是整数</span>
x = <span class="hljs-string">"hello"</span>   <span class="hljs-comment"># 现在 x 是字符串</span>
</code></pre>
</li>
<li><strong>C++</strong>： <strong>静态类型</strong>。每个变量在使用前必须明确定义其类型，且类型在编译时确定，不可更改。
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> x = <span class="hljs-number">10</span>;    <span class="hljs-comment">// x 永远是整数类型</span>
<span class="hljs-comment">// x = "hello"; // 错误：无法将字符串字面值分配给整型变量</span>
std::string s = <span class="hljs-string">"hello"</span>; <span class="hljs-comment">// s 是字符串类型</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>内存管理</strong></p>
<ul>
<li><strong>Python</strong>： 拥有<strong>垃圾回收机制</strong>。开发者无需手动管理内存，解释器会自动回收不再使用的对象所占用的内存。这极大地减少了内存泄漏和悬空指针的风险。</li>
<li><strong>C++</strong>： <strong>手动内存管理</strong>。开发者需要自己使用<code>new</code>/<code>delete</code>或<code>malloc</code>/<code>free</code>来分配和释放堆内存。现代C++推荐使用<strong>智能指针</strong>（<code>std::unique_ptr</code>, <code>std::shared_ptr</code>）来实现自动的、基于作用域的内存管理，但理解其底层原理仍然至关重要。</li>
</ul>
</li>
<li>
<p><strong>函数与参数传递</strong></p>
<ul>
<li><strong>Python</strong>： 参数传递是**“对象引用传递”**。对于可变对象（如列表），在函数内修改会影响到原始对象；对于不可变对象（如整数、字符串），则不会。
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">append_to_list</span>(<span class="hljs-params">lst</span>):
    lst.append(<span class="hljs-number">4</span>) <span class="hljs-comment"># 修改会影响原始列表</span>

my_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
append_to_list(my_list)
<span class="hljs-built_in">print</span>(my_list) <span class="hljs-comment"># 输出 [1, 2, 3, 4]</span>
</code></pre>
</li>
<li><strong>C++</strong>： 支持多种参数传递方式，需要显式指定：
<ul>
<li><strong>传值</strong>： 创建副本，函数内修改不影响原始数据。</li>
<li><strong>传引用</strong>： 不创建副本，函数内修改直接影响原始数据。</li>
<li><strong>传指针</strong>： 类似传引用，但语法和安全性不同。</li>
<li><strong>常量引用</strong>： 为了避免拷贝大型对象，同时防止函数修改它。</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">byValue</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span> </span>{ a = <span class="hljs-number">100</span>; } <span class="hljs-comment">// 不影响原变量</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">byReference</span><span class="hljs-params">(<span class="hljs-type">int</span> &amp;a)</span> </span>{ a = <span class="hljs-number">100</span>; } <span class="hljs-comment">// 影响原变量</span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span> x = <span class="hljs-number">10</span>;
    <span class="hljs-built_in">byValue</span>(x); <span class="hljs-comment">// x 仍然是 10</span>
    <span class="hljs-built_in">byReference</span>(x); <span class="hljs-comment">// x 变成了 100</span>
}
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>面向对象编程</strong></p>
<ul>
<li><strong>Python</strong>： 支持多重继承。所有成员变量和方法默认都是<code>public</code>的。通过命名约定（如单下划线<code>_var</code>表示保护，双下划线<code>__var</code>表示私有）来实现封装。
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):
        self.name = name <span class="hljs-comment"># 公有成员</span>
        self._protected_var = <span class="hljs-number">1</span>
        self.__private_var = <span class="hljs-number">2</span>
</code></pre>
</li>
<li><strong>C++</strong>： 拥有精细的访问控制符：<code>public</code>, <code>protected</code>, <code>private</code>。支持多重继承，但更推荐使用单继承和接口（纯虚类）。
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
<span class="hljs-keyword">public</span>:
    std::string name;
    <span class="hljs-built_in">MyClass</span>(<span class="hljs-type">const</span> std::string&amp; n) : <span class="hljs-built_in">name</span>(n) {}
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> privateVar;
};
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 data-id="heading-2"><strong>三、性能与生态系统</strong></h4>
<ol>
<li>
<p><strong>性能</strong></p>
<ul>
<li><strong>C++</strong>： <strong>性能极高</strong>。编译成本地机器码，直接与操作系统和硬件交互。手动内存管理和零开销抽象原则使得程序可以高度优化，运行时开销极小。</li>
<li><strong>Python</strong>： <strong>性能较低</strong>。作为解释型语言，存在解释器开销。其动态类型特性也使得运行时需要进行类型检查，进一步降低了速度。不过，可以通过调用C/C++扩展库（如NumPy, SciPy）来弥补性能瓶颈，这些库的核心部分是用C/Fortran实现的。</li>
</ul>
</li>
<li>
<p><strong>标准库与生态系统</strong></p>
<ul>
<li><strong>Python</strong>： 以其“内置电池”哲学而闻名，提供了极其丰富和强大的标准库，涵盖了文件处理、网络通信、数据结构、操作系统接口等。第三方库生态（通过PyPI）更是无比繁荣，尤其在AI和数据科学领域。</li>
<li><strong>C++</strong>： 标准库（STL）相对更基础，但提供了强大的通用容器（<code>vector</code>, <code>map</code>）、算法和输入输出功能。其生态系统由许多大型、独立的库组成（如Boost, Qt, OpenCV），这些库功能专一且性能强大。</li>
</ul>
</li>
<li>
<p><strong>学习曲线与开发效率</strong></p>
<ul>
<li><strong>Python</strong>： <strong>学习曲线平缓</strong>。语法直观，可以快速上手并产出成果。<strong>开发效率极高</strong>，非常适合快速迭代和原型开发。</li>
<li><strong>C++</strong>： <strong>学习曲线陡峭</strong>。程序员需要理解复杂的概念，如内存管理、指针、模板、移动语义等。编译-链接-调试的周期较长，<strong>开发效率相对较低</strong>。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-3"><strong>总结</strong></h4>


















































<table><thead><tr><th align="left">特性</th><th align="left">Python</th><th align="left">C++</th></tr></thead><tbody><tr><td align="left"><strong>类型</strong></td><td align="left">动态类型</td><td align="left">静态类型</td></tr><tr><td align="left"><strong>执行</strong></td><td align="left">解释执行</td><td align="left">编译执行</td></tr><tr><td align="left"><strong>语法</strong></td><td align="left">缩进定义块</td><td align="left">花括号定义块</td></tr><tr><td align="left"><strong>内存管理</strong></td><td align="left">自动垃圾回收</td><td align="left">手动管理/智能指针</td></tr><tr><td align="left"><strong>性能</strong></td><td align="left">较低</td><td align="left">极高</td></tr><tr><td align="left"><strong>学习曲线</strong></td><td align="left">平缓</td><td align="left">陡峭</td></tr><tr><td align="left"><strong>开发效率</strong></td><td align="left">高</td><td align="left">低</td></tr><tr><td align="left"><strong>主要领域</strong></td><td align="left">Web、AI、数据科学、脚本</td><td align="left">游戏、系统、嵌入式、高性能计算</td></tr></tbody></table>
<p><strong>结论：</strong></p>
<p>选择Python还是C++，并非是一个孰优孰劣的问题，而是一个<strong>权衡</strong>的问题。</p>
<ul>
<li>当你需要<strong>快速开发、易于学习、专注于业务逻辑和算法本身</strong>，而对极致性能要求不高时，<strong>Python</strong>是理想的选择。</li>
<li>当你需要<strong>对硬件进行精细控制、榨干每一寸性能、开发底层系统或资源受限的应用</strong>时，<strong>C++</strong> 是无可替代的工具。</li>
</ul>
<p>在许多现代项目中，两者甚至会结合使用：用Python作为上层胶水语言，快速构建应用逻辑和原型，而用C++编写核心的性能瓶颈模块，通过Python的扩展接口进行调用，从而实现开发效率和运行效率的完美结合。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js第九章(AI)]]></title>    <link>https://juejin.cn/post/7574916588719538218</link>    <guid>https://juejin.cn/post/7574916588719538218</guid>    <pubDate>2025-11-21T13:24:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574916588719538218" data-draft-id="7574916588719521834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js第九章(AI)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T13:24:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小满zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js第九章(AI)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小满zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T13:24:50.000Z" title="Fri Nov 21 2025 13:24:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI</h2>
<p>Vercel提供了AI SDK，可以让我们在Next.js中轻松集成AI功能。<a href="https://link.juejin.cn?target=https%3A%2F%2Fai-sdk.dev%2Fgetting-started" target="_blank" title="https://ai-sdk.dev/getting-started" ref="nofollow noopener noreferrer">AI SDK 官网</a></p>
<h4 data-id="heading-1">安装AI-SDK</h4>
<pre><code class="hljs language-sh" lang="sh">npm i ai @ai-sdk/deepseek @ai-sdk/react
</code></pre>
<p>这儿我们使用<code>deepseek</code>作为AI模型，<code>@ai-sdk/react</code>封装了流式输出和上下文管理hook，可以让我们在Next.js中轻松集成AI功能。如果你要安装其他模型，只需要将<code>deepseek</code>替换为其他模型即可。</p>
<p>例如：安装<code>openai</code>模型</p>
<pre><code class="hljs language-sh" lang="sh">npm i ai @ai-sdk/openai @ai-sdk/react
</code></pre>
<blockquote>
<p>为什么使用<code>deepseek</code>模型？因为<code>deepseek</code>比较便宜，充10元可以测试很久(非广告)。</p>
</blockquote>
<h4 data-id="heading-2">获取deepSeek API Key</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b389b99973b48f483f7d3ea52bddc6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764336290&amp;x-signature=6KRncuUWJT7bgvIrd4t7eRTZr1I%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afdb38c5928a4b319f5790d732cd7b16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764336290&amp;x-signature=Zl1EeQPi9jh3iLQUdOPyKtx51hw%3D" alt="image.png" loading="lazy"/></p>
<p>然后把生成的API Key复制一下保存起来。</p>
<h4 data-id="heading-3">编写API接口</h4>
<p>src/app/api/chat/route.ts</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextRequest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;
<span class="hljs-keyword">import</span> { streamText,convertToModelMessages } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>
<span class="hljs-keyword">import</span> { createDeepSeek } <span class="hljs-keyword">from</span> <span class="hljs-string">"@ai-sdk/deepseek"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">DEEPSEEK_API_KEY</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./key"</span>;
<span class="hljs-keyword">const</span> deepSeek = <span class="hljs-title function_">createDeepSeek</span>({
    <span class="hljs-attr">apiKey</span>: <span class="hljs-variable constant_">DEEPSEEK_API_KEY</span>, <span class="hljs-comment">//设置API密钥</span>
});
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">POST</span>(<span class="hljs-params">req: NextRequest</span>) {
    <span class="hljs-keyword">const</span> { messages } = <span class="hljs-keyword">await</span> req.<span class="hljs-title function_">json</span>(); <span class="hljs-comment">//获取请求体</span>
    <span class="hljs-comment">//这里为什么接受messages 因为我们使用前端的useChat 他会自动注入这个参数，所有可以直接读取</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">streamText</span>({
        <span class="hljs-attr">model</span>: <span class="hljs-title function_">deepSeek</span>(<span class="hljs-string">'deepseek-chat'</span>), <span class="hljs-comment">//使用deepseek-chat模型</span>
        <span class="hljs-attr">messages</span>:<span class="hljs-title function_">convertToModelMessages</span>(messages), <span class="hljs-comment">//转换为模型消息</span>
        <span class="hljs-comment">//前端传过来的额messages不符合sdk格式所以需要convertToModelMessages转换一下</span>
        <span class="hljs-comment">//转换之后的格式：</span>
        <span class="hljs-comment">//[</span>
            <span class="hljs-comment">//{ role: 'user', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'assistant', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'user', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'assistant', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'user', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'assistant', content: [ [Object] ] },</span>
            <span class="hljs-comment">//{ role: 'user', content: [ [Object] ] }</span>
        <span class="hljs-comment">//]</span>
        <span class="hljs-attr">system</span>: <span class="hljs-string">'你是一个高级程序员，请根据用户的问题给出回答'</span>, <span class="hljs-comment">//系统提示词</span>
    });
   
    <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">toUIMessageStreamResponse</span>() <span class="hljs-comment">//返回流式响应</span>
}
</code></pre>
<p>src/app/page.tsx</p>
<p>我们在前端使用<code>useChat</code>组件来实现AI对话，这个组件内部封装了流式响应，默认会向<code>/api/chat</code>发送请求。</p>
<ul>
<li><code>messages</code>: 消息列表，包含用户和AI的对话内容</li>
<li><code>sendMessage</code>: 发送消息的函数，参数为消息内容</li>
<li><code>onFinish</code>: 消息发送完成后回调函数，可以在这里进行一些操作，例如清空输入框</li>
</ul>
<p><strong>messages</strong>：数据结构解析</p>
<pre><code class="hljs language-ts" lang="ts">[
    {
        <span class="hljs-string">"parts"</span>: [
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>, <span class="hljs-comment">//文本类型</span>
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"你知道 api router 吗"</span>
            }
        ],
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"FPHwY1udRrkEoYgR"</span>, <span class="hljs-comment">//消息ID</span>
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span> <span class="hljs-comment">//用户角色</span>
    },
    {
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"qno6vcWcwFM4Yc8J"</span>, <span class="hljs-comment">//消息ID</span>
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-comment">//AI角色</span>
        <span class="hljs-string">"parts"</span>: [
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"step-start"</span> <span class="hljs-comment">//步骤开始 </span>
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>, <span class="hljs-comment">//文本类型</span>
                <span class="hljs-string">"text"</span>: <span class="hljs-string">"是的，我知道 **API Router**。"</span>, <span class="hljs-comment">//文本内容</span>
                <span class="hljs-string">"state"</span>: <span class="hljs-string">"done"</span> <span class="hljs-comment">//步骤完成</span>
            }
        ]
    }
]
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">'use client'</span>;
<span class="hljs-keyword">import</span> { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/button'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Textarea</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/textarea'</span>;
<span class="hljs-keyword">import</span> { useChat } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">HomePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>); <span class="hljs-comment">//输入框的值</span>
    <span class="hljs-keyword">const</span> messagesEndRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">//获取消息结束的ref</span>
    <span class="hljs-comment">//useChat 内部封装了流式响应 默认会向/api/chat 发送请求</span>
    <span class="hljs-keyword">const</span> { messages, sendMessage } = <span class="hljs-title function_">useChat</span>({
        <span class="hljs-attr">onFinish</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">setInput</span>(<span class="hljs-string">''</span>);
        }
    });

    <span class="hljs-comment">// 自动滚动到底部</span>
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        messagesEndRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> });
    }, [messages]);
    <span class="hljs-comment">//回车发送消息</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleKeyDown</span> = (<span class="hljs-params">e: React.KeyboardEvent&lt;HTMLTextAreaElement&gt;</span>) =&gt; {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span> &amp;&amp; !e.<span class="hljs-property">shiftKey</span>) {
            e.<span class="hljs-title function_">preventDefault</span>();
            <span class="hljs-keyword">if</span> (input.<span class="hljs-title function_">trim</span>()) {
                <span class="hljs-title function_">sendMessage</span>({ <span class="hljs-attr">text</span>: input });
            }
        }
    };

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex flex-col h-screen bg-linear-to-br from-blue-50 via-white to-purple-50'</span>&gt;</span>
            {/* 头部标题 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'bg-white/80 backdrop-blur-sm shadow-sm border-b border-gray-200'</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'max-w-4xl mx-auto px-6 py-4'</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-2xl font-bold bg-linear-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent'</span>&gt;</span>
                        AI 智能助手
                    <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-sm text-gray-500 mt-1'</span>&gt;</span>随时为您解答问题<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            {/* 消息区域 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex-1 overflow-y-auto px-4 py-6'</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'max-w-4xl mx-auto space-y-4'</span>&gt;</span>
                    {messages.length === 0 ? (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex flex-col items-center justify-center h-full text-center py-20'</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'bg-linear-to-br from-blue-100 to-purple-100 rounded-full p-6 mb-4'</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'w-12 h-12 text-blue-600'</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">'none'</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">'currentColor'</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">'0 0 24 24'</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">'round'</span> <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">'round'</span> <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span> <span class="hljs-attr">d</span>=<span class="hljs-string">'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z'</span> /&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-xl font-semibold text-gray-700 mb-2'</span>&gt;</span>开始对话<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-gray-500'</span>&gt;</span>输入您的问题，我会尽力帮助您<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    ) : (
                        messages.map((message) =&gt; (
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                                <span class="hljs-attr">key</span>=<span class="hljs-string">{message.id}</span>
                                <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">flex</span> ${<span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span> ? '<span class="hljs-attr">justify-end</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">justify-start</span>'} <span class="hljs-attr">animate-in</span> <span class="hljs-attr">fade-in</span> <span class="hljs-attr">slide-in-from-bottom-4</span> <span class="hljs-attr">duration-500</span>`}
                            &gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">flex</span> <span class="hljs-attr">gap-3</span> <span class="hljs-attr">max-w-</span>[<span class="hljs-attr">80</span>%] ${<span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span> ? '<span class="hljs-attr">flex-row-reverse</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">flex-row</span>'}`}&gt;</span>
                                    {/* 头像 */}
                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">shrink-0</span> <span class="hljs-attr">w-8</span> <span class="hljs-attr">h-8</span> <span class="hljs-attr">rounded-full</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">justify-center</span> <span class="hljs-attr">text-white</span> <span class="hljs-attr">font-semibold</span> ${
                                        <span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span> 
                                            ? '<span class="hljs-attr">bg-linear-to-br</span> <span class="hljs-attr">from-blue-500</span> <span class="hljs-attr">to-blue-600</span>' 
                                            <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-linear-to-br</span> <span class="hljs-attr">from-purple-500</span> <span class="hljs-attr">to-purple-600</span>'
                                    }`}&gt;</span>
                                        {message.role === 'user' ? '你' : 'AI'}
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                    
                                    {/* 消息内容 */}
                                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">flex</span> <span class="hljs-attr">flex-col</span> ${<span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span> ? '<span class="hljs-attr">items-end</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">items-start</span>'}`}&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">rounded-2xl</span> <span class="hljs-attr">px-4</span> <span class="hljs-attr">py-3</span> <span class="hljs-attr">shadow-sm</span> ${
                                            <span class="hljs-attr">message.role</span> === <span class="hljs-string">'user'</span>
                                                ? '<span class="hljs-attr">bg-linear-to-br</span> <span class="hljs-attr">from-blue-500</span> <span class="hljs-attr">to-blue-600</span> <span class="hljs-attr">text-white</span>'
                                                <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-white</span> <span class="hljs-attr">border</span> <span class="hljs-attr">border-gray-200</span> <span class="hljs-attr">text-gray-800</span>'
                                        }`}&gt;</span>
                                            {message.parts.map((part, index) =&gt; {
                                                switch (part.type) {
                                                    case 'text':
                                                        return (
                                                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{message.id</span> + <span class="hljs-attr">index</span>} <span class="hljs-attr">className</span>=<span class="hljs-string">'whitespace-pre-wrap wrap-break-word'</span>&gt;</span>
                                                                {part.text}
                                                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                                        );
                                                }
                                            })}
                                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        ))
                    )}
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{messagesEndRef}</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            {/* 输入区域 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'bg-white/80 backdrop-blur-sm border-t border-gray-200 shadow-lg'</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'max-w-4xl mx-auto px-4 py-4'</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex gap-3 items-end'</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'flex-1 relative'</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">Textarea</span>
                                <span class="hljs-attr">value</span>=<span class="hljs-string">{input}</span>
                                <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setInput(e.target.value)}
                                onKeyDown={handleKeyDown}
                                placeholder='请输入你的问题... (按 Enter 发送，Shift + Enter 换行)'
                                className='min-h-[60px] max-h-[200px] resize-none rounded-xl border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all shadow-sm'
                            /&gt;
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
                            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
                                if (input.trim()) {
                                    sendMessage({ text: input });
                                }
                            }}
                            disabled={!input.trim()}
                            className='h-[60px] px-6 rounded-xl bg-linear-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed'
                        &gt;
                            <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'w-5 h-5'</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">'none'</span> <span class="hljs-attr">stroke</span>=<span class="hljs-string">'currentColor'</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">'0 0 24 24'</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">'round'</span> <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">'round'</span> <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span> <span class="hljs-attr">d</span>=<span class="hljs-string">'M12 19l9 2-9-18-9 18 9-2zm0 0v-8'</span> /&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f37ae3e6f2c40f48901a37251cabd7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764336290&amp;x-signature=HPVslXZQ2loQfJLIFrfmb5ONPQ8%3D" alt="5.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 Cloudflare 服务中断，看建立多维度风险应对机制的必要]]></title>    <link>https://juejin.cn/post/7575006095388901385</link>    <guid>https://juejin.cn/post/7575006095388901385</guid>    <pubDate>2025-11-21T13:42:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575006095388901385" data-draft-id="7575006095388868617" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 Cloudflare 服务中断，看建立多维度风险应对机制的必要"/> <meta itemprop="keywords" content="人工智能,云计算,云原生"/> <meta itemprop="datePublished" content="2025-11-21T13:42:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AKAMAI"/> <meta itemprop="url" content="https://juejin.cn/user/829502942352628"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 Cloudflare 服务中断，看建立多维度风险应对机制的必要
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/829502942352628/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AKAMAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T13:42:52.000Z" title="Fri Nov 21 2025 13:42:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>11月18日，Cloudflare 出现技术问题，致使全球互联网多处停止运行，多个主要网站瘫痪。求职网站 Indeed、Anthropic 的 Claude 聊天机器人、X（前 Twitter）、电影评论网站 Letterboxd 等平台均受到波及，部分用户短暂无法访问。用户访问这些平台时，收到显示因 Cloudflare 问题导致页面无法加载的错误消息，成千上万的用户报告了相关问题 。</p>
<p>由于此次中断对许多高知名度网站造成了重大影响，该事件已被报道为全球突发新闻。Cloudflare 发言人表示，中断的“根本原因”是用于管理威胁流量的自动生成的配置文件，该文件“超出了预期的条目大小”，从而引发了处理多项服务流量的软件系统崩溃。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d539a9dafd94f4698b82b3d949143bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764337371&amp;x-signature=M0C0qZAYf5lkh6y0KQfLKHzunTE%3D" alt="" loading="lazy"/></p>
<p>（图片源自互联网）</p>
<p>无独有偶，在此前不久，在亚马逊发布相关服务不到一个月后，其 Web 服务便遭受了长达一天的中断，导致大量在线服务瘫痪。随后，Microsoft 在全球范围内也出现服务中断情况。</p>
<p>时间往前回溯，2024 年 7 月，网络安全公司 CrowdStrike 的一次错误升级导致大范围停电，不仅致使航班暂时停飞，金融服务受到严重冲击，还迫使医院推迟手术。</p>
<p>这些事件凸显了互联网安全的复杂性与脆弱性，即便是一个看似细微的配置问题，都可能引发大规模的服务中断，给企业和用户带来一定的损失。企业需要在危机发生之前，部署可靠、全面的安全解决方案来应对各种潜在问题与威胁。</p>
<p>Akamai 一直将弹性能力和防止宕机视为首要任务。正如负责这一全球最分布式计算平台团队的高级副总裁兼首席技术官 James Kretchmar 所说——</p>
<blockquote>
<p>虽然没有任何一家服务提供商能够完全免于风险，但选择那些始终坚持完善实践的提供商至关重要——包括弹性工程与架构级防护措施、稳健的运营与变更安全流程、完善的治理体系以及深入的情景预案规划，例如 Akamai。</p>
<p>作为网络安全领域的利益相关者与专家，Akamai 深知任何人都有可能遭受零日攻击或意料之外的漏洞影响。同样，我们也清楚全球最大的组织都依赖 Akamai，因此持续投入建设我们的平台始终是首要任务。</p>
</blockquote>
<p>借助Akamai 规模宏大、覆盖全球的平台，以及卓越的威胁监测能力，企业能够全天候、7×24h不间断地在本地与云环境中有效防范、精准检测并强力抵御各类网络威胁，进而树立品牌信任度，稳步实现企业愿景：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cde0d6e8e2a64ce3b0d2e75836c2fab7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764337371&amp;x-signature=21o30z5VcgpuT8wPiyDB48b6WW8%3D" alt="" loading="lazy"/></p>
<p>（图片源自互联网）</p>
<p>在超过25 年的时间里，Akamai 一直是全球各大顶级组织值得信赖的合作伙伴，包括：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc19114714aa4220bdbf3a90a450367f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764337371&amp;x-signature=C19DAIWmbs4I5Ch%2BjIXWWycrrRg%3D" alt="" loading="lazy"/></p>
<p>（图片源自互联网）</p>
<p>在我们所处的数字世界中，所有人都彼此紧密相连。Akamai 以平台的高弹性为荣，只为更好地支持全球企业。我们深知自己在客户业务中所扮演的重要角色，并对此高度重视。客户对 Akamai 的信任，是我们支持并保护数字世界的核心所在。</p>
<p>如您希望了解更多Akamai所提供的服务，欢迎您拨打 400-609-1609 预约咨询，您也可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fproducts%2Fweb-performance-optimization%23free-trial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251121_blogarticles229_end" target="_blank" title="https://www.akamai.com/zh/products/web-performance-optimization#free-trial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251121_blogarticles229_end" ref="nofollow noopener noreferrer">点击此处</a>，借助 Akamai 规模庞大的全球平台以及出色的威胁监测能力，在本地和云环境中防范、检测和抵御网络威胁，建立品牌信任度并实现您的愿景。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[计算机毕业设计推荐：基于springboot的快递物流仓库管理系统【Java+spring boot+MySQL、Java项目、Java毕设、Java项目定制定]]></title>    <link>https://juejin.cn/post/7574972697677709348</link>    <guid>https://juejin.cn/post/7574972697677709348</guid>    <pubDate>2025-11-21T12:15:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574972697677709348" data-draft-id="7574996958516576275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="计算机毕业设计推荐：基于springboot的快递物流仓库管理系统【Java+spring boot+MySQL、Java项目、Java毕设、Java项目定制定"/> <meta itemprop="keywords" content="Java,Spring Boot,MySQL"/> <meta itemprop="datePublished" content="2025-11-21T12:15:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机毕业设计小途"/> <meta itemprop="url" content="https://juejin.cn/user/3344059640330504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            计算机毕业设计推荐：基于springboot的快递物流仓库管理系统【Java+spring boot+MySQL、Java项目、Java毕设、Java项目定制定
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3344059640330504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机毕业设计小途
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T12:15:17.000Z" title="Fri Nov 21 2025 12:15:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>💖💖作者：计算机毕业设计小途
💙💙个人简介：曾长期从事计算机专业培训教学，本人也热爱上课教学，语言擅长Java、微信小程序、Python、Golang、安卓Android等，开发项目包括大数据、深度学习、网站、小程序、安卓、算法。平常会做一些项目定制化开发、代码讲解、答辩教学、文档编写、也懂一些降重方面的技巧。平常喜欢分享一些自己开发中遇到的问题的解决办法，也喜欢交流技术，大家有技术代码这一块的问题可以问我！
💛💛想说的话：感谢大家的关注与支持！
💜💜
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011385.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011385.html" ref="nofollow noopener noreferrer">网站实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011386.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011386.html" ref="nofollow noopener noreferrer">安卓/小程序实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011387.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011387.html" ref="nofollow noopener noreferrer">大数据实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011390.html%3Fspm%3D1001.2014.3001.5482" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011390.html?spm=1001.2014.3001.5482" ref="nofollow noopener noreferrer">深度学习实战项目</a></p>
</blockquote>
<p>@<a href="https://link.juejin.cn?target=%25E7%259B%25AE%25E5%25BD%2595" target="_blank" title="%E7%9B%AE%E5%BD%95" ref="nofollow noopener noreferrer">TOC</a></p>
<h2 data-id="heading-0">基于springboot的快递物流仓库管理系统介绍</h2>
<p>本《基于SpringBoot的快递物流仓库管理系统》是一套专为模拟和管理现代快递物流仓储业务而设计的综合性信息管理平台，旨在通过信息化手段实现对快递包裹从揽收到运输完成全生命周期的精细化管控。系统采用当前业界主流且成熟的前后端分离架构进行开发，后端核心技术栈为Java语言结合轻量级、高效率的SpringBoot框架，整合了Spring、SpringMVC与MyBatis，实现了业务逻辑与数据访问的清晰分层；前端界面则基于Vue.js框架，并选用ElementUI组件库进行构建，打造了美观、响应式且用户体验友好的操作界面。整体系统基于B/S架构，通过IDEA或PyCharm作为开发工具，并选用稳定可靠的MySQL关系型数据库作为数据持久化存储方案。在功能层面，系统全面覆盖了快递物流的核心运营环节，构建了一个完整的业务闭环：首先，系统提供了完善的基础数据管理功能，包括对司机信息、快递员信息、客户信息、快递类型以及物流仓库等基础档案的统一维护；其次，核心业务流程模块精确追踪了包裹的每一个动态节点，从“快递揽件”的源头信息录入，到“快递入库”与“快递出库”的仓储作业管理，再到“快递运输”的过程监控，直至“运输完成”的状态确认，确保了物流信息流的完整与准确。此外，系统还特别设计了与人力成本相关的“司机津贴”和“快递员津贴”管理模块，实现了对运营成本的初步核算。最后，系统还配备了基础的“系统管理”与“个人中心”功能，保障了系统的安全与个性化使用，并通过“系统首页”为用户提供了关键业务数据的可视化概览，从而构成了一个功能完备、流程清晰、技术先进的计算机毕业设计项目。</p>
<h2 data-id="heading-1">基于springboot的快递物流仓库管理系统演示视频</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1AZULBzExc%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1AZULBzExc/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">演示视频</a></p>
<h2 data-id="heading-2">基于springboot的快递物流仓库管理系统演示图片</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36d62975c92a404186bbc663b58e3772~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=JNZoHGTtTFpYUIXpLVsVFNTuMtY%3D" alt="仓库物流.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18f2830f33594e51ae7e8b09b93de563~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=K6cErDCqyNu1JiYqS%2FCw9c%2BjOY8%3D" alt="客户信息.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35601eb79a83486c9d7f8c1cb4714473~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=L1R1PwmoJC%2Fr04qdv%2FoDOQDAjxg%3D" alt="快递出库.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c74c4b5536a74dfeb7ea30990ce4e3ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=ZevKebCKcXigFyrCSLCOwyRql%2F8%3D" alt="快递揽件.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/711cbd79bb454cf8ace9e8a0ac1e88e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=ZGCDFco5rPSy9BL4OpOCuQo0%2FEk%3D" alt="快递入库.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56ae0aba6fd84665b12aa9fb9c81f5ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=Ri27unHt6QJLTaQ05xl4JLAbwno%3D" alt="快递信息.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c54cec246564d22ba48208c76effa17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=4qxbskUeQtsd%2FtVDhwRX3e21PXE%3D" alt="快递员津贴.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6013efdd7d2b4d1f8efb3edbb012d6c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=6fMGdpTXl5r5ox6ADuUD86GEi0s%3D" alt="快递员信息.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3234cb79941f485b83532bc2e34fbb9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=x1RIg5bUqfqhPDJP5T7vr4nUpZs%3D" alt="快递运输.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5973d3ceb2144c919724fc1828f81cb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=HPE1aGd6FXyEz1tNvR0KWnxrINc%3D" alt="司机津贴.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5545ba3e4219408483a0a616eb0f0827~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=GrCphB2XH1HQyuw8ug753Zwehlw%3D" alt="司机信息.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9cb83818b04495b92f38e73a4bd1e22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=bK5S2zdDBPoa1HvGQlaCYoizBO8%3D" alt="运输完成.png" loading="lazy"/></p>
<h2 data-id="heading-3">基于springboot的快递物流仓库管理系统代码展示</h2>
<pre><code class="hljs language-dart" lang="dart">from pyspark.sql <span class="hljs-keyword">import</span> SparkSession
from pyspark.sql.functions <span class="hljs-keyword">import</span> col, when, count, avg, lit, round
# 初始化SparkSession，这是所有大数据处理的入口点
spark = SparkSession.builder.appName(<span class="hljs-string">"StrokeAnalysisSystem"</span>).master(<span class="hljs-string">"local[*]"</span>).getOrCreate()
# 模拟从HDFS或数据库加载数据到Spark DataFrame
# 实际项目中，这里会是 spark.read.csv(<span class="hljs-string">"hdfs://..."</span>) 或 spark.read.jdbc(...)
schema = <span class="hljs-string">"id INT, gender STRING, age DOUBLE, hypertension INT, heart_disease INT, ever_married STRING, work_type STRING, Residence_type STRING, avg_glucose_level DOUBLE, bmi DOUBLE, smoking_status STRING, stroke INT"</span>
# 此处使用模拟数据代替真实数据加载过程
mock_data = [(<span class="hljs-number">51676</span>, <span class="hljs-string">"Male"</span>, <span class="hljs-number">67.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">228.69</span>, <span class="hljs-number">36.6</span>, <span class="hljs-string">"formerly smoked"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">31112</span>, <span class="hljs-string">"Male"</span>, <span class="hljs-number">80.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Rural"</span>, <span class="hljs-number">105.92</span>, <span class="hljs-number">32.5</span>, <span class="hljs-string">"never smoked"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">60182</span>, <span class="hljs-string">"Female"</span>, <span class="hljs-number">49.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">171.23</span>, <span class="hljs-number">34.4</span>, <span class="hljs-string">"smokes"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">1665</span>, <span class="hljs-string">"Female"</span>, <span class="hljs-number">79.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Self-employed"</span>, <span class="hljs-string">"Rural"</span>, <span class="hljs-number">174.12</span>, <span class="hljs-number">24.0</span>, <span class="hljs-string">"never smoked"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">58202</span>, <span class="hljs-string">"Male"</span>, <span class="hljs-number">81.0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">186.21</span>, <span class="hljs-number">29.0</span>, <span class="hljs-string">"formerly smoked"</span>, <span class="hljs-number">1</span>),
             (<span class="hljs-number">7009</span>, <span class="hljs-string">"Female"</span>, <span class="hljs-number">50.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">88.5</span>, <span class="hljs-number">27.5</span>, <span class="hljs-string">"never smoked"</span>, <span class="hljs-number">0</span>),
             (<span class="hljs-number">47649</span>, <span class="hljs-string">"Female"</span>, <span class="hljs-number">25.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"No"</span>, <span class="hljs-string">"Private"</span>, <span class="hljs-string">"Rural"</span>, <span class="hljs-number">92.5</span>, <span class="hljs-number">22.5</span>, <span class="hljs-string">"smokes"</span>, <span class="hljs-number">0</span>),
             (<span class="hljs-number">12175</span>, <span class="hljs-string">"Male"</span>, <span class="hljs-number">45.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"Yes"</span>, <span class="hljs-string">"Govt_job"</span>, <span class="hljs-string">"Urban"</span>, <span class="hljs-number">110.5</span>, <span class="hljs-number">33.5</span>, <span class="hljs-string">"never smoked"</span>, <span class="hljs-number">0</span>)]
patient_df = spark.createDataFrame(mock_data, schema)
# ======================== <span class="hljs-number">1.</span> 高风险特征组合画像分析核心代码 ========================
def analyze_high_risk_profiles(df, risk_threshold=<span class="hljs-number">0.6</span>):
    <span class="hljs-string">"""
    分析高风险特征组合，找出中风概率超过阈值的群体画像。
    例如：分析同时患有高血压和心脏病的群体的中风风险。
    """</span>
    # 选择关键的二元特征进行组合分析：高血压、心脏病
    # 使用 a.alias() 来避免列名冲突，并提高代码可读性
    feature_combinations_df = df.groupBy(<span class="hljs-string">"hypertension"</span>, <span class="hljs-string">"heart_disease"</span>, <span class="hljs-string">"smoking_status"</span>).agg(
        count(<span class="hljs-string">"*"</span>).alias(<span class="hljs-string">"total_count"</span>),
        count(when(col(<span class="hljs-string">"stroke"</span>) == <span class="hljs-number">1</span>, True)).alias(<span class="hljs-string">"stroke_count"</span>)
    )
    # 计算每个特征组合下的中风风险概率
    risk_analysis_df = feature_combinations_df.withColumn(
        <span class="hljs-string">"stroke_risk_rate"</span>, round(col(<span class="hljs-string">"stroke_count"</span>) / col(<span class="hljs-string">"total_count"</span>), <span class="hljs-number">4</span>)
    )
    # 筛选出总人数大于一定数量（例如<span class="hljs-number">1</span>人以上，避免小样本偏差）且风险率高于设定阈值的组合
    high_risk_profiles_df = risk_analysis_df.filter(
        (col(<span class="hljs-string">"total_count"</span>) &gt; <span class="hljs-number">1</span>) &amp; (col(<span class="hljs-string">"stroke_risk_rate"</span>) &gt;= risk_threshold)
    ).orderBy(col(<span class="hljs-string">"stroke_risk_rate"</span>).desc())
    # 为了方便前端Echarts等工具使用，将Spark DataFrame转换为JSON格式列表
    high_risk_results = high_risk_profiles_df.toJSON().map(lambda j: eval(j)).collect()
    # 构造最终返回给前端的数据结构
    formatted_results = []
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> high_risk_results:
        profile_desc = f<span class="hljs-string">"高血压:{'是' if row['hypertension']==1 else '否'}, 心脏病:{'是' if row['heart_disease']==1 else '否'}, 吸烟:{row['smoking_status']}"</span>
        formatted_results.append({
            <span class="hljs-string">"profile"</span>: profile_desc,
            <span class="hljs-string">"totalCount"</span>: row[<span class="hljs-string">"total_count"</span>],
            <span class="hljs-string">"strokeCount"</span>: row[<span class="hljs-string">"stroke_count"</span>],
            <span class="hljs-string">"riskRate"</span>: row[<span class="hljs-string">"stroke_risk_rate"</span>]
        })
    <span class="hljs-keyword">return</span> formatted_results
# ======================== <span class="hljs-number">2.</span> 多维度交叉与深度钻取分析核心代码 ========================
def analyze_multi_dimensional_cross(df, dimensions, filters=None):
    <span class="hljs-string">"""
    根据前端请求的维度列表进行动态的交叉分析，并支持过滤条件进行钻取。
    例如：dimensions=["gender", "work_type"], filters={"Residence_type": "Urban"}
    """</span>
    # 应用钻取过滤条件
    filtered_df = df
    <span class="hljs-keyword">if</span> filters:
        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> filters.items():
            filtered_df = filtered_df.filter(col(key) == value)
    # 检查传入的维度列表是否为空，如果为空则无法分组
    <span class="hljs-keyword">if</span> not dimensions:
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"error"</span>: <span class="hljs-string">"维度列表不能为空"</span>}
    # 使用传入的维度列表进行动态分组聚合
    cross_analysis_df = filtered_df.groupBy(*dimensions).agg(
        count(<span class="hljs-string">"*"</span>).alias(<span class="hljs-string">"total_count"</span>),
        count(when(col(<span class="hljs-string">"stroke"</span>) == <span class="hljs-number">1</span>, True)).alias(<span class="hljs-string">"stroke_count"</span>)
    )
    # 增加中风占比列，用于前端图表展示
    result_df = cross_analysis_df.withColumn(
        <span class="hljs-string">"stroke_percentage"</span>, round((col(<span class="hljs-string">"stroke_count"</span>) / col(<span class="hljs-string">"total_count"</span>)) * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)
    ).orderBy(*dimensions)
    # 将最终的分析结果转换为JSON格式，方便API返回
    analysis_results_list = result_df.toJSON().map(lambda j: eval(j)).collect()
    # 构造返回给前端的完整数据，包括维度信息和数据本身
    final_response = {
        <span class="hljs-string">"dimensions"</span>: dimensions,
        <span class="hljs-string">"filtersApplied"</span>: filters <span class="hljs-keyword">if</span> filters <span class="hljs-keyword">else</span> <span class="hljs-string">"无"</span>,
        <span class="hljs-string">"analysisData"</span>: analysis_results_list,
        <span class="hljs-string">"totalRecordsAnalyzed"</span>: result_df.count()
    }
    <span class="hljs-keyword">return</span> final_response
# ======================== <span class="hljs-number">3.</span> 中风核心风险因素关联分析核心代码 ========================
def analyze_risk_factor_correlation(df):
    <span class="hljs-string">"""
    分析核心健康指标（数值型变量）与是否中风的关联性。
    通过对比中风患者与非中风患者在这些指标上的平均值差异来体现关联度。
    """</span>
    # 选择需要进行关联分析的核心数值型指标
    numeric_factors = [<span class="hljs-string">"age"</span>, <span class="hljs-string">"avg_glucose_level"</span>, <span class="hljs-string">"bmi"</span>]
    # 构建聚合表达式列表，对每个指标计算平均值
    agg_expressions = [avg(col(factor)).alias(f<span class="hljs-string">"avg_{factor}"</span>) <span class="hljs-keyword">for</span> factor <span class="hljs-keyword">in</span> numeric_factors]
    # 按是否中风（stroke=<span class="hljs-number">0</span>或<span class="hljs-number">1</span>）进行分组，并应用上面的聚合表达式
    correlation_df = df.groupBy(<span class="hljs-string">"stroke"</span>).agg(*agg_expressions).orderBy(<span class="hljs-string">"stroke"</span>)
    # 清理列名，并对结果进行四舍五入，使其更适合展示
    <span class="hljs-keyword">for</span> factor <span class="hljs-keyword">in</span> numeric_factors:
        correlation_df = correlation_df.withColumn(
            f<span class="hljs-string">"avg_{factor}"</span>, round(col(f<span class="hljs-string">"avg_{factor}"</span>), <span class="hljs-number">2</span>)
        )
    # 将宽表（多列）转换为长表，这种格式更适合Echarts等图表库进行分组柱状图的渲染
    # 例如：(factor, stroke_group, value) -&gt; (age, <span class="hljs-number">0</span>, <span class="hljs-number">55.2</span>), (age, <span class="hljs-number">1</span>, <span class="hljs-number">78.5</span>)
    unpivoted_results = []
    collected_data = correlation_df.collect()
    stroke_group_data = collected_data[<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> len(collected_data) &gt; <span class="hljs-number">1</span> and collected_data[<span class="hljs-number">1</span>][<span class="hljs-string">'stroke'</span>] == <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> None
    non_stroke_group_data = collected_data[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> len(collected_data) &gt; <span class="hljs-number">0</span> and collected_data[<span class="hljs-number">0</span>][<span class="hljs-string">'stroke'</span>] == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> None
    <span class="hljs-keyword">for</span> factor <span class="hljs-keyword">in</span> numeric_factors:
        factor_data = {<span class="hljs-string">"factorName"</span>: factor, <span class="hljs-string">"strokeValue"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"nonStrokeValue"</span>: <span class="hljs-number">0</span>}
        <span class="hljs-keyword">if</span> stroke_group_data:
            factor_data[<span class="hljs-string">"strokeValue"</span>] = stroke_group_data[f<span class="hljs-string">"avg_{factor}"</span>]
        <span class="hljs-keyword">if</span> non_stroke_group_data:
            factor_data[<span class="hljs-string">"nonStrokeValue"</span>] = non_stroke_group_data[f<span class="hljs-string">"avg_{factor}"</span>]
        unpivoted_results.append(factor_data)
    # 返回最终处理好的、适合前端渲染的数据
    <span class="hljs-keyword">return</span> unpivoted_results
# 模拟调用这些函数并打印结果
<span class="hljs-built_in">print</span>(<span class="hljs-string">"--- 高风险特征组合画像分析结果 ---"</span>)
<span class="hljs-built_in">print</span>(analyze_high_risk_profiles(patient_df, risk_threshold=<span class="hljs-number">0.5</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- 多维度交叉与深度钻取分析结果 ---"</span>)
<span class="hljs-built_in">print</span>(analyze_multi_dimensional_cross(patient_df, dimensions=[<span class="hljs-string">"gender"</span>, <span class="hljs-string">"Residence_type"</span>]))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n--- 中风核心风险因素关联分析结果 ---"</span>)
<span class="hljs-built_in">print</span>(analyze_risk_factor_correlation(patient_df))
</code></pre>
<h2 data-id="heading-4">基于springboot的快递物流仓库管理系统文档展示</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4c65e4fdb614c3794e891848a46d9d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V5Lia6K6-6K6h5bCP6YCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764332117&amp;x-signature=0ygMDq%2Fidwl67sq%2B54qmS9ES5eM%3D" alt="文档.png" loading="lazy"/></p>
<blockquote>
<p>💖💖作者：计算机毕业设计小途
💙💙个人简介：曾长期从事计算机专业培训教学，本人也热爱上课教学，语言擅长Java、微信小程序、Python、Golang、安卓Android等，开发项目包括大数据、深度学习、网站、小程序、安卓、算法。平常会做一些项目定制化开发、代码讲解、答辩教学、文档编写、也懂一些降重方面的技巧。平常喜欢分享一些自己开发中遇到的问题的解决办法，也喜欢交流技术，大家有技术代码这一块的问题可以问我！
💛💛想说的话：感谢大家的关注与支持！
💜💜
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011385.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011385.html" ref="nofollow noopener noreferrer">网站实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011386.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011386.html" ref="nofollow noopener noreferrer">安卓/小程序实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011387.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011387.html" ref="nofollow noopener noreferrer">大数据实战项目</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2501_92808674%2Fcategory_13011390.html" target="_blank" title="https://blog.csdn.net/2501_92808674/category_13011390.html" ref="nofollow noopener noreferrer">深度学习实战项目</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spec Kit 实践：从 Prompt 工程到规范驱动开发]]></title>    <link>https://juejin.cn/post/7574916588719505450</link>    <guid>https://juejin.cn/post/7574916588719505450</guid>    <pubDate>2025-11-21T12:51:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574916588719505450" data-draft-id="7575022279567228969" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spec Kit 实践：从 Prompt 工程到规范驱动开发"/> <meta itemprop="keywords" content="VibeCoding,AI编程"/> <meta itemprop="datePublished" content="2025-11-21T12:51:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="严老湿"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824991006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spec Kit 实践：从 Prompt 工程到规范驱动开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824991006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    严老湿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T12:51:49.000Z" title="Fri Nov 21 2025 12:51:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">当前 Vibe Coding 的困扰</h2>
<p>是否已经遇到过以下问题？</p>
<ul>
<li>花费大量时间编写和修改 Prompt，但 AI 生成的代码与预期不符？</li>
<li>完成需求后难以追溯设计原则和具体改动点？</li>
<li>开发完成后希望补充文档，但上下文已被压缩丢失？</li>
<li>编码规则和规范散落在不同编辑器中，缺乏统一管理？</li>
<li>难以建立标准化的 AI 编程流程和质量保障机制？</li>
</ul>
<p>例如下面的提示词语言排行榜：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66c4d0cc82574828a327a76abdfedff3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=qkBKxCxbj8Dbi%2BPSY7MxxQDQfMQ%3D" alt="图源GitHub" loading="lazy"/></p>
<p>而 Spec Kit 提供了一种"规范即代码"的解决方案，旨在解决传统 Prompt 工程中存在的重复修改、缺乏系统性信息留存等问题。</p>
<h2 data-id="heading-1">什么是 Spec Kit</h2>
<p>Spec Kit 是 GitHub 团队近期推出的开发工具套件，倡导"规范即代码"的开发理念。</p>
<p>它引入了<strong>规范驱动开发</strong>的新型软件开发模式，通过 AI 技术提升代码质量和开发效率。其核心思想是将需求规格置于开发流程的中心，让开发者首先精确定义"做什么"和"为什么"，再由 AI 基于清晰的规范生成代码。</p>
<p>简而言之，Spec Kit 通过文档先行的方式，建立系统化的开发工作流。</p>
<h2 data-id="heading-2">环境准备与安装</h2>
<h3 data-id="heading-3">支持的环境</h3>
<p>目前 Spec Kit 支持 <strong>Claude</strong>、<strong>Gemini</strong>、<strong>Copilot</strong> 等 AI 助手。如果无法使用 Claude，也可以将模型替换为 Qwen、DeepSeek 等其他兼容模型。</p>
<p>本文以 Claude Code 作为演示环境。</p>
<h3 data-id="heading-4">系统要求</h3>
<ul>
<li>Python ≥ 3.11</li>
<li>Git（任意版本）</li>
</ul>
<h3 data-id="heading-5">安装步骤</h3>
<p>打开终端（PowerShell、Terminal 等），执行以下命令安装 specify-cli：</p>
<pre><code class="hljs language-shell" lang="shell">uv tool install specify-cli --from git+https://github.com/github/spec-kit.git
</code></pre>
<p>或在项目内直接安装：</p>
<pre><code class="hljs language-shell" lang="shell">uvx --from git+https://github.com/github/spec-kit.git specify init &lt;PROJECT_NAME&gt;
</code></pre>
<h2 data-id="heading-6">项目初始化</h2>
<p>在已有项目目录中执行初始化命令（<code>claude</code> 可替换为其他支持的 AI 助手）：</p>
<pre><code class="hljs language-shell" lang="shell">specify init . --ai claude
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de244bb2cac342d78d921a35de709bd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=KFEGFbCzq76tTAgehsLVb9FbzNY%3D" alt="" loading="lazy"/></p>
<p>初始化完成后，项目目录中会生成 <code>.specify</code> 目录，包含以下结构：</p>
<ul>
<li><code>memory/</code> - 存储项目级原则和规范</li>
<li><code>scripts/bash/</code> - Spec Kit 的调用脚本</li>
<li><code>template/</code> - 执行命令时使用的模板文件</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd0aa477d44b492c81d7ecc95fa4076e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=zvkAWMiFElXW1NxWUGh5OadEUN0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">核心命令参考</h3>
<p>所有 Spec Kit 命令都以 <code>/speckit.</code> 开头：</p>


















































<table><thead><tr><th>命令</th><th>用途描述</th><th>使用时机</th></tr></thead><tbody><tr><td><code>/speckit.constitution</code></td><td>制定或更新项目级开发原则和指南</td><td>项目初始化或引入新规范时</td></tr><tr><td><code>/speckit.specify</code></td><td>明确需求范围和用户故事</td><td>开始新功能开发时</td></tr><tr><td><code>/speckit.plan</code></td><td>基于技术栈创建实施方案</td><td>需求明确后</td></tr><tr><td><code>/speckit.tasks</code></td><td>生成可执行的任务清单</td><td>方案确定后</td></tr><tr><td><code>/speckit.implement</code></td><td>按计划执行所有开发任务</td><td>任务分解完成后</td></tr><tr><td><code>/speckit.clarify</code></td><td>澄清需求中的模糊领域</td><td>制定计划前</td></tr><tr><td><code>/speckit.analyze</code></td><td>跨工件一致性和覆盖率分析</td><td>任务生成后，实施前</td></tr><tr><td><code>/speckit.checklist</code></td><td>生成质量检查清单</td><td>需求验证阶段</td></tr></tbody></table>
<p>常用的核心命令包括：<code>specify</code>、<code>plan</code>、<code>tasks</code>、<code>implement</code>。</p>
<p><code>constitution</code> 主要用于项目初始化阶段或引入新的技术规范时。<code>clarify</code> 用于补充说明需求中的边界条件。<code>checklist</code> 生成验证清单，类似于文本形式的测试用例。</p>
<p>以下是 Spec Kit 的完整工作和核心流程参考：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/033e43829e104419a45d33bd0f8de5ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=N6ug4Vp1XzOydvXdRGT2qikNdCY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/884f094e9aae44ed8caf8c9e20566650~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=ORMu9qQX0V%2F9jAGI8E3jK2MUfdU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">实战演示：二维码生成工具开发</h2>
<h3 data-id="heading-9">启动开发环境</h3>
<p>通过终端或编辑器插件启动 Claude Code（为提升效率，可启用 YOLO 模式跳过权限确认）：</p>
<pre><code class="hljs language-shell" lang="shell">claude --dangerously-skip-permissions
</code></pre>
<h3 data-id="heading-10">建立项目规范</h3>
<p>在对话中输入以下命令，可根据实际项目背景补充具体规范：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.constitution 创建专注于代码质量、测试标准、用户体验一致性和性能要求的原则。
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6ab23fa4224fe2820f2b5e4ac5ce8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=hbk%2B2%2BEEWJ6CSj0ZFyFcFleKmhM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30f03554bcc84827b8a06e62ca47fc11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=GTu0j8tts%2FVaBCMbh%2B0vaYabRt8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">定义功能需求</h3>
<p>使用 specify 命令定义二维码生成工具的需求：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.specify 需要开发一个二维码生成工具库，支持 color、size、logo 等基本配置，提供使用示例，满足常见使用场景。
</code></pre>
<p>此步骤会生成 <code>spec.md</code> 和 <code>requirements.md</code>，明确功能需求和验收标准，为后续开发奠定基础。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/132186143deb486bb615b09162e54804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=B5wvDaCHV%2B3ib2LsKF54EwWZYro%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">澄清需求边界</h3>
<p>如果发现生成的需求存在模糊之处，可使用 clarify 进行澄清：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.clarify 不需要考虑 Node.js 环境，仅针对 Web 端使用。
</code></pre>
<p>clarify 会记录澄清过程，并提出其他需要明确的边界问题，通过交互式对话完善需求文档。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c387c63d3fcd42bb852176630c9b9dd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=4JelOhleeg2lShE2hKEFlEEGegU%3D" alt="" loading="lazy"/></p>
<p>例如，系统可能会提出以下澄清问题：</p>
<p><strong>问题 1: Logo 图像输入方式</strong></p>
<pre><code class="hljs language-sql" lang="sql">基于用户明确只针对 Web 端使用，Logo 的输入方式需要明确。

推荐方案: 选项 C (File 对象<span class="hljs-operator">/</span><span class="hljs-type">Blob</span> <span class="hljs-operator">+</span> URL 字符串) <span class="hljs-operator">-</span>
覆盖 Web 开发中最常见的所有场景，实现复杂度适中。

<span class="hljs-operator">|</span> 选项    <span class="hljs-operator">|</span> 描述                                 <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span><span class="hljs-comment">-------|------------------------------------|</span>
<span class="hljs-operator">|</span> A     <span class="hljs-operator">|</span> 仅支持 URL 字符串                    <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> B     <span class="hljs-operator">|</span> 仅支持 File 对象或 <span class="hljs-type">Blob</span>              <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> C     <span class="hljs-operator">|</span> 同时支持 File 对象<span class="hljs-operator">/</span><span class="hljs-type">Blob</span> 和 URL 字符串 <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> D     <span class="hljs-operator">|</span> 支持 HTMLImageElement 或 Canvas 元素 <span class="hljs-operator">|</span>

<span class="hljs-operator">&gt;</span> yes
</code></pre>
<p><strong>问题 2: 颜色对比度处理策略</strong></p>
<pre><code class="hljs language-less" lang="less">当用户设置的前景色和背景色对比度过低时，系统应该如何处理？

推荐方案: 选项 <span class="hljs-selector-tag">B</span> (警告但允许生成) <span class="hljs-selector-tag">-</span>
既尊重开发者的设计自由度，又通过警告提醒潜在问题。

| 选项    | 描述             |
|<span class="hljs-selector-tag">-------</span>|<span class="hljs-selector-tag">----------------</span>|
| <span class="hljs-selector-tag">A</span>     | 拒绝生成并返回错误  |
| <span class="hljs-selector-tag">B</span>     | 发出警告但仍允许生成 |
| <span class="hljs-selector-tag">C</span>     | 自动调整颜色对比度  |
| <span class="hljs-selector-tag">D</span>     | 静默生成不做提示    |

&gt; <span class="hljs-selector-tag">yes</span>
</code></pre>
<p>澄清过程会记录所有决策，确保需求文档的完整性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73cb1a4583a743dfabc6a5eab3f15024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=kHs46xBgaqQSTTcjXQJmfXC1BXE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">制定技术方案</h3>
<p>使用 plan 命令生成技术实施方案：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.plan
</code></pre>
<p>plan 会综合分析 spec.md、requirements.md 和 constitution.md，制定完整的技术方案，包括市场调研、技术选型和架构设计。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/064db304ba04404a97c630e903e88afa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=Dn%2FC%2FOirJP5679y8A8s1ZBS9McM%3D" alt="" loading="lazy"/></p>
<p>系统会进行技术调研，分析现有解决方案，并基于调研结果设计数据模型和系统架构。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/863dce78e0a44705a4f7422769f4665a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=WRUAfmxaA4dB2yVo7ablHK0G9tw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">任务分解与执行</h3>
<p>基于设计方案进行任务拆分：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.tasks
</code></pre>
<p>系统会将项目分解为多个用户故事，每个故事包含详细的任务清单。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d079a4ead4124c5fafb28f2307e1cc6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=xrGnnKxCX4S9Ai2Z1AxJtUM1OTg%3D" alt="" loading="lazy"/></p>
<p>执行所有开发任务：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.implement
</code></pre>
<pre><code class="hljs language-shell" lang="shell">正在执行 Phase 1: Setup… (esc to interrupt · ctrl+t to hide todos · 2m 15s · ↑ 1.2k tokens)
  ⎿  ☒ 验证并创建项目 ignore 文件
     ☐ Phase 1: Setup (7个任务)
     ☐ Phase 2: Foundational (7个任务)
     ☐ Phase 3: User Story 1 - MVP (7个任务)
     ☐ Phase 4: User Story 2 (5个任务)
     ☐ Phase 5: User Story 5 (5个任务)
     ☐ Phase 6: User Story 3 (7个任务)
     ☐ Phase 7: User Story 4 (4个任务)
     ☐ Phase 8: Polish (8个任务)
</code></pre>
<p>如果执行过程中断，可使用以下命令继续：</p>
<pre><code class="hljs language-shell" lang="shell">/speckit.implement 继续执行
</code></pre>
<p>直到执行完成所有 Task</p>
<h2 data-id="heading-15">开发成果</h2>
<p>通过 Spec Kit 完成的二维码生成工具开发，从需求定义到代码实现，整体耗时约 1 小时（包含网络延迟和指令等待时间）。这种方法相比传统的即时 Prompt 工程，提供了更系统化的开发体验。</p>
<p>项目实现了完整的二维码生成功能，包括：</p>
<ul>
<li>基础二维码生成</li>
<li>颜色和尺寸定制</li>
<li>Logo 嵌入支持</li>
<li>完整的文档和示例</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e51204b120804539b1a38534d8008138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=n24ZYliuPL%2BeK4mYm9gNKX0o%2BAY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45b713148d3f418890023aef9c5411e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=wtA2%2F%2BmK53bJw5bKDwLqWcJ6ZGs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54242b1bb8094d9c953d26d63619ac22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lil6ICB5rm_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764334309&amp;x-signature=a0dfYTuALqYIy5b0964YzQZcjI8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-16">总结</h2>
<p>Spec Kit 通过规范驱动的开发方法，将产品需求、技术架构、测试标准和开发实现有机结合，提供了系统化的 AI 辅助编程解决方案。相比传统的即时 Prompt 工程，它能够：</p>
<ul>
<li>确保需求实现的准确性</li>
<li>提供完整的设计决策记录</li>
<li>生成一致且可维护的代码</li>
<li>建立标准化的开发流程</li>
</ul>
<p>完整项目代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCrazyMrYan%2Fqrcode-gen" target="_blank" title="https://github.com/CrazyMrYan/qrcode-gen" ref="nofollow noopener noreferrer">github.com/CrazyMrYan/…</a></p>
<h2 data-id="heading-17">文献</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yanfukun.com%2Fread%2Fspec-kit%2Fwhat" target="_blank" title="https://www.yanfukun.com/read/spec-kit/what" ref="nofollow noopener noreferrer">www.yanfukun.com/read/spec-k…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgithub%2Fspec-kit" target="_blank" title="https://github.com/github/spec-kit" ref="nofollow noopener noreferrer">github.com/github/spec…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[win11上wsl本地安装版本ubuntu25.10]]></title>    <link>https://juejin.cn/post/7574848503731929134</link>    <guid>https://juejin.cn/post/7574848503731929134</guid>    <pubDate>2025-11-21T11:11:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574848503731929134" data-draft-id="7574991051435311114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="win11上wsl本地安装版本ubuntu25.10"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T11:11:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Livingbody"/> <meta itemprop="url" content="https://juejin.cn/user/4213771487417944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            win11上wsl本地安装版本ubuntu25.10
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4213771487417944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Livingbody
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T11:11:02.000Z" title="Fri Nov 21 2025 11:11:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.安装wsl2</h2>
<pre><code class="hljs language-cmd" lang="cmd">   dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
   dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
   wsl --set-default-version 2
   
</code></pre>
<h2 data-id="heading-1">2.下载镜像</h2>
<p>从163镜像下载
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmirrors.163.com%2Fubuntu-releases%2F25.10%2Fubuntu-25.10-wsl-amd64.wsl" target="_blank" title="https://mirrors.163.com/ubuntu-releases/25.10/ubuntu-25.10-wsl-amd64.wsl" ref="nofollow noopener noreferrer">mirrors.163.com/ubuntu-rele…</a>
速度很快，1分钟不到即可完成。</p>
<h2 data-id="heading-2">3.使用wsl命令安装</h2>
<pre><code class="hljs language-cmd" lang="cmd">   cd .\Downloads\
   wsl --install --from-file .\ubuntu-25.10-wsl-amd64.wsl
   
   
  Linux gaint 6.6.87.2-microsoft-standard-WSL2 #1 SMP PREEMPT_DYNAMIC Thu Jun  5 18:30:46 UTC 2025 x86_64 GNU/Linux   
</code></pre>
<p>安装完成</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9efd92b3b591477086770cbbab1c1c47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGl2aW5nYm9keQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764328262&amp;x-signature=%2FCiutyPN4GAHCth9Ao915genr%2Bg%3D" alt="ScreenShot_2025-11-21_191012_647.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面向电力生产调度系统的数据库实践：从时序处理到多中心容灾]]></title>    <link>https://juejin.cn/post/7574996958516314131</link>    <guid>https://juejin.cn/post/7574996958516314131</guid>    <pubDate>2025-11-21T10:04:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574996958516314131" data-draft-id="7574892669375234102" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面向电力生产调度系统的数据库实践：从时序处理到多中心容灾"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-21T10:04:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面向电力生产调度系统的数据库实践：从时序处理到多中心容灾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:04:13.000Z" title="Fri Nov 21 2025 10:04:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45b009beeabc40b580f87778be5842f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=IW6TRcbyd8wpjZPJPf3josShveY%3D" alt="640.gif" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p>电力生产与调度系统，说白了就是一套典型的“高并发、高可靠、高安全”的关键基础设施。机组运行、DCS/EMS/SCADA 监控、负荷预测、现货交易这些业务，时时刻刻都在产生高频数据流，而且要 7×24 小时不间断地稳定运行。随着“中长期+现货”电力市场的推进，以及新能源并网规模不断扩大，行业对数据库的要求也水涨船高——事务性能要更强、时序写入要更稳、跨区域同步和容灾切换要更快更可靠，安全与合规也必须做到位。</p>
<p>这几年，金仓数据库（KingbaseES）在电力行业的核心系统里持续上车——不管是发电企业的生产运行核心系统，还是国家电网的智能调度系统、现货交易辅助决策系统，都有它的身影。基于这些落地，我们也积累了一套能拿得出手的工程方法论。下面我会结合技术能力与行业案例做一次系统梳理，并给出贴近业务场景的实现示例。</p>
<p>@[toc]</p>
<h2 data-id="heading-1">金仓数据库的介绍</h2>
<p>金仓数据库管理系统 KingbaseES（简称 KES）是一款面向关键应用的企业级通用融合数据库。它既能撑起事务处理，也能胜任数据分析和海量时序数据的采集与检索，互联网场景同样不在话下。落到具体应用上，管理信息系统、业务与生产系统、决策支持、多维分析、运行日志、全文检索、地理信息系统（GIS）、时序数据处理等，都可以把 KES 作为可靠的数据库底座。</p>
<ul>
<li>生态与兼容：对 Oracle/MySQL 的模式兼容持续完善，接口覆盖 JDBC/ODBC/.NET；工具链也很齐（KDTS 迁移、KStudio 开发、KFS 异构同步等），迁移与集成的成本显著降低。</li>
<li>行业落地：在电力、政务、金融、通信等重点行业沉淀了大量最佳实践，长期稳定支撑国家电网电力调度系统；具备多中心容灾与并行复制能力，适配国产 CPU/OS 与主流云平台部署。</li>
<li>安全与合规：通过多项权威安全认证（含商用密码认证、EAL4+ 等），支持纵深防御与完善审计，能够满足高安全关键业务的合规要求。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4047ae4d769d4eef8fce62757f041c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=4cLotSneUVXZopXZiD9gsKI1Z08%3D" alt="e3eea818365b9bdc4d9ce82fc8268cfb.png" loading="lazy"/></p>
<h2 data-id="heading-2">技术解读（结合电力场景）</h2>
<h3 data-id="heading-3">架构与高可用</h3>
<p>多层次高可用方面，主备，读写分离以及多活共享存储（RAC）均能搭建，计划内时可执行滚动升级，碰到计划外故障时能够快速察觉并切换，系统连续性因而更为有保障。</p>
<p>两地三中心容灾机制下，利用并行流复制并结合日志分析来做逻辑同步，同城的双中心就能达成 RPO 约等于 0 ，其 RTO 时间接近秒级别。对于异地灾备而言，RPO 也可以被限制在秒级别之内，这符合电力核心系统的需求。</p>
<p>统一性能与健康监测功能可给出近即时负载及历史会话报告，其从主机/ OS / 数据库 / 会话等诸多层面执行全方位监测，有益于找出性能瓶颈，并为容量规划给予参考。</p>
<h3 data-id="heading-4">高并发与高吞吐</h3>
<ul>
<li>MVCC 并发控制：在高并发场景下有效减少读写锁竞争，既保吞吐又保事务隔离。</li>
<li>区分与执行方案改良：按照时间或者业务方面实施分区裁剪，把索引和方案缓存融合起来，可以缩减事务的响应时间，特别适合海量时序的写入和查询操作。</li>
<li>快速加载与批量写入：具备 COPY/批处理等能力，在机组遥测，计量采集，交易日志入库这些场景下会大幅加快速度。</li>
</ul>
<h3 data-id="heading-5">安全与合规</h3>
<ul>
<li>访问控制与审计：身份鉴别、权限控制、审计体系完善，能够满足等保与行业监管要求。</li>
<li>加密与传输安全：基于 SSL/TLS 的可信传输，配合国密算法，静态与传输数据的安全防护一并覆盖。</li>
</ul>
<h3 data-id="heading-6">生态兼容与迁移</h3>
<ul>
<li>模式兼容：对 Oracle/MySQL 的常用语法与接口进行适配，迁移改造的工作量更可控。</li>
<li>工具与方法：借助 KDTS 做结构与数据迁移，配合 KFS/FlySync 做异构同步；迁移策略遵循“评估—改造—并行验证—切换—运维优化”的全周期流程。</li>
</ul>
<h3 data-id="heading-7">贴近场景的实现示例</h3>
<p>下面的示例围绕发电企业与电网侧的典型需求展开：高频时序数据写入、分区管理、跨区同步与安全控制，以及业务数据的批量入库。</p>
<h4 data-id="heading-8">1）时序分区与高频写入</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> telemetry (
  point_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  ts <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  val <span class="hljs-type">numeric</span>(<span class="hljs-number">12</span>,<span class="hljs-number">4</span>),
  quality <span class="hljs-type">smallint</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (point_id, ts)
) <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (ts);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> telemetry_2025_11
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> telemetry
  <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-11-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2025-12-01'</span>);

<span class="hljs-keyword">CREATE</span> INDEX idx_telemetry_2025_11_ts <span class="hljs-keyword">ON</span> telemetry_2025_11 (ts);
<span class="hljs-keyword">CREATE</span> INDEX idx_telemetry_2025_11_point <span class="hljs-keyword">ON</span> telemetry_2025_11 (point_id);
</code></pre>
<p>批量写入示例：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">COPY</span> telemetry (point_id, ts, val, quality)
<span class="hljs-keyword">FROM</span> STDIN <span class="hljs-keyword">WITH</span> (FORMAT csv);
</code></pre>
<p>按月维护分区与归档：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> telemetry DETACH <span class="hljs-keyword">PARTITION</span> telemetry_2025_05;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> telemetry_2025_05;
</code></pre>
<h4 data-id="heading-9">2）跨区逻辑同步（同城双中心 + 异地灾备）</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> PUBLICATION pub_telemetry <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">TABLE</span> telemetry;

<span class="hljs-keyword">CREATE</span> SUBSCRIPTION sub_telemetry
CONNECTION <span class="hljs-string">'host=dr-site.example.com port=54321 dbname=power user=replicator password=***'</span>
PUBLICATION pub_telemetry
<span class="hljs-keyword">WITH</span> (create_slot <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>, copy_data <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>, enabled <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-10">3）行级安全（RLS）控制示例</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> spot_bid ENABLE <span class="hljs-type">ROW</span> LEVEL SECURITY;

<span class="hljs-keyword">CREATE</span> POLICY p_user_read
<span class="hljs-keyword">ON</span> spot_bid
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span>
<span class="hljs-keyword">USING</span> (owner_id <span class="hljs-operator">=</span> current_setting(<span class="hljs-string">'app.user_id'</span>)::<span class="hljs-type">int</span>);

<span class="hljs-keyword">SET</span> app.user_id <span class="hljs-operator">=</span> <span class="hljs-string">'10001'</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> spot_bid;
</code></pre>
<h4 data-id="heading-11">4）JDBC 批量入库（KingbaseES 官方驱动）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.sql.*;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchInsertExample</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
    Class.forName(<span class="hljs-string">"com.kingbase8.Driver"</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:kingbase8://db-primary:54321/power"</span>;
    <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(url, <span class="hljs-string">"system"</span>, <span class="hljs-string">"secret"</span>)) {
      conn.setAutoCommit(<span class="hljs-literal">false</span>);
      <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"INSERT INTO telemetry(point_id, ts, val, quality) VALUES (?, ?, ?, ?)"</span>;
      <span class="hljs-keyword">try</span> (<span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql)) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) {
          ps.setInt(<span class="hljs-number">1</span>, i % <span class="hljs-number">1000</span>);
          ps.setTimestamp(<span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Timestamp</span>(System.currentTimeMillis()));
          ps.setBigDecimal(<span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.math.BigDecimal(<span class="hljs-string">"123.4567"</span>));
          ps.setShort(<span class="hljs-number">4</span>, (<span class="hljs-type">short</span>)<span class="hljs-number">1</span>);
          ps.addBatch();
          <span class="hljs-keyword">if</span> (i % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>) {
            ps.executeBatch();
          }
        }
        ps.executeBatch();
      }
      conn.commit();
    }
  }
}
</code></pre>
<p>这个 Java 示例使用的是 KingbaseES 官方 JDBC 驱动 <code>com.kingbase8.Driver</code>，连接串写成 <code>jdbc:kingbase8://host:port/database</code>，默认端口为 <code>54321</code>；在生产环境里可以结合读写分离与多节点部署策略。</p>
<h2 data-id="heading-12">案例分析</h2>
<h3 data-id="heading-13">发电行业五大生产运行核心系统上线</h3>
<ul>
<li>发电行业“五大生产运行核心系统”完成国产数据库上线，底层采用金仓数据库，既验证了其工程可靠性，也展现了在发电企业核心场景下的高安全适配能力。</li>
<li>价值点：满足高频数据入库与分析、统一账务与生产管理、跨系统协同与审计追溯，为集团级运行指挥与资源优化提供坚实的数据底座。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46125fd339f245518d350011938d9cc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=hmX5I0v1bVT6pdwmCpxHxUIFhnE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">大唐集团：电力现货交易辅助决策系统</h3>
<p>在“中长期 + 现货”这种模式之下，交易品种变得更多，交易的频率也大幅加强，集团总部必要做到统一而高效地去指挥调度，还要执行资源的改良工作，省公司以及基层单位得要预先判别市场的供需状况和负荷情况，从而迅速应对节点竞价以及区域竞争。</p>
<p>技术要点在于，该系统形成于集团统一平台之上，其职责是给予现货交易辅助决策，金仓数据库则承担起交易数据接入，计算结果归档以及报表生成这些重要任务，从而减轻了用户对于国产数据库存在并发吞吐量小和响应迟缓的忧虑。</p>
<p>效果：系统运行平稳，数据处理效率显著提升，帮助企业实现营销经济利益最大化，并保障业务连续性。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c4117c0a8654d13b53107b6ffcb4d75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=sE27CW14cBQP9qVlFsE%2BOxWgDSc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-15">国家电网：智能电网调度控制系统（国产化迁移）</h3>
<ul>
<li>项目特点：数据录入高频、持续且可靠；安全要求高；定制化需求包括宽表支持、大并发高吞吐与跨区同步。原 Open3000 基于 Oracle，需完成国产化迁移。</li>
<li>技术实现：以 KingbaseES 为底层数据库，构建跨区域同步与多中心容灾；适配宽表与高并发写入，通过工具链与模式兼容实现从 Oracle 的平滑替代与应用改造。</li>
<li>支撑情况：长期稳定支撑智能调度控制业务，满足 7×24 小时运行与关键业务的合规要求。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2179148d76f640209907ff227a0b00bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=hPKyWfnHZlKP7VqSrda69VCSbWs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68e6b27412ef41c2876d7fbc004cacba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324253&amp;x-signature=06UPiT22mj%2BQGjj1AXy4R1OxAw4%3D" alt="741c43759b85d02c8a8c189b764f4180.png" loading="lazy"/></p>
<h2 data-id="heading-16">结语</h2>
<p>电力行业做数据库选型，不只是看几项性能指标，更看工程能否落地以及全生命周期的保障。金仓数据库在发电与电网核心场景的持续实践表明：在高并发写入、跨区同步与容灾、安全合规、生态适配等方面，已经具备产业级的可用能力。配合分区与批量入库的建模策略、逻辑复制与两地三中心架构、行级安全与完整审计，完全可以在现有 IT 条件下，循序渐进地把关键模块到核心系统实现国产化替代与能力升级。</p>
<h2 data-id="heading-17">参考资料</h2>
<ul>
<li>KingbaseES 产品手册（JDBC）：<code>https://help.kingbase.com.cn/v8.6.7.12/development/client-interfaces/jdbc/jdbc-2.html</code></li>
<li>金仓数据库行业百科与最佳实践（墨天轮）：<code>https://www.modb.pro/wiki/13</code></li>
<li>KingbaseES 版本与能力脉络（SegmentFault）：<code>https://segmentfault.com/a/1190000045324574</code></li>
<li>电力现货交易辅助决策系统（大唐集团）：<code>https://www.kingbase.com.cn/case2/details_568_30126.html</code></li>
<li>智能电网调度控制系统（国家电网）：<code>https://www.kingbase.com.cn/case1/details_568_22561.html</code></li>
<li>资讯报道：发电行业“五大生产运行核心系统”上线（微信）：<code>http://mp.weixin.qq.com/s?__biz=MjM5NjgwMDMxMg==&amp;mid=2652201033&amp;idx=1&amp;sn=2eeae7735c0c412ba078678e9ecdb657&amp;chksm=bce15129f099d0c230f0528db3b20fdaaaae5a93bd9abef12aa334a7ff8738674530a221c0ae&amp;scene=27#wechat_redirect</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[并发丢数据深度剖析：JED的锁机制与事务实战踩坑及解决方案]]></title>    <link>https://juejin.cn/post/7574817463449255987</link>    <guid>https://juejin.cn/post/7574817463449255987</guid>    <pubDate>2025-11-21T10:11:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574817463449255987" data-draft-id="7574991051435163658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="并发丢数据深度剖析：JED的锁机制与事务实战踩坑及解决方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T10:11:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            并发丢数据深度剖析：JED的锁机制与事务实战踩坑及解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:11:07.000Z" title="Fri Nov 21 2025 10:11:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、理论来源于实践</h2>
<p><strong>现象</strong>：于2025-08-13 21:45:35，事实逻辑表将自身的指标与维度同步到原子服务的实现时，出现同步过来的指标与维度丢失。</p>
<p><strong>核心原因</strong>：两次重复的事实逻辑表同步时间非常相近，导致同步过来的指标与维度丢失。</p>
<p>﻿</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d1a930f468b4c73abba942fc5e15c98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=SpF6bFOxb2wrzSX8H49brUzGBuI%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<h2 data-id="heading-1">2、倒带进事故现场</h2>
<p>逻辑表向原子服务同步的核心逻辑是 “先删后增”：删除旧数据→对比新老数据→插入新增数据，具体流程如下：</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecc2396cd39d43428e13d24cf1e296c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=Jx0dqZFg1hb6%2FnYECiYiTjdTq3k%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>整体业务代码精简逻辑如下：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Transactional</span>(rollbackFor = Exception.class)
public Map&lt;String, Object&gt; driveToAtomService(Map logicTableData, String erp) {
<span class="hljs-comment">//获得环境信息</span>
String env = driveLogicTable<span class="hljs-selector-class">.getString</span>(DRIVE_LOGIC_TABLE_ENV);
<span class="hljs-comment">//获取/更新实现id</span>
 Long logicTableId = <span class="hljs-built_in">getOrAddLogicTableId</span>(atomicServiceId, driveLogicTable, erp, EnvType.of(env));
<span class="hljs-comment">//删除关联指标</span>
 metricImplMapper<span class="hljs-selector-class">.deleteByLogicTableIds</span>(Collections.singletonList(logicId));
<span class="hljs-comment">//获取请求中的所有的指标信息</span>
List&lt;MetricImplBO&gt; metricList = <span class="hljs-built_in">getMetricImpls</span>(logicTableData, logicTableId);
<span class="hljs-comment">//获取需要新增的指标实现(包含了查询库里现有的指标实现)</span>
List&lt;MetricImplRelBO&gt; metricImpls = metricImplMapper<span class="hljs-selector-class">.getMetricImpls</span>(logicTableId);
Set&lt;Long&gt; metricDefIdSet = metricImpls<span class="hljs-selector-class">.stream</span>()
            <span class="hljs-selector-class">.map</span>(MetricImplRelBO::getMetricDefId)<span class="hljs-selector-class">.collect</span>(Collectors.toSet());
List&lt;MetricImplBO&gt; addList = metricList<span class="hljs-selector-class">.stream</span>()
            <span class="hljs-selector-class">.filter</span>(s -&gt; !metricDefIdSet.contains(s.getMetricDefId()))<span class="hljs-selector-class">.collect</span>(Collectors.toList());
<span class="hljs-comment">//将需要新增的指标实现插入数据库</span>
 <span class="hljs-built_in">addMetricImpl</span>(addList);

}
</code></pre>
<p>用一个请求进行举例：</p>
<p>共计15个指标，64个维度</p>


















































































<table><thead><tr><th>请求1(事务)</th><th>请求2(事务)</th><th>﻿</th><th/><th/></tr></thead><tbody><tr><td>21:06:17.262</td><td>进入同步方法</td><td>21:06:17.263</td><td>进入同步方法</td><td>﻿</td></tr><tr><td>21:06:17.063</td><td>select unify_metric_impl where logic_id = 3245 查询出15条数据(快照读，readview1)</td><td>21:06:17.363</td><td>select unify_metric_impl where logic_id = 3245 查询出15条数据(快照读，readview2)</td><td>﻿</td></tr><tr><td>21:06:17.363</td><td>delete from unify_metric_impl where logic_id = 3245</td><td>21:06:17.372</td><td>delete from unify_metric_impl where logic_id = 3245</td><td>﻿</td></tr><tr><td>21:06:17.459</td><td>select unify_metric_impl where logic_id = 3245 查询出0条数据</td><td>﻿</td><td>delete 由于logic_id不是索引，会表锁阻塞</td><td>﻿</td></tr><tr><td>21:06:18.459</td><td>insert into unify_metric_impl 插入的logic_id = 3245的数据，15条</td><td>﻿</td><td>﻿</td><td>﻿</td></tr><tr><td>21:06:19.408</td><td>方法结束</td><td>﻿</td><td>﻿</td><td>﻿</td></tr><tr><td>﻿</td><td>﻿</td><td>21:06:19.529</td><td>删除成功</td><td>﻿</td></tr><tr><td>﻿</td><td>﻿</td><td>21:06:20.362</td><td>select unify_metric_impl where logic_id = 3245 得到 15条数据</td><td>﻿</td></tr><tr><td>﻿</td><td>﻿</td><td>21:06:20.435</td><td>读出15条数据，比较本次是否有新增指标， 得出没有新增指标，因此不进行新增。addAtomicMetricNameForDrive addList empty</td><td>﻿</td></tr><tr><td>﻿</td><td>﻿</td><td>21:06:21.435</td><td>方法结束</td><td>﻿</td></tr></tbody></table>
<p>﻿</p>
<p><strong>核心结论点</strong>：</p>
<p>1.请求2的删除操作被阻塞了，直到请求1执行完整个方法。</p>
<p>2.请求2中去查看当前实现的指标的时候，发现库里已经存在所有指标不会进行新增，与上一步删除的逻辑相悖。</p>
<p>﻿</p>
<h2 data-id="heading-2">3、结论点深度剖析</h2>
<h3 data-id="heading-3">3.1 分析结论一</h3>
<p>请求2的删除操作被阻塞了，直到请求1执行完整个方法。</p>
<h4 data-id="heading-4">3.1.1 复习JED(京东自研数据库)的锁机制</h4>
<h5 data-id="heading-5">3.1.1.1 不是“一把锁”，而是 “锁矩阵”</h5>



































<table><thead><tr><th>锁粒度</th><th>共享锁（S 锁） （读锁，允许多读）</th><th>排他锁（X 锁） （写锁，独占）</th><th>意向锁（表级，辅助判断）</th></tr></thead><tbody><tr><td><strong>表级</strong></td><td>表 S 锁（极少用，如<code>LOCK TABLES ... READ</code>）</td><td>表 X 锁（极少用，如<code>LOCK TABLES ... WRITE</code>）</td><td>意向 S 锁（IS）、意向 X 锁（IX）</td></tr><tr><td><strong>行级</strong></td><td>行 S 锁（<code>SELECT ... FOR SHARE</code>）</td><td>行 X 锁（<code>UPDATE/DELETE/INSERT</code>默认加）</td><td>（行锁无需意向锁）</td></tr><tr><td><strong>间隙级</strong></td><td>间隙 S 锁（无，间隙只防插入）</td><td>间隙 X 锁（防其他事务插入相同间隙）</td><td>无</td></tr><tr><td><strong>Next-Key</strong></td><td>无</td><td>Next-Key 锁（行锁 + 间隙锁，默认行锁算法）</td><td>无</td></tr></tbody></table>
<p>﻿</p>
<h5 data-id="heading-6">3.1.1.2 一张图总结：锁的 “决策逻辑”</h5>
<p>﻿</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02c2c30e567f41f98e89d2ebb08315a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=Kfoez49CE2SG5dlaN9Beo7HY6ZI%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<h4 data-id="heading-7">3.1.2 理论应用实践</h4>
<h5 data-id="heading-8">3.1.2.1 本次事故的物料：</h5>
<p>JED的表结构：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">CREATE</span> <span class="hljs-selector-tag">TABLE</span> `<span class="hljs-selector-tag">unify_metric_impl</span>` (
  <span class="hljs-built_in">`id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">50</span>) unsigned <span class="hljs-keyword">NOT</span> NULL AUTO_INCREMENT COMMENT <span class="hljs-string">'自增ID'</span>,
  <span class="hljs-built_in">`metric_def_id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">11</span>) unsigned <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'指标定义id'</span>,
  <span class="hljs-built_in">`logic_table_id`</span> <span class="hljs-built_in">bigint</span>(<span class="hljs-number">11</span>) unsigned <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'逻辑表id'</span>,
  <span class="hljs-built_in">`name_en_atomic`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'真实指标名'</span>,
  <span class="hljs-built_in">`committer`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'负责人'</span>,
  <span class="hljs-built_in">`create_time`</span> timestamp <span class="hljs-keyword">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="hljs-string">'开始时间'</span>,
  <span class="hljs-built_in">`update_time`</span> timestamp <span class="hljs-keyword">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT <span class="hljs-string">'修改时间'</span>,
  <span class="hljs-built_in">`metric_atomic_name_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'原子指标id'</span>,
  <span class="hljs-built_in">`decorate_id_list_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'修饰列表'</span>,
  <span class="hljs-built_in">`name_cn_alias_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'中文别名'</span>,
  <span class="hljs-built_in">`metric_type_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'指标类型：DERIVE 衍生指标，FORMULA 复合指标'</span>,
  <span class="hljs-built_in">`description_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'指标说明'</span>,
  <span class="hljs-built_in">`data_type_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'数据类型：STRING，DOUBLE, LONG, INT'</span>,
  <span class="hljs-built_in">`data_accuracy_temp`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'2'</span> COMMENT <span class="hljs-string">'数据精度-小数点后几位'</span>,
  <span class="hljs-built_in">`security_level_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">'-1'</span> COMMENT <span class="hljs-string">'安全等级'</span>,
  <span class="hljs-built_in">`logic_table_id_excel_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">'-1'</span> COMMENT <span class="hljs-string">'模型excelId'</span>,
  <span class="hljs-built_in">`implement_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'指标实现类型：APP、ATOMIC 原子服务'</span>,
  <span class="hljs-built_in">`app_ori_metric_name_temp`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'所依赖的app层原始名字（适用于导数任务改变字段的情况）'</span>,
  <span class="hljs-built_in">`name_en_depend_atomic`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'指标依赖字段'</span>,
  <span class="hljs-built_in">`name_en_depend_app`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">16</span>) DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'所依赖的app层原始名字（适用于导数任务改变字段的情况）'</span>,
  <span class="hljs-built_in">`update_status`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'信息更新状态 0-未完成更新，1-完成更新'</span>,
  <span class="hljs-built_in">`status`</span> <span class="hljs-built_in">tinyint</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'信息更新状态 0-未完成更新，1-完成更新'</span>,
  <span class="hljs-built_in">`light_decorate_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'点灯修饰id列表'</span>,
  <span class="hljs-built_in">`extend_decorate_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'支持的动态修饰id列表'</span>,
  <span class="hljs-built_in">`extend_function_id_list`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'支持的原子服务函数id列表'</span>,
  <span class="hljs-built_in">`aggregation_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'聚合类型:ORIGINAL 原值 COUNT 计数 DISTINCT 指定字段去重 SUM 求和 AVG  均值 MIN 求最大值 MAX 求最小值 QUANTITLE 求分位数'</span>,
  <span class="hljs-built_in">`middle_aggregation_type`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'中间层类型,UNKNOWN:未知,AGG_BY_FIELD:按聚合字段分组后聚合,AGG_BY_DAY:按天去重后累加'</span>,
  <span class="hljs-built_in">`static_decorate_id_list_combination`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> NULL DEFAULT <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'支持的固化修饰id列表组合,[[d1,d2],[d2]]'</span>,
  PRIMARY KEY (<span class="hljs-built_in">`id`</span>),
  KEY <span class="hljs-built_in">`idx_metric_def_id`</span> (<span class="hljs-built_in">`metric_def_id`</span>,<span class="hljs-built_in">`logic_table_id`</span>)
);
</code></pre>
<h5 data-id="heading-9">3.1.2.2 实践分析</h5>
<p>通过JED的锁决策，可以得出</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">//删除关联指标</span>
 <span class="hljs-selector-tag">metricImplMapper</span><span class="hljs-selector-class">.deleteByLogicTableIds</span>(Collections.<span class="hljs-built_in">singletonList</span>(logicId));
</code></pre>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">delete <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-title">in</span> (<span class="hljs-params"><span class="hljs-number">45631</span></span>)</span>;
</code></pre>
<p>JED的索引：KEY <code>idx_metric_def_id</code> (<code>metric_def_id</code>,<code>logic_table_id</code>)</p>
<p>删除写操作，不符合最左匹配原则，因此为表x锁。</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd92beff5a3a4a24a64fa98ee2b8bbb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=xBk4Go6g0L5JIj4tGcunLoWs%2BJI%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>因此请求2的删除操作需要等待请求1的事务释放表锁后才可继续进行，符合当时场景。</p>
<p>﻿</p>
<h3 data-id="heading-10">3.2 分析结论二</h3>
<p>请求2中去查看当前实现的指标的时候，发现库里已经存在所有指标不会进行新增，与上一步删除的逻辑相悖。</p>
<h4 data-id="heading-11">3.2.1 复习JED的事务</h4>
<h5 data-id="heading-12">3.2.1.1 ACID 不是 "四个独立特性"，而是 "因果链"</h5>
<p>﻿</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63952d445b014f019a3bde75b5fe42fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=0N5KKTNtBD11Wt0W7erpOyxT4Ow%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>•<strong>一句话</strong>：ACID 的核心是<strong>一致性</strong>，其他三个特性都是为了实现它的手段。</p>
<p>•<strong>一致性</strong>（Consistency）：一致性确保事务将数据库从一个一致的状态转变到另一个一致的状态。即使在多个事务同时执行的情况下，数据库也能保持数据的一致性。</p>
<p>•<strong>原子性</strong>（Atomicity）：事务是 "不可分割的工作单元"（要么全成，要么全败），是一致性的<strong>前提</strong>（如果步骤能拆分，中间失败就会破坏一致性）。</p>
<p>•<strong>隔离性</strong>（Isolation）：通过控制多事务并发规则，避免互相干扰，是一致性的<strong>保障</strong>（并发混乱会直接破坏一致性）。</p>
<p>•<strong>耐久性</strong>（Durability）：事务提交后结果永久保存，是一致性的<strong>最终落点</strong>（否则重启后数据丢失，之前的一致性白搭）。</p>
<p>﻿</p>
<h5 data-id="heading-13">3.2.1.2 隔离级别：不是 "越严越好"，而是 "成本与需求的平衡术"</h5>
<p>JED 的 4 种隔离级别，本质是用 "数据可见性" 换 "并发性能"的选择：</p>








































<table><thead><tr><th>隔离级别</th><th>解决的问题</th><th>无法解决的问题</th><th>性能消耗</th><th>典型场景</th></tr></thead><tbody><tr><td>读未提交（RU）</td><td>无</td><td>脏读、不可重复读、幻读</td><td>极低</td><td>实时监控（允许脏数据）</td></tr><tr><td>读已提交（RC）</td><td>脏读</td><td>不可重复读、幻读</td><td>低</td><td>互联网普通业务</td></tr><tr><td>可重复读（RR，默认）</td><td>脏读、不可重复读</td><td>幻读（被 Next-Key 锁解决）</td><td>中</td><td>金融交易、库存管理</td></tr><tr><td>串行化（Serializable）</td><td>所有并发问题</td><td>无</td><td>极高</td><td>银行对账（无并发需求）</td></tr></tbody></table>
<p>﻿</p>
<h5 data-id="heading-14">3.2.1.3 MVCC：事务的 "平行宇宙" 机制（为什么读写不冲突？）</h5>
<p><strong>多版本并发控制</strong>是 "无锁读" 的核心，它让读和写像在平行宇宙中运行：</p>
<p><strong>底层逻辑（用 "时间戳" 理解</strong>）：</p>
<p>•每个事务启动时，会拿到一个<strong>全局递增的事务 ID（trx_id）</strong> 。</p>
<p>•每行数据隐藏 3 个字段：</p>
<p>◦<code>DB_TRX_ID</code>：最后修改该行的事务 ID；</p>
<p>◦<code>DB_ROLL_PTR</code>：指向 undo 日志的指针（存储历史版本）；</p>
<p>◦<code>DB_DELETED</code>：标记是否删除（逻辑删除）。</p>
<p><strong>读操作的 "幻术"</strong> ：</p>
<p>•<strong>快照读</strong>（普通 SELECT）：只看 "事务 ID ≤ 自己 ID" 且 "未被删除" 的版本，完全不加锁。 例：事务 A（ID=100）查询时，会忽略所有被 ID&gt;100 的事务修改的数据。</p>
<p>包含 4 个核心字段：</p>
<p>•<code>m_ids</code>：生成 Read View 时，<strong>当前活跃的事务 ID 列表</strong>（未提交的事务）。</p>
<p>•<code>min_trx_id</code>：<code>m_ids</code>中最小的事务 ID。</p>
<p>•<code>max_trx_id</code>：下一个将要分配的事务 ID（非活跃事务 ID，仅用于判断 “未来事务”）。</p>
<p>•<code>creator_trx_id</code>：生成该 Read View 的事务自身 ID。</p>
<p><strong>可见性判断规则</strong>（一条记录是否对当前事务可见，取决于其 “最后修改事务 ID”，记为<code>db_trx_id</code>）：</p>
<p>1.若db_trx_id == creator_trx_id：可见（自己修改的自己可见）。</p>
<p>2.若db_trx_id &lt; min_trx_id：可见（修改记录的事务在当前快照生成前已提交）。</p>
<p>3.若db_trx_id &gt;= max_trx_id：不可见（修改记录的事务在当前快照生成后才启动）。</p>
<p>4.若min_trx_id ≤ db_trx_id &lt; max_trx_id：</p>
<p>◦若db_trx_id在m_ids中：不可见（该事务仍活跃，未提交）。</p>
<p>◦若db_trx_id不在m_ids中：可见（该事务已提交）。</p>
<p>5.当前读（加锁读 / 写操作）：读取最新版本，并加锁防止其他事务修改。</p>
<h5 data-id="heading-15">3.2.1.4 事务日志："安全与性能" 平衡术</h5>
<p>事务能既保证 durability 又不慢，全靠两大日志：</p>
<p>1.<strong>redo log（重做日志）</strong> ：</p>
<p>◦作用：崩溃后恢复未写入磁盘的数据（保证 durability）。</p>
<p>◦反直觉：事务提交时，数据先写 redo log（内存 + 磁盘），再异步刷到数据文件（这叫 WAL 技术）。</p>
<p>◦为什么快？redo log 是<strong>顺序写</strong>（磁盘顺序写比随机写快 100 倍 +）。</p>
<p>2.<strong>undo log（回滚日志）</strong> ：</p>
<p>◦作用：保存数据修改前的版本，用于事务回滚（保证 atomicity）和 MVCC 快照读。</p>
<p>◦注意：undo log 会被 purge 线程定期清理（当没有事务需要旧版本时）。</p>
<h5 data-id="heading-16">3.2.1.5 终极心法：事务设计的 "3 个凡是"</h5>
<p>1.<strong>凡是不需要事务的操作，坚决不用</strong>（如日志插入可关闭自动提交，批量提交）。</p>
<p>2.<strong>凡是能在 RC 解决的，绝不升 RR</strong>（互联网业务优先选 RC，用业务逻辑防不可重复读）。</p>
<p>3.<strong>凡是大事务，必拆分成 "读 - 算 - 写" 三步</strong>（读阶段不加锁，算阶段在应用层，写阶段用最短事务加锁）。</p>
<p>记住：事务的本质不是 "约束"，而是 "工具"—— 能解决问题的最简单事务，才是最好的事务。</p>
<p>﻿</p>
<h4 data-id="heading-17">3.2.2 理论应用实践</h4>
<h5 data-id="heading-18">3.2.2.1 本次事故的物料：</h5>
<p>表的事务等级：</p>
<pre><code class="hljs language-scss" lang="scss">SELECT @<span class="hljs-keyword">@transaction</span>_isolation;
</code></pre>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/326dd49249a04d45a256c06cc1341235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=LSNnpm%2FcOS2xUS1hfYRe3XDgkgA%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>需要删除的指标实现(根据实现id):</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">delete <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-title">in</span> (<span class="hljs-params"><span class="hljs-number">45631</span></span>)</span>;
</code></pre>
<p>需要插入的指标实现：</p>
<pre><code class="hljs language-go" lang="go">INSERT INTO <span class="hljs-string">`unify_metric_impl`</span> (<span class="hljs-string">`id`</span>, <span class="hljs-string">`metric_def_id`</span>, <span class="hljs-string">`logic_table_id`</span>, <span class="hljs-string">`name_en_atomic`</span>, <span class="hljs-string">`committer`</span>, <span class="hljs-string">`create_time`</span>, <span class="hljs-string">`update_time`</span>, <span class="hljs-string">`metric_atomic_name_temp`</span>, <span class="hljs-string">`decorate_id_list_temp`</span>, <span class="hljs-string">`name_cn_alias_temp`</span>, <span class="hljs-string">`metric_type_temp`</span>, <span class="hljs-string">`description_temp`</span>, <span class="hljs-string">`data_type_temp`</span>, <span class="hljs-string">`data_accuracy_temp`</span>, <span class="hljs-string">`security_level_temp`</span>, <span class="hljs-string">`logic_table_id_excel_temp`</span>, <span class="hljs-string">`implement_type`</span>, <span class="hljs-string">`app_ori_metric_name_temp`</span>, <span class="hljs-string">`name_en_depend_atomic`</span>, <span class="hljs-string">`name_en_depend_app`</span>, <span class="hljs-string">`update_status`</span>, <span class="hljs-string">`status`</span>, <span class="hljs-string">`light_decorate_id_list`</span>, <span class="hljs-string">`extend_decorate_id_list`</span>, <span class="hljs-string">`extend_function_id_list`</span>, <span class="hljs-string">`aggregation_type`</span>, <span class="hljs-string">`middle_aggregation_type`</span>, <span class="hljs-string">`static_decorate_id_list_combination`</span>)
VALUES
	(<span class="hljs-number">1358195</span>, <span class="hljs-number">19872</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358196</span>, <span class="hljs-number">19873</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358197</span>, <span class="hljs-number">19875</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358198</span>, <span class="hljs-number">19945</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_sku_deal_ord_sku_dis_qtty_main_img_video_num'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358199</span>, <span class="hljs-number">17263</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358200</span>, <span class="hljs-number">28017</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_bd_bd_attendance_offline__store_cnt_bd_attendance_cnt'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'COUNT_DISTINCT'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358201</span>, <span class="hljs-number">20242</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358202</span>, <span class="hljs-number">18450</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358203</span>, <span class="hljs-number">20276</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_cnt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358204</span>, <span class="hljs-number">18452</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358205</span>, <span class="hljs-number">18453</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358206</span>, <span class="hljs-number">18456</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358207</span>, <span class="hljs-number">19866</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358208</span>, <span class="hljs-number">21691</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_include_moutai'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">1358209</span>, <span class="hljs-number">19871</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>);
</code></pre>
<h5 data-id="heading-19">3.2.2.2 实践分析：</h5>
<p>用sql模拟两个事务的执行过程：</p>
<p>事务1：</p>
<pre><code class="hljs language-javascript" lang="javascript">begin;

select * <span class="hljs-keyword">from</span> unify_metric_impl umi where logic_table_id =  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> unify_metric_impl where logic_table_id <span class="hljs-keyword">in</span> (<span class="hljs-number">45631</span>);

select * <span class="hljs-keyword">from</span> unify_metric_impl umi where logic_table_id =  <span class="hljs-number">45631</span>;

<span class="hljs-variable constant_">INSERT</span> <span class="hljs-variable constant_">INTO</span> <span class="hljs-string">`unify_metric_impl`</span> ( <span class="hljs-string">`metric_def_id`</span>, <span class="hljs-string">`logic_table_id`</span>, <span class="hljs-string">`name_en_atomic`</span>, <span class="hljs-string">`committer`</span>, <span class="hljs-string">`create_time`</span>, <span class="hljs-string">`update_time`</span>, <span class="hljs-string">`metric_atomic_name_temp`</span>, <span class="hljs-string">`decorate_id_list_temp`</span>, <span class="hljs-string">`name_cn_alias_temp`</span>, <span class="hljs-string">`metric_type_temp`</span>, <span class="hljs-string">`description_temp`</span>, <span class="hljs-string">`data_type_temp`</span>, <span class="hljs-string">`data_accuracy_temp`</span>, <span class="hljs-string">`security_level_temp`</span>, <span class="hljs-string">`logic_table_id_excel_temp`</span>, <span class="hljs-string">`implement_type`</span>, <span class="hljs-string">`app_ori_metric_name_temp`</span>, <span class="hljs-string">`name_en_depend_atomic`</span>, <span class="hljs-string">`name_en_depend_app`</span>, <span class="hljs-string">`update_status`</span>, <span class="hljs-string">`status`</span>, <span class="hljs-string">`light_decorate_id_list`</span>, <span class="hljs-string">`extend_decorate_id_list`</span>, <span class="hljs-string">`extend_function_id_list`</span>, <span class="hljs-string">`aggregation_type`</span>, <span class="hljs-string">`middle_aggregation_type`</span>, <span class="hljs-string">`static_decorate_id_list_combination`</span>)
<span class="hljs-variable constant_">VALUES</span>
	(<span class="hljs-number">19872</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19873</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19875</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19945</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_sku_deal_ord_sku_dis_qtty_main_img_video_num'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">17263</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">28017</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_bd_bd_attendance_offline__store_cnt_bd_attendance_cnt'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'COUNT_DISTINCT'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">20242</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18450</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">20276</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_app__ord_cnt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18452</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18453</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_user_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">18456</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_sku_dis_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19866</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_ord_amt_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">21691</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_deal_ord_ord_amt_include_moutai'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>),
	(<span class="hljs-number">19871</span>, <span class="hljs-number">45631</span>, <span class="hljs-string">'jdr_7fresh_trade_complete_ord_sku_qtty_deal_7fresh'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">'2025-09-02 09:23:41'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">'-1'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'4556,8012,8270,7247,7248,7249,7250,2134,7254,7255,5997,7867'</span>, <span class="hljs-string">'25,6,5,7,23,22,20,21,19,18,4,1,2,3,24'</span>, <span class="hljs-string">'toSql'</span>, <span class="hljs-string">'DEFAULT'</span>, <span class="hljs-string">''</span>);

commit;
</code></pre>
<p>﻿</p>
<p>事务2：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">begin</span>;

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> unify_metric_impl umi <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-operator">=</span>  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> unify_metric_impl <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-keyword">in</span> (<span class="hljs-number">45631</span>);

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> unify_metric_impl umi <span class="hljs-keyword">where</span> logic_table_id <span class="hljs-operator">=</span>  <span class="hljs-number">45631</span>;

<span class="hljs-keyword">commit</span>;
</code></pre>
<p>﻿</p>
<p>流程图(用一行数据进行演示版本控制)：</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0d9d2c99860406a9937e465477eeb92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324666&amp;x-signature=zi797ZwXL3vWGldl9xgALf%2B7qCQ%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>为何事务1的select查询出“为空”，事务2的select查询出“不为空”：</p>






























<table><thead><tr><th>对比维度</th><th>事务 1 查询（读自己的删除版本 V2）</th><th>事务 2 查询（读readview前的V1版本）</th></tr></thead><tbody><tr><td>自己生成的版本</td><td>V2（trx_id=17190，已删除）</td><td>V4（trx_id=17191，已删除）</td></tr><tr><td>对自己版本的处理</td><td>可见，且<strong>事务内需反映自己的删除操作</strong>，所以不追溯前驱 V1</td><td>不可见，但<strong>当前删除的版本是由其他事务得到(V3)</strong> ，并非在readview之前的数据。</td></tr><tr><td>追溯的终止条件</td><td>遇到自己生成的版本，即使已删除，也终止追溯</td><td>遇到自己生成的已删除版本，但不符合"有效删除"，需继续追溯</td></tr><tr><td>最终返回结果</td><td>v2（已删除版本，反映自己的删除操作）</td><td>V1（readview之前有效的版本）</td></tr></tbody></table>
<p>﻿</p>
<h2 data-id="heading-20">4.解决办法</h2>
<p>为了解决事务2的查询"不为空"的问题，分别列出以下方案：</p>

































<table><thead><tr><th>﻿</th><th>解决办法</th><th>优点</th><th>缺点</th><th>倾向</th></tr></thead><tbody><tr><td>方式1</td><td>针对同一个逻辑表的同步添加分布式锁</td><td>实现成本低，影响范围小</td><td>存在长事务的问题</td><td>短期解法</td></tr><tr><td>方式2</td><td>将事务2的select改为当前读(使用slecet...for update)，这样就能查询出最新的数据为空</td><td>实现成本低，</td><td>存在长事务的问题，影响范围大(长事务涉及逻辑多)</td><td>不推荐</td></tr><tr><td>方式3</td><td>将长事务拆分， <strong>"读 - 算 - 写" 三步</strong> 1. 读：无锁读取原子服务与实现数据； 2. 算：在应用层对比新增 / 删除数据； 3. 写：仅对差异数据执行短事务操作</td><td>从根源解决问题</td><td>实现成本大，重构该方法</td><td>长期解法</td></tr></tbody></table>
<p><strong>当前落地情况</strong>：已通过 “分布式锁控制同一逻辑表同步并发” 的短期方案解决事故，后续将在业务迭代中推进 “读 - 算 - 写” 拆分的长期优化，进一步降低事务粒度与锁冲突风险。</p>
<h2 data-id="heading-21">5.附录</h2>
<h3 data-id="heading-22">5.1名词解释</h3>
<p>事实逻辑表：由物理数仓中的事实表和维度逻辑表关联形成的语义表，可以描述业务过程的详细信息，是指标的数据来源。</p>
<p>原子服务：指标的实现方式，一个指标可以有多个实现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UModel 数据治理：运维世界模型构建实践]]></title>    <link>https://juejin.cn/post/7574803558878937103</link>    <guid>https://juejin.cn/post/7574803558878937103</guid>    <pubDate>2025-11-21T10:18:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574803558878937103" data-draft-id="7574749664492978210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UModel 数据治理：运维世界模型构建实践"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2025-11-21T10:18:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UModel 数据治理：运维世界模型构建实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:18:19.000Z" title="Fri Nov 21 2025 10:18:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：元乙</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Flive%2F255499" target="_blank" title="https://developer.aliyun.com/live/255499" ref="nofollow noopener noreferrer">点击此处，观看视频解读！</a></p>
<h2 data-id="heading-0">从可观测再出发</h2>
<p>回顾数十年可观测的演进历程，本质上反映了我们对复杂系统认知方式的变化。</p>
<p>最初，我们面向单一数据类型构建监控体系——CPU、内存、磁盘，一个个孤立的指标告诉我们“什么地方出了问题”。随着系统复杂度提升，我们开始收集多类数据——日志、指标、链路并行发展，试图从不同维度观察同一个系统。</p>
<p>进一步，我们意识到这些数据间存在“关联性”，开始尝试将 Logs、Metrics、Traces 关联分析，这就是所谓的“三大支柱”。但这种关联往往停留在时间维度、资源维度、调用链维度上的简单拼接，缺乏深层的语义联系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ad6306831224ffe9ec34a92cc271122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=xYuCpYGPvgw9JY6JRyclR%2FlHO50%3D" alt="图片" loading="lazy"/></p>
<p>然而，这些演进路径都基于一个隐含假设：先收集数据，再从数据中推理出系统的真实状态。这种“由数据到世界”的认知路径，在面对日益复杂的分布式系统时，逐渐暴露出根本性局限。</p>
<p>这里核心困境在于：从海量、异构、动态变化的数据中准确推理出真实世界的状态，本质上是一个极其困难的逆向工程问题。数据只是现象，而现象与本质之间往往存在巨大的认知鸿沟。</p>
<p>如果从第一性原则重新审视这个问题，一个更有效的路径是：先建模真实/IT世界，再针对性地获取数据。这意味着我们需要从“数据驱动”转向“模型驱动”，从面向现象的观测转向面向本质的建模。</p>
<h2 data-id="heading-1">AI 时代的建模必要性</h2>
<p>大模型的出现给了我们强大的工具，但实践中我们发现，当把这些“大脑”直接接入到“原始”的可观测数据流中时，却发现效果有限，往往还出现反作用。AI 缺乏对特定领域的结构化理解，面对没有上下文、没有关系的原始数据，几乎不可能做出精准判断。而这一现象在可观测领域更为明显。</p>
<p>基于在可观测领域尤其是 AIOps 的多年经验，阿里云可观测团队在 19 年开始了可观测数据建模的过程，并逐渐迭代和优化。这里我们经历了几个提升过程：</p>
<ol>
<li><strong>数据标准化：</strong> 解决数据格式混乱问题，借助 OpenTelemetry 开放标准，定义各类可观测数据的互操作。</li>
<li><strong>实体与关联：</strong> 引入 EntitySet 概念描述 IT 世界的核心对象，通过 Link 建立实体间的调用、依赖、归属等关系，构建起 IT 系统的拓扑图谱。</li>
<li><strong>知识表达：</strong> 沉淀领域专家经验，通过 Semantic 的 Set 表达“知识”，让系统不仅有数据，还有相关背景和分析数据的方法。</li>
<li><strong>行动能力：</strong> 支持操作能力建模，将“如何响应”的行动知识也纳入体系，实现从观测到分析到行动的闭环。</li>
</ol>
<p>这些阶段本身也是我们在做 AIOps 逐渐试错和优化的过程，面对 AI 逐渐从理论、落地到改变世界的迅速推进，我们推出的 UModel 这一结构化的运维世界模型，将数据、逻辑和行动串联起来，为 AI 提供了可推理、可交互的知识图谱。</p>
<h2 data-id="heading-2">UModel：可泛化的运维数字化本体</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69bcc9ee5c1e401891d89b09ccc86408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=caMFixTbmIYI%2FdgePGq17mx1xbA%3D" alt="图片" loading="lazy"/></p>
<p>UModel 是从可观测领域出发，基于本体论思想构建的 IT 世界统一建模框架。它不仅仅是数据的抽象，更是一个融合数据、知识、行动三位一体的完整体系。</p>
<p>这一建模过程和业界领先的 Palantir 类似，Palantir 从国防安全领域出发逐渐做到通用 AI 应用领域的领先，其股价也坐火箭式上升。仔细分析 Palantir 的成功，其核心价值不在于 AI 算法本身，而在于底层的“本体”（Ontology）的落地。</p>
<p>上图和 Palantir 的介绍类似，旨在描述运维数字化领域，以 UModel 为核心的可观测运维数字化平台的能力。</p>
<p>借鉴 Palantir 的设计理念，UModel 通过图模型将 IT 世界的三大要素统一：</p>
<ol>
<li><strong>数据层：</strong> 涵盖全域实体和观测数据，尤其包括各类关联关系。</li>
<li><strong>知识层：</strong> 沉淀领域专业知识，运维知识、分析模板、领域模型等。</li>
<li><strong>行动层：</strong> 支撑自动化决策执行的各类操作定义。</li>
</ol>
<h2 data-id="heading-3">为什么 UModel 是可落地的、可持续的</h2>
<p>建模这个概念并不新鲜，任何企业都可以提出“统一数据模型”的愿景。但真正在企业落地且持续发挥作用，很容易走到技术至上论、项目化思维、数据湖即数据能力、重分析轻行动等认知误区，最终导致“数据孤岛与认知隔阂”、“洞察与行动脱节”、“智能化技术与业务割裂”等问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/800fdd8f7cd64f2b9fa180547eb53826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=6HX68%2F%2FoOdWpjus4obO%2BsCBiCAI%3D" alt="图片" loading="lazy"/></p>
<p>UModel 之所以能够真正落地，在于我们系统性地解决了从理念到实践的完整链路问题：</p>
<ol>
<li><strong>面向业务价值的系统设计：</strong> 阿里云可观测团队服务数十万家客户，且可观测领域碎片化极其严重，UModel 从一开始就面向可观测业务场景的核心痛点设计。不是为了建模而建模，而是为了解决实际的运维效率、故障定位、系统优化等具体业务问题。</li>
<li><strong>构建持续进化的生态系统：</strong> 本身 UModel 不是一个“一次性交付”的项目，我们的目标是构建一个具备进化能力的生态系统，上述的几个发展阶段本身也是进化的结果。通过元模型架构，新的实体类型、数据类型、关系类型都可以在不影响现有系统的前提下平滑扩展。</li>
<li><strong>客户价值与平台能力的双飞轮效应：</strong> 我们一直致力于构建一个不仅能够让客户实现数据获取、价值提取、决策、执行到验证的客户价值闭环。同时在打造背后可观测平台能力提升的闭环，包括 UModel、Agent、领域模型等，最终形成双飞轮效应。</li>
</ol>
<h2 data-id="heading-4">UModel 概述：用 Set 和 Link 构建 IT 世界</h2>
<p>UModel 的设计与信息学“本体论”一致：用图来描述对象与关系，用 Field 约束语义与质量。</p>
<h4 data-id="heading-5">核心 Set 类型</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4fe1409cade4947a4624f7c09bcdf75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=7LgEy0b2M1ltaHGEobiQho1lqqU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">核心 Link 类型</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8db519dcc2224b8899ca2d56bb09972c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=iXI2Eyi8OBf4yUuhWZ%2Bawap618M%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">典型例子：应用调用数据库</h4>
<ol>
<li>定义 <code>Service</code> 与 <code>DB</code> 两类 EntitySet，并建立 <code>Service -&gt; DB</code> 的 <code>Calls</code> 关系。</li>
<li>定义 <code>ServiceLogs</code>、<code>ServiceMetrics</code>、<code>Traces</code> 等 TelemetryDataSet，描述自身数据与调用产生的数据。</li>
<li>建立 TelemetryDataSet 与 EntitySet 的 DataLink。</li>
<li>定义具体实例及其 Storage 与 StorageLink。</li>
<li>定义 <code>Service</code> 与 <code>DB</code> 的 Runbook，描述操作手册、分析模板、领域知识等。</li>
</ol>
<p>通过上述建模，我们能直接获知系统中有哪些 Service/DB 实例、产生了哪些数据、存储位置与字段含义，以及操作手册、分析模板、领域知识等，从而支持人/程序/大模型的统一分析。</p>
<h2 data-id="heading-8">UModel 的工程体系：从理念到系统工程</h2>
<p>UModel 不是一个“静态定义”，而是一套工程体系：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1223df1a3364c7a8dbdbf7ed14cc3e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=Tewzrb1yK6eK%2BXiI1oKYuMRaufM%3D" alt="图片" loading="lazy"/></p>
<ul>
<li><strong>元模型架构：</strong> UModel 并不直接定义 Field、DataSet、EntityLink 等概念，而是提供了一套“元模型”。基于元模型定义基础属性字段，通过组合、引用、继承等关系，最终生成 UModel 定义，保证其可扩展性。整体迭代路径符合“道生一、一生二、二生三、三生万物”的思想。</li>
<li><strong>标准化与自动化：</strong> 提供标准化的可观测 UModel 定义，大幅降低使用门槛；内部建立 CommonSchema 维护机制，保证 UModel 定义的高质量发展；提供自动化的实体关系生成、数据同步、元数据更新等管理能力，提升可操作性。</li>
<li><strong>技术基础设施：</strong> 专为可观测场景构建的实体、关系的存储计算引擎，能够快速回溯到任意时刻的系统状态，支持高性能的图查询、关系计算、多维分析等能力。提供管道式、高性能 SPL 统一计算框架，支持关联 UModel、实体、关系、观测数据等各类数据。</li>
<li><strong>面向对象的分析：</strong> 从传统面向数据的分析语法，进化到面向对象的“编程式”分析方式，支持运行时多态、动态方法调用等高级特性，让分析过程更加贴近真实世界的对象交互模式。</li>
<li><strong>面向 AGI 的能力：</strong> 集成语义化搜索、GraphRAG 等面向 AI 的核心能力，上层接口提供 MCP、PaaS API 等，各方面均考虑 LLM 友好特性。</li>
</ul>
<p>在工程化落地上，我们进一步强化了易用性与生产化能力：</p>
<ul>
<li><strong>CommonSchema：</strong> 沉淀阿里云产品、K8s、APM 等常见数据结构，兼容 OpenTelemetry 等标准</li>
<li><strong>实体关系自动生成：</strong> 基于先验知识与计算框架，自动从“应用&amp;业务视角信息”关联到“资源&amp;云产品视角信息”，生成跨域关系</li>
<li><strong>分析最佳实践：</strong> 为 TelemetryDataSet 附加分析最佳实践，包括开箱即用的大盘和告警等</li>
</ul>
<h4 data-id="heading-9">基于 UModel 的可观测应用与实践</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/203574237a824afb895345a9d31da512~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=ZDHRgUsPJt4iGBy9zpKyUEMSy1s%3D" alt="图片" loading="lazy"/></p>
<p>上图是一个典型的 UModel 配置，在系统中定义了一系列的实体，包括应用层的服务/服务实例、K8s 相关实体、底层数据库/主机、CICD 相关的 Job/Repo/操作人等。同时这一系列实体对应的可观测数据也分别进行建模（受限于篇幅，实际这里还会定义相关的 Explorer，便于快速查看数据，例如标准的 K8s、MySQL、服务大盘等；同时还有相关的告警配置）。上述所有的实例均以图的方式进行连接。</p>
<p>基于上述的 UModel 配置，我们能够构造出下图所示的具体实体拓扑（受限于篇幅，只显示一些示例实体）。接收到告警事件时，我们能够进行多种排查方式：</p>
<ol>
<li>根据实体的连接关系一步步排查，每类实体都有对应的可观测数据，按图索骥。</li>
<li>基于先验知识进行定向排查，例如 Service 出现异常后，优先排查依赖的 Service、DB、中间件等调用是否出现问题。</li>
<li>由于故障多数由变更引起，可以优先查看近期相关的服务变更，优先排查变更服务。</li>
<li>通常故障时多个实体均会有告警事件产生，可以将所有告警事件关联实体找出，画出最小连接子图辅助排查。</li>
</ol>
<p>而上述这些排查方式，无论是人、程序还是大模型都可以基于 UModel 这一标准化定义而顺畅工作，发挥出可观测数据真正的价值。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/885cd2f19c054bc4aea20dba85d44ca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=2lYooumkaiz7GJAAOx%2F6eVR2jus%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-10">基于 UModel 的可观测应用</h2>
<p>类似于 MVC 模型，UModel 在可观测团队中承载着 Model 的工作，在此之上我们彻底融合了原<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fcms%3Fspm%3Da1z389.11499242.0.0.65452413vvcY0e%26utm_content%3Dg_1000408141" target="_blank" title="https://www.aliyun.com/product/cms?spm=a1z389.11499242.0.0.65452413vvcY0e&amp;utm_content=g_1000408141" ref="nofollow noopener noreferrer">云监控</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Farms%3Fspm%3Da1z389.11499242.0.0.65452413yOc5rP%26utm_content%3Dg_1000408142" target="_blank" title="https://www.aliyun.com/product/arms?spm=a1z389.11499242.0.0.65452413yOc5rP&amp;utm_content=g_1000408142" ref="nofollow noopener noreferrer">ARMS</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fsls%3Fspm%3Da1z389.11499242.0.0.65452413PLWe13%26utm_content%3Dg_1000408139" target="_blank" title="https://www.aliyun.com/product/sls?spm=a1z389.11499242.0.0.65452413PLWe13&amp;utm_content=g_1000408139" ref="nofollow noopener noreferrer">SLS</a> 团队的各类观测应用，构成全新的“可观测 2.0”：</p>
<ul>
<li>覆盖所有类型的数据，从前端到网关、后端，从应用到中间件、基础设施，从运维类数据到安全、业务。</li>
<li>抽象并建模各类实体和关系，并生成各类跨域的实体关系，完成所有观测实体的打通。</li>
<li>基于 UModel 的统一 UI 能力，在任意界面、任意场景均可以接入可观测“互联网”。</li>
<li>算法、模型不再是针对某个数据而设计，只要是 UModel 描述的数据都能够被支持。</li>
</ul>
<p>关于可观测 2.0 相关的产品和设计理念，可参考：《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwODY2NTk0OQ%3D%3D%26mid%3D2247485489%26idx%3D1%26sn%3D1b44928dab36242369be1f238429c279%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwODY2NTk0OQ==&amp;mid=2247485489&amp;idx=1&amp;sn=1b44928dab36242369be1f238429c279&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">云栖实录：重构可观测 - 打造大模型驱动的云监控 2.0 与 AIOps 新范式</a>》。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4531fe404f484b3fb4514832ca298822~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325099&amp;x-signature=GRKxXAUkJ8DngcSp6bEvuRuBsVk%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-11">More Than UModel：走向 AGI 的运维数字化</h2>
<p>UModel 的核心是一种范式迁移：从“被动收集数据”到“主动建模世界”。当 AGI 成熟时，运维将从“人管机器”转向“AI 理解并优化世界”的新范式：</p>
<ul>
<li>完整上下文感知：瞬间理解任意系统状态的全域背景。</li>
<li>主动系统优化：从被动响应告警到持续主动优化。</li>
<li>预测性架构演进：基于业务趋势提前规划并自动完成复杂技术迁移。</li>
</ul>
<p>我们相信，这一愿景一定会实现！</p>
<blockquote>
<p>"The best way to predict the future is to create it." </p>
<p> —— Peter Ducker</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【原理到实战】实验异质性分析]]></title>    <link>https://juejin.cn/post/7574978545144250403</link>    <guid>https://juejin.cn/post/7574978545144250403</guid>    <pubDate>2025-11-21T10:21:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545144250403" data-draft-id="7574992086715154447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【原理到实战】实验异质性分析"/> <meta itemprop="keywords" content="数据挖掘"/> <meta itemprop="datePublished" content="2025-11-21T10:21:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【原理到实战】实验异质性分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:21:20.000Z" title="Fri Nov 21 2025 10:21:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ol>
<li>什么是实验的异质性</li>
<li>
<ol>
<li>什么是异质性</li>
</ol>
</li>
</ol>
<p>当我们看到如下实验平台指标结果时</p>





















<table><thead><tr><th>实验分组</th><th>指标值</th></tr></thead><tbody><tr><td>对照组</td><td>100</td></tr><tr><td>实验组</td><td>99.96</td></tr><tr><td>相对差异</td><td>-0.04%</td></tr></tbody></table>
<p>在进行分析前，可能我们的第一直觉是这样的</p>
<p><img src="" alt="" loading="lazy"/></p>
<p>经过异质性分析后，可能会发现实际情况是这样的</p>
<p><img src="" alt="" loading="lazy"/></p>
<ol>
<li>概念解析与定义</li>
</ol>
<p>一般来讲，HTE的全称为Heterogeneous Treatment Effects，即异质处理效应，意为实验中同一个treatment对不同的实验样本，得到的策略效果可能是不一样的。另外还有一些重要的概念需要大家理解</p>


































<table><thead><tr><th>英文简称</th><th>英文全称</th><th>中文译名</th><th>含义</th><th>公式</th></tr></thead><tbody><tr><td>ATE</td><td>Average Treatment Effect</td><td>平均处理效应</td><td>所有实验对象的平均实验效果</td><td>ATE=E[Y(1)-Y(0)]</td></tr><tr><td>CATE</td><td>Conditional Average Treatment Effect</td><td>条件平均处理效应</td><td>满足一定条件的实验对象的平均实验效果</td><td>CATE_X=E[Y_x(1)-Y_x(0)</td><td>x \in X]</td></tr><tr><td>ITE</td><td>Individual Treatment Effect</td><td>个体处理效应</td><td>某个实验对象的实验效果</td><td>ITE_i=E[Y_i(1)-Y_i(0)], i=1,2,...N</td></tr></tbody></table>
<p>** 此处采用Donald Rubin提出的潜在因果框架（Potencial outcome）来对实验效果进行统计公式上的描述 [1]*</p>
<ul>
<li><em>由于业内并没有统一的定义，HTE、CATE、ITE概念在一定程度上会有混用的情况，读者需要参考描述以及上下文综合判断名词的含义</em></li>
</ul>
<ol>
<li>异质性分析对于业务的意义</li>
<li>
<ol>
<li>了解策略对于不同用户的不同效果，协助挖掘背后的业务逻辑，辅助迭代、进行新一轮的实验</li>
<li>尝试寻找策略最优子人群，让整体无效的策略，有机会进行部分先推全；反之依然，让部分负向的策略，减少损失</li>
<li>对实验结果建模后预测，对线上提供动态的最优人群支持</li>
</ol>
</li>
</ol>
<blockquote>
<p>根据实验平台数据科学团队测算，以京东零售某产品线下6月运行中的实验为例，仅23%左右的实验没有在实验人群视角发现异质性</p>
</blockquote>
<ol>
<li>异质性分析方法概述</li>
<li>
<ol>
<li>异质性分析的维度选择</li>
<li>
<ol>
<li>对于<strong>分流单元的维度X</strong>，当X满足以下条件时，可以作为异质性的维度进行后续分析</li>
<li>
<ul>
<li>T \perp X，即<strong>分析维度与实验分流无关</strong> (Unconfoundedness)</li>
<li>分析工具化的常见简化方式：对于一个分流ID，<strong>选取他在首次进入实验前一天的标签取值</strong></li>
<li>简单推导：</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>CATE_X</p>
<p>= E[Y_x(1) - Y_x(0)|x \in X] \qquad\qquad\qquad\qquad\qquad \dots (1)</p>
<p>= E[Y_x(1)|x \in X] - E[Y_x(0)|x \in X] \qquad\qquad\qquad\dots (2)</p>
<p>= E[Y_x(1)|T_i=1, x \in X] - E[Y_x(0)|T_i=0, x \in X] \dots (3)= E[Y_i|T_i=1, x \in X] - E[Y_i|T_i=0, x \in X] \qquad\dots (4)</p>
<p><em>T是随机化的，</em> T \perp Y, T \perp X <em>，所以</em>E[Y_i(1)|x \in X]=E[Y_i(1)｜T_i=1,x \in X] <em>，所以（3）成立</em></p>
<ol>
<li>异质性分析的维度分析bad case举例</li>
</ol>














<table><thead><tr><th><strong>分析目标 &amp; 常见错误方法举例</strong></th><th><strong>不成立原因简述</strong></th><th><strong>推荐的实验分析方式</strong></th></tr></thead><tbody><tr><td>-   不同活跃度人群的策略效果</td><td/></tr></tbody></table>
<ul>
<li>在实验运行7天后，利用实验用户在第7天的活跃度标签进行结果拆解                       | 在实验开始后，用户的活跃度标签受到了策略影响，即T \perp X不成立                          | 使用用户在进入实验前1天的活跃度标签值                                     |
| -   分别分析低频策略、中频策略、高频策略对于低、中、高频用户的策略效果</li>
<li>按天取每天用户的活跃度标签，对实验结果进行拆解          | -   用户的活跃度标签受到了策略影响，即T \perp X不成立</li>
<li>用户所在分组应该是确定的，不随时间改变     | 分别建立3个人群正交实验                                            |
| -   分析高单价类目商品（3C家电）和低单价类目商品（休闲食品）的转化率差异</li>
<li>选取xx类目曝光用户，计算实验周期内对应类目的曝光订单转化率 | 分析目标是面向指标维度的（sku所在类目），而非分流单元的维度（C端实验通常为账号、设备），不适用本文提到的异质性分析方法 | 1.  应该使用指标维度下钻进行分析</li>
</ul>
<ol>
<li>
<p>曝光订单转化率的分子、分母均受到策略影响，需在观测全面后综合判断 |</p>
</li>
<li>
<p>异质性分析的方法选择</p>
</li>
</ol>

















<table><thead><tr><th><strong>研究对象</strong></th><th><strong>研究方法</strong></th><th><strong>适用场景</strong></th><th><strong>pros &amp; cons</strong></th></tr></thead><tbody><tr><td>CATE</td><td>维度下钻</td><td>-   低维</td><td/></tr></tbody></table>
<ul>
<li>分析目标明确                                                                                                                                                              | + 快速简单，便于理解+ 产品化容易- 维度选择依赖分析师经验- 交互效应处理困难                                                                                                                                           |
| 方差分析（ANOVA，ANCOVA） | -   低维</li>
<li>分析目标较明确</li>
<li>交互效应评估         | + 解释性强，统计学理论背书+ 可以处理低维度交互效应+ 可作为feature selection的候选方法- 基于线性模型假设- 高维度交互效应解读困难                                                                                             |                                                                                                                                                                                         |
| 因果树（Causal Tree）   | -   高维</li>
<li>分析目标不明确，希望探索               | + 建模方法符合分析直觉- 模型复杂度不足，无法准确描述复杂的现实世界效果- 本方法为现代机器学习因果算法的基石之一，有更好的替代方案                                                                                                         |                                                                                                                                                                                         |
| ITE                | Meta - Learner                        | -   高维</li>
<li>希望输出ITE</li>
<li>算法训练                                                                                                                                                    | + 算法常用，可大规模并行，有工程化先例+ 在过往的simulation中X-learner对ITE估计的准确度表现优秀+ X-learner通常使用xgboost模型，对各种feature有较强的处理能力- 计算量大，耗资源- 需要调参- 由于缺乏统计推断结果，一般不会直接产出p-value，存在对于ITE数值准确性的质疑，算法利用结果的rank居多 |
| DML                | -   高维</li>
<li>希望输出ITE和置信区间               | + 有严谨统计理论证明ITE估计的无偏有效性，可产出样本级的ITE以及置信区间+ 在过往的simulation中Causal Forest DML对ITE估计的准确度表现优秀+ DML模型框架本身具备一定的robust特性，在结合Forest模型后，调参需求低，不容易过拟合，对各种feature有较强的处理能力- 慢，耗资源，工程化先例少 |                                                                                                                                                                                         |
| ITE + CATE hybrid  | ITE Model + Decision Tree Interpreter | -   高维</li>
<li>分析目标不明确，希望探索                                                                                                                                                        | + 决策树的建模方法符合分析直觉+ ITE模型可以较好的对复杂的现实世界进行抽象总结- ITE模型可能会慢                                                                                                                                |</li>
</ul>
<ol>
<li>实验CATE下钻探索工具MVP版逻辑介绍</li>
</ol>
<p>实验平台数据科学团队已经产出python工具包，可以半自动化的利用6行代码实现平台上实验异质性的探索分析，可以实现以下功能</p>
<ol>
<li>通过填写YAML配置，自动生成实验分析SQL，并执行取数，目前包括</li>
<li>
<ol>
<li>自动获取试金石实验分流信息</li>
<li>自动获取试金石实验指标信息</li>
<li>解析实验CATE研究使用的用户标签表</li>
<li>自动生成所有数据源的关联关系</li>
</ol>
</li>
<li>为实验CATE研究提供自动化工具，目前包括</li>
<li>
<ol>
<li>自动化生成实验目标指标的CATE差异最大化子人群</li>
<li>提供调参接口，高级用户可自定义模型参数</li>
<li>提供可视化的模型结果输出，高级用户可根据输出调节模型表现</li>
</ol>
</li>
<li>为实验的下钻分析提供探索、分析功能，目前包括</li>
<li>
<ol>
<li>CATE人群的实验效果统计检验</li>
<li>CATE人群的多指标拆解</li>
<li>CATE人群的特征描述</li>
</ol>
</li>
<li>实验异质性分析show case</li>
<li>
<ol>
<li>某真实实验case的CATE结果分析，此项目整体实验指标为负向不显著，但通过运行分析工具后发现，有两类子人群分别具有正向和负向的显著效果</li>
</ol>
</li>
</ol>













<table><thead><tr><th>自动探索分析模型的树结构</th><th>自动探索分析模型产出的异质性人群实验结果</th></tr></thead><tbody><tr><td><img src="" alt="" loading="lazy"/></td><td><img src="" alt="" loading="lazy"/></td></tr></tbody></table>
<ol>
<li>对于这些子人群，我们发现他们的用户画像具备不同的特征，在业务漏斗的实验结果也不一致，那么下次对频道再次进行迭代时，产品经理可以有针对性的对负向人群的体验进行优化</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在 C# 中自动化生成 PDF 表格]]></title>    <link>https://juejin.cn/post/7574978545144184867</link>    <guid>https://juejin.cn/post/7574978545144184867</guid>    <pubDate>2025-11-21T10:06:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545144184867" data-draft-id="7574978545144168483" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在 C# 中自动化生成 PDF 表格"/> <meta itemprop="keywords" content="后端,C#"/> <meta itemprop="datePublished" content="2025-11-21T10:06:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户835629078051"/> <meta itemprop="url" content="https://juejin.cn/user/3150554985403516"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在 C# 中自动化生成 PDF 表格
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3150554985403516/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户835629078051
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:06:41.000Z" title="Fri Nov 21 2025 10:06:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94cdbe765d5f43b5bae00efc6a9367ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODM1NjI5MDc4MDUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764324400&amp;x-signature=LUrYApa%2Bv9lPM4czKljB6hGPPNM%3D" alt="C#绘制PDF表格" loading="lazy"/></p>
<p>在现代商业应用中，PDF文档因其跨平台、内容固定和易于共享的特性，成为信息传递的重要载体。无论是财务报表、发票、合同，还是产品目录，结构化的数据往往需要以表格的形式呈现。手动创建这些PDF表格不仅效率低下，而且极易出错。幸运的是，借助C#编程，我们可以自动化这一过程，实现高效、精确的PDF表格生成。</p>
<p>本文将深入探讨如何使用一款功能强大的PDF处理库——Spire.PDF for .NET，在C#中创建和定制PDF表格。我们将从基础的表格构建开始，逐步讲解样式设置、单元格合并、动态数据绑定等进阶功能，旨在为开发者提供一份从入门到精通的实践指南。</p>
<h2 data-id="heading-0">一、准备工作与基础表格创建</h2>
<p>首先，我们需要将Spire.PDF for .NET库集成到我们的C#项目中。最便捷的方式是通过NuGet包管理器：</p>
<pre><code class="hljs language-bash" lang="bash">Install-Package Spire.PDF
</code></pre>
<p>安装完成后，我们就可以开始创建最简单的PDF表格了。Spire.PDF库提供了<code>PdfTable</code>类来表示表格，并通过<code>PdfTableColumn</code>和数据填充来构建表格内容。</p>
<p>下面是一个创建2行3列基础表格的示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Pdf;
<span class="hljs-keyword">using</span> Spire.Pdf.Graphics;
<span class="hljs-keyword">using</span> Spire.Pdf.Tables;
<span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BasicTableExample</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateSimpleTable</span>()</span>
    {
        <span class="hljs-comment">// 创建PDF文档</span>
        PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
        <span class="hljs-comment">// 添加一个页面</span>
        PdfPageBase page = doc.Pages.Add();

        <span class="hljs-comment">// 创建PdfTable实例</span>
        PdfTable table = <span class="hljs-keyword">new</span> PdfTable();

        <span class="hljs-comment">// 定义表格列</span>
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"Header 1"</span>));
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"Header 2"</span>));
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"Header 3"</span>));

        <span class="hljs-comment">// 准备表格数据</span>
        <span class="hljs-built_in">string</span>[,] data = 
        {
            { <span class="hljs-string">"Row 1, Cell 1"</span>, <span class="hljs-string">"Row 1, Cell 2"</span>, <span class="hljs-string">"Row 1, Cell 3"</span> },
            { <span class="hljs-string">"Row 2, Cell 1"</span>, <span class="hljs-string">"Row 2, Cell 2"</span>, <span class="hljs-string">"Row 2, Cell 3"</span> }
        };

        <span class="hljs-comment">// 设置表格数据源</span>
        table.DataSource = data;

        <span class="hljs-comment">// 绘制表格到PDF页面，并指定位置</span>
        table.Draw(page, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>));

        <span class="hljs-comment">// 保存PDF文档</span>
        doc.SaveToFile(<span class="hljs-string">"SimpleTable.pdf"</span>);
        doc.Close();
        System.Diagnostics.Process.Start(<span class="hljs-string">"SimpleTable.pdf"</span>);
    }
}
</code></pre>
<blockquote>
<p><strong>核心API提示:</strong></p>
<ul>
<li><code>PdfDocument</code>: PDF文档的顶层对象。</li>
<li><code>PdfPageBase</code>: 代表PDF文档中的一个页面。</li>
<li><code>PdfTable</code>: 用于创建和管理PDF表格。</li>
<li><code>PdfTableColumn</code>: 定义表格的列，可以设置列标题。</li>
<li><code>table.DataSource</code>: 可以接受二维数组、<code>DataTable</code>或自定义对象集合作为数据源。</li>
</ul>
</blockquote>
<h2 data-id="heading-1">二、表格样式与布局进阶</h2>
<p>一个美观且易读的表格离不开精心的样式设计。Spire.PDF允许我们精细控制表格的边框、背景色、字体样式以及单元格的合并与对齐。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Pdf;
<span class="hljs-keyword">using</span> Spire.Pdf.Graphics;
<span class="hljs-keyword">using</span> Spire.Pdf.Tables;
<span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AdvancedTableExample</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateStyledTable</span>()</span>
    {
        PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
        PdfPageBase page = doc.Pages.Add();

        PdfTable table = <span class="hljs-keyword">new</span> PdfTable();

        <span class="hljs-comment">// 定义列并设置列宽</span>
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"产品名称"</span>) { Width = <span class="hljs-number">100</span> });
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"单价"</span>) { Width = <span class="hljs-number">60</span> });
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"数量"</span>) { Width = <span class="hljs-number">60</span> });
        table.Columns.Add(<span class="hljs-keyword">new</span> PdfTableColumn(<span class="hljs-string">"小计"</span>) { Width = <span class="hljs-number">80</span> });

        <span class="hljs-comment">// 设置表格边框</span>
        table.Style.BorderPen = <span class="hljs-keyword">new</span> PdfPen(Color.Black, <span class="hljs-number">0.5f</span>);
        table.Style.CellPadding = <span class="hljs-number">5</span>; <span class="hljs-comment">// 单元格内边距</span>

        <span class="hljs-comment">// 设置表头样式</span>
        table.Style.HeaderSource = PdfHeaderSource.Rows;
        table.Style.HeaderRowCount = <span class="hljs-number">1</span>; <span class="hljs-comment">// 第一行为表头</span>
        table.Style.ShowHeader = <span class="hljs-literal">true</span>;
        table.Style.HeaderStyle.BackgroundBrush = PdfBrushes.DarkSlateGray; <span class="hljs-comment">// 表头背景色</span>
        table.Style.HeaderStyle.TextBrush = PdfBrushes.White; <span class="hljs-comment">// 表头文字颜色</span>
        table.Style.HeaderStyle.Font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">12f</span>, FontStyle.Bold));
        table.Style.HeaderStyle.StringFormat = <span class="hljs-keyword">new</span> PdfStringFormat(PdfTextAlignment.Center, PdfVerticalAlignment.Middle);

        <span class="hljs-comment">// 设置默认单元格样式</span>
        table.Style.DefaultStyle.Font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">10f</span>));
        table.Style.DefaultStyle.BackgroundBrush = PdfBrushes.LightGray;

        <span class="hljs-comment">// 设置交替行样式，提升可读性</span>
        table.Style.AlternateStyle = <span class="hljs-keyword">new</span> PdfCellStyle();
        table.Style.AlternateStyle.BackgroundBrush = PdfBrushes.WhiteSmoke;

        <span class="hljs-comment">// 准备数据</span>
        <span class="hljs-built_in">string</span>[,] data =
        {
            { <span class="hljs-string">"笔记本电脑"</span>, <span class="hljs-string">"8999.00"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"8999.00"</span> },
            { <span class="hljs-string">"机械键盘"</span>, <span class="hljs-string">"799.00"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"1598.00"</span> },
            { <span class="hljs-string">"无线鼠标"</span>, <span class="hljs-string">"299.00"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"897.00"</span> },
            { <span class="hljs-string">"总计"</span>, <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"11494.00"</span> }
        };
        table.DataSource = data;

        <span class="hljs-comment">// 合并“总计”行的单元格</span>
        <span class="hljs-comment">// 合并第4行（索引为3）的第2列到第3列</span>
        table.MergeCells(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>); 
        
        <span class="hljs-comment">// 设置合并后单元格的文本对齐方式</span>
        table.Rows[<span class="hljs-number">3</span>].Cells[<span class="hljs-number">1</span>].StringFormat = <span class="hljs-keyword">new</span> PdfStringFormat(PdfTextAlignment.Right, PdfVerticalAlignment.Middle);

        table.Draw(page, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>));

        doc.SaveToFile(<span class="hljs-string">"StyledTable.pdf"</span>);
        doc.Close();
        System.Diagnostics.Process.Start(<span class="hljs-string">"StyledTable.pdf"</span>);
    }
}
</code></pre>
<blockquote>
<p><strong>样式控制要点:</strong></p>
<ul>
<li><code>table.Style.BorderPen</code>: 设置表格整体边框的画笔。</li>
<li><code>table.Style.CellPadding</code>: 设置单元格内边距。</li>
<li><code>table.Style.HeaderStyle</code>: 控制表头样式，包括背景、字体、对齐等。</li>
<li><code>table.Style.DefaultStyle</code>: 设置非表头单元格的默认样式。</li>
<li><code>table.Style.AlternateStyle</code>: 用于设置交替行的样式，常用于提升表格可读性。</li>
<li><code>table.MergeCells(startRow, startColumn, endRow, endColumn)</code>: 合并指定范围的单元格。</li>
<li><code>PdfStringFormat</code>: 精确控制文本的水平和垂直对齐方式。</li>
</ul>
</blockquote>
<h2 data-id="heading-2">三、动态数据绑定与复杂场景</h2>
<p>在实际应用中，表格数据通常来源于数据库、API或其他动态源。Spire.PDF支持将<code>DataTable</code>或自定义对象集合直接绑定到<code>PdfTable</code>，极大地简化了数据处理。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Pdf;
<span class="hljs-keyword">using</span> Spire.Pdf.Graphics;
<span class="hljs-keyword">using</span> Spire.Pdf.Tables;
<span class="hljs-keyword">using</span> System.Data;
<span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DynamicDataTableExample</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateTableFromDataTable</span>()</span>
    {
        PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
        PdfPageBase page = doc.Pages.Add();

        <span class="hljs-comment">// 创建一个DataTable作为数据源</span>
        DataTable dataTable = <span class="hljs-keyword">new</span> DataTable();
        dataTable.Columns.Add(<span class="hljs-string">"ID"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">int</span>));
        dataTable.Columns.Add(<span class="hljs-string">"姓名"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));
        dataTable.Columns.Add(<span class="hljs-string">"年龄"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">int</span>));
        dataTable.Columns.Add(<span class="hljs-string">"城市"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));

        <span class="hljs-comment">// 填充数据</span>
        dataTable.Rows.Add(<span class="hljs-number">1</span>, <span class="hljs-string">"张三"</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"北京"</span>);
        dataTable.Rows.Add(<span class="hljs-number">2</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-number">25</span>, <span class="hljs-string">"上海"</span>);
        dataTable.Rows.Add(<span class="hljs-number">3</span>, <span class="hljs-string">"王五"</span>, <span class="hljs-number">35</span>, <span class="hljs-string">"广州"</span>);
        dataTable.Rows.Add(<span class="hljs-number">4</span>, <span class="hljs-string">"赵六"</span>, <span class="hljs-number">28</span>, <span class="hljs-string">"深圳"</span>);
        dataTable.Rows.Add(<span class="hljs-number">5</span>, <span class="hljs-string">"钱七"</span>, <span class="hljs-number">40</span>, <span class="hljs-string">"杭州"</span>);
        <span class="hljs-comment">// 更多数据...</span>

        PdfTable table = <span class="hljs-keyword">new</span> PdfTable();
        <span class="hljs-comment">// 直接绑定DataTable</span>
        table.DataSource = dataTable;

        <span class="hljs-comment">// 设置列宽</span>
        table.Columns[<span class="hljs-number">0</span>].Width = <span class="hljs-number">50</span>;
        table.Columns[<span class="hljs-number">1</span>].Width = <span class="hljs-number">80</span>;
        table.Columns[<span class="hljs-number">2</span>].Width = <span class="hljs-number">60</span>;
        table.Columns[<span class="hljs-number">3</span>].Width = <span class="hljs-number">100</span>;

        <span class="hljs-comment">// 设置表头样式</span>
        table.Style.HeaderStyle.BackgroundBrush = PdfBrushes.DarkBlue;
        table.Style.HeaderStyle.TextBrush = PdfBrushes.White;
        table.Style.HeaderStyle.Font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">11f</span>, FontStyle.Bold));
        table.Style.HeaderStyle.StringFormat = <span class="hljs-keyword">new</span> PdfStringFormat(PdfTextAlignment.Center, PdfVerticalAlignment.Middle);

        <span class="hljs-comment">// 设置默认单元格样式</span>
        table.Style.DefaultStyle.Font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">9f</span>));
        table.Style.DefaultStyle.StringFormat = <span class="hljs-keyword">new</span> PdfStringFormat(PdfTextAlignment.Center, PdfVerticalAlignment.Middle);
        table.Style.DefaultStyle.BackgroundBrush = PdfBrushes.LightCyan;

        <span class="hljs-comment">// 处理大数据量时的分页（简要提及）</span>
        <span class="hljs-comment">// 当表格内容超出当前页面时，Spire.PDF会自动进行分页。</span>
        <span class="hljs-comment">// 可以通过 PdfTableLayoutFormat 控制分页行为，例如设置重复表头：</span>
        PdfTableLayoutFormat format = <span class="hljs-keyword">new</span> PdfTableLayoutFormat();
        format.Break = PdfLayoutBreakType.FitPage; <span class="hljs-comment">// 自动适应页面</span>
        format.Layout = PdfLayoutType.Paginate; <span class="hljs-comment">// 启用分页</span>
        table.Style.RepeatHeader = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 每页重复表头</span>

        table.Draw(page, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>), format); <span class="hljs-comment">// 绘制时传入布局格式</span>

        doc.SaveToFile(<span class="hljs-string">"DynamicTableFromDataTable.pdf"</span>);
        doc.Close();
        System.Diagnostics.Process.Start(<span class="hljs-string">"DynamicTableFromDataTable.pdf"</span>);
    }
}
</code></pre>
<blockquote>
<p><strong>动态绑定与分页:</strong></p>
<ul>
<li><code>table.DataSource = dataTable;</code>: 将<code>DataTable</code>直接赋值给<code>DataSource</code>属性，Spire.PDF会自动识别列名作为表头，并填充数据。</li>
<li><code>PdfTableLayoutFormat</code>: 用于控制表格的布局和分页行为，是处理大数据量表格的关键。</li>
<li><code>table.Style.RepeatHeader = true;</code>: 在表格分页时，确保每一页的顶部都显示表头，极大地提升了报表的阅读体验。</li>
<li><strong>图片和超链接:</strong> Spire.PDF也支持在单元格中插入<code>PdfImage</code>或<code>PdfUriAnnotation</code>来添加图片和超链接，这使得报表内容更加丰富。</li>
</ul>
</blockquote>
<h2 data-id="heading-3">四、提升用户体验与性能考量</h2>
<p>在开发过程中，除了功能实现，我们还需要关注性能和代码的健壮性。</p>
<ul>
<li><strong>性能优化:</strong> 频繁创建字体对象会消耗资源。建议将常用的<code>PdfTrueTypeFont</code>实例缓存起来，避免重复创建。对于大型表格，合理设置<code>PdfTableLayoutFormat</code>的分页参数，可以优化渲染速度。</li>
<li><strong>错误处理:</strong> 在实际项目中，应加入必要的<code>try-catch</code>块来处理文件操作、数据绑定等可能发生的异常，确保程序的稳定性。</li>
<li><strong>代码健壮性:</strong> 检查数据源的有效性，防止空引用或格式错误导致的问题。</li>
<li><strong>表格模板:</strong> 对于结构相似但内容不同的报表，可以考虑设计表格模板。预设好表格的样式、列定义，然后根据不同的数据源动态填充，提高代码复用性。</li>
</ul>
<h2 data-id="heading-4">总结</h2>
<p>通过本文的讲解，我们深入了解了如何利用C#和Spire.PDF for .NET库在PDF文档中创建功能丰富、样式多样的表格。从基础的表格构建到复杂的样式控制、动态数据绑定和分页处理，Spire.PDF提供了一整套强大且易用的API，极大地简化了PDF报表的开发工作。</p>
<p>自动化生成PDF表格不仅能够提高开发效率，减少人工错误，还能为企业提供更灵活、更专业的文档输出方案。希望这篇教程能帮助您在C#项目中轻松应对PDF表格的生成需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot实战一：五分钟创建第一个Web应用]]></title>    <link>https://juejin.cn/post/7574967214128316442</link>    <guid>https://juejin.cn/post/7574967214128316442</guid>    <pubDate>2025-11-21T10:15:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214128316442" data-draft-id="7574840547807903754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot实战一：五分钟创建第一个Web应用"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-21T10:15:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智语言"/> <meta itemprop="url" content="https://juejin.cn/user/45498495414779"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot实战一：五分钟创建第一个Web应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/45498495414779/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智语言
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:15:46.000Z" title="Fri Nov 21 2025 10:15:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<blockquote>
<p> 本文的实验操作步骤放在第三步骤，第二部分是理论讲解</p>
</blockquote>
<h2 data-id="heading-0">一、实验目标</h2>
<ul>
<li>使用Spring Initializr在5分钟内创建SpringBoot项目</li>
<li>理解SpringBoot自动配置原理</li>
</ul>
<h3 data-id="heading-1">二、核心理论</h3>
<h3 data-id="heading-2">SpringBoot自动配置原理</h3>
<blockquote>
<p>// SpringBoot通过@SpringBootApplication注解实现自动配置<br/>
@SpringBootApplication // 组合注解：包含@Configuration @EnableAutoConfiguration</p>
<p>@ComponentScan<br/>
public class Application {<br/>
public static void main(String[] args) {<br/>
SpringApplication.run(Application.class, args);<br/>
}<br/>
}</p>
</blockquote>






























<table><thead><tr><th>对比角度</th><th><code>@Configuration</code></th><th><code>@EnableAutoConfiguration</code></th></tr></thead><tbody><tr><td>核心功能</td><td>手动定义配置和 Bean</td><td>自动根据环境 / 依赖配置 Bean</td></tr><tr><td>使用方式</td><td>标记配置类，配合 <code>@Bean</code> 使用</td><td>通常通过 <code>@SpringBootApplication</code> 间接使用</td></tr><tr><td>依赖关系</td><td>是 Spring 核心注解，不依赖 Spring Boot</td><td>是 Spring Boot 特有的自动配置入口</td></tr><tr><td>作用场景</td><td>自定义 Bean 或配置逻辑</td><td>简化默认配置，减少手动编码</td></tr></tbody></table>
<h4 data-id="heading-3">1.1、 <code>@Configuration</code> 注解</h4>
<h5 data-id="heading-4">作用</h5>
<p>标记一个类为<strong>配置类</strong>，用于替代传统的 XML 配置文件，在类中可以通过 <code>@Bean</code> 注解定义 Spring 容器管理的 Bean。</p>
<h5 data-id="heading-5">核心特性</h5>
<ul>
<li><strong>替代 XML 配置</strong>：传统 Spring 中通过 <code>&lt;bean&gt;</code> 标签定义 Bean，<code>@Configuration</code> 类配合 <code>@Bean</code> 可实现完全相同的功能，更符合 Java 代码的编写习惯。</li>
<li><strong>Bean 定义</strong>：在 <code>@Configuration</code> 类中，用 <code>@Bean</code> 注解修饰方法，方法返回值会被注册为 Spring 容器中的 Bean，默认单例。</li>
<li><strong>配置类本身也是 Bean</strong>：<code>@Configuration</code> 类会被 Spring 自动注册为容器中的一个 Bean，可被其他组件注入。</li>
<li><strong>支持嵌套配置</strong>：可以在 <code>@Configuration</code> 类中嵌套其他 <code>@Configuration</code> 类（通过内部类），简化配置结构。</li>
<li><strong>CGLIB 代理增强</strong>：Spring 会通过 CGLIB 代理 <code>@Configuration</code> 类，确保 <code>@Bean</code> 方法之间的调用返回的是容器中已注册的 Bean（而非新实例），保证单例特性。</li>
</ul>
<p><strong>示例</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> {
    <span class="hljs-comment">// 定义一个 Bean，id 默认为方法名 "userService"</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">UserService</span> <span class="hljs-title function_">userService</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();
    }
    
    <span class="hljs-comment">// 依赖其他 Bean（通过方法调用，Spring 会自动注入）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">OrderService</span> <span class="hljs-title function_">orderService</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(<span class="hljs-title function_">userService</span>()); <span class="hljs-comment">// 此处调用返回容器中的 userService 实例</span>
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-6">2. <code>@EnableAutoConfiguration</code> 注解</h4>
<h5 data-id="heading-7">作用</h5>
<p>开启 Spring Boot 的<strong>自动配置机制</strong>，让 Spring Boot 根据项目依赖、类路径资源等自动配置 Spring 容器中的 Bean，简化开发（无需手动编写大量配置）。</p>
<h5 data-id="heading-8">核心原理</h5>
<ul>
<li><strong>类路径扫描</strong>：Spring Boot 启动时，<code>@EnableAutoConfiguration</code> 会触发对类路径下的 <code>META-INF/spring.factories</code> 文件的扫描，该文件中定义了大量自动配置类（<code>XXXAutoConfiguration</code>）。</li>
<li><strong>条件注解筛选</strong>：自动配置类通常通过 <code>@Conditional</code> 系列注解（如 <code>@ConditionalOnClass</code>、<code>@ConditionalOnMissingBean</code> 等）判断是否满足配置条件，只有条件成立时才会注册对应的 Bean。例如：<code>DataSourceAutoConfiguration</code> 会检查类路径是否有 JDBC 相关类，若存在且用户未手动定义 <code>DataSource</code> Bean，则自动配置默认数据源。</li>
<li><strong>优先级机制</strong>：自动配置类可通过 <code>@AutoConfigureBefore</code>、<code>@AutoConfigureAfter</code> 等注解控制加载顺序，确保依赖关系正确。</li>
</ul>
<h5 data-id="heading-9">使用场景</h5>
<ul>
<li>通常不单独使用，而是通过 <code>@SpringBootApplication</code> 间接生效（<code>@SpringBootApplication</code> 包含 <code>@EnableAutoConfiguration</code>）。</li>
<li>若需排除特定自动配置类，可通过 <code>@EnableAutoConfiguration(exclude = XXXAutoConfiguration.class)</code> 实现。</li>
</ul>
<h5 data-id="heading-10">示例</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 等价于 @SpringBootApplication（包含 @EnableAutoConfiguration）</span>
<span class="hljs-variable">@EnableAutoConfiguration</span>
<span class="hljs-variable">@ComponentScan</span>
public class Application {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(Application.class, args);
    }
}

<span class="hljs-comment">// 排除特定自动配置类</span>
@<span class="hljs-selector-tag">EnableAutoConfiguration</span>(exclude = DataSourceAutoConfiguration.class)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Application</span> { ... }
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-11">三、实验操作步骤</h2>
<p>1、打开IDEA，选择新建springboot项目</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5a27b76c9d54db0a0be637fcc2bcc7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=BBWpFfZcExDGJFEIXAzanFYfmnE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-12">2、选择自己想要添加的依赖，比如：</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8955973fdc349b982ecbc7c4948eb76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=%2FoCytKHpF6urb7zpj4Ft6FaWcUg%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-13">3、点击创建后，添加为maven项目</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a49e3ee3b56b45d8bf07dabc8b20ad2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=e2e30OGnAUBsl21%2BVPf3OB9LpWs%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-14">4、依赖更新完成后，可以点击运行</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acf4809be26748db962ad6466ea43034~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=raMa%2BaH9qq274M96GPBdRMPp9Ys%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-15">5、创建第一个controller</h3>
<p>在com.lingyi.springboot_demo包下创建controller包，再创建如下java类</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.lingyi.springboot_demo.controller;

<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> {

    <span class="hljs-comment">/**
     * 基础Hello World接口
     * <span class="hljs-doctag">@return</span> 欢迎信息
     */</span>
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/hello"</span>)</span>
    <span class="hljs-keyword">public</span> String sayHello() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello World! 当前时间："</span> + LocalDateTime.now();
    }
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-16">6、重新启动服务</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efea655a8bac4b8f941e97acce75582c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=n9TBw1JPnggqCwykQKKim%2BuY3MI%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-17">7、测试</h3>
<p>打开浏览器访问地址</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9006f51476624eeda4d0e0ae55d43ed3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66K-t6KiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325278&amp;x-signature=ytr6vbsc5xA5vQ7Y6e09oQorv3w%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app D4 实战（小兔鲜）]]></title>    <link>https://juejin.cn/post/7574817463449223219</link>    <guid>https://juejin.cn/post/7574817463449223219</guid>    <pubDate>2025-11-21T09:55:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574817463449223219" data-draft-id="7574991051434901514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app D4 实战（小兔鲜）"/> <meta itemprop="keywords" content="架构,Vue.js,前端"/> <meta itemprop="datePublished" content="2025-11-21T09:55:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱泡脚的鸡腿"/> <meta itemprop="url" content="https://juejin.cn/user/4466663535419179"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app D4 实战（小兔鲜）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4466663535419179/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱泡脚的鸡腿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:55:02.000Z" title="Fri Nov 21 2025 09:55:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 首页-封装通用轮播组件提高复用</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/336329f9e365420e829cdb35963efd1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=TqJSGRK%2B6H5Xw7MpH2xVFRFS8J8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">1.1 轮播图的静态结构（直接复制就好）</h3>
<pre><code class="hljs language-ts" lang="ts">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> activeIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"carousel"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">swiper</span> <span class="hljs-attr">:circular</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">:autoplay</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">:interval</span>=<span class="hljs-string">"3000"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pages/index/index"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navigator"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span>
            <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFill"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/slider_1.jpg"</span>
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pages/index/index"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navigator"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span>
            <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFill"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/slider_2.jpg"</span>
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">swiper-item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">navigator</span> <span class="hljs-attr">url</span>=<span class="hljs-string">"/pages/index/index"</span> <span class="hljs-attr">hover-class</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navigator"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">image</span>
            <span class="hljs-attr">mode</span>=<span class="hljs-string">"aspectFill"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/slider_3.jpg"</span>
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">navigator</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">swiper-item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">swiper</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 指示点 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicator"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">text</span>
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in 3"</span>
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"item"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"dot"</span>
        <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ active: index === activeIndex }"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 轮播图 */</span>
<span class="hljs-selector-class">.carousel</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">280</span>rpx;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#efefef</span>;
  <span class="hljs-selector-class">.indicator</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">16</span>rpx;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-selector-class">.dot</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">30</span>rpx;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">6</span>rpx;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">8</span>rpx;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6</span>rpx;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.4</span>);
    }
    <span class="hljs-selector-class">.active</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    }
  }
  <span class="hljs-selector-class">.navigator</span>,
  <span class="hljs-selector-class">.image</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-2">1.2 修改一下组件引入规则（pages.json）</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/884c653aa36a48f489b66aa57abc75f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=oaiAXIKp2S1oeu5d2WSj0P02BSk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">1.2.1 添加组件类型声明</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a96f70735754d53b2a74e33f391edb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=3FfWs3Sfy4UZWibiH0KAK%2BOd9bM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57857eda5afc44cf93f8da0bf2af029e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=T1ywLdkku8GxJ7AgjINKQ1I%2B5IM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">1.3 轮播图的dots实现动态</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9636c18f2c5c444e9c434a2f7cf93ab5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=L61QzYcsDVHU1YN00RDUPhF2UVw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fc8585d7f0b4188a8cbc0d0cf3fbb28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=5%2FExRwflkvuw2K7t5TbJi34Vt9M%3D" alt="image.png" loading="lazy"/>
结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5522ac398f8f43edb91bffb824425f2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=sCzLe4KWu0GXybvmREkupSWBoYk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb8801cc2c1e48fb927cb61870df4cea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=bhDtkm%2F0g1NFLL%2BCxQIqeerBor0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e988a2e80c84f789427dc3f7590690c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=kOWNlOE87ZnGsRINpWCUzwMEv44%3D" alt="image.png" loading="lazy"/>
**本次练习重点知识点：
**
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d329a704c0034e80a42204caa9f1bf71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=%2F4Z4RMv4awBZIhoB92166lFflV4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">1.4 首页-获取轮播图数据</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8f54223302449ed9d4edb2b463a6d17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5rOh6ISa55qE6bih6IW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323959&amp;x-signature=E2gn9CNNV%2FMV2WY1WOQMdFvcDSg%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[钉钉小程序直传文件到 阿里云OSS]]></title>    <link>https://juejin.cn/post/7574749664493289506</link>    <guid>https://juejin.cn/post/7574749664493289506</guid>    <pubDate>2025-11-21T10:13:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574749664493289506" data-draft-id="7574978847151308840" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="钉钉小程序直传文件到 阿里云OSS"/> <meta itemprop="keywords" content="前端,uni-app,Vue.js"/> <meta itemprop="datePublished" content="2025-11-21T10:13:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="广白"/> <meta itemprop="url" content="https://juejin.cn/user/231309974726702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            钉钉小程序直传文件到 阿里云OSS
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/231309974726702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    广白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:13:08.000Z" title="Fri Nov 21 2025 10:13:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="tomorrow">.hljs-comment,.hljs-quote{color:#8e908c}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c82829}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5871f}.hljs-attribute{color:#eab700}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#718c00}.hljs-section,.hljs-title{color:#4271ae}.hljs-keyword,.hljs-selector-tag{color:#8959a8}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#4d4d4c}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>举个🌰，用钉钉小程序将一段视频在 前端 直接传到阿里云上。</p>
<p>由于 <code>js-base64</code> 这个npm包在钉钉小程序使用不了，而目前钉钉小程序又没有base64ToArrayBuffer这类方法，故只能曲线救国，使用 <code>dd.writeFile</code>和 <code>dd.readFile</code>来做<code>base64</code>的转换。</p>
<p>首先，我们得先处理OSS配置，具体如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> crypto <span class="hljs-keyword">from</span> <span class="hljs-string">"crypto-js"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">OSSConfig</span> = {
  <span class="hljs-title class_">AccessKeyId</span>: <span class="hljs-string">"xxxx"</span>,
  <span class="hljs-title class_">AccessKeySecret</span>: <span class="hljs-string">"xxxxxx"</span>,
  <span class="hljs-title class_">Host</span>: <span class="hljs-string">"xxxxx"</span>, <span class="hljs-comment">// 具体某个账号下,</span>
  <span class="hljs-title class_">SecurityToken</span>: <span class="hljs-string">"xx"</span>, <span class="hljs-comment">// 可选，使用STS签名时必传。</span>
}

<span class="hljs-comment">// 计算签名。</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">computeSignature</span> = (<span class="hljs-params">accessKeySecret, canonicalString</span>) =&gt; {
  <span class="hljs-keyword">return</span> crypto.<span class="hljs-property">enc</span>.<span class="hljs-property">Base64</span>.<span class="hljs-title function_">stringify</span>(
    crypto.<span class="hljs-title class_">HmacSHA1</span>(canonicalString, accessKeySecret)
  )
}

<span class="hljs-keyword">let</span> ossData = <span class="hljs-literal">null</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getOssConfig</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  date.<span class="hljs-title function_">setHours</span>(date.<span class="hljs-title function_">getHours</span>() + <span class="hljs-number">24</span>) <span class="hljs-comment">//加 1个小时</span>
  <span class="hljs-keyword">const</span> policyText = {
    <span class="hljs-attr">expiration</span>: date.<span class="hljs-title function_">toISOString</span>(), <span class="hljs-comment">// 设置policy过期时间。</span>
    <span class="hljs-attr">conditions</span>: [
      <span class="hljs-comment">// 限制上传大小。</span>
      [<span class="hljs-string">"content-length-range"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>],
    ],
  }
  <span class="hljs-keyword">let</span> fileManager = dd.<span class="hljs-title function_">getFileSystemManager</span>()
  fileManager.<span class="hljs-title function_">writeFile</span>({
    <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${dd.env.USER_DATA_PATH}</span>/test.txt`</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(policyText),
    <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> {
      fileManager.<span class="hljs-title function_">readFile</span>({
        <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${dd.env.USER_DATA_PATH}</span>/test.txt`</span>,
        <span class="hljs-attr">encoding</span>: <span class="hljs-string">"base64"</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">data</span>, <span class="hljs-string">"readFile"</span>)
          <span class="hljs-keyword">const</span> signature = <span class="hljs-title function_">computeSignature</span>(
            <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">AccessKeySecret</span>,
            res.<span class="hljs-property">data</span>
          )
          ossData = {
            <span class="hljs-title class_">OSSAccessKeyId</span>: <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">AccessKeyId</span>,
            signature,
            <span class="hljs-attr">policy</span>: res.<span class="hljs-property">data</span>,
            <span class="hljs-comment">// "x-oss-security-token": OSSConfig.SecurityToken,</span>
          }
        },
        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
        },
      })
    },
    <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
    },
  })
}
</code></pre>
<p>这个ossData就是我们处理好后的配置项，接下来将其填充到 <code>dd.uploadFile</code> 里就大功告成了！</p>
<pre><code class="hljs language-js" lang="js">dd.<span class="hljs-title function_">chooseVideo</span>({
        <span class="hljs-attr">sourceType</span>: [<span class="hljs-string">"album"</span>, <span class="hljs-string">"camera"</span>],
        <span class="hljs-attr">maxDuration</span>: <span class="hljs-number">60</span>,
        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
          <span class="hljs-keyword">let</span> uniqueId = <span class="hljs-string">`<span class="hljs-subst">${dirPath}</span>xcx-<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()}</span>.mp4`</span> <span class="hljs-comment">// dirPath为存储的文件夹路径， 比如"dev/front-end/video/"</span>
          uni.<span class="hljs-title function_">showLoading</span>({
            <span class="hljs-attr">title</span>: <span class="hljs-string">"视频上传中..."</span>,
          })
          dd.<span class="hljs-title function_">uploadFile</span>({
            <span class="hljs-attr">url</span>: <span class="hljs-title class_">OSSConfig</span>.<span class="hljs-property">Host</span>,
            <span class="hljs-attr">fileType</span>: <span class="hljs-string">"video"</span>,
            <span class="hljs-attr">fileName</span>: <span class="hljs-string">"file"</span>,
            <span class="hljs-attr">formData</span>: {
              ...ossData, <span class="hljs-comment">// 上述getOssConfig方法得到的结果</span>
              <span class="hljs-attr">key</span>: uniqueId, <span class="hljs-comment">// 该值为你存在在oss上的位置  后面上传成功之后拼接得到链接需要使用</span>
              <span class="hljs-attr">success_action_status</span>: <span class="hljs-string">"200"</span>, <span class="hljs-comment">// 默认上传成功状态码为204，此处被success_action_status设置为200。</span>
            },
            <span class="hljs-attr">filePath</span>: res.<span class="hljs-property">tempFilePath</span>,
            <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
              uni.<span class="hljs-title function_">hideLoading</span>()
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"视频上传成功,地址为："</span>,<span class="hljs-string">`<span class="hljs-subst">${OSSConfig.Host}</span>/<span class="hljs-subst">${uniqueId}</span>`</span>)
            },
            <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
              uni.<span class="hljs-title function_">hideLoading</span>()
            },
          })
        },
        <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
        },
      })
</code></pre>
<p><br/><br/>
<strong>欢迎小伙伴留言讨论，互相学习！</strong></p>
<p><strong>❤❤❤ 如果对你有帮助，记得点赞收藏哦！❤❤❤</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iFlyCode+SpecKit应用：照片等比智能压缩功能实现]]></title>    <link>https://juejin.cn/post/7574992086715088911</link>    <guid>https://juejin.cn/post/7574992086715088911</guid>    <pubDate>2025-11-21T09:58:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574992086715088911" data-draft-id="7574749664493109282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iFlyCode+SpecKit应用：照片等比智能压缩功能实现"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-21T09:58:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星火飞码iFlyCode"/> <meta itemprop="url" content="https://juejin.cn/user/4378703548127657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iFlyCode+SpecKit应用：照片等比智能压缩功能实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4378703548127657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星火飞码iFlyCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:58:38.000Z" title="Fri Nov 21 2025 09:58:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>iFlyCode+SpecKit</strong></p>
<p><strong>项目背景</strong></p>
<p>**需求来源：**业务上需要上传考生相片，支持历年存储，预期每年新增20w+，上传质量大小不一，除了大小判断外，需要对相片超过配置阈值（默认300KB）的照片进行智能压缩，还不能影响显示效果，同时考虑压缩性能，否则前端返回时间比较久，用户等待时间长。</p>
<p><strong>核心特性</strong></p>
<ul>
<li>
<p>✅ <strong>可配置阈值</strong>: 通过系统配置 <code>KsXpCompressSize</code> 动态调整压缩阈值</p>
</li>
<li>
<p>✅ <strong>智能压缩</strong>: 质量递减压缩 + 尺寸缩放双重策略</p>
</li>
<li>
<p>✅ <strong>大图优化</strong>: 超大图片预缩放，显著降低内存占用</p>
</li>
<li>
<p>✅ <strong>透明通道支持</strong>: 智能识别图片类型，支持PNG/GIF透明背景</p>
</li>
<li>
<p>✅ <strong>三重清理机制</strong>: 正常清理 + 异常清理 + JVM退出清理</p>
</li>
<li>
<p>✅ <strong>详细日志</strong>: 完整的压缩过程日志记录</p>
</li>
</ul>
<p><strong>提问过程</strong></p>
<p>将上述需求描述提交给iFlyCode，使用项目环境和设计智能体。<br/>
（执行片段如下图：）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/869096c39443422ba5c1751f9f26cbbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=i7TBF4quaK239IEvTkoiNd70GXM%3D" alt="" loading="lazy"/></p>
<p><strong>技术架构</strong></p>
<h3 data-id="heading-0">压缩流程图</h3>
<h3 data-id="heading-1">核心方法调用链</h3>
<blockquote>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">readXpFile</span>()    ├─ 判断文件大小 &gt; KsXpCompressSize    ├─ <span class="hljs-built_in">compressImage</span>()    │   ├─ 读取原始图片    │   ├─ 大图片检测与预缩放    │   │   ├─ 计算缩放比例    │   │   ├─ <span class="hljs-built_in">resizeImage</span>() - 预缩放    │   │   └─ 释放原图内存    │   ├─ 质量压缩循环    │   │   └─ <span class="hljs-built_in">compressImageWithQuality</span>()    │   ├─ 尺寸缩放备选    │   │   └─ <span class="hljs-built_in">resizeImage</span>()    │   └─ 返回压缩文件    ├─ fileHandler<span class="hljs-selector-class">.uploadFile</span>()    └─ 清理临时文件
</code></pre>
</blockquote>
<p><strong>核心代码实现</strong></p>
<h3 data-id="heading-2">1. 主压缩逻辑（readXpFile方法集成）</h3>
<p><strong>位置</strong>: <code>BkKsxpServiceImpl.java</code> 第822-849行</p>
<ul>
<li/>
</ul>
<h3 data-id="heading-3">2. 智能压缩方法（compressImage）</h3>
<p><strong>位置</strong>: <code>BkKsxpServiceImpl.java</code> 第1960-2090行</p>
<p><strong>核心特性</strong>:</p>
<ul>
<li>
<p>大图片预缩放优化（&gt;2MB或&gt;2000px）</p>
</li>
<li>
<p><strong>二分查找压缩算法</strong></p>
<p>（压缩次数减少50%）</p>
</li>
<li>
<p>尺寸缩放备选方案（80%）</p>
</li>
<li>
<p>完整的内存管理</p>
</li>
<li>
<p>三重临时文件清理</p>
</li>
<li/>
<li/>
</ul>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">3.</span> 质量压缩方法（compressImageWithQuality）
</code></pre>
<p><strong>位置</strong>: <code>BkKsxpServiceImpl.java</code> 第2096-2116行</p>
<pre><code class="hljs language-java" lang="java">privatevoidcompressImageWithQuality(BufferedImage image, File outputFile, <span class="hljs-type">float</span> quality) <span class="hljs-keyword">throws</span> IOException {    javax.imageio.<span class="hljs-type">ImageWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> ImageIO.getImageWritersByFormatName(<span class="hljs-string">"jpg"</span>).next();    javax.imageio.<span class="hljs-type">ImageWriteParam</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> writer.getDefaultWriteParam();        <span class="hljs-keyword">if</span> (param.canWriteCompressed()) {        param.setCompressionMode(javax.imageio.ImageWriteParam.MODE_EXPLICIT);        param.setCompressionQuality(quality);    }        <span class="hljs-keyword">try</span> (<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(outputFile);         javax.imageio.stream.<span class="hljs-type">ImageOutputStream</span> <span class="hljs-variable">ios</span> <span class="hljs-operator">=</span> ImageIO.createImageOutputStream(fos)) {        writer.setOutput(ios);        writer.write(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">javax</span>.imageio.IIOImage(image, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>), param);    } <span class="hljs-keyword">finally</span> {        writer.dispose();    }}
</code></pre>
<h3 data-id="heading-4">4. 尺寸缩放方法（resizeImage）</h3>
<p><strong>位置</strong>: <code>BkKsxpServiceImpl.java</code> 第2118-2141行</p>
<p><strong>特性</strong>: 支持透明通道（ARGB）</p>
<pre><code class="hljs language-perl" lang="perl">private BufferedImage resizeImage(BufferedImage originalImage, <span class="hljs-keyword">int</span> targetWidth, <span class="hljs-keyword">int</span> targetHeight){    <span class="hljs-regexp">//</span> 保持原图的图片类型，支持透明通道    <span class="hljs-keyword">int</span> imageType = originalImage.getType();    <span class="hljs-keyword">if</span> (imageType == <span class="hljs-number">0</span>) {        imageType = originalImage.getTransparency() == BufferedImage.OPAQUE            ? BufferedImage.TYPE_INT_RGB            : BufferedImage.TYPE_INT_ARGB;    }        BufferedImage resizedImage = new BufferedImage(targetWidth, targetHeight, imageType);    Graphics2D graphics = resizedImage.createGraphics();        <span class="hljs-regexp">//</span> 设置高质量渲染    graphics.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);    graphics.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);    graphics.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);        graphics.drawImage(originalImage, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, targetWidth, targetHeight, null);    graphics.dispose();        <span class="hljs-keyword">return</span> resizedImage;}
</code></pre>
<p><strong>配置说明</strong></p>
<h3 data-id="heading-5">系统配置参数</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80ab9ee4a6d6490ea55fc891f8a30cd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=HO1VeEPrs9nzuhCaGJmt356R3OY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">配置方法</h3>
<h4 data-id="heading-7">方法1: 数据库配置（推荐）</h4>
<pre><code class="hljs language-java" lang="java">-- 插入配置（如果不存在）INSERT INTO <span class="hljs-title function_">basis_syscfg</span><span class="hljs-params">(syscfg_key, syscfg_value, syscfg_desc)</span>VALUES(<span class="hljs-string">'KsXpCompressSize'</span>, <span class="hljs-string">'300'</span>, <span class="hljs-string">'照片压缩阈值（KB）'</span>);-- 更新配置UPDATE basis_syscfg <span class="hljs-type">SET</span> <span class="hljs-variable">syscfg_value</span> <span class="hljs-operator">=</span> <span class="hljs-string">'500'</span><span class="hljs-type">WHERE</span> <span class="hljs-variable">syscfg_key</span> <span class="hljs-operator">=</span> <span class="hljs-string">'KsXpCompressSize'</span>;
</code></pre>
<h4 data-id="heading-8">方法2: 系统管理界面</h4>
<ol>
<li>
<p>登录系统管理后台</p>
</li>
<li>
<p>进入"系统配置"模块</p>
</li>
<li>
<p>查找或添加 <code>KsXpCompressSize</code> 配置项</p>
</li>
<li>
<p>设置期望的阈值（单位：KB）</p>
</li>
<li>
<p>保存配置</p>
</li>
</ol>
<p><strong>性能优化详解</strong></p>
<h3 data-id="heading-9">1. 大图片预缩放策略</h3>
<h4 data-id="heading-10">优化前后对比</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a21d91ef3a0243a18fc21535412ed753~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=CI0j11Oi56K5ES1VyjHHHRHFGyc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">预缩放触发条件</h4>
<pre><code class="hljs language-ruby" lang="ruby">finallong <span class="hljs-variable constant_">LARGE_FILE_THRESHOLD</span> = <span class="hljs-number">2</span> * <span class="hljs-number">1024</span> * 1024L; <span class="hljs-regexp">//</span> 2MBfinalint <span class="hljs-variable constant_">LARGE_DIMENSION_THRESHOLD</span> = <span class="hljs-number">2000</span>; <span class="hljs-regexp">//</span> <span class="hljs-number">2000</span>像素/<span class="hljs-regexp">/ 满足以下任一条件触发预缩放：/</span><span class="hljs-regexp">/ 1. 文件大小 &gt; 2MB/</span><span class="hljs-regexp">/ 2. 宽度 &gt; 2000px/</span><span class="hljs-regexp">/ 3. 高度 &gt; 2000px
</span></code></pre>
<h4 data-id="heading-12">缩放比例计算</h4>
<pre><code class="hljs language-erlang" lang="erlang"><span class="hljs-function"><span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">"hello world!"</span>)</span>;// 策略1: 尺寸超标 - 等比例缩放到2000<span class="hljs-title">px</span>以内<span class="hljs-title">if</span> <span class="hljs-params">(width &gt; <span class="hljs-number">2000</span> || height &gt; <span class="hljs-number">2000</span>)</span> {    <span class="hljs-title">scaleFactor</span> = <span class="hljs-title">min</span><span class="hljs-params">(<span class="hljs-number">2000</span>/width, <span class="hljs-number">2000</span>/height)</span>;}// 策略2: 文件超大但尺寸正常 - 缩小到70%<span class="hljs-title">if</span> <span class="hljs-params">(fileSize &gt; <span class="hljs-number">2</span>MB &amp;&amp; scaleFactor == <span class="hljs-number">1.0</span>)</span> {    <span class="hljs-title">scaleFactor</span> = 0.7;}
</span></code></pre>
<h3 data-id="heading-13">2. 内存管理优化</h3>
<h4 data-id="heading-14">内存释放时机</h4>
<h4 data-id="heading-15">代码示例</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">//</span> <span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">预缩放后释放原图workingImage</span> <span class="hljs-string">=</span> <span class="hljs-string">resizeImage(originalImage,</span> <span class="hljs-string">preScaledWidth,</span> <span class="hljs-string">preScaledHeight);originalImage.flush();</span>  <span class="hljs-string">//</span> <span class="hljs-string">立即释放originalImage</span> <span class="hljs-string">=</span> <span class="hljs-literal">null</span><span class="hljs-string">;//</span> <span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">压缩完成后释放工作图workingImage.flush();workingImage</span> <span class="hljs-string">=</span> <span class="hljs-literal">null</span><span class="hljs-string">;//</span> <span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">finally块确保释放finally</span> {    <span class="hljs-string">if</span> <span class="hljs-string">(workingImage</span> <span class="hljs-type">!=</span> <span class="hljs-literal">null</span><span class="hljs-string">)</span> {        <span class="hljs-string">workingImage.flush();</span>    }}
</code></pre>
<h3 data-id="heading-16">3. 临时文件清理机制</h3>
<h4 data-id="heading-17">三重保障</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c435e0d197242e8ae59f6f5aee7f4bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=VSEWHAPscK4xgYwoeQS0cZNfiso%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">清理代码</h4>
<pre><code class="hljs language-vbnet" lang="vbnet">// <span class="hljs-number">1</span>. 创建时设置自动清理compressedFile = File.createTempFile(<span class="hljs-string">"compressed_"</span>, <span class="hljs-string">".jpg"</span>);compressedFile.deleteOnExit();  // JVM退出时自动删除// <span class="hljs-number">2</span>. 正常使用后清理<span class="hljs-keyword">if</span> (fileToUpload != readFile &amp;&amp; fileToUpload.exists()) {    fileToUpload.delete();}// <span class="hljs-number">3</span>. 异常情况清理<span class="hljs-keyword">catch</span> (Exception e) {    <span class="hljs-keyword">if</span> (compressedFile != null &amp;&amp; compressedFile.exists()) {        <span class="hljs-keyword">try</span> {            compressedFile.delete();        } <span class="hljs-keyword">catch</span> (Exception deleteEx) {            SysLogUtils.printLogger(<span class="hljs-string">"删除临时文件失败"</span>);        }    }}
</code></pre>
<p><strong>单元测试</strong></p>
<h3 data-id="heading-19">测试场景</h3>
<h4 data-id="heading-20">1. 功能测试</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/946aa40fea8c49db9eb787762c83c5b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=844SPxRfc9itqJtGh4%2FAt0YkCzk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-21">2. 性能测试</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">测试场景1: 单张大图片- 文件: 4000x3000, 2MB- 预期: 内存占用 &lt; 20MB, 处理时间 &lt; 3秒<span class="hljs-comment"># 测试场景2: 批量上传- 文件: 100张混合大小照片- 预期: 无内存溢出, 总时间 &lt; 30秒# 测试场景3: 极限测试- 文件: 8000x6000, 10MB- 预期: 成功压缩, 无崩溃</span></span>
</code></pre>
<h4 data-id="heading-22">3. 边界测试</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 测试用例1. 损坏的图片文件 → 应返回null，使用原图2. 非JPG格式 → 应正常处理（PNG/GIF）3. 阈值为0 → 应使用默认值300KB4. 极小图片（10KB） → 不压缩5. 正方形图片 → 等比例缩放6. 极窄/极宽图片 → 正确计算缩放比例</span>
</code></pre>
<h3 data-id="heading-23">测试步骤</h3>
<h4 data-id="heading-24">准备工作</h4>
<pre><code class="hljs language-arduino" lang="arduino">-- <span class="hljs-number">1.</span> 配置压缩阈值<span class="hljs-function">INSERT INTO <span class="hljs-title">basis_syscfg</span><span class="hljs-params">(syscfg_key, syscfg_value, syscfg_desc)</span><span class="hljs-title">VALUES</span><span class="hljs-params">(<span class="hljs-string">'KsXpCompressSize'</span>, <span class="hljs-string">'300'</span>, <span class="hljs-string">'照片压缩阈值（KB）'</span>)</span></span>;
</code></pre>
<h4 data-id="heading-25">执行测试</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">2. 准备测试照片- 小照片: 150KB (不压缩)- 中照片: 500KB (质量压缩)- 大照片: 2MB (预缩放+压缩)- PNG照片: 带透明背景<span class="hljs-comment"># 3. 批量上传测试- 打包成ZIP文件- 通过系统上传- 检查日志输出- 验证存储结果# 4. 验证结果- 检查照片大小是否符合阈值- 检查照片质量是否可接受- 检查透明通道是否保留- 检查临时文件是否清理</span></span>
</code></pre>
<p><strong>日志示例</strong></p>
<h3 data-id="heading-26">正常压缩日志</h3>
<pre><code class="hljs language-scss" lang="scss">照片 <span class="hljs-number">20240101001</span><span class="hljs-selector-class">.jpg</span> 从 <span class="hljs-number">450</span>KB 压缩到 <span class="hljs-number">280</span>KB (阈值: <span class="hljs-number">300</span>KB)
</code></pre>
<h3 data-id="heading-27">大图片预缩放日志</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">大图片预缩放: IMG_4000x3000.jpg, 原尺寸: 4000x3000, 预缩放到: 2000x1500 (比例: 0.50)压缩成功: IMG_4000x3000.jpg, 质量: 0.7, 大小: 285KB</span>
</code></pre>
<h3 data-id="heading-28">尺寸缩放日志</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">通过缩小尺寸压缩: large_photo.jpg, 新尺寸: 1600x1200, 大小: 295KB</span>
</code></pre>
<h3 data-id="heading-29">压缩失败日志</h3>
<pre><code class="hljs language-lua" lang="lua">压缩照片失败: corrupted.jpg, Cannot <span class="hljs-built_in">read</span> <span class="hljs-built_in">input</span> file!
</code></pre>
<p><strong>性能指标</strong></p>
<h3 data-id="heading-30">压缩效果统计</h3>
<h3 data-id="heading-31"/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efdea862258c435fa9203f935c53da6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764323917&amp;x-signature=RI8aYIgsWUpLIDUhu64nFqjxry0%3D" alt="" loading="lazy"/></p>
<p><strong>效果总结</strong></p>
<p>1、原计划3个工作日完成，使用iFlyCode，省去寻找方案的时间，1天左右完成，提效66%；<br/>
2、经过生产验证，该压缩方案成功率100%，效果符合预期，即300k以上相片压缩至300k内，不影响打印效果呈现，满足业务需求，后期可以将本方法抽象成为通用方法进行复用。</p>
<p>— END —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【底层机制】Android图形渲染体系深度解析：VSync信号机制]]></title>    <link>https://juejin.cn/post/7574967214128365594</link>    <guid>https://juejin.cn/post/7574967214128365594</guid>    <pubDate>2025-11-21T10:26:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574967214128365594" data-draft-id="7574991051435130890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【底层机制】Android图形渲染体系深度解析：VSync信号机制"/> <meta itemprop="keywords" content="Android,面试"/> <meta itemprop="datePublished" content="2025-11-21T10:26:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="沐怡旸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【底层机制】Android图形渲染体系深度解析：VSync信号机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    沐怡旸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T10:26:42.000Z" title="Fri Nov 21 2025 10:26:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Android图形渲染体系中，VSync（Vertical Synchronization，垂直同步）是贯穿CPU、GPU与显示器协同工作的核心机制。它不仅解决了画面撕裂、卡顿等关键问题，更定义了Android渲染的"时间节拍"。本文将从底层原理、Android实现架构、关键细节到开发实践，系统拆解VSync信号机制的核心逻辑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc8f52138b3346d6b0e4c9c446905f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764325602&amp;x-signature=IuI9nAthKoDx1mhs%2FWX8yyjnfIw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">一、核心定义：什么是VSync信号？</h2>
<p>VSync信号本质是<strong>显示器硬件产生的周期性同步信号</strong>，其周期与显示器刷新率强相关（例如60Hz刷新率对应16.67ms/帧，90Hz对应11.11ms/帧）。</p>
<h3 data-id="heading-1">关键背景：显示器的工作原理</h3>
<p>现代显示器通常采用"逐行扫描"方式刷新画面：</p>
<ol>
<li><strong>有效扫描期</strong>：从屏幕左上角开始，逐行扫描至右下角，完成一帧画面的显示；</li>
<li><strong>垂直消隐期（VBlank Period）</strong>：一帧扫描结束后，电子束返回左上角准备下一次扫描的间隙，此时显示器暂不更新画面。</li>
</ol>
<p>VSync信号恰好产生于<strong>垂直消隐期的起始时刻</strong>——这个时间点是显示器"准备好接收新帧"的关键窗口期，也是CPU/GPU同步工作的基准时间点。</p>
<h2 data-id="heading-2">二、设计初衷：为什么需要VSync？</h2>
<p>没有VSync时，Android渲染存在两个致命问题，而VSync通过"强制同步"从根源上解决了这些问题。</p>
<h3 data-id="heading-3">1. 画面撕裂（Screen Tearing）</h3>
<ul>
<li><strong>问题本质</strong>：GPU渲染新帧的速度与显示器刷新速度不同步。当显示器还在扫描当前帧时，GPU已完成新帧渲染并写入帧缓冲区，导致显示器同时显示"上一帧下半部分"和"新帧上半部分"，形成撕裂线。</li>
<li><strong>VSync的解决逻辑</strong>：强制GPU只能在<strong>VSync信号触发后的垂直消隐期</strong>更新帧缓冲区。这样确保显示器在有效扫描期只读取完整的一帧数据。</li>
</ul>
<h3 data-id="heading-4">2. 帧数据浪费（Wasted Frames）</h3>
<ul>
<li><strong>问题本质</strong>：GPU渲染速度过快时，会在一个显示器周期内生成多帧数据，但显示器只能按自身节奏读取一帧，其余帧数据被覆盖丢弃，造成计算资源浪费。</li>
<li><strong>VSync的解决逻辑</strong>：通过信号同步GPU的渲染节奏，使其仅在每个VSync周期内执行一次完整的渲染提交流程，确保每帧渲染都有对应的显示时机。</li>
</ul>
<h3 data-id="heading-5">3. 双缓冲与VSync的协同</h3>
<p>双缓冲机制（Double Buffering）本身不能完全解决同步问题：</p>
<ul>
<li>若GPU在有效扫描期完成后台缓冲更新，缓冲切换仍可能导致撕裂；</li>
<li>双缓冲未定义"何时开始渲染"的基准，GPU可能在帧周期内任意时间启动工作。</li>
</ul>
<p>VSync为双缓冲机制增加了"时间基准"——只有在VSync信号到来时，才允许后台缓冲与前台缓冲交换，彻底解决同步问题。</p>
<h2 data-id="heading-6">三、底层原理：VSync的工作机制</h2>
<p>VSync的核心逻辑是"<strong>以显示器刷新率为基准，强制GPU的渲染节奏与显示器保持一致</strong>"，其完整工作流程可拆解为三个关键阶段：</p>
<h3 data-id="heading-7">1. VSync信号的产生与分发</h3>
<ul>
<li><strong>信号源</strong>：由显示器控制器硬件生成，周期固定为显示器刷新率的倒数；</li>
<li><strong>分发路径</strong>：硬件信号通过显示驱动（如DRM/KMS子系统）传递至SurfaceFlinger，再由SurfaceFlinger分发至应用进程。</li>
</ul>
<h3 data-id="heading-8">2. 渲染流程的同步控制</h3>
<p>以60Hz刷新率（16.67ms周期）为例：</p>
<ol>
<li><strong>T0时刻</strong>：VSync信号触发，垂直消隐期开始；</li>
<li><strong>应用工作阶段（T0-T1）</strong>：应用进程接收VSync信号，执行UI线程的Measure、Layout、Draw；</li>
<li><strong>RenderThread工作（T1-T2）</strong>：将绘制命令转换为GL命令，提交给GPU；</li>
<li><strong>GPU工作阶段（T2-T3）</strong>：GPU执行渲染，将最终帧写入缓冲区；</li>
<li><strong>缓冲区交换（下次VSync）</strong>：SurfaceFlinger在垂直消隐期执行缓冲区交换。</li>
</ol>
<p><strong>关键约束</strong>：应用测量布局+渲染+GPU处理的总耗时必须≤16.67ms（60Hz场景），否则会导致掉帧。</p>
<h3 data-id="heading-9">3. 三重缓冲（Triple Buffering）的优化</h3>
<p>当渲染耗时偶尔超过VSync周期时，双缓冲会导致严重卡顿，三重缓冲提供优化：</p>
<ul>
<li><strong>核心逻辑</strong>：增加一个额外的缓冲区。当应用准备好新帧但前缓冲区仍被占用时，新帧可写入第三个缓冲区；</li>
<li><strong>优势</strong>：避免应用因等待缓冲区而阻塞，保持渲染流水线的持续运转；</li>
<li><strong>代价</strong>：增加内存占用和潜在的显示延迟。</li>
</ul>
<h2 data-id="heading-10">四、Android中的实现架构</h2>
<p>Android将VSync机制深度集成到图形渲染栈中，形成"SurfaceFlinger + Choreographer + RenderThread"的协同架构。</p>
<h3 data-id="heading-11">1. 核心组件分工</h3>



































<table><thead><tr><th>组件</th><th>角色定位</th><th>核心职责</th></tr></thead><tbody><tr><td>显示器硬件</td><td>信号源</td><td>产生原始VSync信号</td></tr><tr><td>显示驱动</td><td>信号中转</td><td>接收硬件VSync，通过内核接口暴露</td></tr><tr><td>SurfaceFlinger</td><td>系统级同步中枢</td><td>管理VSync分发、缓冲区交换、图层合成</td></tr><tr><td>Choreographer</td><td>应用级同步代理</td><td>接收VSync信号，调度UI更新、动画、绘制</td></tr><tr><td>RenderThread</td><td>应用渲染线程</td><td>将View树转换为GL命令，管理GPU渲染</td></tr></tbody></table>
<h3 data-id="heading-12">2. VSync信号的传递链路</h3>
<pre><code class="hljs language-swift" lang="swift">显示器硬件 <span class="hljs-operator">→</span> 显示驱动 <span class="hljs-operator">→</span> <span class="hljs-type">SurfaceFlinger</span> <span class="hljs-operator">→</span> <span class="hljs-type">Binder</span> <span class="hljs-type">IPC</span> <span class="hljs-operator">→</span> <span class="hljs-type">Choreographer</span> <span class="hljs-operator">→</span> <span class="hljs-type">UI线程</span><span class="hljs-operator">/</span><span class="hljs-type">RenderThread</span>
</code></pre>
<p><strong>关键实现细节</strong>：</p>
<ul>
<li>SurfaceFlinger通过<code>EventThread</code>管理VSync分发；</li>
<li>Choreographer通过<code>FrameDisplayEventReceiver</code>接收VSync信号；</li>
<li>应用通过<code>Choreographer#postFrameCallback</code>注册渲染回调。</li>
</ul>
<h3 data-id="heading-13">3. 双VSync机制：APP与SF的分离</h3>
<p>Android引入双VSync设计，将应用渲染与系统合成解耦：</p>
<ul>
<li><strong>VSYNC_APP</strong>：触发应用进程的渲染工作；</li>
<li><strong>VSYNC_SF</strong>：触发SurfaceFlinger的图层合成工作。</li>
</ul>
<p><strong>设计价值</strong>：为SurfaceFlinger预留固定的合成时间，避免因应用渲染耗时接近周期上限而导致合成超时。</p>
<h2 data-id="heading-14">五、关键细节与进阶认知</h2>
<h3 data-id="heading-15">1. VSync周期的动态调整（可变刷新率）</h3>
<p>现代Android设备支持可变刷新率（Variable Refresh Rate）：</p>
<ul>
<li><strong>节能模式</strong>：静态内容时降低至30Hz、60Hz；</li>
<li><strong>流畅模式</strong>：滑动、游戏时提升至90Hz、120Hz；</li>
<li><strong>实现机制</strong>：通过显示驱动动态调整VSync信号周期。</li>
</ul>
<h3 data-id="heading-16">2. VSync偏移（VSync Offset）的精确控制</h3>
<p>VSync偏移优化应用渲染与系统合成的时间分配：</p>
<ul>
<li><strong>目标</strong>：确保应用渲染完成后，SurfaceFlinger有足够时间完成合成；</li>
<li><strong>计算依据</strong>：基于显示器的VBlank时长、合成耗时等因素动态调整。</li>
</ul>
<h3 data-id="heading-17">3. 离线渲染与VSync的协同</h3>
<p>当应用使用<code>SurfaceTexture</code>进行相机预览、视频播放时：</p>
<ul>
<li>生产者（Camera、MediaCodec）异步写入帧数据；</li>
<li>消费者（应用/SurfaceFlinger）在VSync时刻获取最新帧；</li>
<li>通过<code>FrameAvailableListener</code>实现生产-消费的同步。</li>
</ul>
<h2 data-id="heading-18">六、开发实践：基于VSync的优化技巧</h2>
<h3 data-id="heading-19">1. 使用Choreographer精准控制渲染时机</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyView</span> : <span class="hljs-type">View</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> choreographer = Choreographer.getInstance()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> frameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            <span class="hljs-comment">// 基于VSync执行动画或渲染</span>
            updateAnimation(frameTimeNanos)
            invalidate()
            <span class="hljs-comment">// 注册下一帧回调</span>
            choreographer.postFrameCallback(<span class="hljs-keyword">this</span>)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startAnimation</span><span class="hljs-params">()</span></span> {
        choreographer.postFrameCallback(frameCallback)
    }
}
</code></pre>
<h3 data-id="heading-20">2. 监控和优化帧率</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 帧率监控实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FrameRateMonitor</span> : <span class="hljs-type">Choreographer.FrameCallback</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastFrameTime = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> frameIntervals = mutableListOf&lt;<span class="hljs-built_in">Long</span>&gt;()
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
        <span class="hljs-keyword">if</span> (lastFrameTime &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">val</span> interval = (frameTimeNanos - lastFrameTime) / <span class="hljs-number">1_000_000</span> <span class="hljs-comment">// 转换为ms</span>
            frameIntervals.add(interval)
            <span class="hljs-comment">// 分析帧间隔，检测掉帧</span>
            <span class="hljs-keyword">if</span> (interval &gt; <span class="hljs-number">16.67</span>) { <span class="hljs-comment">// 60Hz标准周期</span>
                onFrameDropped(interval)
            }
        }
        lastFrameTime = frameTimeNanos
        Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
    }
}
</code></pre>
<h3 data-id="heading-21">3. 渲染性能优化策略</h3>
<ul>
<li><strong>UI线程优化</strong>：减少View层级，避免测量布局的重复计算</li>
<li><strong>渲染线程优化</strong>：控制Canvas操作复杂度，减少路径和阴影使用</li>
<li><strong>GPU优化</strong>：减少过度绘制，合理使用硬件层缓存</li>
</ul>
<h3 data-id="heading-22">4. 高级调试技巧</h3>
<p>使用系统工具深入分析VSync相关问题：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看VSync调试信息</span>
adb shell dumpsys SurfaceFlinger --vsync

<span class="hljs-comment"># 分析应用帧率统计  </span>
adb shell dumpsys gfxinfo &lt;package_name&gt; framestats
</code></pre>
<h2 data-id="heading-23">七、总结</h2>
<p>VSync信号机制为Android渲染建立了"显示器驱动"的时间同步基准。通过硬件信号触发、系统级分发、应用级响应的全链路设计，解决了画面撕裂、帧率不稳定等核心问题。</p>
<p>对于Android开发者，深入理解VSync机制能够：</p>
<ul>
<li>建立"帧级精度"的性能优化思维</li>
<li>准确诊断和解决卡顿、掉帧问题</li>
<li>设计出符合显示刷新特性的流畅动画</li>
<li>为高刷新率、可变刷新率等新技术做好准备</li>
</ul>
<p>随着120Hz+高刷新率显示器的普及和可变刷新率技术的成熟，VSync机制继续演进，但其"同步渲染节奏、保障画面完整性"的核心价值始终不变。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[文件下载：后端配置、前端方式与进度监控]]></title>    <link>https://juejin.cn/post/7574978545143840803</link>    <guid>https://juejin.cn/post/7574978545143840803</guid>    <pubDate>2025-11-21T09:05:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574978545143840803" data-draft-id="7574704948152516660" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="文件下载：后端配置、前端方式与进度监控"/> <meta itemprop="keywords" content="前端,JavaScript,浏览器"/> <meta itemprop="datePublished" content="2025-11-21T09:05:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拉不动的猪"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            文件下载：后端配置、前端方式与进度监控
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拉不动的猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:05:23.000Z" title="Fri Nov 21 2025 09:05:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、后端核心配置：决定下载的 “基础规则”</h3>
<p>后端通过 HTTP 响应头控制文件的传输行为，这是所有下载逻辑的起点，关键配置有 3 个：</p>
<h4 data-id="heading-1">1. <code>Content-Disposition</code>：控制 “下载” 或 “预览”</h4>
<ul>
<li>
<p><strong>配置 1（强制下载）</strong> ：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">Content</span>-Disposition: attachment; filename="file<span class="hljs-selector-class">.xlsx</span>"
</code></pre>
<ul>
<li>作用：告诉浏览器 “这是一个需要下载的附件”，无论文件类型是什么（图片 / PDF/Excel），都会直接触发下载弹窗。</li>
<li>细节：<code>filename</code> 指定默认下载文件名，支持 UTF-8 编码（需处理中文：<code>filename*=UTF-8''%E6%88%91%E7%9A%84%E6%96%87%E4%BB%B6.xlsx</code>）。</li>
</ul>
</li>
<li>
<p><strong>配置 2（在线预览）</strong> ：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-type">Content</span>-<span class="hljs-type">Disposition</span>: <span class="hljs-keyword">inline</span>
</code></pre>
<ul>
<li>作用：告诉浏览器 “直接在页面内预览文件”，比如图片直接显示、PDF 在浏览器打开、TXT 直接渲染。</li>
<li>细节：若不设置该字段，浏览器会根据 <code>Content-Type</code> 自动判断（图片 / PDF 默认预览，Excel / 压缩包默认下载）。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">2. <code>Content-Type</code>：定义文件的 “类型标识”</h4>
<ul>
<li>
<p>作用：告诉浏览器文件的 MIME 类型，决定浏览器如何解析文件（即使配置了 <code>attachment</code>，浏览器也会根据类型处理下载）。</p>
</li>
<li>
<p>常见配置：
# Excel 文件
Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
# PDF 文件
Content-Type: application/pdf
# 图片
Content-Type: image/jpeg
# 二进制流（通用，推荐大文件）
Content-Type: application/octet-stream</p>
</li>
<li>
<p>关键：若后端返回 <code>application/octet-stream</code>（二进制流），浏览器会直接判定为 “可下载文件”，优先级高于 <code>inline</code>。</p>
</li>
</ul>
<h4 data-id="heading-3">3. <code>Content-Length</code>：提供文件的 “总大小”</h4>
<ul>
<li>
<p>配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Content-Length:</span> <span class="hljs-number">10485760</span>  <span class="hljs-comment"># 表示文件大小为 10MB</span>
</code></pre>
</li>
<li>
<p>作用：告诉前端文件的总字节数，是前端计算下载进度的<strong>必要条件</strong>（没有这个头，前端无法知道 “总大小”，只能显示 “已下载字节”，无法算百分比）。</p>
</li>
<li>
<p>注意：若后端用 “分块传输”（<code>Transfer-Encoding: chunked</code>），则不会返回 <code>Content-Length</code>，前端无法计算进度。</p>
</li>
</ul>
<h4 data-id="heading-4">4. 其他辅助配置</h4>
<ul>
<li><code>Accept-Ranges: bytes</code>：支持断点续传，前端可请求文件的某一部分（<code>Range: bytes=0-1023</code>），适合大文件分段下载。</li>
<li><code>Access-Control-Expose-Headers: Content-Length</code>：跨域场景下，允许前端读取 <code>Content-Length</code> 等响应头（否则前端拿不到总大小）。</li>
</ul>
<h3 data-id="heading-5">二、前端下载方式：根据需求选择 “策略”</h3>
<p>前端有 3 种主流下载方式，对应不同场景，和后端配置直接关联：</p>
<h4 data-id="heading-6">方式 1：原生 <code>&lt;a&gt;</code> 标签（最简单，无进度）</h4>
<ul>
<li>
<p><strong>用法</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;a <span class="hljs-attr">href</span>=<span class="hljs-string">"/api/download/file"</span> download=<span class="hljs-string">"自定义文件名.xlsx"</span>&gt;下载&lt;/a&gt;
</code></pre>
</li>
<li>
<p><strong>适用场景</strong>：后端已配置 <code>Content-Disposition: attachment</code>，且无需监控进度（小文件、对进度无要求）。</p>
</li>
<li>
<p><strong>和后端配置的关联</strong>：</p>
<ul>
<li>若后端配了 <code>attachment</code>：点击直接下载，<code>download</code> 属性可自定义文件名（优先级高于后端的 <code>filename</code>）。</li>
<li>若后端配了 <code>inline</code>：浏览器会预览文件，此时加 <code>download</code> 属性可强制触发下载（部分浏览器支持）。</li>
</ul>
</li>
<li>
<p><strong>局限性</strong>：无法监控进度、无法处理复杂逻辑（如权限验证、Token 携带）。</p>
</li>
</ul>
<h4 data-id="heading-7">方式 2：<code>window.open()</code>（和 <code>&lt;a&gt;</code> 标签类似）</h4>
<ul>
<li>
<p><strong>用法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">'/api/download/file?token=xxx'</span>);
</code></pre>
</li>
<li>
<p><strong>适用场景</strong>：需要携带参数（如 Token）的下载，或需要新开窗口处理。</p>
</li>
<li>
<p><strong>缺点</strong>：同样无法监控进度，且可能被浏览器拦截（弹窗拦截）。</p>
</li>
</ul>
<h4 data-id="heading-8">方式 3：AJAX/fetch + Blob（支持进度，最灵活）</h4>
<ul>
<li>
<p><strong>核心逻辑</strong>：前端主动请求文件二进制流，监控传输过程，最后模拟下载。</p>
</li>
<li>
<p><strong>和后端配置的关联</strong>：</p>
<ul>
<li>后端需返回二进制流（<code>Content-Type: application/octet-stream</code> 或对应文件类型）。</li>
<li>若后端配了 <code>Content-Length</code>，可计算精确进度；否则只能监控 “已下载字节”。</li>
</ul>
</li>
<li>
<p><strong>完整代码示例（带进度）</strong> ：</p>
<pre><code class="hljs language-ini" lang="ini">// 1. 创建请求对象
const <span class="hljs-attr">xhr</span> = new XMLHttpRequest()<span class="hljs-comment">;</span>
xhr.open('GET', '/api/download/large-file.zip', true)<span class="hljs-comment">;</span>
<span class="hljs-attr">xhr.responseType</span> = <span class="hljs-string">'blob'</span><span class="hljs-comment">; // 关键：以 Blob 接收响应</span>

// 2. 监控进度
xhr.addEventListener('progress', (e) =&gt; {
  if (e.lengthComputable) {
    const <span class="hljs-attr">progress</span> = (e.loaded / e.total) * <span class="hljs-number">100</span><span class="hljs-comment">; // 进度百分比</span>
    console.log(`下载进度：${progress.toFixed(2)}%`)<span class="hljs-comment">;</span>
    // 更新 UI：比如进度条宽度、文字提示
    document.getElementById('progress-bar').<span class="hljs-attr">style.width</span> = `<span class="hljs-variable">${progress}</span>%`<span class="hljs-comment">;</span>
  } else {
    console.log(`已下载：${e.loaded} 字节`)<span class="hljs-comment">; // 无总大小，只能显示已下载</span>
  }
})<span class="hljs-comment">;</span>

// 3. 请求成功：生成下载链接
xhr.addEventListener('load', () =&gt; {
  if (<span class="hljs-attr">xhr.status</span> === <span class="hljs-number">200</span>) {
    const <span class="hljs-attr">blob</span> = xhr.response<span class="hljs-comment">;</span>
    const <span class="hljs-attr">url</span> = URL.createObjectURL(blob)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">a</span> = document.createElement(<span class="hljs-string">'a'</span>)<span class="hljs-comment">;</span>
    <span class="hljs-attr">a.href</span> = url<span class="hljs-comment">;</span>
    <span class="hljs-attr">a.download</span> = <span class="hljs-string">'大文件.zip'</span><span class="hljs-comment">; // 自定义文件名</span>
    a.click()<span class="hljs-comment">;</span>
    URL.revokeObjectURL(url)<span class="hljs-comment">; // 释放内存</span>
  }
})<span class="hljs-comment">;</span>

// 4. 发送请求（可携带 Token）
xhr.setRequestHeader('Authorization', 'Bearer ' + token)<span class="hljs-comment">;</span>
xhr.send()<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>优势</strong>：</p>
<ul>
<li>可监控实时进度；</li>
<li>可携带自定义请求头（如 Token），处理权限验证；</li>
<li>可中断请求（<code>xhr.abort()</code>）；</li>
<li>可处理后端返回的错误（如权限不足时，后端返回 JSON 而非文件，前端可捕获）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">三、下载进度的关联逻辑：为什么只有 Blob 方式能监控？</h3>
<p>进度监控的核心是<strong>前端能感知 “数据传输的每一步”</strong> ，这和请求方式直接相关：</p>
<h4 data-id="heading-10">1. <code>&lt;a&gt;</code> 标签 /<code>window.open()</code>：进度 “不可见”</h4>
<ul>
<li>
<p>这两种方式是<strong>浏览器直接和后端通信</strong>，前端 JS 被排除在传输过程之外：</p>
<ul>
<li>浏览器接收到后端的响应头后，直接启动下载进程，JS 无法获取 “已下载多少字节”“总字节数”。</li>
<li>相当于 “把下载交给浏览器，前端只能等结果”，自然无法监控进度。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-11">2. AJAX/fetch + Blob：进度 “可感知”</h4>
<ul>
<li>
<p>这种方式是<strong>前端 JS 主动和后端通信</strong>，数据先流经 JS，再交给浏览器：</p>
<ul>
<li>后端以 “流” 的形式分段返回数据，每返回一段，就触发 <code>progress</code> 事件；</li>
<li>事件对象 <code>e</code> 包含 <code>loaded</code>（已接收字节）和 <code>total</code>（总字节，来自 <code>Content-Length</code>），前端可实时计算进度；</li>
<li>所有数据接收完成后，JS 将二进制流封装成 Blob，再模拟 <code>&lt;a&gt;</code> 标签下载。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-12">3. 进度监控的关键前提</h4>
<ul>
<li>后端必须返回 <code>Content-Length</code>（否则 <code>e.lengthComputable</code> 为 <code>false</code>，无法算百分比）；</li>
<li>后端不能用 “分块传输”（<code>Transfer-Encoding: chunked</code>），否则无 <code>Content-Length</code>；</li>
<li>跨域时，后端需配置 <code>Access-Control-Expose-Headers: Content-Length</code>，否则前端拿不到 <code>total</code>。</li>
</ul>
<h3 data-id="heading-13">四、完整关联链总结</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b21fc3c0e8034eeeb9a67131dd7d8cfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ouJ5LiN5Yqo55qE54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764320723&amp;x-signature=fWEbgRq6KnshXsnqEnwpXIvOGpM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">核心关键点回顾</h3>
<ol>
<li><strong>后端是基础</strong>：<code>Content-Disposition</code> 决定默认行为，<code>Content-Length</code> 决定能否算进度，<code>Content-Type</code> 决定文件解析方式。</li>
<li><strong>前端选方式</strong>：小文件 / 无进度需求用 <code>&lt;a&gt;</code> 标签，大文件 / 需进度用 AJAX+Blob。</li>
<li><strong>进度靠流控</strong>：只有让文件以二进制流形式流经前端 JS，才能捕获传输进度，<code>&lt;a&gt;</code> 标签做不到这一点。</li>
</ol>
<p>简单说：后端定 “规则”，前端选 “策略”，进度靠 “流控”—— 这就是三者的核心关联！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS：属性动画]]></title>    <link>https://juejin.cn/post/7574803558878396431</link>    <guid>https://juejin.cn/post/7574803558878396431</guid>    <pubDate>2025-11-21T09:11:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574803558878396431" data-draft-id="7574749664492945442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS：属性动画"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-11-21T09:11:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ChinaDragon"/> <meta itemprop="url" content="https://juejin.cn/user/3966693681410840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS：属性动画
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693681410840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ChinaDragon
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:11:37.000Z" title="Fri Nov 21 2025 09:11:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、属性动画概述</h3>
<blockquote>
<p>属性接口（以下简称属性）包含尺寸属性、布局属性、位置属性等多种类型，用于控制组件的行为。针对当前界面上的组件，其部分属性（如位置属性）的变化会引起UI的变化。添加动画可以让属性值从起点逐渐变化到终点，从而产生连续的动画效果。为保障动画起点和终点的正确性，属性动画会将当前在标脏队列内的所有节点进行刷新。如果发现当前动画时长较长时，需要确认当前是否有额外的节点刷新。根据变化时是否能够添加动画，可以将属性分为可动画属性和不可动画属性。判断一种属性是否适合作为可动画属性主要有两个标准：</p>
<ol>
<li>属性变化能够引起UI的变化。例如，enabled属性用于控制组件是否可以响应点击、触摸等事件，但enabled属性的变化不会引起UI的变化，因此不适合作为可动画属性。</li>
<li>属性在变化时适合添加动画作为过渡。例如，focusable属性决定当前组件是否可以获得焦点，当focusable属性发生变化时，应立即切换到终点值以响应用户行为，不应该加入动画效果，因此不适合作为可动画属性。</li>
</ol>
</blockquote>
<h4 data-id="heading-1">1.1 属性接口分类说明：</h4>
<p><strong>可动画属性：</strong></p>
<ul>
<li>系统可动画属性：</li>
</ul>









































<table><thead><tr><th align="left">分类</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">布局属性</td><td align="left">位置、大小、内边距、外边距、对齐方式、权重等。</td></tr><tr><td align="left">仿射变换</td><td align="left">平移、旋转、缩放、锚点等。</td></tr><tr><td align="left">背景</td><td align="left">背景颜色、背景模糊等。</td></tr><tr><td align="left">内容</td><td align="left">文字大小、文字颜色，图片对齐方式、模糊等。</td></tr><tr><td align="left">前景</td><td align="left">前景颜色等。</td></tr><tr><td align="left">Overlay</td><td align="left">Overlay属性等。</td></tr><tr><td align="left">外观</td><td align="left">透明度、圆角、边框、阴影等。</td></tr><tr><td align="left">...</td><td align="left">...</td></tr></tbody></table>
<ul>
<li>自定义可动画属性：通过自定义属性动画机制抽象出的可动画属性。</li>
</ul>
<p><strong>不可动画属性：zIndex、focusable等。</strong></p>
<blockquote>
<p>通常，可动画属性的参数数据类型必须具备连续性，即可以通过插值方法来填补数据点之间的空隙，达到视觉上的连续效果。但属性的参数数据类型是否能够进行插值并非决定属性是否可动画的关键因素。例如，对于设置元素水平方向布局的<strong>direction</strong>属性，其参数数据类型是枚举值。但是，由于位置属性是可动画属性，ArkUI同样支持在其属性值改变引起组件位置变化时添加动画。</p>
</blockquote>
<blockquote>
<p>对于可动画属性，系统不仅提供通用属性，还支持自定义可动画属性。</p>
<ul>
<li>系统可动画属性：组件自带的支持改变UI界面的属性接口，如位置、缩放、模糊等。</li>
<li>自定义可动画属性：ArkUI提供@AnimatableExtend装饰器用于自定义可动画属性。开发者可从自定义绘制的内容中抽象出可动画属性，用于控制每帧绘制的内容，如自定义绘制音量图标。通过自定义可动画属性，可以为ArkUI中部分原本不支持动画的属性添加动画。</li>
</ul>
</blockquote>
<h3 data-id="heading-2">二、实现属性动画</h3>
<blockquote>
<p>通过可动画属性改变引起UI上产生的连续视觉效果，即为属性动画。属性动画是最基础易懂的动画，ArkUI提供三种动画接口<strong>animateTo、animation和keyframeAnimateTo</strong>驱动组件属性按照动画曲线等动画参数进行连续的变化，产生属性动画。</p>
</blockquote>
<blockquote>
<p><strong>说明</strong>
本章节讨论的属性动画不是狭义的属性动画接口，而是通过给定新的可动画属性终值，对属性产生动画的方式。</p>
</blockquote>

































<table><thead><tr><th align="left">动画接口</th><th align="left">作用域</th><th align="left">原理</th><th align="left">使用场景</th><th/></tr></thead><tbody><tr><td align="left">animateTo</td><td align="left">闭包内改变属性引起的界面变化。<br/>作用于出现消失转场。</td><td align="left">通用函数，对闭包前界面和闭包中的状态变量引起的界面之间的差异做动画。<br/> 支持多次调用，支持嵌套。</td><td align="left">适用对多个可动画属性配置相同动画参数的动画。<br/>需要嵌套使用动画的场景。</td><td/></tr><tr><td align="left">animation</td><td align="left">组件通过属性接口绑定的属性变化引起的界面变化。</td><td align="left">识别组件的可动画属性变化，自动添加动画。</td><td align="left">组件的接口调用是从下往上执行，animation只会作用于在其之上的属性调用。<br/>组件可以根据调用顺序对多个属性设置不同的animation。</td><td>适用于对多个可动画属性配置不同参数动画的场景。</td></tr><tr><td align="left">keyframeAnimateTo</td><td align="left">多个闭包内改变属性引起的分段属性动画。</td><td align="left">通用函数，每一段闭包中的状态变量与前一次的差异做动画。<br/>支持多次调用，不推荐嵌套。</td><td align="left">适用于同一属性需要做连续多个动画的场景。</td><td/></tr></tbody></table>
<h4 data-id="heading-3">2.1 使用animateTo产生属性动画</h4>
<pre><code class="hljs language-c" lang="c">animateTo(value: AnimateParam, event: () =&gt; <span class="hljs-type">void</span>): <span class="hljs-type">void</span>
</code></pre>
<blockquote>
<p>animateTo接口参数中，value指定AnimateParam对象（包括时长、Curve等）event为动画的闭包函数，闭包内变量改变产生的属性动画将遵循相同的动画参数。</p>
</blockquote>
<blockquote>
<p><strong>说明</strong>
直接使用animateTo可能导致UI上下文不明确的问题，建议使用getUIContext()获取UIContext实例，并使用animateTo调用绑定实例的animateTo。</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f99b0781622445dca7ef066aa200765b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321097&amp;x-signature=f5yj4faRUl4dhy3CzxO02ugLIxs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">import { curves } from <span class="hljs-string">'@kit.ArkUI'</span>;

@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AnimateToDemo</span> {</span>
  @State animate: boolean = <span class="hljs-literal">false</span>;
  <span class="hljs-comment">// 第一步: 声明相关状态变量</span>
  @State rotateValue: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件一旋转角度</span>
  @State translateX: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件二偏移量</span>
  @State opacityValue: number = <span class="hljs-number">1</span>; <span class="hljs-comment">// 组件二透明度</span>

  <span class="hljs-comment">// 第二步：将状态变量设置到相关可动画属性接口</span>
  build() {
    Row() {
      <span class="hljs-comment">// 组件一</span>
      Column() {
      }
      .rotate({ angle: this.rotateValue })
      .backgroundColor(<span class="hljs-string">'#317AF7'</span>)
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .onClick(() =&gt; {
        this.getUIContext()?.animateTo({ curve: curves.springMotion() }, () =&gt; {
          this.animate = !this.animate;
          <span class="hljs-comment">// 第三步：闭包内通过状态变量改变UI界面</span>
          <span class="hljs-comment">// 这里可以写任何能改变UI的逻辑比如数组添加，显隐控制，系统会检测改变后的UI界面与之前的UI界面的差异，对有差异的部分添加动画</span>
          <span class="hljs-comment">// 组件一的rotate属性发生变化，所以会给组件一添加rotate旋转动画</span>
          this.rotateValue = this.animate ? <span class="hljs-number">90</span> : <span class="hljs-number">0</span>;
          <span class="hljs-comment">// 组件二的透明度发生变化，所以会给组件二添加透明度的动画</span>
          this.opacityValue = this.animate ? <span class="hljs-number">0.6</span> : <span class="hljs-number">1</span>;
          <span class="hljs-comment">// 组件二的translate属性发生变化，所以会给组件二添加translate偏移动画</span>
          this.translateX = this.animate ? <span class="hljs-number">50</span> : <span class="hljs-number">0</span>;
        })
      })

      <span class="hljs-comment">// 组件二</span>
      Column() {

      }
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .backgroundColor(<span class="hljs-string">'#D94838'</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .opacity(this.opacityValue)
      .translate({ x: this.translateX })
    }
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-string">'100%'</span>)
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<h4 data-id="heading-4">2.2 使用animation产生属性动画</h4>
<blockquote>
<p>相比于animateTo接口需要把要执行动画的属性的修改放在闭包中，<strong>animation</strong>接口无需使用闭包，把animation接口加在要做属性动画的可动画属性后即可。animation只要检测到其绑定的可动画属性发生变化，就会自动添加属性动画，animateTo则必须在动画闭包内改变可动画属性的值从而生成动画。</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13c609d4f6ae429885126f9ce0c2272d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321097&amp;x-signature=vxiTKyb0%2BXqdHRCFU%2FJp02t9u%2FE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">import { curves } from <span class="hljs-string">'@kit.ArkUI'</span>;

@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AnimationDemo2</span> {</span>
  @State animate: boolean = <span class="hljs-literal">false</span>;
  <span class="hljs-comment">// 第一步: 声明相关状态变量</span>
  @State rotateValue: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件一旋转角度</span>
  @State translateX: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件二偏移量</span>
  @State opacityValue: number = <span class="hljs-number">1</span>; <span class="hljs-comment">// 组件二透明度</span>

  <span class="hljs-comment">// 第二步：将状态变量设置到相关可动画属性接口</span>
  build() {
    Row() {
      <span class="hljs-comment">// 组件一</span>
      Column() {
      }
      .opacity(this.opacityValue)
      .rotate({ angle: this.rotateValue })
      <span class="hljs-comment">// 第三步：通过属性动画接口开启属性动画</span>
      .animation({ curve: curves.springMotion() })
      .backgroundColor(<span class="hljs-string">'#ff4f31f7'</span>)
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .onClick(() =&gt; {
        this.animate = !this.animate;
        <span class="hljs-comment">// 第四步：闭包内通过状态变量改变UI界面</span>
        <span class="hljs-comment">// 这里可以写任何能改变UI的逻辑比如数组添加，显隐控制，系统会检测改变后的UI界面与之前的UI界面的差异，对有差异的部分添加动画</span>
        <span class="hljs-comment">// 组件一的rotate属性发生变化，所以会给组件一添加rotate旋转动画</span>
        this.rotateValue = this.animate ? <span class="hljs-number">90</span> : <span class="hljs-number">0</span>;
        <span class="hljs-comment">// 组件二的translate属性发生变化，所以会给组件二添加translate偏移动画</span>
        this.translateX = this.animate ? <span class="hljs-number">50</span> : <span class="hljs-number">0</span>;
        <span class="hljs-comment">// 父组件column的opacity属性有变化，会导致其子节点的透明度也变化，所以这里会给column和其子节点的透明度属性都加动画</span>
        this.opacityValue = this.animate ? <span class="hljs-number">0.6</span> : <span class="hljs-number">1</span>;
      })

      <span class="hljs-comment">// 组件二</span>
      Column() {
      }
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .backgroundColor(<span class="hljs-string">'#ff46bcf3'</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .opacity(this.opacityValue)
      .translate({ x: this.translateX })
      .animation({ curve: curves.springMotion() })
    }
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-string">'100%'</span>)
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<h4 data-id="heading-5">2.3 使用keyframeAnimateTo产生属性动画</h4>
<pre><code class="hljs language-c" lang="c">keyframeAnimateTo(param: KeyframeAnimateParam, keyframes: Array&lt;KeyframeState&gt;): <span class="hljs-type">void</span>
</code></pre>
<blockquote>
<p>keyframeAnimateTo接口参数中，第一个参数KeyframeAnimateParam为关键帧动画的整体参数（包括延时、播放次数、结束回调、期望帧率），第二个参数是一个数组，每一项表示一个关键帧内的动画行为；每一段动画可单独控制动画参数（包括时长、Curve等）。</p>
</blockquote>
<blockquote>
<p>在同一属性存在多段动画过程的场景，可通过在结束回调中再创建新动画实现，但写法更复杂，且每次创建新动画需要耗时，会有衔接卡顿现象。此场景更适宜用关键帧动画实现。</p>
</blockquote>
<blockquote>
<p>以下示例主要演示如何通过keyframeAnimateTo来设置关键帧动画。</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5598c7887a24212837f0cabcf617200~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321097&amp;x-signature=9wdWP4r3TXa0W4%2BpeFgAHG5y4x0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">KeyframeAnimateToDemo</span> {</span>
  <span class="hljs-comment">// 第一步: 声明相关状态变量</span>
  @State rotateValue: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件一旋转角度</span>
  @State translateX: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 组件二偏移量</span>
  @State opacityValue: number = <span class="hljs-number">1</span>; <span class="hljs-comment">// 组件二透明度</span>
  <span class="hljs-comment">// 第二步：将状态变量设置到相关可动画属性接口</span>
  build() {
    Row() {
      <span class="hljs-comment">// 组件一</span>
      Column() {
      }
      .rotate({ angle: this.rotateValue })
      .backgroundColor(<span class="hljs-string">'#317AF7'</span>)
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .onClick(() =&gt; {
        <span class="hljs-comment">// 第三步：调用keyframeAnimateTo接口</span>
        this.getUIContext()?.keyframeAnimateTo({
          iterations: <span class="hljs-number">1</span>
        }, [
          {
            <span class="hljs-comment">// 第一段关键帧动画时长为800ms，组件一顺时针旋转90度，组件二的透明度变从1变为0.6，组件二的translate从0位移到50</span>
            duration: <span class="hljs-number">800</span>,
            event: () =&gt; {
              this.rotateValue = <span class="hljs-number">90</span>;
              this.opacityValue = <span class="hljs-number">0.6</span>;
              this.translateX = <span class="hljs-number">50</span>;
            }
          },
          {
            <span class="hljs-comment">// 第二段关键帧动画时长为500ms，组件一逆时针旋转90度恢复至0度，组件二的透明度变从0.6变为1，组件二的translate从50位移到0</span>
            duration: <span class="hljs-number">500</span>,
            event: () =&gt; {
              this.rotateValue = <span class="hljs-number">0</span>;
              this.opacityValue = <span class="hljs-number">1</span>;
              this.translateX = <span class="hljs-number">0</span>;
            }
          }
        ]);
      })
      <span class="hljs-comment">// 组件二</span>
      Column() {
      }
      .justifyContent(FlexAlign.Center)
      .width(<span class="hljs-number">100</span>)
      .height(<span class="hljs-number">100</span>)
      .backgroundColor(<span class="hljs-string">'#D94838'</span>)
      .borderRadius(<span class="hljs-number">30</span>)
      .opacity(this.opacityValue)
      .translate({ x: this.translateX })
    }
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-string">'100%'</span>)
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<blockquote>
<p><strong>说明</strong></p>
<ul>
<li>在对组件的位置大小的变化做动画的时候，由于布局属性的改变会触发测量布局，性能开销大。<strong>scale</strong>属性的改变不会触发测量布局，性能开销小。因此，在组件位置大小持续发生变化的场景，如跟手触发组件大小变化的场景，推荐使用scale。</li>
<li>属性动画应该作用于始终存在的组件，对于将要出现或者将要消失的组件的动画应该使用<strong>转场动画</strong>。</li>
<li>尽量不要使用动画结束回调。属性动画是对已经发生的状态进行的动画，不需要开发者去处理结束的逻辑。如果要使用结束回调，一定要正确处理连续操作的数据管理。</li>
</ul>
</blockquote>
<h3 data-id="heading-6">三、自定义属性动画</h3>
<blockquote>
<p>属性动画是可动画属性的参数值发生变化时，引起UI上产生的连续视觉效果。当参数值发生连续变化，且设置到可以引起UI发生变化的属性接口上时，就可以实现属性动画。</p>
</blockquote>
<blockquote>
<p>ArkUI提供@AnimatableExtend装饰器，用于自定义可动画属性接口。由于参数的数据类型必须具备一定程度的连续性，自定义可动画属性接口的参数类型仅支持number类型和实现AnimatableArithmetic&lt;T&gt;接口的自定义类型。通过自定义可动画属性接口和可动画数据类型，在使用animateTo或animation执行动画时，通过逐帧回调函数修改不可动画属性接口的值，能够让不可动画属性接口实现动画效果。也可通过逐帧回调函数每帧修改可动画属性的值，实现逐帧布局的效果。</p>
</blockquote>
<h4 data-id="heading-7">3.1 使用number数据类型和@AnimatableExtend装饰器改变Text组件宽度实现逐帧布局的效果</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 第一步：使用@AnimatableExtend装饰器，自定义可动画属性接口</span>
@AnimatableExtend(Text)
function <span class="hljs-title function_">animatableWidth</span><span class="hljs-params">(width: number)</span> {
  .width(width) <span class="hljs-comment">// 调用系统属性接口，逐帧回调函数每帧修改可动画属性的值，实现逐帧布局的效果。</span>
}

@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">AnimatablePropertyExample</span> {</span>
  @State textWidth: number = <span class="hljs-number">80</span>;

  build() {
    Column() {
      Text(<span class="hljs-string">"AnimatableProperty"</span>)
        .animatableWidth(this.textWidth)<span class="hljs-comment">// 第二步：将自定义可动画属性接口设置到组件上</span>
        .animation({ duration: <span class="hljs-number">2000</span>, curve: Curve.Ease }) <span class="hljs-comment">// 第三步:为自定义可动画属性接口绑定动画</span>
      Button(<span class="hljs-string">"Play"</span>)
        .onClick(() =&gt; {
          this.textWidth = this.textWidth == <span class="hljs-number">80</span> ? <span class="hljs-number">160</span> : <span class="hljs-number">80</span>; <span class="hljs-comment">// 第四步：改变自定义可动画属性的参数，产生动画</span>
        })
    }.width(<span class="hljs-string">"100%"</span>)
    .padding(<span class="hljs-number">10</span>)
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AlphaEvolve：基于 Gemini 的高级算法设计编程代理]]></title>    <link>https://juejin.cn/post/7574848503731355694</link>    <guid>https://juejin.cn/post/7574848503731355694</guid>    <pubDate>2025-11-21T09:14:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574848503731355694" data-draft-id="7574840547807199242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AlphaEvolve：基于 Gemini 的高级算法设计编程代理"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-21T09:14:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AlphaEvolve：基于 Gemini 的高级算法设计编程代理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:14:27.000Z" title="Fri Nov 21 2025 09:14:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一篇5月份的老文</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepmind.google%2Fblog%2Falphaevolve-a-gemini-powered-coding-agent-for-designing-advanced-algorithms%2F" target="_blank" title="https://deepmind.google/blog/alphaevolve-a-gemini-powered-coding-agent-for-designing-advanced-algorithms/" ref="nofollow noopener noreferrer">转载</a></p>
<p><strong>AlphaEvolve 团队</strong></p>
<p>新型 AI 代理通过结合大型语言模型的创造力与自动化评估器，为数学和计算中的实际应用演化算法</p>
<p>大型语言模型（LLMs）具有卓越的多功能性。它们可以总结文档、生成代码，甚至头脑风暴出新想法。现在，我们已将这些能力扩展到解决数学和现代计算中基础性且高度复杂的问题。</p>
<p>今天，我们宣布推出 <strong>AlphaEvolve</strong>，这是一个基于大型语言模型的进化编程代理，用于通用算法发现和优化。AlphaEvolve 将我们 <strong>Gemini 模型</strong> 的创造性问题解决能力与验证答案的自动化评估器配对，并使用进化框架来改进最有前景的想法。</p>
<p>AlphaEvolve 提升了 Google 数据中心、芯片设计和 AI 训练过程的效率——包括训练 AlphaEvolve 本身所用的大型语言模型。它还帮助设计了更快的矩阵乘法算法，并为开放的数学问题找到了新的解决方案，在许多领域的应用中展现出令人难以置信的前景。</p>
<h2 data-id="heading-0">使用大型语言模型设计更好的算法</h2>
<p>2023年，我们首次展示了大型语言模型可以生成用计算机代码编写的函数，以帮助<strong>在开放的科学问题上发现新的且可证明正确的知识</strong>。AlphaEvolve 是一个能够超越单一函数发现，进而进化整个代码库并开发更复杂算法的代理。</p>
<p>AlphaEvolve 利用了一套最先进的大型语言模型集成：我们最快、最高效的模型 <strong>Gemini Flash</strong> 最大化了探索想法的广度，而我们最强大的模型 <strong>Gemini Pro</strong> 则通过富有洞察力的建议提供了关键的深度。这些模型共同提出实现算法解决方案的计算机程序。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a247ea56a51944ceba07046406166f5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321267&amp;x-signature=kPs9%2FjMbMrYSRWWEzew%2FKI%2F%2FF8c%3D" alt="" loading="lazy"/></p>
<p>图示显示了提示采样器如何首先为语言模型组装提示，然后生成新的程序。这些程序由评估器评估并存储在程序数据库中。该数据库实现了一个进化算法，确定哪些程序将用于未来的提示。</p>
<p>AlphaEvolve 使用自动化评估指标来验证、运行和评分提议的程序。这些指标为每个解决方案的准确性和质量提供了客观、可量化的评估。这使得 AlphaEvolve 在数学和计算机科学等可以清晰、系统地衡量进展的广泛领域中特别有用。</p>
<h3 data-id="heading-1">优化我们的计算生态系统</h3>
<p>在过去一年中，我们在 Google 的计算生态系统中部署了 AlphaEvolve 发现的算法，包括我们的数据中心、硬件和软件。这些改进中的每一个的影响都在我们的 AI 和计算基础设施中被放大，为所有用户构建一个更强大、更可持续的数字生态系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb04c07f12d34125aef79341c09a44ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321267&amp;x-signature=hlhTBowqaYUb05TENTHlYbNzwY8%3D" alt="" loading="lazy"/></p>
<p>图示显示了 AlphaEvolve 如何帮助 Google 提供更高效的数字生态系统，从数据中心调度和硬件设计到 AI 模型训练。</p>
<h4 data-id="heading-2">改进数据中心调度</h4>
<p>AlphaEvolve 发现了一个简单但非常有效的启发式算法，以帮助 <strong>Borg</strong> 更高效地编排 Google 广阔的数据中心。这个解决方案现已投入生产超过一年，平均持续回收 Google 全球计算资源的 0.7%。这种持续的效率提升意味着在任何给定时刻，相同的计算足迹可以完成更多任务。AlphaEvolve 的解决方案不仅带来强大的性能，还提供了人类可读代码的重要操作优势：可解释性、可调试性、可预测性和易于部署。</p>
<h4 data-id="heading-3">协助硬件设计</h4>
<p>AlphaEvolve 提出了一个 <strong>Verilog</strong> 重写，移除了用于矩阵乘法的关键、高度优化的算术电路中不必要的位。至关重要的是，该提议必须通过鲁棒的验证方法来确认修改后的电路保持功能正确性。这个提议被集成到即将推出的 <strong>Tensor Processing Unit (TPU)</strong> 中，这是 Google 的定制 AI 加速器。通过以芯片设计师的标准语言提出修改建议，AlphaEvolve 促进了 AI 和硬件工程师之间的协作方法，以加速未来专用芯片的设计。</p>
<h4 data-id="heading-4">增强 AI 训练和推理</h4>
<p>AlphaEvolve 正在加速 AI 性能和研究速度。通过找到更智能的方法将大型矩阵乘法操作分解为更可管理的子问题，它将 Gemini 架构中这个关键的 <strong>kernel</strong> 加速了 23%，导致 Gemini 训练时间减少了 1%。由于开发生成式 AI 模型需要大量计算资源，获得的每一点效率都能转化为可观的节省。除了性能提升外，AlphaEvolve 还显著减少了 kernel 优化所需的工程时间，从数周的专家努力减少到数天的自动化实验，让研究人员能够更快地创新。</p>
<p>AlphaEvolve 还可以优化低级 GPU 指令。这个极其复杂的领域通常已经被编译器大量优化，因此人类工程师通常不会直接修改它。AlphaEvolve 为 <strong>FlashAttention</strong> 在 <strong>Transformer</strong> 架构 AI 模型中的 kernel 实现实现了高达 32.5% 的加速。这种优化帮助专家精确定位性能瓶颈，并轻松将改进集成到他们的代码库中，提高他们的生产力并实现未来计算和能源的节省。</p>
<h4 data-id="heading-5">推进数学和算法发现的前沿</h4>
<p>AlphaEvolve 还可以为复杂的数学问题提出新方法。在提供了计算机程序的最小代码骨架后，AlphaEvolve 设计了一种新颖的 <strong>梯度优化</strong> 程序的许多组件，该程序发现了矩阵乘法的多个新算法——这是计算机科学中的一个基本问题。</p>
<p><img alt="转存失败，建议直接上传图片文件" src="" loading="lazy"/></p>
<p><em>视频：AlphaEvolve 为发现更快的矩阵乘法算法而提出的变更列表。在这个例子中，AlphaEvolve 在多个组件中提出了广泛的变更，包括优化器和权重初始化、损失函数和超参数扫描。这些变更都是高度非平凡的，在进化过程中需要 15 次突变。</em></p>
<p>AlphaEvolve 的程序找到了一个使用 48 次标量乘法来乘以 4x4 复值矩阵的算法，改进了 <strong>Strassen 的 1969 年算法</strong>——该算法此前被认为是这种情况下的最佳算法。这一发现展示了对我们先前工作 <strong>AlphaTensor</strong> 的重大进展，后者专门从事矩阵乘法算法，对于 4x4 矩阵，仅发现了二进制算术的改进。</p>
<p>为探究 AlphaEvolve 的广度，我们将系统应用于数学分析、几何、组合数学和数论中的 50 多个开放问题。系统的灵活性使我们能够在几小时内完成大多数实验的设置。在大约 75% 的情况下，它重新发现了当前最先进的解决方案（据我们所知）。</p>
<p>在 20% 的情况下，AlphaEvolve 改进了先前已知的最佳解决方案，在相应的开放问题上取得了进展。例如，它推进了 <strong>接触数问题</strong>（kissing number problem）。这个几何挑战已经<strong>吸引了数学家超过 300 年</strong>，涉及接触一个公共单位球体的不重叠球体的最大数量。AlphaEvolve 发现了 593 个外球的配置，并在 11 维中建立了一个新的下界。</p>
<h3 data-id="heading-6">前进的道路</h3>
<p>AlphaEvolve 展现了从为特定领域发现算法，到为广泛的真实世界挑战开发更复杂算法的发展进程。我们期望 AlphaEvolve 随着大型语言模型能力的提升而持续改进，特别是当它们在编程能力方面变得更加强大时。</p>
<p>与 <strong>People + AI Research 团队</strong>合作，我们一直在构建与 AlphaEvolve 交互的友好用户界面。我们正在为选定的学术用户规划早期访问计划，并探索让 AlphaEvolve 更广泛可用的可能性。如需注册兴趣，请填写<strong>此表单</strong>。</p>
<p>虽然 AlphaEvolve 目前主要应用于数学和计算领域，但其通用性意味着它可以应用于任何解决方案能够被描述为算法并自动验证的问题。我们相信 AlphaEvolve 可能在更多领域产生变革性影响，如材料科学、药物发现、可持续发展以及更广泛的技术和商业应用。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fstorage.googleapis.com%2Fdeepmind-media%2FDeepMind.com%2FBlog%2Falphaevolve-a-gemini-powered-coding-agent-for-designing-advanced-algorithms%2FAlphaEvolve.pdf%3Futm_source%3Ddeepmind.google%26utm_medium%3Dreferral%26utm_campaign%3Dgdm%26utm_content%3D" target="_blank" title="https://storage.googleapis.com/deepmind-media/DeepMind.com/Blog/alphaevolve-a-gemini-powered-coding-agent-for-designing-advanced-algorithms/AlphaEvolve.pdf?utm_source=deepmind.google&amp;utm_medium=referral&amp;utm_campaign=gdm&amp;utm_content=" ref="nofollow noopener noreferrer">阅读更多详细信息请参阅我们的白皮书</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fforms.gle%2FWyqAoh1ixdfq6tgN8%3Futm_source%3Ddeepmind.google%26utm_medium%3Dreferral%26utm_campaign%3Dgdm%26utm_content%3D" target="_blank" title="https://forms.gle/WyqAoh1ixdfq6tgN8?utm_source=deepmind.google&amp;utm_medium=referral&amp;utm_campaign=gdm&amp;utm_content=" ref="nofollow noopener noreferrer">注册您对使用 AlphaEvolve 的兴趣</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcolab.research.google.com%2Fgithub%2Fgoogle-deepmind%2Falphaevolve_results%2Fblob%2Fmaster%2Fmathematical_results.ipynb%3Futm_source%3Ddeepmind.google%26utm_medium%3Dreferral%26utm_campaign%3Dgdm%26utm_content%3D" target="_blank" title="https://colab.research.google.com/github/google-deepmind/alphaevolve_results/blob/master/mathematical_results.ipynb?utm_source=deepmind.google&amp;utm_medium=referral&amp;utm_campaign=gdm&amp;utm_content=" ref="nofollow noopener noreferrer">在 Google Colab 中查看 AlphaEvolve 的数学结果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 SECon+AgentX 大会 — AI 原生应用架构专场]]></title>    <link>https://juejin.cn/post/7574749664492961826</link>    <guid>https://juejin.cn/post/7574749664492961826</guid>    <pubDate>2025-11-21T09:10:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574749664492961826" data-draft-id="7574749664492208162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 SECon+AgentX 大会 — AI 原生应用架构专场"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2025-11-21T09:10:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 SECon+AgentX 大会 — AI 原生应用架构专场
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:10:49.000Z" title="Fri Nov 21 2025 09:10:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 SECon+AgentX 智能时代软件工程技术大会将于 11 月 21 日在上海举办，大会专注于软件开发技术的最新趋势，深度探讨大模型驱动的技术革新以及智能体在工程化落地过程中的关键技术突破与产品商业化验证的会议。重点打造覆盖全产业链的智能体技术实践平台和行业应用产品交流平台。</p>
<p>在本次大会上，阿里云携手信通院联合出品「AI 原生应用架构」专场，欢迎感兴趣的用户报名现场参会。</p>
<h3 data-id="heading-0">AI 原生应用架构专场介绍：</h3>
<p>随着人工智能技术的迅猛演进，尤其是大模型在理解、生成与推理能力上的突破，软件架构正迎来一场深刻的范式迁移——我们正步入“AI 原生架构”时代。在这一新阶段，软件系统不再仅由人类设计逻辑驱动，而是与 AI 模型深度融合，形成具备自适应、自演化与自优化能力的智能架构体系。</p>
<p>AI 原生架构与云原生体系如何深度融合？二者在弹性调度、服务治理与可观测性层面的结合点在哪里？如何构建覆盖观测、评估与模型训练的端到端数据飞轮闭环，实现 AI 能力的持续进化？面对大模型应用带来的安全风险与高可用挑战，又该如何在架构层面设计可信、稳定、可审计的智能系统？本专场将聚焦 AI 原生应用架构的核心命题，探讨从基础设施到应用层的协同演进策略与工程实践。</p>
<h3 data-id="heading-1">专场出品人介绍：</h3>
<p><strong>李艳林  阿里云智能中间件技术负责人</strong></p>
<ul>
<li>Nacos 创始人，阿里云 MSE 创始人，阿里中间件上云负责人，阿里云资深技术专家。</li>
<li>作品：《AI 原生应用架构》、《Nacos架构与原理》、《云原生应用架构白皮书》 关键作者。</li>
<li>履历：十年微服务研发经验，参与阿里异地多活架构演进，全链路压测，百万实例架构演进，全面上云，开源和阿里云等关键战役。</li>
</ul>
<p><strong>马龙飞  中国信息通信研究院</strong></p>
<p><strong>云计算与大数据研究所 云计算部高级业务主管</strong></p>
<ul>
<li>主要负责软件工程智能化、汽车、金融、低空经济等领域研究。</li>
<li>牵头或参与编写《云上软件测试成熟度模型》、《云上智能体评测能力要求》、《汽车行业智能化成熟度模型》、《2023年度中国企业软件研发管理白皮书》、《2025年软件工程智能化标准体系建设指南》、《AIGC驱动Devops智能化应用研究报告》、《2025年AI技术在项目管理中的应用洞察报告》等行业标准和研究报告。</li>
<li>具备多年软件工程&amp;测试领域项目管理经验，发表云计算相关领域专利十余篇，软著十余篇。</li>
</ul>
<h3 data-id="heading-2">专场邀请函，欢迎您报名参会：</h3>
<p><strong>活动时间：</strong> 11.21 13:40-17:25</p>
<p><strong>地点：</strong> 上海明捷万丽酒店二层宴会厅 大宴会厅 2</p>
<p><strong>说明：</strong> 扫描底部二维码即可报名，报名采用审核制，通过审核后将短信/邮件通知，凭通知即可免费现场参会哦！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66a24731dc48474292b773e000b10cfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=ndcJnb1Gxtv4CeqzmG6QbikENwQ%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-3">专场各议题讲师及内容介绍：</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f6596ad88874521bbc4ef0b8e7c66dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=FeuL0QsajnU1isJIhswtEuElGa8%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d500cb5b5dc4cc2914dc808aba533a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=Nu9eMfNlvdden8HCBy7oZdNzWJc%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bad79965a574fe7a4fde8a055406014~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=a3DdQkdjlnY%2F5wC0Q4QAInQ3IEU%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbe0b6d123b34f1083b6ce6f704bd0a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764321049&amp;x-signature=nFQikataM2%2BaWI%2BNITSxsTdNJc8%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[日增千万数据：数据库表设计与高效插入存储方案]]></title>    <link>https://juejin.cn/post/7574958975159959595</link>    <guid>https://juejin.cn/post/7574958975159959595</guid>    <pubDate>2025-11-21T09:18:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574958975159959595" data-draft-id="7574972697677021220" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="日增千万数据：数据库表设计与高效插入存储方案"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2025-11-21T09:18:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            日增千万数据：数据库表设计与高效插入存储方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:18:17.000Z" title="Fri Nov 21 2025 09:18:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">日增千万数据：数据库表设计与高效插入存储方案</h2>
<p>当业务场景涉及 “日增 1000 万条数据”（如日志采集、用户行为追踪、IoT 设备上报）时，传统 “单表 + 默认配置” 的数据库设计会迅速面临瓶颈：单表数据量超亿级后插入延迟从 1ms 飙升至 100ms，磁盘空间半年内耗尽，甚至出现 “锁表导致写入中断”。</p>
<p>本文针对 “日增千万级数据” 的核心诉求 ——<strong>极致插入效率</strong>（写入延迟 &lt; 10ms）、<strong>低成本海量存储</strong>（支持年级数据留存）、<strong>基础查询可用</strong>（非实时复杂查询），从表结构、分表分库、存储引擎、参数调优等维度，提供完整的数据库设计方案。</p>
<h3 data-id="heading-1">一、先明确：日增千万数据的业务特征与核心约束</h3>
<p>设计前需先锚定业务场景的关键特征，避免 “为技术而技术”，不同场景的设计侧重点差异极大：</p>





























<table><thead><tr><th>业务场景</th><th>数据特征</th><th>核心诉求</th><th>非核心诉求</th></tr></thead><tbody><tr><td>日志采集（如 API 日志）</td><td>写入密集（读少写多）、无更新、单条数据小（100-500 字节）</td><td>插入效率优先、存储成本低</td><td>复杂查询（如多条件聚合）可容忍离线计算</td></tr><tr><td>用户行为追踪（如点击日志）</td><td>写入密集、部分字段需更新（如会话结束标记）、数据中等（500-1KB）</td><td>插入 + 轻量查询效率、数据保留 3-6 个月</td><td>无需事务强一致性</td></tr><tr><td>IoT 设备上报（如传感器数据）</td><td>写入均匀（每秒～116 条）、数据结构固定、无更新</td><td>高可用（不丢数据）、插入稳定</td><td>支持按设备 ID / 时间范围查询</td></tr></tbody></table>
<p><strong>核心共性约束</strong>：</p>
<ol>
<li>写入吞吐量：日均 1000 万 → 每秒约 116 条（峰值可能达 500 条 / 秒），需支持批量写入；</li>
</ol>

<ol start="2">
<li>存储成本：单条数据按 500 字节算，日均 500GB，年存 182TB，需低成本存储方案；</li>
</ol>

<ol start="3">
<li>数据生命周期：多数场景数据保留 3-12 个月，过期需高效清理 / 归档。</li>
</ol>
<h3 data-id="heading-2">二、核心设计：分表分库 —— 突破单表瓶颈的唯一选择</h3>
<p>日增 1000 万数据，单表无法支撑（MySQL 单表超 2000 万行后，插入 / 查询性能断崖式下降），<strong>分表分库是必选项</strong>，需优先确定分表策略。</p>
<h4 data-id="heading-3">1. 分表策略选型：时间分表（最适配 “按天写入” 场景）</h4>
<p>“日增千万数据” 多为时序数据（按时间顺序产生），<strong>按时间分表</strong>是最优选择，可灵活适配数据生命周期管理，常见分表粒度：</p>

































<table><thead><tr><th>分表粒度</th><th>单表数据量</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>按天分表</td><td>1000 万条</td><td>日志、行为追踪（需按天查询 / 清理）</td><td>单表数据量可控、过期清理高效（直接删表）</td><td>表数量多（年 365 张），需中间件管理</td></tr><tr><td>按周分表</td><td>7000 万条</td><td>IoT 数据（查询频率低）</td><td>表数量少（年 52 张）</td><td>单表数据量较大，查询略慢</td></tr><tr><td>按月分表</td><td>3 亿条</td><td>非实时归档数据（如历史账单）</td><td>表数量极少</td><td>单表超亿级，插入后期性能下降</td></tr></tbody></table>
<p><strong>推荐方案</strong>：按天分表（优先），表名格式为biz_table_yyyyMMdd（如api_log_20251121），理由：</p>
<ul>
<li>单表 1000 万条在 MySQL/PostgreSQL 中性能可控；</li>
</ul>

<ul>
<li>过期数据清理直接DROP TABLE（毫秒级完成），无需删除行（避免表碎片）；</li>
</ul>

<ul>
<li>按天查询时直接路由到对应表，无跨表扫描。</li>
</ul>
<h4 data-id="heading-4">2. 分库策略：当单库写入达瓶颈时的扩展方案</h4>
<p>若单库写入压力过大（如峰值 5000 条 / 秒，MySQL 单库写入上限约 1 万条 / 秒），需按 “时间范围分库” 或 “哈希分库” 扩展：</p>
<h5 data-id="heading-5">（1）时间分库（适配时序数据）</h5>
<ul>
<li>策略：按 “月” 分库，每个库存储当月的按天分表（如db_log_202511库存储api_log_20251101~api_log_20251130）；</li>
</ul>

<ul>
<li>优势：库内表时间连续，跨天查询（如查 11 月 20-22 日数据）仅需访问 1 个库，无需跨库；</li>
</ul>

<ul>
<li>适用场景：查询多为 “近期连续时间范围”（如近 7 天日志）。</li>
</ul>
<h5 data-id="heading-6">（2）哈希分库（适配均匀查询）</h5>
<ul>
<li>策略：按 “分表键哈希” 分库（如用DATE_FORMAT(created_time, '%Y%m%d')计算哈希值，模 32 得到库索引）；</li>
</ul>

<ul>
<li>优势：写入压力均匀分散到多个库，无单库瓶颈；</li>
</ul>

<ul>
<li>适用场景：查询无明显时间偏好（如随机查询任意日期的 IoT 数据）。</li>
</ul>
<h5 data-id="heading-7">（3）分库分表中间件：透明化操作</h5>
<p>手动管理分表分库复杂度极高，需借助中间件实现 “业务无感知”：</p>
<ul>
<li><strong>MySQL 生态</strong>：ShardingSphere-JDBC（轻量级，嵌入应用）、MyCat（独立服务，支持读写分离）；</li>
</ul>

<ul>
<li><strong>PostgreSQL 生态</strong>：pg_shardman（开源分表插件）、TimescaleDB（时序数据库扩展，自动分表）；</li>
</ul>

<ul>
<li><strong>核心能力</strong>：自动路由（按时间路由到对应表）、批量插入优化、跨表查询聚合（如查近 3 天数据自动合并 3 张表结果）。</li>
</ul>
<h4 data-id="heading-8">3. 分表分表示例（ShardingSphere 配置）</h4>
<p>以 “API 日志表按天分表、按月分库” 为例，ShardingSphere-JDBC 配置（YAML）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">shardingsphere:</span>
    <span class="hljs-attr">datasource:</span>
      <span class="hljs-comment"># 配置3个分库（202511、202512、202601）</span>
      <span class="hljs-attr">names:</span> <span class="hljs-string">db_log_202511,db_log_202512,db_log_202601</span>
      <span class="hljs-attr">db_log_202511:</span> <span class="hljs-comment"># 2025年11月库</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span>
        <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
        <span class="hljs-attr">jdbc-url:</span> <span class="hljs-string">jdbc:mysql://192.168.1.10:3306/db_log_202511?useSSL=false</span>
        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
        <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
      <span class="hljs-comment"># 其他库配置省略...</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-attr">sharding:</span>
        <span class="hljs-attr">tables:</span>
          <span class="hljs-attr">api_log:</span> <span class="hljs-comment"># 逻辑表名（业务代码中使用）</span>
            <span class="hljs-attr">actual-data-nodes:</span> <span class="hljs-string">db_log_${yearmonth}.api_log_${yearmonthday}</span> <span class="hljs-comment"># 实际表名规则</span>
            <span class="hljs-attr">database-strategy:</span> <span class="hljs-comment"># 分库策略（按年月分库）</span>
              <span class="hljs-attr">standard:</span>
                <span class="hljs-attr">sharding-column:</span> <span class="hljs-string">created_time</span> <span class="hljs-comment"># 分库字段（时间戳）</span>
                <span class="hljs-attr">sharding-algorithm-name:</span> <span class="hljs-string">db_inline</span> <span class="hljs-comment"># 分库算法</span>
            <span class="hljs-attr">table-strategy:</span> <span class="hljs-comment"># 分表策略（按天分表）</span>
              <span class="hljs-attr">standard:</span>
                <span class="hljs-attr">sharding-column:</span> <span class="hljs-string">created_time</span>
                <span class="hljs-attr">sharding-algorithm-name:</span> <span class="hljs-string">table_inline</span>
        <span class="hljs-attr">sharding-algorithms:</span>
          <span class="hljs-attr">db_inline:</span> <span class="hljs-comment"># 分库算法：提取年月（如202511）</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">INLINE</span>
            <span class="hljs-attr">props:</span>
              <span class="hljs-attr">algorithm-expression:</span> <span class="hljs-string">db_log_${date_format(created_time,</span> <span class="hljs-string">'yyyyMM'</span><span class="hljs-string">)}</span>
          <span class="hljs-attr">table_inline:</span> <span class="hljs-comment"># 分表算法：提取年月日（如20251121）</span>
            <span class="hljs-attr">type:</span> <span class="hljs-string">INLINE</span>
            <span class="hljs-attr">props:</span>
              <span class="hljs-attr">algorithm-expression:</span> <span class="hljs-string">api_log_${date_format(created_time,</span> <span class="hljs-string">'yyyyMMdd'</span><span class="hljs-string">)}</span>
</code></pre>
<h3 data-id="heading-9">三、表结构优化：为 “插入效率” 和 “存储成本” 服务</h3>
<p>表结构设计直接影响插入速度和存储占用，需遵循 “最小字段、合适类型、少索引” 原则：</p>
<h4 data-id="heading-10">1. 字段设计：精简 + 适配存储</h4>
<h5 data-id="heading-11">（1）数据类型选择：够用即可，避免冗余</h5>









































<table><thead><tr><th>业务字段</th><th>推荐类型</th><th>避免使用</th><th>理由</th></tr></thead><tbody><tr><td>时间戳（创建时间）</td><td>DATETIME (3)（毫秒级，占 5 字节）</td><td>TIMESTAMP（依赖时区）、VARCHAR</td><td>毫秒级精度满足多数场景，比 TIMESTAMP 更稳定</td></tr><tr><td>设备 ID / 用户 ID</td><td>BIGINT（8 字节）或 CHAR (32)（UUID）</td><td>VARCHAR (64)（冗余）</td><td>BIGINT 比 UUID 存储更省空间，查询更快</td></tr><tr><td>状态标识（如成功 / 失败）</td><td>TINYINT（1 字节，0 = 失败，1 = 成功）</td><td>INT（4 字节）、VARCHAR</td><td>状态值少，TINYINT 足够，省空间</td></tr><tr><td>日志内容 / 上报数据</td><td>VARCHAR (1024)（按需调整）或 TEXT</td><td>LONGTEXT（无限制，易冗余）</td><td>多数场景 1KB 内足够，TEXT 需额外磁盘空间</td></tr><tr><td>数值型指标（如耗时、大小）</td><td>INT（4 字节，需 &gt; 20 亿用 BIGINT）</td><td>VARCHAR（无法参与数值计算）</td><td>数值型支持聚合查询，存储更省空间</td></tr></tbody></table>
<h5 data-id="heading-12">（2）避免 NULL 值：用默认值替代</h5>
<p>NULL 值会增加存储开销（需额外标记），且影响索引效率，所有字段尽量设默认值：</p>
<ul>
<li>字符串字段：默认空字符串（DEFAULT ''）；</li>
</ul>

<ul>
<li>数值字段：默认 0（DEFAULT 0）；</li>
</ul>

<ul>
<li>时间字段：默认当前时间（DEFAULT CURRENT_TIMESTAMP(3)）。</li>
</ul>
<h4 data-id="heading-13">2. 索引设计：插入场景 “索引越少越好”</h4>
<p>索引加速查询，但严重拖慢插入（每插入一条数据需更新所有索引），日增千万数据场景下，索引需 “极简”：</p>
<h5 data-id="heading-14">（1）必建索引：主键索引</h5>
<ul>
<li>选择自增 ID（如id BIGINT AUTO_INCREMENT）或雪花 ID（分布式场景）作为主键；</li>
</ul>

<ul>
<li>理由：InnoDB 主键为聚簇索引，自增 ID 插入时不会产生页分裂，插入效率最高；雪花 ID 确保分布式场景下主键唯一。</li>
</ul>
<h5 data-id="heading-15">（2）可选索引：仅建 “高频查询字段”</h5>
<p>仅对 “必须按该字段查询” 的字段建索引，且优先选择 “过滤性好” 的字段：</p>
<ul>
<li>如 IoT 场景需按 “设备 ID + 时间范围” 查询，建联合索引idx_device_time (device_id, created_time)；</li>
</ul>

<ul>
<li>避免单字段索引（如仅device_id），联合索引可覆盖 “设备 + 时间” 查询，无需回表。</li>
</ul>
<h5 data-id="heading-16">（3）延迟建索引：进一步提升插入效率</h5>
<p>若插入后短期内无需查询（如当天数据仅需次日统计），可<strong>延迟建索引</strong>：</p>
<ul>
<li>插入时：仅保留主键索引，无其他索引；</li>
</ul>

<ul>
<li>凌晨低峰期：对前一天的表执行CREATE INDEX（如CREATE INDEX idx_device_time ON api_log_20251121(device_id, created_time)）；</li>
</ul>

<ul>
<li>效果：插入速度提升 30%~50%（无索引更新开销）。</li>
</ul>
<h4 data-id="heading-17">3. 表结构示例（API 日志表）</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 逻辑表结构（实际按天分表，表名api_log_20251121）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> api_log_20251121 (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'主键ID'</span>,
  device_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'设备ID'</span>,
  api_url <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'API地址'</span>,
  status TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'状态：0=失败，1=成功'</span>,
  cost_time <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'耗时（毫秒）'</span>,
  request_data <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'请求数据'</span>,
  created_time DATETIME(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">3</span>) COMMENT <span class="hljs-string">'创建时间（毫秒级）'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (id) COMMENT <span class="hljs-string">'主键聚簇索引'</span>
  <span class="hljs-comment">-- 凌晨延迟创建联合索引：idx_device_time (device_id, created_time)</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'API日志表（20251121）'</span>;
</code></pre>
<h3 data-id="heading-18">四、存储引擎与数据库选型：适配 “写入密集” 场景</h3>
<p>不同数据库 / 存储引擎的写入性能差异极大，需优先选择 “写入优化型” 引擎：</p>
<h4 data-id="heading-19">1. 关系型数据库：MySQL vs PostgreSQL</h4>
<h5 data-id="heading-20">（1）MySQL：InnoDB 引擎（默认首选）</h5>
<ul>
<li><strong>优势</strong>：支持事务（可选关闭）、聚簇索引插入高效、生态成熟（分表中间件多）；</li>
</ul>

<ul>
<li><strong>关键优化参数</strong>（my.cnf）：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 存储引擎选择InnoDB</span>
<span class="hljs-attr">default-storage-engine</span>=InnoDB
<span class="hljs-comment"># 缓冲池大小：设为物理内存的50%-70%（如32GB内存设20GB），减少磁盘IO</span>
<span class="hljs-attr">innodb_buffer_pool_size</span>=<span class="hljs-number">20</span>G
<span class="hljs-comment"># 写入刷盘策略：每秒刷盘（平衡性能与安全性，避免掉电丢1秒内数据）</span>
<span class="hljs-attr">innodb_flush_log_at_trx_commit</span>=<span class="hljs-number">2</span>
<span class="hljs-comment"># 批量插入缓冲区：调大至64MB，提升批量插入效率</span>
<span class="hljs-attr">bulk_insert_buffer_size</span>=<span class="hljs-number">64</span>M
<span class="hljs-comment"># 日志文件大小：设为4GB，减少日志切换频率</span>
<span class="hljs-attr">innodb_log_file_size</span>=<span class="hljs-number">4</span>G
<span class="hljs-comment"># 关闭自动提交：批量插入时手动控制事务，减少事务开销</span>
<span class="hljs-attr">autocommit</span>=<span class="hljs-number">0</span>
<span class="hljs-comment"># 禁用查询缓存：写入密集场景查询缓存无效，反而增加开销</span>
<span class="hljs-attr">query_cache_type</span>=<span class="hljs-number">0</span>
</code></pre>
<ul>
<li><strong>性能测试</strong>：单表日插 1000 万条，批量插入（每次 1000 条）延迟约 5ms / 批，CPU 使用率 &lt; 30%。</li>
</ul>
<h5 data-id="heading-21">（2）PostgreSQL：TimescaleDB 扩展（时序数据最优）</h5>
<p>PostgreSQL 原生对海量时序数据支持一般，需安装<strong>TimescaleDB</strong>（时序数据库扩展）：</p>
<ul>
<li><strong>优势</strong>：自动按时间分表（无需手动管理表名）、支持时序函数（如按分钟聚合）、压缩比高（原始数据压缩 3-10 倍）；</li>
</ul>

<ul>
<li><strong>创建时序表示例</strong>：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 创建扩展</span>
<span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> timescaledb;
<span class="hljs-comment">-- 2. 创建基础表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> api_log (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  device_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  api_url <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  status TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  cost_time <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  created_time TIMESTAMPTZ(<span class="hljs-number">3</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> NOW()
);
<span class="hljs-comment">-- 3. 转换为时序表，按天分块（自动分表）</span>
<span class="hljs-keyword">SELECT</span> create_hypertable(<span class="hljs-string">'api_log'</span>, <span class="hljs-string">'created_time'</span>, chunk_time_interval <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'1 day'</span>);
<span class="hljs-comment">-- 4. 开启压缩（对3天前的块自动压缩）</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> api_log <span class="hljs-keyword">SET</span> (
  timescaledb.compress,
  timescaledb.compress_orderby <span class="hljs-operator">=</span> <span class="hljs-string">'created_time ASC'</span>,
  timescaledb.compress_segmentby <span class="hljs-operator">=</span> <span class="hljs-string">'device_id'</span>
);
<span class="hljs-keyword">SELECT</span> add_compression_policy(<span class="hljs-string">'api_log'</span>, <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'3 days'</span>);
</code></pre>
<ul>
<li><strong>优势</strong>：压缩后存储成本降低 70%，年存 182TB 数据压缩后仅需 50TB 以内。</li>
</ul>
<h4 data-id="heading-22">2. NoSQL 数据库：适合 “非结构化 + 极高写入” 场景</h4>
<p>若数据无需关系约束（如日志、行为数据），可选择 NoSQL 数据库，写入性能更高：</p>
<h5 data-id="heading-23">（1）MongoDB：文档型数据库</h5>
<ul>
<li><strong>优势</strong>：支持批量插入（insertMany）、无固定表结构（适配多变数据）、分片集群支持水平扩展；</li>
</ul>

<ul>
<li><strong>分片策略</strong>：按created_time（时间范围分片），每个分片存储 1 个月数据；</li>
</ul>

<ul>
<li><strong>不足</strong>：不支持事务，复杂查询（如多表关联）性能差。</li>
</ul>
<h5 data-id="heading-24">（2）Cassandra：分布式列存储</h5>
<ul>
<li><strong>优势</strong>：写入性能极高（单节点支持 10 万条 / 秒写入）、多副本高可用、无单点故障；</li>
</ul>

<ul>
<li><strong>适用场景</strong>：IoT 设备上报（写入均匀，无复杂查询）；</li>
</ul>

<ul>
<li><strong>不足</strong>：学习成本高，生态不如 MySQL 成熟。</li>
</ul>
<h3 data-id="heading-25">五、插入性能优化：从 “单条写入” 到 “批量高效写入”</h3>
<p>即使表结构和引擎优化到位，写入方式不当仍会导致性能瓶颈，需优先采用 “批量写入”：</p>
<h4 data-id="heading-26">1. 批量插入：替代单条 INSERT</h4>
<p>单条INSERT（如INSERT INTO api_log VALUES (1, ...), (2, ...)）每次需建立连接、解析 SQL，效率极低，<strong>批量插入</strong>是提升写入效率的核心手段：</p>
<h5 data-id="heading-27">（1）MySQL 批量插入示例（每次 1000 条）</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 批量插入1000条数据，手动控制事务</span>
<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> api_log_20251121 (device_id, api_url, status, cost_time)
<span class="hljs-keyword">VALUES</span> 
(<span class="hljs-number">1001</span>, <span class="hljs-string">'/api/login'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">50</span>),
(<span class="hljs-number">1002</span>, <span class="hljs-string">'/api/pay'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>),
<span class="hljs-comment">-- ... 省略998条 ...</span>
(<span class="hljs-number">2000</span>, <span class="hljs-string">'/api/order'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">150</span>);
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<ul>
<li><strong>批量大小选择</strong>：每次 1000-5000 条（太大易导致 SQL 解析超时，太小则连接开销大）；</li>
</ul>

<ul>
<li><strong>性能提升</strong>：批量插入比单条插入效率提升 5-10 倍（从 100ms / 条降至 5ms / 批）。</li>
</ul>
<h5 data-id="heading-28">（2）应用层批量处理（Java 示例）</h5>
<p>用 MyBatis 批量插入，避免手动拼接 SQL：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Mapper接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiLogMapper</span> {
    <span class="hljs-meta">@Insert</span>(<span class="hljs-string">"&lt;script&gt;"</span> +
            <span class="hljs-string">"INSERT INTO api_log_${dateStr} (device_id, api_url, status, cost_time) "</span> +
            <span class="hljs-string">"VALUES "</span> +
            <span class="hljs-string">"&lt;foreach collection='list' item='item' separator=','&gt;"</span> +
            <span class="hljs-string">"(#{item.deviceId}, #{item.apiUrl}, #{item.status}, #{item.costTime})"</span> +
            <span class="hljs-string">"&lt;/foreach&gt;"</span> +
            <span class="hljs-string">"&lt;/script&gt;"</span>)
    <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchInsert</span>(<span class="hljs-meta">@Param</span>(<span class="hljs-string">"list"</span>) <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ApiLogDO</span>&gt; list, <span class="hljs-meta">@Param</span>(<span class="hljs-string">"dateStr"</span>) <span class="hljs-title class_">String</span> dateStr);
}
<span class="hljs-comment">// 业务代码：积累1000条批量插入</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiLogService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ApiLogMapper</span> apiLogMapper;
    
    <span class="hljs-comment">// 内存队列：临时缓存待插入数据</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">BlockingQueue</span>&lt;<span class="hljs-title class_">ApiLogDO</span>&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10000</span>);
    
    <span class="hljs-comment">// 定时任务：每1秒批量插入一次（或队列满1000条插入）</span>
    <span class="hljs-meta">@Scheduled</span>(fixedRate = <span class="hljs-number">1000</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchInsertTask</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ApiLogDO</span>&gt; batchList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">1000</span>);
        queue.<span class="hljs-title function_">drainTo</span>(batchList, <span class="hljs-number">1000</span>); <span class="hljs-comment">// 从队列取最多1000条</span>
        <span class="hljs-keyword">if</span> (!batchList.<span class="hljs-title function_">isEmpty</span>()) {
            <span class="hljs-title class_">String</span> dateStr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyyMMdd"</span>).<span class="hljs-title function_">format</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
            apiLogMapper.<span class="hljs-title function_">batchInsert</span>(batchList, dateStr);
        }
    }
    
    <span class="hljs-comment">// 接收单条数据，加入队列</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addLog</span>(<span class="hljs-params">ApiLogDO logDO</span>) {
        <span class="hljs-keyword">try</span> {
            queue.<span class="hljs-title function_">put</span>(logDO); <span class="hljs-comment">// 队列满时阻塞，避免数据丢失</span>
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"日志插入队列满"</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-29">2. 异步写入：解耦业务与写入</h4>
<p>若业务无需 “写入成功” 同步返回（如日志采集），可采用 “异步写入” 进一步提升性能：</p>
<ul>
<li><strong>架构</strong>：业务系统 → Kafka（消息队列）→ 消费端（批量写入数据库）；</li>
</ul>

<ul>
<li><strong>优势</strong>：</li>
</ul>
<ol>
<li>
<ol>
<li>业务系统无需等待数据库写入，响应时间从 50ms 降至 1ms；</li>
</ol>
</li>
</ol>

<ol>
<li>
<ol start="2">
<li>Kafka 缓冲峰值流量（如秒杀时日志突增），避免数据库被压垮；</li>
</ol>
</li>
</ol>

<ol>
<li>
<ol start="3">
<li>消费端可横向扩展（多实例消费），支撑更高写入吞吐量；</li>
</ol>
</li>
</ol>
<ul>
<li><strong>注意</strong>：需开启 Kafka 消息持久化（避免掉电丢数据），消费端需处理重复消息（数据库主键唯一约束去重）。</li>
</ul>
<h3 data-id="heading-30">六、数据归档与清理：控制存储成本</h3>
<p>日增 500GB 数据，若不清理，半年后磁盘空间将超 90TB，需制定<strong>数据生命周期管理策略</strong>：</p>
<h4 data-id="heading-31">1. 数据分层存储：热数据 + 冷数据</h4>
<ul>
<li><strong>热数据</strong>（近 30 天）：存储在高性能数据库（如 MySQL/PostgreSQL），支持实时查询；</li>
</ul>

<ul>
<li><strong>冷数据</strong>（30 天 - 1 年）：归档到低成本存储（如 HDFS、对象存储 S3/OSS），用 Parquet/Orc 格式压缩（压缩比 3-5 倍）；</li>
</ul>

<ul>
<li><strong>归档工具</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>MySQL：用mysqldump或xtrabackup导出冷数据，再导入 HDFS；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>PostgreSQL/TimescaleDB：用COPY命令导出为 CSV，再压缩上传至对象存储。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-32">2. 过期数据清理：高效删除</h4>
<ul>
<li><strong>按天分表场景</strong>：直接DROP TABLE api_log_20250821（毫秒级完成），比DELETE FROM快 1000 倍；</li>
</ul>

<ul>
<li><strong>TimescaleDB 场景</strong>：用drop_chunks命令删除旧块（如删除 3 个月前数据）：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> drop_chunks(<span class="hljs-type">interval</span> <span class="hljs-string">'3 months'</span>, <span class="hljs-string">'api_log'</span>);
</code></pre>
<ul>
<li><strong>清理频率</strong>：每天凌晨执行，删除 “超过保留期” 的表 / 块。</li>
</ul>
<h3 data-id="heading-33">七、高可用设计：避免写入中断</h3>
<p>日增千万数据场景下，数据库不可用将导致数据丢失，需构建高可用架构：</p>
<h4 data-id="heading-34">1. 主从复制：读写分离</h4>
<ul>
<li><strong>架构</strong>：1 主 N 从，主库负责写入，从库负责查询（如统计分析）；</li>
</ul>

<ul>
<li><strong>MySQL</strong>：开启半同步复制（rpl_semi_sync_master_enabled=1），确保至少 1 个从库收到 binlog 后再返回成功，避免主库宕机丢数据；</li>
</ul>

<ul>
<li><strong>PostgreSQL</strong>：用流复制构建主从架构，从库实时同步主库数据。</li>
</ul>
<h4 data-id="heading-35">2. 分库分表高可用：避免单库故障</h4>
<ul>
<li>每个分库部署主从架构，某分库主库宕机后，从库自动切换为新主库；</li>
</ul>

<ul>
<li>中间件（如 ShardingSphere）支持故障自动路由，业务无感知。</li>
</ul>
<h4 data-id="heading-36">3. 监控告警：提前发现问题</h4>
<ul>
<li><strong>核心监控指标</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>写入延迟（批量插入耗时 &gt; 20ms 告警）；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>数据库连接数（超过 80% 上限告警）；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>磁盘空间（使用率 &gt; 85% 告警）；</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>主从同步延迟（超过 10 秒告警）；</li>
</ul>
</li>
</ul>

<ul>
<li><strong>工具选型</strong>：Prometheus+Grafana 监控，AlertManager 触发短信 / 钉钉告警。</li>
</ul>
<h3 data-id="heading-37">总结：日增千万数据的核心设计原则</h3>
<ol>
<li><strong>分表分库是基础</strong>：按时间分表，单表数据量控制在 1000 万以内，避免单表瓶颈；</li>
</ol>

<ol start="2">
<li><strong>表结构极简</strong>：用合适数据类型，少索引，避免 NULL 值，为插入效率服务；</li>
</ol>

<ol start="3">
<li><strong>存储引擎适配</strong>：MySQL InnoDB（通用）、PostgreSQL+TimescaleDB（时序数据）、NoSQL（非结构化）；</li>
</ol>

<ol start="4">
<li><strong>写入方式优化</strong>：批量插入 + 异步写入，最大化吞吐量；</li>
</ol>

<ol start="5">
<li><strong>生命周期管理</strong>：热冷数据分层，过期数据高效清理，控制存储成本；</li>
</ol>

<ol start="6">
<li><strong>高可用保障</strong>：主从复制 + 分库高可用，避免写入中断。</li>
</ol>
<p>这套方案可支撑 “日增 1000 万条数据” 的高效插入与存储，同时兼顾查询需求与成本控制，已在日志采集、IoT 上报等场景落地验证，插入延迟稳定在 5-10ms，存储成本降低 60% 以上。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何抓包 (How to Capture Packets) - 完整指南与实用技巧]]></title>    <link>https://juejin.cn/post/7574803558878494735</link>    <guid>https://juejin.cn/post/7574803558878494735</guid>    <pubDate>2025-11-21T09:22:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574803558878494735" data-draft-id="7574749664493060130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何抓包 (How to Capture Packets) - 完整指南与实用技巧"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T09:22:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="00后程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1159358440539900"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何抓包 (How to Capture Packets) - 完整指南与实用技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1159358440539900/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    00后程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T09:22:36.000Z" title="Fri Nov 21 2025 09:22:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如何抓包 (How to Capture Packets)</p>
<p>在现代网络环境中，抓包（Packet Capture）是一项非常重要的技能。无论是网络故障排查、安全分析，还是性能优化，掌握抓包的技巧都能帮助我们更好地理解网络流量和数据传输的过程。本文将详细介绍抓包的基本概念、工具、方法以及一些实用的技巧。</p>
<p>什么是抓包 (What is Packet Capture)</p>
<p>抓包是指在网络传输过程中，捕获并分析数据包的过程。数据包是网络通信中传输的基本单位，它包含了源地址、目的地址、协议类型、数据负载等信息。通过抓包，我们可以深入了解网络流量，识别潜在问题，甚至发现安全隐患。</p>
<p>抓包的应用场景 (Applications of Packet Capture)</p>
<p>抓包技术广泛应用于多个领域，主要包括：</p>
<ol>
<li><strong>网络故障排查</strong>：通过分析抓取的数据包，可以快速定位网络故障的原因，例如丢包、延迟等问题。</li>
<li><strong>安全分析</strong>：抓包可以帮助安全专家识别恶意流量、攻击行为和数据泄露等安全问题。</li>
<li><strong>性能优化</strong>：通过监测网络流量，识别性能瓶颈，从而优化网络配置和应用性能。</li>
<li><strong>协议分析</strong>：抓包可以帮助开发人员理解和调试网络协议，确保其正常工作。</li>
</ol>
<p>常用的抓包工具 (Common Packet Capture Tools)</p>
<p>在抓包过程中，选择合适的工具至关重要。以下是一些常用的抓包工具：</p>
<ol>
<li><strong>Wireshark</strong>：Wireshark 是一款功能强大的开源抓包工具，支持多种操作系统。它提供了丰富的分析功能，能够对捕获的数据包进行深度解析。</li>
<li><strong>tcpdump</strong>：tcpdump 是一个命令行工具，适用于 Unix/Linux 系统。它轻量级且高效，适合在服务器上进行抓包。</li>
<li><strong>Fiddler</strong>：Fiddler 是一款专注于 HTTP/HTTPS 流量的抓包工具，常用于Web开发和调试。</li>
<li><strong>Charles Proxy</strong>：类似于 Fiddler，Charles Proxy 也是一款用于 HTTP/HTTPS 流量抓包的工具，支持多平台。</li>
<li><strong>Burp Suite</strong>：Burp Suite 是一款集成的Web应用安全测试工具，提供了强大的抓包和分析功能。</li>
<li><strong>Sniffmaster</strong>：Sniffmaster 是一款全平台抓包工具，支持 HTTPS、TCP 和 UDP 协议，可在 iOS、Android、Mac 和 Windows 设备上实现无需代理、越狱或 root 的抓包操作，提供免费的代理抓包功能，适合各种抓包需求。</li>
</ol>
<p>如何使用 Wireshark 抓包 (How to Use Wireshark for Packet Capture)</p>
<p>Wireshark 是最常用的抓包工具之一，下面是使用 Wireshark 抓包的基本步骤：</p>
<ol>
<li>安装 Wireshark (Install Wireshark)</li>
</ol>
<p>首先，从 Wireshark 的官方网站下载并安装最新版本的 Wireshark。安装过程中，可以选择安装 WinPcap 或 Npcap（用于捕获网络流量的驱动程序）。</p>
<ol start="2">
<li>启动 Wireshark (Launch Wireshark)</li>
</ol>
<p>安装完成后，启动 Wireshark。在主界面上，你会看到可用的网络接口列表。</p>
<ol start="3">
<li>选择网络接口 (Select Network Interface)</li>
</ol>
<p>选择你想要抓包的网络接口。如果你在使用无线网络，可以选择 Wi-Fi 接口；如果是有线网络，选择相应的以太网接口。</p>
<ol start="4">
<li>开始抓包 (Start Capturing)</li>
</ol>
<p>点击“开始捕获”按钮，Wireshark 将开始捕获经过所选接口的所有数据包。你可以在界面上看到实时更新的数据包列表。</p>
<ol start="5">
<li>停止抓包 (Stop Capturing)</li>
</ol>
<p>完成抓包后，点击“停止捕获”按钮。此时，你可以对捕获到的数据包进行分析。</p>
<ol start="6">
<li>分析数据包 (Analyze Packets)</li>
</ol>
<p>Wireshark 提供了强大的过滤和分析功能。你可以使用过滤器来查找特定类型的数据包，例如 HTTP、TCP 或 UDP。点击某个数据包，可以查看其详细信息，包括协议层、源地址、目的地址等。</p>
<p>使用 tcpdump 抓包 (Using tcpdump for Packet Capture)</p>
<p>tcpdump 是一款命令行工具，适合在服务器上进行抓包。以下是使用 tcpdump 的基本步骤：</p>
<ol>
<li>安装 tcpdump (Install tcpdump)</li>
</ol>
<p>在大多数 Linux 发行版中，tcpdump 可以通过包管理器直接安装。例如，在 Ubuntu 中，可以使用以下命令：</p>
<p>sudo apt-get install tcpdump</p>
<ol start="2">
<li>查看网络接口 (List Network Interfaces)</li>
</ol>
<p>使用以下命令查看可用的网络接口：</p>
<p>tcpdump -D</p>
<ol start="3">
<li>开始抓包 (Start Capturing)</li>
</ol>
<p>选择一个网络接口并开始抓包。例如，抓取 eth0 接口的数据包：</p>
<p>sudo tcpdump -i eth0</p>
<ol start="4">
<li>保存抓包文件 (Save Capture File)</li>
</ol>
<p>如果需要保存抓包数据，可以使用 -w参数。例如：</p>
<p>sudo tcpdump -i eth0 -w capture.pcap</p>
<ol start="5">
<li>停止抓包 (Stop Capturing)</li>
</ol>
<p>在终端中按 Ctrl+C停止抓包。</p>
<ol start="6">
<li>分析抓包文件 (Analyze Capture File)</li>
</ol>
<p>可以使用 Wireshark 打开保存的 .pcap文件进行详细分析。</p>
<p>抓包的注意事项 (Considerations for Packet Capture)</p>
<p>在进行抓包时，有几个注意事项需要牢记：</p>
<ol>
<li><strong>法律和隐私</strong>：在抓包之前，确保你有权限捕获网络流量。未经授权的抓包可能会违反法律或公司政策。</li>
<li><strong>数据量</strong>：抓包可能会产生大量数据，尤其是在高流量网络中。确保你有足够的存储空间，并定期清理不必要的抓包文件。</li>
<li><strong>性能影响</strong>：在高负载环境下，抓包可能会影响网络性能。尽量在非高峰时段进行抓包，或使用过滤器限制捕获的数据量。</li>
<li><strong>分析能力</strong>：抓包只是第一步，后续的数据分析和问题定位同样重要。学习如何有效地分析数据包是抓包技能的重要组成部分。</li>
</ol>
<p>实用的抓包技巧 (Practical Packet Capture Tips)</p>
<p>以下是一些实用的抓包技巧，可以帮助你更高效地进行抓包和分析：</p>
<ol>
<li><strong>使用过滤器</strong>：在抓包时，使用过滤器可以减少捕获的数据量。例如，在 Wireshark 中，可以使用http过滤器仅捕获 HTTP 流量。</li>
<li><strong>标记重要数据包</strong>：在抓包过程中，可以使用 Wireshark 的标记功能标记重要的数据包，以便后续分析。</li>
<li><strong>分析流量图</strong>：Wireshark 提供了流量图功能，可以帮助你直观地了解网络流量的变化情况。</li>
<li><strong>结合其他工具</strong>：抓包可以与其他网络分析工具结合使用，例如性能监控工具，提供更全面的网络分析视角。</li>
<li><strong>定期复习</strong>：网络协议和抓包工具的更新较快，定期复习相关知识和技能，保持与时俱进。</li>
</ol>
<p>结论 (Conclusion)</p>
<p>抓包是一项重要的网络技能，能够帮助我们深入了解网络流量、排查故障和提升安全性。通过掌握抓包工具和技巧，我们可以更有效地进行网络分析和问题解决。希望本文能为你提供实用的指导，帮助你在抓包的道路上不断进步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>