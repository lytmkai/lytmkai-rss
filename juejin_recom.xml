<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Webpack DLL动态链接库的应用和思考]]></title>    <link>https://juejin.cn/post/7571086754879946798</link>    <guid>https://juejin.cn/post/7571086754879946798</guid>    <pubDate>2025-11-11T06:08:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754879946798" data-draft-id="7571060853370912818" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Webpack DLL动态链接库的应用和思考"/> <meta itemprop="keywords" content="前端,Webpack,性能优化"/> <meta itemprop="datePublished" content="2025-11-11T06:08:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="芳香茗的方"/> <meta itemprop="url" content="https://juejin.cn/user/141214963731848"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Webpack DLL动态链接库的应用和思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/141214963731848/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    芳香茗的方
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:08:35.000Z" title="Tue Nov 11 2025 06:08:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>DLL是“动态链接库”的意思，假设项目中用了 react 、lodash，这些静态资源可以被单独打包，且独立于项目。这样每次主项目打包的时候，都可以直接使用过打包好的 react、lodash，节省了性能。</p>
<p>原理：</p>
<ul>
<li>单独一份ddl config文件单独对react、lodash打包，会将打包产物和一个manifest文件放在某个目录下，manifest文件。</li>
<li>打包的产物是以全局变量的方式导出模块的，manifest文件用来告诉使用方react、lodash打包后生成的全局变量叫什么，</li>
<li>使用方在遇到react、lodash时候，就无需再次打包，将使用react和lodash模块的地方，根据manifest文件的指引去通过全局变量访问。</li>
</ul>
<p>简单的例子：</p>
<blockquote>
<p>单独开一个dll config文件 webpack.dll.config.js</p>
</blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">CleanWebpackPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'clean-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>,
  <span class="hljs-attr">entry</span>: {
     <span class="hljs-comment">// 将react和lodash以及你想要预打包的静态文件打包成一个名为vendor的bundle</span>
     <span class="hljs-comment">// 这里没有路径，直接就一个react，就是去打包纯node_modules下的文件</span>
    <span class="hljs-comment">// 当然我们没有loader，webpack默认只能打包js和json文件。如果这里出现一个css入口文件，必然会发生打包错误。</span>
    <span class="hljs-attr">vendor</span>: [<span class="hljs-string">'react'</span>, <span class="hljs-string">'react-dom'</span>, <span class="hljs-string">'lodash'</span>] 
  },
  <span class="hljs-attr">output</span>: {
     <span class="hljs-comment">// 将生成的bundle生成在dll目录下</span>
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'dll'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]_[hash].dll.js'</span>,
     <span class="hljs-comment">// 因为dll对打包生成的模块的导出方式是全局变量的方式，需要通过library告诉webpack应该将模块导出维护在哪个全局变量上。这个全局变量叫做 '[name]_[hash]'，实际编译后即 vendor_&lt;hash&gt; </span>
    <span class="hljs-attr">library</span>: <span class="hljs-string">'[name]_[hash]'</span>
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CleanWebpackPlugin</span>(),
     <span class="hljs-comment">// 使用DllPlugin，这是webpack内置的plugin</span>
    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DllPlugin</span>({
       <span class="hljs-comment">// 将生成的bundle生成在dll目录下，并且生成的manifest文件应该是[name]-manifest.json的形式</span>
      <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'dll'</span>, <span class="hljs-string">'[name]-manifest.json'</span>),
       <span class="hljs-comment">// 表明这些模块的导出的全局变量名，必须和 output.library一致</span>
      <span class="hljs-attr">name</span>: <span class="hljs-string">'[name]_[hash]'</span>
    })
  ]
};
</code></pre>
<blockquote>
<p>然后是主体项目的webpack文件 webpack.config.js</p>
</blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AddAssetHtmlPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'add-asset-html-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name].bundle.js'</span>,
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>)
  },
  <span class="hljs-attr">plugins</span>: [
     <span class="hljs-comment">// 应用方必须配合使用 DllReferencePlugin 才能完成工作</span>
    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DllReferencePlugin</span>({
       <span class="hljs-comment">// 告诉manifest文件在哪</span>
      <span class="hljs-attr">manifest</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dll/vendor-manifest.json'</span>)
    }),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HtmlWebpackPlugin</span>({
      <span class="hljs-attr">template</span>: <span class="hljs-string">'./src/index.html'</span>
    }),
     <span class="hljs-comment">// 需要注意的是，我们需要手动将react、lodash这样被预打包生成的bundle引入在index.html中</span>
     <span class="hljs-comment">// 可以选择直接手动通过&lt;scripe&gt;标签的方式引入，但这样不如直接使用 AddAssetHtmlPlugin 享受工程化带来的福利，比如 publicPath，以及index.html删除后还能自动引入</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddAssetHtmlPlugin</span>({
      <span class="hljs-attr">filepath</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dll/vendor_*.dll.js'</span>),
      <span class="hljs-attr">publicPath</span>: <span class="hljs-string">'./'</span>
    })
  ]
};
</code></pre>
<p>随后可以通过往package.json中加一些npm指令。在发布部署（CICD）时先<code>npm run dll</code>，然后<code>npm run build</code></p>
<p>打包后的运行时状态（伪代码）：</p>
<blockquote>
<p>vendor.dll.js 伪代码，大概的原理</p>
</blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> vendor_2e8f1b = (<span class="hljs-keyword">function</span>(<span class="hljs-params">modules</span>) {
  <span class="hljs-comment">// ▼ 模块缓存机制</span>
  <span class="hljs-keyword">var</span> installedModules = {};
  
  <span class="hljs-comment">// ▼ 模块加载实现 (类似__webpack_require__)</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">__dll_require__</span>(<span class="hljs-params">moduleId</span>) {
    <span class="hljs-keyword">if</span>(installedModules[moduleId]) 
      <span class="hljs-keyword">return</span> installedModules[moduleId].<span class="hljs-property">exports</span>;
    
    <span class="hljs-keyword">var</span> <span class="hljs-variable language_">module</span> = installedModules[moduleId] = {
      <span class="hljs-attr">id</span>: moduleId,
      <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">exports</span>: {}
    };
    modules[moduleId].<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>, <span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span>, __dll_require__);
    <span class="hljs-variable language_">module</span>.<span class="hljs-property">loaded</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>;
  }
  
  <span class="hljs-comment">// ▼ 暴露全局变量</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">__dll_require__</span>(<span class="hljs-number">0</span>);
})({
  <span class="hljs-comment">/*! ▼ 预编译的第三方库模块集合 */</span>
  <span class="hljs-number">0</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span></span>) {
    <span class="hljs-comment">// React核心实现</span>
    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">React</span> = ... <span class="hljs-comment">// 完整React库代码</span>
  },
  <span class="hljs-number">1</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span></span>) {
    <span class="hljs-comment">// ReactDOM实现</span>
    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">ReactDOM</span> = ... 
  },
  <span class="hljs-number">2</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-variable language_">module</span>, <span class="hljs-built_in">exports</span></span>) {
    <span class="hljs-comment">// lodash工具库</span>
    <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">_</span> = ... 
  }
});

</code></pre>
<blockquote>
<p>index.bundle.js 中访问lodash</p>
</blockquote>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-comment">// 在bundle中动态绑定DLL模块，通过访问直接变量的方式来读取react、lodash。也就是说打包后的react和lodash的源码将不会出现在 index.bundle.js 中。 </span>
__webpack_require__.<span class="hljs-title function_">d</span>(<span class="hljs-built_in">exports</span>, <span class="hljs-string">"lodash"</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">vendor_2e8f1b</span>[<span class="hljs-number">2</span>]);
</code></pre>
<blockquote>
<p>Manifest 文件</p>
</blockquote>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"vendor_2e8f1b"</span>,
  <span class="hljs-string">"content"</span>: {  <span class="hljs-comment">// 提供给使用方的预打包bundle信息</span>
    <span class="hljs-string">"./node_modules/react/index.js"</span>: {
      <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>,  <span class="hljs-comment">// react的id为1，使用方的 import { useState } from 'react'; 打包后会通过 window.vendor_2e8f1b[1].useState 访问</span>
      <span class="hljs-string">"buildMeta"</span>: {<span class="hljs-string">"providedExports"</span>: <span class="hljs-literal">true</span>}
    },
    <span class="hljs-string">"./node_modules/lodash/lodash.js"</span>: {
      <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>,
      <span class="hljs-string">"buildMeta"</span>: {<span class="hljs-string">"usedExports"</span>: [<span class="hljs-string">"default"</span>]}
    }
  }
}
</code></pre>
<p><strong>学习Dll时思考的一些问题：</strong></p>
<p><em><strong>Q1：如果使用dll将react、lodash等第三方包预打包出去了，主项目对react和lodash是不是就无法启用treeshaking特性了？</strong></em></p>
<p>A1: 是的，因为在主项目中直接绕过了react和lodash的打包，使用了现成的打包产物，并采用全局变量的方式去访问由dll分离出去的包，自然无法对react和lodash走一遍打包编译的过程，也就没有静态分析的过程，也就是无法treeshaking了。要知道treeshaking影响的是主项目打包后的产物，而不是主项目外的打包产物。webpack总不能会根据manifest文件去反向分析dll预打包的产物，然后修改dll下的产物吧。</p>
<p><em><strong>Q2: dll能否解决Qiankun微前端资源共用问题？</strong></em></p>
<p>A2：是的，dll可以解决微前端资源共用问题，因为在微前端中，对公共资源的处理有externals方案。externals原理也是将公共依赖的模块抛出打包工程，根据配置使用cdn链接，进而通过全局变量式使用外置模块。而dll原理类似，并且dll无需独立部署外置模块的cdn了，所以也可以。</p>
<p>大体思路流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c4f2e5438ab4a1eb6098793c48c6443~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Iqz6aaZ6IyX55qE5pa5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763446380&amp;x-signature=ftHBdNMc9ex0SU4TcvrDi32tbCw%3D" alt="image.png" loading="lazy"/></p>
<p>这样的缺点就是子应用没法脱离主应用独立运行。当然如果有子应用需要独立运行的需求，可以有两种办法：</p>
<ul>
<li>无论主应用还是子应用都通过addAssetHtmlPlugin实现将cdn下的所有js文件引入在html模板中。</li>
<li>或在子应用运行时，率先判断是否为独立运行状态，然后通过动态创建script标签的方式将所有cdn下的js文件引入，待script标签都加载完成后执行后续逻辑。</li>
</ul>
<blockquote>
<p>通过AddAssetHtmlPlugin实现对cdn下的文件</p>
</blockquote>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AddAssetHtmlPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'add-asset-html-webpack-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>);

<span class="hljs-comment">// 准备CDN链接数组</span>
<span class="hljs-keyword">const</span> cdnAssets = [
  <span class="hljs-string">'https://cdn.example.com/library/vendor.react.js'</span>,
  <span class="hljs-string">'https://cdn.example.com/library/vendor.lodash.js
];

module.exports = {
  // ... 其他webpack配置
  plugins: [
    new HtmlWebpackPlugin(),
    // 使用 AddAssetHtmlPlugin 并传入CDN链接数组
    new AddAssetHtmlPlugin({ 
      files: cdnAssets 
    })
  ]
};
</span></code></pre>
<p><em><strong>Q3:dll能否替代external解决方案？</strong></em></p>
<p>A3：还是不能完全替代external方案的。虽然两者具备相似的原理。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/482ecc65ec394daeaf3998d677d42f8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Iqz6aaZ6IyX55qE5pa5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763446380&amp;x-signature=%2FT74SxC62FWazcXEki0pLdD8jCE%3D" alt="image.png" loading="lazy"/></p>
<p><em><strong>Q4：我的第三方库包含vue3，我希望转换为es5，但dll中的打包是es6的，那该怎么办？重新用dllplugin打包一个es5版本的么？</strong></em></p>
<p>A4：是的。思路是需要把webpack.dll.config.js中增加babel-loader相关配置，来使得dll下的产物也是es5的。下面是代码仅描述意思，仅供参考：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.js$/</span>, <span class="hljs-comment">// 匹配所有JavaScript文件</span>
        <span class="hljs-attr">use</span>: {
          <span class="hljs-attr">loader</span>: <span class="hljs-string">'babel-loader'</span>, <span class="hljs-comment">// 必须使用loader而非plugin</span>
          <span class="hljs-attr">options</span>: {
            <span class="hljs-attr">presets</span>: [<span class="hljs-string">'@babel/preset-env'</span>] <span class="hljs-comment">// 指定ES5转换规则</span>
          }
        }
      }
    ]
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DllPlugin</span>({ <span class="hljs-comment">/* DLL配置 */</span> }) <span class="hljs-comment">// Plugin负责库生成，不处理文件转换</span>
  ]
};
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用Unsloth微调一个老中医垂直领域大模型]]></title>    <link>https://juejin.cn/post/7571304204720406582</link>    <guid>https://juejin.cn/post/7571304204720406582</guid>    <pubDate>2025-11-11T06:12:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571304204720406582" data-draft-id="7571005216910393363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用Unsloth微调一个老中医垂直领域大模型"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-11T06:12:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用Unsloth微调一个老中医垂直领域大模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:12:58.000Z" title="Tue Nov 11 2025 06:12:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>本文介绍了如何使用Unsloth框架微调大语言模型，以《伤寒论》数据集为例训练一个中医专家模型。Unsloth显著降低了微调的资源需求。文章涵盖了从环境配置、模型选择、数据准备到训练部署的完整流程，为垂直领域模型微调提供了实用参考。</p>
<p>在实际应用中，我们常常面临特定场景下的问题需求。此时，通过指令微调可以让模型更好地适应这些具体任务，从而提升模型的实用性和表现。</p>
<p>比如：在医疗健康领域，医生希望让大模型更好地理解中医诊断和治疗的知识体系，从而能够辅助分析病情、推荐中药方剂，甚至自动生成病历摘要。又如，在法律行业，律师团队希望通过微调，让大模型能够更准确地解读中国法律条文、判例和合同文本，辅助法律检索和文书生成。此外，在教育领域，教师可以通过指令微调，让模型更贴合本地教材内容，自动批改作业、生成个性化学习建议。这些场景都需要针对特定任务和数据对大模型进行定制化微调，以提升其在实际应用中的表现和价值。</p>
<p>正好最近身体不适，并且得到一本医疗秘籍《伤寒论》，用 <code>Unsloth</code> 来微调一个垂直领域的模型出来。</p>
<h2 data-id="heading-0">1.  关于Unsloth</h2>
<p>大型语言模型（LLM）的微调有很大的资源挑战，如高昂的内存需求和漫长的训练时间。</p>
<p>传统的微调方法，可能需要数十小时才能完成一项任务，并且常常导致内存不足问题 。这种特性限制了个人开发者和小型团队对 LLM 进行定制化和优化的能力。</p>
<p>Unsloth 正是为了解决这些痛点而诞生的。</p>
<p>它是一个专门为加速 LLM 微调并显著降低内存消耗而设计的 Python 框架 。</p>
<p>Unsloth 实现了显著的性能提升，同时保持了与 Hugging Face 生态系统的完全兼容性 。这使得用户即使在免费的 Colab GPU 或配备 GPU 的笔记本电脑等有限硬件上，也能够高效地进行 LLM 微调 。</p>
<h2 data-id="heading-1">2.  Unsloth 的核心优势</h2>
<p><strong>速度提升</strong></p>
<p>在Alpaca 数据集上进行了测试，使用的 batch 大小为 2，gradient accumulation steps 为 4，rank 为 32，并在所有线性层（q、k、v、o、gate、up、down）上应用了 QLoRA</p>





























<table><thead><tr><th>Model</th><th>VRAM</th><th>Unsloth speed</th><th>VRAM reduction</th><th>Longer context</th><th>Hugging Face + FA2</th></tr></thead><tbody><tr><td>Llama 3.3 (70B)</td><td>80GB</td><td>2x</td><td>&gt;75%</td><td>13x longer</td><td>1x</td></tr><tr><td>Llama 3.1 (8B)</td><td>80GB</td><td>2x</td><td>&gt;70%</td><td>12x longer</td><td>1x</td></tr></tbody></table>
<p>测试结果显示，两种模型在显存使用上均为80GB，速度均提升了2倍。Llama 3.3的显存减少了超过75%，能够处理的上下文长度提升了13倍；而Llama 3.1的显存减少了超过70%，上下文长度提升了12倍。</p>
<p><strong>API 简化</strong></p>
<p>Unsloth 提供了一个简洁的 API，显著降低了 LLM 微调的复杂性 。它将模型加载、量化、训练、评估、保存、导出以及与 Ollama、llama.cpp 和 vLLM 等推理引擎的集成等所有工作流程进行了简化 。</p>
<p><strong>Hugging Face 生态系统兼容性</strong></p>
<p>Unsloth 是在 Hugging Face Transformers 库之上构建的，这使其能够充分利用 Hugging Face 强大的生态系统，同时添加自己的增强功能来简化微调过程 。</p>
<p>它与 Hugging Face Hub、Transformers、PEFT 和 TRL 等组件完全兼容 。这意味着用户可以无缝地访问 Hugging Face 提供的丰富模型和数据集资源，并利用 Unsloth 的优化进行训练。</p>
<p><strong>硬件兼容性与可访问性</strong></p>
<p>Unsloth 支持非常多的 NVIDIA GPU，从 2018 年及以后发布的型号，包括 V100、T4、Titan V、RTX 20、30、40 系列、A100 和 H100 等，最低 CUDA 能力要求为 7.0。即使是 GTX 1070 和 1080 也能工作，尽管速度较慢 。</p>
<p>Unsloth 可以在 Linux 和 Windows 操作系统上运行 。</p>
<p><strong>广泛的模型支持</strong></p>
<p>Unsloth 支持所有 Transformer 风格的模型，包括 Llama、DeepSeek、TTS、Qwen、Mistral、Gemma 等主流 LLM。它还支持多模态模型、文本到语音 (TTS)、语音到文本 (STT) 模型、BERT 模型以及扩散模型。</p>
<p><strong>动态量化</strong></p>
<p>Unsloth 引入了动态 4 位量化 (Dynamic 4-bit Quantization) 技术，这是一种智能的量化策略，通过动态选择不对某些参数进行量化，从而在仅增加不到 10% VRAM 的情况下显著提高准确性 。</p>
<p><strong>社区的活跃</strong></p>
<p>从GitHub上可以看出，他的受欢迎程度非常高，目前已经43k颗星</p>
<blockquote>
<p>❝</p>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Funslothai%2Funsloth" target="_blank" title="https://github.com/unslothai/unsloth" ref="nofollow noopener noreferrer">github.com/unslothai/u…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fcdecd2deb545b589b9c4e71cb0ce83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763446378&amp;x-signature=ClBLhODcfYaWWVRXbkvK0TMccGg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">3.  使用要求</h2>
<hr/>
<p>支持 Linux 和 Windows。</p>
<p>支持 2018 年及以后的 NVIDIA 显卡，包括 Blackwell RTX 50 系列。最低要求 CUDA 计算能力为 7.0（如 V100、T4、Titan V、RTX 20、30、40 系列，以及 A100、H100、L40 等）。GTX 1070、1080 虽然可以使用，但运行速度较慢。</p>
<p><strong>GPU内存要求：</strong></p>











































































<table><thead><tr><th>Model parameters</th><th>QLoRA (4-bit) VRAM</th><th>LoRA (16-bit) VRAM</th></tr></thead><tbody><tr><td>3B</td><td>3.5 GB</td><td>8 GB</td></tr><tr><td>7B</td><td>5 GB</td><td>19 GB</td></tr><tr><td>8B</td><td>6 GB</td><td>22 GB</td></tr><tr><td>9B</td><td>6.5 GB</td><td>24 GB</td></tr><tr><td>11B</td><td>7.5 GB</td><td>29 GB</td></tr><tr><td>14B</td><td>8.5 GB</td><td>33 GB</td></tr><tr><td>27B</td><td>22GB</td><td>64GB</td></tr><tr><td>32B</td><td>26 GB</td><td>76 GB</td></tr><tr><td>40B</td><td>30GB</td><td>96GB</td></tr><tr><td>70B</td><td>41 GB</td><td>164 GB</td></tr><tr><td>81B</td><td>48GB</td><td>192GB</td></tr><tr><td>90B</td><td>53GB</td><td>212GB</td></tr><tr><td>405B</td><td>237 GB</td><td>950 GB</td></tr></tbody></table>
<h2 data-id="heading-3">4.  安装 Unsloth</h2>
<hr/>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化一个名为 demo-unsloth 的项目，并指定 Python 版本为 3.11.9  </span>
uv init demo-unsloth -p 3.11.9  
<span class="hljs-comment"># 进入项目目录  </span>
<span class="hljs-built_in">cd</span> demo-unsloth  
<span class="hljs-comment"># 创建虚拟环境  </span>
uv venv  
<span class="hljs-comment"># 激活虚拟环境（Windows 下）  </span>
.venv\Scripts\activate  
<span class="hljs-comment"># 安装 triton-windows，要求版本3.3.1.post19  </span>
uv pip install triton-windows==3.3.1.post19  
<span class="hljs-comment"># 安装支持 CUDA 12.6 的 PyTorch 及其相关库  </span>
uv pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu126
</code></pre>
<p><strong>安装unsloth</strong></p>
<pre><code class="hljs">uv pip install unsloth
</code></pre>
<h2 data-id="heading-4">5.  选择模型</h2>
<hr/>
<p>Unsloth 支持非常多的预训练模型，包括 Llama、DeepSeek、TTS、Qwen、Mistral 和 Gemma 系列 LLM 3。</p>
<p>在选择模型时，需要注意模型名称的后缀。以 <code>unsloth-bnb-4bit</code> 结尾的模型表示它们是 Unsloth 动态 4 位量化模型，与标准 <code>bnb-4bit</code> 模型相比，这些模型在略微增加 VRAM 使用的情况下提供了更高的精度。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.unsloth.ai%2Fget-started%2Fall-our-models" target="_blank" title="https://docs.unsloth.ai/get-started/all-our-models" ref="nofollow noopener noreferrer">docs.unsloth.ai/get-started…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e079ef9a2c44f6cbbb68adbc9a84acf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763446378&amp;x-signature=OIda%2FB%2B45WTQ8nLx7Da6blqwa2o%3D" alt="" loading="lazy"/></p>
<p><strong>我的显卡是RTX 2050显卡，4GB显存，我选一个比较小的版本 unsloth/Qwen2.5-1.5B-Instruct-bnb-4bit</strong></p>
<p><strong>下载模型：</strong></p>
<pre><code class="hljs language-css" lang="css">huggingface-cli download <span class="hljs-attr">--resume-download</span> unsloth/Qwen2.<span class="hljs-number">5</span>-<span class="hljs-number">1.5</span>B-Instruct-bnb-<span class="hljs-number">4</span>bit <span class="hljs-attr">--local-dir</span> ./ckpts/qwen2.<span class="hljs-number">5</span>-<span class="hljs-number">1.5</span>b-instruct-bnb-<span class="hljs-number">4</span>bit
</code></pre>
<h2 data-id="heading-5">6.  数据集准备</h2>
<hr/>
<p>数据集的质量和格式直接决定了模型微调的效果。</p>
<p>一个高质量的数据集不仅需要覆盖目标任务的核心内容，还应保证问答对的准确性、完整性和多样性。</p>
<p>此外，数据集的规模也会影响模型的泛化能力，数据量越大、覆盖面越广，模型在实际应用中的表现通常会更好。</p>
<p>因此，在微调前应充分清洗、标注和检查数据，确保其能够有效支撑下游任务的训练需求。</p>
<p>因为要要训练一个老中医，所以找了一本《伤寒论》,通过工具把他拆成问答对，格式如下</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[    {      <span class="hljs-string">"Question"</span>: <span class="hljs-string">"伤寒一日，巨阳受之会出现什么症状？"</span>,      <span class="hljs-string">"Response"</span>: <span class="hljs-string">"伤寒一日，巨阳受之会出现头项痛、腰脊强的症状。因为巨阳者，诸阳之属也，其脉连于风府，为诸阳主气，所以先受邪。 "</span>    },    {      <span class="hljs-string">"Question"</span>: <span class="hljs-string">"三阴受病，厥阴受之会出现什么症状"</span>,      <span class="hljs-string">"Response"</span>: <span class="hljs-string">"三阴受病，若厥阴受之，厥阴脉循阴器而络于肝，会出现烦满而囊缩的症状。 若伤寒循常无变，十二日厥阴病衰，会出现囊纵、少腹微下的情况。 "</span>    },  ]</span>
</code></pre>
<h2 data-id="heading-6">7.  开始微调</h2>
<hr/>
<h4 data-id="heading-7">7.1 引入依赖</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入必要的库  </span>
<span class="hljs-keyword">from</span> unsloth <span class="hljs-keyword">import</span> FastLanguageModel, is_bfloat16_supported  
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TrainingArguments, EarlyStoppingCallback  
<span class="hljs-keyword">from</span> trl <span class="hljs-keyword">import</span> SFTTrainer  
<span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset  
  
<span class="hljs-comment"># 模型配置参数  </span>
max_seq_length = <span class="hljs-number">2048</span>  <span class="hljs-comment"># 模型处理文本的最大序列长度，支持长文本输入</span>
</code></pre>
<h4 data-id="heading-8">7.2 加载模型</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 加载预训练模型和分词器  </span>
model, <span class="hljs-attr">tokenizer</span> = FastLanguageModel.from_pretrained(  
    <span class="hljs-attr">model_name</span>=<span class="hljs-string">"ckpts/qwen2.5-1.5b-instruct-bnb-4bit"</span>,  
    <span class="hljs-attr">max_seq_length</span>=max_seq_length,  
    <span class="hljs-attr">dtype</span>=None,  <span class="hljs-comment"># 自动检测最佳数据类型（bfloat16或float16）  </span>
    <span class="hljs-attr">load_in_4bit</span>=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 使用4bit量化加载模型，大幅减少显存占用  </span>
)
</code></pre>
<h4 data-id="heading-9">7.3 加载数据集</h4>
<p>大型语言模型需要以特定的“提示风格”或“聊天模板”来接收输入，以便它们能够正确理解任务、指令、输入和预期响应之间的关系。</p>
<p>例如，一个常用的提示风格是：</p>
<pre><code class="hljs language-bash" lang="bash">“请先阅读下方的任务指令，再结合提供的上下文信息，生成恰当的回复。<span class="hljs-comment">### 指令：{} ### 上下文：{} ### 回复：{}”</span>
</code></pre>
<p>有效的微调需要仔细关注输入格式，因为它直接影响模型学习的内容和响应方式</p>
<p>下面代码中加载我们的《伤寒论》数据集（ <code>data/datasets-2025-08.json</code>），并使用 <code>formatting_data</code> 函数将其转换为 Unsloth 所需的格式，此函数会结合输入和输出，按照 <code>prompt_style</code> 进行格式化，并添加 <code>EOS_TOKEN</code>（End-of-Sentence Token），<code>EOS_TOKEN</code> 对于避免模型生成重复内容至关重要。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义训练数据格式化模板  </span>
<span class="hljs-comment"># 使用中医专家角色设定，专门针对《伤寒论》问答任务  </span>
train_prompt_style = <span class="hljs-string">"""你是一位精通中医理论的专家，特别擅长《伤寒论》的理论和实践应用。  
请根据《伤寒论》的经典理论，准确回答以下问题。  
  
### 问题:  
{}  
  
### 回答:  
{}  
"""</span>  
  
<span class="hljs-comment"># 加载训练数据集  </span>
<span class="hljs-comment"># 从JSON文件加载伤寒论问答数据集，包含问题和回答对  </span>
dataset = load_dataset(<span class="hljs-string">"json"</span>, data_files=<span class="hljs-string">"data/datasets-2025-08.json"</span>, split=<span class="hljs-string">"train"</span>)    
  
  
<span class="hljs-keyword">def</span> <span class="hljs-title function_">formatting_data</span>(<span class="hljs-params">examples</span>):  
    <span class="hljs-string">"""格式化数据集函数，将问答对转换为训练格式  
      
    将原始的问题和回答对格式化为模型训练所需的文本格式，  
    添加角色设定和结构化模板。  
  
    Args:  
        examples: 包含Question、Response字段的数据样本字典  
  
    Returns:  
        dict: 包含格式化后文本的字典，键为"text"  
    """</span>  
    questions = examples[<span class="hljs-string">"Question"</span>]  
    responses = examples[<span class="hljs-string">"Response"</span>]  
    texts = []  
    <span class="hljs-keyword">for</span> q, r <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(questions, responses):  
        <span class="hljs-comment"># 使用模板格式化每个问答对，并添加结束标记  </span>
        text = train_prompt_style.<span class="hljs-built_in">format</span>(q, r) + tokenizer.eos_token  
        texts.append(text)  
    <span class="hljs-comment"># print(f"数据集: {texts}")  </span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"text"</span>: texts}  
  
  
<span class="hljs-comment"># 应用数据格式化函数  </span>
dataset = dataset.<span class="hljs-built_in">map</span>(formatting_data, batched=<span class="hljs-literal">True</span>, num_proc=<span class="hljs-number">1</span>)  
  
<span class="hljs-comment"># 数据集分割：80%用于训练，20%用于验证  </span>
<span class="hljs-comment"># 使用固定随机种子确保结果可复现  </span>
train_test_split = dataset.train_test_split(test_size=<span class="hljs-number">0.2</span>, seed=<span class="hljs-number">3407</span>)  
train_dataset = train_test_split[<span class="hljs-string">'train'</span>]  
eval_dataset = train_test_split[<span class="hljs-string">'test'</span>]  
  
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"数据集加载完成 - 训练集: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(train_dataset)}</span> 条, 验证集: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(eval_dataset)}</span> 条"</span>)
</code></pre>
<h4 data-id="heading-10">7.4 定义 LoRA</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 添加LoRA（Low-Rank Adaptation）权重配置  </span>
<span class="hljs-comment"># LoRA是一种高效的微调方法，只训练少量参数即可适应新任务  </span>
<span class="hljs-attr">model</span> = FastLanguageModel.get_peft_model(  
    model,  
    <span class="hljs-attr">r</span>=<span class="hljs-number">32</span>,  <span class="hljs-comment"># LoRA矩阵的秩，值越大表达能力越强，但参数量也越多  </span>
    <span class="hljs-attr">target_modules</span>=[<span class="hljs-string">"q_proj"</span>, <span class="hljs-string">"k_proj"</span>, <span class="hljs-string">"v_proj"</span>, <span class="hljs-string">"o_proj"</span>, <span class="hljs-string">"gate_proj"</span>, <span class="hljs-string">"up_proj"</span>, <span class="hljs-string">"down_proj"</span>, ],  
    <span class="hljs-attr">lora_alpha</span>=<span class="hljs-number">64</span>,  <span class="hljs-comment"># LoRA缩放参数  </span>
    <span class="hljs-attr">lora_dropout</span>=<span class="hljs-number">0.1</span>,  <span class="hljs-comment"># LoRA dropout率，防止过拟合，值越小正则化越弱  </span>
    <span class="hljs-attr">bias</span>=<span class="hljs-string">"none"</span>,  <span class="hljs-comment"># 偏置项处理方式，"none"表示不训练偏置，节省参数  </span>
    <span class="hljs-attr">use_gradient_checkpointing</span>=<span class="hljs-string">"unsloth"</span>,  <span class="hljs-comment"># 使用Unsloth优化的梯度检查点，支持超长序列  </span>
    <span class="hljs-attr">random_state</span>=<span class="hljs-number">3407</span>,  <span class="hljs-comment"># 随机种子，确保结果可复现  </span>
    <span class="hljs-attr">use_rslora</span>=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># 是否使用Rank Stabilized LoRA，当前使用标准LoRA  </span>
    <span class="hljs-attr">loftq_config</span>=None,  <span class="hljs-comment"># LoftQ配置，用于更精确的量化  </span>
)
</code></pre>
<h4 data-id="heading-11">7.5 使用 <code>SFTTrainer</code> 进行训练</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建SFT（Supervised Fine-Tuning）训练器  </span>
<span class="hljs-comment"># 使用监督学习方式微调模型，适用于问答任务  </span>
<span class="hljs-attr">trainer</span> = SFTTrainer(  
    <span class="hljs-attr">model</span>=model,  
    <span class="hljs-attr">tokenizer</span>=tokenizer,  
    <span class="hljs-attr">train_dataset</span>=train_dataset,  <span class="hljs-comment"># 训练数据集  </span>
    <span class="hljs-attr">eval_dataset</span>=eval_dataset,  <span class="hljs-comment"># 验证数据集，用于评估模型性能  </span>
    <span class="hljs-attr">dataset_text_field</span>=<span class="hljs-string">"text"</span>,  <span class="hljs-comment"># 数据集中文本字段的名称  </span>
    <span class="hljs-attr">max_seq_length</span>=max_seq_length,  <span class="hljs-comment"># 最大序列长度  </span>
    <span class="hljs-attr">dataset_num_proc</span>=<span class="hljs-number">1</span>,  <span class="hljs-comment"># 数据处理进程数，设为1避免缓存冲突  </span>
    <span class="hljs-attr">packing</span>=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># 是否使用序列打包，短序列时可设为True提升5倍训练速度  </span>
    <span class="hljs-attr">callbacks</span>=[  
        EarlyStoppingCallback(early_stopping_patience=<span class="hljs-number">3</span>, early_stopping_threshold=<span class="hljs-number">0.0005</span>),  <span class="hljs-comment"># 早停机制，防止过拟合  </span>
    ],  
    <span class="hljs-attr">args</span>=TrainingArguments(  
        <span class="hljs-comment"># 批次大小配置  </span>
        <span class="hljs-attr">per_device_train_batch_size</span>=<span class="hljs-number">2</span>,  <span class="hljs-comment"># 每个GPU的训练批次大小  </span>
        <span class="hljs-attr">per_device_eval_batch_size</span>=<span class="hljs-number">2</span>,  <span class="hljs-comment"># 每个GPU的验证批次大小  </span>
          
        <span class="hljs-comment"># 梯度累积配置  </span>
        <span class="hljs-attr">gradient_accumulation_steps</span>=<span class="hljs-number">8</span>,  <span class="hljs-comment"># 梯度累积步数，有效批次大小 = batch_size * gradient_accumulation_steps  </span>
          
        <span class="hljs-comment"># 学习率配置  </span>
        <span class="hljs-attr">warmup_ratio</span>=<span class="hljs-number">0.15</span>,  <span class="hljs-comment"># 学习率预热比例，前15%的步数用于预热  </span>
        <span class="hljs-attr">learning_rate</span>=<span class="hljs-number">2</span>e-<span class="hljs-number">5</span>,  <span class="hljs-comment"># 学习率，控制参数更新步长  </span>
          
        <span class="hljs-comment"># 训练轮数和步数配置  </span>
        <span class="hljs-comment"># max_steps = 200, # 最大训练步数（可选）  </span>
        <span class="hljs-attr">num_train_epochs</span>=<span class="hljs-number">5</span>,  <span class="hljs-comment"># 训练轮数，给模型充分学习机会  </span>
          
        <span class="hljs-comment"># 精度配置  </span>
        <span class="hljs-attr">fp16</span>=not is_bfloat16_supported(),  <span class="hljs-comment"># 是否使用16位浮点精度训练  </span>
        <span class="hljs-attr">bf16</span>=is_bfloat16_supported(),  <span class="hljs-comment"># 是否使用bfloat16精度训练（更稳定）  </span>
          
        <span class="hljs-comment"># 日志和监控配置  </span>
        <span class="hljs-attr">logging_steps</span>=<span class="hljs-number">2</span>,  <span class="hljs-comment"># 每2步记录一次日志  </span>
        <span class="hljs-attr">eval_steps</span>=<span class="hljs-number">10</span>,  <span class="hljs-comment"># 每10步进行一次验证评估  </span>
        <span class="hljs-attr">eval_strategy</span>=<span class="hljs-string">"steps"</span>,  <span class="hljs-comment"># 按步数进行验证  </span>
          
        <span class="hljs-comment"># 模型保存配置  </span>
        <span class="hljs-attr">save_steps</span>=<span class="hljs-number">20</span>,  <span class="hljs-comment"># 每20步保存一次模型检查点  </span>
        <span class="hljs-attr">save_strategy</span>=<span class="hljs-string">"steps"</span>,  <span class="hljs-comment"># 按步数保存模型  </span>
        <span class="hljs-attr">save_total_limit</span>=<span class="hljs-number">5</span>,  <span class="hljs-comment"># 最多保存5个检查点，节省存储空间  </span>
          
        <span class="hljs-comment"># 最佳模型配置  </span>
        <span class="hljs-attr">load_best_model_at_end</span>=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 训练结束时自动加载最佳模型  </span>
        <span class="hljs-attr">metric_for_best_model</span>=<span class="hljs-string">"eval_loss"</span>,  <span class="hljs-comment"># 使用验证损失作为最佳模型指标  </span>
        <span class="hljs-attr">greater_is_better</span>=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># 损失越小越好  </span>
          
        <span class="hljs-comment"># 正则化配置  </span>
        <span class="hljs-attr">weight_decay</span>=<span class="hljs-number">0.001</span>,  <span class="hljs-comment"># 权重衰减，防止过拟合  </span>
        <span class="hljs-attr">max_grad_norm</span>=<span class="hljs-number">1.0</span>,  <span class="hljs-comment"># 梯度裁剪阈值，防止梯度爆炸  </span>
          
        <span class="hljs-comment"># 学习率调度配置  </span>
        <span class="hljs-attr">lr_scheduler_type</span>=<span class="hljs-string">"cosine"</span>,  <span class="hljs-comment"># 使用余弦退火学习率调度器  </span>
          
        <span class="hljs-comment"># 优化器配置  </span>
        <span class="hljs-attr">optim</span>=<span class="hljs-string">"adamw_8bit"</span>,  <span class="hljs-comment"># 使用8位AdamW优化器，节省显存  </span>
          
        <span class="hljs-comment"># 数据加载配置  </span>
        <span class="hljs-attr">dataloader_num_workers</span>=<span class="hljs-number">0</span>,  <span class="hljs-comment"># 数据加载器工作进程数，设为0避免多进程冲突  </span>
          
        <span class="hljs-comment"># 输出配置  </span>
        <span class="hljs-attr">output_dir</span>=<span class="hljs-string">"outputs"</span>,  <span class="hljs-comment"># 模型输出和检查点保存目录  </span>
          
        <span class="hljs-comment"># 随机种子  </span>
        <span class="hljs-attr">seed</span>=<span class="hljs-number">3407</span>,  <span class="hljs-comment"># 随机种子，确保结果可复现  </span>
  
    ),  
)  
  
<span class="hljs-comment"># 开始训练  </span>
<span class="hljs-attr">train_stats</span> = trainer.train()  
print(f"训练完成，训练损失: \n {train_stats}")
</code></pre>
<h4 data-id="heading-12">7.6 模型保存</h4>
<p>Unsloth 提供了多种保存微调后模型的方法，每种方法都有其特定的用途：</p>
<p><strong><code>save_pretrained</code></strong></p>
<p>此方法仅保存 LoRA 适配器权重。这些文件通常很小，只包含模型修改部分，包括 <code>adapter_config.json</code> 和 <code>adapter_model.safetensors</code> 。这种方法适用于需要灵活切换不同 LoRA 适配器或节省存储空间的情况。</p>
<p><strong><code>save_pretrained_gguf</code></strong></p>
<p>这是一种新的优化格式（GGUF），支持更好的元数据处理。文件同样较小且经过量化，包括 <code>model.gguf</code> 和 <code>tokenizer.json</code> 。Unsloth 的动态量化在 GGUF 导出中通过智能的层特定量化策略，进一步增强了模型性能和效率。</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 保存微调后的模型权重</span>
<span class="hljs-comment"># 只保存LoRA权重，原始模型权重保持不变</span>
model.save_pretrained(<span class="hljs-string">"ckpts/qwen2.5-1.5b-instruct-bnb-4bit-lora"</span>)
<span class="hljs-comment"># 保存分词器（tokenizer），以便后续加载和推理时使用</span>
tokenizer.save_pretrained(<span class="hljs-string">"ckpts/qwen2.5-1.5b-instruct-bnb-4bit-lora"</span>)
<span class="hljs-comment">#==================================================================================</span>

<span class="hljs-comment"># model.save_pretrained_gguf("ckpts/qwen2.5-1.5b-instruct-bnb-4bit-gguf", tokenizer, quantization_method="q4_k_m")</span>
</code></pre>
<h4 data-id="heading-13">7.7 训练过程</h4>
<p><strong>开始时显示基础信息：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-string">==((====))==</span>  <span class="hljs-attr">Unsloth 2025.7.8: Fast Qwen3 patching. Transformers:</span> <span class="hljs-number">4.53</span><span class="hljs-number">.3</span><span class="hljs-string">.</span>
   <span class="hljs-string">\</span>   <span class="hljs-string">/|</span>    <span class="hljs-string">NVIDIA</span> <span class="hljs-string">GeForce</span> <span class="hljs-string">RTX</span> <span class="hljs-number">2050. </span><span class="hljs-string">Num</span> <span class="hljs-string">GPUs</span> <span class="hljs-string">=</span> <span class="hljs-attr">1. Max memory: 4.0 GB. Platform:</span> <span class="hljs-string">Windows.</span>
<span class="hljs-string">O^O/</span> <span class="hljs-string">_/</span> <span class="hljs-string">\</span>    <span class="hljs-attr">Torch:</span> <span class="hljs-number">2.7</span><span class="hljs-number">.1</span><span class="hljs-string">+cu126.</span> <span class="hljs-attr">CUDA: 8.6. CUDA Toolkit: 12.6. Triton:</span> <span class="hljs-number">3.3</span><span class="hljs-number">.1</span>
<span class="hljs-string">\</span>        <span class="hljs-string">/</span>    <span class="hljs-string">Bfloat16</span> <span class="hljs-string">=</span> <span class="hljs-string">TRUE.</span> <span class="hljs-string">FA</span> [<span class="hljs-string">Xformers</span> <span class="hljs-string">=</span> <span class="hljs-number">0.0</span><span class="hljs-number">.31</span><span class="hljs-string">.post1.</span> <span class="hljs-string">FA2</span> <span class="hljs-string">=</span> <span class="hljs-literal">False</span>]
 <span class="hljs-string">"-____-"</span>     <span class="hljs-attr">Free license:</span> <span class="hljs-string">http://github.com/unslothai/unsloth</span>
<span class="hljs-comment"># 批注：系统配置信息</span>
<span class="hljs-comment"># - 使用RTX 2050显卡，4GB显存</span>
<span class="hljs-comment"># - 支持bfloat16精度训练</span>
<span class="hljs-comment"># - 使用Xformers优化注意力机制</span>

</code></pre>
<p><strong>再给出微调的配置：</strong></p>
<pre><code class="hljs language-ini" lang="ini">==((====))==  Unsloth - 2x faster free finetuning | Num GPUs <span class="hljs-attr">used</span> = <span class="hljs-number">1</span>  
   \\   /|    Num <span class="hljs-attr">examples</span> = <span class="hljs-number">353</span> | Num Epochs = <span class="hljs-number">5</span> | Total steps = <span class="hljs-number">115</span>  
O^O/ \_/ \    Batch size per <span class="hljs-attr">device</span> = <span class="hljs-number">2</span> | Gradient accumulation steps = <span class="hljs-number">8</span>  
\        /    Data Parallel <span class="hljs-attr">GPUs</span> = <span class="hljs-number">1</span> | Total batch size (<span class="hljs-number">2</span> x <span class="hljs-number">8</span> x <span class="hljs-number">1</span>) = <span class="hljs-number">16</span>  
 "-____-"     Trainable <span class="hljs-attr">parameters</span> = <span class="hljs-number">20</span>,<span class="hljs-number">185</span>,<span class="hljs-number">088</span> of <span class="hljs-number">616</span>,<span class="hljs-number">235</span>,<span class="hljs-number">008</span> (<span class="hljs-number">3.28</span>% trained)  
<span class="hljs-comment"># 批注：训练配置详情  </span>
<span class="hljs-comment"># - 总样本数：353个  </span>
<span class="hljs-comment"># - 训练轮数：5轮  </span>
<span class="hljs-comment"># - 总步数：115步  </span>
<span class="hljs-comment"># - 有效批次大小：16（2×8×1）  </span>
<span class="hljs-comment"># - 可训练参数：3.28%（20M/616M）</span>
</code></pre>
<p><strong>后面是微调细节：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">{<span class="hljs-string">'loss'</span>: <span class="hljs-number">2.1017</span>, <span class="hljs-string">'grad_norm'</span>: <span class="hljs-number">3.180413007736206</span>, <span class="hljs-string">'learning_rate'</span>: <span class="hljs-number">1.995283421166614e-05</span>, <span class="hljs-string">'epoch'</span>: <span class="hljs-number">1.05</span>}  
{<span class="hljs-string">'loss'</span>: <span class="hljs-number">2.2702</span>, <span class="hljs-string">'grad_norm'</span>: <span class="hljs-number">2.8307971954345703</span>, <span class="hljs-string">'learning_rate'</span>: <span class="hljs-number">1.9869167087338908e-05</span>, <span class="hljs-string">'epoch'</span>: <span class="hljs-number">1.14</span>}  
{<span class="hljs-string">'loss'</span>: <span class="hljs-number">2.0511</span>, <span class="hljs-string">'grad_norm'</span>: <span class="hljs-number">3.1757583618164062</span>, <span class="hljs-string">'learning_rate'</span>: <span class="hljs-number">1.9744105246469264e-05</span>, <span class="hljs-string">'epoch'</span>: <span class="hljs-number">1.23</span>}  
{<span class="hljs-string">'loss'</span>: <span class="hljs-number">2.1853</span>, <span class="hljs-string">'grad_norm'</span>: <span class="hljs-number">2.5234906673431396</span>, <span class="hljs-string">'learning_rate'</span>: <span class="hljs-number">1.957817324187987e-05</span>, <span class="hljs-string">'epoch'</span>: <span class="hljs-number">1.32</span>}  
{<span class="hljs-string">'loss'</span>: <span class="hljs-number">1.8145</span>, <span class="hljs-string">'grad_norm'</span>: <span class="hljs-number">2.9424679279327393</span>, <span class="hljs-string">'learning_rate'</span>: <span class="hljs-number">1.937206705006344e-05</span>, <span class="hljs-string">'epoch'</span>: <span class="hljs-number">1.32</span>}
</code></pre>
<h2 data-id="heading-14">8.  测试微调的模型</h2>
<p>模型测试代码如下：</p>
<pre><code class="hljs language-ini" lang="ini">from unsloth import FastLanguageModel  
from unsloth.chat_templates import get_chat_template  
from transformers import TextStreamer  
import torch  
  
<span class="hljs-attr">max_seq_length</span> = <span class="hljs-number">512</span>  
  
  
model, <span class="hljs-attr">tokenizer</span> = FastLanguageModel.from_pretrained(  
    <span class="hljs-attr">model_name</span>=<span class="hljs-string">"ckpts/qwen2.5-1.5b-instruct-bnb-4bit-lora"</span>,  
    <span class="hljs-attr">max_seq_length</span>=max_seq_length,  
    <span class="hljs-attr">dtype</span>=None,  
    <span class="hljs-attr">load_in_4bit</span>=<span class="hljs-literal">True</span>,  
)  
  
<span class="hljs-comment"># 启用unsloth的2x更快推理优化  </span>
print("启用推理优化...")  
FastLanguageModel.for_inference(model)  
print("模型加载完成")  
  
  
<span class="hljs-comment"># 定义训练数据格式化字符串模板  </span>
<span class="hljs-attr">train_prompt_style</span> = <span class="hljs-string">"""你是一位精通中医理论的专家，特别擅长《伤寒论》的理论和实践应用。  
请根据《伤寒论》的经典理论，准确回答以下问题。  
  
### 问题:  
{}  
"""</span>  
<span class="hljs-attr">question</span> = <span class="hljs-string">'什么是太阳病？'</span>  
  
<span class="hljs-attr">formatted_prompt</span> = train_prompt_style.format(question)  
print(f"格式化后的提示文本:\n-------------------\n{formatted_prompt}\n-------------------")  
print(type(tokenizer))   <span class="hljs-comment"># &lt;class 'transformers.models.qwen2.tokenization_qwen2_fast.Qwen2TokenizerFast'&gt;  </span>
<span class="hljs-attr">inputs</span> = tokenizer([formatted_prompt], return_tensors=<span class="hljs-string">'pt'</span>, max_length=max_seq_length).to(<span class="hljs-string">"cuda"</span>)  
  
print(f"inputs: \n-------------------\n{inputs}\n-------------------")  
  
  
  
<span class="hljs-comment"># 生成回答（流式输出）  </span>
with torch.no_grad():  
    <span class="hljs-attr">outputs</span> = model.generate(  
        <span class="hljs-comment"># 输入序列的token ID  </span>
        inputs<span class="hljs-section">['input_ids']</span>,   
        <span class="hljs-comment"># 注意力掩码，指示哪些位置是有效输入  </span>
        <span class="hljs-attr">attention_mask</span>=inputs[<span class="hljs-string">'attention_mask'</span>],   
        <span class="hljs-comment"># 生成文本的最大长度限制  </span>
        <span class="hljs-attr">max_length</span>=max_seq_length,  
        <span class="hljs-comment"># 启用KV缓存，加速生成过程  </span>
        <span class="hljs-attr">use_cache</span>=<span class="hljs-literal">True</span>,  
        <span class="hljs-comment"># 温度参数，控制生成的随机性  </span>
        <span class="hljs-comment"># 值越低生成越确定，值越高生成越随机  </span>
        <span class="hljs-attr">temperature</span>=<span class="hljs-number">0.8</span>,   
        <span class="hljs-comment"># 核采样参数，只从累积概率达到90%的词中选择  </span>
        <span class="hljs-comment"># 避免选择概率极低的词，提高生成质量  </span>
        <span class="hljs-attr">top_p</span>=<span class="hljs-number">0.9</span>,  
        <span class="hljs-comment"># 启用采样模式，而不是贪婪解码  </span>
        <span class="hljs-comment"># 贪婪解码总是选择概率最高的词，容易产生重复  </span>
        <span class="hljs-attr">do_sample</span>=<span class="hljs-literal">True</span>,  
        <span class="hljs-comment"># 设置填充标记ID，用于处理变长序列  </span>
        <span class="hljs-attr">pad_token_id</span>=tokenizer.eos_token_id,  
        <span class="hljs-comment"># 设置结束标记ID，告诉模型何时停止生成  </span>
        <span class="hljs-attr">eos_token_id</span>=tokenizer.eos_token_id,  
        <span class="hljs-comment"># 重复惩罚参数，防止模型重复生成相同内容  </span>
        <span class="hljs-comment"># 1.1表示重复词的生成概率降低10%  </span>
        <span class="hljs-attr">repetition_penalty</span>=<span class="hljs-number">1.1</span>  
    )  
  
print(type(outputs))  
print(outputs)  
<span class="hljs-attr">answer</span> = tokenizer.decode(outputs[<span class="hljs-number">0</span>], skip_special_tokens=<span class="hljs-literal">True</span>)  
print("\n<span class="hljs-attr">" + "</span>=<span class="hljs-string">" * 80)  
print(answer)  
print("</span>\n<span class="hljs-string">" + "</span>=<span class="hljs-string">" * 80)  
print("</span>测试完成！<span class="hljs-string">")
</span></code></pre>
<h3 data-id="heading-15">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[金仓KES：玩转“五位一体”融合架构，轻松驾驭数字时代]]></title>    <link>https://juejin.cn/post/7571005216910606355</link>    <guid>https://juejin.cn/post/7571005216910606355</guid>    <pubDate>2025-11-11T06:19:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910606355" data-draft-id="7571304204720439350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="金仓KES：玩转“五位一体”融合架构，轻松驾驭数字时代"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-11T06:19:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            金仓KES：玩转“五位一体”融合架构，轻松驾驭数字时代
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:19:57.000Z" title="Tue Nov 11 2025 06:19:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9f8cede0c064c39bf40babc52cc149e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763446797&amp;x-signature=AsVHGzWivpPEvVeUBx78INGrjOw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">开篇：数据时代，你的数据库还好吗？</h2>
<p>当下的数字时代，数据如同生命线一般重要，是推动企业发展的关键力量，不过须要坦诚地说，要想让数据切实发挥作用，并非没有诸多棘手难题。</p>
<ul>
<li>系统繁多，数据隔离，公司存在许多应用系统，其底层数据库种类繁杂，Oracle，MySQL，PostgreSQL等等，这些数据库好似一个个孤岛，数据想要互相探访十分艰难。</li>
<li>场景一旦改变，工具就必要更换，如今要做报表，明天要搞分析，后天还要处理即时数据流，于是便买了许多关系型，文档型，时序型数据库，整个架构既迟缓又沉重，维持它简直让人想死。</li>
<li>国产化浪潮已然来临，对于老系统而言，将其迁移到本国平台之上，其风险颇高，历时亦长，真可谓“欲爱之却非易事”。</li>
</ul>
<p>应对这些问题时，不能再用以往那种“头痛医头，脚痛医脚”的老方法，于是，业界迫切须要一种新的思路，这时，国产数据库中的“大哥”人大金仓站出来，拿出了其几代人积累的核心技术——KingbaseES V9，这是一款实至名归的“融合型”数据库，它重点在于做到“五个一体化”，其目的十分清晰，即凭借单个平台去解决多源，多模，多态等各种复杂问题，从而让中国的数据得以真正运行在“中国芯”之上。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca49d50ad0324aa3b1d60cd9050ecca7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763446797&amp;x-signature=HnIvIDmWguWbu4Iy%2BqOBGtNojsQ%3D" alt="d1401727b440ebf819d7998a9d2d4362.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">一、多语法一体化：代码不用改，迁移没烦恼</h2>
<p>搞过国产化替代的兄弟们都知道，最头疼的就是应用迁移，成本高得吓人，风险大得离谱。特别是那些跟Oracle“深度绑定”的核心系统，里面的存储过程、函数、包，改起来简直是噩梦。</p>
<p><strong>金仓KES的第一个杀手锏，就是“多语法一体化兼容”。</strong> 这可不是简单的“假装认识”，而是从数据库的根儿上，就同时支持SQL标准、Oracle、SQL Server、MySQL、PostgreSQL这些主流数据库的“方言”。</p>
<p><strong>这玩意儿有啥好？</strong></p>
<ul>
<li><strong>代码基本不用动</strong>：以前用Oracle的PL/SQL，或者SQL Server的T-SQL写的代码，KES直接就能看懂、能执行。这么一来，迁移工作量大大减少，风险自然也下来了。5</li>
<li><strong>开发习惯不用改</strong>：原来写Oracle的继续写，写MySQL的也别停。开发团队不用重新学一套新东西，原来的手艺一点没丢，效率杠杠的。</li>
</ul>
<p><strong>举个栗子：直接在KES里跑Oracle风格的PL/SQL</strong></p>
<p>比如说，你之前在Oracle里有这么一个管理员工信息的包（Package）：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- Oracle里的PL/SQL包</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE PACKAGE emp_admin <span class="hljs-keyword">AS</span>
   <span class="hljs-keyword">PROCEDURE</span> hire_employee (p_emp_id NUMBER, p_name VARCHAR2, p_job VARCHAR2);
   <span class="hljs-keyword">FUNCTION</span> get_salary (p_emp_id NUMBER) <span class="hljs-keyword">RETURN</span> NUMBER;
<span class="hljs-keyword">END</span> emp_admin;
<span class="hljs-operator">/</span>

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE PACKAGE BODY emp_admin <span class="hljs-keyword">AS</span>
   <span class="hljs-keyword">PROCEDURE</span> hire_employee (p_emp_id NUMBER, p_name VARCHAR2, p_job VARCHAR2) <span class="hljs-keyword">IS</span>
   <span class="hljs-keyword">BEGIN</span>
      <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> employees (employee_id, first_name, job_id, hire_date)
      <span class="hljs-keyword">VALUES</span> (p_emp_id, p_name, p_job, SYSDATE);
   <span class="hljs-keyword">END</span> hire_employee;

   <span class="hljs-keyword">FUNCTION</span> get_salary (p_emp_id NUMBER) <span class="hljs-keyword">RETURN</span> NUMBER <span class="hljs-keyword">IS</span>
      v_salary NUMBER :<span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
   <span class="hljs-keyword">BEGIN</span>
      <span class="hljs-keyword">SELECT</span> salary <span class="hljs-keyword">INTO</span> v_salary <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">WHERE</span> employee_id <span class="hljs-operator">=</span> p_emp_id;
      <span class="hljs-keyword">RETURN</span> v_salary;
   <span class="hljs-keyword">END</span> get_salary;
<span class="hljs-keyword">END</span> emp_admin;
<span class="hljs-operator">/</span>
</code></pre>
<p>换到金仓KES平台，这段代码你一个字都不用改，直接就能跑。对于那些攒了一堆PL/SQL代码的公司来说，这简直是救星啊！</p>
<hr/>
<h2 data-id="heading-2">二、多模数据一体化：别再建孤岛了，数据放一块儿才够劲</h2>
<p>现在都搞物联网、车联网了，数据早就不是只有行和列那么简单了。时序数据、地理位置（GIS）、JSON文档、图关系...各种新花样层出不穷。以前的办法是，来一种新数据，就买一套新数据库，结果公司里“数据孤岛”越来越多，想把不同类型的数据放一起分析比登天还难。</p>
<p><strong>金仓KES的“多模一体化”就是来解决这个问题的。</strong> 它在一个数据库里，就把关系、文档、图、KV、GIS、时序、向量这些乱七八糟的数据模型全都支持了。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3e981cd04aa48b49257176e2fad23ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763446797&amp;x-signature=1lfh2rKlqRBgwviPESxpGfpVSQ0%3D" alt="image.png" loading="lazy"/></p>
<p><strong>这又解决了什么痛点？</strong></p>
<ul>
<li><strong>告别数据冗余和壁垒</strong>：所有数据都放在KES这一个篮子里，再也不用费劲地在不同系统之间倒腾数据了，技术架构一下子就清爽了。</li>
<li><strong>跨界分析，释放新价值</strong>：你可以用一条SQL，同时查关系表、地理位置和JSON文档，这种“混搭”玩法能让你发现以前根本看不到的商业机会。</li>
</ul>
<p><strong>再举个栗子：时序+GIS的融合查询</strong></p>
<p>想象一下，在智慧交通系统里，你想知道“最近1小时，在市中心那个商圈里，有哪些网约车出没过？” 这就需要同时处理时间和空间两种信息。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 假设：</span>
<span class="hljs-comment">-- 1. taxi_tracks 是个时序表，存着车牌号(license_plate)、时间戳(ts)和经纬度(location)</span>
<span class="hljs-comment">-- 2. core_business_district 是个地理多边形(GEOMETRY)，画出了商圈的范围</span>

<span class="hljs-keyword">SELECT</span>
    license_plate,
    ts,
    ST_AsText(location) <span class="hljs-keyword">AS</span> current_position
<span class="hljs-keyword">FROM</span>
    taxi_tracks
<span class="hljs-keyword">WHERE</span>
    <span class="hljs-comment">-- 按时间筛选：就要最近1小时的</span>
    ts <span class="hljs-operator">&gt;</span> NOW() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'1 hour'</span>
<span class="hljs-keyword">AND</span>
    <span class="hljs-comment">-- 按空间筛选：必须在商圈里头</span>
    ST_Contains(
        ST_GeomFromText(<span class="hljs-string">'POLYGON((...))'</span>, <span class="hljs-number">4326</span>), <span class="hljs-comment">-- 把商圈范围画出来</span>
        location
    );
</code></pre>
<p>你看，就这么一条SQL，既处理了时序（<code>ts &gt; NOW() - INTERVAL '1 hour'</code>），又处理了GIS（<code>ST_Contains</code>）。在一个数据库里就把这么复杂的时空分析搞定了，这在以前那种“多系统组合”的方案里，简直不敢想。</p>
<hr/>
<h2 data-id="heading-3">三、多应用场景一体化：一边交易一边分析，决策快人一步</h2>
<p>老规矩是，数据库得分两拨，一拨叫OLTP，专门处理在线交易，要求快、准、稳；另一拨叫OLAP，专门搞数据分析，要求能算、能聚合。这么一来，你想分析最新的交易数据？对不起，等明天吧！数据得先进数仓，决策永远慢半拍。</p>
<p><strong>金仓KES直接上了HTAP（混合事务/分析处理）架构，实现了“多应用场景一体化”。</strong> 简单说，就是通过内存计算、行列混存这些黑科技，让同一份数据，既能顶住高并发的交易请求，又能随时响应复杂的分析查询。5</p>
<p><strong>这能带来什么好处？</strong></p>
<ul>
<li><strong>实时决策，抢占先机</strong>：分析的就是最新的业务数据，不用等T+1。像实时风控、实时营销这种场景，终于能玩起来了。</li>
<li><strong>架构瘦身，省心省钱</strong>：一套KES，就顶替了以前“OLTP数据库 + ETL工具 + OLAP数仓”的豪华套餐，系统简单了，运维成本自然就下来了。</li>
<li><strong>性能超能打</strong>：KES的性能可不是吹的，跑OLTP的TPCC测试，峰值能干到220万tpmc，搞复杂分析也一点不含糊。5</li>
</ul>
<p><strong>场景模拟：HTAP混合查询</strong></p>
<p>在一个电商平台，老板突然想知道：“咱们的‘钻石会员’，平均一单买多少钱？最近半小时又贡献了多少销售额？”</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 一个简单的HTAP查询</span>
<span class="hljs-keyword">SELECT</span>
    c.customer_level,
    <span class="hljs-built_in">AVG</span>(o.order_amount) <span class="hljs-keyword">AS</span> avg_order_value,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> o.order_time <span class="hljs-operator">&gt;=</span> NOW() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'30 minute'</span> <span class="hljs-keyword">THEN</span> o.order_amount <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> recent_30min_total
<span class="hljs-keyword">FROM</span>
    customers c <span class="hljs-comment">-- 这张表可能以行存为主，用户信息更新快</span>
<span class="hljs-keyword">JOIN</span>
    orders o <span class="hljs-keyword">ON</span> c.customer_id <span class="hljs-operator">=</span> o.customer_id <span class="hljs-comment">-- 这张表可能行列混存，既要实时下单，又要聚合分析</span>
<span class="hljs-keyword">WHERE</span>
    c.customer_level <span class="hljs-operator">=</span> <span class="hljs-string">'钻石会员'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
    c.customer_level;
</code></pre>
<p>KES的聪明之处在于，它的查询优化器会自动判断：更新用户信息这种点查询，用行存效率高；算订单总额这种大批量分析，用列存速度快。就这么着，在一个数据库里，把两种活儿都漂亮地干完了。</p>
<hr/>
<h2 data-id="heading-4">四、集中、分布一体化：从小玩到大，架构随你变</h2>
<p>公司业务规模不一样，对数据库的要求也千差万别。小公司可能搞个主备就够了，业务发展快了就得上读写分离，要是做成了互联网巨头，那必须得上能无限扩展的分布式集群。</p>
<p><strong>金仓KES的“集中、分布一体化架构”就像玩乐高一样，特别灵活。</strong> 它在同一个产品里，把主备、读写分离、共享存储集群（类似Oracle RAC）、还有无共享的分布式集群（Sharding）全都给你准备好了。</p>
<p><strong>这又有什么讲究？</strong></p>
<ul>
<li><strong>丰俭由人，按需选择</strong>：你想要高可用、高扩展，还是一致性？根据你的业务需求，挑最合适的架构来用就行。</li>
<li><strong>无痛升级，平滑演进</strong>：业务从小到大，数据库架构也能跟着平滑升级，从主备到读写分离，再到分布式，都不用换数据库，一次投资，长期受益。</li>
<li><strong>金融级高可用，稳如泰山</strong>：什么同城双活、两地三中心，这些金融行业才敢想的容灾方案，KES都支持。数据零丢失（RPO=0），故障秒级恢复（RTO≤30秒），妥妥的。5</li>
</ul>
<p><strong>架构示意：两地三中心怎么玩？</strong></p>
<ul>
<li><strong>生产中心（同城双活）</strong>：在北京的两个机房里部署KES共享存储集群，对外就一个地址，一个机房挂了，业务自动切到另一个，用户根本感觉不到。</li>
<li><strong>灾备中心（异地容灾）</strong>：在上海再搞一套KES集群，北京的数据实时同步过来。万一北京两个机房都“团灭”了，手动或者自动把业务切到上海，保证服务不中断。</li>
</ul>
<hr/>
<h2 data-id="heading-5">五、开发、运维一体化：一个平台全搞定，省人又省心</h2>
<p>管理数据库这活儿，从开发、测试、上线，到监控、优化，是个贯穿始终的苦差事。以前，开发和DBA（数据库管理员）各用各的工具，沟通起来跟“鸡同鸭讲”似的，效率特别低。</p>
<p><strong>金仓KES直接提供了一套“开发、运维一体化”的工具链，把DevOps的流程给打通了。</strong></p>
<p><strong>这套工具有多香？</strong></p>
<ul>
<li><strong>KStudio (开发神器)</strong>：开发人员用它，从数据库设计、写SQL、调试，到性能分析、做迁移评估，一站式搞定。</li>
<li><strong>KOPS (运维法宝)</strong>：运维人员用它，部署集群、搞监控告警、做备份恢复、玩弹性伸缩，点点鼠标就完成了，还能智能巡检。</li>
<li><strong>降低人力成本</strong>：有了这套统一的工具，对专业的DBA依赖就没那么强了，开发人员自己也能干不少数据库的活儿，整个团队反应更快，效率更高。</li>
</ul>
<p><strong>看看这些贴心功能：</strong></p>
<ul>
<li><strong>KStudio的迁移评估</strong>：想从Oracle迁过来？先用它连上老库扫一遍，自动告诉你哪些代码要改，改动有多大，生成一份详细的报告，让你心里有底。</li>
<li><strong>KOPS的一键部署</strong>：想搭个主备集群，还是分布式集群？在图形界面上选好，点一下“部署”，KOPS就把所有复杂的配置都给你搞定了。</li>
</ul>
<hr/>
<h2 data-id="heading-6">总结：融合，才是国产数据库的王道</h2>
<p>金仓数据库KES的“五个一体化”，可不是简单地把五个功能堆在一起，它们之间是环环相扣、互相成就的。</p>
<ul>
<li><strong>多语法兼容</strong>，解决了“怎么来”的问题；</li>
<li><strong>多模融合</strong>，解决了“怎么存、怎么算”的问题；</li>
<li><strong>HTAP</strong>，解决了“怎么用得快、看得清”的问题；</li>
<li><strong>多架构支持</strong>，解决了“怎么长大、怎么站稳”的问题；</li>
<li><strong>一体化工具</strong>，则解决了“怎么管得好、成本低”的问题。</li>
</ul>
<p>这种“五位一体”的融合架构，乃是金仓数据库 KES 实实在在的核心竞争力所在，凭借此，KES 可以做到“用不变应万变”，用单个平台淡定应对企业数字化转型进程当中出现的各种数据问题，其既是一款不错的数据库产品，又是一次对未来数据库发展走向深入思索并完成考察的过程，为达成“让中国数据跑在中国引擎之上”这一宏伟愿景贡献出一份真真切切的成绩。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[李飞飞最新长文火爆硅谷]]></title>    <link>https://juejin.cn/post/7571068689765744680</link>    <guid>https://juejin.cn/post/7571068689765744680</guid>    <pubDate>2025-11-11T06:34:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571068689765744680" data-draft-id="7571021605318787124" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="李飞飞最新长文火爆硅谷"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-11T06:34:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            李飞飞最新长文火爆硅谷
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:34:24.000Z" title="Tue Nov 11 2025 06:34:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>空间智能，是 AI 的下一个前沿。</p>
<p>刚刚，AI 教母李飞飞发表长文，首次系统性地解释了什么空间智能、为什么重要以及如何构建能够解锁它的<strong>世界模型</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b455d3f83984b5bb8dcb47dcb37851c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447664&amp;x-signature=TAzK6iQriFuGuq05oahSJ%2FhtQpw%3D" alt="" loading="lazy"/></p>
<p>文章里，李飞飞不仅提出了 “真正具有空间智能的世界模型” 必须具备的三个核心能力：</p>
<ul>
<li><strong>生成（Generative）：能创造遵守物理定律、空间一致的世界；</strong></li>
<li><strong>多模态（Multimodal）：能处理从图像、视频到动作的多模态输入；</strong></li>
<li><strong>交互（Interactive）：能预测世界随时间演变或互动的状态。</strong></li>
</ul>
<p>而且，还分享了 World Labs 在新一代<strong>任务函数</strong>、<strong>数据</strong>、<strong>模型架构与学习表示</strong>上面的进展，以及世界模型在创造力、机器人，甚至科学、医疗和教育等领域的潜力。</p>
<p>一经发出，点赞者众，疯传者广，都成热文热搜趋势了——</p>
<p>将空间智能融入世界模型（LWMs）有望推动大语言模型（LLMs）实现下一次质的飞跃。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5338b2f22bbd4dd4ac9e7a8bd813e321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447664&amp;x-signature=LpQQH4qQj5KPfXrAYEVI068vfxQ%3D" alt="" loading="lazy"/></p>
<p>一旦因果推理能力和能效达到相应水平，我们就将站在通往通用人工智能的拐点上。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a58b3efcc8e14c5b92c7c9d8d0118790~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447664&amp;x-signature=sMCfren1yeseuhyflfHxSo2LAPE%3D" alt="" loading="lazy"/></p>
<p>好了，不多说了。接下来，我们一起看看李飞飞这篇从**文字到世界（from words to worlds）**的宣言吧。</p>
<p>以下是全文：</p>
<h2 data-id="heading-0">从文字到世界：空间智能是 AI 的下一个前沿</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d164dce04f347a49ad30670f8962aeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447664&amp;x-signature=QRTWkhJHS%2FmcwnGBV5c%2FYRjv4o4%3D" alt="" loading="lazy"/></p>
<p>1950 年，当计算机还只是自动化算术和简单逻辑时，艾伦 · 图灵提出了一个至今仍回荡的问题：机器能思考吗？</p>
<p>他能看到别人尚未看到的未来，需要非凡的想象力——那就是：智能或许有一天可以被 “构建”，而非 “诞生”。</p>
<p>这一洞见催生了一场持续至今的科学征程——人工智能（AI）。在我投身 AI 研究的 25 年中，图灵的愿景依然不断启发着我。但我们距离那一愿景有多近？答案并不简单。</p>
<p>今天，以大语言模型（LLM）为代表的前沿 AI 技术，已经开始改变人类获取与处理抽象知识的方式。 然而，它们仍然是 “黑暗中的文字匠”：能言善辩，却无经验；知识丰富，却缺乏根基。</p>
<p><strong>空间智能（spatial intelligence）将改变我们创造和交互现实与虚拟世界的方式——彻底革新叙事、创造力、机器人学、科学发现，以及更多领域。这，正是 AI 的下一个前沿。</strong></p>
<p>自我进入这一领域以来，对视觉与空间智能的探索就一直是我的 “北极星”。这也是我为何花费多年时间构建了 ImageNet——首个大规模视觉学习与评测数据集。</p>
<p>它与神经网络算法、现代算力（如 GPU）一道，成为孕育现代 AI 的三大关键要素。也是为何我的斯坦福实验室在过去十年中，将计算机视觉与机器人学习相结合。</p>
<p>同样，这也是我与联合创始人 Justin Johnson、Christoph Lassner、Ben Mildenhall 一年前共同创建 World Labs 的原因：为了第一次真正实现这一可能性。</p>
<p>在这篇文章中，我将解释什么是空间智能、为什么它重要、以及我们如何构建能够解锁它的 “世界模型（world models）”——这种技术将深刻重塑创造力、具身智能与人类进步。</p>
<h2 data-id="heading-1">空间智能：人类认知的脚手架</h2>
<p>AI 从未像今天这样令人振奋。以生成式 AI 为代表的模型，如 LLM，已从研究室走向日常生活，成为数十亿人创作、生产与交流的工具。</p>
<p>它们展示了曾被认为不可能的能力：生成连贯的文本、成山的代码、逼真的图像，甚至短视频。 AI 是否会改变世界？——从任何合理的定义来看，它已经做到了。</p>
<p>然而，仍有大量潜能未被触及。自动化机器人的愿景依然诱人却遥远；在疾病治疗、新材料发现、粒子物理等领域的研究加速梦仍未实现；</p>
<p>真正能够理解并赋能人类创作者的 AI，无论是学习复杂分子化学概念的学生、构想空间的建筑师、构建世界的电影人，还是任何希望沉浸于虚拟体验中的人都仍未到来。</p>
<p>要理解为何这些能力依旧难以实现，我们需要回溯：空间智能是如何演化的？它又如何塑造了我们理解世界的方式？</p>
<p>视觉长期以来是人类智能的基石，但它的力量源自更为根本的东西。早在动物能筑巢、抚育后代、用语言交流或建立文明之前，那看似简单的 “感知行为”：感受到一缕光、触到一种质感就已经悄然点燃了通向智能的进化旅程。</p>
<p>这种从外部世界汲取信息的能力，在感知与生存之间搭建起一座桥梁，而这一桥梁在漫长的进化中变得愈发复杂。</p>
<p>神经元层层叠加，形成能解释世界、协调生物与环境互动的神经系统。因此，许多科学家认为，<strong>“感知—行动” 循环</strong>成为了智能进化的核心机制，也是自然孕育出我们这个物种的根基——一个能感知、学习、思考与行动的终极存在。</p>
<p>空间智能在我们与物理世界的互动中扮演着基础性的角色。每天，我们都在依赖它完成最平常的动作。</p>
<p>停车时想象车尾与路缘的距离；接住被抛来的钥匙；在人群中穿行而不碰撞；半睡半醒间准确地将咖啡倒进杯中。</p>
<p>在极端情况下，消防员穿行于坍塌建筑与浓烟之中，瞬间判断稳定性与生死抉择，通过肢体语言和本能默契沟通——这些都无可言传。而婴儿则在学会语言前的漫长时光里，通过玩耍与环境互动来认识世界。</p>
<p>这一切都在直觉中、自然而然地发生——一种机器至今未能获得的流畅能力。</p>
<p>空间智能同样是我们想象力与创造力的基石。讲故事的人在脑中构建出丰富的世界，并用各种视觉媒介将之传达给他人。</p>
<p>从原始洞穴壁画，到现代电影，再到沉浸式电子游戏。无论是孩子在沙滩上筑城堡，还是在电脑上玩《我的世界》，这种以空间为根基的想象构成了人与虚拟世界交互体验的基础。而在工业应用中，对物体、场景与动态交互环境的模拟则支撑着从工业设计、数字孪生到机器人训练等无数关键场景。</p>
<p>历史上那些塑造文明的关键时刻中，空间智能往往扮演着核心角色。</p>
<p>在古希腊，埃拉托色尼（Eratosthenes）通过对阴影的几何化思考完成了惊人的壮举——他在亚历山大测得太阳影子形成的 7 度角，并与赛恩（Syene）“正午无影” 的现象进行对比，从而计算出了地球的周长。</p>
<p>哈格里夫斯（Hargreaves）发明的 “珍妮纺纱机” 同样源于空间洞察：他意识到只需将多个纺锤并列安装在一个机架上，一个工人就能同时纺出多股线，生产效率因此提高了八倍。</p>
<p>沃森（Watson）与克里克（Crick）揭示 DNA 结构的突破，也依赖于他们亲手搭建的三维分子模型——他们用金属板与铁丝不断调整、拼接，直到碱基对的空间排布完美契合。</p>
<p>在这些案例中，空间智能都推动了文明的进步——当科学家与发明家需要操纵物体、想象结构、在物理空间中推理时，这些能力是纯文字永远无法承载的。</p>
<p><strong>空间智能（Spatial Intelligence）是支撑人类认知的脚手架。</strong></p>
<p>无论是被动观察，还是主动创造，它都在默默发挥作用。</p>
<p>它驱动我们的推理与规划，即便是在最抽象的主题上。它同样塑造了我们与世界互动的方式——无论是语言交流，还是身体行动，无论是与他人，还是与环境本身。</p>
<p>虽然我们大多数人并不会每天像埃拉托色尼那样发现新的真理，但我们几乎时时刻刻都以同样的方式在思考通过感官去理解这个复杂世界，并依托对物理与空间规律的直觉认知，使其变得可理解。</p>
<p>遗憾的是，当今的 AI 还无法以这样的方式思考。</p>
<p>过去几年确实取得了巨大进步。多模态大语言模型（MLLMs），在文本之外又引入了大量多媒体数据进行训练，初步具备了空间感知能力：</p>
<p>它们可以分析图像、回答与之相关的问题，甚至生成超写实的图像与短视频。与此同时，借助传感器与触觉技术的突破，最先进的机器人已经能在严格受限的环境中开始操控物体与工具。</p>
<p>然而，坦率地说，AI 的空间能力依然远未接近人类水平。其局限也显而易见：最先进的 MLLM 在估计距离、方向、大小等任务上，表现往往不比随机猜测好多少；它们无法 “心智旋转” 物体——即从新角度再现同一对象的形状；不会在迷宫中导航、识别捷径，或预测基本的物理规律；生成的视频虽然新奇炫目，却常在几秒钟后失去连贯性。</p>
<p>如今的顶级 AI 擅长阅读、写作、检索与模式识别，但当涉及对物理世界的表征或交互时，却存在根本性局限。</p>
<p>我们人类理解世界的方式是整体性的：不仅仅看到 “眼前的东西”，还理解它们在空间上的关系、在语义上的意义、以及在现实中的重要性。</p>
<p>而这种通过想象、推理、创造与交互来理解世界的能力，正是空间智能的力量。</p>
<p>缺乏它，AI 就与它所试图理解的物理现实脱节。它将无法真正安全地驾驶汽车、无法在家庭与医院中引导机器人、无法创造全新的沉浸式学习与娱乐体验、也无法加速材料科学与医学的发现。</p>
<p>哲学家维特根斯坦曾写道：“语言的边界就是我世界的边界”。我不是哲学家，但我知道，对 AI 而言，世界不止于语言。空间智能代表着超越语言的前沿。</p>
<p>它连接想象、感知与行动，为机器真正提升人类生活打开了新的可能：从医疗到创造力，从科学发现到日常辅助。</p>
<h2 data-id="heading-2">AI 的下一个十年：构建真正具备空间智能的机器</h2>
<p>那么，我们该如何打造拥有空间智能的 AI？</p>
<p>如何让模型具备：像埃拉托色尼那样的空间推理能力，像工业设计师那样的工程精度，像讲故事的人那样的创造性想象力，以及像应急救援人员那样与环境流畅互动的能力？</p>
<p>要实现这样的 AI，我们需要比 LLM 更具雄心的体系：世界模型（World Models）。</p>
<p>这是一种全新的生成式模型，其在理解、推理、生成与交互方面的能力，将超越当今 LLM 所能触及的极限。它能够在语义、物理、几何与动态层面上，理解并生成复杂的虚拟或真实世界。</p>
<p>这一领域尚处于萌芽阶段，现有方法从抽象推理模型到视频生成系统不等。</p>
<p>World Labs 成立于 2024 年初，正是基于这样一种信念：基础性方法仍在形成之中，而这将成为未来十年人工智能的决定性挑战。</p>
<p>在这个新兴领域中，最重要的是确立指导发展方向的核心原则。对于空间智能而言，我将 “世界模型” 定义为具备以下三项核心能力的系统：</p>
<p><strong>1、生成性（Generative）：世界模型能够生成具有感知、几何与物理一致性的世界</strong></p>
<p>要实现空间理解与推理，世界模型必须能够生成自身的模拟世界。</p>
<p>它应能在语义或感知指令的引导下，生成无限多样、变化丰富的虚拟世界，同时保持几何、物理与动态上的一致性，无论这些世界是现实的还是虚拟的。</p>
<p>研究界目前正在探索，这些世界应当以隐式（implicit）还是显式（explicit）的几何结构形式表示。</p>
<p>除了强大的潜在表征（latent representations）之外，我认为通用世界模型的输出还应当允许生成显式、可观测的世界状态，以便适应不同的应用场景。尤其重要的是，模型对当下世界的理解必须与其过去的状态保持连贯一致——理解当前，就是理解它是如何演化而来的。</p>
<p><strong>2、多模态（Multimodal）：世界模型在设计上就是多模态的</strong></p>
<p>正如人类与动物一样，世界模型应能处理多种形式的输入。在生成式 AI 领域中，这些输入被称为 “提示词（prompts）”。</p>
<p>面对不完整的信息——无论是图像、视频、深度图、文本指令、手势还是动作，世界模型都应能预测或生成尽可能完整的世界状态。</p>
<p>这要求模型既要以真实视觉的精度处理图像输入，又能以同样的灵活性理解语义性指令。</p>
<p>如此一来，无论是智能体还是人类，都能通过多样的输入形式与模型就 “世界” 进行交流， 并以多样的方式接收输出。</p>
<p><strong>3、交互性（Interactive）：世界模型能根据输入动作输出下一个状态</strong></p>
<p>最后，当动作（actions）和 / 或目标（goals）作为输入提示的一部分时，世界模型的输出必须包含世界的下一个状态。</p>
<p>这一状态可以是隐式的，也可以是显式的。当输入仅包含一个动作（有无目标皆可）时，世界模型应能生成与世界先前状态、预期目标状态（如有）、以及其语义意义、物理规律、动态行为相一致的输出。</p>
<p>随着空间智能世界模型在推理与生成能力上不断增强，我们可以想象，未来模型不仅能预测世界的下一个状态，还将能够基于该状态预测下一步行动。</p>
<p><strong>这一挑战的规模，超越了 AI 以往所面临的一切。</strong></p>
<p>语言是人类认知中纯粹生成的现象，而 “世界” 遵循的规则则复杂得多。</p>
<p>在地球上，例如：重力决定运动，原子结构决定光的颜色与亮度，无数物理定律约束着一切交互。</p>
<p>即使是最奇幻、最具创造性的世界，也由遵守物理与动态规律的空间对象与智能体构成。</p>
<p>要在模型中一致地协调这些——语义、几何、动力学与物理层面——需要全新的方法论。因为 “世界” 的维度远比语言这种一维的序列信号复杂得多。</p>
<p>要实现像人类一样具备普适空间智能的世界模型，必须跨越若干巨大的技术壁垒。</p>
<p>在 World Labs，我们的研究团队正致力于这一目标的基础性突破。</p>
<p>以下是我们当前研究的几个方向示例：</p>
<ul>
<li>
<p><strong>一种新的通用训练任务函数</strong>：在世界模型研究中，一个长期目标是定义一种像 LLM 中 “下一个 token 预测” 一样简洁优雅的通用任务函数。然而，世界模型输入与输出空间的复杂性使这一函数的设计更加困难。尽管仍有大量探索空间，但这一目标函数及其对应表征必须符合几何与物理规律，忠实体现世界模型在想象与现实之间的 “落地表征” 本质。</p>
</li>
<li>
<p><strong>大规模训练数据</strong>：训练世界模型所需的数据远比文本复杂。好消息是我们已经拥有了庞大的数据资源。互联网上规模宏大的图像与视频集合为训练提供了丰富的素材。挑战在于：如何让算法从二维图像或视频帧（RGB）中提取更深层次的空间信息。过去十年的研究揭示了语言模型中数据量与模型规模的 scaling law；对于世界模型，关键在于构建能够在相似规模上有效利用视觉数据的架构。此外，高质量的合成数据以及额外模态（如深度、触觉）的作用不可低估，它们在训练过程的关键阶段起到补充作用。未来的发展取决于更先进的传感系统、更稳健的信号提取算法、以及更强大的神经仿真方法。</p>
</li>
<li>
<p><strong>新的模型架构与表征学习</strong>：世界模型研究将不可避免地推动模型架构与学习算法的革新，特别是超越当下的多模态 LLM 与视频扩散模型（video diffusion）。这些模型通常将数据编码为一维或二维序列，使得简单的空间任务，例如在短视频中数清不同的椅子，或记住一小时前房间的样子变得异常困难。新的架构思路或许能改进这一点，例如具备 3D 或 4D 感知能力的 token 化、上下文与记忆机制。例如，在 World Labs，我们最近开发了一种基于帧的实时生成模型——RTFM（Real-Time Generative Frame-based Model）。它以空间为基础的帧（spatially-grounded frames）作为空间记忆形式，实现了高效实时生成的同时，保持了生成世界的持续性与一致性。</p>
</li>
</ul>
<p>显然，在完全释放空间智能的潜力之前，我们仍面临艰巨的挑战。但这项研究不仅仅是理论工作，它正成为新一代创造性与生产力工具的核心引擎。</p>
<p>在 World Labs 的进展令人鼓舞。我们最近向部分用户展示了 Marble 的早期版本——全球首个可通过多模态输入生成并保持一致性 3D 环境的世界模型，让用户与创作者能够探索、交互并在其中继续构建他们的创意世界。我们正全力以赴，努力尽快将其向公众开放。</p>
<p>Marble 只是我们的第一步。随着研究的加速，科研人员、工程师、用户与商业领袖们都开始意识到这一方向的巨大潜能。下一代世界模型将使机器在空间智能上达到全新的层次，这将开启 AI 迄今仍普遍缺乏的核心能力，并真正让人工智能进入理解与创造世界的时代。</p>
<h2 data-id="heading-3">用世界模型为人类构建更美好的世界</h2>
<p>人工智能的发展动机至关重要。作为推动现代 AI 时代到来的科学家之一，我的动机始终十分明确：AI 应当增强人类的能力，而非取而代之。</p>
<p>多年来，我一直致力于让 AI 的开发、部署与治理与人类需求保持一致。</p>
<p>当下关于 “技术乌托邦” 与“世界末日”的极端叙事比比皆是，但我依然持一种更务实的立场：AI 是由人开发、被人使用、并由人治理的。</p>
<p>它必须始终尊重人的自主性与尊严。它的 “魔力” 在于拓展我们的能力，让我们变得更具创造力、更紧密相连、更高效并更有成就感。</p>
<p>空间智能正体现了这一愿景——一种能赋能人类创造者、照护者、科学家与梦想家的 AI，使他们实现曾经不可能的目标。这一信念，正是我将空间智能视为 AI 下一个伟大前沿领域的根本原因。</p>
<p>空间智能的应用横跨不同的时间尺度。创作工具正在当下出现——World Labs 的 Marble 已经让创作者与讲故事的人能够亲手掌握这种能力。</p>
<p>机器人领域则代表着中期的雄心目标，我们正致力于完善感知与行动之间的闭环。而最具变革意义的科学应用可能需要更长时间，但它们将深刻地促进人类的福祉。</p>
<p>在所有时间线中，有几个领域的潜力尤其突出，足以重塑人类的能力。要实现这些潜力，需要集体努力远超任何一个团队或公司的能力范围。</p>
<p>它需要整个 AI 生态系统的参与：研究者、创新者、创业者、企业家，乃至政策制定者，共同朝着一个愿景努力。而这个愿景，值得我们追求。以下是未来的图景：</p>
<h4 data-id="heading-4">创造力：为叙事与沉浸体验注入超能力</h4>
<p>“创意，是智慧的乐趣。” 这是我最喜欢的爱因斯坦名言之一。</p>
<p>在人类发明文字之前，我们就会讲故事——把故事画在洞穴壁上，代代相传，并以共享的叙事建立文化。故事是人类理解世界、跨越时空连接彼此、探索 “人之为人” 的方式，也是我们在生活与爱中寻找意义的途径。</p>
<p>今天，空间智能有潜力彻底变革我们创作与体验叙事的方式，从娱乐到教育，从设计到建造，赋予它们更深远的影响力。</p>
<p>World Labs 的 Marble 平台 将前所未有的空间表达能力与编辑控制权交到电影人、游戏设计师、建筑师及各类讲述者手中，让他们无需传统 3D 设计软件的繁复流程，就能快速创造、迭代、探索完整的三维世界。创造的行为依然是人类的核心活动——AI 只是放大并加速创意实现的过程。这包括：</p>
<ul>
<li>
<p>多维叙事体验：电影人和游戏设计师可以利用 Marble 构建整个世界，不受预算或地理限制，探索传统制作流程中无法实现的场景与视角。随着媒介与娱乐的界限模糊化，我们正接近一种全新的互动体验形态——融合艺术、模拟与游戏的个性化世界，让任何人（而不仅仅是大型工作室）都能创造并进入自己的故事。</p>
</li>
<li>
<p>以设计讲述空间故事：几乎所有被制造的物品或建造的空间，都必须在物理实现之前经过虚拟 3D 设计——这一过程往往耗费大量时间与成本。借助空间智能模型，建筑师可以在数分钟内可视化并漫游尚不存在的建筑；工业或时装设计师可以即时将想象转化为形态，探索物体与人体及空间的交互。</p>
</li>
<li>
<p>全新的沉浸与互动体验：人类体验的最深层方式之一，就是创造意义的体验本身。在整个人类历史上，我们只共享一个三维世界：物理世界。直到近几十年，通过游戏与早期虚拟现实（VR），我们才得以初步窥见 “自造世界” 的可能。如今，空间智能结合 VR、XR（扩展现实）头显与沉浸式显示设备，将这种体验提升到前所未有的高度。未来，人们 “走进” 多维世界将如同打开一本书般自然。空间智能让造世界的权力从专业团队扩展到每一位拥有愿景的创作者、教育者与普通人。</p>
</li>
</ul>
<h4 data-id="heading-5">机器人：具身智能的实践</h4>
<p>从昆虫到人类，动物都依赖空间智能来理解、导航并与世界交互。机器人也不会例外。</p>
<p>自该领域诞生以来，“具备空间感知的机器” 就是人类的梦想，包括我在斯坦福研究实验室与学生、合作者共同进行的研究。正因如此，我对用 World Labs 构建的模型实现这一愿景感到异常兴奋。</p>
<ul>
<li><strong>通过世界模型扩展机器人学习：机器人的学习进步取决于可扩展的训练数据方案。要让机器人具备理解、推理、规划与交互的能力，它们需要覆盖极为庞大的状态空间。许多研究者认为，互联网数据、合成仿真数据与人类演示的真实采集三者结合，是实现可泛化机器人的关键。然而，与语言模型不同，如今机器人的训练数据极为稀缺。世界模型将在此发挥决定性作用。 随着其感知精度与计算效率的提高，世界模型生成的输出将迅速缩小模拟与现实之间的差距，从而让机器人能在数不清的状态、互动与环境中学习。</strong></li>
<li><strong>人机协作伙伴：无论是实验室中协助科学家的研究助理机器人，还是陪伴独居老人的家用助理，机器人都可以扩展劳动力并提升社会生产力。但要做到这一点，机器人必须具备空间智能——能感知、推理、规划、行动，并且最重要的是：保持对人类目标与行为的同理一致。例如，实验室机器人可以替代科学家完成仪器操作，让人专注于需要推理的部分；家庭助理机器人则可以帮助老人做饭，而不剥夺他们的乐趣与自主性。真正具备空间智能的世界模型能够预测下一个状态，甚至推断与之匹配的下一步行动，是实现这一愿景的关键。</strong></li>
<li><strong>扩展的具身形态：人形机器人只是我们为自身世界打造的一个形式。真正的创新红利将来自更加多样的设计：输送药物的纳米机器人、穿行狭窄空间的软体机器人、以及为深海或外太空而造的机器。无论形态如何，未来的空间智能模型都必须将环境与机器人自身的感知、运动一体化建模。但开发这些机器人面临的关键挑战在于：缺乏多样化形态的训练数据。世界模型将在这一过程中发挥关键作用——为仿真数据、训练环境与评测任务提供支持。</strong></li>
</ul>
<h2 data-id="heading-6">更长远的地平线：科学、医疗与教育</h2>
<p>除了创造性与机器人应用外，“空间智能” 的深远影响还将延伸至更多能够增强人类能力、拯救生命、加速发现的领域。以下我将重点介绍三个具有深刻变</p>
<p>革潜力的方向。当然，空间智能的应用远不止于此，它的影响范围几乎遍及所有行业。</p>
<p>在<strong>科学研究</strong>中，具备空间智能的系统可以模拟实验、并行验证假设，并探索人类无法亲临的环境——从深海到遥远的行星。这项技术有望彻底变革气候科学、材料研究等领域的计算建模方式。通过将多维度模拟与真实世界数据采集相结合，这些工具能显著降低计算壁垒，拓展每一个实验室可观察与理解的边界。</p>
<p>在<strong>医疗领域</strong>，空间智能将重塑从实验室到病床的全过程。在斯坦福，我与学生及合作者多年来一直与医院、养老机构以及居家患者合作。这些经验让我深信空间智能在医疗领域的变革潜力。AI 可以通过多维建模加速药物研发，通过辅助放射科医生识别影像中的模式来提升诊断质量；它还可支持环境感知式监护系统，在不取代人类关怀的前提下，为患者与护理人员提供持续支持。更不用说机器人在不同场景中帮助医护人员和患者的巨大潜力。</p>
<p>在<strong>教育领域</strong>，空间智能能够实现沉浸式学习，让抽象或复杂的概念变得可感知，并创造出符合人类大脑与身体学习方式的迭代体验。在 AI 时代，更快速、更高效的学习与技能重塑对于儿童与成人都至关重要。学生可以以多维方式探索细胞机器或 “亲历” 历史事件；教师可借助互动环境进行个性化教学；而外科医生、工程师等专业人士则能在高度逼真的仿真环境中安全地练习复杂技能。</p>
<p>跨越这些领域，可能性是无限的，但目标始终如一：让 AI 成为增强人类专长、加速人类发现、放大人类关怀的力量——而不是取代那份属于人的判断力、创造力与共情力。</p>
<h2 data-id="heading-7">结语</h2>
<p>过去十年间，人工智能已成为全球现象，在科技、经济乃至地缘政治层面都带来了转折。</p>
<p>然而，作为一名研究者、教育者和创业者，最令我振奋的仍是图灵七十五年前那道问题背后的精神。我依然与他共享那份好奇与惊叹——正是这份好奇，让我每天都为探索空间智能的挑战而充满动力。</p>
<p>人类历史上第一次，我们正站在这样一个时刻：有望构建出与物理世界高度契合的机器，让它们成为我们应对重大挑战的真正伙伴。</p>
<p>无论是加速疾病研究、革新故事叙述方式，还是在病痛、受伤或衰老的脆弱时刻给予支持，我们都正处于一场技术变革的门槛上，它将提升我们最珍视的生命价值。</p>
<p>这是一个关于更深刻、更丰富、更有力量的生活的愿景。</p>
<p>距自然在原始动物中首次显现空间智能的曙光已近五亿年，而我们有幸成为这一代技术创造者——可能即将赋予机器同样能力的人类，也有幸能将此能力用于全人类的福祉。</p>
<p>若没有空间智能，我们关于 “真正智能机器” 的梦想将永远不完整。</p>
<p>这场探索，是我的 “北极星”。邀请你一同追寻它。</p>
<p><em>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdrfeifei.substack.com%2Fp%2Ffrom-words-to-worlds-spatial-intelligence" target="_blank" title="https://drfeifei.substack.com/p/from-words-to-worlds-spatial-intelligence" ref="nofollow noopener noreferrer">drfeifei.substack.com/p/from-word…</a></em></p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从“给答案”到“教动脑”：这届小学生被AI教会主动思考]]></title>    <link>https://juejin.cn/post/7571068689765793832</link>    <guid>https://juejin.cn/post/7571068689765793832</guid>    <pubDate>2025-11-11T06:35:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571068689765793832" data-draft-id="7571156741396660239" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从“给答案”到“教动脑”：这届小学生被AI教会主动思考"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-11T06:35:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从“给答案”到“教动脑”：这届小学生被AI教会主动思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:35:22.000Z" title="Tue Nov 11 2025 06:35:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“妈，这题怎么做？”</p>
<p>这个在有娃家庭中再熟悉不过的声音，如今正迎来 AI 给出的全新答案。</p>
<p>眼下，各种学习 App、智能学习硬件层出不穷——</p>
<p>ChatGPT 上线了学习模式；谷歌推出了 “Learn Your Way” 教育工具；美国得州有私立学校还要求学生每天花两小时和 AI 助手一起学习……</p>
<p>AI + 教育的浪潮，确实已经汹涌而来。</p>
<p>然而，火热浪潮之下，问题也在显现：</p>
<p>当前大多数 AI 教育产品仍停留在授人以鱼的层面。它们的本质是效率工具 ，追求 “<strong>快</strong>”——快速响应、快速批改、快速给出标准答案，但没有解决 “会” 和“懂”的核心痛点。</p>
<p>学生遇到难题，AI 直接给出答案，看似解决了问题，实则掩盖了思维过程的缺失。久而久之，学生容易陷入一听就会、一做就废和盲目刷题的循环。</p>
<p>那么，授人以渔的 AI 教育应该是什么样子？</p>
<h2 data-id="heading-0">超拟人交互 AI 老师</h2>
<p>行业的演进，比我们感知到的可能更快。</p>
<p>最近教育圈就出现了这么一款大火的 AI 产品，它已经从被动应答的 “工具”，进化成了能主动引导、完成教学闭环的 “师者”。</p>
<p>它就是学而思学习机 T4 所搭载的 “小思 AI1 对 1”。</p>
<p>基于多模态感知能力，它能够同时看懂纸上笔迹、听懂学生表达，并能以自然语言进行实时讲解与引导，形成更接近真人教学的互动体验。</p>
<p>话不多说，一起来看看这位 AI 老师究竟有何本领。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a84ca95a827495598134e3a92a37e1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=jlenWEJkZZP420BVCK%2BJCRXN0ZA%3D" alt="" loading="lazy"/></p>
<p>只需轻轻拍拍 “头”，即可唤醒。</p>
<p>当孩子遇到错题或是不会的问题，把试卷放在它面前，说一句 “第 XX 题我不会做”，或直接指着题目说 “这题我不会”，小思就能立即听懂 / 看见，精准识别题目并开始讲解。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ce7077f5a634f28aa0c84efe8923a26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=xLDhscIOcwzvDuA9JZN7PdV4VJU%3D" alt="" loading="lazy"/></p>
<p>划重点，讲解过程不再是直接给出解析或是答案，而是真的会像 1 对 1 真人辅导老师一样，一步步引导孩子动脑思考，带孩子自主完成解题。</p>
<p><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">视频详情</a></p>
<p>可以看到，小思在讲解时用到了一种新型方式——纸屏互动。</p>
<p>它会先让孩子拿出草稿纸，然后引导他们将每个解题步骤亲手写在纸上。</p>
<p>每写一步，小思都会实时识别并批改；若有错误，会立刻指出问题所在，耐心讲解原因与正确思路。</p>
<p>在讲解过程中，小思能做到一题多解，会根据孩子所处的学段，选用相应的解题方法。它还会在题目上圈划关键信息，引起孩子注意，这与学校课堂中老师强调的 “细读题目、圈出重点” 如出一辙。</p>
<p>即便孩子书写不够工整，或在纸上 “东一句、西一句”，又或是草稿纸上原本已有字迹，小思依然能够精准分辨出刚写下的步骤，理解上下文逻辑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2996b0d1b584d3ba5931ce74565a990~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=i7xklT6XbFq%2FscdRuH7UTitVe28%3D" alt="" loading="lazy"/></p>
<p>当整道题讲解完成后，小思还会对题目进行整体回顾与重点总结，帮助孩子真正理解这一类题型的解题思路与方法，从而实现真正意义上的智能化辅导闭环。</p>
<p>这种方式彻底改变了学生与学习机的互动方式，从单向的看和听，转变为动手写、实时改、双向互动的沉浸式学习。它不再是把答案塞给学生，而是把思考的过程还给了学生。</p>
<p>而这位 AI 老师的能力还远不止于此。</p>
<p>上个月，特斯拉前 AI 总监、OpenAI 创始成员、现在正在全职搞教育的 AI 大神 Andrej Karpathy 在一次专访中提到，他们 “想做的是一种真正的导师体验”。</p>
<p>他以自己学习韩语的过程为例：最开始是自学；后来报了一个十几人的小班；最后换成了 1 对 1 的导师辅导。他发现，好的导师能迅速判断他的知识水平，提出恰到好处的问题。</p>
<p>Karpathy 认为，当下即便是非常优秀的 LLM 也做不到这一点，而好的导师却可以。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f5b118285464e8f907a84f17e885551~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=qIAy%2F7LXKaFTe2kMODSUCAuIIBU%3D" alt="" loading="lazy"/></p>
<p>就这点来看，只能说，现在咱国内的 AI 学习机已经能做到了。</p>
<p>小思在 1 对 1 辅导时，会采用个性化教学方案。</p>
<p>如果孩子在解题中持续出错，小思会灵活地转换思路、变换提问角度，从不同侧面试图撬动孩子的思维。多次引导仍未奏效，它会判断学生认知负荷已达到临界点，主动调整教学节奏，确保核心概念能得以传递，教学流程能够顺利走完。</p>
<p>它还能在孩子学习过程中时刻关注其行为并给予反馈，比如提醒孩子坐姿要端正、专心听讲、认真做题；通过情绪感知技术，能够捕捉孩子的情绪变化，在恰当的时候送上鼓励或祝贺。</p>
<p>小思还会将孩子的情绪总结生成家长报告，推送到家长的手机上，让家长可以关注到孩子的兴趣、情绪、成长变化。</p>
<p>另外，当孩子和小思一起学习时，它会自动构建专属每个孩子的动态学情图谱，并基于行为模型生成个性化学习规划，让教学从 “千人一面” 走向“千人千面”。</p>
<p>孩子在学校完成的习题或试卷，也能通过拍照上传，让小思持续跟踪学情，进行动态诊断与精准反馈。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f51d6dba2a54962bec966520876ae56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=B2DaRArw3lxQnSN4Ak%2BfQH8dJOg%3D" alt="" loading="lazy"/></p>
<p>以备考为例，这段时间学生往往需要做大量试卷刷题。而当你将试卷交给 “小思”，它就能根据学习数据，自动筛选出学生的薄弱环节，优先呈现易错题型与未掌握题型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec3b46be47f2469ba8d16d279fc1305c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=OPbxgqQLAbfk94UlZFU6%2BsxtHNU%3D" alt="" loading="lazy"/></p>
<p>总结来说，学生课后学习的三个关键环节——练习后用 AI 批改、错题用 AI 讲解、AI 根据学习画像进行推荐——在学而思学习机 T4 的 “小思 AI1 对 1” 中，已经形成了一个完整的环环相扣的学习体系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca09618768ba4f329cb182a3e17d44b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=hBhkIJkXuFCnhyCEiukkMEx86mY%3D" alt="" loading="lazy"/></p>
<p>据学而思相关产品负责人介绍：</p>
<p>小思 AI1 对 1 不仅是行业领先推出的软硬一体超拟人交互 AI 老师，也是学习机行业领先多模态交互智能体。搭载了 “小思 AI1 对 1” 学而思学习机 T4，更是行业内少有的能做到纸屏互动、分步骤批改加讲解的学习机。</p>
<p>而学而思能够率先做到这些，并非偶然。</p>
<h2 data-id="heading-1">软硬一体原生派，自研主导</h2>
<p>这背后，是一条由软硬一体与自研主导共同构筑的、难以被快速复制的 AI 原生派护城河。</p>
<p>当前，在 AI + 教育方向上，业内大致形成了三种主要技术路径：</p>
<ul>
<li>
<p>以大模型为核心的开放平台服务，聚焦模型能力本身，不直接落地面向 C 端的教育产品；</p>
</li>
<li>
<p>将 AI 能力嵌入教学 App，用于题库、批改、口语陪练等功能模块；</p>
</li>
<li>
<p>软硬一体化，通过自研模型与专属硬件深度融合，构建原生 AI 老师。</p>
</li>
</ul>
<p>学而思在第三条路径上布局较早，团队认为：</p>
<blockquote>
<p>尽管强大的云端大模型是 AI 老师的 “智慧核心”，但要实现真正媲美甚至超越真人教学的原生 AI 老师体验——即<strong>具备低延迟、多模态、沉浸式交互和深度个性化能力的教学形态</strong>——软硬一体化的实现路径是必然选择。</p>
</blockquote>
<p>基于这一判断，学而思最新自研的 T 系列学习机成为 AI 老师的物理载体。前置的高清摄像头能看清学生在纸上的每一处演算笔迹；内置的传感器与算法则构成了其视觉神经系统，使之能实现低延迟的纸屏同步与多模态交互。</p>
<p>另外，AI 老师的能力边界，包含两个维度，一方面在于解题准确性，另一方面在于讲题能力。前者是客观过程，讲求逻辑与答案的正确；后者则是主观过程，体现教学设计与启发式讲解的水平。</p>
<p>首先，在解题环节，学而思依托自研的 “九章大模型”（MathGPT），承担全学科解题、应用题批改、作文批改、AI 分步讲解等任务。</p>
<p>该模型在中国信通院组织的首轮教育大模型评估中，通过了教育大模型 5 级与教育智能体 4 + 级双项最高级别认证，能力获国家级权威背书。</p>
<p>在此基础上，学而思 AI 老师采用 “双模型” 架构，引入业内领先通用大模型 DeepSeek 以增强开放对话与逻辑推理能力。</p>
<p>当下这类 “垂直模型 + 通用模型” 协同方案也正在成为教育 AI 的新趋势——垂直模型保障专业精度，通用模型扩展交互与逻辑推理能力。</p>
<p>其次，在讲题环节，AI 的表现取决于其是否具备教学思维。</p>
<p>据悉，学而思将二十余年教研团队积累的授课经验、解题策略与课堂互动逻辑数据，系统性地 “注入” 到大模型中，使 AI 逐步掌握教学思维与启发逻辑，具备 “如何教” 的能力，而不仅仅是“如何答”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07392e0b0a674e8ebbd8bcd26e221e18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=w%2BzN46H7l99iu65bbrIIHNpPan0%3D" alt="" loading="lazy"/></p>
<p>最后，教育场景对 AI 系统的安全性要求尤为严格。</p>
<p>学而思贯穿全链路的自研体系，正为安全与可靠性提供了保障。</p>
<p>学而思团队介绍道，在内容安全层面，学而思 AI 老师出的题目的都有真人审核，在特定关键环节甚至设有 “三轮审核” 机制，并由集团级安全中台提供最终保障。在数据与隐私安全上，学习机内部建立了数据防控与权限管理机制。</p>
<p>自研技术栈还能精准约束 AI 行为，比如题目讲解时以标准答案和解析规范模型，自研意图理解模块搭配可插拔调度的大模型保障专业准确。从在线实时拦截到离线全量复审，安全机制覆盖全流程，保障端到端安全。</p>
<p>综合来看，业内 AI 教学系统的演进，正在经历从 “答题工具” 到“AI 学伴”再到 “AI 老师” 的过程。</p>
<h2 data-id="heading-2">通往 “完全体” 之路</h2>
<p>当 AI 技术浪潮席卷各行各业，教育领域也正迎来一场深层变革。这场变革早已跳出单一教学产品的功能修补，而是向着重构教学模式、拓展学习边界的方向突围。</p>
<p>整个行业都在探索，AI 深度融入教育场景，究竟会带来哪些颠覆性改变？而能真正适配教育本质的 AI 老师，又将是什么样的形态？</p>
<p>在今年的云栖大会上，学而思 CTO 田密对标自动驾驶 L1-L5 分级，提出了 AI 老师的 L1-L5。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cc232a25a7642c6bb05150f0058d62f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=Jqj19K1xnwBbkNb%2BqtyTJDxtJDY%3D" alt="" loading="lazy"/></p>
<p>其核心衡量标准颇为直接：AI 能在多大程度上替代传统书桌旁的课外辅导角色。</p>
<p>L5 即实现完全取代真人辅导的 “AI 托管”。</p>
<p>这不仅是学而思的技术路线图，某种程度上也体现出整个 AI 教育赛道可能的技术终局。</p>
<p>按照这一标准衡量，学而思学习机中的 AI 老师能力目前已经一只脚迈入了 L3 阶段。</p>
<p>具体表现为，在题目讲解这一核心场景中，系统已经实现了多模态交互 + 个性化引导，同时将引导 + 实时批改与自适应讲解等能力串联，形成相对完整的系统化学习链条。</p>
<p>实际上，小思全学习机可以自由调度的 AI 能力，有七十多种。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68b5756017c34d48b44b7aec310cc36a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447722&amp;x-signature=ormAyaJB7xkjWmlyDkOOMfIGIxo%3D" alt="" loading="lazy"/></p>
<p>业内有观点认为，现阶段 AI 老师要想做得更好，得在三个方面持续推进：</p>
<ul>
<li>
<p>教学能力：持续优化 AI 老师本身的批改、讲题、诊断规划等能力。</p>
</li>
<li>
<p>认知理解能力：通过汇聚更多学习数据，构建更清晰的数字化学习系统，实现对孩子的深度认知。</p>
</li>
<li>
<p>交互能力：持续推进多模态迭代，实现更自然的拟人交互。</p>
</li>
</ul>
<p>长期来看，学习机有望突破现有形态，向具备教育感知与情感交互的陪伴式机器人演进。</p>
<p>学生是有血有肉的人，教育的目的是为了激发和引导他们的自我发展之路。学而思的实践提供了一种人机协同的引导式教学新思路。当 AI 承担起知识传授中标准化的工作，便为真人教师留出了更多进行情感关怀、创造力激发和人格塑造的空间。</p>
<p>尽管当下的技术发展与完全体 AI 老师仍有距离，但行业沿着多模态个性化的技术链条持续突破，或许正在接近古希腊哲学家苏格拉底曾提出的理想——</p>
<p>“教育不是灌输，而是点燃火焰”。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[李飞飞万字长文爆了！定义 AI 下一个十年]]></title>    <link>https://juejin.cn/post/7571067260053405722</link>    <guid>https://juejin.cn/post/7571067260053405722</guid>    <pubDate>2025-11-11T06:56:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571067260053405722" data-draft-id="7571051830710386738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="李飞飞万字长文爆了！定义 AI 下一个十年"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-11T06:56:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            李飞飞万字长文爆了！定义 AI 下一个十年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:56:42.000Z" title="Tue Nov 11 2025 06:56:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读30分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/787b168bbf994bc9bc8fe95ba127b7ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=LHmxaCcpFDj0fWjStEVuvjybgLI%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】AI 的下一个十年，是构建空间智能的机器。李飞飞最新硬核长文，揭秘了空间智能「世界模型」核心框架和三大核心支柱。」</strong></h5>
<p>AI 的下一个前沿，是「空间智能」。</p>
<p>它是一项能让「看见」升华为「推理」，让「感知」蜕变为「行动」，让「想象」落地为「创造」的技术。</p>
<p>但「空间智能」究竟是什么？为何如此重要？该如何构建它？又该如何应用它？</p>
<p>今天，李飞飞撰万字长文分享了自己关于构建和使用「世界模型」以解锁空间智能的思考。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53787ed7f2c94c409b54871abd824965~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=zuN%2FpXnjjiFvF0Pog1tZ%2B884fiQ%3D" alt="" loading="lazy"/></p>
<p>新文章中，她为真正具备空间智能的「世界模型」所需达成的目标勾勒了一个框架。</p>
<p>具体来说，构建这样的 AI 必须具备三大核心能力：</p>
<p>让 AI 拥有故事讲述家的想象力去创造，</p>
<p>拥有急救人员般的敏捷性去导航，</p>
<p>并拥有科学家的严谨去推理空间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfdd903077454cbab446d9a771c2d62b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=aHmj3fuin0OSEOyuUgKFfihu%2F2Y%3D" alt="" loading="lazy"/></p>
<p>李飞飞与 LeCun 共识的一点是，「世界模型」是解锁空间智能的核心。</p>
<p>它必须能生成遵循物理定律、在空间上保持一致的世界，能处理从图像到动作的多模态输入，并能预测这些世界将如何演变或与之互动。</p>
<p>空间智能的应用疆域，正沿着一条清晰路径演进。</p>
<p>当下，它正赋能创意，World Labs Marble 项目已经将这些能力交到了创作者和故事讲述者的手中。</p>
<p>下一步，它将驾驭物理世界，机器人实现感知与行动之间的闭环。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b5cd939fb414854adfc32d32706931f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=bpqVqiafRO8r54Ffar7Dwljqx%2BE%3D" alt="" loading="lazy"/></p>
<p>而最具变革性的科学应用，虽然需要更长时间，但有望对人类福祉产生深远影响。</p>
<p>哲学家维特根斯坦曾写道：「我语言的极限，意味着我世界的极限。」</p>
<p>李飞飞表示，「我不是哲学家，但我深知，至少对 AI 而言，世界远不止于文字」。</p>
<p>空间智能代表了超越语言的前沿——它是一种将想象、感知与行动融会贯通的能力，为机器真正提升人类生活开启了无限可能，从医疗健康到创意挥洒，从科学探索到日常辅助。</p>
<p>众多网友点评，这是李飞飞一篇非常重要的文章，空间智能必读之作！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d952b60fda34290b81704174f33e976~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=nS3L0QbBABB8uY1FGq1nY%2Fqzb%2BI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/829f115810a1456c8e752addcd2c96c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=3KM4OTQNtkEN%2FLwH83eRxukPOUY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c1a336c69724f4b8627c100a5716194~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=PlvEaZXiGe3rmmV1H%2B2XifLmiwg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4023768723f745d8b60d23042ff8dc29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=HsjDipxBuWha6WwBORrm9mYbJac%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b74535841647441fba71e4d60e0b065d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=cbQYNrQWCFiern%2BSigVpJpBhdr8%3D" alt="" loading="lazy"/></p>
<p>上下滑动查看</p>
<p>以下是全文翻译，一起来拜读下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44a149c8e6ed44cbb4952a69c4cb9ab6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=f6Kg8Uu3IJ%2B2PUEyt6IGww%2B4xNc%3D" alt="" loading="lazy"/></p>
<p><strong>「从语言到世界：空间智能是 AI 的下一个前沿」</strong></p>
<p>1950 年，当计算还只是自动化算术和简单逻辑的代名词时，阿兰 · 图灵提出了一个至今仍振聋发聩的问题：机器能否思考？能洞见他所预见的一切，需要非凡的想象力：智能有朝一日或可后天构建，而非与生俱来。</p>
<p>这一洞见，后来开启了一场名为「人工智能」（AI）的不懈科学探索。</p>
<p>在我投身 AI 领域的第二十五个年头，图灵的远见卓识依然激励着我。但我们离这个目标还有多近？答案并非一言以蔽之。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21d7e8566db54f228e9b01be34e5f734~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=TTHYDZ%2BlQ5jA4%2Fa3EWbXnd%2FStac%3D" alt="" loading="lazy"/></p>
<p>如今，以大语言模型（LLM）为代表的顶尖 AI 技术已开始改变我们获取和运用抽象知识的方式。</p>
<p>然而，它们仍是黑暗中的文字大师；能言善辩却缺乏经验，知识渊博却脱离现实的根基。</p>
<p>空间智能将改变我们创造以及与真实和虚拟世界互动的方式——为故事叙述、创意、机器人技术、科学发现等领域带来革命性的变革。这，就是 AI 的下一个前沿。</p>
<p>对视觉与空间智能的追求，是我踏入该领域以来始终指引我前行的「北极星」。</p>
<p>正因如此，我花费数年时间构建了 ImageNet——首个大规模视觉学习与基准测试数据集，它与神经网络算法、图形处理器（GPU）等现代计算设备一道，成为催生现代 AI 的三大关键基石之一。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb008ef13c0f4511936e2c4dd550388b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=I7QFj1ZVqoO6ugm%2BS9qy0u5Y7ks%3D" alt="" loading="lazy"/></p>
<p>正因如此，我在斯坦福大学的学术实验室在过去十年里，始终致力于将计算机视觉与机器人学习相结合。</p>
<p>也正因如此，一年多前，我与联合创始人 Justin Johnson、Christoph Lassner、Ben Mildenhall 共同创立了 World Labs：旨在首次将这一可能性淋漓尽致地变为现实。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d752adca59a4be6b50f3bea797f6767~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=EFu%2BFVezeBeYYSpmR3Vp9kLtPMI%3D" alt="" loading="lazy"/></p>
<p>World Labs 创始人团队，左起依次为 Ben Mildenhall、Justin Johnson、Christoph Lassner 和李飞飞</p>
<p>在本文中，我将阐释何为空间智能、其重要性何在，以及我们如何构建能够解锁它的「世界模型」——其深远影响将重塑创意、具身智能与人类的进步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e65078eb6a8240e0a6c52b0a2f5c1316~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=rBaPXZYq2vAWjqFDjoveLrvVIMo%3D" alt="" loading="lazy"/></p>
<p><strong>「空间智能：人类认知的基石」</strong></p>
<p>人工智能的发展从未如此激动人心。像大语言模型这样的生成式 AI 已经从实验室走向日常生活，成为数十亿人创意、生产力和沟通的工具。</p>
<p>它们展现了曾被认为遥不可及的能力，能轻松生成连贯的文本、浩如烟海的代码、逼真的图像，乃至短视频片段。AI 是否会改变世界已不再是疑问。</p>
<p>无论以何种合理的标准衡量，它都已然做到了。</p>
<p>然而，仍有太多领域是我们力所不及的。自主机器人的愿景虽引人入胜，却仍停留在理论层面，远未成为未来学家们长期许诺的日常必需品。</p>
<p>在疾病治疗、新材料发现和粒子物理学等领域实现研究进程大飞跃的梦想，在很大程度上仍未实现。</p>
<p>而 AI 真正理解并赋能人类创作者的承诺——无论是帮助学生理解分子化学的复杂概念，协助建筑师构想空间，支持电影制作人构建世界，还是为任何寻求完全沉浸式虚拟体验的人提供支持——也依然遥不可及。</p>
<p>要理解为何这些能力仍难以实现，我们需要审视空间智能的演化历程，以及它如何塑造我们对世界的认知。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73f595c679dd4d87b25ed03940b320d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=X2lqHVlT1AvSAHP4GgOE60PDKrs%3D" alt="" loading="lazy"/></p>
<p>视觉长久以来都是人类智能的基石，但其力量源于某种更为根本的能力。远在动物学会筑巢、哺育后代、用语言交流或建立文明之前，感知这一简单的行为就已悄然点燃了通往智能的进化火花。</p>
<p>这种从外部世界（无论是一缕微光还是一丝触感）收集信息的看似孤立的能力，在感知与生存之间架起了一座桥梁，并随着代代繁衍而愈发坚固和精巧。层层叠叠的神经元从这座桥梁上生长出来，形成了能够解读世界并协调生物体与环境互动的神经系统。</p>
<p>因此，许多科学家推断，感知与行动的循环成为驱动智能进化的核心动力，也是自然界创造出我们人类——这一集感知、学习、思考与行动于一体的终极造物——的根基。</p>
<p>空间智能在定义我们如何与物理世界互动方面扮演着至关重要的角色。</p>
<p>每一天，我们都依赖它来完成最平凡的举动：通过想象保险杠与路缘之间不断缩小的间隙来停放汽车，接住抛过房间的一串钥匙，在拥挤的人行道上穿行而避免碰撞，或是在睡眼惺忪中不看一眼便将咖啡倒入杯中。</p>
<p>在更极端的情况下，消防员在浓烟弥漫、摇摇欲坠的建筑中穿行，对结构的稳定性和自身的生存在瞬间做出判断，并通过手势、肢体语言和一种无可替代的职业直觉进行交流。</p>
<p>而婴幼儿则在学会说话前的整段岁月里，通过与环境的嬉戏互动来认知世界。所有这一切都发生得如此直观、自然——这是机器尚未能企及的自如与娴熟。</p>
<p>空间智能同样是我们想象力与创造力的基石。故事讲述者在脑海中创造出异常丰富的世界，并利用从古老的洞穴壁画到现代电影，再到沉浸式视频游戏等多种视觉媒介，将这些世界呈现给他人。</p>
<p>无论是孩童在沙滩上堆砌沙堡，还是在电脑上玩《我的世界》，基于空间的想象力构成了真实或虚拟世界中互动体验的基础。在众多行业应用中，对物体、场景和动态交互环境的模拟，为从工业设计到数字孪生，再到机器人训练等无数关键商业用例提供了动力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f936b89d96a5484e9e563dff308532fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=CPalbwpPFNCdbuKXPfod1KJHWtY%3D" alt="" loading="lazy"/></p>
<p>历史上充满了由空间智能扮演核心角色的、定义文明进程的时刻。</p>
<p>在古希腊，埃拉托色尼将光影转化为几何学——在太阳直射赛伊尼城的同一时刻，于亚历山大港测得 7 度的夹角——从而计算出地球的周长。</p>
<p>哈格里夫斯的「珍妮纺纱机」凭借一个空间洞见彻底改变了纺织业：将多个纺锤并排置于同一框架内，使得一名工人能同时纺织多根纱线，生产效率提升了八倍。</p>
<p>沃森和克里克通过亲手搭建 3D 分子模型发现了 DNA 的结构，他们不断摆弄金属板和金属丝，直至碱基对的空间排列「咔哒」一声完美契合。</p>
<p>在每一个案例中，当科学家和发明家需要操控物体、构想结构、推理物理空间时，空间智能都推动了文明的进步——而这些，都非文字所能单独承载。</p>
<p>空间智能是我们认知赖以构建的基石。无论我们是被动观察还是主动创造，它都在发挥作用。它驱动着我们的推理与规划，即便是面对最抽象的议题。</p>
<p>它对于我们互动的方式——无论是口头还是肢体，与同伴还是与环境本身——都至关重要。</p>
<p>虽然我们大多数人并非每天都能像埃拉托色尼那样揭示新的宇宙真理，但我们日常的思考方式与他并无二致——通过感官感知复杂的世界，再利用一种对物理、空间运作方式的直观理解来赋予其意义。</p>
<p>不幸的是，今天的 AI 还不能这样思考。</p>
<p>过去几年确实取得了巨大进步。多模态大语言模型（MLLM）除了文本数据外，还用大量的多媒体数据进行训练，引入了一些基本的空间意识，今天的 AI 可以分析图片、回答关于图片的问题，并生成超逼真的图像和短视频。</p>
<p>通过传感器和触觉技术的突破，我们最先进的机器人可以在高度受限的环境中开始操纵物体和工具。</p>
<p>然而，坦率的真相是，AI 的空间能力仍远未达到人类水平，其局限性很快便会暴露无遗。</p>
<p>在估算距离、方向和尺寸，或通过从新角度生成图像来进行物体的「心理旋转」等任务上，最先进的 MLLM 模型的表现鲜有超过随机猜测的。它们无法走出迷宫、识别捷径或预测基本的物理现象。AI 生成的视频——尽管初露锋芒，且的确酷炫——通常在几秒钟后便会失去连贯性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b340585e1e4944e6abfcad97ef8d36ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=recFCQrFTmWApvhn%2FYFdE%2F80rnU%3D" alt="" loading="lazy"/></p>
<p>虽然当前最先进的 AI 在阅读、写作、研究和数据模式识别方面表现出色，但这些模型在表征或与物理世界互动时，却存在根本性的局限。</p>
<p>我们对世界的看法是整体性的——不仅仅是眼前所见，还包括万物在空间上的相互关联、其意义以及其重要性。通过想象、推理、创造和互动——而不仅是描述——来理解这一切，正是空间智能的力量所在。</p>
<p>若无此能力，AI 便与它试图理解的物理现实脱节。它将无法有效地驾驶我们的汽车，引导家中的机器人或医院的护理机器人，也无法为学习和娱乐开启全新的沉浸式互动体验，更无法加速材料科学和医学领域的探索发现。</p>
<p>哲学家维特根斯坦曾写道：「我语言的极限，意味着我世界的极限。」我不是哲学家，但我深知，至少对 AI 而言，世界远不止于文字。</p>
<p>空间智能代表了超越语言的前沿——它是一种将想象、感知与行动融会贯通的能力，为机器真正提升人类生活开启了无限可能，从医疗健康到创意挥洒，从科学探索到日常辅助。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a6fe151b8d544e5a3921fb045de9f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=9cR53sYM1liCrUbbQHH0B3CvVZY%3D" alt="" loading="lazy"/></p>
<p><strong>「AI 的下一个十年：」</strong></p>
<p><strong>「构建真正具备空间智能的机器」</strong></p>
<p>那么，我们该如何构建具备空间智能的 AI？</p>
<p>如何才能打造出能够像埃拉托色尼一样洞察深远、像工业设计师一样精雕细琢、像故事讲述家一样天马行空，并像急救人员一样敏捷自如地与环境互动的模型？</p>
<p>构建具备空间智能的 AI 需要比大语言模型更为宏大的构想：<strong>「世界模型。」</strong></p>
<p>这是一种新型的生成模型，其理解、推理、生成以及与语义、物理、几何和动态上都极为复杂的虚拟或真实世界进行互动的能力，远非今日的 LLM 所能企及。</p>
<p>不过，这一领域尚处萌芽阶段，当前方法涵盖了从抽象推理模型到视频生成系统的各种探索。</p>
<p>World Labs 正是基于这一信念于 2024 年初创立的：基础方法尚在建立之中，而这将成为未来十年的决定性挑战。</p>
<p>在这个新兴领域，最重要的是确立指导发展的基本原则。对于空间智能，我通过三大核心能力来定义世界模型：</p>
<p><strong>「1. 生成式：世界模型能生成在感知、几何和物理层面保持一致的世界」</strong></p>
<p>能解锁空间理解与推理能力的世界模型，也必须能生成属于自己的模拟世界。</p>
<p>它们必须能够生成无穷无尽、千变万化的模拟世界，这些世界遵循语义或感知指令，同时在几何、物理和动态层面保持一致性——无论其表征的是真实空间还是虚拟空间。</p>
<p>研究界正在积极探索，这些世界固有的几何结构应该被隐式表征还是显式表征。</p>
<p>此外，我相信，除了强大的潜在表征，一个通用的世界模型的输出还必须能为众多不同的用例生成一个显式的、可观察的世界状态。</p>
<p>尤其重要的是，它对当前状态的理解必须与其过去——即导致当前状态的先前世界状态——连贯地联系在一起。</p>
<p><strong>「2. 多模态：世界模型在设计上是多模态的」</strong></p>
<p>正如动物与人类一样，世界模型应该能够处理多种形式的输入——在生成式 AI 领域，这被称为「提示词」。</p>
<p>在给定部分信息——无论是图像、视频、深度图、文本指令、手势还是动作——的情况下，世界模型应能预测或生成尽可能完整的世界状态。</p>
<p>这要求它既能以真实视觉的保真度处理视觉输入，又能同样自如地解读语义指令。</p>
<p>这使得智能体和人类都能通过多样化的输入与模型与世界进行交流，并反过来接收多样化的输出。</p>
<p><strong>「3. 互动性：世界模型能根据输入的动作输出下一个状态」</strong></p>
<p>最后，如果动作和 / 或目标是给予世界模型的提示词的一部分，那么其输出必须包含世界的下一个状态，无论是隐式还是显式表征。</p>
<p>当仅给定一个动作（无论是否包含目标状态）作为输入时，世界模型产生的输出必须与世界先前的状态、任何预设的目标状态、其语义含义、物理定律以及动态行为保持一致。</p>
<p>随着具备空间智能的世界模型在推理和生成能力上变得日益强大和稳健，可以想见，在给定目标的情况下，世界模型本身将不仅能预测世界的下一个状态，甚至还能基于新状态预测出下一步的动作。</p>
<p><strong>「这项挑战的广度与深度，超越了」</strong> <strong>「AI」</strong> <strong>「以往所面对的任何课题。」</strong></p>
<p>语言是人类认知中纯粹的生成现象，而世界则遵循着远为复杂的规则。</p>
<p>例如，在地球上，引力支配运动，原子结构决定光如何产生色彩与亮度，无数物理定律约束着每一次互动。即便是最天马行空的创意世界，也由遵循其自身物理定律和动态行为的空间物体与智能体构成。</p>
<p>要将这一切——语义、几何、动态与物理——持续一致地调和起来，需要全新的方法论。表征一个世界的维度，远比像语言这样的一维、顺序信号复杂得多。</p>
<p>要实现能提供如人类般通用能力的世界模型，需要克服若干严峻的技术壁垒。在 World Labs，我们的研究团队正致力于朝此目标取得根本性的进展。</p>
<p>以下是我们当前研究课题的一些示例。</p>
<p><strong>「· 一种新的、通用的训练任务函数：」</strong></p>
<p>定义一个像 LLM 中「预测下一个 token」一样简洁而优雅的通用任务函数，长久以来都是世界模型研究的核心目标。由于其输入和输出空间的复杂性，这种函数的构建本质上更加困难。</p>
<p>尽管仍有待探索，但这个目标函数及相应的表征必须能反映几何与物理定律，尊重世界模型作为想象与现实之根基表征的本质。</p>
<p><strong>「· 大规模</strong>「<strong>「训练数据」</strong>」<strong>：」</strong></p>
<p>训练世界模型需要比文本整理复杂得多的数据。好消息是：海量的数据源业已存在。</p>
<p>互联网规模的图像和视频集是丰富且易于获取的训练材料——挑战在于开发能够从这些二维图像或视频帧信号（即 RGB）中提取更深层次空间信息的算法。</p>
<p>过去十年的研究已证明了语言模型中数据量与模型大小之间的「规模定律」的力量；世界模型的关键突破在于构建能够以相当规模利用现有视觉数据的架构。</p>
<p>此外，我绝不会低估高质量合成数据以及深度、触觉信息等额外模态的力量。它们在训练过程的关键阶段对互联网规模的数据形成了重要补充。</p>
<p>但前路漫漫，这有赖于更好的传感器系统、更稳健的信号提取算法以及远为强大的神经模拟方法。</p>
<p><strong>「· 新的模型架构与表征学习：」</strong></p>
<p>世界模型的研究将不可避免地推动模型架构与学习算法的进步，尤其是在当前 MLLM 和视频扩散范式之外。</p>
<p>这两种范式通常将数据「token 化」为一维或二维序列，这使得一些简单的空间任务变得异常困难——例如，计算一个短视频中不重复的椅子数量，或者记住一个小时前房间的样貌。</p>
<p>替代性架构或可助一臂之力，例如具备三维或四维感知能力的 token 化、上下文和记忆方法。</p>
<p>例如，在 World Labs，我们近期关于一个名为 RTFM 的实时生成性帧基模型的工作就展示了这种转变，它使用基于空间的帧作为一种空间记忆形式，以实现高效的实时生成，同时在生成的世界中保持持久性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/168a8b744efb425d84d6eb1e561f4c7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=lga6I%2FjLBptCAzfkfiVlGKgvmX0%3D" alt="" loading="lazy"/></p>
<p>显然，在我们能够通过世界建模完全解锁空间智能之前，仍面临着艰巨的挑战。这项研究不仅是一次理论演练，它是一类新型创意与生产力工具的核心引擎。而 World Labs 内部的进展令人鼓舞。</p>
<p>我们最近向少数用户展示了 Marble 的一瞥——这是首个能够通过多模态输入提示，来生成并维持一致三维环境的世界模型，供用户和故事讲述者在其创意工作流中进行探索、互动和进一步构建。我们正努力使其尽快向公众开放！</p>
<p>Marble 只是我们创造真正具备空间智能的世界模型的第一步。随着进展加速，研究人员、工程师、用户和商界领袖都开始认识到其非凡的潜力。</p>
<p>下一代世界模型将使机器能够在全新层面上实现空间智能——这一成就将解锁当今 AI 系统中仍然普遍缺失的核心能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/931922a21a1c4d2e870624bb0e16a427~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=WjjuBnL0upv4Oa4GknFZkuULj5A%3D" alt="" loading="lazy"/></p>
<p><strong>「用世界模型为人类构建一个更美好的世界」</strong></p>
<p>是什么在激励 AI 的发展？这一点至关重要。</p>
<p>作为协助开启现代 AI 时代的科学家之一，我的动机始终明确：AI 必须增强人类的能力，而非取而代之。</p>
<p>多年来，我一直致力于使 AI 的开发、部署和治理与人类的需求相契合。</p>
<p>如今，关于技术乌托邦和末日论的极端叙事甚嚣尘上，但我始终持有一种更务实的观点：AI 由人开发，为人所用，由人治理。</p>
<p>它必须始终尊重人的能动性与尊严。它的魔力在于扩展我们的能力，让我们更有创造力、联系更紧密、效率更高、生活更充实。</p>
<p>空间智能正是这一愿景的体现——AI 赋能人类的创作者、照护者、科学家和梦想家，去实现曾经的不可能。这一信念，是我将空间智能作为 AI 下一个伟大前沿并为之奋斗的动力。</p>
<p>空间智能的应用横跨不同的时间尺度。创意工具正不断涌现——World Labs 的 Marble 项目已经将这些能力交到了创作者和故事讲述者的手中。</p>
<p>随着我们不断完善感知与行动之间的闭环，机器人技术将是雄心勃勃的中期目标。而最具变革性的科学应用虽然需要更长时间，但有望对人类的福祉产生深远影响。</p>
<p>在所有这些时间尺度上，有几个领域因其重塑人类能力的潜力而格外突出。这需要巨大的集体努力，远非一个团队或一家公司所能实现。</p>
<p>具体来说，它需要整个 AI 生态系统的参与——研究人员、创新者、企业家、公司，乃至政策制定者——共同为实现一个共享的愿景而努力。</p>
<p>但这个愿景值得我们去追求。以下是这个未来所蕴含的图景：</p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18b21018c5eb42a9b0194ab9db2ed0a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=zXDqu3v2mqRhHC9DiNCygHl3kP8%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「创造力：为故事叙述和沉浸式体验注入超凡动力」</strong></p>
<p>「创造力是智力在享受乐趣。」这是我最喜欢的 爱因斯坦名言之一。</p>
<p>早在书面语言出现之前，人类就已开始讲述故事——将其描绘于洞穴岩壁，代代相传，在共同的叙事之上建立起整个文化。</p>
<p>故事是我们理解世界、跨越时空建立联系、探索人性意义的方式，最重要的是，在生活中找到意义，在内心发现爱。</p>
<p>今天，空间智能有潜力改变我们创造和体验叙事的方式，既尊重其根本的重要性，又将其影响力从娱乐延伸至教育，从设计延伸至建筑。</p>
<p>World Labs 的 Marble 平台将把前所未有的空间能力和编辑可控性交到电影制作人、游戏设计师、建筑师和各类故事讲述者的手中，让他们能够快速创造和迭代完全可探索的三维世界，而无需传统三维设计软件的沉重负担。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7cdde3208f44aa2983dbd802d428324~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=IYREf1ObOtVjszcznFZVWEqQBlU%3D" alt="" loading="lazy"/></p>
<p>创造行为本身依然如故，充满人性的活力；AI 工具只是放大和加速了创作者所能达成的成就。这包括：</p>
<p>**新维度的叙事体验：**电影制作人和游戏设计师正使用 Marble 凭空创造出整个世界，不受预算或地理位置的限制，探索在传统制作流程中难以企及的各种场景和视角。</p>
<p>随着不同形式的媒体与娱乐之间的界限日益模糊，我们正在接近一种全新的互动体验，它融合了艺术、模拟与游戏——个性化的世界，其中任何人，而不仅是工作室，都可以创造并沉浸在自己的故事中。</p>
<p>随着将概念和故事板转化为完整体验的更新、更快捷的方式的出现，叙事将不再局限于单一媒介，创作者可以自由地在无数的界面和平台上构建具有共同主线的大千世界。</p>
<p>**通过设计的空间叙事：**几乎每一个制造的物体或建造的空间，在其实体化之前都必须在虚拟三维环境中进行设计。</p>
<p>这个过程在时间和金钱上都高度迭代且成本高昂。有了具备空间智能的模型，建筑师可以快速构想结构，而无需投入数月时间进行设计，他们可以在尚未存在的空间中漫步——这本质上是在讲述我们未来可能如何生活、工作和聚集的故事。</p>
<p>工业设计师和时装设计师可以瞬间将想象转化为形态，探索物体如何与人体和空间互动。</p>
<p>**新的沉浸式和互动体验：**体验本身是我们作为一个物种创造意义的最深层方式之一。</p>
<p>在整个人类历史中，只有一个单一的三维世界：我们共同生活的物理世界。仅在近几十年，通过游戏和早期的虚拟现实（VR），我们才开始一窥我们自己创造的替代世界是何种滋味。</p>
<p>现在，空间智能与新的设备形态（如 VR 和扩展现实（XR）头显及沉浸式显示器）相结合，以前所未有的方式提升了这些体验。</p>
<p>我们正在接近一个未来，届时，步入一个完全实现的多维世界将像翻开一本书一样自然。</p>
<p>空间智能让世界构建不再是拥有专业制作团队的工作室的专利，而是个人创作者、教育工作者以及任何有愿景希望分享的人都能触及的能力。</p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9103eacc99ec4d97963e02710fbf7493~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=J7AdJp%2BruvaqKVTLXr%2BG%2F%2BwaAr4%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「机器人技术：具身智能在行动」</strong></p>
<p>从昆虫到人类，动物都依赖空间智能来理解、导航并与它们的世界互动。机器人也不例外。</p>
<p>自诞生之日起，具备空间意识的机器就一直是该领域的梦想，这其中也包括我与我在斯坦福研究实验室的学生及合作者们的工作。</p>
<p>这也是为何我如此兴奋，期待能用 World Labs 正在构建的这类模型将这一梦想变为现实。</p>
<p><strong>通过世界模型规模化</strong>「<strong>「机器人」</strong>」**学习：**机器人学习的进展取决于一个可扩展的、可行的训练数据解决方案。</p>
<p>考虑到机器人必须学习去理解、推理、规划和互动的状态空间极其庞大，许多人推测，需要结合互联网数据、合成模拟以及对真实世界人类演示的捕捉，才能真正创造出具备泛化能力的机器人。</p>
<p>但与语言模型不同，当今的机器人研究缺乏训练数据。世界模型将在此扮演决定性角色。</p>
<p>随着它们在感知保真度和计算效率上的提升，世界模型的输出可以迅速弥合模拟与现实之间的鸿沟。这反过来将有助于在无数的状态、互动和环境模拟中训练机器人。</p>
<p>**伴侣与协作者：**机器人作为人类的协作者——无论是在实验室工作台上协助科学家，还是在家中帮助独居老人——都可以在急需更多劳动力和生产力的领域扩展我们的劳动力。</p>
<p>但这需要具备感知、推理、规划和行动的空间智能，同时——这是最重要的——与人类的目标和行为保持共情式的对齐。</p>
<p>例如，一个实验室机器人可以处理仪器，让科学家能专注于需要精细操作或推理的任务；而一个家庭助理则可以帮助一位老年人做饭，而不会削弱他们的乐趣或自主性。</p>
<p>能够预测下一个状态，甚至可能预测出符合这种期望的下一步动作的、真正具备空间智能的世界模型，对于实现这一目标至关重要。</p>
<p>**扩展具身形式：**人形机器人在我们为自己构建的世界中扮演着一定角色。</p>
<p>但创新的全部益处将来自更多样化的设计：输送药物的纳米机器人、在狭小空间中穿行的软体机器人，以及为深海或外太空打造的机器。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c5ac19f5be340549abfed73eb82385d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=HZT0ZQ0Sxn0j75%2FNRo4zIPQT93c%3D" alt="" loading="lazy"/></p>
<p>无论其形态如何，未来的空间智能模型都必须整合这些机器人所处的环境以及它们自身的具身感知与运动。但开发这些机器人的一个关键挑战是，在这些五花八门的具身形态上缺乏训练数据。</p>
<p>世界模型将在模拟数据、训练环境和基准测试任务等方面为这些努力发挥关键作用。</p>
<p><strong>「<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cce9a4b3b034c53862c1cb522379e40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=b38kspL%2BT6RBwYRBXibgTP6pD3E%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「更长远的图景：科学、医疗与教育」</strong></p>
<p>除了创意和机器人应用，空间智能的深远影响还将延伸至那些能以拯救生命、加速发现的方式增强人类能力的领域。</p>
<p>我下面重点介绍三个可能带来深刻变革的应用领域，当然，空间智能的用例在更多行业中同样是广阔无垠的。</p>
<p>**在科学研究中，**具备空间智能的系统可以模拟实验、并行测试假设，并探索人类无法触及的环境——从深邃的海洋到遥远的行星。</p>
<p>这项技术可以改变气候科学和材料研究等领域的计算建模。通过将多维模拟与真实世界的数据收集相结合，这些工具可以降低计算门槛，扩展每个实验室所能观察和理解的范围。</p>
<p><strong>在医疗</strong>「<strong>「健康」</strong>」**领域，**空间智能将重塑从实验室到病床边的每一个环节。在斯坦福，我的学生和合作者多年来一直与医院、养老院以及居家患者合作。</p>
<p>这段经历让我坚信空间智能在此处的变革潜力。AI 可以通过在多维空间中建模分子相互作用来加速药物发现，通过帮助放射科医生在医学影像中识别模式来提升诊断水平，并能实现环境监测系统，在不取代治愈所必需的人类情感联结的前提下，为患者和照护者提供支持。</p>
<p>更不用说机器人在众多不同场景下帮助我们的医护人员和患者的巨大潜力。</p>
<p>**在教育领域，**空间智能可以实现沉浸式学习，使抽象或复杂的概念变得触手可及，并创造出对我们大脑和身体学习方式至关重要的迭代式体验。</p>
<p>在 AI 时代，更快、更有效的学习和技能再培训对于学龄儿童和成年人都尤为重要。学生可以在多维空间中探索细胞的运作机制或亲历历史事件。教师可以利用互动环境获得个性化教学的工具。</p>
<p>从外科医生到工程师的专业人士，都可以在逼真的模拟中安全地练习复杂技能。</p>
<p>在所有这些领域，可能性是无限的，但目标始终如一：AI 增强人类的专业知识，加速人类的发现，并放大人类的关怀——而不是取代作为人类核心的判断力、创造力和同理心。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6036d9b8ff4b4f3ba7138bbc64a5aff7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449001&amp;x-signature=G1F1%2Ba5qjPja89WNXr71zdSv2k0%3D" alt="" loading="lazy"/></p>
<p><strong>「结论」</strong></p>
<p>过去十年见证了 AI 成为一种全球现象，以及技术、经济乃至地缘政治的转折点。</p>
<p>但作为一名研究者、教育者，如今又是一名创业者，最能激励我的，仍然是图灵 75 年前提出的那个问题背后的精神。</p>
<p>我依然怀有他那份好奇与惊叹。正是这种感觉，每天都激励着我迎接空间智能的挑战。</p>
<p>历史上第一次，我们有望构建出与物理世界如此协调的机器，以至于在我们面临的最严峻挑战中，可以将它们视为真正的伙伴。</p>
<p>无论是加速我们对实验室中疾病的理解，彻底改变我们讲述故事的方式，还是在我们因疾病、受伤或年老而最脆弱的时刻给予支持，我们都正处在一项新技术的风口浪尖，这项技术将提升我们最珍视的生活的方方面面。这</p>
<p>是一个更深刻、更丰富、更强大的生活愿景。</p>
<p>在大自然于远古动物身上释放出第一缕空间智能的近五亿年后，我们有幸成为可能很快就能赋予机器同样能力的这一代技术专家中的一员——并有幸利用这些能力为世界各地的人们谋福祉。</p>
<p>我们关于真正智能机器的梦想，没有空间智能是不完整的。</p>
<p>这项探索，就是指引我的北极星。我邀请你与我同行。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fdrfeifei%2Fstatus%2F1987891210699379091" target="_blank" title="https://x.com/drfeifei/status/1987891210699379091" ref="nofollow noopener noreferrer">x.com/drfeifei/st…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdrfeifei.substack.com%2Fp%2Ffrom-words-to-worlds-spatial-intelligence" target="_blank" title="https://drfeifei.substack.com/p/from-words-to-worlds-spatial-intelligence" ref="nofollow noopener noreferrer">drfeifei.substack.com/p/from-word…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谢赛宁 × 李飞飞 ×LeCun 首次联手！寒武纪 - S「空间超感知」AI 震撼登场]]></title>    <link>https://juejin.cn/post/7571086754880323630</link>    <guid>https://juejin.cn/post/7571086754880323630</guid>    <pubDate>2025-11-11T06:58:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754880323630" data-draft-id="7571051830710419506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谢赛宁 × 李飞飞 ×LeCun 首次联手！寒武纪 - S「空间超感知」AI 震撼登场"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-11T06:58:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谢赛宁 × 李飞飞 ×LeCun 首次联手！寒武纪 - S「空间超感知」AI 震撼登场
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:58:11.000Z" title="Tue Nov 11 2025 06:58:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ddae2136f914c48b15f9c02ba504f8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=bROg%2B89e96XCNyXKNkRn27Y0qkw%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】当 AI 不再对着文字死记硬背，而是学会在视频里对人类世界进行超感知，这套全新范式会不会撬开 AGI 的大门？」</strong></h5>
<p>在构建超级智能前，需要什么？</p>
<p>这是目前 AI 领域最前沿，最有哲学意味的问题。这个问题的答案甚至决定了未来人类资源的投入走向。</p>
<p>最近，Yann LeCun、李飞飞和谢赛宁联手发了一篇论文——「Cambrian-S：迈向视频中的空间超感知」。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be695ffb3ca84b4597954a7da31dc0de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=SNiUHiEZMLeOWkfGJFMwtI%2FKnfw%3D" alt="" loading="lazy"/></p>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.04670" target="_blank" title="https://arxiv.org/abs/2511.04670" ref="nofollow noopener noreferrer">arxiv.org/abs/2511.04…</a></p>
<p>代码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcambrian-mllm%2Fcambrian-s" target="_blank" title="https://github.com/cambrian-mllm/cambrian-s" ref="nofollow noopener noreferrer">github.com/cambrian-ml…</a></p>
<p>模型：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fcollections%2Fnyu-visionx%2Fcambrian-s-models" target="_blank" title="https://huggingface.co/collections/nyu-visionx/cambrian-s-models" ref="nofollow noopener noreferrer">huggingface.co/collections…</a></p>
<p>数据：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdatasets%2Fnyu-visionx%2FVSI-590K" target="_blank" title="https://huggingface.co/datasets/nyu-visionx/VSI-590K" ref="nofollow noopener noreferrer">huggingface.co/datasets/ny…</a></p>
<p>基准：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fcollections%2Fnyu-visionx%2Fvsi-super" target="_blank" title="https://huggingface.co/collections/nyu-visionx/vsi-super" ref="nofollow noopener noreferrer">huggingface.co/collections…</a></p>
<p>非常罕见，三位大佬共同署名，而且三人中两位（LeCun 和李飞飞）都是明确的世界模型布道者，而 LeCun 更是一位 LLM 批评者。</p>
<p>他在更多场合还广泛批评目前的基于 LLM 的 AI 底层技术，这个技术无法实现 AGI。可想而知，这篇论文的含金量！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/692558244af64ee8b139dc757593c0f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=uS7%2B8ivzZOQ3OiND3GPjDf2if20%3D" alt="" loading="lazy"/></p>
<p>真正意义上的超感官智能，不仅需要具备看见的能力，更要能通过构建内部世界模型，主动地预判、筛选并组织其所接收的感官信息</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaaf8f6921f74f689a4b82a8566f9d85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=v7rLnN8dGBMUCUp73xhhZqzBaFY%3D" alt="" loading="lazy"/></p>
<p>谢赛宁说关于对这个问题的思考，甚至让他们重构了此前基础的研究。</p>
<p>去年，他们就构建了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652494612%26idx%3D1%26sn%3D6bb7e9c5db36d165ec9ab6a4187720ac%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652494612&amp;idx=1&amp;sn=6bb7e9c5db36d165ec9ab6a4187720ac&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Cambrian-1</a>，这是针对图像多模态模型的一次开放性探索。</p>
<p>扩展阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652494612%26idx%3D1%26sn%3D6bb7e9c5db36d165ec9ab6a4187720ac%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652494612&amp;idx=1&amp;sn=6bb7e9c5db36d165ec9ab6a4187720ac&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">LeCun 谢赛宁首发全新视觉多模态模型，等效 1000 张 A100 干翻 GPT-4V</a></p>
<p>但之后团队并没有直接扩大规模去构建 Cambrian-2 或 3，而是停下来反思：</p>
<ul>
<li>真正的多模态智能意味着什么？</li>
<li>大语言模型范式对于感官建模而言，真的合理吗？</li>
<li>以及，为什么人类的感知如此毫不费力、如此直观，却又如此强大？</li>
</ul>
<p>一些根本性的东西缺失了。</p>
<p>简单说就是，这三位巨头认为 LLM 目前虽然能力很强，但依然无法像人类一样感知这个世界，既然无法感知，代表 LLM 是有缺陷的。</p>
<p>谢赛宁在博客中表示，在构建出「超感知」之前，不可能真正构建出「超级智能」。</p>
<p>那么，什么是超感知 (supersensing)？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0bf36a31d3d45e08b17ed75e06c5e4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=tHAllbWBT9CZjOvW%2B59J9BWpoR0%3D" alt="" loading="lazy"/></p>
<p>在团队看来，「超感知」并非指更高级的传感器或更好的摄像头。</p>
<p>它关乎一个数字生命如何真正地体验世界——吸收源源不断的输入流，并从中学习。</p>
<p>超感知是智能的一部分，正如眼睛是大脑触及外部世界的那一部分。解决编程和数学问题时不需要感知能力。</p>
<p>但身处现实世界中的 AI 智能体，则需要感官建模！</p>
<p>谢赛宁还引用了卡帕西所说，感官建模或许就是 AI 智能体所需要的一切。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1400626cc6c34b688380c9c9ed387aba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=GuocD8DuZWRrfYyuCBHYoss%2FYHo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8af6d08cd7474ba3acdd04456013d5e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=i1p2YiJyyiMqvBolWsSz5xMQrCo%3D" alt="" loading="lazy"/></p>
<p><strong>「视频空间超感知」</strong></p>
<p>如何让 AI 能够真正地感知人类的世界？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10eb1ca3eb0b4e4ba915a2fa40665e10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=f%2FDEKWQ6zsR3CeaIntrVLizdG3Y%3D" alt="" loading="lazy"/></p>
<p>为了更具体地阐述，团队认为以下的分类法能够清晰地描绘出一条演进路径——从团队当前拥有的技术，到团队下一步真正需要构建的目标。</p>
<ul>
<li>
<p><strong>「0. （纯语言理解）」</strong></p>
<p>不具备感官能力；推理仅限于文本和符号。当前的多模态大语言模型虽已超越此阶段，但仍残留着其偏见的痕迹。</p>
</li>
<li>
<p><strong>「1. 语义感知」</strong></p>
<p>将像素解析为物体、属性和关系。这对应于多模态大语言模型目前强大的「看图说话」能力。</p>
</li>
<li>
<p><strong>「2. 流式事件认知」</strong></p>
<p>处理实时的、无限制的数据流，同时主动地解读并响应持续发生的事件。这与当前将多模 T 态大语言模型打造为实时助手的努力方向一致。</p>
</li>
<li>
<p><strong>「3. 隐式」</strong> <strong>「3D」</strong> <strong>「空间认知」</strong></p>
<p>将视频理解为三维世界的投影。智能体必须知道「什么东西」在「哪里」，它们之间「如何关联」，以及空间布局「如何随时间变化」。当今的多模态模型在这一方面的能力仍然**「极其」**有限。</p>
</li>
<li>
<p><strong>「4. 预测性世界建模」</strong></p>
<p>大脑通过基于先验期望来预测潜在的世界状态，从而进行「无意识推断」。当前的多模态系统缺乏一个能够预测未来状态、保持长期记忆或进行推理和规划的内部模型。</p>
</li>
</ul>
<p>要研究这一切，视频是最佳的媒介——它是人类每天体验世界的方式，是人类生活经验的直接投影。</p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27109d5c53b842f7b70bfb9ec2d9cd0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=t92G8ut2%2FppL%2F9MnhT1r4bE6rLw%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「如何判断模型达到超感知能力」</strong></p>
<p>首要问题（始终）是基准测试。</p>
<p>谢赛宁说他也很钟爱多模态大语言模型，但若缺乏开放和批判性的审视，团队可能会在错误的方向上进行优化。</p>
<p>许多视频基准测试甚至不需要真正的感知能力；正如团队所展示的，仅仅依靠单帧图像或字幕就能获得高分。</p>
<p>谢赛宁也提到了现在的玩法是：</p>
<p>科技公司构建强大的语言模型 → 基准测试奖励的是模型的文本记忆能力 → 模型通过扩大 LLM 的规模获得更高分数 → 其他公司纷纷效仿</p>
<p>这个循环不断持续，直到团队意识到，召唤出的「幽灵」在感知能力上，仍然落后于一只猫，或一只松鼠。</p>
<p>莫拉维克悖论再次应验：对人类而言毫不费力的感知能力，对模型来说却难如登天。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78d5d543d47349f6aa7c74e145a0b388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=jsS%2BFhEi1oaAHmEbpJBmSKUpJMI%3D" alt="" loading="lazy"/></p>
<p>这不仅仅是一个科学问题。</p>
<p>真正的价值来自于那些能够在现实世界中感知和行动的模型：</p>
<p>从工厂到农场，再到医院…… 从机器人到那些人们期望能作为个人助理佩戴的 AI 眼镜。</p>
<p>仅靠大语言模型是无法实现这一切的。</p>
<p>超级智能，始于超感知。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47bfbf4417c842fe8a6f160e5938e36c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=SY2NotgK%2FSitHH2r0XlWSBuuE2g%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fe4f40d6b24462b92d388f003382fa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=gkcYo12OClsxki%2Bg2eirLFpIzEo%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「超感知的关键一环是视觉空间智能」</strong></p>
<p>谢赛宁团队之前有一个 VSI-Bench 基准用于测试空间推理，但其中的视频太短，任务也过于简单。</p>
<p>所以，团队打造了一个看似更简单、实则更难的版本：VSI-Super。</p>
<p>其中有两个任务。</p>
<p>· 任务 1：VS</p>
<p>长时程空间记忆。团队使用扩散模型编辑视频，插入一些不合上下文但视觉上融合的物体（而不是随机的「大海捞针」式物体）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7b8358795024e40993540d27c4435d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=ZQaf%2BEf38tqBX2tAIB6q%2F2ikubU%3D" alt="" loading="lazy"/></p>
<p>· 任务 2：VSC</p>
<p>持续计数。在变化的视角和场景下进行持续计数…… 模型只需数出它们所看到的东西。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e962cb922db843a592a65451ffb5db96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=ccPCHHog%2FVkAUGs%2Bi6JuSW9FNqM%3D" alt="" loading="lazy"/></p>
<p>一个测试考察对物体顺序的记忆力，另一个则考察计数能力。</p>
<p>任务简单，可流式处理——还能有比这更容易的吗？</p>
<p>然而，顶尖的大语言模型却纷纷败下阵来。</p>
<p>而且，这不仅仅是长上下文（long context）的问题。</p>
<p>为什么？</p>
<p>谢赛宁解释道（其实还是验证了莫拉维克悖论）：</p>
<ul>
<li>
<p>视频可以任意长。这对于对人类来说，这很简单。人类的感官能处理「无限的 Token」。这虽然是一个有损的过程，但人们能记住几天甚至几周的经历。模型却做不到。</p>
</li>
<li>
<p><strong>「它们」<strong><strong>（LLM）</strong></strong>「缺乏真正的空间认知和泛化能力。」</strong></p>
<p>人类可以一直数下去，而模型不行。</p>
</li>
</ul>
<p>以顶尖的 Gemini 2.5 模型为例，它只能数到几十个。</p>
<p>即使视频更长、物体更多，它也会停止计数。 这充分暴露了其训练数据的分布特点。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4b7b1cc5a894d69b09a63ae9f91c983~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=Gy2DbZQBxc4giyAmEX%2BbTkH9%2B5A%3D" alt="" loading="lazy"/></p>
<p>当然，你可能会问——这难道不只是一个数据或规模化的问题吗？</p>
<p>就像 Scaling Law 一样，继续增加数据量和增大训练量，不就可以解决吗？</p>
<p>谢赛宁表示，部分是因为规模这个原因。</p>
<p>但这也是他们构建全新的 Cambrian-S 视频多模态大语言模型（MLLM）系列的原因。</p>
<p>团队想要挑战当前范式（LLM）的极限。</p>
<p>谢赛宁、李飞飞和 LeCun，他们认为数据和规模化对于超感知至关重要（但仅有这些还不够）。</p>
<p>核心问题在于：目前缺乏真正用于训练空间认知的有效数据。</p>
<p>所以团队构建了一个名为 VSI-590K 的数据集。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fd9d61aa2b1457cbb23bfcda6afd3bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=8VuGba4zV%2BHbttsyyGRlo6Q9pxc%3D" alt="" loading="lazy"/></p>
<p>它包含 59 万个训练样本，来源包括：带有 3D 标注的室内环境第一人称探索视频、来自模拟器的视频，以及使用 VGGT 等视觉工具进行伪标注的 YouTube 视频。</p>
<p>团队探索了多种后训练方案、数据混合策略以及一系列工程细节，训练了从 5 亿到 70 亿参数不等的模型。</p>
<p>结果显示出强大的空间推理能力——性能比团队的基座 MLLM 提升高达 30%。即使是最小的模型也表现得相当出色。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23b87b22c8f648088b14907893209c7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=0x2H81vgslb8Qm2mCRtLJHt96SE%3D" alt="" loading="lazy"/></p>
<p>已经将数据和模型全部开源。</p>
<p>相信它们将在许多任务中发挥作用。但要明确一点——这仍然无法解决 VSI-Super 基准测试的挑战。</p>
<p>而且他们越来越坚信：沿用大语言模型的老路来构建多模态模型，并非通往超感知的终极之道。（其实就是 LeCun 在多个场合下所说的 LLM 并不会通向 AGI。）</p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94a76a653a6144f1bd6a56551a1752ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=g2bqLwIKazHHjNpI9eTCAYgIv9E%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「全新原型，全新范式」</strong></p>
<p>展望未来，团队正在开发一种全新原型——团队称之为「预测性感知」。</p>
<p>在这篇论文中引用了大量来自认知科学和发展心理学的研究成果。</p>
<p>越是深入研读，就越为人类和动物的感知能力而惊叹。</p>
<p>人类的视觉系统拥有极高的带宽，却又有着惊人的效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd3019471be84d46888156fdc37b8dea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=Hn27HelAGudoGNAG%2FP%2FUDf3CTWU%3D" alt="" loading="lazy"/></p>
<p>每只眼睛的 600 万个视锥细胞可以传输约 1.6 Gbit/s 的数据，然而大脑仅用约 10 bits/s 的信息来指导行为。</p>
<p>大部分感官数据都被过滤和压缩，整个过程都在自动运行——你甚至毫无察觉。</p>
<p>人类的大脑是如何做到这一点的？</p>
<p>一个主流理论认为：</p>
<p>你的大脑在后台运行一个「预测性世界模型」来进行感知，它不断地预测未来，并将其与实际发生的情况进行比对。</p>
<ul>
<li>如果预测误差很小 → 说明一切尽在预料之中，可以忽略。</li>
<li>如果预测误差很大 → 这就是「惊异」，大脑会集中注意力，并更新记忆。</li>
</ul>
<p>目前的大语言模型中，没有任何与之相当的机制。</p>
<p>为验证这一想法，团队在 Cambrian-S 模型之上，训练了一个潜在帧预测 (Latent Frame Prediction, LFP) 模块。（过去人类模仿鸟类、蝙蝠发明了飞机和超声波，这次 AI 要模仿人类了）</p>
<p>团队在推理过程中估算「惊异度」，并将其应用于两个方面：</p>
<ul>
<li><strong>「由」****「</strong>「<strong>「惊异度」</strong>」<strong>」****「驱动的记忆管理」</strong> —— 压缩或跳过无意外的帧，将计算资源集中在有意外的帧上。</li>
<li><strong>「由」****「</strong>「<strong>「惊异度」</strong>」<strong>」****「驱动的事件切分」</strong> —— 利用「惊异度」的峰值来检测事件边界或场景变化。</li>
</ul>
<p>通过利用这个内部预测模型提供的信号，已经在空间认知任务上看到了喜人的性能提升。</p>
<p>这目前只是一个简化的预测性世界模型原型——但仅凭这一机制，小模型就在 VSI-Super 评测基准上超越了 Gemini。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/136113e7feeb425d94262c425b1db6a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=4j4SgA7wwYR%2FRqodf2NLVKp%2F%2BYE%3D" alt="" loading="lazy"/></p>
<p>谢赛宁说虽然这篇论文很长，但保证——其中有很多团队认为非常有趣的细节。</p>
<p>如果你也在研究视频多模态模型，那么这篇论文很值得一读。</p>
<p>我不敢说团队的方法就是正确的道路——但我确信，当前的范式是远远不够的，而开放科学、开放研究，才是唯一的出路。</p>
<p>值得一提的是，团队还同步发布了由相关的两个相关项目：</p>
<p><strong>「一项关于多模态基准设计的研究」</strong>——如何对基准进行压力测试，并有效消除语言偏见。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfa5d28721c14f2da3cb99803e74804c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=YV48heCYSiWtrYFJO2C9Rcp9nHQ%3D" alt="" loading="lazy"/></p>
<p><strong>「一份经验总结」</strong>，关于团队如何构建模拟器来收集空间感知视频（Cambrian-S 使用的正是这些数据）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf9815255ff94ae38be38094866482c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=f7TJ2Kdw8gILDR6AOGo2UY5Af8s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afda1b453af5459d91c39b27c607da2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=MZNYddeUREGvOrENZUxcv4Z9RT8%3D" alt="" loading="lazy"/></p>
<p><strong>「作者介绍」</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daa29656b1cd441d8e72a0184d29b325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=s5tU780yksTTIaRLS7zo234B4gM%3D" alt="" loading="lazy"/></p>
<p>共同一作 Shusheng Yang 是纽约大学计算机科学专业的博士生，指导老师是谢赛宁教授。</p>
<p>此前，他在华中科技大学获得计算机课学士学位和计算机视觉与深度学习硕士学位。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cfc35814d0c4eafa8626b0cab395809~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=iLjXrd9M3OKFHHoUn56kpuzfGXc%3D" alt="" loading="lazy"/></p>
<p>共同一作 Jihan Yang，是纽约大学库朗研究所的一名博士后副研究员，师从谢赛宁教授。</p>
<p>此前，他在香港大学获得博士学位，在中山大学获得学士学位。</p>
<p>他的研究兴趣主要集中在机器学习和计算机视觉领域，重点探索多模态大语言模型在推理、智能体、长视频理解、空间智能和统一模型方面的研究，以及它们在现实世界中的应用与落地。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caa8509d7cb548b5aec4c3e3aa8e7fc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449090&amp;x-signature=aLvzYDN2hp0Yr%2BdFZulwT4lcnuE%3D" alt="" loading="lazy"/></p>
<p>核心作者黄品志是纽约大学本科生，师从谢赛宁教授。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcambrian-mllm.github.io%2Fcambrian-s%2F" target="_blank" title="https://cambrian-mllm.github.io/cambrian-s/" ref="nofollow noopener noreferrer">cambrian-mllm.github.io/cambrian-s/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2511.04670" target="_blank" title="https://arxiv.org/abs/2511.04670" ref="nofollow noopener noreferrer">arxiv.org/abs/2511.04…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fsainingxie%2Fstatus%2F1986685042332958925" target="_blank" title="https://x.com/sainingxie/status/1986685042332958925" ref="nofollow noopener noreferrer">x.com/sainingxie/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《Spring Framework 核心原理与实践指南》]]></title>    <link>https://juejin.cn/post/7570999443447021604</link>    <guid>https://juejin.cn/post/7570999443447021604</guid>    <pubDate>2025-11-11T07:25:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570999443447021604" data-draft-id="7570999443447005220" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《Spring Framework 核心原理与实践指南》"/> <meta itemprop="keywords" content="Spring"/> <meta itemprop="datePublished" content="2025-11-11T07:25:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="超级苦力怕"/> <meta itemprop="url" content="https://juejin.cn/user/3687077413139354"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《Spring Framework 核心原理与实践指南》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3687077413139354/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    超级苦力怕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:25:40.000Z" title="Tue Nov 11 2025 07:25:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读25分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.Spring 相关概念</h2>
<p>Spring 是一个开源的 Java 企业级应用开发框架，它的核心目标是简化企业级应用开发的复杂性，提供一站式的解决方案。</p>
<h3 data-id="heading-1">1.1 Spring Framework 系统架构图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40caa7ed61fc4e53a4cc396e84d1029d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn6Ium5Yqb5oCV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763450740&amp;x-signature=55FV5OKJpfeU71tPsnZ0eaJlAI8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>在Spring这部分内容中主要包含<code>IOC/DI</code>和<code>AOP</code>,在后面也会基于这几个部分进行讲解。</p>
<h3 data-id="heading-2">1.2 核心概念</h3>
<p><strong>概念</strong>：</p>
<p><strong>IOC (Inversion of Control) 控制反转</strong>：对象的创建控制权由程序转移到<strong>外部</strong>，这种思想称为控制反转。</p>
<blockquote>
<p>即控制权从应用程序代码转移到框架容器，由容器负责管理对象生命周期和依赖关系。</p>
</blockquote>
<p><strong>Bean</strong>：在Spring中提供了IOC容器，而用于充当外部，负责对象的创建、初始化等工作，被创建或被管理的对象在IOC容器中的统称为Bean。</p>
<p><strong>DI(Dependency Injection)依赖注入</strong>：在容器中建立bean与bean之间的依赖关系的整个过程，称为依赖注入</p>
<h2 data-id="heading-3">2. IOC内容</h2>
<p>IOC主要是控制反转思想，在这里分为<code>bean基础配置</code>,<code>bean实例化</code>,<code>bean的生命周期</code>讲解，分别采用<code>非注解</code>,<code>注解</code>的写法。</p>
<p>同时讲解核心容器,也就是<code>ApplicationContext</code>。</p>
<h3 data-id="heading-4">2.1 bean的基础配置</h3>
<h4 data-id="heading-5">(1) 非注解写法和注意事项</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dff30f7a9ea44faa51572cb036ef0c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn6Ium5Yqb5oCV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763450740&amp;x-signature=y0cG9J%2FyssDktB9sD4M3gDB5dvg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h5 data-id="heading-6">&lt;1&gt; 知识点速览</h5>
<blockquote>
<p>id：bean的id，使用容器可以通过id值获取对应的bean，在一个容器中id值唯一。</p>
<p>class：bean的类型，即配置的bean的全路径类名</p>
<p>name：bean的别名配置,别名可以有多个，使用逗号、分号、空格分隔</p>
<p>scope：负责控制bean的作用范围，有单例和非单例</p>
</blockquote>
<h5 data-id="heading-7">&lt;2&gt; 准备工作</h5>
<p><strong>前置工作</strong>:创建Maven项目，添加Spring对应jar包和所需类
<strong>使用思路</strong>：添加Spring配置文件，完成配置，进行使用</p>
<p>Spring配置文件示例(在resources下建立)</p>
<blockquote>
<p><code>resources</code> 是 Java 项目（尤其是 Maven/Gradle 等构建工具管理的项目）中<strong>专门用于存放非 Java 源代码的资源文件</strong>的标准目录</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span>
<span class="hljs-comment">&lt;!--文档前面内容省略--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.Coolipa.Dao.Impl.BookDaoImpl"</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">"singleton"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"bookDao2 bookDao"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookService"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.Coolipa.Service.Impl.BookServiceImpl"</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">"prototype"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
</code></pre>
<h5 data-id="heading-8">&lt;3&gt; 获取IOC容器并调用方法 (id 和 class的使用)</h5>
<p>启动类通过配置文件中的xml接口完成IOC容器创建，并通过id和class调用内部的方法</p>
<p><strong>配置文件关键点</strong>：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.Coolipa.Dao.Impl.BookDaoImpl"</span> /&gt;</span>
</code></pre>
<p><strong>启动类</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">"ApplicationContext.xml"</span>);
        BookDao bookDao= (BookDao) app.getBean(<span class="hljs-string">"bookDao"</span>);
        bookDao.save();
    }
}

</code></pre>
<h5 data-id="heading-9">&lt;4&gt; 配置别名(name的使用)</h5>
<p>id可能会由于命名习惯而产生分歧，可以利用别名去解决这个问题</p>
<p><strong>配置文件关键点</strong>：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.Coolipa.Dao.Impl.BookDaoImpl"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"bookDao2"</span>/&gt;</span>
</code></pre>
<p><strong>启动类</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">"ApplicationContext.xml"</span>);
        BookDao bookDao= (BookDao) app.getBean(<span class="hljs-string">"bookDao2"</span>);
        bookDao.save();
    }
}
</code></pre>
<p><strong>拓充</strong>：
可以利用bean依赖注入的ref属性指定bean，必须在容器中存在，不存在将会报错<code>NoSuchBeanDefinitionException</code></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span> =<span class="hljs-string">"bookService"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"service service2"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.Coolipa.Dao.Impl.BookDaoImpl"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dao"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c68353811964507ace8135a25514a29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn6Ium5Yqb5oCV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763450740&amp;x-signature=CssUnCvGFYUsp%2FDztjLFp87O5%2BA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h5 data-id="heading-10">&lt;5&gt;测试单例/非单例(scope的使用)</h5>
<p>在默认情况下，Spring创建的Bean对象都是单例了，所以需要手动更改</p>
<p><strong>配置文件关键点</strong>：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.Coolipa.Dao.Impl.BookDaoImpl"</span> 
<span class="hljs-attr">scope</span>=<span class="hljs-string">"singleton"</span>/&gt;</span>
</code></pre>
<p>其中单例为<code>singleton</code>，非单例为<code>prototype</code></p>
<p>拓充：</p>
<blockquote>
<p>为什么bean默认为单例?</p>
</blockquote>
<p>单例指在IOC容器中只会有该类的一个对象,bean对象只有一个就避免了对象的频繁创建与销毁，达到了bean对象的复用，性能高</p>
<blockquote>
<p>bean在容器中是单例的，会不会产生线程安全问题？</p>
</blockquote>
<p>如果对象有成员变量可以用来存储数据，由于线程共用一个bean对象，会存在线程安全问题。
如果对象没有成员变量进行数据存储，则方法中的局部变量在方法调用完毕后会被销毁，不会存在线程安全问题</p>
<h4 data-id="heading-11">(2) 注解写法和注意事项</h4>
<h5 data-id="heading-12">&lt;1&gt; 知识点速览：</h5>
<p>知识点1:@Component等</p>

























<table><thead><tr><th>名称</th><th>@Component/@Controller/@Service/@Repository</th></tr></thead><tbody><tr><td>类型</td><td>类注解</td></tr><tr><td>位置</td><td>类定义上方</td></tr><tr><td>作用</td><td>设置该类为spring管理的bean</td></tr><tr><td>属性</td><td>value（默认）：定义bean的id</td></tr></tbody></table>
<p>知识点2：@Configuration</p>

























<table><thead><tr><th>名称</th><th>@Configuration</th></tr></thead><tbody><tr><td>类型</td><td>类注解</td></tr><tr><td>位置</td><td>类定义上方</td></tr><tr><td>作用</td><td>设置该类为spring配置类</td></tr><tr><td>属性</td><td>value（默认）：定义bean的id</td></tr></tbody></table>
<p>知识点3：@ComponentScan</p>

























<table><thead><tr><th>名称</th><th>@ComponentScan</th></tr></thead><tbody><tr><td>类型</td><td>类注解</td></tr><tr><td>位置</td><td>类定义上方</td></tr><tr><td>作用</td><td>设置spring配置类扫描路径，用于加载使用注解格式定义的bean</td></tr><tr><td>属性</td><td>value（默认）：扫描路径，此路径可以逐层向下扫描</td></tr></tbody></table>
<p>知识点4：@Scope</p>

























<table><thead><tr><th>名称</th><th>@Scope</th></tr></thead><tbody><tr><td>类型</td><td>类注解</td></tr><tr><td>位置</td><td>类定义上方</td></tr><tr><td>作用</td><td>设置该类创建对象的作用范围<br/>可用于设置创建出的bean是否为单例对象</td></tr><tr><td>属性</td><td>value（默认）：定义bean作用范围，<br/><strong>默认值singleton（单例），可选值prototype（非单例）</strong></td></tr></tbody></table>
<h5 data-id="heading-13">&lt;2&gt; 改进方案：</h5>
<p>创建java的配置类，用<code>@configuration</code>注解替换配置类,用<code>@ComponentScan</code>替换指定class文件</p>
<p><strong>配置类</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@Scope("singleton")</span>
<span class="hljs-meta">@ComponentScan("com.Coolipa")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig</span> {
}
</code></pre>
<p><strong>被替换部分</strong>：</p>
<pre><code class="hljs language-java" lang="java">    &lt;bean id=<span class="hljs-string">"bookDao"</span> class=<span class="hljs-string">"com.Coolipa.Dao.Impl.BookDaoImpl"</span> scope=<span class="hljs-string">"singleton"</span> name=<span class="hljs-string">"bookDao2"</span>/&gt;
    &lt;bean id=<span class="hljs-string">"bookService"</span> class=<span class="hljs-string">"com.Coolipa.Service.Impl.BookServiceImpl"</span> scope=<span class="hljs-string">"prototype"</span>/&gt;
</code></pre>
<p><strong>启动类：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">app</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);        <span class="hljs-comment">//名称和字节码都可以</span>
        BookDao bookDao= (BookDao) app.getBean(<span class="hljs-string">"bookDao"</span>);
        bookDao.save();
        <span class="hljs-type">BookService</span> <span class="hljs-variable">bookService</span> <span class="hljs-operator">=</span>app.getBean(BookService.class);
        bookService.save();
    }
}
</code></pre>
<p><strong>被替换部分对比</strong>：</p>
<pre><code class="hljs language-java" lang="java">        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">"applicationContext.xml"</span>);
        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);
</code></pre>
<blockquote>
<p>ClassPathXmlApplicationContext是加载XML配置文件AnnotationConfigApplicationContext是加载配置类</p>
</blockquote>
<h3 data-id="heading-14">2.2 bean实例化</h3>
<p>这里主要为<code>实例化bean的方式</code></p>
<h4 data-id="heading-15">(1) 非注解写法和注意事项</h4>
<h5 data-id="heading-16">&lt;1&gt; 知识点速览</h5>
<p>bean是由构造方法创建的</p>
<p>Spring的IOC实例化对象的三种方式分别为<code>构造方法</code>,<code>静态方法</code>,<code>实例方法</code>，主要掌握<code>构造方法</code>和实例方法中的<code>FactoryBean</code>。</p>
<blockquote>
<p>需要注意的一点是，构造方法在类中默认会提供，但是如果重写了构造方法，默认的就会消失，在使用的过程中需要注意，如果需要重写构造方法，最好把默认的构造方法也重写下。</p>
</blockquote>
<h5 data-id="heading-17">&lt;2&gt; 准备工作</h5>
<p><strong>前置工作</strong>：准备创建的类，配置类，启动类</p>
<h5 data-id="heading-18">&lt;3&gt; 构造方法实例化</h5>
<p>在类中添加无参构造函数即可</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookDao</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BookDaoImpl</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book dao constructor is running ...."</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book dao save ..."</span>);
    }

}
</code></pre>
<blockquote>
<p>Spring容器在创建对象时用的就是构造函数(无参构造)，同时Spring底层用的是反射(可以访问私有构造方法)</p>
</blockquote>
<h5 data-id="heading-19">&lt;4&gt; 静态工厂实例化</h5>
<p>配置类添加内容</p>
<blockquote>
<p>class:工厂类全名</p>
<p>factory-method：具体工厂类中创建对象的方法名</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"orderDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itheima.factory.OrderDaoFactory"</span> <span class="hljs-attr">factory-method</span>=<span class="hljs-string">"getOrderDao"</span>/&gt;</span>
</code></pre>
<p>编写运行类运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppForInstanceOrder</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">"applicationContext.xml"</span>);
        <span class="hljs-type">OrderDao</span> <span class="hljs-variable">orderDao</span> <span class="hljs-operator">=</span> (OrderDao) ctx.getBean(<span class="hljs-string">"orderDao"</span>);
        orderDao.save();
    }
}
</code></pre>
<blockquote>
<p>在工厂静态方法，可以作其他的业务操作</p>
</blockquote>
<h5 data-id="heading-20">&lt;5&gt; 实例工厂与FactoryBean</h5>
<p><strong>实例工厂</strong>：</p>
<p>配置类内容</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userFactory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itheima.factory.UserDaoFactory"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">factory-method</span>=<span class="hljs-string">"getUserDao"</span> <span class="hljs-attr">factory-bean</span>=<span class="hljs-string">"userFactory"</span>/&gt;</span>
</code></pre>
<blockquote>
<p>factory-bean:工厂的实例对象</p>
<p>factory-method:工厂对象中的具体创建对象的方法名</p>
</blockquote>
<p>编写运行类，在类中通过工厂获取对象</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppForInstanceUser</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> 
            <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">"applicationContext.xml"</span>);
        <span class="hljs-type">UserDao</span> <span class="hljs-variable">userDao</span> <span class="hljs-operator">=</span> (UserDao) ctx.getBean(<span class="hljs-string">"userDao"</span>);
        userDao.save();
    }
}
</code></pre>
<p><strong>FactoryBean</strong>：</p>
<p>创建类，实现FactoryBean接口，重写方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDaoFactoryBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;UserDao&gt; {
    <span class="hljs-comment">//代替原始实例工厂中创建对象的方法</span>
    <span class="hljs-keyword">public</span> UserDao <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDaoImpl</span>();
    }
    <span class="hljs-comment">//返回所创建类的Class对象</span>
    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() {
        <span class="hljs-keyword">return</span> UserDao.class;
    }
}
</code></pre>
<blockquote>
<p>FactoryBean接口有三个方法：</p>
<ul>
<li><code>getObject()</code>：返回由FactoryBean创建的对象实例</li>
<li><code>getObjectType()</code>：返回创建对象的类型</li>
<li><code>isSingleton()</code>：默认返回true，表示创建的bean是单例的。可以通过重写此方法返回false来创建原型(prototype)bean</li>
</ul>
</blockquote>
<p>验证方法：可以通过在Spring容器中多次获取同一个FactoryBean创建的bean，观察是否为同一个实例来验证单例行为。</p>
<pre><code class="hljs language-java" lang="java">T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;

Class&lt;?&gt; getObjectType();

<span class="hljs-keyword">default</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h4 data-id="heading-21">(2) 实例化bean的三种方式</h4>
<h3 data-id="heading-22">2.3 bean的生命周期</h3>
<p>这里主要知识点为<code>bean生命周期</code></p>
<h4 data-id="heading-23">(1) 非注解写法和注意事项</h4>
<h5 data-id="heading-24">&lt;1&gt; 知识点速览</h5>
<p>关于Spring中对bean生命周期提供两种方式</p>
<ul>
<li>
<p>在配置文件中的bean标签，可以添加<code>init-method</code>和<code>destroy-method</code>属性</p>
</li>
<li>
<p>类实现<code>InitializingBean</code>与<code>DisposableBean</code>接口，这种方式了解下即可。</p>
</li>
</ul>
<p>关闭容器分为<code>close()</code>和<code>registerShutdownHook()</code>两个方法</p>
<h5 data-id="heading-25">&lt;2&gt; 准备工作</h5>
<p><strong>前置工作</strong>：准备创建的类，配置类，启动类</p>
<h5 data-id="heading-26">&lt;3&gt; 生命周期设置</h5>
<h6 data-id="heading-27">a. 正常实现</h6>
<p>添加初始化和销毁方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookDao</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book dao save ..."</span>);
    }
    <span class="hljs-comment">//表示bean初始化对应的操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"init..."</span>);
    }
    <span class="hljs-comment">//表示bean销毁前对应的操作</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destory</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"destory..."</span>);
    }
}
</code></pre>
<p>在配置文件添加配置，如下:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itheima.dao.impl.BookDaoImpl"</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">"init"</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">"destory"</span>/&gt;</span>
</code></pre>
<blockquote>
<p>由于在普通Java应用中，JVM退出时不会自动调用bean的销毁方法，可以通过以下两种方式触发：</p>
</blockquote>
<ol>
<li>
<p><strong>显式关闭</strong>：使用<code>ClassPathXmlApplicationContext</code>的<code>close()</code>方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ClassPathXmlApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">"applicationContext.xml"</span>);
<span class="hljs-comment">// 使用bean...</span>
ctx.close(); <span class="hljs-comment">// 显式关闭容器，触发销毁方法</span>
</code></pre>
</li>
<li>
<p><strong>注册关闭钩子</strong>：使用<code>registerShutdownHook()</code>方法，在JVM关闭时自动调用销毁方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ClassPathXmlApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">"applicationContext.xml"</span>);
ctx.registerShutdownHook(); <span class="hljs-comment">// 注册JVM关闭钩子</span>
</code></pre>
</li>
</ol>
<p><strong>区别</strong>：</p>
<ul>
<li><code>close()</code>：需要手动调用，立即触发销毁</li>
<li><code>registerShutdownHook()</code>：自动在JVM关闭时触发，更适合生产环境</li>
</ul>
<h6 data-id="heading-28">b. 基于接口实现</h6>
<p>在实现类添加两个接口<code>InitializingBean</code>， <code>DisposableBean</code>并实现接口中的两个方法<code>afterPropertiesSet</code>和<code>destroy</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookService</span>, InitializingBean, DisposableBean {
    <span class="hljs-keyword">private</span> BookDao bookDao;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBookDao</span><span class="hljs-params">(BookDao bookDao)</span> {
        <span class="hljs-built_in">this</span>.bookDao = bookDao;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book service save ..."</span>);
        bookDao.save(); 
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"service destroy"</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"service init"</span>);
    }
}
</code></pre>
<h4 data-id="heading-29">(2) 注解写法和注意事项</h4>
<h5 data-id="heading-30">&lt;1&gt; 知识点速览</h5>
<p>知识点1：@PostConstruct</p>

























<table><thead><tr><th>名称</th><th>@PostConstruct</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>方法上</td></tr><tr><td>作用</td><td>设置该方法为初始化方法</td></tr><tr><td>属性</td><td>无</td></tr></tbody></table>
<p>知识点2：@PreDestroy</p>





















<table><thead><tr><th>名称</th><th>@PreDestroy</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>方法上</td></tr><tr><td>作用</td><td>设置该方法为销毁方法</td></tr></tbody></table>
<h5 data-id="heading-31">&lt;2&gt; 改进方案</h5>
<p>使用<code>@PostConstruct</code>、<code>@PreDestroy</code>定义bean生命周期</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Repository</span>
<span class="hljs-comment">//@Scope设置bean的作用范围</span>
<span class="hljs-meta">@Scope("singleton")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookDao</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book dao save ..."</span>);
    }
    <span class="hljs-comment">//@PostConstruct设置bean的初始化方法</span>
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"init ..."</span>);
    }
    <span class="hljs-comment">//@PreDestroy设置bean的销毁方法</span>
    <span class="hljs-meta">@PreDestroy</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"destroy ..."</span>);
    }
}
</code></pre>
<h3 data-id="heading-32">2.4 核心容器</h3>
<h4 data-id="heading-33">(1) 知识点速览</h4>
<p>核心容器可以简单理解为<code>ApplicationContext</code></p>
<ul>
<li>
<p>容器创建的两种方式</p>
<ul>
<li>ClassPathXmlApplicationContext[掌握]</li>
<li>FileSystemXmlApplicationContext[知道即可]</li>
</ul>
</li>
<li>
<p>获取Bean的三种方式</p>
<ul>
<li>getBean("名称"):需要类型转换</li>
<li>getBean("名称",类型.class):多了一个参数</li>
<li>getBean(类型.class):容器中不能有多个该类的bean对象</li>
</ul>
<p>上述三种方式，各有各的优缺点，用哪个都可以。</p>
</li>
<li>
<p>容器类层次结构</p>
<ul>
<li>只需要知晓容器的最上级的父接口为 BeanFactory即可</li>
</ul>
</li>
<li>
<p>BeanFactory</p>
<ul>
<li>使用BeanFactory创建的容器是延迟加载</li>
<li>使用ApplicationContext创建的容器是立即加载(可通过配置实现延迟加载)</li>
<li>具体BeanFactory如何创建只需要了解即可。</li>
</ul>
</li>
</ul>
<p>bean常用属性</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e4d21dfecab4dcb86f1d1924b7d3426~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn6Ium5Yqb5oCV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763450740&amp;x-signature=FrIavxlzCxm3ork3fxiGpdiyh0o%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>依赖注入常用属性</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d07bb93f8b034ca7b571387522c3baf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn6Ium5Yqb5oCV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763450740&amp;x-signature=hw1PEQxEwnsNm%2BAgmtwoHXQhEtc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-34">(2) 容器的创建方式</h4>
<p>分为<code>类路径下的XML配置文件</code>和<code>文件系统下的XML配置文件</code></p>
<p><strong>类路径下的XML配置文件</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">"applicationContext.xml"</span>);
</code></pre>
<p><strong>文件系统下的XML配置文件</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileSystemXmlApplicationContext</span>(<span class="hljs-string">"D:\\workspace\\spring\\spring_10_container\\src\\main\\resources\\applicationContext.xml"</span>);
</code></pre>
<h4 data-id="heading-35">(3) Bean的三种获取方式</h4>
<p>方式一：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BookDao</span> <span class="hljs-variable">bookDao</span> <span class="hljs-operator">=</span> (BookDao) ctx.getBean(<span class="hljs-string">"bookDao"</span>);
</code></pre>
<p>缺点：需要强转</p>
<p>方式二:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BookDao</span> <span class="hljs-variable">bookDao</span> <span class="hljs-operator">=</span> ctx.getBean(<span class="hljs-string">"bookDao"</span>，BookDao.class);
</code></pre>
<p>缺点：需要多加一个参数</p>
<p>方式三：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BookDao</span> <span class="hljs-variable">bookDao</span> <span class="hljs-operator">=</span> ctx.getBean(BookDao.class);
</code></pre>
<p>缺点：IOC容器中对应的bean对象只能有一个</p>
<h4 data-id="heading-36">(4) BeanFactory的使用</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppForBeanFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Resource</span> <span class="hljs-variable">resources</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">"applicationContext.xml"</span>);
        <span class="hljs-type">BeanFactory</span> <span class="hljs-variable">bf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XmlBeanFactory</span>(resources);
        <span class="hljs-type">BookDao</span> <span class="hljs-variable">bookDao</span> <span class="hljs-operator">=</span> bf.getBean(BookDao.class);
        bookDao.save();
    }
}
</code></pre>
<ul>
<li>
<p>BeanFactory是延迟加载，只有在获取bean对象的时候才会去创建</p>
</li>
<li>
<p>ApplicationContext是立即加载，容器加载的时候就会创建bean对象</p>
</li>
<li>
<p>ApplicationContext要想成为延迟加载，只需要按照如下方式进行配置</p>
</li>
</ul>
<h2 data-id="heading-37">3. DI相关内容</h2>
<p>主要围绕<code>引用类型</code>和<code>简单类型</code>的注入方式进行讲解</p>
<h4 data-id="heading-38">(1) 非注解写法和注意事项</h4>
<h5 data-id="heading-39">&lt;1&gt; 知识点速览</h5>
<h5 data-id="heading-40">&lt;2&gt; 准备工作</h5>
<h5 data-id="heading-41">&lt;3&gt; setter注入</h5>
<p>通过set方法进行注入</p>
<p><strong>引用类型</strong></p>
<p>在配置类中使用<code>propety</code>和<code>ref</code>注入引用类型对象</p>
<pre><code class="hljs language-java" lang="java">    &lt;bean id=<span class="hljs-string">"bookService"</span> class=<span class="hljs-string">"com.itheima.service.impl.BookServiceImpl"</span>&gt;
        &lt;!--property标签：设置注入属性--&gt;
        &lt;!--name属性：设置注入的属性名，实际是set方法对应的名称--&gt;
        &lt;!--ref属性：设置注入引用类型bean的id或name--&gt;
        &lt;property name=<span class="hljs-string">"bookDao"</span> ref=<span class="hljs-string">"bookDao"</span>/&gt;
    &lt;/bean&gt;
</code></pre>
<p>在bean中定义引用数据属性并提供set方法即可</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookService</span>{
    <span class="hljs-keyword">private</span> BookDao bookDao;
    <span class="hljs-comment">//setter注入需要提供要注入对象的set方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBookDao</span><span class="hljs-params">(BookDao bookDao)</span> {
        <span class="hljs-built_in">this</span>.bookDao = bookDao;
    }
}
</code></pre>
<p><strong>简单类型</strong></p>
<p>在配置类中使用<code>propety</code>和<code>value</code>属性注入简单类型数据</p>
<pre><code class="hljs language-xml" lang="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itheima.dao.impl.BookDaoImpl"</span>&gt;</span>
        <span class="hljs-comment">&lt;!--property标签：设置注入属性--&gt;</span>
        <span class="hljs-comment">&lt;!--name属性：设置注入的属性名，实际是set方法对应的名称--&gt;</span>
        <span class="hljs-comment">&lt;!--value属性：设置注入简单类型数据值--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"connectionNum"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"100"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"databaseName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"mysql"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
<h5 data-id="heading-42">&lt;4&gt; 构造器注入</h5>
<p>通过将set方法改为构造方法传参，进行注入</p>
<p><strong>引用注入</strong></p>
<p>配置类使用<code>constructor-arg</code>标签<code>ref</code>属性注入引用类型对象</p>
<pre><code class="hljs language-xml" lang="xml">     <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookService"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itheima.service.impl.BookServiceImpl"</span>&gt;</span> 
           <span class="hljs-comment">&lt;!-- 根据构造方法参数名称注入--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"userDao"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"bookDao"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
<blockquote>
<p>这里的ref指向的是参数，如果改成BookServiceImpl(BookDao bookDao1, UserDao userDao1)，则配置中name指向userDao1和bookDao1</p>
</blockquote>
<p>实现类中定义引用类型属性，并提供构造方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookService</span>{
    <span class="hljs-keyword">private</span> BookDao bookDao;
    <span class="hljs-keyword">private</span> UserDao userDao;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BookServiceImpl</span><span class="hljs-params">(BookDao bookDao, UserDao userDao)</span> {
        <span class="hljs-built_in">this</span>.bookDao = bookDao;
        <span class="hljs-built_in">this</span>.userDao = userDao;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book service save ..."</span>);
        bookDao.save();
        userDao.save();
    }
}
</code></pre>
<p><strong>简单类型</strong></p>
<p>在配置类中使用<code>constructor-arg</code>标签和<code>value</code>属性注入简单类型数据</p>
<pre><code class="hljs language-xml" lang="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itheima.dao.impl.BookDaoImpl"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"databaseName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"mysql"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"connectionNum"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"666"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itheima.dao.impl.UserDaoImpl"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bookService"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.itheima.service.impl.BookServiceImpl"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"bookDao"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"bookDao"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"userDao"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"userDao"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
<p>在实体类添加构造方法</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookDao</span> {
    <span class="hljs-keyword">private</span> String databaseName;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> connectionNum;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BookDaoImpl</span><span class="hljs-params">(String databaseName, <span class="hljs-type">int</span> connectionNum)</span> {
        <span class="hljs-built_in">this</span>.databaseName = databaseName;
        <span class="hljs-built_in">this</span>.connectionNum = connectionNum;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book dao save ..."</span>+databaseName+<span class="hljs-string">","</span>+connectionNum);
    }
}
</code></pre>
<blockquote>
<p>在配置类中，可以添加type属性，按照类型注入，也可以添加index属性，按照索引下标注入</p>
</blockquote>
<h5 data-id="heading-43">&lt;5&gt; 自动装配</h5>
<p>在配置文件中，可以直接添加<code>autowire</code>属性进行注入</p>
<pre><code class="hljs language-java" lang="java">    &lt;bean class=<span class="hljs-string">"com.itheima.dao.impl.BookDaoImpl"</span>/&gt;
    &lt;bean id=<span class="hljs-string">"bookService"</span> class=<span class="hljs-string">"com.itheima.service.impl.BookServiceImpl"</span> autowire=<span class="hljs-string">"byType"</span>/&gt;
</code></pre>
<blockquote>
<p>autowire属性可以按照类型(byType），可以按照名称(byName)
使用按类型装配时（byType）必须保障容器中相同类型的bean唯一，推荐使用
使用按名称装配时（byName）必须保障容器中具有指定名称的bean，因变量名与配置耦合，不推荐使用
自动装配优先级低于setter注入与构造器注入，同时出现时自动装配配置失效</p>
</blockquote>
<h5 data-id="heading-44">&lt;6&gt; 集合注入</h5>
<p>在配置类中直接注入即可</p>
<p>注入数组类型数据</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"array"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>100<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>200<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>300<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
<p>注入List类型数据</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"list"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>itcast<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>itheima<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>boxuegu<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>chuanzhihui<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
<p>注入Set类型数据</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"set"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>itcast<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>itheima<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>boxuegu<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>boxuegu<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
<p>注入Map类型数据</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"map"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"country"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"china"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"province"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"henan"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"city"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"kaifeng"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
<p>注入Properties类型数据</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"properties"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"country"</span>&gt;</span>china<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"province"</span>&gt;</span>henan<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"city"</span>&gt;</span>kaifeng<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
<p>实现类</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookDao</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] array;

    <span class="hljs-keyword">private</span> List&lt;String&gt; list;

    <span class="hljs-keyword">private</span> Set&lt;String&gt; set;

    <span class="hljs-keyword">private</span> Map&lt;String,String&gt; map;

    <span class="hljs-keyword">private</span> Properties properties;

     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book dao save ..."</span>);

        System.out.println(<span class="hljs-string">"遍历数组:"</span> + Arrays.toString(array));

        System.out.println(<span class="hljs-string">"遍历List"</span> + list);

        System.out.println(<span class="hljs-string">"遍历Set"</span> + set);

        System.out.println(<span class="hljs-string">"遍历Map"</span> + map);

        System.out.println(<span class="hljs-string">"遍历Properties"</span> + properties);
    }
}
</code></pre>
<h4 data-id="heading-45">(2) 注解写法和注意事项</h4>
<h5 data-id="heading-46">&lt;1&gt; 知识点速览</h5>
<p>知识点1：@Autowired</p>

























<table><thead><tr><th>名称</th><th>@Autowired</th></tr></thead><tbody><tr><td>类型</td><td>属性注解  或  方法注解（了解）  或  方法形参注解（了解）</td></tr><tr><td>位置</td><td>构造方法、setter方法、字段、配置方法上  或  方法形参前面</td></tr><tr><td>作用</td><td>为引用类型属性设置值</td></tr><tr><td>属性</td><td>required：true/false，定义该属性是否允许为null</td></tr></tbody></table>
<p>知识点2：@Qualifier</p>

























<table><thead><tr><th>名称</th><th>@Qualifier</th></tr></thead><tbody><tr><td>类型</td><td>属性注解  或  方法注解（了解）</td></tr><tr><td>位置</td><td>属性定义上方  或  标准set方法上方  或  类set方法上方</td></tr><tr><td>作用</td><td>为引用类型属性指定注入的beanId</td></tr><tr><td>属性</td><td>value（默认）：设置注入的beanId</td></tr></tbody></table>
<p>知识点3：@Value</p>

























<table><thead><tr><th>名称</th><th>@Value</th></tr></thead><tbody><tr><td>类型</td><td>属性注解  或  方法注解（了解）</td></tr><tr><td>位置</td><td>属性定义上方  或  标准set方法上方  或  类set方法上方</td></tr><tr><td>作用</td><td>为  基本数据类型  或  字符串类型  属性设置值</td></tr><tr><td>属性</td><td>value（默认）：要注入的属性值</td></tr></tbody></table>
<p>知识点4：@PropertySource</p>

























<table><thead><tr><th>名称</th><th>@PropertySource</th></tr></thead><tbody><tr><td>类型</td><td>类注解</td></tr><tr><td>位置</td><td>类定义上方</td></tr><tr><td>作用</td><td>加载properties文件中的属性值</td></tr><tr><td>属性</td><td>value（默认）：设置加载的properties文件对应的文件名或文件名组成的数组</td></tr></tbody></table>
<h5 data-id="heading-47">&lt;2&gt; 改进方案</h5>
<p>通过使用注解，可以按照类型、名称、数据类型，甚至可以读取properties配置文件</p>
<p><strong>按照类型注入</strong></p>
<p>使用<code>@Autowired</code>注解开启自动装配模式</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookService</span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BookDao bookDao;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"save"</span>);
        bookDao.save();
    }
}
</code></pre>
<blockquote>
<p>基于反射设计常见对象，无需提供setter方法，建议使用无参构造方法构建对象</p>
</blockquote>
<p><strong>按照名称注入</strong></p>
<p>使用<code>@Qualifier</code>注解开启指定名称装配bean</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookService</span>{
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@Qualifier("bookDao")</span>
    <span class="hljs-keyword">private</span> BookDao bookDao;
}
</code></pre>
<ul>
<li><code>@Qualifier</code>注解无法单独使用，必须配合<code>@Autowired</code>注解使用</li>
</ul>
<p><strong>简单数据类型注入</strong></p>
<p>使用<code>@Value</code>实现简单类型注入</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Repository("bookDao")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookDao</span>{
    <span class="hljs-meta">@Value("100")</span>
    <span class="hljs-keyword">private</span> String connectionNum;
}
</code></pre>
<p><strong>注解读取properties配置文件</strong></p>
<p>对于如<code>@Qualifier</code>、<code>@Value</code>这种注解，为了防止写死，可以放到properties文件内</p>
<p><strong>使用方法</strong>：</p>
<p>使用<code>@PropertySource</code>注解加载properties文件</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ComponentScan("com.itheima")</span>
<span class="hljs-meta">@PropertySource("classpath:jdbc.properties")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig</span>{
}
</code></pre>
<p><strong>注意:</strong></p>
<ul>
<li>
<p>如果读取的properties配置文件有多个，可以使用<code>@PropertySource</code>的属性来指定多个</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PropertySource({"jdbc.properties","xxx.properties"})</span>
</code></pre>
</li>
<li>
<p><code>@PropertySource</code>注解属性中不支持使用通配符<code>*</code>,运行会报错</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PropertySource({"*.properties"})</span>
</code></pre>
</li>
<li>
<p><code>@PropertySource</code>注解属性中可以把<code>classpath:</code>加上,代表从当前项目的根路径找文件</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PropertySource({"classpath:jdbc.properties"})</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-48">4.AOP相关内容</h2>
<p>AOP(Aspect Oriented Programming)面向切面编程，一种编程范式，指导开发者如何组织程序结构,它可以在不惊动原始设计的基础上为其进行功能增强。</p>
<p>在这里主要学习<code>AOP核心概念</code>和<code>AOP作用</code>，如<code>AOP工作流程</code>、<code>AOP配置管理</code>、<code>AOP事务管理</code></p>
<h3 data-id="heading-49">(1) AOP的核心概念</h3>
<p>概念：AOP(Aspect Oriented Programming)面向切面编程，一种编程范式</p>
<p>作用：在不惊动原始设计的基础上为方法进行功能==增强==</p>
<p>核心概念：</p>
<ul>
<li>代理（Proxy）：SpringAOP的核心本质是采用代理模式实现的</li>
<li>连接点（JoinPoint）：在SpringAOP中，理解为任意方法的执行</li>
<li>切入点（Pointcut）：匹配连接点的式子，也是具有共性功能的方法描述</li>
<li>通知（Advice）：若干个方法的共性功能，在切入点处执行，最终体现为一个方法</li>
<li>切面（Aspect）：描述通知与切入点的对应关系</li>
<li>目标对象（Target）：被代理的原始对象成为目标对象</li>
</ul>
<p>目标对象是要增强的类对应的对象，也叫原始对象。</p>
<p>SpringAOP中式不改变原有代码前提进行增强的，采用的是代理模式，因此对原始对象进行增强，需要对原始方法创建代理对象，在代理对象中的方法把通知加进去，实现了增强，这就是代理。</p>
<h3 data-id="heading-50">(2)  基于注解实现步骤</h3>
<h4 data-id="heading-51">&lt;1&gt; 知识点一览</h4>
<p>知识点1：@EnableAspectJAutoProxy</p>





















<table><thead><tr><th>名称</th><th>@EnableAspectJAutoProxy</th></tr></thead><tbody><tr><td>类型</td><td>配置类注解</td></tr><tr><td>位置</td><td>配置类定义上方</td></tr><tr><td>作用</td><td>开启注解格式AOP功能</td></tr></tbody></table>
<p>知识点2：@Aspect</p>





















<table><thead><tr><th>名称</th><th>@Aspect</th></tr></thead><tbody><tr><td>类型</td><td>类注解</td></tr><tr><td>位置</td><td>切面类定义上方</td></tr><tr><td>作用</td><td>设置当前类为AOP切面类</td></tr></tbody></table>
<p>知识点3：@Pointcut</p>

























<table><thead><tr><th>名称</th><th>@Pointcut</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>切入点方法定义上方</td></tr><tr><td>作用</td><td>设置切入点方法</td></tr><tr><td>属性</td><td>value（默认）：切入点表达式</td></tr></tbody></table>
<p>知识点4：@Before</p>





















<table><thead><tr><th>名称</th><th>@Before</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法前运行</td></tr></tbody></table>
<h4 data-id="heading-52">&lt;2&gt; 准备工作</h4>
<p><strong>准备工作</strong>：创建Maven项目，添加依赖，实现类，配置类，运行类</p>
<p><strong>思路分析</strong>：添加依赖，定义接口与实现类，定义通知类和通知，定义切入点，制作切面,将通知类配给容器，并标识为切面类，开启注解格式AOP功能</p>
<h4 data-id="heading-53">&lt;3&gt; 实现步骤</h4>
<p>添加依赖</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<blockquote>
<p>在<code>spring-context</code>中自动导入了<code>spring-aop</code>，这里是AspectJ，是AOP思想的具体实现</p>
</blockquote>
<p>接口与实现类</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BookDao</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;
}

<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookDao</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(System.currentTimeMillis());
        System.out.println(<span class="hljs-string">"book dao save ..."</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"book dao update ..."</span>);
    }
}
</code></pre>
<p>定义通知类和通知</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdvice</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span>{
        System.out.println(System.currentTimeMillis());
    }
}
</code></pre>
<p>定义切入点(增强update方法)</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdvice</span> {
    <span class="hljs-meta">@Pointcut("execution(void com.Coolipa.dao.BookDao.update())")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pt</span><span class="hljs-params">()</span>{}
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span>{
        System.out.println(System.currentTimeMillis());
    }
}
</code></pre>
<p>制作切面</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdvice</span> {
    <span class="hljs-meta">@Pointcut("execution(void com.itheima.dao.BookDao.update())")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pt</span><span class="hljs-params">()</span>{}
    
    <span class="hljs-meta">@Before("pt()")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span>{
        System.out.println(System.currentTimeMillis());
    }
}
</code></pre>
<p>将通知类配给容器并表示为切面类</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdvice</span> {
    <span class="hljs-meta">@Pointcut("execution(void com.itheima.dao.BookDao.update())")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pt</span><span class="hljs-params">()</span>{}
    
    <span class="hljs-meta">@Before("pt()")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span>{
        System.out.println(System.currentTimeMillis());
    }
}
</code></pre>
<p>开启注解AOP功能</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ComponentScan("com.itheima")</span>
<span class="hljs-meta">@EnableAspectJAutoProxy</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig</span> {
}
</code></pre>
<p>运行程序即可</p>
<h3 data-id="heading-54">(3) AOP工作流程</h3>
<ol>
<li>Spring容器启动，加载bean(需要被增强的类，通知类)，此时bean还没创建</li>
<li>读取所有切面配置中的切入点</li>
<li>初始化bean，将要被实例化bean对象的类中的方法和切入点进行匹配
<ul>
<li>匹配失败，创建原始对象，直接调用原始对象的方法</li>
<li>匹配成功，创建原始对象的代理对象，对其中的方法进行加强</li>
</ul>
</li>
<li>获取bean的执行方法
<ul>
<li>获取bean是原始对象时，调用方法并执行，完成操作</li>
<li>获取bean时代理对象是，运行原始方法与增强的内容，完成操作</li>
</ul>
</li>
</ol>
<h3 data-id="heading-55">(4) AOP配置管理</h3>
<p>这里主要是<code>切入点表达式</code>、<code>AOP通知类型</code>、<code>书写技巧</code></p>
<h4 data-id="heading-56">&lt;1&gt; 切入点表达式</h4>
<ul>
<li>切入点：要被增强的方法</li>
<li>切入点表达式：要进行增强方法的描述方式</li>
</ul>
<blockquote>
<p>切入点表达式格式：execution([修饰符] 返回类型 [声明类型].方法名(参数) [throws 异常])</p>
</blockquote>
<ul>
<li><code>[]</code> 表示可选部分</li>
<li>修饰符：public、private等，通常省略</li>
<li>返回类型：方法返回值类型，使用<code>*</code>匹配任意类型</li>
<li>包名.类名：完整的类路径，可以使用<code>..</code>匹配多级包</li>
<li>方法名：具体方法名，可以使用<code>*</code>通配符</li>
<li>参数：参数类型列表，<code>()</code>表示无参数，<code>(..)</code>表示任意参数</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">execution</span>(<span class="hljs-keyword">public</span> User com.example.service.UserService.<span class="hljs-built_in">findById</span>(<span class="hljs-type">int</span>))
</code></pre>
<ul>
<li><code>*</code>：通配符，可以单独出现，可以作为前后缀</li>
<li><code>..</code>：通配符，多个连续的任意符号，用于简化包名与参数书写</li>
<li><code>+</code>：通配符，匹配子类类型</li>
</ul>
<p><strong>注意事项</strong>：</p>
<ol>
<li>按<strong>标准规范</strong>开发</li>
<li>查询操作的返回值建议使用*匹配</li>
<li>减少使用..的形式描述包</li>
<li><strong>对接口进行描述</strong>，使用*表示模块名，例如UserService的匹配描述为*Service</li>
<li>方法名书写保留动词，例如get，使用*表示名词，例如getById匹配描述为getBy*</li>
<li>参数根据实际情况灵活调整</li>
</ol>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-java" lang="java">execution(<span class="hljs-keyword">void</span> com.itheima.dao.BookDao.update())
匹配接口，能匹配到
execution(<span class="hljs-keyword">void</span> com.itheima.dao.impl.BookDaoImpl.update())
匹配实现类，能匹配到
execution(* com.itheima.dao.impl.BookDaoImpl.update())
返回值任意，能匹配到
execution(* com.itheima.dao.impl.BookDaoImpl.update(*))
返回值任意，但是update方法必须要有一个参数，无法匹配，要想匹配需要在update接口和实现类添加参数
execution(<span class="hljs-keyword">void</span> com.*.*.*.*.update())
返回值为<span class="hljs-keyword">void</span>,com包下的任意包三层包下的任意类的update方法，匹配到的是实现类，能匹配
execution(<span class="hljs-keyword">void</span> com.*.*.*.update())
返回值为<span class="hljs-keyword">void</span>,com包下的任意两层包下的任意类的update方法，匹配到的是接口，能匹配
execution(<span class="hljs-keyword">void</span> *..update())
返回值为<span class="hljs-keyword">void</span>，方法名是update的任意包下的任意类，能匹配
execution(* *..*(..))
匹配项目中任意类的任意方法，能匹配，但是不建议使用这种方式，影响范围广
execution(* *..u*(..))
匹配项目中任意包任意类下只要以u开头的方法，update方法能满足，能匹配
execution(* *..*e(..))
匹配项目中任意包任意类下只要以e结尾的方法，update和save方法能满足，能匹配
execution(<span class="hljs-keyword">void</span> com..*())
返回值为<span class="hljs-keyword">void</span>，com包下的任意包任意类任意方法，能匹配，*代表的是方法
execution(* com.itheima.*.*Service.find*(..))
将项目中所有业务层方法的以find开头的方法匹配
execution(* com.itheima.*.*Service.save*(..))
将项目中所有业务层方法的以save开头的方法匹配
</code></pre>
<h4 data-id="heading-57">&lt;2&gt; AOP通知类型</h4>
<h6 data-id="heading-58">a.知识点总结</h6>
<ul>
<li>前置通知</li>
<li>后置通知</li>
<li>环绕通知（重点）
<ul>
<li>环绕通知依赖形参ProceedingJoinPoint才能实现对原始方法的调用</li>
<li>环绕通知可以隔离原始方法的调用执行</li>
<li>环绕通知返回值设置为Object类型</li>
<li>环绕通知中可以对原始方法调用过程中出现的异常进行处理</li>
</ul>
</li>
<li>返回后通知</li>
<li>抛出异常后通知</li>
</ul>
<p>知识点1：@After</p>





















<table><thead><tr><th>名称</th><th>@After</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法后运行</td></tr></tbody></table>
<p>知识点2：@AfterReturning</p>





















<table><thead><tr><th>名称</th><th>@AfterReturning</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间绑定关系，当前通知方法在原始切入点方法正常执行完毕后执行</td></tr></tbody></table>
<p>知识点3：@AfterThrowing</p>





















<table><thead><tr><th>名称</th><th>@AfterThrowing</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间绑定关系，当前通知方法在原始切入点方法运行抛出异常后执行</td></tr></tbody></table>
<p>知识点4：@Around</p>





















<table><thead><tr><th>名称</th><th>@Around</th></tr></thead><tbody><tr><td>类型</td><td>方法注解</td></tr><tr><td>位置</td><td>通知方法定义上方</td></tr><tr><td>作用</td><td>设置当前通知方法与切入点之间的绑定关系，当前通知方法在原始切入点方法前后运行</td></tr></tbody></table>
<h6 data-id="heading-59">b. 实现</h6>
<p>修改MyAdvice，在方法上加上对应注解即可,前置<code>@Before</code>、后置<code>@After</code>、环绕<code>@Around</code>、返回后通知<code>@AfterReturning</code>、异常后通知<code>@AfterThrowing  </code></p>
<p><strong>前置通知示例</strong>：除了环绕通知，其他基本如下</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdvice</span> {
    <span class="hljs-meta">@Pointcut("execution(void com.itheima.dao.BookDao.update())")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pt</span><span class="hljs-params">()</span>{}
    
    <span class="hljs-meta">@Before("pt()")</span>
    <span class="hljs-comment">//此处也可以写成 @Before("MyAdvice.pt()"),不建议</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"before advice ..."</span>);
    }
}
</code></pre>
<p><strong>环绕通知</strong>：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Around("pt2()")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">aroundSelect</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable {
        System.out.println(<span class="hljs-string">"around before advice ..."</span>);
        <span class="hljs-comment">//表示对原始操作的调用</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> pjp.proceed();
        System.out.println(<span class="hljs-string">"around after advice ..."</span>);
        <span class="hljs-keyword">return</span> ret;
    }
</code></pre>
<p><strong>环绕通知注意事项</strong></p>
<ol>
<li><strong>必须使用ProceedingJoinPoint</strong>：环绕通知必须依赖<code>ProceedingJoinPoint</code>参数才能调用原始方法</li>
<li><strong>必须调用proceed()</strong>：如果不调用<code>pjp.proceed()</code>，原始方法将被跳过</li>
<li><strong>返回值类型</strong>：建议设置为<code>Object</code>类型以兼容各种返回值</li>
<li><strong>异常处理</strong>：必须处理<code>Throwable</code>异常，因为无法预知原始方法是否会抛出异常</li>
<li><strong>void方法处理</strong>：即使原始方法返回void，环绕通知也可以返回Object或void</li>
</ol>
<p>示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Around("pt()")</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable {
    <span class="hljs-comment">// 前置逻辑</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> pjp.proceed(); <span class="hljs-comment">// 调用原始方法</span>
    <span class="hljs-comment">// 后置逻辑</span>
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h4 data-id="heading-60">&lt;3&gt; AOP通知获取参数</h4>
<p><strong>准备工作</strong>：Maven项目，依赖，实现类，配置类，通知类</p>
<p><strong>思路分析</strong>：通过<code>JoinPoint</code>获得参数，通过<code>getArgs()</code>从环绕通知获得参数，通过<code>AfterReturning</code>和<code>Around</code>获得返回值，通过<code>AfterThrowing</code>和<code>Around</code>获得异常</p>
<h5 data-id="heading-61">(1) 获取参数(⭐)</h5>
<p><strong>非环绕通知获取方式</strong></p>
<p>此方法适用于<code>前置</code>、<code>后置</code>、<code>返回后</code>、<code>抛出异常后</code>通知。</p>
<ul>
<li>JoinPoint对象描述了连接点方法的运行状态，可以获取到原始方法的调用参数</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Before("pt()")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">(JoinPoint jp)</span>{
    Object[] args = jp.getArgs();
    System.out.println(Arrays.toString(args));
}
</code></pre>
<p><strong>环绕通知获取方式</strong></p>
<p>通过<code>getArgs()</code>方法获取</p>
<ul>
<li>ProceedJointPoint是JoinPoint的子类</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Around("pt()")</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable {
    Object[] args = pjp.getArgs();
    System.out.println(Arrays.toString(args));
    <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> pjp.proceed();
    <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<h5 data-id="heading-62">(2) 获取返回值</h5>
<p>只有返回后<code>AfterReturing</code>和环绕<code>Around</code>这两个通知类型可以获取</p>
<p><strong>环绕通知获取返回值</strong></p>
<blockquote>
<p><code>ret</code>是方法的返回值</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Around("pt()")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable{
        Object[] args = pjp.getArgs();
        System.out.println(Arrays.toString(args));
        args[<span class="hljs-number">0</span>] = <span class="hljs-number">666</span>;
        <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> pjp.proceed(args);
        <span class="hljs-keyword">return</span> ret;
    }
</code></pre>
<p><strong>返回后通知获取返回值</strong></p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@AfterReturning(value = "pt()",returning = "ret")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterReturning</span><span class="hljs-params">(Object ret)</span> {
        System.out.println(<span class="hljs-string">"afterReturning advice ..."</span>+ret);
    }
</code></pre>
<h5 data-id="heading-63">(3) 获取异常(了解)</h5>
<p>只有抛出异常后<code>AfterThrowing</code>和环绕<code>Around</code>这两个通知类型可以获取</p>
<p><strong>环绕通知获取异常</strong></p>
<p>将异常捕获即可</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Around("pt()")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span>{
        Object[] args = pjp.getArgs();
        System.out.println(Arrays.toString(args));
        args[<span class="hljs-number">0</span>] = <span class="hljs-number">666</span>;
        <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span>{
            ret = pjp.proceed(args);
        }<span class="hljs-keyword">catch</span>(Throwable throwable){
            t.printStackTrace();
        }
        <span class="hljs-keyword">return</span> ret;
    }
</code></pre>
<p><strong>获取异常</strong></p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@AfterThrowing(value = "pt()",throwing = "t")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterThrowing</span><span class="hljs-params">(Throwable t)</span> {
        System.out.println(<span class="hljs-string">"afterThrowing advice ..."</span>+t);
    }
</code></pre>
<h3 data-id="heading-64">(5) AOP事务管理</h3>
<h4 data-id="heading-65">&lt;1&gt; 知识点总览</h4>
<p>事务：在数据层或业务层保障一系列的数据库操作同成功失败
通过<code>@Transactional</code>注解实现，可拓展属性
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bb56582307c4486b7f344795d06b1af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn6Ium5Yqb5oCV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763450740&amp;x-signature=u0dk25zFwp8U8R4VFLwza9upOws%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-66">&lt;2&gt; 概念</h4>
<ul>
<li>事务作用：在数据层保障一系列的数据库操作同成功同失败</li>
<li>Spring事务作用：在数据层或<strong>业务层</strong>保障一系列的数据库操作同成功同失败</li>
</ul>
<h4 data-id="heading-67">&lt;3&gt; 快速使用</h4>
<p>在Spring中，提供了<code>PlatformTransactionManager</code>平台事务管理器</p>
<ol>
<li>
<p>在方法上添加<code>@Transactional</code>注解</p>
<pre><code class="hljs language-java" lang="java">	<span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(String out,String in ,Double money)</span> {
        accountDao.outMoney(out,money);
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;
        accountDao.inMoney(in,money);
    }
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cee5cb3b4354b7b9aae80a0aef281bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn6Ium5Yqb5oCV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763450740&amp;x-signature=ctcHrrQgpztT5YNXZMu%2FBDKfTqY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</li>
</ol>
<p>上面这些属性都可以在<code>@Transactional</code>注解的参数上进行设置。</p>
<ul>
<li>
<p>readOnly：true只读事务，false读写事务，增删改要设为false,查询设为true。</p>
</li>
<li>
<p>timeout:设置超时时间单位秒，在多长时间之内事务没有提交成功就自动回滚，-1表示不设置超时时间。</p>
</li>
<li>
<p>rollbackFor:当出现指定异常进行事务回滚</p>
</li>
<li>
<p>noRollbackFor:当出现指定异常不进行事务回滚</p>
</li>
</ul>
<ol start="2">
<li>在Config类中配置事务管理器</li>
</ol>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">//配置事务管理器，mybatis使用的是jdbc事务</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title function_">transactionManager</span><span class="hljs-params">(DataSource dataSource)</span>{
        <span class="hljs-type">DataSourceTransactionManager</span> <span class="hljs-variable">transactionManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceTransactionManager</span>(dataSource);
        transactionManager.setDataSource(dataSource);
        <span class="hljs-keyword">return</span> transactionManager;
    }
</code></pre>
<ol start="3">
<li>在配置类中开启即可</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//开启注解式事务驱动</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfig</span> {
}
</code></pre>
<p>@Transactional可以写在接口类上、接口方法上、实现类上和实现类方法上</p>
<ul>
<li>写在接口类上，该接口的所有实现类的所有方法都会有事务</li>
<li>写在接口方法上，该接口的所有实现类的该方法都会有事务</li>
<li>写在实现类上，该类中的所有方法都会有事务</li>
<li>写在实现类方法上，该方法上有事务</li>
<li>建议写在实现类或实现类的方法上</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在本地部署腾讯混元大模型并连接到 Elasticsearch 进行使用]]></title>    <link>https://juejin.cn/post/7570999443446726692</link>    <guid>https://juejin.cn/post/7570999443446726692</guid>    <pubDate>2025-11-11T06:36:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570999443446726692" data-draft-id="7571005216910802963" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在本地部署腾讯混元大模型并连接到 Elasticsearch 进行使用"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-11-11T06:36:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在本地部署腾讯混元大模型并连接到 Elasticsearch 进行使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:36:32.000Z" title="Tue Nov 11 2025 06:36:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/695b250221354a71a4c49df39e76e522~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=hegcqwKQ106I5bnkix18GQOFIls%3D" alt="" loading="lazy"/></p>
<p>腾讯混元大模型由腾讯公司全链路自研，在高质量的内容创作、数理逻辑、代码生成、多轮对话、图像与视频生产上性能表现优越，处于业界领先水平。我一直想在我自己的电脑上安装并试用。在本文中，我将详细描述安装过程并连接到 Elasticsearch。</p>
<blockquote>
<p><strong>注意</strong>：一下展示使用最新的 Elastic Stack 9.2.0。其界面可能和之前的有的版本有所不同。</p>
</blockquote>
<h2 data-id="heading-0">安装混元大模型</h2>
<p>我希望使用 Ollama 来进行安装。很可惜，目前混元大模型还不支持 <a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2Fsearch" title="https://ollama.com/search" target="_blank" ref="nofollow noopener noreferrer">Ollama</a> 按照。我在国内的网站上搜索了一下，很少有详细介绍如何安装的。腾讯混元-4B（及更小的变体）可以与 Ollama 一起使用，但目前还不能直接开箱即用。你需要使用与 llama.cpp 兼容的 GGUF 量化版本，然后将其包装为自定义 Ollama 模型。</p>
<p>Ollama 使用 llama.cpp 引擎，它支持 GGUF 格式的模型 —— 包括经过转换或已下载为 GGUF 格式的 Hunyuan-4B。</p>
<p>Hugging Face 上已经有一个可直接使用的量化版本：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fmradermacher%2FHunyuan-4B-Instruct-GGUF%3Futm_source%3Dchatgpt.com" title="https://huggingface.co/mradermacher/Hunyuan-4B-Instruct-GGUF?utm_source=chatgpt.com" target="_blank" ref="nofollow noopener noreferrer">mradermacher/Hunyuan-4B-Instruct-GGUF</a></p>
<p>详细安装步骤：</p>
<h3 data-id="heading-1"><strong>步骤 1：安装 Ollama</strong></h3>
<p>从 <a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2Fdownload" title="https://ollama.com/download" target="_blank" ref="nofollow noopener noreferrer">Download Ollama on macOS</a> 下载适用于 macOS、Windows 或 Linux 的 Ollama。</p>
<p>按照安装程序的指引完成安装，安装完成后，在终端运行以下命令进行验证：</p>
<pre><code class="hljs language-css" lang="css">`ollama <span class="hljs-attr">--version</span>`AI写代码
</code></pre>

<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  $ ollama --version
<span class="hljs-bullet">2.</span>  ollama version is 0.12.9

`AI写代码
</code></pre>
<h3 data-id="heading-2"><strong>步骤 2：下载</strong> GGUF model</h3>
<p>从这些版本中选择一个（例如 Q4_K_M，以平衡质量和速度）：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  <span class="hljs-built_in">mkdir</span> -p ~/.ollama/models/hunyuan-4b
2.  <span class="hljs-built_in">cd</span> ~/.ollama/models/hunyuan-4b
3.  curl -L -O https://huggingface.co/mradermacher/Hunyuan-4B-Instruct-GGUF/resolve/main/Hunyuan-4B-Instruct.Q4_K_M.gguf

`AI写代码
</code></pre>

<pre><code class="hljs language-bash" lang="bash">`

1.  $ <span class="hljs-built_in">ls</span> .ollama/models/
2.  blobs     manifests
3.  $ <span class="hljs-built_in">mkdir</span> -p ~/.ollama/models/hunyuan-4b
4.  $ <span class="hljs-built_in">ls</span> ~/.ollama/models
5.  blobs      hunyuan-4b manifests
6.  $ <span class="hljs-built_in">cd</span> ~/.ollama/models/hunyuan-4b
7.  $ curl -L -O https://huggingface.co/mradermacher/Hunyuan-4B-Instruct-GGUF/resolve/main/Hunyuan-4B-Instruct.Q4_K_M.gguf
8.    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
9.                                   Dload  Upload   Total   Spent    Left  Speed
10.  100  1353  100  1353    0     0    966      0  0:00:01  0:00:01 --:--:--   966
11.  100 2486M  100 2486M    0     0  5854k      0  0:07:14  0:07:14 --:--:-- 4677k

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<h3 data-id="heading-3">步骤 3 – 创建自定义 Modelfile</h3>
<p>在 ~/.ollama/models/hunyuan-4b/Modelfile 中创建以下内容：</p>
<pre><code class="hljs language-python" lang="python">`

<span class="hljs-number">1.</span>  FROM ./Hunyuan-4B-Instruct.Q4_K_M.gguf

<span class="hljs-number">3.</span>  PARAMETER temperature <span class="hljs-number">0.7</span>
<span class="hljs-number">4.</span>  PARAMETER top_p <span class="hljs-number">0.9</span>
<span class="hljs-number">5.</span>  PARAMETER num_ctx <span class="hljs-number">4096</span>

<span class="hljs-number">7.</span>  TEMPLATE <span class="hljs-string">"""{{ .System }}
8.  User: {{ .Prompt }}
9.  Assistant:"""</span>

<span class="hljs-number">11.</span>  SYSTEM <span class="hljs-string">"You are Hunyuan, a helpful Chinese assistant developed by Tencent."</span>

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>

<pre><code class="hljs language-bash" lang="bash">`$ vi ~/.ollama/models/hunyuan-4b/Modelfile` AI写代码
</code></pre>
<h3 data-id="heading-4">步骤 4 – 在 Ollama 中注册模型</h3>
<pre><code class="hljs language-bash" lang="bash">`ollama create hunyuan-4b -f ~/.ollama/models/hunyuan-4b/Modelfile` AI写代码
</code></pre>

<pre><code class="hljs language-markdown" lang="markdown">`1.  $ ollama create hunyuan-4b -f ~/.ollama/models/hunyuan-4b/Modelfile
<span class="hljs-bullet">2.</span>  gathering model components ⠸ 
<span class="hljs-bullet">3.</span>  gathering model components 
<span class="hljs-bullet">4.</span>  copying file sha256:def49bb81ddbecf7c2e3aa557716b915607c6fd3af7e73316c16464321d5da22 100% 
<span class="hljs-bullet">5.</span>  parsing GGUF 
<span class="hljs-bullet">6.</span>  using existing layer sha256:def49bb81ddbecf7c2e3aa557716b915607c6fd3af7e73316c16464321d5da22 
<span class="hljs-bullet">7.</span>  creating new layer sha256:8e48700b8cb5619c3a31e83a13a321070a62ee259d91e1b81b1d2b9eda4a459f 
<span class="hljs-bullet">8.</span>  creating new layer sha256:7127d492f5e2ee2a8d4fbfd439094e35f3c13ebc9f07f6e9c9fd64f9cc243f16 
<span class="hljs-bullet">9.</span>  creating new layer sha256:dedcbf3159e051675ba89642680de2bbfcac020a3f2c1afde851e27629484659 
<span class="hljs-bullet">10.</span>  writing manifest 
<span class="hljs-bullet">11.</span>  success` AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<h3 data-id="heading-5">步骤 5 – 运行模型</h3>
<pre><code class="hljs language-arduino" lang="arduino">`ollama run hunyuan<span class="hljs-number">-4b</span>` AI写代码
</code></pre>

<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  $ ollama run hunyuan-4b
<span class="hljs-bullet">2.</span>  &gt;&gt;&gt; what is Elastic?
<span class="hljs-bullet">3.</span>   1. <span class="hljs-strong">**Definition:**</span> Elastic refers to the ability of an object or system to change shape or size in response to 
<span class="hljs-bullet">4.</span>  external forces without permanent deformation. In simpler terms, it means "bending" or "stretching".
<span class="hljs-bullet">5.</span>  2. <span class="hljs-strong">**Types of Elasticity:**</span>
<span class="hljs-bullet">6.</span>      * <span class="hljs-strong">**Elastic (or Young's Modulus):**</span> The property where an object returns to its original shape after the 
<span class="hljs-bullet">7.</span>  force is removed.
<span class="hljs-bullet">8.</span>      * <span class="hljs-strong">**Yield:**</span> When an object deforms permanently even without a constant force applied, it is called yield. A 
<span class="hljs-bullet">9.</span>  material that exhibits both elastic and yield properties is called "durable".
<span class="hljs-bullet">10.</span>  3. <span class="hljs-strong">**Applications of Elasticity in Physics:**</span>
<span class="hljs-bullet">11.</span>      * <span class="hljs-strong">**Coding (Elastic Database):**</span> Elastic is the name given to the database system by MongoDB.
<span class="hljs-bullet">12.</span>      * <span class="hljs-strong">**Engineering:**</span> Elasticity is used in designing structures like bridges, buildings, etc., ensuring they 
<span class="hljs-bullet">13.</span>  can withstand external forces without permanent deformation.
<span class="hljs-bullet">14.</span>      * <span class="hljs-strong">**Biology:**</span> Elastic tissues such as muscle and skin are involved in various functions in living organisms.
<span class="hljs-bullet">15.</span>  4. <span class="hljs-strong">**Elasticity in Software Engineering:**</span> The term "elastic" is often used to describe systems that have the 
<span class="hljs-bullet">16.</span>  ability to change their structure or behavior dynamically, adapting to changes in the environment or user input 
<span class="hljs-bullet">17.</span>  without a need for complex code modifications.
<span class="hljs-bullet">18.</span>  5. <span class="hljs-strong">**Elasticity in Physics (Reinforced Elasticity):**</span> A phenomenon where materials undergo multiple rounds of 
<span class="hljs-bullet">19.</span>  deformation before returning to their original shape (e.g., rubber bands). This is useful in applications like 
<span class="hljs-bullet">20.</span>  car tires, where repeated pressure and release causes small changes in the tire's shape, improving fuel 
<span class="hljs-bullet">21.</span>  efficiency.
<span class="hljs-bullet">22.</span>  <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">think</span>&gt;</span></span>
<span class="hljs-bullet">23.</span>  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">answer</span>&gt;</span></span>
<span class="hljs-bullet">24.</span>  Okay, let's break down what "Elastic" means.

<span class="hljs-bullet">26.</span>  1.  <span class="hljs-strong">**Core Definition:**</span> In a broad sense, "elasticity" refers to the property of an object or material that can 
<span class="hljs-bullet">27.</span>  change its shape or size when subjected to stress (force) and return to its original shape after the stress is 
<span class="hljs-bullet">28.</span>  removed.
<span class="hljs-bullet">29.</span>      *   Think of stretching a rubber band: it gets longer (deforms), and if you let go, it snaps back to its 
<span class="hljs-bullet">30.</span>  original length. That's elastic deformation.

<span class="hljs-bullet">32.</span>  2.  <span class="hljs-strong">**Types in Physics:**</span>
<span class="hljs-bullet">33.</span>      *   <span class="hljs-strong">**Elastic Deformation:**</span> The object returns to its original shape after the force is removed. Examples 
<span class="hljs-bullet">34.</span>  include a spring or a metal rod.
<span class="hljs-bullet">35.</span>      *   <span class="hljs-strong">**Yield (or Ductile Deformation):**</span> The object deforms permanently even without constant stress, and 
<span class="hljs-bullet">36.</span>  sometimes it will later return to some extent. A material that can undergo both elastic and yield deformation is 
<span class="hljs-bullet">37.</span>  called "ductile."
<span class="hljs-bullet">38.</span>      *   <span class="hljs-strong">**Plastic Deformation:**</span> Permanent shape changes that cannot be easily reversed by the removal of stress.

<span class="hljs-bullet">40.</span>  3.  <span class="hljs-strong">**Why Elasticity Matters (Applications):**</span>
<span class="hljs-bullet">41.</span>      *   <span class="hljs-strong">**Engineering &amp; Architecture:**</span> Designing buildings, bridges, and other structures allows for them to 
<span class="hljs-bullet">42.</span>  withstand external forces like wind, earthquakes, or traffic loads without collapsing permanently.
<span class="hljs-bullet">43.</span>      *   <span class="hljs-strong">**Biology:**</span> Muscles and skin are elastic tissues that allow movement and flexibility in living 
<span class="hljs-bullet">44.</span>  organisms.
<span class="hljs-bullet">45.</span>      *   <span class="hljs-strong">**Physics &amp; Chemistry (Elastic Bands):**</span> Used in demonstrations of elasticity, as mentioned 
<span class="hljs-bullet">46.</span>  above.
<span class="hljs-bullet">47.</span>      *   <span class="hljs-strong">**Materials Science:**</span> Understanding how different materials respond to stress helps in selecting the 
<span class="hljs-bullet">48.</span>  right material for specific applications.

<span class="hljs-bullet">50.</span>  4.  <span class="hljs-strong">**"Elastic" in Software Development:**</span>
<span class="hljs-bullet">51.</span>      *   While not a physical property like in physics or engineering, the term "elastic" is often used 
<span class="hljs-bullet">52.</span>  metaphorically in software development:
<span class="hljs-bullet">53.</span>          *   An <span class="hljs-strong">**Elastic Database**</span> (like MongoDB) is designed to scale up and down automatically when the number 
<span class="hljs-bullet">54.</span>  of users or data grows. It can handle increased load without requiring manual intervention from developers.
<span class="hljs-bullet">55.</span>          *   An <span class="hljs-strong">**Elastic System**</span> can adapt its behavior or structure dynamically in response to changes, making 
<span class="hljs-bullet">56.</span>  it more flexible and resilient than a rigid system.

<span class="hljs-bullet">58.</span>  In summary, "elastic" describes something that can stretch (or compress) and return to its original state. This 
<span class="hljs-bullet">59.</span>  property is crucial for many physical systems and also leads to the concept of scalable and adaptable software 
<span class="hljs-bullet">60.</span>  architectures.
<span class="hljs-bullet">61.</span>  <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">answer</span>&gt;</span></span>

<span class="hljs-bullet">63.</span>  &gt;&gt;&gt; What is Elasticsearch?
<span class="hljs-bullet">64.</span>   Okay, let's break down what "Elasticsearch" means.

<span class="hljs-bullet">66.</span>  1.  <span class="hljs-strong">**Elastic as a Metaphor:**</span> The name comes from the Greek adjective "ellastos," meaning "to stretch." In the 
<span class="hljs-bullet">67.</span>  context of computing, it refers to the ability of software systems to scale and adapt dynamically without 
<span class="hljs-bullet">68.</span>  requiring manual intervention or complex code changes.
<span class="hljs-bullet">69.</span>  2.  <span class="hljs-strong">**Core Concept - Scalability &amp; Elasticity:**</span>
<span class="hljs-bullet">70.</span>      *   <span class="hljs-strong">**Scalability (Up-Scaling):**</span> The system can handle a significantly larger number of users or data volume 
<span class="hljs-bullet">71.</span>  without performance degradation or crashes. For example, when more people start using a web application, the 
<span class="hljs-bullet">72.</span>  database can automatically add more capacity.
<span class="hljs-bullet">73.</span>      *   <span class="hljs-strong">**Elasticity (Auto-Sharding &amp; Rebalancing):**</span> When the load on an Elasticsearch node decreases, it can 
<span class="hljs-bullet">74.</span>  remove resources from that node and move them to other nodes with less load. Conversely, if a node becomes 
<span class="hljs-bullet">75.</span>  overloaded, it can be assigned new clients or data chunks. This automatic distribution of work keeps the system 
<span class="hljs-bullet">76.</span>  balanced and responsive.

<span class="hljs-bullet">78.</span>  3.  <span class="hljs-strong">**Analogy:**</span> Think of your car's engine or brakes being "elastic." If you use more gas (stress), the engine 
<span class="hljs-bullet">79.</span>  heats up slightly. When you let off the gas and turn it off, the heat dissipates back to normal (returns to 
<span class="hljs-bullet">80.</span>  original state). Similarly, Elasticsearch manages its resources dynamically based on current load.

<span class="hljs-bullet">82.</span>  4.  <span class="hljs-strong">**Why Use Elasticsearch?**</span>
<span class="hljs-bullet">83.</span>      *   <span class="hljs-strong">**High Availability &amp; Fault Tolerance:**</span> It's designed for distributed systems, making it resilient even 
<span class="hljs-bullet">84.</span>  if some nodes or data shards fail.
<span class="hljs-bullet">85.</span>      *   <span class="hljs-strong">**Real-time Search and Analytics:**</span> It excels at quickly indexing large amounts of text (like website 
<span class="hljs-bullet">86.</span>  content) and retrieving relevant information in near real-time.
<span class="hljs-bullet">87.</span>      *   <span class="hljs-strong">**Distributed Nature:**</span> Data is sharded across many machines, allowing for massive storage and retrieval 
<span class="hljs-bullet">88.</span>  capabilities far beyond a single machine's limits.
<span class="hljs-bullet">89.</span>      *   <span class="hljs-strong">**Suitable for Log Data &amp; Large Datasets:**</span> It's commonly used to store and analyze logs from 
<span class="hljs-bullet">90.</span>  applications, servers, or IoT devices.

<span class="hljs-bullet">92.</span>  5.  <span class="hljs-strong">**Common Use Cases:**</span>
<span class="hljs-bullet">93.</span>      *   <span class="hljs-strong">**Search Engines (like Solr):**</span> Elasticsearch powers much of Google Search (as part of the search 
<span class="hljs-bullet">94.</span>  infrastructure).
<span class="hljs-bullet">95.</span>      *   <span class="hljs-strong">**Log Management &amp; Monitoring:**</span> Storing and analyzing application logs for performance monitoring and 
<span class="hljs-bullet">96.</span>  troubleshooting.
<span class="hljs-bullet">97.</span>      *   <span class="hljs-strong">**Data Indexing/Analysis:**</span> As a backend database for applications that need to perform complex queries 
<span class="hljs-bullet">98.</span>  or aggregations on large datasets.
<span class="hljs-bullet">99.</span>      *   <span class="hljs-strong">**Real-time Analytics Dashboards.**</span>

<span class="hljs-bullet">101.</span>  In essence, Elasticsearch is a distributed, fault-tolerant search engine designed for high scalability and 
<span class="hljs-bullet">102.</span>  elasticity in the context of data indexing, retrieval, and analysis. It's a fundamental technology for modern 
<span class="hljs-bullet">103.</span>  data-driven applications.
<span class="hljs-bullet">104.</span>  <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">answer</span>&gt;</span></span>

<span class="hljs-bullet">106.</span>  &gt;&gt;&gt; 中国最长的河流是哪条河？
<span class="hljs-bullet">107.</span>   中国最长的河流是<span class="hljs-strong">**长江**</span>。

<span class="hljs-bullet">109.</span>  *   <span class="hljs-strong">**长度：**</span>约6,300公里。这是一条非常长的河流，也是亚洲第一长河。
<span class="hljs-bullet">110.</span>  *   <span class="hljs-strong">**流经地区：**</span>发源于青海省青藏高原的唐古拉山脉各拉丹冬峰西南侧（还有说法认为发源于四川的沱沱河），自西向东流经
<span class="hljs-bullet">111.</span>  青海、西藏、四川、云南、重庆、湖北、湖南、江西、安徽、江苏、上海11个省级行政区，最后注入东海。
<span class="hljs-bullet">112.</span>  *   <span class="hljs-strong">**流域面积：**</span>约94万平方公里。
<span class="hljs-bullet">113.</span>  *   <span class="hljs-strong">**重要性：**</span>
<span class="hljs-bullet">114.</span>      *   <span class="hljs-strong">**经济命脉：**</span>是长江经济带的核心，对促进沿线地区的经济发展至关重要。长江沿岸拥有全国大部分的重要城市和经济
<span class="hljs-bullet">115.</span>  带核心区域。
<span class="hljs-bullet">116.</span>      *   <span class="hljs-strong">**农业灌溉：**</span>提供大量灌溉用水，支撑着沿岸的农业发展。
<span class="hljs-bullet">117.</span>      *   <span class="hljs-strong">**航运价值高：**</span>拥有黄金水道之称，通航里程长，货运量巨大，是中国乃至世界重要的内河运输通道之一（部分河段如
<span class="hljs-bullet">118.</span>  南京到武汉的长江航道已通江）。
<span class="hljs-bullet">119.</span>      *   <span class="hljs-strong">**生态与旅游：**</span>拥有丰富的生物多样性和独特的自然景观，是重要的水电资源和旅游资源。
<span class="hljs-bullet">120.</span>      *   <span class="hljs-strong">**国防意义：**</span>其地理形势对维护国家安全和领土完整具有重要意义。

<span class="hljs-bullet">122.</span>  因此，无论是从长度还是经济、社会等综合角度来看，长江都是中国最重要的河流之一。
<span class="hljs-bullet">123.</span>  <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">answer</span>&gt;</span></span>



`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)收起代码块![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/arrowup-line-top-White.png</span>)
</code></pre>
<p>我们可以在另外一个 termninal 中打入如下的命令来进行测试：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">`

<span class="hljs-number">1</span>.  curl http://localhost:<span class="hljs-number">11434</span>/api/generate -d <span class="hljs-comment">'{</span>
<span class="hljs-number">2</span>.    <span class="hljs-string">"model"</span>: <span class="hljs-string">"hunyuan-4b"</span>,
<span class="hljs-number">3</span>.    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">false</span>,
<span class="hljs-number">4</span>.    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"What is hybrid search in Elasticsearch?"</span>
<span class="hljs-number">5</span>.  }<span class="hljs-comment">'</span>

`AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1ee9eb241154c71a64b409e599721cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=mKZm45jrC7MDoWDdocq0liY3f10%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">连接到 Elasticsearch</h2>
<p>接下来，我们可以参考文章 “<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F145532862" title="https://elasticstack.blog.csdn.net/article/details/145532862" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch：在 Elastic 中玩转 DeepSeek R1 来实现 RAG 应用</a>” 来连接到 Elasticsearch。首先我们按照该文中描述的那样安装好自己的 Elasticsearch 及 Kibana，并安装好 E5 模型。</p>
<h3 data-id="heading-7">创建 Connector</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0c66337d9ff46ba96ca7b8f0bc8bce4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=ZNSXRBWx62eE%2BVKKP%2B%2FuYCn3O7Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2815a965a0a4d5aa2e57ce17af6011f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=%2Fqp7NiBdbHluNh2grUzMfvF3s3A%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/408b206286454c548341b6cf8168a978~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=AdVYeItqFmgEBQE3lhtNQEEEfKg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/114fd7a8fbe54f76bad058362c96105c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=T0QikNVQinDNtN4eqvOlhGM5eto%3D" alt="" loading="lazy"/></p>
<p>我们按照如下的参数来进行配置：</p>
<ul>
<li>Connector name：hunyuan-4b</li>
<li>选择 OpenAI  provider：other (OpenAI Compatible Service)</li>
<li>URL：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A11434%2Fv1%2Fchat%2Fcompletions" title="http://localhost:11434/v1/chat/completions" target="_blank" ref="nofollow noopener noreferrer">http://localhost:11434/v1/chat/completions</a>
<ul>
<li>调整到你的 ollama 的正确路径。如果你从容器内调用，请记住替换 host.docker.internal 或等效项</li>
</ul>
</li>
<li>默认模型：hunyuan-4b</li>
<li>API 密钥：编造一个，需要输入，但值无关紧要</li>
</ul>
<p>我们点击上面的 Save &amp; test 按钮：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c2a699cf9da42e39b57e1ae85a37b9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=7igNDHDlQsGlqd4opAJ0iCcjNBU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cb5541ab88c4a3d9aa0741ea4f90b62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=JX1KAf9CotWn0lBF4y6iL2SRX74%3D" alt="" loading="lazy"/></p>
<p>从上面的测试中，我们可以看出来测试是成功的。</p>
<h3 data-id="heading-8">上传文档并在 Playground 中进行测试</h3>
<p>我们接下来使用和 “<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F145532862" title="https://elasticstack.blog.csdn.net/article/details/145532862" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch：在 Elastic 中玩转 DeepSeek R1 来实现 RAG 应用</a>” 文中一样的文档来进行测试。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad404483635c476e8aa8909e8b659d7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=g8ZgbFNQnze7NL7nmI9cVK3m4vc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0710b8b0eea44abbcc1992b0bb2f376~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=mOrQ3IuifZBl3tCqpXKmwY5Rrbo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23123e0ec7d8456f8484201cba56d6d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=CkthDmvI88S7y4y0JHk%2FpIKoXGk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a19bec7120bc4aa3a512573509a4e0c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=t9acMESYZIVYCcV8vmr6CcQIQCk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eea863eea4264834bfbf1603358f0ed3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=%2Feh0OynoRMah5zOfDIBCaTRfWGw%3D" alt="" loading="lazy"/></p>
<p><strong>Instructions：</strong></p>
<pre><code class="hljs language-sql" lang="sql">`You <span class="hljs-keyword">are</span> an assistant <span class="hljs-keyword">for</span> question<span class="hljs-operator">-</span>answering tasks <span class="hljs-keyword">using</span> relevant text passages <span class="hljs-keyword">from</span> the book Alice <span class="hljs-keyword">in</span> wonderland`AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed9bb3cf771d4306b9c9ee5faa57e338~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=ZMyx%2BMvnzDvXGCbSmHd71txj58M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/151422942a264c12a570581c7317045e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=cmmMWPrRlVukS3CYna3LH33WRhA%3D" alt="" loading="lazy"/></p>
<p>很有意思，混元模型的反应速度比我想象的要快。至少比我上次使用 DeepSeek R1 要快很多。我们尝试使用中文来进行提问：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`谁出现在茶会上？`</span>AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/688a8970b1ed4434bd9c9e27993143cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=38p4XqGVboGHki6t%2BVK3f%2FGs%2Bik%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`文章有哪些章节？`</span>AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89a8c1309d744e47892c0f7d242ce6bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=JbuQx44zI4IIdAvWAjRMm7RYR1E%3D" alt="" loading="lazy"/></p>
<p>如果你想使用代码来完成查询的话，那么请按照如下的步骤：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aedba6f9abbd40bfba670436a72c2795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=9Nj9Inch4uErkkKbz7rj6KI7%2Fak%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5e755d9424741c8abd4bc79d9013776~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763447791&amp;x-signature=TvEWgfH21CP74kjcGghYBMKCizA%3D" alt="" loading="lazy"/></p>
<p>我们可以点击上面的拷贝图标，并做相应的修改 即可。具体的操作步骤，请详细参阅我之前的文章 “<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F145532862" title="https://elasticstack.blog.csdn.net/article/details/145532862" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch：在 Elastic 中玩转 DeepSeek R1 来实现 RAG 应用</a>”。</p>
<p>好了，今天的分享就到这里。祝大家学习愉快！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[盘点Nfs 文件服务在Windows上的坑??]]></title>    <link>https://juejin.cn/post/7571051830710730802</link>    <guid>https://juejin.cn/post/7571051830710730802</guid>    <pubDate>2025-11-11T07:50:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571051830710730802" data-draft-id="7571086754880684078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="盘点Nfs 文件服务在Windows上的坑??"/> <meta itemprop="keywords" content="Linux,Windows,CentOS"/> <meta itemprop="datePublished" content="2025-11-11T07:50:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="stark张宇"/> <meta itemprop="url" content="https://juejin.cn/user/1983974643871069"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            盘点Nfs 文件服务在Windows上的坑??
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1983974643871069/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    stark张宇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:50:27.000Z" title="Tue Nov 11 2025 07:50:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🎯 盘点Nfs 文件服务在Windows上的坑??</h2>
<p>先抛出问题：Nfs文件服务搭建在Centos7.9的服务器上，IP 192.168.31.147，映射在Windows11的本地磁盘，共享所有的文件包括Git仓库，所有心烦一并解决，烦恼就像裤衩里的屎，解决Ta，安排，GoGoGo!</p>
<h3 data-id="heading-1">一、Git 安全</h3>
<p>错误信息 <code>fatal: unsafe repository ('//192.168.31.147/home/wwwroot/shop/crmeb' is owned by someone else)</code>原因是：该 Git 仓库位于网络路径 <code>//192.168.31.147/home/wwwroot/shop/crmeb</code>，Git 认为网络共享目录可能被其他用户控制，存在安全风险。</p>
<p>添加安全目录设置，Win的本地就可以正常显示Git的信息和操作了。</p>
<pre><code class="hljs language-bash" lang="bash">git config --global --add safe.directory <span class="hljs-string">'%(prefix)///192.168.31.147/home/wwwroot/shop/crmeb'</span>
</code></pre>
<h3 data-id="heading-2">二、Git CRLF / LF 结束符的兼容</h3>
<p>Git 抛出错误信息<code>LF will be replaced by CRLF the next time Git touches it</code>，总是在另一端搞出好多文件？</p>
<p><strong>成因</strong>：Unix/Linux/macOS 系统使用<strong>LF</strong> (Line Feed) 的行结束符，Windows 系统使用<strong>CRLF</strong> (Carriage Return + Line Feed)的行结束符，因为是共享文件所以每次都会修改很多文件，Git 检测到文件中的行结束符不一致，会在下次提交时自动进行转换。</p>
<p>解决办法：</p>
<p>如果已经有现有仓库，清除缓存并重置：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">rm</span> --cached -r .
git reset --hard
</code></pre>
<p>打开Git Bash或命令提示符，执行以下Git配置命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 禁止自动换行符转换</span>
git config --global core.autocrlf <span class="hljs-literal">false</span>

<span class="hljs-comment"># 设置不检查换行符</span>
git config --global core.safecrlf <span class="hljs-literal">false</span>
</code></pre>
<p>在Windows11上使用编辑器是<code>phpstrom</code> 设置配置文件，<strong>在项目根目录创建 <code>.editorconfig</code> 文件</strong></p>
<pre><code class="hljs language-bash" lang="bash">root = <span class="hljs-literal">true</span>

[*]
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = <span class="hljs-literal">true</span>
insert_final_newline = <span class="hljs-literal">true</span>
indent_style = space
indent_size = 4

[*.md]
trim_trailing_whitespace = <span class="hljs-literal">false</span>
</code></pre>
<h3 data-id="heading-3">三、Nfs 在Win上的卡顿</h3>
<p>Nfs在Win上的卡顿是致命的，每次转了好多圈也不好使，尤其是程序崩溃后造成的各种诡异情况，针对这些我要分享你几条妙计：</p>
<p>有一种情况是删除了磁盘中映射的Nfs盘，但是它还是存在，分2步解决掉，第一就是删除映射的磁盘文件：</p>
<pre><code class="hljs language-bash" lang="bash">net use * /delete
</code></pre>
<p>删除如果无效可能是缓存的原因，就使用大招，删除网络驱动器缓存。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除网络驱动器缓存</span>
Remove-Item -Path <span class="hljs-string">"HKCU:\Network\Z"</span> -Recurse -Force -ErrorAction SilentlyContinue

<span class="hljs-comment"># 重启资源管理器</span>
taskkill /f /im explorer.exe
Start-Process explorer.exe
</code></pre>
<p>可以写一个.bat脚本，每次关机前断开Nfs链接，在使用前在自动连接，跟方便也很实用：</p>
<pre><code class="hljs language-bash" lang="bash">@<span class="hljs-built_in">echo</span> off
<span class="hljs-built_in">echo</span> 正在连接 NFS 服务器...
mount -o anon \192.168.31.147\home\wwwroot Z:
<span class="hljs-built_in">echo</span> 连接完成！
pause
</code></pre>
<p>我让DeepSeek生成了一个删除链接的.bat脚本，也放在下面了</p>
<pre><code class="hljs language-bash" lang="bash">@<span class="hljs-built_in">echo</span> off
chcp 65001 &gt;nul
title 网络驱动器清理工具

<span class="hljs-built_in">echo</span> ========================================
<span class="hljs-built_in">echo</span>     网络驱动器清理工具 - Windows 11
<span class="hljs-built_in">echo</span> ========================================
<span class="hljs-built_in">echo</span>.

<span class="hljs-built_in">echo</span> 正在删除网络驱动器Z的缓存...
PowerShell -Command <span class="hljs-string">"Remove-Item -Path 'HKCU:\Network\Z' -Recurse -Force -ErrorAction SilentlyContinue"</span>

<span class="hljs-keyword">if</span> %errorlevel% == 0 (
    <span class="hljs-built_in">echo</span> ✓ 网络驱动器缓存清理完成
) <span class="hljs-keyword">else</span> (
    <span class="hljs-built_in">echo</span> ⚠ 清理过程中可能出现问题（可能是驱动器不存在）
)

<span class="hljs-built_in">echo</span>.
<span class="hljs-built_in">echo</span> 正在重启资源管理器...
taskkill /f /im explorer.exe &gt;nul 2&gt;&amp;1
<span class="hljs-built_in">timeout</span> /t 2 /nobreak &gt;nul
start explorer.exe

<span class="hljs-built_in">echo</span> ✓ 资源管理器已重启
<span class="hljs-built_in">echo</span>.
<span class="hljs-built_in">echo</span> 操作完成！按任意键退出...
pause &gt;nul
</code></pre>
<p>这样在Windows上的Nfs的坑就告一段落了，积极的去探索下一段探索，加油！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第3章：基础组件 —— 3.2 按钮]]></title>    <link>https://juejin.cn/post/7571056535441031168</link>    <guid>https://juejin.cn/post/7571056535441031168</guid>    <pubDate>2025-11-11T07:32:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571056535441031168" data-draft-id="7571068689766088744" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第3章：基础组件 —— 3.2 按钮"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-11T07:32:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="旧时光_"/> <meta itemprop="url" content="https://juejin.cn/user/4442458669718279"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第3章：基础组件 —— 3.2 按钮
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4442458669718279/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    旧时光_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:32:53.000Z" title="Tue Nov 11 2025 07:32:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">3.2 按钮</h2>
<h3 data-id="heading-1">📚 章节概览</h3>
<p>按钮是用户交互的核心组件。Flutter 的 Material 库提供了多种按钮组件，本章节将学习：</p>
<ul>
<li><strong>ElevatedButton</strong> - 漂浮按钮（带阴影和背景）</li>
<li><strong>TextButton</strong> - 文本按钮（透明背景）</li>
<li><strong>OutlinedButton</strong> - 边框按钮</li>
<li><strong>IconButton</strong> - 图标按钮</li>
<li><strong>带图标的按钮</strong> - <code>.icon</code> 构造函数</li>
<li><strong>按钮样式自定义</strong> - <code>ButtonStyle</code> 和 <code>styleFrom</code></li>
<li><strong>按钮状态管理</strong> - 启用、禁用、加载中</li>
</ul>
<hr/>
<h3 data-id="heading-2">🎯 核心知识点</h3>
<h4 data-id="heading-3">Material 按钮的共同特点</h4>
<p>所有 Material 库中的按钮都有以下共同点：</p>
<ol>
<li><strong>水波动画</strong>：点击时会出现水波扩散的涟漪动画</li>
<li><strong><code>onPressed</code> 回调</strong>：设置点击事件，为 <code>null</code> 时按钮禁用</li>
<li><strong>继承自 <code>RawMaterialButton</code></strong>：大多数属性都相同</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 启用状态</span>
ElevatedButton(
  onPressed: () {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'按钮被点击'</span>);
  },
  child: Text(<span class="hljs-string">'启用'</span>),
)

<span class="hljs-comment">// 禁用状态</span>
ElevatedButton(
  onPressed: <span class="hljs-keyword">null</span>,  <span class="hljs-comment">// null = 禁用</span>
  child: Text(<span class="hljs-string">'禁用'</span>),
)
</code></pre>
<hr/>
<h3 data-id="heading-4">1️⃣ ElevatedButton（漂浮按钮）</h3>
<h4 data-id="heading-5">特点</h4>
<ul>
<li><strong>默认外观</strong>：带阴影和背景色（主题色）</li>
<li><strong>交互效果</strong>：按下时阴影变大</li>
<li><strong>适用场景</strong>：主要操作、强调的按钮</li>
</ul>
<h4 data-id="heading-6">基本用法</h4>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'ElevatedButton 被点击'</span>);
  },
  child: Text(<span class="hljs-string">'Normal'</span>),
)
</code></pre>
<h4 data-id="heading-7">自定义样式</h4>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ElevatedButton.styleFrom(
    backgroundColor: Colors.red,        <span class="hljs-comment">// 背景色</span>
    foregroundColor: Colors.white,     <span class="hljs-comment">// 前景色（文字/图标）</span>
    elevation: <span class="hljs-number">5</span>,                      <span class="hljs-comment">// 阴影高度</span>
    shadowColor: Colors.black,         <span class="hljs-comment">// 阴影颜色</span>
    padding: EdgeInsets.symmetric(
      horizontal: <span class="hljs-number">24</span>,
      vertical: <span class="hljs-number">12</span>,
    ),
    shape: RoundedRectangleBorder(      <span class="hljs-comment">// 形状</span>
      borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
    ),
  ),
  child: Text(<span class="hljs-string">'自定义样式'</span>),
)
</code></pre>
<hr/>
<h3 data-id="heading-8">2️⃣ TextButton（文本按钮）</h3>
<h4 data-id="heading-9">特点</h4>
<ul>
<li><strong>默认外观</strong>：透明背景，无阴影</li>
<li><strong>交互效果</strong>：按下时出现背景色</li>
<li><strong>适用场景</strong>：次要操作、对话框按钮</li>
</ul>
<h4 data-id="heading-10">基本用法</h4>
<pre><code class="hljs language-dart" lang="dart">TextButton(
  onPressed: () {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'TextButton 被点击'</span>);
  },
  child: Text(<span class="hljs-string">'Normal'</span>),
)
</code></pre>
<h4 data-id="heading-11">常见用例：对话框</h4>
<pre><code class="hljs language-dart" lang="dart">AlertDialog(
  title: Text(<span class="hljs-string">'提示'</span>),
  content: Text(<span class="hljs-string">'确定要删除吗？'</span>),
  actions: [
    TextButton(
      onPressed: () =&gt; Navigator.pop(context),
      child: Text(<span class="hljs-string">'取消'</span>),
    ),
    TextButton(
      onPressed: () {
        <span class="hljs-comment">// 执行删除</span>
        Navigator.pop(context);
      },
      child: Text(<span class="hljs-string">'确定'</span>, style: TextStyle(color: Colors.red)),
    ),
  ],
)
</code></pre>
<hr/>
<h3 data-id="heading-12">3️⃣ OutlinedButton（边框按钮）</h3>
<h4 data-id="heading-13">特点</h4>
<ul>
<li><strong>默认外观</strong>：带边框，透明背景，无阴影</li>
<li><strong>交互效果</strong>：按下时边框变亮，出现背景和阴影</li>
<li><strong>适用场景</strong>：中等强调的操作</li>
</ul>
<h4 data-id="heading-14">基本用法</h4>
<pre><code class="hljs language-dart" lang="dart">OutlinedButton(
  onPressed: () {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'OutlinedButton 被点击'</span>);
  },
  child: Text(<span class="hljs-string">'Normal'</span>),
)
</code></pre>
<h4 data-id="heading-15">自定义边框</h4>
<pre><code class="hljs language-dart" lang="dart">OutlinedButton(
  onPressed: () {},
  style: OutlinedButton.styleFrom(
    side: BorderSide(
      color: Colors.red,   <span class="hljs-comment">// 边框颜色</span>
      width: <span class="hljs-number">2</span>,            <span class="hljs-comment">// 边框宽度</span>
    ),
    shape: RoundedRectangleBorder(
      borderRadius: BorderRadius.circular(<span class="hljs-number">20</span>),
    ),
  ),
  child: Text(<span class="hljs-string">'自定义边框'</span>),
)
</code></pre>
<hr/>
<h3 data-id="heading-16">4️⃣ IconButton（图标按钮）</h3>
<h4 data-id="heading-17">特点</h4>
<ul>
<li><strong>默认外观</strong>：只包含图标，无背景</li>
<li><strong>交互效果</strong>：点击时出现圆形背景</li>
<li><strong>适用场景</strong>：工具栏、AppBar、紧凑布局</li>
</ul>
<h4 data-id="heading-18">基本用法</h4>
<pre><code class="hljs language-dart" lang="dart">IconButton(
  icon: Icon(Icons.thumb_up),
  onPressed: () {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'IconButton 被点击'</span>);
  },
  tooltip: <span class="hljs-string">'点赞'</span>,  <span class="hljs-comment">// 长按显示的提示</span>
)
</code></pre>
<h4 data-id="heading-19">实用示例：收藏功能</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FavoriteButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _FavoriteButtonState createState() =&gt; _FavoriteButtonState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_FavoriteButtonState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">FavoriteButton</span>&gt; </span>{
  <span class="hljs-built_in">bool</span> _isFavorite = <span class="hljs-keyword">false</span>;

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> IconButton(
      icon: Icon(
        _isFavorite ? Icons.favorite : Icons.favorite_border,
      ),
      color: _isFavorite ? Colors.red : Colors.grey,
      onPressed: () {
        setState(() {
          _isFavorite = !_isFavorite;
        });
      },
      tooltip: _isFavorite ? <span class="hljs-string">'取消收藏'</span> : <span class="hljs-string">'收藏'</span>,
    );
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-20">5️⃣ 带图标的按钮</h3>
<h4 data-id="heading-21"><code>.icon</code> 构造函数</h4>
<p>所有主要按钮类型都提供了 <code>.icon</code> 构造函数，可以轻松创建带图标的按钮。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ElevatedButton.icon</span>
ElevatedButton.icon(
  icon: Icon(Icons.send),
  label: Text(<span class="hljs-string">'发送'</span>),
  onPressed: () {},
)

<span class="hljs-comment">// TextButton.icon</span>
TextButton.icon(
  icon: Icon(Icons.info),
  label: Text(<span class="hljs-string">'详情'</span>),
  onPressed: () {},
)

<span class="hljs-comment">// OutlinedButton.icon</span>
OutlinedButton.icon(
  icon: Icon(Icons.add),
  label: Text(<span class="hljs-string">'添加'</span>),
  onPressed: () {},
)
</code></pre>
<h4 data-id="heading-22">图标位置</h4>
<p>默认情况下，图标在左侧。如果需要图标在右侧，可以自定义布局：</p>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  child: Row(
    mainAxisSize: MainAxisSize.min,
    children: [
      Text(<span class="hljs-string">'下载'</span>),
      SizedBox(width: <span class="hljs-number">8</span>),
      Icon(Icons.download),
    ],
  ),
)
</code></pre>
<hr/>
<h3 data-id="heading-23">🎨 按钮样式系统</h3>
<h4 data-id="heading-24">ButtonStyle vs styleFrom</h4>
<p>Flutter 提供了两种方式自定义按钮样式：</p>
<h5 data-id="heading-25">方法1：<code>styleFrom</code>（推荐）</h5>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ElevatedButton.styleFrom(
    backgroundColor: Colors.blue,
    foregroundColor: Colors.white,
    elevation: <span class="hljs-number">5</span>,
    padding: EdgeInsets.all(<span class="hljs-number">16</span>),
    shape: RoundedRectangleBorder(
      borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
    ),
  ),
  child: Text(<span class="hljs-string">'按钮'</span>),
)
</code></pre>
<h5 data-id="heading-26">方法2：<code>ButtonStyle</code>（更灵活）</h5>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ButtonStyle(
    backgroundColor: MaterialStateProperty.all(Colors.blue),
    foregroundColor: MaterialStateProperty.all(Colors.white),
    elevation: MaterialStateProperty.all(<span class="hljs-number">5</span>),
    padding: MaterialStateProperty.all(
      EdgeInsets.all(<span class="hljs-number">16</span>),
    ),
    shape: MaterialStateProperty.all(
      RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
      ),
    ),
  ),
  child: Text(<span class="hljs-string">'按钮'</span>),
)
</code></pre>
<h4 data-id="heading-27">MaterialStateProperty</h4>
<p><code>ButtonStyle</code> 使用 <code>MaterialStateProperty</code> 来根据按钮状态设置不同的样式。</p>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ButtonStyle(
    backgroundColor: MaterialStateProperty.resolveWith&lt;Color&gt;(
      (<span class="hljs-built_in">Set</span>&lt;MaterialState&gt; states) {
        <span class="hljs-keyword">if</span> (states.contains(MaterialState.pressed)) {
          <span class="hljs-keyword">return</span> Colors.red;      <span class="hljs-comment">// 按下时红色</span>
        }
        <span class="hljs-keyword">if</span> (states.contains(MaterialState.hovered)) {
          <span class="hljs-keyword">return</span> Colors.orange;   <span class="hljs-comment">// 悬停时橙色</span>
        }
        <span class="hljs-keyword">if</span> (states.contains(MaterialState.disabled)) {
          <span class="hljs-keyword">return</span> Colors.grey;     <span class="hljs-comment">// 禁用时灰色</span>
        }
        <span class="hljs-keyword">return</span> Colors.blue;       <span class="hljs-comment">// 默认蓝色</span>
      },
    ),
  ),
  child: Text(<span class="hljs-string">'状态按钮'</span>),
)
</code></pre>
<h4 data-id="heading-28">常见状态</h4>





























<table><thead><tr><th>状态</th><th>说明</th></tr></thead><tbody><tr><td><code>MaterialState.pressed</code></td><td>按下状态</td></tr><tr><td><code>MaterialState.hovered</code></td><td>鼠标悬停（Web/Desktop）</td></tr><tr><td><code>MaterialState.focused</code></td><td>获得焦点</td></tr><tr><td><code>MaterialState.disabled</code></td><td>禁用状态</td></tr><tr><td><code>MaterialState.selected</code></td><td>选中状态</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-29">📐 按钮尺寸控制</h3>
<h4 data-id="heading-30">方法1：padding</h4>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ElevatedButton.styleFrom(
    padding: EdgeInsets.symmetric(
      horizontal: <span class="hljs-number">32</span>,
      vertical: <span class="hljs-number">20</span>,
    ),
  ),
  child: Text(<span class="hljs-string">'大按钮'</span>),
)
</code></pre>
<h4 data-id="heading-31">方法2：minimumSize</h4>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ElevatedButton.styleFrom(
    minimumSize: Size(<span class="hljs-number">200</span>, <span class="hljs-number">50</span>),  <span class="hljs-comment">// 最小宽200，高50</span>
  ),
  child: Text(<span class="hljs-string">'固定尺寸'</span>),
)
</code></pre>
<h4 data-id="heading-32">方法3：外层包裹 SizedBox</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 全宽按钮</span>
SizedBox(
  width: <span class="hljs-built_in">double</span>.infinity,
  child: ElevatedButton(
    onPressed: () {},
    child: Text(<span class="hljs-string">'全宽按钮'</span>),
  ),
)

<span class="hljs-comment">// 固定宽度按钮</span>
SizedBox(
  width: <span class="hljs-number">200</span>,
  child: ElevatedButton(
    onPressed: () {},
    child: Text(<span class="hljs-string">'200宽按钮'</span>),
  ),
)
</code></pre>
<hr/>
<h3 data-id="heading-33">🔄 按钮状态管理</h3>
<h4 data-id="heading-34">启用/禁用状态</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ToggleButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _ToggleButtonState createState() =&gt; _ToggleButtonState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ToggleButtonState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ToggleButton</span>&gt; </span>{
  <span class="hljs-built_in">bool</span> _isEnabled = <span class="hljs-keyword">true</span>;

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      children: [
        Switch(
          value: _isEnabled,
          onChanged: (value) {
            setState(() {
              _isEnabled = value;
            });
          },
        ),
        ElevatedButton(
          onPressed: _isEnabled ? () {} : <span class="hljs-keyword">null</span>,  <span class="hljs-comment">// null = 禁用</span>
          child: Text(_isEnabled ? <span class="hljs-string">'启用'</span> : <span class="hljs-string">'禁用'</span>),
        ),
      ],
    );
  }
}
</code></pre>
<h4 data-id="heading-35">加载状态</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoadingButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _LoadingButtonState createState() =&gt; _LoadingButtonState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_LoadingButtonState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">LoadingButton</span>&gt; </span>{
  <span class="hljs-built_in">bool</span> _isLoading = <span class="hljs-keyword">false</span>;

  Future&lt;<span class="hljs-keyword">void</span>&gt; _handleSubmit() <span class="hljs-keyword">async</span> {
    setState(() {
      _isLoading = <span class="hljs-keyword">true</span>;
    });
    
    <span class="hljs-comment">// 模拟网络请求</span>
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>));
    
    setState(() {
      _isLoading = <span class="hljs-keyword">false</span>;
    });
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> ElevatedButton(
      onPressed: _isLoading ? <span class="hljs-keyword">null</span> : _handleSubmit,
      child: _isLoading
          ? SizedBox(
              height: <span class="hljs-number">20</span>,
              width: <span class="hljs-number">20</span>,
              child: CircularProgressIndicator(
                strokeWidth: <span class="hljs-number">2</span>,
                valueColor: AlwaysStoppedAnimation&lt;Color&gt;(Colors.white),
              ),
            )
          : Text(<span class="hljs-string">'提交'</span>),
    );
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-36">🎨 高级样式技巧</h3>
<h4 data-id="heading-37">1. 渐变背景按钮</h4>
<pre><code class="hljs language-dart" lang="dart">Ink(
  decoration: BoxDecoration(
    gradient: LinearGradient(
      colors: [Colors.blue, Colors.purple],
    ),
    borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
  ),
  child: ElevatedButton(
    onPressed: () {},
    style: ElevatedButton.styleFrom(
      backgroundColor: Colors.transparent,
      shadowColor: Colors.transparent,
    ),
    child: Text(<span class="hljs-string">'渐变按钮'</span>),
  ),
)
</code></pre>
<h4 data-id="heading-38">2. 圆形按钮</h4>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ElevatedButton.styleFrom(
    shape: CircleBorder(),
    padding: EdgeInsets.all(<span class="hljs-number">20</span>),
  ),
  child: Icon(Icons.favorite),
)
</code></pre>
<h4 data-id="heading-39">3. 描边文字按钮</h4>
<pre><code class="hljs language-dart" lang="dart">TextButton(
  onPressed: () {},
  child: Text(
    <span class="hljs-string">'描边文字'</span>,
    style: TextStyle(
      foreground: Paint()
        ..style = PaintingStyle.stroke
        ..strokeWidth = <span class="hljs-number">2</span>
        ..color = Colors.blue,
    ),
  ),
)
</code></pre>
<h4 data-id="heading-40">4. 不同圆角的按钮</h4>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ElevatedButton.styleFrom(
    shape: RoundedRectangleBorder(
      borderRadius: BorderRadius.only(
        topLeft: Radius.circular(<span class="hljs-number">20</span>),
        topRight: Radius.circular(<span class="hljs-number">5</span>),
        bottomLeft: Radius.circular(<span class="hljs-number">5</span>),
        bottomRight: Radius.circular(<span class="hljs-number">20</span>),
      ),
    ),
  ),
  child: Text(<span class="hljs-string">'不规则圆角'</span>),
)
</code></pre>
<hr/>
<h3 data-id="heading-41">💡 最佳实践</h3>
<h4 data-id="heading-42">1. 按钮选择指南</h4>






























<table><thead><tr><th>场景</th><th>推荐按钮</th><th>理由</th></tr></thead><tbody><tr><td>主要操作（如提交、保存）</td><td><code>ElevatedButton</code></td><td>视觉突出，强调重要性</td></tr><tr><td>次要操作（如取消、返回）</td><td><code>TextButton</code></td><td>低调，不抢主按钮风头</td></tr><tr><td>中等强调（如添加、编辑）</td><td><code>OutlinedButton</code></td><td>有边界感，但不过于突出</td></tr><tr><td>工具栏、列表操作</td><td><code>IconButton</code></td><td>节省空间，简洁</td></tr></tbody></table>
<h4 data-id="heading-43">2. 按钮组合布局</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 对话框按钮组</span>
Row(
  mainAxisAlignment: MainAxisAlignment.end,
  children: [
    TextButton(
      onPressed: () =&gt; Navigator.pop(context),
      child: Text(<span class="hljs-string">'取消'</span>),
    ),
    SizedBox(width: <span class="hljs-number">8</span>),
    ElevatedButton(
      onPressed: () {
        <span class="hljs-comment">// 确认操作</span>
      },
      child: Text(<span class="hljs-string">'确定'</span>),
    ),
  ],
)

<span class="hljs-comment">// 底部操作栏</span>
Row(
  children: [
    Expanded(
      child: OutlinedButton(
        onPressed: () {},
        child: Text(<span class="hljs-string">'取消'</span>),
      ),
    ),
    SizedBox(width: <span class="hljs-number">16</span>),
    Expanded(
      child: ElevatedButton(
        onPressed: () {},
        child: Text(<span class="hljs-string">'确定'</span>),
      ),
    ),
  ],
)
</code></pre>
<h4 data-id="heading-44">3. 使用全局主题</h4>
<pre><code class="hljs language-dart" lang="dart">MaterialApp(
  theme: ThemeData(
    elevatedButtonTheme: ElevatedButtonThemeData(
      style: ElevatedButton.styleFrom(
        backgroundColor: Colors.blue,
        foregroundColor: Colors.white,
        elevation: <span class="hljs-number">5</span>,
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(<span class="hljs-number">8</span>),
        ),
      ),
    ),
    textButtonTheme: TextButtonThemeData(
      style: TextButton.styleFrom(
        foregroundColor: Colors.blue,
      ),
    ),
  ),
  home: MyHomePage(),
)
</code></pre>
<h4 data-id="heading-45">4. 避免常见错误</h4>
<p>❌ <strong>错误：按钮文字过长导致溢出</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 不好</span>
ElevatedButton(
  onPressed: () {},
  child: Text(<span class="hljs-string">'这是一个非常非常非常长的按钮文字'</span>),
)
</code></pre>
<p>✅ <strong>正确：限制文字或使用自适应布局</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 好</span>
ElevatedButton(
  onPressed: () {},
  child: Text(
    <span class="hljs-string">'这是一个非常非常非常长的按钮文字'</span>,
    overflow: TextOverflow.ellipsis,
    maxLines: <span class="hljs-number">1</span>,
  ),
)
</code></pre>
<hr/>
<h3 data-id="heading-46">🤔 常见问题（FAQ）</h3>
<h4 data-id="heading-47">Q1: 如何去除按钮的水波动画？</h4>
<p><strong>A:</strong> 使用 <code>splashFactory</code> 设置为 <code>NoSplash.splashFactory</code>：</p>
<pre><code class="hljs language-dart" lang="dart">ElevatedButton(
  onPressed: () {},
  style: ElevatedButton.styleFrom(
    splashFactory: NoSplash.splashFactory,  <span class="hljs-comment">// 禁用水波</span>
  ),
  child: Text(<span class="hljs-string">'无水波'</span>),
)
</code></pre>
<h4 data-id="heading-48">Q2: 如何让按钮宽度自适应内容？</h4>
<p><strong>A:</strong> 默认按钮就是自适应内容的。如果被外层组件约束，可以使用 <code>Wrap</code> 或设置 <code>mainAxisSize</code>：</p>
<pre><code class="hljs language-dart" lang="dart">Row(
  mainAxisSize: MainAxisSize.min,  <span class="hljs-comment">// 自适应</span>
  children: [
    ElevatedButton(
      onPressed: () {},
      child: Text(<span class="hljs-string">'短'</span>),
    ),
  ],
)
</code></pre>
<h4 data-id="heading-49">Q3: 为什么我的按钮点击没反应？</h4>
<p><strong>A:</strong> 检查以下几点：</p>
<ol>
<li><code>onPressed</code> 是否为 <code>null</code>（会导致禁用）</li>
<li>是否被其他 Widget 遮挡（如透明的 Overlay）</li>
<li>是否在 <code>IgnorePointer</code> 内部</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 检查是否禁用</span>
ElevatedButton(
  onPressed: <span class="hljs-keyword">null</span>,  <span class="hljs-comment">// ❌ 禁用状态</span>
  child: Text(<span class="hljs-string">'按钮'</span>),
)

<span class="hljs-comment">// 正确</span>
ElevatedButton(
  onPressed: () {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'点击了'</span>);
  },  <span class="hljs-comment">// ✅ 启用状态</span>
  child: Text(<span class="hljs-string">'按钮'</span>),
)
</code></pre>
<h4 data-id="heading-50">Q4: 如何实现按钮防抖（防止重复点击）？</h4>
<p><strong>A:</strong> 使用状态管理或延迟：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DebounceButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _DebounceButtonState createState() =&gt; _DebounceButtonState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_DebounceButtonState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">DebounceButton</span>&gt; </span>{
  <span class="hljs-built_in">bool</span> _isProcessing = <span class="hljs-keyword">false</span>;

  Future&lt;<span class="hljs-keyword">void</span>&gt; _handleClick() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">if</span> (_isProcessing) <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// 防止重复点击</span>
    
    setState(() {
      _isProcessing = <span class="hljs-keyword">true</span>;
    });
    
    <span class="hljs-comment">// 执行操作</span>
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>));
    
    setState(() {
      _isProcessing = <span class="hljs-keyword">false</span>;
    });
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> ElevatedButton(
      onPressed: _isProcessing ? <span class="hljs-keyword">null</span> : _handleClick,
      child: Text(_isProcessing ? <span class="hljs-string">'处理中...'</span> : <span class="hljs-string">'提交'</span>),
    );
  }
}
</code></pre>
<h4 data-id="heading-51">Q5: 如何实现按钮长按效果？</h4>
<p><strong>A:</strong> 使用 <code>GestureDetector</code> 或 <code>InkWell</code> 包裹：</p>
<pre><code class="hljs language-dart" lang="dart">GestureDetector(
  onLongPress: () {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'长按了'</span>);
  },
  child: ElevatedButton(
    onPressed: () {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'普通点击'</span>);
    },
    child: Text(<span class="hljs-string">'长按试试'</span>),
  ),
)
</code></pre>
<hr/>
<h3 data-id="heading-52">🎯 跟着做练习</h3>
<h4 data-id="heading-53">练习1：实现一个全宽的提交按钮</h4>
<p><strong>目标：</strong> 创建一个全宽的绿色提交按钮，带圆角，点击后显示 SnackBar</p>
<p><strong>步骤：</strong></p>
<ol>
<li>使用 <code>SizedBox</code> 设置全宽</li>
<li>使用 <code>ElevatedButton.styleFrom</code> 自定义颜色和圆角</li>
<li>点击时显示 <code>ScaffoldMessenger.of(context).showSnackBar</code></li>
</ol>
<details>
<summary>💡 查看答案</summary>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FullWidthButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> FullWidthButton({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> SizedBox(
      width: <span class="hljs-built_in">double</span>.infinity,
      child: ElevatedButton(
        onPressed: () {
          ScaffoldMessenger.of(context).showSnackBar(
            <span class="hljs-keyword">const</span> SnackBar(
              content: Text(<span class="hljs-string">'提交成功！'</span>),
              duration: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>),
            ),
          );
        },
        style: ElevatedButton.styleFrom(
          backgroundColor: Colors.green,
          foregroundColor: Colors.white,
          padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(vertical: <span class="hljs-number">16</span>),
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(<span class="hljs-number">12</span>),
          ),
        ),
        child: <span class="hljs-keyword">const</span> Text(
          <span class="hljs-string">'提交'</span>,
          style: TextStyle(fontSize: <span class="hljs-number">16</span>, fontWeight: FontWeight.bold),
        ),
      ),
    );
  }
}
</code></pre>
</details>
<hr/>
<h4 data-id="heading-54">练习2：实现一个计数按钮</h4>
<p><strong>目标：</strong> 按钮显示点击次数，每次点击次数+1，点击5次后禁用</p>
<p><strong>步骤：</strong></p>
<ol>
<li>使用 <code>StatefulWidget</code> 管理计数状态</li>
<li>在 <code>onPressed</code> 中更新计数</li>
<li>当计数达到5时，<code>onPressed</code> 设为 <code>null</code></li>
</ol>
<details>
<summary>💡 查看答案</summary>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> CounterButton({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;CounterButton&gt; createState() =&gt; _CounterButtonState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CounterButtonState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">CounterButton</span>&gt; </span>{
  <span class="hljs-built_in">int</span> _count = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> _maxCount = <span class="hljs-number">5</span>;

  <span class="hljs-keyword">void</span> _incrementCounter() {
    <span class="hljs-keyword">if</span> (_count &lt; _maxCount) {
      setState(() {
        _count++;
      });
    }
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      mainAxisSize: MainAxisSize.min,
      children: [
        ElevatedButton(
          onPressed: _count &lt; _maxCount ? _incrementCounter : <span class="hljs-keyword">null</span>,
          child: Text(<span class="hljs-string">'点击次数: <span class="hljs-subst">$_count</span>'</span>),
        ),
        <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
        <span class="hljs-keyword">if</span> (_count &gt;= _maxCount)
          <span class="hljs-keyword">const</span> Text(
            <span class="hljs-string">'已达到最大点击次数'</span>,
            style: TextStyle(color: Colors.red, fontSize: <span class="hljs-number">12</span>),
          ),
        <span class="hljs-keyword">if</span> (_count &lt; _maxCount)
          Text(
            <span class="hljs-string">'还可以点击 <span class="hljs-subst">${_maxCount - _count}</span> 次'</span>,
            style: <span class="hljs-keyword">const</span> TextStyle(color: Colors.grey, fontSize: <span class="hljs-number">12</span>),
          ),
      ],
    );
  }
}
</code></pre>
</details>
<hr/>
<h4 data-id="heading-55">练习3：实现一个多功能工具栏</h4>
<p><strong>目标：</strong> 创建一行图标按钮，包括：编辑、删除、分享、更多</p>
<p><strong>步骤：</strong></p>
<ol>
<li>使用 <code>Row</code> 布局</li>
<li>创建4个 <code>IconButton</code></li>
<li>每个按钮点击时打印不同的信息</li>
</ol>
<details>
<summary>💡 查看答案</summary>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Toolbar</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> VoidCallback? onEdit;
  <span class="hljs-keyword">final</span> VoidCallback? onDelete;
  <span class="hljs-keyword">final</span> VoidCallback? onShare;
  <span class="hljs-keyword">final</span> VoidCallback? onMore;

  <span class="hljs-keyword">const</span> Toolbar({
    <span class="hljs-keyword">super</span>.key,
    <span class="hljs-keyword">this</span>.onEdit,
    <span class="hljs-keyword">this</span>.onDelete,
    <span class="hljs-keyword">this</span>.onShare,
    <span class="hljs-keyword">this</span>.onMore,
  });

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Card(
      child: Padding(
        padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="hljs-number">8</span>, vertical: <span class="hljs-number">4</span>),
        child: Row(
          mainAxisSize: MainAxisSize.min,
          children: [
            IconButton(
              icon: <span class="hljs-keyword">const</span> Icon(Icons.edit),
              onPressed: onEdit ??
                  () {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">'编辑'</span>);
                    ScaffoldMessenger.of(context).showSnackBar(
                      <span class="hljs-keyword">const</span> SnackBar(content: Text(<span class="hljs-string">'编辑功能'</span>)),
                    );
                  },
              tooltip: <span class="hljs-string">'编辑'</span>,
              color: Colors.blue,
            ),
            IconButton(
              icon: <span class="hljs-keyword">const</span> Icon(Icons.delete),
              onPressed: onDelete ??
                  () {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">'删除'</span>);
                    showDialog(
                      context: context,
                      builder: (context) =&gt; AlertDialog(
                        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'确认'</span>),
                        content: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'确定要删除吗？'</span>),
                        actions: [
                          TextButton(
                            onPressed: () =&gt; Navigator.pop(context),
                            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'取消'</span>),
                          ),
                          TextButton(
                            onPressed: () {
                              <span class="hljs-built_in">print</span>(<span class="hljs-string">'已删除'</span>);
                              Navigator.pop(context);
                            },
                            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'确定'</span>),
                          ),
                        ],
                      ),
                    );
                  },
              tooltip: <span class="hljs-string">'删除'</span>,
              color: Colors.red,
            ),
            IconButton(
              icon: <span class="hljs-keyword">const</span> Icon(Icons.share),
              onPressed: onShare ??
                  () {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">'分享'</span>);
                    ScaffoldMessenger.of(context).showSnackBar(
                      <span class="hljs-keyword">const</span> SnackBar(content: Text(<span class="hljs-string">'分享功能'</span>)),
                    );
                  },
              tooltip: <span class="hljs-string">'分享'</span>,
              color: Colors.green,
            ),
            IconButton(
              icon: <span class="hljs-keyword">const</span> Icon(Icons.more_vert),
              onPressed: onMore ??
                  () {
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">'更多'</span>);
                    ScaffoldMessenger.of(context).showSnackBar(
                      <span class="hljs-keyword">const</span> SnackBar(content: Text(<span class="hljs-string">'更多功能'</span>)),
                    );
                  },
              tooltip: <span class="hljs-string">'更多'</span>,
            ),
          ],
        ),
      ),
    );
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ToolbarDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> ToolbarDemo({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Center(
      child: Toolbar(
        onEdit: () =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'自定义编辑'</span>),
        onDelete: () =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">'自定义删除'</span>),
      ),
    );
  }
}
</code></pre>
</details>
<hr/>
<h3 data-id="heading-56">📋 小结</h3>
<h4 data-id="heading-57">核心要点</h4>






























<table><thead><tr><th>按钮类型</th><th>默认外观</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>ElevatedButton</strong></td><td>带阴影和背景</td><td>主要操作</td></tr><tr><td><strong>TextButton</strong></td><td>透明背景</td><td>次要操作、对话框</td></tr><tr><td><strong>OutlinedButton</strong></td><td>边框，透明背景</td><td>中等强调</td></tr><tr><td><strong>IconButton</strong></td><td>仅图标</td><td>工具栏、紧凑布局</td></tr></tbody></table>
<h4 data-id="heading-58">样式自定义</h4>
<ul>
<li><strong>推荐</strong>：<code>styleFrom</code> - 简洁直观</li>
<li><strong>高级</strong>：<code>ButtonStyle</code> + <code>MaterialStateProperty</code> - 根据状态设置样式</li>
</ul>
<h4 data-id="heading-59">状态管理</h4>
<ul>
<li><strong>启用/禁用</strong>：<code>onPressed</code> 为 <code>null</code> 时禁用</li>
<li><strong>加载状态</strong>：显示 <code>CircularProgressIndicator</code> + 禁用按钮</li>
</ul>
<hr/>
<h3 data-id="heading-60">🔗 相关资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fmaterial%2FElevatedButton-class.html" target="_blank" title="https://api.flutter.dev/flutter/material/ElevatedButton-class.html" ref="nofollow noopener noreferrer">ElevatedButton 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fmaterial%2FTextButton-class.html" target="_blank" title="https://api.flutter.dev/flutter/material/TextButton-class.html" ref="nofollow noopener noreferrer">TextButton 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fmaterial%2FOutlinedButton-class.html" target="_blank" title="https://api.flutter.dev/flutter/material/OutlinedButton-class.html" ref="nofollow noopener noreferrer">OutlinedButton 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fmaterial%2FIconButton-class.html" target="_blank" title="https://api.flutter.dev/flutter/material/IconButton-class.html" ref="nofollow noopener noreferrer">IconButton 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fmaterial%2FButtonStyle-class.html" target="_blank" title="https://api.flutter.dev/flutter/material/ButtonStyle-class.html" ref="nofollow noopener noreferrer">ButtonStyle 官方文档</a></li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型 “万能接口” MCP 横空出世！打破数据孤岛，重塑 AI 交互新规则]]></title>    <link>https://juejin.cn/post/7571028035019178010</link>    <guid>https://juejin.cn/post/7571028035019178010</guid>    <pubDate>2025-11-11T07:33:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571028035019178010" data-draft-id="7571088527677947930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型 “万能接口” MCP 横空出世！打破数据孤岛，重塑 AI 交互新规则"/> <meta itemprop="keywords" content="前端,MCP"/> <meta itemprop="datePublished" content="2025-11-11T07:33:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="伶俜monster"/> <meta itemprop="url" content="https://juejin.cn/user/3186805642627192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型 “万能接口” MCP 横空出世！打破数据孤岛，重塑 AI 交互新规则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3186805642627192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    伶俜monster
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:33:35.000Z" title="Tue Nov 11 2025 07:33:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是 MCP</h2>
<p>MCP 即模型上下文协议（Model Context Protocol），是 Anthropic 于 2024 年 11 月推出的开源开放标准协议，核心是为大模型与外部数据源、各类工具的交互制定统一 “规则”，就像 AI 应用领域的 USB - C 接口，通过客户端 - 服务器架构实现二者安全、高效的连接与上下文传递。</p>
<h3 data-id="heading-1">MCP 的特点</h3>
<ul>
<li><strong>交互标准化</strong>：统一大模型与外部数据、工具的对接方式，形成通用 “语言”。</li>
<li><strong>集成高效化</strong>：一次开发适配所有支持 MCP 的模型 / 应用，迁移无需重写代码。</li>
<li><strong>生态开放化</strong>：支持第三方开发可复用服务器，形成共享的工具 / 数据接入生态。</li>
<li><strong>安全可控化</strong>：权限自主管控、敏感信息隔离、传输加密，降低数据泄露风险。</li>
</ul>
<h3 data-id="heading-2">MCP 优缺点</h3>
<ol>
<li>优点</li>
</ol>
<ul>
<li>打破数据与工具的孤岛，实现跨场景资源互通。</li>
<li>大幅减少重复开发工作，降低开发与迁移成本。</li>
<li>无需依赖单一厂商，提升应用灵活性和可扩展性。</li>
<li>从架构设计上保障数据安全，适配企业私有场景。</li>
</ul>
<ol start="2">
<li>缺点</li>
</ol>
<ul>
<li>作为新兴协议，部分小众工具 / 系统暂无成熟适配方案。</li>
<li>企业部署需搭建 MCP 服务器，对小型团队存在一定技术门槛。</li>
<li>生态仍在完善中，跨厂商的深度协同场景尚未完全覆盖。</li>
</ul>
<h3 data-id="heading-3">MCP 与传统集成方式对比表</h3>


















































<table><thead><tr><th>对比维度</th><th>MCP（模型上下文协议）</th><th>传统集成方式（自定义接口/厂商私有插件）</th></tr></thead><tbody><tr><td>对接标准</td><td>统一开放协议，所有支持 MCP 的模型/工具通用</td><td>无统一标准，需按不同厂商/工具的接口规则适配</td></tr><tr><td>开发成本</td><td>一次开发适配所有兼容平台，无重复工作</td><td>每新增一个模型/工具需单独编写适配代码，成本高</td></tr><tr><td>迁移灵活性</td><td>支持跨厂商快速迁移，无需重写核心代码</td><td>绑定单一厂商或工具，迁移需重构适配逻辑</td></tr><tr><td>数据安全</td><td>敏感信息本地存储，权限自主管控，传输加密</td><td>常需向第三方厂商提供密钥，数据泄露风险较高</td></tr><tr><td>生态覆盖</td><td>开放生态，第三方可开发复用服务器，适配场景持续扩充</td><td>多为厂商私有生态，工具/数据互通性差</td></tr><tr><td>技术门槛</td><td>需搭建 MCP 服务器，对小型团队有一定门槛</td><td>无需额外搭建中间层，但适配复杂度随工具增多上升</td></tr><tr><td>协同能力</td><td>支持跨平台、跨工具无缝协同，共享上下文</td><td>不同工具/系统间难以联动，协同效率低</td></tr><tr><td>实时数据接入</td><td>原生支持对接实时业务系统，获取最新数据</td><td>需单独开发实时同步逻辑，适配难度大</td></tr></tbody></table>
<h2 data-id="heading-4">基本规范</h2>
<p>MCP 协议由两部分组成：<strong>工具描述</strong>和<strong>工具调用</strong>。</p>
<h3 data-id="heading-5">知识点</h3>
<ul>
<li><strong>stdio</strong>：标准输入输出，用于工具与外部交互。</li>
<li><strong>jsonrpc</strong>：JSON-RPC 是一种轻量级、基于文本的远程过程调用（RPC）协议，它允许客户端通过 HTTP 或其他传输协议调用远程服务器上的方法。</li>
</ul>
<h3 data-id="heading-6">工具描述</h3>
<p>工具描述是 MCP 服务中最重要的部分，它定义了工具的功能、输入输出格式、权限等信息。工具描述通常以 JSON 格式表示。</p>
<ul>
<li>请求</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"initialize"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"protocolVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"capabilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"roots"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"listChanged"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"clientInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"clientName"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"clientTitle"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"clientVersion"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>响应</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"protocolVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"capabilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"listChanged"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"serverInfo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mcp-server"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MCP Server"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.1"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-7">工具列表</h3>
<ul>
<li>请求</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tools/list"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>响应</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sum"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"两数求和"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Get the sum of two numbers"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"inputSchema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"number"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The first number"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"b"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"number"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The second number"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"a"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"b"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-8">工具调用</h3>
<ul>
<li>请求</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tools/call"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sum"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"arguments"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"a"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"b"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>响应</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"text"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1 + 2 = 3"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-9">MCP 开发调试</h2>
<h3 data-id="heading-10">工具</h3>
<pre><code class="hljs language-bash" lang="bash">npx @modelcontextprotocol/inspector
</code></pre>
<h3 data-id="heading-11">SDK</h3>
<pre><code class="hljs language-bash" lang="bash">npm install @modelcontextprotocol/sdk
</code></pre>
<h3 data-id="heading-12">案例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">McpServer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/mcp.js"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StdioServerTransport</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/server/stdio.js"</span>;
<span class="hljs-comment">//官方指定zod，用于定义输入输出格式</span>
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;

<span class="hljs-comment">//创建一个McpServer实例</span>
<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpServer</span>({
  <span class="hljs-comment">//设置服务器信息</span>
  <span class="hljs-attr">name</span>: <span class="hljs-string">"mcp-server"</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">"MCP Server"</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-string">"0.0.1"</span>,
});

<span class="hljs-comment">//注册一个求和的工具</span>
server.<span class="hljs-title function_">registerTool</span>(
  <span class="hljs-string">"sum"</span>,
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"两数求和"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">"两数求和"</span>,
    <span class="hljs-attr">inputSchema</span>: {
      <span class="hljs-attr">a</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"第一个数"</span>),
      <span class="hljs-attr">b</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"第二个数"</span>),
    },
  },
  <span class="hljs-function">(<span class="hljs-params">{ a, b }</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">content</span>: [
        {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>,
          <span class="hljs-attr">text</span>: <span class="hljs-string">`<span class="hljs-subst">${a}</span> + <span class="hljs-subst">${b}</span> = <span class="hljs-subst">${a + b}</span>`</span>,
        },
      ],
    };
  }
);

<span class="hljs-comment">//添加一个StdioServerTransport实例</span>
<span class="hljs-keyword">const</span> transport = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioServerTransport</span>();
server.<span class="hljs-title function_">connect</span>(transport);
</code></pre>
<p>对应上面的三个步骤</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebab249d48714fc582c1d719cfa61300~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ly25L-cbW9uc3Rlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451215&amp;x-signature=VRr198g%2Be%2BR4EplY%2FdTuaeQQES8%3D" alt="mcp-init.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b35c51acfaea48f4abfa362d42ff41fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ly25L-cbW9uc3Rlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451215&amp;x-signature=g3xzldwsnH9eiVj7%2BdHTEp0%2FyGo%3D" alt="mcp-list.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6bf69ea7b20430a98715ac85eed1935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ly25L-cbW9uc3Rlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451215&amp;x-signature=pluHjzwv%2Fko7Tatg4adXnyIo49s%3D" alt="mcp-call.png" loading="lazy"/></p>
<p><strong>使用：</strong></p>
<p>可以使用编辑器连接，例如：Trae</p>
<ul>
<li>手动添加 MCP 服务</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-comment">//服务名称</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">//执行命令</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"绝对路径"</span><span class="hljs-punctuation">]</span> <span class="hljs-comment">//执行命令参数</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>本地 MCP 服务配置完成，并且识别出了 <code>sum</code> 工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84579a0cd3e14352a9b49d8c02fbde9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ly25L-cbW9uc3Rlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451215&amp;x-signature=m1yyqyLm2b6R3XIMGdEkUTu%2FEk4%3D" alt="mcp-eg1.png" loading="lazy"/></p>
<p>也可以把编写好的服务上传到 npm，就可以远程配置。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Puppeteer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-puppeteer"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f0f31ca82f4486a8052ae36a1b4b652~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ly25L-cbW9uc3Rlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451215&amp;x-signature=4DOGqA8n6anzP3Z9bR3dK3Ffo1Y%3D" alt="mcp-eg2.png" loading="lazy"/></p>
<ul>
<li>
<p>将 MCP 添加到自定义智能体中</p>
</li>
<li>
<p>使用</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03c8cb4176bc484aa7c8dadcf516663f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ly25L-cbW9uc3Rlcg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451215&amp;x-signature=rY5vTOF0ucN0ECoqAMTnF4MMA%2BM%3D" alt="mcp-eg3.png" loading="lazy"/></p>
<p>这里就可以看到 AI 就开始调用自己写的工具输出结果。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FMhDK-XQIU6PwlxnRO0Nl4Q" target="_blank" title="https://mp.weixin.qq.com/s/MhDK-XQIU6PwlxnRO0Nl4Q" ref="nofollow noopener noreferrer">书洞笔记</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Scrapy爬虫多IP代理配置指南：避开反爬还能提速的实战技巧]]></title>    <link>https://juejin.cn/post/7570999443446988836</link>    <guid>https://juejin.cn/post/7570999443446988836</guid>    <pubDate>2025-11-11T07:17:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570999443446988836" data-draft-id="7571304204721127478" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Scrapy爬虫多IP代理配置指南：避开反爬还能提速的实战技巧"/> <meta itemprop="keywords" content="TCP/IP,爬虫"/> <meta itemprop="datePublished" content="2025-11-11T07:17:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="召唤神龙"/> <meta itemprop="url" content="https://juejin.cn/user/640384299179028"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Scrapy爬虫多IP代理配置指南：避开反爬还能提速的实战技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/640384299179028/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    召唤神龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:17:15.000Z" title="Tue Nov 11 2025 07:17:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当你的Scrapy爬虫频繁遭遇封禁时，切换IP代理是最直接的解决方案。但市面上代理服务商众多，如何选择适合Scrapy框架的代理IP？本文将从实战角度解析多IP代理的配置要点，并推荐两款经过验证的优质服务商。</p>
<h2 data-id="heading-0">一、为什么Scrapy必须用多IP代理？</h2>
<p>以某电商平台数据采集为例，同一IP连续访问超过50次就会被限制。实测发现，使用单个代理IP的爬虫存活时间不超过2小时，而采用动态轮换IP的爬虫可稳定运行72小时以上。多IP代理不仅能突破访问频次限制，还能通过地理IP分布获取区域专属内容。</p>
<h2 data-id="heading-1">二、选择代理IP的三大黄金标准</h2>
<p>1. 响应速度：影响采集效率的核心指标。建议选择延迟低于100ms的服务商，例如神龙IP代理的30ms响应技术，可让请求耗时缩短60%</p>
<p>2. 匿名等级：高匿代理能完全隐藏真实IP，避免被目标网站识别。推荐选择神龙HTTP这类获得三大运营商正规授权的服务商</p>
<p>3. 并发支持：根据业务规模选择套餐，小型项目建议5-10并发，大型项目可选择神龙HTTP的定制化解决方案</p>
<h2 data-id="heading-2">三、Scrapy配置代理IP的完整流程</h2>
<p>步骤1：在middlewares.py中创建代理中间件</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyMiddleware</span>(<span class="hljs-title class_ inherited__">object</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_request</span>(<span class="hljs-params">self, request, spider</span>):
        request.meta[<span class="hljs-string">'proxy'</span>] = <span class="hljs-string">'http://user:pass@ip:port'</span>
</code></pre>
<p>步骤2：安装scrapy-rotating-proxy扩展包</p>
<pre><code class="hljs language-python" lang="python">ROTATING_PROXY_LIST = [
    <span class="hljs-string">'http://ip1:port'</span>,
    <span class="hljs-string">'http://ip2:port'</span>, 
     添加至少<span class="hljs-number">20</span>个IP
]
</code></pre>
<p>步骤3：设置智能切换策略（失败自动剔除/成功保留机制）</p>
<h2 data-id="heading-3">四、两大优质代理服务商横向对比</h2>
<p>1. 神龙HTTP：适合企业级大数据采集</p>
<ul>
<li>3000万+动态IP资源池，支持HTTP/HTTPS/SOCKS5协议</li>
<li>实测1秒内完成IP切换，可用率稳定在99.2%以上</li>
<li>提供AI训练专用通道，支持百万级并发请求</li>
</ul>
<p>2. 神龙IP：适合精准区域数据采集</p>
<ul>
<li>覆盖200+城市线路，IP定位误差小于500米</li>
<li>自研智能路由算法，网络延迟降低40%</li>
<li>支持带宽定制，游戏试玩场景实测丢包率0.3%</li>
</ul>
<h2 data-id="heading-4">五、常见问题解决方案</h2>
<p>Q1：代理IP频繁失效怎么办？<br/>
A：检查IP存活检测机制，建议使用神龙HTTP的API动态获取存活IP，并设置每5分钟刷新代理池</p>
<p>Q2：如何避免代理IP被目标网站识别？<br/>
A：优先选用高匿代理，搭配神龙IP的流量加密技术，同时设置合理的请求间隔（建议3-10秒）</p>
<p>Q3：代理费用超出预算怎么处理？<br/>
A：可先使用神龙HTTP的免费测试套餐，确认效果后选择按量付费模式，实测可节省35%成本</p>
<h2 data-id="heading-5">六、进阶优化技巧</h2>
<p>1. 区域IP轮换策略：通过神龙IP的精准定位功能，模拟不同城市用户访问轨迹</p>
<p>2. 协议智能匹配：图片采集用HTTP代理，登录操作切换HTTPS加密通道</p>
<p>3. 流量负载均衡：将神龙HTTP的静态IP用于核心API请求，动态IP用于常规页面抓取</p>
<p>经过实际项目验证，采用多IP代理方案的Scrapy爬虫，数据采集成功率从37%提升至92%，日均采集量突破500万条。选择适配业务场景的代理服务商，配合科学的配置策略，才能真正发挥代理IP的技术价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Studio中Gradle、AGP、Java 版本关系：不再被构建折磨！]]></title>    <link>https://juejin.cn/post/7571156741397364751</link>    <guid>https://juejin.cn/post/7571156741397364751</guid>    <pubDate>2025-11-11T07:48:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571156741397364751" data-draft-id="7571156741397348367" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Studio中Gradle、AGP、Java 版本关系：不再被构建折磨！"/> <meta itemprop="keywords" content="Android,Android Studio"/> <meta itemprop="datePublished" content="2025-11-11T07:48:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_小雨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Studio中Gradle、AGP、Java 版本关系：不再被构建折磨！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_小雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:48:27.000Z" title="Tue Nov 11 2025 07:48:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>作为一名 Android 开发者，你是否也经历过这种崩溃场面：</p>
<p>刚拉个新项目准备运行，屏幕上立刻弹出——</p>
<p>Gradle 版本不匹配！</p>
<p>AGP 与 Gradle 不兼容！</p>
<p>请升级 JDK 至 17！</p>
<p>于是你打开 Settings 改了半天 JDK 版本，结果编译时又提示“Java 版本不对”。</p>
<p>这些看似玄学的报错，其实都源于<strong>对构建工具之间关系的不理解</strong>。</p>
<p>今天，我们就来彻底拆解：</p>
<blockquote>
<p>Android Studio、Gradle、AGP、Java 版本到底是怎么串起来工作的？</p>
<p>让你从此看清版本适配的底层逻辑。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">一、Gradle 与 AGP：引擎与插件的故事</h2>
<p>第一次接触 Android 项目时，都会疑惑——为什么 Gradle 和 AGP 总是绑在一起出现？</p>
<p>其实，它们是完全不同层次的东西，就像“引擎”和“变速箱”的关系。</p>
<hr/>
<h3 data-id="heading-2">Gradle：通用的构建引擎</h3>
<p>Gradle 是一个<strong>通用的构建自动化工具</strong>。</p>
<p>不论是 Java 后端、C++ 模块还是 Android 应用，它都能通过 <code>build.gradle</code> 脚本自动执行构建流程。</p>
<p>它的核心能力有三点：</p>
<ol>
<li>
<p><strong>自动化构建流程</strong></p>
<p>Gradle 会将构建过程拆分成一系列任务（Task），比如：</p>
<ul>
<li><code>clean</code>：清理旧的构建产物</li>
<li><code>compileJava</code>：编译源码</li>
<li><code>packageDebug</code>：打包可执行文件</li>
</ul>
<p>当你点击「Run」或「Build」时，其实就是在触发 Gradle 的任务调度。</p>
</li>
<li>
<p><strong>依赖管理</strong></p>
<p>通过配置 <code>implementation "com.squareup.okhttp3:okhttp:4.11.0"</code>，Gradle 会自动从 Maven 下载库文件。</p>
<p>它还会智能解决版本冲突，比如：</p>
<p><strong>A 库依赖 B 库 1.0，而 C 库依赖 B 库 2.0，Gradle 会自动选择合适版本。</strong></p>
</li>
<li>
<p><strong>高度可扩展性</strong></p>
<p>Gradle 自身不懂 Android，它只懂代码编译的“套路”。</p>
<p>但它提供了插件机制 —— 允许别人扩展它的能力。</p>
<p>而 AGP，就是这个“别人”。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">AGP：让 Gradle 看懂 Android 项目的插件</h3>
<p>AGP，全称 <strong>Android Gradle Plugin</strong>。</p>
<p>它是 Android 项目的专属插件，</p>
<p>让 Gradle 能“理解” Android 项目中的那些特殊结构和规则。</p>
<p>AGP 主要做了两件事：</p>
<ol>
<li>
<p><strong>告诉 Gradle：Android 项目要怎么编译</strong></p>
<p>比如：</p>
<ul>
<li>
<p><code>res/</code> 目录下的 XML 要通过 <code>aapt2</code> 编译；</p>
</li>
<li>
<p><code>AndroidManifest.xml</code> 要和多渠道配置合并；</p>
</li>
<li>
<p>JNI/NDK 代码要用特定工具链处理。</p>
<p>没有 AGP，Gradle 根本不知道该怎么处理这些文件。</p>
</li>
</ul>
</li>
<li>
<p><strong>给 Gradle 注册 Android 专属任务</strong></p>
<p>比如：</p>
<ul>
<li><code>processResources</code>：资源编译</li>
<li><code>dexBuilder</code>：生成 Dex 文件</li>
<li><code>packageDebug</code>：打包调试 APK</li>
<li><code>signingConfig</code>：签名配置</li>
</ul>
<p>这些任务的执行顺序、依赖关系，全由 AGP 定义。</p>
</li>
</ol>
<blockquote>
<p>简而言之：</p>
<p>Gradle 是“执行者”，AGP 是“指挥官”。</p>
<p>前者调度任务，后者定义 Android 构建规则。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">版本强绑定：不匹配就崩</h3>
<p>AGP 和 Gradle 之间的关系，是<strong>强绑定依赖</strong>。</p>
<p>比如：</p>





















<table><thead><tr><th>AGP 版本</th><th>对应 Gradle 版本</th></tr></thead><tbody><tr><td>7.0.x</td><td>7.0+</td></tr><tr><td>8.0.x</td><td>8.0+</td></tr><tr><td>8.5.x</td><td>8.7+</td></tr></tbody></table>
<p>如果搭配错误，Android Studio 会直接报错：</p>
<blockquote>
<p>“The minimum supported Gradle version is X.Y”</p>
</blockquote>
<p>所以在调版本时请记住：</p>
<blockquote>
<p>AGP 定义构建逻辑，Gradle 负责执行逻辑；两者必须版本匹配。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">二、Java 版本设置：为什么要写两遍？</h2>
<p>这是 Android 开发中最常见的困惑之一。</p>
<p>“明明在 Android Studio 设置了 Java 11，为什么在 <code>build.gradle</code> 里还要再写一遍？”</p>
<p>其实，它们控制的是<strong>完全不同的层面</strong>。</p>
<hr/>
<h3 data-id="heading-6">① Android Studio 的 Java 设置：Gradle 的“运行环境”</h3>
<p>位置：</p>
<blockquote>
<p>Settings → Build, Execution, Deployment → Build Tools → Gradle</p>
</blockquote>
<p>这个设置控制的是：</p>
<blockquote>
<p>Gradle 自己运行时用哪个 JDK。</p>
</blockquote>
<p>Gradle 是 Java 程序，它必须依赖 JDK 才能启动和执行任务。</p>
<p>如果这里的版本不满足要求（比如 AGP 8.0 要求 JDK 17+），构建就会直接失败。</p>
<p>这相当于：</p>
<blockquote>
<p>“Gradle 吃饭用的餐具”，它自己必须先能运行。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">② build.gradle 的 Java 设置：项目代码的“语法版本”</h3>
<p>在项目模块的 <code>build.gradle</code> 里写的配置，针对的是<strong>源码编译规则</strong>。</p>
<pre><code class="hljs language-ini" lang="ini">android {
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }
    kotlinOptions {
        <span class="hljs-attr">jvmTarget</span> = <span class="hljs-string">"11"</span>
    }
}
</code></pre>
<p>解释如下：</p>
<ul>
<li><code>sourceCompatibility</code>：源码使用的 Java 语法版本。</li>
<li><code>targetCompatibility</code>：生成字节码的兼容版本。</li>
<li><code>jvmTarget</code>：Kotlin 转换成字节码时的目标 JVM 版本。</li>
</ul>
<p>比如：</p>
<blockquote>
<p>你可以在 JDK 17 环境下编译 Java 11 语法的代码，</p>
<p>但不能反过来 —— 在 JDK 11 下编译 Java 17 语法。</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">核心原则</h3>
<p>必须满足以下规则：</p>
<blockquote>
<p>项目源码版本 ≤ Gradle 运行时的 JDK 版本</p>
</blockquote>
<p>否则，构建会直接失败。</p>
<p>举个例子：</p>
<ul>
<li>
<p>Android Studio 使用 JDK 17（Gradle 运行环境） ✅</p>
</li>
<li>
<p>项目源码设置 Java 11（代码语法版本） ✅</p>
<p>这样没问题。</p>
</li>
</ul>
<p>但如果反过来：</p>
<ul>
<li>
<p>Gradle 运行在 JDK 11</p>
</li>
<li>
<p>项目源码写了 Java 17 语法</p>
<p>编译直接报错：“Unsupported Java version”。</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-9">三、实战建议：3 个小技巧</h2>
<ol>
<li>
<p><strong>新项目尽量使用默认版本组合</strong></p>
<p>Android Studio 新建项目时会自动生成匹配的 Gradle + AGP 版本组合。</p>
<p>不要随意改动，除非你确实有升级理由。</p>
</li>
<li>
<p><strong>升级前查官方版本对应表</strong></p>
<p>升级 AGP 之前，务必检查：</p>
<ul>
<li>对应的 Gradle 版本是否满足？</li>
<li>JDK 是否达到要求？</li>
<li>Kotlin 插件版本是否兼容？</li>
</ul>
</li>
<li>
<p><strong>遇到错误，先看三件事</strong></p>
<ul>
<li>AGP ↔ Gradle 版本是否匹配？</li>
<li>Gradle 用的 JDK 是否满足 AGP 要求？</li>
<li>项目代码版本是否超过运行 JDK？</li>
</ul>
</li>
</ol>
<p>这三步，能解决 90% 的构建报错。</p>
<hr/>
<h2 data-id="heading-10">四、总结</h2>
<p>Android 构建体系看似复杂，其实逻辑很简单：</p>






























<table><thead><tr><th>角色</th><th>职责</th><th>关键点</th></tr></thead><tbody><tr><td><strong>Gradle</strong></td><td>构建引擎</td><td>负责执行任务、管理依赖</td></tr><tr><td><strong>AGP</strong></td><td>Android 插件</td><td>让 Gradle 懂 Android</td></tr><tr><td><strong>JDK（AS 设置）</strong></td><td>Gradle 运行环境</td><td>必须满足 AGP 要求</td></tr><tr><td><strong>Java（build.gradle）</strong></td><td>项目语法版本</td><td>必须 ≤ 运行 JDK</td></tr></tbody></table>
<h3 data-id="heading-11">一句话总结：</h3>
<blockquote>
<p>Gradle 是引擎，AGP 是插件，JDK 是燃料。</p>
<p>理清依赖关系，版本问题就迎刃而解。</p>
</blockquote>
<p>愿你下次点下「Run」键时，不再心惊胆战，而是微笑着看着 AS 流畅地输出：</p>
<pre><code class="hljs">BUILD SUCCESSFUL
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 中的异步编程与 Promise]]></title>    <link>https://juejin.cn/post/7571156741397446671</link>    <guid>https://juejin.cn/post/7571156741397446671</guid>    <pubDate>2025-11-11T07:53:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571156741397446671" data-draft-id="7571156741397430287" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 中的异步编程与 Promise"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T07:53:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="www_stdio"/> <meta itemprop="url" content="https://juejin.cn/user/631558156323657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 中的异步编程与 Promise
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/631558156323657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    www_stdio
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:53:14.000Z" title="Tue Nov 11 2025 07:53:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 中的异步编程与 Promise</h2>
<p>在前端开发中，JavaScript 的异步处理能力至关重要。由于 JavaScript 是一门<strong>单线程语言</strong>，它无法像多线程语言那样同时执行多个任务。然而，现代 Web 应用常常需要处理网络请求、文件读取、定时器等耗时操作。如果这些操作阻塞主线程，用户界面就会“卡死”，严重影响体验。为了解决这个问题，JavaScript 引入了**事件循环（Event Loop）**机制，并通过 <strong>Promise</strong> 等工具让异步代码更可控、更易读。</p>
<h3 data-id="heading-1">单线程与异步的本质</h3>
<p>JavaScript 的执行模型基于一个主线程。所有同步代码（如 <code>console.log</code>、变量声明、循环等）都会按顺序依次执行。但当遇到可能耗时的操作（比如 <code>setTimeout</code>、文件读取、网络请求），JavaScript 不会停下来等待，而是将这些任务交给浏览器或 Node.js 环境的其他线程（如 I/O 线程）去处理，并把回调函数放入**任务队列（Task Queue）**中。主线程继续执行后续同步代码，等当前任务栈清空后，再从队列中取出回调函数执行。</p>
<p>例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
}, <span class="hljs-number">3000</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
</code></pre>
<p>输出顺序是：<code>1 → 3 → 2</code>。<br/>
虽然 <code>setTimeout</code> 写在中间，但它被“推迟”执行，主线程不会等待 3 秒。</p>
<p>这种机制保证了页面的响应性，但也带来了“回调地狱”（Callback Hell）的问题——多层嵌套的回调难以维护。</p>
<h3 data-id="heading-2">Promise：让异步代码更清晰</h3>
<p>ES6 引入的 <strong>Promise</strong> 对象，正是为了解决异步流程控制的混乱问题。Promise 代表一个<strong>尚未完成但未来会完成的操作</strong>，它有三种状态：</p>
<ul>
<li><strong>pending（进行中）</strong></li>
<li><strong>fulfilled（已成功）</strong></li>
<li><strong>rejected（已失败）</strong></li>
</ul>
<p>一旦状态改变（从 pending 变为 fulfilled 或 rejected），就不可逆。</p>
<h4 data-id="heading-3">基本用法</h4>
<p>创建一个 Promise：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">// 立即执行的“执行器”函数（executor）</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
    <span class="hljs-title function_">resolve</span>(); <span class="hljs-comment">// 标记为成功</span>
  }, <span class="hljs-number">3000</span>);
});

p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 在 resolve 后执行</span>
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>);
</code></pre>
<p>输出顺序：<code>4 → 2 → 3</code>。<br/>
注意：<code>then</code> 中的回调不会立即执行，而是在 Promise 状态变为 fulfilled 后，被放入微任务队列（Microtask Queue），在当前同步代码执行完后、下一次事件循环前执行。</p>
<h4 data-id="heading-4">处理错误</h4>
<p>如果异步操作失败，可以调用 <code>reject()</code>，并通过 <code>.catch()</code> 捕获错误：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./b.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-title function_">reject</span>(err); <span class="hljs-comment">// 失败</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">resolve</span>(data.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 成功</span>
    }
  });
});

p.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
}).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err, <span class="hljs-string">'读取文件失败'</span>);
});
</code></pre>
<p>这段代码展示了如何用 Promise 封装 Node.js 的异步文件读取操作，避免了传统的回调嵌套。</p>
<h4 data-id="heading-5">链式调用与数据传递</h4>
<p>Promise 的强大之处还在于<strong>链式调用</strong>。每个 <code>.then()</code> 可以返回一个新的值或新的 Promise，从而形成清晰的流程：</p>
<pre><code class="hljs language-ini" lang="ini">fetch('https://api.github.com/orgs/lemoncode/members')
  .then(<span class="hljs-attr">response</span> =&gt; response.json())
  .then(<span class="hljs-attr">members</span> =&gt; {
    const <span class="hljs-attr">listHtml</span> = members.map(item =&gt; `&lt;li&gt;<span class="hljs-variable">${item.login}</span>&lt;/li&gt;`).join(<span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
    document.getElementById('members').<span class="hljs-attr">innerHTML</span> = listHtml<span class="hljs-comment">;</span>
  })
  .catch(<span class="hljs-attr">error</span> =&gt; {
    console.error('获取成员失败:', error)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
</code></pre>
<p>这里，<code>fetch</code> 返回一个 Promise，<code>.then()</code> 依次处理响应和数据，逻辑一目了然。</p>
<h3 data-id="heading-6">总结</h3>
<ul>
<li>JavaScript 是单线程语言，通过事件循环处理异步任务。</li>
<li>异步操作（如定时器、I/O、网络请求）不会阻塞主线程。</li>
<li>Promise 是 ES6 提供的异步流程控制工具，通过 <code>resolve</code>/<code>reject</code> 和 <code>.then()</code>/<code>.catch()</code> 实现更清晰的代码结构。</li>
<li>使用 Promise 可以避免回调地狱，支持链式调用和错误统一处理。</li>
<li>结合现代语法（如 <code>async/await</code>），异步代码甚至可以写得像同步代码一样直观。</li>
</ul>
<p>掌握 Promise，是迈向高效、可维护 JavaScript 开发的重要一步。无论是前端 AJAX 请求，还是 Node.js 后端文件操作，Promise 都是你不可或缺的伙伴。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 原生 app 和 WebView 如何交互？]]></title>    <link>https://juejin.cn/post/7571051830710779954</link>    <guid>https://juejin.cn/post/7571051830710779954</guid>    <pubDate>2025-11-11T07:54:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571051830710779954" data-draft-id="7571028035018866714" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 原生 app 和 WebView 如何交互？"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-11T07:54:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Vic_wkx"/> <meta itemprop="url" content="https://juejin.cn/user/1116759545357182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 原生 app 和 WebView 如何交互？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759545357182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Vic_wkx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:54:10.000Z" title="Tue Nov 11 2025 07:54:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>在移动开发中，我们有时候会遇到这样的需求：</p>
<ul>
<li>有一部分功能需要网页实现（比如登录页、主页，已经有网页端了，不希望在 app 中再写一遍）</li>
<li>另一部分功能需要原生实现（比如硬件访问、获取系统权限、或者一些注重性能的逻辑）</li>
</ul>
<p>这时候 <strong>Hybrid App（原生 + WebView 混合应用）</strong> 就派上用场了。</p>
<p>本文带你全面了解 <strong>Android 原生 App 和 WebView 的交互方式</strong>，并附上实战示例。</p>
<hr/>
<h2 data-id="heading-1">二、交互</h2>
<p>WebView 与原生 App 的交互也就两种：</p>
<ol>
<li><strong>网页调用 App 原生方法</strong>（JS → Native）</li>
<li><strong>App 调用网页 JS 方法</strong>（Native → JS）</li>
</ol>
<p>双向通信的典型场景：</p>

























<table><thead><tr><th>场景</th><th>方向</th><th>示例</th></tr></thead><tbody><tr><td>网页点击按钮调用 app 功能</td><td>JS → Native</td><td><code>window.myApp.nativeMethod('a')</code></td></tr><tr><td>App 收集设备信息反馈给网页</td><td>Native → JS</td><td><code>webView.evaluateJavascript("jsMethod('a', 'b')")</code></td></tr><tr><td>登录状态同步</td><td>双向</td><td>网页通知 App 用户登录了，App 也可以主动查询网页是否已登录</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-2">2.1 编写本地 html</h3>
<p>写一个本地的 html 文件 test_login.html，内容如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Login Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Hybrid Login Demo<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"login()"</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"logout()"</span>&gt;</span>Logout<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">loginState</span> = { <span class="hljs-attr">isLoggedIn</span>: <span class="hljs-literal">false</span> };

    <span class="hljs-variable language_">window</span>.<span class="hljs-property">isUserLoggedIn</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"isUserLoggedIn = "</span> + <span class="hljs-variable language_">window</span>.<span class="hljs-property">loginState</span>.<span class="hljs-property">isLoggedIn</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">loginState</span>.<span class="hljs-property">isLoggedIn</span>;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">login</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">loginState</span>.<span class="hljs-property">isLoggedIn</span> = <span class="hljs-literal">true</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Login success!"</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">myApp</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">myApp</span>.<span class="hljs-property">onLoginStateChanged</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">myApp</span>.<span class="hljs-title function_">onLoginStateChanged</span>(<span class="hljs-literal">true</span>);
      }
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">loginState</span>.<span class="hljs-property">isLoggedIn</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Logout success!"</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">myApp</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">myApp</span>.<span class="hljs-property">onLoginStateChanged</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">myApp</span>.<span class="hljs-title function_">onLoginStateChanged</span>(<span class="hljs-literal">false</span>);
      }
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>运行效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc58a5cc910044f484bf4e55a4151dd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmljX3dreA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763452449&amp;x-signature=pmu9gv%2Bfk0BzD5Eqr5KThN7C31k%3D" alt="loginHtml.png" loading="lazy"/></p>
<p>可以看到，页面内容很简单，一个 title，两个按钮。一个用于登入，一个用于登出。</p>
<p>html 中维护了一个 loginState.isLoggedIn 属性，表示用户是否已登录。</p>
<p>提供了一个 isUserLoggedIn 函数，用于查询当前登录状态。</p>
<p>另外，还有一个 login 和一个 logout 方法，分别用于模拟登入登出，当状态改变后，通过 <code>window.myApp.onLoginStateChanged</code> 回调通知 app 登陆状态发生了改变。</p>
<h3 data-id="heading-3">2.2 编写 app</h3>
<p>为了便于测试，我们将 test_login.html 文件，放在 assets 文件夹下，app 上的 WebView 直接加载本地 url 即可。</p>
<p>MainActivity 完整代码：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">package</span> com.example.interaction

<span class="hljs-keyword">import</span> android.os.Bundle
<span class="hljs-keyword">import</span> android.webkit.CookieManager
<span class="hljs-keyword">import</span> android.webkit.WebChromeClient
<span class="hljs-keyword">import</span> android.webkit.WebSettings
<span class="hljs-keyword">import</span> android.webkit.WebView
<span class="hljs-keyword">import</span> android.webkit.WebViewClient
<span class="hljs-keyword">import</span> android.widget.Toast
<span class="hljs-keyword">import</span> androidx.activity.ComponentActivity
<span class="hljs-keyword">import</span> androidx.activity.compose.setContent
<span class="hljs-keyword">import</span> androidx.activity.enableEdgeToEdge
<span class="hljs-keyword">import</span> androidx.compose.foundation.layout.*
<span class="hljs-keyword">import</span> androidx.compose.material3.Button
<span class="hljs-keyword">import</span> androidx.compose.material3.Scaffold
<span class="hljs-keyword">import</span> androidx.compose.material3.Text
<span class="hljs-keyword">import</span> androidx.compose.runtime.*
<span class="hljs-keyword">import</span> androidx.compose.ui.Modifier
<span class="hljs-keyword">import</span> androidx.compose.ui.platform.LocalContext
<span class="hljs-keyword">import</span> androidx.compose.ui.unit.dp
<span class="hljs-keyword">import</span> androidx.compose.ui.viewinterop.AndroidView
<span class="hljs-keyword">import</span> com.example.interaction.ui.theme.WebViewJsInteractionDemoTheme

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        enableEdgeToEdge()
        setContent {
            WebViewJsInteractionDemoTheme {
                Scaffold(modifier = Modifier.fillMaxSize()) { innerPadding -&gt;
                    LoginWebView(modifier = Modifier.padding(innerPadding))
                }
            }
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">LoginWebView</span><span class="hljs-params">(modifier: <span class="hljs-type">Modifier</span> = Modifier)</span></span> {
    <span class="hljs-keyword">var</span> loginStatus <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">"Unknown"</span>) }
    <span class="hljs-keyword">val</span> context = LocalContext.current
    <span class="hljs-keyword">val</span> webViewRef = remember { mutableStateOf&lt;WebView?&gt;(<span class="hljs-literal">null</span>) }

    Column(modifier = modifier.fillMaxSize()) {
        AndroidView(
            modifier = Modifier
                .weight(<span class="hljs-number">1f</span>)
                .fillMaxWidth(),
            factory = { context -&gt;
                WebView(context).apply {
                    settings.apply {
                        javaScriptEnabled = <span class="hljs-literal">true</span>
                        domStorageEnabled = <span class="hljs-literal">true</span>
                        allowFileAccess = <span class="hljs-literal">true</span>
                        allowContentAccess = <span class="hljs-literal">true</span>
                        cacheMode = WebSettings.LOAD_DEFAULT
                    }
                    webChromeClient = WebChromeClient()

                    webViewClient = <span class="hljs-keyword">object</span> : WebViewClient() {
                        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onPageFinished</span><span class="hljs-params">(view: <span class="hljs-type">WebView</span>?, url: <span class="hljs-type">String</span>?)</span></span> {
                            <span class="hljs-keyword">super</span>.onPageFinished(view, url)
                            <span class="hljs-comment">// Query login status when page is loaded</span>
                            evaluateJavascript(<span class="hljs-string">"isUserLoggedIn()"</span>) { result -&gt;
                                <span class="hljs-keyword">val</span> isLoggedIn = result?.contains(<span class="hljs-string">"true"</span>) == <span class="hljs-literal">true</span>
                                loginStatus = <span class="hljs-keyword">if</span> (isLoggedIn) <span class="hljs-string">"Logged In"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"Logged Out"</span>
                            }
                        }
                    }

                    <span class="hljs-comment">// Register the JavaScript interface</span>
                    addJavascriptInterface(<span class="hljs-keyword">object</span> {
                        <span class="hljs-meta">@android</span>.webkit.JavascriptInterface
                        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLoginStateChanged</span><span class="hljs-params">(isLoggedIn: <span class="hljs-type">Boolean</span>)</span></span> {
                            (context <span class="hljs-keyword">as</span> ComponentActivity).runOnUiThread {
                                loginStatus = <span class="hljs-keyword">if</span> (isLoggedIn) <span class="hljs-string">"Logged In"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"Logged Out"</span>
                                Toast.makeText(context, <span class="hljs-string">"Login status changed: <span class="hljs-variable">$loginStatus</span>"</span>, Toast.LENGTH_SHORT).show()
                            }
                        }
                    }, <span class="hljs-string">"myApp"</span>)

                    WebView.setWebContentsDebuggingEnabled(<span class="hljs-literal">true</span>)
                    CookieManager.getInstance().setAcceptCookie(<span class="hljs-literal">true</span>)

                    loadUrl(<span class="hljs-string">"file:///android_asset/test_login.html"</span>)
                    webViewRef.value = <span class="hljs-keyword">this</span>
                }
            }
        )

        Spacer(modifier = Modifier.height(<span class="hljs-number">16.</span>dp))

        <span class="hljs-comment">// Check login status button</span>
        Button(
            onClick = {
                webViewRef.value?.evaluateJavascript(<span class="hljs-string">"isUserLoggedIn()"</span>) { result -&gt;
                    <span class="hljs-keyword">val</span> isLoggedIn = result?.contains(<span class="hljs-string">"true"</span>) == <span class="hljs-literal">true</span>
                    loginStatus = <span class="hljs-keyword">if</span> (isLoggedIn) <span class="hljs-string">"Logged In"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"Logged Out"</span>
                    Toast.makeText(context, <span class="hljs-string">"Login status: <span class="hljs-variable">$loginStatus</span>"</span>, Toast.LENGTH_SHORT).show()
                }
            },
            modifier = Modifier
                .fillMaxWidth()
                .padding(horizontal = <span class="hljs-number">16.</span>dp)
        ) {
            Text(<span class="hljs-string">"Check Login Status"</span>)
        }

        Spacer(modifier = Modifier.height(<span class="hljs-number">8.</span>dp))

        Text(
            text = <span class="hljs-string">"Current Status: <span class="hljs-variable">$loginStatus</span>"</span>,
            modifier = Modifier.padding(horizontal = <span class="hljs-number">16.</span>dp)
        )
    }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5380cf1266934b0b9f6aeb7da6897c15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmljX3dreA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763452449&amp;x-signature=LBEryz%2B02B%2BN%2F1uqSnU02IOIZuk%3D" alt="loginDemo.gif" loading="lazy"/></p>
<p>可以看到，在 MainActivity 中，通过 addJavascriptInterface 函数添加了 onLoginStateChanged 接口供 Web 端调用，添加接口时，第二个参数是 name，Web 端将通过 <code>name.接口名</code> 来调用对应的接口，例如：<code>window.myApp.onLoginStateChanged(true);</code>。</p>
<p>在点击 Check Login Status 按钮后，通过 WebView 的 evaluateJavascript 函数调用网页端的 isUserLoggedIn 函数，收到 result 后，更新 loginStatus 变量。</p>
<p>另外，还自定义了 WebViewClient，在 onPageFinished 调用后，主动调用一次 isUserLoggedIn 函数，完成 Current Status 的初始化。</p>
<h2 data-id="heading-4">三、后话</h2>
<p>有一些需要注意的点：</p>
<ul>
<li>调用 js 方法时，结果是异步返回的，通过 listener 接收结果。</li>
<li><code>@JavascriptInterface</code> 的方法在 <strong>非 UI 线程</strong> 执行，如果要更新 UI，需要使用 <code>runOnUiThread</code>。</li>
<li>设置了 <code>WebView.setWebContentsDebuggingEnabled(true)</code> 之后，通过 Chrome DevTools 可直接调试 WebView。方法是在 app 加载了网页后，在 Chrome 浏览器访问 <code>chrome://inspect/#devices</code>，在这里找到自己的设备，点击 inspect。我对这种方式不是很熟悉，就不过多介绍了。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db2ea15ecbc34ed0b9002afbd76172dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmljX3dreA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763452449&amp;x-signature=DI%2Bvvqwxu%2BQZ9Xsygf1GxP0dCDM%3D" alt="chrome.png" loading="lazy"/></p>
<h2 data-id="heading-5">附：一些常见的问题</h2>
<blockquote>
<p>注：这一节是 AI 总结的，不保真：</p>
</blockquote>
<p>在 WebView 中，通过 webView.settings 可以获取到 WebSettings，它可以用来配置一系列网页渲染与访问能力。以下是关键属性解释：</p>

























































































<table><thead><tr><th>属性</th><th>作用</th><th>是否常用</th><th>注意事项</th></tr></thead><tbody><tr><td><code>javaScriptEnabled = true</code></td><td>启用网页中的 JavaScript 执行。没有这个，网页的交互和动态内容几乎全失效。</td><td>✅ 必须</td><td>启用 JS 后要配合 <code>addJavascriptInterface</code> 谨慎使用，否则存在安全隐患。</td></tr><tr><td><code>domStorageEnabled = true</code></td><td>启用 HTML5 的 DOM Storage（<code>localStorage</code> / <code>sessionStorage</code>）。网页才能保存本地状态。</td><td>✅ 常用</td><td>现代 Web 必备。</td></tr><tr><td><code>databaseEnabled = true</code></td><td>启用 Web SQL 数据库（旧标准）。</td><td>⚠️ 较旧</td><td>新网页一般用 IndexedDB。</td></tr><tr><td><code>allowFileAccess = true</code></td><td>允许访问本地文件（<code>file://</code>）。</td><td>✅ 常用</td><td>某些 WebView 资源加载或本地调试需要。</td></tr><tr><td><code>allowContentAccess = true</code></td><td>允许访问 <code>content://</code> URI 内容（如系统媒体）。</td><td>✅ 常用</td><td>安全风险低。</td></tr><tr><td><code>allowFileAccessFromFileURLs = true</code></td><td>允许网页 JS 从 file:// 页面访问其他本地文件。</td><td>⚠️ 慎用</td><td>容易被恶意网页利用本地文件。</td></tr><tr><td><code>allowUniversalAccessFromFileURLs = true</code></td><td>允许 file:// 页面访问任意网络资源（http/https）。</td><td>⚠️ 高风险</td><td>建议仅限调试环境启用。</td></tr><tr><td><code>useWideViewPort = true</code></td><td>启用自适应宽度，让网页以「网页比例」显示而非手机分辨率。</td><td>✅ 常用</td><td>与 <code>loadWithOverviewMode</code> 一起使用更佳。</td></tr><tr><td><code>loadWithOverviewMode = true</code></td><td>缩放网页以适配屏幕宽度。</td><td>✅ 常用</td><td>常配合 responsive 页面。</td></tr><tr><td><code>setSupportZoom(true)</code></td><td>支持缩放。</td><td>✅ 常用</td><td>可搭配手势操作。</td></tr><tr><td><code>builtInZoomControls = true</code></td><td>启用内建缩放按钮。</td><td>✅ 可选</td><td>通常在调试或旧网页中启用。</td></tr><tr><td><code>displayZoomControls = false</code></td><td>隐藏默认的缩放控件（仅保留手势缩放）。</td><td>✅ 推荐</td><td>提升视觉体验。</td></tr><tr><td><code>cacheMode = WebSettings.LOAD_DEFAULT</code></td><td>启用缓存策略。</td><td>✅ 常用</td><td>可选 <code>LOAD_NO_CACHE</code> 禁止缓存。</td></tr></tbody></table>
<p>WebViewClient 和 WebChromeClient 的区别：</p>



































<table><thead><tr><th>对比项</th><th><code>WebViewClient</code></th><th><code>WebChromeClient</code></th></tr></thead><tbody><tr><td>职责</td><td>控制页面导航与加载逻辑</td><td>控制网页中“浏览器行为”与 UI 事件</td></tr><tr><td>常用回调</td><td><code>shouldOverrideUrlLoading</code>、<code>onPageStarted</code>、<code>onPageFinished</code>、<code>onReceivedError</code></td><td><code>onProgressChanged</code>、<code>onReceivedTitle</code>、<code>onConsoleMessage</code>、<code>onJsAlert</code></td></tr><tr><td>场景举例</td><td>拦截跳转、处理自定义 URL Scheme、控制加载动画</td><td>显示网页标题、监控加载进度、拦截 JS 弹窗、打印调试信息</td></tr><tr><td>比喻</td><td>浏览器“司机”</td><td>浏览器“仪表盘”</td></tr><tr><td>建议</td><td>必须设置一个（否则无法处理跳转）</td><td>可选（但调试与交互建议加）</td></tr></tbody></table>
<p>👉 <strong>总结一句话</strong>：</p>
<blockquote>
<p><code>WebViewClient</code> 负责“页面去哪”，<code>WebChromeClient</code> 负责“页面看起来怎样”。</p>
</blockquote>
<p>其他关键配置：</p>

























<table><thead><tr><th>配置</th><th>作用</th></tr></thead><tbody><tr><td><code>setLayerType(View.LAYER_TYPE_HARDWARE, null)</code></td><td>启用硬件加速，提升渲染性能（尤其是视频或动画）。</td></tr><tr><td><code>setOnLongClickListener { true }</code> + <code>isLongClickable = false</code></td><td>禁用长按（防止复制或保存图片）。</td></tr><tr><td><code>WebView.setWebContentsDebuggingEnabled(true)</code></td><td>允许通过 Chrome 调试网页内容（chrome://inspect）。</td></tr><tr><td><code>CookieManager.getInstance().setAcceptThirdPartyCookies(...)</code></td><td/></tr></tbody></table>
<p>以上就是本文的全部内容了，如果你喜欢本文的内容，欢迎点赞、投币、收藏、转发，更重要的是点一个大大的关注，这对我们有非常大的帮助......</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[肝了半个月，我用 Flutter 写了个功能强大的图片编辑器，告别image_cropper]]></title>    <link>https://juejin.cn/post/7571067260053585946</link>    <guid>https://juejin.cn/post/7571067260053585946</guid>    <pubDate>2025-11-11T07:40:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571067260053585946" data-draft-id="7571086754880307246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="肝了半个月，我用 Flutter 写了个功能强大的图片编辑器，告别image_cropper"/> <meta itemprop="keywords" content="前端,Android,Flutter"/> <meta itemprop="datePublished" content="2025-11-11T07:40:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小林的跨端开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/3320949647350765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            肝了半个月，我用 Flutter 写了个功能强大的图片编辑器，告别image_cropper
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3320949647350765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小林的跨端开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:40:58.000Z" title="Tue Nov 11 2025 07:40:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：为什么需要图片编辑？</h2>
<p>在如今的应用开发中，图片处理几乎是社交、电商、工具类 App 的标配功能。用户上传头像需要裁剪，分享美图需要编辑，添加水印需要文字功能，为 App 添加一个头像上传功能等等...这些听起来像是一个再普通不过的需求。产品经理的要求也很简单：“用户选完图片，能把它裁成 1:1 的正方形就行。”</p>
<p>于是，我像往常一样打开 <code>pub.dev</code>，很快就找到 <code>image_cropper</code>。看起来完美，对吧？</p>
<p><strong>然而，现实很快就给了我一记重拳。</strong></p>
<p>当我把这个功能集成进我跨平台的 Flutter 应用后，一连串的问题浮出水面：</p>
<ol>
<li><strong>UI/UX 的巨大鸿沟</strong>：<code>image_cropper</code> 的核心是<strong>通过 <code>MethodChannel</code> 调用原生插件</strong>。这直接导致了 Android 和 iOS 两端的裁剪界面（UI）和交互体验（UX）存在巨大差异。对于我这样追求品牌一致性和统一用户体验的团队来说，这几乎是不可接受的。</li>
<li><strong>桌面端的缺失</strong>：我的应用需要支持 Windows 和 Mac，而 <code>image_cropper</code> 在桌面端的支持并不理想，这直接堵死了我的全平台之路。</li>
<li><strong>扩展性的枷锁</strong>：产品经理紧接着说：“我后续的内容模块需要16:9的封面图，商品模块可能需要自由裁剪……” 我意识到，一个基于原生UI封装的库，很难满足我未来灵活多变的裁剪比例需求。</li>
<li><strong>性能的隐忧</strong>：后端同事也发来提醒：“上传的图片不能太大，最好能在客户端压缩一下，不然服务器和带宽顶不住！” 这意味着我不仅要裁剪，还需要在<strong>不严重损失画质的前提下，对图片进行缩放（Scale）处理，以达到压缩体积的效果</strong>。而这一点，<code>image_cropper</code> 提供的控制力非常有限。</li>
</ol>
<p>面对这些“卡脖子”的问题，我意识到，我需要的不只是一个“能用”的裁剪工具。我需要的是一个<strong>纯 Dart 实现、跨平台 UI 完全一致、功能高度可控、并且能精细化处理图片尺寸</strong>的解决方案。</p>
<p>市面上没有现成的轮子，那就自己造一个！</p>
<p>于是，我肝了半个月，从零开始，用 <code>CustomPaint</code> 和矩阵变换硬核打造了这款全新的 Flutter 图片编辑器。它不仅解决了上述所有痛点，还带来了更多惊喜：</p>
<ul>
<li><strong>像素级无损裁剪</strong>：支持任意比例和自由裁剪，保证画质。</li>
<li><strong>内置缩放压缩</strong>：在裁剪的同时，通过精密的 <code>scale</code> 计算，有效控制输出图片的尺寸和体积。</li>
<li><strong>跨平台体验完全一致</strong>：纯 Dart 绘制，告别平台差异。</li>
<li><strong>不止是裁剪</strong>：它还集成了 360° 自由旋转、功能完善的文本添加与编辑，以及健全的撤销/重做历史管理机制。</li>
</ul>
<p><strong>先来看看最终效果</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07f0efb092c1440f909ae9c2aefa49dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6X55qE6Leo56uv5byA5Y-R5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451658&amp;x-signature=pfbi%2BdlRYKuEPwiC3qeB72Mubew%3D" alt="Simulator Screenshot - iPhone 16 Plus - 2025-11-11 at 15.15.17.png" loading="lazy"/></p>
<ul>
<li>图1:图片编辑主界面：回滚、裁剪、渲染、贴图、撤销</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f2282066c75447399d6a1f853e18e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6X55qE6Leo56uv5byA5Y-R5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451658&amp;x-signature=JvJWRsw0A2vNDfl2qdPazhro50w%3D" alt="Simulator Screenshot - iPhone 16 Plus - 2025-11-11 at 15.15.45.png" loading="lazy"/></p>
<ul>
<li>图2:图片裁剪主界面：自由比例、特定比例</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d9a3ef6df0442fcb11e0c01a94dfd5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6X55qE6Leo56uv5byA5Y-R5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451658&amp;x-signature=yMLAIR3L6iGO5SeqTz9AyNGMfRI%3D" alt="Simulator Screenshot - iPhone 16 Plus - 2025-11-11 at 15.16.02.png" loading="lazy"/></p>
<ul>
<li>图3:图片旋转主界面：自由角度、特定角度</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca18dd1b054346a4834ea9e7da72937c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6X55qE6Leo56uv5byA5Y-R5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451658&amp;x-signature=%2FpB%2FFvlPywPrcU%2FusA%2FkP%2BdBfao%3D" alt="Simulator Screenshot - iPhone 16 Plus - 2025-11-11 at 15.16.35.png" loading="lazy"/></p>
<ul>
<li>图4:图片贴图主界面</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe8831c4cf714fe48df71482b197a1b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5p6X55qE6Leo56uv5byA5Y-R5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763451658&amp;x-signature=CuvEa3glcVnNRYnnYycN%2FGoW08o%3D" alt="Simulator Screenshot - iPhone 16 Plus - 2025-11-11 at 15.17.01.png" loading="lazy"/></p>
<ul>
<li>原图和编辑后的对比：压缩系数（可配置）</li>
</ul>
<h2 data-id="heading-1">编辑器的架构设计</h2>
<p>一个复杂的系统，好的架构是成功的一半。我不想把所有逻辑都堆在一个臃肿的 <code>StatefulWidget</code> 里，那样会变成难以维护的“上帝类”。因此，我从一开始就确立了**“关注点分离”**的核心设计原则。</p>
<p>整个编辑器被拆分为以下几个层次：</p>
<ul>
<li>
<p><strong>视图层 (View)</strong> ：由 <code>ImageEditorView</code> 和 <code>CustomPainter</code> 组成，纯粹负责UI的渲染和用户手势的捕获。它本身不包含任何业务逻辑。</p>
</li>
<li>
<p><strong>控制器 (Controller)</strong> ：<code>ImageEditorController</code> 是整个编辑器的“大脑”。它继承自 <code>ChangeNotifier</code>，负责管理所有状态（图片、旋转角度、裁剪框、文本层等），处理业务逻辑，并通知视图层更新。</p>
</li>
<li>
<p><strong>模型层 (Model)</strong> -：<code>TextLayerData</code>, <code>ImageEditorConfig</code> 等，就是最纯粹的数据结构。</p>
</li>
<li>
<p><strong>处理器/管理器 (Handlers/Managers)</strong> ：这是本次设计的精髓。我将不同功能的复杂逻辑抽离成独立的类，让 Controller 保持清爽，只做“指挥官”。</p>
<ul>
<li><code>CropHandler</code>: 负责所有与裁剪相关的计算，如初始化裁剪框、限制边界、执行高保真裁剪。</li>
<li><code>RotationHandler</code>: 负责渲染旋转后的图片。</li>
<li><code>TextLayerManager</code>: 专门管理文本图层的增删改查和状态。</li>
<li><code>HistoryManager</code>: 负责管理操作快照，实现撤销和重做。</li>
</ul>
</li>
</ul>
<p>这种分层架构带来了巨大的好处：</p>
<ol>
<li><strong>高内聚，低耦合</strong>：每个模块只关心自己的职责，修改裁剪逻辑不会影响文本功能。</li>
<li><strong>易于测试</strong>：可以单独对 <code>CropHandler</code> 或 <code>HistoryManager</code> 进行单元测试。</li>
<li><strong>可扩展性强</strong>：未来想增加“滤镜”功能？只需要新增一个 <code>FilterHandler</code>，然后在 Controller 中集成即可，对现有代码的侵入极小。</li>
</ol>
<h2 data-id="heading-2">万物皆可绘：CustomPaint 的魔力</h2>
<p>编辑器的核心显示区域，本质上是一个画布（Canvas），我需要在上面自由地绘制图片、裁剪框、文本等元素。在 Flutter 中，<code>CustomPaint</code> 和 <code>CustomPainter</code> 是实现这一需求的最佳选择。</p>
<p>我的 <code>ImageEditorPainter</code> 的 <code>paint</code> 方法，就像一位画家在按步骤作画：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ImageEditorPainter.dart</span>
<span class="hljs-meta">@override</span>
<span class="hljs-keyword">void</span> paint(Canvas canvas, Size size) {
    <span class="hljs-comment">// ... 获取 controller 中的各种状态 ...</span>

    <span class="hljs-comment">// --- 1. 绘制变换后的图片 ---</span>
    <span class="hljs-comment">// 这是核心绘制逻辑，保证图片居中显示并应用旋转和缩放</span>
    <span class="hljs-keyword">final</span> canvasCenterX = size.width / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">final</span> canvasCenterY = size.height / <span class="hljs-number">2</span>;
    canvas.save(); <span class="hljs-comment">// 保存当前画布状态</span>
    canvas.translate(canvasCenterX, canvasCenterY); <span class="hljs-comment">// 将画布原点移到中心</span>
    canvas.rotate(rotationAngle); <span class="hljs-comment">// 旋转</span>
    canvas.scale(scale, scale); <span class="hljs-comment">// 缩放</span>
    <span class="hljs-comment">// 以图片中心为原点绘制</span>
    canvas.drawImage(image, Offset(-image.width / <span class="hljs-number">2</span>, -image.height / <span class="hljs-number">2</span>), paint);
    canvas.restore(); <span class="hljs-comment">// 恢复画布状态，后续绘制不受影响</span>

    <span class="hljs-comment">// --- 2. 如果裁剪激活，则绘制裁剪UI ---</span>
    <span class="hljs-keyword">if</span> (isCropping &amp;&amp; cropRect != <span class="hljs-keyword">null</span>) {
      _drawCropUI(canvas, size, cropRect, handleSize);
    }

    <span class="hljs-comment">// --- 3. 绘制所有文本图层 ---</span>
    _drawTextLayers(canvas, size);
}
</code></pre>
<p>这里有几个关键点：</p>
<ol>
<li><strong><code>canvas.save()</code> 和 <code>canvas.restore()</code></strong> ：这对组合是 <code>Canvas</code> 操作的黄金法则。它能确保我的变换（平移、旋转、缩放）只对绘制图片生效，而不会影响后续裁剪框和文本的绘制。</li>
<li><strong>中心点变换</strong>：所有的变换都围绕画布中心进行，这样可以保证用户在缩放和旋转时，视觉焦点始终在图片中心，体验更自然。</li>
<li><strong>绘制裁剪蒙层</strong>：一个有趣的小技巧是，如何绘制裁剪框外部的半透明蒙层？我可以利用 <code>Path</code> 的 <code>fillType = PathFillType.evenOdd</code> 属性。</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ImageEditorPainter.dart -&gt; _drawCropUI</span>
<span class="hljs-keyword">void</span> _drawCropUI(...) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// 创建一个包含两个矩形的路径：一个是整个画布，一个是裁剪框</span>
    Path overlayPath = Path()
      ..addRect(Rect.fromLTWH(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, size.width, size.height))
      ..addRect(currentCropRect)
      ..fillType = PathFillType.evenOdd; <span class="hljs-comment">// 设置为 evenOdd 填充规则</span>
    
    <span class="hljs-comment">// 绘制这个路径，Canvas 会自动填充两个矩形之间的区域</span>
    canvas.drawPath(overlayPath, overlayPaint);
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>通过 <code>CustomPaint</code>，获得了对UI像素级的完全掌控力，为实现复杂的交互效果打下了基础。</p>
<h2 data-id="heading-3">坐标系与高保真裁剪的实现</h2>
<p>这是整个编辑器技术含量最高，也是最难啃的一块硬骨头。</p>
<p><strong>问题是什么？</strong><br/>
用户在屏幕上看到的是一张经过<strong>缩放</strong>和<strong>旋转</strong>的图片。当他拖动裁剪框时，这个裁剪框的坐标是相对于<strong>屏幕</strong>的（我称之为“屏幕坐标系”）。但我的最终目标，是从那张<strong>未经任何变换的、原始高分辨率的图片</strong>（“图片坐标系”）中，精确地切出对应的部分。</p>
<p>如果只是简单地对屏幕内容进行截图，图片质量会严重下降，这是不可接受的。我必须实现<strong>高保真裁剪</strong>。</p>
<p><strong>解决方案：矩阵变换的魔法！</strong></p>
<p>线性代数中的矩阵，是连接不同坐标系的桥梁。我的思路是：</p>
<ol>
<li>构建一个从“图片坐标系”到“屏幕坐标系”的变换矩阵 <code>M</code>。</li>
<li>求出 <code>M</code> 的逆矩阵 <code>M⁻¹</code>，它就是从“屏幕坐标系”返回“图片坐标系”的钥匙。</li>
<li>将屏幕上裁剪框的四个顶点，通过 <code>M⁻¹</code> 变换，得到它们在原始图片上的精确坐标。</li>
<li>根据这四个点，计算出一个能完全包裹它们的最小矩形（<code>sourceRect</code>）。</li>
<li>使用 <code>canvas.drawImageRect</code>，从原始图片中挖出 <code>sourceRect</code> 区域，绘制到一个新的、尺寸完美匹配的画布上，从而生成一张全新的、高保真裁剪后的图片。</li>
</ol>
<p>核心代码在 <code>CropHandler.captureHiResCroppedImage</code> 中：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// CropHandler.dart</span>
<span class="hljs-keyword">static</span> Future&lt;ui.Image?&gt; captureHiResCroppedImage(...) <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 1. 计算从"图片坐标系"到"屏幕坐标系"的变换矩阵</span>
    <span class="hljs-keyword">final</span> Matrix4 matrixToScreen = CoordinateTransformer.createImageToScreenMatrix(...);

    <span class="hljs-comment">// 2. 求逆矩阵</span>
    <span class="hljs-keyword">final</span> Matrix4 screenToImageMatrix = Matrix4.inverted(matrixToScreen);

    <span class="hljs-comment">// 3. 将屏幕上的裁剪框的四个角，通过逆矩阵变换回图片上的坐标</span>
    <span class="hljs-keyword">final</span> topLeft = MatrixUtils.transformPoint(screenToImageMatrix, cropRect.topLeft);
    <span class="hljs-comment">// ... (transform other 3 corners)</span>

    <span class="hljs-comment">// 4. 计算能完全包围这四个点的、在图片坐标系中的矩形边界 (sourceRect)</span>
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> minX = [topLeft.dx, ...].reduce(math.min);
    <span class="hljs-comment">// ... (calculate maxX, minY, maxY)</span>
    <span class="hljs-keyword">final</span> Rect sourceRect = Rect.fromLTRB(minX, minY, maxX, maxY);

    <span class="hljs-comment">// 5. 计算新图片的尺寸（高保真尺寸）</span>
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> newWidth = sourceRect.width.round();
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> newHeight = sourceRect.height.round();

    <span class="hljs-comment">// 6. 使用 PictureRecorder 和 drawImageRect 进行高保真绘制</span>
    <span class="hljs-keyword">final</span> recorder = ui.PictureRecorder();
    <span class="hljs-keyword">final</span> canvas = Canvas(recorder, Rect.fromLTWH(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, newWidth.toDouble(), newHeight.toDouble()));
    <span class="hljs-keyword">final</span> Rect destinationRect = Rect.fromLTWH(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, newWidth.toDouble(), newHeight.toDouble());

    <span class="hljs-comment">// 核心：从原图的 sourceRect 区域，绘制到新画布的 destinationRect 区域</span>
    canvas.drawImageRect(image, sourceRect, destinationRect, Paint());

    <span class="hljs-comment">// 7. 生成最终的高清图片</span>
    <span class="hljs-keyword">final</span> picture = recorder.endRecording();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> picture.toImage(newWidth, newHeight);
}
</code></pre>
<p>这个过程完美地解决了因旋转和缩放带来的坐标系差异问题，保证了每一次裁剪都是像素级的无损操作。同样，在最终导出图片时，文本的绘制也遵循了类似的坐标变换逻辑，确保文字能被高清地“印”在最终的图片上。</p>
<h2 data-id="heading-4">文本与历史记录管理</h2>
<p>除了硬核的裁剪，一些“软”功能的设计同样重要，它们直接决定了用户体验。</p>
<h3 data-id="heading-5">1. 文本管理 (<code>TextLayerManager</code>)</h3>
<p>添加文本不仅仅是在画布上画几个字那么简单，我需要管理多个文本层，支持对它们进行独立的移动、样式修改和删除。</p>
<p><code>TextLayerManager</code> 内部使用一个 <code>Map&lt;String, TextLayerData&gt;</code> 来存储所有文本层，以 <code>id</code> 作为键，实现了 O(1) 复杂度的快速查找。</p>
<p>它负责处理：</p>
<ul>
<li><strong>命中测试</strong>：当用户点击屏幕时，<code>selectLayerAt</code> 方法会遍历所有文本层，计算它们的边界框（<code>_getTextLayerBounds</code>），判断点击位置是否落在某个文本层内，从而实现选中。</li>
<li><strong>状态管理</strong>：管理当前选中的文本层 ID (<code>_selectedLayerId</code>)，并提供更新颜色、大小、位置的接口。</li>
<li><strong>数据隔离</strong>：所有文本相关的状态都内聚在 <code>TextLayerManager</code> 中，<code>ImageEditorController</code> 只需调用其API即可，无需关心内部实现。</li>
</ul>
<h3 data-id="heading-6">2. 时间旅行 (<code>HistoryManager</code>)</h3>
<p>一个专业的编辑器，怎能没有撤销/重做功能？我通过<strong>备忘录模式</strong>实现了这个功能。</p>
<ul>
<li><strong><code>EditorStateSnapshot</code></strong>：这是一个数据类，像一个“快照”，保存了某一时刻编辑器的所有关键状态（<code>ui.Image</code> 对象、文本层列表、旋转角度等）。</li>
<li><strong><code>HistoryManager</code></strong>：它内部维护一个 <code>List&lt;EditorStateSnapshot&gt;</code> 列表，作为历史堆栈。</li>
</ul>
<p><strong>工作流程是这样的：</strong></p>
<ol>
<li><strong>保存快照</strong>：在执行一个“破坏性”操作（如应用裁剪、应用旋转）<strong>之前</strong>，调用 <code>_historyManager.saveSnapshot()</code>，将当前状态推入堆栈。</li>
<li><strong>撤销操作</strong>：当用户点击“撤销”时，调用 <code>_historyManager.popSnapshot()</code>，取出最近的一个快照，然后用快照中的数据恢复 <code>ImageEditorController</code> 的状态。</li>
</ol>
<p>这里需要注意一个细节：在保存快照时，对于 <code>List&lt;TextLayerData&gt;</code> 这样的可变对象，必须进行<strong>深拷贝</strong>，否则后续对文本的修改会污染历史记录。而 <code>ui.Image</code> 是不可变对象，可以直接引用，这为我省了不少事。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// HistoryManager.dart</span>
<span class="hljs-keyword">void</span> saveSnapshot(...) {
    <span class="hljs-comment">// 深拷贝文本图层列表</span>
    <span class="hljs-keyword">final</span> copiedTextLayers = textLayers.map((layer) =&gt; layer.clone()).toList();

    <span class="hljs-keyword">final</span> snapshot = EditorStateSnapshot(
      image: image, <span class="hljs-comment">// ui.Image 是不可变的，可以直接引用</span>
      textLayers: copiedTextLayers,
      <span class="hljs-comment">// ...</span>
    );
    _snapshots.add(snapshot);
    <span class="hljs-comment">// ... (限制历史记录数量)</span>
}
</code></pre>
<p>通过 <code>HistoryManager</code>，我赋予了用户“反悔”的权利，大大提升了编辑器的容错性和用户体验。</p>
<h2 data-id="heading-7">可配置的导出压缩，为服务器减负</h2>
<p>在前面我提到了一个非常现实的痛点：用户上传的原始图片动辄几兆甚至十几兆，如果直接上传，会给服务器的<strong>带宽和存储</strong>带来巨大压力，同时也会消耗用户大量的移动数据。因此，在客户端进行<strong>高质量的预压缩</strong>，是企业级应用不可或缺的一环。</p>
<p>我的目标很明确：</p>
<ol>
<li><strong>压缩过程对用户无感</strong>：用户只需要正常编辑，在最后导出时自动完成。</li>
<li><strong>压缩比率可配置</strong>：允许开发者根据不同的业务场景（如头像、封面、普通插图）灵活设置压缩强度。</li>
<li><strong>保证画质</strong>：不能因为压缩就让图片变得模糊不堪，要在体积和质量之间找到最佳平衡。</li>
</ol>
<p>基于这些目标，我设计了一套优雅的、基于 <code>scale</code> 的压缩方案。</p>
<h3 data-id="heading-8">1. 设计思路：分离与配置</h3>
<p>我没有将压缩逻辑耦合在裁剪或旋转等任何一个编辑步骤中。编辑过程始终应该在最高保真度的图像上进行，以保证操作的精确性。压缩，应该是<strong>导出前（Export）的最后一道工序</strong>。</p>
<p>为此，我引入了 <code>ImageCompressionConfig</code> 配置类，并将其作为 <code>ImageEditorConfig</code> 的一部分：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// models/editor_models.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageEditorConfig</span> </span>{
  <span class="hljs-comment">// ... 其他配置</span>
  <span class="hljs-keyword">final</span> ImageCompressionConfig? compression;
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageCompressionConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> enabled; <span class="hljs-comment">// 是否启用压缩</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> scale; <span class="hljs-comment">// 压缩比例，例如 0.5 表示尺寸变为原来的一半</span>

  <span class="hljs-keyword">const</span> ImageCompressionConfig({
    <span class="hljs-keyword">this</span>.enabled = <span class="hljs-keyword">true</span>,
    <span class="hljs-keyword">this</span>.scale = <span class="hljs-number">0.5</span>,
  });
}
</code></pre>
<p>这样的设计让压缩功能变成了一个<strong>可插拔、可配置</strong>的模块。开发者在初始化编辑器时，可以轻松地决定是否启用压缩以及压缩到什么程度。</p>
<h3 data-id="heading-9">2. 实现揭秘：<code>exportImage</code> 的处理流水线</h3>
<p>当用户点击“完成”并调用 <code>exportImage()</code> 方法时，一条精密的流水线就开始工作了：</p>
<p><code>exportImage() -&gt; _captureTransformedImage() -&gt; _applyCompressionIfNeeded() -&gt; 返回最终图片</code></p>
<ol>
<li><strong><code>_captureTransformedImage()</code></strong> : 首先，无论是否压缩，我们都需要先将用户的所有编辑操作（旋转、裁剪、添加文本等）应用，生成一张“所见即所得”的高保真中间图。</li>
<li><strong><code>_applyCompressionIfNeeded()</code></strong> : 接着，这张高保真图被传递给压缩处理器。这个方法是实现压缩的核心。</li>
</ol>
<p>让我们深入 <code>_applyCompressionIfNeeded</code> 的源码，看看魔法是如何发生的：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ImageEditorController.dart</span>

Future&lt;ui.Image&gt; _applyCompressionIfNeeded(ui.Image image) <span class="hljs-keyword">async</span> {
  <span class="hljs-comment">// 1. 从配置中读取压缩设置</span>
  <span class="hljs-keyword">final</span> ImageCompressionConfig? compressionConfig = config.compression;
  <span class="hljs-keyword">if</span> (compressionConfig == <span class="hljs-keyword">null</span> || !compressionConfig.enabled) {
    <span class="hljs-keyword">return</span> image; <span class="hljs-comment">// 如果未配置或未启用，直接返回原图</span>
  }
  
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> scale = compressionConfig.scale;
  <span class="hljs-keyword">if</span> (scale &lt;= <span class="hljs-number">0</span> || scale &gt;= <span class="hljs-number">1.0</span>) {
    <span class="hljs-keyword">return</span> image; <span class="hljs-comment">// 无效的 scale 值，不处理</span>
  }

  <span class="hljs-comment">// 2. 根据 scale 计算目标尺寸</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> targetWidth = math.max(<span class="hljs-number">1</span>, (image.width * scale).round());
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> targetHeight = math.max(<span class="hljs-number">1</span>, (image.height * scale).round());

  <span class="hljs-comment">// 3. 使用 PictureRecorder 和 drawImageRect 进行高质量缩放</span>
  <span class="hljs-keyword">final</span> ui.PictureRecorder recorder = ui.PictureRecorder();
  <span class="hljs-keyword">final</span> Canvas canvas = Canvas(recorder);
  
  <span class="hljs-keyword">final</span> Rect srcRect = Rect.fromLTWH(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, image.width.toDouble(), image.height.toDouble());
  <span class="hljs-keyword">final</span> Rect dstRect = Rect.fromLTWH(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, targetWidth.toDouble(), targetHeight.toDouble());
  
  <span class="hljs-comment">// 4. [关键] 设置高质量的绘制滤镜</span>
  <span class="hljs-keyword">final</span> Paint paint = Paint()..filterQuality = FilterQuality.high;

  canvas.drawImageRect(image, srcRect, dstRect, paint);

  <span class="hljs-comment">// 5. 生成新的、尺寸更小的图片</span>
  <span class="hljs-keyword">final</span> ui.Picture picture = recorder.endRecording();
  <span class="hljs-keyword">final</span> ui.Image resized = <span class="hljs-keyword">await</span> picture.toImage(targetWidth, targetHeight);
  
  <span class="hljs-comment">// 6. [关键] 释放旧的大图内存</span>
  _disposeImage(image); 
  
  <span class="hljs-keyword">return</span> resized;
}
</code></pre>
<p>这段代码虽然不长，但处处体现着精心的设计：</p>
<ul>
<li><strong>计算目标尺寸 (步骤2)</strong> ：通过将原始宽高乘以 <code>scale</code> 因子，我们得到了压缩后的目标尺寸。这是整个方案的数学基础。</li>
<li><strong><code>drawImageRect</code> (步骤3)</strong> ：这个 Flutter <code>Canvas</code> 的 API 是实现缩放的关键。它允许我们将一个源矩形（<code>srcRect</code>，即整个原始大图）绘制到一个目标矩形（<code>dstRect</code>，即我们计算出的小尺寸矩形）中。在绘制过程中，Flutter 引擎会自动为我们完成像素的插值和缩放。</li>
<li><strong>画质的秘密武器 (步骤4)</strong> ：仅仅缩放是不够的，如何保证画质？答案是 <code>Paint</code> 对象的 <code>filterQuality</code> 属性。将其设置为 <code>FilterQuality.high</code>，会告诉 Flutter 引擎使用更高级、更平滑的算法（通常是双线性或双三次插值）来处理像素，从而在缩小图片时最大程度地保留细节，避免出现锯齿和马赛克。</li>
<li><strong>内存管理的典范 (步骤6)</strong> ：在生成了新的、小尺寸的 <code>resized</code> 图片后，那张作为输入的、高保真的 <code>image</code> 就完成了它的历史使命。通过调用 <code>_disposeImage(image)</code> 主动释放其占用的内存，可以有效避免应用因处理大图而导致的内存峰值，这对于移动设备尤其重要。</li>
</ul>
<h5 data-id="heading-10">3. 优势总结</h5>
<p>通过这种基于 <code>scale</code> 和 <code>drawImageRect</code> 的方案，我们实现了一个非常理想的客户端压缩功能：</p>
<ul>
<li><strong>逻辑解耦</strong>：压缩与编辑功能完全分离，代码清晰，易于维护。</li>
<li><strong>高度可控</strong>：通过 <code>ImageEditorConfig</code>，开发者可以像开关一样控制压缩，并精确调整压缩比。</li>
<li><strong>质量优先</strong>：利用 <code>FilterQuality.high</code> 保证了即使在较大比例压缩下，也能获得令人满意的视觉效果。</li>
<li><strong>性能友好</strong>：即时释放无用的大图资源，体现了优秀的内存管理意识。</li>
</ul>
<p>最终，这个“点睛之笔”不仅提升了用户体验（更快的上传速度），也实实在在地为后端的服务器减轻了负担，实现了双赢。</p>
<h2 data-id="heading-11">快速开始</h2>
<h3 data-id="heading-12">方式</h3>
<p><code>flutter pub add flutter_img_editor</code></p>
<p>或者</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">flutter_img_editor:</span> <span class="hljs-string">^0.0.3</span> <span class="hljs-comment"># 使用最新版本</span>
</code></pre>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'dart:ui'</span> <span class="hljs-keyword">as</span> ui;

<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter_img_editor/image_editor.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:image_picker/image_picker.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'more_page.dart'</span>;

<span class="hljs-keyword">void</span> main() {
  runApp(<span class="hljs-keyword">const</span> MyApp());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> MyApp({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> MaterialApp(
      title: <span class="hljs-string">'Image Editor 示例'</span>,
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
        useMaterial3: <span class="hljs-keyword">true</span>,
      ),
      home: <span class="hljs-keyword">const</span> MyHomePage(),
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> MyHomePage({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyHomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyHomePage</span>&gt; </span>{
  <span class="hljs-keyword">final</span> ImagePicker _picker = ImagePicker();

  <span class="hljs-comment">// 相册图片</span>
  ui.Image? _pickerOriginal;
  ui.Image? _pickerEdited;
  <span class="hljs-built_in">String?</span> _pickerTempPath;
  <span class="hljs-built_in">Duration?</span> _pickerTempDuration;

  <span class="hljs-comment">// 是否正在选择相册图片</span>
  <span class="hljs-built_in">bool</span> _isPickingImage = <span class="hljs-keyword">false</span>;

  <span class="hljs-keyword">void</span> _showSnack(<span class="hljs-built_in">String</span> message) {
    <span class="hljs-keyword">if</span> (!mounted) <span class="hljs-keyword">return</span>;
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text(message)),
    );
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Image Editor 示例'</span>),
        actions: [
          TextButton(
            onPressed: _openMorePage,
            style: TextButton.styleFrom(
              foregroundColor: Theme.of(context).colorScheme.onPrimary,
            ),
            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'更多示例'</span>),
          ),
        ],
      ),
      body: SafeArea(
        child: ListView(
          padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16</span>),
          children: [
            _buildIntroCard(),
            _buildPickerDemo(),
            _buildPerformanceNote(),
          ],
        ),
      ),
    );
  }

  <span class="hljs-keyword">void</span> _openMorePage() {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (_) =&gt; <span class="hljs-keyword">const</span> MorePage(),
      ),
    );
  }

  Card _buildIntroCard() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Card(
      child: Padding(
        padding: EdgeInsets.all(<span class="hljs-number">16</span>),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(
              <span class="hljs-string">'本页聚焦 image_picker 相册流程，演示如何快速打开图片编辑器并保存编辑结果。'</span>,
            ),
            SizedBox(height: <span class="hljs-number">8</span>),
            Text(
              <span class="hljs-string">'想了解内置 Asset、相机拍照与网络下载场景，请点击右上角“更多示例”。'</span>,
              style: TextStyle(color: Colors.black54),
            ),
          ],
        ),
      ),
    );
  }

  Card _buildPickerDemo() {
    <span class="hljs-keyword">return</span> Card(
      child: Padding(
        padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16</span>),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            _buildHeader(
              title: <span class="hljs-string">'案例：Image Picker 相册'</span>,
              actions: [
                ElevatedButton.icon(
                  onPressed: _isPickingImage ? <span class="hljs-keyword">null</span> : _handlePickerEdit,
                  icon: <span class="hljs-keyword">const</span> Icon(Icons.photo_library),
                  label: Text(_isPickingImage ? <span class="hljs-string">'处理中...'</span> : <span class="hljs-string">'选择并编辑'</span>),
                ),
              ],
            ),
            <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
            <span class="hljs-keyword">const</span> Text(
              <span class="hljs-string">'直接通过 image_picker 选择本地相册图片后进入编辑器，'</span>
              <span class="hljs-string">'展示如何与外部端到端整合。'</span>,
            ),
            <span class="hljs-keyword">if</span> (_isPickingImage)
              <span class="hljs-keyword">const</span> Padding(
                padding: EdgeInsets.only(top: <span class="hljs-number">12</span>),
                child: LinearProgressIndicator(minHeight: <span class="hljs-number">3</span>),
              ),
            <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
            Row(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                _buildImagePanel(label: <span class="hljs-string">'原始'</span>, image: _pickerOriginal),
                <span class="hljs-keyword">const</span> SizedBox(width: <span class="hljs-number">16</span>),
                _buildImagePanel(label: <span class="hljs-string">'ui.Image'</span>, image: _pickerEdited),
                <span class="hljs-keyword">const</span> SizedBox(width: <span class="hljs-number">16</span>),
                _buildImagePanelFromPath(label: <span class="hljs-string">'path'</span>, path: _pickerTempPath),
              ],
            ),
            <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">12</span>),
            _buildPixelStats(_pickerOriginal, _pickerEdited),
            <span class="hljs-keyword">if</span> (_pickerTempPath != <span class="hljs-keyword">null</span>) ...[
              <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
              Text(
                <span class="hljs-string">'临时文件路径 (saveImageToTempFile):'</span>,
                style: Theme.of(context).textTheme.titleSmall,
              ),
              <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">4</span>),
              SelectableText(_pickerTempPath!),
              Text(
                <span class="hljs-string">'耗时: <span class="hljs-subst">${_pickerTempDuration != <span class="hljs-keyword">null</span> ? <span class="hljs-string">'<span class="hljs-subst">${_pickerTempDuration!.inMilliseconds}</span> ms'</span> : <span class="hljs-string">'--'</span>}</span>'</span>,
              ),
            ],
          ],
        ),
      ),
    );
  }

  Widget _buildHeader({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> title,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">List</span>&lt;Widget&gt; actions,
  }) {
    <span class="hljs-keyword">return</span> Row(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Expanded(
          child: Text(
            title,
            style: Theme.of(context).textTheme.titleMedium?.copyWith(
                  fontWeight: FontWeight.w600,
                ),
          ),
        ),
        Wrap(
          spacing: <span class="hljs-number">8</span>,
          runSpacing: <span class="hljs-number">8</span>,
          children: actions,
        ),
      ],
    );
  }

  Widget _buildImagePanel({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> label,
    <span class="hljs-keyword">required</span> ui.Image? image,
  }) {
    <span class="hljs-keyword">final</span> TextStyle? captionStyle =
        Theme.of(context).textTheme.labelMedium?.copyWith(
              color: Colors.grey.shade600,
            );
    <span class="hljs-keyword">return</span> Expanded(
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(label, style: Theme.of(context).textTheme.bodySmall),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">6</span>),
          Container(
            height: <span class="hljs-number">180</span>,
            decoration: BoxDecoration(
              borderRadius: BorderRadius.circular(<span class="hljs-number">12</span>),
              color: Colors.grey.shade100,
              border: Border.all(color: Colors.grey.shade300),
            ),
            child: ClipRRect(
              borderRadius: BorderRadius.circular(<span class="hljs-number">12</span>),
              child: image != <span class="hljs-keyword">null</span>
                  ? RawImage(
                      image: image,
                      fit: BoxFit.contain,
                    )
                  : Center(
                      child: Text(
                        <span class="hljs-string">'暂无图片'</span>,
                        style: captionStyle,
                      ),
                    ),
            ),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">6</span>),
          Text(<span class="hljs-string">'像素: <span class="hljs-subst">${_pixelSize(image)}</span>'</span>, style: captionStyle),
        ],
      ),
    );
  }

  Widget _buildImagePanelFromPath({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> label,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String?</span> path,
  }) {
    <span class="hljs-keyword">final</span> captionStyle = Theme.of(context).textTheme.labelMedium?.copyWith(
          color: Colors.grey.shade600,
        );
    Widget child;
    <span class="hljs-keyword">if</span> (path != <span class="hljs-keyword">null</span>) {
      child = Image.file(
        File(path),
        fit: BoxFit.contain,
      );
    } <span class="hljs-keyword">else</span> {
      child = Center(
        child: Text(
          <span class="hljs-string">'暂无图片'</span>,
          style: captionStyle,
        ),
      );
    }
    <span class="hljs-keyword">return</span> Expanded(
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(label, style: Theme.of(context).textTheme.bodySmall),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">6</span>),
          Container(
            height: <span class="hljs-number">180</span>,
            decoration: BoxDecoration(
              borderRadius: BorderRadius.circular(<span class="hljs-number">12</span>),
              color: Colors.grey.shade100,
              border: Border.all(color: Colors.grey.shade300),
            ),
            child: ClipRRect(
              borderRadius: BorderRadius.circular(<span class="hljs-number">12</span>),
              child: child,
            ),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">6</span>),
          <span class="hljs-keyword">if</span> (path != <span class="hljs-keyword">null</span>) Text(<span class="hljs-string">'文件大小: <span class="hljs-subst">${_fileSize(path)}</span>'</span>, style: captionStyle),
        ],
      ),
    );
  }

  Widget _buildPixelStats(ui.Image? original, ui.Image? edited) {
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> delta = _pixelDelta(original, edited);
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> originalMemory = _memoryUsage(original);
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> editedMemory = _memoryUsage(edited);
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> memoryDelta = _memoryDelta(original, edited);
    <span class="hljs-keyword">return</span> Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          <span class="hljs-string">'像素对比'</span>,
          style: Theme.of(context).textTheme.titleSmall,
        ),
        <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">4</span>),
        Text(<span class="hljs-string">'原始: <span class="hljs-subst">${_pixelSize(original)}</span>'</span>),
        Text(<span class="hljs-string">'编辑后: <span class="hljs-subst">${_pixelSize(edited)}</span>'</span>),
        <span class="hljs-keyword">if</span> (delta.isNotEmpty) Text(delta),
        <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
        Text(
          <span class="hljs-string">'内存估算（RGBA 32bit）'</span>,
          style: Theme.of(context).textTheme.titleSmall,
        ),
        <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">4</span>),
        Text(<span class="hljs-string">'原始: <span class="hljs-subst">$originalMemory</span>'</span>),
        Text(<span class="hljs-string">'编辑后: <span class="hljs-subst">$editedMemory</span>'</span>),
        <span class="hljs-keyword">if</span> (memoryDelta.isNotEmpty) Text(memoryDelta),
      ],
    );
  }

  <span class="hljs-built_in">String</span> _pixelSize(ui.Image? image) {
    <span class="hljs-keyword">if</span> (image == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'--'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">'<span class="hljs-subst">${image.width}</span> x <span class="hljs-subst">${image.height}</span>'</span>;
  }

  <span class="hljs-built_in">String</span> _pixelDelta(ui.Image? original, ui.Image? edited) {
    <span class="hljs-keyword">if</span> (original == <span class="hljs-keyword">null</span> || edited == <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    }
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> dw = edited.width - original.width;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> dh = edited.height - original.height;
    <span class="hljs-built_in">String</span> fmt(<span class="hljs-built_in">int</span> value) =&gt; value &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+<span class="hljs-subst">$value</span>'</span> : value.toString();
    <span class="hljs-keyword">if</span> (dw == <span class="hljs-number">0</span> &amp;&amp; dh == <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'变化: 无 (像素保持不变)'</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">'变化: 宽度 <span class="hljs-subst">${fmt(dw)}</span>，高度 <span class="hljs-subst">${fmt(dh)}</span>'</span>;
  }

  <span class="hljs-built_in">String</span> _memoryUsage(ui.Image? image) {
    <span class="hljs-keyword">if</span> (image == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'--'</span>;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> bytes = image.width * image.height * <span class="hljs-number">4</span>;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> mb = bytes / (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">'<span class="hljs-subst">${mb.toStringAsFixed(<span class="hljs-number">2</span>)}</span> MB'</span>;
  }

  <span class="hljs-built_in">String</span> _memoryDelta(ui.Image? original, ui.Image? edited) {
    <span class="hljs-keyword">if</span> (original == <span class="hljs-keyword">null</span> || edited == <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    }
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> originalPixels = original.width * original.height.toDouble();
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> editedPixels = edited.width * edited.height.toDouble();
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> diffBytes = (editedPixels - originalPixels) * <span class="hljs-number">4</span>;
    <span class="hljs-keyword">if</span> (diffBytes == <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'内存变化: 无 (像素点数量一致)'</span>;
    }
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> diffMb = diffBytes / (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> sign = diffMb &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">'内存变化: <span class="hljs-subst">$sign</span><span class="hljs-subst">${diffMb.toStringAsFixed(<span class="hljs-number">2</span>)}</span> MB'</span>;
  }

  <span class="hljs-built_in">String</span> _fileSize(<span class="hljs-built_in">String</span> path) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> bytes = File(path).lengthSync();
      <span class="hljs-keyword">if</span> (bytes &lt; <span class="hljs-number">1024</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'<span class="hljs-subst">$bytes</span> B'</span>;
      }
      <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> kb = bytes / <span class="hljs-number">1024</span>;
      <span class="hljs-keyword">if</span> (kb &lt; <span class="hljs-number">1024</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'<span class="hljs-subst">${kb.toStringAsFixed(<span class="hljs-number">1</span>)}</span> KB'</span>;
      }
      <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> mb = kb / <span class="hljs-number">1024</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-string">'<span class="hljs-subst">${mb.toStringAsFixed(<span class="hljs-number">2</span>)}</span> MB'</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'--'</span>;
    }
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt; _handlePickerEdit() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">if</span> (_isPickingImage) <span class="hljs-keyword">return</span>;
    setState(() {
      _isPickingImage = <span class="hljs-keyword">true</span>;
    });
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> XFile? picked = <span class="hljs-keyword">await</span> _picker.pickImage(source: ImageSource.gallery);
      <span class="hljs-keyword">if</span> (picked == <span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">final</span> ui.Image image = <span class="hljs-keyword">await</span> loadImageFromFile(picked.path);
      <span class="hljs-keyword">if</span> (!mounted) <span class="hljs-keyword">return</span>;
      setState(() {
        _pickerOriginal = image;
        _pickerEdited = <span class="hljs-keyword">null</span>;
      });
      <span class="hljs-keyword">final</span> ui.Image? result = <span class="hljs-keyword">await</span> _openEditor(
        image,
        config: <span class="hljs-keyword">const</span> ImageEditorConfig(
          topToolbar: TopToolbarConfig(
            titleText: <span class="hljs-string">'相册图片编辑'</span>,
            cancelText: <span class="hljs-string">'取消'</span>,
            confirmText: <span class="hljs-string">'完成'</span>,
          ),
          compression: ImageCompressionConfig(
            enabled: <span class="hljs-keyword">true</span>,
            scale: <span class="hljs-number">0.3</span>,
          ),
        ),
      );
      <span class="hljs-keyword">if</span> (!mounted || result == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span>;
      setState(() {
        _pickerEdited = result;
      });
      <span class="hljs-keyword">await</span> _processPickerResult(result);
      <span class="hljs-keyword">await</span> _logImageBytes(result, <span class="hljs-string">'picker'</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      _showSnack(<span class="hljs-string">'选择图片失败: <span class="hljs-subst">$error</span>'</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-keyword">if</span> (!mounted) <span class="hljs-keyword">return</span>;
      setState(() {
        _isPickingImage = <span class="hljs-keyword">false</span>;
      });
    }
  }

  Future&lt;ui.Image?&gt; _openEditor(
    ui.Image image, {
    ImageEditorConfig? config,
  }) {
    <span class="hljs-keyword">return</span> Navigator.push&lt;ui.Image?&gt;(
      context,
      MaterialPageRoute(
        builder: (context) =&gt; ImageEditor(
          image: image,
          config: config ?? <span class="hljs-keyword">const</span> ImageEditorConfig(),
        ),
      ),
    );
  }

  Future&lt;<span class="hljs-keyword">void</span>&gt; _logImageBytes(ui.Image image, <span class="hljs-built_in">String</span> tag) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> bytes = <span class="hljs-keyword">await</span> convertUiImageToBytes(image);
    <span class="hljs-keyword">if</span> (bytes == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// 此处仅演示如何获取可直接用于上传的字节数据，可替换为实际网络请求。</span>
    debugPrint(<span class="hljs-string">'[image_editor_demo][<span class="hljs-subst">$tag</span>] export bytes=<span class="hljs-subst">${bytes.lengthInBytes}</span>'</span>);
  }

  <span class="hljs-comment">/// <span class="markdown">处理相册图片编辑结果为临时文件</span></span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; _processPickerResult(ui.Image result) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">Stopwatch</span> stopwatch = <span class="hljs-built_in">Stopwatch</span>()..start();
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">String?</span> tempPath = <span class="hljs-keyword">await</span> saveImageToTempFile(result);
    stopwatch.stop();

    setState(() {
      _pickerTempPath = tempPath;
      _pickerTempDuration = stopwatch.elapsed;
    });

    <span class="hljs-keyword">if</span> (tempPath == <span class="hljs-keyword">null</span>) {
      _showSnack(<span class="hljs-string">'图片保存失败'</span>);
    } <span class="hljs-keyword">else</span> {
      debugPrint(<span class="hljs-string">'[image_editor_demo][picker] tempPath=<span class="hljs-subst">$tempPath</span> in <span class="hljs-subst">${stopwatch.elapsedMilliseconds}</span>ms'</span>);
    }
  }

  Card _buildPerformanceNote() {
    <span class="hljs-keyword">return</span> Card(
      color: Colors.blueGrey.shade50,
      child: <span class="hljs-keyword">const</span> Padding(
        padding: EdgeInsets.all(<span class="hljs-number">16</span>),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Text(
              <span class="hljs-string">'性能提示'</span>,
              style: TextStyle(fontSize: <span class="hljs-number">16</span>, fontWeight: FontWeight.w600),
            ),
            SizedBox(height: <span class="hljs-number">12</span>),
            Text(
              <span class="hljs-string">'· `ui.Image` 在 Flutter 中以原始 RGBA 32 位像素存储，内存占用约等于像素总数 × 4 字节，读取速度快但占用高。\n'</span>
              <span class="hljs-string">'· 若目标是压缩图片体积，建议在裁剪后进一步按需缩放，并使用 JPG/PNG/WebP 编码保存或上传。\n'</span>
              <span class="hljs-string">'· 对于批量压缩，可结合 `ui.PictureRecorder` 或第三方图像处理库（例如 `image` 包）在后台处理，降低内存峰值。\n'</span>
              <span class="hljs-string">'· 可通过 Flutter DevTools 的 Memory 面板，或在控制台打印 `(image.width * image.height * 4 / 1024 / 1024)` 观察实时内存占用，帮助评估方案。'</span>,
            ),
          ],
        ),
      ),
    );
  }
}
</code></pre>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Fimage_editor" target="_blank" title="https://github.com/xinqingaa/image_editor" ref="nofollow noopener noreferrer">github</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fflutter_img_editor" target="_blank" title="https://pub.dev/packages/flutter_img_editor" ref="nofollow noopener noreferrer">pubdev</a></li>
</ul>
<blockquote>
<p>欢迎大家 Star 和 Fork。如果你对 Flutter 图形图像处理有兴趣，或者在寻找一个可以轻松集成到自己项目中的图片编辑器，希望我的这个轮子能帮到你。
感谢你的阅读！如果觉得这篇文章对你有帮助，不妨点个赞吧！</p>
</blockquote>
<h2 data-id="heading-13">总结和展望</h2>
<p>从一个想法，到一个功能完备的图片编辑器，这个过程充满了挑战，也充满了乐趣。回顾整个项目，我认为有几点关键的收获：</p>
<ol>
<li><strong>架构先行</strong>：良好的分层和模块化设计是应对复杂度的不二法门。将职责拆分到独立的 <code>Handler</code> 和 <code>Manager</code> 中，让代码逻辑清晰，易于维护和扩展。</li>
<li><strong>拥抱底层API</strong>：<code>CustomPaint</code> 和 <code>Matrix4</code> 虽然概念上有些抽象，但它们是实现高级自定义UI和复杂图形操作的利器。深入理解它们，能让你在 Flutter 的世界里拥有更大的创造自由。</li>
<li><strong>关注核心问题</strong>：高保真处理是图片编辑器的灵魂。始终围绕“如何操作原始数据”来思考，而不是“如何修改屏幕显示”，是保证最终输出质量的关键。</li>
</ol>
<p>当然，这个编辑器还有很多可以完善的地方，比如：</p>
<ul>
<li><strong>性能优化</strong>：对于超大尺寸的图片，可以引入瓦片化渲染技术。</li>
<li><strong>功能扩展</strong>：增加画笔、马赛克、滤镜等更丰富的编辑工具。</li>
<li><strong>手势体验</strong>：支持双指旋转和缩放文本层等更精细的交互。</li>
</ul>
<h2 data-id="heading-14">往期文章介绍</h2>
<h3 data-id="heading-15">Flutter 全链路监控 SDK</h3>
<ul>
<li><a href="https://juejin.cn/post/7564977973260173338" target="_blank" title="https://juejin.cn/post/7564977973260173338">掘金文章</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fflutter_monitor_sdk" target="_blank" title="https://pub.dev/packages/flutter_monitor_sdk" ref="nofollow noopener noreferrer">pubdev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Fflutter_monitor_sdk" target="_blank" title="https://github.com/xinqingaa/flutter_monitor_sdk" ref="nofollow noopener noreferrer">github</a></li>
</ul>
<h3 data-id="heading-16">Flutter 全场景弹框</h3>
<ul>
<li><a href="https://juejin.cn/post/7538324216594726950" target="_blank" title="https://juejin.cn/post/7538324216594726950">掘金文章</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Funified_popups" target="_blank" title="https://pub.dev/packages/unified_popups" ref="nofollow noopener noreferrer">pubdev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Funified_popups" target="_blank" title="https://github.com/xinqingaa/unified_popups" ref="nofollow noopener noreferrer">github</a></li>
</ul>
<h3 data-id="heading-17">Flutter日历组件</h3>
<ul>
<li><a href="https://juejin.cn/post/7531976064496123931" target="_blank" title="https://juejin.cn/post/7531976064496123931">掘金文章</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fomni_calendar_view" target="_blank" title="https://pub.dev/packages/omni_calendar_view" ref="nofollow noopener noreferrer">pubdev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Fomni_calendar_view" target="_blank" title="https://github.com/xinqingaa/omni_calendar_view" ref="nofollow noopener noreferrer">github</a></li>
</ul>
<h3 data-id="heading-18">日期选择器</h3>
<ul>
<li><a href="https://juejin.cn/post/7524159959480991753" target="_blank" title="https://juejin.cn/post/7524159959480991753">掘金文章</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fomni_date_picker" target="_blank" title="https://pub.dev/packages/omni_date_picker" ref="nofollow noopener noreferrer">pubdev</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinqingaa%2Fomni_date_picker" target="_blank" title="https://github.com/xinqingaa/omni_date_picker" ref="nofollow noopener noreferrer">github</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代理IP资源怎么选？实测推荐这些高性价比服务商]]></title>    <link>https://juejin.cn/post/7571105461098217515</link>    <guid>https://juejin.cn/post/7571105461098217515</guid>    <pubDate>2025-11-11T07:43:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571105461098217515" data-draft-id="7570999443447119908" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代理IP资源怎么选？实测推荐这些高性价比服务商"/> <meta itemprop="keywords" content="TCP/IP"/> <meta itemprop="datePublished" content="2025-11-11T07:43:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="召唤神龙"/> <meta itemprop="url" content="https://juejin.cn/user/640384299179028"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代理IP资源怎么选？实测推荐这些高性价比服务商
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/640384299179028/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    召唤神龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:43:35.000Z" title="Tue Nov 11 2025 07:43:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多刚接触网络业务的朋友都有这样的困惑：做数据采集总是被封IP，搞市场调研又查不到真实信息，这时候就需要找到靠谱的代理IP资源。作为用过20+代理服务的老用户，今天给大家分享真实体验，教你怎么选对服务商。</p>
<h2 data-id="heading-0">一、代理IP资源到底有什么用？</h2>
<p>简单来说，代理IP就像给你的网络操作穿了个""隐身衣""。比如做电商的朋友需要监控竞品价格，用自己电脑直接访问容易被识别为爬虫。换成代理IP后，每次操作都会切换不同地区的IP地址，让网站以为是正常用户访问。</p>
<p>再比如游戏工作室需要测试新服承载能力，用代理IP模拟不同地区玩家同时登录，能更真实检测服务器性能。这些都是普通网络环境做不到的，但选错代理IP反而会拖累效率。</p>
<h2 data-id="heading-1">二、优质代理IP的4个核心指标</h2>
<p>1. 连接成功率：实测发现低于95%的服务商根本不能用，数据采集中途掉线会前功尽弃。建议优先选标称99%可用率的服务商，比如神龙HTTP这类有运营商合作背景的平台。</p>
<p>2. IP覆盖密度：做本地化调研至少要覆盖30个城市，像神龙IP代理能定位200+城市就比较理想。有个做二手车平台的朋友就靠这个功能，精准获取了不同城市的车辆报价差异。</p>
<p>3. 响应速度：网页加载超过3秒就会影响效率。实测某些服务商的线路确实能做到30ms以内，这对需要高频操作的网络测试特别重要。</p>
<p>4. 售后保障：遇到过凌晨两点爬虫脚本报错，幸亏服务商有24小时技术响应。这点企业用户要特别注意，突发问题处理不及时可能耽误整个项目。</p>
<h2 data-id="heading-2">三、不同场景下的选择技巧</h2>
<p>1. 数据采集场景：需要高匿名性和并发支持。有个做舆情监测的朋友推荐神龙HTTP的动态IP池，他们3000万+资源储备确实能扛住每小时百万级的请求量。</p>
<p>2. 市场调研需求：重点看区域定位精度。之前帮连锁餐饮品牌做选址分析，用支持街道级定位的代理IP，成功获取到目标商圈的客流量数据。</p>
<p>3. 网络性能测试：需要稳定长连接。游戏公司客户实测神龙IP的15M定制带宽线路，连续12小时压力测试没掉线，这对服务器承载测试很关键。</p>
<h2 data-id="heading-3">四、实测推荐这两家服务商</h2>
<p>1. 神龙HTTP：适合企业级用户
他们家的定制方案确实专业，上次有个AI训练项目需要特定城市IP分布，技术团队2小时就给出了解决方案。独有的直播专用IP池实测有效解决账号风控问题，做短视频运营的朋友反馈账号存活率提升60%。</p>
<p>2. 神龙IP：适合精准营销
市场部同事用他们的区域IP做竞品分析，成功抓取到不同城市的差异化促销策略。自主开发的客户端有个""智能路由""功能很有意思，能自动选择延迟最低的节点，做电商比价时效率提升明显。</p>
<h2 data-id="heading-4">五、常见问题答疑</h2>
<p>Q：用代理IP会被封号吗？
A：关键看匿名等级，实测高匿代理配合合理的访问频率，正常业务操作不会触发风控。</p>
<p>Q：需要自己维护IP池吗？
A：正规服务商都提供自动更换IP功能，神龙HTTP的API接口支持按次/按量多种更换策略。</p>
<p>Q：个人用户怎么选套餐？
A：新手建议选按量付费，测试期间用神龙IP的免费测试线路，确定需求再买包月套餐。</p>
<p>最后提醒大家，选代理IP服务不能只看价格。某次图便宜买的低价套餐，结果40%IP不可用，反而浪费更多时间成本。建议先做业务需求分析，再针对性选择服务商的功能组合，这样才能真正提升工作效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python装饰器入门：让你的代码更优雅]]></title>    <link>https://juejin.cn/post/7571005216911278099</link>    <guid>https://juejin.cn/post/7571005216911278099</guid>    <pubDate>2025-11-11T07:56:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216911278099" data-draft-id="7571005216911261715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python装饰器入门：让你的代码更优雅"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-11T07:56:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI的费曼精神"/> <meta itemprop="url" content="https://juejin.cn/user/3776139845447072"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python装饰器入门：让你的代码更优雅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3776139845447072/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI的费曼精神
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:56:38.000Z" title="Tue Nov 11 2025 07:56:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是装饰器？</h2>
<p>装饰器是Python中一个强大的特性，它允许我们在不修改原函数代码的情况下，给函数添加新的功能。简单来说，装饰器就是一个函数，它接收一个函数作为参数，并返回一个新的函数。</p>
<h2 data-id="heading-1">基础示例：计时装饰器</h2>
<p>让我们从一个最常用的例子开始——计算函数执行时间：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps

<span class="hljs-keyword">def</span> <span class="hljs-title function_">timer</span>(<span class="hljs-params">func</span>):
    <span class="hljs-string">"""计算函数执行时间的装饰器"""</span>
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{func.__name__}</span> 执行时间: <span class="hljs-subst">{end_time - start_time:<span class="hljs-number">.4</span>f}</span>秒"</span>)
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-meta">@timer</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">slow_function</span>():
    <span class="hljs-string">"""一个慢函数"""</span>
    time.sleep(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">"完成！"</span>

<span class="hljs-comment"># 使用</span>
result = slow_function()
<span class="hljs-comment"># 输出: slow_function 执行时间: 1.0012秒</span>
</code></pre>
<h2 data-id="heading-2">带参数的装饰器</h2>
<p>有时候我们需要给装饰器传递参数，这时需要再包一层：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">repeat</span>(<span class="hljs-params">times=<span class="hljs-number">3</span></span>):
    <span class="hljs-string">"""重复执行函数的装饰器"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):
<span class="hljs-meta">        @wraps(<span class="hljs-params">func</span>)</span>
        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
            results = []
            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(times):
                result = func(*args, **kwargs)
                results.append(result)
            <span class="hljs-keyword">return</span> results
        <span class="hljs-keyword">return</span> wrapper
    <span class="hljs-keyword">return</span> decorator

<span class="hljs-meta">@repeat(<span class="hljs-params">times=<span class="hljs-number">3</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"你好, <span class="hljs-subst">{name}</span>!"</span>

<span class="hljs-comment"># 使用</span>
messages = greet(<span class="hljs-string">"张三"</span>)
<span class="hljs-built_in">print</span>(messages)
<span class="hljs-comment"># 输出: ['你好, 张三!', '你好, 张三!', '你好, 张三!']</span>
</code></pre>
<h2 data-id="heading-3">实用装饰器：缓存结果</h2>
<p>使用装饰器实现函数结果缓存，提升性能：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">cache</span>(<span class="hljs-params">func</span>):
    <span class="hljs-string">"""简单的缓存装饰器"""</span>
    cached_results = {}
    
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args</span>):
        <span class="hljs-keyword">if</span> args <span class="hljs-keyword">in</span> cached_results:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"从缓存返回: <span class="hljs-subst">{args}</span>"</span>)
            <span class="hljs-keyword">return</span> cached_results[args]
        
        result = func(*args)
        cached_results[args] = result
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-meta">@cache</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci</span>(<span class="hljs-params">n</span>):
    <span class="hljs-string">"""计算斐波那契数列"""</span>
    <span class="hljs-keyword">if</span> n &lt; <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> n
    <span class="hljs-keyword">return</span> fibonacci(n-<span class="hljs-number">1</span>) + fibonacci(n-<span class="hljs-number">2</span>)

<span class="hljs-comment"># 使用</span>
<span class="hljs-built_in">print</span>(fibonacci(<span class="hljs-number">10</span>))  <span class="hljs-comment"># 第一次计算</span>
<span class="hljs-built_in">print</span>(fibonacci(<span class="hljs-number">10</span>))  <span class="hljs-comment"># 从缓存返回</span>
</code></pre>
<h2 data-id="heading-4">类装饰器</h2>
<p>装饰器不仅可以是函数，还可以是类：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span>:
    <span class="hljs-string">"""统计函数调用次数的装饰器"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, func</span>):
        self.func = func
        self.count = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, *args, **kwargs</span>):
        self.count += <span class="hljs-number">1</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.func.__name__}</span> 被调用了 <span class="hljs-subst">{self.count}</span> 次"</span>)
        <span class="hljs-keyword">return</span> self.func(*args, **kwargs)

<span class="hljs-meta">@Counter</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello!"</span>)

<span class="hljs-comment"># 使用</span>
say_hello()  <span class="hljs-comment"># say_hello 被调用了 1 次</span>
say_hello()  <span class="hljs-comment"># say_hello 被调用了 2 次</span>
say_hello()  <span class="hljs-comment"># say_hello 被调用了 3 次</span>
</code></pre>
<h2 data-id="heading-5">实战：日志装饰器</h2>
<p>一个实用的日志装饰器，记录函数调用信息：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

logging.basicConfig(level=logging.INFO)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">log_calls</span>(<span class="hljs-params">func</span>):
    <span class="hljs-string">"""记录函数调用的装饰器"""</span>
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-comment"># 记录调用前</span>
        logging.info(<span class="hljs-string">f"调用函数: <span class="hljs-subst">{func.__name__}</span>"</span>)
        logging.info(<span class="hljs-string">f"参数: args=<span class="hljs-subst">{args}</span>, kwargs=<span class="hljs-subst">{kwargs}</span>"</span>)
        logging.info(<span class="hljs-string">f"时间: <span class="hljs-subst">{datetime.now()}</span>"</span>)
        
        <span class="hljs-keyword">try</span>:
            result = func(*args, **kwargs)
            logging.info(<span class="hljs-string">f"返回值: <span class="hljs-subst">{result}</span>"</span>)
            <span class="hljs-keyword">return</span> result
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logging.error(<span class="hljs-string">f"异常: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">raise</span>
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-meta">@log_calls</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""除法函数"""</span>
    <span class="hljs-keyword">return</span> a / b

<span class="hljs-comment"># 使用</span>
result = divide(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>)
<span class="hljs-comment"># divide(10, 0)  # 会记录异常</span>
</code></pre>
<h2 data-id="heading-6">总结</h2>
<p>装饰器是Python中非常优雅的特性，主要应用场景包括：</p>
<ol>
<li><strong>性能监控</strong>：计时、内存使用统计</li>
<li><strong>缓存</strong>：避免重复计算</li>
<li><strong>权限检查</strong>：验证用户权限</li>
<li><strong>日志记录</strong>：自动记录函数调用</li>
<li><strong>重试机制</strong>：自动重试失败的操作</li>
</ol>
<p>掌握装饰器，能让你的Python代码更加优雅和可维护！</p>
<hr/>
<p><em>本文介绍了Python装饰器的基础用法和实用示例，希望对你有帮助！</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[什么叫“活得明白”？]]></title>    <link>https://juejin.cn/post/7571191453125197850</link>    <guid>https://juejin.cn/post/7571191453125197850</guid>    <pubDate>2025-11-11T07:47:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571191453125197850" data-draft-id="7571028035019227162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="什么叫“活得明白”？"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-11T07:47:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="早发白帝城"/> <meta itemprop="url" content="https://juejin.cn/user/4108219946906760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            什么叫“活得明白”？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4108219946906760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    早发白帝城
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T07:47:36.000Z" title="Tue Nov 11 2025 07:47:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么叫“活得明白”？</h2>
<p>人这一生，好像都在追求一个模糊的目标——活得明白。<br/>
可什么是明白？是看透吗？是放下吗？<br/>
也许，“明白”不是一种顿悟，而是一种被时间一点点磨出的平静。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f27bc024cd6c427c8e6dbd48c03ac293~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pep5Y-R55m95bid5Z-O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763452056&amp;x-signature=HVNwK%2Bow0%2F2jMfmc1EfLvcZm5ac%3D" alt="Snipaste_2025-11-11_15-45-08.png" loading="lazy"/></p>
<h3 data-id="heading-1">一、清醒的明白：知道自己要什么，也知道什么不属于自己</h3>
<p>“明白”有时并不深奥，只是<strong>知道取舍</strong>。<br/>
余华在《许三观卖血记》里写过：许三观卖血换钱，不是因为贪，而是因为要让家人活下去。<br/>
他知道生活永远不会公平，于是用自己能控制的那一点去抵抗命运。</p>
<p>这种明白，是清醒的。<br/>
清醒的人不会幻想生活会善待他，他们只是在艰难里找到最现实的路。<br/>
他们懂得一句话：</p>
<blockquote>
<p>“世界不会因为你的哭泣而让路，但你可以学着走得稳一点。”</p>
</blockquote>
<p>这也是一种“活得明白”——明白不是赢，而是明白<strong>何时不该再挣扎</strong>。</p>
<h3 data-id="heading-2">二、通透的明白：接受无法控制的世界</h3>
<p>真正的明白，不是聪明，而是接受。<br/>
就像《命运》里的那种温柔的悲悯：<br/>
有的人注定会被洪流裹挟，但他们依旧在尽力理解这个世界，而不是怨恨它。</p>
<p>蔡崇达写到那些命运被碾压的人，他们没有力量改变一切，却仍然努力活出一点体面。<br/>
他让我们看到——通透不是妥协，而是<strong>理解复杂的世界后，仍然选择温柔。</strong></p>
<blockquote>
<p>“你不是输给命运，而是学会和命运共处。”</p>
</blockquote>
<p>这样的明白，是一种成熟。<br/>
人到某个阶段，会突然发现：<br/>
人生的很多痛苦，不是因为失去控制，而是<strong>不肯接受</strong>失控。</p>
<h3 data-id="heading-3">三、疼痛的明白：从崩溃中走出来的理解</h3>
<p>余华的《第七天》写的是死亡，却比很多“活着”的故事更温柔。<br/>
杨飞被父亲遗弃、孤独长大、死后游走在人间与亡灵之间——<br/>
他一生都在被世界抛弃，却依然在理解它。</p>
<p>那一幕最令人难忘：<br/>
小小的杨飞，坐在石头上，吃着糖果，摇晃着小腿，等父亲回来。<br/>
他不知道自己已被遗弃。<br/>
——这一等，可能就是一生。</p>
<p>那不是一个孩子的故事，而是一代人的写照：<br/>
他们都在等待命运的回头，<br/>
却最后明白，命运从不会回头。</p>
<p>这种明白，是疼痛之后的平静。<br/>
它不是顿悟，而是被生活打碎、重组，再慢慢生长出来的理解。<br/>
它让人变得柔软，而不是麻木。</p>
<blockquote>
<p>“被世界误解的人，往往也最懂得如何理解世界。”</p>
</blockquote>
<h3 data-id="heading-4">四、愤怒后的明白：荒诞中仍有人性</h3>
<p>《天堂蒜薹之乡》里的人没有哲学，他们只有愤怒。<br/>
他们被制度、市场、权力抛弃——种的蒜薹烂在地里、被迫忍受荒诞的现实。<br/>
他们不是不明白，而是<strong>太明白，却无能为力。</strong></p>
<p>莫言的残酷在于：他写的不是个别人的悲剧，而是一个时代的必然。<br/>
读完你才发现，活得明白有时并不让人快乐。<br/>
它让人清楚地看见“问题”，但也让人知道自己<strong>无法改变什么</strong>。</p>
<p>这也是一种明白：</p>
<blockquote>
<p>“有些人看清了世界，却仍然选择不放弃人性。”</p>
</blockquote>
<p>活得明白，不是摆脱痛苦，而是<strong>带着痛苦继续生活</strong>。</p>
<h3 data-id="heading-5">五、最后的明白：活下去，本身就是答案</h3>
<p>《活着》的最后一页，福贵在田地里对牛讲故事。<br/>
那一刻，他的世界没有胜利者，没有意义，只有“继续活着”。</p>
<p>这也是余华想告诉我们的：</p>
<blockquote>
<p>活得明白，不是看透，而是依旧愿意走下去。</p>
</blockquote>
<p>真正的明白，是不再追问“为什么”，<br/>
是能在苦难里看到一点笑意，<br/>
能在绝望里种一粒麦子，<br/>
能在死亡之后，仍然祝福生命。</p>
<h3 data-id="heading-6">尾声</h3>
<p>“活得明白”，也许不在于懂多少道理，<br/>
而在于你经历过苦难、看清了人心、接受了不公，<br/>
却依然能温柔地说一句——<br/>
<strong>我还愿意继续过下去。</strong></p>
<p>余华让我们看到坚韧，<br/>
莫言让我们看到荒诞，<br/>
蔡崇达让我们看到悲悯，<br/>
而这些作家合在一起，让我们看到：</p>
<blockquote>
<p><strong>真正的明白，不是放下生活，而是被生活打磨后，仍然选择理解它。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[传统RAG的局限被打破！三个轻量级智能体分工协作，如何让问答系统更精准？]]></title>    <link>https://juejin.cn/post/7570598043298119743</link>    <guid>https://juejin.cn/post/7570598043298119743</guid>    <pubDate>2025-11-10T08:09:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298119743" data-draft-id="7570500819889471531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="传统RAG的局限被打破！三个轻量级智能体分工协作，如何让问答系统更精准？"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-10T08:09:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            传统RAG的局限被打破！三个轻量级智能体分工协作，如何让问答系统更精准？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T08:09:22.000Z" title="Mon Nov 10 2025 08:09:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>近期，公司在AI相关项目，尤其是问答系统领域，对回答的准确率和表述质量提出了更高的要求。用户提出的问题不仅限于基础性问题，还可能涉及多样化、复杂化的场景。也就在上周五快下班的时候，项目经理向我反馈，之前的项目团队支持的某客户在使用问答系统时，除了查询私有知识库中的信息外，还会提出以下几类问题：</p>
<ol>
<li><strong>可直接由大语言模型（LLM）回答的问题</strong>：例如通用知识或常识性问题。</li>
<li><strong>非知识库相关的口头表达</strong>：如“谢谢”、“再见”等社交性语句。</li>
<li><strong>需要多步推理的复杂问题</strong>：例如涉及逻辑推理或上下文关联的问题。</li>
</ol>
<p>然而，之前项目团队采用的RAG技术存在一定的局限性：无论用户提出何种问题，系统均默认从知识库中检索答案，再交由LLM生成回答。针对非知识库问题（如口头表达），团队通过在prompt层面设置固定回复的方式进行处理。虽然这种方法能够部分解决问题，但其设计不够优雅，且无法有效应对需要多步推理的复杂问题。项目经理希望我能提出一种更优化的解决方案，以应对上述挑战。为此，我向他提出了一种轻量级的多智能体方案，在不修改检索器和LLM的前提下，优化整个RAG流程。</p>
<h2 data-id="heading-0">架构图</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c2ac68aaa86417fbcf2a41a1d7ef9db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763366961&amp;x-signature=yZC02V0w%2BxnHdCc6%2F1g9UaPpRZg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">定义三个智能体</h2>
<p>我们设计了三个专门的智能体——<strong>推理路由器（Reasoning Router）</strong> 、<strong>信息过滤器（Information Filter）和</strong> <strong>决策制定者（Decision Maker）</strong> ——以促进检索器与大型语言模型（LLM）之间的通信，每个轻量级智能体扮演不同的角色，通过有针对性的指令协同管理RAG（Retrieval-Augmented Generation）管道的各个方面。这种统一设计确保了高效的协调，同时保持了边缘部署的简洁性。三个智能体分别负责评估是否需要检索、生成有效的查询以及选择适合 LLMs 的信息。</p>
<h3 data-id="heading-2">推理路由器（Reasoning Router）</h3>
<p>从高层次视角确定给定问题的最佳推理策略。根据当前状态（即问题），它通过最多两步操作选择行动：</p>
<ol>
<li><strong>决定检索必要性</strong>：如果输出[No Retrieval]，则问题直接由LLM处理，利用其内部知识生成答案。</li>
<li><strong>确定问题复杂性</strong>：如果输出[Retrieval]，还会评估问题是否需要复杂推理。</li>
</ol>
<ul>
<li>对于简单问题，生成一个并与检索器交互以获取文档。检索到的文档随后由<strong>信息过滤器</strong>处理，提取出适合LLM的相关内容。最后，LLM使用过滤后的文档生成问题的答案。</li>
<li>对于复杂问题，输出[Planning]，这将触发需要多个智能体协调的多步推理策略。</li>
</ul>
<p><strong>具体示例如下</strong>：</p>
<ul>
<li><strong>示例1（无需检索）</strong> ：</li>
</ul>

<ul>
<li>输入问题：q = "What is the capital of France?"</li>
<li>输出：[No Retrieval]</li>
<li>解释：该问题属于常识性问题，可直接由LLM回答，无需检索。</li>
</ul>

<ul>
<li><strong>示例2（简单问题，需检索）</strong> ：</li>
</ul>

<ul>
<li>输入问题：q = "What is the population of Paris in 2023?"</li>
<li>输出：[Retrieval]&lt;population of Paris 2023&gt;</li>
<li>解释：该问题需要从外部知识库中检索最新数据。</li>
</ul>

<ul>
<li><strong>示例3（复杂问题，需多步推理）</strong> ：</li>
</ul>

<ul>
<li>输入问题：q = "How does the economic policy of Country A affect its trade relations with Country B?"</li>
<li>输出：[Planning]</li>
<li>解释：该问题涉及多步推理，需要分解为多个子目标并逐步解决。</li>
</ul>
<h3 data-id="heading-3">过滤器（Information Filter）</h3>
<p>用于处理和过滤检索到的信息，以识别适合LLM的内容。其状态空间包括问题、检索到的文档以及当前的推理目标（如果在[Planning]模式下运行）。</p>
<h3 data-id="heading-4">决策者（Decision Maker）</h3>
<p>根据当前状态在[Planning]策略中确定最佳行动。其状态空间包括问题、LLM生成的路线图以及推理历史中积累的文档。根据当前状态，智能地选择行动以评估进展并决定下一步操作。</p>
<h2 data-id="heading-5">智能体如何协作?</h2>
<p>直接回答策略（Direct Answering Strategy）<strong>和</strong>单次检索策略（Single-pass Strategy）已在推理路由器（Reasoning Router）的定义中介绍，分别对应于输出[No Retrieval]和[Retrieval]。</p>
<p>多步推理策略（Multi-Step Reasoning Strategy）对应于推理路由器输出的[Planning]。该策略旨在解决需要LLM生成高层次路线图以及多次检索-过滤循环的复杂问题，通过以下三个阶段实现迭代式信息收集和推理：</p>
<ol>
<li><strong>生成路线图（Generate Roadmap）</strong> ：LLM将复杂问题分解为一系列结构化的子目标，为智能体提供高层次的指导。这些子目标定义了解决问题的步骤和所需的信息类型。</li>
<li><strong>迭代检索与过滤（Iterative Retrieval and Filtering）</strong> ：根据生成的路线图，智能体通过多次检索-过滤循环逐步收集相关信息。每次循环中，推理路由器确定当前子目标是否需要检索，信息过滤器提取相关文档，决策制定者评估进展并决定下一步操作。</li>
<li><strong>综合与生成答案（Synthesis and Answer Generation）</strong> ：在完成所有子目标后，LLM综合收集到的信息，生成最终答案。这一过程确保了复杂问题能够得到全面且准确的回答。</li>
</ol>
<p>通过这三种策略，我们的多智能体系统能够自适应地处理不同复杂度的问题：</p>
<ul>
<li><strong>直接回答策略（Direct Answering Strategy）</strong> ：适用于通用知识问题，提供即时响应。</li>
<li><strong>单次检索策略（Single-pass Strategy）</strong> ：高效处理基于事实的问题，通过一次检索-过滤循环获取答案。</li>
<li><strong>多步推理策略（Multi-Step Strategy）</strong> ：通过引导式迭代推理解决复杂问题。</li>
</ul>
<h2 data-id="heading-6">prompt如何设计</h2>
<h3 data-id="heading-7">Reasoning Router</h3>
<p>推理路由器将按照以下步骤进行评估并输出相应的动作：</p>
<ol>
<li><strong>评估问题</strong>：</li>
</ol>
<ul>
<li>分析问题的<strong>特异性</strong>、<strong>复杂性</strong>和<strong>清晰度</strong>，判断是否需要检索或规划。</li>
<li>确定问题是否属于LLM的现有知识范围，或者是否需要外部信息支持。</li>
</ul>
<ol start="2">
<li><strong>决策类别</strong>：</li>
</ol>
<ul>
<li>如果问题<strong>复杂且需要规划</strong>，输出：[Planning]。</li>
<li>如果问题<strong>需要特定信息</strong>（如最新事件或LLM知识范围外的细分领域），输出：[Retrieval] ‘YOUR QUERY HERE‘。</li>
<li>如果问题<strong>可以直接由LLM回答</strong>，输出：[No Retrieval]。</li>
</ul>
<ol start="3">
<li><strong>输出格式</strong>：</li>
</ol>
<ul>
<li><strong>无需检索</strong>：[No Retrieval]</li>
<li><strong>需要检索</strong>：[Retrieval]（适用于简单问题）</li>
<li><strong>需要规划</strong>：[Planning]（适用于复杂问题）</li>
</ul>
<p>其对应的prompt可以如下设计：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是一个智能助手，负责评估给定的问题是否需要通过检索获取更多信息，或者需要规划才能得出准确答案。你可以访问一个大型语言模型（LLM）来进行规划或回答问题，并且有一个检索系统来提供与查询相关的信息。
指令：
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**评估问题**</span>：评估基于LLM的现有知识是否可以提供精确的答案。考虑问题的具体性、复杂性和清晰度。
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**决策类别**</span>：
<span class="hljs-bullet">-</span> 如果问题是复杂的，并且在检索之前需要一个规划阶段，你的回应应该是：
[Planning]
<span class="hljs-bullet">-</span> 如果问题请求特定信息，你认为LLM不具备这些信息，或者涉及最近的事件或超出LLM知识范围的小众话题，请按照以下格式进行回应：
[Retrieval] ‘YOUR QUERY HERE‘
<span class="hljs-bullet">-</span> 如果你认为LLM可以在没有额外信息的情况下回答问题，请回复：
[No Retrieval]
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**专注于评估**</span>：避免直接回答问题。只专注于确定是否需要检索或规划。
推理路由器状态
现在，请处理以下问题：
问题：{question}
推理路由器的所有可能操作输出
% 对于不需要检索的情况
[No Retrieval]
% 对于需要检索的情况
[Retrieval]&lt;查询内容&gt; （对于简单问题）
[Planning] （对于复杂问题）
</code></pre>
<h3 data-id="heading-8">Information Filter</h3>
<p>信息过滤器的状态空间根据系统当前采用的策略不同而有所区别：</p>
<ol>
<li><strong>单次检索策略（Single-pass Strategy）</strong> ：</li>
</ol>
<ul>
<li><strong>q</strong>：输入问题。</li>
<li><strong>retrieved documents</strong>：从检索系统中获取的相关文档。</li>
<li>状态空间：S2 = {q, retrieved documents}</li>
</ul>
<ol start="2">
<li><strong>多步推理策略（Multi-step Reasoning Strategy）</strong> ：</li>
</ol>
<ul>
<li><strong>q</strong>：输入问题。</li>
<li><strong>retrieved documents</strong>：从检索系统中获取的相关文档。</li>
<li><strong>current objective</strong>：当前推理目标（在多步推理模式下）。</li>
<li>状态空间：S2 = {q, retrieved documents, current objective}</li>
</ul>
<p>它会进行<strong>文档分析</strong>并按照下面的格式进行输出：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Thought: &lt;对每篇文档的分析&gt;</span>
<span class="hljs-section">Action: [&lt;选定的文档ID&gt;]</span>
</code></pre>
<h4 data-id="heading-9"><strong>示例</strong></h4>
<ol>
<li><strong>单次检索策略</strong>：</li>
</ol>
<ul>
<li>
<p><strong>问题</strong>：What is the population of Paris in 2023?</p>
</li>
<li>
<p><strong>检索到的文档</strong>：包含巴黎人口统计数据的多篇文档。</p>
</li>
<li>
<p><strong>信息过滤器输出</strong>：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Thought: Document 1 contains the most recent population data for Paris (2023).</span>
<span class="hljs-section">Action: [Document 1]</span>
</code></pre>
</li>
</ul>
<p><strong>2. 多步推理策略</strong>：</p>
<ul>
<li><strong>问题</strong>：How does the economic policy of Country A affect its trade relations with Country B?</li>
<li><strong>当前目标</strong>：分析Country A的经济政策。</li>
<li><strong>检索到的文档</strong>：多篇关于Country A经济政策的文档。</li>
</ul>
<p>对应的prompt如下设计：</p>
<pre><code class="hljs language-css" lang="css">你是一个智能助手，负责根据给定的问题和当前步骤的目标分析检索到的文档。你的角色是确定每个文档与问题和指定目标的相关性。
指令：
分析相关性：评估每个文档是否符合当前检索步骤的目标，并且包含对问题的直接回答。
思考过程：为每个文档提供简要分析，同时考虑答案内容和检索目标。
筛选文档：在你的思考过程之后，生成一个文档索引列表，指示保留哪些文档。
信息过滤状态
现在，请处理以下问题：
当前步骤的目标：{objective}（仅适用于<span class="hljs-selector-attr">[Planning]</span>模式）
问题：{question}
文档：{documents}
信息过滤输出
思考：&lt;对每个文档的分析&gt;
行动：<span class="hljs-selector-attr">[&lt;选定的文档ID&gt;]</span>
</code></pre>
<h3 data-id="heading-10">Decision Maker</h3>
<p>决策者的状态空间为：<strong>S3 = {q, Accumulated Documents, Roadmap}</strong></p>
<ul>
<li><strong>q</strong>：输入问题。</li>
<li><strong>Accumulated Documents</strong>：当前累积的文档（来自之前的检索-过滤循环）。</li>
<li><strong>Roadmap</strong>：由LLM生成的推理路线图（在多步推理策略中）。</li>
</ul>
<p>主要职责是根据当前状态评估推理进展，并决定是否需要进一步检索或直接生成最终答案。其动作空间包括以下两种可能的操作：</p>
<ol>
<li><strong>[Retrieval]</strong> ：</li>
</ol>
<ul>
<li>请求额外的检索-过滤循环，生成子查询以获取更多相关信息。</li>
<li><strong>适用场景</strong>：当前累积的文档不足以解决所有子目标。</li>
</ul>
<ol start="2">
<li><strong>[LLM]</strong> ：</li>
</ol>
<ul>
<li>将当前累积的所有文档传递给LLM，生成最终答案。</li>
<li><strong>适用场景</strong>：当前累积的文档已足够解决所有子目标。</li>
</ul>
<p>它的输出格式如下：</p>
<pre><code class="hljs language-css" lang="css">Thought: &lt;对当前进展和目标的分析&gt;
Action: {<span class="hljs-selector-attr">[Retrieval]</span>&lt;subquery <span class="hljs-attribute">content</span>&gt;, 或 <span class="hljs-selector-attr">[LLM]</span>}
</code></pre>
<h4 data-id="heading-11"><strong>示例</strong></h4>
<ol>
<li><strong>需要进一步检索</strong>：</li>
</ol>
<ul>
<li><strong>问题</strong>：How does the economic policy of Country A affect its trade relations with Country B?</li>
<li><strong>当前状态</strong>：</li>
</ul>

<ul>
<li><strong>Roadmap</strong>：下一步需要分析Country B的贸易政策。</li>
<li>Accumulated Documents：包含Country A经济政策的文档。</li>
</ul>

<ul>
<li>
<p><strong>决策者输出</strong>：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Thought:</span> Additional information <span class="hljs-keyword">on</span> Country B<span class="hljs-comment">'s trade policy is required to complete the analysis.</span>
<span class="hljs-symbol">Action:</span> [Retrieval]&lt;trade policy <span class="hljs-keyword">of</span> Country B&gt;
</code></pre>
</li>
</ul>
<ol>
<li><strong>生成最终答案</strong>：</li>
</ol>
<ul>
<li><strong>问题</strong>：How does the economic policy of Country A affect its trade relations with Country B?</li>
<li><strong>当前状态</strong>：</li>
</ul>

<ul>
<li>Accumulated Documents：包含Country A经济政策和Country B贸易政策的文档。</li>
<li>Roadmap：所有子目标已完成。</li>
</ul>

<ul>
<li>
<p><strong>决策者输出</strong>：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Thought:</span> Sufficient information has been accumulated <span class="hljs-keyword">to</span> generate the final answer.
<span class="hljs-symbol">Action:</span> [LLM]
</code></pre>
</li>
</ul>
<p>通过决策制定器的动态评估和决策，系统能够在多步推理策略中灵活调整检索和生成过程，确保复杂问题得到全面且准确的回答。</p>
<p>对应的prompt如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是一个智能助手，负责根据提供的现有文档、计划和问题确定下一步的适当行动。你可以访问一个大型语言模型（LLM）来回答问题，并且有一个检索系统用于收集额外的文档。你的目标是决定是否编写查询以检索相关文档，或者基于现有文档和计划使用LLM生成全面的答案。
指令：
<span class="hljs-bullet">1.</span> <span class="hljs-strong">**评估现有文档**</span>：评估现有文档是否足以回答问题。
<span class="hljs-bullet">2.</span> <span class="hljs-strong">**遵循计划**</span>：了解计划中概述的下一步骤。
<span class="hljs-bullet">3.</span> <span class="hljs-strong">**决策类别**</span>：
<span class="hljs-bullet">-</span> 如果现有文档不足以需要额外检索，请回复：
[Retrieval] ‘YOUR QUERY HERE‘
<span class="hljs-bullet">-</span> 如果现有文档足以回答问题，请回复：
[LLM]
<span class="hljs-bullet">4.</span> <span class="hljs-strong">**专注于行动**</span>：不要直接回答问题；集中精力根据现有文档、计划和问题识别下一步的适当行动。
决策者状态
现在，请处理以下问题：现有文档：{accumulated documents}
路线图：{roadmap}
问题：{question}
决策者的输出
思考：[你对当前情况的分析（需要检索额外信息或使用LLM回答）]
行动：[基于分析的决定（[Retrieval]&lt;子查询内容&gt; 或 [LLM])]
</code></pre>
<h2 data-id="heading-12">总结</h2>
<p>通过引入多智能体协作的RAG优化方案，成功解决了传统RAG技术在处理多样化问题时的局限性。然而，这种设计较为依赖模型的能力，尤其是Reasoning Router的准确性。一旦Reasoning Router判断错误，最终结果可能不如预期。因此在资源允许的情况下，可以考虑使用一个7B小模型进行fine-tuning以提升Reasoning Router的表现。</p>
<h3 data-id="heading-13">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Coze+n8n实战：公众号文章从仿写到草稿箱，2分钟全搞定，你只需提交链接！]]></title>    <link>https://juejin.cn/post/7570500819888848939</link>    <guid>https://juejin.cn/post/7570500819888848939</guid>    <pubDate>2025-11-10T06:09:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570500819888848939" data-draft-id="7570339961908969515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Coze+n8n实战：公众号文章从仿写到草稿箱，2分钟全搞定，你只需提交链接！"/> <meta itemprop="keywords" content="Coze,Agent,AIGC"/> <meta itemprop="datePublished" content="2025-11-10T06:09:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="后端小肥肠"/> <meta itemprop="url" content="https://juejin.cn/user/2966945320667536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Coze+n8n实战：公众号文章从仿写到草稿箱，2分钟全搞定，你只需提交链接！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2966945320667536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    后端小肥肠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T06:09:19.000Z" title="Mon Nov 10 2025 06:09:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>大家好，我是小肥肠，专注 AI 干货知识分享！今天给带来的是n8n+Coze实战教程，一键仿写公众号文章到你的草稿箱中。</strong></p>
<h2 data-id="heading-0">1. 前言</h2>
<p>在前几个月我做过一个Coze+RPA的公众号工作流：<a href="https://juejin.cn/post/7523119147435507727" target="_blank" title="https://juejin.cn/post/7523119147435507727">躺赚必备！RPA+Coze+豆包：公众号自动发文，AI率0%亲测有效（附AI率0%提示词）</a>。最近不是都在研究n8n吗？有群友就问能不不能基于n8n仿写，我的回答是当然可以。<strong>只需要你提供一个对标文章链接，等待几秒钟后，一篇新的文章就会出现在你的公众号草稿箱当中，还配了封面图</strong>。</p>
<p>我用半天时间搭建了一个n8n工作流，操作方法非常简单，打开工作流界面，点击底部的 <strong>【Excute</strong> <strong>workflow</strong> <strong>】</strong> 按钮。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c430cf47db054b1d8fd1edf905b37a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=ePDrRj4V24MGoC48mPyUE2mszO4%3D" alt="" loading="lazy"/></p>
<p>在弹出的表单中输入对标文章链接，点击【submit】按钮。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01ce3eb1d80e4b908cf80e0e0cc68e2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=v7ptEBepSodis5nVYN04vNrozN8%3D" alt="" loading="lazy"/></p>
<p>等待几秒后新的文章就会出现在我们的公众号草稿箱中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e555527d65ca4f05b54ae394405b222e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=1bpyHbwYsVM8MvgQYWjoOlTNS7E%3D" alt="" loading="lazy"/></p>
<p>下图中左边是原文，右边是仿写新文 <strong>。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12a1849bec894d1fb0c9ba5d27727f5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=Jap38XNZBU6gxcKKYADhucgsY5U%3D" alt="" loading="lazy"/></p>
<p><strong>在</strong> <strong>新文</strong> <strong>里我没做配图，因为Coze之前做过同样功能的</strong> <strong>工作流</strong> <strong>，大家都反应想自己配图，所以在n8n这边就省略了工作流配图的步骤。对这个工作流感兴趣的读者赶紧码住跟练哦~</strong></p>
<h2 data-id="heading-1">2. 工作流搭建前置操作</h2>
<h3 data-id="heading-2">2.1. 开通图像生成服务</h3>
<p><strong>本</strong> <strong>工作流</strong> <strong>生图依托通义万相2.5</strong> <strong>MCP</strong> <strong>Server，故需要去对应网站开通服务。</strong></p>
<p>通义万相2.5-图像视频生成开通地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2F%3Fspm%3Da2c4g.11186623.0.0.7f477980N1ex6P%26tab%3Dmcp%23%2Fmcp-market%2Fdetail%2FWan25Media" target="_blank" title="https://bailian.console.aliyun.com/?spm=a2c4g.11186623.0.0.7f477980N1ex6P&amp;tab=mcp#/mcp-market/detail/Wan25Media" ref="nofollow noopener noreferrer">bailian.console.aliyun.com/?spm=a2c4g.…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00a4560cc50442d5a06d6cee86a08460~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=83CMmQtBNrfNHrgesmQxI4Krnug%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2. 下载n8n社区节点</h3>
<p>在n8n中新增社区节点n8n-nodes-wechat-offiaccount。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7da90d985ae144048f77c720c20f2cb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=qXGV5TGC1SV0R9Ez%2Bv1aNLpTlt8%3D" alt="" loading="lazy"/></p>
<p>安装完成后需要回到n8n界面，新建凭证（Wechat Official Account Credentials account）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a733730717bc4d0eacd435124e0062ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=IEY8n8gV98lfgFZE9QIOBHceCOk%3D" alt="" loading="lazy"/></p>
<p>将公众号后台的appid和secret填入上述表单，同时需要将你的公网ip配置到白名单当中，公网ip获取指令为：curl ipinfo.io/ip。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7357898839814447bc3c2e0b7acc770d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=DifOTw%2BYYINyfka1MhhZhT0RThA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. 工作流搭建</h2>
<p>整个工作流如下图所示，接下来就开始依次拆解工作流的每个节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1430ddda028b499c8b763e0209422869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=kmUR5RJI9D5v7L8LAtqZplp%2FWz4%3D" alt="" loading="lazy"/></p>
<p><strong>开始节点：</strong> 开始节点类型选择<strong>On form submission。</strong></p>
<ul>
<li>Form Title填写公众号仿写</li>
<li>点击 <strong>【add Form Element】</strong> 节点新增表单要素，在Field Name填入公众号链接，Element Type选择text，Placeholder任意填入一个公众号文章链接。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94a7bfcea310415b950ba26d499a6939~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=%2BAvruBTINVREJf%2BU9NU34Ih%2FcmM%3D" alt="" loading="lazy"/></p>
<p><strong>HTTP Request（调用Coze获取公众号文章内</strong> <strong>api</strong> <strong>）：</strong> 开始节点出来后点击【+】新增<strong>HTTP Request，</strong> 这个节点的作用是调用Coze工作流的api根据输入文章的url来获取文章的标题和内容。</p>
<ul>
<li>Method填写POST。</li>
<li>URL填写<a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.coze.cn%2Fv1%2Fworkflow%2Frun%25E3%2580%2582" target="_blank" title="https://api.coze.cn/v1/workflow/run%E3%80%82" ref="nofollow noopener noreferrer">api.coze.cn/v1/workflow…</a></li>
<li>Generic Auth Type选择Header Auth。</li>
<li>Header Auth填写Coze的凭证</li>
<li>打开Send Headers，Specify Headers选择Using Fields Below，Header Parameters中Name填写Content-Type，value填写application/json。</li>
<li>打开Send Body，Body Content Type选择JSON，Specify Body选择Using JSON，JSON中填写：</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"workflow_id"</span>: <span class="hljs-string">"你的Coze工作流id"</span>,
  <span class="hljs-string">"parameters"</span>: {
    <span class="hljs-string">"input"</span>: <span class="hljs-string">"{{ <span class="hljs-variable">$json</span>['公众号链接'] }}"</span>
  }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b91fae9553f4c4abce4676f1913bb41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=7KdSgRvYMvAi1pRL%2F2Qet%2BnEIfQ%3D" alt="" loading="lazy"/></p>
<p>Coze工作流搭建很简单，就三个节点，核心就是通过Coze插件来获取公众号文章链接内容并清洗文章数据，排除干扰项（如发布时间这些无意义的字）后进行输出：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8169a4cb196c4447ab481dcca6c490d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=vwwA5rw%2BqAv3o2SThRoYMikL4VA%3D" alt="" loading="lazy"/></p>
<p>工作流搭建好以后就可以以API的形式进行调用了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92bfe149546c42fd9953c048724a21c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=V86X0aBcbqKrHk9%2FBWlsru7a4NU%3D" alt="" loading="lazy"/></p>
<p><strong>Code in</strong> <strong>JavaScript</strong> <strong>（把字符串转换为</strong> <strong>json</strong> <strong>格式）：HTTP Request</strong>节点出来后点击【+】新增<strong>Code in JavaScript，</strong> 这是一个代码节点，它的主要作用就是把前置节点输出的字符串数据转换为json格式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8b64c3c4e544524b549c37e39ace729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=YHANrcgfJQHTJxOdD1yBV0cB0rE%3D" alt="" loading="lazy"/></p>
<p><strong>爆文仿写（</strong> <strong>AI</strong> <strong>Agent）：Code in</strong> <strong>JavaScript</strong>节点出来后点击【+】新增<strong>AI Agent</strong>节点，这个节点的作用获取前置节点输出的文章标题和内容基于gemini-2.5-pro模型进行深度二创。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3a0a2adbb6d45bca11a11eb81e6f695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=28TRWIRa5aqshrZLWGWMSeAAgXM%3D" alt="" loading="lazy"/></p>
<ul>
<li>在Chat Model处点击【+】，新增聊天模型。</li>
<li>在Output Parser处点击【+】，规整输出格式，JSON Example处填入：</li>
</ul>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"title"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"content"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25e3a2c4e1e743f2ac7110b1951d8f0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=W4t0priBgc5qH84mf1TaBcxmZv8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3.1 生成封面</h3>
<p><strong>生成封面（</strong> <strong>AI</strong> <strong>Agent）：爆文仿写（AI Agent）</strong> 节点出来后点击【+】新增<strong>AI Agent。</strong> 这个节点的作用的调用通义万相2.5的MCP Server来生成图片。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c597d490ed794789bb43582529cd3fc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=mlU4O74mVUQb1btKcO0stsCT%2BWo%3D" alt="" loading="lazy"/></p>
<ul>
<li>Chat Model处点击【+】新增OpenAI Chat Mode（或DeepSeek Chat Model）。</li>
<li>Tool处点击【+】新增MCP Client Tool用于图片生成。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cce09ce1b97f41baaaa263cfc6dbb3bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=skWhz6Uk01mtftMiwjtrCNfhWCw%3D" alt="" loading="lazy"/></p>
<p>Endpoint填写<a href="https://link.juejin.cn?target=https%3A%2F%2Fdashscope.aliyuncs.com%2Fapi%2Fv1%2Fmcps%2FWan25Media%2Fsse%25E3%2580%2582" target="_blank" title="https://dashscope.aliyuncs.com/api/v1/mcps/Wan25Media/sse%E3%80%82" ref="nofollow noopener noreferrer">dashscope.aliyuncs.com/api/v1/mcps…</a></p>
<p>Server Transport选择Server Sent Events (Deprecated)。</p>
<p>Authentication选择Header Auth。</p>
<p>Credential for Header Auth点击Create new credential，Name填写Authorization，Value填写阿里云百炼的key（<a href="https://link.juejin.cn?target=https%3A%2F%2Fbailian.console.aliyun.com%2F%3Fspm%3Da2c4g.11186623.0.0.7f477980N1ex6P%26tab%3Dmodel%23%2Fapi-key%25EF%25BC%2589%25EF%25BC%258C%25E6%25B3%25A8%25E6%2584%258Fkey%25E5%2589%258D%25E9%259D%25A2%25E9%259C%2580%25E8%25A6%2581%25E5%258A%25A0Bearer%25E5%2592%258C%25E4%25B8%2580%25E4%25B8%25AA%25E8%258B%25B1%25E6%2596%2587%25E7%25A9%25BA%25E6%25A0%25BC%25E3%2580%2582**%25E6%259C%2580%25E5%2590%258E%25E6%258A%258A%25E8%25BF%2599%25E4%25B8%25AAAuth%25E5%2591%25BD%25E5%2590%258D%25E4%25B8%25BAbailian%25E3%2580%2582" target="_blank" title="https://bailian.console.aliyun.com/?spm=a2c4g.11186623.0.0.7f477980N1ex6P&amp;tab=model#/api-key%EF%BC%89%EF%BC%8C%E6%B3%A8%E6%84%8Fkey%E5%89%8D%E9%9D%A2%E9%9C%80%E8%A6%81%E5%8A%A0Bearer%E5%92%8C%E4%B8%80%E4%B8%AA%E8%8B%B1%E6%96%87%E7%A9%BA%E6%A0%BC%E3%80%82**%E6%9C%80%E5%90%8E%E6%8A%8A%E8%BF%99%E4%B8%AAAuth%E5%91%BD%E5%90%8D%E4%B8%BAbailian%E3%80%82" ref="nofollow noopener noreferrer">bailian.console.aliyun.com/?spm=a2c4g.…</a>**</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06923ce274f04160aec4dc5e7398a94a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=jW8EPc7np%2BoIsPasG6AZ1qJvntk%3D" alt="" loading="lazy"/></p>
<p><strong>HTTP Request1（将封面图链接转换为文件）：生成封面（</strong> <strong>AI</strong> <strong>Agent）</strong> 节点出来后点击【+】添加<strong>HTTP Request</strong>节点，这个节点的作用是把图片链接转换为文件格式。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75e5f45ed13d4ce5b887fd6ece0e744a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=2ic2T1T2aY%2BAJoI96iBuw3vrUNI%3D" alt="" loading="lazy"/></p>
<p><strong>Media:uploadOther media（上传封面图）：HTTP Request1</strong>节点出来后点击【+】新增<strong>Media:uploadOther media。</strong> 这个节点的作用是上传图片链接并返回一个media_id，后续填充到公众号封面中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/006b504ac9374f5280747a9ce1c78ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=i92E%2BIsCQhP7ICI0VvrFGpFh2M0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3.2. 生成正文</h3>
<p><strong>Code in JavaScript1：爆文仿写（</strong> <strong>AI</strong> <strong>Agent）</strong> 节点出来后点击【+】新增Code in JavaScript，这个节点的作用是将正文内容改写成html格式内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45a64f65af3b41ea911899620b9e1de9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=Pjg34iKv8cSA4owYyPRwOTvK%2FRI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">3.3. 上传到草稿箱</h3>
<p><strong>Merge：Code in JavaScript1和Media:uploadOther media</strong>节点出来后点击【+】新增<strong>Merge。</strong> 这个节点的作用是整合前面生成的封面和仿写原文。</p>
<ul>
<li>Mode选择Combine</li>
<li>Combine By选择Position</li>
<li>Number of Inputs填写2</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7033e031e62d41d2960a9cc379c7bb6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=aPEkb%2BEZVqX4rcHLJfE2LEcFeqc%3D" alt="" loading="lazy"/></p>
<p><strong>新增草稿：Merge</strong>节点出来后点击【+】新增<strong>Draft:add draft</strong>节点，这个节点的作用是将前置节点生成的封面和正文都上传到公众号草稿当中。</p>
<p>草稿文章对象内容(Articles)填写：</p>
<pre><code class="hljs language-python" lang="python">[
  {
    <span class="hljs-string">"article_type"</span>: <span class="hljs-string">"news"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"{{ $('爆文仿写').item.json.output.title }}"</span>,
    <span class="hljs-string">"author"</span>: <span class="hljs-string">"小肥肠"</span>,
    <span class="hljs-string">"content"</span>: <span class="hljs-string">"{{ 
  $json.htmlContent
    .replaceAll("</span>\n<span class="hljs-string">", "</span>\n<span class="hljs-string">")   
    .replaceAll("</span>\<span class="hljs-string">r", "</span>\<span class="hljs-string">r")   
    .replaceAll("</span><span class="hljs-string">""</span>, <span class="hljs-string">"'"</span>)   
}}<span class="hljs-string">",
    "</span>thumb_media_id<span class="hljs-string">": "</span>{{ $json.media_id }}<span class="hljs-string">",
    "</span>show_cover_pic<span class="hljs-string">": 1,
    "</span>need_open_comment<span class="hljs-string">": 1,
    "</span>only_fans_can_comment<span class="hljs-string">": 0
  }
]
</span></code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34eff983330a401d88ae8c90b2fbabf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=u1nsGtMPR%2FlEPTB38j8Q921A2TQ%3D" alt="" loading="lazy"/></p>
<p>以上就是整个工作流的完整流程拆解，动手能力强的读者可以跟着教程实践一遍。如果想直接获取工作流，可以加入社群后我拉你进空间直接学习使用。</p>
<h2 data-id="heading-8">4. 结语</h2>
<p>本文详细拆解了如何利用 <strong>n8n</strong> 强大的自动化能力，配合 <strong>Coze</strong> 和 <strong>AI</strong> <strong>Agent</strong>（如 <strong>Gemini 2.5 Pro</strong> 模型）实现一个高度自动化的公众号文章仿写工作流。从前置服务的开通、社区节点的安装，到工作流的每一个节点——数据获取、内容深度二创、封面图生成、格式转换，直至最终上传到公众号<strong>草稿箱</strong>，我们完成了整个<strong>一键仿写</strong>的闭环。</p>
<p><strong>如本次分享对你有帮助，麻烦一键三连支持一下小肥肠，我们下期再见~</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a96bc810e0f4e9b9ba33c8bc628fc68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763359758&amp;x-signature=yMZwLutQPoQH8yGkU0EzOKu92qY%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python SQLAlchemy 全生命周期指南：从模型、迁移到优雅会话管理]]></title>    <link>https://juejin.cn/post/7571005216910491667</link>    <guid>https://juejin.cn/post/7571005216910491667</guid>    <pubDate>2025-11-11T06:10:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910491667" data-draft-id="7571007466823352372" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python SQLAlchemy 全生命周期指南：从模型、迁移到优雅会话管理"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T06:10:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI贺贺"/> <meta itemprop="url" content="https://juejin.cn/user/2506542241030365"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python SQLAlchemy 全生命周期指南：从模型、迁移到优雅会话管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542241030365/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI贺贺
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:10:05.000Z" title="Tue Nov 11 2025 06:10:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">摘要</h2>
<p>在 Python 项目中，如何优雅地管理数据库是一个永恒的话题，尤其是在使用像 SQLAlchemy 这样的强大 ORM (Object-Relational Mapper) 时。Web 框架（如 FastAPI）的依赖注入系统为我们提供了便捷的自动化方案，但当代码运行在非 Web 环境（如定时任务、命令行工具、数据处理脚本）时，我们该何去何从？</p>
<p>本文将作为一份终极指南，带你走过 SQLAlchemy 应用的<strong>完整生命周期</strong>：从最初的<strong>模型定义</strong>，到使用 <strong>Alembic</strong> 进行健壮的<strong>数据库迁移</strong>，再到实现优雅高效的<strong>会话管理</strong>。读完本文，你将能够构建一个通用的数据库操作“瑞士军刀”，在任何场景下都能自信地与数据库交互。</p>
<hr/>
<h2 data-id="heading-1">一、ORM 基础：用 Pythonic 的方式定义数据模型</h2>
<p>一切始于模型。ORM 的核心魅力在于让我们用熟悉的 Python 类来描述数据库表结构。</p>
<h3 data-id="heading-2">1.1 SQLAlchemy <code>declarative_base</code></h3>
<p>首先，我们需要一个所有模型的基类，它包含了将类映射到表的元数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py</span>
<span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base

Base = declarative_base()
</code></pre>
<h3 data-id="heading-3">1.2 定义模型</h3>
<p>现在，我们可以通过继承 <code>Base</code> 来创建模型。每个类属性都使用 <code>Column</code> 来定义一个数据库字段。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/models/account.py</span>
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, Integer, String, DateTime, func
<span class="hljs-keyword">from</span> src/core/database <span class="hljs-keyword">import</span> Base

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span>(<span class="hljs-title class_ inherited__">Base</span>):
    __tablename__ = <span class="hljs-string">"accounts"</span>

    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)
    nickname = Column(String, unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, nullable=<span class="hljs-literal">False</span>)
    status = Column(String, default=<span class="hljs-string">"ACTIVE"</span>, nullable=<span class="hljs-literal">False</span>)
    created_at = Column(DateTime, server_default=func.now())
</code></pre>
<h3 data-id="heading-4">1.3 关系映射 (<code>relationship</code>)</h3>
<p>当模型之间存在关联时（如用户和帖子），我们使用 <code>relationship</code> 来定义它们。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 一个用户可以有多篇帖子 (one-to-many)</span>
<span class="hljs-comment"># src/models/post.py</span>
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, Integer, String, ForeignKey
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> relationship
<span class="hljs-keyword">from</span> src/core/database <span class="hljs-keyword">import</span> Base

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Post</span>(<span class="hljs-title class_ inherited__">Base</span>):
    __tablename__ = <span class="hljs-string">"posts"</span>
    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>)
    title = Column(String)
    owner_id = Column(Integer, ForeignKey(<span class="hljs-string">"accounts.id"</span>))

    <span class="hljs-comment"># 'back_populates' 属性用于双向关系，让 Account 模型也能通过 'posts' 访问到 Post</span>
    owner = relationship(<span class="hljs-string">"Account"</span>, back_populates=<span class="hljs-string">"posts"</span>)

<span class="hljs-comment"># 在 Account 模型中添加反向关系</span>
<span class="hljs-comment"># src/models/account.py</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span>(<span class="hljs-title class_ inherited__">Base</span>):
    <span class="hljs-comment"># ... (已有列)</span>
    posts = relationship(<span class="hljs-string">"Post"</span>, back_populates=<span class="hljs-string">"owner"</span>)
</code></pre>
<h3 data-id="heading-5">1.4 <code>create_all</code> 的作用与局限性</h3>
<p>对于快速原型开发，<code>Base.metadata.create_all(engine)</code> 是个好工具，它可以根据你的模型创建所有表。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 仅适用于开发初期或测试</span>
<span class="hljs-keyword">from</span> src.core.database <span class="hljs-keyword">import</span> engine, Base
<span class="hljs-keyword">from</span> src.models <span class="hljs-keyword">import</span> account, post <span class="hljs-comment"># 导入所有模型</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Creating all tables..."</span>)
Base.metadata.create_all(bind=engine)
</code></pre>
<p><strong>局限性</strong>：<code>create_all</code> <strong>不会</strong>处理表的更新。如果你给模型增加了一个字段，它不会在现有数据库中添加这一列。这就是我们需要数据库迁移工具的原因。</p>
<hr/>
<h2 data-id="heading-6">二、数据库迁移的艺术：Alembic 核心工作流</h2>
<p>Alembic 是 SQLAlchemy 官方的数据库迁移工具。它能比对你的模型和当前数据库的状态，自动生成迁移脚本。</p>
<h3 data-id="heading-7">2.1 为什么需要 Alembic？</h3>
<ul>
<li><strong>版本控制</strong>：像 Git 管理代码一样，管理你的数据库结构变更。</li>
<li><strong>自动化</strong>：自动检测模型变化（增删改字段、建表、删表）。</li>
<li><strong>安全可靠</strong>：提供升级（<code>upgrade</code>）和降级（<code>downgrade</code>）操作，出问题时可以回滚。</li>
<li><strong>团队协作</strong>：确保团队中每个人的数据库结构都保持同步。</li>
</ul>
<h3 data-id="heading-8">2.2 Alembic 环境配置</h3>
<p>一个典型的 Alembic 项目包含两个核心配置文件：</p>
<ol>
<li>
<p><strong><code>alembic.ini</code></strong>: 主配置文件。最重要的配置是 <code>sqlalchemy.url</code>，它告诉 Alembic 要连接哪个数据库。为了不硬编码，我们通常让它从环境变量读取。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># alembic.ini</span>
<span class="hljs-section">[alembic]</span>
<span class="hljs-comment"># ...</span>
<span class="hljs-attr">sqlalchemy.url</span> = %(DATABASE_URL)s <span class="hljs-comment"># 从环境变量读取</span>
</code></pre>
</li>
<li>
<p><strong><code>env.py</code></strong>: 运行时环境配置。这里的关键是让 Alembic 知道你的模型定义在哪里，以便进行比对。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># alembic/env.py</span>
<span class="hljs-comment"># ...</span>
<span class="hljs-comment"># 导入你的模型基类</span>
<span class="hljs-keyword">from</span> src.core.database <span class="hljs-keyword">import</span> Base
<span class="hljs-comment"># 导入所有模型，确保 Alembic 能检测到它们</span>
<span class="hljs-keyword">from</span> src.models <span class="hljs-keyword">import</span> account, post

<span class="hljs-comment"># 将你的模型元数据设置为 target_metadata</span>
target_metadata = Base.metadata
<span class="hljs-comment"># ...</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">2.3 Alembic 三大核心命令</h3>
<p>掌握这三个命令，你就掌握了 Alembic 的 90%。</p>
<ol>
<li>
<p><code>alembic revision --autogenerate -m "描述信息"</code></p>
<ul>
<li><strong>作用</strong>：<strong>自动检测</strong>模型与数据库的差异，并<strong>生成</strong>一个新的迁移脚本文件。</li>
<li><strong>示例</strong>：给 <code>Account</code> 模型加一个 <code>email</code> 字段后，运行 <code>alembic revision --autogenerate -m "add email to account"</code>。</li>
</ul>
</li>
<li>
<p><code>alembic upgrade head</code></p>
<ul>
<li><strong>作用</strong>：<strong>应用</strong>所有未应用的迁移脚本，将数据库更新到最新版本（<code>head</code>）。你也可以指定一个版本号来更新到特定版本。</li>
<li><strong>示例</strong>：<code>alembic upgrade head</code> 会执行上一步生成的脚本，在数据库中添加 <code>email</code> 列。</li>
</ul>
</li>
<li>
<p><code>alembic downgrade -1</code></p>
<ul>
<li><strong>作用</strong>：<strong>回滚</strong>数据库。<code>-1</code> 表示回退一个版本。你也可以指定版本号来回退到特定状态。</li>
<li><strong>示例</strong>：<code>alembic downgrade -1</code> 会撤销刚刚的 <code>add email</code> 操作。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">2.4 最佳实践</h3>
<ul>
<li><strong>永远检查自动生成的脚本</strong>：<code>autogenerate</code> 很强大，但并非万能。对于复杂的操作（如数据迁移、复杂的约束变更），它可能需要你手动调整脚本。</li>
<li><strong>保持线性历史</strong>：在团队协作中，如果多人都生成了迁移脚本，合并时可能会产生冲突（多个 <code>head</code>）。通常的解决办法是 <code>rebase</code> 或 <code>merge</code> 迁移文件，确保一个清晰的、线性的升级路径。</li>
</ul>
<hr/>
<h2 data-id="heading-11">三、会话管理：从繁琐到优雅</h2>
<p>模型定义好了，数据库也准备就绪了，现在该如何安全高效地操作数据呢？</p>
<h3 data-id="heading-12">3.1 深入核心：<code>Session</code> 和连接池</h3>
<ul>
<li><strong><code>Engine</code></strong>: 程序的数据库接口，内部维护一个<strong>连接池</strong>。创建 <code>Engine</code> 成本较高，一个应用通常只有一个。</li>
<li><strong><code>Session</code></strong>: 一个轻量级的“工作区”或“记事本”，用于记录你将要对数据库做的所有操作（增、删、改）。它本身不持有数据库连接。</li>
<li><strong>连接池 (Connection Pooling)</strong>：<code>Engine</code> 预先创建并维护一组数据库连接。当 <code>Session</code> 第一次需要与数据库通信时，它会从池中“借用”一个连接，用完后“归还”，而不是每次都创建和销毁昂贵的真实连接。这正是高性能的关键。</li>
<li><strong><code>SessionLocal()</code></strong>: 一个“会话工厂”，调用它会创建一个新的 <code>Session</code> 实例。这个操作成本极低。</li>
</ul>
<h3 data-id="heading-13">3.2 模式演进：四种会话管理模式</h3>
<h4 data-id="heading-14">模式一：基础的 <code>try...finally</code> (不推荐日常使用)</h4>
<p>这是最原始的方式，能工作，但很繁琐且容易出错。</p>
<pre><code class="hljs language-python" lang="python">db = SessionLocal()
<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># ... 执行数据库操作 ...</span>
    db.commit()
<span class="hljs-keyword">finally</span>:
    db.close()
</code></pre>
<h4 data-id="heading-15">模式二：<code>with</code> 语句与上下文管理器 (推荐)</h4>
<p>Python 的 <code>with</code> 语句是处理这类“获取-使用-释放”资源的完美工具。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py</span>
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">db_session_scope</span>():
    db = SessionLocal()
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> db
        db.commit()
    <span class="hljs-keyword">except</span> Exception:
        db.rollback()
        <span class="hljs-keyword">raise</span>
    <span class="hljs-keyword">finally</span>:
        db.close()

<span class="hljs-comment"># 用法</span>
<span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
    user = db.query(Account).first()
</code></pre>
<h4 data-id="heading-16">模式三：装饰器 (<code>@decorator</code>) (推荐)</h4>
<p>对于封装好的业务逻辑函数，装饰器是减少样板代码的利器。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py</span>
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps

<span class="hljs-keyword">def</span> <span class="hljs-title function_">with_db_session</span>(<span class="hljs-params">func</span>):
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
            <span class="hljs-keyword">return</span> func(db, *args, **kwargs)
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># 用法</span>
<span class="hljs-meta">@with_db_session</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_nickname</span>(<span class="hljs-params">db: Session, nickname: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">return</span> db.query(Account).filter_by(nickname=nickname).first()

user = get_user_by_nickname(<span class="hljs-string">"admin"</span>)
</code></pre>
<h4 data-id="heading-17">模式四：高阶函数 (推荐)</h4>
<p>对于一次性的简单查询，一个接受 <code>lambda</code> 的高阶函数非常方便。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_with_db</span>(<span class="hljs-params">func: <span class="hljs-type">Callable</span></span>):
    <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
        <span class="hljs-keyword">return</span> func(db)

<span class="hljs-comment"># 用法</span>
user_count = run_with_db(<span class="hljs-keyword">lambda</span> db: db.query(Account).count())
</code></pre>
<hr/>
<h2 data-id="heading-18">四、构建你的“瑞士军刀”：完整代码实现</h2>
<p>将上述工具整合到 <code>src/core/database.py</code> 中，你就拥有了一个强大的数据库操作工具箱。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># src/core/database.py (最终版本)</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker, Session
<span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base
<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager
<span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Callable</span>
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

load_dotenv()
DATABASE_URL = os.getenv(<span class="hljs-string">"DATABASE_URL"</span>)

engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=<span class="hljs-literal">False</span>, autoflush=<span class="hljs-literal">False</span>, bind=engine)
Base = declarative_base()

<span class="hljs-comment"># --- 我们的工具箱 ---</span>

<span class="hljs-meta">@contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">db_session_scope</span>():
    <span class="hljs-string">"""提供一个事务性的数据库会话作用域。"""</span>
    db = SessionLocal()
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> db
        db.commit()
    <span class="hljs-keyword">except</span> Exception:
        db.rollback()
        <span class="hljs-keyword">raise</span>
    <span class="hljs-keyword">finally</span>:
        db.close()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">with_db_session</span>(<span class="hljs-params">func: <span class="hljs-type">Callable</span></span>):
    <span class="hljs-string">"""装饰器：为函数注入一个 db session。"""</span>
<span class="hljs-meta">    @wraps(<span class="hljs-params">func</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
            <span class="hljs-keyword">return</span> func(db, *args, **kwargs)
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_with_db</span>(<span class="hljs-params">func: <span class="hljs-type">Callable</span></span>):
    <span class="hljs-string">"""高阶函数：在 db 会话中执行一个 lambda 或其他 callable。"""</span>
    <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
        <span class="hljs-keyword">return</span> func(db)
</code></pre>
<hr/>
<h2 data-id="heading-19">五、实战演练</h2>
<p>下面的示例脚本展示了如何在实际项目中使用这些工具。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># examples/database_scope_demo.py</span>
<span class="hljs-keyword">from</span> src.core.database <span class="hljs-keyword">import</span> db_session_scope, with_db_session, run_with_db
<span class="hljs-keyword">from</span> src.models.account <span class="hljs-keyword">import</span> Account
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> Session

<span class="hljs-comment"># 1. with 语句</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_with</span>():
    <span class="hljs-keyword">with</span> db_session_scope() <span class="hljs-keyword">as</span> db:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"当前用户数: <span class="hljs-subst">{db.query(Account).count()}</span>"</span>)

<span class="hljs-comment"># 2. 装饰器</span>
<span class="hljs-meta">@with_db_session</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">find_user</span>(<span class="hljs-params">db: Session, nickname: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">return</span> db.query(Account).filter_by(nickname=nickname).first()

<span class="hljs-comment"># 3. 高阶函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_lambda</span>():
    inactive_count = run_with_db(
        <span class="hljs-keyword">lambda</span> db: db.query(Account).filter_by(status=<span class="hljs-string">'INACTIVE'</span>).count()
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"非活跃用户数: <span class="hljs-subst">{inactive_count}</span>"</span>)

<span class="hljs-comment"># --- 执行 ---</span>
demo_with()
user = find_user(<span class="hljs-string">"admin"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"找到用户: <span class="hljs-subst">{user.nickname <span class="hljs-keyword">if</span> user <span class="hljs-keyword">else</span> <span class="hljs-string">'无'</span>}</span>"</span>)
demo_lambda()
</code></pre>
<hr/>
<h2 data-id="heading-20">六、总结</h2>
<p>通过本文，我们建立了一套覆盖 SQLAlchemy 全生命周期的管理方案：</p>
<ol>
<li><strong>用 <code>declarative_base</code> 定义模型</strong>：代码即文档，清晰明了。</li>
<li><strong>用 <code>Alembic</code> 管理迁移</strong>：保证数据库结构的健壮、可追溯和团队同步。</li>
<li><strong>用三种模式管理会话</strong>：
<ul>
<li><code>with db_session_scope()</code>: 适用于复杂的、多步骤的业务逻辑。</li>
<li><code>@with_db_session</code>: 适用于封装独立的、可复用的业务函数。</li>
<li><code>run_with_db()</code>: 适用于执行简单的、一次性的查询。</li>
</ul>
</li>
</ol>
<p>将这些工具和理念融入你的项目，可以极大地提升代码质量、开发效率和系统的长期可维护性。从此告别混乱的数据库操作，拥抱 Pythonic 的优雅。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[离线工程集成其他推送]]></title>    <link>https://juejin.cn/post/7571005216910475283</link>    <guid>https://juejin.cn/post/7571005216910475283</guid>    <pubDate>2025-11-11T06:09:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910475283" data-draft-id="7570976560708747327" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="离线工程集成其他推送"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-11T06:09:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mr_汪"/> <meta itemprop="url" content="https://juejin.cn/user/1275089221598765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            离线工程集成其他推送
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1275089221598765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mr_汪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:09:03.000Z" title="Tue Nov 11 2025 06:09:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>uniapp中推送通知</p>
<p>1.在app.vue中添加监听</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> globalEvent = uni.requireNativePlugin(<span class="hljs-string">'globalEvent'</span>);
globalEvent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'myEvent'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'onPushMessage myEvent'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(e));
});
app.<span class="hljs-title function_">initEventBus</span>()
</code></pre>
<p>2、调用插件app.initEventBus()，注册EventBus</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">UniJSMethod</span>(uiThread = <span class="hljs-literal">false</span>)
fun <span class="hljs-title function_">initEventBus</span>(): <span class="hljs-title class_">Int</span> {
    <span class="hljs-keyword">if</span> (!isRegistered) {
        <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">getDefault</span>().<span class="hljs-title function_">register</span>(<span class="hljs-variable language_">this</span>)
        <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">d</span>(<span class="hljs-string">"onPushMessage"</span>,<span class="hljs-string">"onMessageEvent initEventBus"</span>)
        isRegistered = <span class="hljs-literal">true</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
}
</code></pre>
<p>3.收到通知设置通知点击跳转，跳转到MainActivity</p>
<pre><code class="hljs language-js" lang="js">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPandoraEntry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PandoraEntry</span>
</code></pre>
<p>4.如果是离线通知的话，直接跳转到MainActivity或者设置打开应用</p>
<blockquote>
<p>MyPandoraEntry启动模式设置成android:launchMode="singleTask"</p>
</blockquote>
<p>5.点击通知后，在startActivity获取到点击通知后intent发送postSticky广播</p>
<pre><code class="hljs language-js" lang="js">    @<span class="hljs-title class_">Override</span>
    public <span class="hljs-keyword">void</span> <span class="hljs-title function_">startActivity</span>(<span class="hljs-params">Intent intent</span>) {
        <span class="hljs-title class_">EventBus</span>.<span class="hljs-title function_">getDefault</span>().<span class="hljs-title function_">postSticky</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageEvent</span>(intent.<span class="hljs-title function_">getExtras</span>().<span class="hljs-title function_">get</span>(<span class="hljs-string">"key"</span>)));

    }
</code></pre>
<p>6.插件收到信息后，通知uniapp层</p>
<pre><code class="hljs language-js" lang="js">fun <span class="hljs-title function_">onMessageEvent</span>(<span class="hljs-params">event: MessageEvent</span>) {
    mUniSDKInstance.<span class="hljs-title function_">fireGlobalEventCallback</span>(<span class="hljs-string">"myEvent"</span>, params)
}
</code></pre>
<p>目前android ios 鸿蒙next都可以使用一样的方式，发送<strong>粘性广播</strong>，通过启动后监听。其中uniapp鸿蒙next需要自己使用接口，目前没有看到globalEvent</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose 状态管理]]></title>    <link>https://juejin.cn/post/7571086754879881262</link>    <guid>https://juejin.cn/post/7571086754879881262</guid>    <pubDate>2025-11-11T06:03:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754879881262" data-draft-id="7570992947464110090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose 状态管理"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-11T06:03:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="循环不息优化不止"/> <meta itemprop="url" content="https://juejin.cn/user/3499064877398681"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose 状态管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3499064877398681/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    循环不息优化不止
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:03:36.000Z" title="Tue Nov 11 2025 06:03:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Jetpack Compose 状态管理</h2>
<p>Jetpack Compose 正在改变我们构建 Android UI 的方式。其声明式的特性让我们能更直观地描述界面，但同时也带来了一个核心问题：<strong>如何管理和持久化UI状态？</strong></p>
<h3 data-id="heading-1">Part 1: <code>remember</code> - Compose 的“短期记忆”</h3>
<p>在 Compose 中，当一个状态改变时，相关的 Composable 函数会<strong>重组（Recomposition）</strong>，也就是重新执行。这意味着，任何在函数体内的普通变量都会在每次重组时被重置。</p>
<p>为了解决这个问题，Compose 提供了 <code>remember</code>。</p>
<p><code>remember</code> 的核心作用是<strong>在多次重组之间“记住”一个值</strong>。它会将计算结果存储在组合树中，下次重组时直接返回缓存的值，而不是重新计算。</p>
<h4 data-id="heading-2">用例 1：记住 UI 状态</h4>
<p>这是最常见的用法。<code>remember</code> 与 <code>MutableState</code> 结合，让状态在重组后得以保留。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 如果没有 remember，每次重组 name 都会被重置为空字符串</span>
<span class="hljs-keyword">var</span> name <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }```

#### 用例 <span class="hljs-number">2</span>：缓存高成本计算

`remember` 不仅能记住宿主，还能记住任何计算结果，这对于避免重复执行昂贵操作至关重要。

​```kotlin
<span class="hljs-comment">// 创建 ShaderBrush 的操作（特别是加载位图）是昂贵的</span>
<span class="hljs-comment">// 使用 remember 可以确保它只在首次组合时被创建一次</span>
<span class="hljs-keyword">val</span> brush = remember {
    ShaderBrush(
        BitmapShader(
            ImageBitmap.imageResource(res, avatarRes).asAndroidBitmap(),
            Shader.TileMode.REPEAT,
            Shader.TileMode.REPEAT
        )
    )
}
</code></pre>
<blockquote>
<p><strong><code>remember</code> 的局限</strong>：它的记忆是“短期”的。当发生<strong>配置变更（如屏幕旋转）<strong>或</strong>系统因内存不足终止进程</strong>时，<code>remember</code> 记住的所有内容都会丢失。</p>
</blockquote>
<h3 data-id="heading-3">Part 2: <code>rememberSaveable</code> - 跨越配置变更的“长期记忆”</h3>
<p>为了解决 <code>remember</code> 的局限性，Compose 提供了 <code>rememberSaveable</code>。</p>
<p>顾名思义，<code>rememberSaveable</code> 不仅能在重组中记住状态，还能自动将数据保存到 Android 的 <code>Bundle</code> 中。这意味着即使用户旋转了屏幕，甚至应用进程被系统回收后，状态也能够被完美恢复。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 即使用户旋转屏幕，输入框中的文字也不会丢失</span>
<span class="hljs-keyword">var</span> name <span class="hljs-keyword">by</span> rememberSaveable { mutableStateOf(<span class="hljs-string">""</span>) }
</code></pre>
<h3 data-id="heading-4">Part 3: 让自定义对象变得“可保存”</h3>
<p><code>rememberSaveable</code> 对基本数据类型（Int, String, Boolean...）支持得很好，但如果我们想保存一个自定义的 <code>City</code> 对象呢？默认情况下，<code>rememberSaveable</code> 是做不到的，因为它不知道如何将一个 <code>City</code> 对象存入 <code>Bundle</code>。</p>
<p>我们有以下三种主流方案来解决这个问题。</p>
<h4 data-id="heading-5">方案一：<code>@Parcelize</code> - 自动化实现 (最推荐)</h4>
<p>如果我们可以修改这个类的源码，这是最简单、最优雅的方式。通过添加 <code>kotlin-parcelize</code> 插件并为数据类添加 <code>@Parcelize</code> 注解，编译器会自动为我们实现 <code>Parcelable</code> 接口。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 在 build.gradle 中启用插件</span>
plugins {
    id <span class="hljs-string">'kotlin-parcelize'</span>
}

<span class="hljs-comment">// 2. 为数据类添加注解并实现 Parcelable 接口</span>
<span class="hljs-meta">@Parcelize</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">City</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> country: String) : Parcelable

<span class="hljs-comment">// 3. 直接在 rememberSaveable 中使用</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CityScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> selectedCity = rememberSaveable {
        mutableStateOf(City(<span class="hljs-string">"Madrid"</span>, <span class="hljs-string">"Spain"</span>))
    }
}
</code></pre>
<p><code>rememberSaveable</code> 会自动检测到 <code>City</code> 是 <code>Parcelable</code> 的，并知道如何处理它。</p>
<h4 data-id="heading-6">方案二：自定义 <code>Saver</code> - 当你无法修改源码时</h4>
<p>当我们无法修改类的定义时（例如，它来自第三方库），我们可以提供一个自定义的 <code>Saver</code> 对象，明确告诉 <code>rememberSaveable</code> 如何“保存”和“恢复”这个对象。</p>
<h5 data-id="heading-7"><strong><code>MapSaver</code> - 健壮且可读的选择</strong></h5>
<p><code>MapSaver</code> 将对象转换为一个 <code>Map&lt;String, Any&gt;</code>。因为值是通过键来存取的，所以它不依赖于顺序，非常健壮。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> CitySaver = mapSaver(
    save = { city -&gt;
        <span class="hljs-comment">// 保存：将 City 对象拆解成一个 Map</span>
        mapOf(<span class="hljs-string">"Name"</span> to city.name, <span class="hljs-string">"Country"</span> to city.country)
    },
    restore = { map -&gt;
        <span class="hljs-comment">// 恢复：从 Map 中读取值，重新构建 City 对象</span>
        City(map[<span class="hljs-string">"Name"</span>] <span class="hljs-keyword">as</span> String, map[<span class="hljs-string">"Country"</span>] <span class="hljs-keyword">as</span> String)
    }
)

<span class="hljs-comment">// 使用时，将自定义的 Saver 传递给 stateSaver 参数</span>
<span class="hljs-keyword">var</span> selectedCity = rememberSaveable(stateSaver = CitySaver) {
    mutableStateOf(City(<span class="hljs-string">"Madrid"</span>, <span class="hljs-string">"Spain"</span>))
}
</code></pre>
<h5 data-id="heading-8"><strong><code>ListSaver</code> - 简洁但需谨慎的选择</strong></h5>
<p><code>ListSaver</code> 将对象转换为一个 <code>List&lt;Any&gt;</code>。它通过索引来存取，代码更简洁，但也更“脆弱”。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> CitySaver = listSaver&lt;City, Any&gt;(
    save = {
        <span class="hljs-comment">// 保存：将属性按固定顺序放入列表</span>
        listOf(it.name, it.country)
    },
    restore = {
        <span class="hljs-comment">// 恢复：按相同顺序从列表中通过索引取值</span>
        City(it[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> String, it[<span class="hljs-number">1</span>] <span class="hljs-keyword">as</span> String)
    }
)

<span class="hljs-comment">// 使用方法与 MapSaver 相同</span>
<span class="hljs-keyword">var</span> selectedCity = rememberSaveable(stateSaver = CitySaver) {
    mutableStateOf(City(<span class="hljs-string">"Madrid"</span>, <span class="hljs-string">"Spain"</span>))
}
</code></pre>






























<table><thead><tr><th align="left">特性</th><th align="left">MapSaver</th><th align="left">ListSaver</th></tr></thead><tbody><tr><td align="left"><strong>工作方式</strong></td><td align="left">键值对 (Key-Value)</td><td align="left">有序列表 (Index-based)</td></tr><tr><td align="left"><strong>健壮性</strong></td><td align="left"><strong>高</strong>，不依赖属性顺序</td><td align="left"><strong>低</strong>，顺序改变会导致错误</td></tr><tr><td align="left"><strong>代码量</strong></td><td align="left">略多</td><td align="left">非常简洁</td></tr><tr><td align="left"><strong>推荐场景</strong></td><td align="left">大多数自定义对象</td><td align="left">属性极少且顺序非常稳定的对象</td></tr></tbody></table>
<h3 data-id="heading-9">Part 4: 精准控制：当状态需要“重置”时</h3>
<p><code>remember</code> 和 <code>rememberSaveable</code> 都会一直持有缓存的值，直到它们离开组合树。但有时我们希望在<strong>输入参数变化时，主动重置或重新计算这个状态</strong>。这就是 <code>key</code> 和 <code>inputs</code> 参数的用武之地。</p>
<h4 data-id="heading-10"><code>remember</code> 与 <code>key</code></h4>
<p>当 <code>remember</code> 的 <code>key</code> 发生变化时，它会废弃旧的缓存，并重新执行其 lambda 计算块。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// avatarRes 是一个外部传入的图片资源 ID</span>
<span class="hljs-keyword">val</span> brush = remember(key1 = avatarRes) {
    <span class="hljs-comment">// 当 avatarRes 改变时，这段代码会重新执行，</span>
    <span class="hljs-comment">// 创建一个新的、包含新头像的 ShaderBrush</span>
    ShaderBrush(...)
}
</code></pre>
<h4 data-id="heading-11"><code>rememberSaveable</code> 与 <code>inputs</code></h4>
<p><code>rememberSaveable</code> 有着同样的能力，参数名为 <code>inputs</code>。当 <code>inputs</code> 变化时，<code>rememberSaveable</code> 会丢弃已保存的状态，并重新执行初始化。</p>
<p>这在“基于外部数据初始化，但允许用户本地修改”的场景下非常有用。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// typedQuery 是外部传入的搜索词</span>
<span class="hljs-keyword">var</span> userTypedQuery <span class="hljs-keyword">by</span> rememberSaveable(inputs = typedQuery, stateSaver = TextFieldValue.Saver) {
    <span class="hljs-comment">// 当外部的 typedQuery 改变时，文本框的内容会被重置为这个新值</span>
    mutableStateOf(
        TextFieldValue(text = typedQuery, selection = TextRange(typedQuery.length))
    )
}
</code></pre>
<h3 data-id="heading-12">Part 5: 架构与最佳实践 - 状态应该放在哪里？</h3>
<p>我们已经掌握了管理状态的工具，但更重要的问题是：状态应该放在哪里？</p>
<h4 data-id="heading-13">状态提升 (State Hoisting)</h4>
<p>这是一个核心原则：将状态从子 Composable 中“提升”到它们的共同父 Composable 中。这样做的好处是：</p>
<ul>
<li><strong>单一数据源</strong>：状态由一个地方统一管理。</li>
<li><strong>可复用性</strong>：子 Composable 变为<strong>无状态 (Stateless)</strong> 的，它们只负责接收数据并显示，不关心数据从何而来，因此可以在任何地方复用。</li>
<li><strong>可测试性</strong>：无状态的 Composable 更容易进行单元测试。</li>
</ul>
<h4 data-id="heading-14">ViewModel - 屏幕级别状态的最终归宿</h4>
<p>对于屏幕级别的状态（那些与业务逻辑紧密相关的状态），最佳实践是将其放在 <code>ViewModel</code> 中。</p>
<ul>
<li><code>ViewModel</code> 天然具备<strong>生命周期感知</strong>能力，它能在配置变更后存活，完美解决了状态持久化的问题。</li>
<li>它将业务逻辑与 UI 逻辑分离，使代码结构更清晰。</li>
<li>UI (Composable) 通过 <code>StateFlow</code> 或其他可观察类型来订阅 <code>ViewModel</code> 中的状态，并对其做出反应。</li>
</ul>
<h3 data-id="heading-15">结论</h3>
<p>掌握状态管理是精通 Jetpack Compose 的关键。让我们快速回顾一下核心工具和使用场景：</p>
<ul>
<li><strong><code>remember</code></strong>: 用于处理<strong>仅与 UI 相关</strong>、<strong>临时性</strong>的状态，以及<strong>缓存昂贵的计算</strong>。</li>
<li><strong><code>rememberSaveable</code></strong>: 用于需要<strong>跨越配置变更和进程终止</strong>来持久化的状态，如用户输入。</li>
<li><strong><code>@Parcelize</code>, <code>MapSaver</code>, <code>ListSaver</code></strong>: 用于让 <code>rememberSaveable</code> 支持你的<strong>自定义数据类型</strong>。</li>
<li><strong><code>key</code>/<code>inputs</code></strong>: 用于在<strong>外部依赖变化时，精准地重置或重新计算</strong>被记住的状态。</li>
<li><strong>状态提升 &amp; <code>ViewModel</code></strong>: 遵循这些架构原则，构建<strong>可维护、可测试、结构清晰</strong>的 Compose 应用。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub 上的 3 个 AI 信息差利器，太绝了啊。]]></title>    <link>https://juejin.cn/post/7571021605318541364</link>    <guid>https://juejin.cn/post/7571021605318541364</guid>    <pubDate>2025-11-11T05:55:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571021605318541364" data-draft-id="7571068689765482536" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub 上的 3 个 AI 信息差利器，太绝了啊。"/> <meta itemprop="keywords" content="GitHub,Git"/> <meta itemprop="datePublished" content="2025-11-11T05:55:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub 上的 3 个 AI 信息差利器，太绝了啊。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:55:15.000Z" title="Tue Nov 11 2025 05:55:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>相信大家也和我一样，对优质的信息源极度关注。</p>
<p>我一般在 X、小宇宙播客、即刻等平台获取最优质的信息。但是信息一般会散落在各个平台，如果能聚合推送给我就好了。</p>
<p>哪怕是一些总结摘要，我也能快速知道自己关注的博主更新了啥，感兴趣就去详细了解一下。</p>
<p>其实 GitHub 上就有一些借助 AI 把优质信息聚合的开源利器，分享给大家。</p>
<p>希望对你有用。</p>
<h2 data-id="heading-0">01、AI 内容聚合平台</h2>
<p>BestBlogs 就可以把 X、小宇宙播客、优质推文、博客、视频啥的推给你，在一个平台看最近的 AI 科技大事儿。它利用 AI 大语言模型对文章进行摘要、评分和翻译，帮助用户高效筛选高价值内容。</p>
<p>基于这个开源项目构建的网站内容，来源于以下 400 多个 RSS 订阅源。</p>
<p>包含文章类、播客类、视频类、Twitter 类：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2c956c7fee54fa5a0f0a857ea70e991~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=vNiaTqsUk7NTR3ws7NofVMmxGSw%3D" alt="图片" loading="lazy"/></p>
<p>优质文章</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef1f518a86d94c03818e1812808eb546~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=mGoRxikvtxmqIHci5n60nd0lTJA%3D" alt="图片" loading="lazy"/></p>
<p>播客很棒，屠龙之术、张小珺、晚点、42 章经这些 AI 方向很优质的博客都有。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1804a523f4947f1b038a91bc443dd29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=uGtdLbbVnu9TdCvrmHOPhRkgTGk%3D" alt="图片" loading="lazy"/></p>
<p>点开播客栏目就能直接播放。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc9f60ffaa664cf290cec48d15638508~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=1vE0eRtsxmDkaj243yUNn5TR6aQ%3D" alt="图片" loading="lazy"/></p>
<p>而且 AI 还会帮你做摘要。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/900a1b5ca68946d69977b53a4e4e5b55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=m9C8B9hG9O9w5jrxcyp7nK2fYHs%3D" alt="图片" loading="lazy"/></p>
<p>只能对播客进行转录，还能区分发言人。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bedfbf91ca164fa09c985bdf97cc96e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=9e1ciauQ1ovS4mTaOw%2F4mW1KL0M%3D" alt="图片" loading="lazy"/></p>
<p>精选视频</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7a74c6d5ed34d9599d24d7bc3d4895f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=OcJfzcrbkFhj7S2gzanavCoCiIc%3D" alt="图片" loading="lazy"/></p>
<p>热门推文</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54d6afbd8aac42b28163ecfb41b7e07f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=e71C2Sy6a7wRmV6n9w0659xQmaI%3D" alt="图片" loading="lazy"/></p>
<p>从实现原理来看，BestBlogs 的工作流程非常细致：首先通过 RSS 协议爬取订阅源的文章信息，并使用无头浏览器提取完整内容。然后通过初步评分过滤低质量内容，接着利用大语言模型进行深度分析，生成一句话总结、详细摘要、主要观点、标签分类和质量评分。最后支持多语言翻译优化，确保内容可读性。</p>
<p>同时，项目集成了 Dify Workflow 等工具，使得智能分析流程可定制化。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/ginobefun/BestBlogs</span>
</code></pre>
<h2 data-id="heading-1">02、监控热点神器</h2>
<p>这个叫 TrendRadar 的开源项目可以一键监控今日头条、百度热搜、微博、抖音、知乎、B站等 35 个平台，把分散在各个平台的热搜合并起来。</p>
<p>按照你关心的热度重新排序，不再被各个平台的算法牵着走。它最大的特点是，小白也能部署成功。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa82c0c80712424e8e37863d583ef217~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=E1rbUnoOxVeYBqzeQaq5GJZoLLE%3D" alt="图片" loading="lazy"/></p>
<p>支持智能关键词筛选，比如设置个人关键词，比如：AI、开源，只推送相关热点，过滤无关信息，自动生成热点分析报告。</p>
<p>而且还能企业微信、飞书、钉钉推送，30 秒网页部署，1 分钟手机通知，无需编程基础。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06c1332560e1498c9fad4acc749130b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=dhVpElKR59rW5emHg6ySN5GNdoE%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4516c91f69354ef19e054b8de36f3146~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=MVfqFBg8qSF2C3thfessoGdFE5w%3D" alt="图片" loading="lazy"/></p>
<p>更值得一提的是它的 AI 分析功能，基于 MCP 协议实现了 13 种智能分析工具。你可以直接用自然语言提问，比如查询昨天知乎的热点或分析比特币最近的热度趋势，系统就会给出相应的分析结果。</p>
<p>如何部署</p>
<p>很简单，直接 Fork 这个开源项目到你的 GitHub 账户。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/sansan0/TrendRadar</span>
</code></pre>
<p>在你 Fork 后的仓库中，进入 <code>Settings</code> &gt; <code>Secrets and variables</code> &gt; <code>Actions</code> &gt; <code>New repository secret。</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72a6f6b5dc6b4716bdd9407853f6453f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=UdvqDW7yVfzSx6UKXf1vqXzftOw%3D" alt="图片" loading="lazy"/></p>
<p>然后配置一下你想在哪个平台收热点新闻通知，比如企业微信、飞书、钉钉啥的。可以同时配置多个平台，系统会向所有配置的平台发送通知。</p>
<p>拿企业微信机器人举例子，你可以在 <code>repository</code> secret 配置：</p>
<ul>
<li>名称：WEWORK_WEBHOOK_URL</li>
<li>值：你的企业微信机器人 Webhook 地址</li>
</ul>
<p>如何获取企业微信机器人的 Webhook 地址，你可以搜一下很简单的。效果类似下图，一个 name 对应一个 <code>repository</code> secret，保存完就行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8eb30e5ae3b403b8548ca46155b101f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=Y5Mt2JDFcFlrz0VnBSH5LllgH7c%3D" alt="图片" loading="lazy"/></p>
<p>然后在 config/config.yaml 中配置推送模式和通知选项，frequency_words.txt 中添加你关心的关键词。</p>
<p>crawler.yml 中设置<strong>推送频率，</strong> 请谨慎调整，别贪心。</p>
<p><strong>手动测试新闻推送，</strong> 进入你 Fork 的开源项目 Actions，找到 "Hot News Crawler" 的点进去</p>
<p>点击 "Run workflow" 按钮运行，等待 1 分钟左右数据到你企业微信上了。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/sansan0/TrendRadar</span>
</code></pre>
<h2 data-id="heading-2">03、AI 资讯日报</h2>
<p>CloudFlare-AI-Insight-Daily 是一个基于 Cloudflare Workers 的内容聚合与生成平台。</p>
<p>它专门针对 AI 领域，每日自动抓取行业新闻、热门开源项目、前沿学术论文以及科技领袖的社交媒体内容。</p>
<p>我经常看这个，最近什么模型发布了、什么新产品，大 V 们说了什么有意思的事情，这个开源项目都能聚合爬取。如果使用 Folo 工具，也应该看到这个 AI Daily 的订阅源。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b83243c64a2c44c78656b2302a4dbaea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445315&amp;x-signature=Obs%2F6H8C6fbMzf%2FUcPKxD9P4CSc%3D" alt="图片" loading="lazy"/></p>
<p>项目目前已经形成了完整的内容产出生态，除了生成网页版日报外，还能自动生成播客脚本，支持 RSS 订阅，甚至可以通过微信公众号每日推送，满足不同用户的内容消费习惯。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/justlovemaki/CloudFlare-AI-Insight-Daily</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java中的“万物皆对象”：一场编程界的哲学革命]]></title>    <link>https://juejin.cn/post/7571088527677472794</link>    <guid>https://juejin.cn/post/7571088527677472794</guid>    <pubDate>2025-11-11T06:20:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571088527677472794" data-draft-id="7571086754880077870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java中的“万物皆对象”：一场编程界的哲学革命"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-11T06:20:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="会编程的吕洞宾"/> <meta itemprop="url" content="https://juejin.cn/user/2506542242333832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java中的“万物皆对象”：一场编程界的哲学革命
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542242333832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    会编程的吕洞宾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:20:58.000Z" title="Tue Nov 11 2025 06:20:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java中的“万物皆对象”：一场编程界的哲学革命</h2>
<blockquote>
<p>作者：会编程的吕洞宾</p>
<p>温馨提示：阅读本文前请确保您已服用"面向对象"牌仙丹，否则可能无法理解本文的玄妙之处</p>
</blockquote>
<h3 data-id="heading-1">什么是"万物皆对象"？</h3>
<p>想象一下，你走进一家神奇的超市，这里的<strong>一切</strong>都是商品对象：</p>
<ul>
<li>苹果是一个<code>Apple</code>对象</li>
<li>购物车是一个<code>ShoppingCart</code>对象</li>
<li>甚至收银员也是一个<code>Cashier</code>对象</li>
</ul>
<p>这就是Java世界的核心思想——<strong>万物皆对象</strong>！在Java的宇宙里，所有东西都是某种类的实例，就像现实世界中所有东西都属于某个类别一样。</p>
<h3 data-id="heading-2">对象的三要素：状态、行为、身份</h3>
<p>每个Java对象都像一个小人儿，有三个基本特征：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-comment">// 状态（内部数据）</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"吕洞宾"</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;  <span class="hljs-comment">// 修仙之人，年龄不是问题</span>
    
    <span class="hljs-comment">// 行为（方法）</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">fly</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"御剑飞行中..."</span>);
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">drink</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"品尝仙酒..."</span>);
    }
}
</code></pre>
<h3 data-id="heading-3">对象是如何"活"起来的？</h3>
<h4 data-id="heading-4">创建对象：new关键字的神奇魔法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 就像变魔术一样，new一下对象就诞生了！</span>
<span class="hljs-type">Person</span> <span class="hljs-variable">ludongbin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
</code></pre>
<h4 data-id="heading-5">对象通信：消息传递</h4>
<p>对象之间通过"发送消息"（调用方法）来交流：</p>
<pre><code class="hljs language-java" lang="java">ludongbin.fly();      <span class="hljs-comment">// 发送"飞行"消息</span>
ludongbin.drink();    <span class="hljs-comment">// 发送"喝酒"消息</span>
</code></pre>
<h3 data-id="heading-6">为什么说"几乎"万物皆对象？</h3>
<p>聪明的你可能要问了："基本类型（int, double等）也是对象吗？"</p>
<p>问得好！这里有个小例外：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;          <span class="hljs-comment">// 这是基本类型，不是对象</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">42</span>);  <span class="hljs-comment">// 这才是对象！</span>
</code></pre>
<p>不过Java提供了"自动装箱"的魔法，让基本类型和包装类对象可以自由转换：</p>
<pre><code class="hljs language-java" lang="java">List&lt;Integer&gt; numbers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
numbers.add(<span class="hljs-number">42</span>);  <span class="hljs-comment">// 自动把int变成Integer对象</span>
</code></pre>
<h3 data-id="heading-7">对象的生命周期：从诞生到仙逝</h3>
<h4 data-id="heading-8">诞生时刻（构造器）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Immortal</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Immortal</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"新的仙人诞生了！"</span>);
    }
}
</code></pre>
<h4 data-id="heading-9">活跃时期（方法调用）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Immortal</span> <span class="hljs-variable">immortal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Immortal</span>();
immortal.practice();  <span class="hljs-comment">// 修炼功法</span>
</code></pre>
<h4 data-id="heading-10">仙逝时刻（垃圾回收）</h4>
<pre><code class="hljs language-java" lang="java">immortal = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// 解除引用</span>
<span class="hljs-comment">// 垃圾回收器会在合适的时候来"超度"这个对象</span>
</code></pre>
<h3 data-id="heading-11">实战演练：创建一个"修仙系统"</h3>
<p>让我们用"万物皆对象"的思想构建一个简单的修仙世界：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 法宝类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MagicTreasure</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> power;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">use</span><span class="hljs-params">()</span> {
        System.out.println(name + <span class="hljs-string">"发挥威力，造成"</span> + power + <span class="hljs-string">"点伤害！"</span>);
    }
}

<span class="hljs-comment">// 修仙者类  </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cultivator</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> level;
    <span class="hljs-keyword">private</span> MagicTreasure treasure;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cultivate</span><span class="hljs-params">()</span> {
        level++;
        System.out.println(name + <span class="hljs-string">"修炼突破，达到"</span> + level + <span class="hljs-string">"层境界！"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fight</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (treasure != <span class="hljs-literal">null</span>) {
            treasure.use();
        }
    }
}

<span class="hljs-comment">// 使用我们的修仙系统</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmortalWorld</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Cultivator</span> <span class="hljs-variable">hero</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cultivator</span>();
        <span class="hljs-type">MagicTreasure</span> <span class="hljs-variable">sword</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MagicTreasure</span>();
        
        hero.cultivate();  <span class="hljs-comment">// 修炼升级</span>
        hero.fight();      <span class="hljs-comment">// 使用法宝战斗</span>
    }
}
</code></pre>
<h3 data-id="heading-12">总结：对象思维的妙处</h3>
<p>"万物皆对象"不仅仅是技术概念，更是一种<strong>思维方式</strong>：</p>
<ol>
<li><strong>模块化</strong>：把复杂系统拆分成独立的对象</li>
<li><strong>复用性</strong>：创建一次，多次使用</li>
<li><strong>灵活性</strong>：容易修改和扩展</li>
<li><strong>现实映射</strong>：代码结构更贴近真实世界</li>
</ol>
<p>记住吕洞宾的修仙心得：<strong>"编程如修仙，对象即万物。心中有对象，代码自然成！"</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java封装：修仙界的"护体罡气"]]></title>    <link>https://juejin.cn/post/7571028035018801178</link>    <guid>https://juejin.cn/post/7571028035018801178</guid>    <pubDate>2025-11-11T06:22:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571028035018801178" data-draft-id="7571051830710108210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java封装：修仙界的&quot;护体罡气&quot;"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-11T06:22:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="会编程的吕洞宾"/> <meta itemprop="url" content="https://juejin.cn/user/2506542242333832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java封装：修仙界的"护体罡气"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2506542242333832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    会编程的吕洞宾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:22:06.000Z" title="Tue Nov 11 2025 06:22:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java封装：修仙界的"护体罡气"</h2>
<blockquote>
<p>作者：会编程的吕洞宾</p>
<p>温馨提示：封装就像给法宝加上保护罩，既保护内部结构，又提供安全的使用方式！</p>
</blockquote>
<h3 data-id="heading-1">什么是封装？编程中的"护体神功"</h3>
<p>想象一下，你炼制了一件绝世法宝"诛仙剑"。你肯定不会把它的内部构造直接暴露给别人，而是提供一个"剑诀"接口，让使用者通过特定方式来操控。</p>
<p>这就是封装：<strong>隐藏对象的内部实现细节，只提供公共的访问方式</strong>。就像给法宝加上保护罩，既安全又易用。</p>
<h3 data-id="heading-2">封装的四大访问权限：修仙界的"门规等级"</h3>
<p>Java提供了四种访问权限，就像修仙门派的不同权限等级：</p>
<h4 data-id="heading-3">1. public：门派广场 - 完全公开</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ImmortalSect</span> {
    <span class="hljs-keyword">public</span> String sectName = <span class="hljs-string">"蜀山派"</span>;  <span class="hljs-comment">// 所有人都能看到</span>
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">welcomeDisciple</span>()</span> {   <span class="hljs-comment">// 所有人都能调用</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"欢迎加入"</span> + sectName);
    }
}
</code></pre>
<h4 data-id="heading-4">2. protected：内门弟子 - 包内和子类可见</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CultivationMethod</span> {
    <span class="hljs-keyword">protected</span> String secretFormula;  <span class="hljs-comment">// 只有本包和子类能看到</span>
    
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">internalMeditation</span>()</span> {  <span class="hljs-comment">// 内部修炼方法</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"内门心法修炼中..."</span>);
    }
}
</code></pre>
<h4 data-id="heading-5">3. 默认（包访问）：本门弟子 - 同包可见</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">InternalAffairs</span> {  <span class="hljs-comment">// 默认权限，同包可见</span>
    String internalRule = <span class="hljs-string">"门规第十条"</span>;  <span class="hljs-comment">// 同包可见</span>
    
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">manageDisciples</span>()</span> {  <span class="hljs-comment">// 内部管理方法</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"管理弟子事务"</span>);
    }
}
</code></pre>
<h4 data-id="heading-6">4. private：密室传承 - 仅本类可见</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SupremeSword</span> {
    <span class="hljs-keyword">private</span> String forgingSecret = <span class="hljs-string">"玄铁百炼之法"</span>;  <span class="hljs-comment">// 只有本类能看到</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> spiritualPower = <span class="hljs-number">1000</span>;              <span class="hljs-comment">// 灵力值，内部使用</span>
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">secretForgingTechnique</span>()</span> {  <span class="hljs-comment">// 秘传锻造术</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"施展"</span> + forgingSecret);
    }
    
    <span class="hljs-comment">// 提供公共接口来使用私有功能</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">activateSword</span>()</span> {
        <span class="hljs-keyword">if</span> (spiritualPower &gt; <span class="hljs-number">0</span>) {
            secretForgingTechnique();
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"飞剑激活，灵力："</span> + spiritualPower);
        }
    }
}
</code></pre>
<h3 data-id="heading-7">封装的实战：炼制"智能法宝"</h3>
<p>让我们炼制一个封装良好的法宝类：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 一个封装良好的法宝类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MagicTreasure</span> {
    <span class="hljs-comment">// 私有属性：内部状态，外部不能直接访问</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> powerLevel;
    <span class="hljs-keyword">private</span> boolean isActivated;
    <span class="hljs-keyword">private</span> String owner;
    
    <span class="hljs-comment">// 构造方法：初始化内部状态</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MagicTreasure</span>(<span class="hljs-params">String name, <span class="hljs-built_in">int</span> powerLevel, String owner</span>)</span> {
        <span class="hljs-keyword">this</span>.name = name;
        setPowerLevel(powerLevel);  <span class="hljs-comment">// 通过setter设置，进行验证</span>
        <span class="hljs-keyword">this</span>.owner = owner;
        <span class="hljs-keyword">this</span>.isActivated = <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 公共getter方法：提供受控的读取访问</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span>()</span> {
        <span class="hljs-keyword">return</span> name;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getPowerLevel</span>()</span> {
        <span class="hljs-keyword">return</span> powerLevel;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getOwner</span>()</span> {
        <span class="hljs-keyword">return</span> owner;
    }
    
    <span class="hljs-comment">// 公共setter方法：提供受控的写入访问</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPowerLevel</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> powerLevel</span>)</span> {
        <span class="hljs-keyword">if</span> (powerLevel &gt;= <span class="hljs-number">0</span> &amp;&amp; powerLevel &lt;= <span class="hljs-number">1000</span>) {
            <span class="hljs-keyword">this</span>.powerLevel = powerLevel;
        } <span class="hljs-keyword">else</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"灵力值必须在0-1000之间"</span>);
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">changeOwner</span>(<span class="hljs-params">String newOwner</span>)</span> {
        <span class="hljs-keyword">if</span> (newOwner != <span class="hljs-literal">null</span> &amp;&amp; !newOwner.trim().isEmpty()) {
            <span class="hljs-keyword">this</span>.owner = newOwner;
            System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"的新主人："</span> + newOwner);
        }
    }
    
    <span class="hljs-comment">// 公共业务方法：封装复杂操作</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">activate</span>()</span> {
        <span class="hljs-keyword">if</span> (powerLevel &gt; <span class="hljs-number">0</span>) {
            isActivated = <span class="hljs-literal">true</span>;
            System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"已激活！当前灵力："</span> + powerLevel);
        } <span class="hljs-keyword">else</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"灵力不足，无法激活法宝"</span>);
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deactivate</span>()</span> {
        isActivated = <span class="hljs-literal">false</span>;
        System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"已休眠"</span>);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">use</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> consumedPower</span>)</span> {
        <span class="hljs-keyword">if</span> (!isActivated) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"请先激活法宝"</span>);
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">if</span> (consumedPower &lt;= powerLevel) {
            powerLevel -= consumedPower;
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"使用"</span> + name + <span class="hljs-string">"，消耗灵力"</span> + consumedPower);
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"剩余灵力："</span> + powerLevel);
        } <span class="hljs-keyword">else</span> {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"灵力不足！需要："</span> + consumedPower + <span class="hljs-string">"，当前："</span> + powerLevel);
        }
    }
    
    <span class="hljs-comment">// 私有辅助方法：内部实现细节</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">internalEnergyFlow</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"内部灵力运转中..."</span>);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">private</span> boolean <span class="hljs-title">checkSpiritualStability</span>()</span> {
        <span class="hljs-keyword">return</span> powerLevel &gt; <span class="hljs-number">100</span>;
    }
}
</code></pre>
<h3 data-id="heading-8">封装的好处：为什么需要"护体罡气"</h3>
<h4 data-id="heading-9">1. 数据保护：防止"走火入魔"</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 没有封装 - 危险！</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DangerousTreasure</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> powerLevel = <span class="hljs-number">100</span>;  <span class="hljs-comment">// 直接暴露，可能被设为负值</span>
}

<span class="hljs-comment">// 使用封装 - 安全！</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeTreasure</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> powerLevel = <span class="hljs-number">100</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setPowerLevel</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> </span>{
        <span class="hljs-keyword">if</span> (value &gt;= <span class="hljs-number">0</span>) {  <span class="hljs-comment">// 数据验证</span>
            <span class="hljs-keyword">this</span>.powerLevel = value;
        }
    }
}
</code></pre>
<h4 data-id="heading-10">2. 实现隐藏：保留"改进空间"</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartPillFurnace</span> {
    <span class="hljs-comment">// 旧版本使用数组存储</span>
    <span class="hljs-comment">// private String[] ingredients = new String[10];</span>
    
    <span class="hljs-comment">// 新版本改用List，但接口不变！</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; ingredients = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-comment">// 公共接口保持不变，内部实现可以优化</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addIngredient</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> ingredient</span>) {
        ingredients.<span class="hljs-title function_">add</span>(ingredient);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">makePill</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 内部实现可以完全重写，不影响使用者</span>
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"炼制仙丹，材料数量："</span> + ingredients.<span class="hljs-title function_">size</span>());
    }
}
</code></pre>
<h4 data-id="heading-11">3. 模块化：便于"分工合作"</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 法宝模块 - 吕洞宾负责</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MagicSword</span> {
    <span class="hljs-keyword">private</span> String bladeMaterial;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> sharpness;
    
    <span class="hljs-comment">// 只暴露必要的接口</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sharpen</span>()</span> { <span class="hljs-comment">/* 实现细节隐藏 */</span> }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">use</span>()</span> { <span class="hljs-comment">/* 使用接口 */</span> }
}

<span class="hljs-comment">// 剑诀模块 - 李白负责  </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SwordTechnique</span> {
    <span class="hljs-keyword">private</span> MagicSword sword;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SwordTechnique</span>(<span class="hljs-params">MagicSword sword</span>)</span> {
        <span class="hljs-keyword">this</span>.sword = sword;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">performTechnique</span>()</span> {
        sword.use();  <span class="hljs-comment">// 只通过公共接口交互</span>
    }
}
</code></pre>
<h3 data-id="heading-12">封装的进阶技巧：修仙界的"高级心法"</h3>
<h4 data-id="heading-13">1. 包封装：门派的"护山大阵"</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 在com.immortal.sect.internal包中</span>
package com.immortal.sect.<span class="hljs-keyword">internal</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title">InternalCultivation</span> {  <span class="hljs-comment">// 包级私有，外部无法访问</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">secretMethod</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"门派秘传心法"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PublicInterface</span> {
    <span class="hljs-keyword">private</span> InternalCultivation <span class="hljs-keyword">internal</span> = <span class="hljs-keyword">new</span> InternalCultivation();
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">publicMethod</span>()</span> {
        <span class="hljs-comment">// 内部实现隐藏，只暴露安全接口</span>
        <span class="hljs-keyword">internal</span>.secretMethod();
    }
}
</code></pre>
<h4 data-id="heading-14">2. 不变性封装：炼制"本命法宝"</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 不可变对象：一旦创建就不能修改</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmortalPill</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> name;      <span class="hljs-comment">// final确保不可变</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> potency;      <span class="hljs-comment">// final确保不可变</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Date createDate;  <span class="hljs-comment">// 引用也要注意防御性拷贝</span>
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ImmortalPill</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> potency)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.potency = potency;
        <span class="hljs-keyword">this</span>.createDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();  <span class="hljs-comment">// 防御性拷贝</span>
    }
    
    <span class="hljs-comment">// 只有getter，没有setter</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> name; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">getPotency</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> potency; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getCreateDate</span><span class="hljs-params">()</span> </span>{ 
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(createDate.<span class="hljs-built_in">getTime</span>());  <span class="hljs-comment">// 返回拷贝，保护原始数据</span>
    }
}
</code></pre>
<h4 data-id="heading-15">3. Builder模式：复杂的"法宝炼制流程"</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 使用Builder模式封装复杂构造过程</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SupremeMagicItem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> power;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> element;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> isBindable;
    
    <span class="hljs-comment">// 私有构造器，强制使用Builder</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SupremeMagicItem</span><span class="hljs-params">(Builder builder)</span> </span>{
        <span class="hljs-keyword">this</span>.name = builder.name;
        <span class="hljs-keyword">this</span>.power = builder.power;
        <span class="hljs-keyword">this</span>.element = builder.element;
        <span class="hljs-keyword">this</span>.isBindable = builder.isBindable;
    }
    
    <span class="hljs-comment">// Builder内部类</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> name;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> power;
        <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> element = <span class="hljs-string">"无"</span>;
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> isBindable = <span class="hljs-literal">false</span>;
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Builder</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> power)</span> </span>{
            <span class="hljs-keyword">this</span>.name = name;
            <span class="hljs-keyword">this</span>.power = power;
        }
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">element</span><span class="hljs-params">(<span class="hljs-type">String</span> element)</span> </span>{
            <span class="hljs-keyword">this</span>.element = element;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> Builder <span class="hljs-title">bindable</span><span class="hljs-params">(<span class="hljs-type">boolean</span> bindable)</span> </span>{
            <span class="hljs-keyword">this</span>.isBindable = bindable;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        
        <span class="hljs-function"><span class="hljs-keyword">public</span> SupremeMagicItem <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">SupremeMagicItem</span>(<span class="hljs-keyword">this</span>);
        }
    }
    
    <span class="hljs-comment">// 使用示例</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        SupremeMagicItem item = <span class="hljs-keyword">new</span> SupremeMagicItem.<span class="hljs-built_in">Builder</span>(<span class="hljs-string">"轩辕剑"</span>, <span class="hljs-number">999</span>)
            .<span class="hljs-built_in">element</span>(<span class="hljs-string">"金"</span>)
            .<span class="hljs-built_in">bindable</span>(<span class="hljs-literal">true</span>)
            .<span class="hljs-built_in">build</span>();
    }
}
</code></pre>
<h3 data-id="heading-16">实战：完整的封装修仙系统</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 完整的封装示例：修仙账户系统</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmortalAccount</span> {
    <span class="hljs-comment">// 私有属性：核心数据</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> username;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> password;  <span class="hljs-comment">// 加密存储</span>
    <span class="hljs-keyword">private</span> int cultivationLevel;
    <span class="hljs-keyword">private</span> double spiritualEnergy;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; treasures;
    
    <span class="hljs-comment">// 构造方法封装初始化逻辑</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ImmortalAccount</span>(<span class="hljs-title class_">String</span> username, <span class="hljs-title class_">String</span> password) {
        <span class="hljs-title function_">setUsername</span>(username);
        <span class="hljs-title function_">setPassword</span>(password);  <span class="hljs-comment">// 密码加密</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cultivationLevel</span> = <span class="hljs-number">1</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">spiritualEnergy</span> = <span class="hljs-number">100.0</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">treasures</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    }
    
    <span class="hljs-comment">// 受控的setter方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setUsername</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> username</span>) {
        <span class="hljs-keyword">if</span> (username != <span class="hljs-literal">null</span> &amp;&amp; username.<span class="hljs-title function_">length</span>() &gt;= <span class="hljs-number">3</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">username</span> = username;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"用户名至少3个字符"</span>);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setPassword</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> password</span>) {
        <span class="hljs-comment">// 密码加密逻辑</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">password</span> = <span class="hljs-title function_">encryptPassword</span>(password);
    }
    
    <span class="hljs-comment">// 业务方法封装复杂逻辑</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">login</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> inputPassword</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">encryptPassword</span>(inputPassword).<span class="hljs-title function_">equals</span>(password);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">cultivate</span>(<span class="hljs-params">int hours</span>) {
        <span class="hljs-keyword">if</span> (hours &gt; <span class="hljs-number">0</span>) {
            double energyGain = hours * <span class="hljs-number">10.0</span>;
            spiritualEnergy += energyGain;
            cultivationLevel += hours / <span class="hljs-number">100</span>;  <span class="hljs-comment">// 每修炼100小时升1级</span>
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"修炼"</span> + hours + <span class="hljs-string">"小时，获得灵力："</span> + energyGain);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addTreasure</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> treasure</span>) {
        <span class="hljs-keyword">if</span> (treasure != <span class="hljs-literal">null</span> &amp;&amp; !treasures.<span class="hljs-title function_">contains</span>(treasure)) {
            treasures.<span class="hljs-title function_">add</span>(treasure);
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"获得法宝："</span> + treasure);
        }
    }
    
    <span class="hljs-comment">// 私有辅助方法</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">encryptPassword</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> password</span>) {
        <span class="hljs-comment">// 简单的加密演示</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"encrypted_"</span> + password;
    }
    
    <span class="hljs-comment">// 只读的getter方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUsername</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> username; }
    <span class="hljs-keyword">public</span> int <span class="hljs-title function_">getCultivationLevel</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> cultivationLevel; }
    <span class="hljs-keyword">public</span> double <span class="hljs-title function_">getSpiritualEnergy</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> spiritualEnergy; }
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">getTreasures</span>(<span class="hljs-params"/>) { 
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(treasures);  <span class="hljs-comment">// 返回拷贝，保护原始数据</span>
    }
}
</code></pre>
<h3 data-id="heading-17">吕洞宾的封装心法</h3>
<p>记住这几条修仙要诀：</p>
<ol>
<li><strong>"最小权限"</strong>：给每个成员最小必要的访问权限</li>
<li><strong>"数据隐藏"</strong>：私有属性，公共接口</li>
<li><strong>"防御性编程"</strong>：对外部输入保持警惕</li>
<li><strong>"接口稳定"</strong>：内部可以随便改，接口要保持稳定</li>
</ol>
<p>封装就像修仙者的"护体罡气"，保护内部脆弱的核心，同时提供强大的外部接口。掌握了封装，你的代码就能像修炼有成的仙人一样，外御强敌，内守本心！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从回调地狱到优雅异步：Promise 带你吃透 JS 异步编程核心]]></title>    <link>https://juejin.cn/post/7571086754880110638</link>    <guid>https://juejin.cn/post/7571086754880110638</guid>    <pubDate>2025-11-11T06:20:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754880110638" data-draft-id="7571086754880045102" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从回调地狱到优雅异步：Promise 带你吃透 JS 异步编程核心"/> <meta itemprop="keywords" content="Vue.js,Promise"/> <meta itemprop="datePublished" content="2025-11-11T06:20:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="生椰丝绒拿铁"/> <meta itemprop="url" content="https://juejin.cn/user/4185180725584116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从回调地狱到优雅异步：Promise 带你吃透 JS 异步编程核心
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185180725584116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    生椰丝绒拿铁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:20:53.000Z" title="Tue Nov 11 2025 06:20:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为前端开发者，你是否也曾被这样的场景折磨？想按顺序执行三个异步操作，最后写出层层嵌套的回调函数，代码像金字塔一样越堆越高，调试时找不着北。或者明明写了 <code>setTimeout</code> 想等上一步完成，结果代码却 “自作主张” 提前执行。</p>
<p>这一切的根源，都要从 JavaScript 的 “单线程” 特性说起。今天我们就从底层逻辑出发，用通俗的例子 + 实战代码，带你彻底搞懂 Promise—— 这个让异步代码变优雅的 “神器”。</p>
<h2 data-id="heading-0">先搞懂：JS 为什么需要异步？</h2>
<p>要理解 Promise，首先得明白 JS 的 “单线程困境”。</p>
<h3 data-id="heading-1">1. 单线程：JS 的 “天生设定”</h3>
<p>JavaScript 从诞生起就是单线程，意思是它只有一个 “代码执行线程”，同一时间只能做一件事。这个设定很合理：JS 主要负责操作 DOM，如果多线程同时修改 DOM，浏览器根本不知道该听谁的。</p>
<p>但问题也随之而来：如果遇到耗时操作（比如读取文件、网络请求、定时器），线程会被卡住。想象一下，点击按钮后发起网络请求，等待响应的 3 秒内页面完全无法交互，这体验简直灾难。</p>
<h3 data-id="heading-2">2. 同步 vs 异步：代码的 “两种执行姿势”</h3>
<p>为了解决这个问题，JS 设计了两种代码执行模式：</p>
<ul>
<li><strong>同步代码</strong>：按顺序从上到下执行，执行完一行再走下一行，比如 <code>console.log</code>、变量声明、for 循环，都是毫秒级完成的 “快任务”。</li>
<li><strong>异步代码</strong>：需要耗时的操作（比如网络请求、文件读取、<code>setTimeout</code>），JS 不会傻傻等待，而是先把它 “挂起来”，继续执行后面的同步代码，等耗时操作完成后再回头执行。</li>
</ul>
<h3 data-id="heading-3">3. 事件循环（Event Loop）：异步代码的 “调度中心”</h3>
<p>那被 “挂起来” 的异步代码怎么知道什么时候执行？答案是 <strong>事件循环</strong>。</p>
<p>简单说，JS 执行时会先处理同步代码，把异步任务放到 “任务队列” 里。等同步代码执行完，线程会不断循环检查任务队列，把里面完成的任务捞出来执行。这就是为什么 <code>setTimeout</code> 里的代码，永远会在所有同步代码之后执行。</p>
<p>看这个经典例子：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
}, <span class="hljs-number">3000</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
</code></pre>
<p>执行结果是 <code>1 → 3 → 2</code>，而不是 <code>1 → 2 → 3</code>。因为 <code>setTimeout</code> 是异步任务，被扔进了任务队列，要等同步代码 <code>console.log(1)</code> 和 <code>console.log(3)</code> 执行完，3 秒后才会被执行。</p>
<h2 data-id="heading-4">回调地狱：异步编程的 “史前困境”</h2>
<p>早期处理异步任务，全靠回调函数。比如要按顺序执行 “读取文件 A → 读取文件 B → 读取文件 C”，代码会变成这样：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript">fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./a.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data1</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
  fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./b.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data2</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
    fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./c.txt'</span>, <span class="hljs-function">(<span class="hljs-params">err, data3</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data1 + data2 + data3);
    });
  });
});
</code></pre>
<p>这种层层嵌套的代码被称为 “回调地狱”，问题很明显：</p>
<ul>
<li>代码可读性差，嵌套越多越像 “金字塔”，调试时要一层层找。</li>
<li>维护困难，修改内层逻辑可能影响外层，容易出错。</li>
<li>错误处理麻烦，每个回调都要写 <code>if (err)</code> 判断。</li>
</ul>
<p>这时候，Promise 应运而生，它的核心目标就是：<strong>让异步代码的执行顺序变得清晰，摆脱回调地狱</strong>。</p>
<h2 data-id="heading-5">Promise：异步编程的 “优雅解决方案”</h2>
<p>Promise 是 ES6 引入的异步编程工具类，本质是一个 “容器”，里面存放着一个未来才会完成的异步操作（比如网络请求、文件读取）。</p>
<h3 data-id="heading-6">1. Promise 的核心概念：三个状态</h3>
<p>一个 Promise 有三种状态，状态一旦改变就不可逆：</p>
<ul>
<li><strong>Pending（等待中）</strong> ：初始状态，异步任务还没完成。</li>
<li><strong>Fulfilled（已成功）</strong> ：异步任务执行完成，调用 <code>resolve()</code> 触发。</li>
<li><strong>Rejected（已失败）</strong> ：异步任务执行出错，调用 <code>reject()</code> 触发。</li>
</ul>
<h3 data-id="heading-7">2. 基本用法：把异步任务 “装进” Promise</h3>
<p>我们用 Promise 重构上面的文件读取例子：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;

<span class="hljs-comment">// 创建 Promise 实例，传入执行器函数（立即执行）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">readFilePromise</span> = (<span class="hljs-params">filename</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    fs.<span class="hljs-title function_">readFile</span>(filename, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-title function_">reject</span>(err); <span class="hljs-comment">// 失败时调用 reject，传递错误信息</span>
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-title function_">resolve</span>(data.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 成功时调用 resolve，传递结果</span>
    });
  });
};

<span class="hljs-comment">// 用 then 链式调用，按顺序执行</span>
<span class="hljs-title function_">readFilePromise</span>(<span class="hljs-string">'./a.txt'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data1</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'a.txt 内容：'</span>, data1);
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">readFilePromise</span>(<span class="hljs-string">'./b.txt'</span>); <span class="hljs-comment">// 返回下一个 Promise</span>
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data2</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'b.txt 内容：'</span>, data2);
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">readFilePromise</span>(<span class="hljs-string">'./c.txt'</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data3</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'c.txt 内容：'</span>, data3);
  })
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'读取失败：'</span>, err); <span class="hljs-comment">// 所有错误统一处理</span>
  });
</code></pre>
<p>是不是瞬间清爽了？这里有两个关键改进：</p>
<ul>
<li>用 <code>then</code> 链式调用替代嵌套，代码从上到下执行，逻辑清晰。</li>
<li>用 <code>catch</code> 统一处理所有错误，不用每个回调都写错误判断。</li>
</ul>
<h3 data-id="heading-8">3. 实战拆解：Promise 如何改变执行顺序？</h3>
<p>再看一个浏览器端的例子，感受 Promise 如何让 “异步变同步”：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
<span class="hljs-comment">// 把定时器这个异步任务装进 Promise</span>
<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
    <span class="hljs-title function_">resolve</span>(); <span class="hljs-comment">// 异步任务完成，调用 resolve 通知 then</span>
  }, <span class="hljs-number">3000</span>);
});

p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 只有 resolve 被调用后，then 里的代码才执行</span>
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>);
</code></pre>
<p>执行结果是 <code>1 → 4 → 2 → 3</code>，这里的关键逻辑：</p>
<ol>
<li>同步代码 <code>console.log(1)</code> 先执行。</li>
<li>创建 Promise 时，执行器函数立即执行，里面的 <code>setTimeout</code> 被扔进任务队列。</li>
<li>同步代码 <code>console.log(4)</code> 执行。</li>
<li>3 秒后，<code>setTimeout</code> 执行 <code>console.log(2)</code>，然后调用 <code>resolve()</code>。</li>
<li>Promise 状态变为成功，触发 <code>then</code> 里的回调，执行 <code>console.log(3)</code>。</li>
</ol>
<p>通过 <code>resolve</code> 和 <code>then</code> 的配合，我们实现了 “等异步任务完成后再执行下一步” 的效果，这就是 Promise 让异步 “同步化” 的核心逻辑。</p>
<h3 data-id="heading-9">4. 真实场景：用 Promise 处理网络请求</h3>
<p>在实际开发中，网络请求是最常见的异步场景。比如用 <code>fetch</code> 获取 GitHub 组织成员列表：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">membersList</span> = document.getElementById(<span class="hljs-string">'memebers'</span>)<span class="hljs-comment">;</span>

// fetch 本身就返回一个 Promise
fetch('https://api.github.com/orgs/lemoncode/members')
  .then(<span class="hljs-attr">response</span> =&gt; response.json()) // 第一个 then 处理响应，返回新的 Promise
  .then(<span class="hljs-attr">members</span> =&gt; {
    // 第二个 then 处理数据，渲染到页面
    <span class="hljs-attr">membersList.innerHTML</span> = members.map(item =&gt; `&lt;li&gt;<span class="hljs-variable">${item.login}</span>&lt;/li&gt;`).join(<span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
  })
  .catch(<span class="hljs-attr">err</span> =&gt; {
    console.log('请求失败：', err)<span class="hljs-comment">;</span>
    <span class="hljs-attr">membersList.innerHTML</span> = <span class="hljs-string">'&lt;li&gt;数据加载失败&lt;/li&gt;'</span><span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
</code></pre>
<p><code>fetch</code> 发起网络请求后，返回一个 Promise。当请求成功时，<code>then</code> 接收响应并转换为 JSON；当请求失败（比如网络错误、404），<code>catch</code> 会捕获错误并给出友好提示。</p>
<h2 data-id="heading-10">Promise 的进阶思考：为什么它能成为异步编程基石？</h2>
<p>Promise 之所以重要，不只是因为它解决了回调地狱，更因为它奠定了 JS 异步编程的基础范式。</p>
<h3 data-id="heading-11">1. 分离关注点：让代码职责更清晰</h3>
<p>Promise 把 “异步任务的执行” 和 “任务完成后的处理逻辑” 分离开来：</p>
<ul>
<li>执行器函数负责发起异步任务（比如读取文件、网络请求）。</li>
<li><code>then</code> 方法负责处理成功结果，<code>catch</code> 负责处理错误。这种分离让代码结构更清晰，可读性和可维护性大大提升。</li>
</ul>
<h3 data-id="heading-12">2. 链式调用：实现复杂异步流程</h3>
<p>Promise 的 <code>then</code> 方法会返回一个新的 Promise，这让链式调用成为可能。除了按顺序执行，还能实现更复杂的流程，比如：</p>
<ul>
<li>并行执行多个异步任务（用 <code>Promise.all</code>）。</li>
<li>只要有一个任务成功就执行（用 <code>Promise.race</code>）。</li>
<li>忽略失败任务，返回所有成功结果（用 <code>Promise.allSettled</code>）。</li>
</ul>
<h3 data-id="heading-13">3. 为 async/await 铺路</h3>
<p>ES7 引入的 <code>async/await</code> 语法，本质是 Promise 的语法糖。正是因为 Promise 规范了异步任务的状态和回调方式，<code>async/await</code> 才能实现 “用同步代码的写法写异步逻辑”。</p>
<p>比如用 <code>async/await</code> 重构网络请求代码：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">async function getMembers() {
  try {
    const <span class="hljs-attr">response</span> = await fetch(<span class="hljs-string">'https://api.github.com/orgs/lemoncode/members'</span>)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">members</span> = await response.json()<span class="hljs-comment">;</span>
    <span class="hljs-attr">membersList.innerHTML</span> = members.map(item =&gt; `&lt;li&gt;<span class="hljs-variable">${item.login}</span>&lt;/li&gt;`).join(<span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
  } catch (err) {
    console.log('请求失败：', err)<span class="hljs-comment">;</span>
    <span class="hljs-attr">membersList.innerHTML</span> = <span class="hljs-string">'&lt;li&gt;数据加载失败&lt;/li&gt;'</span><span class="hljs-comment">;</span>
  }
}
</code></pre>
<p>如果没有 Promise 作为基础，<code>async/await</code> 就无从谈起。</p>
<h2 data-id="heading-14">常见误区：避开 Promise 的 “坑”</h2>
<p>学习 Promise 时，很容易陷入一些误区，这里总结几个高频坑：</p>
<ul>
<li><strong>误区 1</strong>：认为 <code>new Promise</code> 里的代码是异步的。其实执行器函数是立即同步执行的，里面的异步任务（比如 <code>setTimeout</code>）才是异步的。</li>
<li><strong>误区 2</strong>：忘记调用 <code>resolve</code> 或 <code>reject</code>，导致 <code>then</code> 或 <code>catch</code> 永远不执行。</li>
<li><strong>误区 3</strong>：链式调用时没有返回 Promise，导致后续 <code>then</code> 无法获取上一步的结果。</li>
<li><strong>误区 4</strong>：忽略错误处理，没有写 <code>catch</code>，导致异步任务失败时没有反馈。</li>
</ul>
<h2 data-id="heading-15">总结：Promise 带给我们的不止是优雅</h2>
<p>Promise 不仅仅是一个语法糖，它是 JS 异步编程的一次范式升级。它解决了回调地狱的痛点，让异步代码的逻辑更清晰、更易维护，同时为后续的 <code>async/await</code> 打下了基础。</p>
<p>理解 Promise 的核心，其实是理解 JS 单线程、事件循环的底层逻辑。掌握了这些，无论遇到多么复杂的异步场景，你都能游刃有余地处理。</p>
<p>如果你正在学习异步编程，建议多动手写实战代码：用 Promise 封装一个网络请求、用链式调用处理多个异步任务、尝试 <code>Promise.all</code> 等静态方法。只有实践，才能真正吃透这些概念。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《效率翻倍！12个被90%前端忽视的CSS神技》]]></title>    <link>https://juejin.cn/post/7571176484514578447</link>    <guid>https://juejin.cn/post/7571176484514578447</guid>    <pubDate>2025-11-11T06:27:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484514578447" data-draft-id="7571021605318705204" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《效率翻倍！12个被90%前端忽视的CSS神技》"/> <meta itemprop="keywords" content="CSS,前端,面试"/> <meta itemprop="datePublished" content="2025-11-11T06:27:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大知闲闲i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《效率翻倍！12个被90%前端忽视的CSS神技》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大知闲闲i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:27:03.000Z" title="Tue Nov 11 2025 06:27:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>告别重复劳动，让代码既优雅又高效</p>
</blockquote>
<p>在日常前端开发中，我们往往只使用了CSS的冰山一角。经过多个项目实践，我发现现代CSS隐藏着许多实用但被忽视的特性，掌握它们真的能让你少写50%的代码！</p>
<p>下面这12个神技，特别是第3个和第7个，彻底改变了我的开发方式。一起来看看：</p>
<h2 data-id="heading-0">1. accent-color - 表单主题色一键搞定</h2>
<p><strong>痛点</strong>：以前统一表单样式要写一堆选择器覆盖默认样式</p>
<p><strong>神技效果</strong>：一行代码统一所有表单控件主题色</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 传统写法 - 繁琐且兼容性差 */</span>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"checkbox"</span>]</span>::-ms-check,
input[type=<span class="hljs-string">"radio"</span>]::-ms-check {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}

<span class="hljs-comment">/* 现代写法 - 一行搞定 */</span>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"checkbox"</span>]</span>,
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"radio"</span>]</span>,
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"range"</span>]</span>,
progress {
  accent-<span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}
</code></pre>
<p><strong>优势</strong>：保持系统原生交互体验，视觉风格完美统一</p>
<h2 data-id="heading-1"> 2. caret-color - 输入光标的个性化定制</h2>
<p><strong>应用场景</strong>：深色模式、品牌色定制</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.dark-input</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#2d3748</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">caret-color</span>: <span class="hljs-number">#63b3ed</span>; <span class="hljs-comment">/* 再也不怕黑色光标突兀了 */</span>
}

<span class="hljs-selector-class">.brand-input</span> {
  <span class="hljs-attribute">caret-color</span>: <span class="hljs-number">#e53e3e</span>; <span class="hljs-comment">/* 品牌色光标 */</span>
}
</code></pre>
<h2 data-id="heading-2"> 3. currentColor - 智能颜色继承系统</h2>
<p><strong>这个真的绝了！</strong> 让颜色管理变得无比简单</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.icon-button</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#e53e3e</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid currentColor; <span class="hljs-comment">/* 边框自动继承 */</span>
  <span class="hljs-attribute">background</span>: none;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> currentColor; <span class="hljs-comment">/* 阴影也同步 */</span>
}

<span class="hljs-selector-class">.icon-button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#c53030</span>; <span class="hljs-comment">/* 只需改一个颜色，其他自动同步 */</span>
}

<span class="hljs-comment">/* 高级用法 - 渐变边框 */</span>
<span class="hljs-selector-class">.gradient-border</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid currentColor;
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.gradient-border</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  inset: -<span class="hljs-number">2px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, currentColor, transparent);
  <span class="hljs-attribute">z-index</span>: -<span class="hljs-number">1</span>;
}
</code></pre>
<h2 data-id="heading-3"> 4. ::marker - 列表标记的终极解决方案</h2>
<p><strong>告别</strong>：繁琐的<code>::before</code>伪元素模拟</p>
<p>css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 自定义图标列表 */</span>
<span class="hljs-selector-class">.custom-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::marker</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"➤"</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#38a169</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2em</span>;
}

<span class="hljs-comment">/* 个性化编号 */</span>
<span class="hljs-selector-class">.numbered-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::marker</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-built_in">counter</span>(list-item) <span class="hljs-string">". "</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}

<span class="hljs-comment">/* 渐变数字效果 */</span>
<span class="hljs-selector-class">.gradient-marker</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::marker</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"0"</span> <span class="hljs-built_in">counter</span>(list-item);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#4a90e2</span>, <span class="hljs-number">#38a169</span>);
  -webkit-<span class="hljs-attribute">background-clip</span>: text;
  -webkit-text-fill-<span class="hljs-attribute">color</span>: transparent;
}
</code></pre>
<h2 data-id="heading-4"> 5. 智能表单验证 - 交互体验大升级</h2>
<p><strong>传统问题</strong>：<code>:invalid</code>太激进，用户一开始输入就报错</p>
<p><strong>现代方案</strong>：<code>:user-valid</code>和<code>:user-invalid</code>更人性化</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.form-input</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#e2e8f0</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 用户交互后才显示验证状态 */</span>
<span class="hljs-selector-class">.form-input</span>:user-valid {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#48bb78</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0fff4</span>;
}

<span class="hljs-selector-class">.form-input</span><span class="hljs-selector-pseudo">:user-invalid</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#f56565</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff5f5</span>;
}

<span class="hljs-comment">/* 聚焦时的微交互 */</span>
<span class="hljs-selector-class">.form-input</span><span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">74</span>, <span class="hljs-number">144</span>, <span class="hljs-number">226</span>, <span class="hljs-number">0.2</span>);
}
</code></pre>
<h2 data-id="heading-5"> 6. :placeholder-shown - 空状态检测神器</h2>
<p><strong>应用场景</strong>：动态搜索框、智能表单提示</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.search-box</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 空状态样式 */</span>
<span class="hljs-selector-class">.search-box</span><span class="hljs-selector-pseudo">:placeholder-shown</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f7fafc</span>;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#cbd5e0</span>;
}

<span class="hljs-comment">/* 有内容时的样式 */</span>
<span class="hljs-selector-class">.search-box</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-pseudo">:placeholder-shown</span>) {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#4a90e2</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">74</span>, <span class="hljs-number">144</span>, <span class="hljs-number">226</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 智能提示系统 */</span>
<span class="hljs-selector-class">.search-container</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-class">.search-box</span><span class="hljs-selector-pseudo">:placeholder-shown</span>) <span class="hljs-selector-class">.search-hints</span> {
  <span class="hljs-attribute">display</span>: block;
}

<span class="hljs-selector-class">.search-container</span><span class="hljs-selector-pseudo">:has</span>(<span class="hljs-selector-class">.search-box</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-pseudo">:placeholder-shown</span>)) <span class="hljs-selector-class">.search-results</span> {
  <span class="hljs-attribute">display</span>: block;
}
</code></pre>
<h2 data-id="heading-6"> 7. all: unset - 样式彻底重置大法</h2>
<p><strong>使用场景</strong>：组件开发、样式隔离、设计系统</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 自定义按钮组件 */</span>
<span class="hljs-selector-class">.custom-button</span> {
  <span class="hljs-attribute">all</span>: unset; <span class="hljs-comment">/* 彻底清除默认样式 */</span>
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#4a90e2</span>, <span class="hljs-number">#38a169</span>);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.custom-button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">25px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">74</span>, <span class="hljs-number">144</span>, <span class="hljs-number">226</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-comment">/* 重置链接样式 */</span>
<span class="hljs-selector-class">.reset-link</span> {
  <span class="hljs-attribute">all</span>: unset;
  <span class="hljs-attribute">color</span>: inherit;
  <span class="hljs-attribute">text-decoration</span>: none;
  <span class="hljs-attribute">cursor</span>: pointer;
}
</code></pre>
<h2 data-id="heading-7"> inset - 定位布局的终极简化</h2>
<p><strong>告别</strong>：<code>top: 0; right: 0; bottom: 0; left: 0;</code>的繁琐写法</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 全屏覆盖层 */</span>
<span class="hljs-selector-class">.overlay</span> {
  <span class="hljs-attribute">position</span>: fixed;
  inset: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 一行替代四行 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
  backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">5px</span>);
}

<span class="hljs-comment">/* 弹窗定位 */</span>
<span class="hljs-selector-class">.modal</span> {
  <span class="hljs-attribute">position</span>: absolute;
  inset: <span class="hljs-number">20px</span> <span class="hljs-number">40px</span>; <span class="hljs-comment">/* 上下20px，左右40px */</span>
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-comment">/* 高级用法 - 安全区域适配 */</span>
<span class="hljs-selector-class">.safe-area</span> {
  <span class="hljs-attribute">position</span>: fixed;
  inset: <span class="hljs-built_in">env</span>(safe-area-inset-top) 
        <span class="hljs-built_in">env</span>(safe-area-inset-right) 
        <span class="hljs-built_in">env</span>(safe-area-inset-bottom) 
        <span class="hljs-built_in">env</span>(safe-area-inset-left);
}
</code></pre>
<h2 data-id="heading-8"> 9. text-wrap: balance - 文本排版的美学革命</h2>
<p><strong>让标题排版从此优雅起来</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">.card-title {
  text-wrap: balance;
  max-width: <span class="hljs-number">65</span>ch;
  font-size: <span class="hljs-number">1.5</span>rem;
  line-height: <span class="hljs-number">1.4</span>;
}

<span class="hljs-comment">/* 不同场景的文本换行策略 */</span>
.hero-title {
  text-wrap: balance; <span class="hljs-comment">/* 短文本平衡 */</span>
}

.<span class="hljs-type">long</span>-content {
  text-wrap: pretty; <span class="hljs-comment">/* 长段落优化 */</span>
}

.<span class="hljs-keyword">auto</span>-content {
  text-wrap: pretty; <span class="hljs-comment">/* 自动选择最佳换行 */</span>
}

<span class="hljs-comment">/* 结合容器查询 */</span>
@<span class="hljs-built_in">container</span> (min-width: <span class="hljs-number">400</span>px) {
  .responsive-title {
    text-wrap: balance;
  }
}
</code></pre>
<h2 data-id="heading-9"> 10. :is() - 选择器编写的效率利器</h2>
<p><strong>减少重复代码，提升可读性</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 传统写法 - 重复冗长 */</span>
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h1</span>,
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h2</span>, 
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h3</span>,
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h4</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5em</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2d3748</span>;
}

<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h1</span><span class="hljs-selector-pseudo">:hover</span>,
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h2</span><span class="hljs-selector-pseudo">:hover</span>,
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h3</span><span class="hljs-selector-pseudo">:hover</span>, 
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">h4</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}

<span class="hljs-comment">/* 现代写法 - 简洁优雅 */</span>
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span>, <span class="hljs-selector-tag">h4</span>) {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5em</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2d3748</span>;
}

<span class="hljs-selector-class">.card</span> <span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span>, <span class="hljs-selector-tag">h4</span>)<span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4a90e2</span>;
}

<span class="hljs-comment">/* 复杂场景应用 */</span>
<span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-class">.dark-theme</span>, <span class="hljs-selector-class">.high-contrast</span>) <span class="hljs-selector-pseudo">:is</span>(<span class="hljs-selector-tag">button</span>, <span class="hljs-selector-tag">a</span>) {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border-color</span>: currentColor;
}
</code></pre>
<h2 data-id="heading-10">11. aspect-ratio - 宽高比控制的终极方案</h2>
<p><strong>告别</strong>：padding-top hack实现宽高比</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 视频容器 - 始终保持16:9 */</span>
<span class="hljs-selector-class">.video-wrapper</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  aspect-ratio: <span class="hljs-number">16</span> / <span class="hljs-number">9</span>;
  <span class="hljs-attribute">background</span>: black;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-comment">/* 正方形头像 */</span>
<span class="hljs-selector-class">.avatar</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
  aspect-ratio: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">object-fit</span>: cover;
}

<span class="hljs-comment">/* 动态比例网格 */</span>
<span class="hljs-selector-class">.responsive-grid</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">1rem</span>;
}

<span class="hljs-selector-class">.grid-item</span> {
  aspect-ratio: <span class="hljs-number">4</span> / <span class="hljs-number">3</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-comment">/* 高级用法 - 可变比例 */</span>
<span class="hljs-selector-class">.adaptive-card</span> {
  aspect-ratio: <span class="hljs-number">3</span> / <span class="hljs-number">4</span>;
}

<span class="hljs-keyword">@container</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.adaptive-card</span> {
    aspect-ratio: <span class="hljs-number">16</span> / <span class="hljs-number">9</span>;
  }
}
</code></pre>
<h2 data-id="heading-11"> 12. scroll-snap-type - 滚动体验的完美升级</h2>
<p><strong>创建应用级的滚动体验</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.image-gallery</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">overflow-x</span>: auto;
  <span class="hljs-attribute">scroll-snap-type</span>: x mandatory;
  scroll-behavior: smooth;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f7fafc</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.image-gallery</span> <span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">scroll-snap-align</span>: start;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">object-fit</span>: cover;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.image-gallery</span> <span class="hljs-selector-tag">img</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>);
}

<span class="hljs-comment">/* 垂直滚动定位 */</span>
<span class="hljs-selector-class">.vertical-list</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
  <span class="hljs-attribute">scroll-snap-type</span>: y proximity;
}

<span class="hljs-selector-class">.vertical-list</span> <span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">scroll-snap-align</span>: start;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e2e8f0</span>;
}
</code></pre>
<h2 data-id="heading-12"> 实战建议与兼容性处理</h2>
<h3 data-id="heading-13">渐进增强策略</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/* 特性检测保障 */</span>
<span class="hljs-keyword">@supports</span> (<span class="hljs-attribute">aspect-ratio</span>: <span class="hljs-number">1</span>) {
  <span class="hljs-selector-class">.modern-card</span> {
    aspect-ratio: 3 / 4;
  }
}

<span class="hljs-keyword">@supports</span> <span class="hljs-keyword">not</span> (<span class="hljs-attribute">aspect-ratio</span>: <span class="hljs-number">1</span>) {
  <span class="hljs-selector-class">.modern-card</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>; <span class="hljs-comment">/* 优雅降级 */</span>
  }
}

<span class="hljs-keyword">@supports</span> (<span class="hljs-built_in">selector</span>(:<span class="hljs-built_in">is</span>(h1))) {
  <span class="hljs-selector-class">.modern-selector</span> {
    <span class="hljs-comment">/* 使用现代选择器 */</span>
  }
}

<span class="hljs-keyword">@supports</span> <span class="hljs-keyword">not</span> (<span class="hljs-built_in">selector</span>(:<span class="hljs-built_in">is</span>(h1))) {
  <span class="hljs-selector-class">.fallback-selector</span> {
    <span class="hljs-comment">/* 传统写法回退 */</span>
  }
}
</code></pre>
<h3 data-id="heading-14">团队协作规范</h3>
<p>css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 在团队中建立使用规范 */</span>

<span class="hljs-comment">/* 1. 表单主题色统一管理 */</span>
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--accent-color</span>: <span class="hljs-number">#4a90e2</span>;
  <span class="hljs-attr">--caret-color</span>: <span class="hljs-number">#63b3ed</span>;
}

<span class="hljs-comment">/* 2. 现代特性使用标记 */</span>
<span class="hljs-selector-class">.modern-feature</span> {
  <span class="hljs-comment">/*! modern: aspect-ratio */</span>
  aspect-ratio: <span class="hljs-number">16</span> / <span class="hljs-number">9</span>;
  
  <span class="hljs-comment">/*! fallback: padding-top 56.25% */</span>
  <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">56.25%</span>;
}
</code></pre>
<h2 data-id="heading-15"> 总结</h2>
<p>这些CSS特性在现代浏览器中已经得到了很好的支持，掌握它们能够：</p>
<ul>
<li>
<p>✅ <strong>减少50%+的代码量</strong></p>
</li>
<li>
<p>✅ <strong>提升开发效率</strong></p>
</li>
<li>
<p>✅ <strong>改善用户体验</strong></p>
</li>
<li>
<p>✅ <strong>代码更易维护</strong></p>
</li>
<li>
<p>✅ <strong>界面更加精致</strong></p>
</li>
</ul>
<p>建议在实际项目中逐步尝试，你会发现前端开发原来可以如此优雅高效！</p>
<p><strong>现在就动手试试吧，相信你会回来感谢我的！</strong> 🚀</p>
<p>附：主要特性支持情况</p>
<ul>
<li>
<p>✅ Chrome 88+ 全面支持</p>
</li>
<li>
<p>✅ Firefox 78+ 良好支持</p>
</li>
<li>
<p>✅ Safari 14+ 基本支持</p>
</li>
<li>
<p>Edge 88+ 完全支持</p>
</li>
</ul>
<p>希望这些技巧能为你打开CSS新世界的大门！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙开发：this的指向问题]]></title>    <link>https://juejin.cn/post/7570995368739504170</link>    <guid>https://juejin.cn/post/7570995368739504170</guid>    <pubDate>2025-11-11T06:29:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570995368739504170" data-draft-id="7571005216910704659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙开发：this的指向问题"/> <meta itemprop="keywords" content="HarmonyOS,Android,iOS"/> <meta itemprop="datePublished" content="2025-11-11T06:29:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员一鸣"/> <meta itemprop="url" content="https://juejin.cn/user/1398234520239095"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙开发：this的指向问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234520239095/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员一鸣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:29:08.000Z" title="Tue Nov 11 2025 06:29:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>“你开发的组件，明明我数据改变了，为什么却没有变化？”</p>
<p>“不对吧，你这个封装的不行，我在@Builder函数中获取外部的属性，总是为undefined？”</p>
<p>可以说，以上的反馈，无论是在工作之中，还是在外部的开源中，遇到了无数次，我的回答就一句话，<strong>那是你的this指向不对。</strong></p>
<p>this，浅显易懂，就是指的自己，用于类中访问属性和方法，举一个很常见的一个案例，也是最简单的，通常我们给组件设置数据时，经常会用到this，如下所示，this就是指的当前组件Index。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"标题"</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>)
    }
  }
}
</code></pre>
<p>如果是正常的组件引用，一般this不会出现大的问题，但是在自定义组件，用到了@BuilderParam装饰器，在需要外部传递@Builder函数的时候，问题就暴露出来了，我们还是来一个案例。</p>
<p>首先自定义一个组件，如下所示，接收一个外部传递组件layout。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">export</span> struct <span class="hljs-title class_">Child</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"我是Child"</span>
  <span class="hljs-meta">@BuilderParam</span> <span class="hljs-attr">layout</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">layout</span>()
  }
}
</code></pre>
<p>我们把上述的自定义组件Child引用一下，然后自定义一个@Builder函数。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
 <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"我是Index"</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Child</span>({
      <span class="hljs-attr">layout</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">TextView</span>
    })
  }

  <span class="hljs-meta">@Builder</span>
  <span class="hljs-title class_">TextView</span>() {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>)
    }
  }
}
</code></pre>
<p>那么以上的案例，在运行之后，Text组件会显示 <strong>“我是Index”</strong> 还是 <strong>“我是</strong>Child <strong>”</strong> 呢？</p>
<p>答案是 <strong>“我是Child”。</strong></p>
<hr/>
<p>很多同学也会很懵，明明我在Index里调用的this，为什么不是显示Index里的 <strong>"我是Index"</strong> 数据呢？，哎，这就是this指向问题，也是很多同学在@Builder函数中一直困惑的问题。</p>
<h2 data-id="heading-1">this指向分析</h2>
<p>以上的案例中，我们在使用自定义组件的时候，是直接通过this传递的，此时的this指向的是自定义组件Child，所以，在@Builder装饰器函数中，this获取的是自定义组件Child里的数据，如果自定义组件中未有定义，那么就为undefined，这也是前言中很多同学的反馈。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-title class_">Child</span>({
      <span class="hljs-attr">layout</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">TextView</span>
    })
</code></pre>
<p>那么如何把this指向，修改宿主对象呢？也就是调用自定义组件的Index组件呢？很简单，只需要，修改为箭头函数即可。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-title class_">Child</span>({
      <span class="hljs-attr">layout</span>: <span class="hljs-function">()=&gt;</span>{
        <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">TextView</span>()
      }
    })
</code></pre>
<p>以上的案例，this指向的就是宿主对象，这样就解决了数据为什么为undefined，数据为什么无法更新的问题。</p>
<h2 data-id="heading-2">相关总结</h2>
<p>所以，在以后遇到@Builder函数的时候，如果你要用到外部宿主的this，书写方式为箭头函数()=&gt;{}，在大括号里引用你定义的@Builder函数，切记，箭头函数的this才是指向的是宿主对象，否则指向的是自定义组件。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">()=&gt;{
  <span class="hljs-comment">//你定义的@Builder函数</span>
}
</code></pre>
<p>所以啊，老铁们，你们在使用别人自定义的组件时，一定要注意到这个this指向问题，并不是别人封装的不对，而是我们使用的方式不对。</p>
<p>希望这个this，能打开你的新世界大门！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 渲染器源码实现]]></title>    <link>https://juejin.cn/post/7571060853371306034</link>    <guid>https://juejin.cn/post/7571060853371306034</guid>    <pubDate>2025-11-11T06:28:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571060853371306034" data-draft-id="7571051830710190130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 渲染器源码实现"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-11T06:28:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mrk"/> <meta itemprop="url" content="https://juejin.cn/user/2752832847754711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 渲染器源码实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2752832847754711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mrk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:28:04.000Z" title="Tue Nov 11 2025 06:28:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 渲染器源码实现详解：从虚拟DOM到Diff算法的完整实现</h2>
<h3 data-id="heading-1">引言</h3>
<p>Vue3 的渲染器是其性能提升的关键所在，它负责将虚拟DOM转换为真实DOM，并高效处理更新。本文将深入分析一个完整的 Vue3 渲染器实现，详细注释关键代码，帮助理解其核心原理。</p>
<h3 data-id="heading-2">1. 虚拟DOM (vnode) 系统</h3>
<p>虚拟DOM是Vue渲染系统的核心，它是对真实DOM的轻量级JavaScript对象表示。</p>
<p>javascript</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 虚拟 DOM 节点类型枚举
 * 定义了不同类型的虚拟节点，每种类型对应不同的处理方式
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VNODE_TYPES</span> = {
  <span class="hljs-attr">ELEMENT</span>: <span class="hljs-number">1</span>,     <span class="hljs-comment">// 普通HTML元素节点</span>
  <span class="hljs-attr">TEXT</span>: <span class="hljs-number">2</span>,        <span class="hljs-comment">// 文本节点  </span>
  <span class="hljs-attr">COMPONENT</span>: <span class="hljs-number">3</span>,   <span class="hljs-comment">// 组件节点</span>
  <span class="hljs-attr">FRAGMENT</span>: <span class="hljs-number">4</span>,    <span class="hljs-comment">// Fragment节点（多个根节点）</span>
  <span class="hljs-attr">COMMENT</span>: <span class="hljs-number">5</span>,     <span class="hljs-comment">// 注释节点</span>
};

<span class="hljs-comment">/**
 * 创建虚拟 DOM 节点
 * 这是构建虚拟DOM树的基石函数
 * 
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string|Object|Function</span>} <span class="hljs-variable">type</span> - 节点类型（标签名、组件对象或组件函数）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object|null</span>} <span class="hljs-variable">props</span> - 属性对象
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array|string|number|null</span>} <span class="hljs-variable">children</span> - 子节点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string|number|null</span>} <span class="hljs-variable">key</span> - 节点的key（用于diff算法优化）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} 虚拟DOM节点对象
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createVNode</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>, props = <span class="hljs-literal">null</span>, children = <span class="hljs-literal">null</span>, key = <span class="hljs-literal">null</span></span>) {
  <span class="hljs-comment">// 确定节点类型：字符串为HTML元素，对象/函数为组件</span>
  <span class="hljs-keyword">let</span> vnodeType = <span class="hljs-variable constant_">VNODE_TYPES</span>.<span class="hljs-property">ELEMENT</span>;
  
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isString</span>(<span class="hljs-keyword">type</span>)) {
    vnodeType = <span class="hljs-variable constant_">VNODE_TYPES</span>.<span class="hljs-property">ELEMENT</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isObject</span>(<span class="hljs-keyword">type</span>) || <span class="hljs-title function_">isFunction</span>(<span class="hljs-keyword">type</span>)) {
    vnodeType = <span class="hljs-variable constant_">VNODE_TYPES</span>.<span class="hljs-property">COMPONENT</span>;
  }

  <span class="hljs-keyword">return</span> {
    <span class="hljs-keyword">type</span>,           <span class="hljs-comment">// 节点类型标识</span>
    props,          <span class="hljs-comment">// 属性集合</span>
    children,       <span class="hljs-comment">// 子节点数组或文本</span>
    key,            <span class="hljs-comment">// 用于diff算法的唯一标识</span>
    <span class="hljs-attr">el</span>: <span class="hljs-literal">null</span>,       <span class="hljs-comment">// 对应的真实DOM元素（挂载后赋值）</span>
    <span class="hljs-attr">component</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 组件实例（组件节点专用）</span>
    <span class="hljs-attr">shapeFlag</span>: vnodeType, <span class="hljs-comment">// 节点形状标志，决定如何处理该节点</span>
    <span class="hljs-attr">__v_isVNode</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 标识这是一个虚拟节点</span>
  };
}
</code></pre>
<p><strong>关键点说明：</strong></p>
<ul>
<li><code>shapeFlag</code> 使用位运算标志来快速判断节点类型</li>
<li><code>key</code> 属性是Diff算法优化的关键</li>
<li><code>el</code> 属性在挂载后指向对应的真实DOM，建立虚拟DOM与真实DOM的桥梁</li>
</ul>
<h3 data-id="heading-3">2. 渲染器核心架构</h3>
<p>渲染器是Vue3的核心，采用可插拔架构，支持不同平台的渲染。</p>
<p>javascript</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">/**
 * 创建渲染器 - Vue3渲染系统的核心工厂函数
 * 采用依赖注入模式，接收平台特定的DOM操作函数
 * 
 * <span class="hljs-doctag">@param</span> {Object} options - 渲染器选项（平台相关的DOM操作）
 * <span class="hljs-doctag">@returns</span> {Object} 包含render和createApp方法的渲染器对象
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createRenderer</span>(<span class="hljs-params">options</span>) </span>{
  <span class="hljs-comment">// 解构平台相关的DOM操作函数</span>
  <span class="hljs-keyword">const</span> {
    createElement,  <span class="hljs-comment">// 创建DOM元素</span>
    insert,         <span class="hljs-comment">// 插入DOM元素  </span>
    remove,         <span class="hljs-comment">// 移除DOM元素</span>
    setElementText, <span class="hljs-comment">// 设置元素文本</span>
    setText,        <span class="hljs-comment">// 设置文本节点内容</span>
    patchProp,      <span class="hljs-comment">// 更新元素属性</span>
  } = options;

  <span class="hljs-comment">// ... 渲染器核心实现</span>

  <span class="hljs-keyword">return</span> {
    render,
    createApp: <span class="hljs-title function_ invoke__">createAppAPI</span>(render),
  };
}
</code></pre>
<h3 data-id="heading-4">3. 挂载与更新机制</h3>
<h4 data-id="heading-5">3.1 挂载元素节点</h4>
<p>javascript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * 挂载元素节点 - 将虚拟DOM转换为真实DOM的关键步骤
 * 
 * @param {Object} vnode - 虚拟节点
 * @param {HTMLElement} container - 容器元素
 * @param {HTMLElement|null} anchor - 锚点元素（插入位置参考）
 */</span>
function <span class="hljs-built_in">mountElement</span>(vnode, container, anchor = null) {
  <span class="hljs-comment">// 1. 创建对应的真实DOM元素</span>
  const el = <span class="hljs-built_in">createElement</span>(vnode.type);
  vnode<span class="hljs-selector-class">.el</span> = el;  <span class="hljs-comment">// 建立虚拟DOM与真实DOM的关联</span>

  <span class="hljs-comment">// 2. 处理属性：设置class、style、事件监听器等</span>
  if (vnode.props) {
    for (const key in vnode.props) {
      <span class="hljs-built_in">patchProp</span>(el, key, null, vnode.props[key]);
    }
  }

  <span class="hljs-comment">// 3. 处理子节点：递归挂载或设置文本内容</span>
  if (vnode.children) {
    if (isString(vnode.children) || typeof vnode<span class="hljs-selector-class">.children</span> === 'number') {
      <span class="hljs-comment">// 文本子节点直接设置</span>
      <span class="hljs-built_in">setElementText</span>(el, vnode.children);
    } else if (isArray(vnode.children)) {
      <span class="hljs-comment">// 数组子节点递归挂载</span>
      vnode<span class="hljs-selector-class">.children</span><span class="hljs-selector-class">.forEach</span>((child) =&gt; {
        <span class="hljs-built_in">patch</span>(null, child, el);
      });
    }
  }

  <span class="hljs-comment">// 4. 将创建的元素插入到容器中</span>
  <span class="hljs-built_in">insert</span>(el, container, anchor);
}
</code></pre>
<h4 data-id="heading-6">3.2 核心patch函数</h4>
<p>javascript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * patch函数 - 渲染器的心脏，负责挂载新节点或更新已存在节点
 * 这是Vue3性能优化的核心，智能判断应该创建新节点还是更新现有节点
 * 
 * @param {Object|null} oldVNode - 旧的虚拟节点（null表示挂载新节点）
 * @param {Object} newVNode - 新的虚拟节点
 * @param {HTMLElement} container - 容器元素
 * @param {HTMLElement|null} anchor - 锚点元素（插入位置）
 */</span>
function <span class="hljs-built_in">patch</span>(oldVNode, newVNode, container, anchor = null) {
  <span class="hljs-comment">// 1. 如果旧节点存在且类型不同，需要卸载旧节点</span>
  if (oldVNode &amp;&amp; !isSameVNode(oldVNode, newVNode)) {
    <span class="hljs-built_in">unmount</span>(oldVNode);
    oldVNode = null;
  }

  const { shapeFlag } = newVNode;

  <span class="hljs-comment">// 2. 根据节点类型进行不同的处理</span>
  if (shapeFlag === VNODE_TYPES.TEXT) {
    <span class="hljs-comment">// 文本节点处理</span>
    if (!oldVNode) {
      <span class="hljs-built_in">mountText</span>(newVNode, container, anchor);
    } else {
      <span class="hljs-comment">// 更新文本内容</span>
      if (newVNode.children !== oldVNode.children) {
        <span class="hljs-built_in">setText</span>(newVNode.el, newVNode.children);
      }
    }
  } else if (shapeFlag === VNODE_TYPES.ELEMENT) {
    <span class="hljs-comment">// 元素节点处理</span>
    if (!oldVNode) {
      <span class="hljs-built_in">mountElement</span>(newVNode, container, anchor);
    } else {
      <span class="hljs-built_in">patchElement</span>(oldVNode, newVNode);
    }
  } else if (shapeFlag === VNODE_TYPES.COMPONENT) {
    <span class="hljs-comment">// 组件节点处理</span>
    if (!oldVNode) {
      <span class="hljs-built_in">mountComponent</span>(newVNode, container, anchor);
    } else {
      <span class="hljs-built_in">patchComponent</span>(oldVNode, newVNode);
    }
  }
}
</code></pre>
<h3 data-id="heading-7">4. Diff算法：Vue3性能的秘诀</h3>
<p>Vue3的Diff算法是其性能大幅提升的关键，采用双端比较和最长递增子序列优化。</p>
<h4 data-id="heading-8">4.1 双端比较算法</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * 带key的子节点diff算法（双端比较 + 最长递增子序列优化）
 * 这是Vue3相比Vue2性能提升的核心算法
 * 
 * @param {Array} oldChildren - 旧的子节点数组
 * @param {Array} newChildren - 新的子节点数组  
 * @param {HTMLElement} container - 容器元素
 */
function patchKeyedChildren(oldChildren, newChildren, container) {
  // 阶段1：双端比较 - 处理简单的头部和尾部相同情况
  let <span class="hljs-attr">oldStartIdx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  let <span class="hljs-attr">newStartIdx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  let <span class="hljs-attr">oldEndIdx</span> = oldChildren.length - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  let <span class="hljs-attr">newEndIdx</span> = newChildren.length - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  
  // 双端比较的四种简单情况处理
  while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) {
    // 情况1：旧头节点 === 新头节点（位置不变，只需更新内容）
    if (isSameVNode(oldStartVNode, newStartVNode)) {
      patch(oldStartVNode, newStartVNode, container)<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldStartVNode</span> = oldChildren[++oldStartIdx]<span class="hljs-comment">;</span>
      <span class="hljs-attr">newStartVNode</span> = newChildren[++newStartIdx]<span class="hljs-comment">;</span>
    }
    // 情况2：旧尾节点 === 新尾节点（位置不变，只需更新内容）  
    else if (isSameVNode(oldEndVNode, newEndVNode)) {
      patch(oldEndVNode, newEndVNode, container)<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldEndVNode</span> = oldChildren[--oldEndIdx]<span class="hljs-comment">;</span>
      <span class="hljs-attr">newEndVNode</span> = newChildren[--newEndIdx]<span class="hljs-comment">;</span>
    }
    // 情况3：旧头节点 === 新尾节点（节点从头部移到尾部）
    else if (isSameVNode(oldStartVNode, newEndVNode)) {
      patch(oldStartVNode, newEndVNode, container)<span class="hljs-comment">;</span>
      // 移动DOM元素到正确位置
      insert(oldStartVNode.el, container, oldEndVNode.el.nextSibling)<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldStartVNode</span> = oldChildren[++oldStartIdx]<span class="hljs-comment">;</span>
      <span class="hljs-attr">newEndVNode</span> = newChildren[--newEndIdx]<span class="hljs-comment">;</span>
    }
    // 情况4：旧尾节点 === 新头节点（节点从尾部移到头部）
    else if (isSameVNode(oldEndVNode, newStartVNode)) {
      patch(oldEndVNode, newStartVNode, container)<span class="hljs-comment">;</span>
      insert(oldEndVNode.el, container, oldStartVNode.el)<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldEndVNode</span> = oldChildren[--oldEndIdx]<span class="hljs-comment">;</span>
      <span class="hljs-attr">newStartVNode</span> = newChildren[++newStartIdx]<span class="hljs-comment">;</span>
    }
    // 情况5：都不匹配，进入复杂情况处理
    else {
      break<span class="hljs-comment">;</span>
    }
  }
  
  // 阶段2：建立key映射表，处理复杂移动情况
  // 阶段3：使用最长递增子序列算法优化DOM移动操作
}
</code></pre>
<h4 data-id="heading-9">4.2 最长递增子序列算法</h4>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * 最长递增子序列（Longest Increasing Subsequence）算法
 * 用于找出数组中保持递增顺序的最长子序列
 * 在Diff算法中用于识别不需要移动的节点，最小化DOM操作
 * 
 * 算法原理：贪心 + 二分查找，时间复杂度O(n log n)
 * 
 * @param {Array} arr - 输入数组
 * @returns {Array} 最长递增子序列的索引数组
 */
function getSequence(arr) {
  const <span class="hljs-attr">p</span> = arr.slice()<span class="hljs-comment">; // 前驱节点数组，用于回溯构建结果</span>
  const <span class="hljs-attr">result</span> = [<span class="hljs-number">0</span>]<span class="hljs-comment">;    // 当前最长递增子序列的索引</span>
  
  let i, j, u, v, c<span class="hljs-comment">;</span>
  const <span class="hljs-attr">len</span> = arr.length<span class="hljs-comment">;</span>
  
  for (<span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; len; i++) {</span>
    const <span class="hljs-attr">arrI</span> = arr[i]<span class="hljs-comment">;</span>
    
    // 跳过值为0的元素（表示新节点）
    if (arrI !== 0) {
      <span class="hljs-attr">j</span> = result[result.length - <span class="hljs-number">1</span>]<span class="hljs-comment">;</span>
      
      // 如果当前元素大于结果数组最后一个元素，直接添加
      if (arr<span class="hljs-section">[j]</span> &lt; arrI) {
        p<span class="hljs-section">[i]</span> = j<span class="hljs-comment">;           // 记录前驱节点</span>
        result.push(i)<span class="hljs-comment">;     // 添加到结果数组</span>
        continue<span class="hljs-comment">;</span>
      }
      
      // 否则使用二分查找找到应该插入的位置
      <span class="hljs-attr">u</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">v</span> = result.length - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
      
      while (u &lt; v) {
        <span class="hljs-attr">c</span> = (u + v) &gt;&gt; <span class="hljs-number">1</span><span class="hljs-comment">;  // 二分查找中间位置</span>
        if (arr<span class="hljs-section">[result[c]]</span> &lt; arrI) {
          <span class="hljs-attr">u</span> = c + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
        } else {
          <span class="hljs-attr">v</span> = c<span class="hljs-comment">;</span>
        }
      }
      
      // 替换找到的位置
      if (arrI &lt; arr<span class="hljs-section">[result[u]]</span>) {
        if (u &gt; 0) {
          p<span class="hljs-section">[i]</span> = result<span class="hljs-section">[u - 1]</span><span class="hljs-comment">;</span>
        }
        result<span class="hljs-section">[u]</span> = i<span class="hljs-comment">;</span>
      }
    }
  }
  
  // 回溯构建完整的最长递增子序列
  <span class="hljs-attr">u</span> = result.length<span class="hljs-comment">;</span>
  <span class="hljs-attr">v</span> = result[u - <span class="hljs-number">1</span>]<span class="hljs-comment">;</span>
  
  while (u-- &gt; 0) {
    result<span class="hljs-section">[u]</span> = v<span class="hljs-comment">;</span>
    <span class="hljs-attr">v</span> = p[v]<span class="hljs-comment">;</span>
  }
  
  return result<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>算法应用场景：</strong><br/>
当节点顺序发生变化时，LIS算法找出不需要移动的节点，只移动必要的节点，极大减少DOM操作。</p>
<h3 data-id="heading-10">5. 组件系统实现</h3>
<p>Vue3的组件系统基于组合式API，支持更灵活的代码组织方式。</p>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * 挂载组件 - 处理组件节点的创建和渲染
 * 
 * @param {Object} vnode - 组件虚拟节点
 * @param {HTMLElement} container - 容器元素
 * @param {HTMLElement|null} anchor - 锚点元素
 */
function mountComponent(vnode, container, <span class="hljs-attr">anchor</span> = null) {
  // 1. 获取组件定义（可能是对象或函数）
  const <span class="hljs-attr">component</span> = vnode.type<span class="hljs-comment">;</span>
  
  // 2. 创建组件实例
  const <span class="hljs-attr">instance</span> = {
    vnode,
    type: component,
    props: vnode.props || {},
    setupState: {},     // setup函数返回的状态
    render: null,       // 组件的渲染函数
    subTree: null,      // 组件渲染的子树
    isMounted: false,
    update: null,       // 更新函数
  }<span class="hljs-comment">;</span>
  
  // 3. 处理不同类型的组件定义
  if (isFunction(component)) {
    // 函数式组件：直接使用函数作为render
    <span class="hljs-attr">instance.render</span> = component<span class="hljs-comment">;</span>
  } else if (isObject(component)) {
    // 选项式组件：处理setup和render
    if (component.setup) {
      // 调用setup函数，传入props和上下文
      const <span class="hljs-attr">setupResult</span> = component.setup(instance.props, {
        // 这里可以传入emit、slots等上下文
      })<span class="hljs-comment">;</span>
      
      if (isFunction(setupResult)) {
        // setup返回渲染函数
        <span class="hljs-attr">instance.render</span> = setupResult<span class="hljs-comment">;</span>
      } else if (isObject(setupResult)) {
        // setup返回状态对象
        <span class="hljs-attr">instance.setupState</span> = setupResult<span class="hljs-comment">;</span>
        <span class="hljs-attr">instance.render</span> = component.render || defaultRender<span class="hljs-comment">;</span>
      }
    } else if (component.render) {
      <span class="hljs-attr">instance.render</span> = component.render<span class="hljs-comment">;</span>
    }
  }
  
  <span class="hljs-attr">vnode.component</span> = instance<span class="hljs-comment">;</span>
  
  // 4. 执行渲染函数，得到子树并挂载
  <span class="hljs-attr">instance.subTree</span> = instance.render(instance.setupState, instance.props)<span class="hljs-comment">;</span>
  patch(null, instance.subTree, container, anchor)<span class="hljs-comment">;</span>
  <span class="hljs-attr">instance.isMounted</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-11">6. 浏览器DOM操作适配器</h3>
<p>javascript</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * 浏览器环境的渲染器选项
 * 将抽象的渲染操作映射到具体的DOM API
 */</span>
const rendererOptions = {
  <span class="hljs-comment">// 创建DOM元素</span>
  <span class="hljs-built_in">createElement</span>(tag) {
    return document<span class="hljs-selector-class">.createElement</span>(tag);
  },
  
  <span class="hljs-comment">// 插入DOM元素</span>
  <span class="hljs-built_in">insert</span>(el, parent, anchor = null) {
    parent<span class="hljs-selector-class">.insertBefore</span>(el, anchor);
  },
  
  <span class="hljs-comment">// 移除DOM元素  </span>
  <span class="hljs-built_in">remove</span>(el) {
    const parent = el<span class="hljs-selector-class">.parentNode</span>;
    if (parent) {
      parent<span class="hljs-selector-class">.removeChild</span>(el);
    }
  },
  
  <span class="hljs-comment">// 设置元素文本内容</span>
  <span class="hljs-built_in">setElementText</span>(el, text) {
    el<span class="hljs-selector-class">.textContent</span> = text;
  },
  
  <span class="hljs-comment">// 更新元素属性（包括事件、class、style等）</span>
  <span class="hljs-built_in">patchProp</span>(el, key, prevValue, nextValue) {
    <span class="hljs-comment">// 处理事件监听器（以on开头的属性）</span>
    if (/^on/.test(key)) {
      const eventName = key<span class="hljs-selector-class">.slice</span>(<span class="hljs-number">2</span>)<span class="hljs-selector-class">.toLowerCase</span>();
      
      <span class="hljs-comment">// 移除旧事件监听器</span>
      if (prevValue) {
        el<span class="hljs-selector-class">.removeEventListener</span>(eventName, prevValue);
      }
      
      <span class="hljs-comment">// 添加新事件监听器</span>
      if (nextValue) {
        el<span class="hljs-selector-class">.addEventListener</span>(eventName, nextValue);
      }
    }
    <span class="hljs-comment">// 处理class属性</span>
    else if (key === 'class') {
      el<span class="hljs-selector-class">.className</span> = nextValue || '';
    }
    <span class="hljs-comment">// 处理style属性</span>
    else if (key === 'style') {
      if (isObject(nextValue)) {
        <span class="hljs-comment">// 样式对象：逐个设置样式属性</span>
        for (const k in nextValue) {
          el<span class="hljs-selector-class">.style</span><span class="hljs-selector-attr">[k]</span> = nextValue<span class="hljs-selector-attr">[k]</span>;
        }
        <span class="hljs-comment">// 移除旧样式中不存在的属性</span>
        if (isObject(prevValue)) {
          for (const k in prevValue) {
            if (!(k in nextValue)) {
              el<span class="hljs-selector-class">.style</span><span class="hljs-selector-attr">[k]</span> = '';
            }
          }
        }
      } else {
        el<span class="hljs-selector-class">.style</span><span class="hljs-selector-class">.cssText</span> = nextValue || '';
      }
    }
    <span class="hljs-comment">// 处理其他属性</span>
    else {
      if (nextValue == null || nextValue === false) {
        el<span class="hljs-selector-class">.removeAttribute</span>(key);
      } else {
        el<span class="hljs-selector-class">.setAttribute</span>(key, nextValue);
      }
    }
  }
};
</code></pre>
<h3 data-id="heading-12">7. 应用实例创建</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 创建createApp API - Vue应用实例的工厂函数
 * 
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">render</span> - 渲染函数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Function</span>} createApp函数
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createAppAPI</span>(<span class="hljs-params">render</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params">rootComponent</span>) {
    <span class="hljs-keyword">const</span> app = {
      <span class="hljs-attr">_component</span>: rootComponent,
      <span class="hljs-attr">_container</span>: <span class="hljs-literal">null</span>,
      
      <span class="hljs-comment">/**
       * 挂载应用到容器
       * 
       * <span class="hljs-doctag">@param</span> {<span class="hljs-type">HTMLElement|string</span>} <span class="hljs-variable">containerOrSelector</span> - 容器元素或选择器
       * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} 应用实例
       */</span>
      <span class="hljs-title function_">mount</span>(<span class="hljs-params">containerOrSelector</span>) {
        <span class="hljs-comment">// 获取容器元素</span>
        <span class="hljs-keyword">const</span> container = <span class="hljs-keyword">typeof</span> containerOrSelector === <span class="hljs-string">'string'</span> 
          ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(containerOrSelector) 
          : containerOrSelector;
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_container</span> = container;
        
        <span class="hljs-comment">// 创建根组件的虚拟节点</span>
        <span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">createVNode</span>(rootComponent);
        
        <span class="hljs-comment">// 渲染到容器</span>
        <span class="hljs-title function_">render</span>(vnode, container);
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
      }
    };
    
    <span class="hljs-keyword">return</span> app;
  };
}
</code></pre>
<h3 data-id="heading-13">总结</h3>
<p>Vue3渲染器的核心创新点：</p>
<ol>
<li><strong>模块化设计</strong>：通过<code>createRenderer</code>工厂函数，支持多平台渲染</li>
<li><strong>高效的Diff算法</strong>：双端比较 + 最长递增子序列，最小化DOM操作</li>
<li><strong>灵活的组件系统</strong>：支持函数式和选项式组件，组合式API提供更好的逻辑复用</li>
<li><strong>静态提升</strong>：在编译阶段优化静态节点，减少运行时开销</li>
<li><strong>Tree Shaking友好</strong>：模块化的架构使未使用的功能可以被摇树优化</li>
</ol>
<p>这个实现虽然简化，但完整展示了Vue3渲染器的核心原理。实际Vue3源码中还有更多优化，如静态提升、补丁标志、缓存优化等，但基本架构和算法思想是一致的。</p>
<p>通过深入理解这个渲染器实现，开发者可以更好地掌握Vue3的性能优化技巧，编写更高效的Vue应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 JS 单线程到 Promise：彻底搞懂异步编程的 "同步化" 魔法]]></title>    <link>https://juejin.cn/post/7571051830710255666</link>    <guid>https://juejin.cn/post/7571051830710255666</guid>    <pubDate>2025-11-11T06:37:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571051830710255666" data-draft-id="7571051830710239282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 JS 单线程到 Promise：彻底搞懂异步编程的 &quot;同步化&quot; 魔法"/> <meta itemprop="keywords" content="JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-11T06:37:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="社恐的下水道蟑螂"/> <meta itemprop="url" content="https://juejin.cn/user/423789937565536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 JS 单线程到 Promise：彻底搞懂异步编程的 "同步化" 魔法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/423789937565536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    社恐的下水道蟑螂
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:37:22.000Z" title="Tue Nov 11 2025 06:37:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端开发中，"异步" 是绕不开的核心概念。从早期的回调函数嵌套，到 ES6 引入的 Promise，再到 async/await 语法糖，异步编程的演进始终围绕一个目标：让复杂的异步逻辑变得像同步代码一样直观。</p>
<p>本文将从 JS 的单线程特性讲起，通过实例带你理解为什么需要 Promise，以及它如何优雅地解决异步流程控制问题。</p>
<h2 data-id="heading-0">一、从线程到 JS 单线程：为什么异步如此重要？</h2>
<p>要理解 JS 的异步机制，先得搞清楚两个基础概念：<strong>进程</strong>和<strong>线程</strong>。</p>
<ul>
<li><strong>进程</strong>：操作系统分配资源的最小单位（比如一个浏览器标签页就是一个进程）。</li>
<li><strong>线程</strong>：进程内执行代码的最小单位，一个进程可以包含多个线程。</li>
</ul>
<p>而 JavaScript 的核心特性之一就是：<strong>单线程</strong>—— 同一时间只能执行一段代码。</p>
<p>为什么 JS 要设计成单线程？这和它的应用场景密切相关：JS 需要操作 DOM、处理页面交互，如果允许多线程同时操作 DOM，会导致渲染冲突（比如两个线程同时修改同一个元素的样式）。单线程模型虽然简单，却带来了一个关键问题：<strong>如果遇到耗时任务（比如网络请求、定时器），会阻塞后续代码执行</strong>。</p>
<p>为了解决这个问题，JS 将代码分为两类：</p>
<h3 data-id="heading-1">1. 同步代码</h3>
<p>按顺序从上到下执行，执行完一段再执行下一段，比如：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini">console.log('start')<span class="hljs-comment">;</span>
let <span class="hljs-attr">a</span> = <span class="hljs-number">1</span> + <span class="hljs-number">2</span><span class="hljs-comment">;</span>
for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 3; i++) {</span>
  console.log(i)<span class="hljs-comment">;</span>
}
console.log('end')<span class="hljs-comment">;</span>
</code></pre>
<p>这类代码执行速度快（毫秒级），不会阻塞线程。</p>
<h3 data-id="heading-2">2. 异步代码</h3>
<p>耗时较长的操作（比如网络请求、<code>setTimeout</code>、文件读写），会被暂时 "挂起"，先执行后面的同步代码，等耗时操作完成后再回头执行。</p>
<p><strong>关键机制</strong>：JS 的单线程配合<strong>事件循环（Event Loop）</strong>  处理异步任务：</p>
<ul>
<li>同步代码直接进入主线程执行</li>
<li>异步任务会被放入 "任务队列" 等待</li>
<li>主线程执行完所有同步代码后，才会从任务队列中依次取出异步任务执行</li>
</ul>
<h2 data-id="heading-3">二、Promise：让异步代码 "同步化" 的利器</h2>
<p>早期处理异步逻辑依赖回调函数，但多个异步操作嵌套时，会出现 "回调地狱"：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 回调地狱示例</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一步完成'</span>);
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二步完成'</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第三步完成'</span>);
      <span class="hljs-comment">// ...更多嵌套</span>
    }, <span class="hljs-number">1000</span>);
  }, <span class="hljs-number">1000</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<p>代码嵌套层级越深，可读性和可维护性越差。</p>
<p>ES6 引入的<strong>Promise</strong>彻底改变了这一局面，它通过链式调用（<code>.then()</code>）让异步流程变得线性、直观。</p>
<h3 data-id="heading-4">1. Promise 的核心特性</h3>
<ul>
<li><strong>状态不可逆</strong>：Promise 有三种状态，只能从<code>pending</code>（等待中）转为<code>fulfilled</code>（成功）或<code>rejected</code>（失败），且状态一旦改变就无法再变。</li>
<li><strong>链式调用</strong>：通过<code>.then()</code>处理成功结果，<code>.catch()</code>处理错误，解决嵌套问题。</li>
<li><strong>立即执行</strong>：创建 Promise 时，传入的执行器函数（executor）会立即执行。</li>
</ul>
<h3 data-id="heading-5">2. 基本用法</h3>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建Promise实例</span>
<span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">// 执行异步任务（比如网络请求、定时器）</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> success = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (success) {
      <span class="hljs-comment">// 任务成功，调用resolve()，状态变为fulfilled</span>
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'任务完成'</span>); 
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 任务失败，调用reject()，状态变为rejected</span>
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'任务失败'</span>));
    }
  }, <span class="hljs-number">1000</span>);
});

<span class="hljs-comment">// 处理成功结果</span>
promise.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// 输出："任务完成"</span>
}).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-comment">// 处理失败（如果调用了reject，会进入这里）</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
});
</code></pre>
<ul>
<li><code>resolve</code>：将 Promise 状态改为成功，触发<code>.then()</code>的回调。</li>
<li><code>reject</code>：将 Promise 状态改为失败，触发<code>.catch()</code>的回调。</li>
</ul>
<h2 data-id="heading-6">三、实战分析：那段代码的执行逻辑</h2>
<p>结合你提供的代码，我们一步步拆解执行过程，彻底搞懂 Promise 的异步执行顺序：</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 同步代码</span>

<span class="hljs-comment">// 创建Promise</span>
<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-comment">// 执行器函数立即执行，但内部的setTimeout是异步任务</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>); 
    <span class="hljs-title function_">resolve</span>(); <span class="hljs-comment">// 改变状态为fulfilled</span>
  }, <span class="hljs-number">3000</span>);
});

<span class="hljs-comment">// 注册成功回调（会在resolve()后执行）</span>
p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>); <span class="hljs-comment">// 同步代码</span>
</code></pre>
<h3 data-id="heading-7">执行步骤详解：</h3>
<ol>
<li>
<p><strong>同步代码优先执行</strong>：</p>
<ul>
<li>先执行<code>console.log(1)</code>，输出 <code>1</code>。</li>
<li>创建 Promise 实例时，执行器函数立即运行，但函数内部的<code>setTimeout</code>是异步任务（宏任务），被放入任务队列等待。</li>
<li>继续执行<code>console.log(4)</code>，输出 <code>4</code>。此时主线程的同步代码已全部执行完毕。</li>
</ul>
</li>
<li>
<p><strong>异步任务进入事件循环</strong>：</p>
<ul>
<li>3 秒后，<code>setTimeout</code>的回调从任务队列进入主线程执行，输出 <code>2</code>。</li>
<li>执行<code>resolve()</code>，将 Promise 状态从<code>pending</code>改为<code>fulfilled</code>。</li>
<li>Promise 状态改变后，触发<code>.then()</code>中注册的回调，执行<code>console.log(3)</code>，输出 <code>3</code>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">最终输出顺序：</h3>
<p>plaintext</p>
<pre><code class="hljs">1
4
2
3
</code></pre>
<h2 data-id="heading-9">四、Promise 的核心价值</h2>
<ol>
<li>
<p><strong>解决回调地狱</strong>：通过<code>.then()</code>链式调用，将嵌套的异步逻辑转为线性代码。</p>
<p>javascript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 链式调用示例</span>
<span class="hljs-title function_">fetchData</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">processData</span>(data))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-title function_">saveResult</span>(result))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'全部完成'</span>))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error));
</code></pre>
</li>
<li>
<p><strong>统一异步 API</strong>：无论定时器、网络请求还是文件操作，都可以用 Promise 包装，形成统一的异步处理模式。</p>
</li>
<li>
<p><strong>流程控制能力</strong>：结合<code>Promise.all()</code>（并行执行）、<code>Promise.race()</code>（竞速执行）等方法，轻松实现复杂的异步流程控制。</p>
</li>
</ol>
<h2 data-id="heading-10">总结</h2>
<p>JavaScript 的单线程模型决定了异步编程的必要性，而 Promise 则是异步编程的里程碑式解决方案。它通过状态管理和链式调用，让原本混乱的异步逻辑变得清晰可控。</p>
<p>理解 Promise 的关键在于：</p>
<ul>
<li>区分同步代码和异步代码的执行时机</li>
<li>掌握 Promise 的状态变化机制</li>
<li>学会用<code>.then()</code>链式调用替代嵌套回调</li>
</ul>
<p>后续学习中，你还会接触到<code>async/await</code>（Promise 的语法糖），它能让异步代码看起来和同步代码几乎一样。但在此之前，扎实掌握 Promise 的原理和用法，是深入理解 JS 异步编程的基础。</p>
<p>希望这篇文章能帮你彻底搞懂 Promise，下次遇到异步代码时，不再迷茫！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 数组方法完全指南]]></title>    <link>https://juejin.cn/post/7571056535440572416</link>    <guid>https://juejin.cn/post/7571056535440572416</guid>    <pubDate>2025-11-11T06:40:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571056535440572416" data-draft-id="7571156741396742159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 数组方法完全指南"/> <meta itemprop="keywords" content="JavaScript,面试"/> <meta itemprop="datePublished" content="2025-11-11T06:40:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户971417181427"/> <meta itemprop="url" content="https://juejin.cn/user/2200564916558794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 数组方法完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2200564916558794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户971417181427
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:40:51.000Z" title="Tue Nov 11 2025 06:40:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 数组方法完全指南</h2>
<h3 data-id="heading-1">前言</h3>
<p>数组是 JavaScript 中最常用的数据结构之一，它提供了丰富的内置方法来处理数据。掌握这些方法不仅能提高开发效率，还能让代码更加简洁优雅。本文将全面介绍 JavaScript 数组的各种方法，帮助你从入门到精通。</p>
<h3 data-id="heading-2">目录</h3>
<ul>
<li><a href="#%E6%95%B0%E7%BB%84%E5%9F%BA%E7%A1%80" title="#%E6%95%B0%E7%BB%84%E5%9F%BA%E7%A1%80">数组基础</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84" title="#%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84">创建数组</a></li>
<li><a href="#%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95%E5%88%86%E7%B1%BB" title="#%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95%E5%88%86%E7%B1%BB">数组方法分类</a>
<ul>
<li><a href="#%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%96%B9%E6%B3%95" title="#%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%96%B9%E6%B3%95">增删改查方法</a></li>
<li><a href="#%E9%81%8D%E5%8E%86%E6%96%B9%E6%B3%95" title="#%E9%81%8D%E5%8E%86%E6%96%B9%E6%B3%95">遍历方法</a></li>
<li><a href="#%E6%9F%A5%E6%89%BE%E6%96%B9%E6%B3%95" title="#%E6%9F%A5%E6%89%BE%E6%96%B9%E6%B3%95">查找方法</a></li>
<li><a href="#%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95" title="#%E8%BD%AC%E6%8D%A2%E6%96%B9%E6%B3%95">转换方法</a></li>
<li><a href="#%E6%8E%92%E5%BA%8F%E5%92%8C%E5%8F%8D%E8%BD%AC" title="#%E6%8E%92%E5%BA%8F%E5%92%8C%E5%8F%8D%E8%BD%AC">排序和反转</a></li>
<li><a href="#%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95" title="#%E5%88%A4%E6%96%AD%E6%96%B9%E6%B3%95">判断方法</a></li>
<li><a href="#%E5%BD%92%E7%BA%A6%E6%96%B9%E6%B3%95" title="#%E5%BD%92%E7%BA%A6%E6%96%B9%E6%B3%95">归约方法</a></li>
<li><a href="#es6-%E6%96%B0%E6%96%B9%E6%B3%95" title="#es6-%E6%96%B0%E6%96%B9%E6%B3%95">ES6+ 新方法</a></li>
</ul>
</li>
<li><a href="#%E6%96%B9%E6%B3%95%E5%AF%B9%E6%AF%94%E4%B8%8E%E9%80%89%E6%8B%A9" title="#%E6%96%B9%E6%B3%95%E5%AF%B9%E6%AF%94%E4%B8%8E%E9%80%89%E6%8B%A9">方法对比与选择</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li>
<li><a href="#%E6%80%BB%E7%BB%93" title="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
<hr/>
<h3 data-id="heading-3">数组基础</h3>
<p>在 JavaScript 中，数组是一种特殊的对象，用于存储有序的数据集合。数组具有以下特点：</p>
<ul>
<li><strong>可调整大小</strong>：数组长度可以动态变化</li>
<li><strong>可包含不同类型</strong>：同一个数组可以存储数字、字符串、对象等</li>
<li><strong>索引从 0 开始</strong>：第一个元素的索引是 0</li>
<li><strong>浅拷贝</strong>：数组复制操作创建的是浅拷贝</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 数组示例</span>
<span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 'apple'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-property">length</span>); <span class="hljs-comment">// 3</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">创建数组</h3>
<h4 data-id="heading-5">1. 字面量方式</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = []; <span class="hljs-comment">// 空数组</span>
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// 包含元素的数组</span>
<span class="hljs-keyword">const</span> arr3 = [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">true</span>]; <span class="hljs-comment">// 混合类型</span>
</code></pre>
<h4 data-id="heading-6">2. Array 构造函数</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(); <span class="hljs-comment">// 空数组</span>
<span class="hljs-keyword">const</span> arr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// 长度为 5 的稀疏数组</span>
<span class="hljs-keyword">const</span> arr3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3]</span>
</code></pre>
<h4 data-id="heading-7">3. Array.of()</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">7</span>); <span class="hljs-comment">// [7]</span>
<span class="hljs-keyword">const</span> arr2 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3]</span>
<span class="hljs-comment">// 与 new Array(7) 不同，Array.of(7) 创建的是包含一个元素 7 的数组</span>
</code></pre>
<h4 data-id="heading-8">4. Array.from()</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从类数组对象创建</span>
<span class="hljs-keyword">const</span> arr1 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">'hello'</span>); <span class="hljs-comment">// ['h', 'e', 'l', 'l', 'o']</span>
<span class="hljs-keyword">const</span> arr2 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i); <span class="hljs-comment">// [0, 1, 2, 3, 4]</span>

<span class="hljs-comment">// 从 Set/Map 创建</span>
<span class="hljs-keyword">const</span> set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-keyword">const</span> arr3 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(set); <span class="hljs-comment">// [1, 2, 3]</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">数组方法分类</h3>
<h4 data-id="heading-10">增删改查方法</h4>
<h5 data-id="heading-11">push() - 在末尾添加元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>];
fruits.<span class="hljs-title function_">push</span>(<span class="hljs-string">'orange'</span>); <span class="hljs-comment">// 返回新长度 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange']</span>

<span class="hljs-comment">// 可以一次添加多个元素</span>
fruits.<span class="hljs-title function_">push</span>(<span class="hljs-string">'grape'</span>, <span class="hljs-string">'mango'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange', 'grape', 'mango']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回数组的新长度</li>
<li>可以添加多个元素</li>
</ul>
<h5 data-id="heading-12">pop() - 移除并返回最后一个元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> last = fruits.<span class="hljs-title function_">pop</span>(); <span class="hljs-comment">// 'orange'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(last); <span class="hljs-comment">// 'orange'</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回被移除的元素</li>
<li>如果数组为空，返回 <code>undefined</code></li>
</ul>
<h5 data-id="heading-13">unshift() - 在开头添加元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
fruits.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">'apple'</span>); <span class="hljs-comment">// 返回新长度 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回数组的新长度</li>
<li>性能比 <code>push()</code> 低（需要移动所有元素）</li>
</ul>
<h5 data-id="heading-14">shift() - 移除并返回第一个元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> first = fruits.<span class="hljs-title function_">shift</span>(); <span class="hljs-comment">// 'apple'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['banana', 'orange']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回被移除的元素</li>
<li>性能比 <code>pop()</code> 低</li>
</ul>
<h5 data-id="heading-15">splice() - 删除、插入或替换元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'grape'</span>];

<span class="hljs-comment">// 删除元素：从索引 1 开始删除 2 个元素</span>
<span class="hljs-keyword">const</span> removed = fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'grape']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(removed); <span class="hljs-comment">// ['banana', 'orange']</span>

<span class="hljs-comment">// 插入元素：从索引 1 开始，删除 0 个，插入新元素</span>
fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'mango'</span>, <span class="hljs-string">'peach'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'mango', 'peach', 'grape']</span>

<span class="hljs-comment">// 替换元素：从索引 1 开始，删除 1 个，插入新元素</span>
fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'banana'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'peach', 'grape']</span>
</code></pre>
<p><strong>语法</strong>：<code>array.splice(start, deleteCount, ...items)</code></p>
<p><strong>特点</strong>：</p>
<ul>
<li>修改原数组</li>
<li>返回被删除元素的数组</li>
<li>功能强大，可以删除、插入、替换</li>
</ul>
<h5 data-id="heading-16">slice() - 提取数组片段（不修改原数组）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'grape'</span>, <span class="hljs-string">'mango'</span>];

<span class="hljs-comment">// 提取从索引 1 到 3（不包括 3）的元素</span>
<span class="hljs-keyword">const</span> sliced = fruits.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sliced); <span class="hljs-comment">// ['banana', 'orange']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// 原数组不变</span>

<span class="hljs-comment">// 只提供开始索引，提取到末尾</span>
<span class="hljs-keyword">const</span> fromIndex2 = fruits.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fromIndex2); <span class="hljs-comment">// ['orange', 'grape', 'mango']</span>

<span class="hljs-comment">// 负数索引：从末尾开始计算</span>
<span class="hljs-keyword">const</span> lastTwo = fruits.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lastTwo); <span class="hljs-comment">// ['grape', 'mango']</span>

<span class="hljs-comment">// 复制整个数组</span>
<span class="hljs-keyword">const</span> copy = fruits.<span class="hljs-title function_">slice</span>();
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回新数组</li>
<li>常用于数组复制</li>
</ul>
<hr/>
<h4 data-id="heading-17">遍历方法</h4>
<h5 data-id="heading-18">forEach() - 遍历数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">value, index, array</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`索引 <span class="hljs-subst">${index}</span>: 值 <span class="hljs-subst">${value}</span>`</span>);
});

<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 索引 0: 值 1</span>
<span class="hljs-comment">// 索引 1: 值 2</span>
<span class="hljs-comment">// 索引 2: 值 3</span>
<span class="hljs-comment">// 索引 3: 值 4</span>
<span class="hljs-comment">// 索引 4: 值 5</span>

<span class="hljs-comment">// 修改原数组（不推荐，但可以）</span>
<span class="hljs-keyword">const</span> doubled = [];
numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> {
  doubled.<span class="hljs-title function_">push</span>(num * <span class="hljs-number">2</span>);
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doubled); <span class="hljs-comment">// [2, 4, 6, 8, 10]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>不返回新数组（返回 <code>undefined</code>）</li>
<li>无法使用 <code>break</code> 或 <code>continue</code>（可以使用 <code>return</code> 跳过当前迭代）</li>
<li>不会跳过空槽（稀疏数组）</li>
</ul>
<h5 data-id="heading-19">map() - 映射数组（返回新数组）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 将每个数字乘以 2</span>
<span class="hljs-keyword">const</span> doubled = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(doubled); <span class="hljs-comment">// [2, 4, 6, 8, 10]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// 原数组不变 [1, 2, 3, 4, 5]</span>

<span class="hljs-comment">// 提取对象属性</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span> }
];
<span class="hljs-keyword">const</span> names = users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">name</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(names); <span class="hljs-comment">// ['Alice', 'Bob', 'Charlie']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回新数组</li>
<li>新数组长度与原数组相同</li>
<li>最常用的数组方法之一</li>
</ul>
<h5 data-id="heading-20">filter() - 过滤数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// 筛选偶数</span>
<span class="hljs-keyword">const</span> evens = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(evens); <span class="hljs-comment">// [2, 4, 6, 8, 10]</span>

<span class="hljs-comment">// 筛选对象</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">17</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];
<span class="hljs-keyword">const</span> adults = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(adults); <span class="hljs-comment">// [{ name: 'Alice', age: 25 }, { name: 'Charlie', age: 30 }]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回新数组</li>
<li>新数组长度可能小于原数组</li>
<li>回调函数返回 <code>true</code> 的元素会被保留</li>
</ul>
<h5 data-id="heading-21">reduce() - 归约数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 求和</span>
<span class="hljs-keyword">const</span> sum = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">accumulator, currentValue</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> accumulator + currentValue;
}, <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sum); <span class="hljs-comment">// 15</span>

<span class="hljs-comment">// 简化写法</span>
<span class="hljs-keyword">const</span> sum2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> acc + cur, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 求最大值</span>
<span class="hljs-keyword">const</span> max = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(acc, cur));

<span class="hljs-comment">// 数组转对象</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span> }
];
<span class="hljs-keyword">const</span> userMap = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
  acc[user.<span class="hljs-property">id</span>] = user.<span class="hljs-property">name</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userMap); <span class="hljs-comment">// { 1: 'Alice', 2: 'Bob', 3: 'Charlie' }</span>

<span class="hljs-comment">// 数组扁平化</span>
<span class="hljs-keyword">const</span> nested = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]];
<span class="hljs-keyword">const</span> flat = nested.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> acc.<span class="hljs-title function_">concat</span>(cur), []);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(flat); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回单个值</li>
<li>功能强大，可以实现很多复杂操作</li>
<li>初始值可选（建议总是提供）</li>
</ul>
<h5 data-id="heading-22">reduceRight() - 从右到左归约</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-comment">// 从右到左计算</span>
<span class="hljs-keyword">const</span> result = numbers.<span class="hljs-title function_">reduceRight</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> acc - cur);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// -2 (4 - 3 - 2 - 1 = -2)</span>

<span class="hljs-comment">// 与 reduce 对比</span>
<span class="hljs-keyword">const</span> result2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> acc - cur);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result2); <span class="hljs-comment">// -8 (1 - 2 - 3 - 4 = -8)</span>
</code></pre>
<hr/>
<h4 data-id="heading-23">查找方法</h4>
<h5 data-id="heading-24">indexOf() - 查找元素索引</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'banana'</span>];

<span class="hljs-keyword">const</span> index = fruits.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'banana'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index); <span class="hljs-comment">// 1</span>

<span class="hljs-comment">// 从指定位置开始查找</span>
<span class="hljs-keyword">const</span> index2 = fruits.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'banana'</span>, <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index2); <span class="hljs-comment">// 3</span>

<span class="hljs-comment">// 找不到返回 -1</span>
<span class="hljs-keyword">const</span> index3 = fruits.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'grape'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index3); <span class="hljs-comment">// -1</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>使用严格相等（===）比较</li>
<li>返回第一个匹配的索引</li>
<li>找不到返回 -1</li>
</ul>
<h5 data-id="heading-25">lastIndexOf() - 从后往前查找</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>, <span class="hljs-string">'banana'</span>];

<span class="hljs-keyword">const</span> index = fruits.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'banana'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index); <span class="hljs-comment">// 3</span>
</code></pre>
<h5 data-id="heading-26">includes() - 判断是否包含元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'banana'</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'grape'</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 从指定位置开始查找</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'apple'</span>, <span class="hljs-number">1</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>返回布尔值</li>
<li>ES6 新增方法</li>
<li>比 <code>indexOf() !== -1</code> 更语义化</li>
</ul>
<h5 data-id="heading-27">find() - 查找第一个满足条件的元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">17</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];

<span class="hljs-comment">// 查找第一个年龄大于等于 18 的用户</span>
<span class="hljs-keyword">const</span> adult = users.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(adult); <span class="hljs-comment">// { id: 1, name: 'Alice', age: 25 }</span>

<span class="hljs-comment">// 找不到返回 undefined</span>
<span class="hljs-keyword">const</span> senior = users.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt; <span class="hljs-number">100</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(senior); <span class="hljs-comment">// undefined</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回第一个匹配的元素</li>
<li>找不到返回 <code>undefined</code></li>
</ul>
<h5 data-id="heading-28">findIndex() - 查找第一个满足条件的元素索引</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">17</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];

<span class="hljs-keyword">const</span> index = users.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index); <span class="hljs-comment">// 0</span>

<span class="hljs-comment">// 找不到返回 -1</span>
<span class="hljs-keyword">const</span> notFound = users.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt; <span class="hljs-number">100</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(notFound); <span class="hljs-comment">// -1</span>
</code></pre>
<h5 data-id="heading-29">findLast() - 查找最后一个满足条件的元素（ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-keyword">const</span> lastEven = numbers.<span class="hljs-title function_">findLast</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lastEven); <span class="hljs-comment">// 6</span>
</code></pre>
<h5 data-id="heading-30">findLastIndex() - 查找最后一个满足条件的元素索引（ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-keyword">const</span> lastEvenIndex = numbers.<span class="hljs-title function_">findLastIndex</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(lastEvenIndex); <span class="hljs-comment">// 5</span>
</code></pre>
<hr/>
<h4 data-id="heading-31">转换方法</h4>
<h5 data-id="heading-32">join() - 数组转字符串</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">join</span>()); <span class="hljs-comment">// 'apple,banana,orange'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)); <span class="hljs-comment">// 'applebananaorange'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">join</span>(<span class="hljs-string">' - '</span>)); <span class="hljs-comment">// 'apple - banana - orange'</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>默认使用逗号分隔</li>
<li>空数组返回空字符串</li>
</ul>
<h5 data-id="heading-33">toString() - 转换为字符串</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// 'apple,banana,orange'</span>
<span class="hljs-comment">// 等同于 fruits.join()</span>
</code></pre>
<h5 data-id="heading-34">toLocaleString() - 本地化字符串</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1234.56</span>, <span class="hljs-number">7890.12</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers.<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">'zh-CN'</span>)); <span class="hljs-comment">// '1,234.56,7,890.12'</span>
</code></pre>
<h5 data-id="heading-35">flat() - 扁平化数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nested = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]]];

<span class="hljs-comment">// 默认只扁平化一层</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nested.<span class="hljs-title function_">flat</span>()); <span class="hljs-comment">// [1, 2, 3, 4, [5, 6]]</span>

<span class="hljs-comment">// 指定深度</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nested.<span class="hljs-title function_">flat</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>

<span class="hljs-comment">// 扁平化所有层级</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(nested.<span class="hljs-title function_">flat</span>(<span class="hljs-title class_">Infinity</span>)); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>ES2019 新增</li>
<li>可以指定扁平化深度</li>
</ul>
<h5 data-id="heading-36">flatMap() - 映射后扁平化</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// 相当于 map().flat()</span>
<span class="hljs-keyword">const</span> result = numbers.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> [x, x * <span class="hljs-number">2</span>]);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// [1, 2, 2, 4, 3, 6]</span>

<span class="hljs-comment">// 与 map().flat() 对比</span>
<span class="hljs-keyword">const</span> result2 = numbers.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> [x, x * <span class="hljs-number">2</span>]).<span class="hljs-title function_">flat</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result2); <span class="hljs-comment">// [1, 2, 2, 4, 3, 6]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>ES2019 新增</li>
<li>性能比 <code>map().flat()</code> 更好</li>
</ul>
<hr/>
<h4 data-id="heading-37">排序和反转</h4>
<h5 data-id="heading-38">sort() - 排序</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>];

<span class="hljs-comment">// 默认按字符串排序（不推荐）</span>
numbers.<span class="hljs-title function_">sort</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// [1, 1, 2, 3, 4, 5, 6, 9]</span>

<span class="hljs-comment">// 数字排序（升序）</span>
<span class="hljs-keyword">const</span> numbers2 = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>];
numbers2.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers2); <span class="hljs-comment">// [1, 1, 2, 3, 4, 5, 6, 9]</span>

<span class="hljs-comment">// 数字排序（降序）</span>
<span class="hljs-keyword">const</span> numbers3 = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>];
numbers3.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b - a);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers3); <span class="hljs-comment">// [9, 6, 5, 4, 3, 2, 1, 1]</span>

<span class="hljs-comment">// 对象排序</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">17</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
];
users.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">age</span> - b.<span class="hljs-property">age</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(users);
<span class="hljs-comment">// [{ name: 'Bob', age: 17 }, { name: 'Alice', age: 25 }, { name: 'Charlie', age: 30 }]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>修改原数组</strong></li>
<li>默认按字符串 Unicode 码点排序</li>
<li>需要提供比较函数进行数字排序</li>
</ul>
<h5 data-id="heading-39">reverse() - 反转数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
fruits.<span class="hljs-title function_">reverse</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['orange', 'banana', 'apple']</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>修改原数组</strong></li>
<li>返回反转后的数组（原数组的引用）</li>
</ul>
<h5 data-id="heading-40">toSorted() - 排序（不修改原数组，ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> sorted = numbers.<span class="hljs-title function_">toSorted</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sorted); <span class="hljs-comment">// [1, 1, 3, 4, 5]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// [3, 1, 4, 1, 5] 原数组不变</span>
</code></pre>
<h5 data-id="heading-41">toReversed() - 反转（不修改原数组，ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> reversed = fruits.<span class="hljs-title function_">toReversed</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(reversed); <span class="hljs-comment">// ['orange', 'banana', 'apple']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange'] 原数组不变</span>
</code></pre>
<hr/>
<h4 data-id="heading-42">判断方法</h4>
<h5 data-id="heading-43">every() - 判断是否所有元素都满足条件</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// 判断是否都是偶数</span>
<span class="hljs-keyword">const</span> allEven = numbers.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(allEven); <span class="hljs-comment">// true</span>

<span class="hljs-keyword">const</span> numbers2 = [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>];
<span class="hljs-keyword">const</span> allEven2 = numbers2.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(allEven2); <span class="hljs-comment">// false</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回布尔值</li>
<li>空数组返回 <code>true</code>（空真值）</li>
</ul>
<h5 data-id="heading-44">some() - 判断是否有元素满足条件</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>];

<span class="hljs-comment">// 判断是否有偶数</span>
<span class="hljs-keyword">const</span> hasEven = numbers.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hasEven); <span class="hljs-comment">// true</span>

<span class="hljs-keyword">const</span> numbers2 = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>];
<span class="hljs-keyword">const</span> hasEven2 = numbers2.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(hasEven2); <span class="hljs-comment">// false</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回布尔值</li>
<li>空数组返回 <code>false</code></li>
</ul>
<hr/>
<h4 data-id="heading-45">归约方法</h4>
<h5 data-id="heading-46">reduce() 和 reduceRight()</h5>
<p>已在前面详细介绍，这里不再重复。</p>
<hr/>
<h4 data-id="heading-47">ES6+ 新方法</h4>
<h5 data-id="heading-48">Array.from() - 从类数组创建数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从字符串</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">'hello'</span>); <span class="hljs-comment">// ['h', 'e', 'l', 'l', 'o']</span>

<span class="hljs-comment">// 从 Set</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])); <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 从对象（需要 length 属性）</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i); <span class="hljs-comment">// [0, 1, 2, 3, 4]</span>

<span class="hljs-comment">// 从 NodeList</span>
<span class="hljs-keyword">const</span> divs = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'div'</span>);
<span class="hljs-keyword">const</span> divArray = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(divs);
</code></pre>
<h5 data-id="heading-49">Array.of() - 创建数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">7</span>); <span class="hljs-comment">// [7]</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3]</span>
<span class="hljs-comment">// 与 new Array(7) 不同</span>
</code></pre>
<h5 data-id="heading-50">fill() - 填充数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 填充整个数组</span>
<span class="hljs-keyword">const</span> arr1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr1); <span class="hljs-comment">// [0, 0, 0, 0, 0]</span>

<span class="hljs-comment">// 从指定位置填充</span>
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
arr2.<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr2); <span class="hljs-comment">// [1, 2, 0, 0, 5]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>修改原数组</strong></li>
<li>可以指定填充的起始和结束位置</li>
</ul>
<h5 data-id="heading-51">copyWithin() - 复制数组元素</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 将索引 0-2 的元素复制到索引 3 开始的位置</span>
arr.<span class="hljs-title function_">copyWithin</span>(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr); <span class="hljs-comment">// [1, 2, 3, 1, 2]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>修改原数组</strong></li>
<li>使用场景较少</li>
</ul>
<h5 data-id="heading-52">entries() - 返回键值对迭代器</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [index, value] <span class="hljs-keyword">of</span> fruits.<span class="hljs-title function_">entries</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index, value);
}
<span class="hljs-comment">// 0 'apple'</span>
<span class="hljs-comment">// 1 'banana'</span>
<span class="hljs-comment">// 2 'orange'</span>
</code></pre>
<h5 data-id="heading-53">keys() - 返回键迭代器</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> index <span class="hljs-keyword">of</span> fruits.<span class="hljs-title function_">keys</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(index);
}
<span class="hljs-comment">// 0</span>
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 2</span>
</code></pre>
<h5 data-id="heading-54">values() - 返回值迭代器</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value <span class="hljs-keyword">of</span> fruits.<span class="hljs-title function_">values</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);
}
<span class="hljs-comment">// 'apple'</span>
<span class="hljs-comment">// 'banana'</span>
<span class="hljs-comment">// 'orange'</span>
</code></pre>
<h5 data-id="heading-55">at() - 按索引访问（支持负数，ES2022）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">at</span>(<span class="hljs-number">0</span>)); <span class="hljs-comment">// 'apple'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>)); <span class="hljs-comment">// 'orange'（最后一个）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits.<span class="hljs-title function_">at</span>(-<span class="hljs-number">2</span>)); <span class="hljs-comment">// 'banana'（倒数第二个）</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>支持负数索引</li>
<li>比 <code>fruits[fruits.length - 1]</code> 更优雅</li>
</ul>
<h5 data-id="heading-56">with() - 修改指定索引的值（不修改原数组，ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> newFruits = fruits.<span class="hljs-title function_">with</span>(<span class="hljs-number">1</span>, <span class="hljs-string">'grape'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newFruits); <span class="hljs-comment">// ['apple', 'grape', 'orange']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange'] 原数组不变</span>
</code></pre>
<h5 data-id="heading-57">toSpliced() - 删除、插入或替换（不修改原数组，ES2023）</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'apple'</span>, <span class="hljs-string">'banana'</span>, <span class="hljs-string">'orange'</span>];
<span class="hljs-keyword">const</span> newFruits = fruits.<span class="hljs-title function_">toSpliced</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'grape'</span>, <span class="hljs-string">'mango'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newFruits); <span class="hljs-comment">// ['apple', 'grape', 'mango', 'orange']</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fruits); <span class="hljs-comment">// ['apple', 'banana', 'orange'] 原数组不变</span>
</code></pre>
<hr/>
<h3 data-id="heading-58">方法对比与选择</h3>
<h4 data-id="heading-59">修改原数组 vs 不修改原数组</h4>

























<table><thead><tr><th>修改原数组</th><th>不修改原数组</th></tr></thead><tbody><tr><td>push, pop, shift, unshift</td><td>map, filter, slice</td></tr><tr><td>splice, sort, reverse</td><td>concat, join, toString</td></tr><tr><td>fill, copyWithin</td><td>flat, flatMap</td></tr><tr><td/><td>toSorted, toReversed, with, toSpliced</td></tr></tbody></table>
<p><strong>选择建议</strong>：</p>
<ul>
<li>优先使用不修改原数组的方法（函数式编程）</li>
<li>需要修改原数组时，明确知道副作用</li>
</ul>
<h4 data-id="heading-60">查找方法对比</h4>



































<table><thead><tr><th>方法</th><th>返回值</th><th>使用场景</th></tr></thead><tbody><tr><td>indexOf</td><td>索引或 -1</td><td>简单值查找</td></tr><tr><td>includes</td><td>布尔值</td><td>判断是否存在</td></tr><tr><td>find</td><td>元素或 undefined</td><td>对象查找</td></tr><tr><td>findIndex</td><td>索引或 -1</td><td>对象查找索引</td></tr><tr><td>some</td><td>布尔值</td><td>判断是否有满足条件的元素</td></tr></tbody></table>
<h4 data-id="heading-61">遍历方法对比</h4>









































<table><thead><tr><th>方法</th><th>返回值</th><th>是否可中断</th><th>使用场景</th></tr></thead><tbody><tr><td>forEach</td><td>undefined</td><td>否</td><td>简单遍历</td></tr><tr><td>map</td><td>新数组</td><td>否</td><td>转换数组</td></tr><tr><td>filter</td><td>新数组</td><td>否</td><td>过滤数组</td></tr><tr><td>for...of</td><td>-</td><td>是</td><td>需要中断的遍历</td></tr><tr><td>reduce</td><td>单个值</td><td>否</td><td>归约计算</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-62">最佳实践</h3>
<h4 data-id="heading-63">1. 链式调用</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// 链式调用多个方法</span>
<span class="hljs-keyword">const</span> result = numbers
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>)  <span class="hljs-comment">// [2, 4, 6, 8, 10]</span>
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num * <span class="hljs-number">2</span>)            <span class="hljs-comment">// [4, 8, 12, 16, 20]</span>
  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, num</span>) =&gt;</span> sum + num, <span class="hljs-number">0</span>); <span class="hljs-comment">// 60</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// 60</span>
</code></pre>
<h4 data-id="heading-64">2. 避免在遍历中修改数组</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 不推荐：在 forEach 中修改数组长度</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
numbers.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">num, index</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (num % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    numbers.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>); <span class="hljs-comment">// 危险！会跳过元素</span>
  }
});

<span class="hljs-comment">// ✅ 推荐：使用 filter</span>
<span class="hljs-keyword">const</span> numbers2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> odds = numbers2.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">num</span> =&gt;</span> num % <span class="hljs-number">2</span> !== <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-65">3. 使用解构赋值</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 交换变量</span>
<span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span>;
[a, b] = [b, a];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b); <span class="hljs-comment">// 2, 1</span>

<span class="hljs-comment">// 获取第一个和剩余元素</span>
<span class="hljs-keyword">const</span> [first, ...rest] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(first); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rest); <span class="hljs-comment">// [2, 3, 4, 5]</span>
</code></pre>
<h4 data-id="heading-66">4. 性能优化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 不推荐：多次遍历</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> evens = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> doubled = evens.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n * <span class="hljs-number">2</span>);
<span class="hljs-keyword">const</span> sum = doubled.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);

<span class="hljs-comment">// ✅ 推荐：单次遍历</span>
<span class="hljs-keyword">const</span> sum2 = numbers
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n * <span class="hljs-number">2</span>)
  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);

<span class="hljs-comment">// ✅ 更推荐：使用 reduce 一次完成</span>
<span class="hljs-keyword">const</span> sum3 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, n</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> acc + n * <span class="hljs-number">2</span>;
  }
  <span class="hljs-keyword">return</span> acc;
}, <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-67">5. 处理空值和边界情况</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 安全的数组操作</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">safeArrayOperation</span>(<span class="hljs-params">arr</span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(arr) || arr.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> [];
  }
  <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item * <span class="hljs-number">2</span>);
}

<span class="hljs-comment">// 使用可选链和空值合并</span>
<span class="hljs-keyword">const</span> result = array?.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>) ?? [];
</code></pre>
<h4 data-id="heading-68">6. 数组去重</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方法 1：使用 Set</span>
<span class="hljs-keyword">const</span> unique1 = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>])];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(unique1); <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 方法 2：使用 filter + indexOf</span>
<span class="hljs-keyword">const</span> unique2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>].<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index, arr</span>) =&gt;</span> 
  arr.<span class="hljs-title function_">indexOf</span>(item) === index
);

<span class="hljs-comment">// 方法 3：对象数组去重</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> }
];
<span class="hljs-keyword">const</span> uniqueUsers = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">user, index, arr</span>) =&gt;</span> 
  arr.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === user.<span class="hljs-property">id</span>) === index
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(uniqueUsers); <span class="hljs-comment">// [{ id: 1, name: 'Alice' }, { id: 2, name: 'Bob' }]</span>

<span class="hljs-comment">// 方法 4：使用 Map（性能更好）</span>
<span class="hljs-keyword">const</span> uniqueUsers2 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> [user.<span class="hljs-property">id</span>, user])).<span class="hljs-title function_">values</span>()
);
</code></pre>
<h4 data-id="heading-69">7. 数组分组</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 reduce 实现分组</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">'Beijing'</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">'Shanghai'</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">'Beijing'</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'David'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">'Shanghai'</span> }
];

<span class="hljs-comment">// 按城市分组</span>
<span class="hljs-keyword">const</span> groupedByCity = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> city = user.<span class="hljs-property">city</span>;
  <span class="hljs-keyword">if</span> (!acc[city]) {
    acc[city] = [];
  }
  acc[city].<span class="hljs-title function_">push</span>(user);
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(groupedByCity);
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   Beijing: [{ name: 'Alice', ... }, { name: 'Charlie', ... }],</span>
<span class="hljs-comment">//   Shanghai: [{ name: 'Bob', ... }, { name: 'David', ... }]</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 按年龄分组</span>
<span class="hljs-keyword">const</span> groupedByAge = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> age = user.<span class="hljs-property">age</span>;
  acc[age] = acc[age] || [];
  acc[age].<span class="hljs-title function_">push</span>(user);
  <span class="hljs-keyword">return</span> acc;
}, {});
</code></pre>
<h4 data-id="heading-70">8. 数组分块</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 将数组分割成指定大小的块</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">chunk</span>(<span class="hljs-params">array, size</span>) {
  <span class="hljs-keyword">const</span> chunks = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; array.<span class="hljs-property">length</span>; i += size) {
    chunks.<span class="hljs-title function_">push</span>(array.<span class="hljs-title function_">slice</span>(i, i + size));
  }
  <span class="hljs-keyword">return</span> chunks;
}

<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">chunk</span>(numbers, <span class="hljs-number">3</span>)); <span class="hljs-comment">// [[1, 2, 3], [4, 5, 6], [7, 8, 9]]</span>

<span class="hljs-comment">// 使用 reduce 实现</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">chunk2</span> = (<span class="hljs-params">array, size</span>) =&gt; 
  array.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, _, i</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (i % size === <span class="hljs-number">0</span>) {
      acc.<span class="hljs-title function_">push</span>(array.<span class="hljs-title function_">slice</span>(i, i + size));
    }
    <span class="hljs-keyword">return</span> acc;
  }, []);
</code></pre>
<h4 data-id="heading-71">9. 数组合并</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// concat() - 合并数组（不修改原数组）</span>
<span class="hljs-keyword">const</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];
<span class="hljs-keyword">const</span> arr3 = arr1.<span class="hljs-title function_">concat</span>(arr2);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr3); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr1); <span class="hljs-comment">// [1, 2, 3] 原数组不变</span>

<span class="hljs-comment">// 使用扩展运算符（推荐）</span>
<span class="hljs-keyword">const</span> arr4 = [...arr1, ...arr2];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr4); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>

<span class="hljs-comment">// 合并多个数组</span>
<span class="hljs-keyword">const</span> arr5 = [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];
<span class="hljs-keyword">const</span> merged = [...arr1, ...arr2, ...arr5];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(merged); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</code></pre>
<h4 data-id="heading-72">10. 数组交集、并集、差集</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>];

<span class="hljs-comment">// 交集：两个数组都有的元素</span>
<span class="hljs-keyword">const</span> intersection = arr1.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> arr2.<span class="hljs-title function_">includes</span>(item));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(intersection); <span class="hljs-comment">// [4, 5]</span>

<span class="hljs-comment">// 并集：两个数组的所有元素（去重）</span>
<span class="hljs-keyword">const</span> union = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([...arr1, ...arr2])];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(union); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7, 8]</span>

<span class="hljs-comment">// 差集：arr1 有但 arr2 没有的元素</span>
<span class="hljs-keyword">const</span> difference = arr1.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !arr2.<span class="hljs-title function_">includes</span>(item));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(difference); <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 对称差集：两个数组独有的元素</span>
<span class="hljs-keyword">const</span> symmetricDifference = [
  ...arr1.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !arr2.<span class="hljs-title function_">includes</span>(item)),
  ...arr2.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> !arr1.<span class="hljs-title function_">includes</span>(item))
];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(symmetricDifference); <span class="hljs-comment">// [1, 2, 3, 6, 7, 8]</span>
</code></pre>
<h4 data-id="heading-73">11. 数组随机打乱</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Fisher-Yates 洗牌算法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">shuffle</span>(<span class="hljs-params">array</span>) {
  <span class="hljs-keyword">const</span> arr = [...array]; <span class="hljs-comment">// 避免修改原数组</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = arr.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i--) {
    <span class="hljs-keyword">const</span> j = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * (i + <span class="hljs-number">1</span>));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  <span class="hljs-keyword">return</span> arr;
}

<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">shuffle</span>(numbers)); <span class="hljs-comment">// 随机顺序</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(numbers); <span class="hljs-comment">// [1, 2, 3, 4, 5] 原数组不变</span>
</code></pre>
<h4 data-id="heading-74">12. 数组扁平化（多种方法）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nested = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]]];

<span class="hljs-comment">// 方法 1：使用 flat()</span>
<span class="hljs-keyword">const</span> flat1 = nested.<span class="hljs-title function_">flat</span>(<span class="hljs-title class_">Infinity</span>);

<span class="hljs-comment">// 方法 2：使用 reduce + concat</span>
<span class="hljs-keyword">const</span> flat2 = nested.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, cur</span>) =&gt;</span> 
  acc.<span class="hljs-title function_">concat</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(cur) ? <span class="hljs-title function_">flat2</span>(cur) : cur), []
);

<span class="hljs-comment">// 方法 3：使用扩展运算符（仅一层）</span>
<span class="hljs-keyword">const</span> flat3 = [].<span class="hljs-title function_">concat</span>(...nested);

<span class="hljs-comment">// 方法 4：使用 toString()（仅适用于数字）</span>
<span class="hljs-keyword">const</span> numbers = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]];
<span class="hljs-keyword">const</span> flat4 = numbers.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">map</span>(<span class="hljs-title class_">Number</span>);
</code></pre>
<h4 data-id="heading-75">13. 数组统计</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// 求和</span>
<span class="hljs-keyword">const</span> sum = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 平均值</span>
<span class="hljs-keyword">const</span> average = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) / numbers.<span class="hljs-property">length</span>;

<span class="hljs-comment">// 最大值和最小值</span>
<span class="hljs-keyword">const</span> max = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...numbers);
<span class="hljs-keyword">const</span> min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...numbers);

<span class="hljs-comment">// 使用 reduce 求最大值和最小值</span>
<span class="hljs-keyword">const</span> max2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(a, b));
<span class="hljs-keyword">const</span> min2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(a, b));

<span class="hljs-comment">// 统计元素出现次数</span>
<span class="hljs-keyword">const</span> count = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, num</span>) =&gt;</span> {
  acc[num] = (acc[num] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
</code></pre>
<h4 data-id="heading-76">14. 数组转对象</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 键值对数组转对象</span>
<span class="hljs-keyword">const</span> entries = [[<span class="hljs-string">'name'</span>, <span class="hljs-string">'Alice'</span>], [<span class="hljs-string">'age'</span>, <span class="hljs-number">25</span>], [<span class="hljs-string">'city'</span>, <span class="hljs-string">'Beijing'</span>]];
<span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(entries);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj); <span class="hljs-comment">// { name: 'Alice', age: 25, city: 'Beijing' }</span>

<span class="hljs-comment">// 对象数组转对象（以某个属性为键）</span>
<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span> }
];
<span class="hljs-keyword">const</span> userMap = users.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, user</span>) =&gt;</span> {
  acc[user.<span class="hljs-property">id</span>] = user;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userMap);
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   1: { id: 1, name: 'Alice' },</span>
<span class="hljs-comment">//   2: { id: 2, name: 'Bob' },</span>
<span class="hljs-comment">//   3: { id: 3, name: 'Charlie' }</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h4 data-id="heading-77">15. 数组补全方法补充</h4>
<h5 data-id="heading-78">concat() - 合并数组</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];

<span class="hljs-comment">// 合并数组</span>
<span class="hljs-keyword">const</span> merged = arr1.<span class="hljs-title function_">concat</span>(arr2);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(merged); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>

<span class="hljs-comment">// 可以合并多个数组</span>
<span class="hljs-keyword">const</span> arr3 = [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];
<span class="hljs-keyword">const</span> all = arr1.<span class="hljs-title function_">concat</span>(arr2, arr3);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(all); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7, 8, 9]</span>

<span class="hljs-comment">// 也可以合并值</span>
<span class="hljs-keyword">const</span> withValues = arr1.<span class="hljs-title function_">concat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, [<span class="hljs-number">6</span>, <span class="hljs-number">7</span>]);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(withValues); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6, 7]</span>
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li><strong>不修改原数组</strong></li>
<li>返回新数组</li>
<li>可以合并多个数组或值</li>
</ul>
<hr/>
<h3 data-id="heading-79">常见应用场景</h3>
<h4 data-id="heading-80">场景 1：数据处理和转换</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从 API 获取数据后处理</span>
<span class="hljs-keyword">const</span> apiData = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'inactive'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Charlie'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> }
];

<span class="hljs-comment">// 提取活跃用户的名字</span>
<span class="hljs-keyword">const</span> activeUsers = apiData
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">name</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(activeUsers); <span class="hljs-comment">// ['Alice', 'Charlie']</span>
</code></pre>
<h4 data-id="heading-81">场景 2：表单验证</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 验证表单字段</span>
<span class="hljs-keyword">const</span> formFields = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'username'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'alice'</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'25'</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span> }
];

<span class="hljs-comment">// 检查必填字段是否都已填写</span>
<span class="hljs-keyword">const</span> isValid = formFields
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.<span class="hljs-property">required</span>)
  .<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> field.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isValid); <span class="hljs-comment">// false（email 为空）</span>
</code></pre>
<h4 data-id="heading-82">场景 3：购物车计算</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cart = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'商品A'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">2</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'商品B'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">1</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'商品C'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">3</span> }
];

<span class="hljs-comment">// 计算总价</span>
<span class="hljs-keyword">const</span> total = cart.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> 
  sum + item.<span class="hljs-property">price</span> * item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(total); <span class="hljs-comment">// 450</span>

<span class="hljs-comment">// 计算商品总数</span>
<span class="hljs-keyword">const</span> totalQuantity = cart.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> 
  sum + item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(totalQuantity); <span class="hljs-comment">// 6</span>
</code></pre>
<h4 data-id="heading-83">场景 4：数据筛选和搜索</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> products = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'手机'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">5000</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPad'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'平板'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">3000</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'MacBook'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'电脑'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">10000</span> }
];

<span class="hljs-comment">// 按价格筛选</span>
<span class="hljs-keyword">const</span> affordable = products.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">price</span> &lt; <span class="hljs-number">5000</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(affordable); <span class="hljs-comment">// [{ id: 2, name: 'iPad', ... }]</span>

<span class="hljs-comment">// 搜索功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">searchProducts</span>(<span class="hljs-params">products, keyword</span>) {
  <span class="hljs-keyword">return</span> products.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> 
    product.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(keyword.<span class="hljs-title function_">toLowerCase</span>())
  );
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">searchProducts</span>(products, <span class="hljs-string">'phone'</span>)); 
<span class="hljs-comment">// [{ id: 1, name: 'iPhone', ... }]</span>
</code></pre>
<h4 data-id="heading-84">场景 5：数据分组和聚合</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> orders = [
  { <span class="hljs-attr">date</span>: <span class="hljs-string">'2024-01-01'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'电子产品'</span> },
  { <span class="hljs-attr">date</span>: <span class="hljs-string">'2024-01-01'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'食品'</span> },
  { <span class="hljs-attr">date</span>: <span class="hljs-string">'2024-01-02'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'电子产品'</span> },
  { <span class="hljs-attr">date</span>: <span class="hljs-string">'2024-01-02'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'食品'</span> }
];

<span class="hljs-comment">// 按日期分组并计算总金额</span>
<span class="hljs-keyword">const</span> dailyTotal = orders.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, order</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> date = order.<span class="hljs-property">date</span>;
  acc[date] = (acc[date] || <span class="hljs-number">0</span>) + order.<span class="hljs-property">amount</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dailyTotal);
<span class="hljs-comment">// { '2024-01-01': 150, '2024-01-02': 230 }</span>

<span class="hljs-comment">// 按类别分组</span>
<span class="hljs-keyword">const</span> categoryTotal = orders.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, order</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> category = order.<span class="hljs-property">category</span>;
  acc[category] = (acc[category] || <span class="hljs-number">0</span>) + order.<span class="hljs-property">amount</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(categoryTotal);
<span class="hljs-comment">// { '电子产品': 300, '食品': 80 }</span>
</code></pre>
<hr/>
<h3 data-id="heading-85">性能注意事项</h3>
<h4 data-id="heading-86">1. 方法选择</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 性能较差：多次遍历</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> evens = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> doubled = evens.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n * <span class="hljs-number">2</span>);

<span class="hljs-comment">// ✅ 性能较好：单次遍历</span>
<span class="hljs-keyword">const</span> doubled2 = numbers.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, n</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
    acc.<span class="hljs-title function_">push</span>(n * <span class="hljs-number">2</span>);
  }
  <span class="hljs-keyword">return</span> acc;
}, []);
</code></pre>
<h4 data-id="heading-87">2. 大数组处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 对于大数组，考虑使用 for 循环</span>
<span class="hljs-keyword">const</span> largeArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i);

<span class="hljs-comment">// ❌ 可能较慢</span>
<span class="hljs-keyword">const</span> result1 = largeArray.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>);

<span class="hljs-comment">// ✅ 可能更快</span>
<span class="hljs-keyword">const</span> result2 = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; largeArray.<span class="hljs-property">length</span>; i++) {
  result2[i] = largeArray[i] * <span class="hljs-number">2</span>;
}
</code></pre>
<h4 data-id="heading-88">3. 提前退出</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 some() 或 find() 可以提前退出</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];

<span class="hljs-comment">// ✅ 找到第一个偶数就停止</span>
<span class="hljs-keyword">const</span> firstEven = numbers.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>);

<span class="hljs-comment">// ❌ 会遍历所有元素</span>
<span class="hljs-keyword">const</span> firstEven2 = numbers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>)[<span class="hljs-number">0</span>];
</code></pre>
<hr/>
<h3 data-id="heading-89">总结</h3>
<p>JavaScript 数组提供了丰富而强大的方法，掌握这些方法可以大大提高开发效率。以下是关键要点：</p>
<h4 data-id="heading-90">核心方法分类</h4>
<ol>
<li><strong>增删改查</strong>：<code>push</code>, <code>pop</code>, <code>shift</code>, <code>unshift</code>, <code>splice</code>, <code>slice</code></li>
<li><strong>遍历转换</strong>：<code>forEach</code>, <code>map</code>, <code>filter</code>, <code>reduce</code></li>
<li><strong>查找判断</strong>：<code>find</code>, <code>findIndex</code>, <code>includes</code>, <code>some</code>, <code>every</code></li>
<li><strong>排序反转</strong>：<code>sort</code>, <code>reverse</code>, <code>toSorted</code>, <code>toReversed</code></li>
<li><strong>转换方法</strong>：<code>join</code>, <code>flat</code>, <code>flatMap</code>, <code>concat</code></li>
</ol>
<h4 data-id="heading-91">选择原则</h4>
<ul>
<li><strong>优先使用不修改原数组的方法</strong>（函数式编程）</li>
<li><strong>根据需求选择合适的方法</strong>（查找用 <code>find</code>，判断用 <code>some/every</code>）</li>
<li><strong>链式调用提高代码可读性</strong></li>
<li><strong>注意性能，大数组考虑使用传统循环</strong></li>
</ul>
<h4 data-id="heading-92">最佳实践</h4>
<ol>
<li>✅ 使用 <code>map</code> 转换数组</li>
<li>✅ 使用 <code>filter</code> 过滤数组</li>
<li>✅ 使用 <code>reduce</code> 进行复杂计算</li>
<li>✅ 使用 <code>find</code> 查找元素</li>
<li>✅ 使用 <code>includes</code> 判断存在性</li>
<li>❌ 避免在遍历中修改数组</li>
<li>❌ 避免不必要的多次遍历</li>
</ol>
<h4 data-id="heading-93">学习建议</h4>
<ol>
<li><strong>理解每个方法的返回值</strong>：是否修改原数组、返回什么类型</li>
<li><strong>掌握链式调用</strong>：组合使用多个方法</li>
<li><strong>熟悉常见场景</strong>：去重、分组、统计等</li>
<li><strong>注意边界情况</strong>：空数组、undefined、null 等</li>
<li><strong>关注性能</strong>：大数组时选择合适的方法</li>
</ol>
<p>希望这篇指南能帮助你更好地掌握 JavaScript 数组方法，在实际开发中灵活运用！</p>
<hr/>
<h3 data-id="heading-94">参考资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" ref="nofollow noopener noreferrer">MDN Array 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F" target="_blank" title="https://tc39.es/ecma262/" ref="nofollow noopener noreferrer">ECMAScript 规范</a></li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Solidity 学习历程]]></title>    <link>https://juejin.cn/post/7571005216910868499</link>    <guid>https://juejin.cn/post/7571005216910868499</guid>    <pubDate>2025-11-11T06:41:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910868499" data-draft-id="7570995368739438634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Solidity 学习历程"/> <meta itemprop="keywords" content="Solidity"/> <meta itemprop="datePublished" content="2025-11-11T06:41:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cainiaoeba"/> <meta itemprop="url" content="https://juejin.cn/user/4302806371543898"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Solidity 学习历程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4302806371543898/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cainiaoeba
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:41:53.000Z" title="Tue Nov 11 2025 06:41:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h3 data-id="heading-0">从计数器到投票站：我的Solidity智能合约入门三部曲</h3>
<p>大家好，我是C。最近我一头扎进了Web3的世界，从最基础的Solidity智能合约开始学起。学习曲线或许陡峭，但每当一个合约在测试链上成功运行，那种成就感是无与伦比的。</p>
<p>今天，我想和大家分享我的入门学习路径——三个难度递增的经典合约：<strong>点击计数器 (ClickCounter)</strong>、<strong>名字存储器 (SaveMyName)</strong> 和 <strong>投票站 (PollStation)</strong>。这“三部曲”就像是为新手铺设的阶梯，每一步都建立在前一步的基础上，让你平滑地掌握核心概念。</p>
<p>希望这篇文章能像一本清晰的笔记，帮助正在入门的你，也欢迎各位大佬指点！</p>
<hr/>
<h4 data-id="heading-1">第一站：ClickCounter - 智能合约的 "Hello, World!"</h4>
<p>万事开头难，但<code>ClickCounter</code>合约完美地解决了这个问题。它的功能极其简单：在区块链上记录一个数字，并且允许任何人调用一个函数来让这个数字加一。这不就是我们学习任何编程语言时都会写的计数器吗？但在区块链上，它有了全新的意义。</p>
<p><strong>核心知识点：</strong></p>
<ol>
<li><strong>状态变量（State Variables）</strong>: 存储在区块链上的数据。</li>
<li><strong>函数（Functions）</strong>: 与合约交互的入口。</li>
<li><code>public</code> <strong>可见性修饰符</strong>: 允许任何人（包括外部账户和其他合约）调用或读取。</li>
</ol>
<p><strong>合约代码解析：</strong></p>
<p>下面是<code>ClickCounter</code>的完整代码，它非常简洁，是理解合约基本结构的绝佳范例。</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/**
 * @title ClickCounter
 * @dev 一个简单的计数器合约，每次调用increment函数，count就会加1。
 */
contract ClickCounter {
    // 定义一个名为 count 的公共无符号整型变量
    // `public` 关键字会自动为我们创建一个同名的 getter 函数 (count())
    uint public count;

    /**
     * @dev 构造函数，在合约部署时执行一次。
     *      这里我们将 count 初始化为 0。
     */
    constructor() {
        count = 0;
    }

    /**
     * @dev 将 count 的值加 1。
     *      这是一个会修改状态的函数，所以它是一笔“交易”(Transaction)。
     */
    function increment() public {
        count++;
    }
}
</code></pre>
<p><strong>学习总结：</strong>
通过这个合约，我第一次理解了什么是“状态”。<code>count</code>变量的值被永久地记录在了区块链上，任何人都可以通过读取<code>count()</code>来查看它的当前值。而每次调用<code>increment()</code>函数，都是在发起一笔交易（Transaction），这笔交易会消耗Gas，因为它改变了链上的状态。</p>
<p>这个小小的计数器，让我直观地感受到了区块链的“全局共享状态机”这个概念。</p>
<hr/>
<h4 data-id="heading-2">第二站：SaveMyName - 开始与字符串和映射打交道</h4>
<p>掌握了基础的数字操作后，我们进入第二站：<code>SaveMyName</code>。这个合约的功能是让每个用户（由他们的以太坊地址标识）都能在链上存储一个属于自己的名字（字符串）。</p>
<p><strong>核心知识点：</strong></p>
<ol>
<li><strong>字符串（string）</strong>: Solidity中的一种数据类型，用于存储文本。</li>
<li><strong>映射（Mapping）</strong>: 强大的键值对存储结构，类似其他语言中的哈希表或字典。</li>
<li><code>address</code>: 以太坊账户地址的专属类型。</li>
<li><code>msg.sender</code>: 一个全局变量，代表当前调用函数的账户地址。</li>
</ol>
<p><strong>合约代码解析：</strong></p>
<p>这个合约引入了<code>mapping</code>，这是Solidity中极其重要和常用的数据结构，完美地用于“一个地址对应一个数据”的场景。</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/**
 * @title SaveMyName
 * @dev 允许每个地址存储一个与之关联的名字。
 */
contract SaveMyName {
    // 定义一个映射，键是 address 类型，值是 string 类型
    // `names` 将存储从用户地址到其名字的映射关系
    mapping(address =&gt; string) public names;

    /**
     * @dev 存储调用者的名字。
     * @param _name 要存储的名字字符串。
     *      注意：函数参数需要指定内存位置，对于 string 类型通常是 `memory` 或 `calldata`。
     */
    function saveName(string memory _name) public {
        // msg.sender 是一个全局变量，代表调用此函数的账户地址
        // 这行代码将调用者的地址和他传入的名字关联起来
        names[msg.sender] = _name;
    }

    /**
     * @dev 读取指定地址的名字。
     * @param _userAddress 要查询的地址。
     * @return 返回该地址存储的名字。
     *      `view` 关键字表示这是一个只读函数，不修改状态，调用它不需要消耗Gas。
     */
    function getName(address _userAddress) public view returns (string memory) {
        return names[_userAddress];
    }
}
</code></pre>
<p><strong>学习总结：</strong>
<code>SaveMyName</code>合约让我领悟到了智能合约如何实现“身份”与“数据”的绑定。通过<code>mapping(address =&gt; string)</code>，我们创造了一个去中心化的数据库。<code>msg.sender</code>的使用是关键，它确保了用户只能修改属于自己的数据，这是构建多用户DApp的基础。</p>
<p>同时，<code>view</code>函数的概念也让我明白了读（Read）操作和写（Write）操作的区别。读操作是免费的，而写操作需要支付Gas费，这是区块链经济模型的核心之一。</p>
<hr/>
<h4 data-id="heading-3">第三站：PollStation - 构建一个简单的去中心化应用</h4>
<p>前两站是基础，第三站<code>PollStation</code>则是一个小型的“应用”了。它实现了一个简单的投票系统，具备以下功能：</p>
<ul>
<li>任何人都可以创建一个投票提案。</li>
<li>每个地址只能对一个提案投一票。</li>
<li>可以查询每个提案的票数。</li>
</ul>
<p><strong>核心知识点：</strong></p>
<ol>
<li><strong>结构体（Struct）</strong>: 用于定义复杂的数据类型，将多个变量组合在一起。</li>
<li><strong>数组（Array）</strong>: 用于存储一系列同类型的数据。</li>
<li><code>require()</code>: 用于检查条件，如果条件不满足，则撤销交易。这是保证合约逻辑正确性的重要工具。</li>
<li>事件（Events）: 用于在链上留下“日志”，方便前端应用监听合约状态的变化。</li>
</ol>
<p><strong>合约代码解析：</strong></p>
<p>这个合约的复杂性明显提升，它组合运用了前面学到的所有知识，并引入了结构体和数组来管理更复杂的数据。</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/**
 * @title PollStation
 * @dev 一个简单的投票站合约。
 */
contract PollStation {
    // 定义一个结构体来表示一个投票提案
    struct Poll {
        string proposal; // 提案内容
        uint voteCount;  // 获得的票数
    }

    // 存储所有投票提案的动态数组
    Poll[] public polls;

    // 记录每个地址是否已经投过票
    // mapping(address =&gt; bool) private hasVoted; // 这个设计有缺陷，应针对每个提案
    // 更好的设计：记录每个用户对每个提案的投票状态
    mapping(uint =&gt; mapping(address =&gt; bool)) private hasVotedForPoll;

    // 定义一个事件，当有新投票时触发
    event Voted(uint indexed _pollId, address indexed _voter);

    /**
     * @dev 创建一个新的投票提案。
     * @param _proposal 提案的描述内容。
     */
    function createPoll(string memory _proposal) public {
        polls.push(Poll({
            proposal: _proposal,
            voteCount: 0
        }));
    }

    /**
     * @dev 为指定的提案投票。
     * @param _pollId 提案的ID (即它在数组中的索引)。
     */
    function vote(uint _pollId) public {
        // 检查提案ID是否存在
        require(_pollId &lt; polls.length, "Poll does not exist.");
        // 检查该地址是否已经对这个提案投过票
        require(!hasVotedForPoll[_pollId][msg.sender], "You have already voted for this poll.");

        // 标记该地址已投票
        hasVotedForPoll[_pollId][msg.sender] = true;
        // 对应提案的票数加 1
        polls[_pollId].voteCount++;

        // 触发投票事件
        emit Voted(_pollId, msg.sender);
    }

    /**
     * @dev 获取提案总数。
     * @return 返回当前有多少个提案。
     */
    function getPollsCount() public view returns (uint) {
        return polls.length;
    }
}
</code></pre>
<p><strong>学习总结：</strong>
<code>PollStation</code>是一个里程碑。它让我不再是简单地存储数据，而是开始构建有实际业务逻辑的应用。</p>
<ul>
<li><code>struct</code>和<code>array</code>的组合，让我学会了如何组织和管理复杂的数据集合。</li>
<li><code>require()</code>的使用，让我深刻体会到智能合约编程的严谨性——“Code is Law”，我们必须在代码层面处理掉所有无效的操作，以防资产损失或逻辑错误。</li>
<li><code>event</code>的引入，为智能合约和前端应用的交互打开了一扇窗。前端可以通过监听这些事件，来实时更新UI，而无需不断地轮询查询合约状态。</li>
</ul>
<hr/>
<h4 data-id="heading-4">反思与展望</h4>
<p>从<code>ClickCounter</code>的单个状态变量，到<code>SaveMyName</code>的键值对映射，再到<code>PollStation</code>中结构体、数组和事件的综合运用，这三个合约清晰地勾勒出了一条从入门到实践的学习路径。</p>
<p>这个过程让我明白，学习Solidity不仅仅是学习一门新的编程语言。更重要的是，它要求我们转变思维方式——从中心化服务器的思维，转变为在去中心化、透明、不可篡改的环境下构建应用的思维。你需要时刻考虑Gas消耗、交易的原子性以及安全性问题。</p>
<p>这“三部曲”仅仅是开始。接下来，还有ERC20代币标准、ERC721的NFT、DeFi协议等更广阔的世界等待我们去探索。</p>
<p>如果你也对Web3和智能合约开发感兴趣，不妨也从这三个小合约开始，动手敲一遍代码，部署到测试网亲自交互一下。相信我，你会收获良多！</p>
<p>感谢阅读，期待在Web3的世界里与你相遇！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kubernetes无缝集成Harbor，实现CI/CD流水线]]></title>    <link>https://juejin.cn/post/7571005216910917651</link>    <guid>https://juejin.cn/post/7571005216910917651</guid>    <pubDate>2025-11-11T06:45:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910917651" data-draft-id="7571304204720521270" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kubernetes无缝集成Harbor，实现CI/CD流水线"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T06:45:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kubernetes无缝集成Harbor，实现CI/CD流水线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:45:57.000Z" title="Tue Nov 11 2025 06:45:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Harbor 作为企业级的容器镜像仓库，在 Kubernetes 生态中扮演着核心的镜像管理角色。下面这个表格能帮你快速抓住其核心价值和在案例中的体现：</p>






























<table><thead><tr><th>特性维度</th><th>核心价值</th><th>在线书店案例体现</th></tr></thead><tbody><tr><td><strong>统一镜像源</strong></td><td>为集群所有节点提供稳定、快速的私有镜像拉取源，避免依赖公网。</td><td>所有服务镜像（如<code>book-service</code>, <code>user-service</code>）均从内部Harbor拉取。</td></tr><tr><td><strong>基于项目的访问控制 (RBAC)</strong></td><td>实现镜像的权限隔离，不同团队管理各自项目。</td><td>为前端、后端团队创建独立项目，成员只能访问被授权的项目。</td></tr><tr><td><strong>安全扫描</strong></td><td>集成漏洞扫描工具，提升供应链安全。</td><td>推送镜像时自动扫描，阻止含高危漏洞的镜像部署。</td></tr><tr><td><strong>高可用与持久化</strong></td><td>确保镜像仓库稳定运行，数据不丢失。</td><td>采用外部对象存储和数据库，即使Pod重建数据也完好。</td></tr></tbody></table>
<p>下面，我们以一个名为“BookStore”的<strong>在线书店微服务项目</strong>为例，详细介绍如何从零搭建Harbor，并将其无缝集成到Kubernetes集群中，实现CI/CD流水线。</p>
<h3 data-id="heading-0">🔧 安装与配置 Harbor</h3>
<h4 data-id="heading-1">1. 选择部署模式与前提准备</h4>
<p>首先，根据你的环境选择最合适的部署方式：</p>




















<table><thead><tr><th>部署方式</th><th>适用场景</th><th>关键步骤/命令</th></tr></thead><tbody><tr><td><strong>Helm Chart (K8s内)</strong></td><td>生产环境，希望与K8s统一管理。</td><td><code>helm repo add harbor https://helm.goharbor.io</code></td></tr><tr><td><strong>Docker Compose</strong></td><td>开发、测试环境，快速独立部署。</td><td>下载离线包，编辑<code>harbor.yml</code>，运行<code>./install.sh</code>。</td></tr></tbody></table>
<p><strong>前提准备</strong>：确保你的服务器已安装符合版本的 Docker 和 Docker Compose 。</p>
<h4 data-id="heading-2">2. 关键配置详解</h4>
<p>在启动安装前，需要仔细配置 <code>harbor.yml</code>（Docker Compose方式）或自定义的 <code>values.yaml</code>（Helm方式）。以下是几个关键配置点：</p>
<ul>
<li><strong>外部访问与证书</strong>：生产环境<strong>必须启用HTTPS</strong>。</li>
<li><strong>持久化存储</strong>：必须为 Harbor 配置持久化存储，以防止数据丢失 。</li>
<li><strong>管理员密码</strong>：<strong>务必修改</strong>默认的管理员密码（<code>harborAdminPassword</code>）。</li>
</ul>
<p>配置完成后，执行安装脚本（Docker Compose方式）或 Helm 命令即可启动所有服务。通过 <code>docker-compose ps</code>或 <code>kubectl get pods -n harbor</code>确认所有组件状态为 <code>Running</code>或 <code>Ready</code>。</p>
<h3 data-id="heading-3">📥 集成 Harbor 与 Kubernetes</h3>
<p>要让 Kubernetes 集群能够从私有的 Harbor 仓库拉取镜像，需要进行如下配置，其核心流程是通过创建一个包含 Harbor 认证信息的 Secret 来实现的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/133069af87f241478f63a34349a6ca97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTmqZjlrZDnmq4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763449386&amp;x-signature=kZ%2FcDl5oriUEeH35KHZ2Pbvea1w%3D" alt="image.png" loading="lazy"/></p>
<p>具体操作步骤如下：</p>
<ol>
<li>
<p><strong>创建镜像拉取密钥（ImagePullSecret）</strong></p>
<p>在打算部署应用的命名空间下，创建一个 <code>docker-registry</code>类型的 Secret 。</p>
<pre><code class="hljs language-ini" lang="ini">kubectl create secret docker-registry harbor-regcred \
  <span class="hljs-attr">--docker-server</span>=harbor.yourcompany.com \
  <span class="hljs-attr">--docker-username</span>=admin \
  <span class="hljs-attr">--docker-password</span>=yourpassword \
  <span class="hljs-attr">--namespace</span>=your-namespace
</code></pre>
</li>
<li>
<p><strong>在应用部署中引用该 Secret</strong></p>
<p>在你的 Deployment YAML 中，通过 <code>imagePullSecrets</code>字段指明使用刚才创建的 Secret 。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">book-service</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">book-service</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">harbor.yourcompany.com/bookstore/book-service:v1.0.0</span> <span class="hljs-comment"># 必须是完整地址</span>
      <span class="hljs-attr">imagePullSecrets:</span> <span class="hljs-comment"># 引用密钥</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harbor-regcred</span>
</code></pre>
<p>请注意，<code>image</code>字段必须是 <strong>完整的镜像地址</strong>，包含仓库地址、项目路径和标签 。</p>
</li>
</ol>
<h3 data-id="heading-4">🚀 项目实战：在线书店的镜像管理</h3>
<p>假设你正在部署上述“在线书店”应用，它包含 <code>book-service</code>（图书服务）和 <code>user-service</code>（用户服务）。</p>
<ol>
<li>
<p><strong>在 Harbor 中创建项目</strong></p>
<p>登录 Harbor Web UI，为“在线书店”创建两个项目：<code>bookstore/backend</code>和 <code>bookstore/frontend</code>，并分别为后端和前端开发团队配置推送和拉取权限。</p>
</li>
<li>
<p><strong>推送镜像到 Harbor</strong></p>
<p>在 CI/CD 流水线或开发者本地，构建好镜像后，将其推送到 Harbor 对应的项目中 。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 为本地镜像打上符合Harbor规范的标签</span>
docker tag book-service:latest harbor.yourcompany.com/bookstore/backend/book-service:v1.0.0
<span class="hljs-comment"># 2. 登录Harbor（需要先在客户端配置信任证书或insecure-registry）</span>
docker login harbor.yourcompany.com
<span class="hljs-comment"># 3. 推送镜像</span>
docker push harbor.yourcompany.com/bookstore/backend/book-service:v1.0.0
</code></pre>
</li>
<li>
<p><strong>在 Kubernetes 中部署</strong></p>
<p>编写 Deployment YAML 文件，<code>image</code>字段指定为 Harbor 中的镜像地址，并正确引用 <code>imagePullSecrets</code>，然后应用配置 。</p>
<pre><code class="hljs">kubectl apply -f book-service-deployment.yaml -n bookstore
</code></pre>
</li>
</ol>
<h3 data-id="heading-5">🛡️ 企业级增强功能与高可用</h3>
<ul>
<li><strong>启用漏洞扫描</strong>：在 Harbor 中启用 Trivy 等扫描器，并配置策略，阻止携带高危漏洞的镜像被拉取 。</li>
<li><strong>高可用与性能优化</strong>：对于生产环境，应考虑 Harbor 组件本身的高可用 。</li>
</ul>
<h3 data-id="heading-6">🧩 常见问题排查 (Troubleshooting)</h3>
<ul>
<li>
<p><strong>Pod 状态为 <code>ImagePullBackOff</code>或 <code>ErrImagePull</code></strong>：</p>
<ul>
<li><strong>检查镜像地址和标签</strong>：使用 <code>docker pull &lt;镜像完整地址&gt;</code>在节点上手动测试。</li>
<li><strong>检查 Secret</strong>：确认 Secret 所在命名空间与 Pod 一致，且用户名密码正确。</li>
<li><strong>检查证书</strong>：确保 Kubernetes 节点信任 Harbor 的 HTTPS 证书 。</li>
</ul>
</li>
<li>
<p><strong>Harbor 服务无法访问</strong>：</p>
<ul>
<li>检查 Ingress Controller 或 NodePort 服务是否正常 。</li>
</ul>
</li>
<li>
<p><strong>推送镜像失败</strong>：</p>
<ul>
<li>检查客户端 Docker 守护进程的 <code>insecure-registries</code>配置（仅限 HTTP 或自签名证书测试环境）或是否信任了 Harbor 的 CA 证书 。</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Solidity代理合约：解锁区块链代码的灵活升级大法]]></title>    <link>https://juejin.cn/post/7571067260053422106</link>    <guid>https://juejin.cn/post/7571067260053422106</guid>    <pubDate>2025-11-11T06:57:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571067260053422106" data-draft-id="7571060853371519026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Solidity代理合约：解锁区块链代码的灵活升级大法"/> <meta itemprop="keywords" content="Solidity,智能合约,以太坊"/> <meta itemprop="datePublished" content="2025-11-11T06:57:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天涯学馆"/> <meta itemprop="url" content="https://juejin.cn/user/3394916565129287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Solidity代理合约：解锁区块链代码的灵活升级大法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394916565129287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天涯学馆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T06:57:28.000Z" title="Tue Nov 11 2025 06:57:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Solidity里的代理合约（Proxy Contract），这可是区块链开发里一个超级实用的技术，能让你的智能合约像手机系统一样支持“升级”，同时保持数据和地址不变。区块链的合约一旦部署，默认是不可变的，但用代理合约，你可以把逻辑和数据分开，随时替换逻辑合约，简直是开发者的救星！不过，代理合约也有坑，比如存储冲突、权限管理、调用安全等。</p>
<h2 data-id="heading-0">代理合约核心概念</h2>
<p>先来搞清楚几个关键点：</p>
<ul>
<li><strong>代理合约（Proxy）</strong>：一个中间层合约，负责接收调用并转发到逻辑合约（Implementation），存储数据在代理合约中。</li>
<li><strong>逻辑合约（Implementation）</strong>：包含实际业务逻辑，升级时替换这个合约。</li>
<li><strong>存储分离</strong>：代理合约存储数据，逻辑合约只提供代码，防止存储冲突。</li>
<li><strong>委托调用（delegatecall）</strong>：代理合约通过<code>delegatecall</code>调用逻辑合约，代码在逻辑合约执行，但上下文（存储、msg.sender等）属于代理合约。</li>
<li><strong>升级机制</strong>：通过更新逻辑合约地址实现功能升级，不改变代理合约地址。</li>
<li><strong>安全风险</strong>：
<ul>
<li><strong>存储冲突</strong>：逻辑合约的存储布局必须与代理一致。</li>
<li><strong>权限控制</strong>：谁能升级？没限制可能被黑客篡改。</li>
<li><strong>初始化</strong>：新逻辑合约需要正确初始化。</li>
</ul>
</li>
<li><strong>OpenZeppelin</strong>：提供标准的代理合约实现，如透明代理（Transparent Proxy）和UUPS（Universal Upgradeable Proxy Standard）。</li>
<li><strong>Solidity 0.8.x</strong>：自带溢出/下溢检查，配合OpenZeppelin确保安全。</li>
<li><strong>Hardhat</strong>：开发和测试工具，支持部署和验证。</li>
</ul>
<p>咱们用Solidity 0.8.20，结合OpenZeppelin和Hardhat，从简单代理到复杂UUPS实现，逐步打造安全的代理合约。</p>
<h2 data-id="heading-1">环境准备</h2>
<p>用Hardhat搭建开发环境，写和测试合约。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> proxy-demo
<span class="hljs-built_in">cd</span> proxy-demo
npm init -y
npm install --save-dev hardhat @nomicfoundation/hardhat-toolbox @openzeppelin/contracts @openzeppelin/contracts-upgradeable
npm install ethers
</code></pre>
<p>初始化Hardhat：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat init
</code></pre>
<p>选择TypeScript项目，安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev ts-node typescript @types/node @types/mocha
</code></pre>
<p>目录结构：</p>
<pre><code class="hljs language-lua" lang="lua">proxy-demo/
├── contracts/
│   ├── SimpleProxy.sol
│   ├── LogicV1.sol
│   ├── LogicV2.sol
│   ├── TransparentProxy.sol
│   ├── UUPSProxy.sol
├── scripts/
│   ├── deploy.ts
├── test/
│   ├── Proxy.test.ts
├── hardhat.<span class="hljs-built_in">config</span>.ts
├── tsconfig.json
├── <span class="hljs-built_in">package</span>.json
</code></pre>
<p><code>tsconfig.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CommonJS"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"resolveJsonModule"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"rootDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"hardhat.config.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"scripts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"test"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>hardhat.config.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">HardhatUserConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat/config"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"@nomicfoundation/hardhat-toolbox"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">HardhatUserConfig</span> = {
  <span class="hljs-attr">solidity</span>: <span class="hljs-string">"0.8.20"</span>,
  <span class="hljs-attr">networks</span>: {
    <span class="hljs-attr">hardhat</span>: {
      <span class="hljs-attr">chainId</span>: <span class="hljs-number">1337</span>,
    },
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> config;
</code></pre>
<p>跑本地节点：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat node
</code></pre>
<h2 data-id="heading-2">基础代理合约</h2>
<p>先写一个简单的代理合约，理解<code>delegatecall</code>和升级机制。</p>
<h3 data-id="heading-3">合约代码</h3>
<p><code>contracts/LogicV1.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract LogicV1 {
    address public owner;
    uint256 public value;

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/LogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract LogicV2 {
    address public owner;
    uint256 public value;

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value * 2; // V2: Double the value
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/SimpleProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract SimpleProxy {
    address public implementation;
    address public owner;

    constructor(address _implementation) {
        owner = msg.sender;
        implementation = _implementation;
    }

    function upgrade(address _newImplementation) public {
        require(msg.sender == owner, "Only owner");
        implementation = _newImplementation;
    }

    fallback() external payable {
        address impl = implementation;
        require(impl != address(0), "Implementation not set");

        assembly {
            let ptr := mload(0x40)
            calldatacopy(ptr, 0, calldatasize())
            let result := delegatecall(gas(), impl, ptr, calldatasize(), 0, 0)
            let size := returndatasize()
            returndatacopy(ptr, 0, size)
            switch result
            case 0 { revert(ptr, size) }
            default { return(ptr, size) }
        }
    }

    receive() external payable {}
}
</code></pre>
<h3 data-id="heading-4">解析</h3>
<ul>
<li><strong>LogicV1</strong>：
<ul>
<li>存储：<code>owner</code>（合约拥有者），<code>value</code>（一个数值）。</li>
<li><code>initialize</code>：设置<code>owner</code>，防止重复初始化。</li>
<li><code>setValue</code>：设置<code>value</code>，仅<code>owner</code>可调用。</li>
<li><code>getValue</code>：返回<code>value</code>。</li>
</ul>
</li>
<li><strong>LogicV2</strong>：升级版，<code>setValue</code>将输入值翻倍。</li>
<li><strong>SimpleProxy</strong>：
<ul>
<li>存储：<code>implementation</code>（逻辑合约地址），<code>owner</code>。</li>
<li><code>upgrade</code>：更新<code>implementation</code>，仅<code>owner</code>可调用。</li>
<li><code>fallback</code>：通过<code>delegatecall</code>转发调用到<code>implementation</code>，使用汇编确保低级调用。</li>
<li><code>receive</code>：接收ETH。</li>
</ul>
</li>
<li><strong>delegatecall</strong>：
<ul>
<li>执行<code>implementation</code>的代码，但使用代理合约的存储。</li>
<li>代理合约保存<code>owner</code>和<code>value</code>，逻辑合约只提供逻辑。</li>
</ul>
</li>
<li><strong>安全特性</strong>：
<ul>
<li><code>onlyOwner</code>限制升级。</li>
<li>检查<code>implementation</code>不为空。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">测试</h3>
<p><code>test/Proxy.test.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SimpleProxy</span>, <span class="hljs-title class_">LogicV1</span>, <span class="hljs-title class_">LogicV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"SimpleProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">SimpleProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">LogicV1</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">LogicV2</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"SimpleProxy"</span>);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-comment">// Initialize through proxy</span>
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">initialize</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value through proxy"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict setValue to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Only owner"</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">upgrade</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>); <span class="hljs-comment">// V2 doubles the value</span>
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>); <span class="hljs-comment">// Storage preserved</span>
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxy.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgrade</span>(logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Only owner"</span>);
  });
});
</code></pre>
<p>跑测试：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat <span class="hljs-built_in">test</span>
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>LogicV1</code>和<code>SimpleProxy</code>，通过代理调用<code>initialize</code>。</li>
<li>操作：通过代理设置<code>value</code>为42，验证存储在代理合约。</li>
<li>升级：切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20，<code>owner</code>保持不变。</li>
<li>权限：<code>addr1</code>无法升级。</li>
</ul>
</li>
<li><strong>存储</strong>：<code>owner</code>和<code>value</code>存储在代理合约的槽位，<code>delegatecall</code>确保逻辑合约操作代理的存储。</li>
</ul>
<h2 data-id="heading-6">存储冲突问题</h2>
<p>如果逻辑合约的存储布局变化，会导致数据错乱。</p>
<h3 data-id="heading-7">错误示例</h3>
<p><code>contracts/BadLogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract BadLogicV2 {
    uint256 public value; // Slot 0 (wrong order)
    address public owner; // Slot 1 (wrong order)

    function initialize(address _owner) public {
        require(owner == address(0), "Already initialized");
        owner = _owner;
    }

    function setValue(uint256 _value) public {
        require(msg.sender == owner, "Only owner");
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p>测试：</p>
<p><code>test/Proxy.test.ts</code>（添加）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">it</span>(<span class="hljs-string">"should fail with storage collision"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
  <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">BadLogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"BadLogicV2"</span>);
  <span class="hljs-keyword">const</span> badLogicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BadLogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> badLogicV2.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">upgrade</span>(badLogicV2.<span class="hljs-property">address</span>);
  <span class="hljs-keyword">const</span> proxyAsBadLogicV2 = <span class="hljs-title class_">BadLogicV2Factory</span>.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>);
  <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsBadLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-property">not</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>); <span class="hljs-comment">// Storage messed up</span>
});
</code></pre>
<ul>
<li><strong>问题</strong>：<code>LogicV1</code>的存储是<code>owner</code>(slot 0), <code>value</code>(slot 1)，<code>BadLogicV2</code>是<code>value</code>(slot 0), <code>owner</code>(slot 1)，升级后<code>owner</code>被覆盖为<code>value</code>的值。</li>
<li><strong>解决</strong>：新逻辑合约必须保持存储布局一致，或使用<code>storage</code>关键字显式声明槽位。</li>
</ul>
<h2 data-id="heading-8">透明代理（Transparent Proxy）</h2>
<p>用OpenZeppelin的透明代理，解决管理调用冲突。</p>
<p><code>contracts/LogicV1.sol</code>（更新，使用OpenZeppelin升级库）：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";

contract LogicV1 is Initializable, OwnableUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/LogicV2.sol</code>（更新）：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";

contract LogicV2 is Initializable, OwnableUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
</code></pre>
<p><code>contracts/TransparentProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/proxy/transparent/TransparentUpgradeableProxy.sol";

contract TransparentProxy is TransparentUpgradeableProxy {
    constructor(address logic, address admin, bytes memory data)
        TransparentUpgradeableProxy(logic, admin, data)
    {}
}
</code></pre>
<h3 data-id="heading-9">解析</h3>
<ul>
<li><strong>LogicV1/V2</strong>：
<ul>
<li>使用<code>Initializable</code>和<code>OwnableUpgradeable</code>，支持代理初始化。</li>
<li><code>initializer</code>修饰符确保初始化只执行一次。</li>
</ul>
</li>
<li><strong>TransparentProxy</strong>：
<ul>
<li>继承OpenZeppelin的<code>TransparentUpgradeableProxy</code>。</li>
<li>构造函数：设置逻辑合约地址、管理员地址、初始化数据。</li>
<li>透明机制：管理员调用直接访问代理合约（升级功能），普通用户调用转发到逻辑合约。</li>
</ul>
</li>
<li><strong>安全特性</strong>：
<ul>
<li>防止管理员调用逻辑合约功能。</li>
<li><code>OwnableUpgradeable</code>管理权限。</li>
<li>存储布局由OpenZeppelin规范化。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">测试</h3>
<p><code>test/Proxy.test.ts</code>（更新）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TransparentProxy</span>, <span class="hljs-title class_">LogicV1</span>, <span class="hljs-title class_">LogicV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"TransparentProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">TransparentProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">LogicV1</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">LogicV2</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">admin</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1, admin] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"TransparentProxy"</span>);
    <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, admin.<span class="hljs-property">address</span>, initData);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict setValue to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyAdminFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"ProxyAdmin"</span>, admin);
    <span class="hljs-keyword">const</span> proxyAdmin = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyAdminFactory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">deployed</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">connect</span>(admin).<span class="hljs-title function_">upgrade</span>(proxy.<span class="hljs-property">address</span>, logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to admin"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyAdminFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"ProxyAdmin"</span>, admin);
    <span class="hljs-keyword">const</span> proxyAdmin = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyAdminFactory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> proxyAdmin.<span class="hljs-title function_">deployed</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAdmin.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgrade</span>(proxy.<span class="hljs-property">address</span>, logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });
});
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>LogicV1</code>和<code>TransparentProxy</code>，通过<code>initData</code>初始化。</li>
<li>操作：设置<code>value</code>为42，验证存储。</li>
<li>升级：用<code>ProxyAdmin</code>切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20。</li>
<li>权限：只有<code>admin</code>可升级。</li>
</ul>
</li>
<li><strong>透明机制</strong>：管理员调用直接操作代理，普通用户调用转发到逻辑合约。</li>
</ul>
<h2 data-id="heading-11">UUPS代理（Universal Upgradeable Proxy Standard）</h2>
<p>UUPS将升级逻辑移到逻辑合约，减少代理合约存储。</p>
<p><code>contracts/UUPSLogicV1.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";

contract UUPSLogicV1 is Initializable, OwnableUpgradeable, UUPSUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
        __UUPSUpgradeable_init();
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }

    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {}
}
</code></pre>
<p><code>contracts/UUPSLogicV2.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts-upgradeable/proxy/utils/Initializable.sol";
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol";

contract UUPSLogicV2 is Initializable, OwnableUpgradeable, UUPSUpgradeable {
    uint256 public value;

    function initialize(address _owner) public initializer {
        __Ownable_init(_owner);
        __UUPSUpgradeable_init();
    }

    function setValue(uint256 _value) public onlyOwner {
        value = _value * 2;
    }

    function getValue() public view returns (uint256) {
        return value;
    }

    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {}
}
</code></pre>
<p><code>contracts/UUPSProxy.sol</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/proxy/ERC1967/ERC1967Proxy.sol";

contract UUPSProxy is ERC1967Proxy {
    constructor(address logic, bytes memory data) ERC1967Proxy(logic, data) {}
}
</code></pre>
<h3 data-id="heading-12">解析</h3>
<ul>
<li><strong>UUPSLogicV1/V2</strong>：
<ul>
<li>继承<code>UUPSUpgradeable</code>，包含升级逻辑。</li>
<li><code>_authorizeUpgrade</code>：限制升级权限。</li>
</ul>
</li>
<li><strong>UUPSProxy</strong>：
<ul>
<li>继承<code>ERC1967Proxy</code>，存储逻辑地址在特定槽位。</li>
<li>构造函数：设置逻辑合约和初始化数据。</li>
</ul>
</li>
<li><strong>UUPS优势</strong>：
<ul>
<li>代理合约更轻量，升级逻辑在逻辑合约。</li>
<li>可通过自毁移除升级功能。</li>
</ul>
</li>
<li><strong>安全特性</strong>：
<ul>
<li><code>onlyOwner</code>控制升级。</li>
<li><code>Initializer</code>防止重复初始化。</li>
<li>标准化的存储槽（ERC1967）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">测试</h3>
<p><code>test/Proxy.test.ts</code>（更新）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;
<span class="hljs-keyword">import</span> { expect } <span class="hljs-keyword">from</span> <span class="hljs-string">"chai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UUPSProxy</span>, <span class="hljs-title class_">UUPSLogicV</span>1, <span class="hljs-title class_">UUPSLogicV</span>2 } <span class="hljs-keyword">from</span> <span class="hljs-string">"../typechain-types"</span>;

<span class="hljs-title function_">describe</span>(<span class="hljs-string">"UUPSProxy"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: <span class="hljs-title class_">UUPSProxy</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV1</span>: <span class="hljs-title class_">UUPSLogicV</span>1;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">logicV2</span>: <span class="hljs-title class_">UUPSLogicV</span>2;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">owner</span>: <span class="hljs-built_in">any</span>, <span class="hljs-attr">addr1</span>: <span class="hljs-built_in">any</span>;

  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    [owner, addr1] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>);
    logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSProxy"</span>);
    <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
    proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, initData);
    <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV2Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV2"</span>);
    logicV2 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV2Factory</span>.<span class="hljs-title function_">deploy</span>();
    <span class="hljs-keyword">await</span> logicV2.<span class="hljs-title function_">deployed</span>();
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should initialize correctly"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should set and get value"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">42</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should upgrade to LogicV2"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">42</span>);
    <span class="hljs-keyword">await</span> proxyAsLogicV1.<span class="hljs-title function_">upgradeTo</span>(logicV2.<span class="hljs-property">address</span>);
    <span class="hljs-keyword">const</span> proxyAsLogicV2 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV2"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">10</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">getValue</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(<span class="hljs-number">20</span>);
    <span class="hljs-title function_">expect</span>(<span class="hljs-keyword">await</span> proxyAsLogicV2.<span class="hljs-title function_">owner</span>()).<span class="hljs-property">to</span>.<span class="hljs-title function_">equal</span>(owner.<span class="hljs-property">address</span>);
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">"should restrict upgrade to owner"</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> proxyAsLogicV1 = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">attach</span>(proxy.<span class="hljs-property">address</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">expect</span>(proxyAsLogicV1.<span class="hljs-title function_">connect</span>(addr1).<span class="hljs-title function_">upgradeTo</span>(logicV2.<span class="hljs-property">address</span>)).<span class="hljs-property">to</span>.<span class="hljs-property">be</span>.<span class="hljs-title function_">revertedWith</span>(<span class="hljs-string">"Ownable: caller is not the owner"</span>);
  });
});
</code></pre>
<ul>
<li><strong>解析</strong>：
<ul>
<li>部署：<code>UUPSLogicV1</code>和<code>UUPSProxy</code>，通过<code>initData</code>初始化。</li>
<li>操作：设置<code>value</code>为42。</li>
<li>升级：调用<code>upgradeTo</code>切换到<code>LogicV2</code>，<code>setValue(10)</code>返回20。</li>
<li>权限：<code>addr1</code>无法升级。</li>
</ul>
</li>
<li><strong>UUPS特点</strong>：升级逻辑在逻辑合约，代理更轻量。</li>
</ul>
<h2 data-id="heading-14">部署脚本</h2>
<p><code>scripts/deploy.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ethers } <span class="hljs-keyword">from</span> <span class="hljs-string">"hardhat"</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [owner, admin] = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getSigners</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">LogicV1Factory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"LogicV1"</span>);
  <span class="hljs-keyword">const</span> logicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> logicV1.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`LogicV1 deployed to: <span class="hljs-subst">${logicV1.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"TransparentProxy"</span>);
  <span class="hljs-keyword">const</span> initData = <span class="hljs-title class_">LogicV1Factory</span>.<span class="hljs-property">interface</span>.<span class="hljs-title function_">encodeFunctionData</span>(<span class="hljs-string">"initialize"</span>, [owner.<span class="hljs-property">address</span>]);
  <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProxyFactory</span>.<span class="hljs-title function_">deploy</span>(logicV1.<span class="hljs-property">address</span>, admin.<span class="hljs-property">address</span>, initData);
  <span class="hljs-keyword">await</span> proxy.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`TransparentProxy deployed to: <span class="hljs-subst">${proxy.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">UUPSLogicV</span>1Factory = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSLogicV1"</span>);
  <span class="hljs-keyword">const</span> uupsLogicV1 = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UUPSLogicV</span>1Factory.<span class="hljs-title function_">deploy</span>();
  <span class="hljs-keyword">await</span> uupsLogicV1.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`UUPSLogicV1 deployed to: <span class="hljs-subst">${uupsLogicV1.address}</span>`</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title class_">UUPSProxyFactory</span> = <span class="hljs-keyword">await</span> ethers.<span class="hljs-title function_">getContractFactory</span>(<span class="hljs-string">"UUPSProxy"</span>);
  <span class="hljs-keyword">const</span> uupsProxy = <span class="hljs-keyword">await</span> <span class="hljs-title class_">UUPSProxyFactory</span>.<span class="hljs-title function_">deploy</span>(uupsLogicV1.<span class="hljs-property">address</span>, initData);
  <span class="hljs-keyword">await</span> uupsProxy.<span class="hljs-title function_">deployed</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`UUPSProxy deployed to: <span class="hljs-subst">${uupsProxy.address}</span>`</span>);
}

<span class="hljs-title function_">main</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
  process.<span class="hljs-property">exitCode</span> = <span class="hljs-number">1</span>;
});
</code></pre>
<p>跑部署：</p>
<pre><code class="hljs language-bash" lang="bash">npx hardhat run scripts/deploy.ts --network hardhat
</code></pre>
<ul>
<li><strong>解析</strong>：部署透明代理和UUPS代理，记录地址。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用阿里云 ECS 安装 MongoDB并实现后端连接]]></title>    <link>https://juejin.cn/post/7571007466822991924</link>    <guid>https://juejin.cn/post/7571007466822991924</guid>    <pubDate>2025-11-11T04:43:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571007466822991924" data-draft-id="7569548172533858344" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用阿里云 ECS 安装 MongoDB并实现后端连接"/> <meta itemprop="keywords" content="MongoDB,Express"/> <meta itemprop="datePublished" content="2025-11-11T04:43:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="gongzemin"/> <meta itemprop="url" content="https://juejin.cn/user/3931509311681192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用阿里云 ECS 安装 MongoDB并实现后端连接
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3931509311681192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    gongzemin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:43:48.000Z" title="Tue Nov 11 2025 04:43:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前面我们已经在ESC上部署了<a href="https://juejin.cn/post/7569038602434510857" target="_blank" title="https://juejin.cn/post/7569038602434510857">前端Vue应用</a>、<a href="https://juejin.cn/post/7564573165705936911" target="_blank" title="https://juejin.cn/post/7564573165705936911">后端Express</a>，现在就差数据库了。
本来是用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mongodb.com%2Fcloud%2Fatlas%2Fregister" target="_blank" title="https://www.mongodb.com/cloud/atlas/register" ref="nofollow noopener noreferrer">MongoDB Altas</a>(MongoDB 官方推出的云托管 MongoDB 数据库服务)，但是国外的数据库服务，网络有点不稳定，所以决定自己安装MongoDB 社区版</p>
<blockquote>
<p>我的ECS配置是2核2G 40g 云盘 系统是Alibaba Cloud Linux 4 LTS 64位</p>
</blockquote>
<p>我们开始吧</p>
<ol>
<li>安装mongoDB 社区版</li>
<li>启动mongoDB</li>
<li>为数据库添加访问控制，比如admin用户才可以（可选）</li>
<li>后端连接我们在ECS安装的mongoDB</li>
</ol>
<h5 data-id="heading-0">安装mongoDB 社区版</h5>
<p>我们看下<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mongodb.com%2Fdocs%2Fmanual%2Fadministration%2Finstall-community%2F%3Foperating-system%3Dlinux%26linux-distribution%3Dred-hat%26linux-package%3Ddefault%26search-linux%3Dwith-search-linux%23std-label-install-mdb-community-edition" target="_blank" title="https://www.mongodb.com/docs/manual/administration/install-community/?operating-system=linux&amp;linux-distribution=red-hat&amp;linux-package=default&amp;search-linux=with-search-linux#std-label-install-mdb-community-edition" ref="nofollow noopener noreferrer">官网文档</a>，根据不同的系统，发行版本选择，对应的命令，比如我这里服务器是Alibaba Cloud Linux 4, 所以就是Linux, Red Hat</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7546240ac18463fa06e5562e096121f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=afRopHJMWk7R8sVbUqtyrCQDWeA%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-1">配置 MongoDB 的 YUM 软件仓库地址，让系统知道从哪里下载 MongoDB</h6>
<pre><code class="hljs language-bash" lang="bash">[mongodb-org-8.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/8/mongodb-org/8.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://pgp.mongodb.com/server-8.0.asc
</code></pre>
<blockquote>
<p>MongoDB 8.2 使用 8.0 的 GPG 密钥
gpgkey=<a href="https://link.juejin.cn?target=https%3A%2F%2Fpgp.mongodb.com%2Fserver-8.0.asc" target="_blank" title="https://pgp.mongodb.com/server-8.0.asc" ref="nofollow noopener noreferrer">pgp.mongodb.com/server-8.0.…</a>  ✅ 正确</p>
</blockquote>
<p><strong>为什么 8.2 用 8.0 的密钥？</strong>     MongoDB 的 GPG 密钥是按主版本（major version）管理的</p>
<p><strong>1. 在ECS上创建一个 MongoDB 的 YUM 软件源配置文件</strong> ，以便通过<code>dnf</code>或<code>yum</code>包管理器安装MongoDB 8相关软件</p>
<p>登录ECS，执行命令</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">tee</span> /etc/yum.repos.d/mongodb-org-8.0.repo &lt;&lt;<span class="hljs-string">EOF
[mongodb-org-8.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/8/mongodb-org/8.0/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://pgp.mongodb.com/server-8.0.asc
EOF</span>
</code></pre>
<blockquote>
<p>为什么我不安装MongoDB 8.2版本呢，上面那个官方文档就是8.2，因为我当时是问了GROK ai，那个给的就是8.0版本，所以官方文档最靠谱</p>
</blockquote>
<p>各部分含义拆解如下：</p>
<ol>
<li>
<p><code>sudo</code></p>
<ul>
<li>以系统管理员(root)权限执行命令，因为写入<code>/etc/yum.repos.d/</code>目录（系统软件源配置目录）需要管理员权限</li>
</ul>
</li>
<li>
<p><code>tee /etc/yum.repos.d/mongodb-org-8.0.repo</code></p>
<ul>
<li>tee: 命令行工具，用户将输入内容同时写入指定文件和输出到屏幕（方便确认内容是否正确写入）</li>
<li><code>/etc/yum.repos.d/mongodb-org-8.0.repo</code>: 目标文件路径。<code>/etc/yum.repos.d</code> 是Linux系统默认存放软件源配置的目录，<code>.repo</code>是YUM/DNF源配置文件到标准后缀，文件名<code>mongodb-org-8.0.repo</code>明确标识了这是MongoDB8.0的源配置</li>
</ul>
</li>
<li>
<p>&lt;&lt;EOF 和 EOF</p>
<ul>
<li>这是<code>Shell</code>中的Here Document(嵌入文档）语法，用于将<code>&lt;&lt;EOF和EOF</code>之间的内容作为输入传递给<code>tee</code>命令。EOF是分隔符（可替换为其他字符串，如END), 前后必须一致且单独成行，确保内容边界清晰。</li>
</ul>
</li>
<li>
<p>中间的配置内容(MongoDB 8.0源信息）</p>
</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mongodb-org-8.0]</span>          <span class="hljs-comment"># 软件源的唯一标识（方括号内的名称），用于区分系统中的其他软件源</span>
<span class="hljs-attr">name</span>=MongoDB Repository    <span class="hljs-comment"># 软件源的描述名称，方便用户识别（此处为“MongoDB 仓库”）</span>
<span class="hljs-attr">baseurl</span>=https://repo.mongodb.org/yum/redhat/<span class="hljs-number">8</span>/mongodb-org/<span class="hljs-number">8.0</span>/x<span class="hljs-number">86_64</span>/  <span class="hljs-comment"># 软件包的实际下载地址：针对 Red Hat 8 系统、x86_64 架构的 MongoDB 8.0 官方源</span>
<span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">1</span>                 <span class="hljs-comment"># 是否启用 GPG 签名校验（1 表示启用，用于验证软件包的完整性和安全性，防止被篡改）</span>
<span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span>                  <span class="hljs-comment"># 是否启用该软件源（1 表示启用，0 表示禁用，启用后包管理器会从该源检索软件）</span>
<span class="hljs-attr">gpgkey</span>=https://pgp.mongodb.com/server-<span class="hljs-number">8.0</span>.asc  <span class="hljs-comment"># GPG 公钥文件的地址，用于校验软件包的签名</span>
</code></pre>
<p>总结
这条命令的最终效果是：<strong>在系统中创建一个 MongoDB 8.0 官方源的配置文件</strong>，告诉包管理器（dnf/yum）可以从该源下载并安装 MongoDB 8.0 相关软件，同时通过 GPG 校验确保软件包的安全性。执行后，即可通过 <code>sudo dnf install -y mongodb-org</code> 等命令安装 MongoDB 8.0 了。</p>
<h6 data-id="heading-2">导入 MongoDB 的 GPG 公钥到系统</h6>
<pre><code class="hljs language-bash" lang="bash">sudo rpm --import https://pgp.mongodb.com/server-8.0.asc
</code></pre>
<p>导入 MongoDB 的 GPG 公钥到系统, 为什么需要公钥</p>
<blockquote>
<p>下载软件包 → 验证签名 → 确认是官方发布 → 安全安装<br/>
↓<br/>
没有公钥 = 无法验证 = 安装失败或警告</p>
</blockquote>
<h6 data-id="heading-3">清理 DNF 包管理器的所有缓存</h6>
<pre><code class="hljs language-bash" lang="bash">sudo dnf clean all
</code></pre>
<p>为什么要清理缓存？</p>

























<table><thead><tr><th>原因</th><th>说明</th></tr></thead><tbody><tr><td>🔄 刚配置了新源</td><td>确保使用最新的源信息</td></tr><tr><td>🐛 缓存损坏</td><td>解决安装错误</td></tr><tr><td>💾 释放空间</td><td>清理不需要的旧文件</td></tr><tr><td>🆕 强制刷新</td><td>获取最新的软件包列表</td></tr></tbody></table>
<h6 data-id="heading-4">安装mongodb</h6>
<pre><code class="hljs language-bash" lang="bash">sudo yum install -y mongodb-org
</code></pre>
<p>配置 MongoDB 的 YUM 软件仓库地址，安装的完整截图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e79addd00544298b7cd92d396916f1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=u%2BTzfPdRa570BoaipICpSYZvS64%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/022c33a5bd9c48a4af4b05c27544f07f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=UaNbLHbQyGNVRT9ejF%2Fi1rK5QMo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ce64be64a1451c9d8d147c088cfe91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=z8QREBWxShS1AhCvXKtVPIXNHy8%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-5">启动mongoDB服务</h5>
<p>上面我们已经成功的安装了<code>8.0.15-1</code>这个版本，我们先把数据库服务启动</p>
<h6 data-id="heading-6">启动 MongoDB 服务器（后台服务）</h6>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl start mongod  <span class="hljs-comment"># 启动 MongoDB 服务器</span>
sudo systemctl <span class="hljs-built_in">enable</span> mongod <span class="hljs-comment"># 设置开机启动</span>
sudo systemctl status mongod <span class="hljs-comment"># 检查服务状态</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3a88b61b205455faa89cf81338af799~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=xj%2Bbrxzt%2F5%2BwtW7sC%2BYkA2YtrJM%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-7">启动 MongoDB Shell, 在ECS终端输入<code>mongosh</code></h6>
<pre><code class="hljs language-bash" lang="bash">// 连接到本地默认 MongoDB
mongosh
</code></pre>
<p>这样就可以开启, 与MongoDB数据库进行交互的命令行界面, 可以看到第一次连接数据库的时候, 产生了一些警告</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c98e868581184c65af3d264cb84da47a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=7EMLkyRZp4h28xxRaVrxO2MGShI%3D" alt="image.png" loading="lazy"/></p>
<p>比如截图的第二条</p>
<blockquote>
<p>Access control is not enabled for the database. Read and write access to data and configuration is unrestricted</p>
</blockquote>
<p>就是说咱们的数据库没有限制，谁都可以读写咱们的数据库</p>
<h5 data-id="heading-8">配置数据库访问权限</h5>
<h6 data-id="heading-9">编辑配置文件<code>/etc/mongod.conf</code>，启动验证</h6>
<p>我们编辑下配置文件</p>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/mongod.conf
</code></pre>
<p>把security取消注释，authorization改为<code>enabled</code>，允许验证</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">security:</span>
 <span class="hljs-attr">authorization:</span> <span class="hljs-string">enabled</span>
</code></pre>
<p>保存（Ctrl+O &gt; Enter &gt; Ctrl+X for nano）。重启mongod服务</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl restart mongod
sudo systemctl status mongod  <span class="hljs-comment"># 确认running</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db5953f86bc149ea8295bd86f343a07f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=rL9MYQkYwpQyl%2FjkDz0XW4uZ5JI%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-10">增加管理员用户</h6>
<p>我们先切换到 admin 数据库, 因为admin数据库是特殊的管理数据库</p>
<pre><code class="hljs language-bash" lang="bash">use admin
</code></pre>
<ul>
<li>MongoDB中admin数据库是系统级数据库</li>
<li>所有的管理员用户必须存储在admin数据库中</li>
<li>只有在admin数据库中创建的用户才能拥有跨数据库的管理权限</li>
</ul>
<p>如果你不先 use admin，而是在其他数据库（比如默认的 test）中创建管理员，<strong>这个用户就只能管理 test 数据库，无法管理整个 MongoDB 实例</strong>。</p>
<pre><code class="hljs language-php" lang="php">db.<span class="hljs-title function_ invoke__">createUser</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-attr">pwd</span>: <span class="hljs-string">"xxxxxxxx"</span>,  // 用您实际密码替换
  <span class="hljs-attr">roles</span>: [
    { <span class="hljs-attr">role</span>: <span class="hljs-string">"userAdminAnyDatabase"</span>, <span class="hljs-attr">db</span>: <span class="hljs-string">"admin"</span> },
    { <span class="hljs-attr">role</span>: <span class="hljs-string">"readWriteAnyDatabase"</span>, <span class="hljs-attr">db</span>: <span class="hljs-string">"admin"</span> },
    { <span class="hljs-attr">role</span>: <span class="hljs-string">"dbAdminAnyDatabase"</span>, <span class="hljs-attr">db</span>: <span class="hljs-string">"admin"</span> }
  ]
})
</code></pre>
<p>咱们详细解释下上面命令</p>
<ul>
<li>user 是登录使用的账号名</li>
<li>pwd 账号对应的密码</li>
<li>roles 角色数组，定义了用户的权限。这里分配了三个角色：
<ul>
<li>userAdminAnyDatabase 用户管理权限，只管理用户，不能读写数据</li>
<li>readWriteAnyDatabase 在任何数据库中 读写数据</li>
<li>dbAdminAnyDatabase  管理数据库结构</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 为什么需要三个角色？</span>
每个角色负责不同的职责，组合起来形成<span class="hljs-strong">**超级管理员**</span>：

userAdminAnyDatabase    → 管理用户和权限
<span class="hljs-bullet">+</span>
readWriteAnyDatabase    → 操作数据（增删改查）
<span class="hljs-bullet">+</span>
dbAdminAnyDatabase      → 管理数据库结构
=
完整的管理员权限
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42a46519f333467eadc11cefeb1a8454~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=wYp7TGQgVq5pzmbBnJx8L7k40XM%3D" alt="image.png" loading="lazy"/></p>
<p>执行成功，输出<code>{ ok: 1 }</code>，就表示用户创建成功了</p>
<pre><code class="hljs language-scss" lang="scss">db<span class="hljs-selector-class">.getUsers</span>()
</code></pre>
<p>通过db.getUsers(）也可以查看我们新增的用户是否成功</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52d67304230f40c59f41b71d7b703163~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=tk5ttiKNN2jmb34Tap6nf5R1KK4%3D" alt="image.png" loading="lazy"/></p>
<p><strong>由于我们现在已经启动验证</strong>，现在执行<code>mongosh</code>，是可以连接到mongoDB数据库，但是想要读写数据库，读写用户就不行了，会提示我们没有权限</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/265697cd30be469e94549b4f2168d759~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=xFNTRg9giH7ZvcFixNlxZYV8Q2M%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-11">使用存储在 admin 数据库中的 admin 用户进行认证登录</h6>
<p>前面我们创建的admin用户就是保存在admin数据库，所以我们使用 admin 数据库中的admin用户认证</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">1. 使用 admin 数据库中的用户认证</span>
mongosh -u admin --authenticationDatabase admin
<span class="hljs-meta prompt_">
# </span><span class="bash">2. 登录后在 <span class="hljs-built_in">test</span> 数据库</span>
<span class="hljs-meta prompt_">test&gt; </span><span class="bash">
</span><span class="hljs-meta prompt_">
# </span><span class="bash">3. 可以切换到任何数据库工作</span>
<span class="hljs-meta prompt_">test&gt; </span><span class="bash">use myapp</span>
switched to db myapp
<span class="hljs-meta prompt_">
myapp&gt; </span><span class="bash">show collections</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">4. 也可以切换到 admin 数据库</span>
<span class="hljs-meta prompt_">myapp&gt; </span><span class="bash">use admin</span>
switched to db admin
<span class="hljs-meta prompt_">
admin&gt; </span><span class="bash">db.getUsers()</span>
</code></pre>
<ul>
<li>mongosh: 启动 MongoDB Shell 客户端</li>
<li>-u admin: 使用用户名 admin 登录</li>
<li>--authenticationDatabase admin: 指定认证数据库为 admin
<ul>
<li>去admin数据库中查找用户admin的认证信息</li>
<li>在admin数据库中验证密码是否正确</li>
</ul>
</li>
<li>登录后默认连接的是test数据库</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/310ee9e09b6d4f6dbeb2d548038b8d1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=vxMO2%2BIzKR6TTZX9%2Fr1RLoS6FpY%3D" alt="image.png" loading="lazy"/></p>
<p>如果想直接连接到特定数据库
可以在连接字符串中指定：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 认证使用 admin，但直接进入 myapp 数据库工作</span>
mongosh <span class="hljs-string">"mongodb://admin:password@localhost:27017/myapp?authSource=admin"</span>
</code></pre>
<h5 data-id="heading-12">后端express连接mongoDB</h5>
<p>前面我们mongod.conf配置文件，关于网络的，绑定IP是<code>127.0.0.1</code>，那就是ECS上的Mongo服务器, 只允许ECS上的后端服务访问，虽然也可以修改IP，开放外网</p>
<p>mongod.conf配置文件, 只允许本地访问</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># network interfaces</span>
net:
 port: 27017
 bindIp: 127.0.0.1 <span class="hljs-comment"># Enter 0.0.0.0,:: </span>
</code></pre>
<blockquote>
<p>数据库默认不对外开放端口：为了安全，服务器上的 MongoDB、MySQL 等数据库，通常只监听本地回环地址（127.0.0.1），拒绝外部直接访问，本地服务无法通过公网 IP + 数据库端口连接。<br/>
<strong>生产环境的数据库应该只监听本地，不暴露到公网！</strong></p>
</blockquote>
<p>可是我们本地开发也需要连接，这就需要用到SSH端口转发</p>
<h6 data-id="heading-13">SSH 端口转发（SSH Tunneling） 命令</h6>
<p>看下什么是SSH端口转发</p>
<pre><code class="hljs language-scss" lang="scss">你的电脑                    SSH 隧道                  远程服务器
(本地)                   (加密连接)              (<span class="hljs-number">114.215</span>.<span class="hljs-number">200.219</span>)
   |                                                    |
   |  访问 localhost:<span class="hljs-number">27017</span>                              |
   |  ────────────────────────────&gt;                    |
   |          通过 SSH 加密传输                         |
   |                                   转发到本地 MongoDB
   |                                   localhost:<span class="hljs-number">27017</span>
   |  &lt;────────────────────────────                    |
   |          返回数据                                  |
</code></pre>
<p>就是说本地服务 → 连接本地映射的端口 → SSH 加密通道 → 服务器 SSH 服务 → 转发到服务器本地的数据库端口，相当于通过 SSH “搭桥”，让本地服务间接访问到服务器上不对外暴露的数据库。</p>
<p>先查询 27017 端口（MongoDB 默认端口）相关进程信息，</p>
<pre><code class="hljs language-bash" lang="bash">lsof -i:27017
</code></pre>
<ul>
<li>lsof：List Open Files 的缩写，用于列出系统中所有打开的文件（在 Linux 中，网络连接、端口等也被视为 “文件”）。</li>
<li>-i:27017：-i 选项用于筛选网络相关的 “文件”（即网络连接 / 端口），:27017 指定筛选 端口号为 27017 的网络连接。</li>
</ul>
<p>可以看到我本地mongod已经占用了27017端口，
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4d3796537eb4eaaaa3d37f850de66f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=QKS%2BEz77ROBwyFAI7bWgQuS2Juc%3D" alt="image.png" loading="lazy"/></p>
<p>这样我就要停掉这个端口，如果我还要用这个端口做转发的话，不然转发的时候会报错，像这样提示Address already in use
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61f4ac4e38364bb990811029fbd10767~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=l5dIZA6spPhk%2F4IPAXp8raSTQyM%3D" alt="image.png" loading="lazy"/></p>
<p>我先把本地占用27017的进程给停掉</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">kill</span> -9 914
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50494ed75b9444f4b993050d188d534f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=4Wl6nnFOYhiDmFYBWbehOrPLDiE%3D" alt="image.png" loading="lazy"/></p>
<p>执行如下的端口转发命令</p>
<pre><code class="hljs language-bash" lang="bash">ssh -CNL 27017:127.0.0.1:27017 root@114.215.200.219
</code></pre>
<p>命令解释</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">### 1. <span class="hljs-strong">**`ssh`**</span></span>
<span class="hljs-bullet">-</span> SSH 客户端命令

<span class="hljs-section">### 2. <span class="hljs-strong">**`-C`**</span> (Compression)</span>
<span class="hljs-bullet">-</span> 表示<span class="hljs-strong">**启用数据压缩**</span>
<span class="hljs-bullet">-</span> 在传输过程中压缩数据以节省带宽

详细说明：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**作用**</span>：压缩 SSH 连接中传输的所有数据
<span class="hljs-bullet">-</span> <span class="hljs-strong">**优势**</span>：在网络带宽有限或延迟高的情况下提升速度
<span class="hljs-bullet">-</span> <span class="hljs-strong">**适用**</span>：特别适合传输文本数据（如数据库查询结果）

<span class="hljs-section">### 3. <span class="hljs-strong">**`-N`**</span> (No command)</span>
<span class="hljs-bullet">-</span> 表示<span class="hljs-strong">**不执行远程命令**</span>
<span class="hljs-bullet">-</span> 只做端口转发，不打开远程 shell

详细说明：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**作用**</span>：登录后不显示命令行提示符
<span class="hljs-bullet">-</span> <span class="hljs-strong">**优势**</span>：不占用远程 shell 会话，更加轻量
<span class="hljs-bullet">-</span> <span class="hljs-strong">**效果**</span>：终端光标停留，专注于端口转发功能

<span class="hljs-section">### 4. <span class="hljs-strong">**`-L`**</span> (Local Port Forwarding)</span>
<span class="hljs-bullet">-</span> 表示<span class="hljs-strong">**本地端口转发**</span>
<span class="hljs-bullet">-</span> 将本地端口映射到远程服务器的端口

<span class="hljs-section">### 5. <span class="hljs-strong">**`27017:127.0.0.1:27017`**</span></span>
这是转发规则，格式为：<span class="hljs-code">`本地端口:目标主机:目标端口`</span>

27017          :    127.0.0.1    :    27017
  ↓                     ↓                ↓
本地端口          目标主机           目标端口


详细说明：
<span class="hljs-bullet">-</span> <span class="hljs-strong">**第一个 27017**</span>：你本地电脑的端口
<span class="hljs-bullet">-</span> <span class="hljs-strong">**127.0.0.1**</span>：从<span class="hljs-strong">**远程服务器**</span>的角度看，目标主机是它自己（localhost）
<span class="hljs-bullet">-</span> <span class="hljs-strong">**第二个 27017**</span>：远程服务器上的 MongoDB 端口

<span class="hljs-section">### 6. <span class="hljs-strong">**`root@114.215.200.219`**</span></span>
<span class="hljs-bullet">-</span> 用户名：<span class="hljs-code">`root`</span>
<span class="hljs-bullet">-</span> 远程服务器 IP：<span class="hljs-code">`114.215.200.219`</span>
</code></pre>
<p>以 root 用户连接到 114.215.200.219 服务器，启用数据压缩（-C），不执行远程命令（-N），建立本地端口转发（-L），将本地 27017 端口映射到远程服务器的 127.0.0.1:27017</p>
<p>执行后会提示我们输入密码，root@114.215.200.219， 服务器root用户对应的密码，密码输入完后，该终端窗口会卡在那里（这代表隧道保持打开）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f47ae4a65e48c2822efe25fbb8801c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=EJnHOss5ewR2eh8vwQDt4nJ7W%2BM%3D" alt="image.png" loading="lazy"/></p>
<p>新开一个终端执行：</p>
<pre><code class="hljs language-css" lang="css">lsof -<span class="hljs-selector-tag">i</span>:<span class="hljs-number">27017</span>
</code></pre>
<p>看到是SSH占用了ssh 占用了 27017，说明隧道建立成功。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3572972e4e394b70b13a2c929ed9b851~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=%2BUAPtzugOqLcb0yApimynnuleRg%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-14">在express服务里配置.env MONGODB_URI</h6>
<p>配置.env</p>
<pre><code class="hljs language-bash" lang="bash">MONGODB_URI=mongodb://admin:替换自己的密码@127.0.0.1:27017/admin?authSource=admin
</code></pre>
<p>上面代码解释如下</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">## 连接字符串结构</span>
mongodb://  admin  :  密码  @  127.0.0.1  :  27017  /  admin  ?  authSource=admin
<span class="hljs-code">    ↓        ↓        ↓         ↓           ↓        ↓         ↓
  协议     用户名    密码    服务器地址    端口   默认数据库   认证数据库
  
// 连接后
admin&gt;  ← 直接在 admin 数据库中
</span>
<span class="hljs-section">### 6. <span class="hljs-strong">**`?authSource=admin`**</span> (认证数据库)</span>
<span class="hljs-bullet">-</span> <span class="hljs-strong">**指定去哪个数据库验证用户身份**</span>
<span class="hljs-bullet">-</span> 这里指定在 <span class="hljs-code">`admin`</span> 数据库中查找用户并验证密码

连接到：127.0.0.1:27017 的 MongoDB
默认数据库：admin（连接后工作的数据库）
认证方式：使用存储在 admin 数据库中的 admin 用户进行身份验证
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d3808e2a134526ada84b824e2ee14c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=ZQ8LtiH4E8TUZpP8Gk8XuimMcwo%3D" alt="image.png" loading="lazy"/></p>
<p>如果没有建立SSH端口转发，就会提示如下，连接错误，拒绝连接</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/022a43e08f184db6995999f530f52649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29uZ3plbWlu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763441028&amp;x-signature=CXUsTVvPsvAk0GUVAK9VKfW81OE%3D" alt="image.png" loading="lazy"/></p>
<p>还有一点要说的是，如果咱们关掉SSH连接终端窗口，就会导致本地连接错误，所以本地连接ECS数据库，需要保持SSH隧道连接</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Java、Spring Boot 和 Spring AI 开发符合 A2A 标准的 AI 智能体]]></title>    <link>https://juejin.cn/post/7571086754879635502</link>    <guid>https://juejin.cn/post/7571086754879635502</guid>    <pubDate>2025-11-11T05:00:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754879635502" data-draft-id="7570992947463962634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Java、Spring Boot 和 Spring AI 开发符合 A2A 标准的 AI 智能体"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-11T05:00:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="信码由缰"/> <meta itemprop="url" content="https://juejin.cn/user/2110664941509214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Java、Spring Boot 和 Spring AI 开发符合 A2A 标准的 AI 智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2110664941509214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    信码由缰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:00:53.000Z" title="Tue Nov 11 2025 05:00:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>AI 智能体指的是一种软件实体，它能够利用自然语言处理、机器学习或推理系统等人工智能技术，自主感知、推理和行动，以实现特定目标。</p>
</blockquote>
<p><img src="https://cf-blog.icodebuddy.com/image/86/86-0.png" alt="" loading="lazy"/></p>
<p>我为 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftelex.im%2F" target="_blank" title="https://telex.im/" ref="nofollow noopener noreferrer">Telex</a> 开发了一个 AI 智能体，该智能体接收一个正则表达式模式，并就该模式所匹配的字符串类型提供易于理解的解释。开发此智能体的灵感源于我在此之前开发的一个 API（您可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbituann%2Fstring-analyzer-api" target="_blank" title="https://github.com/bituann/string-analyzer-api" ref="nofollow noopener noreferrer">此处</a>查看该项目），在该 API 中我必须使用正则表达式进行一些自然语言处理。尽管我之前学习过正则表达式，但感觉像是第一次见到它。正则表达式就是这样。因此，当 Telex 为其平台寻求更多 AI 智能体时，我决定开发这个智能体。</p>
<p>以下是我使用 Java、Spring AI 和 Spring Boot 实现它的过程。</p>
<h2 data-id="heading-0">初始设置</h2>
<h3 data-id="heading-1">1. Spring Boot 项目初始化</h3>
<p>我使用 Spring 提供的<a href="https://link.juejin.cn?target=https%3A%2F%2Fstart.spring.io%2F" target="_blank" title="https://start.spring.io/" ref="nofollow noopener noreferrer">初始化工具</a>来初始化项目。请注意，我在依赖项中包含了 Spring Web 和 Open AI。</p>
<p><img src="https://cf-blog.icodebuddy.com/image/86/86-1.png" alt="初始化 Spring 项目" loading="lazy"/></p>
<h3 data-id="heading-2">2. 设置 API 凭证</h3>
<p>在我的 <code>application.properties</code> 文件中，我设置了 Spring AI 以使用我的 API 凭证（我的 API 密钥）。我通过 Google AI Studio 获得了一个免费的 Google Gemini API 密钥。我的 <code>application.properties</code> 文件设置如下：</p>
<pre><code class="hljs language-properties" lang="properties">
spring.config.import=classpath:AI.properties

  


spring.application.name=regexplain

spring.ai.openai.api-key = ${GEMINI_API_KEY}

spring.ai.openai.base-url https://generativelanguage.googleapis.com/v1beta/openai

spring.ai.openai.chat.completions-path = /chat/completions

spring.ai.openai.chat.options.model = gemini-2.5-pro

</code></pre>
<p>第一行导入了包含我 API 密钥的文件。重要的是不要将您的 API 密钥暴露给公众。该文件与 <code>application.properties</code> 位于同一文件夹中。</p>
<h3 data-id="heading-3">3. 首次项目运行</h3>
<p>使用我的包管理器（Maven），我安装了所需的依赖项。然后我运行了我的主类，以确保一切正常。如果您到目前为止一切都做对了，您的项目应该可以无错误运行。如果遇到任何错误，请在 Google 上查找解决方法。</p>
<h2 data-id="heading-4">A2A 请求和响应模型</h2>
<p>在深入实现之前，让我们先谈谈符合 A2A 标准的请求和响应的结构。A2A 协议遵循标准的 JSON-RPC 2.0 结构来处理请求和响应。</p>
<p>所有方法调用都封装在一个请求对象中，其结构如下：</p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>

<span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"String"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"String | Integer"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Message"</span>

<span class="hljs-punctuation">}</span>

</code></pre>
<p>响应对象有些类似：</p>
<pre><code class="hljs language-json" lang="json">
<span class="hljs-punctuation">{</span>

<span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"String | Integer | null"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"result?"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Task | Message | null"</span><span class="hljs-punctuation">,</span>

<span class="hljs-attr">"error?"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JSONRPCError"</span>

<span class="hljs-punctuation">}</span>

</code></pre>
<p>响应中的 ID <strong>必须</strong>与请求中的 ID 相同。</p>
<p>有关 A2A 协议的更多信息，请查阅 <a href="https://link.juejin.cn?target=https%3A%2F%2Fa2a-protocol.org%2Flatest%2F" target="_blank" title="https://a2a-protocol.org/latest/" ref="nofollow noopener noreferrer">A2A 协议文档</a>。</p>
<p>以上就是请求和响应的通用结构。我开发这个智能体是为了在 Telex 平台上使用，因此我的部分实现可能特定于 Telex。</p>
<p>现在进入实现部分。我创建了一个名为 <code>model</code> 的文件夹，用于存储我的模型。请求模型类 <code>A2ARequest</code> 如下所示：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A2ARequest</span> {

<span class="hljs-keyword">private</span> String id;

<span class="hljs-keyword">private</span> RequestParamsProperty params;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">A2ARequest</span><span class="hljs-params">(String id, RequestParamsProperty params)</span> {

<span class="hljs-built_in">this</span>.id = id;

<span class="hljs-built_in">this</span>.params = params;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p><code>RequestParamsProperty</code> 类代表了 <code>params</code> 中包含信息的结构。它如下所示：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestParamsProperty</span> {

<span class="hljs-keyword">private</span> HistoryMessage message;

<span class="hljs-keyword">private</span> String messageId;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">RequestParamsProperty</span><span class="hljs-params">(HistoryMessage message, String messageId)</span> {

<span class="hljs-built_in">this</span>.message = message;

<span class="hljs-built_in">this</span>.messageId = messageId;

}

  


<span class="hljs-comment">// getters and setter</span>

}

</code></pre>
<p><code>HistoryMessage</code> 类如下所示：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@JsonIgnoreProperties(ignoreUnknown = true)</span>

<span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HistoryMessage</span> {

<span class="hljs-keyword">private</span> String kind;

<span class="hljs-keyword">private</span> String role;

<span class="hljs-keyword">private</span> List&lt;MessagePart&gt; parts;

<span class="hljs-keyword">private</span> String messageId;

<span class="hljs-keyword">private</span> String taskId;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">HistoryMessage</span><span class="hljs-params">()</span> {}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">HistoryMessage</span><span class="hljs-params">(String role, List&lt;MessagePart&gt; parts, String messageId, String taskId)</span> {

<span class="hljs-built_in">this</span>.kind = <span class="hljs-string">"message"</span>;

<span class="hljs-built_in">this</span>.role = role;

<span class="hljs-built_in">this</span>.parts = parts;

<span class="hljs-built_in">this</span>.messageId = messageId;

<span class="hljs-built_in">this</span>.taskId = taskId;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p>注解的作用是让 Spring 知道在请求和响应的 JSON 表示中包含什么。如果请求中不存在某个属性，它应该忽略它并在类中将其设置为 null。如果某个属性设置为 null，则不应将其包含在响应中。</p>
<p><code>MessagePart</code> 类如下所示：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@JsonIgnoreProperties(ignoreUnknown = true)</span>

<span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessagePart</span> {

<span class="hljs-keyword">private</span> String kind;

<span class="hljs-keyword">private</span> String text;

<span class="hljs-keyword">private</span> List&lt;MessagePart&gt; data;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">MessagePart</span><span class="hljs-params">(String kind, String text, List&lt;MessagePart&gt; data)</span> {

<span class="hljs-built_in">this</span>.kind = kind;

<span class="hljs-built_in">this</span>.text = text;

<span class="hljs-built_in">this</span>.data = data;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p>以上就是表示从 Telex 接收的请求结构所需的所有类。现在需要为我的响应创建一个模型，以及表示响应所需的所有支持类。</p>
<p><code>A2AResponse</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A2AResponse</span> {

<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String jsonrpc;

<span class="hljs-meta">@JsonInclude(JsonInclude.Include.ALWAYS)</span>

<span class="hljs-keyword">private</span> String id;

<span class="hljs-keyword">private</span> Result result;

<span class="hljs-keyword">private</span> CustomError error;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">A2AResponse</span><span class="hljs-params">()</span> {

<span class="hljs-built_in">this</span>.jsonrpc = <span class="hljs-string">"2.0"</span>;

}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">A2AResponse</span><span class="hljs-params">(String id, Result result, CustomError error)</span> {

<span class="hljs-built_in">this</span>.jsonrpc = <span class="hljs-string">"2.0"</span>;

<span class="hljs-built_in">this</span>.id = id;

<span class="hljs-built_in">this</span>.result = result;

<span class="hljs-built_in">this</span>.error = error;

}

  


<span class="hljs-comment">//getters and setters</span>

}

</code></pre>
<p><code>Result</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> {

<span class="hljs-keyword">private</span> String id;

<span class="hljs-keyword">private</span> String contextId;

<span class="hljs-keyword">private</span> TaskStatus status;

<span class="hljs-keyword">private</span> List&lt;Artifact&gt; artifacts;

<span class="hljs-keyword">private</span> List&lt;HistoryMessage&gt; history;

<span class="hljs-keyword">private</span> String kind;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">Result</span><span class="hljs-params">()</span> {}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">Result</span><span class="hljs-params">(String id, String contextId, TaskStatus status, List&lt;Artifact&gt; artifacts, List&lt;HistoryMessage&gt; history, String task)</span> {

<span class="hljs-built_in">this</span>.id = id;

<span class="hljs-built_in">this</span>.contextId = contextId;

<span class="hljs-built_in">this</span>.status = status;

<span class="hljs-built_in">this</span>.artifacts = artifacts;

<span class="hljs-built_in">this</span>.history = history;

<span class="hljs-built_in">this</span>.kind = task;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p><code>CustomError</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomError</span> {

<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;

<span class="hljs-keyword">private</span> String message;

<span class="hljs-keyword">private</span> Map&lt;String, String&gt; data;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">CustomError</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String message, Map&lt;String, String&gt; data)</span> {

<span class="hljs-built_in">this</span>.code = code;

<span class="hljs-built_in">this</span>.message = message;

<span class="hljs-built_in">this</span>.data = data;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p><code>TaskStatus</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskStatus</span> {

<span class="hljs-keyword">private</span> String state;

<span class="hljs-keyword">private</span> Instant timestamp;

<span class="hljs-keyword">private</span> HistoryMessage message;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">TaskStatus</span><span class="hljs-params">()</span> {}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">TaskStatus</span><span class="hljs-params">(String state, Instant timestamp, HistoryMessage message)</span> {

<span class="hljs-built_in">this</span>.state = state;

<span class="hljs-built_in">this</span>.timestamp = timestamp;

<span class="hljs-built_in">this</span>.message = message;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p><code>Artifact</code> 类：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Artifact</span> {

<span class="hljs-keyword">private</span> String artifactId;

<span class="hljs-keyword">private</span> String name;

<span class="hljs-keyword">private</span> List&lt;MessagePart&gt; parts; <span class="hljs-comment">// 稍后复查此类型</span>

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">Artifact</span><span class="hljs-params">()</span> {}

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">Artifact</span><span class="hljs-params">(String artifactId, String name, List&lt;MessagePart&gt; parts)</span> {

<span class="hljs-built_in">this</span>.artifactId = artifactId;

<span class="hljs-built_in">this</span>.name = name;

<span class="hljs-built_in">this</span>.parts = parts;

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p>A2A 协议还包含一个称为"智能体卡片"的东西。我也为它创建了一个模型。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentCard</span> {

<span class="hljs-keyword">private</span> String name;

<span class="hljs-keyword">private</span> String description;

<span class="hljs-keyword">private</span> String url;

<span class="hljs-keyword">private</span> Map&lt;String, String&gt; provider;

<span class="hljs-keyword">private</span> String version;

<span class="hljs-keyword">private</span> Map&lt;String, Boolean&gt; capabilities;

<span class="hljs-keyword">private</span> List&lt;String&gt; defaultInputModes;

<span class="hljs-keyword">private</span> List&lt;String&gt; defaultOutputModes;

<span class="hljs-keyword">private</span> List&lt;Map&lt;String, Object&gt;&gt; skills;

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">AgentCard</span><span class="hljs-params">()</span> {

<span class="hljs-built_in">this</span>.provider = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

<span class="hljs-built_in">this</span>.capabilities = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

<span class="hljs-built_in">this</span>.skills = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

}

  


<span class="hljs-comment">// getters and setters</span>

}

</code></pre>
<p>模型部分就这些了。继续...</p>
<h2 data-id="heading-5">服务类</h2>
<p>我的智能体的作用是获取一个正则表达式字符串，然后使用预定义的提示词将其发送到 OpenAI 的 API。服务类负责与 OpenAI 通信，发送提示词并接收响应。我创建了另一个名为 <code>service</code> 的文件夹，我的服务类就放在这里。我是这样编写我的服务类的：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@Service</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RegExPlainService</span> {

<span class="hljs-keyword">private</span> ChatClient chatClient;

  


RegExPlainService(ChatClient.Builder chatClientBuilder) {

<span class="hljs-built_in">this</span>.chatClient = chatClientBuilder.build();

}

  


<span class="hljs-meta">@Tool(name = "regexplain", description = "An agent that explains what type of string a regex pattern matches")</span>

<span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateResponse</span><span class="hljs-params">(String regex)</span> {

<span class="hljs-keyword">return</span> chatClient

.prompt(<span class="hljs-string">"Give me a simple explanation of the type of string matched by this regex pattern: %s. No validating statements from you. Just straight to the point"</span>.formatted(regex))

.call()

.content();

}

}

</code></pre>
<p><code>@Service</code> 注解允许 Spring Boot 将服务注入到您的控制器中。<code>@Tool</code> 注解将该方法标记为一个智能体工具，如果将来要扩展该智能体以包含该功能，它可以被自主调用。不过目前并不需要它。</p>
<h2 data-id="heading-6">控制器</h2>
<p>控制器通过 REST API 暴露该智能体。在这个案例中，我有两个端点，一个 GET 端点和一个 POST 端点。我在一个名为 <code>controller</code> 的文件夹中创建了我的控制器。实现如下：</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@RestController</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RegExPlainController</span> {

<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RegExPlainService regexplainService;

  


<span class="hljs-meta">@Autowired</span>

RegExPlainController (RegExPlainService regexplainService) {

<span class="hljs-built_in">this</span>.regexplainService = regexplainService;

}

  


<span class="hljs-meta">@GetMapping("/a2a/agent/regexplain/.well-known/agent.json")</span>

<span class="hljs-keyword">public</span> ResponseEntity&lt;AgentCard&gt; <span class="hljs-title function_">getAgentCard</span> <span class="hljs-params">()</span> {

<span class="hljs-type">AgentCard</span> <span class="hljs-variable">agentCard</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AgentCard</span>();

agentCard.setName(<span class="hljs-string">"regexplain"</span>);

agentCard.setDescription(<span class="hljs-string">"An agent that provides a simple explanation of the type of string a regex pattern matches"</span>);

agentCard.setUrl(<span class="hljs-string">"regexplain-production.up.railway.app/api"</span>);

agentCard.setProvider(<span class="hljs-string">"Bituan"</span>, <span class="hljs-literal">null</span>); <span class="hljs-comment">// 假设 setProvider 处理 Map 的填充</span>

agentCard.setVersion(<span class="hljs-string">"1.0"</span>);

agentCard.setCapabilities(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 假设 setCapabilities 处理 Map 的填充</span>

agentCard.setDefaultInputModes(List.of(<span class="hljs-string">"text/plain"</span>));

agentCard.setDefaultOutputModes(List.of(<span class="hljs-string">"application/json"</span>, <span class="hljs-string">"text/plain"</span>));

agentCard.setSkill(<span class="hljs-string">"skill-001"</span>, <span class="hljs-string">"Explain Regex"</span>, <span class="hljs-string">"Provides a simple explanation of the type of string a regex pattern matches"</span>,

List.of(<span class="hljs-string">"text/plain"</span>), List.of(<span class="hljs-string">"text/plain"</span>), List.of());

  


<span class="hljs-keyword">return</span> ResponseEntity.ok(agentCard);

}

  


<span class="hljs-meta">@PostMapping("/a2a/agent/regexplain")</span>

<span class="hljs-keyword">public</span> ResponseEntity&lt;A2AResponse&gt; <span class="hljs-title function_">explainRegex</span> <span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> A2ARequest request)</span> {

String regexRequest;

String responseText;

  


<span class="hljs-comment">// 如果参数无效，返回 403</span>

<span class="hljs-keyword">try</span> {

regexRequest = request.getParams().getMessage().getParts().get(<span class="hljs-number">0</span>).getText();

} <span class="hljs-keyword">catch</span> (Exception e) {

<span class="hljs-type">CustomError</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomError</span>(-<span class="hljs-number">32603</span>, <span class="hljs-string">"Invalid Parameter"</span>, Map.of(<span class="hljs-string">"details"</span>, e.getMessage()));

<span class="hljs-type">A2AResponse</span> <span class="hljs-variable">errorResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A2AResponse</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, error);

<span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatusCode.valueOf(<span class="hljs-number">403</span>)).body(errorResponse);

}

  


<span class="hljs-comment">// 如果调用服务失败，返回错误 500</span>

<span class="hljs-keyword">try</span> {

responseText = regexplainService.generateResponse(regexRequest);

} <span class="hljs-keyword">catch</span> (Exception e) {

<span class="hljs-type">CustomError</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomError</span>(-<span class="hljs-number">32603</span>, <span class="hljs-string">"Internal Error"</span>, Map.of(<span class="hljs-string">"details"</span>, e.getMessage()));

<span class="hljs-type">A2AResponse</span> <span class="hljs-variable">errorResponse</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A2AResponse</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, error);

<span class="hljs-keyword">return</span> ResponseEntity.internalServerError().body(errorResponse);

}

  


<span class="hljs-comment">// 构建响应</span>

<span class="hljs-type">A2AResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A2AResponse</span>();

response.setId(request.getId());

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果</span>

<span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>();

result.setId(UUID.randomUUID().toString());

result.setContextId(UUID.randomUUID().toString());

result.setKind(<span class="hljs-string">"task"</span>);

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建状态</span>

<span class="hljs-type">TaskStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskStatus</span>();

status.setState(<span class="hljs-string">"completed"</span>);

status.setTimestamp(Instant.now());

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建状态 -&gt; 构建消息</span>

<span class="hljs-type">HistoryMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HistoryMessage</span>();

message.setRole(<span class="hljs-string">"agent"</span>);

message.setParts(List.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePart</span>(<span class="hljs-string">"text"</span>, responseText, <span class="hljs-literal">null</span>)));

message.setKind(<span class="hljs-string">"message"</span>);

message.setMessageId(UUID.randomUUID().toString());

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建状态 (续)</span>

status.setMessage(message);

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建工件</span>

List&lt;Artifact&gt; artifacts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

<span class="hljs-type">Artifact</span> <span class="hljs-variable">artifact</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Artifact</span>();

artifact.setArtifactId(UUID.randomUUID().toString());

artifact.setName(<span class="hljs-string">"regexplainerResponse"</span>);

artifact.setParts(List.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePart</span>(<span class="hljs-string">"text"</span>, responseText, <span class="hljs-literal">null</span>)));

artifacts.add(artifact);

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 -&gt; 构建历史记录</span>

List&lt;HistoryMessage&gt; history = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

  


<span class="hljs-comment">// 构建响应 -&gt; 构建结果 (续)</span>

result.setStatus(status);

result.setArtifacts(artifacts);

result.setHistory(history);

  


<span class="hljs-comment">// 构建响应 (续)</span>

response.setResult(result);

  


<span class="hljs-keyword">return</span> ResponseEntity.ok(response);

}

}

</code></pre>
<ul>
<li>
<p>GET 端点使用的路由路径是 A2A 协议标准中用于获取智能体卡片的部分。智能体卡片是对智能体及其功能的描述。</p>
</li>
<li>
<p>POST 端点接收一个符合 A2A 标准的请求，执行智能体，然后返回适当的响应。</p>
</li>
</ul>
<h2 data-id="heading-7">结论</h2>
<p>就是这样。这就是我编写 Regexplain 的过程。</p>
<blockquote>
<p>通过这个示例，您可以从头开始构建您的 AI 智能体并使其符合 A2A 标准。或者，至少我希望这能让您对如何使用 Java 开发符合 A2A 标准的 AI 智能体有所了解。</p>
</blockquote>
<hr/>
<p>【注】本文译自：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Fbituan%2Fdeveloping-an-a2a-compliant-ai-agent-with-java-spring-boot-and-spring-ai-3l5e" target="_blank" title="https://dev.to/bituan/developing-an-a2a-compliant-ai-agent-with-java-spring-boot-and-spring-ai-3l5e" ref="nofollow noopener noreferrer">Developing an A2A-compliant AI Agent with Java, Spring Boot and Spring AI - DEV Community</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day 8：06. 基于Nuxt开发博客项目-我的服务模块开发]]></title>    <link>https://juejin.cn/post/7570976560708583487</link>    <guid>https://juejin.cn/post/7570976560708583487</guid>    <pubDate>2025-11-11T05:37:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976560708583487" data-draft-id="7571304204720144438" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day 8：06. 基于Nuxt开发博客项目-我的服务模块开发"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-11-11T05:37:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="申阳"/> <meta itemprop="url" content="https://juejin.cn/user/4353721775165486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day 8：06. 基于Nuxt开发博客项目-我的服务模块开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721775165486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    申阳
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:37:08.000Z" title="Tue Nov 11 2025 05:37:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e38b54a2eb8e40fda49a2e46ccc01311~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444227&amp;x-signature=wu3%2FSa7o5TnXYIhuvlKDOolVD4k%3D" alt="PixPin_2025-11-11_13-32-01.gif" loading="lazy"/></p>
<h2 data-id="heading-0">一、前言</h2>
<p>大家好，今天是基于<code>Nuxt.js</code>开发个人博客的第8天。前面完成了首页的开发，接下来这个是我们"个人公司"的核心 - 【我的服务】模块。</p>
<p>这个模块，远不止是简单罗列你能提供的服务。它是你从“被动”的内容输出者，转变为“主动”的价值提供者的关键一步，是你“个人公司”的<strong>商业门户</strong>。</p>
<p>这个是我的示例站点，在这里可以看到我目前的进度，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.csyblog.cn%2F" target="_blank" title="https://www.csyblog.cn/" ref="nofollow noopener noreferrer">www.csyblog.cn/</a></p>
<h2 data-id="heading-1">二、为什么你的博客必须有一个专业的“服务模块”？</h2>
<ol>
<li><strong>清晰的价值锚点：</strong> 一篇篇深入的文章展示了你的技术深度，而“服务模块”则清晰地告诉访客：“我能用这些技术为你解决什么问题？”（例如：定制化网站开发、技术咨询、SEO优化、企业培训）。这直接回答了潜在客户最关心的问题：“你能为我做什么？”</li>
<li><strong>建立专业信任感：</strong> 一个结构清晰、描述专业的服务页面，能极大增强你的可信度。它表明你不仅仅是一个技术爱好者，更是一位严谨的、可以提供商业解决方案的专业人士。</li>
<li><strong>高效的流量转化器：</strong> 你的技术博客通过SEO带来了精准的流量（例如，搜索“Nuxt4 项目实战”的开发者，很可能有相关项目需求）。一个醒目的“服务”入口，能将这部分高质量流量无缝引导至你的商业合作通道，实现从“阅读”到“咨询”的自然转化。</li>
<li><strong>提升个人品牌形象：</strong> 它将你的技能、经验和成功案例打包成一个完整的“产品”，让你的个人品牌更具商业价值和辨识度。</li>
</ol>
<h2 data-id="heading-2">三、<strong>个人公司展示服务的常见难点与我的解决方案</strong></h2>
<p>在开发这个模块时，我们深刻认识到个人公司面临的独特挑战，并在设计中予以解决：</p>
<h3 data-id="heading-3">难点1：服务项目多而杂，难以系统化展示。</h3>
<blockquote>
<p>作为“全能型”选手，你可能既能做前端，也能写后端，还能搞运维。但一股脑儿地罗列技能，反而会让访客对你的专业性产生质疑。</p>
</blockquote>
<p><strong>我的解决方案：</strong></p>
<blockquote>
<p>不要罗列技术栈，将服务进行逻辑归类（如：web开发、项目指导、经验分享），并为每个服务打上明确的标签。这样访客可以快速的定位到自己关心的领域，清晰直观。</p>
</blockquote>
<h3 data-id="heading-4">难点2：缺乏知名大客户背书，如何取信于人？</h3>
<blockquote>
<p>没有具体的服务经历，如何证明自己的能力？</p>
</blockquote>
<p><strong>我的解决方案：</strong></p>
<blockquote>
<p>在每项服务下，可以直接展示与之相关的<strong>个人项目案例</strong>。这些项目就是你最好的“客户”。</p>
<p>关联你写的相关<strong>技术博客</strong>。一篇深入剖析某个技术难点的文章，其说服力可能远超一句“我精通此技术”。这巧妙地用你的技术干货为你的服务能力做了强力背书。</p>
</blockquote>
<h3 data-id="heading-5">难点3：沟通成本高，如何高效筛选精准客户？</h3>
<blockquote>
<p>担心收到大量不匹配的咨询，浪费彼此时间。</p>
</blockquote>
<p><strong>我的解决方案：</strong></p>
<blockquote>
<p>在服务描述中，清晰界定服务内容、交付物、周期和预估价格范围。这几乎可以帮我们过滤掉<code>90%</code>的无效咨询。</p>
</blockquote>
<h2 data-id="heading-6">四、我的服务模块展示</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/825d8696a943463caefb66ecbdaa4908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444227&amp;x-signature=KUD%2BaBG0q2S2C8UPpfv2bn5TA8I%3D" alt="image-20251111115004063.png" loading="lazy"/></p>
<h2 data-id="heading-7">五、总结</h2>
<p>“我的服务”模块，是你博客的商业引擎。它不是为了炫耀，而是为了连接，将你的专业能力与市场的真实需求连接起来。</p>
<p><strong>你的博客，不应只是思想的仓库，更应是生意的起点。</strong></p>
<p><strong>千里之行，始于足下。你的“个人公司”从这第一个2小时开始。欢迎在评论区分享你的进展或遇到的卡点，我会逐一查看，尽可能的帮助解决。我们下一篇文章见！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS 上架工具全解析，从 Xcode 到 开心上架（Appuploader）跨平台命令行免 Mac 上传指南]]></title>    <link>https://juejin.cn/post/7571007466823204916</link>    <guid>https://juejin.cn/post/7571007466823204916</guid>    <pubDate>2025-11-11T05:40:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571007466823204916" data-draft-id="7571021605318443060" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS 上架工具全解析，从 Xcode 到 开心上架（Appuploader）跨平台命令行免 Mac 上传指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-11T05:40:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aiopencode"/> <meta itemprop="url" content="https://juejin.cn/user/1898230261493865"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS 上架工具全解析，从 Xcode 到 开心上架（Appuploader）跨平台命令行免 Mac 上传指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1898230261493865/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aiopencode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:40:16.000Z" title="Tue Nov 11 2025 05:40:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 iOS 应用发布流程中，<strong>选择合适的上架工具</strong> 直接决定了开发效率与审核体验。
传统的上架方式依赖 macOS 与 Xcode，而随着跨平台开发的普及，开发者越来越需要更灵活、跨系统、自动化的解决方案。</p>
<p>本文将带你全面了解 iOS 上架工具的生态格局，从官方工具到第三方自动化方案，再到跨平台使用。</p>
<hr/>
<h2 data-id="heading-0">一、iOS 应用上架流程简述</h2>
<p>在分析工具前，我们先明确 App Store 上架的标准流程：</p>





























<table><thead><tr><th>阶段</th><th>操作内容</th></tr></thead><tbody><tr><td>1</td><td>注册 Apple Developer 开发者账号（$99/年）</td></tr><tr><td>2</td><td>创建签名证书与描述文件</td></tr><tr><td>3</td><td>打包生成 IPA 文件</td></tr><tr><td>4</td><td>上传 IPA 到 App Store</td></tr><tr><td>5</td><td>提交审核并发布上线</td></tr></tbody></table>
<p>上传环节是整个流程中最容易出错、最耗时间的部分。
不同工具的选择，会显著影响上架体验。</p>
<hr/>
<h2 data-id="heading-1">二、官方 iOS 上架工具总览</h2>
<h3 data-id="heading-2">Xcode（官方最全方案）</h3>
<ul>
<li><strong>系统要求</strong>：macOS</li>
<li><strong>特点</strong>：集成度高，可直接构建、签名、上传</li>
<li><strong>使用方式</strong>：
<ul>
<li>打包：<code>Product → Archive</code></li>
<li>上传：<code>Distribute App → App Store Connect</code></li>
</ul>
</li>
</ul>
<p>优点：稳定、官方支持
缺点：必须使用 Mac；手动流程多，不适合跨平台团队。</p>
<hr/>
<h3 data-id="heading-3">Transporter（App Store Connect 官方工具）</h3>
<ul>
<li><strong>系统要求</strong>：仅限 macOS</li>
<li><strong>使用方式</strong>：拖拽 IPA 上传至 App Store</li>
<li><strong>适合对象</strong>：非开发人员、需要批量上传的企业账号</li>
</ul>
<p>优点：图形化操作简单
缺点：仅支持 macOS；无法命令行自动化。</p>
<hr/>
<h3 data-id="heading-4">altool（已废弃）</h3>
<ul>
<li>
<p><strong>系统要求</strong>：macOS + Xcode Command Line Tools</p>
</li>
<li>
<p><strong>命令示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">xcrun altool --upload-app -f MyApp.ipa -u dev@icloud.com -p xxx
</code></pre>
</li>
<li>
<p><strong>现状</strong>：被 Transporter 接口替代，不推荐新项目使用。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">Fastlane（自动化工具链）</h3>
<ul>
<li>
<p><strong>系统要求</strong>：macOS（可虚拟）</p>
</li>
<li>
<p><strong>主要功能</strong>：打包、签名、上传、截图管理</p>
</li>
<li>
<p><strong>常用命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">fastlane pilot upload --ipa ./build/MyApp.ipa
</code></pre>
</li>
</ul>
<p>优点：高度自动化、适合持续集成（CI/CD）
缺点：依赖 Mac 环境，对初学者配置较复杂。</p>
<hr/>
<h2 data-id="heading-6">三、第三方跨平台 iOS 上架工具对比</h2>
<p>随着跨平台开发（Flutter、uni-app、React Native）的流行，
许多开发者在 Windows 或 Linux 系统中工作，
这促生了一批 <strong>跨系统上架工具</strong>。</p>





























<table><thead><tr><th>工具</th><th>系统支持</th><th>上传方式</th><th>特点</th></tr></thead><tbody><tr><td><strong>Appuploader（开心上架）</strong></td><td>Win / Linux / macOS</td><td>图形界面 + 命令行</td><td>支持免 Mac 上传</td></tr><tr><td><strong>Fastlane + Transporter API</strong></td><td>macOS / Linux（API 模式）</td><td>命令行</td><td>可用于自动化上传</td></tr><tr><td><strong>第三方代上架平台</strong></td><td>Web 平台</td><td>远程代传</td><td>成本高、安全风险较大</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">四、开心上架（Appuploader）：全平台免 Mac 解决方案</h2>
<p>新版 <strong>开心上架（Appuploader）命令行工具</strong> 提供了真正意义上的跨平台能力，
开发者无需 Mac，即可在任意系统上传 iOS 应用到 App Store。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbec2faa28384353bd31bbf23e3812d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWlvcGVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444415&amp;x-signature=whNuWJpSkw7SV5PD6L%2BUg7ZO5N8%3D" alt="首页" loading="lazy"/></p>
<h3 data-id="heading-8">命令行示例：</h3>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f ./release/MyApp.ipa
</code></pre>

























<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-u</code></td><td>Apple 开发者账号</td></tr><tr><td><code>-p</code></td><td>App 专用密码（非 Apple ID 密码）</td></tr><tr><td><code>-c</code></td><td>上传通道（1=旧通道，2=新通道）</td></tr><tr><td><code>-f</code></td><td>指定要上传的 IPA 文件路径</td></tr></tbody></table>
<p><strong>核心特性</strong>：</p>
<ul>
<li>支持 <strong>Windows / Linux / macOS</strong>；</li>
<li>完全免 Xcode、免 Mac；</li>
<li>支持多通道上传；</li>
<li>提供命令行自动化接口；</li>
<li>不携带设备信息，安全稳定；</li>
<li>可集成 Fastlane / Jenkins / GitLab CI 流水线。</li>
</ul>
<hr/>
<h2 data-id="heading-9">五、开心上架与 Fastlane 的自动化组合</h2>
<p>在持续集成（CI/CD）环境中，开发者可将两者结合：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 构建应用</span>
fastlane gym --scheme <span class="hljs-string">"MyApp"</span> --output_directory <span class="hljs-string">"./build"</span>

<span class="hljs-comment"># 上传应用</span>
appuploader_cli -u dev@icloud.com -p xxx-xxx-xxx-xxx -c 2 -f ./build/MyApp.ipa
</code></pre>
<p>这样即可在 <strong>Windows / Linux</strong> CI 环境中自动上传 IPA 文件，
实现 “构建 → 上传 → 审核” 全自动上架流程。</p>
<hr/>
<h2 data-id="heading-10">六、不同 iOS 上架工具的对比总结</h2>








































<table><thead><tr><th>工具</th><th>平台</th><th>自动化支持</th><th>是否免 Mac</th><th>适合场景</th></tr></thead><tbody><tr><td>Xcode</td><td>macOS</td><td>不支持</td><td>否</td><td>原生开发者</td></tr><tr><td>Transporter</td><td>macOS</td><td>不支持</td><td>否</td><td>小规模手动上传</td></tr><tr><td>Fastlane</td><td>macOS / Linux（API 模式）</td><td>支持</td><td>部分</td><td>自动化流水线</td></tr><tr><td>Appuploader（开心上架）</td><td>Win / Linux / macOS</td><td>支持</td><td>是</td><td>跨平台团队与个人开发者</td></tr></tbody></table>
<p><strong>结论</strong>：
对于没有 Mac 环境的开发者或跨平台团队，
<strong>开心上架 CLI 是当前最具性价比的 iOS 上架工具方案</strong>。</p>
<hr/>
<h2 data-id="heading-11">七、常见问题与解决方案</h2>



































<table><thead><tr><th>问题</th><th>原因</th><th>解决方式</th></tr></thead><tbody><tr><td>上传失败 “Invalid Credentials”</td><td>密码错误</td><td>使用 App 专用密码</td></tr><tr><td>上传速度慢</td><td>网络不稳</td><td>切换上传通道（<code>-c 2</code>）</td></tr><tr><td>签名无效</td><td>证书配置错误</td><td>使用 Appuploader 自动生成</td></tr><tr><td>审核被拒</td><td>隐私声明缺失</td><td>补充 Info.plist 权限说明</td></tr><tr><td>构建未显示</td><td>Bundle ID 不匹配</td><td>检查证书与 App ID 对应关系</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">八、iOS 上架工具的选择建议</h2>





























<table><thead><tr><th>场景</th><th>推荐方案</th></tr></thead><tbody><tr><td>个人开发者</td><td>开心上架（Appuploader）命令行版</td></tr><tr><td>团队协作</td><td>Fastlane + Appuploader 自动化</td></tr><tr><td>Mac 用户</td><td>Xcode + Transporter 组合</td></tr><tr><td>无 Mac 环境</td><td>Appuploader 独立使用</td></tr><tr><td>多系统混合团队</td><td>HBuilderX 打包 + Appuploader 上传</td></tr></tbody></table>
<p>无论哪种方案，确保 IPA 包签名正确是成功上传的前提。</p>
<hr/>
<p><strong>iOS 上架工具</strong> 的演进，见证了从封闭到开放、从手动到自动化的变迁。
如今，开发者不再被 Mac 环境限制，通过一些跨平台工具，即可在任何系统中高效、安全地完成 App 上传与发布。</p>
<p>参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.applicationloader.net%2Ftutorial%2Fzh%2F83%2F83.html" target="_blank" title="https://www.applicationloader.net/tutorial/zh/83/83.html" ref="nofollow noopener noreferrer">www.applicationloader.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？]]></title>    <link>https://juejin.cn/post/7570984257667366958</link>    <guid>https://juejin.cn/post/7570984257667366958</guid>    <pubDate>2025-11-11T03:13:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984257667366958" data-draft-id="7571028035017867290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？  "/> <meta itemprop="keywords" content="前端,Trae,AI编程"/> <meta itemprop="datePublished" content="2025-11-11T03:13:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？  
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:13:12.000Z" title="Tue Nov 11 2025 03:13:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、响应式系统的工作原理</h3>
<p>Vue3的响应式系统基于<strong>Proxy</strong>实现，通过代理对象（或数组）跟踪属性的<strong>读取</strong>（<code>get</code>）和<strong>修改</strong>（<code>set</code>）操作。当属性变化时，Vue会自动触发依赖更新，同步视图。</p>
<p>但Proxy并非“全能”——它只能跟踪<strong>初始存在的属性</strong>和<strong>已知的变更操作</strong>，对于一些“非常规”修改（如新增属性、直接修改数组索引），无法自动触发响应，需要我们手动规避。</p>
<h3 data-id="heading-1">二、对象的局限性：新增/删除属性不响应</h3>
<h4 data-id="heading-2">1. 问题描述</h4>
<p>用<code>reactive</code>创建的响应式对象，<strong>新增属性</strong>或<strong>删除属性</strong>时，无法触发视图更新。因为Proxy默认只跟踪对象初始化时的<strong>已有属性</strong>，新增/删除的属性不在初始跟踪范围内。</p>
<p>示例（错误用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> });

<span class="hljs-comment">// 新增属性：视图不更新</span>
user.<span class="hljs-property">age</span> = <span class="hljs-number">20</span>;

<span class="hljs-comment">// 删除属性：视图不更新</span>
<span class="hljs-keyword">delete</span> user.<span class="hljs-property">name</span>;
</code></pre>
<h4 data-id="heading-3">2. 规避方案</h4>
<p>针对对象的新增/删除操作，Vue3提供了3种标准解决方案：</p>
<h5 data-id="heading-4">(1) 使用<code>set</code>/<code>delete</code>函数</h5>
<p><code>set</code>（<code>Vue.set</code>的简写）用于向响应式对象<strong>新增属性</strong>，<code>delete</code>（<code>Vue.delete</code>的简写）用于<strong>删除属性</strong>，两者都会触发响应式更新。</p>
<p>示例（正确用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive, set, <span class="hljs-keyword">delete</span> <span class="hljs-keyword">as</span> vueDelete } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> });

<span class="hljs-comment">// 新增响应式属性</span>
<span class="hljs-title function_">set</span>(user, <span class="hljs-string">'age'</span>, <span class="hljs-number">20</span>); <span class="hljs-comment">// 视图更新为 { name: 'Alice', age: 20 }</span>

<span class="hljs-comment">// 删除响应式属性</span>
<span class="hljs-title function_">vueDelete</span>(user, <span class="hljs-string">'name'</span>); <span class="hljs-comment">// 视图更新为 { age: 20 }</span>
</code></pre>
<h5 data-id="heading-5">(2) 扩展运算符生成新对象</h5>
<p>通过<strong>扩展运算符</strong>（<code>...</code>）创建新对象，替换原对象。新对象会继承原对象的响应式能力，触发视图更新。</p>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> userRef = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> }); <span class="hljs-comment">// 用ref包裹对象</span>

<span class="hljs-comment">// 新增属性：生成新对象</span>
userRef.<span class="hljs-property">value</span> = { ...userRef.<span class="hljs-property">value</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> }; <span class="hljs-comment">// 响应式更新</span>
</code></pre>
<h5 data-id="heading-6">(3) 初始定义所有可能的属性</h5>
<p>如果提前知道对象的所有属性，可以在<code>reactive</code>初始化时就定义（值为<code>undefined</code>），后续修改时会自动触发响应。</p>
<details>
<summary>往期文章归档</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3中watch侦听器的正确使用姿势你掌握了吗？深度监听、与watchEffect的差异及常见报错解析 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">为什么Vue 3需要ref函数？它的响应式原理与正确用法是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3中reactive函数如何通过Proxy实现响应式？使用时要避开哪些误区？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3响应式系统的底层原理与实践要点你真的懂吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3模板如何通过编译三阶段实现从声明式语法到高效渲染的跨越 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">快速入门Vue模板引用：从收DOM“快递”到调子组件方法，你玩明白了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">快速入门Vue模板里的JS表达式有啥不能碰？计算属性为啥比方法更能打？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">快速入门Vue的v-model表单绑定：语法糖、动态值、修饰符的小技巧你都掌握了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">快速入门Vue3事件处理的挑战题：v-on、修饰符、自定义事件你能通关吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">快速入门Vue3的v-指令：数据和DOM的“翻译官”到底有多少本事？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">快速入门Vue3，插值、动态绑定和避坑技巧你都搞懂了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">想让PostgreSQL快到飞起？先找健康密码还是先换引擎？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">想让PostgreSQL查询快到飞起？分区表、物化视图、并行查询这三招灵不灵？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">子查询总拖慢查询？把它变成连接就能解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQL全表扫描慢到崩溃？建索引+改查询+更统计信息三招能破？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">复杂查询总拖后腿？PostgreSQL多列索引+覆盖索引的神仙技巧你get没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">只给表子集建索引？用函数结果建索引？PostgreSQL这俩操作凭啥能省空间又加速？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-tree索引像字典查词一样工作？那哪些数据库查询它能加速，哪些不能？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">想抓PostgreSQL里的慢SQL？pg_stat_statements基础黑匣子和pg_stat_monitor时间窗，谁能帮你更准揪出性能小偷？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQL的“时光机”MVCC和锁机制是怎么搞定高并发的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQL性能暴涨的关键？内存IO并发参数居然要这么设置？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">大表查询慢到翻遍整个书架？PostgreSQL分区表教你怎么“分类”才高效</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL 查询慢？是不是忘了优化 GROUP BY、ORDER BY 和窗口函数？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQL里的子查询和CTE居然在性能上“掐架”？到底该站哪边？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQL选Join策略有啥小九九？Nested Loop/Merge/Hash谁是它的菜？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQL新手SQL总翻车？这7个性能陷阱你踩过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQL索引选B-Tree还是GiST？“瑞士军刀”和“多面手”的差别你居然还不知道？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">想知道数据库怎么给查询“算成本选路线”？EXPLAIN能帮你看明白？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQL处理SQL居然像做蛋糕？解析到执行的4步里藏着多少查询优化的小心机？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQL备份不是复制文件？物理vs逻辑咋选？误删还能精准恢复到1分钟前？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">转账不翻车、并发不干扰，PostgreSQL的ACID特性到底有啥魔法？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">银行转账不白扣钱、电商下单不超卖，PostgreSQL事务的诀窍是啥？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQL里的PL/pgSQL到底是啥？能让SQL从“说目标”变“讲步骤”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQL视图不存数据？那它怎么简化查询还能递归生成序列和控制权限？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQL索引这么玩，才能让你的查询真的“飞”起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQL的表关系和约束，咋帮你搞定用户订单不混乱、学生选课不重复？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQL查询的筛子、排序、聚合、分组？你会用它们搞定数据吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQL数据类型怎么选才高效不踩坑？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">想解锁PostgreSQL查询从基础到进阶的核心知识点？你都get了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETE居然有这些操作？返回数据、连表删你试过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATE语句怎么玩？从改邮箱到批量更新的避坑技巧你都会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQL插入数据还在逐条敲？批量、冲突处理、返回自增ID的技巧你会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQL的“仓库-房间-货架”游戏，你能建出电商数据库和表吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17安装总翻车？Windows/macOS/Linux避坑指南帮你搞定？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">能当关系型数据库还能玩对象特性，能拆复杂查询还能自动管库存，PostgreSQL凭什么这么香？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">给接口加新字段又不搞崩老客户端？FastAPI的多版本API靠哪三招实现？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">流量突增要搞崩FastAPI？熔断测试是怎么防系统雪崩的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPI秒杀库存总变负数？Redis分布式锁能帮你守住底线吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPI的CI流水线怎么自动测端点，还能让Allure报告美到犯规？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">如何用GitHub Actions为FastAPI项目打造自动化测试流水线？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ffc4ef84559e04693a620d0714cb30787%2F" target="_blank" title="https://blog.cmdragon.cn/posts/fc4ef84559e04693a620d0714cb30787/" ref="nofollow noopener noreferrer">如何用Git Hook和CI流水线为FastAPI项目保驾护航？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F02b0c96842d1481c72dab63a149ce0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/02b0c96842d1481c72dab63a149ce0dd/" ref="nofollow noopener noreferrer">FastAPI如何用契约测试确保API的「菜单」与「菜品」一致？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc9c1e3bb0fdc15303b9b3b1f20124b0b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c9c1e3bb0fdc15303b9b3b1f20124b0b/" ref="nofollow noopener noreferrer">为什么TDD能让你的FastAPI开发飞起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbfa0447a5d0d6f9af12e7a6b206f70%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbfa0447a5d0d6f9af12e7a6b206f70/" ref="nofollow noopener noreferrer">如何用FastAPI玩转多模块测试与异步任务，让代码不再“闹脾气”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf9883a75ffa46b523a03b16ec56ce48%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf9883a75ffa46b523a03b16ec56ce48/" ref="nofollow noopener noreferrer">如何在FastAPI中玩转“时光倒流”的数据库事务回滚测试？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe553dbd5d51835d2c69553f4a773e2d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be553dbd5d51835d2c69553f4a773e2d/" ref="nofollow noopener noreferrer">如何在FastAPI中优雅地模拟多模块集成测试？ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>免费好用的热门在线工具</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID 计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">在线PS - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid 在线编辑器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">数学求解计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">智能提词器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">魔法简历 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - 图片拼图工具 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">字幕下载工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">歌词生成工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">网盘资源聚合搜索 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCII字符画生成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens 工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt 密码工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF 合成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF 分解器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">文本隐写术 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon 在线工具 - 高级AI工具箱与开发者套件 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">应用商店 - 发现1000+提升效率与开发的AI工具和实用程序 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon 更新日志 - 最新更新、功能与改进 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">支持我们 - 成为赞助者 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AI文本生成图像 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">临时邮箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">二维码解析器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">文本转思维导图 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">正则表达式可视化工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">文件隐写工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV 频道探索器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">快传 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">随机抽奖工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">动漫场景查找器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">时间工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">网速测试 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI 智能抠图工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">背景替换工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">艺术二维码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph 元标签生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">图像对比工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">图片压缩专业版 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">密码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVG优化器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">调色板生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">在线节拍器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSS网格布局生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">邮箱验证工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">书法练习字帖 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">金融计算器套件 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">中国亲戚关系计算器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer 工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">图片无损放大 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">文本比较工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IP批量查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">域名查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNS工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">网站图标生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>, <span class="hljs-attr">age</span>: <span class="hljs-literal">undefined</span> }); <span class="hljs-comment">// 初始定义age</span>

user.<span class="hljs-property">age</span> = <span class="hljs-number">20</span>; <span class="hljs-comment">// 响应式更新（视图显示20）</span>
</code></pre>
<h3 data-id="heading-7">三、数组的局限性：直接修改索引/长度不响应</h3>
<h4 data-id="heading-8">1. 问题描述</h4>
<p>用<code>reactive</code>或<code>ref</code>包裹的数组，<strong>直接修改索引</strong>或<strong>修改长度</strong>时，Vue3早期版本无法触发响应（官网文档仍保留此说明）。尽管最新版本（v3.4+）已支持，但为了兼容性，仍建议用<strong>变异方法</strong>或<code>set</code>函数。</p>
<p>示例（不推荐用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);

<span class="hljs-comment">// 直接修改索引：早期版本不响应</span>
list.<span class="hljs-property">value</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">4</span>;

<span class="hljs-comment">// 修改长度：早期版本不响应</span>
list.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> = <span class="hljs-number">2</span>;
</code></pre>
<h4 data-id="heading-9">2. 规避方案</h4>
<p>Vue3推荐用<strong>数组变异方法</strong>或<code>set</code>函数修改数组，确保响应式：</p>
<h5 data-id="heading-10">(1) 使用数组变异方法</h5>
<p>Vue3自动跟踪数组的<strong>变异方法</strong>（修改原数组的方法），这些方法会触发响应式更新。常用变异方法：</p>
<ul>
<li><code>push()</code>：末尾添加元素</li>
<li><code>pop()</code>：末尾删除元素</li>
<li><code>splice()</code>：插入/删除/替换元素</li>
<li><code>sort()</code>：排序</li>
<li><code>reverse()</code>：反转</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);

<span class="hljs-comment">// 修改索引0的值：用splice</span>
list.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// 替换第0个元素为4（响应式）</span>

<span class="hljs-comment">// 修改长度：用splice</span>
list.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// 删除索引2及之后的元素（长度变为2，响应式）</span>
</code></pre>
<h5 data-id="heading-11">(2) 使用<code>set</code>函数</h5>
<p><code>set</code>函数可直接修改数组的指定索引，触发响应式更新。</p>
<p>示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, set } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);

<span class="hljs-comment">// 修改索引0的值：响应式</span>
<span class="hljs-title function_">set</span>(list.<span class="hljs-property">value</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);
</code></pre>
<h3 data-id="heading-12">四、原始值的局限性：<code>reactive</code>无法代理</h3>
<h4 data-id="heading-13">1. 问题描述</h4>
<p><code>reactive</code>只能代理<strong>对象或数组</strong>，无法代理<strong>原始值</strong>（如<code>number</code>、<code>string</code>、<code>boolean</code>）。直接用<code>reactive</code>包裹原始值会报错。</p>
<p>示例（错误用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 报错：value cannot be made reactive: 0</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">reactive</span>(<span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-14">2. 规避方案：使用<code>ref</code></h4>
<p><code>ref</code>是Vue3专门用于代理<strong>原始值</strong>的API，它会将原始值包裹在一个带<code>value</code>属性的响应式对象中。访问或修改时需通过<code>.value</code>（模板中无需<code>.value</code>，Vue会自动解包）。</p>
<p>示例（正确用法）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 用ref代理原始值</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// 修改值：响应式</span>
count.<span class="hljs-property">value</span>++; <span class="hljs-comment">// 变为1</span>

<span class="hljs-comment">// 模板中使用：自动解包</span>
<span class="hljs-comment">// &lt;div&gt;{{ count }}&lt;/div&gt; // 显示1</span>
</code></pre>
<h3 data-id="heading-15">五、实践案例：购物车功能的响应式处理</h3>
<p>我们用上述知识实现一个<strong>购物车功能</strong>，包含商品的添加、删除和数量修改：</p>
<h4 data-id="heading-16">1. 需求分析</h4>
<ul>
<li>商品列表：响应式数组，支持添加、删除。</li>
<li>数量修改：点击“+”/“-”按钮，更新商品数量并同步总价。</li>
<li>总价计算：根据商品数量和单价，实时更新。</li>
</ul>
<h4 data-id="heading-17">2. 完整代码</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="cart"&gt;
    &lt;h2&gt;购物车&lt;/h2&gt;
    &lt;!-- 商品列表 --&gt;
    &lt;div v-for="(item, index) in cart" :key="item.id" class="cart-item"&gt;
      &lt;span&gt;{{ item.name }}&lt;/span&gt;
      &lt;button @click="decrement(index)"&gt;-&lt;/button&gt;
      &lt;span&gt;{{ item.quantity }}&lt;/span&gt;
      &lt;button @click="increment(index)"&gt;+&lt;/button&gt;
      &lt;button @click="removeItem(index)"&gt;删除&lt;/button&gt;
    &lt;/div&gt;
    &lt;!-- 总价 --&gt;
    &lt;p class="total"&gt;总价：{{ totalPrice }} 元&lt;/p&gt;
    &lt;!-- 添加商品按钮 --&gt;
    &lt;button @click="addItem" class="add-btn"&gt;添加商品&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, computed } from 'vue';

// 1. 用ref包裹购物车数组（支持响应式）
const cart = ref([
  { id: 1, name: '商品A', quantity: 1, price: 100 },
  { id: 2, name: '商品B', quantity: 2, price: 200 }
]);

// 2. 计算总价（响应式：依赖cart的变化）
const totalPrice = computed(() =&gt; {
  return cart.value.reduce((sum, item) =&gt; sum + item.quantity * item.price, 0);
});

// 3. 增加数量：用splice修改数组（遵循官网推荐）
function increment(index) {
  const item = cart.value[index];
  // 生成新商品对象（避免直接修改原对象）
  const newItem = { ...item, quantity: item.quantity + 1 };
  // 用splice替换原商品（触发响应式）
  cart.value.splice(index, 1, newItem);
}

// 4. 减少数量：用splice修改数组
function decrement(index) {
  const item = cart.value[index];
  if (item.quantity &gt; 1) {
    const newItem = { ...item, quantity: item.quantity - 1 };
    cart.value.splice(index, 1, newItem);
  }
}

// 5. 删除商品：用splice修改数组
function removeItem(index) {
  cart.value.splice(index, 1);
}

// 6. 添加商品：用push修改数组
function addItem() {
  const newItem = {
    id: Date.now(), // 用时间戳作为唯一ID
    name: `商品${cart.value.length + 1}`,
    quantity: 1,
    price: Math.floor(Math.random() * 100) + 50 // 随机单价（50-149元）
  };
  cart.value.push(newItem); // push是变异方法，触发响应式
}
&lt;/script&gt;

&lt;style scoped&gt;
.cart { max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #eee; }
.cart-item { display: flex; align-items: center; margin: 10px 0; }
.cart-item span { margin: 0 10px; }
.total { font-weight: bold; margin: 20px 0; }
.add-btn { padding: 8px 16px; background: #42b983; color: #fff; border: none; border-radius: 4px; }
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-18">3. 代码说明</h4>
<ul>
<li><strong><code>ref</code>包裹数组</strong>：<code>cart</code>是<code>ref</code>对象，<code>cart.value</code>是响应式数组，修改时需通过<code>.value</code>。</li>
<li><strong>变异方法的使用</strong>：<code>splice</code>（修改数量、删除商品）、<code>push</code>（添加商品）都是数组变异方法，确保响应式。</li>
<li><strong>计算属性<code>computed</code></strong>：<code>totalPrice</code>依赖<code>cart</code>的变化，自动更新总价，无需手动触发。</li>
</ul>
<h3 data-id="heading-19">课后Quiz：测试你的理解</h3>
<h4 data-id="heading-20">问题1</h4>
<p>用<code>reactive</code>创建的对象<code>const user = reactive({ name: 'Alice' })</code>，如何新增响应式属性<code>age</code>？（至少2种方法）</p>
<h4 data-id="heading-21">问题2</h4>
<p>用<code>ref</code>包裹的数组<code>const list = ref([1,2,3])</code>，如何修改索引0的值为4？（至少2种方法）</p>
<h4 data-id="heading-22">答案解析</h4>
<p><strong>问题1答案</strong>：</p>
<ol>
<li>使用<code>set</code>函数：<code>set(user, 'age', 20)</code>。</li>
<li>扩展运算符生成新对象：<code>const userRef = ref(user); userRef.value = { ...userRef.value, age: 20 }</code>（<code>reactive</code>对象不能直接赋值，需用<code>ref</code>包裹）。</li>
</ol>
<p><strong>问题2答案</strong>：</p>
<ol>
<li>用<code>splice</code>：<code>list.value.splice(0, 1, 4)</code>。</li>
<li>用<code>set</code>函数：<code>set(list.value, 0, 4)</code>。</li>
<li>直接修改（最新版本支持）：<code>list.value[0] = 4</code>。</li>
</ol>
<h3 data-id="heading-23">常见报错解决方案</h3>
<h4 data-id="heading-24">报错1：<code>value cannot be made reactive: 0</code></h4>
<ul>
<li><strong>原因</strong>：<code>reactive</code>无法代理原始值（如<code>number</code>）。</li>
<li><strong>解决</strong>：用<code>ref</code>代替<code>reactive</code>：<code>const count = ref(0)</code>。</li>
</ul>
<h4 data-id="heading-25">报错2：<code>Cannot add property age, object is not extensible</code></h4>
<ul>
<li><strong>原因</strong>：<code>reactive</code>对象被冻结（<code>Object.freeze</code>），无法新增属性。</li>
<li><strong>解决</strong>：不要冻结响应式对象，或用<code>ref</code>包裹后修改<code>.value</code>。</li>
</ul>
<h4 data-id="heading-26">报错3：<code>TypeError: Cannot read properties of undefined (reading 'value')</code></h4>
<ul>
<li><strong>原因</strong>：<code>ref</code>对象未初始化，或模板中错误使用<code>.value</code>。</li>
<li><strong>解决</strong>：确保<code>ref</code>初始值非<code>undefined</code>，模板中直接用变量名（如<code>{{ count }}</code>而非<code>{{ count.value }}</code>）。</li>
</ul>
<h3 data-id="heading-27">预防报错的建议</h3>
<ol>
<li><strong>原始值用<code>ref</code></strong>：<code>reactive</code>只代理对象/数组，原始值优先用<code>ref</code>。</li>
<li><strong>数组用变异方法</strong>：修改数组时，优先用<code>push</code>、<code>splice</code>等变异方法，避免直接修改索引。</li>
<li><strong>对象新增属性用<code>set</code></strong>：新增对象属性时，用<code>set</code>函数而非直接赋值。</li>
</ol>
<h3 data-id="heading-28">参考链接</h3>
<ul>
<li>Vue3官网“响应式系统的局限性”：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Freactivity-fundamentals.html%23limitations-of-reactive" target="_blank" title="https://vuejs.org/guide/essentials/reactivity-fundamentals.html#limitations-of-reactive" ref="nofollow noopener noreferrer">vuejs.org/guide/essen…</a></li>
<li>Vue3官网“Ref API”：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fapi%2Freactivity-core.html%23ref" target="_blank" title="https://vuejs.org/api/reactivity-core.html#ref" ref="nofollow noopener noreferrer">vuejs.org/api/reactiv…</a></li>
<li>Vue3官网“数组变异方法”：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Freactivity-fundamentals.html%23caveat-in-arrays-and-collections" target="_blank" title="https://vuejs.org/guide/essentials/reactivity-fundamentals.html#caveat-in-arrays-and-collections" ref="nofollow noopener noreferrer">vuejs.org/guide/essen…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Object.fromEntries 实操]]></title>    <link>https://juejin.cn/post/7570976274238308398</link>    <guid>https://juejin.cn/post/7570976274238308398</guid>    <pubDate>2025-11-11T03:47:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976274238308398" data-draft-id="7571086754879455278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Object.fromEntries 实操"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-11T03:47:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ric970"/> <meta itemprop="url" content="https://juejin.cn/user/1181319736075502"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Object.fromEntries 实操
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1181319736075502/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ric970
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T03:47:09.000Z" title="Tue Nov 11 2025 03:47:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上周帮实习生排查需求，发现他用 for 循环遍历数组转对象，写了 12 行代码还容易出错 —— 其实用 Object.fromEntries，3 行就能搞定，还能避免职场踩坑。</p>
<hr/>
<h2 data-id="heading-0">一、原理拆解：为什么 Object.fromEntries 更高效？</h2>
<h3 data-id="heading-1">核心逻辑</h3>
<p><code>Object.fromEntries()</code> 是 ES2019 新增的 API，作用是<strong>将键值对数组转换成对象</strong>，本质是 <code>Object.entries()</code> 的逆操作：</p>
<ul>
<li>输入：格式为 <code>[[key1, value1], [key2, value2]]</code> 的二维数组</li>
<li>输出：对应键值对组成的普通对象</li>
<li>底层：直接映射键值关系，无需手动维护索引和赋值，性能比 for 循环更优</li>
</ul>
<h3 data-id="heading-2">职场痛点关联</h3>
<p>新人常踩的 3 个坑，用它能直接规避：</p>
<ol>
<li>循环遍历漏处理空值，导致对象缺属性；</li>
<li>手动赋值时键名拼写错误，排查半小时；</li>
<li>嵌套数组转对象时，代码冗余难维护。</li>
</ol>
<hr/>
<h2 data-id="heading-3">二、实操步骤：3 种核心场景 + 代码示例</h2>
<h3 data-id="heading-4">场景 1：基础数组转对象（最常用）</h3>
<h4 data-id="heading-5">步骤：</h4>
<ol>
<li>准备键值对二维数组；</li>
<li>直接传入 <code>Object.fromEntries()</code>；</li>
<li>接收返回的目标对象。</li>
</ol>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 原始数组（接口返回常见格式）</span>
const userList = <span class="hljs-selector-attr">[  [<span class="hljs-string">'name'</span>, <span class="hljs-string">'张三'</span>]</span>,
  <span class="hljs-selector-attr">[<span class="hljs-string">'age'</span>, 28]</span>,
  <span class="hljs-selector-attr">[<span class="hljs-string">'role'</span>, <span class="hljs-string">'前端开发'</span>]</span>
];

<span class="hljs-comment">// 转换（仅1行代码）</span>
const userObj = <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.fromEntries</span>(userList);

console<span class="hljs-selector-class">.log</span>(userObj);
<span class="hljs-comment">// 输出：{ name: '张三', age: 28, role: '前端开发' }</span>
</code></pre>
<h3 data-id="heading-6">场景 2：数组处理后转对象（结合 map）</h3>
<h4 data-id="heading-7">步骤：</h4>
<ol>
<li>用 <code>map()</code> 处理原始数组，生成键值对结构；</li>
<li>链式调用 <code>Object.fromEntries()</code> 完成转换。</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">// 原始数据（后端返回的列表）
const <span class="hljs-attr">goodsList</span> = [
  { id: <span class="hljs-string">'g1'</span>, price: <span class="hljs-number">99</span> },
  { id: <span class="hljs-string">'g2'</span>, price: <span class="hljs-number">199</span> },
  { id: <span class="hljs-string">'g3'</span>, price: <span class="hljs-number">299</span> }
]<span class="hljs-comment">;</span>

// 转换为「商品ID-价格」映射对象
const <span class="hljs-attr">priceMap</span> = Object.fromEntries(
  goodsList.map(<span class="hljs-attr">goods</span> =&gt; [goods.id, goods.price]) // 生成键值对数组
)<span class="hljs-comment">;</span>

console.log(priceMap)<span class="hljs-comment">;</span>
// 输出：{ g1: 99, g2: 199, g3: 299 }
</code></pre>
<h3 data-id="heading-8">场景 3：嵌套数组转多层对象（进阶）</h3>
<h4 data-id="heading-9">步骤：</h4>
<ol>
<li>处理嵌套结构，提取深层键值；</li>
<li>分步骤转换或结合递归（复杂场景）。</li>
</ol>
<pre><code class="hljs language-css" lang="css">// 嵌套数组（配置项场景）
const configList = <span class="hljs-selector-attr">[  [<span class="hljs-string">'theme'</span>, [<span class="hljs-string">'color'</span>, <span class="hljs-string">'dark'</span>]</span>],
  <span class="hljs-selector-attr">[<span class="hljs-string">'layout'</span>, [<span class="hljs-string">'mode'</span>, <span class="hljs-string">'flex'</span>]</span>]
];

// 转多层对象
const configObj = <span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.fromEntries</span>(
  configList<span class="hljs-selector-class">.map</span>((<span class="hljs-selector-attr">[key, [subKey, subValue]</span>]) =&gt; <span class="hljs-selector-attr">[key, { [subKey]</span>: subValue }])
);

console<span class="hljs-selector-class">.log</span>(configObj);
// 输出：{ theme: { <span class="hljs-attribute">color</span>: <span class="hljs-string">'dark'</span> }, layout: { mode: <span class="hljs-string">'flex'</span> } }
</code></pre>
<hr/>
<h2 data-id="heading-10">三、注意事项：避坑 4 个关键细节</h2>
<ol>
<li><strong>键名重复问题</strong>：后出现的键值会覆盖前面的，需提前去重：</li>
</ol>
<pre><code class="hljs language-css" lang="css">const duplicateArr = <span class="hljs-selector-attr">[[<span class="hljs-string">'name'</span>, <span class="hljs-string">'李四'</span>]</span>, <span class="hljs-selector-attr">[<span class="hljs-string">'name'</span>, <span class="hljs-string">'王五'</span>]</span>];
console<span class="hljs-selector-class">.log</span>(<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.fromEntries</span>(duplicateArr)); // { name: <span class="hljs-string">'王五'</span> }
</code></pre>
<ol start="2">
<li><strong>非数组参数报错</strong>：必须传入可迭代对象（数组、Map 等），否则抛错：</li>
</ol>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 错误用法</span>
<span class="hljs-selector-tag">Object</span><span class="hljs-selector-class">.fromEntries</span>(<span class="hljs-string">'invalid'</span>); <span class="hljs-comment">// Uncaught TypeError: Invalid iterable object</span>
</code></pre>
<ol start="3">
<li><strong>null/undefined 处理</strong>：值为 null/undefined 会正常保留，不会过滤：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [[<span class="hljs-string">'address'</span>, <span class="hljs-literal">null</span>], [<span class="hljs-string">'phone'</span>, <span class="hljs-literal">undefined</span>]];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(arr)); <span class="hljs-comment">// { address: null, phone: undefined }</span>
</code></pre>
<ol start="4">
<li><strong>兼容性</strong>：支持 ES2019 及以上环境，IE 完全不支持，需兼容时加 polyfill：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简单polyfill（兼容低版本浏览器）</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Object</span>.<span class="hljs-property">fromEntries</span>) {
  <span class="hljs-title class_">Object</span>.<span class="hljs-property">fromEntries</span> = <span class="hljs-function"><span class="hljs-params">arr</span> =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, ...arr.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span> ({ [k]: v })));
}
</code></pre>
<hr/>
<h2 data-id="heading-11">四、差异化亮点：别人没说的实用技巧</h2>
<p>多数文章只讲基础用法，但实际开发中：</p>
<ul>
<li>结合 <code>Object.fromEntries + new Map()</code> 可实现有序对象（Map 的键顺序保留）：</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> orderedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-string">'b'</span>, <span class="hljs-number">2</span>], [<span class="hljs-string">'a'</span>, <span class="hljs-number">1</span>]]);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(orderedMap)); <span class="hljs-comment">// { b: 2, a: 1 }（保留插入顺序）</span>
</code></pre>
<ul>
<li>处理接口返回的「键值对数组」时，搭配解构能快速提取所需属性，比 for 循环提效 60%，这也是前端职场中「高效编码」的核心细节。</li>
</ul>
<hr/>
<p>建议收藏本文，下次遇到数组转对象需求直接对照实操。你在开发中遇到过哪些数组转对象的坑？或者有更简洁的写法？欢迎在评论区交流～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 CSS `perspective` 实现 3D 卡片效果]]></title>    <link>https://juejin.cn/post/7571086754879520814</link>    <guid>https://juejin.cn/post/7571086754879520814</guid>    <pubDate>2025-11-11T04:04:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571086754879520814" data-draft-id="7570992947463815178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 CSS `perspective` 实现 3D 卡片效果"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-11-11T04:04:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿明Drift"/> <meta itemprop="url" content="https://juejin.cn/user/3667626522083448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 CSS `perspective` 实现 3D 卡片效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3667626522083448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿明Drift
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:04:39.000Z" title="Tue Nov 11 2025 04:04:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一个简单但能显著提升网页用户体验的 3D 卡片组件。本文将带你从零开始理解 <code>perspective</code> 的原理，并结合 React 生态中的优秀库（如 <code>react-tilt</code>），打造一个随鼠标移动而动态倾斜的 3D 卡片组件。</p>
</blockquote>
<p>在现代网页设计中，3D 效果不仅能提升视觉吸引力，还能增强用户交互体验。其中 CSS 的 <code>perspective</code> 属性是实现基础 3D 变换的核心属性之一。本文将通过实际案例，深入解析如何利用 CSS <code>perspective</code> 创建令人印象深刻的 3D 卡片效果。</p>
<p>起因是在浏览一个壁纸网站时看到一个引人注目的 3D 卡片效果，作为一个优秀的前端开发，那必须得研究并借鉴一下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d21c9e5f4a8948f587e3d8bbfb195529~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5piORHJpZnQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763439146&amp;x-signature=aZjfouNtsZ1d5RuElKmDMxNfMWs%3D" alt="6-thumb.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">前置知识</h2>
<h3 data-id="heading-1">基本概念</h3>
<h4 data-id="heading-2">1. 什么是透视（Perspective）？</h4>
<p>在现实世界中，远处的物体看起来更小，近处的物体看起来更大。这种效果称为<strong>透视</strong>。<br/>
CSS 的 <code>perspective</code> 就是用来模拟这种视觉效果的。</p>
<h4 data-id="heading-3">2. 默认情况</h4>
<p>默认情况下，所有变换都是 <strong>正交投影</strong>（orthographic projection），没有远近缩放效果。启用 <code>perspective</code> 后，就会变成 <strong>透视投影</strong>（perspective projection）。</p>
<hr/>
<h3 data-id="heading-4">语法</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">perspective</span>: none | &lt;length&gt;;
</code></pre>
<ul>
<li><code>none</code>：默认值，表示不应用透视（等同于无穷远的视角，无深度感）。</li>
<li><code>&lt;length&gt;</code>：指定观察者与 Z=0 平面的距离，单位通常是 <code>px</code>。值越小，透视效果越强；值越大，效果越弱（趋近于无透视）。</li>
</ul>
<blockquote>
<p>注意：<code>perspective</code> <strong>不能为负值</strong>，也不能使用百分比。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">两种使用方式</h3>
<h4 data-id="heading-6">方式 1：作为父容器的属性（推荐）</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">600px</span>;
}
<span class="hljs-selector-class">.child</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">45deg</span>);
}
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span>3D 元素<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>✅ <strong>优点</strong>：</p>
<ul>
<li>所有子元素共享同一个消失点（vanishing point），看起来更自然。</li>
<li>更符合真实世界的透视逻辑。</li>
</ul>
<h4 data-id="heading-7">方式 2：作为 <code>transform</code> 的函数（不推荐用于复杂场景）</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.element</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">perspective</span>(<span class="hljs-number">600px</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">45deg</span>);
}
</code></pre>
<p>⚠️ <strong>缺点</strong>：</p>
<ul>
<li>每个元素都有自己的消失点，多个元素同时变换时会显得不协调。</li>
<li>不适合构建复杂的 3D 场景。</li>
</ul>
<hr/>
<h3 data-id="heading-8">相关属性详解</h3>
<h4 data-id="heading-9">perspective-origin</h4>
<ul>
<li><code>perspective-origin</code> 定义了透视的"观察中心点"，默认是元素的中心（<code>50% 50%</code>）。</li>
<li>类似于相机对准的位置。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">800px</span>;
    <span class="hljs-attribute">perspective-origin</span>: top left; <span class="hljs-comment">/* 从左上角观察 */</span>
}
</code></pre>
<h4 data-id="heading-10">transform-style</h4>
<ul>
<li>决定子元素如何在 3D 空间中渲染</li>
<li><code>flat</code>（默认）：子元素在 2D 平面中渲染，不保留 3D 层级关系</li>
<li><code>preserve-3d</code>：保留 3D 层级关系，子元素在 3D 空间中渲染</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">perspective</span>: <span class="hljs-number">800px</span>;
    <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;
}
</code></pre>
<h4 data-id="heading-11">transform-style: flat</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aed5d05dd5b5452aaa9e762268732180~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5piORHJpZnQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763439146&amp;x-signature=Mmuh6pP7HkG6rq0TPXQAcYT75G4%3D" alt="style-flat" loading="lazy"/></p>
<h4 data-id="heading-12">transform-style: preserve-3d</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8400572c82e494d85a05b1ee2e646eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5piORHJpZnQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763439146&amp;x-signature=jNzh3uvTPITmf3oe0CyGuOMwjqI%3D" alt="6-style-3d.png" loading="lazy"/></p>
<h4 data-id="heading-13">backface-visibility</h4>
<ul>
<li>控制元素背面是否可见</li>
<li><code>visible</code>（默认）：背面可见</li>
<li><code>hidden</code>：背面不可见</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
    <span class="hljs-attribute">backface-visibility</span>: hidden;
}
</code></pre>
<h3 data-id="heading-14">总结</h3>





























<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td>作用</td><td>控制 3D 变换的透视强度</td></tr><tr><td>值越小</td><td>透视越强（夸张的近大远小）</td></tr><tr><td>值越大</td><td>透视越弱（接近平面）</td></tr><tr><td>推荐用法</td><td>应用于父容器，而非单个元素</td></tr><tr><td>配合属性</td><td><code>transform</code>, <code>transform-style</code>, <code>perspective-origin</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-15">注意事项</h3>
<ol>
<li><strong>只有设置了 <code>perspective</code> 的祖先元素内的 3D 变换才会呈现透视效果</strong>。</li>
<li><code>perspective</code> 本身不会触发 3D 渲染上下文，必须配合 <code>transform</code> 使用。</li>
<li>使用 <code>transform-style: preserve-3d</code> 可以保持 3D 层级关系。</li>
<li>合理使用 <code>backface-visibility: hidden</code> 可以避免不必要的渲染问题。</li>
</ol>
<hr/>
<h2 data-id="heading-16">实际应用场景</h2>
<h3 data-id="heading-17">带透视的 3D 响应式卡片</h3>
<p>现在用 <code>perspective</code> 来复刻一个开头说的壁纸网站的 3D 卡片效果：当鼠标在卡片上移动时，卡片会根据鼠标位置做出响应式的旋转效果，产生逼真的 3D 倾斜感。</p>
<p>关键点就在于要<strong>动态计算旋转的角度</strong>。</p>
<h4 data-id="heading-18">原生 JavaScript 版本</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>3D Hover Card with Perspective<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
            <span class="hljs-selector-tag">body</span> {
                <span class="hljs-attribute">display</span>: flex;
                <span class="hljs-attribute">justify-content</span>: center;
                <span class="hljs-attribute">align-items</span>: center;
                <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
                <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
                <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f2f5</span>;
                <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
            }

            <span class="hljs-comment">/* 关键：设置 perspective 在父容器上 */</span>
            <span class="hljs-selector-class">.card-container</span> {
                <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
                <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
                <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000px</span>; <span class="hljs-comment">/* 透视距离，控制3D强度 */</span>
            }

            <span class="hljs-selector-class">.card</span> {
                <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
                <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
                <span class="hljs-attribute">background</span>: white;
                <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">16px</span>;
                <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>);
                <span class="hljs-attribute">display</span>: flex;
                <span class="hljs-attribute">justify-content</span>: center;
                <span class="hljs-attribute">align-items</span>: center;
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
                <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
                <span class="hljs-attribute">cursor</span>: pointer;

                <span class="hljs-comment">/* 启用3D变换上下文 */</span>
                <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;
                <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.1s</span> ease-out;

                <span class="hljs-comment">/* 初始轻微倾斜（可选） */</span>
                <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">5deg</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0deg</span>);
            }
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"card"</span>&gt;</span>✨ 3D Hover Card<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
            <span class="hljs-keyword">const</span> card = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'card'</span>);
            <span class="hljs-keyword">const</span> container = card.<span class="hljs-property">parentElement</span>;

            container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                <span class="hljs-comment">// 获取容器尺寸和鼠标位置</span>
                <span class="hljs-keyword">const</span> rect = container.<span class="hljs-title function_">getBoundingClientRect</span>();
                <span class="hljs-keyword">const</span> x = e.<span class="hljs-property">clientX</span> - rect.<span class="hljs-property">left</span>;
                <span class="hljs-keyword">const</span> y = e.<span class="hljs-property">clientY</span> - rect.<span class="hljs-property">top</span>;

                <span class="hljs-comment">// 计算中心点偏移（归一化到 -1 ~ 1）</span>
                <span class="hljs-keyword">const</span> centerX = (x - rect.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>) / (rect.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>); <span class="hljs-comment">// -1 到 1</span>
                <span class="hljs-keyword">const</span> centerY = (y - rect.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>) / (rect.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>); <span class="hljs-comment">// -1 到 1</span>

                <span class="hljs-comment">// 控制旋转角度（可调节灵敏度）</span>
                <span class="hljs-keyword">const</span> rotateY = centerX * <span class="hljs-number">15</span>; <span class="hljs-comment">// 水平方向最大 ±15 度</span>
                <span class="hljs-keyword">const</span> rotateX = -centerY * <span class="hljs-number">15</span>; <span class="hljs-comment">// 垂直方向（注意负号：向下移动应向上仰）</span>

                card.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`rotateX(<span class="hljs-subst">${rotateX}</span>deg) rotateY(<span class="hljs-subst">${rotateY}</span>deg)`</span>;
            });

            container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseleave'</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-comment">// 鼠标离开时恢复原状</span>
                card.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'rotateX(5deg) rotateY(0deg)'</span>;
            });
        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-19">使用 React 开源库 <code>react-tilt</code></h4>
<h5 data-id="heading-20">安装</h5>
<pre><code class="hljs language-bash" lang="bash">npm install react-tilt
</code></pre>
<h5 data-id="heading-21">使用示例</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Tilt</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-tilt'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TiltCard</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> options = {
        <span class="hljs-attr">reverse</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 是否反转方向</span>
        <span class="hljs-attr">max</span>: <span class="hljs-number">35</span>, <span class="hljs-comment">// 最大倾斜角度</span>
        <span class="hljs-attr">perspective</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 透视距离（对应 CSS perspective）</span>
        <span class="hljs-attr">scale</span>: <span class="hljs-number">1.1</span>, <span class="hljs-comment">// 鼠标悬停时放大比例</span>
        <span class="hljs-attr">speed</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 过渡动画速度（ms）</span>
        <span class="hljs-attr">transition</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">axis</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 锁定轴（'x' 或 'y'）</span>
        <span class="hljs-attr">reset</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 鼠标离开后是否重置</span>
        <span class="hljs-attr">easing</span>: <span class="hljs-string">'cubic-bezier(.03,.98,.52,.99)'</span>,
    };

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Tilt</span> <span class="hljs-attr">options</span>=<span class="hljs-string">{options}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"tilt-root"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Dynamic 3D Card<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Move your mouse around!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Tilt</span>&gt;</span></span>
    );
}
</code></pre>
<p>我应用到了自己的博客列表页，作为卡片式的结构</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/242463654d624677baf656a2c2f962b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5piORHJpZnQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763439146&amp;x-signature=6Dnwfo450gtxhv8veiuGo44AzsU%3D" alt="6-myblog.gif" loading="lazy"/></p>
<h3 data-id="heading-22">其他应用场景</h3>
<ul>
<li>产品展示（如 360° 查看）</li>
<li>3D 轮播图</li>
<li>游戏或交互式 UI（如倾斜视差效果）</li>
</ul>
<hr/>
<h2 data-id="heading-23">性能优化建议</h2>
<ol>
<li><strong>使用 <code>transform</code> 和 <code>opacity</code> 进行动画</strong>：这两个属性不会触发重排（reflow）和重绘（repaint），性能更好。</li>
<li><strong>合理使用 <code>will-change</code> 属性</strong>：提前告知浏览器哪些属性将要发生变化，让浏览器提前进行优化。</li>
<li><strong>避免过度复杂的 3D 变换</strong>：过多的 3D 变换可能会影响页面性能，特别是在移动设备上。</li>
<li><strong>使用 CSS 硬件加速</strong>：通过 <code>transform: translateZ(0)</code> 或 <code>transform: translate3d(0, 0, 0)</code> 触发硬件加速。</li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
    <span class="hljs-attribute">will-change</span>: transform;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">/* 触发硬件加速 */</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-24"><strong>附：参考资料</strong></h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1Ur421G7A6" target="_blank" title="https://www.bilibili.com/video/BV1Ur421G7A6" ref="nofollow noopener noreferrer">Bilibili 视频：透视 perspective 让三维变换更真实</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fperspective" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/perspective" ref="nofollow noopener noreferrer">MDN - CSS perspective</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Ftransform-style" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-style" ref="nofollow noopener noreferrer">MDN - CSS transform-style</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fbackface-visibility" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/backface-visibility" ref="nofollow noopener noreferrer">MDN - CSS backface-visibility</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Freact-tilt" target="_blank" title="https://www.npmjs.com/package/react-tilt" ref="nofollow noopener noreferrer">react-tilt - npm</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fwill-change" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/will-change" ref="nofollow noopener noreferrer">CSS will-change 属性</a></li>
</ul>
<hr/>
<blockquote>
<p>学习优秀作品，是提升技术的最佳路径。本文作为自己的学习笔记，也希望这篇解析对你有所帮助</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Unsloth 的全微调之路丨从 Adapter 到 Full Fine-tuning]]></title>    <link>https://juejin.cn/post/7571005216910327827</link>    <guid>https://juejin.cn/post/7571005216910327827</guid>    <pubDate>2025-11-11T05:44:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571005216910327827" data-draft-id="7570976560708173887" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Unsloth 的全微调之路丨从 Adapter 到 Full Fine-tuning"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-11-11T05:44:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Unsloth 的全微调之路丨从 Adapter 到 Full Fine-tuning
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:44:37.000Z" title="Tue Nov 11 2025 05:44:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p><strong>本文完整的测试代码位置</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinyuwei-david%2Fdavid-share%2Ftree%2Fmaster%2FDeep-Learning%2FUnsloth-Full-SFT" target="_blank" title="https://github.com/xinyuwei-david/david-share/tree/master/Deep-Learning/Unsloth-Full-SFT" ref="nofollow noopener noreferrer">github.com/xinyuwei-da…</a></p>
<p><strong>GitHub repo</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxinyuwei-david%2Fdavid-share.git" target="_blank" title="https://github.com/xinyuwei-david/david-share.git" ref="nofollow noopener noreferrer">github.com/xinyuwei-da…</a></p>
<p>大语言模型（LLM）最近发展得非常快，一动就是好几亿甚至上百亿的参数，让很多 AI 工程师在微调这些大模型时犯了难。Unsloth 这个框架，原本主要是靠支持 LoRA、QLoRA 等 Adapter 微调而出名，重点就是省内存、训练快。</p>
<p>现在它又更进一步，支持了全参数微调（Full Fine-tuning），也就是说，单卡环境就能搞定大规模模型的完整训练。接下来我想聊一聊 Unsloth 全微调的背景、它用到的关键技术，以及在实际工程中怎么把它用好。</p>
<p><strong>从 LoRA/QLoRA 到 Full Fine-tuning：</strong></p>
<p><strong>Unsloth 的进化历程</strong></p>
<p><strong>初期聚焦</strong></p>
<p>LoRA &amp; QLoRA 早期的 Unsloth 仅支持基于 LoRA/QLoRA 的适配器微调（Adapter Fine-tuning）。它通过动态量化、稀疏优化、梯度检查点等技术手段，大幅减少显存占用，让工程师能在单卡或少卡环境下，对 LLM 进行有效训练。</p>
<p><strong>为什么最初只支持 Adapter 微调？</strong></p>
<ul>
<li><strong>实惠的硬件门槛</strong>：Adapter 微调只需更新部分额外参数，不必动用整套模型，从而有效减少 GPU 显存需求和训练开销。</li>
<li><strong>高性价比</strong>：对于大部分应用场景来说，使用 LoRA/QLoRA 得到的微调效果已足以解决“任务定制”需求，而且成本远低于全量微调。</li>
<li><strong>工程实现相对简单</strong>：无须管理全部模型权重的更新和保存，只需管理 LoRA 等附加层的参数即可。</li>
</ul>
<p>全参数微调走上日程 随着用户对微调需求的精细化、对模型性能的极致追求，以及在更大规模的 LLM 上进行高保真的领域适配需求日益增长，Unsloth 社区在 2024 ~ 2025 年间逐步加入了对 full fine-tuning 的支持，使得你无需额外插入Adapter，也能直接训练整个模型的全部参数。</p>
<p><strong>Unsloth 全微调：关键技术解析</strong></p>
<p><strong>梯度检查点（Gradient Checkpointing）</strong></p>
<ul>
<li>在单 GPU 进行全微调时，重新计算部分前向激活以节省显存成为了必然需求。</li>
<li>PyTorch 本身提供了 checkpoint 工具，但 Unsloth 在此基础上做了更深入的工程优化，大幅降低部分场景下的额外重算开销。</li>
</ul>
<p><strong>激活值卸载（Activation Offloading）</strong></p>
<p>当显存不足时，将部分激活值转存到 CPU 内存。Unsloth 会智能地在训练过程中安排卸载与回传时机，确保在最“恰当”的时刻介入，从而减小对训练速度的冲击。</p>
<p><strong>优化器状态分页（Optimizer Paging）</strong></p>
<ul>
<li>在大模型训练中，单卡不仅需要存储模型本身的参数，还要存储优化器状态，这也是显存占用的一大来源。</li>
<li>通过 8-bit 甚至更低精度的优化器（如 paged_adamw_8bit），即能把部分优化器状态分页至 CPU，释放 GPU 显存，进一步帮助单卡支持更大规模的模型。</li>
</ul>
<p><strong>工程上的部署实例与硬件选择</strong></p>
<p>以常用的 H100 94GB，H200 141GB， AMD MI300X 192 为例：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/936bf17fde304827b95221a9f2f13761~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444677&amp;x-signature=YkKQa43BYQDEPGDEdLfAJVT0iwo%3D" alt="" loading="lazy"/></p>
<ul>
<li>Unsloth 已默认开启多种优化机制（包括梯度检查点与分页式优化器），一般情况下无需额外配置。</li>
<li>全参数微调时显存压力高于 LoRA/QLoRA 等适配器方法，特别需注意的是：</li>
</ul>

<ul>
<li>若单卡 GPU 显存不足（低于80GB），请务必维持分页优化器（Paged Optimizer）默认开启的状态。</li>
<li>适当减小 batch size 通常会减少激活值卸载频率，从而获得整体更高的训练速度。</li>
</ul>

<ul>
<li>实际微调过程建议进行小规模实验验证，逐步调整相关超参数（batch size、序列长度等），结合自身的硬件配置和应用场景找到最佳性能与内存占用平衡点。</li>
</ul>
<p><strong>为什么不直接自己实现这些内存优化？</strong></p>
<ol>
<li><strong>维护难度高</strong>：手动在代码层面开发 offload、checkpoints 等逻辑，面对不同版本的 PyTorch / CUDA / 驱动，以及不同模型结构，调试复杂度极高，且易产生潜在内存泄露、兼容性问题。</li>
<li><strong>社区打磨与更新</strong>：Unsloth 在社区中已有大量真实使用场景与案例，经过了版本迭代与优化，加之官方维护的更新日志（release notes），更易确保长久可用与持续优化。</li>
<li><strong>专注业务逻辑</strong>：使用 Unsloth 可将时间投入到数据集清洗、任务工程化、下游效果评估，而不是消耗在重复开发类似的底层内存管理功能上。</li>
</ol>
<p><strong>最佳实践：如何平衡内存占用与训练效率</strong></p>
<p><strong>保持小 Batch Size（1~2 常见）</strong></p>
<ul>
<li>过大的 batch size 会导致 Unsloth 频繁进行激活值卸载，反而拖慢训练速度。</li>
<li>在单 GPU 场景中，小 batch + 累积梯度(gradient_accumulation_steps) 通常更优。</li>
</ul>
<p><strong>分阶段调试</strong></p>
<ul>
<li>先用小模型、短序列长度跑通流程，观察 GPU 负载与日志，用以确认 offloading 时机与显存开销。</li>
<li>一旦找到稳定训练配置，再逐步扩展到更大模型或更长序列。</li>
</ul>
<p><strong>充分启用 paged optimizer</strong></p>
<p>对于全参数微调而言，优化器状态空间非常可观，将其分页至 CPU，可以显著降低 GPU 显存峰值占用。</p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[postgresql数据库的安装]]></title>    <link>https://juejin.cn/post/7571176484515643444</link>    <guid>https://juejin.cn/post/7571176484515643444</guid>    <pubDate>2025-11-11T04:02:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484515643444" data-draft-id="7570984341414707215" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="postgresql数据库的安装"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-11T04:02:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="蓝色猪猪侠"/> <meta itemprop="url" content="https://juejin.cn/user/791248051648253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            postgresql数据库的安装
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/791248051648253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    蓝色猪猪侠
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T04:02:36.000Z" title="Tue Nov 11 2025 04:02:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>官网下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.postgresql.org%2Fdownload%2F" target="_blank" title="https://www.postgresql.org/download/" ref="nofollow noopener noreferrer">PostgreSQL: Downloads</a></p>
<p>centos7安装postgresql18为例：</p>
<p>1、下载，使用官方的source地址下载：</p>
<p>wget <a href="https://link.juejin.cn?target=https%3A%2F%2Fftp.postgresql.org%2Fpub%2Fsource%2Fv18.0%2Fpostgresql-18.0.tar.gz" target="_blank" title="https://ftp.postgresql.org/pub/source/v18.0/postgresql-18.0.tar.gz" ref="nofollow noopener noreferrer">ftp.postgresql.org/pub/source/…</a></p>
<p>2、解压 tar -xvf postgresql-18.0.tar.gz</p>
<p>3、编译安装时需要c++的相关依赖，若缺失，需要安装(yum install gcc gcc-c++ make libicu-devel bison flex readline-devel zlib-devel)</p>
<p>4、编译与安装
./configure --prefix=安装目录  make &amp;&amp; make install</p>
<p>5、新建数据库用户，并新建数据存储目录</p>
<pre><code class="hljs language-bash" lang="bash">useradd postgres
<span class="hljs-built_in">mkdir</span> 数据库安装目录/data
<span class="hljs-built_in">chown</span> postgres:postgres 数据库安装目录/data
</code></pre>
<p>6、配置环境变量，指定数据存储目录</p>
<pre><code class="hljs language-bash" lang="bash">vim /etc/profile.d/pgsql.sh
<span class="hljs-built_in">export</span> PGHOME=pg安装目录
<span class="hljs-built_in">export</span> PGDATA==pg安装目录/data
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PGHOME</span>/bin:<span class="hljs-variable">$PATH</span>
</code></pre>
<p>7、切换到postgres用户，并初始化数据库,已进入到bin目录</p>
<pre><code class="hljs language-bash" lang="bash">./initdb -D ../data/
</code></pre>
<p>8、编辑配置文件信息</p>
<pre><code class="hljs language-bash" lang="bash">vim ../data/postgresql.conf
相关参数解析：
listen_address：监听地址，默认localhost，*表示所有
port：端口号，默认5432
max_connections：最大连接数
</code></pre>
<p>9、启动服务，使用自带脚本</p>
<pre><code class="hljs language-bash" lang="bash">将源码中的脚本拷贝到/etc/init.d/目录下
<span class="hljs-built_in">cp</span> 源码目录/contrib/start-scripts/linux /etc/init.d/postgresql
添加执行权限 <span class="hljs-built_in">chmod</span> +x /etc/init.d/postgresql
开机自启动  chkconfig --add postgresql
启动 service postgresql start
关闭 service postgresql stop
重启 service postgresql restart
</code></pre>
<p>10、指定远程连接规则</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">data</span>目录下编辑: <span class="hljs-selector-tag">vim</span> <span class="hljs-selector-tag">pg_hba</span><span class="hljs-selector-class">.conf</span>
<span class="hljs-selector-id">#postgres</span>用户不允许远程连接
<span class="hljs-selector-tag">host</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">postgres</span> <span class="hljs-number">0.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span>/<span class="hljs-number">0</span> <span class="hljs-selector-tag">reject</span>
<span class="hljs-selector-tag">host</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">all</span> <span class="hljs-number">0.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.0</span>/<span class="hljs-number">0</span> <span class="hljs-selector-tag">password</span>
端口号不是默认的<span class="hljs-number">5432</span>的连接方式
<span class="hljs-selector-tag">psql</span> <span class="hljs-selector-tag">-h</span> &lt;主机名或<span class="hljs-selector-tag">IP</span>&gt; <span class="hljs-selector-tag">-p</span> &lt;端口号&gt; <span class="hljs-selector-tag">-U</span> &lt;用户名&gt; <span class="hljs-selector-tag">-d</span> &lt;数据库名&gt;
</code></pre>
<p>11、创建用户并授予权限</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> 用户名 <span class="hljs-keyword">with</span> password 密码;
授予管理员权限
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> 用户名 <span class="hljs-keyword">with</span> superuser;
创建一个与用户名一致的数据库
<span class="hljs-keyword">create</span> database 用户名
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java基础（六：线程、线程同步，线程池）]]></title>    <link>https://juejin.cn/post/7571176484514316303</link>    <guid>https://juejin.cn/post/7571176484514316303</guid>    <pubDate>2025-11-11T05:48:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571176484514316303" data-draft-id="7570940025581715496" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java基础（六：线程、线程同步，线程池）"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-11T05:48:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱分享的鱼鱼"/> <meta itemprop="url" content="https://juejin.cn/user/3901536646733133"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java基础（六：线程、线程同步，线程池）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3901536646733133/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱分享的鱼鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:48:05.000Z" title="Tue Nov 11 2025 05:48:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">1. 多线程基础概念</h2>
<h3 data-id="heading-1">1.1 线程与进程</h3>
<ul>
<li><strong>进程</strong>：操作系统中正在运行的程序实例，拥有独立的内存空间，可以看做是一个正在运行的程序实例，进程之间是相互独立的。</li>
<li><strong>线程</strong>：进程中的执行单元，一个进程中可以包含多个线程，共享进程的内存空间。线程使用的资源开销更小，而且线程通信因为共享内存所以更轻松。</li>
</ul>
<h3 data-id="heading-2">1.2 线程的应用</h3>
<h4 data-id="heading-3">1. 并发处理</h4>
<ul>
<li><strong>Web服务器</strong>: 处理多个客户端请求，每个请求由独立 <code>Thread</code> 处理</li>
<li><strong>数据库连接池</strong>: 多个 <code>Thread</code> 共享数据库连接资源</li>
<li><strong>文件I/O操作</strong>: 同时读写多个文件</li>
</ul>
<h4 data-id="heading-4">2. 异步任务执行</h4>
<ul>
<li><strong>后台任务</strong>: 日志记录、数据备份等不需要用户等待的操作</li>
<li><strong>定时任务</strong>: 使用 <code>ScheduledExecutorService</code> 执行周期性任务</li>
<li><strong>消息队列消费者</strong>: 并行处理消息队列中的任务</li>
</ul>
<h4 data-id="heading-5">3. UI应用程序</h4>
<ul>
<li><strong>事件处理</strong>: GUI应用中使用 <code>Thread</code> 分离用户界面响应和后台计算</li>
<li><strong>动画效果</strong>: 在单独 <code>Thread</code> 中处理界面动画，避免阻塞主线程</li>
</ul>
<h4 data-id="heading-6">4. 计算密集型任务</h4>
<ul>
<li><strong>并行计算</strong>: 将大型计算任务分解为多个子任务并行执行</li>
<li><strong>数据处理</strong>: 多 <code>Thread</code> 处理大量数据集</li>
<li><strong>图像处理</strong>: 并行处理图像的不同区域</li>
</ul>
<h4 data-id="heading-7">5. 网络编程</h4>
<ul>
<li><strong>Socket通信</strong>: 服务器端使用多 <code>Thread</code> 处理多个客户端连接</li>
<li><strong>HTTP客户端</strong>: 并发发送多个HTTP请求</li>
<li><strong>RPC调用</strong>: 并行执行远程过程调用</li>
</ul>
<h3 data-id="heading-8">1.3 线程状态</h3>
<p>Java线程有以下几种状态：</p>
<ul>
<li><strong>NEW</strong>：新建状态，线程被创建但未启动</li>
<li><strong>RUNNABLE</strong>：可运行状态，包括运行中和就绪状态</li>
<li><strong>BLOCKED</strong>：阻塞状态，等待监视器锁</li>
<li><strong>WAITING</strong>：等待状态，无限期等待其他线程执行特定操作</li>
<li><strong>TIMED_WAITING</strong>：超时等待状态，有限时间等待</li>
<li><strong>TERMINATED</strong>：终止状态，线程执行完毕</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c85a909c0ccb4b9689c813179565c53f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5YiG5Lqr55qE6bG86bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763444885&amp;x-signature=WlmtnJh48GD%2BUssxaaUOorIULI4%3D" alt="image.png" loading="lazy"/></p>
<p>这张图展示了Java线程的生命周期和状态转换。一个线程从创建开始，经过就绪、运行、阻塞、等待等状态，最终结束。简单来说：线程刚创建时是"新建"状态
调用start()后进入"就绪"状态，等着CPU来执行一旦拿到CPU时间就开始"运行"如果遇到需要等待的情况（比如等待锁、休眠），就会进入相应的等待状态当等待条件满足或时间到，又会回到就绪状态继续竞争CPU最终线程执行完任务就"死亡"了。</p>
<h3 data-id="heading-9">1.4 线程的创建方式</h3>
<h4 data-id="heading-10">方式一：继承 Thread 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 线程执行的代码</span>
        System.out.println(<span class="hljs-string">"线程执行中..."</span>);
    }
}

<span class="hljs-comment">// 使用方式</span>
<span class="hljs-type">MyThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();
thread.start(); <span class="hljs-comment">// 启动线程</span>
</code></pre>
<h4 data-id="heading-11">方式二：实现 Runnable 接口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 线程执行的代码</span>
        System.out.println(<span class="hljs-string">"线程执行中..."</span>);
    }
}

<span class="hljs-comment">// 使用方式</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>());
thread.start();
</code></pre>
<h4 data-id="heading-12">方式三：实现 Callable 接口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Callable;
<span class="hljs-keyword">import</span> java.util.concurrent.FutureTask;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;String&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"执行结果"</span>;
    }
}

<span class="hljs-comment">// 使用方式</span>
FutureTask&lt;String&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>());
<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask);
thread.start();
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> futureTask.get(); <span class="hljs-comment">// 获取执行结果</span>
</code></pre>
<p>通过实现Runnable接口可以避免单继承的限制，提供更好的灵活性，因此最常用的创建方式是Runnable接口</p>
<h3 data-id="heading-13">1.5 线程控制方法</h3>
<p>Java线程控制方法主要包括以下几种：</p>
<ul>
<li><code>start()</code>: 启动线程，使线程进入就绪状态</li>
<li><code>run()</code>: 线程执行的具体任务逻辑</li>
<li><code>join()</code>: 等待线程执行完毕</li>
<li><code>sleep(long millis)</code>: 使当前线程休眠指定时间</li>
<li><code>yield()</code>: 暂停当前线程，让出CPU时间片</li>
<li><code>interrupt()</code>: 中断线程</li>
<li><code>isAlive()</code>: 判断线程是否存活</li>
<li><code>currentThread()</code>: 获取当前线程实例</li>
</ul>
<h2 data-id="heading-14">2. 线程安全与线程同步</h2>
<h3 data-id="heading-15">2.1 概念</h3>
<p><strong>线程安全</strong>‌是一个核心概念，它描述了一个类、方法或对象在多线程环境下‌行为正确的特性。当多个线程同时访问同一个共享资源（如一个变量、一个对象或一个静态字段）时，如果系统始终能产生‌正确的行为和结果，那么这个资源就是线程安全的。线程不安全源于多个线程在没有适当保护的情况下，对共享数据进行“‌<strong>读-改-写</strong>‌”操作。这会导致数据竞争和脏读，最终得到不可预知、错误的结果。线程安全的目标是保证数据的‌<strong>一致性</strong>‌和‌<strong>可见性</strong>‌。一个线程修改了数据，其他线程能立即看到修改后的、一致的数据。</p>
<h4 data-id="heading-16">一个经典的线程不安全例子（银行取款）：</h4>
<p>假设一个银行账户初始有1000元，夫妻二人同时用两张卡从两个ATM机取款1000元。</p>
<ol>
<li>线程A（丈夫）读取余额：1000元。</li>
<li>线程B（妻子）读取余额：1000元。</li>
<li>线程A计算：1000 - 1000 = 0，并将0写回余额。</li>
<li>线程B计算：1000 - 1000 = 0，并将0写回余额。</li>
</ol>
<p>最终账户余额为0元，但实际只应扣款一次，正确的余额应为0元（或根据逻辑处理为负数不允许操作），但这个过程银行损失了1000元。这就是线程不安全导致的数据错误。</p>
<p><strong>线程同步</strong>作为实现线程安全的核心技术体系，其本质在于通过协调多个线程的执行顺序和控制共享资源访问权限，建立并发的秩序。具体而言，这一机制通过两种关键方式保障系统可靠性：一是通过互斥锁（如synchronized或Lock）将可能被多线程同时访问的“临界区”代码转化为串行化执行，确保任一时刻仅有一个线程能操作共享资源；二是通过线程间通信机制（如wait/notify）使不同线程能够有序协作，将原本杂乱的并发操作转化为可控的有序流程。这种双重保障既防范了数据竞争导致的计算错误，又确保了资源状态的一致性，最终使得多线程程序在高效运行的同时保持行为的可预测性与正确性。</p>
<h3 data-id="heading-17">2.2 synchronized 关键字</h3>
<p><code>synchronized</code> 是Java中最基本的线程同步机制，可以保证同一时刻只有一个线程执行被它修饰的代码块。</p>
<h4 data-id="heading-18">修饰实例方法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++; <span class="hljs-comment">// 同一时刻只有一个线程能执行此方法</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> count;
    }
}
</code></pre>
<h4 data-id="heading-19">修饰静态方法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticCounter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        count++; <span class="hljs-comment">// 对类的所有实例同步</span>
    }
}
</code></pre>
<h4 data-id="heading-20">修饰代码块</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockSynchronization</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(lock) {
            count++; <span class="hljs-comment">// 只对lock对象加锁</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span>(<span class="hljs-built_in">this</span>) {
            count--; <span class="hljs-comment">// 对当前实例加锁</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-21">2.3 volatile 关键字</h3>
<p>‌volatile通过强制主内存读写和禁止指令重排序，解决了共享变量的可见性和有序性问题，是线程安全的必要组成部分，但不保证原子性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VolatileExample</span> {‌**<span class="hljs-keyword">volatile</span>通过强制主内存读写和禁止指令重排序，解决了共享变量的可见性和有序性问题，是线程安全的必要组成部分
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 保证可见性</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 保证可见性</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFlag</span><span class="hljs-params">(<span class="hljs-type">boolean</span> flag)</span> {
        <span class="hljs-built_in">this</span>.flag = flag; <span class="hljs-comment">// 修改立即对其他线程可见</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">getFlag</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> flag; <span class="hljs-comment">// 读取最新的值</span>
    }
}
</code></pre>
<p><strong>注意</strong>：<code>volatile</code> 不能替代 <code>synchronized</code>，因为它不保证复合操作的原子性：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++; <span class="hljs-comment">// 这不是原子操作，仍可能出现线程安全问题</span>
}
</code></pre>
<h2 data-id="heading-22">3. 线程池入门 Executors</h2>
<h3 data-id="heading-23">3.1 什么是线程池</h3>
<p>线程池是一种基于池化思想管理线程的工具，通过预先创建一定数量的线程来处理任务，避免频繁创建和销毁线程带来的开销。
举个例子，想象一家汉堡店（线程池）：</p>
<ol>
<li>‌<strong>核心员工（核心线程）</strong> ‌：常驻3位厨师（<code>corePoolSize=3</code>），日常订单由他们处理。</li>
<li>‌<strong>临时工（非核心线程）</strong> ‌：高峰期新增2位兼职（<code>maximumPoolSize=5</code>），应对客流激增。</li>
<li>‌<strong>候餐区（任务队列）</strong> ‌：10个座位（<code>ArrayBlockingQueue(10)</code>），新顾客在此排队。</li>
<li>‌<strong>拒绝策略（饱和策略）</strong> ‌：</li>
</ol>
<ul>
<li>‌<strong>抛异常</strong>‌：座位满时新顾客直接被告知"无法接待"（<code>AbortPolicy</code>）</li>
<li>‌<strong>调用者做</strong>‌：经理亲自做汉堡（<code>CallerRunsPolicy</code>）</li>
<li>‌<strong>丢弃队列最旧</strong>‌：请走排队最久的顾客（<code>DiscardOldestPolicy</code>）</li>
<li>‌<strong>直接拒绝</strong>‌：新顾客直接被拒（<code>DiscardPolicy</code>）</li>
</ul>
<h4 data-id="heading-24">⚡ ‌<strong>运作场景</strong>‌</h4>
<ul>
<li>
<p>‌<strong>低峰期</strong>‌：3位厨师处理订单，候餐区空置。</p>
</li>
<li>
<p>‌<strong>高峰期</strong>‌：</p>
<ul>
<li>订单涌入 → 候餐区坐满10人</li>
<li>继续来客 → 激活2位临时工</li>
<li>‌<strong>超负荷</strong>‌：新顾客触发拒绝策略（如经理道歉劝离）</li>
</ul>
</li>
<li>
<p>‌<strong>回归平静</strong>‌：临时工闲置超过<code>keepAliveTime</code>（如30分钟）后被解雇。</p>
</li>
</ul>
<h4 data-id="heading-25">🔧 ‌<strong>关键配置类比</strong>‌</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
  <span class="hljs-number">3</span>,    <span class="hljs-comment">// 核心厨师3人  </span>
  <span class="hljs-number">5</span>,    <span class="hljs-comment">// 最大厨师5人  </span>
  <span class="hljs-number">30</span>,   <span class="hljs-comment">// 临时工空闲30分钟下班  </span>
  TimeUnit.MINUTES,  
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10</span>) <span class="hljs-comment">// 10个候餐位  </span>
);
</code></pre>
<hr/>
<h4 data-id="heading-26">💡 ‌<strong>为什么用线程池？</strong> ‌</h4>
<ul>
<li>‌<strong>避免重复开销</strong>‌：不重复雇佣/解雇厨师（线程创建/销毁耗资源）</li>
<li>‌<strong>流量控制</strong>‌：队列缓冲突发订单，拒绝策略防系统崩溃</li>
<li>‌<strong>资源复用</strong>‌：厨师持续接单提升效率</li>
</ul>
<blockquote>
<p>就像快餐店不会为每个顾客雇新厨师，线程池‌<strong>复用线程</strong>‌处理任务，避免频繁创建销毁的开销，用队列和扩容机制平衡系统负载。</p>
</blockquote>
<h3 data-id="heading-27">3.2 常见的线程池类型</h3>
<h4 data-id="heading-28">FixedThreadPool 固定大小线程池</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-comment">// 创建固定大小为5的线程池</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">fixedThreadPool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);

<span class="hljs-comment">// 提交任务</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
    fixedThreadPool.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"任务 "</span> + taskId + <span class="hljs-string">" 正在执行，线程："</span> + Thread.currentThread().getName());
    });
}

fixedThreadPool.shutdown(); <span class="hljs-comment">// 关闭线程池</span>
</code></pre>
<h4 data-id="heading-29">CachedThreadPool 缓存线程池</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建缓存线程池，可根据需要创建新线程，空闲线程会被回收</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">cachedThreadPool</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
    cachedThreadPool.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"任务 "</span> + taskId + <span class="hljs-string">" 正在执行"</span>);
    });
}

cachedThreadPool.shutdown();
</code></pre>
<h4 data-id="heading-30">SingleThreadExecutor 单线程池</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建单线程池，保证所有任务按顺序执行</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">singleThreadExecutor</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
    singleThreadExecutor.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"任务 "</span> + taskId + <span class="hljs-string">" 正在执行"</span>);
    });
}

singleThreadExecutor.shutdown();
</code></pre>
<h4 data-id="heading-31">ScheduledThreadPool 定时任务线程池</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">// 创建定时任务线程池</span>
<span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduledThreadPool</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">3</span>);

<span class="hljs-comment">// 延迟执行</span>
scheduledThreadPool.schedule(() -&gt; {
    System.out.println(<span class="hljs-string">"延迟3秒执行的任务"</span>);
}, <span class="hljs-number">3</span>, TimeUnit.SECONDS);

<span class="hljs-comment">// 周期性执行</span>
scheduledThreadPool.scheduleAtFixedRate(() -&gt; {
    System.out.println(<span class="hljs-string">"每2秒执行一次的任务"</span>);
}, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, TimeUnit.SECONDS);

<span class="hljs-comment">// scheduledThreadPool.shutdown(); // 注意：定时任务通常不立即关闭</span>
</code></pre>
<h2 data-id="heading-32">4. ThreadPoolExecutor 使用</h2>
<h3 data-id="heading-33">4.1 ThreadPoolExecutor 构造参数详解</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
    <span class="hljs-number">5</span>,                          <span class="hljs-comment">// corePoolSize: 核心线程数</span>
    <span class="hljs-number">10</span>,                         <span class="hljs-comment">// maximumPoolSize: 最大线程数</span>
    <span class="hljs-number">60L</span>,                        <span class="hljs-comment">// keepAliveTime: 空闲线程存活时间</span>
    TimeUnit.SECONDS,           <span class="hljs-comment">// unit: 时间单位</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">100</span>), <span class="hljs-comment">// workQueue: 工作队列</span>
    Executors.defaultThreadFactory(), <span class="hljs-comment">// threadFactory: 线程工厂</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.AbortPolicy() <span class="hljs-comment">// handler: 拒绝策略</span>
);
</code></pre>
<h3 data-id="heading-34">4.2 核心参数说明</h3>

































<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>corePoolSize</code></td><td>核心线程数，即使空闲也会保留的线程数量</td></tr><tr><td><code>maximumPoolSize</code></td><td>最大线程数，线程池允许创建的最大线程数量</td></tr><tr><td><code>keepAliveTime</code></td><td>非核心线程的空闲存活时间</td></tr><tr><td><code>workQueue</code></td><td>用于存放待执行任务的阻塞队列</td></tr><tr><td><code>threadFactory</code></td><td>创建新线程的工厂</td></tr><tr><td><code>handler</code></td><td>拒绝策略，当线程池和队列都满时的处理策略</td></tr></tbody></table>
<h3 data-id="heading-35">4.3 工作流程</h3>
<ol>
<li>如果当前线程数小于 <code>corePoolSize</code>，即使线程池中有空闲线程，也会创建新的核心线程来执行任务</li>
<li>如果当前线程数等于或大于 <code>corePoolSize</code>，任务将被放入 <code>workQueue</code></li>
<li>如果 <code>workQueue</code> 已满，且当前线程数小于 <code>maximumPoolSize</code>，会创建新的非核心线程来执行任务</li>
<li>如果当前线程数已经达到 <code>maximumPoolSize</code>，且 <code>workQueue</code> 已满，则根据拒绝策略处理新任务</li>
</ol>
<h3 data-id="heading-36">4.4 拒绝策略</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AbortPolicy: 直接抛出异常（默认策略）</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.AbortPolicy()

<span class="hljs-comment">// CallerRunsPolicy: 由调用线程执行任务</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()

<span class="hljs-comment">// DiscardPolicy: 直接丢弃任务</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardPolicy()

<span class="hljs-comment">// DiscardOldestPolicy: 丢弃队列最前面的任务，然后重新尝试执行</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy()
</code></pre>
<h3 data-id="heading-37">4.5 自定义 ThreadPoolExecutor 示例</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 自定义线程池</span>
        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
            <span class="hljs-number">3</span>,                                      <span class="hljs-comment">// 核心线程数</span>
            <span class="hljs-number">6</span>,                                      <span class="hljs-comment">// 最大线程数</span>
            <span class="hljs-number">30L</span>,                                    <span class="hljs-comment">// 空闲线程存活时间</span>
            TimeUnit.SECONDS,                       <span class="hljs-comment">// 时间单位</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10</span>),          <span class="hljs-comment">// 有界阻塞队列</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactory</span>() {                  <span class="hljs-comment">// 自定义线程工厂</span>
                <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> {
                    <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r, <span class="hljs-string">"CustomThread-"</span> + counter++);
                    thread.setDaemon(<span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">return</span> thread;
                }
            },
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy() <span class="hljs-comment">// 拒绝策略</span>
        );
        
        <span class="hljs-comment">// 提交任务</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;
            executor.submit(() -&gt; {
                System.out.println(<span class="hljs-string">"任务 "</span> + taskId + <span class="hljs-string">" 由 "</span> + 
                    Thread.currentThread().getName() + <span class="hljs-string">" 执行"</span>);
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">2000</span>); <span class="hljs-comment">// 模拟任务执行</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            });
        }
        
        <span class="hljs-comment">// 关闭线程池</span>
        executor.shutdown();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 等待所有任务完成</span>
            <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executor.shutdownNow(); <span class="hljs-comment">// 强制关闭</span>
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executor.shutdownNow();
        }
    }
}
</code></pre>
<h3 data-id="heading-38">4.6 线程池状态管理</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 常用的线程池管理方法</span>
executor.shutdown();           <span class="hljs-comment">// 平滑关闭，不再接受新任务，等待已有任务完成</span>
executor.shutdownNow();        <span class="hljs-comment">// 立即关闭，尝试中断所有正在执行的任务</span>
executor.isShutdown();         <span class="hljs-comment">// 判断是否已关闭</span>
executor.isTerminated();       <span class="hljs-comment">// 判断是否所有任务都已完成</span>
executor.getPoolSize();        <span class="hljs-comment">// 获取当前线程数</span>
executor.getActiveCount();     <span class="hljs-comment">// 获取活跃线程数</span>
executor.getCompletedTaskCount(); <span class="hljs-comment">// 获取已完成任务数</span>
</code></pre>
<h2 data-id="heading-39">5. 最佳实践建议</h2>
<ol>
<li><strong>优先使用 ThreadPoolExecutor</strong> 而不是 <code>Executors</code> 工厂方法，可以更精确地控制线程池行为</li>
<li><strong>合理设置线程池大小</strong>：CPU密集型任务设置为CPU核心数+1，IO密集型任务可以设置更大</li>
<li><strong>选择合适的队列类型</strong>：<code>ArrayBlockingQueue</code> 适合有界队列，<code>LinkedBlockingQueue</code> 适合无界队列</li>
<li><strong>正确处理异常</strong>：在线程任务中捕获并处理异常，避免线程意外终止</li>
<li><strong>及时关闭线程池</strong>：应用结束前调用 <code>shutdown()</code> 或 <code>shutdownNow()</code> 方法</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全网最细，Qwen3大模型极致微调与推理实战：Unsloth一站式教程]]></title>    <link>https://juejin.cn/post/7570976560708730943</link>    <guid>https://juejin.cn/post/7570976560708730943</guid>    <pubDate>2025-11-11T05:52:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976560708730943" data-draft-id="7570976560708714559" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全网最细，Qwen3大模型极致微调与推理实战：Unsloth一站式教程"/> <meta itemprop="keywords" content="LLM,程序员,Agent"/> <meta itemprop="datePublished" content="2025-11-11T05:52:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全网最细，Qwen3大模型极致微调与推理实战：Unsloth一站式教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T05:52:01.000Z" title="Tue Nov 11 2025 05:52:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>在大模型快速迭代的今天，Qwen3 作为开源圈的黑马，凭借强悍的推理能力、多语言支持和灵活的“思考模式”切换，吸引了无数开发者关注。</p>
<p>你想让自己的AI项目更聪明、更高效吗？今天就带你全流程掌握如何用 <code>Unsloth</code> 框架对 Qwen3 进行高效微调、推理和评估，让你的应用一飞冲天！</p>
<h2 data-id="heading-0">一、Qwen3模型亮点全解析</h2>
<p>Qwen3 是新一代开源大语言模型，主打以下几个核心优势：</p>
<ul>
<li> <strong>多尺寸可选、部署灵活</strong>：无论是手机、智能眼镜还是自动驾驶、机器人，Qwen3 都能按需选择模型大小，适配边缘设备或云端服务器。</li>
<li> <strong>推理透明可控</strong>：独特的“思考模式”能让模型在输出答案前，先展示推理过程，极大方便调试、教学和代码生成。</li>
<li> <strong>多语言天花板</strong>：支持119种语言及方言，轻松应对全球化产品需求。</li>
<li> <strong>超长上下文处理</strong>：最大支持128K tokens，适合法律、代码、文档等超长文本场景。</li>
<li> <strong>高性能低成本</strong>：MoE（专家混合）架构只激活部分专家，推理快、成本低，媲美甚至超越同体量闭源大模型。</li>
<li> <strong>开源可定制</strong>：Apache 2.0协议，权重可随意下载、二次开发，直接对接Hugging Face生态。</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、Qwen3“思考模式”揭秘：让你的AI会“思考”</h2>
<p>Qwen3 的最大特色就是“思考模式”与“非思考模式”自由切换：</p>
<ul>
<li> <strong>思考模式</strong>：模型在输出答案前，会用<code>&lt;think&gt;...&lt;/think&gt;</code>标签详细展示推理步骤，比如数学计算、逻辑推断等，让你清楚看到AI的思路。</li>
<li> <strong>非思考模式</strong>：直接给出答案，速度更快，适合对话机器人、实时助手等场景。</li>
</ul>
<p>你可以通过三种方式控制思考模式：</p>
<ol>
<li><strong>API参数</strong>：<code>enable_thinking=True</code>（默认开启，输出完整推理过程）；<code>enable_thinking=False</code>（只输出答案，不展示推理）。</li>
<li><strong>Prompt指令</strong>：在用户消息中加<code>/no_think</code>，即使API参数为True，也强制关闭思考展示。</li>
<li><strong>后处理</strong>：如果只想要纯答案，可以在输出后通过字符串处理移除<code>&lt;think&gt;</code>标签。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d74f84508484aa994230bf80079c37c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763445121&amp;x-signature=Yaz2Bi5H16t7eCb4jixaJwiP%2Fak%3D" alt="" loading="lazy"/></p>
<p><strong>应用场景举例</strong>：</p>
<ul>
<li>教育/数学题讲解：展示每一步推导，AI秒变“讲题老师”。</li>
<li>代码生成/调试：看到AI决策流程，快速定位bug。</li>
<li>聊天助手/智能客服：关闭思考模式，响应更快，体验更丝滑。</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、Qwen3 + Unsloth 微调与推理全流程（附代码）</h2>
<p>下面以 PyTorch + Unsloth 框架为例，手把手教你微调和推理 Qwen3：</p>
<h3 data-id="heading-3">1. 环境准备</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch  
<span class="hljs-keyword">from</span> unsloth <span class="hljs-keyword">import</span> FastLanguageModel  
<span class="hljs-keyword">import</span> weave  <span class="hljs-comment"># 可选，用于可视化和分析  </span>
weave.init(<span class="hljs-string">'think_test'</span>)
</code></pre>
<h3 data-id="heading-4">2. 模型加载与配置</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">BASE_MODEL_NAME</span> = <span class="hljs-string">"unsloth/Qwen3-8B"</span>  
<span class="hljs-attr">max_seq_length</span> = <span class="hljs-number">2048</span>  
<span class="hljs-attr">dtype</span> = None  
<span class="hljs-attr">load_in_4bit</span> = <span class="hljs-literal">False</span>  
  
BASE_MODEL, <span class="hljs-attr">TOKENIZER</span> = FastLanguageModel.from_pretrained(  
    <span class="hljs-attr">model_name</span>=BASE_MODEL_NAME,  
    <span class="hljs-attr">max_seq_length</span>=max_seq_length,  
    <span class="hljs-attr">dtype</span>=dtype,  
    <span class="hljs-attr">load_in_4bit</span>=load_in_4bit  
)  
BASE_MODEL.eval().to("cuda")  
FastLanguageModel.for_inference(BASE_MODEL)
</code></pre>
<h3 data-id="heading-5">3. Prompt构建与推理函数</h3>
<pre><code class="hljs language-ini" lang="ini">def make_prompt(instruction):  
    return <span class="hljs-section">[{"role": "user", "content": instruction}]</span>  
  
defapply_chat_template(prompt, tokenizer, <span class="hljs-attr">enable_thinking</span>=<span class="hljs-literal">True</span>):  
    <span class="hljs-attr">messages</span> = make_prompt(prompt)  
    return tokenizer.apply_chat_template(  
        messages,  
        <span class="hljs-attr">tokenize</span>=<span class="hljs-literal">False</span>,  
        <span class="hljs-attr">add_generation_prompt</span>=<span class="hljs-literal">True</span>,  
        <span class="hljs-attr">enable_thinking</span>=enable_thinking  
    )  
  
@weave.op  
defgenerate_response(prompt, <span class="hljs-attr">enable_thinking</span>=<span class="hljs-literal">True</span>):  
    <span class="hljs-attr">prompt_text</span> = apply_chat_template(prompt, TOKENIZER, enable_thinking)  
    <span class="hljs-attr">inputs</span> = TOKENIZER([prompt_text], return_tensors=<span class="hljs-string">"pt"</span>).to(<span class="hljs-string">"cuda"</span>)  
    with torch.no_grad():  
        <span class="hljs-attr">gen_output</span> = BASE_MODEL.generate(  
            **inputs,  
            <span class="hljs-attr">max_new_tokens</span>=<span class="hljs-number">128</span>,  
            <span class="hljs-attr">use_cache</span>=<span class="hljs-literal">False</span>,  
            <span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>,  
            <span class="hljs-attr">top_p</span>=<span class="hljs-number">0.8</span>,  
            <span class="hljs-attr">top_k</span>=<span class="hljs-number">20</span>,  
            <span class="hljs-attr">min_p</span>=<span class="hljs-number">0.0</span>,  
        )  
    <span class="hljs-attr">output_text</span> = TOKENIZER.decode(gen_output[<span class="hljs-number">0</span>], skip_special_tokens=<span class="hljs-literal">True</span>)  
    return output_text
</code></pre>
<h3 data-id="heading-6">4. 实战测试</h3>
<pre><code class="hljs language-scss" lang="scss">math_question = "What is <span class="hljs-number">256</span> multiplied by <span class="hljs-number">17</span>?"  
math_question_no_think = "/no_think\nWhat is <span class="hljs-number">256</span> multiplied by <span class="hljs-number">17</span>?"  
  
<span class="hljs-built_in">print</span>("=== enable_thinking=True (默认) ===")  
<span class="hljs-built_in">print</span>(generate_response(math_question, enable_thinking=True)<span class="hljs-selector-class">.strip</span>())  
  
<span class="hljs-built_in">print</span>("=== enable_thinking=False ===")  
<span class="hljs-built_in">print</span>(generate_response(math_question, enable_thinking=False)<span class="hljs-selector-class">.strip</span>())  
  
<span class="hljs-built_in">print</span>("=== enable_thinking=True + /no_think in prompt ===")  
<span class="hljs-built_in">print</span>(generate_response(math_question_no_think, enable_thinking=True)<span class="hljs-selector-class">.strip</span>())
</code></pre>
<p><strong>效果说明</strong>：</p>
<ul>
<li>默认模式下，输出包含详细推理过程。</li>
<li>关闭思考模式，输出直接给答案。</li>
<li>Prompt加 <code>/no_think</code>，无论API参数如何，都只输出答案。</li>
</ul>
<h2 data-id="heading-7">四、Qwen3适用场景与实战建议</h2>
<ul>
<li> <strong>多端部署</strong>：适合手机、IoT、车载等多种硬件，灵活选型。</li>
<li> <strong>高透明度AI</strong>：教育、科研、代码生成等需要“可解释性”的场合首选。</li>
<li> <strong>超长文本/多语言</strong>：文档分析、全球化产品、法律合规等强需求。</li>
<li> <strong>高性价比推理</strong>：MoE架构让企业级部署更省钱。</li>
<li> <strong>开源自定义</strong>：二次开发、私有化部署无压力。</li>
</ul>
<h2 data-id="heading-8">五、总结</h2>
<p>Qwen3 + Unsloth 的组合，堪称国产大模型微调和推理的新范式。无论你是AI开发新手还是企业技术负责人，都能用极低门槛把AI能力集成到自己的产品中。只要学会上面这套流程，你就能让AI“会思考”、会解释、会多语言，还能轻松微调出专属模型！</p>
<h2 data-id="heading-9">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让代码更清晰：Android 中的 MVC、MVP 与 MVVM]]></title>    <link>https://juejin.cn/post/7570630923711135796</link>    <guid>https://juejin.cn/post/7570630923711135796</guid>    <pubDate>2025-11-10T07:50:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570630923711135796" data-draft-id="7570247858869338164" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让代码更清晰：Android 中的 MVC、MVP 与 MVVM"/> <meta itemprop="keywords" content="Android,MVVM,MVC"/> <meta itemprop="datePublished" content="2025-11-10T07:50:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨白"/> <meta itemprop="url" content="https://juejin.cn/user/2549135752044601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让代码更清晰：Android 中的 MVC、MVP 与 MVVM
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2549135752044601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T07:50:10.000Z" title="Mon Nov 10 2025 07:50:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">真正的问题</h2>
<p>在没有引入架构时，我们的 <code>Activity</code> 或 <code>Fragment</code> 非常臃肿：既要负责展示 View，又要负责响应点击事件，还需要去负责网络请求，处理业务逻辑，管理数据状态...</p>
<p>这导致了高耦合性，这种代码几乎无法测试且难以维护。</p>
<p>所以我们引入了架构模式，就是为了拆开 <code>Activity</code> 或 <code>Fragment</code>。</p>
<h2 data-id="heading-1">MVC 和 MVP 的关系</h2>
<p>首先澄清一个误区：MVP 并不是 MVC 的改进版本，只是解决同一个问题的两种不同的拆分思路。</p>
<p>我们通常认为原生 Android 就是 MVC，其中 <code>Activity</code> 是 Controller，XML 布局是 View，</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Model: 业务逻辑和数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> model = CounterModel()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.view_counter_content)

        <span class="hljs-keyword">val</span> countTextView = findViewById&lt;TextView&gt;(R.id.count_text_view)
        <span class="hljs-keyword">val</span> incrementButon = findViewById&lt;Button&gt;(R.id.increment_button)
        incrementButon.setOnClickListener {
            model.increment()
            countTextView.text = model.getCount().toString()
        }
    }
}
</code></pre>
<p><code>view_counter_content.xml</code> 文件布局代码：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span>
    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/count_text_view"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"0"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"24sp"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/increment_button"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"Increment"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span>
</code></pre>
<p>但 XML（View）只负责布局，肩负的职责太少，显示都是由 <code>Activity</code>（Controller）来完成的，所以 C、V 还是耦合在了一起，我们可以称其为 “M-VC” 架构。</p>
<h3 data-id="heading-2">MVC 拆 View：解耦视图</h3>
<p>我们可以封装一个自定义 View，让它自己在管理内部的 UI 和事件，对外暴露接口和回调。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Model: 业务逻辑和数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}


<span class="hljs-comment">// 管理自己的子视图和 UI 事件</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterView</span>(context: Context, attrs: AttributeSet?) : LinearLayout(context, attrs) {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> countTextView: TextView
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> incrementButon: Button

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> onIncrementListener: (() -&gt; <span class="hljs-built_in">Unit</span>)? = <span class="hljs-literal">null</span>

    <span class="hljs-keyword">init</span> {
        <span class="hljs-comment">// 加载布局</span>
        inflate(context, R.layout.view_counter_content, <span class="hljs-keyword">this</span>)

        countTextView = findViewById(R.id.count_text_view)
        incrementButon = findViewById(R.id.increment_button)

        incrementButon.setOnClickListener {
            <span class="hljs-comment">// 通知 Controller 发生了点击事件</span>
            onIncrementListener?.invoke()
        }
    }

    <span class="hljs-comment">// 让 Controller 更新 UI</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setCount</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
        countTextView.text = count.toString()
    }

    <span class="hljs-comment">// 让 Controller 监听 UI 事件 (命名已统一)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setOnIncrementListener</span><span class="hljs-params">(listener: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-keyword">this</span>.onIncrementListener = listener
    }

}

<span class="hljs-comment">// Controller: Activity，负责调度</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MVCActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> model = CounterModel()
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_mvc)

        <span class="hljs-keyword">val</span> counterView = findViewById&lt;CounterView&gt;(R.id.counter_view)
        <span class="hljs-comment">// Controller 初始加载数据</span>
        counterView.setCount(model.getCount())

        <span class="hljs-comment">// Controller 监听 UI 事件</span>
        counterView.setOnIncrementListener {
            <span class="hljs-comment">// 事件触发，更新 Model</span>
            model.increment()
            <span class="hljs-comment">// 使用 Model 的新数据更新 UI</span>
            counterView.setCount(model.getCount())
        }
    }
}
</code></pre>
<p><code>activity_mvc</code> 布局代码：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">com.example.app.CounterView</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/counter_view"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span>
    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">com.example.app.CounterView</span>&gt;</span>
</code></pre>
<p>这样 <code>Activity</code>（Controller） 就很干净了，只负责调度，并不用关心控件的存在。</p>
<h3 data-id="heading-3">MVP 拆 Controller：解耦控制器</h3>
<p>MVP 拆分的不是 View，它认为 <code>Activity</code> 也是 View（因为它持有 View 的引用）。</p>
<p>MVP 把所有的调度和业务逻辑抽取到了 <code>Presenter</code> 中，通过接口和 <code>Activity</code> 通信。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Model: 业务逻辑和数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}

<span class="hljs-comment">// Contract: 定义 View 和 Presenter 的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">CounterContract</span> {
    <span class="hljs-comment">// View 的接口</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">View</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showCount</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span>
    }

    <span class="hljs-comment">// Presenter 的接口</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Presenter</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadInitialCount</span><span class="hljs-params">()</span></span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">incrementCount</span><span class="hljs-params">()</span></span>
    }
}

<span class="hljs-comment">// Presenter: 控制器，负责所有逻辑</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterPresenter</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> view: CounterContract.View,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> model: CounterModel
) : CounterContract.Presenter {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadInitialCount</span><span class="hljs-params">()</span></span> {
        view.showCount(model.getCount())
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">incrementCount</span><span class="hljs-params">()</span></span> {
        model.increment()
        view.showCount(model.getCount())
    }
}


<span class="hljs-comment">// View: Activity，实现接口，所有逻辑委托给 Presenter</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MVPActivity</span> : <span class="hljs-type">AppCompatActivity</span>(), CounterContract.View {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> presenter: CounterContract.Presenter
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> countTextView: TextView
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> incrementButton: Button

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_mvp)

        countTextView = findViewById(R.id.count_text_view)
        incrementButton = findViewById(R.id.increment_button)
        presenter = CounterPresenter(<span class="hljs-keyword">this</span>, CounterModel())

        <span class="hljs-comment">// 绑定按钮点击事件到 Presenter</span>
        incrementButton.setOnClickListener {
            presenter.incrementCount()
        }

        <span class="hljs-comment">// 加载初始数据</span>
        presenter.loadInitialCount()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showCount</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
        countTextView.text = count.toString()
    }
}
</code></pre>
<blockquote>
<p><code>activity_mvp</code> 布局文件的代码和 <code>view_counter_content</code> 布局一样。</p>
</blockquote>
<p><code>Presenter</code> 是一个纯粹的类，而 <code>Activity</code> 变为了被动的视图，只负责实现接口。</p>
<p>现在，我们就知道了 MVC 和 MVP 都是为了解耦 V 和 C，只不过两者的方向不同。MVP 并没有比 MVC 更好。</p>
<h2 data-id="heading-4">MVVM 与数据绑定</h2>
<p>MVP 解决了耦合性，但也带来了新的问题，随着业务变得复杂，<code>CounterContract.View</code> 接口也会越来越臃肿，Presenter 和 View 存在了大量的命令式调用。</p>
<p>那么我们能不能让 View 订阅数据，我们负责修改数据，View 自动更新呢？</p>
<p>这就是 MVVM 的核心思想：数据绑定。</p>
<p>我们通常会使用 <code>ViewModel</code> 和 <code>LiveData</code> 这两个<strong>工具</strong>来实现它：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Model: 业务逻辑和数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterModel</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}

<span class="hljs-comment">// ViewModel: 持有 Model，暴露状态</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterViewModel</span> : <span class="hljs-type">ViewModel</span>() {

    <span class="hljs-comment">// ViewModel 自己创建和管理 Model</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> model = CounterModel()

    <span class="hljs-comment">// 对外暴露 LiveData</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _count = MutableLiveData&lt;<span class="hljs-built_in">Int</span>&gt;()
    <span class="hljs-keyword">val</span> count: LiveData&lt;<span class="hljs-built_in">Int</span>&gt; = _count

    <span class="hljs-keyword">init</span> {
        <span class="hljs-comment">// 加载初始状态</span>
        _count.value = model.getCount()
    }

    <span class="hljs-comment">//  对外暴露业务逻辑方法</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">incrementCount</span><span class="hljs-params">()</span></span> {
        model.increment()
        _count.value = model.getCount()
    }
}


<span class="hljs-comment">// View: Activity，持有 ViewModel</span>
<span class="hljs-comment">// 订阅 ViewModel 的 LiveData，调用 ViewModel 的方法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MVVMActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> countTextView: TextView
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> incrementButton: Button
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: CounterViewModel <span class="hljs-keyword">by</span> viewModels()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(R.layout.activity_mvvm) <span class="hljs-comment">// 同 activity_mvp.xml</span>

        countTextView = findViewById(R.id.count_text_view)
        incrementButton = findViewById(R.id.increment_button)

        incrementButton.setOnClickListener {
            <span class="hljs-comment">// 调用 ViewModel 的方法</span>
            viewModel.incrementCount()
        }

        <span class="hljs-comment">// 订阅 ViewModel 的 LiveData</span>
        viewModel.count.observe(<span class="hljs-keyword">this</span>) { newCount -&gt;
            <span class="hljs-comment">// 状态改变时，更新 UI</span>
            countTextView.text = newCount.toString()
        }
    }
}
</code></pre>
<p><code>Activity</code> 不需要实现任何接口，<code>ViewModel</code> 也无需持有 <code>Activity</code> 的引用，真正实现了 V 和 VM 的解耦。</p>
<h3 data-id="heading-5">ViewModel 的角色</h3>
<p><code>androidx.lifecycle.ViewModel</code> 最初是为了解决屏幕旋转等配置变更时的数据存活问题而诞生的，无论是 <code>Presenter</code> 或是自定义的 VM 对象，都会在 Activity 销毁时重建。</p>
<blockquote>
<p>数据绑定的本质是观察者模式，也可以通过其他方式来实现数据绑定，所以 VM 不一定代表了 <code>androidx.lifecycle.ViewModel</code>。</p>
</blockquote>
<p>但由于 <code>ViewModel</code> 的特性，能够持有状态、完成逻辑处理，因此，它完美地承担了 VM 的角色。</p>
<p>所以，现在 MVVM 架构中：</p>
<ul>
<li>VM 指的一般是 ViewModel（内部持有 <code>LiveData</code> 或 <code>StateFlow</code>）</li>
<li>V 指的是 Activity / Fragment / Composable，</li>
<li>M 是 Model（在复杂项目中通常是 <code>Repository</code> 或 <code>UseCase</code>）</li>
</ul>
<h2 data-id="heading-6">总结</h2>
<p>架构设计的真正核心就是<strong>拆分</strong>，无论是 MVC（拆分 View）、MVP（拆分 Controller）还是 MVVM（用数据绑定解耦）。它们的目的都是将臃肿的集合体，拆分为清晰的、各司其职的组件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>